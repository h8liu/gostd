<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5877263">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5877318">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5877372">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5877423">//&nbsp;Package&nbsp;gif&nbsp;implements&nbsp;a&nbsp;GIF&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5877482">//</span><br>
<span class="lineno"></span><span class="comment" id="5877485">//&nbsp;The&nbsp;GIF&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/Graphics/GIF/spec-gif89a.txt.</span><br>
<span class="lineno"></span><span class="keyword" id="5877564">package</span>&nbsp;<span class="ident" id="5877572">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5877577">import</span>&nbsp;<span class="op" id="5877584">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5877587">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5877596">&#34;compress/lzw&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5877612">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5877622">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5877629">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5877638">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5877653">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5877658">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5877661">var</span>&nbsp;<span class="op" id="5877665">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5877668">errNotEnough</span>&nbsp;<span class="op" id="5877681">=</span>&nbsp;<span class="ident" id="5877683">errors</span><span class="op" id="5877689">.</span><span class="ident" id="5877690">New</span><span class="op" id="5877693">(</span><span class="string" id="5877694">&#34;gif:&nbsp;not&nbsp;enough&nbsp;image&nbsp;data&#34;</span><span class="op" id="5877722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5877725">errTooMuch</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5877738">=</span>&nbsp;<span class="ident" id="5877740">errors</span><span class="op" id="5877746">.</span><span class="ident" id="5877747">New</span><span class="op" id="5877750">(</span><span class="string" id="5877751">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><span class="op" id="5877777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5877780">errBadPixel</span>&nbsp;&nbsp;<span class="op" id="5877793">=</span>&nbsp;<span class="ident" id="5877795">errors</span><span class="op" id="5877801">.</span><span class="ident" id="5877802">New</span><span class="op" id="5877805">(</span><span class="string" id="5877806">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="5877832">)</span><br>
<span class="lineno"></span><span class="op" id="5877834">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="5877837">//&nbsp;If&nbsp;the&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,&nbsp;then&nbsp;decode&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="5877932">type</span>&nbsp;<span class="ident" id="5877937">reader</span>&nbsp;<span class="keyword" id="5877944">interface</span>&nbsp;<span class="op" id="5877954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5877957">io</span><span class="op" id="5877959">.</span><span class="ident" id="5877960">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5877968">io</span><span class="op" id="5877970">.</span><span class="ident" id="5877971">ByteReader</span><br>
<span class="lineno">30</span><span class="op" id="5877982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5877985">//&nbsp;Masks&nbsp;etc.</span><br>
<span class="lineno"></span><span class="keyword" id="5877999">const</span>&nbsp;<span class="op" id="5878005">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5878008">//&nbsp;Fields.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878020">fColorMapFollows</span>&nbsp;<span class="op" id="5878037">=</span>&nbsp;<span class="num" id="5878039">1</span>&nbsp;<span class="op" id="5878041">&lt;&lt;</span>&nbsp;<span class="num" id="5878044">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5878048">//&nbsp;Image&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878066">ifLocalColorTable</span>&nbsp;<span class="op" id="5878084">=</span>&nbsp;<span class="num" id="5878086">1</span>&nbsp;<span class="op" id="5878088">&lt;&lt;</span>&nbsp;<span class="num" id="5878091">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878094">ifInterlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5878112">=</span>&nbsp;<span class="num" id="5878114">1</span>&nbsp;<span class="op" id="5878116">&lt;&lt;</span>&nbsp;<span class="num" id="5878119">6</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878122">ifPixelSizeMask</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5878140">=</span>&nbsp;<span class="num" id="5878142">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5878146">//&nbsp;Graphic&nbsp;control&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878173">gcTransparentColorSet</span>&nbsp;<span class="op" id="5878195">=</span>&nbsp;<span class="num" id="5878197">1</span>&nbsp;<span class="op" id="5878199">&lt;&lt;</span>&nbsp;<span class="num" id="5878202">0</span><br>
<span class="lineno"></span><span class="op" id="5878204">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5878207">//&nbsp;Section&nbsp;indicators.</span><br>
<span class="lineno"></span><span class="keyword" id="5878230">const</span>&nbsp;<span class="op" id="5878236">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878239">sExtension</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5878256">=</span>&nbsp;<span class="num" id="5878258">0x21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878264">sImageDescriptor</span>&nbsp;<span class="op" id="5878281">=</span>&nbsp;<span class="num" id="5878283">0x2C</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878289">sTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5878306">=</span>&nbsp;<span class="num" id="5878308">0x3B</span><br>
<span class="lineno"></span><span class="op" id="5878313">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5878316">//&nbsp;Extensions.</span><br>
<span class="lineno"></span><span class="keyword" id="5878331">const</span>&nbsp;<span class="op" id="5878337">(</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878340">eText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5878356">=</span>&nbsp;<span class="num" id="5878358">0x01</span>&nbsp;<span class="comment" id="5878363">//&nbsp;Plain&nbsp;Text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878378">eGraphicControl</span>&nbsp;<span class="op" id="5878394">=</span>&nbsp;<span class="num" id="5878396">0xF9</span>&nbsp;<span class="comment" id="5878401">//&nbsp;Graphic&nbsp;Control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878421">eComment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5878437">=</span>&nbsp;<span class="num" id="5878439">0xFE</span>&nbsp;<span class="comment" id="5878444">//&nbsp;Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878456">eApplication</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5878472">=</span>&nbsp;<span class="num" id="5878474">0xFF</span>&nbsp;<span class="comment" id="5878479">//&nbsp;Application</span><br>
<span class="lineno"></span><span class="op" id="5878494">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="5878497">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;type&nbsp;used&nbsp;to&nbsp;decode&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5878547">type</span>&nbsp;<span class="ident" id="5878552">decoder</span>&nbsp;<span class="keyword" id="5878560">struct</span>&nbsp;<span class="op" id="5878567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878570">r</span>&nbsp;<span class="ident" id="5878572">reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5878581">//&nbsp;From&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878598">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5878614">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878622">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5878638">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878643">height</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5878659">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878664">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5878680">byte</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878686">headerFields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5878702">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878708">backgroundIndex</span>&nbsp;<span class="builtintype" id="5878724">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878730">loopCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5878746">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878751">delayTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5878767">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5878773">//&nbsp;Unused&nbsp;from&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878797">aspect</span>&nbsp;<span class="builtintype" id="5878804">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5878811">//&nbsp;From&nbsp;image&nbsp;descriptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878838">imageFields</span>&nbsp;<span class="builtintype" id="5878850">byte</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5878857">//&nbsp;From&nbsp;graphics&nbsp;control.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878884">transparentIndex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5878904">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878910">hasTransparentIndex</span>&nbsp;<span class="builtintype" id="5878930">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5878937">//&nbsp;Computed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878951">pixelSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5878966">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5878972">globalColorMap</span>&nbsp;<span class="ident" id="5878987">color</span><span class="op" id="5878992">.</span><span class="ident" id="5878993">Palette</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5879003">//&nbsp;Used&nbsp;when&nbsp;decoding.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5879027">delay</span>&nbsp;<span class="op" id="5879033">[</span><span class="op" id="5879034">]</span><span class="builtintype" id="5879035">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5879040">image</span>&nbsp;<span class="op" id="5879046">[</span><span class="op" id="5879047">]</span><span class="op" id="5879048">*</span><span class="ident" id="5879049">image</span><span class="op" id="5879054">.</span><span class="ident" id="5879055">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5879065">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5879071">[</span><span class="num" id="5879072">1024</span><span class="op" id="5879076">]</span><span class="builtintype" id="5879077">byte</span>&nbsp;<span class="comment" id="5879082">//&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;read&nbsp;color&nbsp;map</span><br>
<span class="lineno"></span><span class="op" id="5879131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5879134">//&nbsp;blockReader&nbsp;parses&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="5879201">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5879268">//&nbsp;reader&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;decoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5879332">//&nbsp;blocking.&nbsp;&nbsp;After&nbsp;the&nbsp;LZW&nbsp;decoder&nbsp;completes,&nbsp;there&nbsp;will&nbsp;be&nbsp;a&nbsp;0-byte</span><br>
<span class="lineno"></span><span class="comment" id="5879402">//&nbsp;block&nbsp;remaining&nbsp;(0,&nbsp;()),&nbsp;which&nbsp;is&nbsp;consumed&nbsp;when&nbsp;checking&nbsp;that&nbsp;the</span><br>
<span class="lineno">100</span><span class="comment" id="5879471">//&nbsp;blockReader&nbsp;is&nbsp;exhausted.</span><br>
<span class="lineno"></span><span class="keyword" id="5879500">type</span>&nbsp;<span class="ident" id="5879505">blockReader</span>&nbsp;<span class="keyword" id="5879517">struct</span>&nbsp;<span class="op" id="5879524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5879527">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5879533">reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5879541">slice</span>&nbsp;<span class="op" id="5879547">[</span><span class="op" id="5879548">]</span><span class="builtintype" id="5879549">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5879555">err</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5879561">error</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5879568">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5879574">[</span><span class="num" id="5879575">256</span><span class="op" id="5879578">]</span><span class="builtintype" id="5879579">byte</span><br>
<span class="lineno"></span><span class="op" id="5879584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5879587">func</span>&nbsp;<span class="op" id="5879592">(</span><span class="ident" id="5879593">b</span>&nbsp;<span class="op" id="5879595">*</span><span class="ident" id="5879596">blockReader</span><span class="op" id="5879607">)</span>&nbsp;<span class="ident" id="5879609">Read</span><span class="op" id="5879613">(</span><span class="ident" id="5879614">p</span>&nbsp;<span class="op" id="5879616">[</span><span class="op" id="5879617">]</span><span class="builtintype" id="5879618">byte</span><span class="op" id="5879622">)</span>&nbsp;<span class="op" id="5879624">(</span><span class="builtintype" id="5879625">int</span><span class="op" id="5879628">,</span>&nbsp;<span class="builtintype" id="5879630">error</span><span class="op" id="5879635">)</span>&nbsp;<span class="op" id="5879637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5879640">if</span>&nbsp;<span class="ident" id="5879643">b</span><span class="op" id="5879644">.</span><span class="ident" id="5879645">err</span>&nbsp;<span class="op" id="5879649">!=</span>&nbsp;<span class="builtintype" id="5879652">nil</span>&nbsp;<span class="op" id="5879656">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5879660">return</span>&nbsp;<span class="num" id="5879667">0</span><span class="op" id="5879668">,</span>&nbsp;<span class="ident" id="5879670">b</span><span class="op" id="5879671">.</span><span class="ident" id="5879672">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5879677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5879680">if</span>&nbsp;<span class="builtinfunc" id="5879683">len</span><span class="op" id="5879686">(</span><span class="ident" id="5879687">p</span><span class="op" id="5879688">)</span>&nbsp;<span class="op" id="5879690">==</span>&nbsp;<span class="num" id="5879693">0</span>&nbsp;<span class="op" id="5879695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5879699">return</span>&nbsp;<span class="num" id="5879706">0</span><span class="op" id="5879707">,</span>&nbsp;<span class="builtintype" id="5879709">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5879714">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5879717">if</span>&nbsp;<span class="builtinfunc" id="5879720">len</span><span class="op" id="5879723">(</span><span class="ident" id="5879724">b</span><span class="op" id="5879725">.</span><span class="ident" id="5879726">slice</span><span class="op" id="5879731">)</span>&nbsp;<span class="op" id="5879733">==</span>&nbsp;<span class="num" id="5879736">0</span>&nbsp;<span class="op" id="5879738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5879742">var</span>&nbsp;<span class="ident" id="5879746">blockLen</span>&nbsp;<span class="builtintype" id="5879755">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5879763">blockLen</span><span class="op" id="5879771">,</span>&nbsp;<span class="ident" id="5879773">b</span><span class="op" id="5879774">.</span><span class="ident" id="5879775">err</span>&nbsp;<span class="op" id="5879779">=</span>&nbsp;<span class="ident" id="5879781">b</span><span class="op" id="5879782">.</span><span class="ident" id="5879783">r</span><span class="op" id="5879784">.</span><span class="ident" id="5879785">ReadByte</span><span class="op" id="5879793">(</span><span class="op" id="5879794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5879798">if</span>&nbsp;<span class="ident" id="5879801">b</span><span class="op" id="5879802">.</span><span class="ident" id="5879803">err</span>&nbsp;<span class="op" id="5879807">!=</span>&nbsp;<span class="builtintype" id="5879810">nil</span>&nbsp;<span class="op" id="5879814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5879819">return</span>&nbsp;<span class="num" id="5879826">0</span><span class="op" id="5879827">,</span>&nbsp;<span class="ident" id="5879829">b</span><span class="op" id="5879830">.</span><span class="ident" id="5879831">err</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5879837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5879841">if</span>&nbsp;<span class="ident" id="5879844">blockLen</span>&nbsp;<span class="op" id="5879853">==</span>&nbsp;<span class="num" id="5879856">0</span>&nbsp;<span class="op" id="5879858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5879863">b</span><span class="op" id="5879864">.</span><span class="ident" id="5879865">err</span>&nbsp;<span class="op" id="5879869">=</span>&nbsp;<span class="ident" id="5879871">io</span><span class="op" id="5879873">.</span><span class="ident" id="5879874">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5879881">return</span>&nbsp;<span class="num" id="5879888">0</span><span class="op" id="5879889">,</span>&nbsp;<span class="ident" id="5879891">b</span><span class="op" id="5879892">.</span><span class="ident" id="5879893">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5879899">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5879903">b</span><span class="op" id="5879904">.</span><span class="ident" id="5879905">slice</span>&nbsp;<span class="op" id="5879911">=</span>&nbsp;<span class="ident" id="5879913">b</span><span class="op" id="5879914">.</span><span class="ident" id="5879915">tmp</span><span class="op" id="5879918">[</span><span class="num" id="5879919">0</span><span class="op" id="5879920">:</span><span class="ident" id="5879921">blockLen</span><span class="op" id="5879929">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5879933">if</span>&nbsp;<span class="ident" id="5879936">_</span><span class="op" id="5879937">,</span>&nbsp;<span class="ident" id="5879939">b</span><span class="op" id="5879940">.</span><span class="ident" id="5879941">err</span>&nbsp;<span class="op" id="5879945">=</span>&nbsp;<span class="ident" id="5879947">io</span><span class="op" id="5879949">.</span><span class="ident" id="5879950">ReadFull</span><span class="op" id="5879958">(</span><span class="ident" id="5879959">b</span><span class="op" id="5879960">.</span><span class="ident" id="5879961">r</span><span class="op" id="5879962">,</span>&nbsp;<span class="ident" id="5879964">b</span><span class="op" id="5879965">.</span><span class="ident" id="5879966">slice</span><span class="op" id="5879971">)</span><span class="op" id="5879972">;</span>&nbsp;<span class="ident" id="5879974">b</span><span class="op" id="5879975">.</span><span class="ident" id="5879976">err</span>&nbsp;<span class="op" id="5879980">!=</span>&nbsp;<span class="builtintype" id="5879983">nil</span>&nbsp;<span class="op" id="5879987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5879992">return</span>&nbsp;<span class="num" id="5879999">0</span><span class="op" id="5880000">,</span>&nbsp;<span class="ident" id="5880002">b</span><span class="op" id="5880003">.</span><span class="ident" id="5880004">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5880010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5880013">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5880016">n</span>&nbsp;<span class="op" id="5880018">:=</span>&nbsp;<span class="builtinfunc" id="5880021">copy</span><span class="op" id="5880025">(</span><span class="ident" id="5880026">p</span><span class="op" id="5880027">,</span>&nbsp;<span class="ident" id="5880029">b</span><span class="op" id="5880030">.</span><span class="ident" id="5880031">slice</span><span class="op" id="5880036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5880039">b</span><span class="op" id="5880040">.</span><span class="ident" id="5880041">slice</span>&nbsp;<span class="op" id="5880047">=</span>&nbsp;<span class="ident" id="5880049">b</span><span class="op" id="5880050">.</span><span class="ident" id="5880051">slice</span><span class="op" id="5880056">[</span><span class="ident" id="5880057">n</span><span class="op" id="5880058">:</span><span class="op" id="5880059">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880062">return</span>&nbsp;<span class="ident" id="5880069">n</span><span class="op" id="5880070">,</span>&nbsp;<span class="builtintype" id="5880072">nil</span><br>
<span class="lineno"></span><span class="op" id="5880076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="5880079">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;stores&nbsp;the&nbsp;result&nbsp;in&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="5880142">func</span>&nbsp;<span class="op" id="5880147">(</span><span class="ident" id="5880148">d</span>&nbsp;<span class="op" id="5880150">*</span><span class="ident" id="5880151">decoder</span><span class="op" id="5880158">)</span>&nbsp;<span class="ident" id="5880160">decode</span><span class="op" id="5880166">(</span><span class="ident" id="5880167">r</span>&nbsp;<span class="ident" id="5880169">io</span><span class="op" id="5880171">.</span><span class="ident" id="5880172">Reader</span><span class="op" id="5880178">,</span>&nbsp;<span class="ident" id="5880180">configOnly</span>&nbsp;<span class="builtintype" id="5880191">bool</span><span class="op" id="5880195">)</span>&nbsp;<span class="builtintype" id="5880197">error</span>&nbsp;<span class="op" id="5880203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5880206">//&nbsp;Add&nbsp;buffering&nbsp;if&nbsp;r&nbsp;does&nbsp;not&nbsp;provide&nbsp;ReadByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880256">if</span>&nbsp;<span class="ident" id="5880259">rr</span><span class="op" id="5880261">,</span>&nbsp;<span class="ident" id="5880263">ok</span>&nbsp;<span class="op" id="5880266">:=</span>&nbsp;<span class="ident" id="5880269">r</span><span class="op" id="5880270">.</span><span class="op" id="5880271">(</span><span class="ident" id="5880272">reader</span><span class="op" id="5880278">)</span><span class="op" id="5880279">;</span>&nbsp;<span class="ident" id="5880281">ok</span>&nbsp;<span class="op" id="5880284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5880288">d</span><span class="op" id="5880289">.</span><span class="ident" id="5880290">r</span>&nbsp;<span class="op" id="5880292">=</span>&nbsp;<span class="ident" id="5880294">rr</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5880298">}</span>&nbsp;<span class="keyword" id="5880300">else</span>&nbsp;<span class="op" id="5880305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5880309">d</span><span class="op" id="5880310">.</span><span class="ident" id="5880311">r</span>&nbsp;<span class="op" id="5880313">=</span>&nbsp;<span class="ident" id="5880315">bufio</span><span class="op" id="5880320">.</span><span class="ident" id="5880321">NewReader</span><span class="op" id="5880330">(</span><span class="ident" id="5880331">r</span><span class="op" id="5880332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5880335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5880339">err</span>&nbsp;<span class="op" id="5880343">:=</span>&nbsp;<span class="ident" id="5880346">d</span><span class="op" id="5880347">.</span><span class="ident" id="5880348">readHeaderAndScreenDescriptor</span><span class="op" id="5880377">(</span><span class="op" id="5880378">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880381">if</span>&nbsp;<span class="ident" id="5880384">err</span>&nbsp;<span class="op" id="5880388">!=</span>&nbsp;<span class="builtintype" id="5880391">nil</span>&nbsp;<span class="op" id="5880395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880399">return</span>&nbsp;<span class="ident" id="5880406">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5880411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880414">if</span>&nbsp;<span class="ident" id="5880417">configOnly</span>&nbsp;<span class="op" id="5880428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880432">return</span>&nbsp;<span class="builtintype" id="5880439">nil</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5880444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880448">if</span>&nbsp;<span class="ident" id="5880451">d</span><span class="op" id="5880452">.</span><span class="ident" id="5880453">headerFields</span><span class="op" id="5880465">&amp;</span><span class="ident" id="5880466">fColorMapFollows</span>&nbsp;<span class="op" id="5880483">!=</span>&nbsp;<span class="num" id="5880486">0</span>&nbsp;<span class="op" id="5880488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880492">if</span>&nbsp;<span class="ident" id="5880495">d</span><span class="op" id="5880496">.</span><span class="ident" id="5880497">globalColorMap</span><span class="op" id="5880511">,</span>&nbsp;<span class="ident" id="5880513">err</span>&nbsp;<span class="op" id="5880517">=</span>&nbsp;<span class="ident" id="5880519">d</span><span class="op" id="5880520">.</span><span class="ident" id="5880521">readColorMap</span><span class="op" id="5880533">(</span><span class="op" id="5880534">)</span><span class="op" id="5880535">;</span>&nbsp;<span class="ident" id="5880537">err</span>&nbsp;<span class="op" id="5880541">!=</span>&nbsp;<span class="builtintype" id="5880544">nil</span>&nbsp;<span class="op" id="5880548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880553">return</span>&nbsp;<span class="ident" id="5880560">err</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5880566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5880569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880573">for</span>&nbsp;<span class="op" id="5880577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5880581">c</span><span class="op" id="5880582">,</span>&nbsp;<span class="ident" id="5880584">err</span>&nbsp;<span class="op" id="5880588">:=</span>&nbsp;<span class="ident" id="5880591">d</span><span class="op" id="5880592">.</span><span class="ident" id="5880593">r</span><span class="op" id="5880594">.</span><span class="ident" id="5880595">ReadByte</span><span class="op" id="5880603">(</span><span class="op" id="5880604">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880608">if</span>&nbsp;<span class="ident" id="5880611">err</span>&nbsp;<span class="op" id="5880615">!=</span>&nbsp;<span class="builtintype" id="5880618">nil</span>&nbsp;<span class="op" id="5880622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880627">return</span>&nbsp;<span class="ident" id="5880634">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5880640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880644">switch</span>&nbsp;<span class="ident" id="5880651">c</span>&nbsp;<span class="op" id="5880653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880657">case</span>&nbsp;<span class="ident" id="5880662">sExtension</span><span class="op" id="5880672">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880677">if</span>&nbsp;<span class="ident" id="5880680">err</span>&nbsp;<span class="op" id="5880684">=</span>&nbsp;<span class="ident" id="5880686">d</span><span class="op" id="5880687">.</span><span class="ident" id="5880688">readExtension</span><span class="op" id="5880701">(</span><span class="op" id="5880702">)</span><span class="op" id="5880703">;</span>&nbsp;<span class="ident" id="5880705">err</span>&nbsp;<span class="op" id="5880709">!=</span>&nbsp;<span class="builtintype" id="5880712">nil</span>&nbsp;<span class="op" id="5880716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880722">return</span>&nbsp;<span class="ident" id="5880729">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5880736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880741">case</span>&nbsp;<span class="ident" id="5880746">sImageDescriptor</span><span class="op" id="5880762">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5880767">m</span><span class="op" id="5880768">,</span>&nbsp;<span class="ident" id="5880770">err</span>&nbsp;<span class="op" id="5880774">:=</span>&nbsp;<span class="ident" id="5880777">d</span><span class="op" id="5880778">.</span><span class="ident" id="5880779">newImageFromDescriptor</span><span class="op" id="5880801">(</span><span class="op" id="5880802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880807">if</span>&nbsp;<span class="ident" id="5880810">err</span>&nbsp;<span class="op" id="5880814">!=</span>&nbsp;<span class="builtintype" id="5880817">nil</span>&nbsp;<span class="op" id="5880821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880827">return</span>&nbsp;<span class="ident" id="5880834">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5880841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5880846">useLocalColorMap</span>&nbsp;<span class="op" id="5880863">:=</span>&nbsp;<span class="ident" id="5880866">d</span><span class="op" id="5880867">.</span><span class="ident" id="5880868">imageFields</span><span class="op" id="5880879">&amp;</span><span class="ident" id="5880880">fColorMapFollows</span>&nbsp;<span class="op" id="5880897">!=</span>&nbsp;<span class="num" id="5880900">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880905">if</span>&nbsp;<span class="ident" id="5880908">useLocalColorMap</span>&nbsp;<span class="op" id="5880925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5880931">m</span><span class="op" id="5880932">.</span><span class="ident" id="5880933">Palette</span><span class="op" id="5880940">,</span>&nbsp;<span class="ident" id="5880942">err</span>&nbsp;<span class="op" id="5880946">=</span>&nbsp;<span class="ident" id="5880948">d</span><span class="op" id="5880949">.</span><span class="ident" id="5880950">readColorMap</span><span class="op" id="5880962">(</span><span class="op" id="5880963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880969">if</span>&nbsp;<span class="ident" id="5880972">err</span>&nbsp;<span class="op" id="5880976">!=</span>&nbsp;<span class="builtintype" id="5880979">nil</span>&nbsp;<span class="op" id="5880983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5880990">return</span>&nbsp;<span class="ident" id="5880997">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5881005">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5881010">}</span>&nbsp;<span class="keyword" id="5881012">else</span>&nbsp;<span class="op" id="5881017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5881023">m</span><span class="op" id="5881024">.</span><span class="ident" id="5881025">Palette</span>&nbsp;<span class="op" id="5881033">=</span>&nbsp;<span class="ident" id="5881035">d</span><span class="op" id="5881036">.</span><span class="ident" id="5881037">globalColorMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5881055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5881060">if</span>&nbsp;<span class="ident" id="5881063">d</span><span class="op" id="5881064">.</span><span class="ident" id="5881065">hasTransparentIndex</span>&nbsp;<span class="op" id="5881085">&amp;&amp;</span>&nbsp;<span class="builtintype" id="5881088">int</span><span class="op" id="5881091">(</span><span class="ident" id="5881092">d</span><span class="op" id="5881093">.</span><span class="ident" id="5881094">transparentIndex</span><span class="op" id="5881110">)</span>&nbsp;<span class="op" id="5881112">&lt;</span>&nbsp;<span class="builtinfunc" id="5881114">len</span><span class="op" id="5881117">(</span><span class="ident" id="5881118">m</span><span class="op" id="5881119">.</span><span class="ident" id="5881120">Palette</span><span class="op" id="5881127">)</span>&nbsp;<span class="op" id="5881129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5881135">if</span>&nbsp;<span class="op" id="5881138">!</span><span class="ident" id="5881139">useLocalColorMap</span>&nbsp;<span class="op" id="5881156">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5881163">//&nbsp;Clone&nbsp;the&nbsp;global&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5881199">m</span><span class="op" id="5881200">.</span><span class="ident" id="5881201">Palette</span>&nbsp;<span class="op" id="5881209">=</span>&nbsp;<span class="builtinfunc" id="5881211">append</span><span class="op" id="5881217">(</span><span class="ident" id="5881218">color</span><span class="op" id="5881223">.</span><span class="ident" id="5881224">Palette</span><span class="op" id="5881231">(</span><span class="builtintype" id="5881232">nil</span><span class="op" id="5881235">)</span><span class="op" id="5881236">,</span>&nbsp;<span class="ident" id="5881238">d</span><span class="op" id="5881239">.</span><span class="ident" id="5881240">globalColorMap</span><span class="op" id="5881254">...</span><span class="op" id="5881257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5881263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5881269">m</span><span class="op" id="5881270">.</span><span class="ident" id="5881271">Palette</span><span class="op" id="5881278">[</span><span class="ident" id="5881279">d</span><span class="op" id="5881280">.</span><span class="ident" id="5881281">transparentIndex</span><span class="op" id="5881297">]</span>&nbsp;<span class="op" id="5881299">=</span>&nbsp;<span class="ident" id="5881301">color</span><span class="op" id="5881306">.</span><span class="ident" id="5881307">RGBA</span><span class="op" id="5881311">{</span><span class="op" id="5881312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5881317">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5881322">litWidth</span><span class="op" id="5881330">,</span>&nbsp;<span class="ident" id="5881332">err</span>&nbsp;<span class="op" id="5881336">:=</span>&nbsp;<span class="ident" id="5881339">d</span><span class="op" id="5881340">.</span><span class="ident" id="5881341">r</span><span class="op" id="5881342">.</span><span class="ident" id="5881343">ReadByte</span><span class="op" id="5881351">(</span><span class="op" id="5881352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5881357">if</span>&nbsp;<span class="ident" id="5881360">err</span>&nbsp;<span class="op" id="5881364">!=</span>&nbsp;<span class="builtintype" id="5881367">nil</span>&nbsp;<span class="op" id="5881371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5881377">return</span>&nbsp;<span class="ident" id="5881384">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5881391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5881396">if</span>&nbsp;<span class="ident" id="5881399">litWidth</span>&nbsp;<span class="op" id="5881408">&lt;</span>&nbsp;<span class="num" id="5881410">2</span>&nbsp;<span class="op" id="5881412">||</span>&nbsp;<span class="ident" id="5881415">litWidth</span>&nbsp;<span class="op" id="5881424">&gt;</span>&nbsp;<span class="num" id="5881426">8</span>&nbsp;<span class="op" id="5881428">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5881434">return</span>&nbsp;<span class="ident" id="5881441">fmt</span><span class="op" id="5881444">.</span><span class="ident" id="5881445">Errorf</span><span class="op" id="5881451">(</span><span class="string" id="5881452">&#34;gif:&nbsp;pixel&nbsp;size&nbsp;in&nbsp;decode&nbsp;out&nbsp;of&nbsp;range:&nbsp;%d&#34;</span><span class="op" id="5881496">,</span>&nbsp;<span class="ident" id="5881498">litWidth</span><span class="op" id="5881506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5881511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5881516">//&nbsp;A&nbsp;wonderfully&nbsp;Go-like&nbsp;piece&nbsp;of&nbsp;magic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5881560">br</span>&nbsp;<span class="op" id="5881563">:=</span>&nbsp;<span class="op" id="5881566">&amp;</span><span class="ident" id="5881567">blockReader</span><span class="op" id="5881578">{</span><span class="ident" id="5881579">r</span><span class="op" id="5881580">:</span>&nbsp;<span class="ident" id="5881582">d</span><span class="op" id="5881583">.</span><span class="ident" id="5881584">r</span><span class="op" id="5881585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5881590">lzwr</span>&nbsp;<span class="op" id="5881595">:=</span>&nbsp;<span class="ident" id="5881598">lzw</span><span class="op" id="5881601">.</span><span class="ident" id="5881602">NewReader</span><span class="op" id="5881611">(</span><span class="ident" id="5881612">br</span><span class="op" id="5881614">,</span>&nbsp;<span class="ident" id="5881616">lzw</span><span class="op" id="5881619">.</span><span class="ident" id="5881620">LSB</span><span class="op" id="5881623">,</span>&nbsp;<span class="builtintype" id="5881625">int</span><span class="op" id="5881628">(</span><span class="ident" id="5881629">litWidth</span><span class="op" id="5881637">)</span><span class="op" id="5881638">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5881643">defer</span>&nbsp;<span class="ident" id="5881649">lzwr</span><span class="op" id="5881653">.</span><span class="ident" id="5881654">Close</span><span class="op" id="5881659">(</span><span class="op" id="5881660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5881665">if</span>&nbsp;<span class="ident" id="5881668">_</span><span class="op" id="5881669">,</span>&nbsp;<span class="ident" id="5881671">err</span>&nbsp;<span class="op" id="5881675">=</span>&nbsp;<span class="ident" id="5881677">io</span><span class="op" id="5881679">.</span><span class="ident" id="5881680">ReadFull</span><span class="op" id="5881688">(</span><span class="ident" id="5881689">lzwr</span><span class="op" id="5881693">,</span>&nbsp;<span class="ident" id="5881695">m</span><span class="op" id="5881696">.</span><span class="ident" id="5881697">Pix</span><span class="op" id="5881700">)</span><span class="op" id="5881701">;</span>&nbsp;<span class="ident" id="5881703">err</span>&nbsp;<span class="op" id="5881707">!=</span>&nbsp;<span class="builtintype" id="5881710">nil</span>&nbsp;<span class="op" id="5881714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5881720">if</span>&nbsp;<span class="ident" id="5881723">err</span>&nbsp;<span class="op" id="5881727">!=</span>&nbsp;<span class="ident" id="5881730">io</span><span class="op" id="5881732">.</span><span class="ident" id="5881733">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="5881750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5881757">return</span>&nbsp;<span class="ident" id="5881764">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5881772">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5881778">return</span>&nbsp;<span class="ident" id="5881785">errNotEnough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5881801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5881806">//&nbsp;Both&nbsp;lzwr&nbsp;and&nbsp;br&nbsp;should&nbsp;be&nbsp;exhausted.&nbsp;Reading&nbsp;from&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5881868">//&nbsp;should&nbsp;yield&nbsp;(0,&nbsp;io.EOF).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5881900">if</span>&nbsp;<span class="ident" id="5881903">n</span><span class="op" id="5881904">,</span>&nbsp;<span class="ident" id="5881906">err</span>&nbsp;<span class="op" id="5881910">:=</span>&nbsp;<span class="ident" id="5881913">lzwr</span><span class="op" id="5881917">.</span><span class="ident" id="5881918">Read</span><span class="op" id="5881922">(</span><span class="ident" id="5881923">d</span><span class="op" id="5881924">.</span><span class="ident" id="5881925">tmp</span><span class="op" id="5881928">[</span><span class="op" id="5881929">:</span><span class="num" id="5881930">1</span><span class="op" id="5881931">]</span><span class="op" id="5881932">)</span><span class="op" id="5881933">;</span>&nbsp;<span class="ident" id="5881935">n</span>&nbsp;<span class="op" id="5881937">!=</span>&nbsp;<span class="num" id="5881940">0</span>&nbsp;<span class="op" id="5881942">||</span>&nbsp;<span class="ident" id="5881945">err</span>&nbsp;<span class="op" id="5881949">!=</span>&nbsp;<span class="ident" id="5881952">io</span><span class="op" id="5881954">.</span><span class="ident" id="5881955">EOF</span>&nbsp;<span class="op" id="5881959">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5881965">if</span>&nbsp;<span class="ident" id="5881968">err</span>&nbsp;<span class="op" id="5881972">!=</span>&nbsp;<span class="builtintype" id="5881975">nil</span>&nbsp;<span class="op" id="5881979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5881986">return</span>&nbsp;<span class="ident" id="5881993">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5882001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5882007">return</span>&nbsp;<span class="ident" id="5882014">errTooMuch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5882028">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5882033">if</span>&nbsp;<span class="ident" id="5882036">n</span><span class="op" id="5882037">,</span>&nbsp;<span class="ident" id="5882039">err</span>&nbsp;<span class="op" id="5882043">:=</span>&nbsp;<span class="ident" id="5882046">br</span><span class="op" id="5882048">.</span><span class="ident" id="5882049">Read</span><span class="op" id="5882053">(</span><span class="ident" id="5882054">d</span><span class="op" id="5882055">.</span><span class="ident" id="5882056">tmp</span><span class="op" id="5882059">[</span><span class="op" id="5882060">:</span><span class="num" id="5882061">1</span><span class="op" id="5882062">]</span><span class="op" id="5882063">)</span><span class="op" id="5882064">;</span>&nbsp;<span class="ident" id="5882066">n</span>&nbsp;<span class="op" id="5882068">!=</span>&nbsp;<span class="num" id="5882071">0</span>&nbsp;<span class="op" id="5882073">||</span>&nbsp;<span class="ident" id="5882076">err</span>&nbsp;<span class="op" id="5882080">!=</span>&nbsp;<span class="ident" id="5882083">io</span><span class="op" id="5882085">.</span><span class="ident" id="5882086">EOF</span>&nbsp;<span class="op" id="5882090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5882096">if</span>&nbsp;<span class="ident" id="5882099">err</span>&nbsp;<span class="op" id="5882103">!=</span>&nbsp;<span class="builtintype" id="5882106">nil</span>&nbsp;<span class="op" id="5882110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5882117">return</span>&nbsp;<span class="ident" id="5882124">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5882132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5882138">return</span>&nbsp;<span class="ident" id="5882145">errTooMuch</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5882159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5882165">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;color&nbsp;indexes&nbsp;are&nbsp;inside&nbsp;the&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5882224">if</span>&nbsp;<span class="builtinfunc" id="5882227">len</span><span class="op" id="5882230">(</span><span class="ident" id="5882231">m</span><span class="op" id="5882232">.</span><span class="ident" id="5882233">Palette</span><span class="op" id="5882240">)</span>&nbsp;<span class="op" id="5882242">&lt;</span>&nbsp;<span class="num" id="5882244">256</span>&nbsp;<span class="op" id="5882248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5882254">for</span>&nbsp;<span class="ident" id="5882258">_</span><span class="op" id="5882259">,</span>&nbsp;<span class="ident" id="5882261">pixel</span>&nbsp;<span class="op" id="5882267">:=</span>&nbsp;<span class="keyword" id="5882270">range</span>&nbsp;<span class="ident" id="5882276">m</span><span class="op" id="5882277">.</span><span class="ident" id="5882278">Pix</span>&nbsp;<span class="op" id="5882282">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5882289">if</span>&nbsp;<span class="builtintype" id="5882292">int</span><span class="op" id="5882295">(</span><span class="ident" id="5882296">pixel</span><span class="op" id="5882301">)</span>&nbsp;<span class="op" id="5882303">&gt;=</span>&nbsp;<span class="builtinfunc" id="5882306">len</span><span class="op" id="5882309">(</span><span class="ident" id="5882310">m</span><span class="op" id="5882311">.</span><span class="ident" id="5882312">Palette</span><span class="op" id="5882319">)</span>&nbsp;<span class="op" id="5882321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5882329">return</span>&nbsp;<span class="ident" id="5882336">errBadPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5882353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5882359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5882364">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5882370">//&nbsp;Undo&nbsp;the&nbsp;interlacing&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5882411">if</span>&nbsp;<span class="ident" id="5882414">d</span><span class="op" id="5882415">.</span><span class="ident" id="5882416">imageFields</span><span class="op" id="5882427">&amp;</span><span class="ident" id="5882428">ifInterlace</span>&nbsp;<span class="op" id="5882440">!=</span>&nbsp;<span class="num" id="5882443">0</span>&nbsp;<span class="op" id="5882445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5882451">uninterlace</span><span class="op" id="5882462">(</span><span class="ident" id="5882463">m</span><span class="op" id="5882464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5882469">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5882475">d</span><span class="op" id="5882476">.</span><span class="ident" id="5882477">image</span>&nbsp;<span class="op" id="5882483">=</span>&nbsp;<span class="builtinfunc" id="5882485">append</span><span class="op" id="5882491">(</span><span class="ident" id="5882492">d</span><span class="op" id="5882493">.</span><span class="ident" id="5882494">image</span><span class="op" id="5882499">,</span>&nbsp;<span class="ident" id="5882501">m</span><span class="op" id="5882502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5882507">d</span><span class="op" id="5882508">.</span><span class="ident" id="5882509">delay</span>&nbsp;<span class="op" id="5882515">=</span>&nbsp;<span class="builtinfunc" id="5882517">append</span><span class="op" id="5882523">(</span><span class="ident" id="5882524">d</span><span class="op" id="5882525">.</span><span class="ident" id="5882526">delay</span><span class="op" id="5882531">,</span>&nbsp;<span class="ident" id="5882533">d</span><span class="op" id="5882534">.</span><span class="ident" id="5882535">delayTime</span><span class="op" id="5882544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5882549">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;23&nbsp;(Graphic&nbsp;Control&nbsp;Extension)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5882617">//&nbsp;&#34;The&nbsp;scope&nbsp;of&nbsp;this&nbsp;extension&nbsp;is&nbsp;the&nbsp;first&nbsp;graphic&nbsp;rendering&nbsp;block</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5882689">//&nbsp;to&nbsp;follow.&#34;&nbsp;We&nbsp;therefore&nbsp;reset&nbsp;the&nbsp;GCE&nbsp;fields&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5882750">d</span><span class="op" id="5882751">.</span><span class="ident" id="5882752">delayTime</span>&nbsp;<span class="op" id="5882762">=</span>&nbsp;<span class="num" id="5882764">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5882769">d</span><span class="op" id="5882770">.</span><span class="ident" id="5882771">hasTransparentIndex</span>&nbsp;<span class="op" id="5882791">=</span>&nbsp;<span class="builtintype" id="5882793">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5882802">case</span>&nbsp;<span class="ident" id="5882807">sTrailer</span><span class="op" id="5882815">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5882820">if</span>&nbsp;<span class="builtinfunc" id="5882823">len</span><span class="op" id="5882826">(</span><span class="ident" id="5882827">d</span><span class="op" id="5882828">.</span><span class="ident" id="5882829">image</span><span class="op" id="5882834">)</span>&nbsp;<span class="op" id="5882836">==</span>&nbsp;<span class="num" id="5882839">0</span>&nbsp;<span class="op" id="5882841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5882847">return</span>&nbsp;<span class="ident" id="5882854">io</span><span class="op" id="5882856">.</span><span class="ident" id="5882857">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5882877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5882882">return</span>&nbsp;<span class="builtintype" id="5882889">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5882896">default</span><span class="op" id="5882903">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5882908">return</span>&nbsp;<span class="ident" id="5882915">fmt</span><span class="op" id="5882918">.</span><span class="ident" id="5882919">Errorf</span><span class="op" id="5882925">(</span><span class="string" id="5882926">&#34;gif:&nbsp;unknown&nbsp;block&nbsp;type:&nbsp;0x%.2x&#34;</span><span class="op" id="5882959">,</span>&nbsp;<span class="ident" id="5882961">c</span><span class="op" id="5882962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5882966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5882969">}</span><br>
<span class="lineno"></span><span class="op" id="5882971">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="5882974">func</span>&nbsp;<span class="op" id="5882979">(</span><span class="ident" id="5882980">d</span>&nbsp;<span class="op" id="5882982">*</span><span class="ident" id="5882983">decoder</span><span class="op" id="5882990">)</span>&nbsp;<span class="ident" id="5882992">readHeaderAndScreenDescriptor</span><span class="op" id="5883021">(</span><span class="op" id="5883022">)</span>&nbsp;<span class="builtintype" id="5883024">error</span>&nbsp;<span class="op" id="5883030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5883033">_</span><span class="op" id="5883034">,</span>&nbsp;<span class="ident" id="5883036">err</span>&nbsp;<span class="op" id="5883040">:=</span>&nbsp;<span class="ident" id="5883043">io</span><span class="op" id="5883045">.</span><span class="ident" id="5883046">ReadFull</span><span class="op" id="5883054">(</span><span class="ident" id="5883055">d</span><span class="op" id="5883056">.</span><span class="ident" id="5883057">r</span><span class="op" id="5883058">,</span>&nbsp;<span class="ident" id="5883060">d</span><span class="op" id="5883061">.</span><span class="ident" id="5883062">tmp</span><span class="op" id="5883065">[</span><span class="num" id="5883066">0</span><span class="op" id="5883067">:</span><span class="num" id="5883068">13</span><span class="op" id="5883070">]</span><span class="op" id="5883071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5883074">if</span>&nbsp;<span class="ident" id="5883077">err</span>&nbsp;<span class="op" id="5883081">!=</span>&nbsp;<span class="builtintype" id="5883084">nil</span>&nbsp;<span class="op" id="5883088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5883092">return</span>&nbsp;<span class="ident" id="5883099">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5883104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5883107">d</span><span class="op" id="5883108">.</span><span class="ident" id="5883109">vers</span>&nbsp;<span class="op" id="5883114">=</span>&nbsp;<span class="builtintype" id="5883116">string</span><span class="op" id="5883122">(</span><span class="ident" id="5883123">d</span><span class="op" id="5883124">.</span><span class="ident" id="5883125">tmp</span><span class="op" id="5883128">[</span><span class="num" id="5883129">0</span><span class="op" id="5883130">:</span><span class="num" id="5883131">6</span><span class="op" id="5883132">]</span><span class="op" id="5883133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5883136">if</span>&nbsp;<span class="ident" id="5883139">d</span><span class="op" id="5883140">.</span><span class="ident" id="5883141">vers</span>&nbsp;<span class="op" id="5883146">!=</span>&nbsp;<span class="string" id="5883149">&#34;GIF87a&#34;</span>&nbsp;<span class="op" id="5883158">&amp;&amp;</span>&nbsp;<span class="ident" id="5883161">d</span><span class="op" id="5883162">.</span><span class="ident" id="5883163">vers</span>&nbsp;<span class="op" id="5883168">!=</span>&nbsp;<span class="string" id="5883171">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="5883180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5883184">return</span>&nbsp;<span class="ident" id="5883191">fmt</span><span class="op" id="5883194">.</span><span class="ident" id="5883195">Errorf</span><span class="op" id="5883201">(</span><span class="string" id="5883202">&#34;gif:&nbsp;can&#39;t&nbsp;recognize&nbsp;format&nbsp;%s&#34;</span><span class="op" id="5883234">,</span>&nbsp;<span class="ident" id="5883236">d</span><span class="op" id="5883237">.</span><span class="ident" id="5883238">vers</span><span class="op" id="5883242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5883245">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5883248">d</span><span class="op" id="5883249">.</span><span class="ident" id="5883250">width</span>&nbsp;<span class="op" id="5883256">=</span>&nbsp;<span class="builtintype" id="5883258">int</span><span class="op" id="5883261">(</span><span class="ident" id="5883262">d</span><span class="op" id="5883263">.</span><span class="ident" id="5883264">tmp</span><span class="op" id="5883267">[</span><span class="num" id="5883268">6</span><span class="op" id="5883269">]</span><span class="op" id="5883270">)</span>&nbsp;<span class="op" id="5883272">+</span>&nbsp;<span class="builtintype" id="5883274">int</span><span class="op" id="5883277">(</span><span class="ident" id="5883278">d</span><span class="op" id="5883279">.</span><span class="ident" id="5883280">tmp</span><span class="op" id="5883283">[</span><span class="num" id="5883284">7</span><span class="op" id="5883285">]</span><span class="op" id="5883286">)</span><span class="op" id="5883287">&lt;&lt;</span><span class="num" id="5883289">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5883292">d</span><span class="op" id="5883293">.</span><span class="ident" id="5883294">height</span>&nbsp;<span class="op" id="5883301">=</span>&nbsp;<span class="builtintype" id="5883303">int</span><span class="op" id="5883306">(</span><span class="ident" id="5883307">d</span><span class="op" id="5883308">.</span><span class="ident" id="5883309">tmp</span><span class="op" id="5883312">[</span><span class="num" id="5883313">8</span><span class="op" id="5883314">]</span><span class="op" id="5883315">)</span>&nbsp;<span class="op" id="5883317">+</span>&nbsp;<span class="builtintype" id="5883319">int</span><span class="op" id="5883322">(</span><span class="ident" id="5883323">d</span><span class="op" id="5883324">.</span><span class="ident" id="5883325">tmp</span><span class="op" id="5883328">[</span><span class="num" id="5883329">9</span><span class="op" id="5883330">]</span><span class="op" id="5883331">)</span><span class="op" id="5883332">&lt;&lt;</span><span class="num" id="5883334">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5883337">d</span><span class="op" id="5883338">.</span><span class="ident" id="5883339">headerFields</span>&nbsp;<span class="op" id="5883352">=</span>&nbsp;<span class="ident" id="5883354">d</span><span class="op" id="5883355">.</span><span class="ident" id="5883356">tmp</span><span class="op" id="5883359">[</span><span class="num" id="5883360">10</span><span class="op" id="5883362">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5883365">d</span><span class="op" id="5883366">.</span><span class="ident" id="5883367">backgroundIndex</span>&nbsp;<span class="op" id="5883383">=</span>&nbsp;<span class="ident" id="5883385">d</span><span class="op" id="5883386">.</span><span class="ident" id="5883387">tmp</span><span class="op" id="5883390">[</span><span class="num" id="5883391">11</span><span class="op" id="5883393">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5883396">d</span><span class="op" id="5883397">.</span><span class="ident" id="5883398">aspect</span>&nbsp;<span class="op" id="5883405">=</span>&nbsp;<span class="ident" id="5883407">d</span><span class="op" id="5883408">.</span><span class="ident" id="5883409">tmp</span><span class="op" id="5883412">[</span><span class="num" id="5883413">12</span><span class="op" id="5883415">]</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5883418">d</span><span class="op" id="5883419">.</span><span class="ident" id="5883420">loopCount</span>&nbsp;<span class="op" id="5883430">=</span>&nbsp;<span class="op" id="5883432">-</span><span class="num" id="5883433">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5883436">d</span><span class="op" id="5883437">.</span><span class="ident" id="5883438">pixelSize</span>&nbsp;<span class="op" id="5883448">=</span>&nbsp;<span class="builtintype" id="5883450">uint</span><span class="op" id="5883454">(</span><span class="ident" id="5883455">d</span><span class="op" id="5883456">.</span><span class="ident" id="5883457">headerFields</span><span class="op" id="5883469">&amp;</span><span class="num" id="5883470">7</span><span class="op" id="5883471">)</span>&nbsp;<span class="op" id="5883473">+</span>&nbsp;<span class="num" id="5883475">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5883478">return</span>&nbsp;<span class="builtintype" id="5883485">nil</span><br>
<span class="lineno"></span><span class="op" id="5883489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="5883492">func</span>&nbsp;<span class="op" id="5883497">(</span><span class="ident" id="5883498">d</span>&nbsp;<span class="op" id="5883500">*</span><span class="ident" id="5883501">decoder</span><span class="op" id="5883508">)</span>&nbsp;<span class="ident" id="5883510">readColorMap</span><span class="op" id="5883522">(</span><span class="op" id="5883523">)</span>&nbsp;<span class="op" id="5883525">(</span><span class="ident" id="5883526">color</span><span class="op" id="5883531">.</span><span class="ident" id="5883532">Palette</span><span class="op" id="5883539">,</span>&nbsp;<span class="builtintype" id="5883541">error</span><span class="op" id="5883546">)</span>&nbsp;<span class="op" id="5883548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5883551">if</span>&nbsp;<span class="ident" id="5883554">d</span><span class="op" id="5883555">.</span><span class="ident" id="5883556">pixelSize</span>&nbsp;<span class="op" id="5883566">&gt;</span>&nbsp;<span class="num" id="5883568">8</span>&nbsp;<span class="op" id="5883570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5883574">return</span>&nbsp;<span class="builtintype" id="5883581">nil</span><span class="op" id="5883584">,</span>&nbsp;<span class="ident" id="5883586">fmt</span><span class="op" id="5883589">.</span><span class="ident" id="5883590">Errorf</span><span class="op" id="5883596">(</span><span class="string" id="5883597">&#34;gif:&nbsp;can&#39;t&nbsp;handle&nbsp;%d&nbsp;bits&nbsp;per&nbsp;pixel&#34;</span><span class="op" id="5883634">,</span>&nbsp;<span class="ident" id="5883636">d</span><span class="op" id="5883637">.</span><span class="ident" id="5883638">pixelSize</span><span class="op" id="5883647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5883650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5883653">numColors</span>&nbsp;<span class="op" id="5883663">:=</span>&nbsp;<span class="num" id="5883666">1</span>&nbsp;<span class="op" id="5883668">&lt;&lt;</span>&nbsp;<span class="ident" id="5883671">d</span><span class="op" id="5883672">.</span><span class="ident" id="5883673">pixelSize</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5883684">if</span>&nbsp;<span class="ident" id="5883687">d</span><span class="op" id="5883688">.</span><span class="ident" id="5883689">imageFields</span><span class="op" id="5883700">&amp;</span><span class="ident" id="5883701">ifLocalColorTable</span>&nbsp;<span class="op" id="5883719">!=</span>&nbsp;<span class="num" id="5883722">0</span>&nbsp;<span class="op" id="5883724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5883728">numColors</span>&nbsp;<span class="op" id="5883738">=</span>&nbsp;<span class="num" id="5883740">1</span>&nbsp;<span class="op" id="5883742">&lt;&lt;</span>&nbsp;<span class="op" id="5883745">(</span><span class="op" id="5883746">(</span><span class="ident" id="5883747">d</span><span class="op" id="5883748">.</span><span class="ident" id="5883749">imageFields</span>&nbsp;<span class="op" id="5883761">&amp;</span>&nbsp;<span class="ident" id="5883763">ifPixelSizeMask</span><span class="op" id="5883778">)</span>&nbsp;<span class="op" id="5883780">+</span>&nbsp;<span class="num" id="5883782">1</span><span class="op" id="5883783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5883786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5883789">numValues</span>&nbsp;<span class="op" id="5883799">:=</span>&nbsp;<span class="num" id="5883802">3</span>&nbsp;<span class="op" id="5883804">*</span>&nbsp;<span class="ident" id="5883806">numColors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5883817">_</span><span class="op" id="5883818">,</span>&nbsp;<span class="ident" id="5883820">err</span>&nbsp;<span class="op" id="5883824">:=</span>&nbsp;<span class="ident" id="5883827">io</span><span class="op" id="5883829">.</span><span class="ident" id="5883830">ReadFull</span><span class="op" id="5883838">(</span><span class="ident" id="5883839">d</span><span class="op" id="5883840">.</span><span class="ident" id="5883841">r</span><span class="op" id="5883842">,</span>&nbsp;<span class="ident" id="5883844">d</span><span class="op" id="5883845">.</span><span class="ident" id="5883846">tmp</span><span class="op" id="5883849">[</span><span class="num" id="5883850">0</span><span class="op" id="5883851">:</span><span class="ident" id="5883852">numValues</span><span class="op" id="5883861">]</span><span class="op" id="5883862">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5883865">if</span>&nbsp;<span class="ident" id="5883868">err</span>&nbsp;<span class="op" id="5883872">!=</span>&nbsp;<span class="builtintype" id="5883875">nil</span>&nbsp;<span class="op" id="5883879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5883883">return</span>&nbsp;<span class="builtintype" id="5883890">nil</span><span class="op" id="5883893">,</span>&nbsp;<span class="ident" id="5883895">fmt</span><span class="op" id="5883898">.</span><span class="ident" id="5883899">Errorf</span><span class="op" id="5883905">(</span><span class="string" id="5883906">&#34;gif:&nbsp;short&nbsp;read&nbsp;on&nbsp;color&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="5883940">,</span>&nbsp;<span class="ident" id="5883942">err</span><span class="op" id="5883945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5883948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5883951">colorMap</span>&nbsp;<span class="op" id="5883960">:=</span>&nbsp;<span class="builtinfunc" id="5883963">make</span><span class="op" id="5883967">(</span><span class="ident" id="5883968">color</span><span class="op" id="5883973">.</span><span class="ident" id="5883974">Palette</span><span class="op" id="5883981">,</span>&nbsp;<span class="ident" id="5883983">numColors</span><span class="op" id="5883992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5883995">j</span>&nbsp;<span class="op" id="5883997">:=</span>&nbsp;<span class="num" id="5884000">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884003">for</span>&nbsp;<span class="ident" id="5884007">i</span>&nbsp;<span class="op" id="5884009">:=</span>&nbsp;<span class="keyword" id="5884012">range</span>&nbsp;<span class="ident" id="5884018">colorMap</span>&nbsp;<span class="op" id="5884027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5884031">colorMap</span><span class="op" id="5884039">[</span><span class="ident" id="5884040">i</span><span class="op" id="5884041">]</span>&nbsp;<span class="op" id="5884043">=</span>&nbsp;<span class="ident" id="5884045">color</span><span class="op" id="5884050">.</span><span class="ident" id="5884051">RGBA</span><span class="op" id="5884055">{</span><span class="ident" id="5884056">d</span><span class="op" id="5884057">.</span><span class="ident" id="5884058">tmp</span><span class="op" id="5884061">[</span><span class="ident" id="5884062">j</span><span class="op" id="5884063">+</span><span class="num" id="5884064">0</span><span class="op" id="5884065">]</span><span class="op" id="5884066">,</span>&nbsp;<span class="ident" id="5884068">d</span><span class="op" id="5884069">.</span><span class="ident" id="5884070">tmp</span><span class="op" id="5884073">[</span><span class="ident" id="5884074">j</span><span class="op" id="5884075">+</span><span class="num" id="5884076">1</span><span class="op" id="5884077">]</span><span class="op" id="5884078">,</span>&nbsp;<span class="ident" id="5884080">d</span><span class="op" id="5884081">.</span><span class="ident" id="5884082">tmp</span><span class="op" id="5884085">[</span><span class="ident" id="5884086">j</span><span class="op" id="5884087">+</span><span class="num" id="5884088">2</span><span class="op" id="5884089">]</span><span class="op" id="5884090">,</span>&nbsp;<span class="num" id="5884092">0xFF</span><span class="op" id="5884096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5884100">j</span>&nbsp;<span class="op" id="5884102">+=</span>&nbsp;<span class="num" id="5884105">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5884108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884111">return</span>&nbsp;<span class="ident" id="5884118">colorMap</span><span class="op" id="5884126">,</span>&nbsp;<span class="builtintype" id="5884128">nil</span><br>
<span class="lineno">295</span><span class="op" id="5884132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5884135">func</span>&nbsp;<span class="op" id="5884140">(</span><span class="ident" id="5884141">d</span>&nbsp;<span class="op" id="5884143">*</span><span class="ident" id="5884144">decoder</span><span class="op" id="5884151">)</span>&nbsp;<span class="ident" id="5884153">readExtension</span><span class="op" id="5884166">(</span><span class="op" id="5884167">)</span>&nbsp;<span class="builtintype" id="5884169">error</span>&nbsp;<span class="op" id="5884175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5884178">extension</span><span class="op" id="5884187">,</span>&nbsp;<span class="ident" id="5884189">err</span>&nbsp;<span class="op" id="5884193">:=</span>&nbsp;<span class="ident" id="5884196">d</span><span class="op" id="5884197">.</span><span class="ident" id="5884198">r</span><span class="op" id="5884199">.</span><span class="ident" id="5884200">ReadByte</span><span class="op" id="5884208">(</span><span class="op" id="5884209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884212">if</span>&nbsp;<span class="ident" id="5884215">err</span>&nbsp;<span class="op" id="5884219">!=</span>&nbsp;<span class="builtintype" id="5884222">nil</span>&nbsp;<span class="op" id="5884226">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884230">return</span>&nbsp;<span class="ident" id="5884237">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5884242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5884245">size</span>&nbsp;<span class="op" id="5884250">:=</span>&nbsp;<span class="num" id="5884253">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884256">switch</span>&nbsp;<span class="ident" id="5884263">extension</span>&nbsp;<span class="op" id="5884273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884276">case</span>&nbsp;<span class="ident" id="5884281">eText</span><span class="op" id="5884286">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5884290">size</span>&nbsp;<span class="op" id="5884295">=</span>&nbsp;<span class="num" id="5884297">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884301">case</span>&nbsp;<span class="ident" id="5884306">eGraphicControl</span><span class="op" id="5884321">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884325">return</span>&nbsp;<span class="ident" id="5884332">d</span><span class="op" id="5884333">.</span><span class="ident" id="5884334">readGraphicControl</span><span class="op" id="5884352">(</span><span class="op" id="5884353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884356">case</span>&nbsp;<span class="ident" id="5884361">eComment</span><span class="op" id="5884369">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5884373">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;but&nbsp;read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884410">case</span>&nbsp;<span class="ident" id="5884415">eApplication</span><span class="op" id="5884427">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5884431">b</span><span class="op" id="5884432">,</span>&nbsp;<span class="ident" id="5884434">err</span>&nbsp;<span class="op" id="5884438">:=</span>&nbsp;<span class="ident" id="5884441">d</span><span class="op" id="5884442">.</span><span class="ident" id="5884443">r</span><span class="op" id="5884444">.</span><span class="ident" id="5884445">ReadByte</span><span class="op" id="5884453">(</span><span class="op" id="5884454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884458">if</span>&nbsp;<span class="ident" id="5884461">err</span>&nbsp;<span class="op" id="5884465">!=</span>&nbsp;<span class="builtintype" id="5884468">nil</span>&nbsp;<span class="op" id="5884472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884477">return</span>&nbsp;<span class="ident" id="5884484">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5884490">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5884494">//&nbsp;The&nbsp;spec&nbsp;requires&nbsp;size&nbsp;be&nbsp;11,&nbsp;but&nbsp;Adobe&nbsp;sometimes&nbsp;uses&nbsp;10.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5884558">size</span>&nbsp;<span class="op" id="5884563">=</span>&nbsp;<span class="builtintype" id="5884565">int</span><span class="op" id="5884568">(</span><span class="ident" id="5884569">b</span><span class="op" id="5884570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884573">default</span><span class="op" id="5884580">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884584">return</span>&nbsp;<span class="ident" id="5884591">fmt</span><span class="op" id="5884594">.</span><span class="ident" id="5884595">Errorf</span><span class="op" id="5884601">(</span><span class="string" id="5884602">&#34;gif:&nbsp;unknown&nbsp;extension&nbsp;0x%.2x&#34;</span><span class="op" id="5884633">,</span>&nbsp;<span class="ident" id="5884635">extension</span><span class="op" id="5884644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5884647">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884650">if</span>&nbsp;<span class="ident" id="5884653">size</span>&nbsp;<span class="op" id="5884658">&gt;</span>&nbsp;<span class="num" id="5884660">0</span>&nbsp;<span class="op" id="5884662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884666">if</span>&nbsp;<span class="ident" id="5884669">_</span><span class="op" id="5884670">,</span>&nbsp;<span class="ident" id="5884672">err</span>&nbsp;<span class="op" id="5884676">:=</span>&nbsp;<span class="ident" id="5884679">io</span><span class="op" id="5884681">.</span><span class="ident" id="5884682">ReadFull</span><span class="op" id="5884690">(</span><span class="ident" id="5884691">d</span><span class="op" id="5884692">.</span><span class="ident" id="5884693">r</span><span class="op" id="5884694">,</span>&nbsp;<span class="ident" id="5884696">d</span><span class="op" id="5884697">.</span><span class="ident" id="5884698">tmp</span><span class="op" id="5884701">[</span><span class="num" id="5884702">0</span><span class="op" id="5884703">:</span><span class="ident" id="5884704">size</span><span class="op" id="5884708">]</span><span class="op" id="5884709">)</span><span class="op" id="5884710">;</span>&nbsp;<span class="ident" id="5884712">err</span>&nbsp;<span class="op" id="5884716">!=</span>&nbsp;<span class="builtintype" id="5884719">nil</span>&nbsp;<span class="op" id="5884723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884728">return</span>&nbsp;<span class="ident" id="5884735">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5884741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5884744">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5884748">//&nbsp;Application&nbsp;Extension&nbsp;with&nbsp;&#34;NETSCAPE2.0&#34;&nbsp;as&nbsp;string&nbsp;and&nbsp;1&nbsp;in&nbsp;data&nbsp;means</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5884823">//&nbsp;this&nbsp;extension&nbsp;defines&nbsp;a&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884864">if</span>&nbsp;<span class="ident" id="5884867">extension</span>&nbsp;<span class="op" id="5884877">==</span>&nbsp;<span class="ident" id="5884880">eApplication</span>&nbsp;<span class="op" id="5884893">&amp;&amp;</span>&nbsp;<span class="builtintype" id="5884896">string</span><span class="op" id="5884902">(</span><span class="ident" id="5884903">d</span><span class="op" id="5884904">.</span><span class="ident" id="5884905">tmp</span><span class="op" id="5884908">[</span><span class="op" id="5884909">:</span><span class="ident" id="5884910">size</span><span class="op" id="5884914">]</span><span class="op" id="5884915">)</span>&nbsp;<span class="op" id="5884917">==</span>&nbsp;<span class="string" id="5884920">&#34;NETSCAPE2.0&#34;</span>&nbsp;<span class="op" id="5884934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5884938">n</span><span class="op" id="5884939">,</span>&nbsp;<span class="ident" id="5884941">err</span>&nbsp;<span class="op" id="5884945">:=</span>&nbsp;<span class="ident" id="5884948">d</span><span class="op" id="5884949">.</span><span class="ident" id="5884950">readBlock</span><span class="op" id="5884959">(</span><span class="op" id="5884960">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884964">if</span>&nbsp;<span class="ident" id="5884967">n</span>&nbsp;<span class="op" id="5884969">==</span>&nbsp;<span class="num" id="5884972">0</span>&nbsp;<span class="op" id="5884974">||</span>&nbsp;<span class="ident" id="5884977">err</span>&nbsp;<span class="op" id="5884981">!=</span>&nbsp;<span class="builtintype" id="5884984">nil</span>&nbsp;<span class="op" id="5884988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5884993">return</span>&nbsp;<span class="ident" id="5885000">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5885006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5885010">if</span>&nbsp;<span class="ident" id="5885013">n</span>&nbsp;<span class="op" id="5885015">==</span>&nbsp;<span class="num" id="5885018">3</span>&nbsp;<span class="op" id="5885020">&amp;&amp;</span>&nbsp;<span class="ident" id="5885023">d</span><span class="op" id="5885024">.</span><span class="ident" id="5885025">tmp</span><span class="op" id="5885028">[</span><span class="num" id="5885029">0</span><span class="op" id="5885030">]</span>&nbsp;<span class="op" id="5885032">==</span>&nbsp;<span class="num" id="5885035">1</span>&nbsp;<span class="op" id="5885037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885042">d</span><span class="op" id="5885043">.</span><span class="ident" id="5885044">loopCount</span>&nbsp;<span class="op" id="5885054">=</span>&nbsp;<span class="builtintype" id="5885056">int</span><span class="op" id="5885059">(</span><span class="ident" id="5885060">d</span><span class="op" id="5885061">.</span><span class="ident" id="5885062">tmp</span><span class="op" id="5885065">[</span><span class="num" id="5885066">1</span><span class="op" id="5885067">]</span><span class="op" id="5885068">)</span>&nbsp;<span class="op" id="5885070">|</span>&nbsp;<span class="builtintype" id="5885072">int</span><span class="op" id="5885075">(</span><span class="ident" id="5885076">d</span><span class="op" id="5885077">.</span><span class="ident" id="5885078">tmp</span><span class="op" id="5885081">[</span><span class="num" id="5885082">2</span><span class="op" id="5885083">]</span><span class="op" id="5885084">)</span><span class="op" id="5885085">&lt;&lt;</span><span class="num" id="5885087">8</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5885091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5885094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5885097">for</span>&nbsp;<span class="op" id="5885101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885105">n</span><span class="op" id="5885106">,</span>&nbsp;<span class="ident" id="5885108">err</span>&nbsp;<span class="op" id="5885112">:=</span>&nbsp;<span class="ident" id="5885115">d</span><span class="op" id="5885116">.</span><span class="ident" id="5885117">readBlock</span><span class="op" id="5885126">(</span><span class="op" id="5885127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5885131">if</span>&nbsp;<span class="ident" id="5885134">n</span>&nbsp;<span class="op" id="5885136">==</span>&nbsp;<span class="num" id="5885139">0</span>&nbsp;<span class="op" id="5885141">||</span>&nbsp;<span class="ident" id="5885144">err</span>&nbsp;<span class="op" id="5885148">!=</span>&nbsp;<span class="builtintype" id="5885151">nil</span>&nbsp;<span class="op" id="5885155">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5885160">return</span>&nbsp;<span class="ident" id="5885167">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5885173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5885176">}</span><br>
<span class="lineno"></span><span class="op" id="5885178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="5885181">func</span>&nbsp;<span class="op" id="5885186">(</span><span class="ident" id="5885187">d</span>&nbsp;<span class="op" id="5885189">*</span><span class="ident" id="5885190">decoder</span><span class="op" id="5885197">)</span>&nbsp;<span class="ident" id="5885199">readGraphicControl</span><span class="op" id="5885217">(</span><span class="op" id="5885218">)</span>&nbsp;<span class="builtintype" id="5885220">error</span>&nbsp;<span class="op" id="5885226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5885229">if</span>&nbsp;<span class="ident" id="5885232">_</span><span class="op" id="5885233">,</span>&nbsp;<span class="ident" id="5885235">err</span>&nbsp;<span class="op" id="5885239">:=</span>&nbsp;<span class="ident" id="5885242">io</span><span class="op" id="5885244">.</span><span class="ident" id="5885245">ReadFull</span><span class="op" id="5885253">(</span><span class="ident" id="5885254">d</span><span class="op" id="5885255">.</span><span class="ident" id="5885256">r</span><span class="op" id="5885257">,</span>&nbsp;<span class="ident" id="5885259">d</span><span class="op" id="5885260">.</span><span class="ident" id="5885261">tmp</span><span class="op" id="5885264">[</span><span class="num" id="5885265">0</span><span class="op" id="5885266">:</span><span class="num" id="5885267">6</span><span class="op" id="5885268">]</span><span class="op" id="5885269">)</span><span class="op" id="5885270">;</span>&nbsp;<span class="ident" id="5885272">err</span>&nbsp;<span class="op" id="5885276">!=</span>&nbsp;<span class="builtintype" id="5885279">nil</span>&nbsp;<span class="op" id="5885283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5885287">return</span>&nbsp;<span class="ident" id="5885294">fmt</span><span class="op" id="5885297">.</span><span class="ident" id="5885298">Errorf</span><span class="op" id="5885304">(</span><span class="string" id="5885305">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;graphic&nbsp;control:&nbsp;%s&#34;</span><span class="op" id="5885342">,</span>&nbsp;<span class="ident" id="5885344">err</span><span class="op" id="5885347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5885350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885353">d</span><span class="op" id="5885354">.</span><span class="ident" id="5885355">flags</span>&nbsp;<span class="op" id="5885361">=</span>&nbsp;<span class="ident" id="5885363">d</span><span class="op" id="5885364">.</span><span class="ident" id="5885365">tmp</span><span class="op" id="5885368">[</span><span class="num" id="5885369">1</span><span class="op" id="5885370">]</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885373">d</span><span class="op" id="5885374">.</span><span class="ident" id="5885375">delayTime</span>&nbsp;<span class="op" id="5885385">=</span>&nbsp;<span class="builtintype" id="5885387">int</span><span class="op" id="5885390">(</span><span class="ident" id="5885391">d</span><span class="op" id="5885392">.</span><span class="ident" id="5885393">tmp</span><span class="op" id="5885396">[</span><span class="num" id="5885397">2</span><span class="op" id="5885398">]</span><span class="op" id="5885399">)</span>&nbsp;<span class="op" id="5885401">|</span>&nbsp;<span class="builtintype" id="5885403">int</span><span class="op" id="5885406">(</span><span class="ident" id="5885407">d</span><span class="op" id="5885408">.</span><span class="ident" id="5885409">tmp</span><span class="op" id="5885412">[</span><span class="num" id="5885413">3</span><span class="op" id="5885414">]</span><span class="op" id="5885415">)</span><span class="op" id="5885416">&lt;&lt;</span><span class="num" id="5885418">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5885421">if</span>&nbsp;<span class="ident" id="5885424">d</span><span class="op" id="5885425">.</span><span class="ident" id="5885426">flags</span><span class="op" id="5885431">&amp;</span><span class="ident" id="5885432">gcTransparentColorSet</span>&nbsp;<span class="op" id="5885454">!=</span>&nbsp;<span class="num" id="5885457">0</span>&nbsp;<span class="op" id="5885459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885463">d</span><span class="op" id="5885464">.</span><span class="ident" id="5885465">transparentIndex</span>&nbsp;<span class="op" id="5885482">=</span>&nbsp;<span class="ident" id="5885484">d</span><span class="op" id="5885485">.</span><span class="ident" id="5885486">tmp</span><span class="op" id="5885489">[</span><span class="num" id="5885490">4</span><span class="op" id="5885491">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885495">d</span><span class="op" id="5885496">.</span><span class="ident" id="5885497">hasTransparentIndex</span>&nbsp;<span class="op" id="5885517">=</span>&nbsp;<span class="builtintype" id="5885519">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5885525">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5885528">return</span>&nbsp;<span class="builtintype" id="5885535">nil</span><br>
<span class="lineno"></span><span class="op" id="5885539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5885542">func</span>&nbsp;<span class="op" id="5885547">(</span><span class="ident" id="5885548">d</span>&nbsp;<span class="op" id="5885550">*</span><span class="ident" id="5885551">decoder</span><span class="op" id="5885558">)</span>&nbsp;<span class="ident" id="5885560">newImageFromDescriptor</span><span class="op" id="5885582">(</span><span class="op" id="5885583">)</span>&nbsp;<span class="op" id="5885585">(</span><span class="op" id="5885586">*</span><span class="ident" id="5885587">image</span><span class="op" id="5885592">.</span><span class="ident" id="5885593">Paletted</span><span class="op" id="5885601">,</span>&nbsp;<span class="builtintype" id="5885603">error</span><span class="op" id="5885608">)</span>&nbsp;<span class="op" id="5885610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5885613">if</span>&nbsp;<span class="ident" id="5885616">_</span><span class="op" id="5885617">,</span>&nbsp;<span class="ident" id="5885619">err</span>&nbsp;<span class="op" id="5885623">:=</span>&nbsp;<span class="ident" id="5885626">io</span><span class="op" id="5885628">.</span><span class="ident" id="5885629">ReadFull</span><span class="op" id="5885637">(</span><span class="ident" id="5885638">d</span><span class="op" id="5885639">.</span><span class="ident" id="5885640">r</span><span class="op" id="5885641">,</span>&nbsp;<span class="ident" id="5885643">d</span><span class="op" id="5885644">.</span><span class="ident" id="5885645">tmp</span><span class="op" id="5885648">[</span><span class="num" id="5885649">0</span><span class="op" id="5885650">:</span><span class="num" id="5885651">9</span><span class="op" id="5885652">]</span><span class="op" id="5885653">)</span><span class="op" id="5885654">;</span>&nbsp;<span class="ident" id="5885656">err</span>&nbsp;<span class="op" id="5885660">!=</span>&nbsp;<span class="builtintype" id="5885663">nil</span>&nbsp;<span class="op" id="5885667">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5885671">return</span>&nbsp;<span class="builtintype" id="5885678">nil</span><span class="op" id="5885681">,</span>&nbsp;<span class="ident" id="5885683">fmt</span><span class="op" id="5885686">.</span><span class="ident" id="5885687">Errorf</span><span class="op" id="5885693">(</span><span class="string" id="5885694">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;image&nbsp;descriptor:&nbsp;%s&#34;</span><span class="op" id="5885732">,</span>&nbsp;<span class="ident" id="5885734">err</span><span class="op" id="5885737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5885740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885743">left</span>&nbsp;<span class="op" id="5885748">:=</span>&nbsp;<span class="builtintype" id="5885751">int</span><span class="op" id="5885754">(</span><span class="ident" id="5885755">d</span><span class="op" id="5885756">.</span><span class="ident" id="5885757">tmp</span><span class="op" id="5885760">[</span><span class="num" id="5885761">0</span><span class="op" id="5885762">]</span><span class="op" id="5885763">)</span>&nbsp;<span class="op" id="5885765">+</span>&nbsp;<span class="builtintype" id="5885767">int</span><span class="op" id="5885770">(</span><span class="ident" id="5885771">d</span><span class="op" id="5885772">.</span><span class="ident" id="5885773">tmp</span><span class="op" id="5885776">[</span><span class="num" id="5885777">1</span><span class="op" id="5885778">]</span><span class="op" id="5885779">)</span><span class="op" id="5885780">&lt;&lt;</span><span class="num" id="5885782">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885785">top</span>&nbsp;<span class="op" id="5885789">:=</span>&nbsp;<span class="builtintype" id="5885792">int</span><span class="op" id="5885795">(</span><span class="ident" id="5885796">d</span><span class="op" id="5885797">.</span><span class="ident" id="5885798">tmp</span><span class="op" id="5885801">[</span><span class="num" id="5885802">2</span><span class="op" id="5885803">]</span><span class="op" id="5885804">)</span>&nbsp;<span class="op" id="5885806">+</span>&nbsp;<span class="builtintype" id="5885808">int</span><span class="op" id="5885811">(</span><span class="ident" id="5885812">d</span><span class="op" id="5885813">.</span><span class="ident" id="5885814">tmp</span><span class="op" id="5885817">[</span><span class="num" id="5885818">3</span><span class="op" id="5885819">]</span><span class="op" id="5885820">)</span><span class="op" id="5885821">&lt;&lt;</span><span class="num" id="5885823">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885826">width</span>&nbsp;<span class="op" id="5885832">:=</span>&nbsp;<span class="builtintype" id="5885835">int</span><span class="op" id="5885838">(</span><span class="ident" id="5885839">d</span><span class="op" id="5885840">.</span><span class="ident" id="5885841">tmp</span><span class="op" id="5885844">[</span><span class="num" id="5885845">4</span><span class="op" id="5885846">]</span><span class="op" id="5885847">)</span>&nbsp;<span class="op" id="5885849">+</span>&nbsp;<span class="builtintype" id="5885851">int</span><span class="op" id="5885854">(</span><span class="ident" id="5885855">d</span><span class="op" id="5885856">.</span><span class="ident" id="5885857">tmp</span><span class="op" id="5885860">[</span><span class="num" id="5885861">5</span><span class="op" id="5885862">]</span><span class="op" id="5885863">)</span><span class="op" id="5885864">&lt;&lt;</span><span class="num" id="5885866">8</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885869">height</span>&nbsp;<span class="op" id="5885876">:=</span>&nbsp;<span class="builtintype" id="5885879">int</span><span class="op" id="5885882">(</span><span class="ident" id="5885883">d</span><span class="op" id="5885884">.</span><span class="ident" id="5885885">tmp</span><span class="op" id="5885888">[</span><span class="num" id="5885889">6</span><span class="op" id="5885890">]</span><span class="op" id="5885891">)</span>&nbsp;<span class="op" id="5885893">+</span>&nbsp;<span class="builtintype" id="5885895">int</span><span class="op" id="5885898">(</span><span class="ident" id="5885899">d</span><span class="op" id="5885900">.</span><span class="ident" id="5885901">tmp</span><span class="op" id="5885904">[</span><span class="num" id="5885905">7</span><span class="op" id="5885906">]</span><span class="op" id="5885907">)</span><span class="op" id="5885908">&lt;&lt;</span><span class="num" id="5885910">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5885913">d</span><span class="op" id="5885914">.</span><span class="ident" id="5885915">imageFields</span>&nbsp;<span class="op" id="5885927">=</span>&nbsp;<span class="ident" id="5885929">d</span><span class="op" id="5885930">.</span><span class="ident" id="5885931">tmp</span><span class="op" id="5885934">[</span><span class="num" id="5885935">8</span><span class="op" id="5885936">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5885940">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;20&nbsp;(Image&nbsp;Descriptor)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5885997">//&nbsp;&#34;Each&nbsp;image&nbsp;must&nbsp;fit&nbsp;within&nbsp;the&nbsp;boundaries&nbsp;of&nbsp;the&nbsp;Logical</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5886059">//&nbsp;Screen,&nbsp;as&nbsp;defined&nbsp;in&nbsp;the&nbsp;Logical&nbsp;Screen&nbsp;Descriptor.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886117">bounds</span>&nbsp;<span class="op" id="5886124">:=</span>&nbsp;<span class="ident" id="5886127">image</span><span class="op" id="5886132">.</span><span class="ident" id="5886133">Rect</span><span class="op" id="5886137">(</span><span class="ident" id="5886138">left</span><span class="op" id="5886142">,</span>&nbsp;<span class="ident" id="5886144">top</span><span class="op" id="5886147">,</span>&nbsp;<span class="ident" id="5886149">left</span><span class="op" id="5886153">+</span><span class="ident" id="5886154">width</span><span class="op" id="5886159">,</span>&nbsp;<span class="ident" id="5886161">top</span><span class="op" id="5886164">+</span><span class="ident" id="5886165">height</span><span class="op" id="5886171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5886174">if</span>&nbsp;<span class="ident" id="5886177">bounds</span>&nbsp;<span class="op" id="5886184">!=</span>&nbsp;<span class="ident" id="5886187">bounds</span><span class="op" id="5886193">.</span><span class="ident" id="5886194">Intersect</span><span class="op" id="5886203">(</span><span class="ident" id="5886204">image</span><span class="op" id="5886209">.</span><span class="ident" id="5886210">Rect</span><span class="op" id="5886214">(</span><span class="num" id="5886215">0</span><span class="op" id="5886216">,</span>&nbsp;<span class="num" id="5886218">0</span><span class="op" id="5886219">,</span>&nbsp;<span class="ident" id="5886221">d</span><span class="op" id="5886222">.</span><span class="ident" id="5886223">width</span><span class="op" id="5886228">,</span>&nbsp;<span class="ident" id="5886230">d</span><span class="op" id="5886231">.</span><span class="ident" id="5886232">height</span><span class="op" id="5886238">)</span><span class="op" id="5886239">)</span>&nbsp;<span class="op" id="5886241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5886245">return</span>&nbsp;<span class="builtintype" id="5886252">nil</span><span class="op" id="5886255">,</span>&nbsp;<span class="ident" id="5886257">errors</span><span class="op" id="5886263">.</span><span class="ident" id="5886264">New</span><span class="op" id="5886267">(</span><span class="string" id="5886268">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><span class="op" id="5886312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5886315">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5886318">return</span>&nbsp;<span class="ident" id="5886325">image</span><span class="op" id="5886330">.</span><span class="ident" id="5886331">NewPaletted</span><span class="op" id="5886342">(</span><span class="ident" id="5886343">bounds</span><span class="op" id="5886349">,</span>&nbsp;<span class="builtintype" id="5886351">nil</span><span class="op" id="5886354">)</span><span class="op" id="5886355">,</span>&nbsp;<span class="builtintype" id="5886357">nil</span><br>
<span class="lineno"></span><span class="op" id="5886361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5886364">func</span>&nbsp;<span class="op" id="5886369">(</span><span class="ident" id="5886370">d</span>&nbsp;<span class="op" id="5886372">*</span><span class="ident" id="5886373">decoder</span><span class="op" id="5886380">)</span>&nbsp;<span class="ident" id="5886382">readBlock</span><span class="op" id="5886391">(</span><span class="op" id="5886392">)</span>&nbsp;<span class="op" id="5886394">(</span><span class="builtintype" id="5886395">int</span><span class="op" id="5886398">,</span>&nbsp;<span class="builtintype" id="5886400">error</span><span class="op" id="5886405">)</span>&nbsp;<span class="op" id="5886407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886410">n</span><span class="op" id="5886411">,</span>&nbsp;<span class="ident" id="5886413">err</span>&nbsp;<span class="op" id="5886417">:=</span>&nbsp;<span class="ident" id="5886420">d</span><span class="op" id="5886421">.</span><span class="ident" id="5886422">r</span><span class="op" id="5886423">.</span><span class="ident" id="5886424">ReadByte</span><span class="op" id="5886432">(</span><span class="op" id="5886433">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5886436">if</span>&nbsp;<span class="ident" id="5886439">n</span>&nbsp;<span class="op" id="5886441">==</span>&nbsp;<span class="num" id="5886444">0</span>&nbsp;<span class="op" id="5886446">||</span>&nbsp;<span class="ident" id="5886449">err</span>&nbsp;<span class="op" id="5886453">!=</span>&nbsp;<span class="builtintype" id="5886456">nil</span>&nbsp;<span class="op" id="5886460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5886464">return</span>&nbsp;<span class="num" id="5886471">0</span><span class="op" id="5886472">,</span>&nbsp;<span class="ident" id="5886474">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5886479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5886482">return</span>&nbsp;<span class="ident" id="5886489">io</span><span class="op" id="5886491">.</span><span class="ident" id="5886492">ReadFull</span><span class="op" id="5886500">(</span><span class="ident" id="5886501">d</span><span class="op" id="5886502">.</span><span class="ident" id="5886503">r</span><span class="op" id="5886504">,</span>&nbsp;<span class="ident" id="5886506">d</span><span class="op" id="5886507">.</span><span class="ident" id="5886508">tmp</span><span class="op" id="5886511">[</span><span class="num" id="5886512">0</span><span class="op" id="5886513">:</span><span class="ident" id="5886514">n</span><span class="op" id="5886515">]</span><span class="op" id="5886516">)</span><br>
<span class="lineno"></span><span class="op" id="5886518">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="comment" id="5886521">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;ordering&nbsp;for&nbsp;a&nbsp;pass&nbsp;of&nbsp;the&nbsp;interlace&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="5886598">type</span>&nbsp;<span class="ident" id="5886603">interlaceScan</span>&nbsp;<span class="keyword" id="5886617">struct</span>&nbsp;<span class="op" id="5886624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5886627">skip</span><span class="op" id="5886631">,</span>&nbsp;<span class="ident" id="5886633">start</span>&nbsp;<span class="builtintype" id="5886639">int</span><br>
<span class="lineno"></span><span class="op" id="5886643">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="5886646">//&nbsp;interlacing&nbsp;represents&nbsp;the&nbsp;set&nbsp;of&nbsp;scans&nbsp;in&nbsp;an&nbsp;interlaced&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5886717">var</span>&nbsp;<span class="ident" id="5886721">interlacing</span>&nbsp;<span class="op" id="5886733">=</span>&nbsp;<span class="op" id="5886735">[</span><span class="op" id="5886736">]</span><span class="ident" id="5886737">interlaceScan</span><span class="op" id="5886750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5886753">{</span><span class="num" id="5886754">8</span><span class="op" id="5886755">,</span>&nbsp;<span class="num" id="5886757">0</span><span class="op" id="5886758">}</span><span class="op" id="5886759">,</span>&nbsp;<span class="comment" id="5886761">//&nbsp;Group&nbsp;1&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5886812">{</span><span class="num" id="5886813">8</span><span class="op" id="5886814">,</span>&nbsp;<span class="num" id="5886816">4</span><span class="op" id="5886817">}</span><span class="op" id="5886818">,</span>&nbsp;<span class="comment" id="5886820">//&nbsp;Group&nbsp;2&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;4.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5886871">{</span><span class="num" id="5886872">4</span><span class="op" id="5886873">,</span>&nbsp;<span class="num" id="5886875">2</span><span class="op" id="5886876">}</span><span class="op" id="5886877">,</span>&nbsp;<span class="comment" id="5886879">//&nbsp;Group&nbsp;3&nbsp;:&nbsp;Every&nbsp;4th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5886930">{</span><span class="num" id="5886931">2</span><span class="op" id="5886932">,</span>&nbsp;<span class="num" id="5886934">1</span><span class="op" id="5886935">}</span><span class="op" id="5886936">,</span>&nbsp;<span class="comment" id="5886938">//&nbsp;Group&nbsp;4&nbsp;:&nbsp;Every&nbsp;2nd.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;1.</span><br>
<span class="lineno"></span><span class="op" id="5886988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5886991">//&nbsp;uninterlace&nbsp;rearranges&nbsp;the&nbsp;pixels&nbsp;in&nbsp;m&nbsp;to&nbsp;account&nbsp;for&nbsp;interlaced&nbsp;input.</span><br>
<span class="lineno">400</span><span class="keyword" id="5887066">func</span>&nbsp;<span class="ident" id="5887071">uninterlace</span><span class="op" id="5887082">(</span><span class="ident" id="5887083">m</span>&nbsp;<span class="op" id="5887085">*</span><span class="ident" id="5887086">image</span><span class="op" id="5887091">.</span><span class="ident" id="5887092">Paletted</span><span class="op" id="5887100">)</span>&nbsp;<span class="op" id="5887102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5887105">var</span>&nbsp;<span class="ident" id="5887109">nPix</span>&nbsp;<span class="op" id="5887114">[</span><span class="op" id="5887115">]</span><span class="builtintype" id="5887116">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887123">dx</span>&nbsp;<span class="op" id="5887126">:=</span>&nbsp;<span class="ident" id="5887129">m</span><span class="op" id="5887130">.</span><span class="ident" id="5887131">Bounds</span><span class="op" id="5887137">(</span><span class="op" id="5887138">)</span><span class="op" id="5887139">.</span><span class="ident" id="5887140">Dx</span><span class="op" id="5887142">(</span><span class="op" id="5887143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887146">dy</span>&nbsp;<span class="op" id="5887149">:=</span>&nbsp;<span class="ident" id="5887152">m</span><span class="op" id="5887153">.</span><span class="ident" id="5887154">Bounds</span><span class="op" id="5887160">(</span><span class="op" id="5887161">)</span><span class="op" id="5887162">.</span><span class="ident" id="5887163">Dy</span><span class="op" id="5887165">(</span><span class="op" id="5887166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887169">nPix</span>&nbsp;<span class="op" id="5887174">=</span>&nbsp;<span class="builtinfunc" id="5887176">make</span><span class="op" id="5887180">(</span><span class="op" id="5887181">[</span><span class="op" id="5887182">]</span><span class="builtintype" id="5887183">uint8</span><span class="op" id="5887188">,</span>&nbsp;<span class="ident" id="5887190">dx</span><span class="op" id="5887192">*</span><span class="ident" id="5887193">dy</span><span class="op" id="5887195">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887198">offset</span>&nbsp;<span class="op" id="5887205">:=</span>&nbsp;<span class="num" id="5887208">0</span>&nbsp;<span class="comment" id="5887210">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;input&nbsp;by&nbsp;sequential&nbsp;scan&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5887264">for</span>&nbsp;<span class="ident" id="5887268">_</span><span class="op" id="5887269">,</span>&nbsp;<span class="ident" id="5887271">pass</span>&nbsp;<span class="op" id="5887276">:=</span>&nbsp;<span class="keyword" id="5887279">range</span>&nbsp;<span class="ident" id="5887285">interlacing</span>&nbsp;<span class="op" id="5887297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887301">nOffset</span>&nbsp;<span class="op" id="5887309">:=</span>&nbsp;<span class="ident" id="5887312">pass</span><span class="op" id="5887316">.</span><span class="ident" id="5887317">start</span>&nbsp;<span class="op" id="5887323">*</span>&nbsp;<span class="ident" id="5887325">dx</span>&nbsp;<span class="comment" id="5887328">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;output&nbsp;as&nbsp;defined&nbsp;by&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5887378">for</span>&nbsp;<span class="ident" id="5887382">y</span>&nbsp;<span class="op" id="5887384">:=</span>&nbsp;<span class="ident" id="5887387">pass</span><span class="op" id="5887391">.</span><span class="ident" id="5887392">start</span><span class="op" id="5887397">;</span>&nbsp;<span class="ident" id="5887399">y</span>&nbsp;<span class="op" id="5887401">&lt;</span>&nbsp;<span class="ident" id="5887403">dy</span><span class="op" id="5887405">;</span>&nbsp;<span class="ident" id="5887407">y</span>&nbsp;<span class="op" id="5887409">+=</span>&nbsp;<span class="ident" id="5887412">pass</span><span class="op" id="5887416">.</span><span class="ident" id="5887417">skip</span>&nbsp;<span class="op" id="5887422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5887427">copy</span><span class="op" id="5887431">(</span><span class="ident" id="5887432">nPix</span><span class="op" id="5887436">[</span><span class="ident" id="5887437">nOffset</span><span class="op" id="5887444">:</span><span class="ident" id="5887445">nOffset</span><span class="op" id="5887452">+</span><span class="ident" id="5887453">dx</span><span class="op" id="5887455">]</span><span class="op" id="5887456">,</span>&nbsp;<span class="ident" id="5887458">m</span><span class="op" id="5887459">.</span><span class="ident" id="5887460">Pix</span><span class="op" id="5887463">[</span><span class="ident" id="5887464">offset</span><span class="op" id="5887470">:</span><span class="ident" id="5887471">offset</span><span class="op" id="5887477">+</span><span class="ident" id="5887478">dx</span><span class="op" id="5887480">]</span><span class="op" id="5887481">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887486">offset</span>&nbsp;<span class="op" id="5887493">+=</span>&nbsp;<span class="ident" id="5887496">dx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887502">nOffset</span>&nbsp;<span class="op" id="5887510">+=</span>&nbsp;<span class="ident" id="5887513">dx</span>&nbsp;<span class="op" id="5887516">*</span>&nbsp;<span class="ident" id="5887518">pass</span><span class="op" id="5887522">.</span><span class="ident" id="5887523">skip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5887530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5887533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887536">m</span><span class="op" id="5887537">.</span><span class="ident" id="5887538">Pix</span>&nbsp;<span class="op" id="5887542">=</span>&nbsp;<span class="ident" id="5887544">nPix</span><br>
<span class="lineno">415</span><span class="op" id="5887549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5887552">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;first&nbsp;embedded</span><br>
<span class="lineno"></span><span class="comment" id="5887618">//&nbsp;image&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="5887646">func</span>&nbsp;<span class="ident" id="5887651">Decode</span><span class="op" id="5887657">(</span><span class="ident" id="5887658">r</span>&nbsp;<span class="ident" id="5887660">io</span><span class="op" id="5887662">.</span><span class="ident" id="5887663">Reader</span><span class="op" id="5887669">)</span>&nbsp;<span class="op" id="5887671">(</span><span class="ident" id="5887672">image</span><span class="op" id="5887677">.</span><span class="ident" id="5887678">Image</span><span class="op" id="5887683">,</span>&nbsp;<span class="builtintype" id="5887685">error</span><span class="op" id="5887690">)</span>&nbsp;<span class="op" id="5887692">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5887695">var</span>&nbsp;<span class="ident" id="5887699">d</span>&nbsp;<span class="ident" id="5887701">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5887710">if</span>&nbsp;<span class="ident" id="5887713">err</span>&nbsp;<span class="op" id="5887717">:=</span>&nbsp;<span class="ident" id="5887720">d</span><span class="op" id="5887721">.</span><span class="ident" id="5887722">decode</span><span class="op" id="5887728">(</span><span class="ident" id="5887729">r</span><span class="op" id="5887730">,</span>&nbsp;<span class="builtintype" id="5887732">false</span><span class="op" id="5887737">)</span><span class="op" id="5887738">;</span>&nbsp;<span class="ident" id="5887740">err</span>&nbsp;<span class="op" id="5887744">!=</span>&nbsp;<span class="builtintype" id="5887747">nil</span>&nbsp;<span class="op" id="5887751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5887755">return</span>&nbsp;<span class="builtintype" id="5887762">nil</span><span class="op" id="5887765">,</span>&nbsp;<span class="ident" id="5887767">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5887772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5887775">return</span>&nbsp;<span class="ident" id="5887782">d</span><span class="op" id="5887783">.</span><span class="ident" id="5887784">image</span><span class="op" id="5887789">[</span><span class="num" id="5887790">0</span><span class="op" id="5887791">]</span><span class="op" id="5887792">,</span>&nbsp;<span class="builtintype" id="5887794">nil</span><br>
<span class="lineno">425</span><span class="op" id="5887798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5887801">//&nbsp;GIF&nbsp;represents&nbsp;the&nbsp;possibly&nbsp;multiple&nbsp;images&nbsp;stored&nbsp;in&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5887870">type</span>&nbsp;<span class="ident" id="5887875">GIF</span>&nbsp;<span class="keyword" id="5887879">struct</span>&nbsp;<span class="op" id="5887886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887889">Image</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5887899">[</span><span class="op" id="5887900">]</span><span class="op" id="5887901">*</span><span class="ident" id="5887902">image</span><span class="op" id="5887907">.</span><span class="ident" id="5887908">Paletted</span>&nbsp;<span class="comment" id="5887917">//&nbsp;The&nbsp;successive&nbsp;images.</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5887944">Delay</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5887954">[</span><span class="op" id="5887955">]</span><span class="builtintype" id="5887956">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5887972">//&nbsp;The&nbsp;successive&nbsp;delay&nbsp;times,&nbsp;one&nbsp;per&nbsp;frame,&nbsp;in&nbsp;100ths&nbsp;of&nbsp;a&nbsp;second.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888042">LoopCount</span>&nbsp;<span class="builtintype" id="5888052">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5888070">//&nbsp;The&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span><span class="op" id="5888089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5888092">//&nbsp;DecodeAll&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;sequential&nbsp;frames</span><br>
<span class="lineno">435</span><span class="comment" id="5888164">//&nbsp;and&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5888191">func</span>&nbsp;<span class="ident" id="5888196">DecodeAll</span><span class="op" id="5888205">(</span><span class="ident" id="5888206">r</span>&nbsp;<span class="ident" id="5888208">io</span><span class="op" id="5888210">.</span><span class="ident" id="5888211">Reader</span><span class="op" id="5888217">)</span>&nbsp;<span class="op" id="5888219">(</span><span class="op" id="5888220">*</span><span class="ident" id="5888221">GIF</span><span class="op" id="5888224">,</span>&nbsp;<span class="builtintype" id="5888226">error</span><span class="op" id="5888231">)</span>&nbsp;<span class="op" id="5888233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5888236">var</span>&nbsp;<span class="ident" id="5888240">d</span>&nbsp;<span class="ident" id="5888242">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5888251">if</span>&nbsp;<span class="ident" id="5888254">err</span>&nbsp;<span class="op" id="5888258">:=</span>&nbsp;<span class="ident" id="5888261">d</span><span class="op" id="5888262">.</span><span class="ident" id="5888263">decode</span><span class="op" id="5888269">(</span><span class="ident" id="5888270">r</span><span class="op" id="5888271">,</span>&nbsp;<span class="builtintype" id="5888273">false</span><span class="op" id="5888278">)</span><span class="op" id="5888279">;</span>&nbsp;<span class="ident" id="5888281">err</span>&nbsp;<span class="op" id="5888285">!=</span>&nbsp;<span class="builtintype" id="5888288">nil</span>&nbsp;<span class="op" id="5888292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5888296">return</span>&nbsp;<span class="builtintype" id="5888303">nil</span><span class="op" id="5888306">,</span>&nbsp;<span class="ident" id="5888308">err</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5888313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888316">gif</span>&nbsp;<span class="op" id="5888320">:=</span>&nbsp;<span class="op" id="5888323">&amp;</span><span class="ident" id="5888324">GIF</span><span class="op" id="5888327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888331">Image</span><span class="op" id="5888336">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888342">d</span><span class="op" id="5888343">.</span><span class="ident" id="5888344">image</span><span class="op" id="5888349">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888353">LoopCount</span><span class="op" id="5888362">:</span>&nbsp;<span class="ident" id="5888364">d</span><span class="op" id="5888365">.</span><span class="ident" id="5888366">loopCount</span><span class="op" id="5888375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888379">Delay</span><span class="op" id="5888384">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888390">d</span><span class="op" id="5888391">.</span><span class="ident" id="5888392">delay</span><span class="op" id="5888397">,</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5888400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5888403">return</span>&nbsp;<span class="ident" id="5888410">gif</span><span class="op" id="5888413">,</span>&nbsp;<span class="builtintype" id="5888415">nil</span><br>
<span class="lineno"></span><span class="op" id="5888419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5888422">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;global&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;GIF&nbsp;image</span><br>
<span class="lineno">450</span><span class="comment" id="5888499">//&nbsp;without&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5888537">func</span>&nbsp;<span class="ident" id="5888542">DecodeConfig</span><span class="op" id="5888554">(</span><span class="ident" id="5888555">r</span>&nbsp;<span class="ident" id="5888557">io</span><span class="op" id="5888559">.</span><span class="ident" id="5888560">Reader</span><span class="op" id="5888566">)</span>&nbsp;<span class="op" id="5888568">(</span><span class="ident" id="5888569">image</span><span class="op" id="5888574">.</span><span class="ident" id="5888575">Config</span><span class="op" id="5888581">,</span>&nbsp;<span class="builtintype" id="5888583">error</span><span class="op" id="5888588">)</span>&nbsp;<span class="op" id="5888590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5888593">var</span>&nbsp;<span class="ident" id="5888597">d</span>&nbsp;<span class="ident" id="5888599">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5888608">if</span>&nbsp;<span class="ident" id="5888611">err</span>&nbsp;<span class="op" id="5888615">:=</span>&nbsp;<span class="ident" id="5888618">d</span><span class="op" id="5888619">.</span><span class="ident" id="5888620">decode</span><span class="op" id="5888626">(</span><span class="ident" id="5888627">r</span><span class="op" id="5888628">,</span>&nbsp;<span class="builtintype" id="5888630">true</span><span class="op" id="5888634">)</span><span class="op" id="5888635">;</span>&nbsp;<span class="ident" id="5888637">err</span>&nbsp;<span class="op" id="5888641">!=</span>&nbsp;<span class="builtintype" id="5888644">nil</span>&nbsp;<span class="op" id="5888648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5888652">return</span>&nbsp;<span class="ident" id="5888659">image</span><span class="op" id="5888664">.</span><span class="ident" id="5888665">Config</span><span class="op" id="5888671">{</span><span class="op" id="5888672">}</span><span class="op" id="5888673">,</span>&nbsp;<span class="ident" id="5888675">err</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5888680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5888683">return</span>&nbsp;<span class="ident" id="5888690">image</span><span class="op" id="5888695">.</span><span class="ident" id="5888696">Config</span><span class="op" id="5888702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888706">ColorModel</span><span class="op" id="5888716">:</span>&nbsp;<span class="ident" id="5888718">d</span><span class="op" id="5888719">.</span><span class="ident" id="5888720">globalColorMap</span><span class="op" id="5888734">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888738">Width</span><span class="op" id="5888743">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888750">d</span><span class="op" id="5888751">.</span><span class="ident" id="5888752">width</span><span class="op" id="5888757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888761">Height</span><span class="op" id="5888767">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888773">d</span><span class="op" id="5888774">.</span><span class="ident" id="5888775">height</span><span class="op" id="5888781">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5888784">}</span><span class="op" id="5888785">,</span>&nbsp;<span class="builtintype" id="5888787">nil</span><br>
<span class="lineno"></span><span class="op" id="5888791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5888794">func</span>&nbsp;<span class="ident" id="5888799">init</span><span class="op" id="5888803">(</span><span class="op" id="5888804">)</span>&nbsp;<span class="op" id="5888806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5888809">image</span><span class="op" id="5888814">.</span><span class="ident" id="5888815">RegisterFormat</span><span class="op" id="5888829">(</span><span class="string" id="5888830">&#34;gif&#34;</span><span class="op" id="5888835">,</span>&nbsp;<span class="string" id="5888837">&#34;GIF8?a&#34;</span><span class="op" id="5888845">,</span>&nbsp;<span class="ident" id="5888847">Decode</span><span class="op" id="5888853">,</span>&nbsp;<span class="ident" id="5888855">DecodeConfig</span><span class="op" id="5888867">)</span><br>
<span class="lineno">465</span><span class="op" id="5888869">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
