<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4666842">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4666897">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4666951">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4667002">//&nbsp;Package&nbsp;png&nbsp;implements&nbsp;a&nbsp;PNG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="4667061">//</span><br>
<span class="lineno"></span><span class="comment" id="4667064">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/TR/PNG/.</span><br>
<span class="lineno"></span><span class="keyword" id="4667122">package</span>&nbsp;<span class="ident" id="4667130">png</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4667135">import</span>&nbsp;<span class="op" id="4667142">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4667145">&#34;compress/zlib&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4667162">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4667181">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4667188">&#34;hash&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4667196">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4667210">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4667219">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4667234">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4667239">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4667242">//&nbsp;Color&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="4667278">const</span>&nbsp;<span class="op" id="4667284">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667287">ctGrayscale</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4667304">=</span>&nbsp;<span class="num" id="4667306">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667309">ctTrueColor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4667326">=</span>&nbsp;<span class="num" id="4667328">2</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667331">ctPaletted</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4667348">=</span>&nbsp;<span class="num" id="4667350">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667353">ctGrayscaleAlpha</span>&nbsp;<span class="op" id="4667370">=</span>&nbsp;<span class="num" id="4667372">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667375">ctTrueColorAlpha</span>&nbsp;<span class="op" id="4667392">=</span>&nbsp;<span class="num" id="4667394">6</span><br>
<span class="lineno"></span><span class="op" id="4667396">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="4667399">//&nbsp;A&nbsp;cb&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;color&nbsp;type&nbsp;and&nbsp;bit&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="4667453">const</span>&nbsp;<span class="op" id="4667459">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667462">cbInvalid</span>&nbsp;<span class="op" id="4667472">=</span>&nbsp;<span class="ident" id="4667474">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667480">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667486">cbG2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667492">cbG4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667498">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667504">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667511">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667518">cbP1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667524">cbP2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667530">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667536">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667542">cbTCA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667550">cbG16</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667557">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667565">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667573">cbTCA16</span><br>
<span class="lineno"></span><span class="op" id="4667581">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4667584">//&nbsp;Filter&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="4667621">const</span>&nbsp;<span class="op" id="4667627">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667630">ftNone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4667640">=</span>&nbsp;<span class="num" id="4667642">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667645">ftSub</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4667655">=</span>&nbsp;<span class="num" id="4667657">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667660">ftUp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4667670">=</span>&nbsp;<span class="num" id="4667672">2</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667675">ftAverage</span>&nbsp;<span class="op" id="4667685">=</span>&nbsp;<span class="num" id="4667687">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667690">ftPaeth</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4667700">=</span>&nbsp;<span class="num" id="4667702">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667705">nFilter</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4667715">=</span>&nbsp;<span class="num" id="4667717">5</span><br>
<span class="lineno"></span><span class="op" id="4667719">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="4667722">//&nbsp;Interlace&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4667741">const</span>&nbsp;<span class="op" id="4667747">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667750">itNone</span>&nbsp;&nbsp;<span class="op" id="4667758">=</span>&nbsp;<span class="num" id="4667760">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667763">itAdam7</span>&nbsp;<span class="op" id="4667771">=</span>&nbsp;<span class="num" id="4667773">1</span><br>
<span class="lineno"></span><span class="op" id="4667775">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="4667778">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;placement&nbsp;and&nbsp;size&nbsp;of&nbsp;a&nbsp;pass&nbsp;for&nbsp;Adam7&nbsp;interlacing.</span><br>
<span class="lineno"></span><span class="keyword" id="4667859">type</span>&nbsp;<span class="ident" id="4667864">interlaceScan</span>&nbsp;<span class="keyword" id="4667878">struct</span>&nbsp;<span class="op" id="4667885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4667888">xFactor</span><span class="op" id="4667895">,</span>&nbsp;<span class="ident" id="4667897">yFactor</span><span class="op" id="4667904">,</span>&nbsp;<span class="ident" id="4667906">xOffset</span><span class="op" id="4667913">,</span>&nbsp;<span class="ident" id="4667915">yOffset</span>&nbsp;<span class="builtintype" id="4667923">int</span><br>
<span class="lineno"></span><span class="op" id="4667927">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="4667930">//&nbsp;interlacing&nbsp;defines&nbsp;Adam7&nbsp;interlacing,&nbsp;with&nbsp;7&nbsp;passes&nbsp;of&nbsp;reduced&nbsp;images.</span><br>
<span class="lineno"></span><span class="comment" id="4668005">//&nbsp;See&nbsp;http://www.w3.org/TR/PNG/#8Interlace</span><br>
<span class="lineno"></span><span class="keyword" id="4668049">var</span>&nbsp;<span class="ident" id="4668053">interlacing</span>&nbsp;<span class="op" id="4668065">=</span>&nbsp;<span class="op" id="4668067">[</span><span class="op" id="4668068">]</span><span class="ident" id="4668069">interlaceScan</span><span class="op" id="4668082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4668085">{</span><span class="num" id="4668086">8</span><span class="op" id="4668087">,</span>&nbsp;<span class="num" id="4668089">8</span><span class="op" id="4668090">,</span>&nbsp;<span class="num" id="4668092">0</span><span class="op" id="4668093">,</span>&nbsp;<span class="num" id="4668095">0</span><span class="op" id="4668096">}</span><span class="op" id="4668097">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4668100">{</span><span class="num" id="4668101">8</span><span class="op" id="4668102">,</span>&nbsp;<span class="num" id="4668104">8</span><span class="op" id="4668105">,</span>&nbsp;<span class="num" id="4668107">4</span><span class="op" id="4668108">,</span>&nbsp;<span class="num" id="4668110">0</span><span class="op" id="4668111">}</span><span class="op" id="4668112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4668115">{</span><span class="num" id="4668116">4</span><span class="op" id="4668117">,</span>&nbsp;<span class="num" id="4668119">8</span><span class="op" id="4668120">,</span>&nbsp;<span class="num" id="4668122">0</span><span class="op" id="4668123">,</span>&nbsp;<span class="num" id="4668125">4</span><span class="op" id="4668126">}</span><span class="op" id="4668127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4668130">{</span><span class="num" id="4668131">4</span><span class="op" id="4668132">,</span>&nbsp;<span class="num" id="4668134">4</span><span class="op" id="4668135">,</span>&nbsp;<span class="num" id="4668137">2</span><span class="op" id="4668138">,</span>&nbsp;<span class="num" id="4668140">0</span><span class="op" id="4668141">}</span><span class="op" id="4668142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4668145">{</span><span class="num" id="4668146">2</span><span class="op" id="4668147">,</span>&nbsp;<span class="num" id="4668149">4</span><span class="op" id="4668150">,</span>&nbsp;<span class="num" id="4668152">0</span><span class="op" id="4668153">,</span>&nbsp;<span class="num" id="4668155">2</span><span class="op" id="4668156">}</span><span class="op" id="4668157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4668160">{</span><span class="num" id="4668161">2</span><span class="op" id="4668162">,</span>&nbsp;<span class="num" id="4668164">2</span><span class="op" id="4668165">,</span>&nbsp;<span class="num" id="4668167">1</span><span class="op" id="4668168">,</span>&nbsp;<span class="num" id="4668170">0</span><span class="op" id="4668171">}</span><span class="op" id="4668172">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4668175">{</span><span class="num" id="4668176">1</span><span class="op" id="4668177">,</span>&nbsp;<span class="num" id="4668179">2</span><span class="op" id="4668180">,</span>&nbsp;<span class="num" id="4668182">0</span><span class="op" id="4668183">,</span>&nbsp;<span class="num" id="4668185">1</span><span class="op" id="4668186">}</span><span class="op" id="4668187">,</span><br>
<span class="lineno"></span><span class="op" id="4668189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4668192">//&nbsp;Decoding&nbsp;stage.</span><br>
<span class="lineno"></span><span class="comment" id="4668211">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;says&nbsp;that&nbsp;the&nbsp;IHDR,&nbsp;PLTE&nbsp;(if&nbsp;present),&nbsp;IDAT&nbsp;and&nbsp;IEND</span><br>
<span class="lineno">85</span><span class="comment" id="4668289">//&nbsp;chunks&nbsp;must&nbsp;appear&nbsp;in&nbsp;that&nbsp;order.&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;IDAT&nbsp;chunks,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4668365">//&nbsp;IDAT&nbsp;chunks&nbsp;must&nbsp;be&nbsp;sequential&nbsp;(i.e.&nbsp;they&nbsp;may&nbsp;not&nbsp;have&nbsp;any&nbsp;other&nbsp;chunks</span><br>
<span class="lineno"></span><span class="comment" id="4668440">//&nbsp;between&nbsp;them).</span><br>
<span class="lineno"></span><span class="comment" id="4668458">//&nbsp;http://www.w3.org/TR/PNG/#5ChunkOrdering</span><br>
<span class="lineno"></span><span class="keyword" id="4668502">const</span>&nbsp;<span class="op" id="4668508">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668511">dsStart</span>&nbsp;<span class="op" id="4668519">=</span>&nbsp;<span class="ident" id="4668521">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668527">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668539">dsSeenPLTE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668551">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668563">dsSeenIEND</span><br>
<span class="lineno">95</span><span class="op" id="4668574">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4668577">const</span>&nbsp;<span class="ident" id="4668583">pngHeader</span>&nbsp;<span class="op" id="4668593">=</span>&nbsp;<span class="string" id="4668595">&#34;\x89PNG\r\n\x1a\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4668616">type</span>&nbsp;<span class="ident" id="4668621">decoder</span>&nbsp;<span class="keyword" id="4668629">struct</span>&nbsp;<span class="op" id="4668636">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668639">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4668653">io</span><span class="op" id="4668655">.</span><span class="ident" id="4668656">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668664">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4668678">image</span><span class="op" id="4668683">.</span><span class="ident" id="4668684">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668691">crc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4668705">hash</span><span class="op" id="4668709">.</span><span class="ident" id="4668710">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668718">width</span><span class="op" id="4668723">,</span>&nbsp;<span class="ident" id="4668725">height</span>&nbsp;<span class="builtintype" id="4668732">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668737">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4668751">int</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668756">palette</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4668770">color</span><span class="op" id="4668775">.</span><span class="ident" id="4668776">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668785">cb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4668799">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668804">stage</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4668818">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668823">idatLength</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4668837">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668845">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4668859">[</span><span class="num" id="4668860">3</span>&nbsp;<span class="op" id="4668862">*</span>&nbsp;<span class="num" id="4668864">256</span><span class="op" id="4668867">]</span><span class="builtintype" id="4668868">byte</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4668874">interlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4668888">int</span><br>
<span class="lineno"></span><span class="op" id="4668892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4668895">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;PNG.</span><br>
<span class="lineno"></span><span class="keyword" id="4668955">type</span>&nbsp;<span class="ident" id="4668960">FormatError</span>&nbsp;<span class="builtintype" id="4668972">string</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="4668980">func</span>&nbsp;<span class="op" id="4668985">(</span><span class="ident" id="4668986">e</span>&nbsp;<span class="ident" id="4668988">FormatError</span><span class="op" id="4668999">)</span>&nbsp;<span class="ident" id="4669001">Error</span><span class="op" id="4669006">(</span><span class="op" id="4669007">)</span>&nbsp;<span class="builtintype" id="4669009">string</span>&nbsp;<span class="op" id="4669016">{</span>&nbsp;<span class="keyword" id="4669018">return</span>&nbsp;<span class="string" id="4669025">&#34;png:&nbsp;invalid&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="4669049">+</span>&nbsp;<span class="builtintype" id="4669051">string</span><span class="op" id="4669057">(</span><span class="ident" id="4669058">e</span><span class="op" id="4669059">)</span>&nbsp;<span class="op" id="4669061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4669064">var</span>&nbsp;<span class="ident" id="4669068">chunkOrderError</span>&nbsp;<span class="op" id="4669084">=</span>&nbsp;<span class="ident" id="4669086">FormatError</span><span class="op" id="4669097">(</span><span class="string" id="4669098">&#34;chunk&nbsp;out&nbsp;of&nbsp;order&#34;</span><span class="op" id="4669118">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="4669121">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;PNG&nbsp;feature.</span><br>
<span class="lineno"></span><span class="keyword" id="4669211">type</span>&nbsp;<span class="ident" id="4669216">UnsupportedError</span>&nbsp;<span class="builtintype" id="4669233">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4669241">func</span>&nbsp;<span class="op" id="4669246">(</span><span class="ident" id="4669247">e</span>&nbsp;<span class="ident" id="4669249">UnsupportedError</span><span class="op" id="4669265">)</span>&nbsp;<span class="ident" id="4669267">Error</span><span class="op" id="4669272">(</span><span class="op" id="4669273">)</span>&nbsp;<span class="builtintype" id="4669275">string</span>&nbsp;<span class="op" id="4669282">{</span>&nbsp;<span class="keyword" id="4669284">return</span>&nbsp;<span class="string" id="4669291">&#34;png:&nbsp;unsupported&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="4669320">+</span>&nbsp;<span class="builtintype" id="4669322">string</span><span class="op" id="4669328">(</span><span class="ident" id="4669329">e</span><span class="op" id="4669330">)</span>&nbsp;<span class="op" id="4669332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="4669335">func</span>&nbsp;<span class="ident" id="4669340">min</span><span class="op" id="4669343">(</span><span class="ident" id="4669344">a</span><span class="op" id="4669345">,</span>&nbsp;<span class="ident" id="4669347">b</span>&nbsp;<span class="builtintype" id="4669349">int</span><span class="op" id="4669352">)</span>&nbsp;<span class="builtintype" id="4669354">int</span>&nbsp;<span class="op" id="4669358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4669361">if</span>&nbsp;<span class="ident" id="4669364">a</span>&nbsp;<span class="op" id="4669366">&lt;</span>&nbsp;<span class="ident" id="4669368">b</span>&nbsp;<span class="op" id="4669370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4669374">return</span>&nbsp;<span class="ident" id="4669381">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4669384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4669387">return</span>&nbsp;<span class="ident" id="4669394">b</span><br>
<span class="lineno">130</span><span class="op" id="4669396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4669399">func</span>&nbsp;<span class="op" id="4669404">(</span><span class="ident" id="4669405">d</span>&nbsp;<span class="op" id="4669407">*</span><span class="ident" id="4669408">decoder</span><span class="op" id="4669415">)</span>&nbsp;<span class="ident" id="4669417">parseIHDR</span><span class="op" id="4669426">(</span><span class="ident" id="4669427">length</span>&nbsp;<span class="builtintype" id="4669434">uint32</span><span class="op" id="4669440">)</span>&nbsp;<span class="builtintype" id="4669442">error</span>&nbsp;<span class="op" id="4669448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4669451">if</span>&nbsp;<span class="ident" id="4669454">length</span>&nbsp;<span class="op" id="4669461">!=</span>&nbsp;<span class="num" id="4669464">13</span>&nbsp;<span class="op" id="4669467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4669471">return</span>&nbsp;<span class="ident" id="4669478">FormatError</span><span class="op" id="4669489">(</span><span class="string" id="4669490">&#34;bad&nbsp;IHDR&nbsp;length&#34;</span><span class="op" id="4669507">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4669510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4669513">if</span>&nbsp;<span class="ident" id="4669516">_</span><span class="op" id="4669517">,</span>&nbsp;<span class="ident" id="4669519">err</span>&nbsp;<span class="op" id="4669523">:=</span>&nbsp;<span class="ident" id="4669526">io</span><span class="op" id="4669528">.</span><span class="ident" id="4669529">ReadFull</span><span class="op" id="4669537">(</span><span class="ident" id="4669538">d</span><span class="op" id="4669539">.</span><span class="ident" id="4669540">r</span><span class="op" id="4669541">,</span>&nbsp;<span class="ident" id="4669543">d</span><span class="op" id="4669544">.</span><span class="ident" id="4669545">tmp</span><span class="op" id="4669548">[</span><span class="op" id="4669549">:</span><span class="num" id="4669550">13</span><span class="op" id="4669552">]</span><span class="op" id="4669553">)</span><span class="op" id="4669554">;</span>&nbsp;<span class="ident" id="4669556">err</span>&nbsp;<span class="op" id="4669560">!=</span>&nbsp;<span class="ident" id="4669563">nil</span>&nbsp;<span class="op" id="4669567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4669571">return</span>&nbsp;<span class="ident" id="4669578">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4669583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4669586">d</span><span class="op" id="4669587">.</span><span class="ident" id="4669588">crc</span><span class="op" id="4669591">.</span><span class="ident" id="4669592">Write</span><span class="op" id="4669597">(</span><span class="ident" id="4669598">d</span><span class="op" id="4669599">.</span><span class="ident" id="4669600">tmp</span><span class="op" id="4669603">[</span><span class="op" id="4669604">:</span><span class="num" id="4669605">13</span><span class="op" id="4669607">]</span><span class="op" id="4669608">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4669611">if</span>&nbsp;<span class="ident" id="4669614">d</span><span class="op" id="4669615">.</span><span class="ident" id="4669616">tmp</span><span class="op" id="4669619">[</span><span class="num" id="4669620">10</span><span class="op" id="4669622">]</span>&nbsp;<span class="op" id="4669624">!=</span>&nbsp;<span class="num" id="4669627">0</span>&nbsp;<span class="op" id="4669629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4669633">return</span>&nbsp;<span class="ident" id="4669640">UnsupportedError</span><span class="op" id="4669656">(</span><span class="string" id="4669657">&#34;compression&nbsp;method&#34;</span><span class="op" id="4669677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4669680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4669683">if</span>&nbsp;<span class="ident" id="4669686">d</span><span class="op" id="4669687">.</span><span class="ident" id="4669688">tmp</span><span class="op" id="4669691">[</span><span class="num" id="4669692">11</span><span class="op" id="4669694">]</span>&nbsp;<span class="op" id="4669696">!=</span>&nbsp;<span class="num" id="4669699">0</span>&nbsp;<span class="op" id="4669701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4669705">return</span>&nbsp;<span class="ident" id="4669712">UnsupportedError</span><span class="op" id="4669728">(</span><span class="string" id="4669729">&#34;filter&nbsp;method&#34;</span><span class="op" id="4669744">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4669747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4669750">if</span>&nbsp;<span class="ident" id="4669753">d</span><span class="op" id="4669754">.</span><span class="ident" id="4669755">tmp</span><span class="op" id="4669758">[</span><span class="num" id="4669759">12</span><span class="op" id="4669761">]</span>&nbsp;<span class="op" id="4669763">!=</span>&nbsp;<span class="ident" id="4669766">itNone</span>&nbsp;<span class="op" id="4669773">&amp;&amp;</span>&nbsp;<span class="ident" id="4669776">d</span><span class="op" id="4669777">.</span><span class="ident" id="4669778">tmp</span><span class="op" id="4669781">[</span><span class="num" id="4669782">12</span><span class="op" id="4669784">]</span>&nbsp;<span class="op" id="4669786">!=</span>&nbsp;<span class="ident" id="4669789">itAdam7</span>&nbsp;<span class="op" id="4669797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4669801">return</span>&nbsp;<span class="ident" id="4669808">FormatError</span><span class="op" id="4669819">(</span><span class="string" id="4669820">&#34;invalid&nbsp;interlace&nbsp;method&#34;</span><span class="op" id="4669846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4669849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4669852">d</span><span class="op" id="4669853">.</span><span class="ident" id="4669854">interlace</span>&nbsp;<span class="op" id="4669864">=</span>&nbsp;<span class="builtintype" id="4669866">int</span><span class="op" id="4669869">(</span><span class="ident" id="4669870">d</span><span class="op" id="4669871">.</span><span class="ident" id="4669872">tmp</span><span class="op" id="4669875">[</span><span class="num" id="4669876">12</span><span class="op" id="4669878">]</span><span class="op" id="4669879">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4669882">w</span>&nbsp;<span class="op" id="4669884">:=</span>&nbsp;<span class="builtintype" id="4669887">int32</span><span class="op" id="4669892">(</span><span class="ident" id="4669893">binary</span><span class="op" id="4669899">.</span><span class="ident" id="4669900">BigEndian</span><span class="op" id="4669909">.</span><span class="ident" id="4669910">Uint32</span><span class="op" id="4669916">(</span><span class="ident" id="4669917">d</span><span class="op" id="4669918">.</span><span class="ident" id="4669919">tmp</span><span class="op" id="4669922">[</span><span class="num" id="4669923">0</span><span class="op" id="4669924">:</span><span class="num" id="4669925">4</span><span class="op" id="4669926">]</span><span class="op" id="4669927">)</span><span class="op" id="4669928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4669931">h</span>&nbsp;<span class="op" id="4669933">:=</span>&nbsp;<span class="builtintype" id="4669936">int32</span><span class="op" id="4669941">(</span><span class="ident" id="4669942">binary</span><span class="op" id="4669948">.</span><span class="ident" id="4669949">BigEndian</span><span class="op" id="4669958">.</span><span class="ident" id="4669959">Uint32</span><span class="op" id="4669965">(</span><span class="ident" id="4669966">d</span><span class="op" id="4669967">.</span><span class="ident" id="4669968">tmp</span><span class="op" id="4669971">[</span><span class="num" id="4669972">4</span><span class="op" id="4669973">:</span><span class="num" id="4669974">8</span><span class="op" id="4669975">]</span><span class="op" id="4669976">)</span><span class="op" id="4669977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4669980">if</span>&nbsp;<span class="ident" id="4669983">w</span>&nbsp;<span class="op" id="4669985">&lt;</span>&nbsp;<span class="num" id="4669987">0</span>&nbsp;<span class="op" id="4669989">||</span>&nbsp;<span class="ident" id="4669992">h</span>&nbsp;<span class="op" id="4669994">&lt;</span>&nbsp;<span class="num" id="4669996">0</span>&nbsp;<span class="op" id="4669998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670002">return</span>&nbsp;<span class="ident" id="4670009">FormatError</span><span class="op" id="4670020">(</span><span class="string" id="4670021">&#34;negative&nbsp;dimension&#34;</span><span class="op" id="4670041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4670044">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670047">nPixels</span>&nbsp;<span class="op" id="4670055">:=</span>&nbsp;<span class="ident" id="4670058">int64</span><span class="op" id="4670063">(</span><span class="ident" id="4670064">w</span><span class="op" id="4670065">)</span>&nbsp;<span class="op" id="4670067">*</span>&nbsp;<span class="ident" id="4670069">int64</span><span class="op" id="4670074">(</span><span class="ident" id="4670075">h</span><span class="op" id="4670076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670079">if</span>&nbsp;<span class="ident" id="4670082">nPixels</span>&nbsp;<span class="op" id="4670090">!=</span>&nbsp;<span class="ident" id="4670093">int64</span><span class="op" id="4670098">(</span><span class="builtintype" id="4670099">int</span><span class="op" id="4670102">(</span><span class="ident" id="4670103">nPixels</span><span class="op" id="4670110">)</span><span class="op" id="4670111">)</span>&nbsp;<span class="op" id="4670113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670117">return</span>&nbsp;<span class="ident" id="4670124">UnsupportedError</span><span class="op" id="4670140">(</span><span class="string" id="4670141">&#34;dimension&nbsp;overflow&#34;</span><span class="op" id="4670161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4670164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670167">d</span><span class="op" id="4670168">.</span><span class="ident" id="4670169">cb</span>&nbsp;<span class="op" id="4670172">=</span>&nbsp;<span class="ident" id="4670174">cbInvalid</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670185">d</span><span class="op" id="4670186">.</span><span class="ident" id="4670187">depth</span>&nbsp;<span class="op" id="4670193">=</span>&nbsp;<span class="builtintype" id="4670195">int</span><span class="op" id="4670198">(</span><span class="ident" id="4670199">d</span><span class="op" id="4670200">.</span><span class="ident" id="4670201">tmp</span><span class="op" id="4670204">[</span><span class="num" id="4670205">8</span><span class="op" id="4670206">]</span><span class="op" id="4670207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670210">switch</span>&nbsp;<span class="ident" id="4670217">d</span><span class="op" id="4670218">.</span><span class="ident" id="4670219">depth</span>&nbsp;<span class="op" id="4670225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670228">case</span>&nbsp;<span class="num" id="4670233">1</span><span class="op" id="4670234">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670238">switch</span>&nbsp;<span class="ident" id="4670245">d</span><span class="op" id="4670246">.</span><span class="ident" id="4670247">tmp</span><span class="op" id="4670250">[</span><span class="num" id="4670251">9</span><span class="op" id="4670252">]</span>&nbsp;<span class="op" id="4670254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670258">case</span>&nbsp;<span class="ident" id="4670263">ctGrayscale</span><span class="op" id="4670274">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670279">d</span><span class="op" id="4670280">.</span><span class="ident" id="4670281">cb</span>&nbsp;<span class="op" id="4670284">=</span>&nbsp;<span class="ident" id="4670286">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670293">case</span>&nbsp;<span class="ident" id="4670298">ctPaletted</span><span class="op" id="4670308">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670313">d</span><span class="op" id="4670314">.</span><span class="ident" id="4670315">cb</span>&nbsp;<span class="op" id="4670318">=</span>&nbsp;<span class="ident" id="4670320">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4670327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670330">case</span>&nbsp;<span class="num" id="4670335">2</span><span class="op" id="4670336">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670340">switch</span>&nbsp;<span class="ident" id="4670347">d</span><span class="op" id="4670348">.</span><span class="ident" id="4670349">tmp</span><span class="op" id="4670352">[</span><span class="num" id="4670353">9</span><span class="op" id="4670354">]</span>&nbsp;<span class="op" id="4670356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670360">case</span>&nbsp;<span class="ident" id="4670365">ctGrayscale</span><span class="op" id="4670376">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670381">d</span><span class="op" id="4670382">.</span><span class="ident" id="4670383">cb</span>&nbsp;<span class="op" id="4670386">=</span>&nbsp;<span class="ident" id="4670388">cbG2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670395">case</span>&nbsp;<span class="ident" id="4670400">ctPaletted</span><span class="op" id="4670410">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670415">d</span><span class="op" id="4670416">.</span><span class="ident" id="4670417">cb</span>&nbsp;<span class="op" id="4670420">=</span>&nbsp;<span class="ident" id="4670422">cbP2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4670429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670432">case</span>&nbsp;<span class="num" id="4670437">4</span><span class="op" id="4670438">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670442">switch</span>&nbsp;<span class="ident" id="4670449">d</span><span class="op" id="4670450">.</span><span class="ident" id="4670451">tmp</span><span class="op" id="4670454">[</span><span class="num" id="4670455">9</span><span class="op" id="4670456">]</span>&nbsp;<span class="op" id="4670458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670462">case</span>&nbsp;<span class="ident" id="4670467">ctGrayscale</span><span class="op" id="4670478">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670483">d</span><span class="op" id="4670484">.</span><span class="ident" id="4670485">cb</span>&nbsp;<span class="op" id="4670488">=</span>&nbsp;<span class="ident" id="4670490">cbG4</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670497">case</span>&nbsp;<span class="ident" id="4670502">ctPaletted</span><span class="op" id="4670512">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670517">d</span><span class="op" id="4670518">.</span><span class="ident" id="4670519">cb</span>&nbsp;<span class="op" id="4670522">=</span>&nbsp;<span class="ident" id="4670524">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4670531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670534">case</span>&nbsp;<span class="num" id="4670539">8</span><span class="op" id="4670540">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670544">switch</span>&nbsp;<span class="ident" id="4670551">d</span><span class="op" id="4670552">.</span><span class="ident" id="4670553">tmp</span><span class="op" id="4670556">[</span><span class="num" id="4670557">9</span><span class="op" id="4670558">]</span>&nbsp;<span class="op" id="4670560">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670564">case</span>&nbsp;<span class="ident" id="4670569">ctGrayscale</span><span class="op" id="4670580">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670585">d</span><span class="op" id="4670586">.</span><span class="ident" id="4670587">cb</span>&nbsp;<span class="op" id="4670590">=</span>&nbsp;<span class="ident" id="4670592">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670599">case</span>&nbsp;<span class="ident" id="4670604">ctTrueColor</span><span class="op" id="4670615">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670620">d</span><span class="op" id="4670621">.</span><span class="ident" id="4670622">cb</span>&nbsp;<span class="op" id="4670625">=</span>&nbsp;<span class="ident" id="4670627">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670635">case</span>&nbsp;<span class="ident" id="4670640">ctPaletted</span><span class="op" id="4670650">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670655">d</span><span class="op" id="4670656">.</span><span class="ident" id="4670657">cb</span>&nbsp;<span class="op" id="4670660">=</span>&nbsp;<span class="ident" id="4670662">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670669">case</span>&nbsp;<span class="ident" id="4670674">ctGrayscaleAlpha</span><span class="op" id="4670690">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670695">d</span><span class="op" id="4670696">.</span><span class="ident" id="4670697">cb</span>&nbsp;<span class="op" id="4670700">=</span>&nbsp;<span class="ident" id="4670702">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670710">case</span>&nbsp;<span class="ident" id="4670715">ctTrueColorAlpha</span><span class="op" id="4670731">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670736">d</span><span class="op" id="4670737">.</span><span class="ident" id="4670738">cb</span>&nbsp;<span class="op" id="4670741">=</span>&nbsp;<span class="ident" id="4670743">cbTCA8</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4670752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670755">case</span>&nbsp;<span class="num" id="4670760">16</span><span class="op" id="4670762">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670766">switch</span>&nbsp;<span class="ident" id="4670773">d</span><span class="op" id="4670774">.</span><span class="ident" id="4670775">tmp</span><span class="op" id="4670778">[</span><span class="num" id="4670779">9</span><span class="op" id="4670780">]</span>&nbsp;<span class="op" id="4670782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670786">case</span>&nbsp;<span class="ident" id="4670791">ctGrayscale</span><span class="op" id="4670802">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670807">d</span><span class="op" id="4670808">.</span><span class="ident" id="4670809">cb</span>&nbsp;<span class="op" id="4670812">=</span>&nbsp;<span class="ident" id="4670814">cbG16</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670822">case</span>&nbsp;<span class="ident" id="4670827">ctTrueColor</span><span class="op" id="4670838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670843">d</span><span class="op" id="4670844">.</span><span class="ident" id="4670845">cb</span>&nbsp;<span class="op" id="4670848">=</span>&nbsp;<span class="ident" id="4670850">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670859">case</span>&nbsp;<span class="ident" id="4670864">ctGrayscaleAlpha</span><span class="op" id="4670880">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670885">d</span><span class="op" id="4670886">.</span><span class="ident" id="4670887">cb</span>&nbsp;<span class="op" id="4670890">=</span>&nbsp;<span class="ident" id="4670892">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670901">case</span>&nbsp;<span class="ident" id="4670906">ctTrueColorAlpha</span><span class="op" id="4670922">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670927">d</span><span class="op" id="4670928">.</span><span class="ident" id="4670929">cb</span>&nbsp;<span class="op" id="4670932">=</span>&nbsp;<span class="ident" id="4670934">cbTCA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4670944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4670947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670950">if</span>&nbsp;<span class="ident" id="4670953">d</span><span class="op" id="4670954">.</span><span class="ident" id="4670955">cb</span>&nbsp;<span class="op" id="4670958">==</span>&nbsp;<span class="ident" id="4670961">cbInvalid</span>&nbsp;<span class="op" id="4670971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670975">return</span>&nbsp;<span class="ident" id="4670982">UnsupportedError</span><span class="op" id="4670998">(</span><span class="ident" id="4670999">fmt</span><span class="op" id="4671002">.</span><span class="ident" id="4671003">Sprintf</span><span class="op" id="4671010">(</span><span class="string" id="4671011">&#34;bit&nbsp;depth&nbsp;%d,&nbsp;color&nbsp;type&nbsp;%d&#34;</span><span class="op" id="4671040">,</span>&nbsp;<span class="ident" id="4671042">d</span><span class="op" id="4671043">.</span><span class="ident" id="4671044">tmp</span><span class="op" id="4671047">[</span><span class="num" id="4671048">8</span><span class="op" id="4671049">]</span><span class="op" id="4671050">,</span>&nbsp;<span class="ident" id="4671052">d</span><span class="op" id="4671053">.</span><span class="ident" id="4671054">tmp</span><span class="op" id="4671057">[</span><span class="num" id="4671058">9</span><span class="op" id="4671059">]</span><span class="op" id="4671060">)</span><span class="op" id="4671061">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4671064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671067">d</span><span class="op" id="4671068">.</span><span class="ident" id="4671069">width</span><span class="op" id="4671074">,</span>&nbsp;<span class="ident" id="4671076">d</span><span class="op" id="4671077">.</span><span class="ident" id="4671078">height</span>&nbsp;<span class="op" id="4671085">=</span>&nbsp;<span class="builtintype" id="4671087">int</span><span class="op" id="4671090">(</span><span class="ident" id="4671091">w</span><span class="op" id="4671092">)</span><span class="op" id="4671093">,</span>&nbsp;<span class="builtintype" id="4671095">int</span><span class="op" id="4671098">(</span><span class="ident" id="4671099">h</span><span class="op" id="4671100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671103">return</span>&nbsp;<span class="ident" id="4671110">d</span><span class="op" id="4671111">.</span><span class="ident" id="4671112">verifyChecksum</span><span class="op" id="4671126">(</span><span class="op" id="4671127">)</span><br>
<span class="lineno"></span><span class="op" id="4671129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="4671132">func</span>&nbsp;<span class="op" id="4671137">(</span><span class="ident" id="4671138">d</span>&nbsp;<span class="op" id="4671140">*</span><span class="ident" id="4671141">decoder</span><span class="op" id="4671148">)</span>&nbsp;<span class="ident" id="4671150">parsePLTE</span><span class="op" id="4671159">(</span><span class="ident" id="4671160">length</span>&nbsp;<span class="builtintype" id="4671167">uint32</span><span class="op" id="4671173">)</span>&nbsp;<span class="builtintype" id="4671175">error</span>&nbsp;<span class="op" id="4671181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671184">np</span>&nbsp;<span class="op" id="4671187">:=</span>&nbsp;<span class="builtintype" id="4671190">int</span><span class="op" id="4671193">(</span><span class="ident" id="4671194">length</span>&nbsp;<span class="op" id="4671201">/</span>&nbsp;<span class="num" id="4671203">3</span><span class="op" id="4671204">)</span>&nbsp;<span class="comment" id="4671206">//&nbsp;The&nbsp;number&nbsp;of&nbsp;palette&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671241">if</span>&nbsp;<span class="ident" id="4671244">length</span><span class="op" id="4671250">%</span><span class="num" id="4671251">3</span>&nbsp;<span class="op" id="4671253">!=</span>&nbsp;<span class="num" id="4671256">0</span>&nbsp;<span class="op" id="4671258">||</span>&nbsp;<span class="ident" id="4671261">np</span>&nbsp;<span class="op" id="4671264">&lt;=</span>&nbsp;<span class="num" id="4671267">0</span>&nbsp;<span class="op" id="4671269">||</span>&nbsp;<span class="ident" id="4671272">np</span>&nbsp;<span class="op" id="4671275">&gt;</span>&nbsp;<span class="num" id="4671277">256</span>&nbsp;<span class="op" id="4671281">||</span>&nbsp;<span class="ident" id="4671284">np</span>&nbsp;<span class="op" id="4671287">&gt;</span>&nbsp;<span class="num" id="4671289">1</span><span class="op" id="4671290">&lt;&lt;</span><span class="builtintype" id="4671292">uint</span><span class="op" id="4671296">(</span><span class="ident" id="4671297">d</span><span class="op" id="4671298">.</span><span class="ident" id="4671299">depth</span><span class="op" id="4671304">)</span>&nbsp;<span class="op" id="4671306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671310">return</span>&nbsp;<span class="ident" id="4671317">FormatError</span><span class="op" id="4671328">(</span><span class="string" id="4671329">&#34;bad&nbsp;PLTE&nbsp;length&#34;</span><span class="op" id="4671346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4671349">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671352">n</span><span class="op" id="4671353">,</span>&nbsp;<span class="ident" id="4671355">err</span>&nbsp;<span class="op" id="4671359">:=</span>&nbsp;<span class="ident" id="4671362">io</span><span class="op" id="4671364">.</span><span class="ident" id="4671365">ReadFull</span><span class="op" id="4671373">(</span><span class="ident" id="4671374">d</span><span class="op" id="4671375">.</span><span class="ident" id="4671376">r</span><span class="op" id="4671377">,</span>&nbsp;<span class="ident" id="4671379">d</span><span class="op" id="4671380">.</span><span class="ident" id="4671381">tmp</span><span class="op" id="4671384">[</span><span class="op" id="4671385">:</span><span class="num" id="4671386">3</span><span class="op" id="4671387">*</span><span class="ident" id="4671388">np</span><span class="op" id="4671390">]</span><span class="op" id="4671391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671394">if</span>&nbsp;<span class="ident" id="4671397">err</span>&nbsp;<span class="op" id="4671401">!=</span>&nbsp;<span class="ident" id="4671404">nil</span>&nbsp;<span class="op" id="4671408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671412">return</span>&nbsp;<span class="ident" id="4671419">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4671424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671427">d</span><span class="op" id="4671428">.</span><span class="ident" id="4671429">crc</span><span class="op" id="4671432">.</span><span class="ident" id="4671433">Write</span><span class="op" id="4671438">(</span><span class="ident" id="4671439">d</span><span class="op" id="4671440">.</span><span class="ident" id="4671441">tmp</span><span class="op" id="4671444">[</span><span class="op" id="4671445">:</span><span class="ident" id="4671446">n</span><span class="op" id="4671447">]</span><span class="op" id="4671448">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671451">switch</span>&nbsp;<span class="ident" id="4671458">d</span><span class="op" id="4671459">.</span><span class="ident" id="4671460">cb</span>&nbsp;<span class="op" id="4671463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671466">case</span>&nbsp;<span class="ident" id="4671471">cbP1</span><span class="op" id="4671475">,</span>&nbsp;<span class="ident" id="4671477">cbP2</span><span class="op" id="4671481">,</span>&nbsp;<span class="ident" id="4671483">cbP4</span><span class="op" id="4671487">,</span>&nbsp;<span class="ident" id="4671489">cbP8</span><span class="op" id="4671493">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671497">d</span><span class="op" id="4671498">.</span><span class="ident" id="4671499">palette</span>&nbsp;<span class="op" id="4671507">=</span>&nbsp;<span class="builtinfunc" id="4671509">make</span><span class="op" id="4671513">(</span><span class="ident" id="4671514">color</span><span class="op" id="4671519">.</span><span class="ident" id="4671520">Palette</span><span class="op" id="4671527">,</span>&nbsp;<span class="num" id="4671529">256</span><span class="op" id="4671532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671536">for</span>&nbsp;<span class="ident" id="4671540">i</span>&nbsp;<span class="op" id="4671542">:=</span>&nbsp;<span class="num" id="4671545">0</span><span class="op" id="4671546">;</span>&nbsp;<span class="ident" id="4671548">i</span>&nbsp;<span class="op" id="4671550">&lt;</span>&nbsp;<span class="ident" id="4671552">np</span><span class="op" id="4671554">;</span>&nbsp;<span class="ident" id="4671556">i</span><span class="op" id="4671557">++</span>&nbsp;<span class="op" id="4671560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671565">d</span><span class="op" id="4671566">.</span><span class="ident" id="4671567">palette</span><span class="op" id="4671574">[</span><span class="ident" id="4671575">i</span><span class="op" id="4671576">]</span>&nbsp;<span class="op" id="4671578">=</span>&nbsp;<span class="ident" id="4671580">color</span><span class="op" id="4671585">.</span><span class="ident" id="4671586">RGBA</span><span class="op" id="4671590">{</span><span class="ident" id="4671591">d</span><span class="op" id="4671592">.</span><span class="ident" id="4671593">tmp</span><span class="op" id="4671596">[</span><span class="num" id="4671597">3</span><span class="op" id="4671598">*</span><span class="ident" id="4671599">i</span><span class="op" id="4671600">+</span><span class="num" id="4671601">0</span><span class="op" id="4671602">]</span><span class="op" id="4671603">,</span>&nbsp;<span class="ident" id="4671605">d</span><span class="op" id="4671606">.</span><span class="ident" id="4671607">tmp</span><span class="op" id="4671610">[</span><span class="num" id="4671611">3</span><span class="op" id="4671612">*</span><span class="ident" id="4671613">i</span><span class="op" id="4671614">+</span><span class="num" id="4671615">1</span><span class="op" id="4671616">]</span><span class="op" id="4671617">,</span>&nbsp;<span class="ident" id="4671619">d</span><span class="op" id="4671620">.</span><span class="ident" id="4671621">tmp</span><span class="op" id="4671624">[</span><span class="num" id="4671625">3</span><span class="op" id="4671626">*</span><span class="ident" id="4671627">i</span><span class="op" id="4671628">+</span><span class="num" id="4671629">2</span><span class="op" id="4671630">]</span><span class="op" id="4671631">,</span>&nbsp;<span class="num" id="4671633">0xff</span><span class="op" id="4671637">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4671641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671645">for</span>&nbsp;<span class="ident" id="4671649">i</span>&nbsp;<span class="op" id="4671651">:=</span>&nbsp;<span class="ident" id="4671654">np</span><span class="op" id="4671656">;</span>&nbsp;<span class="ident" id="4671658">i</span>&nbsp;<span class="op" id="4671660">&lt;</span>&nbsp;<span class="num" id="4671662">256</span><span class="op" id="4671665">;</span>&nbsp;<span class="ident" id="4671667">i</span><span class="op" id="4671668">++</span>&nbsp;<span class="op" id="4671671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4671676">//&nbsp;Initialize&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;palette&nbsp;to&nbsp;opaque&nbsp;black.&nbsp;The&nbsp;spec&nbsp;(section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4671752">//&nbsp;11.2.3)&nbsp;says&nbsp;that&nbsp;&#34;any&nbsp;out-of-range&nbsp;pixel&nbsp;value&nbsp;found&nbsp;in&nbsp;the&nbsp;image&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4671830">//&nbsp;is&nbsp;an&nbsp;error&#34;,&nbsp;but&nbsp;some&nbsp;real-world&nbsp;PNG&nbsp;files&nbsp;have&nbsp;out-of-range&nbsp;pixel</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4671904">//&nbsp;values.&nbsp;We&nbsp;fall&nbsp;back&nbsp;to&nbsp;opaque&nbsp;black,&nbsp;the&nbsp;same&nbsp;as&nbsp;libpng&nbsp;1.5.13;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4671975">//&nbsp;ImageMagick&nbsp;6.5.7&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4672017">d</span><span class="op" id="4672018">.</span><span class="ident" id="4672019">palette</span><span class="op" id="4672026">[</span><span class="ident" id="4672027">i</span><span class="op" id="4672028">]</span>&nbsp;<span class="op" id="4672030">=</span>&nbsp;<span class="ident" id="4672032">color</span><span class="op" id="4672037">.</span><span class="ident" id="4672038">RGBA</span><span class="op" id="4672042">{</span><span class="num" id="4672043">0x00</span><span class="op" id="4672047">,</span>&nbsp;<span class="num" id="4672049">0x00</span><span class="op" id="4672053">,</span>&nbsp;<span class="num" id="4672055">0x00</span><span class="op" id="4672059">,</span>&nbsp;<span class="num" id="4672061">0xff</span><span class="op" id="4672065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4672069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4672073">d</span><span class="op" id="4672074">.</span><span class="ident" id="4672075">palette</span>&nbsp;<span class="op" id="4672083">=</span>&nbsp;<span class="ident" id="4672085">d</span><span class="op" id="4672086">.</span><span class="ident" id="4672087">palette</span><span class="op" id="4672094">[</span><span class="op" id="4672095">:</span><span class="ident" id="4672096">np</span><span class="op" id="4672098">]</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4672101">case</span>&nbsp;<span class="ident" id="4672106">cbTC8</span><span class="op" id="4672111">,</span>&nbsp;<span class="ident" id="4672113">cbTCA8</span><span class="op" id="4672119">,</span>&nbsp;<span class="ident" id="4672121">cbTC16</span><span class="op" id="4672127">,</span>&nbsp;<span class="ident" id="4672129">cbTCA16</span><span class="op" id="4672136">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4672140">//&nbsp;As&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec,&nbsp;a&nbsp;PLTE&nbsp;chunk&nbsp;is&nbsp;optional&nbsp;(and&nbsp;for&nbsp;practical&nbsp;purposes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4672220">//&nbsp;ignorable)&nbsp;for&nbsp;the&nbsp;ctTrueColor&nbsp;and&nbsp;ctTrueColorAlpha&nbsp;color&nbsp;types&nbsp;(section&nbsp;4.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4672305">default</span><span class="op" id="4672312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4672316">return</span>&nbsp;<span class="ident" id="4672323">FormatError</span><span class="op" id="4672334">(</span><span class="string" id="4672335">&#34;PLTE,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="4672362">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4672365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4672368">return</span>&nbsp;<span class="ident" id="4672375">d</span><span class="op" id="4672376">.</span><span class="ident" id="4672377">verifyChecksum</span><span class="op" id="4672391">(</span><span class="op" id="4672392">)</span><br>
<span class="lineno"></span><span class="op" id="4672394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4672397">func</span>&nbsp;<span class="op" id="4672402">(</span><span class="ident" id="4672403">d</span>&nbsp;<span class="op" id="4672405">*</span><span class="ident" id="4672406">decoder</span><span class="op" id="4672413">)</span>&nbsp;<span class="ident" id="4672415">parsetRNS</span><span class="op" id="4672424">(</span><span class="ident" id="4672425">length</span>&nbsp;<span class="builtintype" id="4672432">uint32</span><span class="op" id="4672438">)</span>&nbsp;<span class="builtintype" id="4672440">error</span>&nbsp;<span class="op" id="4672446">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4672449">if</span>&nbsp;<span class="ident" id="4672452">length</span>&nbsp;<span class="op" id="4672459">&gt;</span>&nbsp;<span class="num" id="4672461">256</span>&nbsp;<span class="op" id="4672465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4672469">return</span>&nbsp;<span class="ident" id="4672476">FormatError</span><span class="op" id="4672487">(</span><span class="string" id="4672488">&#34;bad&nbsp;tRNS&nbsp;length&#34;</span><span class="op" id="4672505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4672508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4672511">n</span><span class="op" id="4672512">,</span>&nbsp;<span class="ident" id="4672514">err</span>&nbsp;<span class="op" id="4672518">:=</span>&nbsp;<span class="ident" id="4672521">io</span><span class="op" id="4672523">.</span><span class="ident" id="4672524">ReadFull</span><span class="op" id="4672532">(</span><span class="ident" id="4672533">d</span><span class="op" id="4672534">.</span><span class="ident" id="4672535">r</span><span class="op" id="4672536">,</span>&nbsp;<span class="ident" id="4672538">d</span><span class="op" id="4672539">.</span><span class="ident" id="4672540">tmp</span><span class="op" id="4672543">[</span><span class="op" id="4672544">:</span><span class="ident" id="4672545">length</span><span class="op" id="4672551">]</span><span class="op" id="4672552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4672555">if</span>&nbsp;<span class="ident" id="4672558">err</span>&nbsp;<span class="op" id="4672562">!=</span>&nbsp;<span class="ident" id="4672565">nil</span>&nbsp;<span class="op" id="4672569">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4672573">return</span>&nbsp;<span class="ident" id="4672580">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4672585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4672588">d</span><span class="op" id="4672589">.</span><span class="ident" id="4672590">crc</span><span class="op" id="4672593">.</span><span class="ident" id="4672594">Write</span><span class="op" id="4672599">(</span><span class="ident" id="4672600">d</span><span class="op" id="4672601">.</span><span class="ident" id="4672602">tmp</span><span class="op" id="4672605">[</span><span class="op" id="4672606">:</span><span class="ident" id="4672607">n</span><span class="op" id="4672608">]</span><span class="op" id="4672609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4672612">switch</span>&nbsp;<span class="ident" id="4672619">d</span><span class="op" id="4672620">.</span><span class="ident" id="4672621">cb</span>&nbsp;<span class="op" id="4672624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4672627">case</span>&nbsp;<span class="ident" id="4672632">cbG8</span><span class="op" id="4672636">,</span>&nbsp;<span class="ident" id="4672638">cbG16</span><span class="op" id="4672643">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4672647">return</span>&nbsp;<span class="ident" id="4672654">UnsupportedError</span><span class="op" id="4672670">(</span><span class="string" id="4672671">&#34;grayscale&nbsp;transparency&#34;</span><span class="op" id="4672695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4672698">case</span>&nbsp;<span class="ident" id="4672703">cbTC8</span><span class="op" id="4672708">,</span>&nbsp;<span class="ident" id="4672710">cbTC16</span><span class="op" id="4672716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4672720">return</span>&nbsp;<span class="ident" id="4672727">UnsupportedError</span><span class="op" id="4672743">(</span><span class="string" id="4672744">&#34;truecolor&nbsp;transparency&#34;</span><span class="op" id="4672768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4672771">case</span>&nbsp;<span class="ident" id="4672776">cbP1</span><span class="op" id="4672780">,</span>&nbsp;<span class="ident" id="4672782">cbP2</span><span class="op" id="4672786">,</span>&nbsp;<span class="ident" id="4672788">cbP4</span><span class="op" id="4672792">,</span>&nbsp;<span class="ident" id="4672794">cbP8</span><span class="op" id="4672798">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4672802">if</span>&nbsp;<span class="builtinfunc" id="4672805">len</span><span class="op" id="4672808">(</span><span class="ident" id="4672809">d</span><span class="op" id="4672810">.</span><span class="ident" id="4672811">palette</span><span class="op" id="4672818">)</span>&nbsp;<span class="op" id="4672820">&lt;</span>&nbsp;<span class="ident" id="4672822">n</span>&nbsp;<span class="op" id="4672824">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4672829">d</span><span class="op" id="4672830">.</span><span class="ident" id="4672831">palette</span>&nbsp;<span class="op" id="4672839">=</span>&nbsp;<span class="ident" id="4672841">d</span><span class="op" id="4672842">.</span><span class="ident" id="4672843">palette</span><span class="op" id="4672850">[</span><span class="op" id="4672851">:</span><span class="ident" id="4672852">n</span><span class="op" id="4672853">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4672857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4672861">for</span>&nbsp;<span class="ident" id="4672865">i</span>&nbsp;<span class="op" id="4672867">:=</span>&nbsp;<span class="num" id="4672870">0</span><span class="op" id="4672871">;</span>&nbsp;<span class="ident" id="4672873">i</span>&nbsp;<span class="op" id="4672875">&lt;</span>&nbsp;<span class="ident" id="4672877">n</span><span class="op" id="4672878">;</span>&nbsp;<span class="ident" id="4672880">i</span><span class="op" id="4672881">++</span>&nbsp;<span class="op" id="4672884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4672889">rgba</span>&nbsp;<span class="op" id="4672894">:=</span>&nbsp;<span class="ident" id="4672897">d</span><span class="op" id="4672898">.</span><span class="ident" id="4672899">palette</span><span class="op" id="4672906">[</span><span class="ident" id="4672907">i</span><span class="op" id="4672908">]</span><span class="op" id="4672909">.</span><span class="op" id="4672910">(</span><span class="ident" id="4672911">color</span><span class="op" id="4672916">.</span><span class="ident" id="4672917">RGBA</span><span class="op" id="4672921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4672926">d</span><span class="op" id="4672927">.</span><span class="ident" id="4672928">palette</span><span class="op" id="4672935">[</span><span class="ident" id="4672936">i</span><span class="op" id="4672937">]</span>&nbsp;<span class="op" id="4672939">=</span>&nbsp;<span class="ident" id="4672941">color</span><span class="op" id="4672946">.</span><span class="ident" id="4672947">NRGBA</span><span class="op" id="4672952">{</span><span class="ident" id="4672953">rgba</span><span class="op" id="4672957">.</span><span class="ident" id="4672958">R</span><span class="op" id="4672959">,</span>&nbsp;<span class="ident" id="4672961">rgba</span><span class="op" id="4672965">.</span><span class="ident" id="4672966">G</span><span class="op" id="4672967">,</span>&nbsp;<span class="ident" id="4672969">rgba</span><span class="op" id="4672973">.</span><span class="ident" id="4672974">B</span><span class="op" id="4672975">,</span>&nbsp;<span class="ident" id="4672977">d</span><span class="op" id="4672978">.</span><span class="ident" id="4672979">tmp</span><span class="op" id="4672982">[</span><span class="ident" id="4672983">i</span><span class="op" id="4672984">]</span><span class="op" id="4672985">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4672989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4672992">case</span>&nbsp;<span class="ident" id="4672997">cbGA8</span><span class="op" id="4673002">,</span>&nbsp;<span class="ident" id="4673004">cbGA16</span><span class="op" id="4673010">,</span>&nbsp;<span class="ident" id="4673012">cbTCA8</span><span class="op" id="4673018">,</span>&nbsp;<span class="ident" id="4673020">cbTCA16</span><span class="op" id="4673027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4673031">return</span>&nbsp;<span class="ident" id="4673038">FormatError</span><span class="op" id="4673049">(</span><span class="string" id="4673050">&#34;tRNS,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="4673077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4673080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4673083">return</span>&nbsp;<span class="ident" id="4673090">d</span><span class="op" id="4673091">.</span><span class="ident" id="4673092">verifyChecksum</span><span class="op" id="4673106">(</span><span class="op" id="4673107">)</span><br>
<span class="lineno">275</span><span class="op" id="4673109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4673112">//&nbsp;Read&nbsp;presents&nbsp;one&nbsp;or&nbsp;more&nbsp;IDAT&nbsp;chunks&nbsp;as&nbsp;one&nbsp;continuous&nbsp;stream&nbsp;(minus&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4673189">//&nbsp;intermediate&nbsp;chunk&nbsp;headers&nbsp;and&nbsp;footers).&nbsp;If&nbsp;the&nbsp;PNG&nbsp;data&nbsp;looked&nbsp;like:</span><br>
<span class="lineno"></span><span class="comment" id="4673262">//&nbsp;&nbsp;&nbsp;...&nbsp;len0&nbsp;IDAT&nbsp;xxx&nbsp;crc0&nbsp;len1&nbsp;IDAT&nbsp;yy&nbsp;crc1&nbsp;len2&nbsp;IEND&nbsp;crc2</span><br>
<span class="lineno">280</span><span class="comment" id="4673323">//&nbsp;then&nbsp;this&nbsp;reader&nbsp;presents&nbsp;xxxyy.&nbsp;For&nbsp;well-formed&nbsp;PNG&nbsp;data,&nbsp;the&nbsp;decoder&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="4673403">//&nbsp;immediately&nbsp;before&nbsp;the&nbsp;first&nbsp;Read&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4673483">//&nbsp;first&nbsp;IDAT&nbsp;and&nbsp;xxx,&nbsp;and&nbsp;the&nbsp;decoder&nbsp;state&nbsp;immediately&nbsp;after&nbsp;the&nbsp;last&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="4673560">//&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;yy&nbsp;and&nbsp;crc1.</span><br>
<span class="lineno"></span><span class="keyword" id="4673615">func</span>&nbsp;<span class="op" id="4673620">(</span><span class="ident" id="4673621">d</span>&nbsp;<span class="op" id="4673623">*</span><span class="ident" id="4673624">decoder</span><span class="op" id="4673631">)</span>&nbsp;<span class="ident" id="4673633">Read</span><span class="op" id="4673637">(</span><span class="ident" id="4673638">p</span>&nbsp;<span class="op" id="4673640">[</span><span class="op" id="4673641">]</span><span class="builtintype" id="4673642">byte</span><span class="op" id="4673646">)</span>&nbsp;<span class="op" id="4673648">(</span><span class="builtintype" id="4673649">int</span><span class="op" id="4673652">,</span>&nbsp;<span class="builtintype" id="4673654">error</span><span class="op" id="4673659">)</span>&nbsp;<span class="op" id="4673661">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4673664">if</span>&nbsp;<span class="builtinfunc" id="4673667">len</span><span class="op" id="4673670">(</span><span class="ident" id="4673671">p</span><span class="op" id="4673672">)</span>&nbsp;<span class="op" id="4673674">==</span>&nbsp;<span class="num" id="4673677">0</span>&nbsp;<span class="op" id="4673679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4673683">return</span>&nbsp;<span class="num" id="4673690">0</span><span class="op" id="4673691">,</span>&nbsp;<span class="ident" id="4673693">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4673698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4673701">for</span>&nbsp;<span class="ident" id="4673705">d</span><span class="op" id="4673706">.</span><span class="ident" id="4673707">idatLength</span>&nbsp;<span class="op" id="4673718">==</span>&nbsp;<span class="num" id="4673721">0</span>&nbsp;<span class="op" id="4673723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4673727">//&nbsp;We&nbsp;have&nbsp;exhausted&nbsp;an&nbsp;IDAT&nbsp;chunk.&nbsp;Verify&nbsp;the&nbsp;checksum&nbsp;of&nbsp;that&nbsp;chunk.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4673800">if</span>&nbsp;<span class="ident" id="4673803">err</span>&nbsp;<span class="op" id="4673807">:=</span>&nbsp;<span class="ident" id="4673810">d</span><span class="op" id="4673811">.</span><span class="ident" id="4673812">verifyChecksum</span><span class="op" id="4673826">(</span><span class="op" id="4673827">)</span><span class="op" id="4673828">;</span>&nbsp;<span class="ident" id="4673830">err</span>&nbsp;<span class="op" id="4673834">!=</span>&nbsp;<span class="ident" id="4673837">nil</span>&nbsp;<span class="op" id="4673841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4673846">return</span>&nbsp;<span class="num" id="4673853">0</span><span class="op" id="4673854">,</span>&nbsp;<span class="ident" id="4673856">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4673862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4673866">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type&nbsp;of&nbsp;the&nbsp;next&nbsp;chunk,&nbsp;and&nbsp;check&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4673936">//&nbsp;it&nbsp;is&nbsp;an&nbsp;IDAT&nbsp;chunk.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4673962">if</span>&nbsp;<span class="ident" id="4673965">_</span><span class="op" id="4673966">,</span>&nbsp;<span class="ident" id="4673968">err</span>&nbsp;<span class="op" id="4673972">:=</span>&nbsp;<span class="ident" id="4673975">io</span><span class="op" id="4673977">.</span><span class="ident" id="4673978">ReadFull</span><span class="op" id="4673986">(</span><span class="ident" id="4673987">d</span><span class="op" id="4673988">.</span><span class="ident" id="4673989">r</span><span class="op" id="4673990">,</span>&nbsp;<span class="ident" id="4673992">d</span><span class="op" id="4673993">.</span><span class="ident" id="4673994">tmp</span><span class="op" id="4673997">[</span><span class="op" id="4673998">:</span><span class="num" id="4673999">8</span><span class="op" id="4674000">]</span><span class="op" id="4674001">)</span><span class="op" id="4674002">;</span>&nbsp;<span class="ident" id="4674004">err</span>&nbsp;<span class="op" id="4674008">!=</span>&nbsp;<span class="ident" id="4674011">nil</span>&nbsp;<span class="op" id="4674015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4674020">return</span>&nbsp;<span class="num" id="4674027">0</span><span class="op" id="4674028">,</span>&nbsp;<span class="ident" id="4674030">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4674036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4674040">d</span><span class="op" id="4674041">.</span><span class="ident" id="4674042">idatLength</span>&nbsp;<span class="op" id="4674053">=</span>&nbsp;<span class="ident" id="4674055">binary</span><span class="op" id="4674061">.</span><span class="ident" id="4674062">BigEndian</span><span class="op" id="4674071">.</span><span class="ident" id="4674072">Uint32</span><span class="op" id="4674078">(</span><span class="ident" id="4674079">d</span><span class="op" id="4674080">.</span><span class="ident" id="4674081">tmp</span><span class="op" id="4674084">[</span><span class="op" id="4674085">:</span><span class="num" id="4674086">4</span><span class="op" id="4674087">]</span><span class="op" id="4674088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4674092">if</span>&nbsp;<span class="builtintype" id="4674095">string</span><span class="op" id="4674101">(</span><span class="ident" id="4674102">d</span><span class="op" id="4674103">.</span><span class="ident" id="4674104">tmp</span><span class="op" id="4674107">[</span><span class="num" id="4674108">4</span><span class="op" id="4674109">:</span><span class="num" id="4674110">8</span><span class="op" id="4674111">]</span><span class="op" id="4674112">)</span>&nbsp;<span class="op" id="4674114">!=</span>&nbsp;<span class="string" id="4674117">&#34;IDAT&#34;</span>&nbsp;<span class="op" id="4674124">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4674129">return</span>&nbsp;<span class="num" id="4674136">0</span><span class="op" id="4674137">,</span>&nbsp;<span class="ident" id="4674139">FormatError</span><span class="op" id="4674150">(</span><span class="string" id="4674151">&#34;not&nbsp;enough&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="4674174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4674178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4674182">d</span><span class="op" id="4674183">.</span><span class="ident" id="4674184">crc</span><span class="op" id="4674187">.</span><span class="ident" id="4674188">Reset</span><span class="op" id="4674193">(</span><span class="op" id="4674194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4674198">d</span><span class="op" id="4674199">.</span><span class="ident" id="4674200">crc</span><span class="op" id="4674203">.</span><span class="ident" id="4674204">Write</span><span class="op" id="4674209">(</span><span class="ident" id="4674210">d</span><span class="op" id="4674211">.</span><span class="ident" id="4674212">tmp</span><span class="op" id="4674215">[</span><span class="num" id="4674216">4</span><span class="op" id="4674217">:</span><span class="num" id="4674218">8</span><span class="op" id="4674219">]</span><span class="op" id="4674220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4674223">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4674226">if</span>&nbsp;<span class="builtintype" id="4674229">int</span><span class="op" id="4674232">(</span><span class="ident" id="4674233">d</span><span class="op" id="4674234">.</span><span class="ident" id="4674235">idatLength</span><span class="op" id="4674245">)</span>&nbsp;<span class="op" id="4674247">&lt;</span>&nbsp;<span class="num" id="4674249">0</span>&nbsp;<span class="op" id="4674251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4674255">return</span>&nbsp;<span class="num" id="4674262">0</span><span class="op" id="4674263">,</span>&nbsp;<span class="ident" id="4674265">UnsupportedError</span><span class="op" id="4674281">(</span><span class="string" id="4674282">&#34;IDAT&nbsp;chunk&nbsp;length&nbsp;overflow&#34;</span><span class="op" id="4674310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4674313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4674316">n</span><span class="op" id="4674317">,</span>&nbsp;<span class="ident" id="4674319">err</span>&nbsp;<span class="op" id="4674323">:=</span>&nbsp;<span class="ident" id="4674326">d</span><span class="op" id="4674327">.</span><span class="ident" id="4674328">r</span><span class="op" id="4674329">.</span><span class="ident" id="4674330">Read</span><span class="op" id="4674334">(</span><span class="ident" id="4674335">p</span><span class="op" id="4674336">[</span><span class="op" id="4674337">:</span><span class="ident" id="4674338">min</span><span class="op" id="4674341">(</span><span class="builtinfunc" id="4674342">len</span><span class="op" id="4674345">(</span><span class="ident" id="4674346">p</span><span class="op" id="4674347">)</span><span class="op" id="4674348">,</span>&nbsp;<span class="builtintype" id="4674350">int</span><span class="op" id="4674353">(</span><span class="ident" id="4674354">d</span><span class="op" id="4674355">.</span><span class="ident" id="4674356">idatLength</span><span class="op" id="4674366">)</span><span class="op" id="4674367">)</span><span class="op" id="4674368">]</span><span class="op" id="4674369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4674372">d</span><span class="op" id="4674373">.</span><span class="ident" id="4674374">crc</span><span class="op" id="4674377">.</span><span class="ident" id="4674378">Write</span><span class="op" id="4674383">(</span><span class="ident" id="4674384">p</span><span class="op" id="4674385">[</span><span class="op" id="4674386">:</span><span class="ident" id="4674387">n</span><span class="op" id="4674388">]</span><span class="op" id="4674389">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4674392">d</span><span class="op" id="4674393">.</span><span class="ident" id="4674394">idatLength</span>&nbsp;<span class="op" id="4674405">-=</span>&nbsp;<span class="builtintype" id="4674408">uint32</span><span class="op" id="4674414">(</span><span class="ident" id="4674415">n</span><span class="op" id="4674416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4674419">return</span>&nbsp;<span class="ident" id="4674426">n</span><span class="op" id="4674427">,</span>&nbsp;<span class="ident" id="4674429">err</span><br>
<span class="lineno"></span><span class="op" id="4674433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4674436">//&nbsp;decode&nbsp;decodes&nbsp;the&nbsp;IDAT&nbsp;data&nbsp;into&nbsp;an&nbsp;image.</span><br>
<span class="lineno">315</span><span class="keyword" id="4674483">func</span>&nbsp;<span class="op" id="4674488">(</span><span class="ident" id="4674489">d</span>&nbsp;<span class="op" id="4674491">*</span><span class="ident" id="4674492">decoder</span><span class="op" id="4674499">)</span>&nbsp;<span class="ident" id="4674501">decode</span><span class="op" id="4674507">(</span><span class="op" id="4674508">)</span>&nbsp;<span class="op" id="4674510">(</span><span class="ident" id="4674511">image</span><span class="op" id="4674516">.</span><span class="ident" id="4674517">Image</span><span class="op" id="4674522">,</span>&nbsp;<span class="builtintype" id="4674524">error</span><span class="op" id="4674529">)</span>&nbsp;<span class="op" id="4674531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4674534">r</span><span class="op" id="4674535">,</span>&nbsp;<span class="ident" id="4674537">err</span>&nbsp;<span class="op" id="4674541">:=</span>&nbsp;<span class="ident" id="4674544">zlib</span><span class="op" id="4674548">.</span><span class="ident" id="4674549">NewReader</span><span class="op" id="4674558">(</span><span class="ident" id="4674559">d</span><span class="op" id="4674560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4674563">if</span>&nbsp;<span class="ident" id="4674566">err</span>&nbsp;<span class="op" id="4674570">!=</span>&nbsp;<span class="ident" id="4674573">nil</span>&nbsp;<span class="op" id="4674577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4674581">return</span>&nbsp;<span class="ident" id="4674588">nil</span><span class="op" id="4674591">,</span>&nbsp;<span class="ident" id="4674593">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4674598">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4674601">defer</span>&nbsp;<span class="ident" id="4674607">r</span><span class="op" id="4674608">.</span><span class="ident" id="4674609">Close</span><span class="op" id="4674614">(</span><span class="op" id="4674615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4674618">var</span>&nbsp;<span class="ident" id="4674622">img</span>&nbsp;<span class="ident" id="4674626">image</span><span class="op" id="4674631">.</span><span class="ident" id="4674632">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4674639">if</span>&nbsp;<span class="ident" id="4674642">d</span><span class="op" id="4674643">.</span><span class="ident" id="4674644">interlace</span>&nbsp;<span class="op" id="4674654">==</span>&nbsp;<span class="ident" id="4674657">itNone</span>&nbsp;<span class="op" id="4674664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4674668">img</span><span class="op" id="4674671">,</span>&nbsp;<span class="ident" id="4674673">err</span>&nbsp;<span class="op" id="4674677">=</span>&nbsp;<span class="ident" id="4674679">d</span><span class="op" id="4674680">.</span><span class="ident" id="4674681">readImagePass</span><span class="op" id="4674694">(</span><span class="ident" id="4674695">r</span><span class="op" id="4674696">,</span>&nbsp;<span class="num" id="4674698">0</span><span class="op" id="4674699">,</span>&nbsp;<span class="builtintype" id="4674701">false</span><span class="op" id="4674706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4674709">}</span>&nbsp;<span class="keyword" id="4674711">else</span>&nbsp;<span class="keyword" id="4674716">if</span>&nbsp;<span class="ident" id="4674719">d</span><span class="op" id="4674720">.</span><span class="ident" id="4674721">interlace</span>&nbsp;<span class="op" id="4674731">==</span>&nbsp;<span class="ident" id="4674734">itAdam7</span>&nbsp;<span class="op" id="4674742">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4674746">//&nbsp;Allocate&nbsp;a&nbsp;blank&nbsp;image&nbsp;of&nbsp;the&nbsp;full&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4674792">img</span><span class="op" id="4674795">,</span>&nbsp;<span class="ident" id="4674797">err</span>&nbsp;<span class="op" id="4674801">=</span>&nbsp;<span class="ident" id="4674803">d</span><span class="op" id="4674804">.</span><span class="ident" id="4674805">readImagePass</span><span class="op" id="4674818">(</span><span class="ident" id="4674819">nil</span><span class="op" id="4674822">,</span>&nbsp;<span class="num" id="4674824">0</span><span class="op" id="4674825">,</span>&nbsp;<span class="builtintype" id="4674827">true</span><span class="op" id="4674831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4674835">for</span>&nbsp;<span class="ident" id="4674839">pass</span>&nbsp;<span class="op" id="4674844">:=</span>&nbsp;<span class="num" id="4674847">0</span><span class="op" id="4674848">;</span>&nbsp;<span class="ident" id="4674850">pass</span>&nbsp;<span class="op" id="4674855">&lt;</span>&nbsp;<span class="num" id="4674857">7</span><span class="op" id="4674858">;</span>&nbsp;<span class="ident" id="4674860">pass</span><span class="op" id="4674864">++</span>&nbsp;<span class="op" id="4674867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4674872">imagePass</span><span class="op" id="4674881">,</span>&nbsp;<span class="ident" id="4674883">err</span>&nbsp;<span class="op" id="4674887">:=</span>&nbsp;<span class="ident" id="4674890">d</span><span class="op" id="4674891">.</span><span class="ident" id="4674892">readImagePass</span><span class="op" id="4674905">(</span><span class="ident" id="4674906">r</span><span class="op" id="4674907">,</span>&nbsp;<span class="ident" id="4674909">pass</span><span class="op" id="4674913">,</span>&nbsp;<span class="builtintype" id="4674915">false</span><span class="op" id="4674920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4674925">if</span>&nbsp;<span class="ident" id="4674928">err</span>&nbsp;<span class="op" id="4674932">!=</span>&nbsp;<span class="ident" id="4674935">nil</span>&nbsp;<span class="op" id="4674939">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4674945">return</span>&nbsp;<span class="ident" id="4674952">nil</span><span class="op" id="4674955">,</span>&nbsp;<span class="ident" id="4674957">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4674964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4674969">d</span><span class="op" id="4674970">.</span><span class="ident" id="4674971">mergePassInto</span><span class="op" id="4674984">(</span><span class="ident" id="4674985">img</span><span class="op" id="4674988">,</span>&nbsp;<span class="ident" id="4674990">imagePass</span><span class="op" id="4674999">,</span>&nbsp;<span class="ident" id="4675001">pass</span><span class="op" id="4675005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4675009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4675012">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4675016">//&nbsp;Check&nbsp;for&nbsp;EOF,&nbsp;to&nbsp;verify&nbsp;the&nbsp;zlib&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4675064">n</span>&nbsp;<span class="op" id="4675066">:=</span>&nbsp;<span class="num" id="4675069">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4675072">for</span>&nbsp;<span class="ident" id="4675076">i</span>&nbsp;<span class="op" id="4675078">:=</span>&nbsp;<span class="num" id="4675081">0</span><span class="op" id="4675082">;</span>&nbsp;<span class="ident" id="4675084">n</span>&nbsp;<span class="op" id="4675086">==</span>&nbsp;<span class="num" id="4675089">0</span>&nbsp;<span class="op" id="4675091">&amp;&amp;</span>&nbsp;<span class="ident" id="4675094">err</span>&nbsp;<span class="op" id="4675098">==</span>&nbsp;<span class="ident" id="4675101">nil</span><span class="op" id="4675104">;</span>&nbsp;<span class="ident" id="4675106">i</span><span class="op" id="4675107">++</span>&nbsp;<span class="op" id="4675110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4675114">if</span>&nbsp;<span class="ident" id="4675117">i</span>&nbsp;<span class="op" id="4675119">==</span>&nbsp;<span class="num" id="4675122">100</span>&nbsp;<span class="op" id="4675126">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4675131">return</span>&nbsp;<span class="ident" id="4675138">nil</span><span class="op" id="4675141">,</span>&nbsp;<span class="ident" id="4675143">io</span><span class="op" id="4675145">.</span><span class="ident" id="4675146">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4675162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4675166">n</span><span class="op" id="4675167">,</span>&nbsp;<span class="ident" id="4675169">err</span>&nbsp;<span class="op" id="4675173">=</span>&nbsp;<span class="ident" id="4675175">r</span><span class="op" id="4675176">.</span><span class="ident" id="4675177">Read</span><span class="op" id="4675181">(</span><span class="ident" id="4675182">d</span><span class="op" id="4675183">.</span><span class="ident" id="4675184">tmp</span><span class="op" id="4675187">[</span><span class="op" id="4675188">:</span><span class="num" id="4675189">1</span><span class="op" id="4675190">]</span><span class="op" id="4675191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4675194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4675197">if</span>&nbsp;<span class="ident" id="4675200">err</span>&nbsp;<span class="op" id="4675204">!=</span>&nbsp;<span class="ident" id="4675207">nil</span>&nbsp;<span class="op" id="4675211">&amp;&amp;</span>&nbsp;<span class="ident" id="4675214">err</span>&nbsp;<span class="op" id="4675218">!=</span>&nbsp;<span class="ident" id="4675221">io</span><span class="op" id="4675223">.</span><span class="ident" id="4675224">EOF</span>&nbsp;<span class="op" id="4675228">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4675232">return</span>&nbsp;<span class="ident" id="4675239">nil</span><span class="op" id="4675242">,</span>&nbsp;<span class="ident" id="4675244">FormatError</span><span class="op" id="4675255">(</span><span class="ident" id="4675256">err</span><span class="op" id="4675259">.</span><span class="ident" id="4675260">Error</span><span class="op" id="4675265">(</span><span class="op" id="4675266">)</span><span class="op" id="4675267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4675270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4675273">if</span>&nbsp;<span class="ident" id="4675276">n</span>&nbsp;<span class="op" id="4675278">!=</span>&nbsp;<span class="num" id="4675281">0</span>&nbsp;<span class="op" id="4675283">||</span>&nbsp;<span class="ident" id="4675286">d</span><span class="op" id="4675287">.</span><span class="ident" id="4675288">idatLength</span>&nbsp;<span class="op" id="4675299">!=</span>&nbsp;<span class="num" id="4675302">0</span>&nbsp;<span class="op" id="4675304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4675308">return</span>&nbsp;<span class="ident" id="4675315">nil</span><span class="op" id="4675318">,</span>&nbsp;<span class="ident" id="4675320">FormatError</span><span class="op" id="4675331">(</span><span class="string" id="4675332">&#34;too&nbsp;much&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="4675353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4675356">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4675360">return</span>&nbsp;<span class="ident" id="4675367">img</span><span class="op" id="4675370">,</span>&nbsp;<span class="ident" id="4675372">nil</span><br>
<span class="lineno"></span><span class="op" id="4675376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4675379">//&nbsp;readImagePass&nbsp;reads&nbsp;a&nbsp;single&nbsp;image&nbsp;pass,&nbsp;sized&nbsp;according&nbsp;to&nbsp;the&nbsp;pass&nbsp;number.</span><br>
<span class="lineno">355</span><span class="keyword" id="4675459">func</span>&nbsp;<span class="op" id="4675464">(</span><span class="ident" id="4675465">d</span>&nbsp;<span class="op" id="4675467">*</span><span class="ident" id="4675468">decoder</span><span class="op" id="4675475">)</span>&nbsp;<span class="ident" id="4675477">readImagePass</span><span class="op" id="4675490">(</span><span class="ident" id="4675491">r</span>&nbsp;<span class="ident" id="4675493">io</span><span class="op" id="4675495">.</span><span class="ident" id="4675496">Reader</span><span class="op" id="4675502">,</span>&nbsp;<span class="ident" id="4675504">pass</span>&nbsp;<span class="builtintype" id="4675509">int</span><span class="op" id="4675512">,</span>&nbsp;<span class="ident" id="4675514">allocateOnly</span>&nbsp;<span class="builtintype" id="4675527">bool</span><span class="op" id="4675531">)</span>&nbsp;<span class="op" id="4675533">(</span><span class="ident" id="4675534">image</span><span class="op" id="4675539">.</span><span class="ident" id="4675540">Image</span><span class="op" id="4675545">,</span>&nbsp;<span class="builtintype" id="4675547">error</span><span class="op" id="4675552">)</span>&nbsp;<span class="op" id="4675554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4675557">var</span>&nbsp;<span class="ident" id="4675561">bitsPerPixel</span>&nbsp;<span class="builtintype" id="4675574">int</span>&nbsp;<span class="op" id="4675578">=</span>&nbsp;<span class="num" id="4675580">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4675583">pixOffset</span>&nbsp;<span class="op" id="4675593">:=</span>&nbsp;<span class="num" id="4675596">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4675599">var</span>&nbsp;<span class="op" id="4675603">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4675607">gray</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4675616">*</span><span class="ident" id="4675617">image</span><span class="op" id="4675622">.</span><span class="ident" id="4675623">Gray</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4675630">rgba</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4675639">*</span><span class="ident" id="4675640">image</span><span class="op" id="4675645">.</span><span class="ident" id="4675646">RGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4675653">paletted</span>&nbsp;<span class="op" id="4675662">*</span><span class="ident" id="4675663">image</span><span class="op" id="4675668">.</span><span class="ident" id="4675669">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4675680">nrgba</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4675689">*</span><span class="ident" id="4675690">image</span><span class="op" id="4675695">.</span><span class="ident" id="4675696">NRGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4675704">gray16</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4675713">*</span><span class="ident" id="4675714">image</span><span class="op" id="4675719">.</span><span class="ident" id="4675720">Gray16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4675729">rgba64</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4675738">*</span><span class="ident" id="4675739">image</span><span class="op" id="4675744">.</span><span class="ident" id="4675745">RGBA64</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4675754">nrgba64</span>&nbsp;&nbsp;<span class="op" id="4675763">*</span><span class="ident" id="4675764">image</span><span class="op" id="4675769">.</span><span class="ident" id="4675770">NRGBA64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4675780">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4675789">image</span><span class="op" id="4675794">.</span><span class="ident" id="4675795">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4675802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4675805">width</span><span class="op" id="4675810">,</span>&nbsp;<span class="ident" id="4675812">height</span>&nbsp;<span class="op" id="4675819">:=</span>&nbsp;<span class="ident" id="4675822">d</span><span class="op" id="4675823">.</span><span class="ident" id="4675824">width</span><span class="op" id="4675829">,</span>&nbsp;<span class="ident" id="4675831">d</span><span class="op" id="4675832">.</span><span class="ident" id="4675833">height</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4675841">if</span>&nbsp;<span class="ident" id="4675844">d</span><span class="op" id="4675845">.</span><span class="ident" id="4675846">interlace</span>&nbsp;<span class="op" id="4675856">==</span>&nbsp;<span class="ident" id="4675859">itAdam7</span>&nbsp;<span class="op" id="4675867">&amp;&amp;</span>&nbsp;<span class="op" id="4675870">!</span><span class="ident" id="4675871">allocateOnly</span>&nbsp;<span class="op" id="4675884">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4675888">p</span>&nbsp;<span class="op" id="4675890">:=</span>&nbsp;<span class="ident" id="4675893">interlacing</span><span class="op" id="4675904">[</span><span class="ident" id="4675905">pass</span><span class="op" id="4675909">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4675913">//&nbsp;Add&nbsp;the&nbsp;multiplication&nbsp;factor&nbsp;and&nbsp;subtract&nbsp;one,&nbsp;effectively&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4675991">width</span>&nbsp;<span class="op" id="4675997">=</span>&nbsp;<span class="op" id="4675999">(</span><span class="ident" id="4676000">width</span>&nbsp;<span class="op" id="4676006">-</span>&nbsp;<span class="ident" id="4676008">p</span><span class="op" id="4676009">.</span><span class="ident" id="4676010">xOffset</span>&nbsp;<span class="op" id="4676018">+</span>&nbsp;<span class="ident" id="4676020">p</span><span class="op" id="4676021">.</span><span class="ident" id="4676022">xFactor</span>&nbsp;<span class="op" id="4676030">-</span>&nbsp;<span class="num" id="4676032">1</span><span class="op" id="4676033">)</span>&nbsp;<span class="op" id="4676035">/</span>&nbsp;<span class="ident" id="4676037">p</span><span class="op" id="4676038">.</span><span class="ident" id="4676039">xFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676049">height</span>&nbsp;<span class="op" id="4676056">=</span>&nbsp;<span class="op" id="4676058">(</span><span class="ident" id="4676059">height</span>&nbsp;<span class="op" id="4676066">-</span>&nbsp;<span class="ident" id="4676068">p</span><span class="op" id="4676069">.</span><span class="ident" id="4676070">yOffset</span>&nbsp;<span class="op" id="4676078">+</span>&nbsp;<span class="ident" id="4676080">p</span><span class="op" id="4676081">.</span><span class="ident" id="4676082">yFactor</span>&nbsp;<span class="op" id="4676090">-</span>&nbsp;<span class="num" id="4676092">1</span><span class="op" id="4676093">)</span>&nbsp;<span class="op" id="4676095">/</span>&nbsp;<span class="ident" id="4676097">p</span><span class="op" id="4676098">.</span><span class="ident" id="4676099">yFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4676108">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4676111">switch</span>&nbsp;<span class="ident" id="4676118">d</span><span class="op" id="4676119">.</span><span class="ident" id="4676120">cb</span>&nbsp;<span class="op" id="4676123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4676126">case</span>&nbsp;<span class="ident" id="4676131">cbG1</span><span class="op" id="4676135">,</span>&nbsp;<span class="ident" id="4676137">cbG2</span><span class="op" id="4676141">,</span>&nbsp;<span class="ident" id="4676143">cbG4</span><span class="op" id="4676147">,</span>&nbsp;<span class="ident" id="4676149">cbG8</span><span class="op" id="4676153">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676157">bitsPerPixel</span>&nbsp;<span class="op" id="4676170">=</span>&nbsp;<span class="ident" id="4676172">d</span><span class="op" id="4676173">.</span><span class="ident" id="4676174">depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676182">gray</span>&nbsp;<span class="op" id="4676187">=</span>&nbsp;<span class="ident" id="4676189">image</span><span class="op" id="4676194">.</span><span class="ident" id="4676195">NewGray</span><span class="op" id="4676202">(</span><span class="ident" id="4676203">image</span><span class="op" id="4676208">.</span><span class="ident" id="4676209">Rect</span><span class="op" id="4676213">(</span><span class="num" id="4676214">0</span><span class="op" id="4676215">,</span>&nbsp;<span class="num" id="4676217">0</span><span class="op" id="4676218">,</span>&nbsp;<span class="ident" id="4676220">width</span><span class="op" id="4676225">,</span>&nbsp;<span class="ident" id="4676227">height</span><span class="op" id="4676233">)</span><span class="op" id="4676234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676238">img</span>&nbsp;<span class="op" id="4676242">=</span>&nbsp;<span class="ident" id="4676244">gray</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4676250">case</span>&nbsp;<span class="ident" id="4676255">cbGA8</span><span class="op" id="4676260">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676264">bitsPerPixel</span>&nbsp;<span class="op" id="4676277">=</span>&nbsp;<span class="num" id="4676279">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676284">nrgba</span>&nbsp;<span class="op" id="4676290">=</span>&nbsp;<span class="ident" id="4676292">image</span><span class="op" id="4676297">.</span><span class="ident" id="4676298">NewNRGBA</span><span class="op" id="4676306">(</span><span class="ident" id="4676307">image</span><span class="op" id="4676312">.</span><span class="ident" id="4676313">Rect</span><span class="op" id="4676317">(</span><span class="num" id="4676318">0</span><span class="op" id="4676319">,</span>&nbsp;<span class="num" id="4676321">0</span><span class="op" id="4676322">,</span>&nbsp;<span class="ident" id="4676324">width</span><span class="op" id="4676329">,</span>&nbsp;<span class="ident" id="4676331">height</span><span class="op" id="4676337">)</span><span class="op" id="4676338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676342">img</span>&nbsp;<span class="op" id="4676346">=</span>&nbsp;<span class="ident" id="4676348">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4676355">case</span>&nbsp;<span class="ident" id="4676360">cbTC8</span><span class="op" id="4676365">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676369">bitsPerPixel</span>&nbsp;<span class="op" id="4676382">=</span>&nbsp;<span class="num" id="4676384">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676389">rgba</span>&nbsp;<span class="op" id="4676394">=</span>&nbsp;<span class="ident" id="4676396">image</span><span class="op" id="4676401">.</span><span class="ident" id="4676402">NewRGBA</span><span class="op" id="4676409">(</span><span class="ident" id="4676410">image</span><span class="op" id="4676415">.</span><span class="ident" id="4676416">Rect</span><span class="op" id="4676420">(</span><span class="num" id="4676421">0</span><span class="op" id="4676422">,</span>&nbsp;<span class="num" id="4676424">0</span><span class="op" id="4676425">,</span>&nbsp;<span class="ident" id="4676427">width</span><span class="op" id="4676432">,</span>&nbsp;<span class="ident" id="4676434">height</span><span class="op" id="4676440">)</span><span class="op" id="4676441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676445">img</span>&nbsp;<span class="op" id="4676449">=</span>&nbsp;<span class="ident" id="4676451">rgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4676457">case</span>&nbsp;<span class="ident" id="4676462">cbP1</span><span class="op" id="4676466">,</span>&nbsp;<span class="ident" id="4676468">cbP2</span><span class="op" id="4676472">,</span>&nbsp;<span class="ident" id="4676474">cbP4</span><span class="op" id="4676478">,</span>&nbsp;<span class="ident" id="4676480">cbP8</span><span class="op" id="4676484">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676488">bitsPerPixel</span>&nbsp;<span class="op" id="4676501">=</span>&nbsp;<span class="ident" id="4676503">d</span><span class="op" id="4676504">.</span><span class="ident" id="4676505">depth</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676513">paletted</span>&nbsp;<span class="op" id="4676522">=</span>&nbsp;<span class="ident" id="4676524">image</span><span class="op" id="4676529">.</span><span class="ident" id="4676530">NewPaletted</span><span class="op" id="4676541">(</span><span class="ident" id="4676542">image</span><span class="op" id="4676547">.</span><span class="ident" id="4676548">Rect</span><span class="op" id="4676552">(</span><span class="num" id="4676553">0</span><span class="op" id="4676554">,</span>&nbsp;<span class="num" id="4676556">0</span><span class="op" id="4676557">,</span>&nbsp;<span class="ident" id="4676559">width</span><span class="op" id="4676564">,</span>&nbsp;<span class="ident" id="4676566">height</span><span class="op" id="4676572">)</span><span class="op" id="4676573">,</span>&nbsp;<span class="ident" id="4676575">d</span><span class="op" id="4676576">.</span><span class="ident" id="4676577">palette</span><span class="op" id="4676584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676588">img</span>&nbsp;<span class="op" id="4676592">=</span>&nbsp;<span class="ident" id="4676594">paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4676604">case</span>&nbsp;<span class="ident" id="4676609">cbTCA8</span><span class="op" id="4676615">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676619">bitsPerPixel</span>&nbsp;<span class="op" id="4676632">=</span>&nbsp;<span class="num" id="4676634">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676639">nrgba</span>&nbsp;<span class="op" id="4676645">=</span>&nbsp;<span class="ident" id="4676647">image</span><span class="op" id="4676652">.</span><span class="ident" id="4676653">NewNRGBA</span><span class="op" id="4676661">(</span><span class="ident" id="4676662">image</span><span class="op" id="4676667">.</span><span class="ident" id="4676668">Rect</span><span class="op" id="4676672">(</span><span class="num" id="4676673">0</span><span class="op" id="4676674">,</span>&nbsp;<span class="num" id="4676676">0</span><span class="op" id="4676677">,</span>&nbsp;<span class="ident" id="4676679">width</span><span class="op" id="4676684">,</span>&nbsp;<span class="ident" id="4676686">height</span><span class="op" id="4676692">)</span><span class="op" id="4676693">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676697">img</span>&nbsp;<span class="op" id="4676701">=</span>&nbsp;<span class="ident" id="4676703">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4676710">case</span>&nbsp;<span class="ident" id="4676715">cbG16</span><span class="op" id="4676720">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676724">bitsPerPixel</span>&nbsp;<span class="op" id="4676737">=</span>&nbsp;<span class="num" id="4676739">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676744">gray16</span>&nbsp;<span class="op" id="4676751">=</span>&nbsp;<span class="ident" id="4676753">image</span><span class="op" id="4676758">.</span><span class="ident" id="4676759">NewGray16</span><span class="op" id="4676768">(</span><span class="ident" id="4676769">image</span><span class="op" id="4676774">.</span><span class="ident" id="4676775">Rect</span><span class="op" id="4676779">(</span><span class="num" id="4676780">0</span><span class="op" id="4676781">,</span>&nbsp;<span class="num" id="4676783">0</span><span class="op" id="4676784">,</span>&nbsp;<span class="ident" id="4676786">width</span><span class="op" id="4676791">,</span>&nbsp;<span class="ident" id="4676793">height</span><span class="op" id="4676799">)</span><span class="op" id="4676800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676804">img</span>&nbsp;<span class="op" id="4676808">=</span>&nbsp;<span class="ident" id="4676810">gray16</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4676818">case</span>&nbsp;<span class="ident" id="4676823">cbGA16</span><span class="op" id="4676829">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676833">bitsPerPixel</span>&nbsp;<span class="op" id="4676846">=</span>&nbsp;<span class="num" id="4676848">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676853">nrgba64</span>&nbsp;<span class="op" id="4676861">=</span>&nbsp;<span class="ident" id="4676863">image</span><span class="op" id="4676868">.</span><span class="ident" id="4676869">NewNRGBA64</span><span class="op" id="4676879">(</span><span class="ident" id="4676880">image</span><span class="op" id="4676885">.</span><span class="ident" id="4676886">Rect</span><span class="op" id="4676890">(</span><span class="num" id="4676891">0</span><span class="op" id="4676892">,</span>&nbsp;<span class="num" id="4676894">0</span><span class="op" id="4676895">,</span>&nbsp;<span class="ident" id="4676897">width</span><span class="op" id="4676902">,</span>&nbsp;<span class="ident" id="4676904">height</span><span class="op" id="4676910">)</span><span class="op" id="4676911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676915">img</span>&nbsp;<span class="op" id="4676919">=</span>&nbsp;<span class="ident" id="4676921">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4676930">case</span>&nbsp;<span class="ident" id="4676935">cbTC16</span><span class="op" id="4676941">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676945">bitsPerPixel</span>&nbsp;<span class="op" id="4676958">=</span>&nbsp;<span class="num" id="4676960">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4676965">rgba64</span>&nbsp;<span class="op" id="4676972">=</span>&nbsp;<span class="ident" id="4676974">image</span><span class="op" id="4676979">.</span><span class="ident" id="4676980">NewRGBA64</span><span class="op" id="4676989">(</span><span class="ident" id="4676990">image</span><span class="op" id="4676995">.</span><span class="ident" id="4676996">Rect</span><span class="op" id="4677000">(</span><span class="num" id="4677001">0</span><span class="op" id="4677002">,</span>&nbsp;<span class="num" id="4677004">0</span><span class="op" id="4677005">,</span>&nbsp;<span class="ident" id="4677007">width</span><span class="op" id="4677012">,</span>&nbsp;<span class="ident" id="4677014">height</span><span class="op" id="4677020">)</span><span class="op" id="4677021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4677025">img</span>&nbsp;<span class="op" id="4677029">=</span>&nbsp;<span class="ident" id="4677031">rgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4677039">case</span>&nbsp;<span class="ident" id="4677044">cbTCA16</span><span class="op" id="4677051">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4677055">bitsPerPixel</span>&nbsp;<span class="op" id="4677068">=</span>&nbsp;<span class="num" id="4677070">64</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4677075">nrgba64</span>&nbsp;<span class="op" id="4677083">=</span>&nbsp;<span class="ident" id="4677085">image</span><span class="op" id="4677090">.</span><span class="ident" id="4677091">NewNRGBA64</span><span class="op" id="4677101">(</span><span class="ident" id="4677102">image</span><span class="op" id="4677107">.</span><span class="ident" id="4677108">Rect</span><span class="op" id="4677112">(</span><span class="num" id="4677113">0</span><span class="op" id="4677114">,</span>&nbsp;<span class="num" id="4677116">0</span><span class="op" id="4677117">,</span>&nbsp;<span class="ident" id="4677119">width</span><span class="op" id="4677124">,</span>&nbsp;<span class="ident" id="4677126">height</span><span class="op" id="4677132">)</span><span class="op" id="4677133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4677137">img</span>&nbsp;<span class="op" id="4677141">=</span>&nbsp;<span class="ident" id="4677143">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4677152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4677155">if</span>&nbsp;<span class="ident" id="4677158">allocateOnly</span>&nbsp;<span class="op" id="4677171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4677175">return</span>&nbsp;<span class="ident" id="4677182">img</span><span class="op" id="4677185">,</span>&nbsp;<span class="ident" id="4677187">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4677192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4677195">bytesPerPixel</span>&nbsp;<span class="op" id="4677209">:=</span>&nbsp;<span class="op" id="4677212">(</span><span class="ident" id="4677213">bitsPerPixel</span>&nbsp;<span class="op" id="4677226">+</span>&nbsp;<span class="num" id="4677228">7</span><span class="op" id="4677229">)</span>&nbsp;<span class="op" id="4677231">/</span>&nbsp;<span class="num" id="4677233">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4677237">//&nbsp;The&nbsp;+1&nbsp;is&nbsp;for&nbsp;the&nbsp;per-row&nbsp;filter&nbsp;type,&nbsp;which&nbsp;is&nbsp;at&nbsp;cr[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4677299">rowSize</span>&nbsp;<span class="op" id="4677307">:=</span>&nbsp;<span class="num" id="4677310">1</span>&nbsp;<span class="op" id="4677312">+</span>&nbsp;<span class="op" id="4677314">(</span><span class="ident" id="4677315">bitsPerPixel</span><span class="op" id="4677327">*</span><span class="ident" id="4677328">width</span><span class="op" id="4677333">+</span><span class="num" id="4677334">7</span><span class="op" id="4677335">)</span><span class="op" id="4677336">/</span><span class="num" id="4677337">8</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4677340">//&nbsp;cr&nbsp;and&nbsp;pr&nbsp;are&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;current&nbsp;and&nbsp;previous&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4677402">cr</span>&nbsp;<span class="op" id="4677405">:=</span>&nbsp;<span class="builtinfunc" id="4677408">make</span><span class="op" id="4677412">(</span><span class="op" id="4677413">[</span><span class="op" id="4677414">]</span><span class="builtintype" id="4677415">uint8</span><span class="op" id="4677420">,</span>&nbsp;<span class="ident" id="4677422">rowSize</span><span class="op" id="4677429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4677432">pr</span>&nbsp;<span class="op" id="4677435">:=</span>&nbsp;<span class="builtinfunc" id="4677438">make</span><span class="op" id="4677442">(</span><span class="op" id="4677443">[</span><span class="op" id="4677444">]</span><span class="builtintype" id="4677445">uint8</span><span class="op" id="4677450">,</span>&nbsp;<span class="ident" id="4677452">rowSize</span><span class="op" id="4677459">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4677463">for</span>&nbsp;<span class="ident" id="4677467">y</span>&nbsp;<span class="op" id="4677469">:=</span>&nbsp;<span class="num" id="4677472">0</span><span class="op" id="4677473">;</span>&nbsp;<span class="ident" id="4677475">y</span>&nbsp;<span class="op" id="4677477">&lt;</span>&nbsp;<span class="ident" id="4677479">height</span><span class="op" id="4677485">;</span>&nbsp;<span class="ident" id="4677487">y</span><span class="op" id="4677488">++</span>&nbsp;<span class="op" id="4677491">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4677495">//&nbsp;Read&nbsp;the&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4677529">_</span><span class="op" id="4677530">,</span>&nbsp;<span class="ident" id="4677532">err</span>&nbsp;<span class="op" id="4677536">:=</span>&nbsp;<span class="ident" id="4677539">io</span><span class="op" id="4677541">.</span><span class="ident" id="4677542">ReadFull</span><span class="op" id="4677550">(</span><span class="ident" id="4677551">r</span><span class="op" id="4677552">,</span>&nbsp;<span class="ident" id="4677554">cr</span><span class="op" id="4677556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4677560">if</span>&nbsp;<span class="ident" id="4677563">err</span>&nbsp;<span class="op" id="4677567">!=</span>&nbsp;<span class="ident" id="4677570">nil</span>&nbsp;<span class="op" id="4677574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4677579">return</span>&nbsp;<span class="ident" id="4677586">nil</span><span class="op" id="4677589">,</span>&nbsp;<span class="ident" id="4677591">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4677597">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4677602">//&nbsp;Apply&nbsp;the&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4677625">cdat</span>&nbsp;<span class="op" id="4677630">:=</span>&nbsp;<span class="ident" id="4677633">cr</span><span class="op" id="4677635">[</span><span class="num" id="4677636">1</span><span class="op" id="4677637">:</span><span class="op" id="4677638">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4677642">pdat</span>&nbsp;<span class="op" id="4677647">:=</span>&nbsp;<span class="ident" id="4677650">pr</span><span class="op" id="4677652">[</span><span class="num" id="4677653">1</span><span class="op" id="4677654">:</span><span class="op" id="4677655">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4677659">switch</span>&nbsp;<span class="ident" id="4677666">cr</span><span class="op" id="4677668">[</span><span class="num" id="4677669">0</span><span class="op" id="4677670">]</span>&nbsp;<span class="op" id="4677672">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4677676">case</span>&nbsp;<span class="ident" id="4677681">ftNone</span><span class="op" id="4677687">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4677692">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4677704">case</span>&nbsp;<span class="ident" id="4677709">ftSub</span><span class="op" id="4677714">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4677719">for</span>&nbsp;<span class="ident" id="4677723">i</span>&nbsp;<span class="op" id="4677725">:=</span>&nbsp;<span class="ident" id="4677728">bytesPerPixel</span><span class="op" id="4677741">;</span>&nbsp;<span class="ident" id="4677743">i</span>&nbsp;<span class="op" id="4677745">&lt;</span>&nbsp;<span class="builtinfunc" id="4677747">len</span><span class="op" id="4677750">(</span><span class="ident" id="4677751">cdat</span><span class="op" id="4677755">)</span><span class="op" id="4677756">;</span>&nbsp;<span class="ident" id="4677758">i</span><span class="op" id="4677759">++</span>&nbsp;<span class="op" id="4677762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4677768">cdat</span><span class="op" id="4677772">[</span><span class="ident" id="4677773">i</span><span class="op" id="4677774">]</span>&nbsp;<span class="op" id="4677776">+=</span>&nbsp;<span class="ident" id="4677779">cdat</span><span class="op" id="4677783">[</span><span class="ident" id="4677784">i</span><span class="op" id="4677785">-</span><span class="ident" id="4677786">bytesPerPixel</span><span class="op" id="4677799">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4677804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4677808">case</span>&nbsp;<span class="ident" id="4677813">ftUp</span><span class="op" id="4677817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4677822">for</span>&nbsp;<span class="ident" id="4677826">i</span><span class="op" id="4677827">,</span>&nbsp;<span class="ident" id="4677829">p</span>&nbsp;<span class="op" id="4677831">:=</span>&nbsp;<span class="keyword" id="4677834">range</span>&nbsp;<span class="ident" id="4677840">pdat</span>&nbsp;<span class="op" id="4677845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4677851">cdat</span><span class="op" id="4677855">[</span><span class="ident" id="4677856">i</span><span class="op" id="4677857">]</span>&nbsp;<span class="op" id="4677859">+=</span>&nbsp;<span class="ident" id="4677862">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4677867">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4677871">case</span>&nbsp;<span class="ident" id="4677876">ftAverage</span><span class="op" id="4677885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4677890">for</span>&nbsp;<span class="ident" id="4677894">i</span>&nbsp;<span class="op" id="4677896">:=</span>&nbsp;<span class="num" id="4677899">0</span><span class="op" id="4677900">;</span>&nbsp;<span class="ident" id="4677902">i</span>&nbsp;<span class="op" id="4677904">&lt;</span>&nbsp;<span class="ident" id="4677906">bytesPerPixel</span><span class="op" id="4677919">;</span>&nbsp;<span class="ident" id="4677921">i</span><span class="op" id="4677922">++</span>&nbsp;<span class="op" id="4677925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4677931">cdat</span><span class="op" id="4677935">[</span><span class="ident" id="4677936">i</span><span class="op" id="4677937">]</span>&nbsp;<span class="op" id="4677939">+=</span>&nbsp;<span class="ident" id="4677942">pdat</span><span class="op" id="4677946">[</span><span class="ident" id="4677947">i</span><span class="op" id="4677948">]</span>&nbsp;<span class="op" id="4677950">/</span>&nbsp;<span class="num" id="4677952">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4677957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4677962">for</span>&nbsp;<span class="ident" id="4677966">i</span>&nbsp;<span class="op" id="4677968">:=</span>&nbsp;<span class="ident" id="4677971">bytesPerPixel</span><span class="op" id="4677984">;</span>&nbsp;<span class="ident" id="4677986">i</span>&nbsp;<span class="op" id="4677988">&lt;</span>&nbsp;<span class="builtinfunc" id="4677990">len</span><span class="op" id="4677993">(</span><span class="ident" id="4677994">cdat</span><span class="op" id="4677998">)</span><span class="op" id="4677999">;</span>&nbsp;<span class="ident" id="4678001">i</span><span class="op" id="4678002">++</span>&nbsp;<span class="op" id="4678005">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4678011">cdat</span><span class="op" id="4678015">[</span><span class="ident" id="4678016">i</span><span class="op" id="4678017">]</span>&nbsp;<span class="op" id="4678019">+=</span>&nbsp;<span class="builtintype" id="4678022">uint8</span><span class="op" id="4678027">(</span><span class="op" id="4678028">(</span><span class="builtintype" id="4678029">int</span><span class="op" id="4678032">(</span><span class="ident" id="4678033">cdat</span><span class="op" id="4678037">[</span><span class="ident" id="4678038">i</span><span class="op" id="4678039">-</span><span class="ident" id="4678040">bytesPerPixel</span><span class="op" id="4678053">]</span><span class="op" id="4678054">)</span>&nbsp;<span class="op" id="4678056">+</span>&nbsp;<span class="builtintype" id="4678058">int</span><span class="op" id="4678061">(</span><span class="ident" id="4678062">pdat</span><span class="op" id="4678066">[</span><span class="ident" id="4678067">i</span><span class="op" id="4678068">]</span><span class="op" id="4678069">)</span><span class="op" id="4678070">)</span>&nbsp;<span class="op" id="4678072">/</span>&nbsp;<span class="num" id="4678074">2</span><span class="op" id="4678075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4678080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4678084">case</span>&nbsp;<span class="ident" id="4678089">ftPaeth</span><span class="op" id="4678096">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4678101">filterPaeth</span><span class="op" id="4678112">(</span><span class="ident" id="4678113">cdat</span><span class="op" id="4678117">,</span>&nbsp;<span class="ident" id="4678119">pdat</span><span class="op" id="4678123">,</span>&nbsp;<span class="ident" id="4678125">bytesPerPixel</span><span class="op" id="4678138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4678142">default</span><span class="op" id="4678149">:</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4678154">return</span>&nbsp;<span class="ident" id="4678161">nil</span><span class="op" id="4678164">,</span>&nbsp;<span class="ident" id="4678166">FormatError</span><span class="op" id="4678177">(</span><span class="string" id="4678178">&#34;bad&nbsp;filter&nbsp;type&#34;</span><span class="op" id="4678195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4678199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4678204">//&nbsp;Convert&nbsp;from&nbsp;bytes&nbsp;to&nbsp;colors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4678239">switch</span>&nbsp;<span class="ident" id="4678246">d</span><span class="op" id="4678247">.</span><span class="ident" id="4678248">cb</span>&nbsp;<span class="op" id="4678251">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4678255">case</span>&nbsp;<span class="ident" id="4678260">cbG1</span><span class="op" id="4678264">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4678269">for</span>&nbsp;<span class="ident" id="4678273">x</span>&nbsp;<span class="op" id="4678275">:=</span>&nbsp;<span class="num" id="4678278">0</span><span class="op" id="4678279">;</span>&nbsp;<span class="ident" id="4678281">x</span>&nbsp;<span class="op" id="4678283">&lt;</span>&nbsp;<span class="ident" id="4678285">width</span><span class="op" id="4678290">;</span>&nbsp;<span class="ident" id="4678292">x</span>&nbsp;<span class="op" id="4678294">+=</span>&nbsp;<span class="num" id="4678297">8</span>&nbsp;<span class="op" id="4678299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4678305">b</span>&nbsp;<span class="op" id="4678307">:=</span>&nbsp;<span class="ident" id="4678310">cdat</span><span class="op" id="4678314">[</span><span class="ident" id="4678315">x</span><span class="op" id="4678316">/</span><span class="num" id="4678317">8</span><span class="op" id="4678318">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4678324">for</span>&nbsp;<span class="ident" id="4678328">x2</span>&nbsp;<span class="op" id="4678331">:=</span>&nbsp;<span class="num" id="4678334">0</span><span class="op" id="4678335">;</span>&nbsp;<span class="ident" id="4678337">x2</span>&nbsp;<span class="op" id="4678340">&lt;</span>&nbsp;<span class="num" id="4678342">8</span>&nbsp;<span class="op" id="4678344">&amp;&amp;</span>&nbsp;<span class="ident" id="4678347">x</span><span class="op" id="4678348">+</span><span class="ident" id="4678349">x2</span>&nbsp;<span class="op" id="4678352">&lt;</span>&nbsp;<span class="ident" id="4678354">width</span><span class="op" id="4678359">;</span>&nbsp;<span class="ident" id="4678361">x2</span><span class="op" id="4678363">++</span>&nbsp;<span class="op" id="4678366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4678373">gray</span><span class="op" id="4678377">.</span><span class="ident" id="4678378">SetGray</span><span class="op" id="4678385">(</span><span class="ident" id="4678386">x</span><span class="op" id="4678387">+</span><span class="ident" id="4678388">x2</span><span class="op" id="4678390">,</span>&nbsp;<span class="ident" id="4678392">y</span><span class="op" id="4678393">,</span>&nbsp;<span class="ident" id="4678395">color</span><span class="op" id="4678400">.</span><span class="ident" id="4678401">Gray</span><span class="op" id="4678405">{</span><span class="op" id="4678406">(</span><span class="ident" id="4678407">b</span>&nbsp;<span class="op" id="4678409">&gt;&gt;</span>&nbsp;<span class="num" id="4678412">7</span><span class="op" id="4678413">)</span>&nbsp;<span class="op" id="4678415">*</span>&nbsp;<span class="num" id="4678417">0xff</span><span class="op" id="4678421">}</span><span class="op" id="4678422">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4678429">b</span>&nbsp;<span class="op" id="4678431">&lt;&lt;=</span>&nbsp;<span class="num" id="4678435">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4678441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4678446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4678450">case</span>&nbsp;<span class="ident" id="4678455">cbG2</span><span class="op" id="4678459">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4678464">for</span>&nbsp;<span class="ident" id="4678468">x</span>&nbsp;<span class="op" id="4678470">:=</span>&nbsp;<span class="num" id="4678473">0</span><span class="op" id="4678474">;</span>&nbsp;<span class="ident" id="4678476">x</span>&nbsp;<span class="op" id="4678478">&lt;</span>&nbsp;<span class="ident" id="4678480">width</span><span class="op" id="4678485">;</span>&nbsp;<span class="ident" id="4678487">x</span>&nbsp;<span class="op" id="4678489">+=</span>&nbsp;<span class="num" id="4678492">4</span>&nbsp;<span class="op" id="4678494">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4678500">b</span>&nbsp;<span class="op" id="4678502">:=</span>&nbsp;<span class="ident" id="4678505">cdat</span><span class="op" id="4678509">[</span><span class="ident" id="4678510">x</span><span class="op" id="4678511">/</span><span class="num" id="4678512">4</span><span class="op" id="4678513">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4678519">for</span>&nbsp;<span class="ident" id="4678523">x2</span>&nbsp;<span class="op" id="4678526">:=</span>&nbsp;<span class="num" id="4678529">0</span><span class="op" id="4678530">;</span>&nbsp;<span class="ident" id="4678532">x2</span>&nbsp;<span class="op" id="4678535">&lt;</span>&nbsp;<span class="num" id="4678537">4</span>&nbsp;<span class="op" id="4678539">&amp;&amp;</span>&nbsp;<span class="ident" id="4678542">x</span><span class="op" id="4678543">+</span><span class="ident" id="4678544">x2</span>&nbsp;<span class="op" id="4678547">&lt;</span>&nbsp;<span class="ident" id="4678549">width</span><span class="op" id="4678554">;</span>&nbsp;<span class="ident" id="4678556">x2</span><span class="op" id="4678558">++</span>&nbsp;<span class="op" id="4678561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4678568">gray</span><span class="op" id="4678572">.</span><span class="ident" id="4678573">SetGray</span><span class="op" id="4678580">(</span><span class="ident" id="4678581">x</span><span class="op" id="4678582">+</span><span class="ident" id="4678583">x2</span><span class="op" id="4678585">,</span>&nbsp;<span class="ident" id="4678587">y</span><span class="op" id="4678588">,</span>&nbsp;<span class="ident" id="4678590">color</span><span class="op" id="4678595">.</span><span class="ident" id="4678596">Gray</span><span class="op" id="4678600">{</span><span class="op" id="4678601">(</span><span class="ident" id="4678602">b</span>&nbsp;<span class="op" id="4678604">&gt;&gt;</span>&nbsp;<span class="num" id="4678607">6</span><span class="op" id="4678608">)</span>&nbsp;<span class="op" id="4678610">*</span>&nbsp;<span class="num" id="4678612">0x55</span><span class="op" id="4678616">}</span><span class="op" id="4678617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4678624">b</span>&nbsp;<span class="op" id="4678626">&lt;&lt;=</span>&nbsp;<span class="num" id="4678630">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4678636">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4678641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4678645">case</span>&nbsp;<span class="ident" id="4678650">cbG4</span><span class="op" id="4678654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4678659">for</span>&nbsp;<span class="ident" id="4678663">x</span>&nbsp;<span class="op" id="4678665">:=</span>&nbsp;<span class="num" id="4678668">0</span><span class="op" id="4678669">;</span>&nbsp;<span class="ident" id="4678671">x</span>&nbsp;<span class="op" id="4678673">&lt;</span>&nbsp;<span class="ident" id="4678675">width</span><span class="op" id="4678680">;</span>&nbsp;<span class="ident" id="4678682">x</span>&nbsp;<span class="op" id="4678684">+=</span>&nbsp;<span class="num" id="4678687">2</span>&nbsp;<span class="op" id="4678689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4678695">b</span>&nbsp;<span class="op" id="4678697">:=</span>&nbsp;<span class="ident" id="4678700">cdat</span><span class="op" id="4678704">[</span><span class="ident" id="4678705">x</span><span class="op" id="4678706">/</span><span class="num" id="4678707">2</span><span class="op" id="4678708">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4678714">for</span>&nbsp;<span class="ident" id="4678718">x2</span>&nbsp;<span class="op" id="4678721">:=</span>&nbsp;<span class="num" id="4678724">0</span><span class="op" id="4678725">;</span>&nbsp;<span class="ident" id="4678727">x2</span>&nbsp;<span class="op" id="4678730">&lt;</span>&nbsp;<span class="num" id="4678732">2</span>&nbsp;<span class="op" id="4678734">&amp;&amp;</span>&nbsp;<span class="ident" id="4678737">x</span><span class="op" id="4678738">+</span><span class="ident" id="4678739">x2</span>&nbsp;<span class="op" id="4678742">&lt;</span>&nbsp;<span class="ident" id="4678744">width</span><span class="op" id="4678749">;</span>&nbsp;<span class="ident" id="4678751">x2</span><span class="op" id="4678753">++</span>&nbsp;<span class="op" id="4678756">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4678763">gray</span><span class="op" id="4678767">.</span><span class="ident" id="4678768">SetGray</span><span class="op" id="4678775">(</span><span class="ident" id="4678776">x</span><span class="op" id="4678777">+</span><span class="ident" id="4678778">x2</span><span class="op" id="4678780">,</span>&nbsp;<span class="ident" id="4678782">y</span><span class="op" id="4678783">,</span>&nbsp;<span class="ident" id="4678785">color</span><span class="op" id="4678790">.</span><span class="ident" id="4678791">Gray</span><span class="op" id="4678795">{</span><span class="op" id="4678796">(</span><span class="ident" id="4678797">b</span>&nbsp;<span class="op" id="4678799">&gt;&gt;</span>&nbsp;<span class="num" id="4678802">4</span><span class="op" id="4678803">)</span>&nbsp;<span class="op" id="4678805">*</span>&nbsp;<span class="num" id="4678807">0x11</span><span class="op" id="4678811">}</span><span class="op" id="4678812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4678819">b</span>&nbsp;<span class="op" id="4678821">&lt;&lt;=</span>&nbsp;<span class="num" id="4678825">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4678831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4678836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4678840">case</span>&nbsp;<span class="ident" id="4678845">cbG8</span><span class="op" id="4678849">:</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4678854">copy</span><span class="op" id="4678858">(</span><span class="ident" id="4678859">gray</span><span class="op" id="4678863">.</span><span class="ident" id="4678864">Pix</span><span class="op" id="4678867">[</span><span class="ident" id="4678868">pixOffset</span><span class="op" id="4678877">:</span><span class="op" id="4678878">]</span><span class="op" id="4678879">,</span>&nbsp;<span class="ident" id="4678881">cdat</span><span class="op" id="4678885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4678890">pixOffset</span>&nbsp;<span class="op" id="4678900">+=</span>&nbsp;<span class="ident" id="4678903">gray</span><span class="op" id="4678907">.</span><span class="ident" id="4678908">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4678917">case</span>&nbsp;<span class="ident" id="4678922">cbGA8</span><span class="op" id="4678927">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4678932">for</span>&nbsp;<span class="ident" id="4678936">x</span>&nbsp;<span class="op" id="4678938">:=</span>&nbsp;<span class="num" id="4678941">0</span><span class="op" id="4678942">;</span>&nbsp;<span class="ident" id="4678944">x</span>&nbsp;<span class="op" id="4678946">&lt;</span>&nbsp;<span class="ident" id="4678948">width</span><span class="op" id="4678953">;</span>&nbsp;<span class="ident" id="4678955">x</span><span class="op" id="4678956">++</span>&nbsp;<span class="op" id="4678959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4678965">ycol</span>&nbsp;<span class="op" id="4678970">:=</span>&nbsp;<span class="ident" id="4678973">cdat</span><span class="op" id="4678977">[</span><span class="num" id="4678978">2</span><span class="op" id="4678979">*</span><span class="ident" id="4678980">x</span><span class="op" id="4678981">+</span><span class="num" id="4678982">0</span><span class="op" id="4678983">]</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4678989">nrgba</span><span class="op" id="4678994">.</span><span class="ident" id="4678995">SetNRGBA</span><span class="op" id="4679003">(</span><span class="ident" id="4679004">x</span><span class="op" id="4679005">,</span>&nbsp;<span class="ident" id="4679007">y</span><span class="op" id="4679008">,</span>&nbsp;<span class="ident" id="4679010">color</span><span class="op" id="4679015">.</span><span class="ident" id="4679016">NRGBA</span><span class="op" id="4679021">{</span><span class="ident" id="4679022">ycol</span><span class="op" id="4679026">,</span>&nbsp;<span class="ident" id="4679028">ycol</span><span class="op" id="4679032">,</span>&nbsp;<span class="ident" id="4679034">ycol</span><span class="op" id="4679038">,</span>&nbsp;<span class="ident" id="4679040">cdat</span><span class="op" id="4679044">[</span><span class="num" id="4679045">2</span><span class="op" id="4679046">*</span><span class="ident" id="4679047">x</span><span class="op" id="4679048">+</span><span class="num" id="4679049">1</span><span class="op" id="4679050">]</span><span class="op" id="4679051">}</span><span class="op" id="4679052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4679057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679061">case</span>&nbsp;<span class="ident" id="4679066">cbTC8</span><span class="op" id="4679071">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679076">pix</span><span class="op" id="4679079">,</span>&nbsp;<span class="ident" id="4679081">i</span><span class="op" id="4679082">,</span>&nbsp;<span class="ident" id="4679084">j</span>&nbsp;<span class="op" id="4679086">:=</span>&nbsp;<span class="ident" id="4679089">rgba</span><span class="op" id="4679093">.</span><span class="ident" id="4679094">Pix</span><span class="op" id="4679097">,</span>&nbsp;<span class="ident" id="4679099">pixOffset</span><span class="op" id="4679108">,</span>&nbsp;<span class="num" id="4679110">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679115">for</span>&nbsp;<span class="ident" id="4679119">x</span>&nbsp;<span class="op" id="4679121">:=</span>&nbsp;<span class="num" id="4679124">0</span><span class="op" id="4679125">;</span>&nbsp;<span class="ident" id="4679127">x</span>&nbsp;<span class="op" id="4679129">&lt;</span>&nbsp;<span class="ident" id="4679131">width</span><span class="op" id="4679136">;</span>&nbsp;<span class="ident" id="4679138">x</span><span class="op" id="4679139">++</span>&nbsp;<span class="op" id="4679142">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679148">pix</span><span class="op" id="4679151">[</span><span class="ident" id="4679152">i</span><span class="op" id="4679153">+</span><span class="num" id="4679154">0</span><span class="op" id="4679155">]</span>&nbsp;<span class="op" id="4679157">=</span>&nbsp;<span class="ident" id="4679159">cdat</span><span class="op" id="4679163">[</span><span class="ident" id="4679164">j</span><span class="op" id="4679165">+</span><span class="num" id="4679166">0</span><span class="op" id="4679167">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679173">pix</span><span class="op" id="4679176">[</span><span class="ident" id="4679177">i</span><span class="op" id="4679178">+</span><span class="num" id="4679179">1</span><span class="op" id="4679180">]</span>&nbsp;<span class="op" id="4679182">=</span>&nbsp;<span class="ident" id="4679184">cdat</span><span class="op" id="4679188">[</span><span class="ident" id="4679189">j</span><span class="op" id="4679190">+</span><span class="num" id="4679191">1</span><span class="op" id="4679192">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679198">pix</span><span class="op" id="4679201">[</span><span class="ident" id="4679202">i</span><span class="op" id="4679203">+</span><span class="num" id="4679204">2</span><span class="op" id="4679205">]</span>&nbsp;<span class="op" id="4679207">=</span>&nbsp;<span class="ident" id="4679209">cdat</span><span class="op" id="4679213">[</span><span class="ident" id="4679214">j</span><span class="op" id="4679215">+</span><span class="num" id="4679216">2</span><span class="op" id="4679217">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679223">pix</span><span class="op" id="4679226">[</span><span class="ident" id="4679227">i</span><span class="op" id="4679228">+</span><span class="num" id="4679229">3</span><span class="op" id="4679230">]</span>&nbsp;<span class="op" id="4679232">=</span>&nbsp;<span class="num" id="4679234">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679243">i</span>&nbsp;<span class="op" id="4679245">+=</span>&nbsp;<span class="num" id="4679248">4</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679254">j</span>&nbsp;<span class="op" id="4679256">+=</span>&nbsp;<span class="num" id="4679259">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4679264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679269">pixOffset</span>&nbsp;<span class="op" id="4679279">+=</span>&nbsp;<span class="ident" id="4679282">rgba</span><span class="op" id="4679286">.</span><span class="ident" id="4679287">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679296">case</span>&nbsp;<span class="ident" id="4679301">cbP1</span><span class="op" id="4679305">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679310">for</span>&nbsp;<span class="ident" id="4679314">x</span>&nbsp;<span class="op" id="4679316">:=</span>&nbsp;<span class="num" id="4679319">0</span><span class="op" id="4679320">;</span>&nbsp;<span class="ident" id="4679322">x</span>&nbsp;<span class="op" id="4679324">&lt;</span>&nbsp;<span class="ident" id="4679326">width</span><span class="op" id="4679331">;</span>&nbsp;<span class="ident" id="4679333">x</span>&nbsp;<span class="op" id="4679335">+=</span>&nbsp;<span class="num" id="4679338">8</span>&nbsp;<span class="op" id="4679340">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679346">b</span>&nbsp;<span class="op" id="4679348">:=</span>&nbsp;<span class="ident" id="4679351">cdat</span><span class="op" id="4679355">[</span><span class="ident" id="4679356">x</span><span class="op" id="4679357">/</span><span class="num" id="4679358">8</span><span class="op" id="4679359">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679365">for</span>&nbsp;<span class="ident" id="4679369">x2</span>&nbsp;<span class="op" id="4679372">:=</span>&nbsp;<span class="num" id="4679375">0</span><span class="op" id="4679376">;</span>&nbsp;<span class="ident" id="4679378">x2</span>&nbsp;<span class="op" id="4679381">&lt;</span>&nbsp;<span class="num" id="4679383">8</span>&nbsp;<span class="op" id="4679385">&amp;&amp;</span>&nbsp;<span class="ident" id="4679388">x</span><span class="op" id="4679389">+</span><span class="ident" id="4679390">x2</span>&nbsp;<span class="op" id="4679393">&lt;</span>&nbsp;<span class="ident" id="4679395">width</span><span class="op" id="4679400">;</span>&nbsp;<span class="ident" id="4679402">x2</span><span class="op" id="4679404">++</span>&nbsp;<span class="op" id="4679407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679414">idx</span>&nbsp;<span class="op" id="4679418">:=</span>&nbsp;<span class="ident" id="4679421">b</span>&nbsp;<span class="op" id="4679423">&gt;&gt;</span>&nbsp;<span class="num" id="4679426">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679433">if</span>&nbsp;<span class="builtinfunc" id="4679436">len</span><span class="op" id="4679439">(</span><span class="ident" id="4679440">paletted</span><span class="op" id="4679448">.</span><span class="ident" id="4679449">Palette</span><span class="op" id="4679456">)</span>&nbsp;<span class="op" id="4679458">&lt;=</span>&nbsp;<span class="builtintype" id="4679461">int</span><span class="op" id="4679464">(</span><span class="ident" id="4679465">idx</span><span class="op" id="4679468">)</span>&nbsp;<span class="op" id="4679470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679478">paletted</span><span class="op" id="4679486">.</span><span class="ident" id="4679487">Palette</span>&nbsp;<span class="op" id="4679495">=</span>&nbsp;<span class="ident" id="4679497">paletted</span><span class="op" id="4679505">.</span><span class="ident" id="4679506">Palette</span><span class="op" id="4679513">[</span><span class="op" id="4679514">:</span><span class="builtintype" id="4679515">int</span><span class="op" id="4679518">(</span><span class="ident" id="4679519">idx</span><span class="op" id="4679522">)</span><span class="op" id="4679523">+</span><span class="num" id="4679524">1</span><span class="op" id="4679525">]</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4679532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679539">paletted</span><span class="op" id="4679547">.</span><span class="ident" id="4679548">SetColorIndex</span><span class="op" id="4679561">(</span><span class="ident" id="4679562">x</span><span class="op" id="4679563">+</span><span class="ident" id="4679564">x2</span><span class="op" id="4679566">,</span>&nbsp;<span class="ident" id="4679568">y</span><span class="op" id="4679569">,</span>&nbsp;<span class="ident" id="4679571">idx</span><span class="op" id="4679574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679581">b</span>&nbsp;<span class="op" id="4679583">&lt;&lt;=</span>&nbsp;<span class="num" id="4679587">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4679593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4679598">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679602">case</span>&nbsp;<span class="ident" id="4679607">cbP2</span><span class="op" id="4679611">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679616">for</span>&nbsp;<span class="ident" id="4679620">x</span>&nbsp;<span class="op" id="4679622">:=</span>&nbsp;<span class="num" id="4679625">0</span><span class="op" id="4679626">;</span>&nbsp;<span class="ident" id="4679628">x</span>&nbsp;<span class="op" id="4679630">&lt;</span>&nbsp;<span class="ident" id="4679632">width</span><span class="op" id="4679637">;</span>&nbsp;<span class="ident" id="4679639">x</span>&nbsp;<span class="op" id="4679641">+=</span>&nbsp;<span class="num" id="4679644">4</span>&nbsp;<span class="op" id="4679646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679652">b</span>&nbsp;<span class="op" id="4679654">:=</span>&nbsp;<span class="ident" id="4679657">cdat</span><span class="op" id="4679661">[</span><span class="ident" id="4679662">x</span><span class="op" id="4679663">/</span><span class="num" id="4679664">4</span><span class="op" id="4679665">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679671">for</span>&nbsp;<span class="ident" id="4679675">x2</span>&nbsp;<span class="op" id="4679678">:=</span>&nbsp;<span class="num" id="4679681">0</span><span class="op" id="4679682">;</span>&nbsp;<span class="ident" id="4679684">x2</span>&nbsp;<span class="op" id="4679687">&lt;</span>&nbsp;<span class="num" id="4679689">4</span>&nbsp;<span class="op" id="4679691">&amp;&amp;</span>&nbsp;<span class="ident" id="4679694">x</span><span class="op" id="4679695">+</span><span class="ident" id="4679696">x2</span>&nbsp;<span class="op" id="4679699">&lt;</span>&nbsp;<span class="ident" id="4679701">width</span><span class="op" id="4679706">;</span>&nbsp;<span class="ident" id="4679708">x2</span><span class="op" id="4679710">++</span>&nbsp;<span class="op" id="4679713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679720">idx</span>&nbsp;<span class="op" id="4679724">:=</span>&nbsp;<span class="ident" id="4679727">b</span>&nbsp;<span class="op" id="4679729">&gt;&gt;</span>&nbsp;<span class="num" id="4679732">6</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679739">if</span>&nbsp;<span class="builtinfunc" id="4679742">len</span><span class="op" id="4679745">(</span><span class="ident" id="4679746">paletted</span><span class="op" id="4679754">.</span><span class="ident" id="4679755">Palette</span><span class="op" id="4679762">)</span>&nbsp;<span class="op" id="4679764">&lt;=</span>&nbsp;<span class="builtintype" id="4679767">int</span><span class="op" id="4679770">(</span><span class="ident" id="4679771">idx</span><span class="op" id="4679774">)</span>&nbsp;<span class="op" id="4679776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679784">paletted</span><span class="op" id="4679792">.</span><span class="ident" id="4679793">Palette</span>&nbsp;<span class="op" id="4679801">=</span>&nbsp;<span class="ident" id="4679803">paletted</span><span class="op" id="4679811">.</span><span class="ident" id="4679812">Palette</span><span class="op" id="4679819">[</span><span class="op" id="4679820">:</span><span class="builtintype" id="4679821">int</span><span class="op" id="4679824">(</span><span class="ident" id="4679825">idx</span><span class="op" id="4679828">)</span><span class="op" id="4679829">+</span><span class="num" id="4679830">1</span><span class="op" id="4679831">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4679838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679845">paletted</span><span class="op" id="4679853">.</span><span class="ident" id="4679854">SetColorIndex</span><span class="op" id="4679867">(</span><span class="ident" id="4679868">x</span><span class="op" id="4679869">+</span><span class="ident" id="4679870">x2</span><span class="op" id="4679872">,</span>&nbsp;<span class="ident" id="4679874">y</span><span class="op" id="4679875">,</span>&nbsp;<span class="ident" id="4679877">idx</span><span class="op" id="4679880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679887">b</span>&nbsp;<span class="op" id="4679889">&lt;&lt;=</span>&nbsp;<span class="num" id="4679893">2</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4679899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4679904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679908">case</span>&nbsp;<span class="ident" id="4679913">cbP4</span><span class="op" id="4679917">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679922">for</span>&nbsp;<span class="ident" id="4679926">x</span>&nbsp;<span class="op" id="4679928">:=</span>&nbsp;<span class="num" id="4679931">0</span><span class="op" id="4679932">;</span>&nbsp;<span class="ident" id="4679934">x</span>&nbsp;<span class="op" id="4679936">&lt;</span>&nbsp;<span class="ident" id="4679938">width</span><span class="op" id="4679943">;</span>&nbsp;<span class="ident" id="4679945">x</span>&nbsp;<span class="op" id="4679947">+=</span>&nbsp;<span class="num" id="4679950">2</span>&nbsp;<span class="op" id="4679952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679958">b</span>&nbsp;<span class="op" id="4679960">:=</span>&nbsp;<span class="ident" id="4679963">cdat</span><span class="op" id="4679967">[</span><span class="ident" id="4679968">x</span><span class="op" id="4679969">/</span><span class="num" id="4679970">2</span><span class="op" id="4679971">]</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679977">for</span>&nbsp;<span class="ident" id="4679981">x2</span>&nbsp;<span class="op" id="4679984">:=</span>&nbsp;<span class="num" id="4679987">0</span><span class="op" id="4679988">;</span>&nbsp;<span class="ident" id="4679990">x2</span>&nbsp;<span class="op" id="4679993">&lt;</span>&nbsp;<span class="num" id="4679995">2</span>&nbsp;<span class="op" id="4679997">&amp;&amp;</span>&nbsp;<span class="ident" id="4680000">x</span><span class="op" id="4680001">+</span><span class="ident" id="4680002">x2</span>&nbsp;<span class="op" id="4680005">&lt;</span>&nbsp;<span class="ident" id="4680007">width</span><span class="op" id="4680012">;</span>&nbsp;<span class="ident" id="4680014">x2</span><span class="op" id="4680016">++</span>&nbsp;<span class="op" id="4680019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680026">idx</span>&nbsp;<span class="op" id="4680030">:=</span>&nbsp;<span class="ident" id="4680033">b</span>&nbsp;<span class="op" id="4680035">&gt;&gt;</span>&nbsp;<span class="num" id="4680038">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680045">if</span>&nbsp;<span class="builtinfunc" id="4680048">len</span><span class="op" id="4680051">(</span><span class="ident" id="4680052">paletted</span><span class="op" id="4680060">.</span><span class="ident" id="4680061">Palette</span><span class="op" id="4680068">)</span>&nbsp;<span class="op" id="4680070">&lt;=</span>&nbsp;<span class="builtintype" id="4680073">int</span><span class="op" id="4680076">(</span><span class="ident" id="4680077">idx</span><span class="op" id="4680080">)</span>&nbsp;<span class="op" id="4680082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680090">paletted</span><span class="op" id="4680098">.</span><span class="ident" id="4680099">Palette</span>&nbsp;<span class="op" id="4680107">=</span>&nbsp;<span class="ident" id="4680109">paletted</span><span class="op" id="4680117">.</span><span class="ident" id="4680118">Palette</span><span class="op" id="4680125">[</span><span class="op" id="4680126">:</span><span class="builtintype" id="4680127">int</span><span class="op" id="4680130">(</span><span class="ident" id="4680131">idx</span><span class="op" id="4680134">)</span><span class="op" id="4680135">+</span><span class="num" id="4680136">1</span><span class="op" id="4680137">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4680144">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680151">paletted</span><span class="op" id="4680159">.</span><span class="ident" id="4680160">SetColorIndex</span><span class="op" id="4680173">(</span><span class="ident" id="4680174">x</span><span class="op" id="4680175">+</span><span class="ident" id="4680176">x2</span><span class="op" id="4680178">,</span>&nbsp;<span class="ident" id="4680180">y</span><span class="op" id="4680181">,</span>&nbsp;<span class="ident" id="4680183">idx</span><span class="op" id="4680186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680193">b</span>&nbsp;<span class="op" id="4680195">&lt;&lt;=</span>&nbsp;<span class="num" id="4680199">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4680205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4680210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680214">case</span>&nbsp;<span class="ident" id="4680219">cbP8</span><span class="op" id="4680223">:</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680228">if</span>&nbsp;<span class="builtinfunc" id="4680231">len</span><span class="op" id="4680234">(</span><span class="ident" id="4680235">paletted</span><span class="op" id="4680243">.</span><span class="ident" id="4680244">Palette</span><span class="op" id="4680251">)</span>&nbsp;<span class="op" id="4680253">!=</span>&nbsp;<span class="num" id="4680256">255</span>&nbsp;<span class="op" id="4680260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680266">for</span>&nbsp;<span class="ident" id="4680270">x</span>&nbsp;<span class="op" id="4680272">:=</span>&nbsp;<span class="num" id="4680275">0</span><span class="op" id="4680276">;</span>&nbsp;<span class="ident" id="4680278">x</span>&nbsp;<span class="op" id="4680280">&lt;</span>&nbsp;<span class="ident" id="4680282">width</span><span class="op" id="4680287">;</span>&nbsp;<span class="ident" id="4680289">x</span><span class="op" id="4680290">++</span>&nbsp;<span class="op" id="4680293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680300">if</span>&nbsp;<span class="builtinfunc" id="4680303">len</span><span class="op" id="4680306">(</span><span class="ident" id="4680307">paletted</span><span class="op" id="4680315">.</span><span class="ident" id="4680316">Palette</span><span class="op" id="4680323">)</span>&nbsp;<span class="op" id="4680325">&lt;=</span>&nbsp;<span class="builtintype" id="4680328">int</span><span class="op" id="4680331">(</span><span class="ident" id="4680332">cdat</span><span class="op" id="4680336">[</span><span class="ident" id="4680337">x</span><span class="op" id="4680338">]</span><span class="op" id="4680339">)</span>&nbsp;<span class="op" id="4680341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680349">paletted</span><span class="op" id="4680357">.</span><span class="ident" id="4680358">Palette</span>&nbsp;<span class="op" id="4680366">=</span>&nbsp;<span class="ident" id="4680368">paletted</span><span class="op" id="4680376">.</span><span class="ident" id="4680377">Palette</span><span class="op" id="4680384">[</span><span class="op" id="4680385">:</span><span class="builtintype" id="4680386">int</span><span class="op" id="4680389">(</span><span class="ident" id="4680390">cdat</span><span class="op" id="4680394">[</span><span class="ident" id="4680395">x</span><span class="op" id="4680396">]</span><span class="op" id="4680397">)</span><span class="op" id="4680398">+</span><span class="num" id="4680399">1</span><span class="op" id="4680400">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4680407">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4680413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4680418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4680423">copy</span><span class="op" id="4680427">(</span><span class="ident" id="4680428">paletted</span><span class="op" id="4680436">.</span><span class="ident" id="4680437">Pix</span><span class="op" id="4680440">[</span><span class="ident" id="4680441">pixOffset</span><span class="op" id="4680450">:</span><span class="op" id="4680451">]</span><span class="op" id="4680452">,</span>&nbsp;<span class="ident" id="4680454">cdat</span><span class="op" id="4680458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680463">pixOffset</span>&nbsp;<span class="op" id="4680473">+=</span>&nbsp;<span class="ident" id="4680476">paletted</span><span class="op" id="4680484">.</span><span class="ident" id="4680485">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680494">case</span>&nbsp;<span class="ident" id="4680499">cbTCA8</span><span class="op" id="4680505">:</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4680510">copy</span><span class="op" id="4680514">(</span><span class="ident" id="4680515">nrgba</span><span class="op" id="4680520">.</span><span class="ident" id="4680521">Pix</span><span class="op" id="4680524">[</span><span class="ident" id="4680525">pixOffset</span><span class="op" id="4680534">:</span><span class="op" id="4680535">]</span><span class="op" id="4680536">,</span>&nbsp;<span class="ident" id="4680538">cdat</span><span class="op" id="4680542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680547">pixOffset</span>&nbsp;<span class="op" id="4680557">+=</span>&nbsp;<span class="ident" id="4680560">nrgba</span><span class="op" id="4680565">.</span><span class="ident" id="4680566">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680575">case</span>&nbsp;<span class="ident" id="4680580">cbG16</span><span class="op" id="4680585">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680590">for</span>&nbsp;<span class="ident" id="4680594">x</span>&nbsp;<span class="op" id="4680596">:=</span>&nbsp;<span class="num" id="4680599">0</span><span class="op" id="4680600">;</span>&nbsp;<span class="ident" id="4680602">x</span>&nbsp;<span class="op" id="4680604">&lt;</span>&nbsp;<span class="ident" id="4680606">width</span><span class="op" id="4680611">;</span>&nbsp;<span class="ident" id="4680613">x</span><span class="op" id="4680614">++</span>&nbsp;<span class="op" id="4680617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680623">ycol</span>&nbsp;<span class="op" id="4680628">:=</span>&nbsp;<span class="builtintype" id="4680631">uint16</span><span class="op" id="4680637">(</span><span class="ident" id="4680638">cdat</span><span class="op" id="4680642">[</span><span class="num" id="4680643">2</span><span class="op" id="4680644">*</span><span class="ident" id="4680645">x</span><span class="op" id="4680646">+</span><span class="num" id="4680647">0</span><span class="op" id="4680648">]</span><span class="op" id="4680649">)</span><span class="op" id="4680650">&lt;&lt;</span><span class="num" id="4680652">8</span>&nbsp;<span class="op" id="4680654">|</span>&nbsp;<span class="builtintype" id="4680656">uint16</span><span class="op" id="4680662">(</span><span class="ident" id="4680663">cdat</span><span class="op" id="4680667">[</span><span class="num" id="4680668">2</span><span class="op" id="4680669">*</span><span class="ident" id="4680670">x</span><span class="op" id="4680671">+</span><span class="num" id="4680672">1</span><span class="op" id="4680673">]</span><span class="op" id="4680674">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680680">gray16</span><span class="op" id="4680686">.</span><span class="ident" id="4680687">SetGray16</span><span class="op" id="4680696">(</span><span class="ident" id="4680697">x</span><span class="op" id="4680698">,</span>&nbsp;<span class="ident" id="4680700">y</span><span class="op" id="4680701">,</span>&nbsp;<span class="ident" id="4680703">color</span><span class="op" id="4680708">.</span><span class="ident" id="4680709">Gray16</span><span class="op" id="4680715">{</span><span class="ident" id="4680716">ycol</span><span class="op" id="4680720">}</span><span class="op" id="4680721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4680726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680730">case</span>&nbsp;<span class="ident" id="4680735">cbGA16</span><span class="op" id="4680741">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680746">for</span>&nbsp;<span class="ident" id="4680750">x</span>&nbsp;<span class="op" id="4680752">:=</span>&nbsp;<span class="num" id="4680755">0</span><span class="op" id="4680756">;</span>&nbsp;<span class="ident" id="4680758">x</span>&nbsp;<span class="op" id="4680760">&lt;</span>&nbsp;<span class="ident" id="4680762">width</span><span class="op" id="4680767">;</span>&nbsp;<span class="ident" id="4680769">x</span><span class="op" id="4680770">++</span>&nbsp;<span class="op" id="4680773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680779">ycol</span>&nbsp;<span class="op" id="4680784">:=</span>&nbsp;<span class="builtintype" id="4680787">uint16</span><span class="op" id="4680793">(</span><span class="ident" id="4680794">cdat</span><span class="op" id="4680798">[</span><span class="num" id="4680799">4</span><span class="op" id="4680800">*</span><span class="ident" id="4680801">x</span><span class="op" id="4680802">+</span><span class="num" id="4680803">0</span><span class="op" id="4680804">]</span><span class="op" id="4680805">)</span><span class="op" id="4680806">&lt;&lt;</span><span class="num" id="4680808">8</span>&nbsp;<span class="op" id="4680810">|</span>&nbsp;<span class="builtintype" id="4680812">uint16</span><span class="op" id="4680818">(</span><span class="ident" id="4680819">cdat</span><span class="op" id="4680823">[</span><span class="num" id="4680824">4</span><span class="op" id="4680825">*</span><span class="ident" id="4680826">x</span><span class="op" id="4680827">+</span><span class="num" id="4680828">1</span><span class="op" id="4680829">]</span><span class="op" id="4680830">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680836">acol</span>&nbsp;<span class="op" id="4680841">:=</span>&nbsp;<span class="builtintype" id="4680844">uint16</span><span class="op" id="4680850">(</span><span class="ident" id="4680851">cdat</span><span class="op" id="4680855">[</span><span class="num" id="4680856">4</span><span class="op" id="4680857">*</span><span class="ident" id="4680858">x</span><span class="op" id="4680859">+</span><span class="num" id="4680860">2</span><span class="op" id="4680861">]</span><span class="op" id="4680862">)</span><span class="op" id="4680863">&lt;&lt;</span><span class="num" id="4680865">8</span>&nbsp;<span class="op" id="4680867">|</span>&nbsp;<span class="builtintype" id="4680869">uint16</span><span class="op" id="4680875">(</span><span class="ident" id="4680876">cdat</span><span class="op" id="4680880">[</span><span class="num" id="4680881">4</span><span class="op" id="4680882">*</span><span class="ident" id="4680883">x</span><span class="op" id="4680884">+</span><span class="num" id="4680885">3</span><span class="op" id="4680886">]</span><span class="op" id="4680887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680893">nrgba64</span><span class="op" id="4680900">.</span><span class="ident" id="4680901">SetNRGBA64</span><span class="op" id="4680911">(</span><span class="ident" id="4680912">x</span><span class="op" id="4680913">,</span>&nbsp;<span class="ident" id="4680915">y</span><span class="op" id="4680916">,</span>&nbsp;<span class="ident" id="4680918">color</span><span class="op" id="4680923">.</span><span class="ident" id="4680924">NRGBA64</span><span class="op" id="4680931">{</span><span class="ident" id="4680932">ycol</span><span class="op" id="4680936">,</span>&nbsp;<span class="ident" id="4680938">ycol</span><span class="op" id="4680942">,</span>&nbsp;<span class="ident" id="4680944">ycol</span><span class="op" id="4680948">,</span>&nbsp;<span class="ident" id="4680950">acol</span><span class="op" id="4680954">}</span><span class="op" id="4680955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4680960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680964">case</span>&nbsp;<span class="ident" id="4680969">cbTC16</span><span class="op" id="4680975">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680980">for</span>&nbsp;<span class="ident" id="4680984">x</span>&nbsp;<span class="op" id="4680986">:=</span>&nbsp;<span class="num" id="4680989">0</span><span class="op" id="4680990">;</span>&nbsp;<span class="ident" id="4680992">x</span>&nbsp;<span class="op" id="4680994">&lt;</span>&nbsp;<span class="ident" id="4680996">width</span><span class="op" id="4681001">;</span>&nbsp;<span class="ident" id="4681003">x</span><span class="op" id="4681004">++</span>&nbsp;<span class="op" id="4681007">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681013">rcol</span>&nbsp;<span class="op" id="4681018">:=</span>&nbsp;<span class="builtintype" id="4681021">uint16</span><span class="op" id="4681027">(</span><span class="ident" id="4681028">cdat</span><span class="op" id="4681032">[</span><span class="num" id="4681033">6</span><span class="op" id="4681034">*</span><span class="ident" id="4681035">x</span><span class="op" id="4681036">+</span><span class="num" id="4681037">0</span><span class="op" id="4681038">]</span><span class="op" id="4681039">)</span><span class="op" id="4681040">&lt;&lt;</span><span class="num" id="4681042">8</span>&nbsp;<span class="op" id="4681044">|</span>&nbsp;<span class="builtintype" id="4681046">uint16</span><span class="op" id="4681052">(</span><span class="ident" id="4681053">cdat</span><span class="op" id="4681057">[</span><span class="num" id="4681058">6</span><span class="op" id="4681059">*</span><span class="ident" id="4681060">x</span><span class="op" id="4681061">+</span><span class="num" id="4681062">1</span><span class="op" id="4681063">]</span><span class="op" id="4681064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681070">gcol</span>&nbsp;<span class="op" id="4681075">:=</span>&nbsp;<span class="builtintype" id="4681078">uint16</span><span class="op" id="4681084">(</span><span class="ident" id="4681085">cdat</span><span class="op" id="4681089">[</span><span class="num" id="4681090">6</span><span class="op" id="4681091">*</span><span class="ident" id="4681092">x</span><span class="op" id="4681093">+</span><span class="num" id="4681094">2</span><span class="op" id="4681095">]</span><span class="op" id="4681096">)</span><span class="op" id="4681097">&lt;&lt;</span><span class="num" id="4681099">8</span>&nbsp;<span class="op" id="4681101">|</span>&nbsp;<span class="builtintype" id="4681103">uint16</span><span class="op" id="4681109">(</span><span class="ident" id="4681110">cdat</span><span class="op" id="4681114">[</span><span class="num" id="4681115">6</span><span class="op" id="4681116">*</span><span class="ident" id="4681117">x</span><span class="op" id="4681118">+</span><span class="num" id="4681119">3</span><span class="op" id="4681120">]</span><span class="op" id="4681121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681127">bcol</span>&nbsp;<span class="op" id="4681132">:=</span>&nbsp;<span class="builtintype" id="4681135">uint16</span><span class="op" id="4681141">(</span><span class="ident" id="4681142">cdat</span><span class="op" id="4681146">[</span><span class="num" id="4681147">6</span><span class="op" id="4681148">*</span><span class="ident" id="4681149">x</span><span class="op" id="4681150">+</span><span class="num" id="4681151">4</span><span class="op" id="4681152">]</span><span class="op" id="4681153">)</span><span class="op" id="4681154">&lt;&lt;</span><span class="num" id="4681156">8</span>&nbsp;<span class="op" id="4681158">|</span>&nbsp;<span class="builtintype" id="4681160">uint16</span><span class="op" id="4681166">(</span><span class="ident" id="4681167">cdat</span><span class="op" id="4681171">[</span><span class="num" id="4681172">6</span><span class="op" id="4681173">*</span><span class="ident" id="4681174">x</span><span class="op" id="4681175">+</span><span class="num" id="4681176">5</span><span class="op" id="4681177">]</span><span class="op" id="4681178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681184">rgba64</span><span class="op" id="4681190">.</span><span class="ident" id="4681191">SetRGBA64</span><span class="op" id="4681200">(</span><span class="ident" id="4681201">x</span><span class="op" id="4681202">,</span>&nbsp;<span class="ident" id="4681204">y</span><span class="op" id="4681205">,</span>&nbsp;<span class="ident" id="4681207">color</span><span class="op" id="4681212">.</span><span class="ident" id="4681213">RGBA64</span><span class="op" id="4681219">{</span><span class="ident" id="4681220">rcol</span><span class="op" id="4681224">,</span>&nbsp;<span class="ident" id="4681226">gcol</span><span class="op" id="4681230">,</span>&nbsp;<span class="ident" id="4681232">bcol</span><span class="op" id="4681236">,</span>&nbsp;<span class="num" id="4681238">0xffff</span><span class="op" id="4681244">}</span><span class="op" id="4681245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4681250">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4681254">case</span>&nbsp;<span class="ident" id="4681259">cbTCA16</span><span class="op" id="4681266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4681271">for</span>&nbsp;<span class="ident" id="4681275">x</span>&nbsp;<span class="op" id="4681277">:=</span>&nbsp;<span class="num" id="4681280">0</span><span class="op" id="4681281">;</span>&nbsp;<span class="ident" id="4681283">x</span>&nbsp;<span class="op" id="4681285">&lt;</span>&nbsp;<span class="ident" id="4681287">width</span><span class="op" id="4681292">;</span>&nbsp;<span class="ident" id="4681294">x</span><span class="op" id="4681295">++</span>&nbsp;<span class="op" id="4681298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681304">rcol</span>&nbsp;<span class="op" id="4681309">:=</span>&nbsp;<span class="builtintype" id="4681312">uint16</span><span class="op" id="4681318">(</span><span class="ident" id="4681319">cdat</span><span class="op" id="4681323">[</span><span class="num" id="4681324">8</span><span class="op" id="4681325">*</span><span class="ident" id="4681326">x</span><span class="op" id="4681327">+</span><span class="num" id="4681328">0</span><span class="op" id="4681329">]</span><span class="op" id="4681330">)</span><span class="op" id="4681331">&lt;&lt;</span><span class="num" id="4681333">8</span>&nbsp;<span class="op" id="4681335">|</span>&nbsp;<span class="builtintype" id="4681337">uint16</span><span class="op" id="4681343">(</span><span class="ident" id="4681344">cdat</span><span class="op" id="4681348">[</span><span class="num" id="4681349">8</span><span class="op" id="4681350">*</span><span class="ident" id="4681351">x</span><span class="op" id="4681352">+</span><span class="num" id="4681353">1</span><span class="op" id="4681354">]</span><span class="op" id="4681355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681361">gcol</span>&nbsp;<span class="op" id="4681366">:=</span>&nbsp;<span class="builtintype" id="4681369">uint16</span><span class="op" id="4681375">(</span><span class="ident" id="4681376">cdat</span><span class="op" id="4681380">[</span><span class="num" id="4681381">8</span><span class="op" id="4681382">*</span><span class="ident" id="4681383">x</span><span class="op" id="4681384">+</span><span class="num" id="4681385">2</span><span class="op" id="4681386">]</span><span class="op" id="4681387">)</span><span class="op" id="4681388">&lt;&lt;</span><span class="num" id="4681390">8</span>&nbsp;<span class="op" id="4681392">|</span>&nbsp;<span class="builtintype" id="4681394">uint16</span><span class="op" id="4681400">(</span><span class="ident" id="4681401">cdat</span><span class="op" id="4681405">[</span><span class="num" id="4681406">8</span><span class="op" id="4681407">*</span><span class="ident" id="4681408">x</span><span class="op" id="4681409">+</span><span class="num" id="4681410">3</span><span class="op" id="4681411">]</span><span class="op" id="4681412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681418">bcol</span>&nbsp;<span class="op" id="4681423">:=</span>&nbsp;<span class="builtintype" id="4681426">uint16</span><span class="op" id="4681432">(</span><span class="ident" id="4681433">cdat</span><span class="op" id="4681437">[</span><span class="num" id="4681438">8</span><span class="op" id="4681439">*</span><span class="ident" id="4681440">x</span><span class="op" id="4681441">+</span><span class="num" id="4681442">4</span><span class="op" id="4681443">]</span><span class="op" id="4681444">)</span><span class="op" id="4681445">&lt;&lt;</span><span class="num" id="4681447">8</span>&nbsp;<span class="op" id="4681449">|</span>&nbsp;<span class="builtintype" id="4681451">uint16</span><span class="op" id="4681457">(</span><span class="ident" id="4681458">cdat</span><span class="op" id="4681462">[</span><span class="num" id="4681463">8</span><span class="op" id="4681464">*</span><span class="ident" id="4681465">x</span><span class="op" id="4681466">+</span><span class="num" id="4681467">5</span><span class="op" id="4681468">]</span><span class="op" id="4681469">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681475">acol</span>&nbsp;<span class="op" id="4681480">:=</span>&nbsp;<span class="builtintype" id="4681483">uint16</span><span class="op" id="4681489">(</span><span class="ident" id="4681490">cdat</span><span class="op" id="4681494">[</span><span class="num" id="4681495">8</span><span class="op" id="4681496">*</span><span class="ident" id="4681497">x</span><span class="op" id="4681498">+</span><span class="num" id="4681499">6</span><span class="op" id="4681500">]</span><span class="op" id="4681501">)</span><span class="op" id="4681502">&lt;&lt;</span><span class="num" id="4681504">8</span>&nbsp;<span class="op" id="4681506">|</span>&nbsp;<span class="builtintype" id="4681508">uint16</span><span class="op" id="4681514">(</span><span class="ident" id="4681515">cdat</span><span class="op" id="4681519">[</span><span class="num" id="4681520">8</span><span class="op" id="4681521">*</span><span class="ident" id="4681522">x</span><span class="op" id="4681523">+</span><span class="num" id="4681524">7</span><span class="op" id="4681525">]</span><span class="op" id="4681526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681532">nrgba64</span><span class="op" id="4681539">.</span><span class="ident" id="4681540">SetNRGBA64</span><span class="op" id="4681550">(</span><span class="ident" id="4681551">x</span><span class="op" id="4681552">,</span>&nbsp;<span class="ident" id="4681554">y</span><span class="op" id="4681555">,</span>&nbsp;<span class="ident" id="4681557">color</span><span class="op" id="4681562">.</span><span class="ident" id="4681563">NRGBA64</span><span class="op" id="4681570">{</span><span class="ident" id="4681571">rcol</span><span class="op" id="4681575">,</span>&nbsp;<span class="ident" id="4681577">gcol</span><span class="op" id="4681581">,</span>&nbsp;<span class="ident" id="4681583">bcol</span><span class="op" id="4681587">,</span>&nbsp;<span class="ident" id="4681589">acol</span><span class="op" id="4681593">}</span><span class="op" id="4681594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4681599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4681603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4681608">//&nbsp;The&nbsp;current&nbsp;row&nbsp;for&nbsp;y&nbsp;is&nbsp;the&nbsp;previous&nbsp;row&nbsp;for&nbsp;y+1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681664">pr</span><span class="op" id="4681666">,</span>&nbsp;<span class="ident" id="4681668">cr</span>&nbsp;<span class="op" id="4681671">=</span>&nbsp;<span class="ident" id="4681673">cr</span><span class="op" id="4681675">,</span>&nbsp;<span class="ident" id="4681677">pr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4681681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4681685">return</span>&nbsp;<span class="ident" id="4681692">img</span><span class="op" id="4681695">,</span>&nbsp;<span class="ident" id="4681697">nil</span><br>
<span class="lineno">585</span><span class="op" id="4681701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4681704">//&nbsp;mergePassInto&nbsp;merges&nbsp;a&nbsp;single&nbsp;pass&nbsp;into&nbsp;a&nbsp;full&nbsp;sized&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4681767">func</span>&nbsp;<span class="op" id="4681772">(</span><span class="ident" id="4681773">d</span>&nbsp;<span class="op" id="4681775">*</span><span class="ident" id="4681776">decoder</span><span class="op" id="4681783">)</span>&nbsp;<span class="ident" id="4681785">mergePassInto</span><span class="op" id="4681798">(</span><span class="ident" id="4681799">dst</span>&nbsp;<span class="ident" id="4681803">image</span><span class="op" id="4681808">.</span><span class="ident" id="4681809">Image</span><span class="op" id="4681814">,</span>&nbsp;<span class="ident" id="4681816">src</span>&nbsp;<span class="ident" id="4681820">image</span><span class="op" id="4681825">.</span><span class="ident" id="4681826">Image</span><span class="op" id="4681831">,</span>&nbsp;<span class="ident" id="4681833">pass</span>&nbsp;<span class="builtintype" id="4681838">int</span><span class="op" id="4681841">)</span>&nbsp;<span class="op" id="4681843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681846">p</span>&nbsp;<span class="op" id="4681848">:=</span>&nbsp;<span class="ident" id="4681851">interlacing</span><span class="op" id="4681862">[</span><span class="ident" id="4681863">pass</span><span class="op" id="4681867">]</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4681870">var</span>&nbsp;<span class="op" id="4681874">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681878">srcPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4681892">[</span><span class="op" id="4681893">]</span><span class="builtintype" id="4681894">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681902">dstPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4681916">[</span><span class="op" id="4681917">]</span><span class="builtintype" id="4681918">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681926">stride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4681940">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681946">rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4681960">image</span><span class="op" id="4681965">.</span><span class="ident" id="4681966">Rectangle</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681978">bytesPerPixel</span>&nbsp;<span class="builtintype" id="4681992">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4681997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4682000">switch</span>&nbsp;<span class="ident" id="4682007">target</span>&nbsp;<span class="op" id="4682014">:=</span>&nbsp;<span class="ident" id="4682017">dst</span><span class="op" id="4682020">.</span><span class="op" id="4682021">(</span><span class="keyword" id="4682022">type</span><span class="op" id="4682026">)</span>&nbsp;<span class="op" id="4682028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4682031">case</span>&nbsp;<span class="op" id="4682036">*</span><span class="ident" id="4682037">image</span><span class="op" id="4682042">.</span><span class="ident" id="4682043">Alpha</span><span class="op" id="4682048">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682052">srcPix</span>&nbsp;<span class="op" id="4682059">=</span>&nbsp;<span class="ident" id="4682061">src</span><span class="op" id="4682064">.</span><span class="op" id="4682065">(</span><span class="op" id="4682066">*</span><span class="ident" id="4682067">image</span><span class="op" id="4682072">.</span><span class="ident" id="4682073">Alpha</span><span class="op" id="4682078">)</span><span class="op" id="4682079">.</span><span class="ident" id="4682080">Pix</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682086">dstPix</span><span class="op" id="4682092">,</span>&nbsp;<span class="ident" id="4682094">stride</span><span class="op" id="4682100">,</span>&nbsp;<span class="ident" id="4682102">rect</span>&nbsp;<span class="op" id="4682107">=</span>&nbsp;<span class="ident" id="4682109">target</span><span class="op" id="4682115">.</span><span class="ident" id="4682116">Pix</span><span class="op" id="4682119">,</span>&nbsp;<span class="ident" id="4682121">target</span><span class="op" id="4682127">.</span><span class="ident" id="4682128">Stride</span><span class="op" id="4682134">,</span>&nbsp;<span class="ident" id="4682136">target</span><span class="op" id="4682142">.</span><span class="ident" id="4682143">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682150">bytesPerPixel</span>&nbsp;<span class="op" id="4682164">=</span>&nbsp;<span class="num" id="4682166">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4682169">case</span>&nbsp;<span class="op" id="4682174">*</span><span class="ident" id="4682175">image</span><span class="op" id="4682180">.</span><span class="ident" id="4682181">Alpha16</span><span class="op" id="4682188">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682192">srcPix</span>&nbsp;<span class="op" id="4682199">=</span>&nbsp;<span class="ident" id="4682201">src</span><span class="op" id="4682204">.</span><span class="op" id="4682205">(</span><span class="op" id="4682206">*</span><span class="ident" id="4682207">image</span><span class="op" id="4682212">.</span><span class="ident" id="4682213">Alpha16</span><span class="op" id="4682220">)</span><span class="op" id="4682221">.</span><span class="ident" id="4682222">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682228">dstPix</span><span class="op" id="4682234">,</span>&nbsp;<span class="ident" id="4682236">stride</span><span class="op" id="4682242">,</span>&nbsp;<span class="ident" id="4682244">rect</span>&nbsp;<span class="op" id="4682249">=</span>&nbsp;<span class="ident" id="4682251">target</span><span class="op" id="4682257">.</span><span class="ident" id="4682258">Pix</span><span class="op" id="4682261">,</span>&nbsp;<span class="ident" id="4682263">target</span><span class="op" id="4682269">.</span><span class="ident" id="4682270">Stride</span><span class="op" id="4682276">,</span>&nbsp;<span class="ident" id="4682278">target</span><span class="op" id="4682284">.</span><span class="ident" id="4682285">Rect</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682292">bytesPerPixel</span>&nbsp;<span class="op" id="4682306">=</span>&nbsp;<span class="num" id="4682308">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4682311">case</span>&nbsp;<span class="op" id="4682316">*</span><span class="ident" id="4682317">image</span><span class="op" id="4682322">.</span><span class="ident" id="4682323">Gray</span><span class="op" id="4682327">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682331">srcPix</span>&nbsp;<span class="op" id="4682338">=</span>&nbsp;<span class="ident" id="4682340">src</span><span class="op" id="4682343">.</span><span class="op" id="4682344">(</span><span class="op" id="4682345">*</span><span class="ident" id="4682346">image</span><span class="op" id="4682351">.</span><span class="ident" id="4682352">Gray</span><span class="op" id="4682356">)</span><span class="op" id="4682357">.</span><span class="ident" id="4682358">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682364">dstPix</span><span class="op" id="4682370">,</span>&nbsp;<span class="ident" id="4682372">stride</span><span class="op" id="4682378">,</span>&nbsp;<span class="ident" id="4682380">rect</span>&nbsp;<span class="op" id="4682385">=</span>&nbsp;<span class="ident" id="4682387">target</span><span class="op" id="4682393">.</span><span class="ident" id="4682394">Pix</span><span class="op" id="4682397">,</span>&nbsp;<span class="ident" id="4682399">target</span><span class="op" id="4682405">.</span><span class="ident" id="4682406">Stride</span><span class="op" id="4682412">,</span>&nbsp;<span class="ident" id="4682414">target</span><span class="op" id="4682420">.</span><span class="ident" id="4682421">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682428">bytesPerPixel</span>&nbsp;<span class="op" id="4682442">=</span>&nbsp;<span class="num" id="4682444">1</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4682447">case</span>&nbsp;<span class="op" id="4682452">*</span><span class="ident" id="4682453">image</span><span class="op" id="4682458">.</span><span class="ident" id="4682459">Gray16</span><span class="op" id="4682465">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682469">srcPix</span>&nbsp;<span class="op" id="4682476">=</span>&nbsp;<span class="ident" id="4682478">src</span><span class="op" id="4682481">.</span><span class="op" id="4682482">(</span><span class="op" id="4682483">*</span><span class="ident" id="4682484">image</span><span class="op" id="4682489">.</span><span class="ident" id="4682490">Gray16</span><span class="op" id="4682496">)</span><span class="op" id="4682497">.</span><span class="ident" id="4682498">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682504">dstPix</span><span class="op" id="4682510">,</span>&nbsp;<span class="ident" id="4682512">stride</span><span class="op" id="4682518">,</span>&nbsp;<span class="ident" id="4682520">rect</span>&nbsp;<span class="op" id="4682525">=</span>&nbsp;<span class="ident" id="4682527">target</span><span class="op" id="4682533">.</span><span class="ident" id="4682534">Pix</span><span class="op" id="4682537">,</span>&nbsp;<span class="ident" id="4682539">target</span><span class="op" id="4682545">.</span><span class="ident" id="4682546">Stride</span><span class="op" id="4682552">,</span>&nbsp;<span class="ident" id="4682554">target</span><span class="op" id="4682560">.</span><span class="ident" id="4682561">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682568">bytesPerPixel</span>&nbsp;<span class="op" id="4682582">=</span>&nbsp;<span class="num" id="4682584">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4682587">case</span>&nbsp;<span class="op" id="4682592">*</span><span class="ident" id="4682593">image</span><span class="op" id="4682598">.</span><span class="ident" id="4682599">NRGBA</span><span class="op" id="4682604">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682608">srcPix</span>&nbsp;<span class="op" id="4682615">=</span>&nbsp;<span class="ident" id="4682617">src</span><span class="op" id="4682620">.</span><span class="op" id="4682621">(</span><span class="op" id="4682622">*</span><span class="ident" id="4682623">image</span><span class="op" id="4682628">.</span><span class="ident" id="4682629">NRGBA</span><span class="op" id="4682634">)</span><span class="op" id="4682635">.</span><span class="ident" id="4682636">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682642">dstPix</span><span class="op" id="4682648">,</span>&nbsp;<span class="ident" id="4682650">stride</span><span class="op" id="4682656">,</span>&nbsp;<span class="ident" id="4682658">rect</span>&nbsp;<span class="op" id="4682663">=</span>&nbsp;<span class="ident" id="4682665">target</span><span class="op" id="4682671">.</span><span class="ident" id="4682672">Pix</span><span class="op" id="4682675">,</span>&nbsp;<span class="ident" id="4682677">target</span><span class="op" id="4682683">.</span><span class="ident" id="4682684">Stride</span><span class="op" id="4682690">,</span>&nbsp;<span class="ident" id="4682692">target</span><span class="op" id="4682698">.</span><span class="ident" id="4682699">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682706">bytesPerPixel</span>&nbsp;<span class="op" id="4682720">=</span>&nbsp;<span class="num" id="4682722">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4682725">case</span>&nbsp;<span class="op" id="4682730">*</span><span class="ident" id="4682731">image</span><span class="op" id="4682736">.</span><span class="ident" id="4682737">NRGBA64</span><span class="op" id="4682744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682748">srcPix</span>&nbsp;<span class="op" id="4682755">=</span>&nbsp;<span class="ident" id="4682757">src</span><span class="op" id="4682760">.</span><span class="op" id="4682761">(</span><span class="op" id="4682762">*</span><span class="ident" id="4682763">image</span><span class="op" id="4682768">.</span><span class="ident" id="4682769">NRGBA64</span><span class="op" id="4682776">)</span><span class="op" id="4682777">.</span><span class="ident" id="4682778">Pix</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682784">dstPix</span><span class="op" id="4682790">,</span>&nbsp;<span class="ident" id="4682792">stride</span><span class="op" id="4682798">,</span>&nbsp;<span class="ident" id="4682800">rect</span>&nbsp;<span class="op" id="4682805">=</span>&nbsp;<span class="ident" id="4682807">target</span><span class="op" id="4682813">.</span><span class="ident" id="4682814">Pix</span><span class="op" id="4682817">,</span>&nbsp;<span class="ident" id="4682819">target</span><span class="op" id="4682825">.</span><span class="ident" id="4682826">Stride</span><span class="op" id="4682832">,</span>&nbsp;<span class="ident" id="4682834">target</span><span class="op" id="4682840">.</span><span class="ident" id="4682841">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682848">bytesPerPixel</span>&nbsp;<span class="op" id="4682862">=</span>&nbsp;<span class="num" id="4682864">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4682867">case</span>&nbsp;<span class="op" id="4682872">*</span><span class="ident" id="4682873">image</span><span class="op" id="4682878">.</span><span class="ident" id="4682879">Paletted</span><span class="op" id="4682887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682891">srcPix</span>&nbsp;<span class="op" id="4682898">=</span>&nbsp;<span class="ident" id="4682900">src</span><span class="op" id="4682903">.</span><span class="op" id="4682904">(</span><span class="op" id="4682905">*</span><span class="ident" id="4682906">image</span><span class="op" id="4682911">.</span><span class="ident" id="4682912">Paletted</span><span class="op" id="4682920">)</span><span class="op" id="4682921">.</span><span class="ident" id="4682922">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682928">dstPix</span><span class="op" id="4682934">,</span>&nbsp;<span class="ident" id="4682936">stride</span><span class="op" id="4682942">,</span>&nbsp;<span class="ident" id="4682944">rect</span>&nbsp;<span class="op" id="4682949">=</span>&nbsp;<span class="ident" id="4682951">target</span><span class="op" id="4682957">.</span><span class="ident" id="4682958">Pix</span><span class="op" id="4682961">,</span>&nbsp;<span class="ident" id="4682963">target</span><span class="op" id="4682969">.</span><span class="ident" id="4682970">Stride</span><span class="op" id="4682976">,</span>&nbsp;<span class="ident" id="4682978">target</span><span class="op" id="4682984">.</span><span class="ident" id="4682985">Rect</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4682992">bytesPerPixel</span>&nbsp;<span class="op" id="4683006">=</span>&nbsp;<span class="num" id="4683008">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683011">case</span>&nbsp;<span class="op" id="4683016">*</span><span class="ident" id="4683017">image</span><span class="op" id="4683022">.</span><span class="ident" id="4683023">RGBA</span><span class="op" id="4683027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683031">srcPix</span>&nbsp;<span class="op" id="4683038">=</span>&nbsp;<span class="ident" id="4683040">src</span><span class="op" id="4683043">.</span><span class="op" id="4683044">(</span><span class="op" id="4683045">*</span><span class="ident" id="4683046">image</span><span class="op" id="4683051">.</span><span class="ident" id="4683052">RGBA</span><span class="op" id="4683056">)</span><span class="op" id="4683057">.</span><span class="ident" id="4683058">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683064">dstPix</span><span class="op" id="4683070">,</span>&nbsp;<span class="ident" id="4683072">stride</span><span class="op" id="4683078">,</span>&nbsp;<span class="ident" id="4683080">rect</span>&nbsp;<span class="op" id="4683085">=</span>&nbsp;<span class="ident" id="4683087">target</span><span class="op" id="4683093">.</span><span class="ident" id="4683094">Pix</span><span class="op" id="4683097">,</span>&nbsp;<span class="ident" id="4683099">target</span><span class="op" id="4683105">.</span><span class="ident" id="4683106">Stride</span><span class="op" id="4683112">,</span>&nbsp;<span class="ident" id="4683114">target</span><span class="op" id="4683120">.</span><span class="ident" id="4683121">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683128">bytesPerPixel</span>&nbsp;<span class="op" id="4683142">=</span>&nbsp;<span class="num" id="4683144">4</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683147">case</span>&nbsp;<span class="op" id="4683152">*</span><span class="ident" id="4683153">image</span><span class="op" id="4683158">.</span><span class="ident" id="4683159">RGBA64</span><span class="op" id="4683165">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683169">srcPix</span>&nbsp;<span class="op" id="4683176">=</span>&nbsp;<span class="ident" id="4683178">src</span><span class="op" id="4683181">.</span><span class="op" id="4683182">(</span><span class="op" id="4683183">*</span><span class="ident" id="4683184">image</span><span class="op" id="4683189">.</span><span class="ident" id="4683190">RGBA64</span><span class="op" id="4683196">)</span><span class="op" id="4683197">.</span><span class="ident" id="4683198">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683204">dstPix</span><span class="op" id="4683210">,</span>&nbsp;<span class="ident" id="4683212">stride</span><span class="op" id="4683218">,</span>&nbsp;<span class="ident" id="4683220">rect</span>&nbsp;<span class="op" id="4683225">=</span>&nbsp;<span class="ident" id="4683227">target</span><span class="op" id="4683233">.</span><span class="ident" id="4683234">Pix</span><span class="op" id="4683237">,</span>&nbsp;<span class="ident" id="4683239">target</span><span class="op" id="4683245">.</span><span class="ident" id="4683246">Stride</span><span class="op" id="4683252">,</span>&nbsp;<span class="ident" id="4683254">target</span><span class="op" id="4683260">.</span><span class="ident" id="4683261">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683268">bytesPerPixel</span>&nbsp;<span class="op" id="4683282">=</span>&nbsp;<span class="num" id="4683284">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4683287">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683290">s</span><span class="op" id="4683291">,</span>&nbsp;<span class="ident" id="4683293">bounds</span>&nbsp;<span class="op" id="4683300">:=</span>&nbsp;<span class="num" id="4683303">0</span><span class="op" id="4683304">,</span>&nbsp;<span class="ident" id="4683306">src</span><span class="op" id="4683309">.</span><span class="ident" id="4683310">Bounds</span><span class="op" id="4683316">(</span><span class="op" id="4683317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683320">for</span>&nbsp;<span class="ident" id="4683324">y</span>&nbsp;<span class="op" id="4683326">:=</span>&nbsp;<span class="ident" id="4683329">bounds</span><span class="op" id="4683335">.</span><span class="ident" id="4683336">Min</span><span class="op" id="4683339">.</span><span class="ident" id="4683340">Y</span><span class="op" id="4683341">;</span>&nbsp;<span class="ident" id="4683343">y</span>&nbsp;<span class="op" id="4683345">&lt;</span>&nbsp;<span class="ident" id="4683347">bounds</span><span class="op" id="4683353">.</span><span class="ident" id="4683354">Max</span><span class="op" id="4683357">.</span><span class="ident" id="4683358">Y</span><span class="op" id="4683359">;</span>&nbsp;<span class="ident" id="4683361">y</span><span class="op" id="4683362">++</span>&nbsp;<span class="op" id="4683365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683369">dBase</span>&nbsp;<span class="op" id="4683375">:=</span>&nbsp;<span class="op" id="4683378">(</span><span class="ident" id="4683379">y</span><span class="op" id="4683380">*</span><span class="ident" id="4683381">p</span><span class="op" id="4683382">.</span><span class="ident" id="4683383">yFactor</span><span class="op" id="4683390">+</span><span class="ident" id="4683391">p</span><span class="op" id="4683392">.</span><span class="ident" id="4683393">yOffset</span><span class="op" id="4683400">-</span><span class="ident" id="4683401">rect</span><span class="op" id="4683405">.</span><span class="ident" id="4683406">Min</span><span class="op" id="4683409">.</span><span class="ident" id="4683410">Y</span><span class="op" id="4683411">)</span><span class="op" id="4683412">*</span><span class="ident" id="4683413">stride</span>&nbsp;<span class="op" id="4683420">+</span>&nbsp;<span class="op" id="4683422">(</span><span class="ident" id="4683423">p</span><span class="op" id="4683424">.</span><span class="ident" id="4683425">xOffset</span><span class="op" id="4683432">-</span><span class="ident" id="4683433">rect</span><span class="op" id="4683437">.</span><span class="ident" id="4683438">Min</span><span class="op" id="4683441">.</span><span class="ident" id="4683442">X</span><span class="op" id="4683443">)</span><span class="op" id="4683444">*</span><span class="ident" id="4683445">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683461">for</span>&nbsp;<span class="ident" id="4683465">x</span>&nbsp;<span class="op" id="4683467">:=</span>&nbsp;<span class="ident" id="4683470">bounds</span><span class="op" id="4683476">.</span><span class="ident" id="4683477">Min</span><span class="op" id="4683480">.</span><span class="ident" id="4683481">X</span><span class="op" id="4683482">;</span>&nbsp;<span class="ident" id="4683484">x</span>&nbsp;<span class="op" id="4683486">&lt;</span>&nbsp;<span class="ident" id="4683488">bounds</span><span class="op" id="4683494">.</span><span class="ident" id="4683495">Max</span><span class="op" id="4683498">.</span><span class="ident" id="4683499">X</span><span class="op" id="4683500">;</span>&nbsp;<span class="ident" id="4683502">x</span><span class="op" id="4683503">++</span>&nbsp;<span class="op" id="4683506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683511">d</span>&nbsp;<span class="op" id="4683513">:=</span>&nbsp;<span class="ident" id="4683516">dBase</span>&nbsp;<span class="op" id="4683522">+</span>&nbsp;<span class="ident" id="4683524">x</span><span class="op" id="4683525">*</span><span class="ident" id="4683526">p</span><span class="op" id="4683527">.</span><span class="ident" id="4683528">xFactor</span><span class="op" id="4683535">*</span><span class="ident" id="4683536">bytesPerPixel</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4683553">copy</span><span class="op" id="4683557">(</span><span class="ident" id="4683558">dstPix</span><span class="op" id="4683564">[</span><span class="ident" id="4683565">d</span><span class="op" id="4683566">:</span><span class="op" id="4683567">]</span><span class="op" id="4683568">,</span>&nbsp;<span class="ident" id="4683570">srcPix</span><span class="op" id="4683576">[</span><span class="ident" id="4683577">s</span><span class="op" id="4683578">:</span><span class="ident" id="4683579">s</span><span class="op" id="4683580">+</span><span class="ident" id="4683581">bytesPerPixel</span><span class="op" id="4683594">]</span><span class="op" id="4683595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683600">s</span>&nbsp;<span class="op" id="4683602">+=</span>&nbsp;<span class="ident" id="4683605">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4683621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4683624">}</span><br>
<span class="lineno"></span><span class="op" id="4683626">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span><span class="keyword" id="4683629">func</span>&nbsp;<span class="op" id="4683634">(</span><span class="ident" id="4683635">d</span>&nbsp;<span class="op" id="4683637">*</span><span class="ident" id="4683638">decoder</span><span class="op" id="4683645">)</span>&nbsp;<span class="ident" id="4683647">parseIDAT</span><span class="op" id="4683656">(</span><span class="ident" id="4683657">length</span>&nbsp;<span class="builtintype" id="4683664">uint32</span><span class="op" id="4683670">)</span>&nbsp;<span class="op" id="4683672">(</span><span class="ident" id="4683673">err</span>&nbsp;<span class="builtintype" id="4683677">error</span><span class="op" id="4683682">)</span>&nbsp;<span class="op" id="4683684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683687">d</span><span class="op" id="4683688">.</span><span class="ident" id="4683689">idatLength</span>&nbsp;<span class="op" id="4683700">=</span>&nbsp;<span class="ident" id="4683702">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4683710">d</span><span class="op" id="4683711">.</span><span class="ident" id="4683712">img</span><span class="op" id="4683715">,</span>&nbsp;<span class="ident" id="4683717">err</span>&nbsp;<span class="op" id="4683721">=</span>&nbsp;<span class="ident" id="4683723">d</span><span class="op" id="4683724">.</span><span class="ident" id="4683725">decode</span><span class="op" id="4683731">(</span><span class="op" id="4683732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683735">if</span>&nbsp;<span class="ident" id="4683738">err</span>&nbsp;<span class="op" id="4683742">!=</span>&nbsp;<span class="ident" id="4683745">nil</span>&nbsp;<span class="op" id="4683749">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683753">return</span>&nbsp;<span class="ident" id="4683760">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4683765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683768">return</span>&nbsp;<span class="ident" id="4683775">d</span><span class="op" id="4683776">.</span><span class="ident" id="4683777">verifyChecksum</span><span class="op" id="4683791">(</span><span class="op" id="4683792">)</span><br>
<span class="lineno"></span><span class="op" id="4683794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">655</span><span class="keyword" id="4683797">func</span>&nbsp;<span class="op" id="4683802">(</span><span class="ident" id="4683803">d</span>&nbsp;<span class="op" id="4683805">*</span><span class="ident" id="4683806">decoder</span><span class="op" id="4683813">)</span>&nbsp;<span class="ident" id="4683815">parseIEND</span><span class="op" id="4683824">(</span><span class="ident" id="4683825">length</span>&nbsp;<span class="builtintype" id="4683832">uint32</span><span class="op" id="4683838">)</span>&nbsp;<span class="builtintype" id="4683840">error</span>&nbsp;<span class="op" id="4683846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683849">if</span>&nbsp;<span class="ident" id="4683852">length</span>&nbsp;<span class="op" id="4683859">!=</span>&nbsp;<span class="num" id="4683862">0</span>&nbsp;<span class="op" id="4683864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683868">return</span>&nbsp;<span class="ident" id="4683875">FormatError</span><span class="op" id="4683886">(</span><span class="string" id="4683887">&#34;bad&nbsp;IEND&nbsp;length&#34;</span><span class="op" id="4683904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4683907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4683910">return</span>&nbsp;<span class="ident" id="4683917">d</span><span class="op" id="4683918">.</span><span class="ident" id="4683919">verifyChecksum</span><span class="op" id="4683933">(</span><span class="op" id="4683934">)</span><br>
<span class="lineno">660</span><span class="op" id="4683936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4683939">func</span>&nbsp;<span class="op" id="4683944">(</span><span class="ident" id="4683945">d</span>&nbsp;<span class="op" id="4683947">*</span><span class="ident" id="4683948">decoder</span><span class="op" id="4683955">)</span>&nbsp;<span class="ident" id="4683957">parseChunk</span><span class="op" id="4683967">(</span><span class="op" id="4683968">)</span>&nbsp;<span class="builtintype" id="4683970">error</span>&nbsp;<span class="op" id="4683976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4683979">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684015">n</span><span class="op" id="4684016">,</span>&nbsp;<span class="ident" id="4684018">err</span>&nbsp;<span class="op" id="4684022">:=</span>&nbsp;<span class="ident" id="4684025">io</span><span class="op" id="4684027">.</span><span class="ident" id="4684028">ReadFull</span><span class="op" id="4684036">(</span><span class="ident" id="4684037">d</span><span class="op" id="4684038">.</span><span class="ident" id="4684039">r</span><span class="op" id="4684040">,</span>&nbsp;<span class="ident" id="4684042">d</span><span class="op" id="4684043">.</span><span class="ident" id="4684044">tmp</span><span class="op" id="4684047">[</span><span class="op" id="4684048">:</span><span class="num" id="4684049">8</span><span class="op" id="4684050">]</span><span class="op" id="4684051">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684054">if</span>&nbsp;<span class="ident" id="4684057">err</span>&nbsp;<span class="op" id="4684061">!=</span>&nbsp;<span class="ident" id="4684064">nil</span>&nbsp;<span class="op" id="4684068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684072">return</span>&nbsp;<span class="ident" id="4684079">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4684084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684087">length</span>&nbsp;<span class="op" id="4684094">:=</span>&nbsp;<span class="ident" id="4684097">binary</span><span class="op" id="4684103">.</span><span class="ident" id="4684104">BigEndian</span><span class="op" id="4684113">.</span><span class="ident" id="4684114">Uint32</span><span class="op" id="4684120">(</span><span class="ident" id="4684121">d</span><span class="op" id="4684122">.</span><span class="ident" id="4684123">tmp</span><span class="op" id="4684126">[</span><span class="op" id="4684127">:</span><span class="num" id="4684128">4</span><span class="op" id="4684129">]</span><span class="op" id="4684130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684133">d</span><span class="op" id="4684134">.</span><span class="ident" id="4684135">crc</span><span class="op" id="4684138">.</span><span class="ident" id="4684139">Reset</span><span class="op" id="4684144">(</span><span class="op" id="4684145">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684148">d</span><span class="op" id="4684149">.</span><span class="ident" id="4684150">crc</span><span class="op" id="4684153">.</span><span class="ident" id="4684154">Write</span><span class="op" id="4684159">(</span><span class="ident" id="4684160">d</span><span class="op" id="4684161">.</span><span class="ident" id="4684162">tmp</span><span class="op" id="4684165">[</span><span class="num" id="4684166">4</span><span class="op" id="4684167">:</span><span class="num" id="4684168">8</span><span class="op" id="4684169">]</span><span class="op" id="4684170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4684174">//&nbsp;Read&nbsp;the&nbsp;chunk&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684199">switch</span>&nbsp;<span class="builtintype" id="4684206">string</span><span class="op" id="4684212">(</span><span class="ident" id="4684213">d</span><span class="op" id="4684214">.</span><span class="ident" id="4684215">tmp</span><span class="op" id="4684218">[</span><span class="num" id="4684219">4</span><span class="op" id="4684220">:</span><span class="num" id="4684221">8</span><span class="op" id="4684222">]</span><span class="op" id="4684223">)</span>&nbsp;<span class="op" id="4684225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684228">case</span>&nbsp;<span class="string" id="4684233">&#34;IHDR&#34;</span><span class="op" id="4684239">:</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684243">if</span>&nbsp;<span class="ident" id="4684246">d</span><span class="op" id="4684247">.</span><span class="ident" id="4684248">stage</span>&nbsp;<span class="op" id="4684254">!=</span>&nbsp;<span class="ident" id="4684257">dsStart</span>&nbsp;<span class="op" id="4684265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684270">return</span>&nbsp;<span class="ident" id="4684277">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4684295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684299">d</span><span class="op" id="4684300">.</span><span class="ident" id="4684301">stage</span>&nbsp;<span class="op" id="4684307">=</span>&nbsp;<span class="ident" id="4684309">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684322">return</span>&nbsp;<span class="ident" id="4684329">d</span><span class="op" id="4684330">.</span><span class="ident" id="4684331">parseIHDR</span><span class="op" id="4684340">(</span><span class="ident" id="4684341">length</span><span class="op" id="4684347">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684350">case</span>&nbsp;<span class="string" id="4684355">&#34;PLTE&#34;</span><span class="op" id="4684361">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684365">if</span>&nbsp;<span class="ident" id="4684368">d</span><span class="op" id="4684369">.</span><span class="ident" id="4684370">stage</span>&nbsp;<span class="op" id="4684376">!=</span>&nbsp;<span class="ident" id="4684379">dsSeenIHDR</span>&nbsp;<span class="op" id="4684390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684395">return</span>&nbsp;<span class="ident" id="4684402">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4684420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684424">d</span><span class="op" id="4684425">.</span><span class="ident" id="4684426">stage</span>&nbsp;<span class="op" id="4684432">=</span>&nbsp;<span class="ident" id="4684434">dsSeenPLTE</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684447">return</span>&nbsp;<span class="ident" id="4684454">d</span><span class="op" id="4684455">.</span><span class="ident" id="4684456">parsePLTE</span><span class="op" id="4684465">(</span><span class="ident" id="4684466">length</span><span class="op" id="4684472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684475">case</span>&nbsp;<span class="string" id="4684480">&#34;tRNS&#34;</span><span class="op" id="4684486">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684490">if</span>&nbsp;<span class="ident" id="4684493">d</span><span class="op" id="4684494">.</span><span class="ident" id="4684495">stage</span>&nbsp;<span class="op" id="4684501">!=</span>&nbsp;<span class="ident" id="4684504">dsSeenPLTE</span>&nbsp;<span class="op" id="4684515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684520">return</span>&nbsp;<span class="ident" id="4684527">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4684545">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684549">return</span>&nbsp;<span class="ident" id="4684556">d</span><span class="op" id="4684557">.</span><span class="ident" id="4684558">parsetRNS</span><span class="op" id="4684567">(</span><span class="ident" id="4684568">length</span><span class="op" id="4684574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684577">case</span>&nbsp;<span class="string" id="4684582">&#34;IDAT&#34;</span><span class="op" id="4684588">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684592">if</span>&nbsp;<span class="ident" id="4684595">d</span><span class="op" id="4684596">.</span><span class="ident" id="4684597">stage</span>&nbsp;<span class="op" id="4684603">&lt;</span>&nbsp;<span class="ident" id="4684605">dsSeenIHDR</span>&nbsp;<span class="op" id="4684616">||</span>&nbsp;<span class="ident" id="4684619">d</span><span class="op" id="4684620">.</span><span class="ident" id="4684621">stage</span>&nbsp;<span class="op" id="4684627">&gt;</span>&nbsp;<span class="ident" id="4684629">dsSeenIDAT</span>&nbsp;<span class="op" id="4684640">||</span>&nbsp;<span class="op" id="4684643">(</span><span class="ident" id="4684644">d</span><span class="op" id="4684645">.</span><span class="ident" id="4684646">cb</span>&nbsp;<span class="op" id="4684649">==</span>&nbsp;<span class="ident" id="4684652">cbP8</span>&nbsp;<span class="op" id="4684657">&amp;&amp;</span>&nbsp;<span class="ident" id="4684660">d</span><span class="op" id="4684661">.</span><span class="ident" id="4684662">stage</span>&nbsp;<span class="op" id="4684668">==</span>&nbsp;<span class="ident" id="4684671">dsSeenIHDR</span><span class="op" id="4684681">)</span>&nbsp;<span class="op" id="4684683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684688">return</span>&nbsp;<span class="ident" id="4684695">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4684713">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684717">d</span><span class="op" id="4684718">.</span><span class="ident" id="4684719">stage</span>&nbsp;<span class="op" id="4684725">=</span>&nbsp;<span class="ident" id="4684727">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684740">return</span>&nbsp;<span class="ident" id="4684747">d</span><span class="op" id="4684748">.</span><span class="ident" id="4684749">parseIDAT</span><span class="op" id="4684758">(</span><span class="ident" id="4684759">length</span><span class="op" id="4684765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684768">case</span>&nbsp;<span class="string" id="4684773">&#34;IEND&#34;</span><span class="op" id="4684779">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684783">if</span>&nbsp;<span class="ident" id="4684786">d</span><span class="op" id="4684787">.</span><span class="ident" id="4684788">stage</span>&nbsp;<span class="op" id="4684794">!=</span>&nbsp;<span class="ident" id="4684797">dsSeenIDAT</span>&nbsp;<span class="op" id="4684808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684813">return</span>&nbsp;<span class="ident" id="4684820">chunkOrderError</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4684838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684842">d</span><span class="op" id="4684843">.</span><span class="ident" id="4684844">stage</span>&nbsp;<span class="op" id="4684850">=</span>&nbsp;<span class="ident" id="4684852">dsSeenIEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684865">return</span>&nbsp;<span class="ident" id="4684872">d</span><span class="op" id="4684873">.</span><span class="ident" id="4684874">parseIEND</span><span class="op" id="4684883">(</span><span class="ident" id="4684884">length</span><span class="op" id="4684890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4684893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4684896">//&nbsp;Ignore&nbsp;this&nbsp;chunk&nbsp;(of&nbsp;a&nbsp;known&nbsp;length).</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684939">var</span>&nbsp;<span class="ident" id="4684943">ignored</span>&nbsp;<span class="op" id="4684951">[</span><span class="num" id="4684952">4096</span><span class="op" id="4684956">]</span><span class="builtintype" id="4684957">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4684963">for</span>&nbsp;<span class="ident" id="4684967">length</span>&nbsp;<span class="op" id="4684974">&gt;</span>&nbsp;<span class="num" id="4684976">0</span>&nbsp;<span class="op" id="4684978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4684982">n</span><span class="op" id="4684983">,</span>&nbsp;<span class="ident" id="4684985">err</span>&nbsp;<span class="op" id="4684989">=</span>&nbsp;<span class="ident" id="4684991">io</span><span class="op" id="4684993">.</span><span class="ident" id="4684994">ReadFull</span><span class="op" id="4685002">(</span><span class="ident" id="4685003">d</span><span class="op" id="4685004">.</span><span class="ident" id="4685005">r</span><span class="op" id="4685006">,</span>&nbsp;<span class="ident" id="4685008">ignored</span><span class="op" id="4685015">[</span><span class="op" id="4685016">:</span><span class="ident" id="4685017">min</span><span class="op" id="4685020">(</span><span class="builtinfunc" id="4685021">len</span><span class="op" id="4685024">(</span><span class="ident" id="4685025">ignored</span><span class="op" id="4685032">)</span><span class="op" id="4685033">,</span>&nbsp;<span class="builtintype" id="4685035">int</span><span class="op" id="4685038">(</span><span class="ident" id="4685039">length</span><span class="op" id="4685045">)</span><span class="op" id="4685046">)</span><span class="op" id="4685047">]</span><span class="op" id="4685048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685052">if</span>&nbsp;<span class="ident" id="4685055">err</span>&nbsp;<span class="op" id="4685059">!=</span>&nbsp;<span class="ident" id="4685062">nil</span>&nbsp;<span class="op" id="4685066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685071">return</span>&nbsp;<span class="ident" id="4685078">err</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685088">d</span><span class="op" id="4685089">.</span><span class="ident" id="4685090">crc</span><span class="op" id="4685093">.</span><span class="ident" id="4685094">Write</span><span class="op" id="4685099">(</span><span class="ident" id="4685100">ignored</span><span class="op" id="4685107">[</span><span class="op" id="4685108">:</span><span class="ident" id="4685109">n</span><span class="op" id="4685110">]</span><span class="op" id="4685111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685115">length</span>&nbsp;<span class="op" id="4685122">-=</span>&nbsp;<span class="builtintype" id="4685125">uint32</span><span class="op" id="4685131">(</span><span class="ident" id="4685132">n</span><span class="op" id="4685133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685139">return</span>&nbsp;<span class="ident" id="4685146">d</span><span class="op" id="4685147">.</span><span class="ident" id="4685148">verifyChecksum</span><span class="op" id="4685162">(</span><span class="op" id="4685163">)</span><br>
<span class="lineno">715</span><span class="op" id="4685165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4685168">func</span>&nbsp;<span class="op" id="4685173">(</span><span class="ident" id="4685174">d</span>&nbsp;<span class="op" id="4685176">*</span><span class="ident" id="4685177">decoder</span><span class="op" id="4685184">)</span>&nbsp;<span class="ident" id="4685186">verifyChecksum</span><span class="op" id="4685200">(</span><span class="op" id="4685201">)</span>&nbsp;<span class="builtintype" id="4685203">error</span>&nbsp;<span class="op" id="4685209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685212">if</span>&nbsp;<span class="ident" id="4685215">_</span><span class="op" id="4685216">,</span>&nbsp;<span class="ident" id="4685218">err</span>&nbsp;<span class="op" id="4685222">:=</span>&nbsp;<span class="ident" id="4685225">io</span><span class="op" id="4685227">.</span><span class="ident" id="4685228">ReadFull</span><span class="op" id="4685236">(</span><span class="ident" id="4685237">d</span><span class="op" id="4685238">.</span><span class="ident" id="4685239">r</span><span class="op" id="4685240">,</span>&nbsp;<span class="ident" id="4685242">d</span><span class="op" id="4685243">.</span><span class="ident" id="4685244">tmp</span><span class="op" id="4685247">[</span><span class="op" id="4685248">:</span><span class="num" id="4685249">4</span><span class="op" id="4685250">]</span><span class="op" id="4685251">)</span><span class="op" id="4685252">;</span>&nbsp;<span class="ident" id="4685254">err</span>&nbsp;<span class="op" id="4685258">!=</span>&nbsp;<span class="ident" id="4685261">nil</span>&nbsp;<span class="op" id="4685265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685269">return</span>&nbsp;<span class="ident" id="4685276">err</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685284">if</span>&nbsp;<span class="ident" id="4685287">binary</span><span class="op" id="4685293">.</span><span class="ident" id="4685294">BigEndian</span><span class="op" id="4685303">.</span><span class="ident" id="4685304">Uint32</span><span class="op" id="4685310">(</span><span class="ident" id="4685311">d</span><span class="op" id="4685312">.</span><span class="ident" id="4685313">tmp</span><span class="op" id="4685316">[</span><span class="op" id="4685317">:</span><span class="num" id="4685318">4</span><span class="op" id="4685319">]</span><span class="op" id="4685320">)</span>&nbsp;<span class="op" id="4685322">!=</span>&nbsp;<span class="ident" id="4685325">d</span><span class="op" id="4685326">.</span><span class="ident" id="4685327">crc</span><span class="op" id="4685330">.</span><span class="ident" id="4685331">Sum32</span><span class="op" id="4685336">(</span><span class="op" id="4685337">)</span>&nbsp;<span class="op" id="4685339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685343">return</span>&nbsp;<span class="ident" id="4685350">FormatError</span><span class="op" id="4685361">(</span><span class="string" id="4685362">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="4685380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685386">return</span>&nbsp;<span class="ident" id="4685393">nil</span><br>
<span class="lineno">725</span><span class="op" id="4685397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4685400">func</span>&nbsp;<span class="op" id="4685405">(</span><span class="ident" id="4685406">d</span>&nbsp;<span class="op" id="4685408">*</span><span class="ident" id="4685409">decoder</span><span class="op" id="4685416">)</span>&nbsp;<span class="ident" id="4685418">checkHeader</span><span class="op" id="4685429">(</span><span class="op" id="4685430">)</span>&nbsp;<span class="builtintype" id="4685432">error</span>&nbsp;<span class="op" id="4685438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685441">_</span><span class="op" id="4685442">,</span>&nbsp;<span class="ident" id="4685444">err</span>&nbsp;<span class="op" id="4685448">:=</span>&nbsp;<span class="ident" id="4685451">io</span><span class="op" id="4685453">.</span><span class="ident" id="4685454">ReadFull</span><span class="op" id="4685462">(</span><span class="ident" id="4685463">d</span><span class="op" id="4685464">.</span><span class="ident" id="4685465">r</span><span class="op" id="4685466">,</span>&nbsp;<span class="ident" id="4685468">d</span><span class="op" id="4685469">.</span><span class="ident" id="4685470">tmp</span><span class="op" id="4685473">[</span><span class="op" id="4685474">:</span><span class="builtinfunc" id="4685475">len</span><span class="op" id="4685478">(</span><span class="ident" id="4685479">pngHeader</span><span class="op" id="4685488">)</span><span class="op" id="4685489">]</span><span class="op" id="4685490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685493">if</span>&nbsp;<span class="ident" id="4685496">err</span>&nbsp;<span class="op" id="4685500">!=</span>&nbsp;<span class="ident" id="4685503">nil</span>&nbsp;<span class="op" id="4685507">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685511">return</span>&nbsp;<span class="ident" id="4685518">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685526">if</span>&nbsp;<span class="builtintype" id="4685529">string</span><span class="op" id="4685535">(</span><span class="ident" id="4685536">d</span><span class="op" id="4685537">.</span><span class="ident" id="4685538">tmp</span><span class="op" id="4685541">[</span><span class="op" id="4685542">:</span><span class="builtinfunc" id="4685543">len</span><span class="op" id="4685546">(</span><span class="ident" id="4685547">pngHeader</span><span class="op" id="4685556">)</span><span class="op" id="4685557">]</span><span class="op" id="4685558">)</span>&nbsp;<span class="op" id="4685560">!=</span>&nbsp;<span class="ident" id="4685563">pngHeader</span>&nbsp;<span class="op" id="4685573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685577">return</span>&nbsp;<span class="ident" id="4685584">FormatError</span><span class="op" id="4685595">(</span><span class="string" id="4685596">&#34;not&nbsp;a&nbsp;PNG&nbsp;file&#34;</span><span class="op" id="4685612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685615">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685618">return</span>&nbsp;<span class="ident" id="4685625">nil</span><br>
<span class="lineno"></span><span class="op" id="4685629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4685632">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;PNG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="comment" id="4685701">//&nbsp;The&nbsp;type&nbsp;of&nbsp;Image&nbsp;returned&nbsp;depends&nbsp;on&nbsp;the&nbsp;PNG&nbsp;contents.</span><br>
<span class="lineno">740</span><span class="keyword" id="4685760">func</span>&nbsp;<span class="ident" id="4685765">Decode</span><span class="op" id="4685771">(</span><span class="ident" id="4685772">r</span>&nbsp;<span class="ident" id="4685774">io</span><span class="op" id="4685776">.</span><span class="ident" id="4685777">Reader</span><span class="op" id="4685783">)</span>&nbsp;<span class="op" id="4685785">(</span><span class="ident" id="4685786">image</span><span class="op" id="4685791">.</span><span class="ident" id="4685792">Image</span><span class="op" id="4685797">,</span>&nbsp;<span class="builtintype" id="4685799">error</span><span class="op" id="4685804">)</span>&nbsp;<span class="op" id="4685806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685809">d</span>&nbsp;<span class="op" id="4685811">:=</span>&nbsp;<span class="op" id="4685814">&amp;</span><span class="ident" id="4685815">decoder</span><span class="op" id="4685822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685826">r</span><span class="op" id="4685827">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4685831">r</span><span class="op" id="4685832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685836">crc</span><span class="op" id="4685839">:</span>&nbsp;<span class="ident" id="4685841">crc32</span><span class="op" id="4685846">.</span><span class="ident" id="4685847">NewIEEE</span><span class="op" id="4685854">(</span><span class="op" id="4685855">)</span><span class="op" id="4685856">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685859">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685862">if</span>&nbsp;<span class="ident" id="4685865">err</span>&nbsp;<span class="op" id="4685869">:=</span>&nbsp;<span class="ident" id="4685872">d</span><span class="op" id="4685873">.</span><span class="ident" id="4685874">checkHeader</span><span class="op" id="4685885">(</span><span class="op" id="4685886">)</span><span class="op" id="4685887">;</span>&nbsp;<span class="ident" id="4685889">err</span>&nbsp;<span class="op" id="4685893">!=</span>&nbsp;<span class="ident" id="4685896">nil</span>&nbsp;<span class="op" id="4685900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685904">if</span>&nbsp;<span class="ident" id="4685907">err</span>&nbsp;<span class="op" id="4685911">==</span>&nbsp;<span class="ident" id="4685914">io</span><span class="op" id="4685916">.</span><span class="ident" id="4685917">EOF</span>&nbsp;<span class="op" id="4685921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4685926">err</span>&nbsp;<span class="op" id="4685930">=</span>&nbsp;<span class="ident" id="4685932">io</span><span class="op" id="4685934">.</span><span class="ident" id="4685935">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685958">return</span>&nbsp;<span class="ident" id="4685965">nil</span><span class="op" id="4685968">,</span>&nbsp;<span class="ident" id="4685970">err</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4685975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4685978">for</span>&nbsp;<span class="ident" id="4685982">d</span><span class="op" id="4685983">.</span><span class="ident" id="4685984">stage</span>&nbsp;<span class="op" id="4685990">!=</span>&nbsp;<span class="ident" id="4685993">dsSeenIEND</span>&nbsp;<span class="op" id="4686004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686008">if</span>&nbsp;<span class="ident" id="4686011">err</span>&nbsp;<span class="op" id="4686015">:=</span>&nbsp;<span class="ident" id="4686018">d</span><span class="op" id="4686019">.</span><span class="ident" id="4686020">parseChunk</span><span class="op" id="4686030">(</span><span class="op" id="4686031">)</span><span class="op" id="4686032">;</span>&nbsp;<span class="ident" id="4686034">err</span>&nbsp;<span class="op" id="4686038">!=</span>&nbsp;<span class="ident" id="4686041">nil</span>&nbsp;<span class="op" id="4686045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686050">if</span>&nbsp;<span class="ident" id="4686053">err</span>&nbsp;<span class="op" id="4686057">==</span>&nbsp;<span class="ident" id="4686060">io</span><span class="op" id="4686062">.</span><span class="ident" id="4686063">EOF</span>&nbsp;<span class="op" id="4686067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686073">err</span>&nbsp;<span class="op" id="4686077">=</span>&nbsp;<span class="ident" id="4686079">io</span><span class="op" id="4686081">.</span><span class="ident" id="4686082">ErrUnexpectedEOF</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686107">return</span>&nbsp;<span class="ident" id="4686114">nil</span><span class="op" id="4686117">,</span>&nbsp;<span class="ident" id="4686119">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686131">return</span>&nbsp;<span class="ident" id="4686138">d</span><span class="op" id="4686139">.</span><span class="ident" id="4686140">img</span><span class="op" id="4686143">,</span>&nbsp;<span class="ident" id="4686145">nil</span><br>
<span class="lineno">760</span><span class="op" id="4686149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4686152">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;PNG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="4686230">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4686260">func</span>&nbsp;<span class="ident" id="4686265">DecodeConfig</span><span class="op" id="4686277">(</span><span class="ident" id="4686278">r</span>&nbsp;<span class="ident" id="4686280">io</span><span class="op" id="4686282">.</span><span class="ident" id="4686283">Reader</span><span class="op" id="4686289">)</span>&nbsp;<span class="op" id="4686291">(</span><span class="ident" id="4686292">image</span><span class="op" id="4686297">.</span><span class="ident" id="4686298">Config</span><span class="op" id="4686304">,</span>&nbsp;<span class="builtintype" id="4686306">error</span><span class="op" id="4686311">)</span>&nbsp;<span class="op" id="4686313">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686316">d</span>&nbsp;<span class="op" id="4686318">:=</span>&nbsp;<span class="op" id="4686321">&amp;</span><span class="ident" id="4686322">decoder</span><span class="op" id="4686329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686333">r</span><span class="op" id="4686334">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4686338">r</span><span class="op" id="4686339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686343">crc</span><span class="op" id="4686346">:</span>&nbsp;<span class="ident" id="4686348">crc32</span><span class="op" id="4686353">.</span><span class="ident" id="4686354">NewIEEE</span><span class="op" id="4686361">(</span><span class="op" id="4686362">)</span><span class="op" id="4686363">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686369">if</span>&nbsp;<span class="ident" id="4686372">err</span>&nbsp;<span class="op" id="4686376">:=</span>&nbsp;<span class="ident" id="4686379">d</span><span class="op" id="4686380">.</span><span class="ident" id="4686381">checkHeader</span><span class="op" id="4686392">(</span><span class="op" id="4686393">)</span><span class="op" id="4686394">;</span>&nbsp;<span class="ident" id="4686396">err</span>&nbsp;<span class="op" id="4686400">!=</span>&nbsp;<span class="ident" id="4686403">nil</span>&nbsp;<span class="op" id="4686407">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686411">if</span>&nbsp;<span class="ident" id="4686414">err</span>&nbsp;<span class="op" id="4686418">==</span>&nbsp;<span class="ident" id="4686421">io</span><span class="op" id="4686423">.</span><span class="ident" id="4686424">EOF</span>&nbsp;<span class="op" id="4686428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686433">err</span>&nbsp;<span class="op" id="4686437">=</span>&nbsp;<span class="ident" id="4686439">io</span><span class="op" id="4686441">.</span><span class="ident" id="4686442">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686465">return</span>&nbsp;<span class="ident" id="4686472">image</span><span class="op" id="4686477">.</span><span class="ident" id="4686478">Config</span><span class="op" id="4686484">{</span><span class="op" id="4686485">}</span><span class="op" id="4686486">,</span>&nbsp;<span class="ident" id="4686488">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686493">}</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686496">for</span>&nbsp;<span class="op" id="4686500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686504">if</span>&nbsp;<span class="ident" id="4686507">err</span>&nbsp;<span class="op" id="4686511">:=</span>&nbsp;<span class="ident" id="4686514">d</span><span class="op" id="4686515">.</span><span class="ident" id="4686516">parseChunk</span><span class="op" id="4686526">(</span><span class="op" id="4686527">)</span><span class="op" id="4686528">;</span>&nbsp;<span class="ident" id="4686530">err</span>&nbsp;<span class="op" id="4686534">!=</span>&nbsp;<span class="ident" id="4686537">nil</span>&nbsp;<span class="op" id="4686541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686546">if</span>&nbsp;<span class="ident" id="4686549">err</span>&nbsp;<span class="op" id="4686553">==</span>&nbsp;<span class="ident" id="4686556">io</span><span class="op" id="4686558">.</span><span class="ident" id="4686559">EOF</span>&nbsp;<span class="op" id="4686563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686569">err</span>&nbsp;<span class="op" id="4686573">=</span>&nbsp;<span class="ident" id="4686575">io</span><span class="op" id="4686577">.</span><span class="ident" id="4686578">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686598">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686603">return</span>&nbsp;<span class="ident" id="4686610">image</span><span class="op" id="4686615">.</span><span class="ident" id="4686616">Config</span><span class="op" id="4686622">{</span><span class="op" id="4686623">}</span><span class="op" id="4686624">,</span>&nbsp;<span class="ident" id="4686626">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686636">paletted</span>&nbsp;<span class="op" id="4686645">:=</span>&nbsp;<span class="ident" id="4686648">d</span><span class="op" id="4686649">.</span><span class="ident" id="4686650">cb</span>&nbsp;<span class="op" id="4686653">==</span>&nbsp;<span class="ident" id="4686656">cbP8</span>&nbsp;<span class="op" id="4686661">||</span>&nbsp;<span class="ident" id="4686664">d</span><span class="op" id="4686665">.</span><span class="ident" id="4686666">cb</span>&nbsp;<span class="op" id="4686669">==</span>&nbsp;<span class="ident" id="4686672">cbP4</span>&nbsp;<span class="op" id="4686677">||</span>&nbsp;<span class="ident" id="4686680">d</span><span class="op" id="4686681">.</span><span class="ident" id="4686682">cb</span>&nbsp;<span class="op" id="4686685">==</span>&nbsp;<span class="ident" id="4686688">cbP2</span>&nbsp;<span class="op" id="4686693">||</span>&nbsp;<span class="ident" id="4686696">d</span><span class="op" id="4686697">.</span><span class="ident" id="4686698">cb</span>&nbsp;<span class="op" id="4686701">==</span>&nbsp;<span class="ident" id="4686704">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686711">if</span>&nbsp;<span class="ident" id="4686714">d</span><span class="op" id="4686715">.</span><span class="ident" id="4686716">stage</span>&nbsp;<span class="op" id="4686722">==</span>&nbsp;<span class="ident" id="4686725">dsSeenIHDR</span>&nbsp;<span class="op" id="4686736">&amp;&amp;</span>&nbsp;<span class="op" id="4686739">!</span><span class="ident" id="4686740">paletted</span>&nbsp;<span class="op" id="4686749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686754">break</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686766">if</span>&nbsp;<span class="ident" id="4686769">d</span><span class="op" id="4686770">.</span><span class="ident" id="4686771">stage</span>&nbsp;<span class="op" id="4686777">==</span>&nbsp;<span class="ident" id="4686780">dsSeenPLTE</span>&nbsp;<span class="op" id="4686791">&amp;&amp;</span>&nbsp;<span class="ident" id="4686794">paletted</span>&nbsp;<span class="op" id="4686803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686808">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4686819">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686822">var</span>&nbsp;<span class="ident" id="4686826">cm</span>&nbsp;<span class="ident" id="4686829">color</span><span class="op" id="4686834">.</span><span class="ident" id="4686835">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686842">switch</span>&nbsp;<span class="ident" id="4686849">d</span><span class="op" id="4686850">.</span><span class="ident" id="4686851">cb</span>&nbsp;<span class="op" id="4686854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686857">case</span>&nbsp;<span class="ident" id="4686862">cbG1</span><span class="op" id="4686866">,</span>&nbsp;<span class="ident" id="4686868">cbG2</span><span class="op" id="4686872">,</span>&nbsp;<span class="ident" id="4686874">cbG4</span><span class="op" id="4686878">,</span>&nbsp;<span class="ident" id="4686880">cbG8</span><span class="op" id="4686884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686888">cm</span>&nbsp;<span class="op" id="4686891">=</span>&nbsp;<span class="ident" id="4686893">color</span><span class="op" id="4686898">.</span><span class="ident" id="4686899">GrayModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686910">case</span>&nbsp;<span class="ident" id="4686915">cbGA8</span><span class="op" id="4686920">:</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686924">cm</span>&nbsp;<span class="op" id="4686927">=</span>&nbsp;<span class="ident" id="4686929">color</span><span class="op" id="4686934">.</span><span class="ident" id="4686935">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686947">case</span>&nbsp;<span class="ident" id="4686952">cbTC8</span><span class="op" id="4686957">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4686961">cm</span>&nbsp;<span class="op" id="4686964">=</span>&nbsp;<span class="ident" id="4686966">color</span><span class="op" id="4686971">.</span><span class="ident" id="4686972">RGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4686983">case</span>&nbsp;<span class="ident" id="4686988">cbP1</span><span class="op" id="4686992">,</span>&nbsp;<span class="ident" id="4686994">cbP2</span><span class="op" id="4686998">,</span>&nbsp;<span class="ident" id="4687000">cbP4</span><span class="op" id="4687004">,</span>&nbsp;<span class="ident" id="4687006">cbP8</span><span class="op" id="4687010">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687014">cm</span>&nbsp;<span class="op" id="4687017">=</span>&nbsp;<span class="ident" id="4687019">d</span><span class="op" id="4687020">.</span><span class="ident" id="4687021">palette</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687030">case</span>&nbsp;<span class="ident" id="4687035">cbTCA8</span><span class="op" id="4687041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687045">cm</span>&nbsp;<span class="op" id="4687048">=</span>&nbsp;<span class="ident" id="4687050">color</span><span class="op" id="4687055">.</span><span class="ident" id="4687056">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687068">case</span>&nbsp;<span class="ident" id="4687073">cbG16</span><span class="op" id="4687078">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687082">cm</span>&nbsp;<span class="op" id="4687085">=</span>&nbsp;<span class="ident" id="4687087">color</span><span class="op" id="4687092">.</span><span class="ident" id="4687093">Gray16Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687106">case</span>&nbsp;<span class="ident" id="4687111">cbGA16</span><span class="op" id="4687117">:</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687121">cm</span>&nbsp;<span class="op" id="4687124">=</span>&nbsp;<span class="ident" id="4687126">color</span><span class="op" id="4687131">.</span><span class="ident" id="4687132">NRGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687146">case</span>&nbsp;<span class="ident" id="4687151">cbTC16</span><span class="op" id="4687157">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687161">cm</span>&nbsp;<span class="op" id="4687164">=</span>&nbsp;<span class="ident" id="4687166">color</span><span class="op" id="4687171">.</span><span class="ident" id="4687172">RGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687185">case</span>&nbsp;<span class="ident" id="4687190">cbTCA16</span><span class="op" id="4687197">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687201">cm</span>&nbsp;<span class="op" id="4687204">=</span>&nbsp;<span class="ident" id="4687206">color</span><span class="op" id="4687211">.</span><span class="ident" id="4687212">NRGBA64Model</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4687226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4687229">return</span>&nbsp;<span class="ident" id="4687236">image</span><span class="op" id="4687241">.</span><span class="ident" id="4687242">Config</span><span class="op" id="4687248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687252">ColorModel</span><span class="op" id="4687262">:</span>&nbsp;<span class="ident" id="4687264">cm</span><span class="op" id="4687266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687270">Width</span><span class="op" id="4687275">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687282">d</span><span class="op" id="4687283">.</span><span class="ident" id="4687284">width</span><span class="op" id="4687289">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687293">Height</span><span class="op" id="4687299">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4687305">d</span><span class="op" id="4687306">.</span><span class="ident" id="4687307">height</span><span class="op" id="4687313">,</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4687316">}</span><span class="op" id="4687317">,</span>&nbsp;<span class="ident" id="4687319">nil</span><br>
<span class="lineno"></span><span class="op" id="4687323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4687326">func</span>&nbsp;<span class="ident" id="4687331">init</span><span class="op" id="4687335">(</span><span class="op" id="4687336">)</span>&nbsp;<span class="op" id="4687338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4687341">image</span><span class="op" id="4687346">.</span><span class="ident" id="4687347">RegisterFormat</span><span class="op" id="4687361">(</span><span class="string" id="4687362">&#34;png&#34;</span><span class="op" id="4687367">,</span>&nbsp;<span class="ident" id="4687369">pngHeader</span><span class="op" id="4687378">,</span>&nbsp;<span class="ident" id="4687380">Decode</span><span class="op" id="4687386">,</span>&nbsp;<span class="ident" id="4687388">DecodeConfig</span><span class="op" id="4687400">)</span><br>
<span class="lineno">820</span><span class="op" id="4687402">}</span>
</div>
</body>
</html>
