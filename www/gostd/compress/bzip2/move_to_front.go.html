<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html" class="current">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5519426">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5519481">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5519535">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5519586">package</span>&nbsp;<span class="ident" id="5519594">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5519601">//&nbsp;moveToFrontDecoder&nbsp;implements&nbsp;a&nbsp;move-to-front&nbsp;list.&nbsp;Such&nbsp;a&nbsp;list&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5519674">//&nbsp;efficient&nbsp;way&nbsp;to&nbsp;transform&nbsp;a&nbsp;string&nbsp;with&nbsp;repeating&nbsp;elements&nbsp;into&nbsp;one&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5519751">//&nbsp;many&nbsp;small&nbsp;valued&nbsp;numbers,&nbsp;which&nbsp;is&nbsp;suitable&nbsp;for&nbsp;entropy&nbsp;encoding.&nbsp;It&nbsp;works</span><br>
<span class="lineno">10</span><span class="comment" id="5519830">//&nbsp;by&nbsp;starting&nbsp;with&nbsp;an&nbsp;initial&nbsp;list&nbsp;of&nbsp;symbols&nbsp;and&nbsp;references&nbsp;symbols&nbsp;by&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="5519909">//&nbsp;index&nbsp;into&nbsp;that&nbsp;list.&nbsp;When&nbsp;a&nbsp;symbol&nbsp;is&nbsp;referenced,&nbsp;it&#39;s&nbsp;moved&nbsp;to&nbsp;the&nbsp;front</span><br>
<span class="lineno"></span><span class="comment" id="5519987">//&nbsp;of&nbsp;the&nbsp;list.&nbsp;Thus,&nbsp;a&nbsp;repeated&nbsp;symbol&nbsp;ends&nbsp;up&nbsp;being&nbsp;encoded&nbsp;with&nbsp;many&nbsp;zeros,</span><br>
<span class="lineno"></span><span class="comment" id="5520066">//&nbsp;as&nbsp;the&nbsp;symbol&nbsp;will&nbsp;be&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list&nbsp;after&nbsp;the&nbsp;first&nbsp;access.</span><br>
<span class="lineno"></span><span class="keyword" id="5520140">type</span>&nbsp;<span class="ident" id="5520145">moveToFrontDecoder</span>&nbsp;<span class="op" id="5520164">[</span><span class="op" id="5520165">]</span><span class="builtintype" id="5520166">byte</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5520172">//&nbsp;newMTFDecoder&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;explicit&nbsp;initial&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5520251">//&nbsp;of&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="5520266">func</span>&nbsp;<span class="ident" id="5520271">newMTFDecoder</span><span class="op" id="5520284">(</span><span class="ident" id="5520285">symbols</span>&nbsp;<span class="op" id="5520293">[</span><span class="op" id="5520294">]</span><span class="builtintype" id="5520295">byte</span><span class="op" id="5520299">)</span>&nbsp;<span class="ident" id="5520301">moveToFrontDecoder</span>&nbsp;<span class="op" id="5520320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5520323">if</span>&nbsp;<span class="builtinfunc" id="5520326">len</span><span class="op" id="5520329">(</span><span class="ident" id="5520330">symbols</span><span class="op" id="5520337">)</span>&nbsp;<span class="op" id="5520339">&gt;</span>&nbsp;<span class="num" id="5520341">256</span>&nbsp;<span class="op" id="5520345">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5520349">panic</span><span class="op" id="5520354">(</span><span class="string" id="5520355">&#34;too&nbsp;many&nbsp;symbols&#34;</span><span class="op" id="5520373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5520376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5520379">return</span>&nbsp;<span class="ident" id="5520386">moveToFrontDecoder</span><span class="op" id="5520404">(</span><span class="ident" id="5520405">symbols</span><span class="op" id="5520412">)</span><br>
<span class="lineno"></span><span class="op" id="5520414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5520417">//&nbsp;newMTFDecoderWithRange&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="5520491">//&nbsp;symbol&nbsp;list&nbsp;of&nbsp;0...n-1.</span><br>
<span class="lineno"></span><span class="keyword" id="5520518">func</span>&nbsp;<span class="ident" id="5520523">newMTFDecoderWithRange</span><span class="op" id="5520545">(</span><span class="ident" id="5520546">n</span>&nbsp;<span class="builtintype" id="5520548">int</span><span class="op" id="5520551">)</span>&nbsp;<span class="ident" id="5520553">moveToFrontDecoder</span>&nbsp;<span class="op" id="5520572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5520575">if</span>&nbsp;<span class="ident" id="5520578">n</span>&nbsp;<span class="op" id="5520580">&gt;</span>&nbsp;<span class="num" id="5520582">256</span>&nbsp;<span class="op" id="5520586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5520590">panic</span><span class="op" id="5520595">(</span><span class="string" id="5520596">&#34;newMTFDecoderWithRange:&nbsp;cannot&nbsp;have&nbsp;&gt;&nbsp;256&nbsp;symbols&#34;</span><span class="op" id="5520647">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5520650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5520654">m</span>&nbsp;<span class="op" id="5520656">:=</span>&nbsp;<span class="builtinfunc" id="5520659">make</span><span class="op" id="5520663">(</span><span class="op" id="5520664">[</span><span class="op" id="5520665">]</span><span class="builtintype" id="5520666">byte</span><span class="op" id="5520670">,</span>&nbsp;<span class="ident" id="5520672">n</span><span class="op" id="5520673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5520676">for</span>&nbsp;<span class="ident" id="5520680">i</span>&nbsp;<span class="op" id="5520682">:=</span>&nbsp;<span class="num" id="5520685">0</span><span class="op" id="5520686">;</span>&nbsp;<span class="ident" id="5520688">i</span>&nbsp;<span class="op" id="5520690">&lt;</span>&nbsp;<span class="ident" id="5520692">n</span><span class="op" id="5520693">;</span>&nbsp;<span class="ident" id="5520695">i</span><span class="op" id="5520696">++</span>&nbsp;<span class="op" id="5520699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5520703">m</span><span class="op" id="5520704">[</span><span class="ident" id="5520705">i</span><span class="op" id="5520706">]</span>&nbsp;<span class="op" id="5520708">=</span>&nbsp;<span class="builtintype" id="5520710">byte</span><span class="op" id="5520714">(</span><span class="ident" id="5520715">i</span><span class="op" id="5520716">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5520719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5520722">return</span>&nbsp;<span class="ident" id="5520729">moveToFrontDecoder</span><span class="op" id="5520747">(</span><span class="ident" id="5520748">m</span><span class="op" id="5520749">)</span><br>
<span class="lineno"></span><span class="op" id="5520751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5520754">func</span>&nbsp;<span class="op" id="5520759">(</span><span class="ident" id="5520760">m</span>&nbsp;<span class="ident" id="5520762">moveToFrontDecoder</span><span class="op" id="5520780">)</span>&nbsp;<span class="ident" id="5520782">Decode</span><span class="op" id="5520788">(</span><span class="ident" id="5520789">n</span>&nbsp;<span class="builtintype" id="5520791">int</span><span class="op" id="5520794">)</span>&nbsp;<span class="op" id="5520796">(</span><span class="ident" id="5520797">b</span>&nbsp;<span class="builtintype" id="5520799">byte</span><span class="op" id="5520803">)</span>&nbsp;<span class="op" id="5520805">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520808">//&nbsp;Implement&nbsp;move-to-front&nbsp;with&nbsp;a&nbsp;simple&nbsp;copy.&nbsp;This&nbsp;approach</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520870">//&nbsp;beats&nbsp;more&nbsp;sophisticated&nbsp;approaches&nbsp;in&nbsp;benchmarking,&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520936">//&nbsp;because&nbsp;it&nbsp;has&nbsp;high&nbsp;locality&nbsp;of&nbsp;reference&nbsp;inside&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5520994">//&nbsp;single&nbsp;cache&nbsp;line&nbsp;(most&nbsp;move-to-front&nbsp;operations&nbsp;have&nbsp;n&nbsp;&lt;&nbsp;64).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5521061">b</span>&nbsp;<span class="op" id="5521063">=</span>&nbsp;<span class="ident" id="5521065">m</span><span class="op" id="5521066">[</span><span class="ident" id="5521067">n</span><span class="op" id="5521068">]</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5521071">copy</span><span class="op" id="5521075">(</span><span class="ident" id="5521076">m</span><span class="op" id="5521077">[</span><span class="num" id="5521078">1</span><span class="op" id="5521079">:</span><span class="op" id="5521080">]</span><span class="op" id="5521081">,</span>&nbsp;<span class="ident" id="5521083">m</span><span class="op" id="5521084">[</span><span class="op" id="5521085">:</span><span class="ident" id="5521086">n</span><span class="op" id="5521087">]</span><span class="op" id="5521088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5521091">m</span><span class="op" id="5521092">[</span><span class="num" id="5521093">0</span><span class="op" id="5521094">]</span>&nbsp;<span class="op" id="5521096">=</span>&nbsp;<span class="ident" id="5521098">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5521101">return</span><br>
<span class="lineno"></span><span class="op" id="5521108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5521111">//&nbsp;First&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="5521165">func</span>&nbsp;<span class="op" id="5521170">(</span><span class="ident" id="5521171">m</span>&nbsp;<span class="ident" id="5521173">moveToFrontDecoder</span><span class="op" id="5521191">)</span>&nbsp;<span class="ident" id="5521193">First</span><span class="op" id="5521198">(</span><span class="op" id="5521199">)</span>&nbsp;<span class="builtintype" id="5521201">byte</span>&nbsp;<span class="op" id="5521206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5521209">return</span>&nbsp;<span class="ident" id="5521216">m</span><span class="op" id="5521217">[</span><span class="num" id="5521218">0</span><span class="op" id="5521219">]</span><br>
<span class="lineno"></span><span class="op" id="5521221">}</span>
</div>
</body>
</html>
