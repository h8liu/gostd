<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html" class="current">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3355222">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3355278">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3355332">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3355383">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3355456">package</span>&nbsp;<span class="ident" id="3355464">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3355469">import</span>&nbsp;<span class="op" id="3355476">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3355479">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3355485">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="3355495">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3355498">//&nbsp;Boolean&nbsp;to&nbsp;int.</span><br>
<span class="lineno">15</span><span class="keyword" id="3355517">func</span>&nbsp;<span class="ident" id="3355522">boolint</span><span class="op" id="3355529">(</span><span class="ident" id="3355530">b</span>&nbsp;<span class="builtintype" id="3355532">bool</span><span class="op" id="3355536">)</span>&nbsp;<span class="builtintype" id="3355538">int</span>&nbsp;<span class="op" id="3355542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355545">if</span>&nbsp;<span class="ident" id="3355548">b</span>&nbsp;<span class="op" id="3355550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355554">return</span>&nbsp;<span class="num" id="3355561">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3355564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355567">return</span>&nbsp;<span class="num" id="3355574">0</span><br>
<span class="lineno">20</span><span class="op" id="3355576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3355579">func</span>&nbsp;<span class="ident" id="3355584">ipv4AddrToInterface</span><span class="op" id="3355603">(</span><span class="ident" id="3355604">ip</span>&nbsp;<span class="ident" id="3355607">IP</span><span class="op" id="3355609">)</span>&nbsp;<span class="op" id="3355611">(</span><span class="op" id="3355612">*</span><span class="ident" id="3355613">Interface</span><span class="op" id="3355622">,</span>&nbsp;<span class="builtintype" id="3355624">error</span><span class="op" id="3355629">)</span>&nbsp;<span class="op" id="3355631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3355634">ift</span><span class="op" id="3355637">,</span>&nbsp;<span class="ident" id="3355639">err</span>&nbsp;<span class="op" id="3355643">:=</span>&nbsp;<span class="ident" id="3355646">Interfaces</span><span class="op" id="3355656">(</span><span class="op" id="3355657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355660">if</span>&nbsp;<span class="ident" id="3355663">err</span>&nbsp;<span class="op" id="3355667">!=</span>&nbsp;<span class="builtintype" id="3355670">nil</span>&nbsp;<span class="op" id="3355674">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355678">return</span>&nbsp;<span class="builtintype" id="3355685">nil</span><span class="op" id="3355688">,</span>&nbsp;<span class="ident" id="3355690">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3355695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355698">for</span>&nbsp;<span class="ident" id="3355702">_</span><span class="op" id="3355703">,</span>&nbsp;<span class="ident" id="3355705">ifi</span>&nbsp;<span class="op" id="3355709">:=</span>&nbsp;<span class="keyword" id="3355712">range</span>&nbsp;<span class="ident" id="3355718">ift</span>&nbsp;<span class="op" id="3355722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3355726">ifat</span><span class="op" id="3355730">,</span>&nbsp;<span class="ident" id="3355732">err</span>&nbsp;<span class="op" id="3355736">:=</span>&nbsp;<span class="ident" id="3355739">ifi</span><span class="op" id="3355742">.</span><span class="ident" id="3355743">Addrs</span><span class="op" id="3355748">(</span><span class="op" id="3355749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355753">if</span>&nbsp;<span class="ident" id="3355756">err</span>&nbsp;<span class="op" id="3355760">!=</span>&nbsp;<span class="builtintype" id="3355763">nil</span>&nbsp;<span class="op" id="3355767">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355772">return</span>&nbsp;<span class="builtintype" id="3355779">nil</span><span class="op" id="3355782">,</span>&nbsp;<span class="ident" id="3355784">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3355790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355794">for</span>&nbsp;<span class="ident" id="3355798">_</span><span class="op" id="3355799">,</span>&nbsp;<span class="ident" id="3355801">ifa</span>&nbsp;<span class="op" id="3355805">:=</span>&nbsp;<span class="keyword" id="3355808">range</span>&nbsp;<span class="ident" id="3355814">ifat</span>&nbsp;<span class="op" id="3355819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355824">switch</span>&nbsp;<span class="ident" id="3355831">v</span>&nbsp;<span class="op" id="3355833">:=</span>&nbsp;<span class="ident" id="3355836">ifa</span><span class="op" id="3355839">.</span><span class="op" id="3355840">(</span><span class="keyword" id="3355841">type</span><span class="op" id="3355845">)</span>&nbsp;<span class="op" id="3355847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355852">case</span>&nbsp;<span class="op" id="3355857">*</span><span class="ident" id="3355858">IPAddr</span><span class="op" id="3355864">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355870">if</span>&nbsp;<span class="ident" id="3355873">ip</span><span class="op" id="3355875">.</span><span class="ident" id="3355876">Equal</span><span class="op" id="3355881">(</span><span class="ident" id="3355882">v</span><span class="op" id="3355883">.</span><span class="ident" id="3355884">IP</span><span class="op" id="3355886">)</span>&nbsp;<span class="op" id="3355888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355895">return</span>&nbsp;<span class="op" id="3355902">&amp;</span><span class="ident" id="3355903">ifi</span><span class="op" id="3355906">,</span>&nbsp;<span class="builtintype" id="3355908">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3355916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355921">case</span>&nbsp;<span class="op" id="3355926">*</span><span class="ident" id="3355927">IPNet</span><span class="op" id="3355932">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355938">if</span>&nbsp;<span class="ident" id="3355941">ip</span><span class="op" id="3355943">.</span><span class="ident" id="3355944">Equal</span><span class="op" id="3355949">(</span><span class="ident" id="3355950">v</span><span class="op" id="3355951">.</span><span class="ident" id="3355952">IP</span><span class="op" id="3355954">)</span>&nbsp;<span class="op" id="3355956">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355963">return</span>&nbsp;<span class="op" id="3355970">&amp;</span><span class="ident" id="3355971">ifi</span><span class="op" id="3355974">,</span>&nbsp;<span class="builtintype" id="3355976">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3355984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3355989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3355993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3355996">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3355999">if</span>&nbsp;<span class="ident" id="3356002">ip</span><span class="op" id="3356004">.</span><span class="ident" id="3356005">Equal</span><span class="op" id="3356010">(</span><span class="ident" id="3356011">IPv4zero</span><span class="op" id="3356019">)</span>&nbsp;<span class="op" id="3356021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356025">return</span>&nbsp;<span class="builtintype" id="3356032">nil</span><span class="op" id="3356035">,</span>&nbsp;<span class="builtintype" id="3356037">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356045">return</span>&nbsp;<span class="builtintype" id="3356052">nil</span><span class="op" id="3356055">,</span>&nbsp;<span class="ident" id="3356057">errNoSuchInterface</span><br>
<span class="lineno"></span><span class="op" id="3356076">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="3356079">func</span>&nbsp;<span class="ident" id="3356084">interfaceToIPv4Addr</span><span class="op" id="3356103">(</span><span class="ident" id="3356104">ifi</span>&nbsp;<span class="op" id="3356108">*</span><span class="ident" id="3356109">Interface</span><span class="op" id="3356118">)</span>&nbsp;<span class="op" id="3356120">(</span><span class="ident" id="3356121">IP</span><span class="op" id="3356123">,</span>&nbsp;<span class="builtintype" id="3356125">error</span><span class="op" id="3356130">)</span>&nbsp;<span class="op" id="3356132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356135">if</span>&nbsp;<span class="ident" id="3356138">ifi</span>&nbsp;<span class="op" id="3356142">==</span>&nbsp;<span class="builtintype" id="3356145">nil</span>&nbsp;<span class="op" id="3356149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356153">return</span>&nbsp;<span class="ident" id="3356160">IPv4zero</span><span class="op" id="3356168">,</span>&nbsp;<span class="builtintype" id="3356170">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356175">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356178">ifat</span><span class="op" id="3356182">,</span>&nbsp;<span class="ident" id="3356184">err</span>&nbsp;<span class="op" id="3356188">:=</span>&nbsp;<span class="ident" id="3356191">ifi</span><span class="op" id="3356194">.</span><span class="ident" id="3356195">Addrs</span><span class="op" id="3356200">(</span><span class="op" id="3356201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356204">if</span>&nbsp;<span class="ident" id="3356207">err</span>&nbsp;<span class="op" id="3356211">!=</span>&nbsp;<span class="builtintype" id="3356214">nil</span>&nbsp;<span class="op" id="3356218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356222">return</span>&nbsp;<span class="builtintype" id="3356229">nil</span><span class="op" id="3356232">,</span>&nbsp;<span class="ident" id="3356234">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356242">for</span>&nbsp;<span class="ident" id="3356246">_</span><span class="op" id="3356247">,</span>&nbsp;<span class="ident" id="3356249">ifa</span>&nbsp;<span class="op" id="3356253">:=</span>&nbsp;<span class="keyword" id="3356256">range</span>&nbsp;<span class="ident" id="3356262">ifat</span>&nbsp;<span class="op" id="3356267">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356271">switch</span>&nbsp;<span class="ident" id="3356278">v</span>&nbsp;<span class="op" id="3356280">:=</span>&nbsp;<span class="ident" id="3356283">ifa</span><span class="op" id="3356286">.</span><span class="op" id="3356287">(</span><span class="keyword" id="3356288">type</span><span class="op" id="3356292">)</span>&nbsp;<span class="op" id="3356294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356298">case</span>&nbsp;<span class="op" id="3356303">*</span><span class="ident" id="3356304">IPAddr</span><span class="op" id="3356310">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356315">if</span>&nbsp;<span class="ident" id="3356318">v</span><span class="op" id="3356319">.</span><span class="ident" id="3356320">IP</span><span class="op" id="3356322">.</span><span class="ident" id="3356323">To4</span><span class="op" id="3356326">(</span><span class="op" id="3356327">)</span>&nbsp;<span class="op" id="3356329">!=</span>&nbsp;<span class="builtintype" id="3356332">nil</span>&nbsp;<span class="op" id="3356336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356342">return</span>&nbsp;<span class="ident" id="3356349">v</span><span class="op" id="3356350">.</span><span class="ident" id="3356351">IP</span><span class="op" id="3356353">,</span>&nbsp;<span class="builtintype" id="3356355">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356362">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356366">case</span>&nbsp;<span class="op" id="3356371">*</span><span class="ident" id="3356372">IPNet</span><span class="op" id="3356377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356382">if</span>&nbsp;<span class="ident" id="3356385">v</span><span class="op" id="3356386">.</span><span class="ident" id="3356387">IP</span><span class="op" id="3356389">.</span><span class="ident" id="3356390">To4</span><span class="op" id="3356393">(</span><span class="op" id="3356394">)</span>&nbsp;<span class="op" id="3356396">!=</span>&nbsp;<span class="builtintype" id="3356399">nil</span>&nbsp;<span class="op" id="3356403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356409">return</span>&nbsp;<span class="ident" id="3356416">v</span><span class="op" id="3356417">.</span><span class="ident" id="3356418">IP</span><span class="op" id="3356420">,</span>&nbsp;<span class="builtintype" id="3356422">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356433">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356439">return</span>&nbsp;<span class="builtintype" id="3356446">nil</span><span class="op" id="3356449">,</span>&nbsp;<span class="ident" id="3356451">errNoSuchInterface</span><br>
<span class="lineno"></span><span class="op" id="3356470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3356473">func</span>&nbsp;<span class="ident" id="3356478">setIPv4MreqToInterface</span><span class="op" id="3356500">(</span><span class="ident" id="3356501">mreq</span>&nbsp;<span class="op" id="3356506">*</span><span class="ident" id="3356507">syscall</span><span class="op" id="3356514">.</span><span class="ident" id="3356515">IPMreq</span><span class="op" id="3356521">,</span>&nbsp;<span class="ident" id="3356523">ifi</span>&nbsp;<span class="op" id="3356527">*</span><span class="ident" id="3356528">Interface</span><span class="op" id="3356537">)</span>&nbsp;<span class="builtintype" id="3356539">error</span>&nbsp;<span class="op" id="3356545">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356548">if</span>&nbsp;<span class="ident" id="3356551">ifi</span>&nbsp;<span class="op" id="3356555">==</span>&nbsp;<span class="builtintype" id="3356558">nil</span>&nbsp;<span class="op" id="3356562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356566">return</span>&nbsp;<span class="builtintype" id="3356573">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3356581">ifat</span><span class="op" id="3356585">,</span>&nbsp;<span class="ident" id="3356587">err</span>&nbsp;<span class="op" id="3356591">:=</span>&nbsp;<span class="ident" id="3356594">ifi</span><span class="op" id="3356597">.</span><span class="ident" id="3356598">Addrs</span><span class="op" id="3356603">(</span><span class="op" id="3356604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356607">if</span>&nbsp;<span class="ident" id="3356610">err</span>&nbsp;<span class="op" id="3356614">!=</span>&nbsp;<span class="builtintype" id="3356617">nil</span>&nbsp;<span class="op" id="3356621">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356625">return</span>&nbsp;<span class="ident" id="3356632">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356640">for</span>&nbsp;<span class="ident" id="3356644">_</span><span class="op" id="3356645">,</span>&nbsp;<span class="ident" id="3356647">ifa</span>&nbsp;<span class="op" id="3356651">:=</span>&nbsp;<span class="keyword" id="3356654">range</span>&nbsp;<span class="ident" id="3356660">ifat</span>&nbsp;<span class="op" id="3356665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356669">switch</span>&nbsp;<span class="ident" id="3356676">v</span>&nbsp;<span class="op" id="3356678">:=</span>&nbsp;<span class="ident" id="3356681">ifa</span><span class="op" id="3356684">.</span><span class="op" id="3356685">(</span><span class="keyword" id="3356686">type</span><span class="op" id="3356690">)</span>&nbsp;<span class="op" id="3356692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356696">case</span>&nbsp;<span class="op" id="3356701">*</span><span class="ident" id="3356702">IPAddr</span><span class="op" id="3356708">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356713">if</span>&nbsp;<span class="ident" id="3356716">a</span>&nbsp;<span class="op" id="3356718">:=</span>&nbsp;<span class="ident" id="3356721">v</span><span class="op" id="3356722">.</span><span class="ident" id="3356723">IP</span><span class="op" id="3356725">.</span><span class="ident" id="3356726">To4</span><span class="op" id="3356729">(</span><span class="op" id="3356730">)</span><span class="op" id="3356731">;</span>&nbsp;<span class="ident" id="3356733">a</span>&nbsp;<span class="op" id="3356735">!=</span>&nbsp;<span class="builtintype" id="3356738">nil</span>&nbsp;<span class="op" id="3356742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3356748">copy</span><span class="op" id="3356752">(</span><span class="ident" id="3356753">mreq</span><span class="op" id="3356757">.</span><span class="ident" id="3356758">Interface</span><span class="op" id="3356767">[</span><span class="op" id="3356768">:</span><span class="op" id="3356769">]</span><span class="op" id="3356770">,</span>&nbsp;<span class="ident" id="3356772">a</span><span class="op" id="3356773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356779">goto</span>&nbsp;<span class="ident" id="3356784">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356796">case</span>&nbsp;<span class="op" id="3356801">*</span><span class="ident" id="3356802">IPNet</span><span class="op" id="3356807">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356812">if</span>&nbsp;<span class="ident" id="3356815">a</span>&nbsp;<span class="op" id="3356817">:=</span>&nbsp;<span class="ident" id="3356820">v</span><span class="op" id="3356821">.</span><span class="ident" id="3356822">IP</span><span class="op" id="3356824">.</span><span class="ident" id="3356825">To4</span><span class="op" id="3356828">(</span><span class="op" id="3356829">)</span><span class="op" id="3356830">;</span>&nbsp;<span class="ident" id="3356832">a</span>&nbsp;<span class="op" id="3356834">!=</span>&nbsp;<span class="builtintype" id="3356837">nil</span>&nbsp;<span class="op" id="3356841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3356847">copy</span><span class="op" id="3356851">(</span><span class="ident" id="3356852">mreq</span><span class="op" id="3356856">.</span><span class="ident" id="3356857">Interface</span><span class="op" id="3356866">[</span><span class="op" id="3356867">:</span><span class="op" id="3356868">]</span><span class="op" id="3356869">,</span>&nbsp;<span class="ident" id="3356871">a</span><span class="op" id="3356872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356878">goto</span>&nbsp;<span class="ident" id="3356883">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356895">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356898">}</span><br>
<span class="lineno"></span><span class="ident" id="3356900">done</span><span class="op" id="3356904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356907">if</span>&nbsp;<span class="ident" id="3356910">bytesEqual</span><span class="op" id="3356920">(</span><span class="ident" id="3356921">mreq</span><span class="op" id="3356925">.</span><span class="ident" id="3356926">Multiaddr</span><span class="op" id="3356935">[</span><span class="op" id="3356936">:</span><span class="op" id="3356937">]</span><span class="op" id="3356938">,</span>&nbsp;<span class="ident" id="3356940">IPv4zero</span><span class="op" id="3356948">.</span><span class="ident" id="3356949">To4</span><span class="op" id="3356952">(</span><span class="op" id="3356953">)</span><span class="op" id="3356954">)</span>&nbsp;<span class="op" id="3356956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356960">return</span>&nbsp;<span class="ident" id="3356967">errNoSuchMulticastInterface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356996">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3356999">return</span>&nbsp;<span class="builtintype" id="3357006">nil</span><br>
<span class="lineno"></span><span class="op" id="3357010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3357013">func</span>&nbsp;<span class="ident" id="3357018">setReadBuffer</span><span class="op" id="3357031">(</span><span class="ident" id="3357032">fd</span>&nbsp;<span class="op" id="3357035">*</span><span class="ident" id="3357036">netFD</span><span class="op" id="3357041">,</span>&nbsp;<span class="ident" id="3357043">bytes</span>&nbsp;<span class="builtintype" id="3357049">int</span><span class="op" id="3357052">)</span>&nbsp;<span class="builtintype" id="3357054">error</span>&nbsp;<span class="op" id="3357060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357063">if</span>&nbsp;<span class="ident" id="3357066">err</span>&nbsp;<span class="op" id="3357070">:=</span>&nbsp;<span class="ident" id="3357073">fd</span><span class="op" id="3357075">.</span><span class="ident" id="3357076">incref</span><span class="op" id="3357082">(</span><span class="op" id="3357083">)</span><span class="op" id="3357084">;</span>&nbsp;<span class="ident" id="3357086">err</span>&nbsp;<span class="op" id="3357090">!=</span>&nbsp;<span class="builtintype" id="3357093">nil</span>&nbsp;<span class="op" id="3357097">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357101">return</span>&nbsp;<span class="ident" id="3357108">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3357113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357116">defer</span>&nbsp;<span class="ident" id="3357122">fd</span><span class="op" id="3357124">.</span><span class="ident" id="3357125">decref</span><span class="op" id="3357131">(</span><span class="op" id="3357132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357135">return</span>&nbsp;<span class="ident" id="3357142">os</span><span class="op" id="3357144">.</span><span class="ident" id="3357145">NewSyscallError</span><span class="op" id="3357160">(</span><span class="string" id="3357161">&#34;setsockopt&#34;</span><span class="op" id="3357173">,</span>&nbsp;<span class="ident" id="3357175">syscall</span><span class="op" id="3357182">.</span><span class="ident" id="3357183">SetsockoptInt</span><span class="op" id="3357196">(</span><span class="ident" id="3357197">fd</span><span class="op" id="3357199">.</span><span class="ident" id="3357200">sysfd</span><span class="op" id="3357205">,</span>&nbsp;<span class="ident" id="3357207">syscall</span><span class="op" id="3357214">.</span><span class="ident" id="3357215">SOL_SOCKET</span><span class="op" id="3357225">,</span>&nbsp;<span class="ident" id="3357227">syscall</span><span class="op" id="3357234">.</span><span class="ident" id="3357235">SO_RCVBUF</span><span class="op" id="3357244">,</span>&nbsp;<span class="ident" id="3357246">bytes</span><span class="op" id="3357251">)</span><span class="op" id="3357252">)</span><br>
<span class="lineno"></span><span class="op" id="3357254">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="3357257">func</span>&nbsp;<span class="ident" id="3357262">setWriteBuffer</span><span class="op" id="3357276">(</span><span class="ident" id="3357277">fd</span>&nbsp;<span class="op" id="3357280">*</span><span class="ident" id="3357281">netFD</span><span class="op" id="3357286">,</span>&nbsp;<span class="ident" id="3357288">bytes</span>&nbsp;<span class="builtintype" id="3357294">int</span><span class="op" id="3357297">)</span>&nbsp;<span class="builtintype" id="3357299">error</span>&nbsp;<span class="op" id="3357305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357308">if</span>&nbsp;<span class="ident" id="3357311">err</span>&nbsp;<span class="op" id="3357315">:=</span>&nbsp;<span class="ident" id="3357318">fd</span><span class="op" id="3357320">.</span><span class="ident" id="3357321">incref</span><span class="op" id="3357327">(</span><span class="op" id="3357328">)</span><span class="op" id="3357329">;</span>&nbsp;<span class="ident" id="3357331">err</span>&nbsp;<span class="op" id="3357335">!=</span>&nbsp;<span class="builtintype" id="3357338">nil</span>&nbsp;<span class="op" id="3357342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357346">return</span>&nbsp;<span class="ident" id="3357353">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3357358">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357361">defer</span>&nbsp;<span class="ident" id="3357367">fd</span><span class="op" id="3357369">.</span><span class="ident" id="3357370">decref</span><span class="op" id="3357376">(</span><span class="op" id="3357377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357380">return</span>&nbsp;<span class="ident" id="3357387">os</span><span class="op" id="3357389">.</span><span class="ident" id="3357390">NewSyscallError</span><span class="op" id="3357405">(</span><span class="string" id="3357406">&#34;setsockopt&#34;</span><span class="op" id="3357418">,</span>&nbsp;<span class="ident" id="3357420">syscall</span><span class="op" id="3357427">.</span><span class="ident" id="3357428">SetsockoptInt</span><span class="op" id="3357441">(</span><span class="ident" id="3357442">fd</span><span class="op" id="3357444">.</span><span class="ident" id="3357445">sysfd</span><span class="op" id="3357450">,</span>&nbsp;<span class="ident" id="3357452">syscall</span><span class="op" id="3357459">.</span><span class="ident" id="3357460">SOL_SOCKET</span><span class="op" id="3357470">,</span>&nbsp;<span class="ident" id="3357472">syscall</span><span class="op" id="3357479">.</span><span class="ident" id="3357480">SO_SNDBUF</span><span class="op" id="3357489">,</span>&nbsp;<span class="ident" id="3357491">bytes</span><span class="op" id="3357496">)</span><span class="op" id="3357497">)</span><br>
<span class="lineno"></span><span class="op" id="3357499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3357502">func</span>&nbsp;<span class="ident" id="3357507">setKeepAlive</span><span class="op" id="3357519">(</span><span class="ident" id="3357520">fd</span>&nbsp;<span class="op" id="3357523">*</span><span class="ident" id="3357524">netFD</span><span class="op" id="3357529">,</span>&nbsp;<span class="ident" id="3357531">keepalive</span>&nbsp;<span class="builtintype" id="3357541">bool</span><span class="op" id="3357545">)</span>&nbsp;<span class="builtintype" id="3357547">error</span>&nbsp;<span class="op" id="3357553">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357556">if</span>&nbsp;<span class="ident" id="3357559">err</span>&nbsp;<span class="op" id="3357563">:=</span>&nbsp;<span class="ident" id="3357566">fd</span><span class="op" id="3357568">.</span><span class="ident" id="3357569">incref</span><span class="op" id="3357575">(</span><span class="op" id="3357576">)</span><span class="op" id="3357577">;</span>&nbsp;<span class="ident" id="3357579">err</span>&nbsp;<span class="op" id="3357583">!=</span>&nbsp;<span class="builtintype" id="3357586">nil</span>&nbsp;<span class="op" id="3357590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357594">return</span>&nbsp;<span class="ident" id="3357601">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3357606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357609">defer</span>&nbsp;<span class="ident" id="3357615">fd</span><span class="op" id="3357617">.</span><span class="ident" id="3357618">decref</span><span class="op" id="3357624">(</span><span class="op" id="3357625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357628">return</span>&nbsp;<span class="ident" id="3357635">os</span><span class="op" id="3357637">.</span><span class="ident" id="3357638">NewSyscallError</span><span class="op" id="3357653">(</span><span class="string" id="3357654">&#34;setsockopt&#34;</span><span class="op" id="3357666">,</span>&nbsp;<span class="ident" id="3357668">syscall</span><span class="op" id="3357675">.</span><span class="ident" id="3357676">SetsockoptInt</span><span class="op" id="3357689">(</span><span class="ident" id="3357690">fd</span><span class="op" id="3357692">.</span><span class="ident" id="3357693">sysfd</span><span class="op" id="3357698">,</span>&nbsp;<span class="ident" id="3357700">syscall</span><span class="op" id="3357707">.</span><span class="ident" id="3357708">SOL_SOCKET</span><span class="op" id="3357718">,</span>&nbsp;<span class="ident" id="3357720">syscall</span><span class="op" id="3357727">.</span><span class="ident" id="3357728">SO_KEEPALIVE</span><span class="op" id="3357740">,</span>&nbsp;<span class="ident" id="3357742">boolint</span><span class="op" id="3357749">(</span><span class="ident" id="3357750">keepalive</span><span class="op" id="3357759">)</span><span class="op" id="3357760">)</span><span class="op" id="3357761">)</span><br>
<span class="lineno">125</span><span class="op" id="3357763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3357766">func</span>&nbsp;<span class="ident" id="3357771">setLinger</span><span class="op" id="3357780">(</span><span class="ident" id="3357781">fd</span>&nbsp;<span class="op" id="3357784">*</span><span class="ident" id="3357785">netFD</span><span class="op" id="3357790">,</span>&nbsp;<span class="ident" id="3357792">sec</span>&nbsp;<span class="builtintype" id="3357796">int</span><span class="op" id="3357799">)</span>&nbsp;<span class="builtintype" id="3357801">error</span>&nbsp;<span class="op" id="3357807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357810">var</span>&nbsp;<span class="ident" id="3357814">l</span>&nbsp;<span class="ident" id="3357816">syscall</span><span class="op" id="3357823">.</span><span class="ident" id="3357824">Linger</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357832">if</span>&nbsp;<span class="ident" id="3357835">sec</span>&nbsp;<span class="op" id="3357839">&gt;=</span>&nbsp;<span class="num" id="3357842">0</span>&nbsp;<span class="op" id="3357844">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3357848">l</span><span class="op" id="3357849">.</span><span class="ident" id="3357850">Onoff</span>&nbsp;<span class="op" id="3357856">=</span>&nbsp;<span class="num" id="3357858">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3357862">l</span><span class="op" id="3357863">.</span><span class="ident" id="3357864">Linger</span>&nbsp;<span class="op" id="3357871">=</span>&nbsp;<span class="builtintype" id="3357873">int32</span><span class="op" id="3357878">(</span><span class="ident" id="3357879">sec</span><span class="op" id="3357882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3357885">}</span>&nbsp;<span class="keyword" id="3357887">else</span>&nbsp;<span class="op" id="3357892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3357896">l</span><span class="op" id="3357897">.</span><span class="ident" id="3357898">Onoff</span>&nbsp;<span class="op" id="3357904">=</span>&nbsp;<span class="num" id="3357906">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3357910">l</span><span class="op" id="3357911">.</span><span class="ident" id="3357912">Linger</span>&nbsp;<span class="op" id="3357919">=</span>&nbsp;<span class="num" id="3357921">0</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3357924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357927">if</span>&nbsp;<span class="ident" id="3357930">err</span>&nbsp;<span class="op" id="3357934">:=</span>&nbsp;<span class="ident" id="3357937">fd</span><span class="op" id="3357939">.</span><span class="ident" id="3357940">incref</span><span class="op" id="3357946">(</span><span class="op" id="3357947">)</span><span class="op" id="3357948">;</span>&nbsp;<span class="ident" id="3357950">err</span>&nbsp;<span class="op" id="3357954">!=</span>&nbsp;<span class="builtintype" id="3357957">nil</span>&nbsp;<span class="op" id="3357961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357965">return</span>&nbsp;<span class="ident" id="3357972">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3357977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357980">defer</span>&nbsp;<span class="ident" id="3357986">fd</span><span class="op" id="3357988">.</span><span class="ident" id="3357989">decref</span><span class="op" id="3357995">(</span><span class="op" id="3357996">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3357999">return</span>&nbsp;<span class="ident" id="3358006">os</span><span class="op" id="3358008">.</span><span class="ident" id="3358009">NewSyscallError</span><span class="op" id="3358024">(</span><span class="string" id="3358025">&#34;setsockopt&#34;</span><span class="op" id="3358037">,</span>&nbsp;<span class="ident" id="3358039">syscall</span><span class="op" id="3358046">.</span><span class="ident" id="3358047">SetsockoptLinger</span><span class="op" id="3358063">(</span><span class="ident" id="3358064">fd</span><span class="op" id="3358066">.</span><span class="ident" id="3358067">sysfd</span><span class="op" id="3358072">,</span>&nbsp;<span class="ident" id="3358074">syscall</span><span class="op" id="3358081">.</span><span class="ident" id="3358082">SOL_SOCKET</span><span class="op" id="3358092">,</span>&nbsp;<span class="ident" id="3358094">syscall</span><span class="op" id="3358101">.</span><span class="ident" id="3358102">SO_LINGER</span><span class="op" id="3358111">,</span>&nbsp;<span class="op" id="3358113">&amp;</span><span class="ident" id="3358114">l</span><span class="op" id="3358115">)</span><span class="op" id="3358116">)</span><br>
<span class="lineno"></span><span class="op" id="3358118">}</span>
</div>
</body>
</html>
