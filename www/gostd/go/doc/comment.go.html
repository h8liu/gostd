<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/doc</h2>
<ul>
<li><a href="/gostd/go/doc/comment.go.html">comment.go</a></li>
<li><a href="/gostd/go/doc/comment_test.go.html">comment_test.go</a></li>
<li><a href="/gostd/go/doc/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/doc/doc_test.go.html">doc_test.go</a></li>
<li><a href="/gostd/go/doc/example.go.html">example.go</a></li>
<li><a href="/gostd/go/doc/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/doc/exports.go.html">exports.go</a></li>
<li><a href="/gostd/go/doc/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/doc/reader.go.html">reader.go</a></li>
<li><a href="/gostd/go/doc/synopsis.go.html">synopsis.go</a></li>
<li><a href="/gostd/go/doc/synopsis_test.go.html">synopsis_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5747404">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5747459">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5747513">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5747564">//&nbsp;Godoc&nbsp;comment&nbsp;extraction&nbsp;and&nbsp;comment&nbsp;-&gt;&nbsp;HTML&nbsp;formatting.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5747625">package</span>&nbsp;<span class="ident" id="5747633">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5747638">import</span>&nbsp;<span class="op" id="5747645">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5747648">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5747654">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5747664">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5747675">&#34;text/template&#34;</span>&nbsp;<span class="comment" id="5747691">//&nbsp;for&nbsp;HTMLEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5747710">&#34;unicode&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5747721">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5747736">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5747739">var</span>&nbsp;<span class="op" id="5747743">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747746">ldquo</span>&nbsp;<span class="op" id="5747752">=</span>&nbsp;<span class="op" id="5747754">[</span><span class="op" id="5747755">]</span><span class="builtintype" id="5747756">byte</span><span class="op" id="5747760">(</span><span class="string" id="5747761">&#34;&amp;ldquo;&#34;</span><span class="op" id="5747770">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747773">rdquo</span>&nbsp;<span class="op" id="5747779">=</span>&nbsp;<span class="op" id="5747781">[</span><span class="op" id="5747782">]</span><span class="builtintype" id="5747783">byte</span><span class="op" id="5747787">(</span><span class="string" id="5747788">&#34;&amp;rdquo;&#34;</span><span class="op" id="5747797">)</span><br>
<span class="lineno"></span><span class="op" id="5747799">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5747802">//&nbsp;Escape&nbsp;comment&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,</span><br>
<span class="lineno"></span><span class="comment" id="5747851">//&nbsp;also&nbsp;turn&nbsp;``&nbsp;into&nbsp;&amp;ldquo;&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;.</span><br>
<span class="lineno">25</span><span class="keyword" id="5747901">func</span>&nbsp;<span class="ident" id="5747906">commentEscape</span><span class="op" id="5747919">(</span><span class="ident" id="5747920">w</span>&nbsp;<span class="ident" id="5747922">io</span><span class="op" id="5747924">.</span><span class="ident" id="5747925">Writer</span><span class="op" id="5747931">,</span>&nbsp;<span class="ident" id="5747933">text</span>&nbsp;<span class="builtintype" id="5747938">string</span><span class="op" id="5747944">,</span>&nbsp;<span class="ident" id="5747946">nice</span>&nbsp;<span class="builtintype" id="5747951">bool</span><span class="op" id="5747955">)</span>&nbsp;<span class="op" id="5747957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747960">last</span>&nbsp;<span class="op" id="5747965">:=</span>&nbsp;<span class="num" id="5747968">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747971">if</span>&nbsp;<span class="ident" id="5747974">nice</span>&nbsp;<span class="op" id="5747979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747983">for</span>&nbsp;<span class="ident" id="5747987">i</span>&nbsp;<span class="op" id="5747989">:=</span>&nbsp;<span class="num" id="5747992">0</span><span class="op" id="5747993">;</span>&nbsp;<span class="ident" id="5747995">i</span>&nbsp;<span class="op" id="5747997">&lt;</span>&nbsp;<span class="builtinfunc" id="5747999">len</span><span class="op" id="5748002">(</span><span class="ident" id="5748003">text</span><span class="op" id="5748007">)</span><span class="op" id="5748008">-</span><span class="num" id="5748009">1</span><span class="op" id="5748010">;</span>&nbsp;<span class="ident" id="5748012">i</span><span class="op" id="5748013">++</span>&nbsp;<span class="op" id="5748016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748021">ch</span>&nbsp;<span class="op" id="5748024">:=</span>&nbsp;<span class="ident" id="5748027">text</span><span class="op" id="5748031">[</span><span class="ident" id="5748032">i</span><span class="op" id="5748033">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748038">if</span>&nbsp;<span class="ident" id="5748041">ch</span>&nbsp;<span class="op" id="5748044">==</span>&nbsp;<span class="ident" id="5748047">text</span><span class="op" id="5748051">[</span><span class="ident" id="5748052">i</span><span class="op" id="5748053">+</span><span class="num" id="5748054">1</span><span class="op" id="5748055">]</span>&nbsp;<span class="op" id="5748057">&amp;&amp;</span>&nbsp;<span class="op" id="5748060">(</span><span class="ident" id="5748061">ch</span>&nbsp;<span class="op" id="5748064">==</span>&nbsp;<span class="string" id="5748067">&#39;`&#39;</span>&nbsp;<span class="op" id="5748071">||</span>&nbsp;<span class="ident" id="5748074">ch</span>&nbsp;<span class="op" id="5748077">==</span>&nbsp;<span class="string" id="5748080">&#39;\&#39;&#39;</span><span class="op" id="5748084">)</span>&nbsp;<span class="op" id="5748086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748092">template</span><span class="op" id="5748100">.</span><span class="ident" id="5748101">HTMLEscape</span><span class="op" id="5748111">(</span><span class="ident" id="5748112">w</span><span class="op" id="5748113">,</span>&nbsp;<span class="op" id="5748115">[</span><span class="op" id="5748116">]</span><span class="builtintype" id="5748117">byte</span><span class="op" id="5748121">(</span><span class="ident" id="5748122">text</span><span class="op" id="5748126">[</span><span class="ident" id="5748127">last</span><span class="op" id="5748131">:</span><span class="ident" id="5748132">i</span><span class="op" id="5748133">]</span><span class="op" id="5748134">)</span><span class="op" id="5748135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748141">last</span>&nbsp;<span class="op" id="5748146">=</span>&nbsp;<span class="ident" id="5748148">i</span>&nbsp;<span class="op" id="5748150">+</span>&nbsp;<span class="num" id="5748152">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748158">switch</span>&nbsp;<span class="ident" id="5748165">ch</span>&nbsp;<span class="op" id="5748168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748174">case</span>&nbsp;<span class="string" id="5748179">&#39;`&#39;</span><span class="op" id="5748182">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748189">w</span><span class="op" id="5748190">.</span><span class="ident" id="5748191">Write</span><span class="op" id="5748196">(</span><span class="ident" id="5748197">ldquo</span><span class="op" id="5748202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748208">case</span>&nbsp;<span class="string" id="5748213">&#39;\&#39;&#39;</span><span class="op" id="5748217">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748224">w</span><span class="op" id="5748225">.</span><span class="ident" id="5748226">Write</span><span class="op" id="5748231">(</span><span class="ident" id="5748232">rdquo</span><span class="op" id="5748237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5748243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748249">i</span><span class="op" id="5748250">++</span>&nbsp;<span class="comment" id="5748253">//&nbsp;loop&nbsp;will&nbsp;add&nbsp;one&nbsp;more</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5748282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5748286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5748289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748292">template</span><span class="op" id="5748300">.</span><span class="ident" id="5748301">HTMLEscape</span><span class="op" id="5748311">(</span><span class="ident" id="5748312">w</span><span class="op" id="5748313">,</span>&nbsp;<span class="op" id="5748315">[</span><span class="op" id="5748316">]</span><span class="builtintype" id="5748317">byte</span><span class="op" id="5748321">(</span><span class="ident" id="5748322">text</span><span class="op" id="5748326">[</span><span class="ident" id="5748327">last</span><span class="op" id="5748331">:</span><span class="op" id="5748332">]</span><span class="op" id="5748333">)</span><span class="op" id="5748334">)</span><br>
<span class="lineno"></span><span class="op" id="5748336">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5748339">const</span>&nbsp;<span class="op" id="5748345">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5748348">//&nbsp;Regexp&nbsp;for&nbsp;Go&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748378">identRx</span>&nbsp;<span class="op" id="5748386">=</span>&nbsp;<span class="string" id="5748388">`[\pL_][\pL_0-9]*`</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5748409">//&nbsp;Regexp&nbsp;for&nbsp;URLs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748429">protocol</span>&nbsp;<span class="op" id="5748438">=</span>&nbsp;<span class="string" id="5748440">`https?|ftp|file|gopher|mailto|news|nntp|telnet|wais|prospero`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748504">hostPart</span>&nbsp;<span class="op" id="5748513">=</span>&nbsp;<span class="string" id="5748515">`[a-zA-Z0-9_@\-]+`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748535">filePart</span>&nbsp;<span class="op" id="5748544">=</span>&nbsp;<span class="string" id="5748546">`[a-zA-Z0-9_?%#~&amp;/\-+=()]+`</span>&nbsp;<span class="comment" id="5748574">//&nbsp;parentheses&nbsp;may&nbsp;not&nbsp;be&nbsp;matching;&nbsp;see&nbsp;pairedParensPrefixLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748637">urlRx</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748646">=</span>&nbsp;<span class="string" id="5748648">`(`</span>&nbsp;<span class="op" id="5748652">+</span>&nbsp;<span class="ident" id="5748654">protocol</span>&nbsp;<span class="op" id="5748663">+</span>&nbsp;<span class="string" id="5748665">`)://`</span>&nbsp;<span class="op" id="5748672">+</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5748676">//&nbsp;http://</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748689">hostPart</span>&nbsp;<span class="op" id="5748698">+</span>&nbsp;<span class="string" id="5748700">`([.:]`</span>&nbsp;<span class="op" id="5748708">+</span>&nbsp;<span class="ident" id="5748710">hostPart</span>&nbsp;<span class="op" id="5748719">+</span>&nbsp;<span class="string" id="5748721">`)*/?`</span>&nbsp;<span class="op" id="5748728">+</span>&nbsp;<span class="comment" id="5748730">//&nbsp;//www.google.com:8080/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748758">filePart</span>&nbsp;<span class="op" id="5748767">+</span>&nbsp;<span class="string" id="5748769">`([:.,]`</span>&nbsp;<span class="op" id="5748778">+</span>&nbsp;<span class="ident" id="5748780">filePart</span>&nbsp;<span class="op" id="5748789">+</span>&nbsp;<span class="string" id="5748791">`)*`</span><br>
<span class="lineno"></span><span class="op" id="5748796">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5748799">var</span>&nbsp;<span class="ident" id="5748803">matchRx</span>&nbsp;<span class="op" id="5748811">=</span>&nbsp;<span class="ident" id="5748813">regexp</span><span class="op" id="5748819">.</span><span class="ident" id="5748820">MustCompile</span><span class="op" id="5748831">(</span><span class="string" id="5748832">`(`</span>&nbsp;<span class="op" id="5748836">+</span>&nbsp;<span class="ident" id="5748838">urlRx</span>&nbsp;<span class="op" id="5748844">+</span>&nbsp;<span class="string" id="5748846">`)|(`</span>&nbsp;<span class="op" id="5748852">+</span>&nbsp;<span class="ident" id="5748854">identRx</span>&nbsp;<span class="op" id="5748862">+</span>&nbsp;<span class="string" id="5748864">`)`</span><span class="op" id="5748867">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="5748870">var</span>&nbsp;<span class="op" id="5748874">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748877">html_a</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748889">=</span>&nbsp;<span class="op" id="5748891">[</span><span class="op" id="5748892">]</span><span class="builtintype" id="5748893">byte</span><span class="op" id="5748897">(</span><span class="string" id="5748898">`&lt;a&nbsp;href=&#34;`</span><span class="op" id="5748909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748912">html_aq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748924">=</span>&nbsp;<span class="op" id="5748926">[</span><span class="op" id="5748927">]</span><span class="builtintype" id="5748928">byte</span><span class="op" id="5748932">(</span><span class="string" id="5748933">`&#34;&gt;`</span><span class="op" id="5748937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748940">html_enda</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5748952">=</span>&nbsp;<span class="op" id="5748954">[</span><span class="op" id="5748955">]</span><span class="builtintype" id="5748956">byte</span><span class="op" id="5748960">(</span><span class="string" id="5748961">&#34;&lt;/a&gt;&#34;</span><span class="op" id="5748967">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748970">html_i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748982">=</span>&nbsp;<span class="op" id="5748984">[</span><span class="op" id="5748985">]</span><span class="builtintype" id="5748986">byte</span><span class="op" id="5748990">(</span><span class="string" id="5748991">&#34;&lt;i&gt;&#34;</span><span class="op" id="5748996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748999">html_endi</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5749011">=</span>&nbsp;<span class="op" id="5749013">[</span><span class="op" id="5749014">]</span><span class="builtintype" id="5749015">byte</span><span class="op" id="5749019">(</span><span class="string" id="5749020">&#34;&lt;/i&gt;&#34;</span><span class="op" id="5749026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749029">html_p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5749041">=</span>&nbsp;<span class="op" id="5749043">[</span><span class="op" id="5749044">]</span><span class="builtintype" id="5749045">byte</span><span class="op" id="5749049">(</span><span class="string" id="5749050">&#34;&lt;p&gt;\n&#34;</span><span class="op" id="5749057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749060">html_endp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5749072">=</span>&nbsp;<span class="op" id="5749074">[</span><span class="op" id="5749075">]</span><span class="builtintype" id="5749076">byte</span><span class="op" id="5749080">(</span><span class="string" id="5749081">&#34;&lt;/p&gt;\n&#34;</span><span class="op" id="5749089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749092">html_pre</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5749104">=</span>&nbsp;<span class="op" id="5749106">[</span><span class="op" id="5749107">]</span><span class="builtintype" id="5749108">byte</span><span class="op" id="5749112">(</span><span class="string" id="5749113">&#34;&lt;pre&gt;&#34;</span><span class="op" id="5749120">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749123">html_endpre</span>&nbsp;<span class="op" id="5749135">=</span>&nbsp;<span class="op" id="5749137">[</span><span class="op" id="5749138">]</span><span class="builtintype" id="5749139">byte</span><span class="op" id="5749143">(</span><span class="string" id="5749144">&#34;&lt;/pre&gt;\n&#34;</span><span class="op" id="5749154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749157">html_h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5749169">=</span>&nbsp;<span class="op" id="5749171">[</span><span class="op" id="5749172">]</span><span class="builtintype" id="5749173">byte</span><span class="op" id="5749177">(</span><span class="string" id="5749178">`&lt;h3&nbsp;id=&#34;`</span><span class="op" id="5749188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749191">html_hq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5749203">=</span>&nbsp;<span class="op" id="5749205">[</span><span class="op" id="5749206">]</span><span class="builtintype" id="5749207">byte</span><span class="op" id="5749211">(</span><span class="string" id="5749212">`&#34;&gt;`</span><span class="op" id="5749216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749219">html_endh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5749231">=</span>&nbsp;<span class="op" id="5749233">[</span><span class="op" id="5749234">]</span><span class="builtintype" id="5749235">byte</span><span class="op" id="5749239">(</span><span class="string" id="5749240">&#34;&lt;/h3&gt;\n&#34;</span><span class="op" id="5749249">)</span><br>
<span class="lineno"></span><span class="op" id="5749251">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="5749254">//&nbsp;pairedParensPrefixLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;longest&nbsp;prefix&nbsp;of&nbsp;s&nbsp;containing&nbsp;paired&nbsp;parentheses.</span><br>
<span class="lineno"></span><span class="keyword" id="5749356">func</span>&nbsp;<span class="ident" id="5749361">pairedParensPrefixLen</span><span class="op" id="5749382">(</span><span class="ident" id="5749383">s</span>&nbsp;<span class="builtintype" id="5749385">string</span><span class="op" id="5749391">)</span>&nbsp;<span class="builtintype" id="5749393">int</span>&nbsp;<span class="op" id="5749397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749400">parens</span>&nbsp;<span class="op" id="5749407">:=</span>&nbsp;<span class="num" id="5749410">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749413">l</span>&nbsp;<span class="op" id="5749415">:=</span>&nbsp;<span class="builtinfunc" id="5749418">len</span><span class="op" id="5749421">(</span><span class="ident" id="5749422">s</span><span class="op" id="5749423">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749426">for</span>&nbsp;<span class="ident" id="5749430">i</span><span class="op" id="5749431">,</span>&nbsp;<span class="ident" id="5749433">ch</span>&nbsp;<span class="op" id="5749436">:=</span>&nbsp;<span class="keyword" id="5749439">range</span>&nbsp;<span class="ident" id="5749445">s</span>&nbsp;<span class="op" id="5749447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749451">switch</span>&nbsp;<span class="ident" id="5749458">ch</span>&nbsp;<span class="op" id="5749461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749465">case</span>&nbsp;<span class="string" id="5749470">&#39;(&#39;</span><span class="op" id="5749473">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749478">if</span>&nbsp;<span class="ident" id="5749481">parens</span>&nbsp;<span class="op" id="5749488">==</span>&nbsp;<span class="num" id="5749491">0</span>&nbsp;<span class="op" id="5749493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749499">l</span>&nbsp;<span class="op" id="5749501">=</span>&nbsp;<span class="ident" id="5749503">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5749508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749513">parens</span><span class="op" id="5749519">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749524">case</span>&nbsp;<span class="string" id="5749529">&#39;)&#39;</span><span class="op" id="5749532">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749537">parens</span><span class="op" id="5749543">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749549">if</span>&nbsp;<span class="ident" id="5749552">parens</span>&nbsp;<span class="op" id="5749559">==</span>&nbsp;<span class="num" id="5749562">0</span>&nbsp;<span class="op" id="5749564">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749570">l</span>&nbsp;<span class="op" id="5749572">=</span>&nbsp;<span class="builtinfunc" id="5749574">len</span><span class="op" id="5749577">(</span><span class="ident" id="5749578">s</span><span class="op" id="5749579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5749584">}</span>&nbsp;<span class="keyword" id="5749586">else</span>&nbsp;<span class="keyword" id="5749591">if</span>&nbsp;<span class="ident" id="5749594">parens</span>&nbsp;<span class="op" id="5749601">&lt;</span>&nbsp;<span class="num" id="5749603">0</span>&nbsp;<span class="op" id="5749605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749611">return</span>&nbsp;<span class="ident" id="5749618">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5749623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5749627">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5749630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749633">return</span>&nbsp;<span class="ident" id="5749640">l</span><br>
<span class="lineno"></span><span class="op" id="5749642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5749645">//&nbsp;Emphasize&nbsp;and&nbsp;escape&nbsp;a&nbsp;line&nbsp;of&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;URLs&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;</span><br>
<span class="lineno">100</span><span class="comment" id="5749725">//&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if</span><br>
<span class="lineno"></span><span class="comment" id="5749805">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="5749882">//&nbsp;into&nbsp;a&nbsp;link).&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5749962">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="5750041">//&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;link.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,&nbsp;the&nbsp;remaining&nbsp;text&#39;s</span><br>
<span class="lineno">105</span><span class="comment" id="5750120">//&nbsp;appearance&nbsp;is&nbsp;improved&nbsp;where&nbsp;it&nbsp;makes&nbsp;sense&nbsp;(e.g.,&nbsp;``&nbsp;is&nbsp;turned&nbsp;into&nbsp;&amp;ldquo;</span><br>
<span class="lineno"></span><span class="comment" id="5750200">//&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;).</span><br>
<span class="lineno"></span><span class="keyword" id="5750225">func</span>&nbsp;<span class="ident" id="5750230">emphasize</span><span class="op" id="5750239">(</span><span class="ident" id="5750240">w</span>&nbsp;<span class="ident" id="5750242">io</span><span class="op" id="5750244">.</span><span class="ident" id="5750245">Writer</span><span class="op" id="5750251">,</span>&nbsp;<span class="ident" id="5750253">line</span>&nbsp;<span class="builtintype" id="5750258">string</span><span class="op" id="5750264">,</span>&nbsp;<span class="ident" id="5750266">words</span>&nbsp;<span class="keyword" id="5750272">map</span><span class="op" id="5750275">[</span><span class="builtintype" id="5750276">string</span><span class="op" id="5750282">]</span><span class="builtintype" id="5750283">string</span><span class="op" id="5750289">,</span>&nbsp;<span class="ident" id="5750291">nice</span>&nbsp;<span class="builtintype" id="5750296">bool</span><span class="op" id="5750300">)</span>&nbsp;<span class="op" id="5750302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750305">for</span>&nbsp;<span class="op" id="5750309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750313">m</span>&nbsp;<span class="op" id="5750315">:=</span>&nbsp;<span class="ident" id="5750318">matchRx</span><span class="op" id="5750325">.</span><span class="ident" id="5750326">FindStringSubmatchIndex</span><span class="op" id="5750349">(</span><span class="ident" id="5750350">line</span><span class="op" id="5750354">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750358">if</span>&nbsp;<span class="ident" id="5750361">m</span>&nbsp;<span class="op" id="5750363">==</span>&nbsp;<span class="ident" id="5750366">nil</span>&nbsp;<span class="op" id="5750370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750375">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5750383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750387">//&nbsp;m&nbsp;&gt;=&nbsp;6&nbsp;(two&nbsp;parenthesized&nbsp;sub-regexps&nbsp;in&nbsp;matchRx,&nbsp;1st&nbsp;one&nbsp;is&nbsp;urlRx)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750461">//&nbsp;write&nbsp;text&nbsp;before&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750490">commentEscape</span><span class="op" id="5750503">(</span><span class="ident" id="5750504">w</span><span class="op" id="5750505">,</span>&nbsp;<span class="ident" id="5750507">line</span><span class="op" id="5750511">[</span><span class="num" id="5750512">0</span><span class="op" id="5750513">:</span><span class="ident" id="5750514">m</span><span class="op" id="5750515">[</span><span class="num" id="5750516">0</span><span class="op" id="5750517">]</span><span class="op" id="5750518">]</span><span class="op" id="5750519">,</span>&nbsp;<span class="ident" id="5750521">nice</span><span class="op" id="5750525">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750530">//&nbsp;adjust&nbsp;match&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750561">match</span>&nbsp;<span class="op" id="5750567">:=</span>&nbsp;<span class="ident" id="5750570">line</span><span class="op" id="5750574">[</span><span class="ident" id="5750575">m</span><span class="op" id="5750576">[</span><span class="num" id="5750577">0</span><span class="op" id="5750578">]</span><span class="op" id="5750579">:</span><span class="ident" id="5750580">m</span><span class="op" id="5750581">[</span><span class="num" id="5750582">1</span><span class="op" id="5750583">]</span><span class="op" id="5750584">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750588">if</span>&nbsp;<span class="ident" id="5750591">n</span>&nbsp;<span class="op" id="5750593">:=</span>&nbsp;<span class="ident" id="5750596">pairedParensPrefixLen</span><span class="op" id="5750617">(</span><span class="ident" id="5750618">match</span><span class="op" id="5750623">)</span><span class="op" id="5750624">;</span>&nbsp;<span class="ident" id="5750626">n</span>&nbsp;<span class="op" id="5750628">&lt;</span>&nbsp;<span class="builtinfunc" id="5750630">len</span><span class="op" id="5750633">(</span><span class="ident" id="5750634">match</span><span class="op" id="5750639">)</span>&nbsp;<span class="op" id="5750641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750646">//&nbsp;match&nbsp;contains&nbsp;unpaired&nbsp;parentheses&nbsp;(rare);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750696">//&nbsp;redo&nbsp;matching&nbsp;with&nbsp;shortened&nbsp;line&nbsp;for&nbsp;correct&nbsp;indices</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750756">m</span>&nbsp;<span class="op" id="5750758">=</span>&nbsp;<span class="ident" id="5750760">matchRx</span><span class="op" id="5750767">.</span><span class="ident" id="5750768">FindStringSubmatchIndex</span><span class="op" id="5750791">(</span><span class="ident" id="5750792">line</span><span class="op" id="5750796">[</span><span class="op" id="5750797">:</span><span class="ident" id="5750798">m</span><span class="op" id="5750799">[</span><span class="num" id="5750800">0</span><span class="op" id="5750801">]</span><span class="op" id="5750802">+</span><span class="ident" id="5750803">n</span><span class="op" id="5750804">]</span><span class="op" id="5750805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750810">match</span>&nbsp;<span class="op" id="5750816">=</span>&nbsp;<span class="ident" id="5750818">match</span><span class="op" id="5750823">[</span><span class="op" id="5750824">:</span><span class="ident" id="5750825">n</span><span class="op" id="5750826">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5750830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750835">//&nbsp;analyze&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750854">url</span>&nbsp;<span class="op" id="5750858">:=</span>&nbsp;<span class="string" id="5750861">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750866">italics</span>&nbsp;<span class="op" id="5750874">:=</span>&nbsp;<span class="builtintype" id="5750877">false</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750885">if</span>&nbsp;<span class="ident" id="5750888">words</span>&nbsp;<span class="op" id="5750894">!=</span>&nbsp;<span class="ident" id="5750897">nil</span>&nbsp;<span class="op" id="5750901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5750906">url</span><span class="op" id="5750909">,</span>&nbsp;<span class="ident" id="5750911">italics</span>&nbsp;<span class="op" id="5750919">=</span>&nbsp;<span class="ident" id="5750921">words</span><span class="op" id="5750926">[</span><span class="ident" id="5750927">match</span><span class="op" id="5750932">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5750936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5750940">if</span>&nbsp;<span class="ident" id="5750943">m</span><span class="op" id="5750944">[</span><span class="num" id="5750945">2</span><span class="op" id="5750946">]</span>&nbsp;<span class="op" id="5750948">&gt;=</span>&nbsp;<span class="num" id="5750951">0</span>&nbsp;<span class="op" id="5750953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5750958">//&nbsp;match&nbsp;against&nbsp;first&nbsp;parenthesized&nbsp;sub-regexp;&nbsp;must&nbsp;be&nbsp;match&nbsp;against&nbsp;urlRx</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751038">if</span>&nbsp;<span class="op" id="5751041">!</span><span class="ident" id="5751042">italics</span>&nbsp;<span class="op" id="5751050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5751056">//&nbsp;no&nbsp;alternative&nbsp;URL&nbsp;in&nbsp;words&nbsp;list,&nbsp;use&nbsp;match&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751115">url</span>&nbsp;<span class="op" id="5751119">=</span>&nbsp;<span class="ident" id="5751121">match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751135">italics</span>&nbsp;<span class="op" id="5751143">=</span>&nbsp;<span class="builtintype" id="5751145">false</span>&nbsp;<span class="comment" id="5751151">//&nbsp;don&#39;t&nbsp;italicize&nbsp;URLs</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5751182">//&nbsp;write&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751199">if</span>&nbsp;<span class="builtinfunc" id="5751202">len</span><span class="op" id="5751205">(</span><span class="ident" id="5751206">url</span><span class="op" id="5751209">)</span>&nbsp;<span class="op" id="5751211">&gt;</span>&nbsp;<span class="num" id="5751213">0</span>&nbsp;<span class="op" id="5751215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751220">w</span><span class="op" id="5751221">.</span><span class="ident" id="5751222">Write</span><span class="op" id="5751227">(</span><span class="ident" id="5751228">html_a</span><span class="op" id="5751234">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751239">template</span><span class="op" id="5751247">.</span><span class="ident" id="5751248">HTMLEscape</span><span class="op" id="5751258">(</span><span class="ident" id="5751259">w</span><span class="op" id="5751260">,</span>&nbsp;<span class="op" id="5751262">[</span><span class="op" id="5751263">]</span><span class="builtintype" id="5751264">byte</span><span class="op" id="5751268">(</span><span class="ident" id="5751269">url</span><span class="op" id="5751272">)</span><span class="op" id="5751273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751278">w</span><span class="op" id="5751279">.</span><span class="ident" id="5751280">Write</span><span class="op" id="5751285">(</span><span class="ident" id="5751286">html_aq</span><span class="op" id="5751293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751301">if</span>&nbsp;<span class="ident" id="5751304">italics</span>&nbsp;<span class="op" id="5751312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751317">w</span><span class="op" id="5751318">.</span><span class="ident" id="5751319">Write</span><span class="op" id="5751324">(</span><span class="ident" id="5751325">html_i</span><span class="op" id="5751331">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751339">commentEscape</span><span class="op" id="5751352">(</span><span class="ident" id="5751353">w</span><span class="op" id="5751354">,</span>&nbsp;<span class="ident" id="5751356">match</span><span class="op" id="5751361">,</span>&nbsp;<span class="ident" id="5751363">nice</span><span class="op" id="5751367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751371">if</span>&nbsp;<span class="ident" id="5751374">italics</span>&nbsp;<span class="op" id="5751382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751387">w</span><span class="op" id="5751388">.</span><span class="ident" id="5751389">Write</span><span class="op" id="5751394">(</span><span class="ident" id="5751395">html_endi</span><span class="op" id="5751404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751408">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751412">if</span>&nbsp;<span class="builtinfunc" id="5751415">len</span><span class="op" id="5751418">(</span><span class="ident" id="5751419">url</span><span class="op" id="5751422">)</span>&nbsp;<span class="op" id="5751424">&gt;</span>&nbsp;<span class="num" id="5751426">0</span>&nbsp;<span class="op" id="5751428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751433">w</span><span class="op" id="5751434">.</span><span class="ident" id="5751435">Write</span><span class="op" id="5751440">(</span><span class="ident" id="5751441">html_enda</span><span class="op" id="5751450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5751459">//&nbsp;advance</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751472">line</span>&nbsp;<span class="op" id="5751477">=</span>&nbsp;<span class="ident" id="5751479">line</span><span class="op" id="5751483">[</span><span class="ident" id="5751484">m</span><span class="op" id="5751485">[</span><span class="num" id="5751486">1</span><span class="op" id="5751487">]</span><span class="op" id="5751488">:</span><span class="op" id="5751489">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751495">commentEscape</span><span class="op" id="5751508">(</span><span class="ident" id="5751509">w</span><span class="op" id="5751510">,</span>&nbsp;<span class="ident" id="5751512">line</span><span class="op" id="5751516">,</span>&nbsp;<span class="ident" id="5751518">nice</span><span class="op" id="5751522">)</span><br>
<span class="lineno"></span><span class="op" id="5751524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="5751527">func</span>&nbsp;<span class="ident" id="5751532">indentLen</span><span class="op" id="5751541">(</span><span class="ident" id="5751542">s</span>&nbsp;<span class="builtintype" id="5751544">string</span><span class="op" id="5751550">)</span>&nbsp;<span class="builtintype" id="5751552">int</span>&nbsp;<span class="op" id="5751556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751559">i</span>&nbsp;<span class="op" id="5751561">:=</span>&nbsp;<span class="num" id="5751564">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751567">for</span>&nbsp;<span class="ident" id="5751571">i</span>&nbsp;<span class="op" id="5751573">&lt;</span>&nbsp;<span class="builtinfunc" id="5751575">len</span><span class="op" id="5751578">(</span><span class="ident" id="5751579">s</span><span class="op" id="5751580">)</span>&nbsp;<span class="op" id="5751582">&amp;&amp;</span>&nbsp;<span class="op" id="5751585">(</span><span class="ident" id="5751586">s</span><span class="op" id="5751587">[</span><span class="ident" id="5751588">i</span><span class="op" id="5751589">]</span>&nbsp;<span class="op" id="5751591">==</span>&nbsp;<span class="string" id="5751594">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5751598">||</span>&nbsp;<span class="ident" id="5751601">s</span><span class="op" id="5751602">[</span><span class="ident" id="5751603">i</span><span class="op" id="5751604">]</span>&nbsp;<span class="op" id="5751606">==</span>&nbsp;<span class="string" id="5751609">&#39;\t&#39;</span><span class="op" id="5751613">)</span>&nbsp;<span class="op" id="5751615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751619">i</span><span class="op" id="5751620">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751624">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751627">return</span>&nbsp;<span class="ident" id="5751634">i</span><br>
<span class="lineno"></span><span class="op" id="5751636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5751639">func</span>&nbsp;<span class="ident" id="5751644">isBlank</span><span class="op" id="5751651">(</span><span class="ident" id="5751652">s</span>&nbsp;<span class="builtintype" id="5751654">string</span><span class="op" id="5751660">)</span>&nbsp;<span class="builtintype" id="5751662">bool</span>&nbsp;<span class="op" id="5751667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751670">return</span>&nbsp;<span class="builtinfunc" id="5751677">len</span><span class="op" id="5751680">(</span><span class="ident" id="5751681">s</span><span class="op" id="5751682">)</span>&nbsp;<span class="op" id="5751684">==</span>&nbsp;<span class="num" id="5751687">0</span>&nbsp;<span class="op" id="5751689">||</span>&nbsp;<span class="op" id="5751692">(</span><span class="builtinfunc" id="5751693">len</span><span class="op" id="5751696">(</span><span class="ident" id="5751697">s</span><span class="op" id="5751698">)</span>&nbsp;<span class="op" id="5751700">==</span>&nbsp;<span class="num" id="5751703">1</span>&nbsp;<span class="op" id="5751705">&amp;&amp;</span>&nbsp;<span class="ident" id="5751708">s</span><span class="op" id="5751709">[</span><span class="num" id="5751710">0</span><span class="op" id="5751711">]</span>&nbsp;<span class="op" id="5751713">==</span>&nbsp;<span class="string" id="5751716">&#39;\n&#39;</span><span class="op" id="5751720">)</span><br>
<span class="lineno">175</span><span class="op" id="5751722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5751725">func</span>&nbsp;<span class="ident" id="5751730">commonPrefix</span><span class="op" id="5751742">(</span><span class="ident" id="5751743">a</span><span class="op" id="5751744">,</span>&nbsp;<span class="ident" id="5751746">b</span>&nbsp;<span class="builtintype" id="5751748">string</span><span class="op" id="5751754">)</span>&nbsp;<span class="builtintype" id="5751756">string</span>&nbsp;<span class="op" id="5751763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751766">i</span>&nbsp;<span class="op" id="5751768">:=</span>&nbsp;<span class="num" id="5751771">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751774">for</span>&nbsp;<span class="ident" id="5751778">i</span>&nbsp;<span class="op" id="5751780">&lt;</span>&nbsp;<span class="builtinfunc" id="5751782">len</span><span class="op" id="5751785">(</span><span class="ident" id="5751786">a</span><span class="op" id="5751787">)</span>&nbsp;<span class="op" id="5751789">&amp;&amp;</span>&nbsp;<span class="ident" id="5751792">i</span>&nbsp;<span class="op" id="5751794">&lt;</span>&nbsp;<span class="builtinfunc" id="5751796">len</span><span class="op" id="5751799">(</span><span class="ident" id="5751800">b</span><span class="op" id="5751801">)</span>&nbsp;<span class="op" id="5751803">&amp;&amp;</span>&nbsp;<span class="ident" id="5751806">a</span><span class="op" id="5751807">[</span><span class="ident" id="5751808">i</span><span class="op" id="5751809">]</span>&nbsp;<span class="op" id="5751811">==</span>&nbsp;<span class="ident" id="5751814">b</span><span class="op" id="5751815">[</span><span class="ident" id="5751816">i</span><span class="op" id="5751817">]</span>&nbsp;<span class="op" id="5751819">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751823">i</span><span class="op" id="5751824">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751831">return</span>&nbsp;<span class="ident" id="5751838">a</span><span class="op" id="5751839">[</span><span class="num" id="5751840">0</span><span class="op" id="5751841">:</span><span class="ident" id="5751842">i</span><span class="op" id="5751843">]</span><br>
<span class="lineno"></span><span class="op" id="5751845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="5751848">func</span>&nbsp;<span class="ident" id="5751853">unindent</span><span class="op" id="5751861">(</span><span class="ident" id="5751862">block</span>&nbsp;<span class="op" id="5751868">[</span><span class="op" id="5751869">]</span><span class="builtintype" id="5751870">string</span><span class="op" id="5751876">)</span>&nbsp;<span class="op" id="5751878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751881">if</span>&nbsp;<span class="builtinfunc" id="5751884">len</span><span class="op" id="5751887">(</span><span class="ident" id="5751888">block</span><span class="op" id="5751893">)</span>&nbsp;<span class="op" id="5751895">==</span>&nbsp;<span class="num" id="5751898">0</span>&nbsp;<span class="op" id="5751900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751904">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5751912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5751916">//&nbsp;compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5751956">prefix</span>&nbsp;<span class="op" id="5751963">:=</span>&nbsp;<span class="ident" id="5751966">block</span><span class="op" id="5751971">[</span><span class="num" id="5751972">0</span><span class="op" id="5751973">]</span><span class="op" id="5751974">[</span><span class="num" id="5751975">0</span><span class="op" id="5751976">:</span><span class="ident" id="5751977">indentLen</span><span class="op" id="5751986">(</span><span class="ident" id="5751987">block</span><span class="op" id="5751992">[</span><span class="num" id="5751993">0</span><span class="op" id="5751994">]</span><span class="op" id="5751995">)</span><span class="op" id="5751996">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5751999">for</span>&nbsp;<span class="ident" id="5752003">_</span><span class="op" id="5752004">,</span>&nbsp;<span class="ident" id="5752006">line</span>&nbsp;<span class="op" id="5752011">:=</span>&nbsp;<span class="keyword" id="5752014">range</span>&nbsp;<span class="ident" id="5752020">block</span>&nbsp;<span class="op" id="5752026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752030">if</span>&nbsp;<span class="op" id="5752033">!</span><span class="ident" id="5752034">isBlank</span><span class="op" id="5752041">(</span><span class="ident" id="5752042">line</span><span class="op" id="5752046">)</span>&nbsp;<span class="op" id="5752048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752053">prefix</span>&nbsp;<span class="op" id="5752060">=</span>&nbsp;<span class="ident" id="5752062">commonPrefix</span><span class="op" id="5752074">(</span><span class="ident" id="5752075">prefix</span><span class="op" id="5752081">,</span>&nbsp;<span class="ident" id="5752083">line</span><span class="op" id="5752087">[</span><span class="num" id="5752088">0</span><span class="op" id="5752089">:</span><span class="ident" id="5752090">indentLen</span><span class="op" id="5752099">(</span><span class="ident" id="5752100">line</span><span class="op" id="5752104">)</span><span class="op" id="5752105">]</span><span class="op" id="5752106">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752116">n</span>&nbsp;<span class="op" id="5752118">:=</span>&nbsp;<span class="builtinfunc" id="5752121">len</span><span class="op" id="5752124">(</span><span class="ident" id="5752125">prefix</span><span class="op" id="5752131">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752135">//&nbsp;remove</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752146">for</span>&nbsp;<span class="ident" id="5752150">i</span><span class="op" id="5752151">,</span>&nbsp;<span class="ident" id="5752153">line</span>&nbsp;<span class="op" id="5752158">:=</span>&nbsp;<span class="keyword" id="5752161">range</span>&nbsp;<span class="ident" id="5752167">block</span>&nbsp;<span class="op" id="5752173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752177">if</span>&nbsp;<span class="op" id="5752180">!</span><span class="ident" id="5752181">isBlank</span><span class="op" id="5752188">(</span><span class="ident" id="5752189">line</span><span class="op" id="5752193">)</span>&nbsp;<span class="op" id="5752195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752200">block</span><span class="op" id="5752205">[</span><span class="ident" id="5752206">i</span><span class="op" id="5752207">]</span>&nbsp;<span class="op" id="5752209">=</span>&nbsp;<span class="ident" id="5752211">line</span><span class="op" id="5752215">[</span><span class="ident" id="5752216">n</span><span class="op" id="5752217">:</span><span class="op" id="5752218">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752225">}</span><br>
<span class="lineno">205</span><span class="op" id="5752227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5752230">//&nbsp;heading&nbsp;returns&nbsp;the&nbsp;trimmed&nbsp;line&nbsp;if&nbsp;it&nbsp;passes&nbsp;as&nbsp;a&nbsp;section&nbsp;heading;</span><br>
<span class="lineno"></span><span class="comment" id="5752301">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5752343">func</span>&nbsp;<span class="ident" id="5752348">heading</span><span class="op" id="5752355">(</span><span class="ident" id="5752356">line</span>&nbsp;<span class="builtintype" id="5752361">string</span><span class="op" id="5752367">)</span>&nbsp;<span class="builtintype" id="5752369">string</span>&nbsp;<span class="op" id="5752376">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752379">line</span>&nbsp;<span class="op" id="5752384">=</span>&nbsp;<span class="ident" id="5752386">strings</span><span class="op" id="5752393">.</span><span class="ident" id="5752394">TrimSpace</span><span class="op" id="5752403">(</span><span class="ident" id="5752404">line</span><span class="op" id="5752408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752411">if</span>&nbsp;<span class="builtinfunc" id="5752414">len</span><span class="op" id="5752417">(</span><span class="ident" id="5752418">line</span><span class="op" id="5752422">)</span>&nbsp;<span class="op" id="5752424">==</span>&nbsp;<span class="num" id="5752427">0</span>&nbsp;<span class="op" id="5752429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752433">return</span>&nbsp;<span class="string" id="5752440">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752448">//&nbsp;a&nbsp;heading&nbsp;must&nbsp;start&nbsp;with&nbsp;an&nbsp;uppercase&nbsp;letter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752498">r</span><span class="op" id="5752499">,</span>&nbsp;<span class="ident" id="5752501">_</span>&nbsp;<span class="op" id="5752503">:=</span>&nbsp;<span class="ident" id="5752506">utf8</span><span class="op" id="5752510">.</span><span class="ident" id="5752511">DecodeRuneInString</span><span class="op" id="5752529">(</span><span class="ident" id="5752530">line</span><span class="op" id="5752534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752537">if</span>&nbsp;<span class="op" id="5752540">!</span><span class="ident" id="5752541">unicode</span><span class="op" id="5752548">.</span><span class="ident" id="5752549">IsLetter</span><span class="op" id="5752557">(</span><span class="ident" id="5752558">r</span><span class="op" id="5752559">)</span>&nbsp;<span class="op" id="5752561">||</span>&nbsp;<span class="op" id="5752564">!</span><span class="ident" id="5752565">unicode</span><span class="op" id="5752572">.</span><span class="ident" id="5752573">IsUpper</span><span class="op" id="5752580">(</span><span class="ident" id="5752581">r</span><span class="op" id="5752582">)</span>&nbsp;<span class="op" id="5752584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752588">return</span>&nbsp;<span class="string" id="5752595">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752599">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752603">//&nbsp;it&nbsp;must&nbsp;end&nbsp;in&nbsp;a&nbsp;letter&nbsp;or&nbsp;digit:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752641">r</span><span class="op" id="5752642">,</span>&nbsp;<span class="ident" id="5752644">_</span>&nbsp;<span class="op" id="5752646">=</span>&nbsp;<span class="ident" id="5752648">utf8</span><span class="op" id="5752652">.</span><span class="ident" id="5752653">DecodeLastRuneInString</span><span class="op" id="5752675">(</span><span class="ident" id="5752676">line</span><span class="op" id="5752680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752683">if</span>&nbsp;<span class="op" id="5752686">!</span><span class="ident" id="5752687">unicode</span><span class="op" id="5752694">.</span><span class="ident" id="5752695">IsLetter</span><span class="op" id="5752703">(</span><span class="ident" id="5752704">r</span><span class="op" id="5752705">)</span>&nbsp;<span class="op" id="5752707">&amp;&amp;</span>&nbsp;<span class="op" id="5752710">!</span><span class="ident" id="5752711">unicode</span><span class="op" id="5752718">.</span><span class="ident" id="5752719">IsDigit</span><span class="op" id="5752726">(</span><span class="ident" id="5752727">r</span><span class="op" id="5752728">)</span>&nbsp;<span class="op" id="5752730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752734">return</span>&nbsp;<span class="string" id="5752741">&#34;&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752749">//&nbsp;exclude&nbsp;lines&nbsp;with&nbsp;illegal&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752791">if</span>&nbsp;<span class="ident" id="5752794">strings</span><span class="op" id="5752801">.</span><span class="ident" id="5752802">IndexAny</span><span class="op" id="5752810">(</span><span class="ident" id="5752811">line</span><span class="op" id="5752815">,</span>&nbsp;<span class="string" id="5752817">&#34;,.;:!?+*/=()[]{}_^&amp;~%#@&lt;\&#34;&gt;\\&#34;</span><span class="op" id="5752852">)</span>&nbsp;<span class="op" id="5752854">&gt;=</span>&nbsp;<span class="num" id="5752857">0</span>&nbsp;<span class="op" id="5752859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752863">return</span>&nbsp;<span class="string" id="5752870">&#34;&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5752878">//&nbsp;allow&nbsp;&#34;&#39;&#34;&nbsp;for&nbsp;possessive&nbsp;&#34;&#39;s&#34;&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752917">for</span>&nbsp;<span class="ident" id="5752921">b</span>&nbsp;<span class="op" id="5752923">:=</span>&nbsp;<span class="ident" id="5752926">line</span><span class="op" id="5752930">;</span>&nbsp;<span class="op" id="5752932">;</span>&nbsp;<span class="op" id="5752934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5752938">i</span>&nbsp;<span class="op" id="5752940">:=</span>&nbsp;<span class="ident" id="5752943">strings</span><span class="op" id="5752950">.</span><span class="ident" id="5752951">IndexRune</span><span class="op" id="5752960">(</span><span class="ident" id="5752961">b</span><span class="op" id="5752962">,</span>&nbsp;<span class="string" id="5752964">&#39;\&#39;&#39;</span><span class="op" id="5752968">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752972">if</span>&nbsp;<span class="ident" id="5752975">i</span>&nbsp;<span class="op" id="5752977">&lt;</span>&nbsp;<span class="num" id="5752979">0</span>&nbsp;<span class="op" id="5752981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752986">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5752994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5752998">if</span>&nbsp;<span class="ident" id="5753001">i</span><span class="op" id="5753002">+</span><span class="num" id="5753003">1</span>&nbsp;<span class="op" id="5753005">&gt;=</span>&nbsp;<span class="builtinfunc" id="5753008">len</span><span class="op" id="5753011">(</span><span class="ident" id="5753012">b</span><span class="op" id="5753013">)</span>&nbsp;<span class="op" id="5753015">||</span>&nbsp;<span class="ident" id="5753018">b</span><span class="op" id="5753019">[</span><span class="ident" id="5753020">i</span><span class="op" id="5753021">+</span><span class="num" id="5753022">1</span><span class="op" id="5753023">]</span>&nbsp;<span class="op" id="5753025">!=</span>&nbsp;<span class="string" id="5753028">&#39;s&#39;</span>&nbsp;<span class="op" id="5753032">||</span>&nbsp;<span class="op" id="5753035">(</span><span class="ident" id="5753036">i</span><span class="op" id="5753037">+</span><span class="num" id="5753038">2</span>&nbsp;<span class="op" id="5753040">&lt;</span>&nbsp;<span class="builtinfunc" id="5753042">len</span><span class="op" id="5753045">(</span><span class="ident" id="5753046">b</span><span class="op" id="5753047">)</span>&nbsp;<span class="op" id="5753049">&amp;&amp;</span>&nbsp;<span class="ident" id="5753052">b</span><span class="op" id="5753053">[</span><span class="ident" id="5753054">i</span><span class="op" id="5753055">+</span><span class="num" id="5753056">2</span><span class="op" id="5753057">]</span>&nbsp;<span class="op" id="5753059">!=</span>&nbsp;<span class="string" id="5753062">&#39;&nbsp;&#39;</span><span class="op" id="5753065">)</span>&nbsp;<span class="op" id="5753067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753072">return</span>&nbsp;<span class="string" id="5753079">&#34;&#34;</span>&nbsp;<span class="comment" id="5753082">//&nbsp;not&nbsp;followed&nbsp;by&nbsp;&#34;s&nbsp;&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5753108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753112">b</span>&nbsp;<span class="op" id="5753114">=</span>&nbsp;<span class="ident" id="5753116">b</span><span class="op" id="5753117">[</span><span class="ident" id="5753118">i</span><span class="op" id="5753119">+</span><span class="num" id="5753120">2</span><span class="op" id="5753121">:</span><span class="op" id="5753122">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5753125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753129">return</span>&nbsp;<span class="ident" id="5753136">line</span><br>
<span class="lineno">245</span><span class="op" id="5753141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5753144">type</span>&nbsp;<span class="ident" id="5753149">op</span>&nbsp;<span class="builtintype" id="5753152">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5753157">const</span>&nbsp;<span class="op" id="5753163">(</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753166">opPara</span>&nbsp;<span class="ident" id="5753173">op</span>&nbsp;<span class="op" id="5753176">=</span>&nbsp;<span class="ident" id="5753178">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753184">opHead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753192">opPre</span><br>
<span class="lineno"></span><span class="op" id="5753198">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="5753201">type</span>&nbsp;<span class="ident" id="5753206">block</span>&nbsp;<span class="keyword" id="5753212">struct</span>&nbsp;<span class="op" id="5753219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753222">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5753228">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5753232">lines</span>&nbsp;<span class="op" id="5753238">[</span><span class="op" id="5753239">]</span><span class="builtintype" id="5753240">string</span><br>
<span class="lineno"></span><span class="op" id="5753247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="5753250">var</span>&nbsp;<span class="ident" id="5753254">nonAlphaNumRx</span>&nbsp;<span class="op" id="5753268">=</span>&nbsp;<span class="ident" id="5753270">regexp</span><span class="op" id="5753276">.</span><span class="ident" id="5753277">MustCompile</span><span class="op" id="5753288">(</span><span class="string" id="5753289">`[^a-zA-Z0-9]`</span><span class="op" id="5753303">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5753306">func</span>&nbsp;<span class="ident" id="5753311">anchorID</span><span class="op" id="5753319">(</span><span class="ident" id="5753320">line</span>&nbsp;<span class="builtintype" id="5753325">string</span><span class="op" id="5753331">)</span>&nbsp;<span class="builtintype" id="5753333">string</span>&nbsp;<span class="op" id="5753340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5753343">//&nbsp;Add&nbsp;a&nbsp;&#34;hdr-&#34;&nbsp;prefix&nbsp;to&nbsp;avoid&nbsp;conflicting&nbsp;with&nbsp;IDs&nbsp;used&nbsp;for&nbsp;package&nbsp;symbols.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5753423">return</span>&nbsp;<span class="string" id="5753430">&#34;hdr-&#34;</span>&nbsp;<span class="op" id="5753437">+</span>&nbsp;<span class="ident" id="5753439">nonAlphaNumRx</span><span class="op" id="5753452">.</span><span class="ident" id="5753453">ReplaceAllString</span><span class="op" id="5753469">(</span><span class="ident" id="5753470">line</span><span class="op" id="5753474">,</span>&nbsp;<span class="string" id="5753476">&#34;_&#34;</span><span class="op" id="5753479">)</span><br>
<span class="lineno">265</span><span class="op" id="5753481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5753484">//&nbsp;ToHTML&nbsp;converts&nbsp;comment&nbsp;text&nbsp;to&nbsp;formatted&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="5753535">//&nbsp;The&nbsp;comment&nbsp;was&nbsp;prepared&nbsp;by&nbsp;DocReader,</span><br>
<span class="lineno"></span><span class="comment" id="5753577">//&nbsp;so&nbsp;it&nbsp;is&nbsp;known&nbsp;not&nbsp;to&nbsp;have&nbsp;leading,&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">270</span><span class="comment" id="5753637">//&nbsp;nor&nbsp;to&nbsp;have&nbsp;trailing&nbsp;spaces&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;lines.</span><br>
<span class="lineno"></span><span class="comment" id="5753689">//&nbsp;The&nbsp;comment&nbsp;markers&nbsp;have&nbsp;already&nbsp;been&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="5753739">//</span><br>
<span class="lineno"></span><span class="comment" id="5753742">//&nbsp;Each&nbsp;span&nbsp;of&nbsp;unindented&nbsp;non-blank&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="5753803">//&nbsp;a&nbsp;single&nbsp;paragraph.&nbsp;There&nbsp;is&nbsp;one&nbsp;exception&nbsp;to&nbsp;the&nbsp;rule:&nbsp;a&nbsp;span&nbsp;that</span><br>
<span class="lineno">275</span><span class="comment" id="5753874">//&nbsp;consists&nbsp;of&nbsp;a&nbsp;single&nbsp;line,&nbsp;is&nbsp;followed&nbsp;by&nbsp;another&nbsp;paragraph&nbsp;span,</span><br>
<span class="lineno"></span><span class="comment" id="5753943">//&nbsp;begins&nbsp;with&nbsp;a&nbsp;capital&nbsp;letter,&nbsp;and&nbsp;contains&nbsp;no&nbsp;punctuation</span><br>
<span class="lineno"></span><span class="comment" id="5754004">//&nbsp;is&nbsp;formatted&nbsp;as&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span><span class="comment" id="5754034">//</span><br>
<span class="lineno"></span><span class="comment" id="5754037">//&nbsp;A&nbsp;span&nbsp;of&nbsp;indented&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;&lt;pre&gt;&nbsp;block,</span><br>
<span class="lineno">280</span><span class="comment" id="5754098">//&nbsp;with&nbsp;the&nbsp;common&nbsp;indent&nbsp;prefix&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="5754140">//</span><br>
<span class="lineno"></span><span class="comment" id="5754143">//&nbsp;URLs&nbsp;in&nbsp;the&nbsp;comment&nbsp;text&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears</span><br>
<span class="lineno"></span><span class="comment" id="5754221">//&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="5754299">//&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted&nbsp;into&nbsp;a&nbsp;link).</span><br>
<span class="lineno">285</span><span class="comment" id="5754368">//</span><br>
<span class="lineno"></span><span class="comment" id="5754371">//&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="5754455">//&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="5754542">//&nbsp;into&nbsp;a&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="5754558">func</span>&nbsp;<span class="ident" id="5754563">ToHTML</span><span class="op" id="5754569">(</span><span class="ident" id="5754570">w</span>&nbsp;<span class="ident" id="5754572">io</span><span class="op" id="5754574">.</span><span class="ident" id="5754575">Writer</span><span class="op" id="5754581">,</span>&nbsp;<span class="ident" id="5754583">text</span>&nbsp;<span class="builtintype" id="5754588">string</span><span class="op" id="5754594">,</span>&nbsp;<span class="ident" id="5754596">words</span>&nbsp;<span class="keyword" id="5754602">map</span><span class="op" id="5754605">[</span><span class="builtintype" id="5754606">string</span><span class="op" id="5754612">]</span><span class="builtintype" id="5754613">string</span><span class="op" id="5754619">)</span>&nbsp;<span class="op" id="5754621">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754624">for</span>&nbsp;<span class="ident" id="5754628">_</span><span class="op" id="5754629">,</span>&nbsp;<span class="ident" id="5754631">b</span>&nbsp;<span class="op" id="5754633">:=</span>&nbsp;<span class="keyword" id="5754636">range</span>&nbsp;<span class="ident" id="5754642">blocks</span><span class="op" id="5754648">(</span><span class="ident" id="5754649">text</span><span class="op" id="5754653">)</span>&nbsp;<span class="op" id="5754655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754659">switch</span>&nbsp;<span class="ident" id="5754666">b</span><span class="op" id="5754667">.</span><span class="ident" id="5754668">op</span>&nbsp;<span class="op" id="5754671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754675">case</span>&nbsp;<span class="ident" id="5754680">opPara</span><span class="op" id="5754686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754691">w</span><span class="op" id="5754692">.</span><span class="ident" id="5754693">Write</span><span class="op" id="5754698">(</span><span class="ident" id="5754699">html_p</span><span class="op" id="5754705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754710">for</span>&nbsp;<span class="ident" id="5754714">_</span><span class="op" id="5754715">,</span>&nbsp;<span class="ident" id="5754717">line</span>&nbsp;<span class="op" id="5754722">:=</span>&nbsp;<span class="keyword" id="5754725">range</span>&nbsp;<span class="ident" id="5754731">b</span><span class="op" id="5754732">.</span><span class="ident" id="5754733">lines</span>&nbsp;<span class="op" id="5754739">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754745">emphasize</span><span class="op" id="5754754">(</span><span class="ident" id="5754755">w</span><span class="op" id="5754756">,</span>&nbsp;<span class="ident" id="5754758">line</span><span class="op" id="5754762">,</span>&nbsp;<span class="ident" id="5754764">words</span><span class="op" id="5754769">,</span>&nbsp;<span class="builtintype" id="5754771">true</span><span class="op" id="5754775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5754780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754785">w</span><span class="op" id="5754786">.</span><span class="ident" id="5754787">Write</span><span class="op" id="5754792">(</span><span class="ident" id="5754793">html_endp</span><span class="op" id="5754802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754806">case</span>&nbsp;<span class="ident" id="5754811">opHead</span><span class="op" id="5754817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754822">w</span><span class="op" id="5754823">.</span><span class="ident" id="5754824">Write</span><span class="op" id="5754829">(</span><span class="ident" id="5754830">html_h</span><span class="op" id="5754836">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754841">id</span>&nbsp;<span class="op" id="5754844">:=</span>&nbsp;<span class="string" id="5754847">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754853">for</span>&nbsp;<span class="ident" id="5754857">_</span><span class="op" id="5754858">,</span>&nbsp;<span class="ident" id="5754860">line</span>&nbsp;<span class="op" id="5754865">:=</span>&nbsp;<span class="keyword" id="5754868">range</span>&nbsp;<span class="ident" id="5754874">b</span><span class="op" id="5754875">.</span><span class="ident" id="5754876">lines</span>&nbsp;<span class="op" id="5754882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5754888">if</span>&nbsp;<span class="ident" id="5754891">id</span>&nbsp;<span class="op" id="5754894">==</span>&nbsp;<span class="string" id="5754897">&#34;&#34;</span>&nbsp;<span class="op" id="5754900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754907">id</span>&nbsp;<span class="op" id="5754910">=</span>&nbsp;<span class="ident" id="5754912">anchorID</span><span class="op" id="5754920">(</span><span class="ident" id="5754921">line</span><span class="op" id="5754925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754932">w</span><span class="op" id="5754933">.</span><span class="ident" id="5754934">Write</span><span class="op" id="5754939">(</span><span class="op" id="5754940">[</span><span class="op" id="5754941">]</span><span class="builtintype" id="5754942">byte</span><span class="op" id="5754946">(</span><span class="ident" id="5754947">id</span><span class="op" id="5754949">)</span><span class="op" id="5754950">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754957">w</span><span class="op" id="5754958">.</span><span class="ident" id="5754959">Write</span><span class="op" id="5754964">(</span><span class="ident" id="5754965">html_hq</span><span class="op" id="5754972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5754978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5754984">commentEscape</span><span class="op" id="5754997">(</span><span class="ident" id="5754998">w</span><span class="op" id="5754999">,</span>&nbsp;<span class="ident" id="5755001">line</span><span class="op" id="5755005">,</span>&nbsp;<span class="builtintype" id="5755007">true</span><span class="op" id="5755011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755021">if</span>&nbsp;<span class="ident" id="5755024">id</span>&nbsp;<span class="op" id="5755027">==</span>&nbsp;<span class="string" id="5755030">&#34;&#34;</span>&nbsp;<span class="op" id="5755033">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755039">w</span><span class="op" id="5755040">.</span><span class="ident" id="5755041">Write</span><span class="op" id="5755046">(</span><span class="ident" id="5755047">html_hq</span><span class="op" id="5755054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755064">w</span><span class="op" id="5755065">.</span><span class="ident" id="5755066">Write</span><span class="op" id="5755071">(</span><span class="ident" id="5755072">html_endh</span><span class="op" id="5755081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755085">case</span>&nbsp;<span class="ident" id="5755090">opPre</span><span class="op" id="5755095">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755100">w</span><span class="op" id="5755101">.</span><span class="ident" id="5755102">Write</span><span class="op" id="5755107">(</span><span class="ident" id="5755108">html_pre</span><span class="op" id="5755116">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755121">for</span>&nbsp;<span class="ident" id="5755125">_</span><span class="op" id="5755126">,</span>&nbsp;<span class="ident" id="5755128">line</span>&nbsp;<span class="op" id="5755133">:=</span>&nbsp;<span class="keyword" id="5755136">range</span>&nbsp;<span class="ident" id="5755142">b</span><span class="op" id="5755143">.</span><span class="ident" id="5755144">lines</span>&nbsp;<span class="op" id="5755150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755156">emphasize</span><span class="op" id="5755165">(</span><span class="ident" id="5755166">w</span><span class="op" id="5755167">,</span>&nbsp;<span class="ident" id="5755169">line</span><span class="op" id="5755173">,</span>&nbsp;<span class="ident" id="5755175">nil</span><span class="op" id="5755178">,</span>&nbsp;<span class="builtintype" id="5755180">false</span><span class="op" id="5755185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755195">w</span><span class="op" id="5755196">.</span><span class="ident" id="5755197">Write</span><span class="op" id="5755202">(</span><span class="ident" id="5755203">html_endpre</span><span class="op" id="5755214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755218">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755221">}</span><br>
<span class="lineno"></span><span class="op" id="5755223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5755226">func</span>&nbsp;<span class="ident" id="5755231">blocks</span><span class="op" id="5755237">(</span><span class="ident" id="5755238">text</span>&nbsp;<span class="builtintype" id="5755243">string</span><span class="op" id="5755249">)</span>&nbsp;<span class="op" id="5755251">[</span><span class="op" id="5755252">]</span><span class="ident" id="5755253">block</span>&nbsp;<span class="op" id="5755259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755262">var</span>&nbsp;<span class="op" id="5755266">(</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755270">out</span>&nbsp;&nbsp;<span class="op" id="5755275">[</span><span class="op" id="5755276">]</span><span class="ident" id="5755277">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755285">para</span>&nbsp;<span class="op" id="5755290">[</span><span class="op" id="5755291">]</span><span class="builtintype" id="5755292">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755302">lastWasBlank</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5755317">=</span>&nbsp;<span class="builtintype" id="5755319">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755327">lastWasHeading</span>&nbsp;<span class="op" id="5755342">=</span>&nbsp;<span class="builtintype" id="5755344">false</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755351">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5755355">close</span>&nbsp;<span class="op" id="5755361">:=</span>&nbsp;<span class="keyword" id="5755364">func</span><span class="op" id="5755368">(</span><span class="op" id="5755369">)</span>&nbsp;<span class="op" id="5755371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755375">if</span>&nbsp;<span class="ident" id="5755378">para</span>&nbsp;<span class="op" id="5755383">!=</span>&nbsp;<span class="ident" id="5755386">nil</span>&nbsp;<span class="op" id="5755390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755395">out</span>&nbsp;<span class="op" id="5755399">=</span>&nbsp;<span class="builtinfunc" id="5755401">append</span><span class="op" id="5755407">(</span><span class="ident" id="5755408">out</span><span class="op" id="5755411">,</span>&nbsp;<span class="ident" id="5755413">block</span><span class="op" id="5755418">{</span><span class="ident" id="5755419">opPara</span><span class="op" id="5755425">,</span>&nbsp;<span class="ident" id="5755427">para</span><span class="op" id="5755431">}</span><span class="op" id="5755432">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755437">para</span>&nbsp;<span class="op" id="5755442">=</span>&nbsp;<span class="ident" id="5755444">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755457">lines</span>&nbsp;<span class="op" id="5755463">:=</span>&nbsp;<span class="ident" id="5755466">strings</span><span class="op" id="5755473">.</span><span class="ident" id="5755474">SplitAfter</span><span class="op" id="5755484">(</span><span class="ident" id="5755485">text</span><span class="op" id="5755489">,</span>&nbsp;<span class="string" id="5755491">&#34;\n&#34;</span><span class="op" id="5755495">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755498">unindent</span><span class="op" id="5755506">(</span><span class="ident" id="5755507">lines</span><span class="op" id="5755512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755515">for</span>&nbsp;<span class="ident" id="5755519">i</span>&nbsp;<span class="op" id="5755521">:=</span>&nbsp;<span class="num" id="5755524">0</span><span class="op" id="5755525">;</span>&nbsp;<span class="ident" id="5755527">i</span>&nbsp;<span class="op" id="5755529">&lt;</span>&nbsp;<span class="builtinfunc" id="5755531">len</span><span class="op" id="5755534">(</span><span class="ident" id="5755535">lines</span><span class="op" id="5755540">)</span><span class="op" id="5755541">;</span>&nbsp;<span class="op" id="5755543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755547">line</span>&nbsp;<span class="op" id="5755552">:=</span>&nbsp;<span class="ident" id="5755555">lines</span><span class="op" id="5755560">[</span><span class="ident" id="5755561">i</span><span class="op" id="5755562">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755566">if</span>&nbsp;<span class="ident" id="5755569">isBlank</span><span class="op" id="5755576">(</span><span class="ident" id="5755577">line</span><span class="op" id="5755581">)</span>&nbsp;<span class="op" id="5755583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755588">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5755610">close</span><span class="op" id="5755615">(</span><span class="op" id="5755616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755621">i</span><span class="op" id="5755622">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755628">lastWasBlank</span>&nbsp;<span class="op" id="5755641">=</span>&nbsp;<span class="builtintype" id="5755643">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755651">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755662">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755666">if</span>&nbsp;<span class="ident" id="5755669">indentLen</span><span class="op" id="5755678">(</span><span class="ident" id="5755679">line</span><span class="op" id="5755683">)</span>&nbsp;<span class="op" id="5755685">&gt;</span>&nbsp;<span class="num" id="5755687">0</span>&nbsp;<span class="op" id="5755689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755694">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5755716">close</span><span class="op" id="5755721">(</span><span class="op" id="5755722">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755728">//&nbsp;count&nbsp;indented&nbsp;or&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755764">j</span>&nbsp;<span class="op" id="5755766">:=</span>&nbsp;<span class="ident" id="5755769">i</span>&nbsp;<span class="op" id="5755771">+</span>&nbsp;<span class="num" id="5755773">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755778">for</span>&nbsp;<span class="ident" id="5755782">j</span>&nbsp;<span class="op" id="5755784">&lt;</span>&nbsp;<span class="builtinfunc" id="5755786">len</span><span class="op" id="5755789">(</span><span class="ident" id="5755790">lines</span><span class="op" id="5755795">)</span>&nbsp;<span class="op" id="5755797">&amp;&amp;</span>&nbsp;<span class="op" id="5755800">(</span><span class="ident" id="5755801">isBlank</span><span class="op" id="5755808">(</span><span class="ident" id="5755809">lines</span><span class="op" id="5755814">[</span><span class="ident" id="5755815">j</span><span class="op" id="5755816">]</span><span class="op" id="5755817">)</span>&nbsp;<span class="op" id="5755819">||</span>&nbsp;<span class="ident" id="5755822">indentLen</span><span class="op" id="5755831">(</span><span class="ident" id="5755832">lines</span><span class="op" id="5755837">[</span><span class="ident" id="5755838">j</span><span class="op" id="5755839">]</span><span class="op" id="5755840">)</span>&nbsp;<span class="op" id="5755842">&gt;</span>&nbsp;<span class="num" id="5755844">0</span><span class="op" id="5755845">)</span>&nbsp;<span class="op" id="5755847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755853">j</span><span class="op" id="5755854">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5755865">//&nbsp;but&nbsp;not&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5755900">for</span>&nbsp;<span class="ident" id="5755904">j</span>&nbsp;<span class="op" id="5755906">&gt;</span>&nbsp;<span class="ident" id="5755908">i</span>&nbsp;<span class="op" id="5755910">&amp;&amp;</span>&nbsp;<span class="ident" id="5755913">isBlank</span><span class="op" id="5755920">(</span><span class="ident" id="5755921">lines</span><span class="op" id="5755926">[</span><span class="ident" id="5755927">j</span><span class="op" id="5755928">-</span><span class="num" id="5755929">1</span><span class="op" id="5755930">]</span><span class="op" id="5755931">)</span>&nbsp;<span class="op" id="5755933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755939">j</span><span class="op" id="5755940">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5755946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755951">pre</span>&nbsp;<span class="op" id="5755955">:=</span>&nbsp;<span class="ident" id="5755958">lines</span><span class="op" id="5755963">[</span><span class="ident" id="5755964">i</span><span class="op" id="5755965">:</span><span class="ident" id="5755966">j</span><span class="op" id="5755967">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755972">i</span>&nbsp;<span class="op" id="5755974">=</span>&nbsp;<span class="ident" id="5755976">j</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5755982">unindent</span><span class="op" id="5755990">(</span><span class="ident" id="5755991">pre</span><span class="op" id="5755994">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756000">//&nbsp;put&nbsp;those&nbsp;lines&nbsp;in&nbsp;a&nbsp;pre&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756037">out</span>&nbsp;<span class="op" id="5756041">=</span>&nbsp;<span class="builtinfunc" id="5756043">append</span><span class="op" id="5756049">(</span><span class="ident" id="5756050">out</span><span class="op" id="5756053">,</span>&nbsp;<span class="ident" id="5756055">block</span><span class="op" id="5756060">{</span><span class="ident" id="5756061">opPre</span><span class="op" id="5756066">,</span>&nbsp;<span class="ident" id="5756068">pre</span><span class="op" id="5756071">}</span><span class="op" id="5756072">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756077">lastWasHeading</span>&nbsp;<span class="op" id="5756092">=</span>&nbsp;<span class="builtintype" id="5756094">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756103">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756119">if</span>&nbsp;<span class="ident" id="5756122">lastWasBlank</span>&nbsp;<span class="op" id="5756135">&amp;&amp;</span>&nbsp;<span class="op" id="5756138">!</span><span class="ident" id="5756139">lastWasHeading</span>&nbsp;<span class="op" id="5756154">&amp;&amp;</span>&nbsp;<span class="ident" id="5756157">i</span><span class="op" id="5756158">+</span><span class="num" id="5756159">2</span>&nbsp;<span class="op" id="5756161">&lt;</span>&nbsp;<span class="builtinfunc" id="5756163">len</span><span class="op" id="5756166">(</span><span class="ident" id="5756167">lines</span><span class="op" id="5756172">)</span>&nbsp;<span class="op" id="5756174">&amp;&amp;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756180">isBlank</span><span class="op" id="5756187">(</span><span class="ident" id="5756188">lines</span><span class="op" id="5756193">[</span><span class="ident" id="5756194">i</span><span class="op" id="5756195">+</span><span class="num" id="5756196">1</span><span class="op" id="5756197">]</span><span class="op" id="5756198">)</span>&nbsp;<span class="op" id="5756200">&amp;&amp;</span>&nbsp;<span class="op" id="5756203">!</span><span class="ident" id="5756204">isBlank</span><span class="op" id="5756211">(</span><span class="ident" id="5756212">lines</span><span class="op" id="5756217">[</span><span class="ident" id="5756218">i</span><span class="op" id="5756219">+</span><span class="num" id="5756220">2</span><span class="op" id="5756221">]</span><span class="op" id="5756222">)</span>&nbsp;<span class="op" id="5756224">&amp;&amp;</span>&nbsp;<span class="ident" id="5756227">indentLen</span><span class="op" id="5756236">(</span><span class="ident" id="5756237">lines</span><span class="op" id="5756242">[</span><span class="ident" id="5756243">i</span><span class="op" id="5756244">+</span><span class="num" id="5756245">2</span><span class="op" id="5756246">]</span><span class="op" id="5756247">)</span>&nbsp;<span class="op" id="5756249">==</span>&nbsp;<span class="num" id="5756252">0</span>&nbsp;<span class="op" id="5756254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756259">//&nbsp;current&nbsp;line&nbsp;is&nbsp;non-blank,&nbsp;surrounded&nbsp;by&nbsp;blank&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756318">//&nbsp;and&nbsp;the&nbsp;next&nbsp;non-blank&nbsp;line&nbsp;is&nbsp;not&nbsp;indented:&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756374">//&nbsp;might&nbsp;be&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756400">if</span>&nbsp;<span class="ident" id="5756403">head</span>&nbsp;<span class="op" id="5756408">:=</span>&nbsp;<span class="ident" id="5756411">heading</span><span class="op" id="5756418">(</span><span class="ident" id="5756419">line</span><span class="op" id="5756423">)</span><span class="op" id="5756424">;</span>&nbsp;<span class="ident" id="5756426">head</span>&nbsp;<span class="op" id="5756431">!=</span>&nbsp;<span class="string" id="5756434">&#34;&#34;</span>&nbsp;<span class="op" id="5756437">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5756443">close</span><span class="op" id="5756448">(</span><span class="op" id="5756449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756455">out</span>&nbsp;<span class="op" id="5756459">=</span>&nbsp;<span class="builtinfunc" id="5756461">append</span><span class="op" id="5756467">(</span><span class="ident" id="5756468">out</span><span class="op" id="5756471">,</span>&nbsp;<span class="ident" id="5756473">block</span><span class="op" id="5756478">{</span><span class="ident" id="5756479">opHead</span><span class="op" id="5756485">,</span>&nbsp;<span class="op" id="5756487">[</span><span class="op" id="5756488">]</span><span class="builtintype" id="5756489">string</span><span class="op" id="5756495">{</span><span class="ident" id="5756496">head</span><span class="op" id="5756500">}</span><span class="op" id="5756501">}</span><span class="op" id="5756502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756508">i</span>&nbsp;<span class="op" id="5756510">+=</span>&nbsp;<span class="num" id="5756513">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756519">lastWasHeading</span>&nbsp;<span class="op" id="5756534">=</span>&nbsp;<span class="builtintype" id="5756536">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756545">continue</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5756566">//&nbsp;open&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756586">lastWasBlank</span>&nbsp;<span class="op" id="5756599">=</span>&nbsp;<span class="builtintype" id="5756601">false</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756609">lastWasHeading</span>&nbsp;<span class="op" id="5756624">=</span>&nbsp;<span class="builtintype" id="5756626">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756634">para</span>&nbsp;<span class="op" id="5756639">=</span>&nbsp;<span class="builtinfunc" id="5756641">append</span><span class="op" id="5756647">(</span><span class="ident" id="5756648">para</span><span class="op" id="5756652">,</span>&nbsp;<span class="ident" id="5756654">lines</span><span class="op" id="5756659">[</span><span class="ident" id="5756660">i</span><span class="op" id="5756661">]</span><span class="op" id="5756662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5756666">i</span><span class="op" id="5756667">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5756671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5756674">close</span><span class="op" id="5756679">(</span><span class="op" id="5756680">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5756684">return</span>&nbsp;<span class="ident" id="5756691">out</span><br>
<span class="lineno"></span><span class="op" id="5756695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5756698">//&nbsp;ToText&nbsp;prepares&nbsp;comment&nbsp;text&nbsp;for&nbsp;presentation&nbsp;in&nbsp;textual&nbsp;output.</span><br>
<span class="lineno">400</span><span class="comment" id="5756766">//&nbsp;It&nbsp;wraps&nbsp;paragraphs&nbsp;of&nbsp;text&nbsp;to&nbsp;width&nbsp;or&nbsp;fewer&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno"></span><span class="comment" id="5756835">//&nbsp;and&nbsp;then&nbsp;prefixes&nbsp;each&nbsp;line&nbsp;with&nbsp;the&nbsp;indent.&nbsp;&nbsp;In&nbsp;preformatted&nbsp;sections</span><br>
<span class="lineno"></span><span class="comment" id="5756909">//&nbsp;(such&nbsp;as&nbsp;program&nbsp;text),&nbsp;it&nbsp;prefixes&nbsp;each&nbsp;non-blank&nbsp;line&nbsp;with&nbsp;preIndent.</span><br>
<span class="lineno"></span><span class="keyword" id="5756984">func</span>&nbsp;<span class="ident" id="5756989">ToText</span><span class="op" id="5756995">(</span><span class="ident" id="5756996">w</span>&nbsp;<span class="ident" id="5756998">io</span><span class="op" id="5757000">.</span><span class="ident" id="5757001">Writer</span><span class="op" id="5757007">,</span>&nbsp;<span class="ident" id="5757009">text</span>&nbsp;<span class="builtintype" id="5757014">string</span><span class="op" id="5757020">,</span>&nbsp;<span class="ident" id="5757022">indent</span><span class="op" id="5757028">,</span>&nbsp;<span class="ident" id="5757030">preIndent</span>&nbsp;<span class="builtintype" id="5757040">string</span><span class="op" id="5757046">,</span>&nbsp;<span class="ident" id="5757048">width</span>&nbsp;<span class="builtintype" id="5757054">int</span><span class="op" id="5757057">)</span>&nbsp;<span class="op" id="5757059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757062">l</span>&nbsp;<span class="op" id="5757064">:=</span>&nbsp;<span class="ident" id="5757067">lineWrapper</span><span class="op" id="5757078">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757082">out</span><span class="op" id="5757085">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5757090">w</span><span class="op" id="5757091">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757095">width</span><span class="op" id="5757100">:</span>&nbsp;&nbsp;<span class="ident" id="5757103">width</span><span class="op" id="5757108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757112">indent</span><span class="op" id="5757118">:</span>&nbsp;<span class="ident" id="5757120">indent</span><span class="op" id="5757126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757132">for</span>&nbsp;<span class="ident" id="5757136">_</span><span class="op" id="5757137">,</span>&nbsp;<span class="ident" id="5757139">b</span>&nbsp;<span class="op" id="5757141">:=</span>&nbsp;<span class="keyword" id="5757144">range</span>&nbsp;<span class="ident" id="5757150">blocks</span><span class="op" id="5757156">(</span><span class="ident" id="5757157">text</span><span class="op" id="5757161">)</span>&nbsp;<span class="op" id="5757163">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757167">switch</span>&nbsp;<span class="ident" id="5757174">b</span><span class="op" id="5757175">.</span><span class="ident" id="5757176">op</span>&nbsp;<span class="op" id="5757179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757183">case</span>&nbsp;<span class="ident" id="5757188">opPara</span><span class="op" id="5757194">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5757199">//&nbsp;l.write&nbsp;will&nbsp;add&nbsp;leading&nbsp;newline&nbsp;if&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757250">for</span>&nbsp;<span class="ident" id="5757254">_</span><span class="op" id="5757255">,</span>&nbsp;<span class="ident" id="5757257">line</span>&nbsp;<span class="op" id="5757262">:=</span>&nbsp;<span class="keyword" id="5757265">range</span>&nbsp;<span class="ident" id="5757271">b</span><span class="op" id="5757272">.</span><span class="ident" id="5757273">lines</span>&nbsp;<span class="op" id="5757279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757285">l</span><span class="op" id="5757286">.</span><span class="ident" id="5757287">write</span><span class="op" id="5757292">(</span><span class="ident" id="5757293">line</span><span class="op" id="5757297">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757307">l</span><span class="op" id="5757308">.</span><span class="ident" id="5757309">flush</span><span class="op" id="5757314">(</span><span class="op" id="5757315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757319">case</span>&nbsp;<span class="ident" id="5757324">opHead</span><span class="op" id="5757330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757335">w</span><span class="op" id="5757336">.</span><span class="ident" id="5757337">Write</span><span class="op" id="5757342">(</span><span class="ident" id="5757343">nl</span><span class="op" id="5757345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757350">for</span>&nbsp;<span class="ident" id="5757354">_</span><span class="op" id="5757355">,</span>&nbsp;<span class="ident" id="5757357">line</span>&nbsp;<span class="op" id="5757362">:=</span>&nbsp;<span class="keyword" id="5757365">range</span>&nbsp;<span class="ident" id="5757371">b</span><span class="op" id="5757372">.</span><span class="ident" id="5757373">lines</span>&nbsp;<span class="op" id="5757379">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757385">l</span><span class="op" id="5757386">.</span><span class="ident" id="5757387">write</span><span class="op" id="5757392">(</span><span class="ident" id="5757393">line</span>&nbsp;<span class="op" id="5757398">+</span>&nbsp;<span class="string" id="5757400">&#34;\n&#34;</span><span class="op" id="5757404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757414">l</span><span class="op" id="5757415">.</span><span class="ident" id="5757416">flush</span><span class="op" id="5757421">(</span><span class="op" id="5757422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757426">case</span>&nbsp;<span class="ident" id="5757431">opPre</span><span class="op" id="5757436">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757441">w</span><span class="op" id="5757442">.</span><span class="ident" id="5757443">Write</span><span class="op" id="5757448">(</span><span class="ident" id="5757449">nl</span><span class="op" id="5757451">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757456">for</span>&nbsp;<span class="ident" id="5757460">_</span><span class="op" id="5757461">,</span>&nbsp;<span class="ident" id="5757463">line</span>&nbsp;<span class="op" id="5757468">:=</span>&nbsp;<span class="keyword" id="5757471">range</span>&nbsp;<span class="ident" id="5757477">b</span><span class="op" id="5757478">.</span><span class="ident" id="5757479">lines</span>&nbsp;<span class="op" id="5757485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757491">if</span>&nbsp;<span class="ident" id="5757494">isBlank</span><span class="op" id="5757501">(</span><span class="ident" id="5757502">line</span><span class="op" id="5757506">)</span>&nbsp;<span class="op" id="5757508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757515">w</span><span class="op" id="5757516">.</span><span class="ident" id="5757517">Write</span><span class="op" id="5757522">(</span><span class="op" id="5757523">[</span><span class="op" id="5757524">]</span><span class="builtintype" id="5757525">byte</span><span class="op" id="5757529">(</span><span class="string" id="5757530">&#34;\n&#34;</span><span class="op" id="5757534">)</span><span class="op" id="5757535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757541">}</span>&nbsp;<span class="keyword" id="5757543">else</span>&nbsp;<span class="op" id="5757548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757555">w</span><span class="op" id="5757556">.</span><span class="ident" id="5757557">Write</span><span class="op" id="5757562">(</span><span class="op" id="5757563">[</span><span class="op" id="5757564">]</span><span class="builtintype" id="5757565">byte</span><span class="op" id="5757569">(</span><span class="ident" id="5757570">preIndent</span><span class="op" id="5757579">)</span><span class="op" id="5757580">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757587">w</span><span class="op" id="5757588">.</span><span class="ident" id="5757589">Write</span><span class="op" id="5757594">(</span><span class="op" id="5757595">[</span><span class="op" id="5757596">]</span><span class="builtintype" id="5757597">byte</span><span class="op" id="5757601">(</span><span class="ident" id="5757602">line</span><span class="op" id="5757606">)</span><span class="op" id="5757607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757625">}</span><br>
<span class="lineno">435</span><span class="op" id="5757627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5757630">type</span>&nbsp;<span class="ident" id="5757635">lineWrapper</span>&nbsp;<span class="keyword" id="5757647">struct</span>&nbsp;<span class="op" id="5757654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757657">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5757667">io</span><span class="op" id="5757669">.</span><span class="ident" id="5757670">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757678">printed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5757688">bool</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757694">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5757704">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757709">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5757719">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757727">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5757737">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757742">pendSpace</span>&nbsp;<span class="builtintype" id="5757752">int</span><br>
<span class="lineno"></span><span class="op" id="5757756">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="5757759">var</span>&nbsp;<span class="ident" id="5757763">nl</span>&nbsp;<span class="op" id="5757766">=</span>&nbsp;<span class="op" id="5757768">[</span><span class="op" id="5757769">]</span><span class="builtintype" id="5757770">byte</span><span class="op" id="5757774">(</span><span class="string" id="5757775">&#34;\n&#34;</span><span class="op" id="5757779">)</span><br>
<span class="lineno"></span><span class="keyword" id="5757781">var</span>&nbsp;<span class="ident" id="5757785">space</span>&nbsp;<span class="op" id="5757791">=</span>&nbsp;<span class="op" id="5757793">[</span><span class="op" id="5757794">]</span><span class="builtintype" id="5757795">byte</span><span class="op" id="5757799">(</span><span class="string" id="5757800">&#34;&nbsp;&#34;</span><span class="op" id="5757803">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5757806">func</span>&nbsp;<span class="op" id="5757811">(</span><span class="ident" id="5757812">l</span>&nbsp;<span class="op" id="5757814">*</span><span class="ident" id="5757815">lineWrapper</span><span class="op" id="5757826">)</span>&nbsp;<span class="ident" id="5757828">write</span><span class="op" id="5757833">(</span><span class="ident" id="5757834">text</span>&nbsp;<span class="builtintype" id="5757839">string</span><span class="op" id="5757845">)</span>&nbsp;<span class="op" id="5757847">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757850">if</span>&nbsp;<span class="ident" id="5757853">l</span><span class="op" id="5757854">.</span><span class="ident" id="5757855">n</span>&nbsp;<span class="op" id="5757857">==</span>&nbsp;<span class="num" id="5757860">0</span>&nbsp;<span class="op" id="5757862">&amp;&amp;</span>&nbsp;<span class="ident" id="5757865">l</span><span class="op" id="5757866">.</span><span class="ident" id="5757867">printed</span>&nbsp;<span class="op" id="5757875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757879">l</span><span class="op" id="5757880">.</span><span class="ident" id="5757881">out</span><span class="op" id="5757884">.</span><span class="ident" id="5757885">Write</span><span class="op" id="5757890">(</span><span class="ident" id="5757891">nl</span><span class="op" id="5757893">)</span>&nbsp;<span class="comment" id="5757895">//&nbsp;blank&nbsp;line&nbsp;before&nbsp;new&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5757931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757934">l</span><span class="op" id="5757935">.</span><span class="ident" id="5757936">printed</span>&nbsp;<span class="op" id="5757944">=</span>&nbsp;<span class="builtintype" id="5757946">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5757953">for</span>&nbsp;<span class="ident" id="5757957">_</span><span class="op" id="5757958">,</span>&nbsp;<span class="ident" id="5757960">f</span>&nbsp;<span class="op" id="5757962">:=</span>&nbsp;<span class="keyword" id="5757965">range</span>&nbsp;<span class="ident" id="5757971">strings</span><span class="op" id="5757978">.</span><span class="ident" id="5757979">Fields</span><span class="op" id="5757985">(</span><span class="ident" id="5757986">text</span><span class="op" id="5757990">)</span>&nbsp;<span class="op" id="5757992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5757996">w</span>&nbsp;<span class="op" id="5757998">:=</span>&nbsp;<span class="ident" id="5758001">utf8</span><span class="op" id="5758005">.</span><span class="ident" id="5758006">RuneCountInString</span><span class="op" id="5758023">(</span><span class="ident" id="5758024">f</span><span class="op" id="5758025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5758029">//&nbsp;wrap&nbsp;if&nbsp;line&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758059">if</span>&nbsp;<span class="ident" id="5758062">l</span><span class="op" id="5758063">.</span><span class="ident" id="5758064">n</span>&nbsp;<span class="op" id="5758066">&gt;</span>&nbsp;<span class="num" id="5758068">0</span>&nbsp;<span class="op" id="5758070">&amp;&amp;</span>&nbsp;<span class="ident" id="5758073">l</span><span class="op" id="5758074">.</span><span class="ident" id="5758075">n</span><span class="op" id="5758076">+</span><span class="ident" id="5758077">l</span><span class="op" id="5758078">.</span><span class="ident" id="5758079">pendSpace</span><span class="op" id="5758088">+</span><span class="ident" id="5758089">w</span>&nbsp;<span class="op" id="5758091">&gt;</span>&nbsp;<span class="ident" id="5758093">l</span><span class="op" id="5758094">.</span><span class="ident" id="5758095">width</span>&nbsp;<span class="op" id="5758101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758106">l</span><span class="op" id="5758107">.</span><span class="ident" id="5758108">out</span><span class="op" id="5758111">.</span><span class="ident" id="5758112">Write</span><span class="op" id="5758117">(</span><span class="ident" id="5758118">nl</span><span class="op" id="5758120">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758125">l</span><span class="op" id="5758126">.</span><span class="ident" id="5758127">n</span>&nbsp;<span class="op" id="5758129">=</span>&nbsp;<span class="num" id="5758131">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758136">l</span><span class="op" id="5758137">.</span><span class="ident" id="5758138">pendSpace</span>&nbsp;<span class="op" id="5758148">=</span>&nbsp;<span class="num" id="5758150">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758158">if</span>&nbsp;<span class="ident" id="5758161">l</span><span class="op" id="5758162">.</span><span class="ident" id="5758163">n</span>&nbsp;<span class="op" id="5758165">==</span>&nbsp;<span class="num" id="5758168">0</span>&nbsp;<span class="op" id="5758170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758175">l</span><span class="op" id="5758176">.</span><span class="ident" id="5758177">out</span><span class="op" id="5758180">.</span><span class="ident" id="5758181">Write</span><span class="op" id="5758186">(</span><span class="op" id="5758187">[</span><span class="op" id="5758188">]</span><span class="builtintype" id="5758189">byte</span><span class="op" id="5758193">(</span><span class="ident" id="5758194">l</span><span class="op" id="5758195">.</span><span class="ident" id="5758196">indent</span><span class="op" id="5758202">)</span><span class="op" id="5758203">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758211">l</span><span class="op" id="5758212">.</span><span class="ident" id="5758213">out</span><span class="op" id="5758216">.</span><span class="ident" id="5758217">Write</span><span class="op" id="5758222">(</span><span class="ident" id="5758223">space</span><span class="op" id="5758228">[</span><span class="op" id="5758229">:</span><span class="ident" id="5758230">l</span><span class="op" id="5758231">.</span><span class="ident" id="5758232">pendSpace</span><span class="op" id="5758241">]</span><span class="op" id="5758242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758246">l</span><span class="op" id="5758247">.</span><span class="ident" id="5758248">out</span><span class="op" id="5758251">.</span><span class="ident" id="5758252">Write</span><span class="op" id="5758257">(</span><span class="op" id="5758258">[</span><span class="op" id="5758259">]</span><span class="builtintype" id="5758260">byte</span><span class="op" id="5758264">(</span><span class="ident" id="5758265">f</span><span class="op" id="5758266">)</span><span class="op" id="5758267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758271">l</span><span class="op" id="5758272">.</span><span class="ident" id="5758273">n</span>&nbsp;<span class="op" id="5758275">+=</span>&nbsp;<span class="ident" id="5758278">l</span><span class="op" id="5758279">.</span><span class="ident" id="5758280">pendSpace</span>&nbsp;<span class="op" id="5758290">+</span>&nbsp;<span class="ident" id="5758292">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758296">l</span><span class="op" id="5758297">.</span><span class="ident" id="5758298">pendSpace</span>&nbsp;<span class="op" id="5758308">=</span>&nbsp;<span class="num" id="5758310">1</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758313">}</span><br>
<span class="lineno"></span><span class="op" id="5758315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5758318">func</span>&nbsp;<span class="op" id="5758323">(</span><span class="ident" id="5758324">l</span>&nbsp;<span class="op" id="5758326">*</span><span class="ident" id="5758327">lineWrapper</span><span class="op" id="5758338">)</span>&nbsp;<span class="ident" id="5758340">flush</span><span class="op" id="5758345">(</span><span class="op" id="5758346">)</span>&nbsp;<span class="op" id="5758348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758351">if</span>&nbsp;<span class="ident" id="5758354">l</span><span class="op" id="5758355">.</span><span class="ident" id="5758356">n</span>&nbsp;<span class="op" id="5758358">==</span>&nbsp;<span class="num" id="5758361">0</span>&nbsp;<span class="op" id="5758363">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5758367">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5758375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758378">l</span><span class="op" id="5758379">.</span><span class="ident" id="5758380">out</span><span class="op" id="5758383">.</span><span class="ident" id="5758384">Write</span><span class="op" id="5758389">(</span><span class="ident" id="5758390">nl</span><span class="op" id="5758392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758395">l</span><span class="op" id="5758396">.</span><span class="ident" id="5758397">pendSpace</span>&nbsp;<span class="op" id="5758407">=</span>&nbsp;<span class="num" id="5758409">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5758412">l</span><span class="op" id="5758413">.</span><span class="ident" id="5758414">n</span>&nbsp;<span class="op" id="5758416">=</span>&nbsp;<span class="num" id="5758418">0</span><br>
<span class="lineno">480</span><span class="op" id="5758420">}</span>
</div>
</body>
</html>
