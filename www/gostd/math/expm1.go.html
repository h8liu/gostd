<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math</h2>
<ul>
<li><a href="/gostd/math/abs.go.html">abs.go</a></li>
<li><a href="/gostd/math/acosh.go.html">acosh.go</a></li>
<li><a href="/gostd/math/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/math/asin.go.html">asin.go</a></li>
<li><a href="/gostd/math/asinh.go.html">asinh.go</a></li>
<li><a href="/gostd/math/atan.go.html">atan.go</a></li>
<li><a href="/gostd/math/atan2.go.html">atan2.go</a></li>
<li><a href="/gostd/math/atanh.go.html">atanh.go</a></li>
<li><a href="/gostd/math/bits.go.html">bits.go</a></li>
<li><a href="/gostd/math/cbrt.go.html">cbrt.go</a></li>
<li><a href="/gostd/math/const.go.html">const.go</a></li>
<li><a href="/gostd/math/copysign.go.html">copysign.go</a></li>
<li><a href="/gostd/math/dim.go.html">dim.go</a></li>
<li><a href="/gostd/math/erf.go.html">erf.go</a></li>
<li><a href="/gostd/math/exp.go.html">exp.go</a></li>
<li><a href="/gostd/math/expm1.go.html">expm1.go</a></li>
<li><a href="/gostd/math/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/math/floor.go.html">floor.go</a></li>
<li><a href="/gostd/math/frexp.go.html">frexp.go</a></li>
<li><a href="/gostd/math/gamma.go.html">gamma.go</a></li>
<li><a href="/gostd/math/hypot.go.html">hypot.go</a></li>
<li><a href="/gostd/math/j0.go.html">j0.go</a></li>
<li><a href="/gostd/math/j1.go.html">j1.go</a></li>
<li><a href="/gostd/math/jn.go.html">jn.go</a></li>
<li><a href="/gostd/math/ldexp.go.html">ldexp.go</a></li>
<li><a href="/gostd/math/lgamma.go.html">lgamma.go</a></li>
<li><a href="/gostd/math/log.go.html">log.go</a></li>
<li><a href="/gostd/math/log10.go.html">log10.go</a></li>
<li><a href="/gostd/math/log1p.go.html">log1p.go</a></li>
<li><a href="/gostd/math/logb.go.html">logb.go</a></li>
<li><a href="/gostd/math/mod.go.html">mod.go</a></li>
<li><a href="/gostd/math/modf.go.html">modf.go</a></li>
<li><a href="/gostd/math/nextafter.go.html">nextafter.go</a></li>
<li><a href="/gostd/math/pow.go.html">pow.go</a></li>
<li><a href="/gostd/math/pow10.go.html">pow10.go</a></li>
<li><a href="/gostd/math/remainder.go.html">remainder.go</a></li>
<li><a href="/gostd/math/signbit.go.html">signbit.go</a></li>
<li><a href="/gostd/math/sin.go.html">sin.go</a></li>
<li><a href="/gostd/math/sincos.go.html">sincos.go</a></li>
<li><a href="/gostd/math/sinh.go.html">sinh.go</a></li>
<li><a href="/gostd/math/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/math/tan.go.html">tan.go</a></li>
<li><a href="/gostd/math/tanh.go.html">tanh.go</a></li>
<li><a href="/gostd/math/unsafe.go.html">unsafe.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2079581">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2079636">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2079690">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2079741">package</span>&nbsp;<span class="ident" id="2079749">math</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2079755">//&nbsp;The&nbsp;original&nbsp;C&nbsp;code,&nbsp;the&nbsp;long&nbsp;comment,&nbsp;and&nbsp;the&nbsp;constants</span><br>
<span class="lineno"></span><span class="comment" id="2079815">//&nbsp;below&nbsp;are&nbsp;from&nbsp;FreeBSD&#39;s&nbsp;/usr/src/lib/msun/src/s_expm1.c</span><br>
<span class="lineno"></span><span class="comment" id="2079875">//&nbsp;and&nbsp;came&nbsp;with&nbsp;this&nbsp;notice.&nbsp;&nbsp;The&nbsp;go&nbsp;code&nbsp;is&nbsp;a&nbsp;simplified</span><br>
<span class="lineno">10</span><span class="comment" id="2079934">//&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="2079964">//</span><br>
<span class="lineno"></span><span class="comment" id="2079967">//&nbsp;====================================================</span><br>
<span class="lineno"></span><span class="comment" id="2080023">//&nbsp;Copyright&nbsp;(C)&nbsp;1993&nbsp;by&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2080092">//</span><br>
<span class="lineno">15</span><span class="comment" id="2080095">//&nbsp;Developed&nbsp;at&nbsp;SunPro,&nbsp;a&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;business.</span><br>
<span class="lineno"></span><span class="comment" id="2080154">//&nbsp;Permission&nbsp;to&nbsp;use,&nbsp;copy,&nbsp;modify,&nbsp;and&nbsp;distribute&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="2080210">//&nbsp;software&nbsp;is&nbsp;freely&nbsp;granted,&nbsp;provided&nbsp;that&nbsp;this&nbsp;notice</span><br>
<span class="lineno"></span><span class="comment" id="2080267">//&nbsp;is&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="comment" id="2080284">//&nbsp;====================================================</span><br>
<span class="lineno">20</span><span class="comment" id="2080340">//</span><br>
<span class="lineno"></span><span class="comment" id="2080343">//&nbsp;expm1(x)</span><br>
<span class="lineno"></span><span class="comment" id="2080355">//&nbsp;Returns&nbsp;exp(x)-1,&nbsp;the&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2080406">//</span><br>
<span class="lineno"></span><span class="comment" id="2080409">//&nbsp;Method</span><br>
<span class="lineno">25</span><span class="comment" id="2080419">//&nbsp;&nbsp;&nbsp;1.&nbsp;Argument&nbsp;reduction:</span><br>
<span class="lineno"></span><span class="comment" id="2080447">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Given&nbsp;x,&nbsp;find&nbsp;r&nbsp;and&nbsp;integer&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2080495">//</span><br>
<span class="lineno"></span><span class="comment" id="2080498">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;k*ln2&nbsp;+&nbsp;r,&nbsp;&nbsp;|r|&nbsp;&lt;=&nbsp;0.5*ln2&nbsp;~&nbsp;0.34658</span><br>
<span class="lineno"></span><span class="comment" id="2080556">//</span><br>
<span class="lineno">30</span><span class="comment" id="2080559">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;a&nbsp;correction&nbsp;term&nbsp;c&nbsp;will&nbsp;be&nbsp;computed&nbsp;to&nbsp;compensate</span><br>
<span class="lineno"></span><span class="comment" id="2080623">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;error&nbsp;in&nbsp;r&nbsp;when&nbsp;rounded&nbsp;to&nbsp;a&nbsp;floating-point&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="2080687">//</span><br>
<span class="lineno"></span><span class="comment" id="2080690">//&nbsp;&nbsp;&nbsp;2.&nbsp;Approximating&nbsp;expm1(r)&nbsp;by&nbsp;a&nbsp;special&nbsp;rational&nbsp;function&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="2080755">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;interval&nbsp;[0,0.34658]:</span><br>
<span class="lineno">35</span><span class="comment" id="2080789">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Since</span><br>
<span class="lineno"></span><span class="comment" id="2080803">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;-&nbsp;r**4/360&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2080868">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;define&nbsp;R1(r*r)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2080897">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;*&nbsp;R1(r*r)</span><br>
<span class="lineno"></span><span class="comment" id="2080955">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;is,</span><br>
<span class="lineno">40</span><span class="comment" id="2080972">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(r**2)&nbsp;=&nbsp;6/r&nbsp;*((exp(r)+1)/(exp(r)-1)&nbsp;-&nbsp;2/r)</span><br>
<span class="lineno"></span><span class="comment" id="2081030">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6/r&nbsp;*&nbsp;(&nbsp;1&nbsp;+&nbsp;2.0*(1/(exp(r)-1)&nbsp;-&nbsp;1/r))</span><br>
<span class="lineno"></span><span class="comment" id="2081091">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1&nbsp;-&nbsp;r**2/60&nbsp;+&nbsp;r**4/2520&nbsp;-&nbsp;r**6/100800&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2081158">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;use&nbsp;a&nbsp;special&nbsp;Reme&nbsp;algorithm&nbsp;on&nbsp;[0,0.347]&nbsp;to&nbsp;generate</span><br>
<span class="lineno"></span><span class="comment" id="2081223">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;polynomial&nbsp;of&nbsp;degree&nbsp;5&nbsp;in&nbsp;r*r&nbsp;to&nbsp;approximate&nbsp;R1.&nbsp;The</span><br>
<span class="lineno">45</span><span class="comment" id="2081286">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maximum&nbsp;error&nbsp;of&nbsp;this&nbsp;polynomial&nbsp;approximation&nbsp;is&nbsp;bounded</span><br>
<span class="lineno"></span><span class="comment" id="2081352">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;2**-61.&nbsp;In&nbsp;other&nbsp;words,</span><br>
<span class="lineno"></span><span class="comment" id="2081387">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(z)&nbsp;~&nbsp;1.0&nbsp;+&nbsp;Q1*z&nbsp;+&nbsp;Q2*z**2&nbsp;+&nbsp;Q3*z**3&nbsp;+&nbsp;Q4*z**4&nbsp;+&nbsp;Q5*z**5</span><br>
<span class="lineno"></span><span class="comment" id="2081458">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;&nbsp;&nbsp;Q1&nbsp;&nbsp;=&nbsp;&nbsp;-1.6666666666666567384E-2,</span><br>
<span class="lineno"></span><span class="comment" id="2081508">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q2&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;3.9682539681370365873E-4,</span><br>
<span class="lineno">50</span><span class="comment" id="2081558">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3&nbsp;&nbsp;=&nbsp;&nbsp;-9.9206344733435987357E-6,</span><br>
<span class="lineno"></span><span class="comment" id="2081608">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q4&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;2.5051361420808517002E-7,</span><br>
<span class="lineno"></span><span class="comment" id="2081658">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q5&nbsp;&nbsp;=&nbsp;&nbsp;-6.2843505682382617102E-9;</span><br>
<span class="lineno"></span><span class="comment" id="2081708">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(where&nbsp;z=r*r,&nbsp;and&nbsp;the&nbsp;values&nbsp;of&nbsp;Q1&nbsp;to&nbsp;Q5&nbsp;are&nbsp;listed&nbsp;below)</span><br>
<span class="lineno"></span><span class="comment" id="2081775">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;error&nbsp;bounded&nbsp;by</span><br>
<span class="lineno">55</span><span class="comment" id="2081805">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-61</span><br>
<span class="lineno"></span><span class="comment" id="2081858">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;1.0+Q1*z+...+Q5*z&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;R1(z)&nbsp;|&nbsp;&lt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="2081908">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="2081953">//</span><br>
<span class="lineno"></span><span class="comment" id="2081956">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;exp(r)-1&nbsp;is&nbsp;then&nbsp;computed&nbsp;by&nbsp;the&nbsp;following</span><br>
<span class="lineno">60</span><span class="comment" id="2082018">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specific&nbsp;way&nbsp;which&nbsp;minimize&nbsp;the&nbsp;accumulation&nbsp;rounding&nbsp;error:</span><br>
<span class="lineno"></span><span class="comment" id="2082087">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="2082126">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;3&nbsp;-&nbsp;(R1&nbsp;+&nbsp;R1*r/2)&nbsp;&nbsp;]</span><br>
<span class="lineno"></span><span class="comment" id="2082190">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;r&nbsp;+&nbsp;---&nbsp;+&nbsp;---&nbsp;*&nbsp;[--------------------]</span><br>
<span class="lineno"></span><span class="comment" id="2082254">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]</span><br>
<span class="lineno">65</span><span class="comment" id="2082318">//</span><br>
<span class="lineno"></span><span class="comment" id="2082321">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;compensate&nbsp;the&nbsp;error&nbsp;in&nbsp;the&nbsp;argument&nbsp;reduction,&nbsp;we&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="2082387">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)&nbsp;=&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;expm1(r)*c</span><br>
<span class="lineno"></span><span class="comment" id="2082442">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;r*c</span><br>
<span class="lineno"></span><span class="comment" id="2082490">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thus&nbsp;c+r*c&nbsp;will&nbsp;be&nbsp;added&nbsp;in&nbsp;as&nbsp;the&nbsp;correction&nbsp;terms&nbsp;for</span><br>
<span class="lineno">70</span><span class="comment" id="2082554">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c).&nbsp;Now&nbsp;rearrange&nbsp;the&nbsp;term&nbsp;to&nbsp;avoid&nbsp;optimization</span><br>
<span class="lineno"></span><span class="comment" id="2082619">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;up:</span><br>
<span class="lineno"></span><span class="comment" id="2082637">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2082709">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;R1&nbsp;-&nbsp;&nbsp;(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2082781">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)~r&nbsp;-&nbsp;({r*(---&nbsp;*&nbsp;[--------------------]-c)-c}&nbsp;-&nbsp;---&nbsp;)</span><br>
<span class="lineno">75</span><span class="comment" id="2082853">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2082925">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2082997">//</span><br>
<span class="lineno"></span><span class="comment" id="2083000">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;r&nbsp;-&nbsp;E</span><br>
<span class="lineno"></span><span class="comment" id="2083027">//&nbsp;&nbsp;&nbsp;3.&nbsp;Scale&nbsp;back&nbsp;to&nbsp;obtain&nbsp;expm1(x):</span><br>
<span class="lineno">80</span><span class="comment" id="2083066">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;step&nbsp;1,&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="2083095">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(x)&nbsp;=&nbsp;either&nbsp;2**k*[expm1(r)+1]&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="2083146">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2**k*[expm1(r)&nbsp;+&nbsp;(1-2**-k)]</span><br>
<span class="lineno"></span><span class="comment" id="2083203">//&nbsp;&nbsp;&nbsp;4.&nbsp;Implementation&nbsp;notes:</span><br>
<span class="lineno"></span><span class="comment" id="2083233">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(A).&nbsp;To&nbsp;save&nbsp;one&nbsp;multiplication,&nbsp;we&nbsp;scale&nbsp;the&nbsp;coefficient&nbsp;Qi</span><br>
<span class="lineno">85</span><span class="comment" id="2083302">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;Qi*2**i,&nbsp;and&nbsp;replace&nbsp;z&nbsp;by&nbsp;(x**2)/2.</span><br>
<span class="lineno"></span><span class="comment" id="2083354">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(B).&nbsp;To&nbsp;achieve&nbsp;maximum&nbsp;accuracy,&nbsp;we&nbsp;compute&nbsp;expm1(x)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2083419">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(i)&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0,&nbsp;(raise&nbsp;inexact&nbsp;if&nbsp;x!=inf)</span><br>
<span class="lineno"></span><span class="comment" id="2083490">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ii)&nbsp;&nbsp;if&nbsp;k=0,&nbsp;return&nbsp;r-E</span><br>
<span class="lineno"></span><span class="comment" id="2083525">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iii)&nbsp;if&nbsp;k=-1,&nbsp;return&nbsp;0.5*(r-E)-0.5</span><br>
<span class="lineno">90</span><span class="comment" id="2083571">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iv)&nbsp;&nbsp;if&nbsp;k=1&nbsp;if&nbsp;r&nbsp;&lt;&nbsp;-0.25,&nbsp;return&nbsp;2*((r+0.5)-&nbsp;E)</span><br>
<span class="lineno"></span><span class="comment" id="2083630">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;1.0+2.0*(r-E);</span><br>
<span class="lineno"></span><span class="comment" id="2083690">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(v)&nbsp;&nbsp;&nbsp;if&nbsp;(k&lt;-2||k&gt;56)&nbsp;return&nbsp;2**k(1-(E-r))&nbsp;-&nbsp;1&nbsp;(or&nbsp;exp(x)-1)</span><br>
<span class="lineno"></span><span class="comment" id="2083761">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vi)&nbsp;&nbsp;if&nbsp;k&nbsp;&lt;=&nbsp;20,&nbsp;return&nbsp;2**k((1-2**-k)-(E-r)),&nbsp;else</span><br>
<span class="lineno"></span><span class="comment" id="2083824">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vii)&nbsp;return&nbsp;2**k(1-((E+2**-k)-r))</span><br>
<span class="lineno">95</span><span class="comment" id="2083869">//</span><br>
<span class="lineno"></span><span class="comment" id="2083872">//&nbsp;Special&nbsp;cases:</span><br>
<span class="lineno"></span><span class="comment" id="2083890">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(INF)&nbsp;is&nbsp;INF,&nbsp;expm1(NaN)&nbsp;is&nbsp;NaN;</span><br>
<span class="lineno"></span><span class="comment" id="2083936">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(-INF)&nbsp;is&nbsp;-1,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2083967">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;finite&nbsp;argument,&nbsp;only&nbsp;expm1(0)=0&nbsp;is&nbsp;exact.</span><br>
<span class="lineno">100</span><span class="comment" id="2084022">//</span><br>
<span class="lineno"></span><span class="comment" id="2084025">//&nbsp;Accuracy:</span><br>
<span class="lineno"></span><span class="comment" id="2084038">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;an&nbsp;error&nbsp;analysis,&nbsp;the&nbsp;error&nbsp;is&nbsp;always&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="2084108">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;ulp&nbsp;(unit&nbsp;in&nbsp;the&nbsp;last&nbsp;place).</span><br>
<span class="lineno"></span><span class="comment" id="2084148">//</span><br>
<span class="lineno">105</span><span class="comment" id="2084151">//&nbsp;Misc.&nbsp;info.</span><br>
<span class="lineno"></span><span class="comment" id="2084166">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;IEEE&nbsp;double</span><br>
<span class="lineno"></span><span class="comment" id="2084190">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;7.09782712893383973096e+02&nbsp;then&nbsp;expm1(x)&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="2084260">//</span><br>
<span class="lineno"></span><span class="comment" id="2084263">//&nbsp;Constants:</span><br>
<span class="lineno">110</span><span class="comment" id="2084277">//&nbsp;The&nbsp;hexadecimal&nbsp;values&nbsp;are&nbsp;the&nbsp;intended&nbsp;ones&nbsp;for&nbsp;the&nbsp;following</span><br>
<span class="lineno"></span><span class="comment" id="2084343">//&nbsp;constants.&nbsp;The&nbsp;decimal&nbsp;values&nbsp;may&nbsp;be&nbsp;used,&nbsp;provided&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2084407">//&nbsp;compiler&nbsp;will&nbsp;convert&nbsp;from&nbsp;decimal&nbsp;to&nbsp;binary&nbsp;accurately&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="2084473">//&nbsp;to&nbsp;produce&nbsp;the&nbsp;hexadecimal&nbsp;values&nbsp;shown.</span><br>
<span class="lineno"></span><span class="comment" id="2084517">//</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2084521">//&nbsp;Expm1&nbsp;returns&nbsp;e**x&nbsp;-&nbsp;1,&nbsp;the&nbsp;base-e&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2084585">//&nbsp;It&nbsp;is&nbsp;more&nbsp;accurate&nbsp;than&nbsp;Exp(x)&nbsp;-&nbsp;1&nbsp;when&nbsp;x&nbsp;is&nbsp;near&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="2084645">//</span><br>
<span class="lineno"></span><span class="comment" id="2084648">//&nbsp;Special&nbsp;cases&nbsp;are:</span><br>
<span class="lineno">120</span><span class="comment" id="2084670">//&nbsp;&nbsp;&nbsp;&nbspExpm1(+Inf)&nbsp;=&nbsp;+Inf</span><br>
<span class="lineno"></span><span class="comment" id="2084692">//&nbsp;&nbsp;&nbsp;&nbspExpm1(-Inf)&nbsp;=&nbsp;-1</span><br>
<span class="lineno"></span><span class="comment" id="2084712">//&nbsp;&nbsp;&nbsp;&nbspExpm1(NaN)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="comment" id="2084732">//&nbsp;Very&nbsp;large&nbsp;values&nbsp;overflow&nbsp;to&nbsp;-1&nbsp;or&nbsp;+Inf.</span><br>
<span class="lineno"></span><span class="keyword" id="2084777">func</span>&nbsp;<span class="ident" id="2084782">Expm1</span><span class="op" id="2084787">(</span><span class="ident" id="2084788">x</span>&nbsp;<span class="builtintype" id="2084790">float64</span><span class="op" id="2084797">)</span>&nbsp;<span class="builtintype" id="2084799">float64</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="2084808">func</span>&nbsp;<span class="ident" id="2084813">expm1</span><span class="op" id="2084818">(</span><span class="ident" id="2084819">x</span>&nbsp;<span class="builtintype" id="2084821">float64</span><span class="op" id="2084828">)</span>&nbsp;<span class="builtintype" id="2084830">float64</span>&nbsp;<span class="op" id="2084838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2084841">const</span>&nbsp;<span class="op" id="2084847">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084851">Othreshold</span>&nbsp;<span class="op" id="2084862">=</span>&nbsp;<span class="num" id="2084864">7.09782712893383973096e+02</span>&nbsp;<span class="comment" id="2084891">//&nbsp;0x40862E42FEFA39EF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084915">Ln2X56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2084926">=</span>&nbsp;<span class="num" id="2084928">3.88162421113569373274e+01</span>&nbsp;<span class="comment" id="2084955">//&nbsp;0x4043687a9f1af2b1</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2084979">Ln2HalfX3</span>&nbsp;&nbsp;<span class="op" id="2084990">=</span>&nbsp;<span class="num" id="2084992">1.03972077083991796413e+00</span>&nbsp;<span class="comment" id="2085019">//&nbsp;0x3ff0a2b23f3bab73</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085043">Ln2Half</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2085054">=</span>&nbsp;<span class="num" id="2085056">3.46573590279972654709e-01</span>&nbsp;<span class="comment" id="2085083">//&nbsp;0x3fd62e42fefa39ef</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085107">Ln2Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2085118">=</span>&nbsp;<span class="num" id="2085120">6.93147180369123816490e-01</span>&nbsp;<span class="comment" id="2085147">//&nbsp;0x3fe62e42fee00000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085171">Ln2Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2085182">=</span>&nbsp;<span class="num" id="2085184">1.90821492927058770002e-10</span>&nbsp;<span class="comment" id="2085211">//&nbsp;0x3dea39ef35793c76</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085235">InvLn2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2085246">=</span>&nbsp;<span class="num" id="2085248">1.44269504088896338700e+00</span>&nbsp;<span class="comment" id="2085275">//&nbsp;0x3ff71547652b82fe</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085299">Tiny</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2085310">=</span>&nbsp;<span class="num" id="2085312">1.0</span>&nbsp;<span class="op" id="2085316">/</span>&nbsp;<span class="op" id="2085318">(</span><span class="num" id="2085319">1</span>&nbsp;<span class="op" id="2085321">&lt;&lt;</span>&nbsp;<span class="num" id="2085324">54</span><span class="op" id="2085326">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2085339">//&nbsp;2**-54&nbsp;=&nbsp;0x3c90000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2085372">//&nbsp;scaled&nbsp;coefficients&nbsp;related&nbsp;to&nbsp;expm1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085414">Q1</span>&nbsp;<span class="op" id="2085417">=</span>&nbsp;<span class="op" id="2085419">-</span><span class="num" id="2085420">3.33333333333331316428e-02</span>&nbsp;<span class="comment" id="2085447">//&nbsp;0xBFA11111111110F4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085471">Q2</span>&nbsp;<span class="op" id="2085474">=</span>&nbsp;<span class="num" id="2085476">1.58730158725481460165e-03</span>&nbsp;&nbsp;<span class="comment" id="2085504">//&nbsp;0x3F5A01A019FE5585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085528">Q3</span>&nbsp;<span class="op" id="2085531">=</span>&nbsp;<span class="op" id="2085533">-</span><span class="num" id="2085534">7.93650757867487942473e-05</span>&nbsp;<span class="comment" id="2085561">//&nbsp;0xBF14CE199EAADBB7</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085585">Q4</span>&nbsp;<span class="op" id="2085588">=</span>&nbsp;<span class="num" id="2085590">4.00821782732936239552e-06</span>&nbsp;&nbsp;<span class="comment" id="2085618">//&nbsp;0x3ED0CFCA86E65239</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085642">Q5</span>&nbsp;<span class="op" id="2085645">=</span>&nbsp;<span class="op" id="2085647">-</span><span class="num" id="2085648">2.01099218183624371326e-07</span>&nbsp;<span class="comment" id="2085675">//&nbsp;0xBE8AFDB76E09C32D</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2085698">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2085702">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085720">switch</span>&nbsp;<span class="op" id="2085727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085730">case</span>&nbsp;<span class="ident" id="2085735">IsInf</span><span class="op" id="2085740">(</span><span class="ident" id="2085741">x</span><span class="op" id="2085742">,</span>&nbsp;<span class="num" id="2085744">1</span><span class="op" id="2085745">)</span>&nbsp;<span class="op" id="2085747">||</span>&nbsp;<span class="ident" id="2085750">IsNaN</span><span class="op" id="2085755">(</span><span class="ident" id="2085756">x</span><span class="op" id="2085757">)</span><span class="op" id="2085758">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085762">return</span>&nbsp;<span class="ident" id="2085769">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085772">case</span>&nbsp;<span class="ident" id="2085777">IsInf</span><span class="op" id="2085782">(</span><span class="ident" id="2085783">x</span><span class="op" id="2085784">,</span>&nbsp;<span class="op" id="2085786">-</span><span class="num" id="2085787">1</span><span class="op" id="2085788">)</span><span class="op" id="2085789">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085793">return</span>&nbsp;<span class="op" id="2085800">-</span><span class="num" id="2085801">1</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2085804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085808">absx</span>&nbsp;<span class="op" id="2085813">:=</span>&nbsp;<span class="ident" id="2085816">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085819">sign</span>&nbsp;<span class="op" id="2085824">:=</span>&nbsp;<span class="builtintype" id="2085827">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085834">if</span>&nbsp;<span class="ident" id="2085837">x</span>&nbsp;<span class="op" id="2085839">&lt;</span>&nbsp;<span class="num" id="2085841">0</span>&nbsp;<span class="op" id="2085843">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085847">absx</span>&nbsp;<span class="op" id="2085852">=</span>&nbsp;<span class="op" id="2085854">-</span><span class="ident" id="2085855">absx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2085862">sign</span>&nbsp;<span class="op" id="2085867">=</span>&nbsp;<span class="builtintype" id="2085869">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2085875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2085879">//&nbsp;filter&nbsp;out&nbsp;huge&nbsp;argument</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085908">if</span>&nbsp;<span class="ident" id="2085911">absx</span>&nbsp;<span class="op" id="2085916">&gt;=</span>&nbsp;<span class="ident" id="2085919">Ln2X56</span>&nbsp;<span class="op" id="2085926">{</span>&nbsp;<span class="comment" id="2085928">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;56&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2085952">if</span>&nbsp;<span class="ident" id="2085955">absx</span>&nbsp;<span class="op" id="2085960">&gt;=</span>&nbsp;<span class="ident" id="2085963">Othreshold</span>&nbsp;<span class="op" id="2085974">{</span>&nbsp;<span class="comment" id="2085976">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;709.78...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086002">return</span>&nbsp;<span class="ident" id="2086009">Inf</span><span class="op" id="2086012">(</span><span class="num" id="2086013">1</span><span class="op" id="2086014">)</span>&nbsp;<span class="comment" id="2086016">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086034">if</span>&nbsp;<span class="ident" id="2086037">sign</span>&nbsp;<span class="op" id="2086042">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086047">return</span>&nbsp;<span class="op" id="2086054">-</span><span class="num" id="2086055">1</span>&nbsp;<span class="comment" id="2086057">//&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2086094">//&nbsp;argument&nbsp;reduction</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086117">var</span>&nbsp;<span class="ident" id="2086121">c</span>&nbsp;<span class="builtintype" id="2086123">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086132">var</span>&nbsp;<span class="ident" id="2086136">k</span>&nbsp;<span class="builtintype" id="2086138">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086143">if</span>&nbsp;<span class="ident" id="2086146">absx</span>&nbsp;<span class="op" id="2086151">&gt;</span>&nbsp;<span class="ident" id="2086153">Ln2Half</span>&nbsp;<span class="op" id="2086161">{</span>&nbsp;<span class="comment" id="2086163">//&nbsp;if&nbsp;&nbsp;|x|&nbsp;&gt;&nbsp;0.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086188">var</span>&nbsp;<span class="ident" id="2086192">hi</span><span class="op" id="2086194">,</span>&nbsp;<span class="ident" id="2086196">lo</span>&nbsp;<span class="builtintype" id="2086199">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086209">if</span>&nbsp;<span class="ident" id="2086212">absx</span>&nbsp;<span class="op" id="2086217">&lt;</span>&nbsp;<span class="ident" id="2086219">Ln2HalfX3</span>&nbsp;<span class="op" id="2086229">{</span>&nbsp;<span class="comment" id="2086231">//&nbsp;and&nbsp;|x|&nbsp;&lt;&nbsp;1.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086257">if</span>&nbsp;<span class="op" id="2086260">!</span><span class="ident" id="2086261">sign</span>&nbsp;<span class="op" id="2086266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086272">hi</span>&nbsp;<span class="op" id="2086275">=</span>&nbsp;<span class="ident" id="2086277">x</span>&nbsp;<span class="op" id="2086279">-</span>&nbsp;<span class="ident" id="2086281">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086291">lo</span>&nbsp;<span class="op" id="2086294">=</span>&nbsp;<span class="ident" id="2086296">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086306">k</span>&nbsp;<span class="op" id="2086308">=</span>&nbsp;<span class="num" id="2086310">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086315">}</span>&nbsp;<span class="keyword" id="2086317">else</span>&nbsp;<span class="op" id="2086322">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086328">hi</span>&nbsp;<span class="op" id="2086331">=</span>&nbsp;<span class="ident" id="2086333">x</span>&nbsp;<span class="op" id="2086335">+</span>&nbsp;<span class="ident" id="2086337">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086347">lo</span>&nbsp;<span class="op" id="2086350">=</span>&nbsp;<span class="op" id="2086352">-</span><span class="ident" id="2086353">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086363">k</span>&nbsp;<span class="op" id="2086365">=</span>&nbsp;<span class="op" id="2086367">-</span><span class="num" id="2086368">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086377">}</span>&nbsp;<span class="keyword" id="2086379">else</span>&nbsp;<span class="op" id="2086384">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086389">if</span>&nbsp;<span class="op" id="2086392">!</span><span class="ident" id="2086393">sign</span>&nbsp;<span class="op" id="2086398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086404">k</span>&nbsp;<span class="op" id="2086406">=</span>&nbsp;<span class="builtintype" id="2086408">int</span><span class="op" id="2086411">(</span><span class="ident" id="2086412">InvLn2</span><span class="op" id="2086418">*</span><span class="ident" id="2086419">x</span>&nbsp;<span class="op" id="2086421">+</span>&nbsp;<span class="num" id="2086423">0.5</span><span class="op" id="2086426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086431">}</span>&nbsp;<span class="keyword" id="2086433">else</span>&nbsp;<span class="op" id="2086438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086444">k</span>&nbsp;<span class="op" id="2086446">=</span>&nbsp;<span class="builtintype" id="2086448">int</span><span class="op" id="2086451">(</span><span class="ident" id="2086452">InvLn2</span><span class="op" id="2086458">*</span><span class="ident" id="2086459">x</span>&nbsp;<span class="op" id="2086461">-</span>&nbsp;<span class="num" id="2086463">0.5</span><span class="op" id="2086466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086471">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086476">t</span>&nbsp;<span class="op" id="2086478">:=</span>&nbsp;<span class="builtintype" id="2086481">float64</span><span class="op" id="2086488">(</span><span class="ident" id="2086489">k</span><span class="op" id="2086490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086495">hi</span>&nbsp;<span class="op" id="2086498">=</span>&nbsp;<span class="ident" id="2086500">x</span>&nbsp;<span class="op" id="2086502">-</span>&nbsp;<span class="ident" id="2086504">t</span><span class="op" id="2086505">*</span><span class="ident" id="2086506">Ln2Hi</span>&nbsp;<span class="comment" id="2086512">//&nbsp;t&nbsp;*&nbsp;Ln2Hi&nbsp;is&nbsp;exact&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086542">lo</span>&nbsp;<span class="op" id="2086545">=</span>&nbsp;<span class="ident" id="2086547">t</span>&nbsp;<span class="op" id="2086549">*</span>&nbsp;<span class="ident" id="2086551">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086563">x</span>&nbsp;<span class="op" id="2086565">=</span>&nbsp;<span class="ident" id="2086567">hi</span>&nbsp;<span class="op" id="2086570">-</span>&nbsp;<span class="ident" id="2086572">lo</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086577">c</span>&nbsp;<span class="op" id="2086579">=</span>&nbsp;<span class="op" id="2086581">(</span><span class="ident" id="2086582">hi</span>&nbsp;<span class="op" id="2086585">-</span>&nbsp;<span class="ident" id="2086587">x</span><span class="op" id="2086588">)</span>&nbsp;<span class="op" id="2086590">-</span>&nbsp;<span class="ident" id="2086592">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086596">}</span>&nbsp;<span class="keyword" id="2086598">else</span>&nbsp;<span class="keyword" id="2086603">if</span>&nbsp;<span class="ident" id="2086606">absx</span>&nbsp;<span class="op" id="2086611">&lt;</span>&nbsp;<span class="ident" id="2086613">Tiny</span>&nbsp;<span class="op" id="2086618">{</span>&nbsp;<span class="comment" id="2086620">//&nbsp;when&nbsp;|x|&nbsp;&lt;&nbsp;2**-54,&nbsp;return&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086653">return</span>&nbsp;<span class="ident" id="2086660">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086663">}</span>&nbsp;<span class="keyword" id="2086665">else</span>&nbsp;<span class="op" id="2086670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086674">k</span>&nbsp;<span class="op" id="2086676">=</span>&nbsp;<span class="num" id="2086678">0</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2086681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2086685">//&nbsp;x&nbsp;is&nbsp;now&nbsp;in&nbsp;primary&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086715">hfx</span>&nbsp;<span class="op" id="2086719">:=</span>&nbsp;<span class="num" id="2086722">0.5</span>&nbsp;<span class="op" id="2086726">*</span>&nbsp;<span class="ident" id="2086728">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086731">hxs</span>&nbsp;<span class="op" id="2086735">:=</span>&nbsp;<span class="ident" id="2086738">x</span>&nbsp;<span class="op" id="2086740">*</span>&nbsp;<span class="ident" id="2086742">hfx</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086747">r1</span>&nbsp;<span class="op" id="2086750">:=</span>&nbsp;<span class="num" id="2086753">1</span>&nbsp;<span class="op" id="2086755">+</span>&nbsp;<span class="ident" id="2086757">hxs</span><span class="op" id="2086760">*</span><span class="op" id="2086761">(</span><span class="ident" id="2086762">Q1</span><span class="op" id="2086764">+</span><span class="ident" id="2086765">hxs</span><span class="op" id="2086768">*</span><span class="op" id="2086769">(</span><span class="ident" id="2086770">Q2</span><span class="op" id="2086772">+</span><span class="ident" id="2086773">hxs</span><span class="op" id="2086776">*</span><span class="op" id="2086777">(</span><span class="ident" id="2086778">Q3</span><span class="op" id="2086780">+</span><span class="ident" id="2086781">hxs</span><span class="op" id="2086784">*</span><span class="op" id="2086785">(</span><span class="ident" id="2086786">Q4</span><span class="op" id="2086788">+</span><span class="ident" id="2086789">hxs</span><span class="op" id="2086792">*</span><span class="ident" id="2086793">Q5</span><span class="op" id="2086795">)</span><span class="op" id="2086796">)</span><span class="op" id="2086797">)</span><span class="op" id="2086798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086801">t</span>&nbsp;<span class="op" id="2086803">:=</span>&nbsp;<span class="num" id="2086806">3</span>&nbsp;<span class="op" id="2086808">-</span>&nbsp;<span class="ident" id="2086810">r1</span><span class="op" id="2086812">*</span><span class="ident" id="2086813">hfx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086818">e</span>&nbsp;<span class="op" id="2086820">:=</span>&nbsp;<span class="ident" id="2086823">hxs</span>&nbsp;<span class="op" id="2086827">*</span>&nbsp;<span class="op" id="2086829">(</span><span class="op" id="2086830">(</span><span class="ident" id="2086831">r1</span>&nbsp;<span class="op" id="2086834">-</span>&nbsp;<span class="ident" id="2086836">t</span><span class="op" id="2086837">)</span>&nbsp;<span class="op" id="2086839">/</span>&nbsp;<span class="op" id="2086841">(</span><span class="num" id="2086842">6.0</span>&nbsp;<span class="op" id="2086846">-</span>&nbsp;<span class="ident" id="2086848">x</span><span class="op" id="2086849">*</span><span class="ident" id="2086850">t</span><span class="op" id="2086851">)</span><span class="op" id="2086852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086855">if</span>&nbsp;<span class="ident" id="2086858">k</span>&nbsp;<span class="op" id="2086860">!=</span>&nbsp;<span class="num" id="2086863">0</span>&nbsp;<span class="op" id="2086865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086869">e</span>&nbsp;<span class="op" id="2086871">=</span>&nbsp;<span class="op" id="2086873">(</span><span class="ident" id="2086874">x</span><span class="op" id="2086875">*</span><span class="op" id="2086876">(</span><span class="ident" id="2086877">e</span><span class="op" id="2086878">-</span><span class="ident" id="2086879">c</span><span class="op" id="2086880">)</span>&nbsp;<span class="op" id="2086882">-</span>&nbsp;<span class="ident" id="2086884">c</span><span class="op" id="2086885">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2086889">e</span>&nbsp;<span class="op" id="2086891">-=</span>&nbsp;<span class="ident" id="2086894">hxs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086900">switch</span>&nbsp;<span class="op" id="2086907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086911">case</span>&nbsp;<span class="ident" id="2086916">k</span>&nbsp;<span class="op" id="2086918">==</span>&nbsp;<span class="op" id="2086921">-</span><span class="num" id="2086922">1</span><span class="op" id="2086923">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086928">return</span>&nbsp;<span class="num" id="2086935">0.5</span><span class="op" id="2086938">*</span><span class="op" id="2086939">(</span><span class="ident" id="2086940">x</span><span class="op" id="2086941">-</span><span class="ident" id="2086942">e</span><span class="op" id="2086943">)</span>&nbsp;<span class="op" id="2086945">-</span>&nbsp;<span class="num" id="2086947">0.5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086953">case</span>&nbsp;<span class="ident" id="2086958">k</span>&nbsp;<span class="op" id="2086960">==</span>&nbsp;<span class="num" id="2086963">1</span><span class="op" id="2086964">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086969">if</span>&nbsp;<span class="ident" id="2086972">x</span>&nbsp;<span class="op" id="2086974">&lt;</span>&nbsp;<span class="op" id="2086976">-</span><span class="num" id="2086977">0.25</span>&nbsp;<span class="op" id="2086982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2086988">return</span>&nbsp;<span class="op" id="2086995">-</span><span class="num" id="2086996">2</span>&nbsp;<span class="op" id="2086998">*</span>&nbsp;<span class="op" id="2087000">(</span><span class="ident" id="2087001">e</span>&nbsp;<span class="op" id="2087003">-</span>&nbsp;<span class="op" id="2087005">(</span><span class="ident" id="2087006">x</span>&nbsp;<span class="op" id="2087008">+</span>&nbsp;<span class="num" id="2087010">0.5</span><span class="op" id="2087013">)</span><span class="op" id="2087014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087024">return</span>&nbsp;<span class="num" id="2087031">1</span>&nbsp;<span class="op" id="2087033">+</span>&nbsp;<span class="num" id="2087035">2</span><span class="op" id="2087036">*</span><span class="op" id="2087037">(</span><span class="ident" id="2087038">x</span><span class="op" id="2087039">-</span><span class="ident" id="2087040">e</span><span class="op" id="2087041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087045">case</span>&nbsp;<span class="ident" id="2087050">k</span>&nbsp;<span class="op" id="2087052">&lt;=</span>&nbsp;<span class="op" id="2087055">-</span><span class="num" id="2087056">2</span>&nbsp;<span class="op" id="2087058">||</span>&nbsp;<span class="ident" id="2087061">k</span>&nbsp;<span class="op" id="2087063">&gt;</span>&nbsp;<span class="num" id="2087065">56</span><span class="op" id="2087067">:</span>&nbsp;<span class="comment" id="2087069">//&nbsp;suffice&nbsp;to&nbsp;return&nbsp;exp(x)-1</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087102">y</span>&nbsp;<span class="op" id="2087104">:=</span>&nbsp;<span class="num" id="2087107">1</span>&nbsp;<span class="op" id="2087109">-</span>&nbsp;<span class="op" id="2087111">(</span><span class="ident" id="2087112">e</span>&nbsp;<span class="op" id="2087114">-</span>&nbsp;<span class="ident" id="2087116">x</span><span class="op" id="2087117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087122">y</span>&nbsp;<span class="op" id="2087124">=</span>&nbsp;<span class="ident" id="2087126">Float64frombits</span><span class="op" id="2087141">(</span><span class="ident" id="2087142">Float64bits</span><span class="op" id="2087153">(</span><span class="ident" id="2087154">y</span><span class="op" id="2087155">)</span>&nbsp;<span class="op" id="2087157">+</span>&nbsp;<span class="ident" id="2087159">uint64</span><span class="op" id="2087165">(</span><span class="ident" id="2087166">k</span><span class="op" id="2087167">)</span><span class="op" id="2087168">&lt;&lt;</span><span class="num" id="2087170">52</span><span class="op" id="2087172">)</span>&nbsp;<span class="comment" id="2087174">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087202">return</span>&nbsp;<span class="ident" id="2087209">y</span>&nbsp;<span class="op" id="2087211">-</span>&nbsp;<span class="num" id="2087213">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087221">if</span>&nbsp;<span class="ident" id="2087224">k</span>&nbsp;<span class="op" id="2087226">&lt;</span>&nbsp;<span class="num" id="2087228">20</span>&nbsp;<span class="op" id="2087231">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087236">t</span>&nbsp;<span class="op" id="2087238">:=</span>&nbsp;<span class="ident" id="2087241">Float64frombits</span><span class="op" id="2087256">(</span><span class="num" id="2087257">0x3ff0000000000000</span>&nbsp;<span class="op" id="2087276">-</span>&nbsp;<span class="op" id="2087278">(</span><span class="num" id="2087279">0x20000000000000</span>&nbsp;<span class="op" id="2087296">&gt;&gt;</span>&nbsp;<span class="builtintype" id="2087299">uint</span><span class="op" id="2087303">(</span><span class="ident" id="2087304">k</span><span class="op" id="2087305">)</span><span class="op" id="2087306">)</span><span class="op" id="2087307">)</span>&nbsp;<span class="comment" id="2087309">//&nbsp;t=1-2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087325">y</span>&nbsp;<span class="op" id="2087327">:=</span>&nbsp;<span class="ident" id="2087330">t</span>&nbsp;<span class="op" id="2087332">-</span>&nbsp;<span class="op" id="2087334">(</span><span class="ident" id="2087335">e</span>&nbsp;<span class="op" id="2087337">-</span>&nbsp;<span class="ident" id="2087339">x</span><span class="op" id="2087340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087345">y</span>&nbsp;<span class="op" id="2087347">=</span>&nbsp;<span class="ident" id="2087349">Float64frombits</span><span class="op" id="2087364">(</span><span class="ident" id="2087365">Float64bits</span><span class="op" id="2087376">(</span><span class="ident" id="2087377">y</span><span class="op" id="2087378">)</span>&nbsp;<span class="op" id="2087380">+</span>&nbsp;<span class="ident" id="2087382">uint64</span><span class="op" id="2087388">(</span><span class="ident" id="2087389">k</span><span class="op" id="2087390">)</span><span class="op" id="2087391">&lt;&lt;</span><span class="num" id="2087393">52</span><span class="op" id="2087395">)</span>&nbsp;<span class="comment" id="2087397">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087425">return</span>&nbsp;<span class="ident" id="2087432">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087436">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087440">t</span>&nbsp;<span class="op" id="2087442">:=</span>&nbsp;<span class="ident" id="2087445">Float64frombits</span><span class="op" id="2087460">(</span><span class="ident" id="2087461">uint64</span><span class="op" id="2087467">(</span><span class="op" id="2087468">(</span><span class="num" id="2087469">0x3ff</span>&nbsp;<span class="op" id="2087475">-</span>&nbsp;<span class="ident" id="2087477">k</span><span class="op" id="2087478">)</span>&nbsp;<span class="op" id="2087480">&lt;&lt;</span>&nbsp;<span class="num" id="2087483">52</span><span class="op" id="2087485">)</span><span class="op" id="2087486">)</span>&nbsp;<span class="comment" id="2087488">//&nbsp;2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087499">y</span>&nbsp;<span class="op" id="2087501">:=</span>&nbsp;<span class="ident" id="2087504">x</span>&nbsp;<span class="op" id="2087506">-</span>&nbsp;<span class="op" id="2087508">(</span><span class="ident" id="2087509">e</span>&nbsp;<span class="op" id="2087511">+</span>&nbsp;<span class="ident" id="2087513">t</span><span class="op" id="2087514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087518">y</span>&nbsp;<span class="op" id="2087520">+=</span>&nbsp;<span class="num" id="2087523">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2087527">y</span>&nbsp;<span class="op" id="2087529">=</span>&nbsp;<span class="ident" id="2087531">Float64frombits</span><span class="op" id="2087546">(</span><span class="ident" id="2087547">Float64bits</span><span class="op" id="2087558">(</span><span class="ident" id="2087559">y</span><span class="op" id="2087560">)</span>&nbsp;<span class="op" id="2087562">+</span>&nbsp;<span class="ident" id="2087564">uint64</span><span class="op" id="2087570">(</span><span class="ident" id="2087571">k</span><span class="op" id="2087572">)</span><span class="op" id="2087573">&lt;&lt;</span><span class="num" id="2087575">52</span><span class="op" id="2087577">)</span>&nbsp;<span class="comment" id="2087579">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087606">return</span>&nbsp;<span class="ident" id="2087613">y</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2087616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2087619">return</span>&nbsp;<span class="ident" id="2087626">x</span>&nbsp;<span class="op" id="2087628">-</span>&nbsp;<span class="op" id="2087630">(</span><span class="ident" id="2087631">x</span><span class="op" id="2087632">*</span><span class="ident" id="2087633">e</span>&nbsp;<span class="op" id="2087635">-</span>&nbsp;<span class="ident" id="2087637">hxs</span><span class="op" id="2087640">)</span>&nbsp;<span class="comment" id="2087642">//&nbsp;c&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="op" id="2087652">}</span>
</div>
</body>
</html>
