<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html" class="current">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4844009">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4844064">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4844118">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4844169">//&nbsp;Package&nbsp;ascii85&nbsp;implements&nbsp;the&nbsp;ascii85&nbsp;data&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="4844225">//&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;btoa&nbsp;tool&nbsp;and&nbsp;Adobe&#39;s&nbsp;PostScript&nbsp;and&nbsp;PDF&nbsp;document&nbsp;formats.</span><br>
<span class="lineno"></span><span class="keyword" id="4844302">package</span>&nbsp;<span class="ident" id="4844310">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4844319">import</span>&nbsp;<span class="op" id="4844326">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4844329">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4844335">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="4844345">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4844348">/*<br>
<span class="lineno">15</span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4844367">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;into&nbsp;at&nbsp;most&nbsp;MaxEncodedLen(len(src))</span><br>
<span class="lineno"></span><span class="comment" id="4844426">//&nbsp;bytes&nbsp;of&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;actual&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">20</span><span class="comment" id="4844489">//</span><br>
<span class="lineno"></span><span class="comment" id="4844492">//&nbsp;The&nbsp;encoding&nbsp;handles&nbsp;4-byte&nbsp;chunks,&nbsp;using&nbsp;a&nbsp;special&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="4844556">//&nbsp;for&nbsp;the&nbsp;last&nbsp;fragment,&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="4844622">//&nbsp;individual&nbsp;blocks&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="4844694">//</span><br>
<span class="lineno">25</span><span class="comment" id="4844697">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="4844761">//&nbsp;Encode&nbsp;does&nbsp;not&nbsp;add&nbsp;these.</span><br>
<span class="lineno"></span><span class="keyword" id="4844791">func</span>&nbsp;<span class="ident" id="4844796">Encode</span><span class="op" id="4844802">(</span><span class="ident" id="4844803">dst</span><span class="op" id="4844806">,</span>&nbsp;<span class="ident" id="4844808">src</span>&nbsp;<span class="op" id="4844812">[</span><span class="op" id="4844813">]</span><span class="builtintype" id="4844814">byte</span><span class="op" id="4844818">)</span>&nbsp;<span class="builtintype" id="4844820">int</span>&nbsp;<span class="op" id="4844824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4844827">if</span>&nbsp;<span class="builtinfunc" id="4844830">len</span><span class="op" id="4844833">(</span><span class="ident" id="4844834">src</span><span class="op" id="4844837">)</span>&nbsp;<span class="op" id="4844839">==</span>&nbsp;<span class="num" id="4844842">0</span>&nbsp;<span class="op" id="4844844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4844848">return</span>&nbsp;<span class="num" id="4844855">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4844858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4844862">n</span>&nbsp;<span class="op" id="4844864">:=</span>&nbsp;<span class="num" id="4844867">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4844870">for</span>&nbsp;<span class="builtinfunc" id="4844874">len</span><span class="op" id="4844877">(</span><span class="ident" id="4844878">src</span><span class="op" id="4844881">)</span>&nbsp;<span class="op" id="4844883">&gt;</span>&nbsp;<span class="num" id="4844885">0</span>&nbsp;<span class="op" id="4844887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4844891">dst</span><span class="op" id="4844894">[</span><span class="num" id="4844895">0</span><span class="op" id="4844896">]</span>&nbsp;<span class="op" id="4844898">=</span>&nbsp;<span class="num" id="4844900">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4844904">dst</span><span class="op" id="4844907">[</span><span class="num" id="4844908">1</span><span class="op" id="4844909">]</span>&nbsp;<span class="op" id="4844911">=</span>&nbsp;<span class="num" id="4844913">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4844917">dst</span><span class="op" id="4844920">[</span><span class="num" id="4844921">2</span><span class="op" id="4844922">]</span>&nbsp;<span class="op" id="4844924">=</span>&nbsp;<span class="num" id="4844926">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4844930">dst</span><span class="op" id="4844933">[</span><span class="num" id="4844934">3</span><span class="op" id="4844935">]</span>&nbsp;<span class="op" id="4844937">=</span>&nbsp;<span class="num" id="4844939">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4844943">dst</span><span class="op" id="4844946">[</span><span class="num" id="4844947">4</span><span class="op" id="4844948">]</span>&nbsp;<span class="op" id="4844950">=</span>&nbsp;<span class="num" id="4844952">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4844957">//&nbsp;Unpack&nbsp;4&nbsp;bytes&nbsp;into&nbsp;uint32&nbsp;to&nbsp;repack&nbsp;into&nbsp;base&nbsp;85&nbsp;5-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4845020">var</span>&nbsp;<span class="ident" id="4845024">v</span>&nbsp;<span class="builtintype" id="4845026">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4845035">switch</span>&nbsp;<span class="builtinfunc" id="4845042">len</span><span class="op" id="4845045">(</span><span class="ident" id="4845046">src</span><span class="op" id="4845049">)</span>&nbsp;<span class="op" id="4845051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4845055">default</span><span class="op" id="4845062">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4845067">v</span>&nbsp;<span class="op" id="4845069">|=</span>&nbsp;<span class="builtintype" id="4845072">uint32</span><span class="op" id="4845078">(</span><span class="ident" id="4845079">src</span><span class="op" id="4845082">[</span><span class="num" id="4845083">3</span><span class="op" id="4845084">]</span><span class="op" id="4845085">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4845090">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4845104">case</span>&nbsp;<span class="num" id="4845109">3</span><span class="op" id="4845110">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4845115">v</span>&nbsp;<span class="op" id="4845117">|=</span>&nbsp;<span class="builtintype" id="4845120">uint32</span><span class="op" id="4845126">(</span><span class="ident" id="4845127">src</span><span class="op" id="4845130">[</span><span class="num" id="4845131">2</span><span class="op" id="4845132">]</span><span class="op" id="4845133">)</span>&nbsp;<span class="op" id="4845135">&lt;&lt;</span>&nbsp;<span class="num" id="4845138">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4845143">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4845157">case</span>&nbsp;<span class="num" id="4845162">2</span><span class="op" id="4845163">:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4845168">v</span>&nbsp;<span class="op" id="4845170">|=</span>&nbsp;<span class="builtintype" id="4845173">uint32</span><span class="op" id="4845179">(</span><span class="ident" id="4845180">src</span><span class="op" id="4845183">[</span><span class="num" id="4845184">1</span><span class="op" id="4845185">]</span><span class="op" id="4845186">)</span>&nbsp;<span class="op" id="4845188">&lt;&lt;</span>&nbsp;<span class="num" id="4845191">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4845197">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4845211">case</span>&nbsp;<span class="num" id="4845216">1</span><span class="op" id="4845217">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4845222">v</span>&nbsp;<span class="op" id="4845224">|=</span>&nbsp;<span class="builtintype" id="4845227">uint32</span><span class="op" id="4845233">(</span><span class="ident" id="4845234">src</span><span class="op" id="4845237">[</span><span class="num" id="4845238">0</span><span class="op" id="4845239">]</span><span class="op" id="4845240">)</span>&nbsp;<span class="op" id="4845242">&lt;&lt;</span>&nbsp;<span class="num" id="4845245">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4845250">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4845255">//&nbsp;Special&nbsp;case:&nbsp;zero&nbsp;(!!!!!)&nbsp;shortens&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4845302">if</span>&nbsp;<span class="ident" id="4845305">v</span>&nbsp;<span class="op" id="4845307">==</span>&nbsp;<span class="num" id="4845310">0</span>&nbsp;<span class="op" id="4845312">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4845315">len</span><span class="op" id="4845318">(</span><span class="ident" id="4845319">src</span><span class="op" id="4845322">)</span>&nbsp;<span class="op" id="4845324">&gt;=</span>&nbsp;<span class="num" id="4845327">4</span>&nbsp;<span class="op" id="4845329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4845334">dst</span><span class="op" id="4845337">[</span><span class="num" id="4845338">0</span><span class="op" id="4845339">]</span>&nbsp;<span class="op" id="4845341">=</span>&nbsp;<span class="string" id="4845343">&#39;z&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4845350">dst</span>&nbsp;<span class="op" id="4845354">=</span>&nbsp;<span class="ident" id="4845356">dst</span><span class="op" id="4845359">[</span><span class="num" id="4845360">1</span><span class="op" id="4845361">:</span><span class="op" id="4845362">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4845367">src</span>&nbsp;<span class="op" id="4845371">=</span>&nbsp;<span class="ident" id="4845373">src</span><span class="op" id="4845376">[</span><span class="num" id="4845377">4</span><span class="op" id="4845378">:</span><span class="op" id="4845379">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4845384">n</span><span class="op" id="4845385">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4845391">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4845402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4845407">//&nbsp;Otherwise,&nbsp;5&nbsp;base&nbsp;85&nbsp;digits&nbsp;starting&nbsp;at&nbsp;!.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4845455">for</span>&nbsp;<span class="ident" id="4845459">i</span>&nbsp;<span class="op" id="4845461">:=</span>&nbsp;<span class="num" id="4845464">4</span><span class="op" id="4845465">;</span>&nbsp;<span class="ident" id="4845467">i</span>&nbsp;<span class="op" id="4845469">&gt;=</span>&nbsp;<span class="num" id="4845472">0</span><span class="op" id="4845473">;</span>&nbsp;<span class="ident" id="4845475">i</span><span class="op" id="4845476">--</span>&nbsp;<span class="op" id="4845479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4845484">dst</span><span class="op" id="4845487">[</span><span class="ident" id="4845488">i</span><span class="op" id="4845489">]</span>&nbsp;<span class="op" id="4845491">=</span>&nbsp;<span class="string" id="4845493">&#39;!&#39;</span>&nbsp;<span class="op" id="4845497">+</span>&nbsp;<span class="builtintype" id="4845499">byte</span><span class="op" id="4845503">(</span><span class="ident" id="4845504">v</span><span class="op" id="4845505">%</span><span class="num" id="4845506">85</span><span class="op" id="4845508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4845513">v</span>&nbsp;<span class="op" id="4845515">/=</span>&nbsp;<span class="num" id="4845518">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4845523">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4845528">//&nbsp;If&nbsp;src&nbsp;was&nbsp;short,&nbsp;discard&nbsp;the&nbsp;low&nbsp;destination&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4845586">m</span>&nbsp;<span class="op" id="4845588">:=</span>&nbsp;<span class="num" id="4845591">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4845595">if</span>&nbsp;<span class="builtinfunc" id="4845598">len</span><span class="op" id="4845601">(</span><span class="ident" id="4845602">src</span><span class="op" id="4845605">)</span>&nbsp;<span class="op" id="4845607">&lt;</span>&nbsp;<span class="num" id="4845609">4</span>&nbsp;<span class="op" id="4845611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4845616">m</span>&nbsp;<span class="op" id="4845618">-=</span>&nbsp;<span class="num" id="4845621">4</span>&nbsp;<span class="op" id="4845623">-</span>&nbsp;<span class="builtinfunc" id="4845625">len</span><span class="op" id="4845628">(</span><span class="ident" id="4845629">src</span><span class="op" id="4845632">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4845637">src</span>&nbsp;<span class="op" id="4845641">=</span>&nbsp;<span class="builtintype" id="4845643">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4845649">}</span>&nbsp;<span class="keyword" id="4845651">else</span>&nbsp;<span class="op" id="4845656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4845661">src</span>&nbsp;<span class="op" id="4845665">=</span>&nbsp;<span class="ident" id="4845667">src</span><span class="op" id="4845670">[</span><span class="num" id="4845671">4</span><span class="op" id="4845672">:</span><span class="op" id="4845673">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4845677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4845681">dst</span>&nbsp;<span class="op" id="4845685">=</span>&nbsp;<span class="ident" id="4845687">dst</span><span class="op" id="4845690">[</span><span class="ident" id="4845691">m</span><span class="op" id="4845692">:</span><span class="op" id="4845693">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4845697">n</span>&nbsp;<span class="op" id="4845699">+=</span>&nbsp;<span class="ident" id="4845702">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4845705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4845708">return</span>&nbsp;<span class="ident" id="4845715">n</span><br>
<span class="lineno"></span><span class="op" id="4845717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="4845720">//&nbsp;MaxEncodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;an&nbsp;encoding&nbsp;of&nbsp;n&nbsp;source&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4845798">func</span>&nbsp;<span class="ident" id="4845803">MaxEncodedLen</span><span class="op" id="4845816">(</span><span class="ident" id="4845817">n</span>&nbsp;<span class="builtintype" id="4845819">int</span><span class="op" id="4845822">)</span>&nbsp;<span class="builtintype" id="4845824">int</span>&nbsp;<span class="op" id="4845828">{</span>&nbsp;<span class="keyword" id="4845830">return</span>&nbsp;<span class="op" id="4845837">(</span><span class="ident" id="4845838">n</span>&nbsp;<span class="op" id="4845840">+</span>&nbsp;<span class="num" id="4845842">3</span><span class="op" id="4845843">)</span>&nbsp;<span class="op" id="4845845">/</span>&nbsp;<span class="num" id="4845847">4</span>&nbsp;<span class="op" id="4845849">*</span>&nbsp;<span class="num" id="4845851">5</span>&nbsp;<span class="op" id="4845853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4845856">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4845925">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">90</span><span class="comment" id="4845987">//&nbsp;Ascii85&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;32-bit&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="4846048">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="4846116">//&nbsp;trailing&nbsp;partial&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="4846143">func</span>&nbsp;<span class="ident" id="4846148">NewEncoder</span><span class="op" id="4846158">(</span><span class="ident" id="4846159">w</span>&nbsp;<span class="ident" id="4846161">io</span><span class="op" id="4846163">.</span><span class="ident" id="4846164">Writer</span><span class="op" id="4846170">)</span>&nbsp;<span class="ident" id="4846172">io</span><span class="op" id="4846174">.</span><span class="ident" id="4846175">WriteCloser</span>&nbsp;<span class="op" id="4846187">{</span>&nbsp;<span class="keyword" id="4846189">return</span>&nbsp;<span class="op" id="4846196">&amp;</span><span class="ident" id="4846197">encoder</span><span class="op" id="4846204">{</span><span class="ident" id="4846205">w</span><span class="op" id="4846206">:</span>&nbsp;<span class="ident" id="4846208">w</span><span class="op" id="4846209">}</span>&nbsp;<span class="op" id="4846211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4846214">type</span>&nbsp;<span class="ident" id="4846219">encoder</span>&nbsp;<span class="keyword" id="4846227">struct</span>&nbsp;<span class="op" id="4846234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4846237">err</span>&nbsp;&nbsp;<span class="builtintype" id="4846242">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4846249">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4846254">io</span><span class="op" id="4846256">.</span><span class="ident" id="4846257">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4846265">buf</span>&nbsp;&nbsp;<span class="op" id="4846270">[</span><span class="num" id="4846271">4</span><span class="op" id="4846272">]</span><span class="builtintype" id="4846273">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4846281">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4846321">nbuf</span>&nbsp;<span class="builtintype" id="4846326">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4846337">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4846364">out</span>&nbsp;&nbsp;<span class="op" id="4846369">[</span><span class="num" id="4846370">1024</span><span class="op" id="4846374">]</span><span class="builtintype" id="4846375">byte</span>&nbsp;<span class="comment" id="4846380">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="4846397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4846400">func</span>&nbsp;<span class="op" id="4846405">(</span><span class="ident" id="4846406">e</span>&nbsp;<span class="op" id="4846408">*</span><span class="ident" id="4846409">encoder</span><span class="op" id="4846416">)</span>&nbsp;<span class="ident" id="4846418">Write</span><span class="op" id="4846423">(</span><span class="ident" id="4846424">p</span>&nbsp;<span class="op" id="4846426">[</span><span class="op" id="4846427">]</span><span class="builtintype" id="4846428">byte</span><span class="op" id="4846432">)</span>&nbsp;<span class="op" id="4846434">(</span><span class="ident" id="4846435">n</span>&nbsp;<span class="builtintype" id="4846437">int</span><span class="op" id="4846440">,</span>&nbsp;<span class="ident" id="4846442">err</span>&nbsp;<span class="builtintype" id="4846446">error</span><span class="op" id="4846451">)</span>&nbsp;<span class="op" id="4846453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4846456">if</span>&nbsp;<span class="ident" id="4846459">e</span><span class="op" id="4846460">.</span><span class="ident" id="4846461">err</span>&nbsp;<span class="op" id="4846465">!=</span>&nbsp;<span class="builtintype" id="4846468">nil</span>&nbsp;<span class="op" id="4846472">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4846476">return</span>&nbsp;<span class="num" id="4846483">0</span><span class="op" id="4846484">,</span>&nbsp;<span class="ident" id="4846486">e</span><span class="op" id="4846487">.</span><span class="ident" id="4846488">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4846493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4846497">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4846517">if</span>&nbsp;<span class="ident" id="4846520">e</span><span class="op" id="4846521">.</span><span class="ident" id="4846522">nbuf</span>&nbsp;<span class="op" id="4846527">&gt;</span>&nbsp;<span class="num" id="4846529">0</span>&nbsp;<span class="op" id="4846531">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4846535">var</span>&nbsp;<span class="ident" id="4846539">i</span>&nbsp;<span class="builtintype" id="4846541">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4846547">for</span>&nbsp;<span class="ident" id="4846551">i</span>&nbsp;<span class="op" id="4846553">=</span>&nbsp;<span class="num" id="4846555">0</span><span class="op" id="4846556">;</span>&nbsp;<span class="ident" id="4846558">i</span>&nbsp;<span class="op" id="4846560">&lt;</span>&nbsp;<span class="builtinfunc" id="4846562">len</span><span class="op" id="4846565">(</span><span class="ident" id="4846566">p</span><span class="op" id="4846567">)</span>&nbsp;<span class="op" id="4846569">&amp;&amp;</span>&nbsp;<span class="ident" id="4846572">e</span><span class="op" id="4846573">.</span><span class="ident" id="4846574">nbuf</span>&nbsp;<span class="op" id="4846579">&lt;</span>&nbsp;<span class="num" id="4846581">4</span><span class="op" id="4846582">;</span>&nbsp;<span class="ident" id="4846584">i</span><span class="op" id="4846585">++</span>&nbsp;<span class="op" id="4846588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4846593">e</span><span class="op" id="4846594">.</span><span class="ident" id="4846595">buf</span><span class="op" id="4846598">[</span><span class="ident" id="4846599">e</span><span class="op" id="4846600">.</span><span class="ident" id="4846601">nbuf</span><span class="op" id="4846605">]</span>&nbsp;<span class="op" id="4846607">=</span>&nbsp;<span class="ident" id="4846609">p</span><span class="op" id="4846610">[</span><span class="ident" id="4846611">i</span><span class="op" id="4846612">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4846617">e</span><span class="op" id="4846618">.</span><span class="ident" id="4846619">nbuf</span><span class="op" id="4846623">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4846628">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4846632">n</span>&nbsp;<span class="op" id="4846634">+=</span>&nbsp;<span class="ident" id="4846637">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4846641">p</span>&nbsp;<span class="op" id="4846643">=</span>&nbsp;<span class="ident" id="4846645">p</span><span class="op" id="4846646">[</span><span class="ident" id="4846647">i</span><span class="op" id="4846648">:</span><span class="op" id="4846649">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4846653">if</span>&nbsp;<span class="ident" id="4846656">e</span><span class="op" id="4846657">.</span><span class="ident" id="4846658">nbuf</span>&nbsp;<span class="op" id="4846663">&lt;</span>&nbsp;<span class="num" id="4846665">4</span>&nbsp;<span class="op" id="4846667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4846672">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4846681">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4846685">nout</span>&nbsp;<span class="op" id="4846690">:=</span>&nbsp;<span class="ident" id="4846693">Encode</span><span class="op" id="4846699">(</span><span class="ident" id="4846700">e</span><span class="op" id="4846701">.</span><span class="ident" id="4846702">out</span><span class="op" id="4846705">[</span><span class="num" id="4846706">0</span><span class="op" id="4846707">:</span><span class="op" id="4846708">]</span><span class="op" id="4846709">,</span>&nbsp;<span class="ident" id="4846711">e</span><span class="op" id="4846712">.</span><span class="ident" id="4846713">buf</span><span class="op" id="4846716">[</span><span class="num" id="4846717">0</span><span class="op" id="4846718">:</span><span class="op" id="4846719">]</span><span class="op" id="4846720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4846724">if</span>&nbsp;<span class="ident" id="4846727">_</span><span class="op" id="4846728">,</span>&nbsp;<span class="ident" id="4846730">e</span><span class="op" id="4846731">.</span><span class="ident" id="4846732">err</span>&nbsp;<span class="op" id="4846736">=</span>&nbsp;<span class="ident" id="4846738">e</span><span class="op" id="4846739">.</span><span class="ident" id="4846740">w</span><span class="op" id="4846741">.</span><span class="ident" id="4846742">Write</span><span class="op" id="4846747">(</span><span class="ident" id="4846748">e</span><span class="op" id="4846749">.</span><span class="ident" id="4846750">out</span><span class="op" id="4846753">[</span><span class="num" id="4846754">0</span><span class="op" id="4846755">:</span><span class="ident" id="4846756">nout</span><span class="op" id="4846760">]</span><span class="op" id="4846761">)</span><span class="op" id="4846762">;</span>&nbsp;<span class="ident" id="4846764">e</span><span class="op" id="4846765">.</span><span class="ident" id="4846766">err</span>&nbsp;<span class="op" id="4846770">!=</span>&nbsp;<span class="builtintype" id="4846773">nil</span>&nbsp;<span class="op" id="4846777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4846782">return</span>&nbsp;<span class="ident" id="4846789">n</span><span class="op" id="4846790">,</span>&nbsp;<span class="ident" id="4846792">e</span><span class="op" id="4846793">.</span><span class="ident" id="4846794">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4846800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4846804">e</span><span class="op" id="4846805">.</span><span class="ident" id="4846806">nbuf</span>&nbsp;<span class="op" id="4846811">=</span>&nbsp;<span class="num" id="4846813">0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4846816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4846820">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4846847">for</span>&nbsp;<span class="builtinfunc" id="4846851">len</span><span class="op" id="4846854">(</span><span class="ident" id="4846855">p</span><span class="op" id="4846856">)</span>&nbsp;<span class="op" id="4846858">&gt;=</span>&nbsp;<span class="num" id="4846861">4</span>&nbsp;<span class="op" id="4846863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4846867">nn</span>&nbsp;<span class="op" id="4846870">:=</span>&nbsp;<span class="builtinfunc" id="4846873">len</span><span class="op" id="4846876">(</span><span class="ident" id="4846877">e</span><span class="op" id="4846878">.</span><span class="ident" id="4846879">out</span><span class="op" id="4846882">)</span>&nbsp;<span class="op" id="4846884">/</span>&nbsp;<span class="num" id="4846886">5</span>&nbsp;<span class="op" id="4846888">*</span>&nbsp;<span class="num" id="4846890">4</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4846894">if</span>&nbsp;<span class="ident" id="4846897">nn</span>&nbsp;<span class="op" id="4846900">&gt;</span>&nbsp;<span class="builtinfunc" id="4846902">len</span><span class="op" id="4846905">(</span><span class="ident" id="4846906">p</span><span class="op" id="4846907">)</span>&nbsp;<span class="op" id="4846909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4846914">nn</span>&nbsp;<span class="op" id="4846917">=</span>&nbsp;<span class="builtinfunc" id="4846919">len</span><span class="op" id="4846922">(</span><span class="ident" id="4846923">p</span><span class="op" id="4846924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4846928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4846932">nn</span>&nbsp;<span class="op" id="4846935">-=</span>&nbsp;<span class="ident" id="4846938">nn</span>&nbsp;<span class="op" id="4846941">%</span>&nbsp;<span class="num" id="4846943">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4846947">if</span>&nbsp;<span class="ident" id="4846950">nn</span>&nbsp;<span class="op" id="4846953">&gt;</span>&nbsp;<span class="num" id="4846955">0</span>&nbsp;<span class="op" id="4846957">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4846962">nout</span>&nbsp;<span class="op" id="4846967">:=</span>&nbsp;<span class="ident" id="4846970">Encode</span><span class="op" id="4846976">(</span><span class="ident" id="4846977">e</span><span class="op" id="4846978">.</span><span class="ident" id="4846979">out</span><span class="op" id="4846982">[</span><span class="num" id="4846983">0</span><span class="op" id="4846984">:</span><span class="op" id="4846985">]</span><span class="op" id="4846986">,</span>&nbsp;<span class="ident" id="4846988">p</span><span class="op" id="4846989">[</span><span class="num" id="4846990">0</span><span class="op" id="4846991">:</span><span class="ident" id="4846992">nn</span><span class="op" id="4846994">]</span><span class="op" id="4846995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4847000">if</span>&nbsp;<span class="ident" id="4847003">_</span><span class="op" id="4847004">,</span>&nbsp;<span class="ident" id="4847006">e</span><span class="op" id="4847007">.</span><span class="ident" id="4847008">err</span>&nbsp;<span class="op" id="4847012">=</span>&nbsp;<span class="ident" id="4847014">e</span><span class="op" id="4847015">.</span><span class="ident" id="4847016">w</span><span class="op" id="4847017">.</span><span class="ident" id="4847018">Write</span><span class="op" id="4847023">(</span><span class="ident" id="4847024">e</span><span class="op" id="4847025">.</span><span class="ident" id="4847026">out</span><span class="op" id="4847029">[</span><span class="num" id="4847030">0</span><span class="op" id="4847031">:</span><span class="ident" id="4847032">nout</span><span class="op" id="4847036">]</span><span class="op" id="4847037">)</span><span class="op" id="4847038">;</span>&nbsp;<span class="ident" id="4847040">e</span><span class="op" id="4847041">.</span><span class="ident" id="4847042">err</span>&nbsp;<span class="op" id="4847046">!=</span>&nbsp;<span class="builtintype" id="4847049">nil</span>&nbsp;<span class="op" id="4847053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4847059">return</span>&nbsp;<span class="ident" id="4847066">n</span><span class="op" id="4847067">,</span>&nbsp;<span class="ident" id="4847069">e</span><span class="op" id="4847070">.</span><span class="ident" id="4847071">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4847078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4847082">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4847086">n</span>&nbsp;<span class="op" id="4847088">+=</span>&nbsp;<span class="ident" id="4847091">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4847096">p</span>&nbsp;<span class="op" id="4847098">=</span>&nbsp;<span class="ident" id="4847100">p</span><span class="op" id="4847101">[</span><span class="ident" id="4847102">nn</span><span class="op" id="4847104">:</span><span class="op" id="4847105">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4847108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4847112">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4847133">for</span>&nbsp;<span class="ident" id="4847137">i</span>&nbsp;<span class="op" id="4847139">:=</span>&nbsp;<span class="num" id="4847142">0</span><span class="op" id="4847143">;</span>&nbsp;<span class="ident" id="4847145">i</span>&nbsp;<span class="op" id="4847147">&lt;</span>&nbsp;<span class="builtinfunc" id="4847149">len</span><span class="op" id="4847152">(</span><span class="ident" id="4847153">p</span><span class="op" id="4847154">)</span><span class="op" id="4847155">;</span>&nbsp;<span class="ident" id="4847157">i</span><span class="op" id="4847158">++</span>&nbsp;<span class="op" id="4847161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4847165">e</span><span class="op" id="4847166">.</span><span class="ident" id="4847167">buf</span><span class="op" id="4847170">[</span><span class="ident" id="4847171">i</span><span class="op" id="4847172">]</span>&nbsp;<span class="op" id="4847174">=</span>&nbsp;<span class="ident" id="4847176">p</span><span class="op" id="4847177">[</span><span class="ident" id="4847178">i</span><span class="op" id="4847179">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4847182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4847185">e</span><span class="op" id="4847186">.</span><span class="ident" id="4847187">nbuf</span>&nbsp;<span class="op" id="4847192">=</span>&nbsp;<span class="builtinfunc" id="4847194">len</span><span class="op" id="4847197">(</span><span class="ident" id="4847198">p</span><span class="op" id="4847199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4847202">n</span>&nbsp;<span class="op" id="4847204">+=</span>&nbsp;<span class="builtinfunc" id="4847207">len</span><span class="op" id="4847210">(</span><span class="ident" id="4847211">p</span><span class="op" id="4847212">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4847215">return</span><br>
<span class="lineno"></span><span class="op" id="4847222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4847225">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="4847279">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno">155</span><span class="keyword" id="4847332">func</span>&nbsp;<span class="op" id="4847337">(</span><span class="ident" id="4847338">e</span>&nbsp;<span class="op" id="4847340">*</span><span class="ident" id="4847341">encoder</span><span class="op" id="4847348">)</span>&nbsp;<span class="ident" id="4847350">Close</span><span class="op" id="4847355">(</span><span class="op" id="4847356">)</span>&nbsp;<span class="builtintype" id="4847358">error</span>&nbsp;<span class="op" id="4847364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4847367">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4847424">if</span>&nbsp;<span class="ident" id="4847427">e</span><span class="op" id="4847428">.</span><span class="ident" id="4847429">err</span>&nbsp;<span class="op" id="4847433">==</span>&nbsp;<span class="builtintype" id="4847436">nil</span>&nbsp;<span class="op" id="4847440">&amp;&amp;</span>&nbsp;<span class="ident" id="4847443">e</span><span class="op" id="4847444">.</span><span class="ident" id="4847445">nbuf</span>&nbsp;<span class="op" id="4847450">&gt;</span>&nbsp;<span class="num" id="4847452">0</span>&nbsp;<span class="op" id="4847454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4847458">nout</span>&nbsp;<span class="op" id="4847463">:=</span>&nbsp;<span class="ident" id="4847466">Encode</span><span class="op" id="4847472">(</span><span class="ident" id="4847473">e</span><span class="op" id="4847474">.</span><span class="ident" id="4847475">out</span><span class="op" id="4847478">[</span><span class="num" id="4847479">0</span><span class="op" id="4847480">:</span><span class="op" id="4847481">]</span><span class="op" id="4847482">,</span>&nbsp;<span class="ident" id="4847484">e</span><span class="op" id="4847485">.</span><span class="ident" id="4847486">buf</span><span class="op" id="4847489">[</span><span class="num" id="4847490">0</span><span class="op" id="4847491">:</span><span class="ident" id="4847492">e</span><span class="op" id="4847493">.</span><span class="ident" id="4847494">nbuf</span><span class="op" id="4847498">]</span><span class="op" id="4847499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4847503">e</span><span class="op" id="4847504">.</span><span class="ident" id="4847505">nbuf</span>&nbsp;<span class="op" id="4847510">=</span>&nbsp;<span class="num" id="4847512">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4847516">_</span><span class="op" id="4847517">,</span>&nbsp;<span class="ident" id="4847519">e</span><span class="op" id="4847520">.</span><span class="ident" id="4847521">err</span>&nbsp;<span class="op" id="4847525">=</span>&nbsp;<span class="ident" id="4847527">e</span><span class="op" id="4847528">.</span><span class="ident" id="4847529">w</span><span class="op" id="4847530">.</span><span class="ident" id="4847531">Write</span><span class="op" id="4847536">(</span><span class="ident" id="4847537">e</span><span class="op" id="4847538">.</span><span class="ident" id="4847539">out</span><span class="op" id="4847542">[</span><span class="num" id="4847543">0</span><span class="op" id="4847544">:</span><span class="ident" id="4847545">nout</span><span class="op" id="4847549">]</span><span class="op" id="4847550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4847553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4847556">return</span>&nbsp;<span class="ident" id="4847563">e</span><span class="op" id="4847564">.</span><span class="ident" id="4847565">err</span><br>
<span class="lineno"></span><span class="op" id="4847569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="4847572">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4847591">type</span>&nbsp;<span class="ident" id="4847596">CorruptInputError</span>&nbsp;<span class="ident" id="4847614">int64</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="4847621">func</span>&nbsp;<span class="op" id="4847626">(</span><span class="ident" id="4847627">e</span>&nbsp;<span class="ident" id="4847629">CorruptInputError</span><span class="op" id="4847646">)</span>&nbsp;<span class="ident" id="4847648">Error</span><span class="op" id="4847653">(</span><span class="op" id="4847654">)</span>&nbsp;<span class="builtintype" id="4847656">string</span>&nbsp;<span class="op" id="4847663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4847666">return</span>&nbsp;<span class="string" id="4847673">&#34;illegal&nbsp;ascii85&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="4847711">+</span>&nbsp;<span class="ident" id="4847713">strconv</span><span class="op" id="4847720">.</span><span class="ident" id="4847721">FormatInt</span><span class="op" id="4847730">(</span><span class="ident" id="4847731">int64</span><span class="op" id="4847736">(</span><span class="ident" id="4847737">e</span><span class="op" id="4847738">)</span><span class="op" id="4847739">,</span>&nbsp;<span class="num" id="4847741">10</span><span class="op" id="4847743">)</span><br>
<span class="lineno"></span><span class="op" id="4847745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="4847748">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;into&nbsp;dst,&nbsp;returning&nbsp;both&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="4847806">//&nbsp;of&nbsp;bytes&nbsp;written&nbsp;to&nbsp;dst&nbsp;and&nbsp;the&nbsp;number&nbsp;consumed&nbsp;from&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="4847867">//&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;ascii85&nbsp;data,&nbsp;Decode&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4847931">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;a&nbsp;CorruptInputError.</span><br>
<span class="lineno"></span><span class="comment" id="4847996">//&nbsp;Decode&nbsp;ignores&nbsp;space&nbsp;and&nbsp;control&nbsp;characters&nbsp;in&nbsp;src.</span><br>
<span class="lineno">180</span><span class="comment" id="4848051">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="4848115">//&nbsp;Decode&nbsp;expects&nbsp;these&nbsp;to&nbsp;have&nbsp;been&nbsp;stripped&nbsp;by&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="4848176">//</span><br>
<span class="lineno"></span><span class="comment" id="4848179">//&nbsp;If&nbsp;flush&nbsp;is&nbsp;true,&nbsp;Decode&nbsp;assumes&nbsp;that&nbsp;src&nbsp;represents&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4848239">//&nbsp;end&nbsp;of&nbsp;the&nbsp;input&nbsp;stream&nbsp;and&nbsp;processes&nbsp;it&nbsp;completely&nbsp;rather</span><br>
<span class="lineno">185</span><span class="comment" id="4848301">//&nbsp;than&nbsp;wait&nbsp;for&nbsp;the&nbsp;completion&nbsp;of&nbsp;another&nbsp;32-bit&nbsp;block.</span><br>
<span class="lineno"></span><span class="comment" id="4848358">//</span><br>
<span class="lineno"></span><span class="comment" id="4848361">//&nbsp;NewDecoder&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;interface&nbsp;around&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="comment" id="4848419">//</span><br>
<span class="lineno"></span><span class="keyword" id="4848422">func</span>&nbsp;<span class="ident" id="4848427">Decode</span><span class="op" id="4848433">(</span><span class="ident" id="4848434">dst</span><span class="op" id="4848437">,</span>&nbsp;<span class="ident" id="4848439">src</span>&nbsp;<span class="op" id="4848443">[</span><span class="op" id="4848444">]</span><span class="builtintype" id="4848445">byte</span><span class="op" id="4848449">,</span>&nbsp;<span class="ident" id="4848451">flush</span>&nbsp;<span class="builtintype" id="4848457">bool</span><span class="op" id="4848461">)</span>&nbsp;<span class="op" id="4848463">(</span><span class="ident" id="4848464">ndst</span><span class="op" id="4848468">,</span>&nbsp;<span class="ident" id="4848470">nsrc</span>&nbsp;<span class="builtintype" id="4848475">int</span><span class="op" id="4848478">,</span>&nbsp;<span class="ident" id="4848480">err</span>&nbsp;<span class="builtintype" id="4848484">error</span><span class="op" id="4848489">)</span>&nbsp;<span class="op" id="4848491">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4848494">var</span>&nbsp;<span class="ident" id="4848498">v</span>&nbsp;<span class="builtintype" id="4848500">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4848508">var</span>&nbsp;<span class="ident" id="4848512">nb</span>&nbsp;<span class="builtintype" id="4848515">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4848520">for</span>&nbsp;<span class="ident" id="4848524">i</span><span class="op" id="4848525">,</span>&nbsp;<span class="ident" id="4848527">b</span>&nbsp;<span class="op" id="4848529">:=</span>&nbsp;<span class="keyword" id="4848532">range</span>&nbsp;<span class="ident" id="4848538">src</span>&nbsp;<span class="op" id="4848542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4848546">if</span>&nbsp;<span class="builtinfunc" id="4848549">len</span><span class="op" id="4848552">(</span><span class="ident" id="4848553">dst</span><span class="op" id="4848556">)</span><span class="op" id="4848557">-</span><span class="ident" id="4848558">ndst</span>&nbsp;<span class="op" id="4848563">&lt;</span>&nbsp;<span class="num" id="4848565">4</span>&nbsp;<span class="op" id="4848567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4848572">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4848581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4848585">switch</span>&nbsp;<span class="op" id="4848592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4848596">case</span>&nbsp;<span class="ident" id="4848601">b</span>&nbsp;<span class="op" id="4848603">&lt;=</span>&nbsp;<span class="string" id="4848606">&#39;&nbsp;&#39;</span><span class="op" id="4848609">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4848614">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4848625">case</span>&nbsp;<span class="ident" id="4848630">b</span>&nbsp;<span class="op" id="4848632">==</span>&nbsp;<span class="string" id="4848635">&#39;z&#39;</span>&nbsp;<span class="op" id="4848639">&amp;&amp;</span>&nbsp;<span class="ident" id="4848642">nb</span>&nbsp;<span class="op" id="4848645">==</span>&nbsp;<span class="num" id="4848648">0</span><span class="op" id="4848649">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4848654">nb</span>&nbsp;<span class="op" id="4848657">=</span>&nbsp;<span class="num" id="4848659">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4848664">v</span>&nbsp;<span class="op" id="4848666">=</span>&nbsp;<span class="num" id="4848668">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4848672">case</span>&nbsp;<span class="string" id="4848677">&#39;!&#39;</span>&nbsp;<span class="op" id="4848681">&lt;=</span>&nbsp;<span class="ident" id="4848684">b</span>&nbsp;<span class="op" id="4848686">&amp;&amp;</span>&nbsp;<span class="ident" id="4848689">b</span>&nbsp;<span class="op" id="4848691">&lt;=</span>&nbsp;<span class="string" id="4848694">&#39;u&#39;</span><span class="op" id="4848697">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4848702">v</span>&nbsp;<span class="op" id="4848704">=</span>&nbsp;<span class="ident" id="4848706">v</span><span class="op" id="4848707">*</span><span class="num" id="4848708">85</span>&nbsp;<span class="op" id="4848711">+</span>&nbsp;<span class="builtintype" id="4848713">uint32</span><span class="op" id="4848719">(</span><span class="ident" id="4848720">b</span><span class="op" id="4848721">-</span><span class="string" id="4848722">&#39;!&#39;</span><span class="op" id="4848725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4848730">nb</span><span class="op" id="4848732">++</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4848737">default</span><span class="op" id="4848744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4848749">return</span>&nbsp;<span class="num" id="4848756">0</span><span class="op" id="4848757">,</span>&nbsp;<span class="num" id="4848759">0</span><span class="op" id="4848760">,</span>&nbsp;<span class="ident" id="4848762">CorruptInputError</span><span class="op" id="4848779">(</span><span class="ident" id="4848780">i</span><span class="op" id="4848781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4848785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4848789">if</span>&nbsp;<span class="ident" id="4848792">nb</span>&nbsp;<span class="op" id="4848795">==</span>&nbsp;<span class="num" id="4848798">5</span>&nbsp;<span class="op" id="4848800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4848805">nsrc</span>&nbsp;<span class="op" id="4848810">=</span>&nbsp;<span class="ident" id="4848812">i</span>&nbsp;<span class="op" id="4848814">+</span>&nbsp;<span class="num" id="4848816">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4848821">dst</span><span class="op" id="4848824">[</span><span class="ident" id="4848825">ndst</span><span class="op" id="4848829">]</span>&nbsp;<span class="op" id="4848831">=</span>&nbsp;<span class="builtintype" id="4848833">byte</span><span class="op" id="4848837">(</span><span class="ident" id="4848838">v</span>&nbsp;<span class="op" id="4848840">&gt;&gt;</span>&nbsp;<span class="num" id="4848843">24</span><span class="op" id="4848845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4848850">dst</span><span class="op" id="4848853">[</span><span class="ident" id="4848854">ndst</span><span class="op" id="4848858">+</span><span class="num" id="4848859">1</span><span class="op" id="4848860">]</span>&nbsp;<span class="op" id="4848862">=</span>&nbsp;<span class="builtintype" id="4848864">byte</span><span class="op" id="4848868">(</span><span class="ident" id="4848869">v</span>&nbsp;<span class="op" id="4848871">&gt;&gt;</span>&nbsp;<span class="num" id="4848874">16</span><span class="op" id="4848876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4848881">dst</span><span class="op" id="4848884">[</span><span class="ident" id="4848885">ndst</span><span class="op" id="4848889">+</span><span class="num" id="4848890">2</span><span class="op" id="4848891">]</span>&nbsp;<span class="op" id="4848893">=</span>&nbsp;<span class="builtintype" id="4848895">byte</span><span class="op" id="4848899">(</span><span class="ident" id="4848900">v</span>&nbsp;<span class="op" id="4848902">&gt;&gt;</span>&nbsp;<span class="num" id="4848905">8</span><span class="op" id="4848906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4848911">dst</span><span class="op" id="4848914">[</span><span class="ident" id="4848915">ndst</span><span class="op" id="4848919">+</span><span class="num" id="4848920">3</span><span class="op" id="4848921">]</span>&nbsp;<span class="op" id="4848923">=</span>&nbsp;<span class="builtintype" id="4848925">byte</span><span class="op" id="4848929">(</span><span class="ident" id="4848930">v</span><span class="op" id="4848931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4848936">ndst</span>&nbsp;<span class="op" id="4848941">+=</span>&nbsp;<span class="num" id="4848944">4</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4848949">nb</span>&nbsp;<span class="op" id="4848952">=</span>&nbsp;<span class="num" id="4848954">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4848959">v</span>&nbsp;<span class="op" id="4848961">=</span>&nbsp;<span class="num" id="4848963">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4848967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4848970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4848973">if</span>&nbsp;<span class="ident" id="4848976">flush</span>&nbsp;<span class="op" id="4848982">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4848986">nsrc</span>&nbsp;<span class="op" id="4848991">=</span>&nbsp;<span class="builtinfunc" id="4848993">len</span><span class="op" id="4848996">(</span><span class="ident" id="4848997">src</span><span class="op" id="4849000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4849004">if</span>&nbsp;<span class="ident" id="4849007">nb</span>&nbsp;<span class="op" id="4849010">&gt;</span>&nbsp;<span class="num" id="4849012">0</span>&nbsp;<span class="op" id="4849014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4849019">//&nbsp;The&nbsp;number&nbsp;of&nbsp;output&nbsp;bytes&nbsp;in&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4849073">//&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;leftover&nbsp;input&nbsp;bytes&nbsp;-&nbsp;1:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4849122">//&nbsp;the&nbsp;extra&nbsp;byte&nbsp;provides&nbsp;enough&nbsp;bits&nbsp;to&nbsp;cover</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4849173">//&nbsp;the&nbsp;inefficiency&nbsp;of&nbsp;the&nbsp;encoding&nbsp;for&nbsp;the&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4849227">if</span>&nbsp;<span class="ident" id="4849230">nb</span>&nbsp;<span class="op" id="4849233">==</span>&nbsp;<span class="num" id="4849236">1</span>&nbsp;<span class="op" id="4849238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4849244">return</span>&nbsp;<span class="num" id="4849251">0</span><span class="op" id="4849252">,</span>&nbsp;<span class="num" id="4849254">0</span><span class="op" id="4849255">,</span>&nbsp;<span class="ident" id="4849257">CorruptInputError</span><span class="op" id="4849274">(</span><span class="builtinfunc" id="4849275">len</span><span class="op" id="4849278">(</span><span class="ident" id="4849279">src</span><span class="op" id="4849282">)</span><span class="op" id="4849283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4849288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4849293">for</span>&nbsp;<span class="ident" id="4849297">i</span>&nbsp;<span class="op" id="4849299">:=</span>&nbsp;<span class="ident" id="4849302">nb</span><span class="op" id="4849304">;</span>&nbsp;<span class="ident" id="4849306">i</span>&nbsp;<span class="op" id="4849308">&lt;</span>&nbsp;<span class="num" id="4849310">5</span><span class="op" id="4849311">;</span>&nbsp;<span class="ident" id="4849313">i</span><span class="op" id="4849314">++</span>&nbsp;<span class="op" id="4849317">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4849323">//&nbsp;The&nbsp;short&nbsp;encoding&nbsp;truncated&nbsp;the&nbsp;output&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4849377">//&nbsp;We&nbsp;have&nbsp;to&nbsp;assume&nbsp;the&nbsp;worst&nbsp;case&nbsp;values&nbsp;(digit&nbsp;84)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4849435">//&nbsp;in&nbsp;order&nbsp;to&nbsp;ensure&nbsp;that&nbsp;the&nbsp;top&nbsp;bits&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4849492">v</span>&nbsp;<span class="op" id="4849494">=</span>&nbsp;<span class="ident" id="4849496">v</span><span class="op" id="4849497">*</span><span class="num" id="4849498">85</span>&nbsp;<span class="op" id="4849501">+</span>&nbsp;<span class="num" id="4849503">84</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4849509">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4849514">for</span>&nbsp;<span class="ident" id="4849518">i</span>&nbsp;<span class="op" id="4849520">:=</span>&nbsp;<span class="num" id="4849523">0</span><span class="op" id="4849524">;</span>&nbsp;<span class="ident" id="4849526">i</span>&nbsp;<span class="op" id="4849528">&lt;</span>&nbsp;<span class="ident" id="4849530">nb</span><span class="op" id="4849532">-</span><span class="num" id="4849533">1</span><span class="op" id="4849534">;</span>&nbsp;<span class="ident" id="4849536">i</span><span class="op" id="4849537">++</span>&nbsp;<span class="op" id="4849540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4849546">dst</span><span class="op" id="4849549">[</span><span class="ident" id="4849550">ndst</span><span class="op" id="4849554">]</span>&nbsp;<span class="op" id="4849556">=</span>&nbsp;<span class="builtintype" id="4849558">byte</span><span class="op" id="4849562">(</span><span class="ident" id="4849563">v</span>&nbsp;<span class="op" id="4849565">&gt;&gt;</span>&nbsp;<span class="num" id="4849568">24</span><span class="op" id="4849570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4849576">v</span>&nbsp;<span class="op" id="4849578">&lt;&lt;=</span>&nbsp;<span class="num" id="4849582">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4849588">ndst</span><span class="op" id="4849592">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4849598">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4849602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4849605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4849608">return</span><br>
<span class="lineno"></span><span class="op" id="4849615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="4849618">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno"></span><span class="keyword" id="4849673">func</span>&nbsp;<span class="ident" id="4849678">NewDecoder</span><span class="op" id="4849688">(</span><span class="ident" id="4849689">r</span>&nbsp;<span class="ident" id="4849691">io</span><span class="op" id="4849693">.</span><span class="ident" id="4849694">Reader</span><span class="op" id="4849700">)</span>&nbsp;<span class="ident" id="4849702">io</span><span class="op" id="4849704">.</span><span class="ident" id="4849705">Reader</span>&nbsp;<span class="op" id="4849712">{</span>&nbsp;<span class="keyword" id="4849714">return</span>&nbsp;<span class="op" id="4849721">&amp;</span><span class="ident" id="4849722">decoder</span><span class="op" id="4849729">{</span><span class="ident" id="4849730">r</span><span class="op" id="4849731">:</span>&nbsp;<span class="ident" id="4849733">r</span><span class="op" id="4849734">}</span>&nbsp;<span class="op" id="4849736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4849739">type</span>&nbsp;<span class="ident" id="4849744">decoder</span>&nbsp;<span class="keyword" id="4849752">struct</span>&nbsp;<span class="op" id="4849759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4849762">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4849770">error</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4849777">readErr</span>&nbsp;<span class="builtintype" id="4849785">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4849792">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4849800">io</span><span class="op" id="4849802">.</span><span class="ident" id="4849803">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4849811">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4849819">[</span><span class="num" id="4849820">1024</span><span class="op" id="4849824">]</span><span class="builtintype" id="4849825">byte</span>&nbsp;<span class="comment" id="4849830">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4849849">nbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4849857">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4849862">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4849870">[</span><span class="op" id="4849871">]</span><span class="builtintype" id="4849872">byte</span>&nbsp;<span class="comment" id="4849877">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4849905">outbuf</span>&nbsp;&nbsp;<span class="op" id="4849913">[</span><span class="num" id="4849914">1024</span><span class="op" id="4849918">]</span><span class="builtintype" id="4849919">byte</span><br>
<span class="lineno"></span><span class="op" id="4849924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4849927">func</span>&nbsp;<span class="op" id="4849932">(</span><span class="ident" id="4849933">d</span>&nbsp;<span class="op" id="4849935">*</span><span class="ident" id="4849936">decoder</span><span class="op" id="4849943">)</span>&nbsp;<span class="ident" id="4849945">Read</span><span class="op" id="4849949">(</span><span class="ident" id="4849950">p</span>&nbsp;<span class="op" id="4849952">[</span><span class="op" id="4849953">]</span><span class="builtintype" id="4849954">byte</span><span class="op" id="4849958">)</span>&nbsp;<span class="op" id="4849960">(</span><span class="ident" id="4849961">n</span>&nbsp;<span class="builtintype" id="4849963">int</span><span class="op" id="4849966">,</span>&nbsp;<span class="ident" id="4849968">err</span>&nbsp;<span class="builtintype" id="4849972">error</span><span class="op" id="4849977">)</span>&nbsp;<span class="op" id="4849979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4849982">if</span>&nbsp;<span class="builtinfunc" id="4849985">len</span><span class="op" id="4849988">(</span><span class="ident" id="4849989">p</span><span class="op" id="4849990">)</span>&nbsp;<span class="op" id="4849992">==</span>&nbsp;<span class="num" id="4849995">0</span>&nbsp;<span class="op" id="4849997">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4850001">return</span>&nbsp;<span class="num" id="4850008">0</span><span class="op" id="4850009">,</span>&nbsp;<span class="builtintype" id="4850011">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4850016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4850019">if</span>&nbsp;<span class="ident" id="4850022">d</span><span class="op" id="4850023">.</span><span class="ident" id="4850024">err</span>&nbsp;<span class="op" id="4850028">!=</span>&nbsp;<span class="builtintype" id="4850031">nil</span>&nbsp;<span class="op" id="4850035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4850039">return</span>&nbsp;<span class="num" id="4850046">0</span><span class="op" id="4850047">,</span>&nbsp;<span class="ident" id="4850049">d</span><span class="op" id="4850050">.</span><span class="ident" id="4850051">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4850056">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4850060">for</span>&nbsp;<span class="op" id="4850064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4850068">//&nbsp;Copy&nbsp;leftover&nbsp;output&nbsp;from&nbsp;last&nbsp;decode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4850112">if</span>&nbsp;<span class="builtinfunc" id="4850115">len</span><span class="op" id="4850118">(</span><span class="ident" id="4850119">d</span><span class="op" id="4850120">.</span><span class="ident" id="4850121">out</span><span class="op" id="4850124">)</span>&nbsp;<span class="op" id="4850126">&gt;</span>&nbsp;<span class="num" id="4850128">0</span>&nbsp;<span class="op" id="4850130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4850135">n</span>&nbsp;<span class="op" id="4850137">=</span>&nbsp;<span class="builtinfunc" id="4850139">copy</span><span class="op" id="4850143">(</span><span class="ident" id="4850144">p</span><span class="op" id="4850145">,</span>&nbsp;<span class="ident" id="4850147">d</span><span class="op" id="4850148">.</span><span class="ident" id="4850149">out</span><span class="op" id="4850152">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4850157">d</span><span class="op" id="4850158">.</span><span class="ident" id="4850159">out</span>&nbsp;<span class="op" id="4850163">=</span>&nbsp;<span class="ident" id="4850165">d</span><span class="op" id="4850166">.</span><span class="ident" id="4850167">out</span><span class="op" id="4850170">[</span><span class="ident" id="4850171">n</span><span class="op" id="4850172">:</span><span class="op" id="4850173">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4850178">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4850187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4850192">//&nbsp;Decode&nbsp;leftover&nbsp;input&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4850235">var</span>&nbsp;<span class="ident" id="4850239">nn</span><span class="op" id="4850241">,</span>&nbsp;<span class="ident" id="4850243">nsrc</span><span class="op" id="4850247">,</span>&nbsp;<span class="ident" id="4850249">ndst</span>&nbsp;<span class="builtintype" id="4850254">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4850260">if</span>&nbsp;<span class="ident" id="4850263">d</span><span class="op" id="4850264">.</span><span class="ident" id="4850265">nbuf</span>&nbsp;<span class="op" id="4850270">&gt;</span>&nbsp;<span class="num" id="4850272">0</span>&nbsp;<span class="op" id="4850274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4850279">ndst</span><span class="op" id="4850283">,</span>&nbsp;<span class="ident" id="4850285">nsrc</span><span class="op" id="4850289">,</span>&nbsp;<span class="ident" id="4850291">d</span><span class="op" id="4850292">.</span><span class="ident" id="4850293">err</span>&nbsp;<span class="op" id="4850297">=</span>&nbsp;<span class="ident" id="4850299">Decode</span><span class="op" id="4850305">(</span><span class="ident" id="4850306">d</span><span class="op" id="4850307">.</span><span class="ident" id="4850308">outbuf</span><span class="op" id="4850314">[</span><span class="num" id="4850315">0</span><span class="op" id="4850316">:</span><span class="op" id="4850317">]</span><span class="op" id="4850318">,</span>&nbsp;<span class="ident" id="4850320">d</span><span class="op" id="4850321">.</span><span class="ident" id="4850322">buf</span><span class="op" id="4850325">[</span><span class="num" id="4850326">0</span><span class="op" id="4850327">:</span><span class="ident" id="4850328">d</span><span class="op" id="4850329">.</span><span class="ident" id="4850330">nbuf</span><span class="op" id="4850334">]</span><span class="op" id="4850335">,</span>&nbsp;<span class="ident" id="4850337">d</span><span class="op" id="4850338">.</span><span class="ident" id="4850339">readErr</span>&nbsp;<span class="op" id="4850347">!=</span>&nbsp;<span class="builtintype" id="4850350">nil</span><span class="op" id="4850353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4850358">if</span>&nbsp;<span class="ident" id="4850361">ndst</span>&nbsp;<span class="op" id="4850366">&gt;</span>&nbsp;<span class="num" id="4850368">0</span>&nbsp;<span class="op" id="4850370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4850376">d</span><span class="op" id="4850377">.</span><span class="ident" id="4850378">out</span>&nbsp;<span class="op" id="4850382">=</span>&nbsp;<span class="ident" id="4850384">d</span><span class="op" id="4850385">.</span><span class="ident" id="4850386">outbuf</span><span class="op" id="4850392">[</span><span class="num" id="4850393">0</span><span class="op" id="4850394">:</span><span class="ident" id="4850395">ndst</span><span class="op" id="4850399">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4850405">d</span><span class="op" id="4850406">.</span><span class="ident" id="4850407">nbuf</span>&nbsp;<span class="op" id="4850412">=</span>&nbsp;<span class="builtinfunc" id="4850414">copy</span><span class="op" id="4850418">(</span><span class="ident" id="4850419">d</span><span class="op" id="4850420">.</span><span class="ident" id="4850421">buf</span><span class="op" id="4850424">[</span><span class="num" id="4850425">0</span><span class="op" id="4850426">:</span><span class="op" id="4850427">]</span><span class="op" id="4850428">,</span>&nbsp;<span class="ident" id="4850430">d</span><span class="op" id="4850431">.</span><span class="ident" id="4850432">buf</span><span class="op" id="4850435">[</span><span class="ident" id="4850436">nsrc</span><span class="op" id="4850440">:</span><span class="ident" id="4850441">d</span><span class="op" id="4850442">.</span><span class="ident" id="4850443">nbuf</span><span class="op" id="4850447">]</span><span class="op" id="4850448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4850454">continue</span>&nbsp;<span class="comment" id="4850463">//&nbsp;copy&nbsp;out&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4850489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4850494">if</span>&nbsp;<span class="ident" id="4850497">ndst</span>&nbsp;<span class="op" id="4850502">==</span>&nbsp;<span class="num" id="4850505">0</span>&nbsp;<span class="op" id="4850507">&amp;&amp;</span>&nbsp;<span class="ident" id="4850510">d</span><span class="op" id="4850511">.</span><span class="ident" id="4850512">err</span>&nbsp;<span class="op" id="4850516">==</span>&nbsp;<span class="builtintype" id="4850519">nil</span>&nbsp;<span class="op" id="4850523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4850529">//&nbsp;Special&nbsp;case:&nbsp;input&nbsp;buffer&nbsp;is&nbsp;mostly&nbsp;filled&nbsp;with&nbsp;non-data&nbsp;bytes.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4850601">//&nbsp;Filter&nbsp;out&nbsp;such&nbsp;bytes&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;more&nbsp;input.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4850659">off</span>&nbsp;<span class="op" id="4850663">:=</span>&nbsp;<span class="num" id="4850666">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4850672">for</span>&nbsp;<span class="ident" id="4850676">i</span>&nbsp;<span class="op" id="4850678">:=</span>&nbsp;<span class="num" id="4850681">0</span><span class="op" id="4850682">;</span>&nbsp;<span class="ident" id="4850684">i</span>&nbsp;<span class="op" id="4850686">&lt;</span>&nbsp;<span class="ident" id="4850688">d</span><span class="op" id="4850689">.</span><span class="ident" id="4850690">nbuf</span><span class="op" id="4850694">;</span>&nbsp;<span class="ident" id="4850696">i</span><span class="op" id="4850697">++</span>&nbsp;<span class="op" id="4850700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4850707">if</span>&nbsp;<span class="ident" id="4850710">d</span><span class="op" id="4850711">.</span><span class="ident" id="4850712">buf</span><span class="op" id="4850715">[</span><span class="ident" id="4850716">i</span><span class="op" id="4850717">]</span>&nbsp;<span class="op" id="4850719">&gt;</span>&nbsp;<span class="string" id="4850721">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4850725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4850733">d</span><span class="op" id="4850734">.</span><span class="ident" id="4850735">buf</span><span class="op" id="4850738">[</span><span class="ident" id="4850739">off</span><span class="op" id="4850742">]</span>&nbsp;<span class="op" id="4850744">=</span>&nbsp;<span class="ident" id="4850746">d</span><span class="op" id="4850747">.</span><span class="ident" id="4850748">buf</span><span class="op" id="4850751">[</span><span class="ident" id="4850752">i</span><span class="op" id="4850753">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4850761">off</span><span class="op" id="4850764">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4850772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4850778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4850784">d</span><span class="op" id="4850785">.</span><span class="ident" id="4850786">nbuf</span>&nbsp;<span class="op" id="4850791">=</span>&nbsp;<span class="ident" id="4850793">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4850800">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4850804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4850809">//&nbsp;Out&nbsp;of&nbsp;input,&nbsp;out&nbsp;of&nbsp;decoded&nbsp;output.&nbsp;&nbsp;Check&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4850866">if</span>&nbsp;<span class="ident" id="4850869">d</span><span class="op" id="4850870">.</span><span class="ident" id="4850871">err</span>&nbsp;<span class="op" id="4850875">!=</span>&nbsp;<span class="builtintype" id="4850878">nil</span>&nbsp;<span class="op" id="4850882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4850887">return</span>&nbsp;<span class="num" id="4850894">0</span><span class="op" id="4850895">,</span>&nbsp;<span class="ident" id="4850897">d</span><span class="op" id="4850898">.</span><span class="ident" id="4850899">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4850905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4850909">if</span>&nbsp;<span class="ident" id="4850912">d</span><span class="op" id="4850913">.</span><span class="ident" id="4850914">readErr</span>&nbsp;<span class="op" id="4850922">!=</span>&nbsp;<span class="builtintype" id="4850925">nil</span>&nbsp;<span class="op" id="4850929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4850934">d</span><span class="op" id="4850935">.</span><span class="ident" id="4850936">err</span>&nbsp;<span class="op" id="4850940">=</span>&nbsp;<span class="ident" id="4850942">d</span><span class="op" id="4850943">.</span><span class="ident" id="4850944">readErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4850955">return</span>&nbsp;<span class="num" id="4850962">0</span><span class="op" id="4850963">,</span>&nbsp;<span class="ident" id="4850965">d</span><span class="op" id="4850966">.</span><span class="ident" id="4850967">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4850973">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4850978">//&nbsp;Read&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4850999">nn</span><span class="op" id="4851001">,</span>&nbsp;<span class="ident" id="4851003">d</span><span class="op" id="4851004">.</span><span class="ident" id="4851005">readErr</span>&nbsp;<span class="op" id="4851013">=</span>&nbsp;<span class="ident" id="4851015">d</span><span class="op" id="4851016">.</span><span class="ident" id="4851017">r</span><span class="op" id="4851018">.</span><span class="ident" id="4851019">Read</span><span class="op" id="4851023">(</span><span class="ident" id="4851024">d</span><span class="op" id="4851025">.</span><span class="ident" id="4851026">buf</span><span class="op" id="4851029">[</span><span class="ident" id="4851030">d</span><span class="op" id="4851031">.</span><span class="ident" id="4851032">nbuf</span><span class="op" id="4851036">:</span><span class="op" id="4851037">]</span><span class="op" id="4851038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4851042">d</span><span class="op" id="4851043">.</span><span class="ident" id="4851044">nbuf</span>&nbsp;<span class="op" id="4851049">+=</span>&nbsp;<span class="ident" id="4851052">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4851056">}</span><br>
<span class="lineno">310</span><span class="op" id="4851058">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
