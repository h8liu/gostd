<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8110145">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8110200">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8110254">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8110305">package</span>&nbsp;<span class="ident" id="8110313">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8110318">import</span>&nbsp;<span class="op" id="8110325">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110328">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110337">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110344">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110353">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110368">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110374">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110387">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110393">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110404">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8110414">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8110417">var</span>&nbsp;<span class="ident" id="8110421">filenames</span>&nbsp;<span class="op" id="8110431">=</span>&nbsp;<span class="op" id="8110433">[</span><span class="op" id="8110434">]</span><span class="builtintype" id="8110435">string</span><span class="op" id="8110441">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110444">&#34;basn0g01&#34;</span><span class="op" id="8110454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110457">&#34;basn0g01-30&#34;</span><span class="op" id="8110470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110473">&#34;basn0g02&#34;</span><span class="op" id="8110483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110486">&#34;basn0g02-29&#34;</span><span class="op" id="8110499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110502">&#34;basn0g04&#34;</span><span class="op" id="8110512">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110515">&#34;basn0g04-31&#34;</span><span class="op" id="8110528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110531">&#34;basn0g08&#34;</span><span class="op" id="8110541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110544">&#34;basn0g16&#34;</span><span class="op" id="8110554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110557">&#34;basn2c08&#34;</span><span class="op" id="8110567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110570">&#34;basn2c16&#34;</span><span class="op" id="8110580">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110583">&#34;basn3p01&#34;</span><span class="op" id="8110593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110596">&#34;basn3p02&#34;</span><span class="op" id="8110606">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110609">&#34;basn3p04&#34;</span><span class="op" id="8110619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110622">&#34;basn3p04-31i&#34;</span><span class="op" id="8110636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110639">&#34;basn3p08&#34;</span><span class="op" id="8110649">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110652">&#34;basn3p08-trns&#34;</span><span class="op" id="8110667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110670">&#34;basn4a08&#34;</span><span class="op" id="8110680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110683">&#34;basn4a16&#34;</span><span class="op" id="8110693">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110696">&#34;basn6a08&#34;</span><span class="op" id="8110706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110709">&#34;basn6a16&#34;</span><span class="op" id="8110719">,</span><br>
<span class="lineno">40</span><span class="op" id="8110721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8110724">var</span>&nbsp;<span class="ident" id="8110728">filenamesPaletted</span>&nbsp;<span class="op" id="8110746">=</span>&nbsp;<span class="op" id="8110748">[</span><span class="op" id="8110749">]</span><span class="builtintype" id="8110750">string</span><span class="op" id="8110756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110759">&#34;basn3p01&#34;</span><span class="op" id="8110769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110772">&#34;basn3p02&#34;</span><span class="op" id="8110782">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110785">&#34;basn3p04&#34;</span><span class="op" id="8110795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110798">&#34;basn3p08&#34;</span><span class="op" id="8110808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110811">&#34;basn3p08-trns&#34;</span><span class="op" id="8110826">,</span><br>
<span class="lineno"></span><span class="op" id="8110828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="8110831">var</span>&nbsp;<span class="ident" id="8110835">filenamesShort</span>&nbsp;<span class="op" id="8110850">=</span>&nbsp;<span class="op" id="8110852">[</span><span class="op" id="8110853">]</span><span class="builtintype" id="8110854">string</span><span class="op" id="8110860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110863">&#34;basn0g01&#34;</span><span class="op" id="8110873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110876">&#34;basn0g04-31&#34;</span><span class="op" id="8110889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110892">&#34;basn6a16&#34;</span><span class="op" id="8110902">,</span><br>
<span class="lineno"></span><span class="op" id="8110904">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="8110907">func</span>&nbsp;<span class="ident" id="8110912">readPNG</span><span class="op" id="8110919">(</span><span class="ident" id="8110920">filename</span>&nbsp;<span class="builtintype" id="8110929">string</span><span class="op" id="8110935">)</span>&nbsp;<span class="op" id="8110937">(</span><span class="ident" id="8110938">image</span><span class="op" id="8110943">.</span><span class="ident" id="8110944">Image</span><span class="op" id="8110949">,</span>&nbsp;<span class="builtintype" id="8110951">error</span><span class="op" id="8110956">)</span>&nbsp;<span class="op" id="8110958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110961">f</span><span class="op" id="8110962">,</span>&nbsp;<span class="ident" id="8110964">err</span>&nbsp;<span class="op" id="8110968">:=</span>&nbsp;<span class="ident" id="8110971">os</span><span class="op" id="8110973">.</span><span class="ident" id="8110974">Open</span><span class="op" id="8110978">(</span><span class="ident" id="8110979">filename</span><span class="op" id="8110987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110990">if</span>&nbsp;<span class="ident" id="8110993">err</span>&nbsp;<span class="op" id="8110997">!=</span>&nbsp;<span class="ident" id="8111000">nil</span>&nbsp;<span class="op" id="8111004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111008">return</span>&nbsp;<span class="ident" id="8111015">nil</span><span class="op" id="8111018">,</span>&nbsp;<span class="ident" id="8111020">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111028">defer</span>&nbsp;<span class="ident" id="8111034">f</span><span class="op" id="8111035">.</span><span class="ident" id="8111036">Close</span><span class="op" id="8111041">(</span><span class="op" id="8111042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111045">return</span>&nbsp;<span class="ident" id="8111052">Decode</span><span class="op" id="8111058">(</span><span class="ident" id="8111059">f</span><span class="op" id="8111060">)</span><br>
<span class="lineno"></span><span class="op" id="8111062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="8111065">//&nbsp;An&nbsp;approximation&nbsp;of&nbsp;the&nbsp;sng&nbsp;command-line&nbsp;tool.</span><br>
<span class="lineno"></span><span class="keyword" id="8111115">func</span>&nbsp;<span class="ident" id="8111120">sng</span><span class="op" id="8111123">(</span><span class="ident" id="8111124">w</span>&nbsp;<span class="ident" id="8111126">io</span><span class="op" id="8111128">.</span><span class="ident" id="8111129">WriteCloser</span><span class="op" id="8111140">,</span>&nbsp;<span class="ident" id="8111142">filename</span>&nbsp;<span class="builtintype" id="8111151">string</span><span class="op" id="8111157">,</span>&nbsp;<span class="ident" id="8111159">png</span>&nbsp;<span class="ident" id="8111163">image</span><span class="op" id="8111168">.</span><span class="ident" id="8111169">Image</span><span class="op" id="8111174">)</span>&nbsp;<span class="op" id="8111176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111179">defer</span>&nbsp;<span class="ident" id="8111185">w</span><span class="op" id="8111186">.</span><span class="ident" id="8111187">Close</span><span class="op" id="8111192">(</span><span class="op" id="8111193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111196">bounds</span>&nbsp;<span class="op" id="8111203">:=</span>&nbsp;<span class="ident" id="8111206">png</span><span class="op" id="8111209">.</span><span class="ident" id="8111210">Bounds</span><span class="op" id="8111216">(</span><span class="op" id="8111217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111220">cm</span>&nbsp;<span class="op" id="8111223">:=</span>&nbsp;<span class="ident" id="8111226">png</span><span class="op" id="8111229">.</span><span class="ident" id="8111230">ColorModel</span><span class="op" id="8111240">(</span><span class="op" id="8111241">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111244">var</span>&nbsp;<span class="ident" id="8111248">bitdepth</span>&nbsp;<span class="builtintype" id="8111257">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111262">switch</span>&nbsp;<span class="ident" id="8111269">cm</span>&nbsp;<span class="op" id="8111272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111275">case</span>&nbsp;<span class="ident" id="8111280">color</span><span class="op" id="8111285">.</span><span class="ident" id="8111286">RGBAModel</span><span class="op" id="8111295">,</span>&nbsp;<span class="ident" id="8111297">color</span><span class="op" id="8111302">.</span><span class="ident" id="8111303">NRGBAModel</span><span class="op" id="8111313">,</span>&nbsp;<span class="ident" id="8111315">color</span><span class="op" id="8111320">.</span><span class="ident" id="8111321">AlphaModel</span><span class="op" id="8111331">,</span>&nbsp;<span class="ident" id="8111333">color</span><span class="op" id="8111338">.</span><span class="ident" id="8111339">GrayModel</span><span class="op" id="8111348">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111352">bitdepth</span>&nbsp;<span class="op" id="8111361">=</span>&nbsp;<span class="num" id="8111363">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111366">default</span><span class="op" id="8111373">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111377">bitdepth</span>&nbsp;<span class="op" id="8111386">=</span>&nbsp;<span class="num" id="8111388">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111395">cpm</span><span class="op" id="8111398">,</span>&nbsp;<span class="ident" id="8111400">_</span>&nbsp;<span class="op" id="8111402">:=</span>&nbsp;<span class="ident" id="8111405">cm</span><span class="op" id="8111407">.</span><span class="op" id="8111408">(</span><span class="ident" id="8111409">color</span><span class="op" id="8111414">.</span><span class="ident" id="8111415">Palette</span><span class="op" id="8111422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111425">var</span>&nbsp;<span class="ident" id="8111429">paletted</span>&nbsp;<span class="op" id="8111438">*</span><span class="ident" id="8111439">image</span><span class="op" id="8111444">.</span><span class="ident" id="8111445">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111455">if</span>&nbsp;<span class="ident" id="8111458">cpm</span>&nbsp;<span class="op" id="8111462">!=</span>&nbsp;<span class="ident" id="8111465">nil</span>&nbsp;<span class="op" id="8111469">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111473">switch</span>&nbsp;<span class="op" id="8111480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111484">case</span>&nbsp;<span class="builtinfunc" id="8111489">len</span><span class="op" id="8111492">(</span><span class="ident" id="8111493">cpm</span><span class="op" id="8111496">)</span>&nbsp;<span class="op" id="8111498">&lt;=</span>&nbsp;<span class="num" id="8111501">2</span><span class="op" id="8111502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111507">bitdepth</span>&nbsp;<span class="op" id="8111516">=</span>&nbsp;<span class="num" id="8111518">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111522">case</span>&nbsp;<span class="builtinfunc" id="8111527">len</span><span class="op" id="8111530">(</span><span class="ident" id="8111531">cpm</span><span class="op" id="8111534">)</span>&nbsp;<span class="op" id="8111536">&lt;=</span>&nbsp;<span class="num" id="8111539">4</span><span class="op" id="8111540">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111545">bitdepth</span>&nbsp;<span class="op" id="8111554">=</span>&nbsp;<span class="num" id="8111556">2</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111560">case</span>&nbsp;<span class="builtinfunc" id="8111565">len</span><span class="op" id="8111568">(</span><span class="ident" id="8111569">cpm</span><span class="op" id="8111572">)</span>&nbsp;<span class="op" id="8111574">&lt;=</span>&nbsp;<span class="num" id="8111577">16</span><span class="op" id="8111579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111584">bitdepth</span>&nbsp;<span class="op" id="8111593">=</span>&nbsp;<span class="num" id="8111595">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111599">default</span><span class="op" id="8111606">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111611">bitdepth</span>&nbsp;<span class="op" id="8111620">=</span>&nbsp;<span class="num" id="8111622">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111626">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111630">paletted</span>&nbsp;<span class="op" id="8111639">=</span>&nbsp;<span class="ident" id="8111641">png</span><span class="op" id="8111644">.</span><span class="op" id="8111645">(</span><span class="op" id="8111646">*</span><span class="ident" id="8111647">image</span><span class="op" id="8111652">.</span><span class="ident" id="8111653">Paletted</span><span class="op" id="8111661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8111668">//&nbsp;Write&nbsp;the&nbsp;filename&nbsp;and&nbsp;IHDR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111701">io</span><span class="op" id="8111703">.</span><span class="ident" id="8111704">WriteString</span><span class="op" id="8111715">(</span><span class="ident" id="8111716">w</span><span class="op" id="8111717">,</span>&nbsp;<span class="string" id="8111719">&#34;#SNG:&nbsp;from&nbsp;&#34;</span><span class="op" id="8111732">+</span><span class="ident" id="8111733">filename</span><span class="op" id="8111741">+</span><span class="string" id="8111742">&#34;.png\nIHDR&nbsp;{\n&#34;</span><span class="op" id="8111758">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111761">fmt</span><span class="op" id="8111764">.</span><span class="ident" id="8111765">Fprintf</span><span class="op" id="8111772">(</span><span class="ident" id="8111773">w</span><span class="op" id="8111774">,</span>&nbsp;<span class="string" id="8111776">&#34;&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;%d;&nbsp;height:&nbsp;%d;&nbsp;bitdepth:&nbsp;%d;\n&#34;</span><span class="op" id="8111820">,</span>&nbsp;<span class="ident" id="8111822">bounds</span><span class="op" id="8111828">.</span><span class="ident" id="8111829">Dx</span><span class="op" id="8111831">(</span><span class="op" id="8111832">)</span><span class="op" id="8111833">,</span>&nbsp;<span class="ident" id="8111835">bounds</span><span class="op" id="8111841">.</span><span class="ident" id="8111842">Dy</span><span class="op" id="8111844">(</span><span class="op" id="8111845">)</span><span class="op" id="8111846">,</span>&nbsp;<span class="ident" id="8111848">bitdepth</span><span class="op" id="8111856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111859">switch</span>&nbsp;<span class="op" id="8111866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111869">case</span>&nbsp;<span class="ident" id="8111874">cm</span>&nbsp;<span class="op" id="8111877">==</span>&nbsp;<span class="ident" id="8111880">color</span><span class="op" id="8111885">.</span><span class="ident" id="8111886">RGBAModel</span><span class="op" id="8111895">,</span>&nbsp;<span class="ident" id="8111897">cm</span>&nbsp;<span class="op" id="8111900">==</span>&nbsp;<span class="ident" id="8111903">color</span><span class="op" id="8111908">.</span><span class="ident" id="8111909">RGBA64Model</span><span class="op" id="8111920">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111924">io</span><span class="op" id="8111926">.</span><span class="ident" id="8111927">WriteString</span><span class="op" id="8111938">(</span><span class="ident" id="8111939">w</span><span class="op" id="8111940">,</span>&nbsp;<span class="string" id="8111942">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color;\n&#34;</span><span class="op" id="8111962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111965">case</span>&nbsp;<span class="ident" id="8111970">cm</span>&nbsp;<span class="op" id="8111973">==</span>&nbsp;<span class="ident" id="8111976">color</span><span class="op" id="8111981">.</span><span class="ident" id="8111982">NRGBAModel</span><span class="op" id="8111992">,</span>&nbsp;<span class="ident" id="8111994">cm</span>&nbsp;<span class="op" id="8111997">==</span>&nbsp;<span class="ident" id="8112000">color</span><span class="op" id="8112005">.</span><span class="ident" id="8112006">NRGBA64Model</span><span class="op" id="8112018">:</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112022">io</span><span class="op" id="8112024">.</span><span class="ident" id="8112025">WriteString</span><span class="op" id="8112036">(</span><span class="ident" id="8112037">w</span><span class="op" id="8112038">,</span>&nbsp;<span class="string" id="8112040">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;alpha;\n&#34;</span><span class="op" id="8112066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112069">case</span>&nbsp;<span class="ident" id="8112074">cm</span>&nbsp;<span class="op" id="8112077">==</span>&nbsp;<span class="ident" id="8112080">color</span><span class="op" id="8112085">.</span><span class="ident" id="8112086">GrayModel</span><span class="op" id="8112095">,</span>&nbsp;<span class="ident" id="8112097">cm</span>&nbsp;<span class="op" id="8112100">==</span>&nbsp;<span class="ident" id="8112103">color</span><span class="op" id="8112108">.</span><span class="ident" id="8112109">Gray16Model</span><span class="op" id="8112120">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112124">io</span><span class="op" id="8112126">.</span><span class="ident" id="8112127">WriteString</span><span class="op" id="8112138">(</span><span class="ident" id="8112139">w</span><span class="op" id="8112140">,</span>&nbsp;<span class="string" id="8112142">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;grayscale;\n&#34;</span><span class="op" id="8112166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112169">case</span>&nbsp;<span class="ident" id="8112174">cpm</span>&nbsp;<span class="op" id="8112178">!=</span>&nbsp;<span class="ident" id="8112181">nil</span><span class="op" id="8112184">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112188">io</span><span class="op" id="8112190">.</span><span class="ident" id="8112191">WriteString</span><span class="op" id="8112202">(</span><span class="ident" id="8112203">w</span><span class="op" id="8112204">,</span>&nbsp;<span class="string" id="8112206">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;palette;\n&#34;</span><span class="op" id="8112234">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112237">default</span><span class="op" id="8112244">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112248">io</span><span class="op" id="8112250">.</span><span class="ident" id="8112251">WriteString</span><span class="op" id="8112262">(</span><span class="ident" id="8112263">w</span><span class="op" id="8112264">,</span>&nbsp;<span class="string" id="8112266">&#34;unknown&nbsp;PNG&nbsp;decoder&nbsp;color&nbsp;model\n&#34;</span><span class="op" id="8112301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112307">io</span><span class="op" id="8112309">.</span><span class="ident" id="8112310">WriteString</span><span class="op" id="8112321">(</span><span class="ident" id="8112322">w</span><span class="op" id="8112323">,</span>&nbsp;<span class="string" id="8112325">&#34;}\n&#34;</span><span class="op" id="8112330">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8112334">//&nbsp;We&nbsp;fake&nbsp;a&nbsp;gAMA&nbsp;output.&nbsp;The&nbsp;test&nbsp;files&nbsp;have&nbsp;a&nbsp;gAMA&nbsp;chunk&nbsp;but&nbsp;the&nbsp;go&nbsp;PNG&nbsp;parser&nbsp;ignores&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8112427">//&nbsp;(the&nbsp;PNG&nbsp;spec&nbsp;section&nbsp;11.3&nbsp;says&nbsp;&#34;Ancillary&nbsp;chunks&nbsp;may&nbsp;be&nbsp;ignored&nbsp;by&nbsp;a&nbsp;decoder&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112512">io</span><span class="op" id="8112514">.</span><span class="ident" id="8112515">WriteString</span><span class="op" id="8112526">(</span><span class="ident" id="8112527">w</span><span class="op" id="8112528">,</span>&nbsp;<span class="string" id="8112530">&#34;gAMA&nbsp;{1.0000}\n&#34;</span><span class="op" id="8112547">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8112551">//&nbsp;Write&nbsp;the&nbsp;PLTE&nbsp;and&nbsp;tRNS&nbsp;(if&nbsp;applicable).</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112596">if</span>&nbsp;<span class="ident" id="8112599">cpm</span>&nbsp;<span class="op" id="8112603">!=</span>&nbsp;<span class="ident" id="8112606">nil</span>&nbsp;<span class="op" id="8112610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112614">lastAlpha</span>&nbsp;<span class="op" id="8112624">:=</span>&nbsp;<span class="op" id="8112627">-</span><span class="num" id="8112628">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112632">io</span><span class="op" id="8112634">.</span><span class="ident" id="8112635">WriteString</span><span class="op" id="8112646">(</span><span class="ident" id="8112647">w</span><span class="op" id="8112648">,</span>&nbsp;<span class="string" id="8112650">&#34;PLTE&nbsp;{\n&#34;</span><span class="op" id="8112660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112664">for</span>&nbsp;<span class="ident" id="8112668">i</span><span class="op" id="8112669">,</span>&nbsp;<span class="ident" id="8112671">c</span>&nbsp;<span class="op" id="8112673">:=</span>&nbsp;<span class="keyword" id="8112676">range</span>&nbsp;<span class="ident" id="8112682">cpm</span>&nbsp;<span class="op" id="8112686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112691">var</span>&nbsp;<span class="ident" id="8112695">r</span><span class="op" id="8112696">,</span>&nbsp;<span class="ident" id="8112698">g</span><span class="op" id="8112699">,</span>&nbsp;<span class="ident" id="8112701">b</span><span class="op" id="8112702">,</span>&nbsp;<span class="ident" id="8112704">a</span>&nbsp;<span class="builtintype" id="8112706">uint8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112715">switch</span>&nbsp;<span class="ident" id="8112722">c</span>&nbsp;<span class="op" id="8112724">:=</span>&nbsp;<span class="ident" id="8112727">c</span><span class="op" id="8112728">.</span><span class="op" id="8112729">(</span><span class="keyword" id="8112730">type</span><span class="op" id="8112734">)</span>&nbsp;<span class="op" id="8112736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112741">case</span>&nbsp;<span class="ident" id="8112746">color</span><span class="op" id="8112751">.</span><span class="ident" id="8112752">RGBA</span><span class="op" id="8112756">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112762">r</span><span class="op" id="8112763">,</span>&nbsp;<span class="ident" id="8112765">g</span><span class="op" id="8112766">,</span>&nbsp;<span class="ident" id="8112768">b</span><span class="op" id="8112769">,</span>&nbsp;<span class="ident" id="8112771">a</span>&nbsp;<span class="op" id="8112773">=</span>&nbsp;<span class="ident" id="8112775">c</span><span class="op" id="8112776">.</span><span class="ident" id="8112777">R</span><span class="op" id="8112778">,</span>&nbsp;<span class="ident" id="8112780">c</span><span class="op" id="8112781">.</span><span class="ident" id="8112782">G</span><span class="op" id="8112783">,</span>&nbsp;<span class="ident" id="8112785">c</span><span class="op" id="8112786">.</span><span class="ident" id="8112787">B</span><span class="op" id="8112788">,</span>&nbsp;<span class="num" id="8112790">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112798">case</span>&nbsp;<span class="ident" id="8112803">color</span><span class="op" id="8112808">.</span><span class="ident" id="8112809">NRGBA</span><span class="op" id="8112814">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112820">r</span><span class="op" id="8112821">,</span>&nbsp;<span class="ident" id="8112823">g</span><span class="op" id="8112824">,</span>&nbsp;<span class="ident" id="8112826">b</span><span class="op" id="8112827">,</span>&nbsp;<span class="ident" id="8112829">a</span>&nbsp;<span class="op" id="8112831">=</span>&nbsp;<span class="ident" id="8112833">c</span><span class="op" id="8112834">.</span><span class="ident" id="8112835">R</span><span class="op" id="8112836">,</span>&nbsp;<span class="ident" id="8112838">c</span><span class="op" id="8112839">.</span><span class="ident" id="8112840">G</span><span class="op" id="8112841">,</span>&nbsp;<span class="ident" id="8112843">c</span><span class="op" id="8112844">.</span><span class="ident" id="8112845">B</span><span class="op" id="8112846">,</span>&nbsp;<span class="ident" id="8112848">c</span><span class="op" id="8112849">.</span><span class="ident" id="8112850">A</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112855">default</span><span class="op" id="8112862">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8112868">panic</span><span class="op" id="8112873">(</span><span class="string" id="8112874">&#34;unknown&nbsp;palette&nbsp;color&nbsp;type&#34;</span><span class="op" id="8112902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112912">if</span>&nbsp;<span class="ident" id="8112915">a</span>&nbsp;<span class="op" id="8112917">!=</span>&nbsp;<span class="num" id="8112920">0xff</span>&nbsp;<span class="op" id="8112925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112931">lastAlpha</span>&nbsp;<span class="op" id="8112941">=</span>&nbsp;<span class="ident" id="8112943">i</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112953">fmt</span><span class="op" id="8112956">.</span><span class="ident" id="8112957">Fprintf</span><span class="op" id="8112964">(</span><span class="ident" id="8112965">w</span><span class="op" id="8112966">,</span>&nbsp;<span class="string" id="8112968">&#34;&nbsp;&nbsp;&nbsp;&nbsp;(%3d,%3d,%3d)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;rgb&nbsp;=&nbsp;(0x%02x,0x%02x,0x%02x)\n&#34;</span><span class="op" id="8113024">,</span>&nbsp;<span class="ident" id="8113026">r</span><span class="op" id="8113027">,</span>&nbsp;<span class="ident" id="8113029">g</span><span class="op" id="8113030">,</span>&nbsp;<span class="ident" id="8113032">b</span><span class="op" id="8113033">,</span>&nbsp;<span class="ident" id="8113035">r</span><span class="op" id="8113036">,</span>&nbsp;<span class="ident" id="8113038">g</span><span class="op" id="8113039">,</span>&nbsp;<span class="ident" id="8113041">b</span><span class="op" id="8113042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113050">io</span><span class="op" id="8113052">.</span><span class="ident" id="8113053">WriteString</span><span class="op" id="8113064">(</span><span class="ident" id="8113065">w</span><span class="op" id="8113066">,</span>&nbsp;<span class="string" id="8113068">&#34;}\n&#34;</span><span class="op" id="8113073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113077">if</span>&nbsp;<span class="ident" id="8113080">lastAlpha</span>&nbsp;<span class="op" id="8113090">!=</span>&nbsp;<span class="op" id="8113093">-</span><span class="num" id="8113094">1</span>&nbsp;<span class="op" id="8113096">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113101">io</span><span class="op" id="8113103">.</span><span class="ident" id="8113104">WriteString</span><span class="op" id="8113115">(</span><span class="ident" id="8113116">w</span><span class="op" id="8113117">,</span>&nbsp;<span class="string" id="8113119">&#34;tRNS&nbsp;{\n&#34;</span><span class="op" id="8113129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113134">for</span>&nbsp;<span class="ident" id="8113138">i</span>&nbsp;<span class="op" id="8113140">:=</span>&nbsp;<span class="num" id="8113143">0</span><span class="op" id="8113144">;</span>&nbsp;<span class="ident" id="8113146">i</span>&nbsp;<span class="op" id="8113148">&lt;=</span>&nbsp;<span class="ident" id="8113151">lastAlpha</span><span class="op" id="8113160">;</span>&nbsp;<span class="ident" id="8113162">i</span><span class="op" id="8113163">++</span>&nbsp;<span class="op" id="8113166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113172">_</span><span class="op" id="8113173">,</span>&nbsp;<span class="ident" id="8113175">_</span><span class="op" id="8113176">,</span>&nbsp;<span class="ident" id="8113178">_</span><span class="op" id="8113179">,</span>&nbsp;<span class="ident" id="8113181">a</span>&nbsp;<span class="op" id="8113183">:=</span>&nbsp;<span class="ident" id="8113186">cpm</span><span class="op" id="8113189">[</span><span class="ident" id="8113190">i</span><span class="op" id="8113191">]</span><span class="op" id="8113192">.</span><span class="ident" id="8113193">RGBA</span><span class="op" id="8113197">(</span><span class="op" id="8113198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113204">a</span>&nbsp;<span class="op" id="8113206">&gt;&gt;=</span>&nbsp;<span class="num" id="8113210">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113216">fmt</span><span class="op" id="8113219">.</span><span class="ident" id="8113220">Fprintf</span><span class="op" id="8113227">(</span><span class="ident" id="8113228">w</span><span class="op" id="8113229">,</span>&nbsp;<span class="string" id="8113231">&#34;&nbsp;%d&#34;</span><span class="op" id="8113236">,</span>&nbsp;<span class="ident" id="8113238">a</span><span class="op" id="8113239">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113249">io</span><span class="op" id="8113251">.</span><span class="ident" id="8113252">WriteString</span><span class="op" id="8113263">(</span><span class="ident" id="8113264">w</span><span class="op" id="8113265">,</span>&nbsp;<span class="string" id="8113267">&#34;}\n&#34;</span><span class="op" id="8113272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8113283">//&nbsp;Write&nbsp;the&nbsp;IMAGE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113304">io</span><span class="op" id="8113306">.</span><span class="ident" id="8113307">WriteString</span><span class="op" id="8113318">(</span><span class="ident" id="8113319">w</span><span class="op" id="8113320">,</span>&nbsp;<span class="string" id="8113322">&#34;IMAGE&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;pixels&nbsp;hex\n&#34;</span><span class="op" id="8113349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113352">for</span>&nbsp;<span class="ident" id="8113356">y</span>&nbsp;<span class="op" id="8113358">:=</span>&nbsp;<span class="ident" id="8113361">bounds</span><span class="op" id="8113367">.</span><span class="ident" id="8113368">Min</span><span class="op" id="8113371">.</span><span class="ident" id="8113372">Y</span><span class="op" id="8113373">;</span>&nbsp;<span class="ident" id="8113375">y</span>&nbsp;<span class="op" id="8113377">&lt;</span>&nbsp;<span class="ident" id="8113379">bounds</span><span class="op" id="8113385">.</span><span class="ident" id="8113386">Max</span><span class="op" id="8113389">.</span><span class="ident" id="8113390">Y</span><span class="op" id="8113391">;</span>&nbsp;<span class="ident" id="8113393">y</span><span class="op" id="8113394">++</span>&nbsp;<span class="op" id="8113397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113401">switch</span>&nbsp;<span class="op" id="8113408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113412">case</span>&nbsp;<span class="ident" id="8113417">cm</span>&nbsp;<span class="op" id="8113420">==</span>&nbsp;<span class="ident" id="8113423">color</span><span class="op" id="8113428">.</span><span class="ident" id="8113429">GrayModel</span><span class="op" id="8113438">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113443">for</span>&nbsp;<span class="ident" id="8113447">x</span>&nbsp;<span class="op" id="8113449">:=</span>&nbsp;<span class="ident" id="8113452">bounds</span><span class="op" id="8113458">.</span><span class="ident" id="8113459">Min</span><span class="op" id="8113462">.</span><span class="ident" id="8113463">X</span><span class="op" id="8113464">;</span>&nbsp;<span class="ident" id="8113466">x</span>&nbsp;<span class="op" id="8113468">&lt;</span>&nbsp;<span class="ident" id="8113470">bounds</span><span class="op" id="8113476">.</span><span class="ident" id="8113477">Max</span><span class="op" id="8113480">.</span><span class="ident" id="8113481">X</span><span class="op" id="8113482">;</span>&nbsp;<span class="ident" id="8113484">x</span><span class="op" id="8113485">++</span>&nbsp;<span class="op" id="8113488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113494">gray</span>&nbsp;<span class="op" id="8113499">:=</span>&nbsp;<span class="ident" id="8113502">png</span><span class="op" id="8113505">.</span><span class="ident" id="8113506">At</span><span class="op" id="8113508">(</span><span class="ident" id="8113509">x</span><span class="op" id="8113510">,</span>&nbsp;<span class="ident" id="8113512">y</span><span class="op" id="8113513">)</span><span class="op" id="8113514">.</span><span class="op" id="8113515">(</span><span class="ident" id="8113516">color</span><span class="op" id="8113521">.</span><span class="ident" id="8113522">Gray</span><span class="op" id="8113526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113532">fmt</span><span class="op" id="8113535">.</span><span class="ident" id="8113536">Fprintf</span><span class="op" id="8113543">(</span><span class="ident" id="8113544">w</span><span class="op" id="8113545">,</span>&nbsp;<span class="string" id="8113547">&#34;%02x&#34;</span><span class="op" id="8113553">,</span>&nbsp;<span class="ident" id="8113555">gray</span><span class="op" id="8113559">.</span><span class="ident" id="8113560">Y</span><span class="op" id="8113561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113570">case</span>&nbsp;<span class="ident" id="8113575">cm</span>&nbsp;<span class="op" id="8113578">==</span>&nbsp;<span class="ident" id="8113581">color</span><span class="op" id="8113586">.</span><span class="ident" id="8113587">Gray16Model</span><span class="op" id="8113598">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113603">for</span>&nbsp;<span class="ident" id="8113607">x</span>&nbsp;<span class="op" id="8113609">:=</span>&nbsp;<span class="ident" id="8113612">bounds</span><span class="op" id="8113618">.</span><span class="ident" id="8113619">Min</span><span class="op" id="8113622">.</span><span class="ident" id="8113623">X</span><span class="op" id="8113624">;</span>&nbsp;<span class="ident" id="8113626">x</span>&nbsp;<span class="op" id="8113628">&lt;</span>&nbsp;<span class="ident" id="8113630">bounds</span><span class="op" id="8113636">.</span><span class="ident" id="8113637">Max</span><span class="op" id="8113640">.</span><span class="ident" id="8113641">X</span><span class="op" id="8113642">;</span>&nbsp;<span class="ident" id="8113644">x</span><span class="op" id="8113645">++</span>&nbsp;<span class="op" id="8113648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113654">gray16</span>&nbsp;<span class="op" id="8113661">:=</span>&nbsp;<span class="ident" id="8113664">png</span><span class="op" id="8113667">.</span><span class="ident" id="8113668">At</span><span class="op" id="8113670">(</span><span class="ident" id="8113671">x</span><span class="op" id="8113672">,</span>&nbsp;<span class="ident" id="8113674">y</span><span class="op" id="8113675">)</span><span class="op" id="8113676">.</span><span class="op" id="8113677">(</span><span class="ident" id="8113678">color</span><span class="op" id="8113683">.</span><span class="ident" id="8113684">Gray16</span><span class="op" id="8113690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113696">fmt</span><span class="op" id="8113699">.</span><span class="ident" id="8113700">Fprintf</span><span class="op" id="8113707">(</span><span class="ident" id="8113708">w</span><span class="op" id="8113709">,</span>&nbsp;<span class="string" id="8113711">&#34;%04x&nbsp;&#34;</span><span class="op" id="8113718">,</span>&nbsp;<span class="ident" id="8113720">gray16</span><span class="op" id="8113726">.</span><span class="ident" id="8113727">Y</span><span class="op" id="8113728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113737">case</span>&nbsp;<span class="ident" id="8113742">cm</span>&nbsp;<span class="op" id="8113745">==</span>&nbsp;<span class="ident" id="8113748">color</span><span class="op" id="8113753">.</span><span class="ident" id="8113754">RGBAModel</span><span class="op" id="8113763">:</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113768">for</span>&nbsp;<span class="ident" id="8113772">x</span>&nbsp;<span class="op" id="8113774">:=</span>&nbsp;<span class="ident" id="8113777">bounds</span><span class="op" id="8113783">.</span><span class="ident" id="8113784">Min</span><span class="op" id="8113787">.</span><span class="ident" id="8113788">X</span><span class="op" id="8113789">;</span>&nbsp;<span class="ident" id="8113791">x</span>&nbsp;<span class="op" id="8113793">&lt;</span>&nbsp;<span class="ident" id="8113795">bounds</span><span class="op" id="8113801">.</span><span class="ident" id="8113802">Max</span><span class="op" id="8113805">.</span><span class="ident" id="8113806">X</span><span class="op" id="8113807">;</span>&nbsp;<span class="ident" id="8113809">x</span><span class="op" id="8113810">++</span>&nbsp;<span class="op" id="8113813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113819">rgba</span>&nbsp;<span class="op" id="8113824">:=</span>&nbsp;<span class="ident" id="8113827">png</span><span class="op" id="8113830">.</span><span class="ident" id="8113831">At</span><span class="op" id="8113833">(</span><span class="ident" id="8113834">x</span><span class="op" id="8113835">,</span>&nbsp;<span class="ident" id="8113837">y</span><span class="op" id="8113838">)</span><span class="op" id="8113839">.</span><span class="op" id="8113840">(</span><span class="ident" id="8113841">color</span><span class="op" id="8113846">.</span><span class="ident" id="8113847">RGBA</span><span class="op" id="8113851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113857">fmt</span><span class="op" id="8113860">.</span><span class="ident" id="8113861">Fprintf</span><span class="op" id="8113868">(</span><span class="ident" id="8113869">w</span><span class="op" id="8113870">,</span>&nbsp;<span class="string" id="8113872">&#34;%02x%02x%02x&nbsp;&#34;</span><span class="op" id="8113887">,</span>&nbsp;<span class="ident" id="8113889">rgba</span><span class="op" id="8113893">.</span><span class="ident" id="8113894">R</span><span class="op" id="8113895">,</span>&nbsp;<span class="ident" id="8113897">rgba</span><span class="op" id="8113901">.</span><span class="ident" id="8113902">G</span><span class="op" id="8113903">,</span>&nbsp;<span class="ident" id="8113905">rgba</span><span class="op" id="8113909">.</span><span class="ident" id="8113910">B</span><span class="op" id="8113911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113920">case</span>&nbsp;<span class="ident" id="8113925">cm</span>&nbsp;<span class="op" id="8113928">==</span>&nbsp;<span class="ident" id="8113931">color</span><span class="op" id="8113936">.</span><span class="ident" id="8113937">RGBA64Model</span><span class="op" id="8113948">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113953">for</span>&nbsp;<span class="ident" id="8113957">x</span>&nbsp;<span class="op" id="8113959">:=</span>&nbsp;<span class="ident" id="8113962">bounds</span><span class="op" id="8113968">.</span><span class="ident" id="8113969">Min</span><span class="op" id="8113972">.</span><span class="ident" id="8113973">X</span><span class="op" id="8113974">;</span>&nbsp;<span class="ident" id="8113976">x</span>&nbsp;<span class="op" id="8113978">&lt;</span>&nbsp;<span class="ident" id="8113980">bounds</span><span class="op" id="8113986">.</span><span class="ident" id="8113987">Max</span><span class="op" id="8113990">.</span><span class="ident" id="8113991">X</span><span class="op" id="8113992">;</span>&nbsp;<span class="ident" id="8113994">x</span><span class="op" id="8113995">++</span>&nbsp;<span class="op" id="8113998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114004">rgba64</span>&nbsp;<span class="op" id="8114011">:=</span>&nbsp;<span class="ident" id="8114014">png</span><span class="op" id="8114017">.</span><span class="ident" id="8114018">At</span><span class="op" id="8114020">(</span><span class="ident" id="8114021">x</span><span class="op" id="8114022">,</span>&nbsp;<span class="ident" id="8114024">y</span><span class="op" id="8114025">)</span><span class="op" id="8114026">.</span><span class="op" id="8114027">(</span><span class="ident" id="8114028">color</span><span class="op" id="8114033">.</span><span class="ident" id="8114034">RGBA64</span><span class="op" id="8114040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114046">fmt</span><span class="op" id="8114049">.</span><span class="ident" id="8114050">Fprintf</span><span class="op" id="8114057">(</span><span class="ident" id="8114058">w</span><span class="op" id="8114059">,</span>&nbsp;<span class="string" id="8114061">&#34;%04x%04x%04x&nbsp;&#34;</span><span class="op" id="8114076">,</span>&nbsp;<span class="ident" id="8114078">rgba64</span><span class="op" id="8114084">.</span><span class="ident" id="8114085">R</span><span class="op" id="8114086">,</span>&nbsp;<span class="ident" id="8114088">rgba64</span><span class="op" id="8114094">.</span><span class="ident" id="8114095">G</span><span class="op" id="8114096">,</span>&nbsp;<span class="ident" id="8114098">rgba64</span><span class="op" id="8114104">.</span><span class="ident" id="8114105">B</span><span class="op" id="8114106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114115">case</span>&nbsp;<span class="ident" id="8114120">cm</span>&nbsp;<span class="op" id="8114123">==</span>&nbsp;<span class="ident" id="8114126">color</span><span class="op" id="8114131">.</span><span class="ident" id="8114132">NRGBAModel</span><span class="op" id="8114142">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114147">for</span>&nbsp;<span class="ident" id="8114151">x</span>&nbsp;<span class="op" id="8114153">:=</span>&nbsp;<span class="ident" id="8114156">bounds</span><span class="op" id="8114162">.</span><span class="ident" id="8114163">Min</span><span class="op" id="8114166">.</span><span class="ident" id="8114167">X</span><span class="op" id="8114168">;</span>&nbsp;<span class="ident" id="8114170">x</span>&nbsp;<span class="op" id="8114172">&lt;</span>&nbsp;<span class="ident" id="8114174">bounds</span><span class="op" id="8114180">.</span><span class="ident" id="8114181">Max</span><span class="op" id="8114184">.</span><span class="ident" id="8114185">X</span><span class="op" id="8114186">;</span>&nbsp;<span class="ident" id="8114188">x</span><span class="op" id="8114189">++</span>&nbsp;<span class="op" id="8114192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114198">nrgba</span>&nbsp;<span class="op" id="8114204">:=</span>&nbsp;<span class="ident" id="8114207">png</span><span class="op" id="8114210">.</span><span class="ident" id="8114211">At</span><span class="op" id="8114213">(</span><span class="ident" id="8114214">x</span><span class="op" id="8114215">,</span>&nbsp;<span class="ident" id="8114217">y</span><span class="op" id="8114218">)</span><span class="op" id="8114219">.</span><span class="op" id="8114220">(</span><span class="ident" id="8114221">color</span><span class="op" id="8114226">.</span><span class="ident" id="8114227">NRGBA</span><span class="op" id="8114232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114238">fmt</span><span class="op" id="8114241">.</span><span class="ident" id="8114242">Fprintf</span><span class="op" id="8114249">(</span><span class="ident" id="8114250">w</span><span class="op" id="8114251">,</span>&nbsp;<span class="string" id="8114253">&#34;%02x%02x%02x%02x&nbsp;&#34;</span><span class="op" id="8114272">,</span>&nbsp;<span class="ident" id="8114274">nrgba</span><span class="op" id="8114279">.</span><span class="ident" id="8114280">R</span><span class="op" id="8114281">,</span>&nbsp;<span class="ident" id="8114283">nrgba</span><span class="op" id="8114288">.</span><span class="ident" id="8114289">G</span><span class="op" id="8114290">,</span>&nbsp;<span class="ident" id="8114292">nrgba</span><span class="op" id="8114297">.</span><span class="ident" id="8114298">B</span><span class="op" id="8114299">,</span>&nbsp;<span class="ident" id="8114301">nrgba</span><span class="op" id="8114306">.</span><span class="ident" id="8114307">A</span><span class="op" id="8114308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114317">case</span>&nbsp;<span class="ident" id="8114322">cm</span>&nbsp;<span class="op" id="8114325">==</span>&nbsp;<span class="ident" id="8114328">color</span><span class="op" id="8114333">.</span><span class="ident" id="8114334">NRGBA64Model</span><span class="op" id="8114346">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114351">for</span>&nbsp;<span class="ident" id="8114355">x</span>&nbsp;<span class="op" id="8114357">:=</span>&nbsp;<span class="ident" id="8114360">bounds</span><span class="op" id="8114366">.</span><span class="ident" id="8114367">Min</span><span class="op" id="8114370">.</span><span class="ident" id="8114371">X</span><span class="op" id="8114372">;</span>&nbsp;<span class="ident" id="8114374">x</span>&nbsp;<span class="op" id="8114376">&lt;</span>&nbsp;<span class="ident" id="8114378">bounds</span><span class="op" id="8114384">.</span><span class="ident" id="8114385">Max</span><span class="op" id="8114388">.</span><span class="ident" id="8114389">X</span><span class="op" id="8114390">;</span>&nbsp;<span class="ident" id="8114392">x</span><span class="op" id="8114393">++</span>&nbsp;<span class="op" id="8114396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114402">nrgba64</span>&nbsp;<span class="op" id="8114410">:=</span>&nbsp;<span class="ident" id="8114413">png</span><span class="op" id="8114416">.</span><span class="ident" id="8114417">At</span><span class="op" id="8114419">(</span><span class="ident" id="8114420">x</span><span class="op" id="8114421">,</span>&nbsp;<span class="ident" id="8114423">y</span><span class="op" id="8114424">)</span><span class="op" id="8114425">.</span><span class="op" id="8114426">(</span><span class="ident" id="8114427">color</span><span class="op" id="8114432">.</span><span class="ident" id="8114433">NRGBA64</span><span class="op" id="8114440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114446">fmt</span><span class="op" id="8114449">.</span><span class="ident" id="8114450">Fprintf</span><span class="op" id="8114457">(</span><span class="ident" id="8114458">w</span><span class="op" id="8114459">,</span>&nbsp;<span class="string" id="8114461">&#34;%04x%04x%04x%04x&nbsp;&#34;</span><span class="op" id="8114480">,</span>&nbsp;<span class="ident" id="8114482">nrgba64</span><span class="op" id="8114489">.</span><span class="ident" id="8114490">R</span><span class="op" id="8114491">,</span>&nbsp;<span class="ident" id="8114493">nrgba64</span><span class="op" id="8114500">.</span><span class="ident" id="8114501">G</span><span class="op" id="8114502">,</span>&nbsp;<span class="ident" id="8114504">nrgba64</span><span class="op" id="8114511">.</span><span class="ident" id="8114512">B</span><span class="op" id="8114513">,</span>&nbsp;<span class="ident" id="8114515">nrgba64</span><span class="op" id="8114522">.</span><span class="ident" id="8114523">A</span><span class="op" id="8114524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114533">case</span>&nbsp;<span class="ident" id="8114538">cpm</span>&nbsp;<span class="op" id="8114542">!=</span>&nbsp;<span class="ident" id="8114545">nil</span><span class="op" id="8114548">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114553">var</span>&nbsp;<span class="ident" id="8114557">b</span><span class="op" id="8114558">,</span>&nbsp;<span class="ident" id="8114560">c</span>&nbsp;<span class="builtintype" id="8114562">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114569">for</span>&nbsp;<span class="ident" id="8114573">x</span>&nbsp;<span class="op" id="8114575">:=</span>&nbsp;<span class="ident" id="8114578">bounds</span><span class="op" id="8114584">.</span><span class="ident" id="8114585">Min</span><span class="op" id="8114588">.</span><span class="ident" id="8114589">X</span><span class="op" id="8114590">;</span>&nbsp;<span class="ident" id="8114592">x</span>&nbsp;<span class="op" id="8114594">&lt;</span>&nbsp;<span class="ident" id="8114596">bounds</span><span class="op" id="8114602">.</span><span class="ident" id="8114603">Max</span><span class="op" id="8114606">.</span><span class="ident" id="8114607">X</span><span class="op" id="8114608">;</span>&nbsp;<span class="ident" id="8114610">x</span><span class="op" id="8114611">++</span>&nbsp;<span class="op" id="8114614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114620">b</span>&nbsp;<span class="op" id="8114622">=</span>&nbsp;<span class="ident" id="8114624">b</span><span class="op" id="8114625">&lt;&lt;</span><span class="builtintype" id="8114627">uint</span><span class="op" id="8114631">(</span><span class="ident" id="8114632">bitdepth</span><span class="op" id="8114640">)</span>&nbsp;<span class="op" id="8114642">|</span>&nbsp;<span class="builtintype" id="8114644">int</span><span class="op" id="8114647">(</span><span class="ident" id="8114648">paletted</span><span class="op" id="8114656">.</span><span class="ident" id="8114657">ColorIndexAt</span><span class="op" id="8114669">(</span><span class="ident" id="8114670">x</span><span class="op" id="8114671">,</span>&nbsp;<span class="ident" id="8114673">y</span><span class="op" id="8114674">)</span><span class="op" id="8114675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114681">c</span><span class="op" id="8114682">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114689">if</span>&nbsp;<span class="ident" id="8114692">c</span>&nbsp;<span class="op" id="8114694">==</span>&nbsp;<span class="num" id="8114697">8</span><span class="op" id="8114698">/</span><span class="ident" id="8114699">bitdepth</span>&nbsp;<span class="op" id="8114708">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114715">fmt</span><span class="op" id="8114718">.</span><span class="ident" id="8114719">Fprintf</span><span class="op" id="8114726">(</span><span class="ident" id="8114727">w</span><span class="op" id="8114728">,</span>&nbsp;<span class="string" id="8114730">&#34;%02x&#34;</span><span class="op" id="8114736">,</span>&nbsp;<span class="ident" id="8114738">b</span><span class="op" id="8114739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114746">b</span>&nbsp;<span class="op" id="8114748">=</span>&nbsp;<span class="num" id="8114750">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114757">c</span>&nbsp;<span class="op" id="8114759">=</span>&nbsp;<span class="num" id="8114761">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114772">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114777">if</span>&nbsp;<span class="ident" id="8114780">c</span>&nbsp;<span class="op" id="8114782">!=</span>&nbsp;<span class="num" id="8114785">0</span>&nbsp;<span class="op" id="8114787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114793">for</span>&nbsp;<span class="ident" id="8114797">c</span>&nbsp;<span class="op" id="8114799">!=</span>&nbsp;<span class="num" id="8114802">8</span><span class="op" id="8114803">/</span><span class="ident" id="8114804">bitdepth</span>&nbsp;<span class="op" id="8114813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114820">b</span>&nbsp;<span class="op" id="8114822">=</span>&nbsp;<span class="ident" id="8114824">b</span>&nbsp;<span class="op" id="8114826">&lt;&lt;</span>&nbsp;<span class="builtintype" id="8114829">uint</span><span class="op" id="8114833">(</span><span class="ident" id="8114834">bitdepth</span><span class="op" id="8114842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114849">c</span><span class="op" id="8114850">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114857">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114863">fmt</span><span class="op" id="8114866">.</span><span class="ident" id="8114867">Fprintf</span><span class="op" id="8114874">(</span><span class="ident" id="8114875">w</span><span class="op" id="8114876">,</span>&nbsp;<span class="string" id="8114878">&#34;%02x&#34;</span><span class="op" id="8114884">,</span>&nbsp;<span class="ident" id="8114886">b</span><span class="op" id="8114887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114900">io</span><span class="op" id="8114902">.</span><span class="ident" id="8114903">WriteString</span><span class="op" id="8114914">(</span><span class="ident" id="8114915">w</span><span class="op" id="8114916">,</span>&nbsp;<span class="string" id="8114918">&#34;\n&#34;</span><span class="op" id="8114922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114925">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114928">io</span><span class="op" id="8114930">.</span><span class="ident" id="8114931">WriteString</span><span class="op" id="8114942">(</span><span class="ident" id="8114943">w</span><span class="op" id="8114944">,</span>&nbsp;<span class="string" id="8114946">&#34;}\n&#34;</span><span class="op" id="8114951">)</span><br>
<span class="lineno"></span><span class="op" id="8114953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8114956">func</span>&nbsp;<span class="ident" id="8114961">TestReader</span><span class="op" id="8114971">(</span><span class="ident" id="8114972">t</span>&nbsp;<span class="op" id="8114974">*</span><span class="ident" id="8114975">testing</span><span class="op" id="8114982">.</span><span class="ident" id="8114983">T</span><span class="op" id="8114984">)</span>&nbsp;<span class="op" id="8114986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114989">names</span>&nbsp;<span class="op" id="8114995">:=</span>&nbsp;<span class="ident" id="8114998">filenames</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115009">if</span>&nbsp;<span class="ident" id="8115012">testing</span><span class="op" id="8115019">.</span><span class="ident" id="8115020">Short</span><span class="op" id="8115025">(</span><span class="op" id="8115026">)</span>&nbsp;<span class="op" id="8115028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115032">names</span>&nbsp;<span class="op" id="8115038">=</span>&nbsp;<span class="ident" id="8115040">filenamesShort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115059">for</span>&nbsp;<span class="ident" id="8115063">_</span><span class="op" id="8115064">,</span>&nbsp;<span class="ident" id="8115066">fn</span>&nbsp;<span class="op" id="8115069">:=</span>&nbsp;<span class="keyword" id="8115072">range</span>&nbsp;<span class="ident" id="8115078">names</span>&nbsp;<span class="op" id="8115084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8115088">//&nbsp;Read&nbsp;the&nbsp;.png&nbsp;file.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115113">img</span><span class="op" id="8115116">,</span>&nbsp;<span class="ident" id="8115118">err</span>&nbsp;<span class="op" id="8115122">:=</span>&nbsp;<span class="ident" id="8115125">readPNG</span><span class="op" id="8115132">(</span><span class="string" id="8115133">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="8115154">+</span>&nbsp;<span class="ident" id="8115156">fn</span>&nbsp;<span class="op" id="8115159">+</span>&nbsp;<span class="string" id="8115161">&#34;.png&#34;</span><span class="op" id="8115167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115171">if</span>&nbsp;<span class="ident" id="8115174">err</span>&nbsp;<span class="op" id="8115178">!=</span>&nbsp;<span class="ident" id="8115181">nil</span>&nbsp;<span class="op" id="8115185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115190">t</span><span class="op" id="8115191">.</span><span class="ident" id="8115192">Error</span><span class="op" id="8115197">(</span><span class="ident" id="8115198">fn</span><span class="op" id="8115200">,</span>&nbsp;<span class="ident" id="8115202">err</span><span class="op" id="8115205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115210">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115221">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115226">if</span>&nbsp;<span class="ident" id="8115229">fn</span>&nbsp;<span class="op" id="8115232">==</span>&nbsp;<span class="string" id="8115235">&#34;basn4a16&#34;</span>&nbsp;<span class="op" id="8115246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8115251">//&nbsp;basn4a16.sng&nbsp;is&nbsp;gray&nbsp;+&nbsp;alpha&nbsp;but&nbsp;sng()&nbsp;will&nbsp;produce&nbsp;true&nbsp;color&nbsp;+&nbsp;alpha</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8115328">//&nbsp;so&nbsp;we&nbsp;just&nbsp;check&nbsp;a&nbsp;single&nbsp;random&nbsp;pixel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115374">c</span>&nbsp;<span class="op" id="8115376">:=</span>&nbsp;<span class="ident" id="8115379">img</span><span class="op" id="8115382">.</span><span class="ident" id="8115383">At</span><span class="op" id="8115385">(</span><span class="num" id="8115386">2</span><span class="op" id="8115387">,</span>&nbsp;<span class="num" id="8115389">1</span><span class="op" id="8115390">)</span><span class="op" id="8115391">.</span><span class="op" id="8115392">(</span><span class="ident" id="8115393">color</span><span class="op" id="8115398">.</span><span class="ident" id="8115399">NRGBA64</span><span class="op" id="8115406">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115411">if</span>&nbsp;<span class="ident" id="8115414">c</span><span class="op" id="8115415">.</span><span class="ident" id="8115416">R</span>&nbsp;<span class="op" id="8115418">!=</span>&nbsp;<span class="num" id="8115421">0x11a7</span>&nbsp;<span class="op" id="8115428">||</span>&nbsp;<span class="ident" id="8115431">c</span><span class="op" id="8115432">.</span><span class="ident" id="8115433">G</span>&nbsp;<span class="op" id="8115435">!=</span>&nbsp;<span class="num" id="8115438">0x11a7</span>&nbsp;<span class="op" id="8115445">||</span>&nbsp;<span class="ident" id="8115448">c</span><span class="op" id="8115449">.</span><span class="ident" id="8115450">B</span>&nbsp;<span class="op" id="8115452">!=</span>&nbsp;<span class="num" id="8115455">0x11a7</span>&nbsp;<span class="op" id="8115462">||</span>&nbsp;<span class="ident" id="8115465">c</span><span class="op" id="8115466">.</span><span class="ident" id="8115467">A</span>&nbsp;<span class="op" id="8115469">!=</span>&nbsp;<span class="num" id="8115472">0x1085</span>&nbsp;<span class="op" id="8115479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115485">t</span><span class="op" id="8115486">.</span><span class="ident" id="8115487">Error</span><span class="op" id="8115492">(</span><span class="ident" id="8115493">fn</span><span class="op" id="8115495">,</span>&nbsp;<span class="ident" id="8115497">fmt</span><span class="op" id="8115500">.</span><span class="ident" id="8115501">Errorf</span><span class="op" id="8115507">(</span><span class="string" id="8115508">&#34;wrong&nbsp;pixel&nbsp;value&nbsp;at&nbsp;(2,&nbsp;1):&nbsp;%x&#34;</span><span class="op" id="8115541">,</span>&nbsp;<span class="ident" id="8115543">c</span><span class="op" id="8115544">)</span><span class="op" id="8115545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115555">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115566">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115571">piper</span><span class="op" id="8115576">,</span>&nbsp;<span class="ident" id="8115578">pipew</span>&nbsp;<span class="op" id="8115584">:=</span>&nbsp;<span class="ident" id="8115587">io</span><span class="op" id="8115589">.</span><span class="ident" id="8115590">Pipe</span><span class="op" id="8115594">(</span><span class="op" id="8115595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115599">pb</span>&nbsp;<span class="op" id="8115602">:=</span>&nbsp;<span class="ident" id="8115605">bufio</span><span class="op" id="8115610">.</span><span class="ident" id="8115611">NewScanner</span><span class="op" id="8115621">(</span><span class="ident" id="8115622">piper</span><span class="op" id="8115627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115631">go</span>&nbsp;<span class="ident" id="8115634">sng</span><span class="op" id="8115637">(</span><span class="ident" id="8115638">pipew</span><span class="op" id="8115643">,</span>&nbsp;<span class="ident" id="8115645">fn</span><span class="op" id="8115647">,</span>&nbsp;<span class="ident" id="8115649">img</span><span class="op" id="8115652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115656">defer</span>&nbsp;<span class="ident" id="8115662">piper</span><span class="op" id="8115667">.</span><span class="ident" id="8115668">Close</span><span class="op" id="8115673">(</span><span class="op" id="8115674">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8115679">//&nbsp;Read&nbsp;the&nbsp;.sng&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115704">sf</span><span class="op" id="8115706">,</span>&nbsp;<span class="ident" id="8115708">err</span>&nbsp;<span class="op" id="8115712">:=</span>&nbsp;<span class="ident" id="8115715">os</span><span class="op" id="8115717">.</span><span class="ident" id="8115718">Open</span><span class="op" id="8115722">(</span><span class="string" id="8115723">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="8115744">+</span>&nbsp;<span class="ident" id="8115746">fn</span>&nbsp;<span class="op" id="8115749">+</span>&nbsp;<span class="string" id="8115751">&#34;.sng&#34;</span><span class="op" id="8115757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115761">if</span>&nbsp;<span class="ident" id="8115764">err</span>&nbsp;<span class="op" id="8115768">!=</span>&nbsp;<span class="ident" id="8115771">nil</span>&nbsp;<span class="op" id="8115775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115780">t</span><span class="op" id="8115781">.</span><span class="ident" id="8115782">Error</span><span class="op" id="8115787">(</span><span class="ident" id="8115788">fn</span><span class="op" id="8115790">,</span>&nbsp;<span class="ident" id="8115792">err</span><span class="op" id="8115795">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115800">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115815">defer</span>&nbsp;<span class="ident" id="8115821">sf</span><span class="op" id="8115823">.</span><span class="ident" id="8115824">Close</span><span class="op" id="8115829">(</span><span class="op" id="8115830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115834">sb</span>&nbsp;<span class="op" id="8115837">:=</span>&nbsp;<span class="ident" id="8115840">bufio</span><span class="op" id="8115845">.</span><span class="ident" id="8115846">NewScanner</span><span class="op" id="8115856">(</span><span class="ident" id="8115857">sf</span><span class="op" id="8115859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115863">if</span>&nbsp;<span class="ident" id="8115866">err</span>&nbsp;<span class="op" id="8115870">!=</span>&nbsp;<span class="ident" id="8115873">nil</span>&nbsp;<span class="op" id="8115877">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115882">t</span><span class="op" id="8115883">.</span><span class="ident" id="8115884">Error</span><span class="op" id="8115889">(</span><span class="ident" id="8115890">fn</span><span class="op" id="8115892">,</span>&nbsp;<span class="ident" id="8115894">err</span><span class="op" id="8115897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115902">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8115918">//&nbsp;Compare&nbsp;the&nbsp;two,&nbsp;in&nbsp;SNG&nbsp;format,&nbsp;line&nbsp;by&nbsp;line.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115969">for</span>&nbsp;<span class="op" id="8115973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115978">pdone</span>&nbsp;<span class="op" id="8115984">:=</span>&nbsp;<span class="op" id="8115987">!</span><span class="ident" id="8115988">pb</span><span class="op" id="8115990">.</span><span class="ident" id="8115991">Scan</span><span class="op" id="8115995">(</span><span class="op" id="8115996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116001">sdone</span>&nbsp;<span class="op" id="8116007">:=</span>&nbsp;<span class="op" id="8116010">!</span><span class="ident" id="8116011">sb</span><span class="op" id="8116013">.</span><span class="ident" id="8116014">Scan</span><span class="op" id="8116018">(</span><span class="op" id="8116019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8116024">if</span>&nbsp;<span class="ident" id="8116027">pdone</span>&nbsp;<span class="op" id="8116033">&amp;&amp;</span>&nbsp;<span class="ident" id="8116036">sdone</span>&nbsp;<span class="op" id="8116042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8116048">break</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8116062">if</span>&nbsp;<span class="ident" id="8116065">pdone</span>&nbsp;<span class="op" id="8116071">||</span>&nbsp;<span class="ident" id="8116074">sdone</span>&nbsp;<span class="op" id="8116080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116086">t</span><span class="op" id="8116087">.</span><span class="ident" id="8116088">Errorf</span><span class="op" id="8116094">(</span><span class="string" id="8116095">&#34;%s:&nbsp;Different&nbsp;sizes&#34;</span><span class="op" id="8116116">,</span>&nbsp;<span class="ident" id="8116118">fn</span><span class="op" id="8116120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8116126">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116135">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116140">ps</span>&nbsp;<span class="op" id="8116143">:=</span>&nbsp;<span class="ident" id="8116146">pb</span><span class="op" id="8116148">.</span><span class="ident" id="8116149">Text</span><span class="op" id="8116153">(</span><span class="op" id="8116154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116159">ss</span>&nbsp;<span class="op" id="8116162">:=</span>&nbsp;<span class="ident" id="8116165">sb</span><span class="op" id="8116167">.</span><span class="ident" id="8116168">Text</span><span class="op" id="8116172">(</span><span class="op" id="8116173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8116178">if</span>&nbsp;<span class="ident" id="8116181">ps</span>&nbsp;<span class="op" id="8116184">!=</span>&nbsp;<span class="ident" id="8116187">ss</span>&nbsp;<span class="op" id="8116190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116196">t</span><span class="op" id="8116197">.</span><span class="ident" id="8116198">Errorf</span><span class="op" id="8116204">(</span><span class="string" id="8116205">&#34;%s:&nbsp;Mismatch\n%sversus\n%s\n&#34;</span><span class="op" id="8116235">,</span>&nbsp;<span class="ident" id="8116237">fn</span><span class="op" id="8116239">,</span>&nbsp;<span class="ident" id="8116241">ps</span><span class="op" id="8116243">,</span>&nbsp;<span class="ident" id="8116245">ss</span><span class="op" id="8116247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8116253">break</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8116270">if</span>&nbsp;<span class="ident" id="8116273">pb</span><span class="op" id="8116275">.</span><span class="ident" id="8116276">Err</span><span class="op" id="8116279">(</span><span class="op" id="8116280">)</span>&nbsp;<span class="op" id="8116282">!=</span>&nbsp;<span class="ident" id="8116285">nil</span>&nbsp;<span class="op" id="8116289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116294">t</span><span class="op" id="8116295">.</span><span class="ident" id="8116296">Error</span><span class="op" id="8116301">(</span><span class="ident" id="8116302">fn</span><span class="op" id="8116304">,</span>&nbsp;<span class="ident" id="8116306">pb</span><span class="op" id="8116308">.</span><span class="ident" id="8116309">Err</span><span class="op" id="8116312">(</span><span class="op" id="8116313">)</span><span class="op" id="8116314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116318">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8116322">if</span>&nbsp;<span class="ident" id="8116325">sb</span><span class="op" id="8116327">.</span><span class="ident" id="8116328">Err</span><span class="op" id="8116331">(</span><span class="op" id="8116332">)</span>&nbsp;<span class="op" id="8116334">!=</span>&nbsp;<span class="ident" id="8116337">nil</span>&nbsp;<span class="op" id="8116341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116346">t</span><span class="op" id="8116347">.</span><span class="ident" id="8116348">Error</span><span class="op" id="8116353">(</span><span class="ident" id="8116354">fn</span><span class="op" id="8116356">,</span>&nbsp;<span class="ident" id="8116358">sb</span><span class="op" id="8116360">.</span><span class="ident" id="8116361">Err</span><span class="op" id="8116364">(</span><span class="op" id="8116365">)</span><span class="op" id="8116366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116373">}</span><br>
<span class="lineno"></span><span class="op" id="8116375">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="8116378">var</span>&nbsp;<span class="ident" id="8116382">readerErrors</span>&nbsp;<span class="op" id="8116395">=</span>&nbsp;<span class="op" id="8116397">[</span><span class="op" id="8116398">]</span><span class="keyword" id="8116399">struct</span>&nbsp;<span class="op" id="8116406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116409">file</span>&nbsp;<span class="builtintype" id="8116414">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116422">err</span>&nbsp;&nbsp;<span class="builtintype" id="8116427">string</span><br>
<span class="lineno"></span><span class="op" id="8116434">}</span><span class="op" id="8116435">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116438">{</span><span class="string" id="8116439">&#34;invalid-zlib.png&#34;</span><span class="op" id="8116457">,</span>&nbsp;<span class="string" id="8116459">&#34;zlib:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="8116483">}</span><span class="op" id="8116484">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116487">{</span><span class="string" id="8116488">&#34;invalid-crc32.png&#34;</span><span class="op" id="8116507">,</span>&nbsp;<span class="string" id="8116509">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="8116527">}</span><span class="op" id="8116528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116531">{</span><span class="string" id="8116532">&#34;invalid-noend.png&#34;</span><span class="op" id="8116551">,</span>&nbsp;<span class="string" id="8116553">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="8116569">}</span><span class="op" id="8116570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116573">{</span><span class="string" id="8116574">&#34;invalid-trunc.png&#34;</span><span class="op" id="8116593">,</span>&nbsp;<span class="string" id="8116595">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="8116611">}</span><span class="op" id="8116612">,</span><br>
<span class="lineno"></span><span class="op" id="8116614">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="8116617">func</span>&nbsp;<span class="ident" id="8116622">TestReaderError</span><span class="op" id="8116637">(</span><span class="ident" id="8116638">t</span>&nbsp;<span class="op" id="8116640">*</span><span class="ident" id="8116641">testing</span><span class="op" id="8116648">.</span><span class="ident" id="8116649">T</span><span class="op" id="8116650">)</span>&nbsp;<span class="op" id="8116652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8116655">for</span>&nbsp;<span class="ident" id="8116659">_</span><span class="op" id="8116660">,</span>&nbsp;<span class="ident" id="8116662">tt</span>&nbsp;<span class="op" id="8116665">:=</span>&nbsp;<span class="keyword" id="8116668">range</span>&nbsp;<span class="ident" id="8116674">readerErrors</span>&nbsp;<span class="op" id="8116687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116691">img</span><span class="op" id="8116694">,</span>&nbsp;<span class="ident" id="8116696">err</span>&nbsp;<span class="op" id="8116700">:=</span>&nbsp;<span class="ident" id="8116703">readPNG</span><span class="op" id="8116710">(</span><span class="string" id="8116711">&#34;testdata/&#34;</span>&nbsp;<span class="op" id="8116723">+</span>&nbsp;<span class="ident" id="8116725">tt</span><span class="op" id="8116727">.</span><span class="ident" id="8116728">file</span><span class="op" id="8116732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8116736">if</span>&nbsp;<span class="ident" id="8116739">err</span>&nbsp;<span class="op" id="8116743">==</span>&nbsp;<span class="ident" id="8116746">nil</span>&nbsp;<span class="op" id="8116750">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116755">t</span><span class="op" id="8116756">.</span><span class="ident" id="8116757">Errorf</span><span class="op" id="8116763">(</span><span class="string" id="8116764">&#34;decoding&nbsp;%s:&nbsp;missing&nbsp;error&#34;</span><span class="op" id="8116792">,</span>&nbsp;<span class="ident" id="8116794">tt</span><span class="op" id="8116796">.</span><span class="ident" id="8116797">file</span><span class="op" id="8116801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8116806">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8116821">if</span>&nbsp;<span class="op" id="8116824">!</span><span class="ident" id="8116825">strings</span><span class="op" id="8116832">.</span><span class="ident" id="8116833">Contains</span><span class="op" id="8116841">(</span><span class="ident" id="8116842">err</span><span class="op" id="8116845">.</span><span class="ident" id="8116846">Error</span><span class="op" id="8116851">(</span><span class="op" id="8116852">)</span><span class="op" id="8116853">,</span>&nbsp;<span class="ident" id="8116855">tt</span><span class="op" id="8116857">.</span><span class="ident" id="8116858">err</span><span class="op" id="8116861">)</span>&nbsp;<span class="op" id="8116863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116868">t</span><span class="op" id="8116869">.</span><span class="ident" id="8116870">Errorf</span><span class="op" id="8116876">(</span><span class="string" id="8116877">&#34;decoding&nbsp;%s:&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8116903">,</span>&nbsp;<span class="ident" id="8116905">tt</span><span class="op" id="8116907">.</span><span class="ident" id="8116908">file</span><span class="op" id="8116912">,</span>&nbsp;<span class="ident" id="8116914">err</span><span class="op" id="8116917">,</span>&nbsp;<span class="ident" id="8116919">tt</span><span class="op" id="8116921">.</span><span class="ident" id="8116922">err</span><span class="op" id="8116925">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8116933">if</span>&nbsp;<span class="ident" id="8116936">img</span>&nbsp;<span class="op" id="8116940">!=</span>&nbsp;<span class="ident" id="8116943">nil</span>&nbsp;<span class="op" id="8116947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116952">t</span><span class="op" id="8116953">.</span><span class="ident" id="8116954">Errorf</span><span class="op" id="8116960">(</span><span class="string" id="8116961">&#34;decoding&nbsp;%s:&nbsp;have&nbsp;image&nbsp;+&nbsp;error&#34;</span><span class="op" id="8116994">,</span>&nbsp;<span class="ident" id="8116996">tt</span><span class="op" id="8116998">.</span><span class="ident" id="8116999">file</span><span class="op" id="8117003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117010">}</span><br>
<span class="lineno">295</span><span class="op" id="8117012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8117015">func</span>&nbsp;<span class="ident" id="8117020">TestPalettedDecodeConfig</span><span class="op" id="8117044">(</span><span class="ident" id="8117045">t</span>&nbsp;<span class="op" id="8117047">*</span><span class="ident" id="8117048">testing</span><span class="op" id="8117055">.</span><span class="ident" id="8117056">T</span><span class="op" id="8117057">)</span>&nbsp;<span class="op" id="8117059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117062">for</span>&nbsp;<span class="ident" id="8117066">_</span><span class="op" id="8117067">,</span>&nbsp;<span class="ident" id="8117069">fn</span>&nbsp;<span class="op" id="8117072">:=</span>&nbsp;<span class="keyword" id="8117075">range</span>&nbsp;<span class="ident" id="8117081">filenamesPaletted</span>&nbsp;<span class="op" id="8117099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117103">f</span><span class="op" id="8117104">,</span>&nbsp;<span class="ident" id="8117106">err</span>&nbsp;<span class="op" id="8117110">:=</span>&nbsp;<span class="ident" id="8117113">os</span><span class="op" id="8117115">.</span><span class="ident" id="8117116">Open</span><span class="op" id="8117120">(</span><span class="string" id="8117121">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="8117142">+</span>&nbsp;<span class="ident" id="8117144">fn</span>&nbsp;<span class="op" id="8117147">+</span>&nbsp;<span class="string" id="8117149">&#34;.png&#34;</span><span class="op" id="8117155">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117159">if</span>&nbsp;<span class="ident" id="8117162">err</span>&nbsp;<span class="op" id="8117166">!=</span>&nbsp;<span class="ident" id="8117169">nil</span>&nbsp;<span class="op" id="8117173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117178">t</span><span class="op" id="8117179">.</span><span class="ident" id="8117180">Errorf</span><span class="op" id="8117186">(</span><span class="string" id="8117187">&#34;%s:&nbsp;open&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8117208">,</span>&nbsp;<span class="ident" id="8117210">fn</span><span class="op" id="8117212">,</span>&nbsp;<span class="ident" id="8117214">err</span><span class="op" id="8117217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117222">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117237">defer</span>&nbsp;<span class="ident" id="8117243">f</span><span class="op" id="8117244">.</span><span class="ident" id="8117245">Close</span><span class="op" id="8117250">(</span><span class="op" id="8117251">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117255">cfg</span><span class="op" id="8117258">,</span>&nbsp;<span class="ident" id="8117260">err</span>&nbsp;<span class="op" id="8117264">:=</span>&nbsp;<span class="ident" id="8117267">DecodeConfig</span><span class="op" id="8117279">(</span><span class="ident" id="8117280">f</span><span class="op" id="8117281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117285">if</span>&nbsp;<span class="ident" id="8117288">err</span>&nbsp;<span class="op" id="8117292">!=</span>&nbsp;<span class="ident" id="8117295">nil</span>&nbsp;<span class="op" id="8117299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117304">t</span><span class="op" id="8117305">.</span><span class="ident" id="8117306">Errorf</span><span class="op" id="8117312">(</span><span class="string" id="8117313">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="8117321">,</span>&nbsp;<span class="ident" id="8117323">fn</span><span class="op" id="8117325">,</span>&nbsp;<span class="ident" id="8117327">err</span><span class="op" id="8117330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117335">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117346">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117350">pal</span><span class="op" id="8117353">,</span>&nbsp;<span class="ident" id="8117355">ok</span>&nbsp;<span class="op" id="8117358">:=</span>&nbsp;<span class="ident" id="8117361">cfg</span><span class="op" id="8117364">.</span><span class="ident" id="8117365">ColorModel</span><span class="op" id="8117375">.</span><span class="op" id="8117376">(</span><span class="ident" id="8117377">color</span><span class="op" id="8117382">.</span><span class="ident" id="8117383">Palette</span><span class="op" id="8117390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117394">if</span>&nbsp;<span class="op" id="8117397">!</span><span class="ident" id="8117398">ok</span>&nbsp;<span class="op" id="8117401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117406">t</span><span class="op" id="8117407">.</span><span class="ident" id="8117408">Errorf</span><span class="op" id="8117414">(</span><span class="string" id="8117415">&#34;%s:&nbsp;expected&nbsp;paletted&nbsp;color&nbsp;model&#34;</span><span class="op" id="8117450">,</span>&nbsp;<span class="ident" id="8117452">fn</span><span class="op" id="8117454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117459">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117470">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117474">if</span>&nbsp;<span class="ident" id="8117477">pal</span>&nbsp;<span class="op" id="8117481">==</span>&nbsp;<span class="ident" id="8117484">nil</span>&nbsp;<span class="op" id="8117488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117493">t</span><span class="op" id="8117494">.</span><span class="ident" id="8117495">Errorf</span><span class="op" id="8117501">(</span><span class="string" id="8117502">&#34;%s:&nbsp;palette&nbsp;not&nbsp;initialized&#34;</span><span class="op" id="8117531">,</span>&nbsp;<span class="ident" id="8117533">fn</span><span class="op" id="8117535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117540">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117554">}</span><br>
<span class="lineno">320</span><span class="op" id="8117556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8117559">func</span>&nbsp;<span class="ident" id="8117564">benchmarkDecode</span><span class="op" id="8117579">(</span><span class="ident" id="8117580">b</span>&nbsp;<span class="op" id="8117582">*</span><span class="ident" id="8117583">testing</span><span class="op" id="8117590">.</span><span class="ident" id="8117591">B</span><span class="op" id="8117592">,</span>&nbsp;<span class="ident" id="8117594">filename</span>&nbsp;<span class="builtintype" id="8117603">string</span><span class="op" id="8117609">,</span>&nbsp;<span class="ident" id="8117611">bytesPerPixel</span>&nbsp;<span class="builtintype" id="8117625">int</span><span class="op" id="8117628">)</span>&nbsp;<span class="op" id="8117630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117633">b</span><span class="op" id="8117634">.</span><span class="ident" id="8117635">StopTimer</span><span class="op" id="8117644">(</span><span class="op" id="8117645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117648">data</span><span class="op" id="8117652">,</span>&nbsp;<span class="ident" id="8117654">err</span>&nbsp;<span class="op" id="8117658">:=</span>&nbsp;<span class="ident" id="8117661">ioutil</span><span class="op" id="8117667">.</span><span class="ident" id="8117668">ReadFile</span><span class="op" id="8117676">(</span><span class="ident" id="8117677">filename</span><span class="op" id="8117685">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117688">if</span>&nbsp;<span class="ident" id="8117691">err</span>&nbsp;<span class="op" id="8117695">!=</span>&nbsp;<span class="ident" id="8117698">nil</span>&nbsp;<span class="op" id="8117702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117706">b</span><span class="op" id="8117707">.</span><span class="ident" id="8117708">Fatal</span><span class="op" id="8117713">(</span><span class="ident" id="8117714">err</span><span class="op" id="8117717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117723">s</span>&nbsp;<span class="op" id="8117725">:=</span>&nbsp;<span class="builtintype" id="8117728">string</span><span class="op" id="8117734">(</span><span class="ident" id="8117735">data</span><span class="op" id="8117739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117742">cfg</span><span class="op" id="8117745">,</span>&nbsp;<span class="ident" id="8117747">err</span>&nbsp;<span class="op" id="8117751">:=</span>&nbsp;<span class="ident" id="8117754">DecodeConfig</span><span class="op" id="8117766">(</span><span class="ident" id="8117767">strings</span><span class="op" id="8117774">.</span><span class="ident" id="8117775">NewReader</span><span class="op" id="8117784">(</span><span class="ident" id="8117785">s</span><span class="op" id="8117786">)</span><span class="op" id="8117787">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117790">if</span>&nbsp;<span class="ident" id="8117793">err</span>&nbsp;<span class="op" id="8117797">!=</span>&nbsp;<span class="ident" id="8117800">nil</span>&nbsp;<span class="op" id="8117804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117808">b</span><span class="op" id="8117809">.</span><span class="ident" id="8117810">Fatal</span><span class="op" id="8117815">(</span><span class="ident" id="8117816">err</span><span class="op" id="8117819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117825">b</span><span class="op" id="8117826">.</span><span class="ident" id="8117827">SetBytes</span><span class="op" id="8117835">(</span><span class="ident" id="8117836">int64</span><span class="op" id="8117841">(</span><span class="ident" id="8117842">cfg</span><span class="op" id="8117845">.</span><span class="ident" id="8117846">Width</span>&nbsp;<span class="op" id="8117852">*</span>&nbsp;<span class="ident" id="8117854">cfg</span><span class="op" id="8117857">.</span><span class="ident" id="8117858">Height</span>&nbsp;<span class="op" id="8117865">*</span>&nbsp;<span class="ident" id="8117867">bytesPerPixel</span><span class="op" id="8117880">)</span><span class="op" id="8117881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117884">b</span><span class="op" id="8117885">.</span><span class="ident" id="8117886">StartTimer</span><span class="op" id="8117896">(</span><span class="op" id="8117897">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117900">for</span>&nbsp;<span class="ident" id="8117904">i</span>&nbsp;<span class="op" id="8117906">:=</span>&nbsp;<span class="num" id="8117909">0</span><span class="op" id="8117910">;</span>&nbsp;<span class="ident" id="8117912">i</span>&nbsp;<span class="op" id="8117914">&lt;</span>&nbsp;<span class="ident" id="8117916">b</span><span class="op" id="8117917">.</span><span class="ident" id="8117918">N</span><span class="op" id="8117919">;</span>&nbsp;<span class="ident" id="8117921">i</span><span class="op" id="8117922">++</span>&nbsp;<span class="op" id="8117925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117929">Decode</span><span class="op" id="8117935">(</span><span class="ident" id="8117936">strings</span><span class="op" id="8117943">.</span><span class="ident" id="8117944">NewReader</span><span class="op" id="8117953">(</span><span class="ident" id="8117954">s</span><span class="op" id="8117955">)</span><span class="op" id="8117956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117959">}</span><br>
<span class="lineno"></span><span class="op" id="8117961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="8117964">func</span>&nbsp;<span class="ident" id="8117969">BenchmarkDecodeGray</span><span class="op" id="8117988">(</span><span class="ident" id="8117989">b</span>&nbsp;<span class="op" id="8117991">*</span><span class="ident" id="8117992">testing</span><span class="op" id="8117999">.</span><span class="ident" id="8118000">B</span><span class="op" id="8118001">)</span>&nbsp;<span class="op" id="8118003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118006">benchmarkDecode</span><span class="op" id="8118021">(</span><span class="ident" id="8118022">b</span><span class="op" id="8118023">,</span>&nbsp;<span class="string" id="8118025">&#34;testdata/benchGray.png&#34;</span><span class="op" id="8118049">,</span>&nbsp;<span class="num" id="8118051">1</span><span class="op" id="8118052">)</span><br>
<span class="lineno"></span><span class="op" id="8118054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8118057">func</span>&nbsp;<span class="ident" id="8118062">BenchmarkDecodeNRGBAGradient</span><span class="op" id="8118090">(</span><span class="ident" id="8118091">b</span>&nbsp;<span class="op" id="8118093">*</span><span class="ident" id="8118094">testing</span><span class="op" id="8118101">.</span><span class="ident" id="8118102">B</span><span class="op" id="8118103">)</span>&nbsp;<span class="op" id="8118105">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118108">benchmarkDecode</span><span class="op" id="8118123">(</span><span class="ident" id="8118124">b</span><span class="op" id="8118125">,</span>&nbsp;<span class="string" id="8118127">&#34;testdata/benchNRGBA-gradient.png&#34;</span><span class="op" id="8118161">,</span>&nbsp;<span class="num" id="8118163">4</span><span class="op" id="8118164">)</span><br>
<span class="lineno"></span><span class="op" id="8118166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8118169">func</span>&nbsp;<span class="ident" id="8118174">BenchmarkDecodeNRGBAOpaque</span><span class="op" id="8118200">(</span><span class="ident" id="8118201">b</span>&nbsp;<span class="op" id="8118203">*</span><span class="ident" id="8118204">testing</span><span class="op" id="8118211">.</span><span class="ident" id="8118212">B</span><span class="op" id="8118213">)</span>&nbsp;<span class="op" id="8118215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118218">benchmarkDecode</span><span class="op" id="8118233">(</span><span class="ident" id="8118234">b</span><span class="op" id="8118235">,</span>&nbsp;<span class="string" id="8118237">&#34;testdata/benchNRGBA-opaque.png&#34;</span><span class="op" id="8118269">,</span>&nbsp;<span class="num" id="8118271">4</span><span class="op" id="8118272">)</span><br>
<span class="lineno">350</span><span class="op" id="8118274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8118277">func</span>&nbsp;<span class="ident" id="8118282">BenchmarkDecodePaletted</span><span class="op" id="8118305">(</span><span class="ident" id="8118306">b</span>&nbsp;<span class="op" id="8118308">*</span><span class="ident" id="8118309">testing</span><span class="op" id="8118316">.</span><span class="ident" id="8118317">B</span><span class="op" id="8118318">)</span>&nbsp;<span class="op" id="8118320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118323">benchmarkDecode</span><span class="op" id="8118338">(</span><span class="ident" id="8118339">b</span><span class="op" id="8118340">,</span>&nbsp;<span class="string" id="8118342">&#34;testdata/benchPaletted.png&#34;</span><span class="op" id="8118370">,</span>&nbsp;<span class="num" id="8118372">1</span><span class="op" id="8118373">)</span><br>
<span class="lineno"></span><span class="op" id="8118375">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="8118378">func</span>&nbsp;<span class="ident" id="8118383">BenchmarkDecodeRGB</span><span class="op" id="8118401">(</span><span class="ident" id="8118402">b</span>&nbsp;<span class="op" id="8118404">*</span><span class="ident" id="8118405">testing</span><span class="op" id="8118412">.</span><span class="ident" id="8118413">B</span><span class="op" id="8118414">)</span>&nbsp;<span class="op" id="8118416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118419">benchmarkDecode</span><span class="op" id="8118434">(</span><span class="ident" id="8118435">b</span><span class="op" id="8118436">,</span>&nbsp;<span class="string" id="8118438">&#34;testdata/benchRGB.png&#34;</span><span class="op" id="8118461">,</span>&nbsp;<span class="num" id="8118463">4</span><span class="op" id="8118464">)</span><br>
<span class="lineno"></span><span class="op" id="8118466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="keyword" id="8118469">func</span>&nbsp;<span class="ident" id="8118474">BenchmarkDecodeInterlacing</span><span class="op" id="8118500">(</span><span class="ident" id="8118501">b</span>&nbsp;<span class="op" id="8118503">*</span><span class="ident" id="8118504">testing</span><span class="op" id="8118511">.</span><span class="ident" id="8118512">B</span><span class="op" id="8118513">)</span>&nbsp;<span class="op" id="8118515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118518">benchmarkDecode</span><span class="op" id="8118533">(</span><span class="ident" id="8118534">b</span><span class="op" id="8118535">,</span>&nbsp;<span class="string" id="8118537">&#34;testdata/benchRGB-interlace.png&#34;</span><span class="op" id="8118570">,</span>&nbsp;<span class="num" id="8118572">4</span><span class="op" id="8118573">)</span><br>
<span class="lineno"></span><span class="op" id="8118575">}</span>
</div>
</body>
</html>
