<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3749122">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3749177">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3749231">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3749282">package</span>&nbsp;<span class="ident" id="3749290">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3749297">import</span>&nbsp;<span class="op" id="3749304">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3749307">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="3749321">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="3749324">//&nbsp;YCbCrSubsampleRatio&nbsp;is&nbsp;the&nbsp;chroma&nbsp;subsample&nbsp;ratio&nbsp;used&nbsp;in&nbsp;a&nbsp;YCbCr&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="3749400">type</span>&nbsp;<span class="ident" id="3749405">YCbCrSubsampleRatio</span>&nbsp;<span class="builtintype" id="3749425">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3749430">const</span>&nbsp;<span class="op" id="3749436">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3749439">YCbCrSubsampleRatio444</span>&nbsp;<span class="ident" id="3749462">YCbCrSubsampleRatio</span>&nbsp;<span class="op" id="3749482">=</span>&nbsp;<span class="ident" id="3749484">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3749490">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3749514">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3749538">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span><span class="op" id="3749561">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3749564">func</span>&nbsp;<span class="op" id="3749569">(</span><span class="ident" id="3749570">s</span>&nbsp;<span class="ident" id="3749572">YCbCrSubsampleRatio</span><span class="op" id="3749591">)</span>&nbsp;<span class="ident" id="3749593">String</span><span class="op" id="3749599">(</span><span class="op" id="3749600">)</span>&nbsp;<span class="builtintype" id="3749602">string</span>&nbsp;<span class="op" id="3749609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3749612">switch</span>&nbsp;<span class="ident" id="3749619">s</span>&nbsp;<span class="op" id="3749621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3749624">case</span>&nbsp;<span class="ident" id="3749629">YCbCrSubsampleRatio444</span><span class="op" id="3749651">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3749655">return</span>&nbsp;<span class="string" id="3749662">&#34;YCbCrSubsampleRatio444&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3749688">case</span>&nbsp;<span class="ident" id="3749693">YCbCrSubsampleRatio422</span><span class="op" id="3749715">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3749719">return</span>&nbsp;<span class="string" id="3749726">&#34;YCbCrSubsampleRatio422&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3749752">case</span>&nbsp;<span class="ident" id="3749757">YCbCrSubsampleRatio420</span><span class="op" id="3749779">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3749783">return</span>&nbsp;<span class="string" id="3749790">&#34;YCbCrSubsampleRatio420&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3749816">case</span>&nbsp;<span class="ident" id="3749821">YCbCrSubsampleRatio440</span><span class="op" id="3749843">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3749847">return</span>&nbsp;<span class="string" id="3749854">&#34;YCbCrSubsampleRatio440&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3749880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3749883">return</span>&nbsp;<span class="string" id="3749890">&#34;YCbCrSubsampleRatioUnknown&#34;</span><br>
<span class="lineno"></span><span class="op" id="3749919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3749922">//&nbsp;YCbCr&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;Y&#39;CbCr&nbsp;colors.&nbsp;There&nbsp;is&nbsp;one&nbsp;Y&nbsp;sample&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="3749997">//&nbsp;pixel,&nbsp;but&nbsp;each&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;sample&nbsp;can&nbsp;span&nbsp;one&nbsp;or&nbsp;more&nbsp;pixels.</span><br>
<span class="lineno"></span><span class="comment" id="3750062">//&nbsp;YStride&nbsp;is&nbsp;the&nbsp;Y&nbsp;slice&nbsp;index&nbsp;delta&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span><span class="comment" id="3750136">//&nbsp;CStride&nbsp;is&nbsp;the&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;slice&nbsp;index&nbsp;delta&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels</span><br>
<span class="lineno"></span><span class="comment" id="3750217">//&nbsp;that&nbsp;map&nbsp;to&nbsp;separate&nbsp;chroma&nbsp;samples.</span><br>
<span class="lineno">40</span><span class="comment" id="3750257">//&nbsp;It&nbsp;is&nbsp;not&nbsp;an&nbsp;absolute&nbsp;requirement,&nbsp;but&nbsp;YStride&nbsp;and&nbsp;len(Y)&nbsp;are&nbsp;typically</span><br>
<span class="lineno"></span><span class="comment" id="3750332">//&nbsp;multiples&nbsp;of&nbsp;8,&nbsp;and:</span><br>
<span class="lineno"></span><span class="comment" id="3750356">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:4:4,&nbsp;CStride&nbsp;==&nbsp;YStride/1&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/1.</span><br>
<span class="lineno"></span><span class="comment" id="3750426">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:2:2,&nbsp;CStride&nbsp;==&nbsp;YStride/2&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/2.</span><br>
<span class="lineno"></span><span class="comment" id="3750496">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:2:0,&nbsp;CStride&nbsp;==&nbsp;YStride/2&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/4.</span><br>
<span class="lineno">45</span><span class="comment" id="3750566">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:4:0,&nbsp;CStride&nbsp;==&nbsp;YStride/1&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/2.</span><br>
<span class="lineno"></span><span class="keyword" id="3750636">type</span>&nbsp;<span class="ident" id="3750641">YCbCr</span>&nbsp;<span class="keyword" id="3750647">struct</span>&nbsp;<span class="op" id="3750654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750657">Y</span><span class="op" id="3750658">,</span>&nbsp;<span class="ident" id="3750660">Cb</span><span class="op" id="3750662">,</span>&nbsp;<span class="ident" id="3750664">Cr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3750672">[</span><span class="op" id="3750673">]</span><span class="builtintype" id="3750674">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750681">YStride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3750696">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750701">CStride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3750716">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750721">SubsampleRatio</span>&nbsp;<span class="ident" id="3750736">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3750757">Rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750772">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="3750782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3750785">func</span>&nbsp;<span class="op" id="3750790">(</span><span class="ident" id="3750791">p</span>&nbsp;<span class="op" id="3750793">*</span><span class="ident" id="3750794">YCbCr</span><span class="op" id="3750799">)</span>&nbsp;<span class="ident" id="3750801">ColorModel</span><span class="op" id="3750811">(</span><span class="op" id="3750812">)</span>&nbsp;<span class="ident" id="3750814">color</span><span class="op" id="3750819">.</span><span class="ident" id="3750820">Model</span>&nbsp;<span class="op" id="3750826">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3750829">return</span>&nbsp;<span class="ident" id="3750836">color</span><span class="op" id="3750841">.</span><span class="ident" id="3750842">YCbCrModel</span><br>
<span class="lineno"></span><span class="op" id="3750853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3750856">func</span>&nbsp;<span class="op" id="3750861">(</span><span class="ident" id="3750862">p</span>&nbsp;<span class="op" id="3750864">*</span><span class="ident" id="3750865">YCbCr</span><span class="op" id="3750870">)</span>&nbsp;<span class="ident" id="3750872">Bounds</span><span class="op" id="3750878">(</span><span class="op" id="3750879">)</span>&nbsp;<span class="ident" id="3750881">Rectangle</span>&nbsp;<span class="op" id="3750891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3750894">return</span>&nbsp;<span class="ident" id="3750901">p</span><span class="op" id="3750902">.</span><span class="ident" id="3750903">Rect</span><br>
<span class="lineno">60</span><span class="op" id="3750908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3750911">func</span>&nbsp;<span class="op" id="3750916">(</span><span class="ident" id="3750917">p</span>&nbsp;<span class="op" id="3750919">*</span><span class="ident" id="3750920">YCbCr</span><span class="op" id="3750925">)</span>&nbsp;<span class="ident" id="3750927">At</span><span class="op" id="3750929">(</span><span class="ident" id="3750930">x</span><span class="op" id="3750931">,</span>&nbsp;<span class="ident" id="3750933">y</span>&nbsp;<span class="builtintype" id="3750935">int</span><span class="op" id="3750938">)</span>&nbsp;<span class="ident" id="3750940">color</span><span class="op" id="3750945">.</span><span class="ident" id="3750946">Color</span>&nbsp;<span class="op" id="3750952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3750955">return</span>&nbsp;<span class="ident" id="3750962">p</span><span class="op" id="3750963">.</span><span class="ident" id="3750964">YCbCrAt</span><span class="op" id="3750971">(</span><span class="ident" id="3750972">x</span><span class="op" id="3750973">,</span>&nbsp;<span class="ident" id="3750975">y</span><span class="op" id="3750976">)</span><br>
<span class="lineno"></span><span class="op" id="3750978">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3750981">func</span>&nbsp;<span class="op" id="3750986">(</span><span class="ident" id="3750987">p</span>&nbsp;<span class="op" id="3750989">*</span><span class="ident" id="3750990">YCbCr</span><span class="op" id="3750995">)</span>&nbsp;<span class="ident" id="3750997">YCbCrAt</span><span class="op" id="3751004">(</span><span class="ident" id="3751005">x</span><span class="op" id="3751006">,</span>&nbsp;<span class="ident" id="3751008">y</span>&nbsp;<span class="builtintype" id="3751010">int</span><span class="op" id="3751013">)</span>&nbsp;<span class="ident" id="3751015">color</span><span class="op" id="3751020">.</span><span class="ident" id="3751021">YCbCr</span>&nbsp;<span class="op" id="3751027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3751030">if</span>&nbsp;<span class="op" id="3751033">!</span><span class="op" id="3751034">(</span><span class="ident" id="3751035">Point</span><span class="op" id="3751040">{</span><span class="ident" id="3751041">x</span><span class="op" id="3751042">,</span>&nbsp;<span class="ident" id="3751044">y</span><span class="op" id="3751045">}</span><span class="op" id="3751046">.</span><span class="ident" id="3751047">In</span><span class="op" id="3751049">(</span><span class="ident" id="3751050">p</span><span class="op" id="3751051">.</span><span class="ident" id="3751052">Rect</span><span class="op" id="3751056">)</span><span class="op" id="3751057">)</span>&nbsp;<span class="op" id="3751059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3751063">return</span>&nbsp;<span class="ident" id="3751070">color</span><span class="op" id="3751075">.</span><span class="ident" id="3751076">YCbCr</span><span class="op" id="3751081">{</span><span class="op" id="3751082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3751085">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751088">yi</span>&nbsp;<span class="op" id="3751091">:=</span>&nbsp;<span class="ident" id="3751094">p</span><span class="op" id="3751095">.</span><span class="ident" id="3751096">YOffset</span><span class="op" id="3751103">(</span><span class="ident" id="3751104">x</span><span class="op" id="3751105">,</span>&nbsp;<span class="ident" id="3751107">y</span><span class="op" id="3751108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751111">ci</span>&nbsp;<span class="op" id="3751114">:=</span>&nbsp;<span class="ident" id="3751117">p</span><span class="op" id="3751118">.</span><span class="ident" id="3751119">COffset</span><span class="op" id="3751126">(</span><span class="ident" id="3751127">x</span><span class="op" id="3751128">,</span>&nbsp;<span class="ident" id="3751130">y</span><span class="op" id="3751131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3751134">return</span>&nbsp;<span class="ident" id="3751141">color</span><span class="op" id="3751146">.</span><span class="ident" id="3751147">YCbCr</span><span class="op" id="3751152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751156">p</span><span class="op" id="3751157">.</span><span class="ident" id="3751158">Y</span><span class="op" id="3751159">[</span><span class="ident" id="3751160">yi</span><span class="op" id="3751162">]</span><span class="op" id="3751163">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751167">p</span><span class="op" id="3751168">.</span><span class="ident" id="3751169">Cb</span><span class="op" id="3751171">[</span><span class="ident" id="3751172">ci</span><span class="op" id="3751174">]</span><span class="op" id="3751175">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3751179">p</span><span class="op" id="3751180">.</span><span class="ident" id="3751181">Cr</span><span class="op" id="3751183">[</span><span class="ident" id="3751184">ci</span><span class="op" id="3751186">]</span><span class="op" id="3751187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3751190">}</span><br>
<span class="lineno"></span><span class="op" id="3751192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3751195">//&nbsp;YOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Y&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">80</span><span class="comment" id="3751270">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="3751294">func</span>&nbsp;<span class="op" id="3751299">(</span><span class="ident" id="3751300">p</span>&nbsp;<span class="op" id="3751302">*</span><span class="ident" id="3751303">YCbCr</span><span class="op" id="3751308">)</span>&nbsp;<span class="ident" id="3751310">YOffset</span><span class="op" id="3751317">(</span><span class="ident" id="3751318">x</span><span class="op" id="3751319">,</span>&nbsp;<span class="ident" id="3751321">y</span>&nbsp;<span class="builtintype" id="3751323">int</span><span class="op" id="3751326">)</span>&nbsp;<span class="builtintype" id="3751328">int</span>&nbsp;<span class="op" id="3751332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3751335">return</span>&nbsp;<span class="op" id="3751342">(</span><span class="ident" id="3751343">y</span><span class="op" id="3751344">-</span><span class="ident" id="3751345">p</span><span class="op" id="3751346">.</span><span class="ident" id="3751347">Rect</span><span class="op" id="3751351">.</span><span class="ident" id="3751352">Min</span><span class="op" id="3751355">.</span><span class="ident" id="3751356">Y</span><span class="op" id="3751357">)</span><span class="op" id="3751358">*</span><span class="ident" id="3751359">p</span><span class="op" id="3751360">.</span><span class="ident" id="3751361">YStride</span>&nbsp;<span class="op" id="3751369">+</span>&nbsp;<span class="op" id="3751371">(</span><span class="ident" id="3751372">x</span>&nbsp;<span class="op" id="3751374">-</span>&nbsp;<span class="ident" id="3751376">p</span><span class="op" id="3751377">.</span><span class="ident" id="3751378">Rect</span><span class="op" id="3751382">.</span><span class="ident" id="3751383">Min</span><span class="op" id="3751386">.</span><span class="ident" id="3751387">X</span><span class="op" id="3751388">)</span><br>
<span class="lineno"></span><span class="op" id="3751390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="3751393">//&nbsp;COffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Cb&nbsp;or&nbsp;Cr&nbsp;that&nbsp;corresponds</span><br>
<span class="lineno"></span><span class="comment" id="3751472">//&nbsp;to&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="3751499">func</span>&nbsp;<span class="op" id="3751504">(</span><span class="ident" id="3751505">p</span>&nbsp;<span class="op" id="3751507">*</span><span class="ident" id="3751508">YCbCr</span><span class="op" id="3751513">)</span>&nbsp;<span class="ident" id="3751515">COffset</span><span class="op" id="3751522">(</span><span class="ident" id="3751523">x</span><span class="op" id="3751524">,</span>&nbsp;<span class="ident" id="3751526">y</span>&nbsp;<span class="builtintype" id="3751528">int</span><span class="op" id="3751531">)</span>&nbsp;<span class="builtintype" id="3751533">int</span>&nbsp;<span class="op" id="3751537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3751540">switch</span>&nbsp;<span class="ident" id="3751547">p</span><span class="op" id="3751548">.</span><span class="ident" id="3751549">SubsampleRatio</span>&nbsp;<span class="op" id="3751564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3751567">case</span>&nbsp;<span class="ident" id="3751572">YCbCrSubsampleRatio422</span><span class="op" id="3751594">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3751598">return</span>&nbsp;<span class="op" id="3751605">(</span><span class="ident" id="3751606">y</span><span class="op" id="3751607">-</span><span class="ident" id="3751608">p</span><span class="op" id="3751609">.</span><span class="ident" id="3751610">Rect</span><span class="op" id="3751614">.</span><span class="ident" id="3751615">Min</span><span class="op" id="3751618">.</span><span class="ident" id="3751619">Y</span><span class="op" id="3751620">)</span><span class="op" id="3751621">*</span><span class="ident" id="3751622">p</span><span class="op" id="3751623">.</span><span class="ident" id="3751624">CStride</span>&nbsp;<span class="op" id="3751632">+</span>&nbsp;<span class="op" id="3751634">(</span><span class="ident" id="3751635">x</span><span class="op" id="3751636">/</span><span class="num" id="3751637">2</span>&nbsp;<span class="op" id="3751639">-</span>&nbsp;<span class="ident" id="3751641">p</span><span class="op" id="3751642">.</span><span class="ident" id="3751643">Rect</span><span class="op" id="3751647">.</span><span class="ident" id="3751648">Min</span><span class="op" id="3751651">.</span><span class="ident" id="3751652">X</span><span class="op" id="3751653">/</span><span class="num" id="3751654">2</span><span class="op" id="3751655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3751658">case</span>&nbsp;<span class="ident" id="3751663">YCbCrSubsampleRatio420</span><span class="op" id="3751685">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3751689">return</span>&nbsp;<span class="op" id="3751696">(</span><span class="ident" id="3751697">y</span><span class="op" id="3751698">/</span><span class="num" id="3751699">2</span><span class="op" id="3751700">-</span><span class="ident" id="3751701">p</span><span class="op" id="3751702">.</span><span class="ident" id="3751703">Rect</span><span class="op" id="3751707">.</span><span class="ident" id="3751708">Min</span><span class="op" id="3751711">.</span><span class="ident" id="3751712">Y</span><span class="op" id="3751713">/</span><span class="num" id="3751714">2</span><span class="op" id="3751715">)</span><span class="op" id="3751716">*</span><span class="ident" id="3751717">p</span><span class="op" id="3751718">.</span><span class="ident" id="3751719">CStride</span>&nbsp;<span class="op" id="3751727">+</span>&nbsp;<span class="op" id="3751729">(</span><span class="ident" id="3751730">x</span><span class="op" id="3751731">/</span><span class="num" id="3751732">2</span>&nbsp;<span class="op" id="3751734">-</span>&nbsp;<span class="ident" id="3751736">p</span><span class="op" id="3751737">.</span><span class="ident" id="3751738">Rect</span><span class="op" id="3751742">.</span><span class="ident" id="3751743">Min</span><span class="op" id="3751746">.</span><span class="ident" id="3751747">X</span><span class="op" id="3751748">/</span><span class="num" id="3751749">2</span><span class="op" id="3751750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3751753">case</span>&nbsp;<span class="ident" id="3751758">YCbCrSubsampleRatio440</span><span class="op" id="3751780">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3751784">return</span>&nbsp;<span class="op" id="3751791">(</span><span class="ident" id="3751792">y</span><span class="op" id="3751793">/</span><span class="num" id="3751794">2</span><span class="op" id="3751795">-</span><span class="ident" id="3751796">p</span><span class="op" id="3751797">.</span><span class="ident" id="3751798">Rect</span><span class="op" id="3751802">.</span><span class="ident" id="3751803">Min</span><span class="op" id="3751806">.</span><span class="ident" id="3751807">Y</span><span class="op" id="3751808">/</span><span class="num" id="3751809">2</span><span class="op" id="3751810">)</span><span class="op" id="3751811">*</span><span class="ident" id="3751812">p</span><span class="op" id="3751813">.</span><span class="ident" id="3751814">CStride</span>&nbsp;<span class="op" id="3751822">+</span>&nbsp;<span class="op" id="3751824">(</span><span class="ident" id="3751825">x</span>&nbsp;<span class="op" id="3751827">-</span>&nbsp;<span class="ident" id="3751829">p</span><span class="op" id="3751830">.</span><span class="ident" id="3751831">Rect</span><span class="op" id="3751835">.</span><span class="ident" id="3751836">Min</span><span class="op" id="3751839">.</span><span class="ident" id="3751840">X</span><span class="op" id="3751841">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3751844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3751847">//&nbsp;Default&nbsp;to&nbsp;4:4:4&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3751881">return</span>&nbsp;<span class="op" id="3751888">(</span><span class="ident" id="3751889">y</span><span class="op" id="3751890">-</span><span class="ident" id="3751891">p</span><span class="op" id="3751892">.</span><span class="ident" id="3751893">Rect</span><span class="op" id="3751897">.</span><span class="ident" id="3751898">Min</span><span class="op" id="3751901">.</span><span class="ident" id="3751902">Y</span><span class="op" id="3751903">)</span><span class="op" id="3751904">*</span><span class="ident" id="3751905">p</span><span class="op" id="3751906">.</span><span class="ident" id="3751907">CStride</span>&nbsp;<span class="op" id="3751915">+</span>&nbsp;<span class="op" id="3751917">(</span><span class="ident" id="3751918">x</span>&nbsp;<span class="op" id="3751920">-</span>&nbsp;<span class="ident" id="3751922">p</span><span class="op" id="3751923">.</span><span class="ident" id="3751924">Rect</span><span class="op" id="3751928">.</span><span class="ident" id="3751929">Min</span><span class="op" id="3751932">.</span><span class="ident" id="3751933">X</span><span class="op" id="3751934">)</span><br>
<span class="lineno"></span><span class="op" id="3751936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="3751939">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="3752016">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="3752088">func</span>&nbsp;<span class="op" id="3752093">(</span><span class="ident" id="3752094">p</span>&nbsp;<span class="op" id="3752096">*</span><span class="ident" id="3752097">YCbCr</span><span class="op" id="3752102">)</span>&nbsp;<span class="ident" id="3752104">SubImage</span><span class="op" id="3752112">(</span><span class="ident" id="3752113">r</span>&nbsp;<span class="ident" id="3752115">Rectangle</span><span class="op" id="3752124">)</span>&nbsp;<span class="ident" id="3752126">Image</span>&nbsp;<span class="op" id="3752132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752135">r</span>&nbsp;<span class="op" id="3752137">=</span>&nbsp;<span class="ident" id="3752139">r</span><span class="op" id="3752140">.</span><span class="ident" id="3752141">Intersect</span><span class="op" id="3752150">(</span><span class="ident" id="3752151">p</span><span class="op" id="3752152">.</span><span class="ident" id="3752153">Rect</span><span class="op" id="3752157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3752160">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3752241">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3752323">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752373">if</span>&nbsp;<span class="ident" id="3752376">r</span><span class="op" id="3752377">.</span><span class="ident" id="3752378">Empty</span><span class="op" id="3752383">(</span><span class="op" id="3752384">)</span>&nbsp;<span class="op" id="3752386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752390">return</span>&nbsp;<span class="op" id="3752397">&amp;</span><span class="ident" id="3752398">YCbCr</span><span class="op" id="3752403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752408">SubsampleRatio</span><span class="op" id="3752422">:</span>&nbsp;<span class="ident" id="3752424">p</span><span class="op" id="3752425">.</span><span class="ident" id="3752426">SubsampleRatio</span><span class="op" id="3752440">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3752444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3752447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752450">yi</span>&nbsp;<span class="op" id="3752453">:=</span>&nbsp;<span class="ident" id="3752456">p</span><span class="op" id="3752457">.</span><span class="ident" id="3752458">YOffset</span><span class="op" id="3752465">(</span><span class="ident" id="3752466">r</span><span class="op" id="3752467">.</span><span class="ident" id="3752468">Min</span><span class="op" id="3752471">.</span><span class="ident" id="3752472">X</span><span class="op" id="3752473">,</span>&nbsp;<span class="ident" id="3752475">r</span><span class="op" id="3752476">.</span><span class="ident" id="3752477">Min</span><span class="op" id="3752480">.</span><span class="ident" id="3752481">Y</span><span class="op" id="3752482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752485">ci</span>&nbsp;<span class="op" id="3752488">:=</span>&nbsp;<span class="ident" id="3752491">p</span><span class="op" id="3752492">.</span><span class="ident" id="3752493">COffset</span><span class="op" id="3752500">(</span><span class="ident" id="3752501">r</span><span class="op" id="3752502">.</span><span class="ident" id="3752503">Min</span><span class="op" id="3752506">.</span><span class="ident" id="3752507">X</span><span class="op" id="3752508">,</span>&nbsp;<span class="ident" id="3752510">r</span><span class="op" id="3752511">.</span><span class="ident" id="3752512">Min</span><span class="op" id="3752515">.</span><span class="ident" id="3752516">Y</span><span class="op" id="3752517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752520">return</span>&nbsp;<span class="op" id="3752527">&amp;</span><span class="ident" id="3752528">YCbCr</span><span class="op" id="3752533">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752537">Y</span><span class="op" id="3752538">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752553">p</span><span class="op" id="3752554">.</span><span class="ident" id="3752555">Y</span><span class="op" id="3752556">[</span><span class="ident" id="3752557">yi</span><span class="op" id="3752559">:</span><span class="op" id="3752560">]</span><span class="op" id="3752561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752565">Cb</span><span class="op" id="3752567">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752581">p</span><span class="op" id="3752582">.</span><span class="ident" id="3752583">Cb</span><span class="op" id="3752585">[</span><span class="ident" id="3752586">ci</span><span class="op" id="3752588">:</span><span class="op" id="3752589">]</span><span class="op" id="3752590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752594">Cr</span><span class="op" id="3752596">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752610">p</span><span class="op" id="3752611">.</span><span class="ident" id="3752612">Cr</span><span class="op" id="3752614">[</span><span class="ident" id="3752615">ci</span><span class="op" id="3752617">:</span><span class="op" id="3752618">]</span><span class="op" id="3752619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752623">SubsampleRatio</span><span class="op" id="3752637">:</span>&nbsp;<span class="ident" id="3752639">p</span><span class="op" id="3752640">.</span><span class="ident" id="3752641">SubsampleRatio</span><span class="op" id="3752655">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752659">YStride</span><span class="op" id="3752666">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752675">p</span><span class="op" id="3752676">.</span><span class="ident" id="3752677">YStride</span><span class="op" id="3752684">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752688">CStride</span><span class="op" id="3752695">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752704">p</span><span class="op" id="3752705">.</span><span class="ident" id="3752706">CStride</span><span class="op" id="3752713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752717">Rect</span><span class="op" id="3752721">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3752733">r</span><span class="op" id="3752734">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3752737">}</span><br>
<span class="lineno"></span><span class="op" id="3752739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="3752742">func</span>&nbsp;<span class="op" id="3752747">(</span><span class="ident" id="3752748">p</span>&nbsp;<span class="op" id="3752750">*</span><span class="ident" id="3752751">YCbCr</span><span class="op" id="3752756">)</span>&nbsp;<span class="ident" id="3752758">Opaque</span><span class="op" id="3752764">(</span><span class="op" id="3752765">)</span>&nbsp;<span class="builtintype" id="3752767">bool</span>&nbsp;<span class="op" id="3752772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752775">return</span>&nbsp;<span class="builtintype" id="3752782">true</span><br>
<span class="lineno"></span><span class="op" id="3752787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3752790">//&nbsp;NewYCbCr&nbsp;returns&nbsp;a&nbsp;new&nbsp;YCbCr&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds&nbsp;and&nbsp;subsample&nbsp;ratio.</span><br>
<span class="lineno">130</span><span class="keyword" id="3752865">func</span>&nbsp;<span class="ident" id="3752870">NewYCbCr</span><span class="op" id="3752878">(</span><span class="ident" id="3752879">r</span>&nbsp;<span class="ident" id="3752881">Rectangle</span><span class="op" id="3752890">,</span>&nbsp;<span class="ident" id="3752892">subsampleRatio</span>&nbsp;<span class="ident" id="3752907">YCbCrSubsampleRatio</span><span class="op" id="3752926">)</span>&nbsp;<span class="op" id="3752928">*</span><span class="ident" id="3752929">YCbCr</span>&nbsp;<span class="op" id="3752935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3752938">w</span><span class="op" id="3752939">,</span>&nbsp;<span class="ident" id="3752941">h</span><span class="op" id="3752942">,</span>&nbsp;<span class="ident" id="3752944">cw</span><span class="op" id="3752946">,</span>&nbsp;<span class="ident" id="3752948">ch</span>&nbsp;<span class="op" id="3752951">:=</span>&nbsp;<span class="ident" id="3752954">r</span><span class="op" id="3752955">.</span><span class="ident" id="3752956">Dx</span><span class="op" id="3752958">(</span><span class="op" id="3752959">)</span><span class="op" id="3752960">,</span>&nbsp;<span class="ident" id="3752962">r</span><span class="op" id="3752963">.</span><span class="ident" id="3752964">Dy</span><span class="op" id="3752966">(</span><span class="op" id="3752967">)</span><span class="op" id="3752968">,</span>&nbsp;<span class="num" id="3752970">0</span><span class="op" id="3752971">,</span>&nbsp;<span class="num" id="3752973">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3752976">switch</span>&nbsp;<span class="ident" id="3752983">subsampleRatio</span>&nbsp;<span class="op" id="3752998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753001">case</span>&nbsp;<span class="ident" id="3753006">YCbCrSubsampleRatio422</span><span class="op" id="3753028">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753032">cw</span>&nbsp;<span class="op" id="3753035">=</span>&nbsp;<span class="op" id="3753037">(</span><span class="ident" id="3753038">r</span><span class="op" id="3753039">.</span><span class="ident" id="3753040">Max</span><span class="op" id="3753043">.</span><span class="ident" id="3753044">X</span><span class="op" id="3753045">+</span><span class="num" id="3753046">1</span><span class="op" id="3753047">)</span><span class="op" id="3753048">/</span><span class="num" id="3753049">2</span>&nbsp;<span class="op" id="3753051">-</span>&nbsp;<span class="ident" id="3753053">r</span><span class="op" id="3753054">.</span><span class="ident" id="3753055">Min</span><span class="op" id="3753058">.</span><span class="ident" id="3753059">X</span><span class="op" id="3753060">/</span><span class="num" id="3753061">2</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753065">ch</span>&nbsp;<span class="op" id="3753068">=</span>&nbsp;<span class="ident" id="3753070">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753073">case</span>&nbsp;<span class="ident" id="3753078">YCbCrSubsampleRatio420</span><span class="op" id="3753100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753104">cw</span>&nbsp;<span class="op" id="3753107">=</span>&nbsp;<span class="op" id="3753109">(</span><span class="ident" id="3753110">r</span><span class="op" id="3753111">.</span><span class="ident" id="3753112">Max</span><span class="op" id="3753115">.</span><span class="ident" id="3753116">X</span><span class="op" id="3753117">+</span><span class="num" id="3753118">1</span><span class="op" id="3753119">)</span><span class="op" id="3753120">/</span><span class="num" id="3753121">2</span>&nbsp;<span class="op" id="3753123">-</span>&nbsp;<span class="ident" id="3753125">r</span><span class="op" id="3753126">.</span><span class="ident" id="3753127">Min</span><span class="op" id="3753130">.</span><span class="ident" id="3753131">X</span><span class="op" id="3753132">/</span><span class="num" id="3753133">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753137">ch</span>&nbsp;<span class="op" id="3753140">=</span>&nbsp;<span class="op" id="3753142">(</span><span class="ident" id="3753143">r</span><span class="op" id="3753144">.</span><span class="ident" id="3753145">Max</span><span class="op" id="3753148">.</span><span class="ident" id="3753149">Y</span><span class="op" id="3753150">+</span><span class="num" id="3753151">1</span><span class="op" id="3753152">)</span><span class="op" id="3753153">/</span><span class="num" id="3753154">2</span>&nbsp;<span class="op" id="3753156">-</span>&nbsp;<span class="ident" id="3753158">r</span><span class="op" id="3753159">.</span><span class="ident" id="3753160">Min</span><span class="op" id="3753163">.</span><span class="ident" id="3753164">Y</span><span class="op" id="3753165">/</span><span class="num" id="3753166">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753169">case</span>&nbsp;<span class="ident" id="3753174">YCbCrSubsampleRatio440</span><span class="op" id="3753196">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753200">cw</span>&nbsp;<span class="op" id="3753203">=</span>&nbsp;<span class="ident" id="3753205">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753209">ch</span>&nbsp;<span class="op" id="3753212">=</span>&nbsp;<span class="op" id="3753214">(</span><span class="ident" id="3753215">r</span><span class="op" id="3753216">.</span><span class="ident" id="3753217">Max</span><span class="op" id="3753220">.</span><span class="ident" id="3753221">Y</span><span class="op" id="3753222">+</span><span class="num" id="3753223">1</span><span class="op" id="3753224">)</span><span class="op" id="3753225">/</span><span class="num" id="3753226">2</span>&nbsp;<span class="op" id="3753228">-</span>&nbsp;<span class="ident" id="3753230">r</span><span class="op" id="3753231">.</span><span class="ident" id="3753232">Min</span><span class="op" id="3753235">.</span><span class="ident" id="3753236">Y</span><span class="op" id="3753237">/</span><span class="num" id="3753238">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753241">default</span><span class="op" id="3753248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3753252">//&nbsp;Default&nbsp;to&nbsp;4:4:4&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753287">cw</span>&nbsp;<span class="op" id="3753290">=</span>&nbsp;<span class="ident" id="3753292">w</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753296">ch</span>&nbsp;<span class="op" id="3753299">=</span>&nbsp;<span class="ident" id="3753301">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3753304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753307">b</span>&nbsp;<span class="op" id="3753309">:=</span>&nbsp;<span class="builtinfunc" id="3753312">make</span><span class="op" id="3753316">(</span><span class="op" id="3753317">[</span><span class="op" id="3753318">]</span><span class="builtintype" id="3753319">byte</span><span class="op" id="3753323">,</span>&nbsp;<span class="ident" id="3753325">w</span><span class="op" id="3753326">*</span><span class="ident" id="3753327">h</span><span class="op" id="3753328">+</span><span class="num" id="3753329">2</span><span class="op" id="3753330">*</span><span class="ident" id="3753331">cw</span><span class="op" id="3753333">*</span><span class="ident" id="3753334">ch</span><span class="op" id="3753336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3753339">return</span>&nbsp;<span class="op" id="3753346">&amp;</span><span class="ident" id="3753347">YCbCr</span><span class="op" id="3753352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753356">Y</span><span class="op" id="3753357">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753372">b</span><span class="op" id="3753373">[</span><span class="op" id="3753374">:</span><span class="ident" id="3753375">w</span><span class="op" id="3753376">*</span><span class="ident" id="3753377">h</span><span class="op" id="3753378">]</span><span class="op" id="3753379">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753383">Cb</span><span class="op" id="3753385">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753399">b</span><span class="op" id="3753400">[</span><span class="ident" id="3753401">w</span><span class="op" id="3753402">*</span><span class="ident" id="3753403">h</span><span class="op" id="3753404">+</span><span class="num" id="3753405">0</span><span class="op" id="3753406">*</span><span class="ident" id="3753407">cw</span><span class="op" id="3753409">*</span><span class="ident" id="3753410">ch</span>&nbsp;<span class="op" id="3753413">:</span>&nbsp;<span class="ident" id="3753415">w</span><span class="op" id="3753416">*</span><span class="ident" id="3753417">h</span><span class="op" id="3753418">+</span><span class="num" id="3753419">1</span><span class="op" id="3753420">*</span><span class="ident" id="3753421">cw</span><span class="op" id="3753423">*</span><span class="ident" id="3753424">ch</span><span class="op" id="3753426">]</span><span class="op" id="3753427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753431">Cr</span><span class="op" id="3753433">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753447">b</span><span class="op" id="3753448">[</span><span class="ident" id="3753449">w</span><span class="op" id="3753450">*</span><span class="ident" id="3753451">h</span><span class="op" id="3753452">+</span><span class="num" id="3753453">1</span><span class="op" id="3753454">*</span><span class="ident" id="3753455">cw</span><span class="op" id="3753457">*</span><span class="ident" id="3753458">ch</span>&nbsp;<span class="op" id="3753461">:</span>&nbsp;<span class="ident" id="3753463">w</span><span class="op" id="3753464">*</span><span class="ident" id="3753465">h</span><span class="op" id="3753466">+</span><span class="num" id="3753467">2</span><span class="op" id="3753468">*</span><span class="ident" id="3753469">cw</span><span class="op" id="3753471">*</span><span class="ident" id="3753472">ch</span><span class="op" id="3753474">]</span><span class="op" id="3753475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753479">SubsampleRatio</span><span class="op" id="3753493">:</span>&nbsp;<span class="ident" id="3753495">subsampleRatio</span><span class="op" id="3753509">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753513">YStride</span><span class="op" id="3753520">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753529">w</span><span class="op" id="3753530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753534">CStride</span><span class="op" id="3753541">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753550">cw</span><span class="op" id="3753552">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3753556">Rect</span><span class="op" id="3753560">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3753572">r</span><span class="op" id="3753573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3753576">}</span><br>
<span class="lineno"></span><span class="op" id="3753578">}</span>
</div>
</body>
</html>
