<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5824843">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5824898">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5824952">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5825003">package</span>&nbsp;<span class="ident" id="5825011">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5825017">import</span>&nbsp;<span class="op" id="5825024">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5825027">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5825036">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5825046">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5825055">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5825070">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5825075">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5825078">//&nbsp;min&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;of&nbsp;two&nbsp;integers.</span><br>
<span class="lineno"></span><span class="keyword" id="5825122">func</span>&nbsp;<span class="ident" id="5825127">min</span><span class="op" id="5825130">(</span><span class="ident" id="5825131">x</span><span class="op" id="5825132">,</span>&nbsp;<span class="ident" id="5825134">y</span>&nbsp;<span class="builtintype" id="5825136">int</span><span class="op" id="5825139">)</span>&nbsp;<span class="builtintype" id="5825141">int</span>&nbsp;<span class="op" id="5825145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825148">if</span>&nbsp;<span class="ident" id="5825151">x</span>&nbsp;<span class="op" id="5825153">&lt;</span>&nbsp;<span class="ident" id="5825155">y</span>&nbsp;<span class="op" id="5825157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825161">return</span>&nbsp;<span class="ident" id="5825168">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5825171">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825174">return</span>&nbsp;<span class="ident" id="5825181">y</span><br>
<span class="lineno"></span><span class="op" id="5825183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5825186">//&nbsp;div&nbsp;returns&nbsp;a/b&nbsp;rounded&nbsp;to&nbsp;the&nbsp;nearest&nbsp;integer,&nbsp;instead&nbsp;of&nbsp;rounded&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><span class="keyword" id="5825265">func</span>&nbsp;<span class="ident" id="5825270">div</span><span class="op" id="5825273">(</span><span class="ident" id="5825274">a</span><span class="op" id="5825275">,</span>&nbsp;<span class="ident" id="5825277">b</span>&nbsp;<span class="builtintype" id="5825279">int32</span><span class="op" id="5825284">)</span>&nbsp;<span class="builtintype" id="5825286">int32</span>&nbsp;<span class="op" id="5825292">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825295">if</span>&nbsp;<span class="ident" id="5825298">a</span>&nbsp;<span class="op" id="5825300">&gt;=</span>&nbsp;<span class="num" id="5825303">0</span>&nbsp;<span class="op" id="5825305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825309">return</span>&nbsp;<span class="op" id="5825316">(</span><span class="ident" id="5825317">a</span>&nbsp;<span class="op" id="5825319">+</span>&nbsp;<span class="op" id="5825321">(</span><span class="ident" id="5825322">b</span>&nbsp;<span class="op" id="5825324">&gt;&gt;</span>&nbsp;<span class="num" id="5825327">1</span><span class="op" id="5825328">)</span><span class="op" id="5825329">)</span>&nbsp;<span class="op" id="5825331">/</span>&nbsp;<span class="ident" id="5825333">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5825336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5825339">return</span>&nbsp;<span class="op" id="5825346">-</span><span class="op" id="5825347">(</span><span class="op" id="5825348">(</span><span class="op" id="5825349">-</span><span class="ident" id="5825350">a</span>&nbsp;<span class="op" id="5825352">+</span>&nbsp;<span class="op" id="5825354">(</span><span class="ident" id="5825355">b</span>&nbsp;<span class="op" id="5825357">&gt;&gt;</span>&nbsp;<span class="num" id="5825360">1</span><span class="op" id="5825361">)</span><span class="op" id="5825362">)</span>&nbsp;<span class="op" id="5825364">/</span>&nbsp;<span class="ident" id="5825366">b</span><span class="op" id="5825367">)</span><br>
<span class="lineno"></span><span class="op" id="5825369">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5825372">//&nbsp;bitCount&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;needed&nbsp;to&nbsp;hold&nbsp;an&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="5825437">var</span>&nbsp;<span class="ident" id="5825441">bitCount</span>&nbsp;<span class="op" id="5825450">=</span>&nbsp;<span class="op" id="5825452">[</span><span class="num" id="5825453">256</span><span class="op" id="5825456">]</span><span class="builtintype" id="5825457">byte</span><span class="op" id="5825461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5825464">0</span><span class="op" id="5825465">,</span>&nbsp;<span class="num" id="5825467">1</span><span class="op" id="5825468">,</span>&nbsp;<span class="num" id="5825470">2</span><span class="op" id="5825471">,</span>&nbsp;<span class="num" id="5825473">2</span><span class="op" id="5825474">,</span>&nbsp;<span class="num" id="5825476">3</span><span class="op" id="5825477">,</span>&nbsp;<span class="num" id="5825479">3</span><span class="op" id="5825480">,</span>&nbsp;<span class="num" id="5825482">3</span><span class="op" id="5825483">,</span>&nbsp;<span class="num" id="5825485">3</span><span class="op" id="5825486">,</span>&nbsp;<span class="num" id="5825488">4</span><span class="op" id="5825489">,</span>&nbsp;<span class="num" id="5825491">4</span><span class="op" id="5825492">,</span>&nbsp;<span class="num" id="5825494">4</span><span class="op" id="5825495">,</span>&nbsp;<span class="num" id="5825497">4</span><span class="op" id="5825498">,</span>&nbsp;<span class="num" id="5825500">4</span><span class="op" id="5825501">,</span>&nbsp;<span class="num" id="5825503">4</span><span class="op" id="5825504">,</span>&nbsp;<span class="num" id="5825506">4</span><span class="op" id="5825507">,</span>&nbsp;<span class="num" id="5825509">4</span><span class="op" id="5825510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5825513">5</span><span class="op" id="5825514">,</span>&nbsp;<span class="num" id="5825516">5</span><span class="op" id="5825517">,</span>&nbsp;<span class="num" id="5825519">5</span><span class="op" id="5825520">,</span>&nbsp;<span class="num" id="5825522">5</span><span class="op" id="5825523">,</span>&nbsp;<span class="num" id="5825525">5</span><span class="op" id="5825526">,</span>&nbsp;<span class="num" id="5825528">5</span><span class="op" id="5825529">,</span>&nbsp;<span class="num" id="5825531">5</span><span class="op" id="5825532">,</span>&nbsp;<span class="num" id="5825534">5</span><span class="op" id="5825535">,</span>&nbsp;<span class="num" id="5825537">5</span><span class="op" id="5825538">,</span>&nbsp;<span class="num" id="5825540">5</span><span class="op" id="5825541">,</span>&nbsp;<span class="num" id="5825543">5</span><span class="op" id="5825544">,</span>&nbsp;<span class="num" id="5825546">5</span><span class="op" id="5825547">,</span>&nbsp;<span class="num" id="5825549">5</span><span class="op" id="5825550">,</span>&nbsp;<span class="num" id="5825552">5</span><span class="op" id="5825553">,</span>&nbsp;<span class="num" id="5825555">5</span><span class="op" id="5825556">,</span>&nbsp;<span class="num" id="5825558">5</span><span class="op" id="5825559">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5825562">6</span><span class="op" id="5825563">,</span>&nbsp;<span class="num" id="5825565">6</span><span class="op" id="5825566">,</span>&nbsp;<span class="num" id="5825568">6</span><span class="op" id="5825569">,</span>&nbsp;<span class="num" id="5825571">6</span><span class="op" id="5825572">,</span>&nbsp;<span class="num" id="5825574">6</span><span class="op" id="5825575">,</span>&nbsp;<span class="num" id="5825577">6</span><span class="op" id="5825578">,</span>&nbsp;<span class="num" id="5825580">6</span><span class="op" id="5825581">,</span>&nbsp;<span class="num" id="5825583">6</span><span class="op" id="5825584">,</span>&nbsp;<span class="num" id="5825586">6</span><span class="op" id="5825587">,</span>&nbsp;<span class="num" id="5825589">6</span><span class="op" id="5825590">,</span>&nbsp;<span class="num" id="5825592">6</span><span class="op" id="5825593">,</span>&nbsp;<span class="num" id="5825595">6</span><span class="op" id="5825596">,</span>&nbsp;<span class="num" id="5825598">6</span><span class="op" id="5825599">,</span>&nbsp;<span class="num" id="5825601">6</span><span class="op" id="5825602">,</span>&nbsp;<span class="num" id="5825604">6</span><span class="op" id="5825605">,</span>&nbsp;<span class="num" id="5825607">6</span><span class="op" id="5825608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5825611">6</span><span class="op" id="5825612">,</span>&nbsp;<span class="num" id="5825614">6</span><span class="op" id="5825615">,</span>&nbsp;<span class="num" id="5825617">6</span><span class="op" id="5825618">,</span>&nbsp;<span class="num" id="5825620">6</span><span class="op" id="5825621">,</span>&nbsp;<span class="num" id="5825623">6</span><span class="op" id="5825624">,</span>&nbsp;<span class="num" id="5825626">6</span><span class="op" id="5825627">,</span>&nbsp;<span class="num" id="5825629">6</span><span class="op" id="5825630">,</span>&nbsp;<span class="num" id="5825632">6</span><span class="op" id="5825633">,</span>&nbsp;<span class="num" id="5825635">6</span><span class="op" id="5825636">,</span>&nbsp;<span class="num" id="5825638">6</span><span class="op" id="5825639">,</span>&nbsp;<span class="num" id="5825641">6</span><span class="op" id="5825642">,</span>&nbsp;<span class="num" id="5825644">6</span><span class="op" id="5825645">,</span>&nbsp;<span class="num" id="5825647">6</span><span class="op" id="5825648">,</span>&nbsp;<span class="num" id="5825650">6</span><span class="op" id="5825651">,</span>&nbsp;<span class="num" id="5825653">6</span><span class="op" id="5825654">,</span>&nbsp;<span class="num" id="5825656">6</span><span class="op" id="5825657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5825660">7</span><span class="op" id="5825661">,</span>&nbsp;<span class="num" id="5825663">7</span><span class="op" id="5825664">,</span>&nbsp;<span class="num" id="5825666">7</span><span class="op" id="5825667">,</span>&nbsp;<span class="num" id="5825669">7</span><span class="op" id="5825670">,</span>&nbsp;<span class="num" id="5825672">7</span><span class="op" id="5825673">,</span>&nbsp;<span class="num" id="5825675">7</span><span class="op" id="5825676">,</span>&nbsp;<span class="num" id="5825678">7</span><span class="op" id="5825679">,</span>&nbsp;<span class="num" id="5825681">7</span><span class="op" id="5825682">,</span>&nbsp;<span class="num" id="5825684">7</span><span class="op" id="5825685">,</span>&nbsp;<span class="num" id="5825687">7</span><span class="op" id="5825688">,</span>&nbsp;<span class="num" id="5825690">7</span><span class="op" id="5825691">,</span>&nbsp;<span class="num" id="5825693">7</span><span class="op" id="5825694">,</span>&nbsp;<span class="num" id="5825696">7</span><span class="op" id="5825697">,</span>&nbsp;<span class="num" id="5825699">7</span><span class="op" id="5825700">,</span>&nbsp;<span class="num" id="5825702">7</span><span class="op" id="5825703">,</span>&nbsp;<span class="num" id="5825705">7</span><span class="op" id="5825706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5825709">7</span><span class="op" id="5825710">,</span>&nbsp;<span class="num" id="5825712">7</span><span class="op" id="5825713">,</span>&nbsp;<span class="num" id="5825715">7</span><span class="op" id="5825716">,</span>&nbsp;<span class="num" id="5825718">7</span><span class="op" id="5825719">,</span>&nbsp;<span class="num" id="5825721">7</span><span class="op" id="5825722">,</span>&nbsp;<span class="num" id="5825724">7</span><span class="op" id="5825725">,</span>&nbsp;<span class="num" id="5825727">7</span><span class="op" id="5825728">,</span>&nbsp;<span class="num" id="5825730">7</span><span class="op" id="5825731">,</span>&nbsp;<span class="num" id="5825733">7</span><span class="op" id="5825734">,</span>&nbsp;<span class="num" id="5825736">7</span><span class="op" id="5825737">,</span>&nbsp;<span class="num" id="5825739">7</span><span class="op" id="5825740">,</span>&nbsp;<span class="num" id="5825742">7</span><span class="op" id="5825743">,</span>&nbsp;<span class="num" id="5825745">7</span><span class="op" id="5825746">,</span>&nbsp;<span class="num" id="5825748">7</span><span class="op" id="5825749">,</span>&nbsp;<span class="num" id="5825751">7</span><span class="op" id="5825752">,</span>&nbsp;<span class="num" id="5825754">7</span><span class="op" id="5825755">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5825758">7</span><span class="op" id="5825759">,</span>&nbsp;<span class="num" id="5825761">7</span><span class="op" id="5825762">,</span>&nbsp;<span class="num" id="5825764">7</span><span class="op" id="5825765">,</span>&nbsp;<span class="num" id="5825767">7</span><span class="op" id="5825768">,</span>&nbsp;<span class="num" id="5825770">7</span><span class="op" id="5825771">,</span>&nbsp;<span class="num" id="5825773">7</span><span class="op" id="5825774">,</span>&nbsp;<span class="num" id="5825776">7</span><span class="op" id="5825777">,</span>&nbsp;<span class="num" id="5825779">7</span><span class="op" id="5825780">,</span>&nbsp;<span class="num" id="5825782">7</span><span class="op" id="5825783">,</span>&nbsp;<span class="num" id="5825785">7</span><span class="op" id="5825786">,</span>&nbsp;<span class="num" id="5825788">7</span><span class="op" id="5825789">,</span>&nbsp;<span class="num" id="5825791">7</span><span class="op" id="5825792">,</span>&nbsp;<span class="num" id="5825794">7</span><span class="op" id="5825795">,</span>&nbsp;<span class="num" id="5825797">7</span><span class="op" id="5825798">,</span>&nbsp;<span class="num" id="5825800">7</span><span class="op" id="5825801">,</span>&nbsp;<span class="num" id="5825803">7</span><span class="op" id="5825804">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5825807">7</span><span class="op" id="5825808">,</span>&nbsp;<span class="num" id="5825810">7</span><span class="op" id="5825811">,</span>&nbsp;<span class="num" id="5825813">7</span><span class="op" id="5825814">,</span>&nbsp;<span class="num" id="5825816">7</span><span class="op" id="5825817">,</span>&nbsp;<span class="num" id="5825819">7</span><span class="op" id="5825820">,</span>&nbsp;<span class="num" id="5825822">7</span><span class="op" id="5825823">,</span>&nbsp;<span class="num" id="5825825">7</span><span class="op" id="5825826">,</span>&nbsp;<span class="num" id="5825828">7</span><span class="op" id="5825829">,</span>&nbsp;<span class="num" id="5825831">7</span><span class="op" id="5825832">,</span>&nbsp;<span class="num" id="5825834">7</span><span class="op" id="5825835">,</span>&nbsp;<span class="num" id="5825837">7</span><span class="op" id="5825838">,</span>&nbsp;<span class="num" id="5825840">7</span><span class="op" id="5825841">,</span>&nbsp;<span class="num" id="5825843">7</span><span class="op" id="5825844">,</span>&nbsp;<span class="num" id="5825846">7</span><span class="op" id="5825847">,</span>&nbsp;<span class="num" id="5825849">7</span><span class="op" id="5825850">,</span>&nbsp;<span class="num" id="5825852">7</span><span class="op" id="5825853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5825856">8</span><span class="op" id="5825857">,</span>&nbsp;<span class="num" id="5825859">8</span><span class="op" id="5825860">,</span>&nbsp;<span class="num" id="5825862">8</span><span class="op" id="5825863">,</span>&nbsp;<span class="num" id="5825865">8</span><span class="op" id="5825866">,</span>&nbsp;<span class="num" id="5825868">8</span><span class="op" id="5825869">,</span>&nbsp;<span class="num" id="5825871">8</span><span class="op" id="5825872">,</span>&nbsp;<span class="num" id="5825874">8</span><span class="op" id="5825875">,</span>&nbsp;<span class="num" id="5825877">8</span><span class="op" id="5825878">,</span>&nbsp;<span class="num" id="5825880">8</span><span class="op" id="5825881">,</span>&nbsp;<span class="num" id="5825883">8</span><span class="op" id="5825884">,</span>&nbsp;<span class="num" id="5825886">8</span><span class="op" id="5825887">,</span>&nbsp;<span class="num" id="5825889">8</span><span class="op" id="5825890">,</span>&nbsp;<span class="num" id="5825892">8</span><span class="op" id="5825893">,</span>&nbsp;<span class="num" id="5825895">8</span><span class="op" id="5825896">,</span>&nbsp;<span class="num" id="5825898">8</span><span class="op" id="5825899">,</span>&nbsp;<span class="num" id="5825901">8</span><span class="op" id="5825902">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5825905">8</span><span class="op" id="5825906">,</span>&nbsp;<span class="num" id="5825908">8</span><span class="op" id="5825909">,</span>&nbsp;<span class="num" id="5825911">8</span><span class="op" id="5825912">,</span>&nbsp;<span class="num" id="5825914">8</span><span class="op" id="5825915">,</span>&nbsp;<span class="num" id="5825917">8</span><span class="op" id="5825918">,</span>&nbsp;<span class="num" id="5825920">8</span><span class="op" id="5825921">,</span>&nbsp;<span class="num" id="5825923">8</span><span class="op" id="5825924">,</span>&nbsp;<span class="num" id="5825926">8</span><span class="op" id="5825927">,</span>&nbsp;<span class="num" id="5825929">8</span><span class="op" id="5825930">,</span>&nbsp;<span class="num" id="5825932">8</span><span class="op" id="5825933">,</span>&nbsp;<span class="num" id="5825935">8</span><span class="op" id="5825936">,</span>&nbsp;<span class="num" id="5825938">8</span><span class="op" id="5825939">,</span>&nbsp;<span class="num" id="5825941">8</span><span class="op" id="5825942">,</span>&nbsp;<span class="num" id="5825944">8</span><span class="op" id="5825945">,</span>&nbsp;<span class="num" id="5825947">8</span><span class="op" id="5825948">,</span>&nbsp;<span class="num" id="5825950">8</span><span class="op" id="5825951">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5825954">8</span><span class="op" id="5825955">,</span>&nbsp;<span class="num" id="5825957">8</span><span class="op" id="5825958">,</span>&nbsp;<span class="num" id="5825960">8</span><span class="op" id="5825961">,</span>&nbsp;<span class="num" id="5825963">8</span><span class="op" id="5825964">,</span>&nbsp;<span class="num" id="5825966">8</span><span class="op" id="5825967">,</span>&nbsp;<span class="num" id="5825969">8</span><span class="op" id="5825970">,</span>&nbsp;<span class="num" id="5825972">8</span><span class="op" id="5825973">,</span>&nbsp;<span class="num" id="5825975">8</span><span class="op" id="5825976">,</span>&nbsp;<span class="num" id="5825978">8</span><span class="op" id="5825979">,</span>&nbsp;<span class="num" id="5825981">8</span><span class="op" id="5825982">,</span>&nbsp;<span class="num" id="5825984">8</span><span class="op" id="5825985">,</span>&nbsp;<span class="num" id="5825987">8</span><span class="op" id="5825988">,</span>&nbsp;<span class="num" id="5825990">8</span><span class="op" id="5825991">,</span>&nbsp;<span class="num" id="5825993">8</span><span class="op" id="5825994">,</span>&nbsp;<span class="num" id="5825996">8</span><span class="op" id="5825997">,</span>&nbsp;<span class="num" id="5825999">8</span><span class="op" id="5826000">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5826003">8</span><span class="op" id="5826004">,</span>&nbsp;<span class="num" id="5826006">8</span><span class="op" id="5826007">,</span>&nbsp;<span class="num" id="5826009">8</span><span class="op" id="5826010">,</span>&nbsp;<span class="num" id="5826012">8</span><span class="op" id="5826013">,</span>&nbsp;<span class="num" id="5826015">8</span><span class="op" id="5826016">,</span>&nbsp;<span class="num" id="5826018">8</span><span class="op" id="5826019">,</span>&nbsp;<span class="num" id="5826021">8</span><span class="op" id="5826022">,</span>&nbsp;<span class="num" id="5826024">8</span><span class="op" id="5826025">,</span>&nbsp;<span class="num" id="5826027">8</span><span class="op" id="5826028">,</span>&nbsp;<span class="num" id="5826030">8</span><span class="op" id="5826031">,</span>&nbsp;<span class="num" id="5826033">8</span><span class="op" id="5826034">,</span>&nbsp;<span class="num" id="5826036">8</span><span class="op" id="5826037">,</span>&nbsp;<span class="num" id="5826039">8</span><span class="op" id="5826040">,</span>&nbsp;<span class="num" id="5826042">8</span><span class="op" id="5826043">,</span>&nbsp;<span class="num" id="5826045">8</span><span class="op" id="5826046">,</span>&nbsp;<span class="num" id="5826048">8</span><span class="op" id="5826049">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5826052">8</span><span class="op" id="5826053">,</span>&nbsp;<span class="num" id="5826055">8</span><span class="op" id="5826056">,</span>&nbsp;<span class="num" id="5826058">8</span><span class="op" id="5826059">,</span>&nbsp;<span class="num" id="5826061">8</span><span class="op" id="5826062">,</span>&nbsp;<span class="num" id="5826064">8</span><span class="op" id="5826065">,</span>&nbsp;<span class="num" id="5826067">8</span><span class="op" id="5826068">,</span>&nbsp;<span class="num" id="5826070">8</span><span class="op" id="5826071">,</span>&nbsp;<span class="num" id="5826073">8</span><span class="op" id="5826074">,</span>&nbsp;<span class="num" id="5826076">8</span><span class="op" id="5826077">,</span>&nbsp;<span class="num" id="5826079">8</span><span class="op" id="5826080">,</span>&nbsp;<span class="num" id="5826082">8</span><span class="op" id="5826083">,</span>&nbsp;<span class="num" id="5826085">8</span><span class="op" id="5826086">,</span>&nbsp;<span class="num" id="5826088">8</span><span class="op" id="5826089">,</span>&nbsp;<span class="num" id="5826091">8</span><span class="op" id="5826092">,</span>&nbsp;<span class="num" id="5826094">8</span><span class="op" id="5826095">,</span>&nbsp;<span class="num" id="5826097">8</span><span class="op" id="5826098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5826101">8</span><span class="op" id="5826102">,</span>&nbsp;<span class="num" id="5826104">8</span><span class="op" id="5826105">,</span>&nbsp;<span class="num" id="5826107">8</span><span class="op" id="5826108">,</span>&nbsp;<span class="num" id="5826110">8</span><span class="op" id="5826111">,</span>&nbsp;<span class="num" id="5826113">8</span><span class="op" id="5826114">,</span>&nbsp;<span class="num" id="5826116">8</span><span class="op" id="5826117">,</span>&nbsp;<span class="num" id="5826119">8</span><span class="op" id="5826120">,</span>&nbsp;<span class="num" id="5826122">8</span><span class="op" id="5826123">,</span>&nbsp;<span class="num" id="5826125">8</span><span class="op" id="5826126">,</span>&nbsp;<span class="num" id="5826128">8</span><span class="op" id="5826129">,</span>&nbsp;<span class="num" id="5826131">8</span><span class="op" id="5826132">,</span>&nbsp;<span class="num" id="5826134">8</span><span class="op" id="5826135">,</span>&nbsp;<span class="num" id="5826137">8</span><span class="op" id="5826138">,</span>&nbsp;<span class="num" id="5826140">8</span><span class="op" id="5826141">,</span>&nbsp;<span class="num" id="5826143">8</span><span class="op" id="5826144">,</span>&nbsp;<span class="num" id="5826146">8</span><span class="op" id="5826147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5826150">8</span><span class="op" id="5826151">,</span>&nbsp;<span class="num" id="5826153">8</span><span class="op" id="5826154">,</span>&nbsp;<span class="num" id="5826156">8</span><span class="op" id="5826157">,</span>&nbsp;<span class="num" id="5826159">8</span><span class="op" id="5826160">,</span>&nbsp;<span class="num" id="5826162">8</span><span class="op" id="5826163">,</span>&nbsp;<span class="num" id="5826165">8</span><span class="op" id="5826166">,</span>&nbsp;<span class="num" id="5826168">8</span><span class="op" id="5826169">,</span>&nbsp;<span class="num" id="5826171">8</span><span class="op" id="5826172">,</span>&nbsp;<span class="num" id="5826174">8</span><span class="op" id="5826175">,</span>&nbsp;<span class="num" id="5826177">8</span><span class="op" id="5826178">,</span>&nbsp;<span class="num" id="5826180">8</span><span class="op" id="5826181">,</span>&nbsp;<span class="num" id="5826183">8</span><span class="op" id="5826184">,</span>&nbsp;<span class="num" id="5826186">8</span><span class="op" id="5826187">,</span>&nbsp;<span class="num" id="5826189">8</span><span class="op" id="5826190">,</span>&nbsp;<span class="num" id="5826192">8</span><span class="op" id="5826193">,</span>&nbsp;<span class="num" id="5826195">8</span><span class="op" id="5826196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5826199">8</span><span class="op" id="5826200">,</span>&nbsp;<span class="num" id="5826202">8</span><span class="op" id="5826203">,</span>&nbsp;<span class="num" id="5826205">8</span><span class="op" id="5826206">,</span>&nbsp;<span class="num" id="5826208">8</span><span class="op" id="5826209">,</span>&nbsp;<span class="num" id="5826211">8</span><span class="op" id="5826212">,</span>&nbsp;<span class="num" id="5826214">8</span><span class="op" id="5826215">,</span>&nbsp;<span class="num" id="5826217">8</span><span class="op" id="5826218">,</span>&nbsp;<span class="num" id="5826220">8</span><span class="op" id="5826221">,</span>&nbsp;<span class="num" id="5826223">8</span><span class="op" id="5826224">,</span>&nbsp;<span class="num" id="5826226">8</span><span class="op" id="5826227">,</span>&nbsp;<span class="num" id="5826229">8</span><span class="op" id="5826230">,</span>&nbsp;<span class="num" id="5826232">8</span><span class="op" id="5826233">,</span>&nbsp;<span class="num" id="5826235">8</span><span class="op" id="5826236">,</span>&nbsp;<span class="num" id="5826238">8</span><span class="op" id="5826239">,</span>&nbsp;<span class="num" id="5826241">8</span><span class="op" id="5826242">,</span>&nbsp;<span class="num" id="5826244">8</span><span class="op" id="5826245">,</span><br>
<span class="lineno"></span><span class="op" id="5826247">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5826250">type</span>&nbsp;<span class="ident" id="5826255">quantIndex</span>&nbsp;<span class="builtintype" id="5826266">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5826271">const</span>&nbsp;<span class="op" id="5826277">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5826280">quantIndexLuminance</span>&nbsp;<span class="ident" id="5826300">quantIndex</span>&nbsp;<span class="op" id="5826311">=</span>&nbsp;<span class="ident" id="5826313">iota</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5826319">quantIndexChrominance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5826342">nQuantIndex</span><br>
<span class="lineno"></span><span class="op" id="5826354">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5826357">//&nbsp;unscaledQuant&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;Each</span><br>
<span class="lineno">60</span><span class="comment" id="5826434">//&nbsp;encoder&nbsp;copies&nbsp;and&nbsp;scales&nbsp;the&nbsp;tables&nbsp;according&nbsp;to&nbsp;its&nbsp;quality&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="5826510">//&nbsp;The&nbsp;values&nbsp;are&nbsp;derived&nbsp;from&nbsp;section&nbsp;K.1&nbsp;after&nbsp;converting&nbsp;from&nbsp;natural&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5826586">//&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5826604">var</span>&nbsp;<span class="ident" id="5826608">unscaledQuant</span>&nbsp;<span class="op" id="5826622">=</span>&nbsp;<span class="op" id="5826624">[</span><span class="ident" id="5826625">nQuantIndex</span><span class="op" id="5826636">]</span><span class="op" id="5826637">[</span><span class="ident" id="5826638">blockSize</span><span class="op" id="5826647">]</span><span class="builtintype" id="5826648">byte</span><span class="op" id="5826652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5826655">//&nbsp;Luminance.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5826670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5826674">16</span><span class="op" id="5826676">,</span>&nbsp;<span class="num" id="5826678">11</span><span class="op" id="5826680">,</span>&nbsp;<span class="num" id="5826682">12</span><span class="op" id="5826684">,</span>&nbsp;<span class="num" id="5826686">14</span><span class="op" id="5826688">,</span>&nbsp;<span class="num" id="5826690">12</span><span class="op" id="5826692">,</span>&nbsp;<span class="num" id="5826694">10</span><span class="op" id="5826696">,</span>&nbsp;<span class="num" id="5826698">16</span><span class="op" id="5826700">,</span>&nbsp;<span class="num" id="5826702">14</span><span class="op" id="5826704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5826708">13</span><span class="op" id="5826710">,</span>&nbsp;<span class="num" id="5826712">14</span><span class="op" id="5826714">,</span>&nbsp;<span class="num" id="5826716">18</span><span class="op" id="5826718">,</span>&nbsp;<span class="num" id="5826720">17</span><span class="op" id="5826722">,</span>&nbsp;<span class="num" id="5826724">16</span><span class="op" id="5826726">,</span>&nbsp;<span class="num" id="5826728">19</span><span class="op" id="5826730">,</span>&nbsp;<span class="num" id="5826732">24</span><span class="op" id="5826734">,</span>&nbsp;<span class="num" id="5826736">40</span><span class="op" id="5826738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5826742">26</span><span class="op" id="5826744">,</span>&nbsp;<span class="num" id="5826746">24</span><span class="op" id="5826748">,</span>&nbsp;<span class="num" id="5826750">22</span><span class="op" id="5826752">,</span>&nbsp;<span class="num" id="5826754">22</span><span class="op" id="5826756">,</span>&nbsp;<span class="num" id="5826758">24</span><span class="op" id="5826760">,</span>&nbsp;<span class="num" id="5826762">49</span><span class="op" id="5826764">,</span>&nbsp;<span class="num" id="5826766">35</span><span class="op" id="5826768">,</span>&nbsp;<span class="num" id="5826770">37</span><span class="op" id="5826772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5826776">29</span><span class="op" id="5826778">,</span>&nbsp;<span class="num" id="5826780">40</span><span class="op" id="5826782">,</span>&nbsp;<span class="num" id="5826784">58</span><span class="op" id="5826786">,</span>&nbsp;<span class="num" id="5826788">51</span><span class="op" id="5826790">,</span>&nbsp;<span class="num" id="5826792">61</span><span class="op" id="5826794">,</span>&nbsp;<span class="num" id="5826796">60</span><span class="op" id="5826798">,</span>&nbsp;<span class="num" id="5826800">57</span><span class="op" id="5826802">,</span>&nbsp;<span class="num" id="5826804">51</span><span class="op" id="5826806">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5826810">56</span><span class="op" id="5826812">,</span>&nbsp;<span class="num" id="5826814">55</span><span class="op" id="5826816">,</span>&nbsp;<span class="num" id="5826818">64</span><span class="op" id="5826820">,</span>&nbsp;<span class="num" id="5826822">72</span><span class="op" id="5826824">,</span>&nbsp;<span class="num" id="5826826">92</span><span class="op" id="5826828">,</span>&nbsp;<span class="num" id="5826830">78</span><span class="op" id="5826832">,</span>&nbsp;<span class="num" id="5826834">64</span><span class="op" id="5826836">,</span>&nbsp;<span class="num" id="5826838">68</span><span class="op" id="5826840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5826844">87</span><span class="op" id="5826846">,</span>&nbsp;<span class="num" id="5826848">69</span><span class="op" id="5826850">,</span>&nbsp;<span class="num" id="5826852">55</span><span class="op" id="5826854">,</span>&nbsp;<span class="num" id="5826856">56</span><span class="op" id="5826858">,</span>&nbsp;<span class="num" id="5826860">80</span><span class="op" id="5826862">,</span>&nbsp;<span class="num" id="5826864">109</span><span class="op" id="5826867">,</span>&nbsp;<span class="num" id="5826869">81</span><span class="op" id="5826871">,</span>&nbsp;<span class="num" id="5826873">87</span><span class="op" id="5826875">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5826879">95</span><span class="op" id="5826881">,</span>&nbsp;<span class="num" id="5826883">98</span><span class="op" id="5826885">,</span>&nbsp;<span class="num" id="5826887">103</span><span class="op" id="5826890">,</span>&nbsp;<span class="num" id="5826892">104</span><span class="op" id="5826895">,</span>&nbsp;<span class="num" id="5826897">103</span><span class="op" id="5826900">,</span>&nbsp;<span class="num" id="5826902">62</span><span class="op" id="5826904">,</span>&nbsp;<span class="num" id="5826906">77</span><span class="op" id="5826908">,</span>&nbsp;<span class="num" id="5826910">113</span><span class="op" id="5826913">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5826917">121</span><span class="op" id="5826920">,</span>&nbsp;<span class="num" id="5826922">112</span><span class="op" id="5826925">,</span>&nbsp;<span class="num" id="5826927">100</span><span class="op" id="5826930">,</span>&nbsp;<span class="num" id="5826932">120</span><span class="op" id="5826935">,</span>&nbsp;<span class="num" id="5826937">92</span><span class="op" id="5826939">,</span>&nbsp;<span class="num" id="5826941">101</span><span class="op" id="5826944">,</span>&nbsp;<span class="num" id="5826946">103</span><span class="op" id="5826949">,</span>&nbsp;<span class="num" id="5826951">99</span><span class="op" id="5826953">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5826956">}</span><span class="op" id="5826957">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5826960">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5826977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5826981">17</span><span class="op" id="5826983">,</span>&nbsp;<span class="num" id="5826985">18</span><span class="op" id="5826987">,</span>&nbsp;<span class="num" id="5826989">18</span><span class="op" id="5826991">,</span>&nbsp;<span class="num" id="5826993">24</span><span class="op" id="5826995">,</span>&nbsp;<span class="num" id="5826997">21</span><span class="op" id="5826999">,</span>&nbsp;<span class="num" id="5827001">24</span><span class="op" id="5827003">,</span>&nbsp;<span class="num" id="5827005">47</span><span class="op" id="5827007">,</span>&nbsp;<span class="num" id="5827009">26</span><span class="op" id="5827011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5827015">26</span><span class="op" id="5827017">,</span>&nbsp;<span class="num" id="5827019">47</span><span class="op" id="5827021">,</span>&nbsp;<span class="num" id="5827023">99</span><span class="op" id="5827025">,</span>&nbsp;<span class="num" id="5827027">66</span><span class="op" id="5827029">,</span>&nbsp;<span class="num" id="5827031">56</span><span class="op" id="5827033">,</span>&nbsp;<span class="num" id="5827035">66</span><span class="op" id="5827037">,</span>&nbsp;<span class="num" id="5827039">99</span><span class="op" id="5827041">,</span>&nbsp;<span class="num" id="5827043">99</span><span class="op" id="5827045">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5827049">99</span><span class="op" id="5827051">,</span>&nbsp;<span class="num" id="5827053">99</span><span class="op" id="5827055">,</span>&nbsp;<span class="num" id="5827057">99</span><span class="op" id="5827059">,</span>&nbsp;<span class="num" id="5827061">99</span><span class="op" id="5827063">,</span>&nbsp;<span class="num" id="5827065">99</span><span class="op" id="5827067">,</span>&nbsp;<span class="num" id="5827069">99</span><span class="op" id="5827071">,</span>&nbsp;<span class="num" id="5827073">99</span><span class="op" id="5827075">,</span>&nbsp;<span class="num" id="5827077">99</span><span class="op" id="5827079">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5827083">99</span><span class="op" id="5827085">,</span>&nbsp;<span class="num" id="5827087">99</span><span class="op" id="5827089">,</span>&nbsp;<span class="num" id="5827091">99</span><span class="op" id="5827093">,</span>&nbsp;<span class="num" id="5827095">99</span><span class="op" id="5827097">,</span>&nbsp;<span class="num" id="5827099">99</span><span class="op" id="5827101">,</span>&nbsp;<span class="num" id="5827103">99</span><span class="op" id="5827105">,</span>&nbsp;<span class="num" id="5827107">99</span><span class="op" id="5827109">,</span>&nbsp;<span class="num" id="5827111">99</span><span class="op" id="5827113">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5827117">99</span><span class="op" id="5827119">,</span>&nbsp;<span class="num" id="5827121">99</span><span class="op" id="5827123">,</span>&nbsp;<span class="num" id="5827125">99</span><span class="op" id="5827127">,</span>&nbsp;<span class="num" id="5827129">99</span><span class="op" id="5827131">,</span>&nbsp;<span class="num" id="5827133">99</span><span class="op" id="5827135">,</span>&nbsp;<span class="num" id="5827137">99</span><span class="op" id="5827139">,</span>&nbsp;<span class="num" id="5827141">99</span><span class="op" id="5827143">,</span>&nbsp;<span class="num" id="5827145">99</span><span class="op" id="5827147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5827151">99</span><span class="op" id="5827153">,</span>&nbsp;<span class="num" id="5827155">99</span><span class="op" id="5827157">,</span>&nbsp;<span class="num" id="5827159">99</span><span class="op" id="5827161">,</span>&nbsp;<span class="num" id="5827163">99</span><span class="op" id="5827165">,</span>&nbsp;<span class="num" id="5827167">99</span><span class="op" id="5827169">,</span>&nbsp;<span class="num" id="5827171">99</span><span class="op" id="5827173">,</span>&nbsp;<span class="num" id="5827175">99</span><span class="op" id="5827177">,</span>&nbsp;<span class="num" id="5827179">99</span><span class="op" id="5827181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5827185">99</span><span class="op" id="5827187">,</span>&nbsp;<span class="num" id="5827189">99</span><span class="op" id="5827191">,</span>&nbsp;<span class="num" id="5827193">99</span><span class="op" id="5827195">,</span>&nbsp;<span class="num" id="5827197">99</span><span class="op" id="5827199">,</span>&nbsp;<span class="num" id="5827201">99</span><span class="op" id="5827203">,</span>&nbsp;<span class="num" id="5827205">99</span><span class="op" id="5827207">,</span>&nbsp;<span class="num" id="5827209">99</span><span class="op" id="5827211">,</span>&nbsp;<span class="num" id="5827213">99</span><span class="op" id="5827215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5827219">99</span><span class="op" id="5827221">,</span>&nbsp;<span class="num" id="5827223">99</span><span class="op" id="5827225">,</span>&nbsp;<span class="num" id="5827227">99</span><span class="op" id="5827229">,</span>&nbsp;<span class="num" id="5827231">99</span><span class="op" id="5827233">,</span>&nbsp;<span class="num" id="5827235">99</span><span class="op" id="5827237">,</span>&nbsp;<span class="num" id="5827239">99</span><span class="op" id="5827241">,</span>&nbsp;<span class="num" id="5827243">99</span><span class="op" id="5827245">,</span>&nbsp;<span class="num" id="5827247">99</span><span class="op" id="5827249">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5827252">}</span><span class="op" id="5827253">,</span><br>
<span class="lineno"></span><span class="op" id="5827255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5827258">type</span>&nbsp;<span class="ident" id="5827263">huffIndex</span>&nbsp;<span class="builtintype" id="5827273">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="5827278">const</span>&nbsp;<span class="op" id="5827284">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5827287">huffIndexLuminanceDC</span>&nbsp;<span class="ident" id="5827308">huffIndex</span>&nbsp;<span class="op" id="5827318">=</span>&nbsp;<span class="ident" id="5827320">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5827326">huffIndexLuminanceAC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5827348">huffIndexChrominanceDC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5827372">huffIndexChrominanceAC</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5827396">nHuffIndex</span><br>
<span class="lineno"></span><span class="op" id="5827407">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5827410">//&nbsp;huffmanSpec&nbsp;specifies&nbsp;a&nbsp;Huffman&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5827455">type</span>&nbsp;<span class="ident" id="5827460">huffmanSpec</span>&nbsp;<span class="keyword" id="5827472">struct</span>&nbsp;<span class="op" id="5827479">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5827482">//&nbsp;count[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;length&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5827536">count</span>&nbsp;<span class="op" id="5827542">[</span><span class="num" id="5827543">16</span><span class="op" id="5827545">]</span><span class="builtintype" id="5827546">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5827552">//&nbsp;value[i]&nbsp;is&nbsp;the&nbsp;decoded&nbsp;value&nbsp;of&nbsp;the&nbsp;i&#39;th&nbsp;codeword.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5827608">value</span>&nbsp;<span class="op" id="5827614">[</span><span class="op" id="5827615">]</span><span class="builtintype" id="5827616">byte</span><br>
<span class="lineno"></span><span class="op" id="5827621">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="5827624">//&nbsp;theHuffmanSpec&nbsp;is&nbsp;the&nbsp;Huffman&nbsp;encoding&nbsp;specifications.</span><br>
<span class="lineno"></span><span class="comment" id="5827682">//&nbsp;This&nbsp;encoder&nbsp;uses&nbsp;the&nbsp;same&nbsp;Huffman&nbsp;encoding&nbsp;for&nbsp;all&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="5827745">var</span>&nbsp;<span class="ident" id="5827749">theHuffmanSpec</span>&nbsp;<span class="op" id="5827764">=</span>&nbsp;<span class="op" id="5827766">[</span><span class="ident" id="5827767">nHuffIndex</span><span class="op" id="5827777">]</span><span class="ident" id="5827778">huffmanSpec</span><span class="op" id="5827789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5827792">//&nbsp;Luminance&nbsp;DC.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5827810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5827814">[</span><span class="num" id="5827815">16</span><span class="op" id="5827817">]</span><span class="builtintype" id="5827818">byte</span><span class="op" id="5827822">{</span><span class="num" id="5827823">0</span><span class="op" id="5827824">,</span>&nbsp;<span class="num" id="5827826">1</span><span class="op" id="5827827">,</span>&nbsp;<span class="num" id="5827829">5</span><span class="op" id="5827830">,</span>&nbsp;<span class="num" id="5827832">1</span><span class="op" id="5827833">,</span>&nbsp;<span class="num" id="5827835">1</span><span class="op" id="5827836">,</span>&nbsp;<span class="num" id="5827838">1</span><span class="op" id="5827839">,</span>&nbsp;<span class="num" id="5827841">1</span><span class="op" id="5827842">,</span>&nbsp;<span class="num" id="5827844">1</span><span class="op" id="5827845">,</span>&nbsp;<span class="num" id="5827847">1</span><span class="op" id="5827848">,</span>&nbsp;<span class="num" id="5827850">0</span><span class="op" id="5827851">,</span>&nbsp;<span class="num" id="5827853">0</span><span class="op" id="5827854">,</span>&nbsp;<span class="num" id="5827856">0</span><span class="op" id="5827857">,</span>&nbsp;<span class="num" id="5827859">0</span><span class="op" id="5827860">,</span>&nbsp;<span class="num" id="5827862">0</span><span class="op" id="5827863">,</span>&nbsp;<span class="num" id="5827865">0</span><span class="op" id="5827866">,</span>&nbsp;<span class="num" id="5827868">0</span><span class="op" id="5827869">}</span><span class="op" id="5827870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5827874">[</span><span class="op" id="5827875">]</span><span class="builtintype" id="5827876">byte</span><span class="op" id="5827880">{</span><span class="num" id="5827881">0</span><span class="op" id="5827882">,</span>&nbsp;<span class="num" id="5827884">1</span><span class="op" id="5827885">,</span>&nbsp;<span class="num" id="5827887">2</span><span class="op" id="5827888">,</span>&nbsp;<span class="num" id="5827890">3</span><span class="op" id="5827891">,</span>&nbsp;<span class="num" id="5827893">4</span><span class="op" id="5827894">,</span>&nbsp;<span class="num" id="5827896">5</span><span class="op" id="5827897">,</span>&nbsp;<span class="num" id="5827899">6</span><span class="op" id="5827900">,</span>&nbsp;<span class="num" id="5827902">7</span><span class="op" id="5827903">,</span>&nbsp;<span class="num" id="5827905">8</span><span class="op" id="5827906">,</span>&nbsp;<span class="num" id="5827908">9</span><span class="op" id="5827909">,</span>&nbsp;<span class="num" id="5827911">10</span><span class="op" id="5827913">,</span>&nbsp;<span class="num" id="5827915">11</span><span class="op" id="5827917">}</span><span class="op" id="5827918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5827921">}</span><span class="op" id="5827922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5827925">//&nbsp;Luminance&nbsp;AC.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5827943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5827947">[</span><span class="num" id="5827948">16</span><span class="op" id="5827950">]</span><span class="builtintype" id="5827951">byte</span><span class="op" id="5827955">{</span><span class="num" id="5827956">0</span><span class="op" id="5827957">,</span>&nbsp;<span class="num" id="5827959">2</span><span class="op" id="5827960">,</span>&nbsp;<span class="num" id="5827962">1</span><span class="op" id="5827963">,</span>&nbsp;<span class="num" id="5827965">3</span><span class="op" id="5827966">,</span>&nbsp;<span class="num" id="5827968">3</span><span class="op" id="5827969">,</span>&nbsp;<span class="num" id="5827971">2</span><span class="op" id="5827972">,</span>&nbsp;<span class="num" id="5827974">4</span><span class="op" id="5827975">,</span>&nbsp;<span class="num" id="5827977">3</span><span class="op" id="5827978">,</span>&nbsp;<span class="num" id="5827980">5</span><span class="op" id="5827981">,</span>&nbsp;<span class="num" id="5827983">5</span><span class="op" id="5827984">,</span>&nbsp;<span class="num" id="5827986">4</span><span class="op" id="5827987">,</span>&nbsp;<span class="num" id="5827989">4</span><span class="op" id="5827990">,</span>&nbsp;<span class="num" id="5827992">0</span><span class="op" id="5827993">,</span>&nbsp;<span class="num" id="5827995">0</span><span class="op" id="5827996">,</span>&nbsp;<span class="num" id="5827998">1</span><span class="op" id="5827999">,</span>&nbsp;<span class="num" id="5828001">125</span><span class="op" id="5828004">}</span><span class="op" id="5828005">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5828009">[</span><span class="op" id="5828010">]</span><span class="builtintype" id="5828011">byte</span><span class="op" id="5828015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828020">0x01</span><span class="op" id="5828024">,</span>&nbsp;<span class="num" id="5828026">0x02</span><span class="op" id="5828030">,</span>&nbsp;<span class="num" id="5828032">0x03</span><span class="op" id="5828036">,</span>&nbsp;<span class="num" id="5828038">0x00</span><span class="op" id="5828042">,</span>&nbsp;<span class="num" id="5828044">0x04</span><span class="op" id="5828048">,</span>&nbsp;<span class="num" id="5828050">0x11</span><span class="op" id="5828054">,</span>&nbsp;<span class="num" id="5828056">0x05</span><span class="op" id="5828060">,</span>&nbsp;<span class="num" id="5828062">0x12</span><span class="op" id="5828066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828071">0x21</span><span class="op" id="5828075">,</span>&nbsp;<span class="num" id="5828077">0x31</span><span class="op" id="5828081">,</span>&nbsp;<span class="num" id="5828083">0x41</span><span class="op" id="5828087">,</span>&nbsp;<span class="num" id="5828089">0x06</span><span class="op" id="5828093">,</span>&nbsp;<span class="num" id="5828095">0x13</span><span class="op" id="5828099">,</span>&nbsp;<span class="num" id="5828101">0x51</span><span class="op" id="5828105">,</span>&nbsp;<span class="num" id="5828107">0x61</span><span class="op" id="5828111">,</span>&nbsp;<span class="num" id="5828113">0x07</span><span class="op" id="5828117">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828122">0x22</span><span class="op" id="5828126">,</span>&nbsp;<span class="num" id="5828128">0x71</span><span class="op" id="5828132">,</span>&nbsp;<span class="num" id="5828134">0x14</span><span class="op" id="5828138">,</span>&nbsp;<span class="num" id="5828140">0x32</span><span class="op" id="5828144">,</span>&nbsp;<span class="num" id="5828146">0x81</span><span class="op" id="5828150">,</span>&nbsp;<span class="num" id="5828152">0x91</span><span class="op" id="5828156">,</span>&nbsp;<span class="num" id="5828158">0xa1</span><span class="op" id="5828162">,</span>&nbsp;<span class="num" id="5828164">0x08</span><span class="op" id="5828168">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828173">0x23</span><span class="op" id="5828177">,</span>&nbsp;<span class="num" id="5828179">0x42</span><span class="op" id="5828183">,</span>&nbsp;<span class="num" id="5828185">0xb1</span><span class="op" id="5828189">,</span>&nbsp;<span class="num" id="5828191">0xc1</span><span class="op" id="5828195">,</span>&nbsp;<span class="num" id="5828197">0x15</span><span class="op" id="5828201">,</span>&nbsp;<span class="num" id="5828203">0x52</span><span class="op" id="5828207">,</span>&nbsp;<span class="num" id="5828209">0xd1</span><span class="op" id="5828213">,</span>&nbsp;<span class="num" id="5828215">0xf0</span><span class="op" id="5828219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828224">0x24</span><span class="op" id="5828228">,</span>&nbsp;<span class="num" id="5828230">0x33</span><span class="op" id="5828234">,</span>&nbsp;<span class="num" id="5828236">0x62</span><span class="op" id="5828240">,</span>&nbsp;<span class="num" id="5828242">0x72</span><span class="op" id="5828246">,</span>&nbsp;<span class="num" id="5828248">0x82</span><span class="op" id="5828252">,</span>&nbsp;<span class="num" id="5828254">0x09</span><span class="op" id="5828258">,</span>&nbsp;<span class="num" id="5828260">0x0a</span><span class="op" id="5828264">,</span>&nbsp;<span class="num" id="5828266">0x16</span><span class="op" id="5828270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828275">0x17</span><span class="op" id="5828279">,</span>&nbsp;<span class="num" id="5828281">0x18</span><span class="op" id="5828285">,</span>&nbsp;<span class="num" id="5828287">0x19</span><span class="op" id="5828291">,</span>&nbsp;<span class="num" id="5828293">0x1a</span><span class="op" id="5828297">,</span>&nbsp;<span class="num" id="5828299">0x25</span><span class="op" id="5828303">,</span>&nbsp;<span class="num" id="5828305">0x26</span><span class="op" id="5828309">,</span>&nbsp;<span class="num" id="5828311">0x27</span><span class="op" id="5828315">,</span>&nbsp;<span class="num" id="5828317">0x28</span><span class="op" id="5828321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828326">0x29</span><span class="op" id="5828330">,</span>&nbsp;<span class="num" id="5828332">0x2a</span><span class="op" id="5828336">,</span>&nbsp;<span class="num" id="5828338">0x34</span><span class="op" id="5828342">,</span>&nbsp;<span class="num" id="5828344">0x35</span><span class="op" id="5828348">,</span>&nbsp;<span class="num" id="5828350">0x36</span><span class="op" id="5828354">,</span>&nbsp;<span class="num" id="5828356">0x37</span><span class="op" id="5828360">,</span>&nbsp;<span class="num" id="5828362">0x38</span><span class="op" id="5828366">,</span>&nbsp;<span class="num" id="5828368">0x39</span><span class="op" id="5828372">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828377">0x3a</span><span class="op" id="5828381">,</span>&nbsp;<span class="num" id="5828383">0x43</span><span class="op" id="5828387">,</span>&nbsp;<span class="num" id="5828389">0x44</span><span class="op" id="5828393">,</span>&nbsp;<span class="num" id="5828395">0x45</span><span class="op" id="5828399">,</span>&nbsp;<span class="num" id="5828401">0x46</span><span class="op" id="5828405">,</span>&nbsp;<span class="num" id="5828407">0x47</span><span class="op" id="5828411">,</span>&nbsp;<span class="num" id="5828413">0x48</span><span class="op" id="5828417">,</span>&nbsp;<span class="num" id="5828419">0x49</span><span class="op" id="5828423">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828428">0x4a</span><span class="op" id="5828432">,</span>&nbsp;<span class="num" id="5828434">0x53</span><span class="op" id="5828438">,</span>&nbsp;<span class="num" id="5828440">0x54</span><span class="op" id="5828444">,</span>&nbsp;<span class="num" id="5828446">0x55</span><span class="op" id="5828450">,</span>&nbsp;<span class="num" id="5828452">0x56</span><span class="op" id="5828456">,</span>&nbsp;<span class="num" id="5828458">0x57</span><span class="op" id="5828462">,</span>&nbsp;<span class="num" id="5828464">0x58</span><span class="op" id="5828468">,</span>&nbsp;<span class="num" id="5828470">0x59</span><span class="op" id="5828474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828479">0x5a</span><span class="op" id="5828483">,</span>&nbsp;<span class="num" id="5828485">0x63</span><span class="op" id="5828489">,</span>&nbsp;<span class="num" id="5828491">0x64</span><span class="op" id="5828495">,</span>&nbsp;<span class="num" id="5828497">0x65</span><span class="op" id="5828501">,</span>&nbsp;<span class="num" id="5828503">0x66</span><span class="op" id="5828507">,</span>&nbsp;<span class="num" id="5828509">0x67</span><span class="op" id="5828513">,</span>&nbsp;<span class="num" id="5828515">0x68</span><span class="op" id="5828519">,</span>&nbsp;<span class="num" id="5828521">0x69</span><span class="op" id="5828525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828530">0x6a</span><span class="op" id="5828534">,</span>&nbsp;<span class="num" id="5828536">0x73</span><span class="op" id="5828540">,</span>&nbsp;<span class="num" id="5828542">0x74</span><span class="op" id="5828546">,</span>&nbsp;<span class="num" id="5828548">0x75</span><span class="op" id="5828552">,</span>&nbsp;<span class="num" id="5828554">0x76</span><span class="op" id="5828558">,</span>&nbsp;<span class="num" id="5828560">0x77</span><span class="op" id="5828564">,</span>&nbsp;<span class="num" id="5828566">0x78</span><span class="op" id="5828570">,</span>&nbsp;<span class="num" id="5828572">0x79</span><span class="op" id="5828576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828581">0x7a</span><span class="op" id="5828585">,</span>&nbsp;<span class="num" id="5828587">0x83</span><span class="op" id="5828591">,</span>&nbsp;<span class="num" id="5828593">0x84</span><span class="op" id="5828597">,</span>&nbsp;<span class="num" id="5828599">0x85</span><span class="op" id="5828603">,</span>&nbsp;<span class="num" id="5828605">0x86</span><span class="op" id="5828609">,</span>&nbsp;<span class="num" id="5828611">0x87</span><span class="op" id="5828615">,</span>&nbsp;<span class="num" id="5828617">0x88</span><span class="op" id="5828621">,</span>&nbsp;<span class="num" id="5828623">0x89</span><span class="op" id="5828627">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828632">0x8a</span><span class="op" id="5828636">,</span>&nbsp;<span class="num" id="5828638">0x92</span><span class="op" id="5828642">,</span>&nbsp;<span class="num" id="5828644">0x93</span><span class="op" id="5828648">,</span>&nbsp;<span class="num" id="5828650">0x94</span><span class="op" id="5828654">,</span>&nbsp;<span class="num" id="5828656">0x95</span><span class="op" id="5828660">,</span>&nbsp;<span class="num" id="5828662">0x96</span><span class="op" id="5828666">,</span>&nbsp;<span class="num" id="5828668">0x97</span><span class="op" id="5828672">,</span>&nbsp;<span class="num" id="5828674">0x98</span><span class="op" id="5828678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828683">0x99</span><span class="op" id="5828687">,</span>&nbsp;<span class="num" id="5828689">0x9a</span><span class="op" id="5828693">,</span>&nbsp;<span class="num" id="5828695">0xa2</span><span class="op" id="5828699">,</span>&nbsp;<span class="num" id="5828701">0xa3</span><span class="op" id="5828705">,</span>&nbsp;<span class="num" id="5828707">0xa4</span><span class="op" id="5828711">,</span>&nbsp;<span class="num" id="5828713">0xa5</span><span class="op" id="5828717">,</span>&nbsp;<span class="num" id="5828719">0xa6</span><span class="op" id="5828723">,</span>&nbsp;<span class="num" id="5828725">0xa7</span><span class="op" id="5828729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828734">0xa8</span><span class="op" id="5828738">,</span>&nbsp;<span class="num" id="5828740">0xa9</span><span class="op" id="5828744">,</span>&nbsp;<span class="num" id="5828746">0xaa</span><span class="op" id="5828750">,</span>&nbsp;<span class="num" id="5828752">0xb2</span><span class="op" id="5828756">,</span>&nbsp;<span class="num" id="5828758">0xb3</span><span class="op" id="5828762">,</span>&nbsp;<span class="num" id="5828764">0xb4</span><span class="op" id="5828768">,</span>&nbsp;<span class="num" id="5828770">0xb5</span><span class="op" id="5828774">,</span>&nbsp;<span class="num" id="5828776">0xb6</span><span class="op" id="5828780">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828785">0xb7</span><span class="op" id="5828789">,</span>&nbsp;<span class="num" id="5828791">0xb8</span><span class="op" id="5828795">,</span>&nbsp;<span class="num" id="5828797">0xb9</span><span class="op" id="5828801">,</span>&nbsp;<span class="num" id="5828803">0xba</span><span class="op" id="5828807">,</span>&nbsp;<span class="num" id="5828809">0xc2</span><span class="op" id="5828813">,</span>&nbsp;<span class="num" id="5828815">0xc3</span><span class="op" id="5828819">,</span>&nbsp;<span class="num" id="5828821">0xc4</span><span class="op" id="5828825">,</span>&nbsp;<span class="num" id="5828827">0xc5</span><span class="op" id="5828831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828836">0xc6</span><span class="op" id="5828840">,</span>&nbsp;<span class="num" id="5828842">0xc7</span><span class="op" id="5828846">,</span>&nbsp;<span class="num" id="5828848">0xc8</span><span class="op" id="5828852">,</span>&nbsp;<span class="num" id="5828854">0xc9</span><span class="op" id="5828858">,</span>&nbsp;<span class="num" id="5828860">0xca</span><span class="op" id="5828864">,</span>&nbsp;<span class="num" id="5828866">0xd2</span><span class="op" id="5828870">,</span>&nbsp;<span class="num" id="5828872">0xd3</span><span class="op" id="5828876">,</span>&nbsp;<span class="num" id="5828878">0xd4</span><span class="op" id="5828882">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828887">0xd5</span><span class="op" id="5828891">,</span>&nbsp;<span class="num" id="5828893">0xd6</span><span class="op" id="5828897">,</span>&nbsp;<span class="num" id="5828899">0xd7</span><span class="op" id="5828903">,</span>&nbsp;<span class="num" id="5828905">0xd8</span><span class="op" id="5828909">,</span>&nbsp;<span class="num" id="5828911">0xd9</span><span class="op" id="5828915">,</span>&nbsp;<span class="num" id="5828917">0xda</span><span class="op" id="5828921">,</span>&nbsp;<span class="num" id="5828923">0xe1</span><span class="op" id="5828927">,</span>&nbsp;<span class="num" id="5828929">0xe2</span><span class="op" id="5828933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828938">0xe3</span><span class="op" id="5828942">,</span>&nbsp;<span class="num" id="5828944">0xe4</span><span class="op" id="5828948">,</span>&nbsp;<span class="num" id="5828950">0xe5</span><span class="op" id="5828954">,</span>&nbsp;<span class="num" id="5828956">0xe6</span><span class="op" id="5828960">,</span>&nbsp;<span class="num" id="5828962">0xe7</span><span class="op" id="5828966">,</span>&nbsp;<span class="num" id="5828968">0xe8</span><span class="op" id="5828972">,</span>&nbsp;<span class="num" id="5828974">0xe9</span><span class="op" id="5828978">,</span>&nbsp;<span class="num" id="5828980">0xea</span><span class="op" id="5828984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5828989">0xf1</span><span class="op" id="5828993">,</span>&nbsp;<span class="num" id="5828995">0xf2</span><span class="op" id="5828999">,</span>&nbsp;<span class="num" id="5829001">0xf3</span><span class="op" id="5829005">,</span>&nbsp;<span class="num" id="5829007">0xf4</span><span class="op" id="5829011">,</span>&nbsp;<span class="num" id="5829013">0xf5</span><span class="op" id="5829017">,</span>&nbsp;<span class="num" id="5829019">0xf6</span><span class="op" id="5829023">,</span>&nbsp;<span class="num" id="5829025">0xf7</span><span class="op" id="5829029">,</span>&nbsp;<span class="num" id="5829031">0xf8</span><span class="op" id="5829035">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5829040">0xf9</span><span class="op" id="5829044">,</span>&nbsp;<span class="num" id="5829046">0xfa</span><span class="op" id="5829050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5829054">}</span><span class="op" id="5829055">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5829058">}</span><span class="op" id="5829059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5829062">//&nbsp;Chrominance&nbsp;DC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5829082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5829086">[</span><span class="num" id="5829087">16</span><span class="op" id="5829089">]</span><span class="builtintype" id="5829090">byte</span><span class="op" id="5829094">{</span><span class="num" id="5829095">0</span><span class="op" id="5829096">,</span>&nbsp;<span class="num" id="5829098">3</span><span class="op" id="5829099">,</span>&nbsp;<span class="num" id="5829101">1</span><span class="op" id="5829102">,</span>&nbsp;<span class="num" id="5829104">1</span><span class="op" id="5829105">,</span>&nbsp;<span class="num" id="5829107">1</span><span class="op" id="5829108">,</span>&nbsp;<span class="num" id="5829110">1</span><span class="op" id="5829111">,</span>&nbsp;<span class="num" id="5829113">1</span><span class="op" id="5829114">,</span>&nbsp;<span class="num" id="5829116">1</span><span class="op" id="5829117">,</span>&nbsp;<span class="num" id="5829119">1</span><span class="op" id="5829120">,</span>&nbsp;<span class="num" id="5829122">1</span><span class="op" id="5829123">,</span>&nbsp;<span class="num" id="5829125">1</span><span class="op" id="5829126">,</span>&nbsp;<span class="num" id="5829128">0</span><span class="op" id="5829129">,</span>&nbsp;<span class="num" id="5829131">0</span><span class="op" id="5829132">,</span>&nbsp;<span class="num" id="5829134">0</span><span class="op" id="5829135">,</span>&nbsp;<span class="num" id="5829137">0</span><span class="op" id="5829138">,</span>&nbsp;<span class="num" id="5829140">0</span><span class="op" id="5829141">}</span><span class="op" id="5829142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5829146">[</span><span class="op" id="5829147">]</span><span class="builtintype" id="5829148">byte</span><span class="op" id="5829152">{</span><span class="num" id="5829153">0</span><span class="op" id="5829154">,</span>&nbsp;<span class="num" id="5829156">1</span><span class="op" id="5829157">,</span>&nbsp;<span class="num" id="5829159">2</span><span class="op" id="5829160">,</span>&nbsp;<span class="num" id="5829162">3</span><span class="op" id="5829163">,</span>&nbsp;<span class="num" id="5829165">4</span><span class="op" id="5829166">,</span>&nbsp;<span class="num" id="5829168">5</span><span class="op" id="5829169">,</span>&nbsp;<span class="num" id="5829171">6</span><span class="op" id="5829172">,</span>&nbsp;<span class="num" id="5829174">7</span><span class="op" id="5829175">,</span>&nbsp;<span class="num" id="5829177">8</span><span class="op" id="5829178">,</span>&nbsp;<span class="num" id="5829180">9</span><span class="op" id="5829181">,</span>&nbsp;<span class="num" id="5829183">10</span><span class="op" id="5829185">,</span>&nbsp;<span class="num" id="5829187">11</span><span class="op" id="5829189">}</span><span class="op" id="5829190">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5829193">}</span><span class="op" id="5829194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5829197">//&nbsp;Chrominance&nbsp;AC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5829217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5829221">[</span><span class="num" id="5829222">16</span><span class="op" id="5829224">]</span><span class="builtintype" id="5829225">byte</span><span class="op" id="5829229">{</span><span class="num" id="5829230">0</span><span class="op" id="5829231">,</span>&nbsp;<span class="num" id="5829233">2</span><span class="op" id="5829234">,</span>&nbsp;<span class="num" id="5829236">1</span><span class="op" id="5829237">,</span>&nbsp;<span class="num" id="5829239">2</span><span class="op" id="5829240">,</span>&nbsp;<span class="num" id="5829242">4</span><span class="op" id="5829243">,</span>&nbsp;<span class="num" id="5829245">4</span><span class="op" id="5829246">,</span>&nbsp;<span class="num" id="5829248">3</span><span class="op" id="5829249">,</span>&nbsp;<span class="num" id="5829251">4</span><span class="op" id="5829252">,</span>&nbsp;<span class="num" id="5829254">7</span><span class="op" id="5829255">,</span>&nbsp;<span class="num" id="5829257">5</span><span class="op" id="5829258">,</span>&nbsp;<span class="num" id="5829260">4</span><span class="op" id="5829261">,</span>&nbsp;<span class="num" id="5829263">4</span><span class="op" id="5829264">,</span>&nbsp;<span class="num" id="5829266">0</span><span class="op" id="5829267">,</span>&nbsp;<span class="num" id="5829269">1</span><span class="op" id="5829270">,</span>&nbsp;<span class="num" id="5829272">2</span><span class="op" id="5829273">,</span>&nbsp;<span class="num" id="5829275">119</span><span class="op" id="5829278">}</span><span class="op" id="5829279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5829283">[</span><span class="op" id="5829284">]</span><span class="builtintype" id="5829285">byte</span><span class="op" id="5829289">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5829294">0x00</span><span class="op" id="5829298">,</span>&nbsp;<span class="num" id="5829300">0x01</span><span class="op" id="5829304">,</span>&nbsp;<span class="num" id="5829306">0x02</span><span class="op" id="5829310">,</span>&nbsp;<span class="num" id="5829312">0x03</span><span class="op" id="5829316">,</span>&nbsp;<span class="num" id="5829318">0x11</span><span class="op" id="5829322">,</span>&nbsp;<span class="num" id="5829324">0x04</span><span class="op" id="5829328">,</span>&nbsp;<span class="num" id="5829330">0x05</span><span class="op" id="5829334">,</span>&nbsp;<span class="num" id="5829336">0x21</span><span class="op" id="5829340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5829345">0x31</span><span class="op" id="5829349">,</span>&nbsp;<span class="num" id="5829351">0x06</span><span class="op" id="5829355">,</span>&nbsp;<span class="num" id="5829357">0x12</span><span class="op" id="5829361">,</span>&nbsp;<span class="num" id="5829363">0x41</span><span class="op" id="5829367">,</span>&nbsp;<span class="num" id="5829369">0x51</span><span class="op" id="5829373">,</span>&nbsp;<span class="num" id="5829375">0x07</span><span class="op" id="5829379">,</span>&nbsp;<span class="num" id="5829381">0x61</span><span class="op" id="5829385">,</span>&nbsp;<span class="num" id="5829387">0x71</span><span class="op" id="5829391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5829396">0x13</span><span class="op" id="5829400">,</span>&nbsp;<span class="num" id="5829402">0x22</span><span class="op" id="5829406">,</span>&nbsp;<span class="num" id="5829408">0x32</span><span class="op" id="5829412">,</span>&nbsp;<span class="num" id="5829414">0x81</span><span class="op" id="5829418">,</span>&nbsp;<span class="num" id="5829420">0x08</span><span class="op" id="5829424">,</span>&nbsp;<span class="num" id="5829426">0x14</span><span class="op" id="5829430">,</span>&nbsp;<span class="num" id="5829432">0x42</span><span class="op" id="5829436">,</span>&nbsp;<span class="num" id="5829438">0x91</span><span class="op" id="5829442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5829447">0xa1</span><span class="op" id="5829451">,</span>&nbsp;<span class="num" id="5829453">0xb1</span><span class="op" id="5829457">,</span>&nbsp;<span class="num" id="5829459">0xc1</span><span class="op" id="5829463">,</span>&nbsp;<span class="num" id="5829465">0x09</span><span class="op" id="5829469">,</span>&nbsp;<span class="num" id="5829471">0x23</span><span class="op" id="5829475">,</span>&nbsp;<span class="num" id="5829477">0x33</span><span class="op" id="5829481">,</span>&nbsp;<span class="num" id="5829483">0x52</span><span class="op" id="5829487">,</span>&nbsp;<span class="num" id="5829489">0xf0</span><span class="op" id="5829493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5829498">0x15</span><span class="op" id="5829502">,</span>&nbsp;<span class="num" id="5829504">0x62</span><span class="op" id="5829508">,</span>&nbsp;<span class="num" id="5829510">0x72</span><span class="op" id="5829514">,</span>&nbsp;<span class="num" id="5829516">0xd1</span><span class="op" id="5829520">,</span>&nbsp;<span class="num" id="5829522">0x0a</span><span class="op" id="5829526">,</span>&nbsp;<span class="num" id="5829528">0x16</span><span class="op" id="5829532">,</span>&nbsp;<span class="num" id="5829534">0x24</span><span class="op" id="5829538">,</span>&nbsp;<span class="num" id="5829540">0x34</span><span class="op" id="5829544">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5829549">0xe1</span><span class="op" id="5829553">,</span>&nbsp;<span class="num" id="5829555">0x25</span><span class="op" id="5829559">,</span>&nbsp;<span class="num" id="5829561">0xf1</span><span class="op" id="5829565">,</span>&nbsp;<span class="num" id="5829567">0x17</span><span class="op" id="5829571">,</span>&nbsp;<span class="num" id="5829573">0x18</span><span class="op" id="5829577">,</span>&nbsp;<span class="num" id="5829579">0x19</span><span class="op" id="5829583">,</span>&nbsp;<span class="num" id="5829585">0x1a</span><span class="op" id="5829589">,</span>&nbsp;<span class="num" id="5829591">0x26</span><span class="op" id="5829595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5829600">0x27</span><span class="op" id="5829604">,</span>&nbsp;<span class="num" id="5829606">0x28</span><span class="op" id="5829610">,</span>&nbsp;<span class="num" id="5829612">0x29</span><span class="op" id="5829616">,</span>&nbsp;<span class="num" id="5829618">0x2a</span><span class="op" id="5829622">,</span>&nbsp;<span class="num" id="5829624">0x35</span><span class="op" id="5829628">,</span>&nbsp;<span class="num" id="5829630">0x36</span><span class="op" id="5829634">,</span>&nbsp;<span class="num" id="5829636">0x37</span><span class="op" id="5829640">,</span>&nbsp;<span class="num" id="5829642">0x38</span><span class="op" id="5829646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5829651">0x39</span><span class="op" id="5829655">,</span>&nbsp;<span class="num" id="5829657">0x3a</span><span class="op" id="5829661">,</span>&nbsp;<span class="num" id="5829663">0x43</span><span class="op" id="5829667">,</span>&nbsp;<span class="num" id="5829669">0x44</span><span class="op" id="5829673">,</span>&nbsp;<span class="num" id="5829675">0x45</span><span class="op" id="5829679">,</span>&nbsp;<span class="num" id="5829681">0x46</span><span class="op" id="5829685">,</span>&nbsp;<span class="num" id="5829687">0x47</span><span class="op" id="5829691">,</span>&nbsp;<span class="num" id="5829693">0x48</span><span class="op" id="5829697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5829702">0x49</span><span class="op" id="5829706">,</span>&nbsp;<span class="num" id="5829708">0x4a</span><span class="op" id="5829712">,</span>&nbsp;<span class="num" id="5829714">0x53</span><span class="op" id="5829718">,</span>&nbsp;<span class="num" id="5829720">0x54</span><span class="op" id="5829724">,</span>&nbsp;<span class="num" id="5829726">0x55</span><span class="op" id="5829730">,</span>&nbsp;<span class="num" id="5829732">0x56</span><span class="op" id="5829736">,</span>&nbsp;<span class="num" id="5829738">0x57</span><span class="op" id="5829742">,</span>&nbsp;<span class="num" id="5829744">0x58</span><span class="op" id="5829748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5829753">0x59</span><span class="op" id="5829757">,</span>&nbsp;<span class="num" id="5829759">0x5a</span><span class="op" id="5829763">,</span>&nbsp;<span class="num" id="5829765">0x63</span><span class="op" id="5829769">,</span>&nbsp;<span class="num" id="5829771">0x64</span><span class="op" id="5829775">,</span>&nbsp;<span class="num" id="5829777">0x65</span><span class="op" id="5829781">,</span>&nbsp;<span class="num" id="5829783">0x66</span><span class="op" id="5829787">,</span>&nbsp;<span class="num" id="5829789">0x67</span><span class="op" id="5829793">,</span>&nbsp;<span class="num" id="5829795">0x68</span><span class="op" id="5829799">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5829804">0x69</span><span class="op" id="5829808">,</span>&nbsp;<span class="num" id="5829810">0x6a</span><span class="op" id="5829814">,</span>&nbsp;<span class="num" id="5829816">0x73</span><span class="op" id="5829820">,</span>&nbsp;<span class="num" id="5829822">0x74</span><span class="op" id="5829826">,</span>&nbsp;<span class="num" id="5829828">0x75</span><span class="op" id="5829832">,</span>&nbsp;<span class="num" id="5829834">0x76</span><span class="op" id="5829838">,</span>&nbsp;<span class="num" id="5829840">0x77</span><span class="op" id="5829844">,</span>&nbsp;<span class="num" id="5829846">0x78</span><span class="op" id="5829850">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5829855">0x79</span><span class="op" id="5829859">,</span>&nbsp;<span class="num" id="5829861">0x7a</span><span class="op" id="5829865">,</span>&nbsp;<span class="num" id="5829867">0x82</span><span class="op" id="5829871">,</span>&nbsp;<span class="num" id="5829873">0x83</span><span class="op" id="5829877">,</span>&nbsp;<span class="num" id="5829879">0x84</span><span class="op" id="5829883">,</span>&nbsp;<span class="num" id="5829885">0x85</span><span class="op" id="5829889">,</span>&nbsp;<span class="num" id="5829891">0x86</span><span class="op" id="5829895">,</span>&nbsp;<span class="num" id="5829897">0x87</span><span class="op" id="5829901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5829906">0x88</span><span class="op" id="5829910">,</span>&nbsp;<span class="num" id="5829912">0x89</span><span class="op" id="5829916">,</span>&nbsp;<span class="num" id="5829918">0x8a</span><span class="op" id="5829922">,</span>&nbsp;<span class="num" id="5829924">0x92</span><span class="op" id="5829928">,</span>&nbsp;<span class="num" id="5829930">0x93</span><span class="op" id="5829934">,</span>&nbsp;<span class="num" id="5829936">0x94</span><span class="op" id="5829940">,</span>&nbsp;<span class="num" id="5829942">0x95</span><span class="op" id="5829946">,</span>&nbsp;<span class="num" id="5829948">0x96</span><span class="op" id="5829952">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5829957">0x97</span><span class="op" id="5829961">,</span>&nbsp;<span class="num" id="5829963">0x98</span><span class="op" id="5829967">,</span>&nbsp;<span class="num" id="5829969">0x99</span><span class="op" id="5829973">,</span>&nbsp;<span class="num" id="5829975">0x9a</span><span class="op" id="5829979">,</span>&nbsp;<span class="num" id="5829981">0xa2</span><span class="op" id="5829985">,</span>&nbsp;<span class="num" id="5829987">0xa3</span><span class="op" id="5829991">,</span>&nbsp;<span class="num" id="5829993">0xa4</span><span class="op" id="5829997">,</span>&nbsp;<span class="num" id="5829999">0xa5</span><span class="op" id="5830003">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5830008">0xa6</span><span class="op" id="5830012">,</span>&nbsp;<span class="num" id="5830014">0xa7</span><span class="op" id="5830018">,</span>&nbsp;<span class="num" id="5830020">0xa8</span><span class="op" id="5830024">,</span>&nbsp;<span class="num" id="5830026">0xa9</span><span class="op" id="5830030">,</span>&nbsp;<span class="num" id="5830032">0xaa</span><span class="op" id="5830036">,</span>&nbsp;<span class="num" id="5830038">0xb2</span><span class="op" id="5830042">,</span>&nbsp;<span class="num" id="5830044">0xb3</span><span class="op" id="5830048">,</span>&nbsp;<span class="num" id="5830050">0xb4</span><span class="op" id="5830054">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5830059">0xb5</span><span class="op" id="5830063">,</span>&nbsp;<span class="num" id="5830065">0xb6</span><span class="op" id="5830069">,</span>&nbsp;<span class="num" id="5830071">0xb7</span><span class="op" id="5830075">,</span>&nbsp;<span class="num" id="5830077">0xb8</span><span class="op" id="5830081">,</span>&nbsp;<span class="num" id="5830083">0xb9</span><span class="op" id="5830087">,</span>&nbsp;<span class="num" id="5830089">0xba</span><span class="op" id="5830093">,</span>&nbsp;<span class="num" id="5830095">0xc2</span><span class="op" id="5830099">,</span>&nbsp;<span class="num" id="5830101">0xc3</span><span class="op" id="5830105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5830110">0xc4</span><span class="op" id="5830114">,</span>&nbsp;<span class="num" id="5830116">0xc5</span><span class="op" id="5830120">,</span>&nbsp;<span class="num" id="5830122">0xc6</span><span class="op" id="5830126">,</span>&nbsp;<span class="num" id="5830128">0xc7</span><span class="op" id="5830132">,</span>&nbsp;<span class="num" id="5830134">0xc8</span><span class="op" id="5830138">,</span>&nbsp;<span class="num" id="5830140">0xc9</span><span class="op" id="5830144">,</span>&nbsp;<span class="num" id="5830146">0xca</span><span class="op" id="5830150">,</span>&nbsp;<span class="num" id="5830152">0xd2</span><span class="op" id="5830156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5830161">0xd3</span><span class="op" id="5830165">,</span>&nbsp;<span class="num" id="5830167">0xd4</span><span class="op" id="5830171">,</span>&nbsp;<span class="num" id="5830173">0xd5</span><span class="op" id="5830177">,</span>&nbsp;<span class="num" id="5830179">0xd6</span><span class="op" id="5830183">,</span>&nbsp;<span class="num" id="5830185">0xd7</span><span class="op" id="5830189">,</span>&nbsp;<span class="num" id="5830191">0xd8</span><span class="op" id="5830195">,</span>&nbsp;<span class="num" id="5830197">0xd9</span><span class="op" id="5830201">,</span>&nbsp;<span class="num" id="5830203">0xda</span><span class="op" id="5830207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5830212">0xe2</span><span class="op" id="5830216">,</span>&nbsp;<span class="num" id="5830218">0xe3</span><span class="op" id="5830222">,</span>&nbsp;<span class="num" id="5830224">0xe4</span><span class="op" id="5830228">,</span>&nbsp;<span class="num" id="5830230">0xe5</span><span class="op" id="5830234">,</span>&nbsp;<span class="num" id="5830236">0xe6</span><span class="op" id="5830240">,</span>&nbsp;<span class="num" id="5830242">0xe7</span><span class="op" id="5830246">,</span>&nbsp;<span class="num" id="5830248">0xe8</span><span class="op" id="5830252">,</span>&nbsp;<span class="num" id="5830254">0xe9</span><span class="op" id="5830258">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5830263">0xea</span><span class="op" id="5830267">,</span>&nbsp;<span class="num" id="5830269">0xf2</span><span class="op" id="5830273">,</span>&nbsp;<span class="num" id="5830275">0xf3</span><span class="op" id="5830279">,</span>&nbsp;<span class="num" id="5830281">0xf4</span><span class="op" id="5830285">,</span>&nbsp;<span class="num" id="5830287">0xf5</span><span class="op" id="5830291">,</span>&nbsp;<span class="num" id="5830293">0xf6</span><span class="op" id="5830297">,</span>&nbsp;<span class="num" id="5830299">0xf7</span><span class="op" id="5830303">,</span>&nbsp;<span class="num" id="5830305">0xf8</span><span class="op" id="5830309">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5830314">0xf9</span><span class="op" id="5830318">,</span>&nbsp;<span class="num" id="5830320">0xfa</span><span class="op" id="5830324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5830328">}</span><span class="op" id="5830329">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5830332">}</span><span class="op" id="5830333">,</span><br>
<span class="lineno"></span><span class="op" id="5830335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5830338">//&nbsp;huffmanLUT&nbsp;is&nbsp;a&nbsp;compiled&nbsp;look-up&nbsp;table&nbsp;representation&nbsp;of&nbsp;a&nbsp;huffmanSpec.</span><br>
<span class="lineno"></span><span class="comment" id="5830413">//&nbsp;Each&nbsp;value&nbsp;maps&nbsp;to&nbsp;a&nbsp;uint32&nbsp;of&nbsp;which&nbsp;the&nbsp;8&nbsp;most&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5830490">//&nbsp;codeword&nbsp;size&nbsp;in&nbsp;bits&nbsp;and&nbsp;the&nbsp;24&nbsp;least&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the&nbsp;codeword.</span><br>
<span class="lineno"></span><span class="comment" id="5830568">//&nbsp;The&nbsp;maximum&nbsp;codeword&nbsp;size&nbsp;is&nbsp;16&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="5830609">type</span>&nbsp;<span class="ident" id="5830614">huffmanLUT</span>&nbsp;<span class="op" id="5830625">[</span><span class="op" id="5830626">]</span><span class="builtintype" id="5830627">uint32</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="5830635">func</span>&nbsp;<span class="op" id="5830640">(</span><span class="ident" id="5830641">h</span>&nbsp;<span class="op" id="5830643">*</span><span class="ident" id="5830644">huffmanLUT</span><span class="op" id="5830654">)</span>&nbsp;<span class="ident" id="5830656">init</span><span class="op" id="5830660">(</span><span class="ident" id="5830661">s</span>&nbsp;<span class="ident" id="5830663">huffmanSpec</span><span class="op" id="5830674">)</span>&nbsp;<span class="op" id="5830676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5830679">maxValue</span>&nbsp;<span class="op" id="5830688">:=</span>&nbsp;<span class="num" id="5830691">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5830694">for</span>&nbsp;<span class="ident" id="5830698">_</span><span class="op" id="5830699">,</span>&nbsp;<span class="ident" id="5830701">v</span>&nbsp;<span class="op" id="5830703">:=</span>&nbsp;<span class="keyword" id="5830706">range</span>&nbsp;<span class="ident" id="5830712">s</span><span class="op" id="5830713">.</span><span class="ident" id="5830714">value</span>&nbsp;<span class="op" id="5830720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5830724">if</span>&nbsp;<span class="builtintype" id="5830727">int</span><span class="op" id="5830730">(</span><span class="ident" id="5830731">v</span><span class="op" id="5830732">)</span>&nbsp;<span class="op" id="5830734">&gt;</span>&nbsp;<span class="ident" id="5830736">maxValue</span>&nbsp;<span class="op" id="5830745">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5830750">maxValue</span>&nbsp;<span class="op" id="5830759">=</span>&nbsp;<span class="builtintype" id="5830761">int</span><span class="op" id="5830764">(</span><span class="ident" id="5830765">v</span><span class="op" id="5830766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5830770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5830773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5830776">*</span><span class="ident" id="5830777">h</span>&nbsp;<span class="op" id="5830779">=</span>&nbsp;<span class="builtinfunc" id="5830781">make</span><span class="op" id="5830785">(</span><span class="op" id="5830786">[</span><span class="op" id="5830787">]</span><span class="builtintype" id="5830788">uint32</span><span class="op" id="5830794">,</span>&nbsp;<span class="ident" id="5830796">maxValue</span><span class="op" id="5830804">+</span><span class="num" id="5830805">1</span><span class="op" id="5830806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5830809">code</span><span class="op" id="5830813">,</span>&nbsp;<span class="ident" id="5830815">k</span>&nbsp;<span class="op" id="5830817">:=</span>&nbsp;<span class="builtintype" id="5830820">uint32</span><span class="op" id="5830826">(</span><span class="num" id="5830827">0</span><span class="op" id="5830828">)</span><span class="op" id="5830829">,</span>&nbsp;<span class="num" id="5830831">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5830834">for</span>&nbsp;<span class="ident" id="5830838">i</span>&nbsp;<span class="op" id="5830840">:=</span>&nbsp;<span class="num" id="5830843">0</span><span class="op" id="5830844">;</span>&nbsp;<span class="ident" id="5830846">i</span>&nbsp;<span class="op" id="5830848">&lt;</span>&nbsp;<span class="builtinfunc" id="5830850">len</span><span class="op" id="5830853">(</span><span class="ident" id="5830854">s</span><span class="op" id="5830855">.</span><span class="ident" id="5830856">count</span><span class="op" id="5830861">)</span><span class="op" id="5830862">;</span>&nbsp;<span class="ident" id="5830864">i</span><span class="op" id="5830865">++</span>&nbsp;<span class="op" id="5830868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5830872">nBits</span>&nbsp;<span class="op" id="5830878">:=</span>&nbsp;<span class="builtintype" id="5830881">uint32</span><span class="op" id="5830887">(</span><span class="ident" id="5830888">i</span><span class="op" id="5830889">+</span><span class="num" id="5830890">1</span><span class="op" id="5830891">)</span>&nbsp;<span class="op" id="5830893">&lt;&lt;</span>&nbsp;<span class="num" id="5830896">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5830901">for</span>&nbsp;<span class="ident" id="5830905">j</span>&nbsp;<span class="op" id="5830907">:=</span>&nbsp;<span class="builtintype" id="5830910">uint8</span><span class="op" id="5830915">(</span><span class="num" id="5830916">0</span><span class="op" id="5830917">)</span><span class="op" id="5830918">;</span>&nbsp;<span class="ident" id="5830920">j</span>&nbsp;<span class="op" id="5830922">&lt;</span>&nbsp;<span class="ident" id="5830924">s</span><span class="op" id="5830925">.</span><span class="ident" id="5830926">count</span><span class="op" id="5830931">[</span><span class="ident" id="5830932">i</span><span class="op" id="5830933">]</span><span class="op" id="5830934">;</span>&nbsp;<span class="ident" id="5830936">j</span><span class="op" id="5830937">++</span>&nbsp;<span class="op" id="5830940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5830945">(</span><span class="op" id="5830946">*</span><span class="ident" id="5830947">h</span><span class="op" id="5830948">)</span><span class="op" id="5830949">[</span><span class="ident" id="5830950">s</span><span class="op" id="5830951">.</span><span class="ident" id="5830952">value</span><span class="op" id="5830957">[</span><span class="ident" id="5830958">k</span><span class="op" id="5830959">]</span><span class="op" id="5830960">]</span>&nbsp;<span class="op" id="5830962">=</span>&nbsp;<span class="ident" id="5830964">nBits</span>&nbsp;<span class="op" id="5830970">|</span>&nbsp;<span class="ident" id="5830972">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5830980">code</span><span class="op" id="5830984">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5830990">k</span><span class="op" id="5830991">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5830996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5831000">code</span>&nbsp;<span class="op" id="5831005">&lt;&lt;=</span>&nbsp;<span class="num" id="5831009">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5831012">}</span><br>
<span class="lineno"></span><span class="op" id="5831014">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5831017">//&nbsp;theHuffmanLUT&nbsp;are&nbsp;compiled&nbsp;representations&nbsp;of&nbsp;theHuffmanSpec.</span><br>
<span class="lineno"></span><span class="keyword" id="5831082">var</span>&nbsp;<span class="ident" id="5831086">theHuffmanLUT</span>&nbsp;<span class="op" id="5831100">[</span><span class="num" id="5831101">4</span><span class="op" id="5831102">]</span><span class="ident" id="5831103">huffmanLUT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5831115">func</span>&nbsp;<span class="ident" id="5831120">init</span><span class="op" id="5831124">(</span><span class="op" id="5831125">)</span>&nbsp;<span class="op" id="5831127">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5831130">for</span>&nbsp;<span class="ident" id="5831134">i</span><span class="op" id="5831135">,</span>&nbsp;<span class="ident" id="5831137">s</span>&nbsp;<span class="op" id="5831139">:=</span>&nbsp;<span class="keyword" id="5831142">range</span>&nbsp;<span class="ident" id="5831148">theHuffmanSpec</span>&nbsp;<span class="op" id="5831163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5831167">theHuffmanLUT</span><span class="op" id="5831180">[</span><span class="ident" id="5831181">i</span><span class="op" id="5831182">]</span><span class="op" id="5831183">.</span><span class="ident" id="5831184">init</span><span class="op" id="5831188">(</span><span class="ident" id="5831189">s</span><span class="op" id="5831190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5831193">}</span><br>
<span class="lineno"></span><span class="op" id="5831195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="5831198">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5831230">type</span>&nbsp;<span class="ident" id="5831235">writer</span>&nbsp;<span class="keyword" id="5831242">interface</span>&nbsp;<span class="op" id="5831252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5831255">Flush</span><span class="op" id="5831260">(</span><span class="op" id="5831261">)</span>&nbsp;<span class="builtintype" id="5831263">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5831270">io</span><span class="op" id="5831272">.</span><span class="ident" id="5831273">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5831281">io</span><span class="op" id="5831283">.</span><span class="ident" id="5831284">ByteWriter</span><br>
<span class="lineno">215</span><span class="op" id="5831295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5831298">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;JPEG&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="5831346">type</span>&nbsp;<span class="ident" id="5831351">encoder</span>&nbsp;<span class="keyword" id="5831359">struct</span>&nbsp;<span class="op" id="5831366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5831369">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5831444">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5831515">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5831519">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5831527">err</span>&nbsp;<span class="builtintype" id="5831531">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5831538">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5831567">buf</span>&nbsp;<span class="op" id="5831571">[</span><span class="num" id="5831572">16</span><span class="op" id="5831574">]</span><span class="builtintype" id="5831575">byte</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5831581">//&nbsp;bits&nbsp;and&nbsp;nBits&nbsp;are&nbsp;accumulated&nbsp;bits&nbsp;to&nbsp;write&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5831636">bits</span><span class="op" id="5831640">,</span>&nbsp;<span class="ident" id="5831642">nBits</span>&nbsp;<span class="builtintype" id="5831648">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5831656">//&nbsp;quant&nbsp;is&nbsp;the&nbsp;scaled&nbsp;quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5831719">quant</span>&nbsp;<span class="op" id="5831725">[</span><span class="ident" id="5831726">nQuantIndex</span><span class="op" id="5831737">]</span><span class="op" id="5831738">[</span><span class="ident" id="5831739">blockSize</span><span class="op" id="5831748">]</span><span class="builtintype" id="5831749">byte</span><br>
<span class="lineno"></span><span class="op" id="5831754">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="5831757">func</span>&nbsp;<span class="op" id="5831762">(</span><span class="ident" id="5831763">e</span>&nbsp;<span class="op" id="5831765">*</span><span class="ident" id="5831766">encoder</span><span class="op" id="5831773">)</span>&nbsp;<span class="ident" id="5831775">flush</span><span class="op" id="5831780">(</span><span class="op" id="5831781">)</span>&nbsp;<span class="op" id="5831783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5831786">if</span>&nbsp;<span class="ident" id="5831789">e</span><span class="op" id="5831790">.</span><span class="ident" id="5831791">err</span>&nbsp;<span class="op" id="5831795">!=</span>&nbsp;<span class="ident" id="5831798">nil</span>&nbsp;<span class="op" id="5831802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5831806">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5831814">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5831817">e</span><span class="op" id="5831818">.</span><span class="ident" id="5831819">err</span>&nbsp;<span class="op" id="5831823">=</span>&nbsp;<span class="ident" id="5831825">e</span><span class="op" id="5831826">.</span><span class="ident" id="5831827">w</span><span class="op" id="5831828">.</span><span class="ident" id="5831829">Flush</span><span class="op" id="5831834">(</span><span class="op" id="5831835">)</span><br>
<span class="lineno"></span><span class="op" id="5831837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5831840">func</span>&nbsp;<span class="op" id="5831845">(</span><span class="ident" id="5831846">e</span>&nbsp;<span class="op" id="5831848">*</span><span class="ident" id="5831849">encoder</span><span class="op" id="5831856">)</span>&nbsp;<span class="ident" id="5831858">write</span><span class="op" id="5831863">(</span><span class="ident" id="5831864">p</span>&nbsp;<span class="op" id="5831866">[</span><span class="op" id="5831867">]</span><span class="builtintype" id="5831868">byte</span><span class="op" id="5831872">)</span>&nbsp;<span class="op" id="5831874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5831877">if</span>&nbsp;<span class="ident" id="5831880">e</span><span class="op" id="5831881">.</span><span class="ident" id="5831882">err</span>&nbsp;<span class="op" id="5831886">!=</span>&nbsp;<span class="ident" id="5831889">nil</span>&nbsp;<span class="op" id="5831893">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5831897">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5831905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5831908">_</span><span class="op" id="5831909">,</span>&nbsp;<span class="ident" id="5831911">e</span><span class="op" id="5831912">.</span><span class="ident" id="5831913">err</span>&nbsp;<span class="op" id="5831917">=</span>&nbsp;<span class="ident" id="5831919">e</span><span class="op" id="5831920">.</span><span class="ident" id="5831921">w</span><span class="op" id="5831922">.</span><span class="ident" id="5831923">Write</span><span class="op" id="5831928">(</span><span class="ident" id="5831929">p</span><span class="op" id="5831930">)</span><br>
<span class="lineno"></span><span class="op" id="5831932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="5831935">func</span>&nbsp;<span class="op" id="5831940">(</span><span class="ident" id="5831941">e</span>&nbsp;<span class="op" id="5831943">*</span><span class="ident" id="5831944">encoder</span><span class="op" id="5831951">)</span>&nbsp;<span class="ident" id="5831953">writeByte</span><span class="op" id="5831962">(</span><span class="ident" id="5831963">b</span>&nbsp;<span class="builtintype" id="5831965">byte</span><span class="op" id="5831969">)</span>&nbsp;<span class="op" id="5831971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5831974">if</span>&nbsp;<span class="ident" id="5831977">e</span><span class="op" id="5831978">.</span><span class="ident" id="5831979">err</span>&nbsp;<span class="op" id="5831983">!=</span>&nbsp;<span class="ident" id="5831986">nil</span>&nbsp;<span class="op" id="5831990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5831994">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5832002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832005">e</span><span class="op" id="5832006">.</span><span class="ident" id="5832007">err</span>&nbsp;<span class="op" id="5832011">=</span>&nbsp;<span class="ident" id="5832013">e</span><span class="op" id="5832014">.</span><span class="ident" id="5832015">w</span><span class="op" id="5832016">.</span><span class="ident" id="5832017">WriteByte</span><span class="op" id="5832026">(</span><span class="ident" id="5832027">b</span><span class="op" id="5832028">)</span><br>
<span class="lineno">250</span><span class="op" id="5832030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5832033">//&nbsp;emit&nbsp;emits&nbsp;the&nbsp;least&nbsp;significant&nbsp;nBits&nbsp;bits&nbsp;of&nbsp;bits&nbsp;to&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno"></span><span class="comment" id="5832107">//&nbsp;The&nbsp;precondition&nbsp;is&nbsp;bits&nbsp;&lt;&nbsp;1&lt;&lt;nBits&nbsp;&amp;&amp;&nbsp;nBits&nbsp;&lt;=&nbsp;16.</span><br>
<span class="lineno"></span><span class="keyword" id="5832162">func</span>&nbsp;<span class="op" id="5832167">(</span><span class="ident" id="5832168">e</span>&nbsp;<span class="op" id="5832170">*</span><span class="ident" id="5832171">encoder</span><span class="op" id="5832178">)</span>&nbsp;<span class="ident" id="5832180">emit</span><span class="op" id="5832184">(</span><span class="ident" id="5832185">bits</span><span class="op" id="5832189">,</span>&nbsp;<span class="ident" id="5832191">nBits</span>&nbsp;<span class="builtintype" id="5832197">uint32</span><span class="op" id="5832203">)</span>&nbsp;<span class="op" id="5832205">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832208">nBits</span>&nbsp;<span class="op" id="5832214">+=</span>&nbsp;<span class="ident" id="5832217">e</span><span class="op" id="5832218">.</span><span class="ident" id="5832219">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832226">bits</span>&nbsp;<span class="op" id="5832231">&lt;&lt;=</span>&nbsp;<span class="num" id="5832235">32</span>&nbsp;<span class="op" id="5832238">-</span>&nbsp;<span class="ident" id="5832240">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832247">bits</span>&nbsp;<span class="op" id="5832252">|=</span>&nbsp;<span class="ident" id="5832255">e</span><span class="op" id="5832256">.</span><span class="ident" id="5832257">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5832263">for</span>&nbsp;<span class="ident" id="5832267">nBits</span>&nbsp;<span class="op" id="5832273">&gt;=</span>&nbsp;<span class="num" id="5832276">8</span>&nbsp;<span class="op" id="5832278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832282">b</span>&nbsp;<span class="op" id="5832284">:=</span>&nbsp;<span class="builtintype" id="5832287">uint8</span><span class="op" id="5832292">(</span><span class="ident" id="5832293">bits</span>&nbsp;<span class="op" id="5832298">&gt;&gt;</span>&nbsp;<span class="num" id="5832301">24</span><span class="op" id="5832303">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832307">e</span><span class="op" id="5832308">.</span><span class="ident" id="5832309">writeByte</span><span class="op" id="5832318">(</span><span class="ident" id="5832319">b</span><span class="op" id="5832320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5832324">if</span>&nbsp;<span class="ident" id="5832327">b</span>&nbsp;<span class="op" id="5832329">==</span>&nbsp;<span class="num" id="5832332">0xff</span>&nbsp;<span class="op" id="5832337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832342">e</span><span class="op" id="5832343">.</span><span class="ident" id="5832344">writeByte</span><span class="op" id="5832353">(</span><span class="num" id="5832354">0x00</span><span class="op" id="5832358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5832362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832366">bits</span>&nbsp;<span class="op" id="5832371">&lt;&lt;=</span>&nbsp;<span class="num" id="5832375">8</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832379">nBits</span>&nbsp;<span class="op" id="5832385">-=</span>&nbsp;<span class="num" id="5832388">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5832391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832394">e</span><span class="op" id="5832395">.</span><span class="ident" id="5832396">bits</span><span class="op" id="5832400">,</span>&nbsp;<span class="ident" id="5832402">e</span><span class="op" id="5832403">.</span><span class="ident" id="5832404">nBits</span>&nbsp;<span class="op" id="5832410">=</span>&nbsp;<span class="ident" id="5832412">bits</span><span class="op" id="5832416">,</span>&nbsp;<span class="ident" id="5832418">nBits</span><br>
<span class="lineno"></span><span class="op" id="5832424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5832427">//&nbsp;emitHuff&nbsp;emits&nbsp;the&nbsp;given&nbsp;value&nbsp;with&nbsp;the&nbsp;given&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5832493">func</span>&nbsp;<span class="op" id="5832498">(</span><span class="ident" id="5832499">e</span>&nbsp;<span class="op" id="5832501">*</span><span class="ident" id="5832502">encoder</span><span class="op" id="5832509">)</span>&nbsp;<span class="ident" id="5832511">emitHuff</span><span class="op" id="5832519">(</span><span class="ident" id="5832520">h</span>&nbsp;<span class="ident" id="5832522">huffIndex</span><span class="op" id="5832531">,</span>&nbsp;<span class="ident" id="5832533">value</span>&nbsp;<span class="builtintype" id="5832539">int32</span><span class="op" id="5832544">)</span>&nbsp;<span class="op" id="5832546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832549">x</span>&nbsp;<span class="op" id="5832551">:=</span>&nbsp;<span class="ident" id="5832554">theHuffmanLUT</span><span class="op" id="5832567">[</span><span class="ident" id="5832568">h</span><span class="op" id="5832569">]</span><span class="op" id="5832570">[</span><span class="ident" id="5832571">value</span><span class="op" id="5832576">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832579">e</span><span class="op" id="5832580">.</span><span class="ident" id="5832581">emit</span><span class="op" id="5832585">(</span><span class="ident" id="5832586">x</span><span class="op" id="5832587">&amp;</span><span class="op" id="5832588">(</span><span class="num" id="5832589">1</span><span class="op" id="5832590">&lt;&lt;</span><span class="num" id="5832592">24</span><span class="op" id="5832594">-</span><span class="num" id="5832595">1</span><span class="op" id="5832596">)</span><span class="op" id="5832597">,</span>&nbsp;<span class="ident" id="5832599">x</span><span class="op" id="5832600">&gt;&gt;</span><span class="num" id="5832602">24</span><span class="op" id="5832604">)</span><br>
<span class="lineno"></span><span class="op" id="5832606">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="5832609">//&nbsp;emitHuffRLE&nbsp;emits&nbsp;a&nbsp;run&nbsp;of&nbsp;runLength&nbsp;copies&nbsp;of&nbsp;value&nbsp;encoded&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="5832688">//&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5832708">func</span>&nbsp;<span class="op" id="5832713">(</span><span class="ident" id="5832714">e</span>&nbsp;<span class="op" id="5832716">*</span><span class="ident" id="5832717">encoder</span><span class="op" id="5832724">)</span>&nbsp;<span class="ident" id="5832726">emitHuffRLE</span><span class="op" id="5832737">(</span><span class="ident" id="5832738">h</span>&nbsp;<span class="ident" id="5832740">huffIndex</span><span class="op" id="5832749">,</span>&nbsp;<span class="ident" id="5832751">runLength</span><span class="op" id="5832760">,</span>&nbsp;<span class="ident" id="5832762">value</span>&nbsp;<span class="builtintype" id="5832768">int32</span><span class="op" id="5832773">)</span>&nbsp;<span class="op" id="5832775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832778">a</span><span class="op" id="5832779">,</span>&nbsp;<span class="ident" id="5832781">b</span>&nbsp;<span class="op" id="5832783">:=</span>&nbsp;<span class="ident" id="5832786">value</span><span class="op" id="5832791">,</span>&nbsp;<span class="ident" id="5832793">value</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5832800">if</span>&nbsp;<span class="ident" id="5832803">a</span>&nbsp;<span class="op" id="5832805">&lt;</span>&nbsp;<span class="num" id="5832807">0</span>&nbsp;<span class="op" id="5832809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832813">a</span><span class="op" id="5832814">,</span>&nbsp;<span class="ident" id="5832816">b</span>&nbsp;<span class="op" id="5832818">=</span>&nbsp;<span class="op" id="5832820">-</span><span class="ident" id="5832821">value</span><span class="op" id="5832826">,</span>&nbsp;<span class="ident" id="5832828">value</span><span class="op" id="5832833">-</span><span class="num" id="5832834">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5832837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5832840">var</span>&nbsp;<span class="ident" id="5832844">nBits</span>&nbsp;<span class="builtintype" id="5832850">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5832858">if</span>&nbsp;<span class="ident" id="5832861">a</span>&nbsp;<span class="op" id="5832863">&lt;</span>&nbsp;<span class="num" id="5832865">0x100</span>&nbsp;<span class="op" id="5832871">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832875">nBits</span>&nbsp;<span class="op" id="5832881">=</span>&nbsp;<span class="builtintype" id="5832883">uint32</span><span class="op" id="5832889">(</span><span class="ident" id="5832890">bitCount</span><span class="op" id="5832898">[</span><span class="ident" id="5832899">a</span><span class="op" id="5832900">]</span><span class="op" id="5832901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5832904">}</span>&nbsp;<span class="keyword" id="5832906">else</span>&nbsp;<span class="op" id="5832911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832915">nBits</span>&nbsp;<span class="op" id="5832921">=</span>&nbsp;<span class="num" id="5832923">8</span>&nbsp;<span class="op" id="5832925">+</span>&nbsp;<span class="builtintype" id="5832927">uint32</span><span class="op" id="5832933">(</span><span class="ident" id="5832934">bitCount</span><span class="op" id="5832942">[</span><span class="ident" id="5832943">a</span><span class="op" id="5832944">&gt;&gt;</span><span class="num" id="5832946">8</span><span class="op" id="5832947">]</span><span class="op" id="5832948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5832951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5832954">e</span><span class="op" id="5832955">.</span><span class="ident" id="5832956">emitHuff</span><span class="op" id="5832964">(</span><span class="ident" id="5832965">h</span><span class="op" id="5832966">,</span>&nbsp;<span class="ident" id="5832968">runLength</span><span class="op" id="5832977">&lt;&lt;</span><span class="num" id="5832979">4</span><span class="op" id="5832980">|</span><span class="builtintype" id="5832981">int32</span><span class="op" id="5832986">(</span><span class="ident" id="5832987">nBits</span><span class="op" id="5832992">)</span><span class="op" id="5832993">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5832996">if</span>&nbsp;<span class="ident" id="5832999">nBits</span>&nbsp;<span class="op" id="5833005">&gt;</span>&nbsp;<span class="num" id="5833007">0</span>&nbsp;<span class="op" id="5833009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833013">e</span><span class="op" id="5833014">.</span><span class="ident" id="5833015">emit</span><span class="op" id="5833019">(</span><span class="builtintype" id="5833020">uint32</span><span class="op" id="5833026">(</span><span class="ident" id="5833027">b</span><span class="op" id="5833028">)</span><span class="op" id="5833029">&amp;</span><span class="op" id="5833030">(</span><span class="num" id="5833031">1</span><span class="op" id="5833032">&lt;&lt;</span><span class="ident" id="5833034">nBits</span><span class="op" id="5833039">-</span><span class="num" id="5833040">1</span><span class="op" id="5833041">)</span><span class="op" id="5833042">,</span>&nbsp;<span class="ident" id="5833044">nBits</span><span class="op" id="5833049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5833052">}</span><br>
<span class="lineno"></span><span class="op" id="5833054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="5833057">//&nbsp;writeMarkerHeader&nbsp;writes&nbsp;the&nbsp;header&nbsp;for&nbsp;a&nbsp;marker&nbsp;with&nbsp;the&nbsp;given&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5833132">func</span>&nbsp;<span class="op" id="5833137">(</span><span class="ident" id="5833138">e</span>&nbsp;<span class="op" id="5833140">*</span><span class="ident" id="5833141">encoder</span><span class="op" id="5833148">)</span>&nbsp;<span class="ident" id="5833150">writeMarkerHeader</span><span class="op" id="5833167">(</span><span class="ident" id="5833168">marker</span>&nbsp;<span class="builtintype" id="5833175">uint8</span><span class="op" id="5833180">,</span>&nbsp;<span class="ident" id="5833182">markerlen</span>&nbsp;<span class="builtintype" id="5833192">int</span><span class="op" id="5833195">)</span>&nbsp;<span class="op" id="5833197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833200">e</span><span class="op" id="5833201">.</span><span class="ident" id="5833202">buf</span><span class="op" id="5833205">[</span><span class="num" id="5833206">0</span><span class="op" id="5833207">]</span>&nbsp;<span class="op" id="5833209">=</span>&nbsp;<span class="num" id="5833211">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833217">e</span><span class="op" id="5833218">.</span><span class="ident" id="5833219">buf</span><span class="op" id="5833222">[</span><span class="num" id="5833223">1</span><span class="op" id="5833224">]</span>&nbsp;<span class="op" id="5833226">=</span>&nbsp;<span class="ident" id="5833228">marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833236">e</span><span class="op" id="5833237">.</span><span class="ident" id="5833238">buf</span><span class="op" id="5833241">[</span><span class="num" id="5833242">2</span><span class="op" id="5833243">]</span>&nbsp;<span class="op" id="5833245">=</span>&nbsp;<span class="builtintype" id="5833247">uint8</span><span class="op" id="5833252">(</span><span class="ident" id="5833253">markerlen</span>&nbsp;<span class="op" id="5833263">&gt;&gt;</span>&nbsp;<span class="num" id="5833266">8</span><span class="op" id="5833267">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833270">e</span><span class="op" id="5833271">.</span><span class="ident" id="5833272">buf</span><span class="op" id="5833275">[</span><span class="num" id="5833276">3</span><span class="op" id="5833277">]</span>&nbsp;<span class="op" id="5833279">=</span>&nbsp;<span class="builtintype" id="5833281">uint8</span><span class="op" id="5833286">(</span><span class="ident" id="5833287">markerlen</span>&nbsp;<span class="op" id="5833297">&amp;</span>&nbsp;<span class="num" id="5833299">0xff</span><span class="op" id="5833303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833306">e</span><span class="op" id="5833307">.</span><span class="ident" id="5833308">write</span><span class="op" id="5833313">(</span><span class="ident" id="5833314">e</span><span class="op" id="5833315">.</span><span class="ident" id="5833316">buf</span><span class="op" id="5833319">[</span><span class="op" id="5833320">:</span><span class="num" id="5833321">4</span><span class="op" id="5833322">]</span><span class="op" id="5833323">)</span><br>
<span class="lineno"></span><span class="op" id="5833325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5833328">//&nbsp;writeDQT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Quantization&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno">305</span><span class="keyword" id="5833385">func</span>&nbsp;<span class="op" id="5833390">(</span><span class="ident" id="5833391">e</span>&nbsp;<span class="op" id="5833393">*</span><span class="ident" id="5833394">encoder</span><span class="op" id="5833401">)</span>&nbsp;<span class="ident" id="5833403">writeDQT</span><span class="op" id="5833411">(</span><span class="op" id="5833412">)</span>&nbsp;<span class="op" id="5833414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5833417">const</span>&nbsp;<span class="ident" id="5833423">markerlen</span>&nbsp;<span class="op" id="5833433">=</span>&nbsp;<span class="num" id="5833435">2</span>&nbsp;<span class="op" id="5833437">+</span>&nbsp;<span class="builtintype" id="5833439">int</span><span class="op" id="5833442">(</span><span class="ident" id="5833443">nQuantIndex</span><span class="op" id="5833454">)</span><span class="op" id="5833455">*</span><span class="op" id="5833456">(</span><span class="num" id="5833457">1</span><span class="op" id="5833458">+</span><span class="ident" id="5833459">blockSize</span><span class="op" id="5833468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833471">e</span><span class="op" id="5833472">.</span><span class="ident" id="5833473">writeMarkerHeader</span><span class="op" id="5833490">(</span><span class="ident" id="5833491">dqtMarker</span><span class="op" id="5833500">,</span>&nbsp;<span class="ident" id="5833502">markerlen</span><span class="op" id="5833511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5833514">for</span>&nbsp;<span class="ident" id="5833518">i</span>&nbsp;<span class="op" id="5833520">:=</span>&nbsp;<span class="keyword" id="5833523">range</span>&nbsp;<span class="ident" id="5833529">e</span><span class="op" id="5833530">.</span><span class="ident" id="5833531">quant</span>&nbsp;<span class="op" id="5833537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833541">e</span><span class="op" id="5833542">.</span><span class="ident" id="5833543">writeByte</span><span class="op" id="5833552">(</span><span class="builtintype" id="5833553">uint8</span><span class="op" id="5833558">(</span><span class="ident" id="5833559">i</span><span class="op" id="5833560">)</span><span class="op" id="5833561">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833565">e</span><span class="op" id="5833566">.</span><span class="ident" id="5833567">write</span><span class="op" id="5833572">(</span><span class="ident" id="5833573">e</span><span class="op" id="5833574">.</span><span class="ident" id="5833575">quant</span><span class="op" id="5833580">[</span><span class="ident" id="5833581">i</span><span class="op" id="5833582">]</span><span class="op" id="5833583">[</span><span class="op" id="5833584">:</span><span class="op" id="5833585">]</span><span class="op" id="5833586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5833589">}</span><br>
<span class="lineno"></span><span class="op" id="5833591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5833594">//&nbsp;writeSOF0&nbsp;writes&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline)&nbsp;marker.</span><br>
<span class="lineno">315</span><span class="keyword" id="5833652">func</span>&nbsp;<span class="op" id="5833657">(</span><span class="ident" id="5833658">e</span>&nbsp;<span class="op" id="5833660">*</span><span class="ident" id="5833661">encoder</span><span class="op" id="5833668">)</span>&nbsp;<span class="ident" id="5833670">writeSOF0</span><span class="op" id="5833679">(</span><span class="ident" id="5833680">size</span>&nbsp;<span class="ident" id="5833685">image</span><span class="op" id="5833690">.</span><span class="ident" id="5833691">Point</span><span class="op" id="5833696">,</span>&nbsp;<span class="ident" id="5833698">nComponent</span>&nbsp;<span class="builtintype" id="5833709">int</span><span class="op" id="5833712">)</span>&nbsp;<span class="op" id="5833714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833717">markerlen</span>&nbsp;<span class="op" id="5833727">:=</span>&nbsp;<span class="num" id="5833730">8</span>&nbsp;<span class="op" id="5833732">+</span>&nbsp;<span class="num" id="5833734">3</span><span class="op" id="5833735">*</span><span class="ident" id="5833736">nComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833748">e</span><span class="op" id="5833749">.</span><span class="ident" id="5833750">writeMarkerHeader</span><span class="op" id="5833767">(</span><span class="ident" id="5833768">sof0Marker</span><span class="op" id="5833778">,</span>&nbsp;<span class="ident" id="5833780">markerlen</span><span class="op" id="5833789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833792">e</span><span class="op" id="5833793">.</span><span class="ident" id="5833794">buf</span><span class="op" id="5833797">[</span><span class="num" id="5833798">0</span><span class="op" id="5833799">]</span>&nbsp;<span class="op" id="5833801">=</span>&nbsp;<span class="num" id="5833803">8</span>&nbsp;<span class="comment" id="5833805">//&nbsp;8-bit&nbsp;color.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833822">e</span><span class="op" id="5833823">.</span><span class="ident" id="5833824">buf</span><span class="op" id="5833827">[</span><span class="num" id="5833828">1</span><span class="op" id="5833829">]</span>&nbsp;<span class="op" id="5833831">=</span>&nbsp;<span class="builtintype" id="5833833">uint8</span><span class="op" id="5833838">(</span><span class="ident" id="5833839">size</span><span class="op" id="5833843">.</span><span class="ident" id="5833844">Y</span>&nbsp;<span class="op" id="5833846">&gt;&gt;</span>&nbsp;<span class="num" id="5833849">8</span><span class="op" id="5833850">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833853">e</span><span class="op" id="5833854">.</span><span class="ident" id="5833855">buf</span><span class="op" id="5833858">[</span><span class="num" id="5833859">2</span><span class="op" id="5833860">]</span>&nbsp;<span class="op" id="5833862">=</span>&nbsp;<span class="builtintype" id="5833864">uint8</span><span class="op" id="5833869">(</span><span class="ident" id="5833870">size</span><span class="op" id="5833874">.</span><span class="ident" id="5833875">Y</span>&nbsp;<span class="op" id="5833877">&amp;</span>&nbsp;<span class="num" id="5833879">0xff</span><span class="op" id="5833883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833886">e</span><span class="op" id="5833887">.</span><span class="ident" id="5833888">buf</span><span class="op" id="5833891">[</span><span class="num" id="5833892">3</span><span class="op" id="5833893">]</span>&nbsp;<span class="op" id="5833895">=</span>&nbsp;<span class="builtintype" id="5833897">uint8</span><span class="op" id="5833902">(</span><span class="ident" id="5833903">size</span><span class="op" id="5833907">.</span><span class="ident" id="5833908">X</span>&nbsp;<span class="op" id="5833910">&gt;&gt;</span>&nbsp;<span class="num" id="5833913">8</span><span class="op" id="5833914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833917">e</span><span class="op" id="5833918">.</span><span class="ident" id="5833919">buf</span><span class="op" id="5833922">[</span><span class="num" id="5833923">4</span><span class="op" id="5833924">]</span>&nbsp;<span class="op" id="5833926">=</span>&nbsp;<span class="builtintype" id="5833928">uint8</span><span class="op" id="5833933">(</span><span class="ident" id="5833934">size</span><span class="op" id="5833938">.</span><span class="ident" id="5833939">X</span>&nbsp;<span class="op" id="5833941">&amp;</span>&nbsp;<span class="num" id="5833943">0xff</span><span class="op" id="5833947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5833950">e</span><span class="op" id="5833951">.</span><span class="ident" id="5833952">buf</span><span class="op" id="5833955">[</span><span class="num" id="5833956">5</span><span class="op" id="5833957">]</span>&nbsp;<span class="op" id="5833959">=</span>&nbsp;<span class="builtintype" id="5833961">uint8</span><span class="op" id="5833966">(</span><span class="ident" id="5833967">nComponent</span><span class="op" id="5833977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5833980">if</span>&nbsp;<span class="ident" id="5833983">nComponent</span>&nbsp;<span class="op" id="5833994">==</span>&nbsp;<span class="num" id="5833997">1</span>&nbsp;<span class="op" id="5833999">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834003">e</span><span class="op" id="5834004">.</span><span class="ident" id="5834005">buf</span><span class="op" id="5834008">[</span><span class="num" id="5834009">6</span><span class="op" id="5834010">]</span>&nbsp;<span class="op" id="5834012">=</span>&nbsp;<span class="num" id="5834014">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5834018">//&nbsp;No&nbsp;subsampling&nbsp;for&nbsp;grayscale&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834059">e</span><span class="op" id="5834060">.</span><span class="ident" id="5834061">buf</span><span class="op" id="5834064">[</span><span class="num" id="5834065">7</span><span class="op" id="5834066">]</span>&nbsp;<span class="op" id="5834068">=</span>&nbsp;<span class="num" id="5834070">0x11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834077">e</span><span class="op" id="5834078">.</span><span class="ident" id="5834079">buf</span><span class="op" id="5834082">[</span><span class="num" id="5834083">8</span><span class="op" id="5834084">]</span>&nbsp;<span class="op" id="5834086">=</span>&nbsp;<span class="num" id="5834088">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5834094">}</span>&nbsp;<span class="keyword" id="5834096">else</span>&nbsp;<span class="op" id="5834101">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5834105">for</span>&nbsp;<span class="ident" id="5834109">i</span>&nbsp;<span class="op" id="5834111">:=</span>&nbsp;<span class="num" id="5834114">0</span><span class="op" id="5834115">;</span>&nbsp;<span class="ident" id="5834117">i</span>&nbsp;<span class="op" id="5834119">&lt;</span>&nbsp;<span class="ident" id="5834121">nComponent</span><span class="op" id="5834131">;</span>&nbsp;<span class="ident" id="5834133">i</span><span class="op" id="5834134">++</span>&nbsp;<span class="op" id="5834137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834142">e</span><span class="op" id="5834143">.</span><span class="ident" id="5834144">buf</span><span class="op" id="5834147">[</span><span class="num" id="5834148">3</span><span class="op" id="5834149">*</span><span class="ident" id="5834150">i</span><span class="op" id="5834151">+</span><span class="num" id="5834152">6</span><span class="op" id="5834153">]</span>&nbsp;<span class="op" id="5834155">=</span>&nbsp;<span class="builtintype" id="5834157">uint8</span><span class="op" id="5834162">(</span><span class="ident" id="5834163">i</span>&nbsp;<span class="op" id="5834165">+</span>&nbsp;<span class="num" id="5834167">1</span><span class="op" id="5834168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5834173">//&nbsp;We&nbsp;use&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834212">e</span><span class="op" id="5834213">.</span><span class="ident" id="5834214">buf</span><span class="op" id="5834217">[</span><span class="num" id="5834218">3</span><span class="op" id="5834219">*</span><span class="ident" id="5834220">i</span><span class="op" id="5834221">+</span><span class="num" id="5834222">7</span><span class="op" id="5834223">]</span>&nbsp;<span class="op" id="5834225">=</span>&nbsp;<span class="string" id="5834227">&#34;\x22\x11\x11&#34;</span><span class="op" id="5834241">[</span><span class="ident" id="5834242">i</span><span class="op" id="5834243">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834248">e</span><span class="op" id="5834249">.</span><span class="ident" id="5834250">buf</span><span class="op" id="5834253">[</span><span class="num" id="5834254">3</span><span class="op" id="5834255">*</span><span class="ident" id="5834256">i</span><span class="op" id="5834257">+</span><span class="num" id="5834258">8</span><span class="op" id="5834259">]</span>&nbsp;<span class="op" id="5834261">=</span>&nbsp;<span class="string" id="5834263">&#34;\x00\x01\x01&#34;</span><span class="op" id="5834277">[</span><span class="ident" id="5834278">i</span><span class="op" id="5834279">]</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5834283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5834286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834289">e</span><span class="op" id="5834290">.</span><span class="ident" id="5834291">write</span><span class="op" id="5834296">(</span><span class="ident" id="5834297">e</span><span class="op" id="5834298">.</span><span class="ident" id="5834299">buf</span><span class="op" id="5834302">[</span><span class="op" id="5834303">:</span><span class="num" id="5834304">3</span><span class="op" id="5834305">*</span><span class="op" id="5834306">(</span><span class="ident" id="5834307">nComponent</span><span class="op" id="5834317">-</span><span class="num" id="5834318">1</span><span class="op" id="5834319">)</span><span class="op" id="5834320">+</span><span class="num" id="5834321">9</span><span class="op" id="5834322">]</span><span class="op" id="5834323">)</span><br>
<span class="lineno"></span><span class="op" id="5834325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="5834328">//&nbsp;writeDHT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno"></span><span class="keyword" id="5834380">func</span>&nbsp;<span class="op" id="5834385">(</span><span class="ident" id="5834386">e</span>&nbsp;<span class="op" id="5834388">*</span><span class="ident" id="5834389">encoder</span><span class="op" id="5834396">)</span>&nbsp;<span class="ident" id="5834398">writeDHT</span><span class="op" id="5834406">(</span><span class="ident" id="5834407">nComponent</span>&nbsp;<span class="builtintype" id="5834418">int</span><span class="op" id="5834421">)</span>&nbsp;<span class="op" id="5834423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834426">markerlen</span>&nbsp;<span class="op" id="5834436">:=</span>&nbsp;<span class="num" id="5834439">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834442">specs</span>&nbsp;<span class="op" id="5834448">:=</span>&nbsp;<span class="ident" id="5834451">theHuffmanSpec</span><span class="op" id="5834465">[</span><span class="op" id="5834466">:</span><span class="op" id="5834467">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5834470">if</span>&nbsp;<span class="ident" id="5834473">nComponent</span>&nbsp;<span class="op" id="5834484">==</span>&nbsp;<span class="num" id="5834487">1</span>&nbsp;<span class="op" id="5834489">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5834493">//&nbsp;Drop&nbsp;the&nbsp;Chrominance&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834527">specs</span>&nbsp;<span class="op" id="5834533">=</span>&nbsp;<span class="ident" id="5834535">specs</span><span class="op" id="5834540">[</span><span class="op" id="5834541">:</span><span class="num" id="5834542">2</span><span class="op" id="5834543">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5834546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5834549">for</span>&nbsp;<span class="ident" id="5834553">_</span><span class="op" id="5834554">,</span>&nbsp;<span class="ident" id="5834556">s</span>&nbsp;<span class="op" id="5834558">:=</span>&nbsp;<span class="keyword" id="5834561">range</span>&nbsp;<span class="ident" id="5834567">specs</span>&nbsp;<span class="op" id="5834573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834577">markerlen</span>&nbsp;<span class="op" id="5834587">+=</span>&nbsp;<span class="num" id="5834590">1</span>&nbsp;<span class="op" id="5834592">+</span>&nbsp;<span class="num" id="5834594">16</span>&nbsp;<span class="op" id="5834597">+</span>&nbsp;<span class="builtinfunc" id="5834599">len</span><span class="op" id="5834602">(</span><span class="ident" id="5834603">s</span><span class="op" id="5834604">.</span><span class="ident" id="5834605">value</span><span class="op" id="5834610">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5834613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834616">e</span><span class="op" id="5834617">.</span><span class="ident" id="5834618">writeMarkerHeader</span><span class="op" id="5834635">(</span><span class="ident" id="5834636">dhtMarker</span><span class="op" id="5834645">,</span>&nbsp;<span class="ident" id="5834647">markerlen</span><span class="op" id="5834656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5834659">for</span>&nbsp;<span class="ident" id="5834663">i</span><span class="op" id="5834664">,</span>&nbsp;<span class="ident" id="5834666">s</span>&nbsp;<span class="op" id="5834668">:=</span>&nbsp;<span class="keyword" id="5834671">range</span>&nbsp;<span class="ident" id="5834677">specs</span>&nbsp;<span class="op" id="5834683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834687">e</span><span class="op" id="5834688">.</span><span class="ident" id="5834689">writeByte</span><span class="op" id="5834698">(</span><span class="string" id="5834699">&#34;\x00\x10\x01\x11&#34;</span><span class="op" id="5834717">[</span><span class="ident" id="5834718">i</span><span class="op" id="5834719">]</span><span class="op" id="5834720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834724">e</span><span class="op" id="5834725">.</span><span class="ident" id="5834726">write</span><span class="op" id="5834731">(</span><span class="ident" id="5834732">s</span><span class="op" id="5834733">.</span><span class="ident" id="5834734">count</span><span class="op" id="5834739">[</span><span class="op" id="5834740">:</span><span class="op" id="5834741">]</span><span class="op" id="5834742">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5834746">e</span><span class="op" id="5834747">.</span><span class="ident" id="5834748">write</span><span class="op" id="5834753">(</span><span class="ident" id="5834754">s</span><span class="op" id="5834755">.</span><span class="ident" id="5834756">value</span><span class="op" id="5834761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5834764">}</span><br>
<span class="lineno"></span><span class="op" id="5834766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5834769">//&nbsp;writeBlock&nbsp;writes&nbsp;a&nbsp;block&nbsp;of&nbsp;pixel&nbsp;data&nbsp;using&nbsp;the&nbsp;given&nbsp;quantization&nbsp;table,</span><br>
<span class="lineno">360</span><span class="comment" id="5834848">//&nbsp;returning&nbsp;the&nbsp;post-quantized&nbsp;DC&nbsp;value&nbsp;of&nbsp;the&nbsp;DCT-transformed&nbsp;block.&nbsp;b&nbsp;is&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5834927">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5834959">func</span>&nbsp;<span class="op" id="5834964">(</span><span class="ident" id="5834965">e</span>&nbsp;<span class="op" id="5834967">*</span><span class="ident" id="5834968">encoder</span><span class="op" id="5834975">)</span>&nbsp;<span class="ident" id="5834977">writeBlock</span><span class="op" id="5834987">(</span><span class="ident" id="5834988">b</span>&nbsp;<span class="op" id="5834990">*</span><span class="ident" id="5834991">block</span><span class="op" id="5834996">,</span>&nbsp;<span class="ident" id="5834998">q</span>&nbsp;<span class="ident" id="5835000">quantIndex</span><span class="op" id="5835010">,</span>&nbsp;<span class="ident" id="5835012">prevDC</span>&nbsp;<span class="builtintype" id="5835019">int32</span><span class="op" id="5835024">)</span>&nbsp;<span class="builtintype" id="5835026">int32</span>&nbsp;<span class="op" id="5835032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835035">fdct</span><span class="op" id="5835039">(</span><span class="ident" id="5835040">b</span><span class="op" id="5835041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5835044">//&nbsp;Emit&nbsp;the&nbsp;DC&nbsp;delta.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835067">dc</span>&nbsp;<span class="op" id="5835070">:=</span>&nbsp;<span class="ident" id="5835073">div</span><span class="op" id="5835076">(</span><span class="ident" id="5835077">b</span><span class="op" id="5835078">[</span><span class="num" id="5835079">0</span><span class="op" id="5835080">]</span><span class="op" id="5835081">,</span>&nbsp;<span class="num" id="5835083">8</span><span class="op" id="5835084">*</span><span class="builtintype" id="5835085">int32</span><span class="op" id="5835090">(</span><span class="ident" id="5835091">e</span><span class="op" id="5835092">.</span><span class="ident" id="5835093">quant</span><span class="op" id="5835098">[</span><span class="ident" id="5835099">q</span><span class="op" id="5835100">]</span><span class="op" id="5835101">[</span><span class="num" id="5835102">0</span><span class="op" id="5835103">]</span><span class="op" id="5835104">)</span><span class="op" id="5835105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835108">e</span><span class="op" id="5835109">.</span><span class="ident" id="5835110">emitHuffRLE</span><span class="op" id="5835121">(</span><span class="ident" id="5835122">huffIndex</span><span class="op" id="5835131">(</span><span class="num" id="5835132">2</span><span class="op" id="5835133">*</span><span class="ident" id="5835134">q</span><span class="op" id="5835135">+</span><span class="num" id="5835136">0</span><span class="op" id="5835137">)</span><span class="op" id="5835138">,</span>&nbsp;<span class="num" id="5835140">0</span><span class="op" id="5835141">,</span>&nbsp;<span class="ident" id="5835143">dc</span><span class="op" id="5835145">-</span><span class="ident" id="5835146">prevDC</span><span class="op" id="5835152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5835155">//&nbsp;Emit&nbsp;the&nbsp;AC&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835183">h</span><span class="op" id="5835184">,</span>&nbsp;<span class="ident" id="5835186">runLength</span>&nbsp;<span class="op" id="5835196">:=</span>&nbsp;<span class="ident" id="5835199">huffIndex</span><span class="op" id="5835208">(</span><span class="num" id="5835209">2</span><span class="op" id="5835210">*</span><span class="ident" id="5835211">q</span><span class="op" id="5835212">+</span><span class="num" id="5835213">1</span><span class="op" id="5835214">)</span><span class="op" id="5835215">,</span>&nbsp;<span class="builtintype" id="5835217">int32</span><span class="op" id="5835222">(</span><span class="num" id="5835223">0</span><span class="op" id="5835224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835227">for</span>&nbsp;<span class="ident" id="5835231">zig</span>&nbsp;<span class="op" id="5835235">:=</span>&nbsp;<span class="num" id="5835238">1</span><span class="op" id="5835239">;</span>&nbsp;<span class="ident" id="5835241">zig</span>&nbsp;<span class="op" id="5835245">&lt;</span>&nbsp;<span class="ident" id="5835247">blockSize</span><span class="op" id="5835256">;</span>&nbsp;<span class="ident" id="5835258">zig</span><span class="op" id="5835261">++</span>&nbsp;<span class="op" id="5835264">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835268">ac</span>&nbsp;<span class="op" id="5835271">:=</span>&nbsp;<span class="ident" id="5835274">div</span><span class="op" id="5835277">(</span><span class="ident" id="5835278">b</span><span class="op" id="5835279">[</span><span class="ident" id="5835280">unzig</span><span class="op" id="5835285">[</span><span class="ident" id="5835286">zig</span><span class="op" id="5835289">]</span><span class="op" id="5835290">]</span><span class="op" id="5835291">,</span>&nbsp;<span class="num" id="5835293">8</span><span class="op" id="5835294">*</span><span class="builtintype" id="5835295">int32</span><span class="op" id="5835300">(</span><span class="ident" id="5835301">e</span><span class="op" id="5835302">.</span><span class="ident" id="5835303">quant</span><span class="op" id="5835308">[</span><span class="ident" id="5835309">q</span><span class="op" id="5835310">]</span><span class="op" id="5835311">[</span><span class="ident" id="5835312">zig</span><span class="op" id="5835315">]</span><span class="op" id="5835316">)</span><span class="op" id="5835317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835321">if</span>&nbsp;<span class="ident" id="5835324">ac</span>&nbsp;<span class="op" id="5835327">==</span>&nbsp;<span class="num" id="5835330">0</span>&nbsp;<span class="op" id="5835332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835337">runLength</span><span class="op" id="5835346">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5835351">}</span>&nbsp;<span class="keyword" id="5835353">else</span>&nbsp;<span class="op" id="5835358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835363">for</span>&nbsp;<span class="ident" id="5835367">runLength</span>&nbsp;<span class="op" id="5835377">&gt;</span>&nbsp;<span class="num" id="5835379">15</span>&nbsp;<span class="op" id="5835382">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835388">e</span><span class="op" id="5835389">.</span><span class="ident" id="5835390">emitHuff</span><span class="op" id="5835398">(</span><span class="ident" id="5835399">h</span><span class="op" id="5835400">,</span>&nbsp;<span class="num" id="5835402">0xf0</span><span class="op" id="5835406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835412">runLength</span>&nbsp;<span class="op" id="5835422">-=</span>&nbsp;<span class="num" id="5835425">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5835431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835436">e</span><span class="op" id="5835437">.</span><span class="ident" id="5835438">emitHuffRLE</span><span class="op" id="5835449">(</span><span class="ident" id="5835450">h</span><span class="op" id="5835451">,</span>&nbsp;<span class="ident" id="5835453">runLength</span><span class="op" id="5835462">,</span>&nbsp;<span class="ident" id="5835464">ac</span><span class="op" id="5835466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835471">runLength</span>&nbsp;<span class="op" id="5835481">=</span>&nbsp;<span class="num" id="5835483">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5835487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5835490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835493">if</span>&nbsp;<span class="ident" id="5835496">runLength</span>&nbsp;<span class="op" id="5835506">&gt;</span>&nbsp;<span class="num" id="5835508">0</span>&nbsp;<span class="op" id="5835510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835514">e</span><span class="op" id="5835515">.</span><span class="ident" id="5835516">emitHuff</span><span class="op" id="5835524">(</span><span class="ident" id="5835525">h</span><span class="op" id="5835526">,</span>&nbsp;<span class="num" id="5835528">0x00</span><span class="op" id="5835532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5835535">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835538">return</span>&nbsp;<span class="ident" id="5835545">dc</span><br>
<span class="lineno"></span><span class="op" id="5835548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5835551">//&nbsp;toYCbCr&nbsp;converts&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5835625">//&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno">390</span><span class="keyword" id="5835642">func</span>&nbsp;<span class="ident" id="5835647">toYCbCr</span><span class="op" id="5835654">(</span><span class="ident" id="5835655">m</span>&nbsp;<span class="ident" id="5835657">image</span><span class="op" id="5835662">.</span><span class="ident" id="5835663">Image</span><span class="op" id="5835668">,</span>&nbsp;<span class="ident" id="5835670">p</span>&nbsp;<span class="ident" id="5835672">image</span><span class="op" id="5835677">.</span><span class="ident" id="5835678">Point</span><span class="op" id="5835683">,</span>&nbsp;<span class="ident" id="5835685">yBlock</span><span class="op" id="5835691">,</span>&nbsp;<span class="ident" id="5835693">cbBlock</span><span class="op" id="5835700">,</span>&nbsp;<span class="ident" id="5835702">crBlock</span>&nbsp;<span class="op" id="5835710">*</span><span class="ident" id="5835711">block</span><span class="op" id="5835716">)</span>&nbsp;<span class="op" id="5835718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835721">b</span>&nbsp;<span class="op" id="5835723">:=</span>&nbsp;<span class="ident" id="5835726">m</span><span class="op" id="5835727">.</span><span class="ident" id="5835728">Bounds</span><span class="op" id="5835734">(</span><span class="op" id="5835735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835738">xmax</span>&nbsp;<span class="op" id="5835743">:=</span>&nbsp;<span class="ident" id="5835746">b</span><span class="op" id="5835747">.</span><span class="ident" id="5835748">Max</span><span class="op" id="5835751">.</span><span class="ident" id="5835752">X</span>&nbsp;<span class="op" id="5835754">-</span>&nbsp;<span class="num" id="5835756">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835759">ymax</span>&nbsp;<span class="op" id="5835764">:=</span>&nbsp;<span class="ident" id="5835767">b</span><span class="op" id="5835768">.</span><span class="ident" id="5835769">Max</span><span class="op" id="5835772">.</span><span class="ident" id="5835773">Y</span>&nbsp;<span class="op" id="5835775">-</span>&nbsp;<span class="num" id="5835777">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835780">for</span>&nbsp;<span class="ident" id="5835784">j</span>&nbsp;<span class="op" id="5835786">:=</span>&nbsp;<span class="num" id="5835789">0</span><span class="op" id="5835790">;</span>&nbsp;<span class="ident" id="5835792">j</span>&nbsp;<span class="op" id="5835794">&lt;</span>&nbsp;<span class="num" id="5835796">8</span><span class="op" id="5835797">;</span>&nbsp;<span class="ident" id="5835799">j</span><span class="op" id="5835800">++</span>&nbsp;<span class="op" id="5835803">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5835807">for</span>&nbsp;<span class="ident" id="5835811">i</span>&nbsp;<span class="op" id="5835813">:=</span>&nbsp;<span class="num" id="5835816">0</span><span class="op" id="5835817">;</span>&nbsp;<span class="ident" id="5835819">i</span>&nbsp;<span class="op" id="5835821">&lt;</span>&nbsp;<span class="num" id="5835823">8</span><span class="op" id="5835824">;</span>&nbsp;<span class="ident" id="5835826">i</span><span class="op" id="5835827">++</span>&nbsp;<span class="op" id="5835830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835835">r</span><span class="op" id="5835836">,</span>&nbsp;<span class="ident" id="5835838">g</span><span class="op" id="5835839">,</span>&nbsp;<span class="ident" id="5835841">b</span><span class="op" id="5835842">,</span>&nbsp;<span class="ident" id="5835844">_</span>&nbsp;<span class="op" id="5835846">:=</span>&nbsp;<span class="ident" id="5835849">m</span><span class="op" id="5835850">.</span><span class="ident" id="5835851">At</span><span class="op" id="5835853">(</span><span class="ident" id="5835854">min</span><span class="op" id="5835857">(</span><span class="ident" id="5835858">p</span><span class="op" id="5835859">.</span><span class="ident" id="5835860">X</span><span class="op" id="5835861">+</span><span class="ident" id="5835862">i</span><span class="op" id="5835863">,</span>&nbsp;<span class="ident" id="5835865">xmax</span><span class="op" id="5835869">)</span><span class="op" id="5835870">,</span>&nbsp;<span class="ident" id="5835872">min</span><span class="op" id="5835875">(</span><span class="ident" id="5835876">p</span><span class="op" id="5835877">.</span><span class="ident" id="5835878">Y</span><span class="op" id="5835879">+</span><span class="ident" id="5835880">j</span><span class="op" id="5835881">,</span>&nbsp;<span class="ident" id="5835883">ymax</span><span class="op" id="5835887">)</span><span class="op" id="5835888">)</span><span class="op" id="5835889">.</span><span class="ident" id="5835890">RGBA</span><span class="op" id="5835894">(</span><span class="op" id="5835895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835900">yy</span><span class="op" id="5835902">,</span>&nbsp;<span class="ident" id="5835904">cb</span><span class="op" id="5835906">,</span>&nbsp;<span class="ident" id="5835908">cr</span>&nbsp;<span class="op" id="5835911">:=</span>&nbsp;<span class="ident" id="5835914">color</span><span class="op" id="5835919">.</span><span class="ident" id="5835920">RGBToYCbCr</span><span class="op" id="5835930">(</span><span class="builtintype" id="5835931">uint8</span><span class="op" id="5835936">(</span><span class="ident" id="5835937">r</span><span class="op" id="5835938">&gt;&gt;</span><span class="num" id="5835940">8</span><span class="op" id="5835941">)</span><span class="op" id="5835942">,</span>&nbsp;<span class="builtintype" id="5835944">uint8</span><span class="op" id="5835949">(</span><span class="ident" id="5835950">g</span><span class="op" id="5835951">&gt;&gt;</span><span class="num" id="5835953">8</span><span class="op" id="5835954">)</span><span class="op" id="5835955">,</span>&nbsp;<span class="builtintype" id="5835957">uint8</span><span class="op" id="5835962">(</span><span class="ident" id="5835963">b</span><span class="op" id="5835964">&gt;&gt;</span><span class="num" id="5835966">8</span><span class="op" id="5835967">)</span><span class="op" id="5835968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5835973">yBlock</span><span class="op" id="5835979">[</span><span class="num" id="5835980">8</span><span class="op" id="5835981">*</span><span class="ident" id="5835982">j</span><span class="op" id="5835983">+</span><span class="ident" id="5835984">i</span><span class="op" id="5835985">]</span>&nbsp;<span class="op" id="5835987">=</span>&nbsp;<span class="builtintype" id="5835989">int32</span><span class="op" id="5835994">(</span><span class="ident" id="5835995">yy</span><span class="op" id="5835997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836002">cbBlock</span><span class="op" id="5836009">[</span><span class="num" id="5836010">8</span><span class="op" id="5836011">*</span><span class="ident" id="5836012">j</span><span class="op" id="5836013">+</span><span class="ident" id="5836014">i</span><span class="op" id="5836015">]</span>&nbsp;<span class="op" id="5836017">=</span>&nbsp;<span class="builtintype" id="5836019">int32</span><span class="op" id="5836024">(</span><span class="ident" id="5836025">cb</span><span class="op" id="5836027">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836032">crBlock</span><span class="op" id="5836039">[</span><span class="num" id="5836040">8</span><span class="op" id="5836041">*</span><span class="ident" id="5836042">j</span><span class="op" id="5836043">+</span><span class="ident" id="5836044">i</span><span class="op" id="5836045">]</span>&nbsp;<span class="op" id="5836047">=</span>&nbsp;<span class="builtintype" id="5836049">int32</span><span class="op" id="5836054">(</span><span class="ident" id="5836055">cr</span><span class="op" id="5836057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5836061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5836064">}</span><br>
<span class="lineno"></span><span class="op" id="5836066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="5836069">//&nbsp;grayToY&nbsp;stores&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;in&nbsp;yBlock.</span><br>
<span class="lineno"></span><span class="keyword" id="5836145">func</span>&nbsp;<span class="ident" id="5836150">grayToY</span><span class="op" id="5836157">(</span><span class="ident" id="5836158">m</span>&nbsp;<span class="op" id="5836160">*</span><span class="ident" id="5836161">image</span><span class="op" id="5836166">.</span><span class="ident" id="5836167">Gray</span><span class="op" id="5836171">,</span>&nbsp;<span class="ident" id="5836173">p</span>&nbsp;<span class="ident" id="5836175">image</span><span class="op" id="5836180">.</span><span class="ident" id="5836181">Point</span><span class="op" id="5836186">,</span>&nbsp;<span class="ident" id="5836188">yBlock</span>&nbsp;<span class="op" id="5836195">*</span><span class="ident" id="5836196">block</span><span class="op" id="5836201">)</span>&nbsp;<span class="op" id="5836203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836206">b</span>&nbsp;<span class="op" id="5836208">:=</span>&nbsp;<span class="ident" id="5836211">m</span><span class="op" id="5836212">.</span><span class="ident" id="5836213">Bounds</span><span class="op" id="5836219">(</span><span class="op" id="5836220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836223">xmax</span>&nbsp;<span class="op" id="5836228">:=</span>&nbsp;<span class="ident" id="5836231">b</span><span class="op" id="5836232">.</span><span class="ident" id="5836233">Max</span><span class="op" id="5836236">.</span><span class="ident" id="5836237">X</span>&nbsp;<span class="op" id="5836239">-</span>&nbsp;<span class="num" id="5836241">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836244">ymax</span>&nbsp;<span class="op" id="5836249">:=</span>&nbsp;<span class="ident" id="5836252">b</span><span class="op" id="5836253">.</span><span class="ident" id="5836254">Max</span><span class="op" id="5836257">.</span><span class="ident" id="5836258">Y</span>&nbsp;<span class="op" id="5836260">-</span>&nbsp;<span class="num" id="5836262">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836265">pix</span>&nbsp;<span class="op" id="5836269">:=</span>&nbsp;<span class="ident" id="5836272">m</span><span class="op" id="5836273">.</span><span class="ident" id="5836274">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836279">for</span>&nbsp;<span class="ident" id="5836283">j</span>&nbsp;<span class="op" id="5836285">:=</span>&nbsp;<span class="num" id="5836288">0</span><span class="op" id="5836289">;</span>&nbsp;<span class="ident" id="5836291">j</span>&nbsp;<span class="op" id="5836293">&lt;</span>&nbsp;<span class="num" id="5836295">8</span><span class="op" id="5836296">;</span>&nbsp;<span class="ident" id="5836298">j</span><span class="op" id="5836299">++</span>&nbsp;<span class="op" id="5836302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836306">for</span>&nbsp;<span class="ident" id="5836310">i</span>&nbsp;<span class="op" id="5836312">:=</span>&nbsp;<span class="num" id="5836315">0</span><span class="op" id="5836316">;</span>&nbsp;<span class="ident" id="5836318">i</span>&nbsp;<span class="op" id="5836320">&lt;</span>&nbsp;<span class="num" id="5836322">8</span><span class="op" id="5836323">;</span>&nbsp;<span class="ident" id="5836325">i</span><span class="op" id="5836326">++</span>&nbsp;<span class="op" id="5836329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836334">idx</span>&nbsp;<span class="op" id="5836338">:=</span>&nbsp;<span class="ident" id="5836341">m</span><span class="op" id="5836342">.</span><span class="ident" id="5836343">PixOffset</span><span class="op" id="5836352">(</span><span class="ident" id="5836353">min</span><span class="op" id="5836356">(</span><span class="ident" id="5836357">p</span><span class="op" id="5836358">.</span><span class="ident" id="5836359">X</span><span class="op" id="5836360">+</span><span class="ident" id="5836361">i</span><span class="op" id="5836362">,</span>&nbsp;<span class="ident" id="5836364">xmax</span><span class="op" id="5836368">)</span><span class="op" id="5836369">,</span>&nbsp;<span class="ident" id="5836371">min</span><span class="op" id="5836374">(</span><span class="ident" id="5836375">p</span><span class="op" id="5836376">.</span><span class="ident" id="5836377">Y</span><span class="op" id="5836378">+</span><span class="ident" id="5836379">j</span><span class="op" id="5836380">,</span>&nbsp;<span class="ident" id="5836382">ymax</span><span class="op" id="5836386">)</span><span class="op" id="5836387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836392">yBlock</span><span class="op" id="5836398">[</span><span class="num" id="5836399">8</span><span class="op" id="5836400">*</span><span class="ident" id="5836401">j</span><span class="op" id="5836402">+</span><span class="ident" id="5836403">i</span><span class="op" id="5836404">]</span>&nbsp;<span class="op" id="5836406">=</span>&nbsp;<span class="builtintype" id="5836408">int32</span><span class="op" id="5836413">(</span><span class="ident" id="5836414">pix</span><span class="op" id="5836417">[</span><span class="ident" id="5836418">idx</span><span class="op" id="5836421">]</span><span class="op" id="5836422">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5836426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5836429">}</span><br>
<span class="lineno"></span><span class="op" id="5836431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5836434">//&nbsp;rgbaToYCbCr&nbsp;is&nbsp;a&nbsp;specialized&nbsp;version&nbsp;of&nbsp;toYCbCr&nbsp;for&nbsp;image.RGBA&nbsp;images.</span><br>
<span class="lineno">420</span><span class="keyword" id="5836508">func</span>&nbsp;<span class="ident" id="5836513">rgbaToYCbCr</span><span class="op" id="5836524">(</span><span class="ident" id="5836525">m</span>&nbsp;<span class="op" id="5836527">*</span><span class="ident" id="5836528">image</span><span class="op" id="5836533">.</span><span class="ident" id="5836534">RGBA</span><span class="op" id="5836538">,</span>&nbsp;<span class="ident" id="5836540">p</span>&nbsp;<span class="ident" id="5836542">image</span><span class="op" id="5836547">.</span><span class="ident" id="5836548">Point</span><span class="op" id="5836553">,</span>&nbsp;<span class="ident" id="5836555">yBlock</span><span class="op" id="5836561">,</span>&nbsp;<span class="ident" id="5836563">cbBlock</span><span class="op" id="5836570">,</span>&nbsp;<span class="ident" id="5836572">crBlock</span>&nbsp;<span class="op" id="5836580">*</span><span class="ident" id="5836581">block</span><span class="op" id="5836586">)</span>&nbsp;<span class="op" id="5836588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836591">b</span>&nbsp;<span class="op" id="5836593">:=</span>&nbsp;<span class="ident" id="5836596">m</span><span class="op" id="5836597">.</span><span class="ident" id="5836598">Bounds</span><span class="op" id="5836604">(</span><span class="op" id="5836605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836608">xmax</span>&nbsp;<span class="op" id="5836613">:=</span>&nbsp;<span class="ident" id="5836616">b</span><span class="op" id="5836617">.</span><span class="ident" id="5836618">Max</span><span class="op" id="5836621">.</span><span class="ident" id="5836622">X</span>&nbsp;<span class="op" id="5836624">-</span>&nbsp;<span class="num" id="5836626">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836629">ymax</span>&nbsp;<span class="op" id="5836634">:=</span>&nbsp;<span class="ident" id="5836637">b</span><span class="op" id="5836638">.</span><span class="ident" id="5836639">Max</span><span class="op" id="5836642">.</span><span class="ident" id="5836643">Y</span>&nbsp;<span class="op" id="5836645">-</span>&nbsp;<span class="num" id="5836647">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836650">for</span>&nbsp;<span class="ident" id="5836654">j</span>&nbsp;<span class="op" id="5836656">:=</span>&nbsp;<span class="num" id="5836659">0</span><span class="op" id="5836660">;</span>&nbsp;<span class="ident" id="5836662">j</span>&nbsp;<span class="op" id="5836664">&lt;</span>&nbsp;<span class="num" id="5836666">8</span><span class="op" id="5836667">;</span>&nbsp;<span class="ident" id="5836669">j</span><span class="op" id="5836670">++</span>&nbsp;<span class="op" id="5836673">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836677">sj</span>&nbsp;<span class="op" id="5836680">:=</span>&nbsp;<span class="ident" id="5836683">p</span><span class="op" id="5836684">.</span><span class="ident" id="5836685">Y</span>&nbsp;<span class="op" id="5836687">+</span>&nbsp;<span class="ident" id="5836689">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836693">if</span>&nbsp;<span class="ident" id="5836696">sj</span>&nbsp;<span class="op" id="5836699">&gt;</span>&nbsp;<span class="ident" id="5836701">ymax</span>&nbsp;<span class="op" id="5836706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836711">sj</span>&nbsp;<span class="op" id="5836714">=</span>&nbsp;<span class="ident" id="5836716">ymax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5836723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836727">offset</span>&nbsp;<span class="op" id="5836734">:=</span>&nbsp;<span class="op" id="5836737">(</span><span class="ident" id="5836738">sj</span><span class="op" id="5836740">-</span><span class="ident" id="5836741">b</span><span class="op" id="5836742">.</span><span class="ident" id="5836743">Min</span><span class="op" id="5836746">.</span><span class="ident" id="5836747">Y</span><span class="op" id="5836748">)</span><span class="op" id="5836749">*</span><span class="ident" id="5836750">m</span><span class="op" id="5836751">.</span><span class="ident" id="5836752">Stride</span>&nbsp;<span class="op" id="5836759">-</span>&nbsp;<span class="ident" id="5836761">b</span><span class="op" id="5836762">.</span><span class="ident" id="5836763">Min</span><span class="op" id="5836766">.</span><span class="ident" id="5836767">X</span><span class="op" id="5836768">*</span><span class="num" id="5836769">4</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836773">for</span>&nbsp;<span class="ident" id="5836777">i</span>&nbsp;<span class="op" id="5836779">:=</span>&nbsp;<span class="num" id="5836782">0</span><span class="op" id="5836783">;</span>&nbsp;<span class="ident" id="5836785">i</span>&nbsp;<span class="op" id="5836787">&lt;</span>&nbsp;<span class="num" id="5836789">8</span><span class="op" id="5836790">;</span>&nbsp;<span class="ident" id="5836792">i</span><span class="op" id="5836793">++</span>&nbsp;<span class="op" id="5836796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836801">sx</span>&nbsp;<span class="op" id="5836804">:=</span>&nbsp;<span class="ident" id="5836807">p</span><span class="op" id="5836808">.</span><span class="ident" id="5836809">X</span>&nbsp;<span class="op" id="5836811">+</span>&nbsp;<span class="ident" id="5836813">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5836818">if</span>&nbsp;<span class="ident" id="5836821">sx</span>&nbsp;<span class="op" id="5836824">&gt;</span>&nbsp;<span class="ident" id="5836826">xmax</span>&nbsp;<span class="op" id="5836831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836837">sx</span>&nbsp;<span class="op" id="5836840">=</span>&nbsp;<span class="ident" id="5836842">xmax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5836850">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836855">pix</span>&nbsp;<span class="op" id="5836859">:=</span>&nbsp;<span class="ident" id="5836862">m</span><span class="op" id="5836863">.</span><span class="ident" id="5836864">Pix</span><span class="op" id="5836867">[</span><span class="ident" id="5836868">offset</span><span class="op" id="5836874">+</span><span class="ident" id="5836875">sx</span><span class="op" id="5836877">*</span><span class="num" id="5836878">4</span><span class="op" id="5836879">:</span><span class="op" id="5836880">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836885">yy</span><span class="op" id="5836887">,</span>&nbsp;<span class="ident" id="5836889">cb</span><span class="op" id="5836891">,</span>&nbsp;<span class="ident" id="5836893">cr</span>&nbsp;<span class="op" id="5836896">:=</span>&nbsp;<span class="ident" id="5836899">color</span><span class="op" id="5836904">.</span><span class="ident" id="5836905">RGBToYCbCr</span><span class="op" id="5836915">(</span><span class="ident" id="5836916">pix</span><span class="op" id="5836919">[</span><span class="num" id="5836920">0</span><span class="op" id="5836921">]</span><span class="op" id="5836922">,</span>&nbsp;<span class="ident" id="5836924">pix</span><span class="op" id="5836927">[</span><span class="num" id="5836928">1</span><span class="op" id="5836929">]</span><span class="op" id="5836930">,</span>&nbsp;<span class="ident" id="5836932">pix</span><span class="op" id="5836935">[</span><span class="num" id="5836936">2</span><span class="op" id="5836937">]</span><span class="op" id="5836938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836943">yBlock</span><span class="op" id="5836949">[</span><span class="num" id="5836950">8</span><span class="op" id="5836951">*</span><span class="ident" id="5836952">j</span><span class="op" id="5836953">+</span><span class="ident" id="5836954">i</span><span class="op" id="5836955">]</span>&nbsp;<span class="op" id="5836957">=</span>&nbsp;<span class="builtintype" id="5836959">int32</span><span class="op" id="5836964">(</span><span class="ident" id="5836965">yy</span><span class="op" id="5836967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5836972">cbBlock</span><span class="op" id="5836979">[</span><span class="num" id="5836980">8</span><span class="op" id="5836981">*</span><span class="ident" id="5836982">j</span><span class="op" id="5836983">+</span><span class="ident" id="5836984">i</span><span class="op" id="5836985">]</span>&nbsp;<span class="op" id="5836987">=</span>&nbsp;<span class="builtintype" id="5836989">int32</span><span class="op" id="5836994">(</span><span class="ident" id="5836995">cb</span><span class="op" id="5836997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5837002">crBlock</span><span class="op" id="5837009">[</span><span class="num" id="5837010">8</span><span class="op" id="5837011">*</span><span class="ident" id="5837012">j</span><span class="op" id="5837013">+</span><span class="ident" id="5837014">i</span><span class="op" id="5837015">]</span>&nbsp;<span class="op" id="5837017">=</span>&nbsp;<span class="builtintype" id="5837019">int32</span><span class="op" id="5837024">(</span><span class="ident" id="5837025">cr</span><span class="op" id="5837027">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5837031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5837034">}</span><br>
<span class="lineno"></span><span class="op" id="5837036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5837039">//&nbsp;scale&nbsp;scales&nbsp;the&nbsp;16x16&nbsp;region&nbsp;represented&nbsp;by&nbsp;the&nbsp;4&nbsp;src&nbsp;blocks&nbsp;to&nbsp;the&nbsp;8x8</span><br>
<span class="lineno">445</span><span class="comment" id="5837115">//&nbsp;dst&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="5837129">func</span>&nbsp;<span class="ident" id="5837134">scale</span><span class="op" id="5837139">(</span><span class="ident" id="5837140">dst</span>&nbsp;<span class="op" id="5837144">*</span><span class="ident" id="5837145">block</span><span class="op" id="5837150">,</span>&nbsp;<span class="ident" id="5837152">src</span>&nbsp;<span class="op" id="5837156">*</span><span class="op" id="5837157">[</span><span class="num" id="5837158">4</span><span class="op" id="5837159">]</span><span class="ident" id="5837160">block</span><span class="op" id="5837165">)</span>&nbsp;<span class="op" id="5837167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5837170">for</span>&nbsp;<span class="ident" id="5837174">i</span>&nbsp;<span class="op" id="5837176">:=</span>&nbsp;<span class="num" id="5837179">0</span><span class="op" id="5837180">;</span>&nbsp;<span class="ident" id="5837182">i</span>&nbsp;<span class="op" id="5837184">&lt;</span>&nbsp;<span class="num" id="5837186">4</span><span class="op" id="5837187">;</span>&nbsp;<span class="ident" id="5837189">i</span><span class="op" id="5837190">++</span>&nbsp;<span class="op" id="5837193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5837197">dstOff</span>&nbsp;<span class="op" id="5837204">:=</span>&nbsp;<span class="op" id="5837207">(</span><span class="ident" id="5837208">i</span><span class="op" id="5837209">&amp;</span><span class="num" id="5837210">2</span><span class="op" id="5837211">)</span><span class="op" id="5837212">&lt;&lt;</span><span class="num" id="5837214">4</span>&nbsp;<span class="op" id="5837216">|</span>&nbsp;<span class="op" id="5837218">(</span><span class="ident" id="5837219">i</span><span class="op" id="5837220">&amp;</span><span class="num" id="5837221">1</span><span class="op" id="5837222">)</span><span class="op" id="5837223">&lt;&lt;</span><span class="num" id="5837225">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5837229">for</span>&nbsp;<span class="ident" id="5837233">y</span>&nbsp;<span class="op" id="5837235">:=</span>&nbsp;<span class="num" id="5837238">0</span><span class="op" id="5837239">;</span>&nbsp;<span class="ident" id="5837241">y</span>&nbsp;<span class="op" id="5837243">&lt;</span>&nbsp;<span class="num" id="5837245">4</span><span class="op" id="5837246">;</span>&nbsp;<span class="ident" id="5837248">y</span><span class="op" id="5837249">++</span>&nbsp;<span class="op" id="5837252">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5837257">for</span>&nbsp;<span class="ident" id="5837261">x</span>&nbsp;<span class="op" id="5837263">:=</span>&nbsp;<span class="num" id="5837266">0</span><span class="op" id="5837267">;</span>&nbsp;<span class="ident" id="5837269">x</span>&nbsp;<span class="op" id="5837271">&lt;</span>&nbsp;<span class="num" id="5837273">4</span><span class="op" id="5837274">;</span>&nbsp;<span class="ident" id="5837276">x</span><span class="op" id="5837277">++</span>&nbsp;<span class="op" id="5837280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5837286">j</span>&nbsp;<span class="op" id="5837288">:=</span>&nbsp;<span class="num" id="5837291">16</span><span class="op" id="5837293">*</span><span class="ident" id="5837294">y</span>&nbsp;<span class="op" id="5837296">+</span>&nbsp;<span class="num" id="5837298">2</span><span class="op" id="5837299">*</span><span class="ident" id="5837300">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5837306">sum</span>&nbsp;<span class="op" id="5837310">:=</span>&nbsp;<span class="ident" id="5837313">src</span><span class="op" id="5837316">[</span><span class="ident" id="5837317">i</span><span class="op" id="5837318">]</span><span class="op" id="5837319">[</span><span class="ident" id="5837320">j</span><span class="op" id="5837321">]</span>&nbsp;<span class="op" id="5837323">+</span>&nbsp;<span class="ident" id="5837325">src</span><span class="op" id="5837328">[</span><span class="ident" id="5837329">i</span><span class="op" id="5837330">]</span><span class="op" id="5837331">[</span><span class="ident" id="5837332">j</span><span class="op" id="5837333">+</span><span class="num" id="5837334">1</span><span class="op" id="5837335">]</span>&nbsp;<span class="op" id="5837337">+</span>&nbsp;<span class="ident" id="5837339">src</span><span class="op" id="5837342">[</span><span class="ident" id="5837343">i</span><span class="op" id="5837344">]</span><span class="op" id="5837345">[</span><span class="ident" id="5837346">j</span><span class="op" id="5837347">+</span><span class="num" id="5837348">8</span><span class="op" id="5837349">]</span>&nbsp;<span class="op" id="5837351">+</span>&nbsp;<span class="ident" id="5837353">src</span><span class="op" id="5837356">[</span><span class="ident" id="5837357">i</span><span class="op" id="5837358">]</span><span class="op" id="5837359">[</span><span class="ident" id="5837360">j</span><span class="op" id="5837361">+</span><span class="num" id="5837362">9</span><span class="op" id="5837363">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5837369">dst</span><span class="op" id="5837372">[</span><span class="num" id="5837373">8</span><span class="op" id="5837374">*</span><span class="ident" id="5837375">y</span><span class="op" id="5837376">+</span><span class="ident" id="5837377">x</span><span class="op" id="5837378">+</span><span class="ident" id="5837379">dstOff</span><span class="op" id="5837385">]</span>&nbsp;<span class="op" id="5837387">=</span>&nbsp;<span class="op" id="5837389">(</span><span class="ident" id="5837390">sum</span>&nbsp;<span class="op" id="5837394">+</span>&nbsp;<span class="num" id="5837396">2</span><span class="op" id="5837397">)</span>&nbsp;<span class="op" id="5837399">&gt;&gt;</span>&nbsp;<span class="num" id="5837402">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5837407">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5837411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5837414">}</span><br>
<span class="lineno"></span><span class="op" id="5837416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5837419">//&nbsp;sosHeaderY&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;8&nbsp;bytes:</span><br>
<span class="lineno">460</span><span class="comment" id="5837483">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x08&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5837518">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x01&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5837556">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5837616">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5837687">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno">465</span><span class="comment" id="5837762">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="5837805">var</span>&nbsp;<span class="ident" id="5837809">sosHeaderY</span>&nbsp;<span class="op" id="5837820">=</span>&nbsp;<span class="op" id="5837822">[</span><span class="op" id="5837823">]</span><span class="builtintype" id="5837824">byte</span><span class="op" id="5837828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5837831">0xff</span><span class="op" id="5837835">,</span>&nbsp;<span class="num" id="5837837">0xda</span><span class="op" id="5837841">,</span>&nbsp;<span class="num" id="5837843">0x00</span><span class="op" id="5837847">,</span>&nbsp;<span class="num" id="5837849">0x08</span><span class="op" id="5837853">,</span>&nbsp;<span class="num" id="5837855">0x01</span><span class="op" id="5837859">,</span>&nbsp;<span class="num" id="5837861">0x01</span><span class="op" id="5837865">,</span>&nbsp;<span class="num" id="5837867">0x00</span><span class="op" id="5837871">,</span>&nbsp;<span class="num" id="5837873">0x00</span><span class="op" id="5837877">,</span>&nbsp;<span class="num" id="5837879">0x3f</span><span class="op" id="5837883">,</span>&nbsp;<span class="num" id="5837885">0x00</span><span class="op" id="5837889">,</span><br>
<span class="lineno"></span><span class="op" id="5837891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="5837894">//&nbsp;sosHeaderYCbCr&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;12&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="5837963">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x0c&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5837998">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x03&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5838036">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5838096">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;2&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x02\x11&#34;,</span><br>
<span class="lineno">475</span><span class="comment" id="5838156">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;3&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x03\x11&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5838216">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5838287">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno"></span><span class="comment" id="5838362">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="5838405">var</span>&nbsp;<span class="ident" id="5838409">sosHeaderYCbCr</span>&nbsp;<span class="op" id="5838424">=</span>&nbsp;<span class="op" id="5838426">[</span><span class="op" id="5838427">]</span><span class="builtintype" id="5838428">byte</span><span class="op" id="5838432">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5838435">0xff</span><span class="op" id="5838439">,</span>&nbsp;<span class="num" id="5838441">0xda</span><span class="op" id="5838445">,</span>&nbsp;<span class="num" id="5838447">0x00</span><span class="op" id="5838451">,</span>&nbsp;<span class="num" id="5838453">0x0c</span><span class="op" id="5838457">,</span>&nbsp;<span class="num" id="5838459">0x03</span><span class="op" id="5838463">,</span>&nbsp;<span class="num" id="5838465">0x01</span><span class="op" id="5838469">,</span>&nbsp;<span class="num" id="5838471">0x00</span><span class="op" id="5838475">,</span>&nbsp;<span class="num" id="5838477">0x02</span><span class="op" id="5838481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5838484">0x11</span><span class="op" id="5838488">,</span>&nbsp;<span class="num" id="5838490">0x03</span><span class="op" id="5838494">,</span>&nbsp;<span class="num" id="5838496">0x11</span><span class="op" id="5838500">,</span>&nbsp;<span class="num" id="5838502">0x00</span><span class="op" id="5838506">,</span>&nbsp;<span class="num" id="5838508">0x3f</span><span class="op" id="5838512">,</span>&nbsp;<span class="num" id="5838514">0x00</span><span class="op" id="5838518">,</span><br>
<span class="lineno"></span><span class="op" id="5838520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5838523">//&nbsp;writeSOS&nbsp;writes&nbsp;the&nbsp;StartOfScan&nbsp;marker.</span><br>
<span class="lineno">485</span><span class="keyword" id="5838566">func</span>&nbsp;<span class="op" id="5838571">(</span><span class="ident" id="5838572">e</span>&nbsp;<span class="op" id="5838574">*</span><span class="ident" id="5838575">encoder</span><span class="op" id="5838582">)</span>&nbsp;<span class="ident" id="5838584">writeSOS</span><span class="op" id="5838592">(</span><span class="ident" id="5838593">m</span>&nbsp;<span class="ident" id="5838595">image</span><span class="op" id="5838600">.</span><span class="ident" id="5838601">Image</span><span class="op" id="5838606">)</span>&nbsp;<span class="op" id="5838608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5838611">switch</span>&nbsp;<span class="ident" id="5838618">m</span><span class="op" id="5838619">.</span><span class="op" id="5838620">(</span><span class="keyword" id="5838621">type</span><span class="op" id="5838625">)</span>&nbsp;<span class="op" id="5838627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5838630">case</span>&nbsp;<span class="op" id="5838635">*</span><span class="ident" id="5838636">image</span><span class="op" id="5838641">.</span><span class="ident" id="5838642">Gray</span><span class="op" id="5838646">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5838650">e</span><span class="op" id="5838651">.</span><span class="ident" id="5838652">write</span><span class="op" id="5838657">(</span><span class="ident" id="5838658">sosHeaderY</span><span class="op" id="5838668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5838671">default</span><span class="op" id="5838678">:</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5838682">e</span><span class="op" id="5838683">.</span><span class="ident" id="5838684">write</span><span class="op" id="5838689">(</span><span class="ident" id="5838690">sosHeaderYCbCr</span><span class="op" id="5838704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5838707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5838710">var</span>&nbsp;<span class="op" id="5838714">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5838718">//&nbsp;Scratch&nbsp;buffers&nbsp;to&nbsp;hold&nbsp;the&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5838765">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5838817">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5838824">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5838832">cb</span><span class="op" id="5838834">,</span>&nbsp;<span class="ident" id="5838836">cr</span>&nbsp;<span class="op" id="5838839">[</span><span class="num" id="5838840">4</span><span class="op" id="5838841">]</span><span class="ident" id="5838842">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5838850">//&nbsp;DC&nbsp;components&nbsp;are&nbsp;delta-encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5838888">prevDCY</span><span class="op" id="5838895">,</span>&nbsp;<span class="ident" id="5838897">prevDCCb</span><span class="op" id="5838905">,</span>&nbsp;<span class="ident" id="5838907">prevDCCr</span>&nbsp;<span class="builtintype" id="5838916">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5838923">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5838926">bounds</span>&nbsp;<span class="op" id="5838933">:=</span>&nbsp;<span class="ident" id="5838936">m</span><span class="op" id="5838937">.</span><span class="ident" id="5838938">Bounds</span><span class="op" id="5838944">(</span><span class="op" id="5838945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5838948">switch</span>&nbsp;<span class="ident" id="5838955">m</span>&nbsp;<span class="op" id="5838957">:=</span>&nbsp;<span class="ident" id="5838960">m</span><span class="op" id="5838961">.</span><span class="op" id="5838962">(</span><span class="keyword" id="5838963">type</span><span class="op" id="5838967">)</span>&nbsp;<span class="op" id="5838969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5838972">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5839034">case</span>&nbsp;<span class="op" id="5839039">*</span><span class="ident" id="5839040">image</span><span class="op" id="5839045">.</span><span class="ident" id="5839046">Gray</span><span class="op" id="5839050">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5839054">for</span>&nbsp;<span class="ident" id="5839058">y</span>&nbsp;<span class="op" id="5839060">:=</span>&nbsp;<span class="ident" id="5839063">bounds</span><span class="op" id="5839069">.</span><span class="ident" id="5839070">Min</span><span class="op" id="5839073">.</span><span class="ident" id="5839074">Y</span><span class="op" id="5839075">;</span>&nbsp;<span class="ident" id="5839077">y</span>&nbsp;<span class="op" id="5839079">&lt;</span>&nbsp;<span class="ident" id="5839081">bounds</span><span class="op" id="5839087">.</span><span class="ident" id="5839088">Max</span><span class="op" id="5839091">.</span><span class="ident" id="5839092">Y</span><span class="op" id="5839093">;</span>&nbsp;<span class="ident" id="5839095">y</span>&nbsp;<span class="op" id="5839097">+=</span>&nbsp;<span class="num" id="5839100">8</span>&nbsp;<span class="op" id="5839102">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5839107">for</span>&nbsp;<span class="ident" id="5839111">x</span>&nbsp;<span class="op" id="5839113">:=</span>&nbsp;<span class="ident" id="5839116">bounds</span><span class="op" id="5839122">.</span><span class="ident" id="5839123">Min</span><span class="op" id="5839126">.</span><span class="ident" id="5839127">X</span><span class="op" id="5839128">;</span>&nbsp;<span class="ident" id="5839130">x</span>&nbsp;<span class="op" id="5839132">&lt;</span>&nbsp;<span class="ident" id="5839134">bounds</span><span class="op" id="5839140">.</span><span class="ident" id="5839141">Max</span><span class="op" id="5839144">.</span><span class="ident" id="5839145">X</span><span class="op" id="5839146">;</span>&nbsp;<span class="ident" id="5839148">x</span>&nbsp;<span class="op" id="5839150">+=</span>&nbsp;<span class="num" id="5839153">8</span>&nbsp;<span class="op" id="5839155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5839161">p</span>&nbsp;<span class="op" id="5839163">:=</span>&nbsp;<span class="ident" id="5839166">image</span><span class="op" id="5839171">.</span><span class="ident" id="5839172">Pt</span><span class="op" id="5839174">(</span><span class="ident" id="5839175">x</span><span class="op" id="5839176">,</span>&nbsp;<span class="ident" id="5839178">y</span><span class="op" id="5839179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5839185">grayToY</span><span class="op" id="5839192">(</span><span class="ident" id="5839193">m</span><span class="op" id="5839194">,</span>&nbsp;<span class="ident" id="5839196">p</span><span class="op" id="5839197">,</span>&nbsp;<span class="op" id="5839199">&amp;</span><span class="ident" id="5839200">b</span><span class="op" id="5839201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5839207">prevDCY</span>&nbsp;<span class="op" id="5839215">=</span>&nbsp;<span class="ident" id="5839217">e</span><span class="op" id="5839218">.</span><span class="ident" id="5839219">writeBlock</span><span class="op" id="5839229">(</span><span class="op" id="5839230">&amp;</span><span class="ident" id="5839231">b</span><span class="op" id="5839232">,</span>&nbsp;<span class="num" id="5839234">0</span><span class="op" id="5839235">,</span>&nbsp;<span class="ident" id="5839237">prevDCY</span><span class="op" id="5839244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5839249">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5839253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5839256">default</span><span class="op" id="5839263">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5839267">rgba</span><span class="op" id="5839271">,</span>&nbsp;<span class="ident" id="5839273">_</span>&nbsp;<span class="op" id="5839275">:=</span>&nbsp;<span class="ident" id="5839278">m</span><span class="op" id="5839279">.</span><span class="op" id="5839280">(</span><span class="op" id="5839281">*</span><span class="ident" id="5839282">image</span><span class="op" id="5839287">.</span><span class="ident" id="5839288">RGBA</span><span class="op" id="5839292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5839296">for</span>&nbsp;<span class="ident" id="5839300">y</span>&nbsp;<span class="op" id="5839302">:=</span>&nbsp;<span class="ident" id="5839305">bounds</span><span class="op" id="5839311">.</span><span class="ident" id="5839312">Min</span><span class="op" id="5839315">.</span><span class="ident" id="5839316">Y</span><span class="op" id="5839317">;</span>&nbsp;<span class="ident" id="5839319">y</span>&nbsp;<span class="op" id="5839321">&lt;</span>&nbsp;<span class="ident" id="5839323">bounds</span><span class="op" id="5839329">.</span><span class="ident" id="5839330">Max</span><span class="op" id="5839333">.</span><span class="ident" id="5839334">Y</span><span class="op" id="5839335">;</span>&nbsp;<span class="ident" id="5839337">y</span>&nbsp;<span class="op" id="5839339">+=</span>&nbsp;<span class="num" id="5839342">16</span>&nbsp;<span class="op" id="5839345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5839350">for</span>&nbsp;<span class="ident" id="5839354">x</span>&nbsp;<span class="op" id="5839356">:=</span>&nbsp;<span class="ident" id="5839359">bounds</span><span class="op" id="5839365">.</span><span class="ident" id="5839366">Min</span><span class="op" id="5839369">.</span><span class="ident" id="5839370">X</span><span class="op" id="5839371">;</span>&nbsp;<span class="ident" id="5839373">x</span>&nbsp;<span class="op" id="5839375">&lt;</span>&nbsp;<span class="ident" id="5839377">bounds</span><span class="op" id="5839383">.</span><span class="ident" id="5839384">Max</span><span class="op" id="5839387">.</span><span class="ident" id="5839388">X</span><span class="op" id="5839389">;</span>&nbsp;<span class="ident" id="5839391">x</span>&nbsp;<span class="op" id="5839393">+=</span>&nbsp;<span class="num" id="5839396">16</span>&nbsp;<span class="op" id="5839399">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5839405">for</span>&nbsp;<span class="ident" id="5839409">i</span>&nbsp;<span class="op" id="5839411">:=</span>&nbsp;<span class="num" id="5839414">0</span><span class="op" id="5839415">;</span>&nbsp;<span class="ident" id="5839417">i</span>&nbsp;<span class="op" id="5839419">&lt;</span>&nbsp;<span class="num" id="5839421">4</span><span class="op" id="5839422">;</span>&nbsp;<span class="ident" id="5839424">i</span><span class="op" id="5839425">++</span>&nbsp;<span class="op" id="5839428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5839435">xOff</span>&nbsp;<span class="op" id="5839440">:=</span>&nbsp;<span class="op" id="5839443">(</span><span class="ident" id="5839444">i</span>&nbsp;<span class="op" id="5839446">&amp;</span>&nbsp;<span class="num" id="5839448">1</span><span class="op" id="5839449">)</span>&nbsp;<span class="op" id="5839451">*</span>&nbsp;<span class="num" id="5839453">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5839460">yOff</span>&nbsp;<span class="op" id="5839465">:=</span>&nbsp;<span class="op" id="5839468">(</span><span class="ident" id="5839469">i</span>&nbsp;<span class="op" id="5839471">&amp;</span>&nbsp;<span class="num" id="5839473">2</span><span class="op" id="5839474">)</span>&nbsp;<span class="op" id="5839476">*</span>&nbsp;<span class="num" id="5839478">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5839485">p</span>&nbsp;<span class="op" id="5839487">:=</span>&nbsp;<span class="ident" id="5839490">image</span><span class="op" id="5839495">.</span><span class="ident" id="5839496">Pt</span><span class="op" id="5839498">(</span><span class="ident" id="5839499">x</span><span class="op" id="5839500">+</span><span class="ident" id="5839501">xOff</span><span class="op" id="5839505">,</span>&nbsp;<span class="ident" id="5839507">y</span><span class="op" id="5839508">+</span><span class="ident" id="5839509">yOff</span><span class="op" id="5839513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5839520">if</span>&nbsp;<span class="ident" id="5839523">rgba</span>&nbsp;<span class="op" id="5839528">!=</span>&nbsp;<span class="ident" id="5839531">nil</span>&nbsp;<span class="op" id="5839535">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5839543">rgbaToYCbCr</span><span class="op" id="5839554">(</span><span class="ident" id="5839555">rgba</span><span class="op" id="5839559">,</span>&nbsp;<span class="ident" id="5839561">p</span><span class="op" id="5839562">,</span>&nbsp;<span class="op" id="5839564">&amp;</span><span class="ident" id="5839565">b</span><span class="op" id="5839566">,</span>&nbsp;<span class="op" id="5839568">&amp;</span><span class="ident" id="5839569">cb</span><span class="op" id="5839571">[</span><span class="ident" id="5839572">i</span><span class="op" id="5839573">]</span><span class="op" id="5839574">,</span>&nbsp;<span class="op" id="5839576">&amp;</span><span class="ident" id="5839577">cr</span><span class="op" id="5839579">[</span><span class="ident" id="5839580">i</span><span class="op" id="5839581">]</span><span class="op" id="5839582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5839589">}</span>&nbsp;<span class="keyword" id="5839591">else</span>&nbsp;<span class="op" id="5839596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5839604">toYCbCr</span><span class="op" id="5839611">(</span><span class="ident" id="5839612">m</span><span class="op" id="5839613">,</span>&nbsp;<span class="ident" id="5839615">p</span><span class="op" id="5839616">,</span>&nbsp;<span class="op" id="5839618">&amp;</span><span class="ident" id="5839619">b</span><span class="op" id="5839620">,</span>&nbsp;<span class="op" id="5839622">&amp;</span><span class="ident" id="5839623">cb</span><span class="op" id="5839625">[</span><span class="ident" id="5839626">i</span><span class="op" id="5839627">]</span><span class="op" id="5839628">,</span>&nbsp;<span class="op" id="5839630">&amp;</span><span class="ident" id="5839631">cr</span><span class="op" id="5839633">[</span><span class="ident" id="5839634">i</span><span class="op" id="5839635">]</span><span class="op" id="5839636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5839643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5839650">prevDCY</span>&nbsp;<span class="op" id="5839658">=</span>&nbsp;<span class="ident" id="5839660">e</span><span class="op" id="5839661">.</span><span class="ident" id="5839662">writeBlock</span><span class="op" id="5839672">(</span><span class="op" id="5839673">&amp;</span><span class="ident" id="5839674">b</span><span class="op" id="5839675">,</span>&nbsp;<span class="num" id="5839677">0</span><span class="op" id="5839678">,</span>&nbsp;<span class="ident" id="5839680">prevDCY</span><span class="op" id="5839687">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5839693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5839699">scale</span><span class="op" id="5839704">(</span><span class="op" id="5839705">&amp;</span><span class="ident" id="5839706">b</span><span class="op" id="5839707">,</span>&nbsp;<span class="op" id="5839709">&amp;</span><span class="ident" id="5839710">cb</span><span class="op" id="5839712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5839718">prevDCCb</span>&nbsp;<span class="op" id="5839727">=</span>&nbsp;<span class="ident" id="5839729">e</span><span class="op" id="5839730">.</span><span class="ident" id="5839731">writeBlock</span><span class="op" id="5839741">(</span><span class="op" id="5839742">&amp;</span><span class="ident" id="5839743">b</span><span class="op" id="5839744">,</span>&nbsp;<span class="num" id="5839746">1</span><span class="op" id="5839747">,</span>&nbsp;<span class="ident" id="5839749">prevDCCb</span><span class="op" id="5839757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5839763">scale</span><span class="op" id="5839768">(</span><span class="op" id="5839769">&amp;</span><span class="ident" id="5839770">b</span><span class="op" id="5839771">,</span>&nbsp;<span class="op" id="5839773">&amp;</span><span class="ident" id="5839774">cr</span><span class="op" id="5839776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5839782">prevDCCr</span>&nbsp;<span class="op" id="5839791">=</span>&nbsp;<span class="ident" id="5839793">e</span><span class="op" id="5839794">.</span><span class="ident" id="5839795">writeBlock</span><span class="op" id="5839805">(</span><span class="op" id="5839806">&amp;</span><span class="ident" id="5839807">b</span><span class="op" id="5839808">,</span>&nbsp;<span class="num" id="5839810">1</span><span class="op" id="5839811">,</span>&nbsp;<span class="ident" id="5839813">prevDCCr</span><span class="op" id="5839821">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5839826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5839830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5839833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5839836">//&nbsp;Pad&nbsp;the&nbsp;last&nbsp;byte&nbsp;with&nbsp;1&#39;s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5839868">e</span><span class="op" id="5839869">.</span><span class="ident" id="5839870">emit</span><span class="op" id="5839874">(</span><span class="num" id="5839875">0x7f</span><span class="op" id="5839879">,</span>&nbsp;<span class="num" id="5839881">7</span><span class="op" id="5839882">)</span><br>
<span class="lineno">535</span><span class="op" id="5839884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5839887">//&nbsp;DefaultQuality&nbsp;is&nbsp;the&nbsp;default&nbsp;quality&nbsp;encoding&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="5839948">const</span>&nbsp;<span class="ident" id="5839954">DefaultQuality</span>&nbsp;<span class="op" id="5839969">=</span>&nbsp;<span class="num" id="5839971">75</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="5839975">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="comment" id="5840015">//&nbsp;Quality&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;100&nbsp;inclusive,&nbsp;higher&nbsp;is&nbsp;better.</span><br>
<span class="lineno"></span><span class="keyword" id="5840076">type</span>&nbsp;<span class="ident" id="5840081">Options</span>&nbsp;<span class="keyword" id="5840089">struct</span>&nbsp;<span class="op" id="5840096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5840099">Quality</span>&nbsp;<span class="builtintype" id="5840107">int</span><br>
<span class="lineno"></span><span class="op" id="5840111">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="5840114">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;JPEG&nbsp;4:2:0&nbsp;baseline&nbsp;format&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="5840193">//&nbsp;options.&nbsp;Default&nbsp;parameters&nbsp;are&nbsp;used&nbsp;if&nbsp;a&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;passed.</span><br>
<span class="lineno"></span><span class="keyword" id="5840262">func</span>&nbsp;<span class="ident" id="5840267">Encode</span><span class="op" id="5840273">(</span><span class="ident" id="5840274">w</span>&nbsp;<span class="ident" id="5840276">io</span><span class="op" id="5840278">.</span><span class="ident" id="5840279">Writer</span><span class="op" id="5840285">,</span>&nbsp;<span class="ident" id="5840287">m</span>&nbsp;<span class="ident" id="5840289">image</span><span class="op" id="5840294">.</span><span class="ident" id="5840295">Image</span><span class="op" id="5840300">,</span>&nbsp;<span class="ident" id="5840302">o</span>&nbsp;<span class="op" id="5840304">*</span><span class="ident" id="5840305">Options</span><span class="op" id="5840312">)</span>&nbsp;<span class="builtintype" id="5840314">error</span>&nbsp;<span class="op" id="5840320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5840323">b</span>&nbsp;<span class="op" id="5840325">:=</span>&nbsp;<span class="ident" id="5840328">m</span><span class="op" id="5840329">.</span><span class="ident" id="5840330">Bounds</span><span class="op" id="5840336">(</span><span class="op" id="5840337">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5840340">if</span>&nbsp;<span class="ident" id="5840343">b</span><span class="op" id="5840344">.</span><span class="ident" id="5840345">Dx</span><span class="op" id="5840347">(</span><span class="op" id="5840348">)</span>&nbsp;<span class="op" id="5840350">&gt;=</span>&nbsp;<span class="num" id="5840353">1</span><span class="op" id="5840354">&lt;&lt;</span><span class="num" id="5840356">16</span>&nbsp;<span class="op" id="5840359">||</span>&nbsp;<span class="ident" id="5840362">b</span><span class="op" id="5840363">.</span><span class="ident" id="5840364">Dy</span><span class="op" id="5840366">(</span><span class="op" id="5840367">)</span>&nbsp;<span class="op" id="5840369">&gt;=</span>&nbsp;<span class="num" id="5840372">1</span><span class="op" id="5840373">&lt;&lt;</span><span class="num" id="5840375">16</span>&nbsp;<span class="op" id="5840378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5840382">return</span>&nbsp;<span class="ident" id="5840389">errors</span><span class="op" id="5840395">.</span><span class="ident" id="5840396">New</span><span class="op" id="5840399">(</span><span class="string" id="5840400">&#34;jpeg:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="5840436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5840439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5840442">var</span>&nbsp;<span class="ident" id="5840446">e</span>&nbsp;<span class="ident" id="5840448">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5840457">if</span>&nbsp;<span class="ident" id="5840460">ww</span><span class="op" id="5840462">,</span>&nbsp;<span class="ident" id="5840464">ok</span>&nbsp;<span class="op" id="5840467">:=</span>&nbsp;<span class="ident" id="5840470">w</span><span class="op" id="5840471">.</span><span class="op" id="5840472">(</span><span class="ident" id="5840473">writer</span><span class="op" id="5840479">)</span><span class="op" id="5840480">;</span>&nbsp;<span class="ident" id="5840482">ok</span>&nbsp;<span class="op" id="5840485">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5840489">e</span><span class="op" id="5840490">.</span><span class="ident" id="5840491">w</span>&nbsp;<span class="op" id="5840493">=</span>&nbsp;<span class="ident" id="5840495">ww</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5840499">}</span>&nbsp;<span class="keyword" id="5840501">else</span>&nbsp;<span class="op" id="5840506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5840510">e</span><span class="op" id="5840511">.</span><span class="ident" id="5840512">w</span>&nbsp;<span class="op" id="5840514">=</span>&nbsp;<span class="ident" id="5840516">bufio</span><span class="op" id="5840521">.</span><span class="ident" id="5840522">NewWriter</span><span class="op" id="5840531">(</span><span class="ident" id="5840532">w</span><span class="op" id="5840533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5840536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5840539">//&nbsp;Clip&nbsp;quality&nbsp;to&nbsp;[1,&nbsp;100].</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5840569">quality</span>&nbsp;<span class="op" id="5840577">:=</span>&nbsp;<span class="ident" id="5840580">DefaultQuality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5840596">if</span>&nbsp;<span class="ident" id="5840599">o</span>&nbsp;<span class="op" id="5840601">!=</span>&nbsp;<span class="ident" id="5840604">nil</span>&nbsp;<span class="op" id="5840608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5840612">quality</span>&nbsp;<span class="op" id="5840620">=</span>&nbsp;<span class="ident" id="5840622">o</span><span class="op" id="5840623">.</span><span class="ident" id="5840624">Quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5840634">if</span>&nbsp;<span class="ident" id="5840637">quality</span>&nbsp;<span class="op" id="5840645">&lt;</span>&nbsp;<span class="num" id="5840647">1</span>&nbsp;<span class="op" id="5840649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5840654">quality</span>&nbsp;<span class="op" id="5840662">=</span>&nbsp;<span class="num" id="5840664">1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5840668">}</span>&nbsp;<span class="keyword" id="5840670">else</span>&nbsp;<span class="keyword" id="5840675">if</span>&nbsp;<span class="ident" id="5840678">quality</span>&nbsp;<span class="op" id="5840686">&gt;</span>&nbsp;<span class="num" id="5840688">100</span>&nbsp;<span class="op" id="5840692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5840697">quality</span>&nbsp;<span class="op" id="5840705">=</span>&nbsp;<span class="num" id="5840707">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5840713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5840716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5840719">//&nbsp;Convert&nbsp;from&nbsp;a&nbsp;quality&nbsp;rating&nbsp;to&nbsp;a&nbsp;scaling&nbsp;factor.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5840774">var</span>&nbsp;<span class="ident" id="5840778">scale</span>&nbsp;<span class="builtintype" id="5840784">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5840789">if</span>&nbsp;<span class="ident" id="5840792">quality</span>&nbsp;<span class="op" id="5840800">&lt;</span>&nbsp;<span class="num" id="5840802">50</span>&nbsp;<span class="op" id="5840805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5840809">scale</span>&nbsp;<span class="op" id="5840815">=</span>&nbsp;<span class="num" id="5840817">5000</span>&nbsp;<span class="op" id="5840822">/</span>&nbsp;<span class="ident" id="5840824">quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5840833">}</span>&nbsp;<span class="keyword" id="5840835">else</span>&nbsp;<span class="op" id="5840840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5840844">scale</span>&nbsp;<span class="op" id="5840850">=</span>&nbsp;<span class="num" id="5840852">200</span>&nbsp;<span class="op" id="5840856">-</span>&nbsp;<span class="ident" id="5840858">quality</span><span class="op" id="5840865">*</span><span class="num" id="5840866">2</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5840869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5840872">//&nbsp;Initialize&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5840912">for</span>&nbsp;<span class="ident" id="5840916">i</span>&nbsp;<span class="op" id="5840918">:=</span>&nbsp;<span class="keyword" id="5840921">range</span>&nbsp;<span class="ident" id="5840927">e</span><span class="op" id="5840928">.</span><span class="ident" id="5840929">quant</span>&nbsp;<span class="op" id="5840935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5840939">for</span>&nbsp;<span class="ident" id="5840943">j</span>&nbsp;<span class="op" id="5840945">:=</span>&nbsp;<span class="keyword" id="5840948">range</span>&nbsp;<span class="ident" id="5840954">e</span><span class="op" id="5840955">.</span><span class="ident" id="5840956">quant</span><span class="op" id="5840961">[</span><span class="ident" id="5840962">i</span><span class="op" id="5840963">]</span>&nbsp;<span class="op" id="5840965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5840970">x</span>&nbsp;<span class="op" id="5840972">:=</span>&nbsp;<span class="builtintype" id="5840975">int</span><span class="op" id="5840978">(</span><span class="ident" id="5840979">unscaledQuant</span><span class="op" id="5840992">[</span><span class="ident" id="5840993">i</span><span class="op" id="5840994">]</span><span class="op" id="5840995">[</span><span class="ident" id="5840996">j</span><span class="op" id="5840997">]</span><span class="op" id="5840998">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5841003">x</span>&nbsp;<span class="op" id="5841005">=</span>&nbsp;<span class="op" id="5841007">(</span><span class="ident" id="5841008">x</span><span class="op" id="5841009">*</span><span class="ident" id="5841010">scale</span>&nbsp;<span class="op" id="5841016">+</span>&nbsp;<span class="num" id="5841018">50</span><span class="op" id="5841020">)</span>&nbsp;<span class="op" id="5841022">/</span>&nbsp;<span class="num" id="5841024">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5841031">if</span>&nbsp;<span class="ident" id="5841034">x</span>&nbsp;<span class="op" id="5841036">&lt;</span>&nbsp;<span class="num" id="5841038">1</span>&nbsp;<span class="op" id="5841040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5841046">x</span>&nbsp;<span class="op" id="5841048">=</span>&nbsp;<span class="num" id="5841050">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5841055">}</span>&nbsp;<span class="keyword" id="5841057">else</span>&nbsp;<span class="keyword" id="5841062">if</span>&nbsp;<span class="ident" id="5841065">x</span>&nbsp;<span class="op" id="5841067">&gt;</span>&nbsp;<span class="num" id="5841069">255</span>&nbsp;<span class="op" id="5841073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5841079">x</span>&nbsp;<span class="op" id="5841081">=</span>&nbsp;<span class="num" id="5841083">255</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5841090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5841095">e</span><span class="op" id="5841096">.</span><span class="ident" id="5841097">quant</span><span class="op" id="5841102">[</span><span class="ident" id="5841103">i</span><span class="op" id="5841104">]</span><span class="op" id="5841105">[</span><span class="ident" id="5841106">j</span><span class="op" id="5841107">]</span>&nbsp;<span class="op" id="5841109">=</span>&nbsp;<span class="builtintype" id="5841111">uint8</span><span class="op" id="5841116">(</span><span class="ident" id="5841117">x</span><span class="op" id="5841118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5841122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5841125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5841128">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;components&nbsp;based&nbsp;on&nbsp;input&nbsp;image&nbsp;type.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5841188">nComponent</span>&nbsp;<span class="op" id="5841199">:=</span>&nbsp;<span class="num" id="5841202">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5841205">switch</span>&nbsp;<span class="ident" id="5841212">m</span><span class="op" id="5841213">.</span><span class="op" id="5841214">(</span><span class="keyword" id="5841215">type</span><span class="op" id="5841219">)</span>&nbsp;<span class="op" id="5841221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5841224">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5841286">case</span>&nbsp;<span class="op" id="5841291">*</span><span class="ident" id="5841292">image</span><span class="op" id="5841297">.</span><span class="ident" id="5841298">Gray</span><span class="op" id="5841302">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5841306">nComponent</span>&nbsp;<span class="op" id="5841317">=</span>&nbsp;<span class="num" id="5841319">1</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5841322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5841325">//&nbsp;Write&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5841362">e</span><span class="op" id="5841363">.</span><span class="ident" id="5841364">buf</span><span class="op" id="5841367">[</span><span class="num" id="5841368">0</span><span class="op" id="5841369">]</span>&nbsp;<span class="op" id="5841371">=</span>&nbsp;<span class="num" id="5841373">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5841379">e</span><span class="op" id="5841380">.</span><span class="ident" id="5841381">buf</span><span class="op" id="5841384">[</span><span class="num" id="5841385">1</span><span class="op" id="5841386">]</span>&nbsp;<span class="op" id="5841388">=</span>&nbsp;<span class="num" id="5841390">0xd8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5841396">e</span><span class="op" id="5841397">.</span><span class="ident" id="5841398">write</span><span class="op" id="5841403">(</span><span class="ident" id="5841404">e</span><span class="op" id="5841405">.</span><span class="ident" id="5841406">buf</span><span class="op" id="5841409">[</span><span class="op" id="5841410">:</span><span class="num" id="5841411">2</span><span class="op" id="5841412">]</span><span class="op" id="5841413">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5841416">//&nbsp;Write&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5841451">e</span><span class="op" id="5841452">.</span><span class="ident" id="5841453">writeDQT</span><span class="op" id="5841461">(</span><span class="op" id="5841462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5841465">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;dimensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5841497">e</span><span class="op" id="5841498">.</span><span class="ident" id="5841499">writeSOF0</span><span class="op" id="5841508">(</span><span class="ident" id="5841509">b</span><span class="op" id="5841510">.</span><span class="ident" id="5841511">Size</span><span class="op" id="5841515">(</span><span class="op" id="5841516">)</span><span class="op" id="5841517">,</span>&nbsp;<span class="ident" id="5841519">nComponent</span><span class="op" id="5841529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5841532">//&nbsp;Write&nbsp;the&nbsp;Huffman&nbsp;tables.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5841562">e</span><span class="op" id="5841563">.</span><span class="ident" id="5841564">writeDHT</span><span class="op" id="5841572">(</span><span class="ident" id="5841573">nComponent</span><span class="op" id="5841583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5841586">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5841612">e</span><span class="op" id="5841613">.</span><span class="ident" id="5841614">writeSOS</span><span class="op" id="5841622">(</span><span class="ident" id="5841623">m</span><span class="op" id="5841624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5841627">//&nbsp;Write&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5841662">e</span><span class="op" id="5841663">.</span><span class="ident" id="5841664">buf</span><span class="op" id="5841667">[</span><span class="num" id="5841668">0</span><span class="op" id="5841669">]</span>&nbsp;<span class="op" id="5841671">=</span>&nbsp;<span class="num" id="5841673">0xff</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5841679">e</span><span class="op" id="5841680">.</span><span class="ident" id="5841681">buf</span><span class="op" id="5841684">[</span><span class="num" id="5841685">1</span><span class="op" id="5841686">]</span>&nbsp;<span class="op" id="5841688">=</span>&nbsp;<span class="num" id="5841690">0xd9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5841696">e</span><span class="op" id="5841697">.</span><span class="ident" id="5841698">write</span><span class="op" id="5841703">(</span><span class="ident" id="5841704">e</span><span class="op" id="5841705">.</span><span class="ident" id="5841706">buf</span><span class="op" id="5841709">[</span><span class="op" id="5841710">:</span><span class="num" id="5841711">2</span><span class="op" id="5841712">]</span><span class="op" id="5841713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5841716">e</span><span class="op" id="5841717">.</span><span class="ident" id="5841718">flush</span><span class="op" id="5841723">(</span><span class="op" id="5841724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5841727">return</span>&nbsp;<span class="ident" id="5841734">e</span><span class="op" id="5841735">.</span><span class="ident" id="5841736">err</span><br>
<span class="lineno"></span><span class="op" id="5841740">}</span>
</div>
</body>
</html>
