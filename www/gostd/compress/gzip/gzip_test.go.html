<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8289752">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8289807">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8289861">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8289912">package</span>&nbsp;<span class="ident" id="8289920">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8289926">import</span>&nbsp;<span class="op" id="8289933">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8289936">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8289945">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8289954">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8289967">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8289978">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8289985">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="8289988">//&nbsp;TestEmpty&nbsp;tests&nbsp;that&nbsp;an&nbsp;empty&nbsp;payload&nbsp;still&nbsp;forms&nbsp;a&nbsp;valid&nbsp;GZIP&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="8290062">func</span>&nbsp;<span class="ident" id="8290067">TestEmpty</span><span class="op" id="8290076">(</span><span class="ident" id="8290077">t</span>&nbsp;<span class="op" id="8290079">*</span><span class="ident" id="8290080">testing</span><span class="op" id="8290087">.</span><span class="ident" id="8290088">T</span><span class="op" id="8290089">)</span>&nbsp;<span class="op" id="8290091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290094">buf</span>&nbsp;<span class="op" id="8290098">:=</span>&nbsp;<span class="builtinfunc" id="8290101">new</span><span class="op" id="8290104">(</span><span class="ident" id="8290105">bytes</span><span class="op" id="8290110">.</span><span class="ident" id="8290111">Buffer</span><span class="op" id="8290117">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8290121">if</span>&nbsp;<span class="ident" id="8290124">err</span>&nbsp;<span class="op" id="8290128">:=</span>&nbsp;<span class="ident" id="8290131">NewWriter</span><span class="op" id="8290140">(</span><span class="ident" id="8290141">buf</span><span class="op" id="8290144">)</span><span class="op" id="8290145">.</span><span class="ident" id="8290146">Close</span><span class="op" id="8290151">(</span><span class="op" id="8290152">)</span><span class="op" id="8290153">;</span>&nbsp;<span class="ident" id="8290155">err</span>&nbsp;<span class="op" id="8290159">!=</span>&nbsp;<span class="ident" id="8290162">nil</span>&nbsp;<span class="op" id="8290166">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290170">t</span><span class="op" id="8290171">.</span><span class="ident" id="8290172">Fatalf</span><span class="op" id="8290178">(</span><span class="string" id="8290179">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="8290197">,</span>&nbsp;<span class="ident" id="8290199">err</span><span class="op" id="8290202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8290205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290209">r</span><span class="op" id="8290210">,</span>&nbsp;<span class="ident" id="8290212">err</span>&nbsp;<span class="op" id="8290216">:=</span>&nbsp;<span class="ident" id="8290219">NewReader</span><span class="op" id="8290228">(</span><span class="ident" id="8290229">buf</span><span class="op" id="8290232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8290235">if</span>&nbsp;<span class="ident" id="8290238">err</span>&nbsp;<span class="op" id="8290242">!=</span>&nbsp;<span class="ident" id="8290245">nil</span>&nbsp;<span class="op" id="8290249">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290253">t</span><span class="op" id="8290254">.</span><span class="ident" id="8290255">Fatalf</span><span class="op" id="8290261">(</span><span class="string" id="8290262">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="8290277">,</span>&nbsp;<span class="ident" id="8290279">err</span><span class="op" id="8290282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8290285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290288">b</span><span class="op" id="8290289">,</span>&nbsp;<span class="ident" id="8290291">err</span>&nbsp;<span class="op" id="8290295">:=</span>&nbsp;<span class="ident" id="8290298">ioutil</span><span class="op" id="8290304">.</span><span class="ident" id="8290305">ReadAll</span><span class="op" id="8290312">(</span><span class="ident" id="8290313">r</span><span class="op" id="8290314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8290317">if</span>&nbsp;<span class="ident" id="8290320">err</span>&nbsp;<span class="op" id="8290324">!=</span>&nbsp;<span class="ident" id="8290327">nil</span>&nbsp;<span class="op" id="8290331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290335">t</span><span class="op" id="8290336">.</span><span class="ident" id="8290337">Fatalf</span><span class="op" id="8290343">(</span><span class="string" id="8290344">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="8290357">,</span>&nbsp;<span class="ident" id="8290359">err</span><span class="op" id="8290362">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8290365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8290368">if</span>&nbsp;<span class="builtinfunc" id="8290371">len</span><span class="op" id="8290374">(</span><span class="ident" id="8290375">b</span><span class="op" id="8290376">)</span>&nbsp;<span class="op" id="8290378">!=</span>&nbsp;<span class="num" id="8290381">0</span>&nbsp;<span class="op" id="8290383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290387">t</span><span class="op" id="8290388">.</span><span class="ident" id="8290389">Fatalf</span><span class="op" id="8290395">(</span><span class="string" id="8290396">&#34;got&nbsp;%d&nbsp;bytes,&nbsp;want&nbsp;0&#34;</span><span class="op" id="8290418">,</span>&nbsp;<span class="builtinfunc" id="8290420">len</span><span class="op" id="8290423">(</span><span class="ident" id="8290424">b</span><span class="op" id="8290425">)</span><span class="op" id="8290426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8290429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8290432">if</span>&nbsp;<span class="ident" id="8290435">err</span>&nbsp;<span class="op" id="8290439">:=</span>&nbsp;<span class="ident" id="8290442">r</span><span class="op" id="8290443">.</span><span class="ident" id="8290444">Close</span><span class="op" id="8290449">(</span><span class="op" id="8290450">)</span><span class="op" id="8290451">;</span>&nbsp;<span class="ident" id="8290453">err</span>&nbsp;<span class="op" id="8290457">!=</span>&nbsp;<span class="ident" id="8290460">nil</span>&nbsp;<span class="op" id="8290464">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290468">t</span><span class="op" id="8290469">.</span><span class="ident" id="8290470">Fatalf</span><span class="op" id="8290476">(</span><span class="string" id="8290477">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="8290495">,</span>&nbsp;<span class="ident" id="8290497">err</span><span class="op" id="8290500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8290503">}</span><br>
<span class="lineno"></span><span class="op" id="8290505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8290508">//&nbsp;TestRoundTrip&nbsp;tests&nbsp;that&nbsp;gzipping&nbsp;and&nbsp;then&nbsp;gunzipping&nbsp;is&nbsp;the&nbsp;identity</span><br>
<span class="lineno">40</span><span class="comment" id="8290581">//&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="8290594">func</span>&nbsp;<span class="ident" id="8290599">TestRoundTrip</span><span class="op" id="8290612">(</span><span class="ident" id="8290613">t</span>&nbsp;<span class="op" id="8290615">*</span><span class="ident" id="8290616">testing</span><span class="op" id="8290623">.</span><span class="ident" id="8290624">T</span><span class="op" id="8290625">)</span>&nbsp;<span class="op" id="8290627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290630">buf</span>&nbsp;<span class="op" id="8290634">:=</span>&nbsp;<span class="builtinfunc" id="8290637">new</span><span class="op" id="8290640">(</span><span class="ident" id="8290641">bytes</span><span class="op" id="8290646">.</span><span class="ident" id="8290647">Buffer</span><span class="op" id="8290653">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290657">w</span>&nbsp;<span class="op" id="8290659">:=</span>&nbsp;<span class="ident" id="8290662">NewWriter</span><span class="op" id="8290671">(</span><span class="ident" id="8290672">buf</span><span class="op" id="8290675">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290678">w</span><span class="op" id="8290679">.</span><span class="ident" id="8290680">Comment</span>&nbsp;<span class="op" id="8290688">=</span>&nbsp;<span class="string" id="8290690">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290701">w</span><span class="op" id="8290702">.</span><span class="ident" id="8290703">Extra</span>&nbsp;<span class="op" id="8290709">=</span>&nbsp;<span class="op" id="8290711">[</span><span class="op" id="8290712">]</span><span class="builtintype" id="8290713">byte</span><span class="op" id="8290717">(</span><span class="string" id="8290718">&#34;extra&#34;</span><span class="op" id="8290725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290728">w</span><span class="op" id="8290729">.</span><span class="ident" id="8290730">ModTime</span>&nbsp;<span class="op" id="8290738">=</span>&nbsp;<span class="ident" id="8290740">time</span><span class="op" id="8290744">.</span><span class="ident" id="8290745">Unix</span><span class="op" id="8290749">(</span><span class="num" id="8290750">1e8</span><span class="op" id="8290753">,</span>&nbsp;<span class="num" id="8290755">0</span><span class="op" id="8290756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290759">w</span><span class="op" id="8290760">.</span><span class="ident" id="8290761">Name</span>&nbsp;<span class="op" id="8290766">=</span>&nbsp;<span class="string" id="8290768">&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8290776">if</span>&nbsp;<span class="ident" id="8290779">_</span><span class="op" id="8290780">,</span>&nbsp;<span class="ident" id="8290782">err</span>&nbsp;<span class="op" id="8290786">:=</span>&nbsp;<span class="ident" id="8290789">w</span><span class="op" id="8290790">.</span><span class="ident" id="8290791">Write</span><span class="op" id="8290796">(</span><span class="op" id="8290797">[</span><span class="op" id="8290798">]</span><span class="builtintype" id="8290799">byte</span><span class="op" id="8290803">(</span><span class="string" id="8290804">&#34;payload&#34;</span><span class="op" id="8290813">)</span><span class="op" id="8290814">)</span><span class="op" id="8290815">;</span>&nbsp;<span class="ident" id="8290817">err</span>&nbsp;<span class="op" id="8290821">!=</span>&nbsp;<span class="ident" id="8290824">nil</span>&nbsp;<span class="op" id="8290828">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290832">t</span><span class="op" id="8290833">.</span><span class="ident" id="8290834">Fatalf</span><span class="op" id="8290840">(</span><span class="string" id="8290841">&#34;Write:&nbsp;%v&#34;</span><span class="op" id="8290852">,</span>&nbsp;<span class="ident" id="8290854">err</span><span class="op" id="8290857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8290860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8290863">if</span>&nbsp;<span class="ident" id="8290866">err</span>&nbsp;<span class="op" id="8290870">:=</span>&nbsp;<span class="ident" id="8290873">w</span><span class="op" id="8290874">.</span><span class="ident" id="8290875">Close</span><span class="op" id="8290880">(</span><span class="op" id="8290881">)</span><span class="op" id="8290882">;</span>&nbsp;<span class="ident" id="8290884">err</span>&nbsp;<span class="op" id="8290888">!=</span>&nbsp;<span class="ident" id="8290891">nil</span>&nbsp;<span class="op" id="8290895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290899">t</span><span class="op" id="8290900">.</span><span class="ident" id="8290901">Fatalf</span><span class="op" id="8290907">(</span><span class="string" id="8290908">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="8290926">,</span>&nbsp;<span class="ident" id="8290928">err</span><span class="op" id="8290931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8290934">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290938">r</span><span class="op" id="8290939">,</span>&nbsp;<span class="ident" id="8290941">err</span>&nbsp;<span class="op" id="8290945">:=</span>&nbsp;<span class="ident" id="8290948">NewReader</span><span class="op" id="8290957">(</span><span class="ident" id="8290958">buf</span><span class="op" id="8290961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8290964">if</span>&nbsp;<span class="ident" id="8290967">err</span>&nbsp;<span class="op" id="8290971">!=</span>&nbsp;<span class="ident" id="8290974">nil</span>&nbsp;<span class="op" id="8290978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290982">t</span><span class="op" id="8290983">.</span><span class="ident" id="8290984">Fatalf</span><span class="op" id="8290990">(</span><span class="string" id="8290991">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="8291006">,</span>&nbsp;<span class="ident" id="8291008">err</span><span class="op" id="8291011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291014">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291017">b</span><span class="op" id="8291018">,</span>&nbsp;<span class="ident" id="8291020">err</span>&nbsp;<span class="op" id="8291024">:=</span>&nbsp;<span class="ident" id="8291027">ioutil</span><span class="op" id="8291033">.</span><span class="ident" id="8291034">ReadAll</span><span class="op" id="8291041">(</span><span class="ident" id="8291042">r</span><span class="op" id="8291043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291046">if</span>&nbsp;<span class="ident" id="8291049">err</span>&nbsp;<span class="op" id="8291053">!=</span>&nbsp;<span class="ident" id="8291056">nil</span>&nbsp;<span class="op" id="8291060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291064">t</span><span class="op" id="8291065">.</span><span class="ident" id="8291066">Fatalf</span><span class="op" id="8291072">(</span><span class="string" id="8291073">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="8291086">,</span>&nbsp;<span class="ident" id="8291088">err</span><span class="op" id="8291091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291097">if</span>&nbsp;<span class="builtintype" id="8291100">string</span><span class="op" id="8291106">(</span><span class="ident" id="8291107">b</span><span class="op" id="8291108">)</span>&nbsp;<span class="op" id="8291110">!=</span>&nbsp;<span class="string" id="8291113">&#34;payload&#34;</span>&nbsp;<span class="op" id="8291123">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291127">t</span><span class="op" id="8291128">.</span><span class="ident" id="8291129">Fatalf</span><span class="op" id="8291135">(</span><span class="string" id="8291136">&#34;payload&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8291160">,</span>&nbsp;<span class="builtintype" id="8291162">string</span><span class="op" id="8291168">(</span><span class="ident" id="8291169">b</span><span class="op" id="8291170">)</span><span class="op" id="8291171">,</span>&nbsp;<span class="string" id="8291173">&#34;payload&#34;</span><span class="op" id="8291182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291188">if</span>&nbsp;<span class="ident" id="8291191">r</span><span class="op" id="8291192">.</span><span class="ident" id="8291193">Comment</span>&nbsp;<span class="op" id="8291201">!=</span>&nbsp;<span class="string" id="8291204">&#34;comment&#34;</span>&nbsp;<span class="op" id="8291214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291218">t</span><span class="op" id="8291219">.</span><span class="ident" id="8291220">Fatalf</span><span class="op" id="8291226">(</span><span class="string" id="8291227">&#34;comment&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8291251">,</span>&nbsp;<span class="ident" id="8291253">r</span><span class="op" id="8291254">.</span><span class="ident" id="8291255">Comment</span><span class="op" id="8291262">,</span>&nbsp;<span class="string" id="8291264">&#34;comment&#34;</span><span class="op" id="8291273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291276">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291279">if</span>&nbsp;<span class="builtintype" id="8291282">string</span><span class="op" id="8291288">(</span><span class="ident" id="8291289">r</span><span class="op" id="8291290">.</span><span class="ident" id="8291291">Extra</span><span class="op" id="8291296">)</span>&nbsp;<span class="op" id="8291298">!=</span>&nbsp;<span class="string" id="8291301">&#34;extra&#34;</span>&nbsp;<span class="op" id="8291309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291313">t</span><span class="op" id="8291314">.</span><span class="ident" id="8291315">Fatalf</span><span class="op" id="8291321">(</span><span class="string" id="8291322">&#34;extra&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8291344">,</span>&nbsp;<span class="ident" id="8291346">r</span><span class="op" id="8291347">.</span><span class="ident" id="8291348">Extra</span><span class="op" id="8291353">,</span>&nbsp;<span class="string" id="8291355">&#34;extra&#34;</span><span class="op" id="8291362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291368">if</span>&nbsp;<span class="ident" id="8291371">r</span><span class="op" id="8291372">.</span><span class="ident" id="8291373">ModTime</span><span class="op" id="8291380">.</span><span class="ident" id="8291381">Unix</span><span class="op" id="8291385">(</span><span class="op" id="8291386">)</span>&nbsp;<span class="op" id="8291388">!=</span>&nbsp;<span class="num" id="8291391">1e8</span>&nbsp;<span class="op" id="8291395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291399">t</span><span class="op" id="8291400">.</span><span class="ident" id="8291401">Fatalf</span><span class="op" id="8291407">(</span><span class="string" id="8291408">&#34;mtime&nbsp;is&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8291430">,</span>&nbsp;<span class="ident" id="8291432">r</span><span class="op" id="8291433">.</span><span class="ident" id="8291434">ModTime</span><span class="op" id="8291441">.</span><span class="ident" id="8291442">Unix</span><span class="op" id="8291446">(</span><span class="op" id="8291447">)</span><span class="op" id="8291448">,</span>&nbsp;<span class="builtintype" id="8291450">uint32</span><span class="op" id="8291456">(</span><span class="num" id="8291457">1e8</span><span class="op" id="8291460">)</span><span class="op" id="8291461">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291467">if</span>&nbsp;<span class="ident" id="8291470">r</span><span class="op" id="8291471">.</span><span class="ident" id="8291472">Name</span>&nbsp;<span class="op" id="8291477">!=</span>&nbsp;<span class="string" id="8291480">&#34;name&#34;</span>&nbsp;<span class="op" id="8291487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291491">t</span><span class="op" id="8291492">.</span><span class="ident" id="8291493">Fatalf</span><span class="op" id="8291499">(</span><span class="string" id="8291500">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8291521">,</span>&nbsp;<span class="ident" id="8291523">r</span><span class="op" id="8291524">.</span><span class="ident" id="8291525">Name</span><span class="op" id="8291529">,</span>&nbsp;<span class="string" id="8291531">&#34;name&#34;</span><span class="op" id="8291537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291543">if</span>&nbsp;<span class="ident" id="8291546">err</span>&nbsp;<span class="op" id="8291550">:=</span>&nbsp;<span class="ident" id="8291553">r</span><span class="op" id="8291554">.</span><span class="ident" id="8291555">Close</span><span class="op" id="8291560">(</span><span class="op" id="8291561">)</span><span class="op" id="8291562">;</span>&nbsp;<span class="ident" id="8291564">err</span>&nbsp;<span class="op" id="8291568">!=</span>&nbsp;<span class="ident" id="8291571">nil</span>&nbsp;<span class="op" id="8291575">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291579">t</span><span class="op" id="8291580">.</span><span class="ident" id="8291581">Fatalf</span><span class="op" id="8291587">(</span><span class="string" id="8291588">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="8291606">,</span>&nbsp;<span class="ident" id="8291608">err</span><span class="op" id="8291611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291614">}</span><br>
<span class="lineno"></span><span class="op" id="8291616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8291619">//&nbsp;TestLatin1&nbsp;tests&nbsp;the&nbsp;internal&nbsp;functions&nbsp;for&nbsp;converting&nbsp;to&nbsp;and&nbsp;from&nbsp;Latin-1.</span><br>
<span class="lineno">85</span><span class="keyword" id="8291698">func</span>&nbsp;<span class="ident" id="8291703">TestLatin1</span><span class="op" id="8291713">(</span><span class="ident" id="8291714">t</span>&nbsp;<span class="op" id="8291716">*</span><span class="ident" id="8291717">testing</span><span class="op" id="8291724">.</span><span class="ident" id="8291725">T</span><span class="op" id="8291726">)</span>&nbsp;<span class="op" id="8291728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291731">latin1</span>&nbsp;<span class="op" id="8291738">:=</span>&nbsp;<span class="op" id="8291741">[</span><span class="op" id="8291742">]</span><span class="builtintype" id="8291743">byte</span><span class="op" id="8291747">{</span><span class="num" id="8291748">0xc4</span><span class="op" id="8291752">,</span>&nbsp;<span class="string" id="8291754">&#39;u&#39;</span><span class="op" id="8291757">,</span>&nbsp;<span class="num" id="8291759">0xdf</span><span class="op" id="8291763">,</span>&nbsp;<span class="string" id="8291765">&#39;e&#39;</span><span class="op" id="8291768">,</span>&nbsp;<span class="string" id="8291770">&#39;r&#39;</span><span class="op" id="8291773">,</span>&nbsp;<span class="string" id="8291775">&#39;u&#39;</span><span class="op" id="8291778">,</span>&nbsp;<span class="string" id="8291780">&#39;n&#39;</span><span class="op" id="8291783">,</span>&nbsp;<span class="string" id="8291785">&#39;g&#39;</span><span class="op" id="8291788">,</span>&nbsp;<span class="num" id="8291790">0</span><span class="op" id="8291791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291794">utf8</span>&nbsp;<span class="op" id="8291799">:=</span>&nbsp;<span class="string" id="8291802">&#34;Äußerung&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291816">z</span>&nbsp;<span class="op" id="8291818">:=</span>&nbsp;<span class="ident" id="8291821">Reader</span><span class="op" id="8291827">{</span><span class="ident" id="8291828">r</span><span class="op" id="8291829">:</span>&nbsp;<span class="ident" id="8291831">bufio</span><span class="op" id="8291836">.</span><span class="ident" id="8291837">NewReader</span><span class="op" id="8291846">(</span><span class="ident" id="8291847">bytes</span><span class="op" id="8291852">.</span><span class="ident" id="8291853">NewReader</span><span class="op" id="8291862">(</span><span class="ident" id="8291863">latin1</span><span class="op" id="8291869">)</span><span class="op" id="8291870">)</span><span class="op" id="8291871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291874">s</span><span class="op" id="8291875">,</span>&nbsp;<span class="ident" id="8291877">err</span>&nbsp;<span class="op" id="8291881">:=</span>&nbsp;<span class="ident" id="8291884">z</span><span class="op" id="8291885">.</span><span class="ident" id="8291886">readString</span><span class="op" id="8291896">(</span><span class="op" id="8291897">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291900">if</span>&nbsp;<span class="ident" id="8291903">err</span>&nbsp;<span class="op" id="8291907">!=</span>&nbsp;<span class="ident" id="8291910">nil</span>&nbsp;<span class="op" id="8291914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291918">t</span><span class="op" id="8291919">.</span><span class="ident" id="8291920">Fatalf</span><span class="op" id="8291926">(</span><span class="string" id="8291927">&#34;readString:&nbsp;%v&#34;</span><span class="op" id="8291943">,</span>&nbsp;<span class="ident" id="8291945">err</span><span class="op" id="8291948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291954">if</span>&nbsp;<span class="ident" id="8291957">s</span>&nbsp;<span class="op" id="8291959">!=</span>&nbsp;<span class="ident" id="8291962">utf8</span>&nbsp;<span class="op" id="8291967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291971">t</span><span class="op" id="8291972">.</span><span class="ident" id="8291973">Fatalf</span><span class="op" id="8291979">(</span><span class="string" id="8291980">&#34;read&nbsp;latin-1:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8292011">,</span>&nbsp;<span class="ident" id="8292013">s</span><span class="op" id="8292014">,</span>&nbsp;<span class="ident" id="8292016">utf8</span><span class="op" id="8292020">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292027">buf</span>&nbsp;<span class="op" id="8292031">:=</span>&nbsp;<span class="ident" id="8292034">bytes</span><span class="op" id="8292039">.</span><span class="ident" id="8292040">NewBuffer</span><span class="op" id="8292049">(</span><span class="builtinfunc" id="8292050">make</span><span class="op" id="8292054">(</span><span class="op" id="8292055">[</span><span class="op" id="8292056">]</span><span class="builtintype" id="8292057">byte</span><span class="op" id="8292061">,</span>&nbsp;<span class="num" id="8292063">0</span><span class="op" id="8292064">,</span>&nbsp;<span class="builtinfunc" id="8292066">len</span><span class="op" id="8292069">(</span><span class="ident" id="8292070">latin1</span><span class="op" id="8292076">)</span><span class="op" id="8292077">)</span><span class="op" id="8292078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292081">c</span>&nbsp;<span class="op" id="8292083">:=</span>&nbsp;<span class="ident" id="8292086">Writer</span><span class="op" id="8292092">{</span><span class="ident" id="8292093">w</span><span class="op" id="8292094">:</span>&nbsp;<span class="ident" id="8292096">buf</span><span class="op" id="8292099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292102">if</span>&nbsp;<span class="ident" id="8292105">err</span>&nbsp;<span class="op" id="8292109">=</span>&nbsp;<span class="ident" id="8292111">c</span><span class="op" id="8292112">.</span><span class="ident" id="8292113">writeString</span><span class="op" id="8292124">(</span><span class="ident" id="8292125">utf8</span><span class="op" id="8292129">)</span><span class="op" id="8292130">;</span>&nbsp;<span class="ident" id="8292132">err</span>&nbsp;<span class="op" id="8292136">!=</span>&nbsp;<span class="ident" id="8292139">nil</span>&nbsp;<span class="op" id="8292143">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292147">t</span><span class="op" id="8292148">.</span><span class="ident" id="8292149">Fatalf</span><span class="op" id="8292155">(</span><span class="string" id="8292156">&#34;writeString:&nbsp;%v&#34;</span><span class="op" id="8292173">,</span>&nbsp;<span class="ident" id="8292175">err</span><span class="op" id="8292178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292184">s</span>&nbsp;<span class="op" id="8292186">=</span>&nbsp;<span class="ident" id="8292188">buf</span><span class="op" id="8292191">.</span><span class="ident" id="8292192">String</span><span class="op" id="8292198">(</span><span class="op" id="8292199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292202">if</span>&nbsp;<span class="ident" id="8292205">s</span>&nbsp;<span class="op" id="8292207">!=</span>&nbsp;<span class="builtintype" id="8292210">string</span><span class="op" id="8292216">(</span><span class="ident" id="8292217">latin1</span><span class="op" id="8292223">)</span>&nbsp;<span class="op" id="8292225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292229">t</span><span class="op" id="8292230">.</span><span class="ident" id="8292231">Fatalf</span><span class="op" id="8292237">(</span><span class="string" id="8292238">&#34;write&nbsp;utf-8:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8292268">,</span>&nbsp;<span class="ident" id="8292270">s</span><span class="op" id="8292271">,</span>&nbsp;<span class="builtintype" id="8292273">string</span><span class="op" id="8292279">(</span><span class="ident" id="8292280">latin1</span><span class="op" id="8292286">)</span><span class="op" id="8292287">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292290">}</span><br>
<span class="lineno"></span><span class="op" id="8292292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8292295">//&nbsp;TestLatin1RoundTrip&nbsp;tests&nbsp;that&nbsp;metadata&nbsp;that&nbsp;is&nbsp;representable&nbsp;in&nbsp;Latin-1</span><br>
<span class="lineno"></span><span class="comment" id="8292371">//&nbsp;survives&nbsp;a&nbsp;round&nbsp;trip.</span><br>
<span class="lineno">110</span><span class="keyword" id="8292397">func</span>&nbsp;<span class="ident" id="8292402">TestLatin1RoundTrip</span><span class="op" id="8292421">(</span><span class="ident" id="8292422">t</span>&nbsp;<span class="op" id="8292424">*</span><span class="ident" id="8292425">testing</span><span class="op" id="8292432">.</span><span class="ident" id="8292433">T</span><span class="op" id="8292434">)</span>&nbsp;<span class="op" id="8292436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292439">testCases</span>&nbsp;<span class="op" id="8292449">:=</span>&nbsp;<span class="op" id="8292452">[</span><span class="op" id="8292453">]</span><span class="keyword" id="8292454">struct</span>&nbsp;<span class="op" id="8292461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292465">name</span>&nbsp;<span class="builtintype" id="8292470">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292479">ok</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8292484">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292490">}</span><span class="op" id="8292491">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292495">{</span><span class="string" id="8292496">&#34;&#34;</span><span class="op" id="8292498">,</span>&nbsp;<span class="builtintype" id="8292500">true</span><span class="op" id="8292504">}</span><span class="op" id="8292505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292509">{</span><span class="string" id="8292510">&#34;ASCII&nbsp;is&nbsp;OK&#34;</span><span class="op" id="8292523">,</span>&nbsp;<span class="builtintype" id="8292525">true</span><span class="op" id="8292529">}</span><span class="op" id="8292530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292534">{</span><span class="string" id="8292535">&#34;unless&nbsp;it&nbsp;contains&nbsp;a&nbsp;NUL\x00&#34;</span><span class="op" id="8292565">,</span>&nbsp;<span class="builtintype" id="8292567">false</span><span class="op" id="8292572">}</span><span class="op" id="8292573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292577">{</span><span class="string" id="8292578">&#34;no&nbsp;matter&nbsp;where&nbsp;\x00&nbsp;occurs&#34;</span><span class="op" id="8292607">,</span>&nbsp;<span class="builtintype" id="8292609">false</span><span class="op" id="8292614">}</span><span class="op" id="8292615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292619">{</span><span class="string" id="8292620">&#34;\x00\x00\x00&#34;</span><span class="op" id="8292634">,</span>&nbsp;<span class="builtintype" id="8292636">false</span><span class="op" id="8292641">}</span><span class="op" id="8292642">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292646">{</span><span class="string" id="8292647">&#34;Látin-1&nbsp;also&nbsp;passes&nbsp;(U+00E1)&#34;</span><span class="op" id="8292678">,</span>&nbsp;<span class="builtintype" id="8292680">true</span><span class="op" id="8292684">}</span><span class="op" id="8292685">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292689">{</span><span class="string" id="8292690">&#34;but&nbsp;LĀtin&nbsp;Extended-A&nbsp;(U+0100)&nbsp;does&nbsp;not&#34;</span><span class="op" id="8292731">,</span>&nbsp;<span class="builtintype" id="8292733">false</span><span class="op" id="8292738">}</span><span class="op" id="8292739">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292743">{</span><span class="string" id="8292744">&#34;neither&nbsp;does&nbsp;日本語&#34;</span><span class="op" id="8292768">,</span>&nbsp;<span class="builtintype" id="8292770">false</span><span class="op" id="8292775">}</span><span class="op" id="8292776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292780">{</span><span class="string" id="8292781">&#34;invalid&nbsp;UTF-8&nbsp;also&nbsp;\xffails&#34;</span><span class="op" id="8292810">,</span>&nbsp;<span class="builtintype" id="8292812">false</span><span class="op" id="8292817">}</span><span class="op" id="8292818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292822">{</span><span class="string" id="8292823">&#34;\x00&nbsp;as&nbsp;does&nbsp;Látin-1&nbsp;with&nbsp;NUL&#34;</span><span class="op" id="8292855">,</span>&nbsp;<span class="builtintype" id="8292857">false</span><span class="op" id="8292862">}</span><span class="op" id="8292863">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292869">for</span>&nbsp;<span class="ident" id="8292873">_</span><span class="op" id="8292874">,</span>&nbsp;<span class="ident" id="8292876">tc</span>&nbsp;<span class="op" id="8292879">:=</span>&nbsp;<span class="keyword" id="8292882">range</span>&nbsp;<span class="ident" id="8292888">testCases</span>&nbsp;<span class="op" id="8292898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292902">buf</span>&nbsp;<span class="op" id="8292906">:=</span>&nbsp;<span class="builtinfunc" id="8292909">new</span><span class="op" id="8292912">(</span><span class="ident" id="8292913">bytes</span><span class="op" id="8292918">.</span><span class="ident" id="8292919">Buffer</span><span class="op" id="8292925">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292930">w</span>&nbsp;<span class="op" id="8292932">:=</span>&nbsp;<span class="ident" id="8292935">NewWriter</span><span class="op" id="8292944">(</span><span class="ident" id="8292945">buf</span><span class="op" id="8292948">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292952">w</span><span class="op" id="8292953">.</span><span class="ident" id="8292954">Name</span>&nbsp;<span class="op" id="8292959">=</span>&nbsp;<span class="ident" id="8292961">tc</span><span class="op" id="8292963">.</span><span class="ident" id="8292964">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292971">err</span>&nbsp;<span class="op" id="8292975">:=</span>&nbsp;<span class="ident" id="8292978">w</span><span class="op" id="8292979">.</span><span class="ident" id="8292980">Close</span><span class="op" id="8292985">(</span><span class="op" id="8292986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292990">if</span>&nbsp;<span class="op" id="8292993">(</span><span class="ident" id="8292994">err</span>&nbsp;<span class="op" id="8292998">==</span>&nbsp;<span class="ident" id="8293001">nil</span><span class="op" id="8293004">)</span>&nbsp;<span class="op" id="8293006">!=</span>&nbsp;<span class="ident" id="8293009">tc</span><span class="op" id="8293011">.</span><span class="ident" id="8293012">ok</span>&nbsp;<span class="op" id="8293015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293020">t</span><span class="op" id="8293021">.</span><span class="ident" id="8293022">Errorf</span><span class="op" id="8293028">(</span><span class="string" id="8293029">&#34;Writer.Close:&nbsp;name&nbsp;=&nbsp;%q,&nbsp;err&nbsp;=&nbsp;%v&#34;</span><span class="op" id="8293064">,</span>&nbsp;<span class="ident" id="8293066">tc</span><span class="op" id="8293068">.</span><span class="ident" id="8293069">name</span><span class="op" id="8293073">,</span>&nbsp;<span class="ident" id="8293075">err</span><span class="op" id="8293078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293083">continue</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293098">if</span>&nbsp;<span class="op" id="8293101">!</span><span class="ident" id="8293102">tc</span><span class="op" id="8293104">.</span><span class="ident" id="8293105">ok</span>&nbsp;<span class="op" id="8293108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293113">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293129">r</span><span class="op" id="8293130">,</span>&nbsp;<span class="ident" id="8293132">err</span>&nbsp;<span class="op" id="8293136">:=</span>&nbsp;<span class="ident" id="8293139">NewReader</span><span class="op" id="8293148">(</span><span class="ident" id="8293149">buf</span><span class="op" id="8293152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293156">if</span>&nbsp;<span class="ident" id="8293159">err</span>&nbsp;<span class="op" id="8293163">!=</span>&nbsp;<span class="ident" id="8293166">nil</span>&nbsp;<span class="op" id="8293170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293175">t</span><span class="op" id="8293176">.</span><span class="ident" id="8293177">Errorf</span><span class="op" id="8293183">(</span><span class="string" id="8293184">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="8293199">,</span>&nbsp;<span class="ident" id="8293201">err</span><span class="op" id="8293204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293209">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293220">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293224">_</span><span class="op" id="8293225">,</span>&nbsp;<span class="ident" id="8293227">err</span>&nbsp;<span class="op" id="8293231">=</span>&nbsp;<span class="ident" id="8293233">ioutil</span><span class="op" id="8293239">.</span><span class="ident" id="8293240">ReadAll</span><span class="op" id="8293247">(</span><span class="ident" id="8293248">r</span><span class="op" id="8293249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293253">if</span>&nbsp;<span class="ident" id="8293256">err</span>&nbsp;<span class="op" id="8293260">!=</span>&nbsp;<span class="ident" id="8293263">nil</span>&nbsp;<span class="op" id="8293267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293272">t</span><span class="op" id="8293273">.</span><span class="ident" id="8293274">Errorf</span><span class="op" id="8293280">(</span><span class="string" id="8293281">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="8293294">,</span>&nbsp;<span class="ident" id="8293296">err</span><span class="op" id="8293299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293304">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293315">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293319">if</span>&nbsp;<span class="ident" id="8293322">r</span><span class="op" id="8293323">.</span><span class="ident" id="8293324">Name</span>&nbsp;<span class="op" id="8293329">!=</span>&nbsp;<span class="ident" id="8293332">tc</span><span class="op" id="8293334">.</span><span class="ident" id="8293335">name</span>&nbsp;<span class="op" id="8293340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293345">t</span><span class="op" id="8293346">.</span><span class="ident" id="8293347">Errorf</span><span class="op" id="8293353">(</span><span class="string" id="8293354">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8293375">,</span>&nbsp;<span class="ident" id="8293377">r</span><span class="op" id="8293378">.</span><span class="ident" id="8293379">Name</span><span class="op" id="8293383">,</span>&nbsp;<span class="ident" id="8293385">tc</span><span class="op" id="8293387">.</span><span class="ident" id="8293388">name</span><span class="op" id="8293392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293397">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293412">if</span>&nbsp;<span class="ident" id="8293415">err</span>&nbsp;<span class="op" id="8293419">:=</span>&nbsp;<span class="ident" id="8293422">r</span><span class="op" id="8293423">.</span><span class="ident" id="8293424">Close</span><span class="op" id="8293429">(</span><span class="op" id="8293430">)</span><span class="op" id="8293431">;</span>&nbsp;<span class="ident" id="8293433">err</span>&nbsp;<span class="op" id="8293437">!=</span>&nbsp;<span class="ident" id="8293440">nil</span>&nbsp;<span class="op" id="8293444">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293449">t</span><span class="op" id="8293450">.</span><span class="ident" id="8293451">Errorf</span><span class="op" id="8293457">(</span><span class="string" id="8293458">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="8293476">,</span>&nbsp;<span class="ident" id="8293478">err</span><span class="op" id="8293481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293486">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293500">}</span><br>
<span class="lineno"></span><span class="op" id="8293502">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="8293505">func</span>&nbsp;<span class="ident" id="8293510">TestWriterFlush</span><span class="op" id="8293525">(</span><span class="ident" id="8293526">t</span>&nbsp;<span class="op" id="8293528">*</span><span class="ident" id="8293529">testing</span><span class="op" id="8293536">.</span><span class="ident" id="8293537">T</span><span class="op" id="8293538">)</span>&nbsp;<span class="op" id="8293540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293543">buf</span>&nbsp;<span class="op" id="8293547">:=</span>&nbsp;<span class="builtinfunc" id="8293550">new</span><span class="op" id="8293553">(</span><span class="ident" id="8293554">bytes</span><span class="op" id="8293559">.</span><span class="ident" id="8293560">Buffer</span><span class="op" id="8293566">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293570">w</span>&nbsp;<span class="op" id="8293572">:=</span>&nbsp;<span class="ident" id="8293575">NewWriter</span><span class="op" id="8293584">(</span><span class="ident" id="8293585">buf</span><span class="op" id="8293588">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293591">w</span><span class="op" id="8293592">.</span><span class="ident" id="8293593">Comment</span>&nbsp;<span class="op" id="8293601">=</span>&nbsp;<span class="string" id="8293603">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293614">w</span><span class="op" id="8293615">.</span><span class="ident" id="8293616">Extra</span>&nbsp;<span class="op" id="8293622">=</span>&nbsp;<span class="op" id="8293624">[</span><span class="op" id="8293625">]</span><span class="builtintype" id="8293626">byte</span><span class="op" id="8293630">(</span><span class="string" id="8293631">&#34;extra&#34;</span><span class="op" id="8293638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293641">w</span><span class="op" id="8293642">.</span><span class="ident" id="8293643">ModTime</span>&nbsp;<span class="op" id="8293651">=</span>&nbsp;<span class="ident" id="8293653">time</span><span class="op" id="8293657">.</span><span class="ident" id="8293658">Unix</span><span class="op" id="8293662">(</span><span class="num" id="8293663">1e8</span><span class="op" id="8293666">,</span>&nbsp;<span class="num" id="8293668">0</span><span class="op" id="8293669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293672">w</span><span class="op" id="8293673">.</span><span class="ident" id="8293674">Name</span>&nbsp;<span class="op" id="8293679">=</span>&nbsp;<span class="string" id="8293681">&#34;name&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293690">n0</span>&nbsp;<span class="op" id="8293693">:=</span>&nbsp;<span class="ident" id="8293696">buf</span><span class="op" id="8293699">.</span><span class="ident" id="8293700">Len</span><span class="op" id="8293703">(</span><span class="op" id="8293704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293707">if</span>&nbsp;<span class="ident" id="8293710">n0</span>&nbsp;<span class="op" id="8293713">!=</span>&nbsp;<span class="num" id="8293716">0</span>&nbsp;<span class="op" id="8293718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293722">t</span><span class="op" id="8293723">.</span><span class="ident" id="8293724">Fatalf</span><span class="op" id="8293730">(</span><span class="string" id="8293731">&#34;buffer&nbsp;size&nbsp;=&nbsp;%d&nbsp;before&nbsp;writes;&nbsp;want&nbsp;0&#34;</span><span class="op" id="8293771">,</span>&nbsp;<span class="ident" id="8293773">n0</span><span class="op" id="8293775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293782">if</span>&nbsp;<span class="ident" id="8293785">err</span>&nbsp;<span class="op" id="8293789">:=</span>&nbsp;<span class="ident" id="8293792">w</span><span class="op" id="8293793">.</span><span class="ident" id="8293794">Flush</span><span class="op" id="8293799">(</span><span class="op" id="8293800">)</span><span class="op" id="8293801">;</span>&nbsp;<span class="ident" id="8293803">err</span>&nbsp;<span class="op" id="8293807">!=</span>&nbsp;<span class="ident" id="8293810">nil</span>&nbsp;<span class="op" id="8293814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293818">t</span><span class="op" id="8293819">.</span><span class="ident" id="8293820">Fatal</span><span class="op" id="8293825">(</span><span class="ident" id="8293826">err</span><span class="op" id="8293829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293836">n1</span>&nbsp;<span class="op" id="8293839">:=</span>&nbsp;<span class="ident" id="8293842">buf</span><span class="op" id="8293845">.</span><span class="ident" id="8293846">Len</span><span class="op" id="8293849">(</span><span class="op" id="8293850">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293853">if</span>&nbsp;<span class="ident" id="8293856">n1</span>&nbsp;<span class="op" id="8293859">==</span>&nbsp;<span class="num" id="8293862">0</span>&nbsp;<span class="op" id="8293864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293868">t</span><span class="op" id="8293869">.</span><span class="ident" id="8293870">Fatal</span><span class="op" id="8293875">(</span><span class="string" id="8293876">&#34;no&nbsp;data&nbsp;after&nbsp;first&nbsp;flush&#34;</span><span class="op" id="8293903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293910">w</span><span class="op" id="8293911">.</span><span class="ident" id="8293912">Write</span><span class="op" id="8293917">(</span><span class="op" id="8293918">[</span><span class="op" id="8293919">]</span><span class="builtintype" id="8293920">byte</span><span class="op" id="8293924">(</span><span class="string" id="8293925">&#34;x&#34;</span><span class="op" id="8293928">)</span><span class="op" id="8293929">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293933">n2</span>&nbsp;<span class="op" id="8293936">:=</span>&nbsp;<span class="ident" id="8293939">buf</span><span class="op" id="8293942">.</span><span class="ident" id="8293943">Len</span><span class="op" id="8293946">(</span><span class="op" id="8293947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293950">if</span>&nbsp;<span class="ident" id="8293953">n1</span>&nbsp;<span class="op" id="8293956">!=</span>&nbsp;<span class="ident" id="8293959">n2</span>&nbsp;<span class="op" id="8293962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293966">t</span><span class="op" id="8293967">.</span><span class="ident" id="8293968">Fatalf</span><span class="op" id="8293974">(</span><span class="string" id="8293975">&#34;after&nbsp;writing&nbsp;a&nbsp;single&nbsp;byte,&nbsp;size&nbsp;changed&nbsp;from&nbsp;%d&nbsp;to&nbsp;%d;&nbsp;want&nbsp;no&nbsp;change&#34;</span><span class="op" id="8294048">,</span>&nbsp;<span class="ident" id="8294050">n1</span><span class="op" id="8294052">,</span>&nbsp;<span class="ident" id="8294054">n2</span><span class="op" id="8294056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294059">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294063">if</span>&nbsp;<span class="ident" id="8294066">err</span>&nbsp;<span class="op" id="8294070">:=</span>&nbsp;<span class="ident" id="8294073">w</span><span class="op" id="8294074">.</span><span class="ident" id="8294075">Flush</span><span class="op" id="8294080">(</span><span class="op" id="8294081">)</span><span class="op" id="8294082">;</span>&nbsp;<span class="ident" id="8294084">err</span>&nbsp;<span class="op" id="8294088">!=</span>&nbsp;<span class="ident" id="8294091">nil</span>&nbsp;<span class="op" id="8294095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294099">t</span><span class="op" id="8294100">.</span><span class="ident" id="8294101">Fatal</span><span class="op" id="8294106">(</span><span class="ident" id="8294107">err</span><span class="op" id="8294110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294117">n3</span>&nbsp;<span class="op" id="8294120">:=</span>&nbsp;<span class="ident" id="8294123">buf</span><span class="op" id="8294126">.</span><span class="ident" id="8294127">Len</span><span class="op" id="8294130">(</span><span class="op" id="8294131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294134">if</span>&nbsp;<span class="ident" id="8294137">n2</span>&nbsp;<span class="op" id="8294140">==</span>&nbsp;<span class="ident" id="8294143">n3</span>&nbsp;<span class="op" id="8294146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294150">t</span><span class="op" id="8294151">.</span><span class="ident" id="8294152">Fatal</span><span class="op" id="8294157">(</span><span class="string" id="8294158">&#34;Flush&nbsp;didn&#39;t&nbsp;flush&nbsp;any&nbsp;data&#34;</span><span class="op" id="8294187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294190">}</span><br>
<span class="lineno"></span><span class="op" id="8294192">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="8294195">//&nbsp;Multiple&nbsp;gzip&nbsp;files&nbsp;concatenated&nbsp;form&nbsp;a&nbsp;valid&nbsp;gzip&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="8294255">func</span>&nbsp;<span class="ident" id="8294260">TestConcat</span><span class="op" id="8294270">(</span><span class="ident" id="8294271">t</span>&nbsp;<span class="op" id="8294273">*</span><span class="ident" id="8294274">testing</span><span class="op" id="8294281">.</span><span class="ident" id="8294282">T</span><span class="op" id="8294283">)</span>&nbsp;<span class="op" id="8294285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294288">var</span>&nbsp;<span class="ident" id="8294292">buf</span>&nbsp;<span class="ident" id="8294296">bytes</span><span class="op" id="8294301">.</span><span class="ident" id="8294302">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294310">w</span>&nbsp;<span class="op" id="8294312">:=</span>&nbsp;<span class="ident" id="8294315">NewWriter</span><span class="op" id="8294324">(</span><span class="op" id="8294325">&amp;</span><span class="ident" id="8294326">buf</span><span class="op" id="8294329">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294332">w</span><span class="op" id="8294333">.</span><span class="ident" id="8294334">Write</span><span class="op" id="8294339">(</span><span class="op" id="8294340">[</span><span class="op" id="8294341">]</span><span class="builtintype" id="8294342">byte</span><span class="op" id="8294346">(</span><span class="string" id="8294347">&#34;hello&nbsp;&#34;</span><span class="op" id="8294355">)</span><span class="op" id="8294356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294359">w</span><span class="op" id="8294360">.</span><span class="ident" id="8294361">Close</span><span class="op" id="8294366">(</span><span class="op" id="8294367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294370">w</span>&nbsp;<span class="op" id="8294372">=</span>&nbsp;<span class="ident" id="8294374">NewWriter</span><span class="op" id="8294383">(</span><span class="op" id="8294384">&amp;</span><span class="ident" id="8294385">buf</span><span class="op" id="8294388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294391">w</span><span class="op" id="8294392">.</span><span class="ident" id="8294393">Write</span><span class="op" id="8294398">(</span><span class="op" id="8294399">[</span><span class="op" id="8294400">]</span><span class="builtintype" id="8294401">byte</span><span class="op" id="8294405">(</span><span class="string" id="8294406">&#34;world\n&#34;</span><span class="op" id="8294415">)</span><span class="op" id="8294416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294419">w</span><span class="op" id="8294420">.</span><span class="ident" id="8294421">Close</span><span class="op" id="8294426">(</span><span class="op" id="8294427">)</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294431">r</span><span class="op" id="8294432">,</span>&nbsp;<span class="ident" id="8294434">err</span>&nbsp;<span class="op" id="8294438">:=</span>&nbsp;<span class="ident" id="8294441">NewReader</span><span class="op" id="8294450">(</span><span class="op" id="8294451">&amp;</span><span class="ident" id="8294452">buf</span><span class="op" id="8294455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294458">data</span><span class="op" id="8294462">,</span>&nbsp;<span class="ident" id="8294464">err</span>&nbsp;<span class="op" id="8294468">:=</span>&nbsp;<span class="ident" id="8294471">ioutil</span><span class="op" id="8294477">.</span><span class="ident" id="8294478">ReadAll</span><span class="op" id="8294485">(</span><span class="ident" id="8294486">r</span><span class="op" id="8294487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294490">if</span>&nbsp;<span class="builtintype" id="8294493">string</span><span class="op" id="8294499">(</span><span class="ident" id="8294500">data</span><span class="op" id="8294504">)</span>&nbsp;<span class="op" id="8294506">!=</span>&nbsp;<span class="string" id="8294509">&#34;hello&nbsp;world\n&#34;</span>&nbsp;<span class="op" id="8294525">||</span>&nbsp;<span class="ident" id="8294528">err</span>&nbsp;<span class="op" id="8294532">!=</span>&nbsp;<span class="ident" id="8294535">nil</span>&nbsp;<span class="op" id="8294539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294543">t</span><span class="op" id="8294544">.</span><span class="ident" id="8294545">Fatalf</span><span class="op" id="8294551">(</span><span class="string" id="8294552">&#34;ReadAll&nbsp;=&nbsp;%q,&nbsp;%v,&nbsp;want&nbsp;%q,&nbsp;nil&#34;</span><span class="op" id="8294584">,</span>&nbsp;<span class="ident" id="8294586">data</span><span class="op" id="8294590">,</span>&nbsp;<span class="ident" id="8294592">err</span><span class="op" id="8294595">,</span>&nbsp;<span class="string" id="8294597">&#34;hello&nbsp;world&#34;</span><span class="op" id="8294610">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294613">}</span><br>
<span class="lineno"></span><span class="op" id="8294615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8294618">func</span>&nbsp;<span class="ident" id="8294623">TestWriterReset</span><span class="op" id="8294638">(</span><span class="ident" id="8294639">t</span>&nbsp;<span class="op" id="8294641">*</span><span class="ident" id="8294642">testing</span><span class="op" id="8294649">.</span><span class="ident" id="8294650">T</span><span class="op" id="8294651">)</span>&nbsp;<span class="op" id="8294653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294656">buf</span>&nbsp;<span class="op" id="8294660">:=</span>&nbsp;<span class="builtinfunc" id="8294663">new</span><span class="op" id="8294666">(</span><span class="ident" id="8294667">bytes</span><span class="op" id="8294672">.</span><span class="ident" id="8294673">Buffer</span><span class="op" id="8294679">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294682">buf2</span>&nbsp;<span class="op" id="8294687">:=</span>&nbsp;<span class="builtinfunc" id="8294690">new</span><span class="op" id="8294693">(</span><span class="ident" id="8294694">bytes</span><span class="op" id="8294699">.</span><span class="ident" id="8294700">Buffer</span><span class="op" id="8294706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294709">z</span>&nbsp;<span class="op" id="8294711">:=</span>&nbsp;<span class="ident" id="8294714">NewWriter</span><span class="op" id="8294723">(</span><span class="ident" id="8294724">buf</span><span class="op" id="8294727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294730">msg</span>&nbsp;<span class="op" id="8294734">:=</span>&nbsp;<span class="op" id="8294737">[</span><span class="op" id="8294738">]</span><span class="builtintype" id="8294739">byte</span><span class="op" id="8294743">(</span><span class="string" id="8294744">&#34;hello&nbsp;world&#34;</span><span class="op" id="8294757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294760">z</span><span class="op" id="8294761">.</span><span class="ident" id="8294762">Write</span><span class="op" id="8294767">(</span><span class="ident" id="8294768">msg</span><span class="op" id="8294771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294774">z</span><span class="op" id="8294775">.</span><span class="ident" id="8294776">Close</span><span class="op" id="8294781">(</span><span class="op" id="8294782">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294785">z</span><span class="op" id="8294786">.</span><span class="ident" id="8294787">Reset</span><span class="op" id="8294792">(</span><span class="ident" id="8294793">buf2</span><span class="op" id="8294797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294800">z</span><span class="op" id="8294801">.</span><span class="ident" id="8294802">Write</span><span class="op" id="8294807">(</span><span class="ident" id="8294808">msg</span><span class="op" id="8294811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294814">z</span><span class="op" id="8294815">.</span><span class="ident" id="8294816">Close</span><span class="op" id="8294821">(</span><span class="op" id="8294822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294825">if</span>&nbsp;<span class="ident" id="8294828">buf</span><span class="op" id="8294831">.</span><span class="ident" id="8294832">String</span><span class="op" id="8294838">(</span><span class="op" id="8294839">)</span>&nbsp;<span class="op" id="8294841">!=</span>&nbsp;<span class="ident" id="8294844">buf2</span><span class="op" id="8294848">.</span><span class="ident" id="8294849">String</span><span class="op" id="8294855">(</span><span class="op" id="8294856">)</span>&nbsp;<span class="op" id="8294858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294862">t</span><span class="op" id="8294863">.</span><span class="ident" id="8294864">Errorf</span><span class="op" id="8294870">(</span><span class="string" id="8294871">&#34;buf2&nbsp;%q&nbsp;!=&nbsp;original&nbsp;buf&nbsp;of&nbsp;%q&#34;</span><span class="op" id="8294902">,</span>&nbsp;<span class="ident" id="8294904">buf2</span><span class="op" id="8294908">.</span><span class="ident" id="8294909">String</span><span class="op" id="8294915">(</span><span class="op" id="8294916">)</span><span class="op" id="8294917">,</span>&nbsp;<span class="ident" id="8294919">buf</span><span class="op" id="8294922">.</span><span class="ident" id="8294923">String</span><span class="op" id="8294929">(</span><span class="op" id="8294930">)</span><span class="op" id="8294931">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294934">}</span><br>
<span class="lineno"></span><span class="op" id="8294936">}</span>
</div>
</body>
</html>
