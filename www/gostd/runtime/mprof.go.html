<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html" class="current">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1619335">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1619390">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1619444">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1619495">//&nbsp;Malloc&nbsp;profiling.</span><br>
<span class="lineno"></span><span class="comment" id="1619516">//&nbsp;Patterned&nbsp;after&nbsp;tcmalloc&#39;s&nbsp;algorithms;&nbsp;shorter&nbsp;code.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1619573">package</span>&nbsp;<span class="ident" id="1619581">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="1619590">import</span>&nbsp;<span class="op" id="1619597">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1619600">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1619609">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1619612">//&nbsp;NOTE(rsc):&nbsp;Everything&nbsp;here&nbsp;could&nbsp;use&nbsp;cas&nbsp;if&nbsp;contention&nbsp;became&nbsp;an&nbsp;issue.</span><br>
<span class="lineno">15</span><span class="keyword" id="1619687">var</span>&nbsp;<span class="ident" id="1619691">proflock</span>&nbsp;<span class="ident" id="1619700"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786208">mutex</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1619707">//&nbsp;All&nbsp;memory&nbsp;allocations&nbsp;are&nbsp;local&nbsp;and&nbsp;do&nbsp;not&nbsp;escape&nbsp;outside&nbsp;of&nbsp;the&nbsp;profiler.</span><br>
<span class="lineno"></span><span class="comment" id="1619786">//&nbsp;The&nbsp;profiler&nbsp;is&nbsp;forbidden&nbsp;from&nbsp;referring&nbsp;to&nbsp;garbage-collected&nbsp;memory.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="1619860">const</span>&nbsp;<span class="op" id="1619866">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1619869">//&nbsp;profile&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619887">memProfile</span>&nbsp;<span class="ident" id="1619898"><a href="/gostd/runtime/mprof.go.html#1620055">bucketType</a></span>&nbsp;<span class="op" id="1619909">=</span>&nbsp;<span class="num" id="1619911">1</span>&nbsp;<span class="op" id="1619913">+</span>&nbsp;<span class="ident" id="1619915">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619921">blockProfile</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1619936">//&nbsp;size&nbsp;of&nbsp;bucket&nbsp;hash&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619966">buckHashSize</span>&nbsp;<span class="op" id="1619979">=</span>&nbsp;<span class="num" id="1619981">179999</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1619990">//&nbsp;max&nbsp;depth&nbsp;of&nbsp;stack&nbsp;to&nbsp;record&nbsp;in&nbsp;bucket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620033">maxStack</span>&nbsp;<span class="op" id="1620042">=</span>&nbsp;<span class="num" id="1620044">32</span><br>
<span class="lineno">30</span><span class="op" id="1620047">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1620050">type</span>&nbsp;<span class="ident" id="1620055">bucketType</span>&nbsp;<span class="builtintype" id="1620066">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1620071">//&nbsp;A&nbsp;bucket&nbsp;holds&nbsp;per-call-stack&nbsp;profiling&nbsp;information.</span><br>
<span class="lineno">35</span><span class="comment" id="1620127">//&nbsp;The&nbsp;representation&nbsp;is&nbsp;a&nbsp;bit&nbsp;sleazy,&nbsp;inherited&nbsp;from&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="1620184">//&nbsp;This&nbsp;struct&nbsp;defines&nbsp;the&nbsp;bucket&nbsp;header.&nbsp;It&nbsp;is&nbsp;followed&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1620244">//&nbsp;memory&nbsp;by&nbsp;the&nbsp;stack&nbsp;words&nbsp;and&nbsp;then&nbsp;the&nbsp;actual&nbsp;record</span><br>
<span class="lineno"></span><span class="comment" id="1620300">//&nbsp;data,&nbsp;either&nbsp;a&nbsp;memRecord&nbsp;or&nbsp;a&nbsp;blockRecord.</span><br>
<span class="lineno"></span><span class="comment" id="1620346">//</span><br>
<span class="lineno">40</span><span class="comment" id="1620349">//&nbsp;Per-call-stack&nbsp;profiling&nbsp;information.</span><br>
<span class="lineno"></span><span class="comment" id="1620390">//&nbsp;Lookup&nbsp;by&nbsp;hashing&nbsp;call&nbsp;stack&nbsp;into&nbsp;a&nbsp;linked-list&nbsp;hash&nbsp;table.</span><br>
<span class="lineno"></span><span class="keyword" id="1620453">type</span>&nbsp;<span class="ident" id="1620458">bucket</span>&nbsp;<span class="keyword" id="1620465">struct</span>&nbsp;<span class="op" id="1620472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620475">next</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1620483">*</span><span class="ident" id="1620484"><a href="/gostd/runtime/mprof.go.html#1620458">bucket</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620492">allnext</span>&nbsp;<span class="op" id="1620500">*</span><span class="ident" id="1620501"><a href="/gostd/runtime/mprof.go.html#1620458">bucket</a></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620509">typ</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620517"><a href="/gostd/runtime/mprof.go.html#1620055">bucketType</a></span>&nbsp;<span class="comment" id="1620528">//&nbsp;memBucket&nbsp;or&nbsp;blockBucket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620557">hash</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1620565">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620574">size</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1620582">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620591">nstk</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1620599">uintptr</span><br>
<span class="lineno"></span><span class="op" id="1620607">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="1620610">//&nbsp;A&nbsp;memRecord&nbsp;is&nbsp;the&nbsp;bucket&nbsp;data&nbsp;for&nbsp;a&nbsp;bucket&nbsp;of&nbsp;type&nbsp;memProfile,</span><br>
<span class="lineno"></span><span class="comment" id="1620677">//&nbsp;part&nbsp;of&nbsp;the&nbsp;memory&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="1620708">type</span>&nbsp;<span class="ident" id="1620713">memRecord</span>&nbsp;<span class="keyword" id="1620723">struct</span>&nbsp;<span class="op" id="1620730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1620733">//&nbsp;The&nbsp;following&nbsp;complex&nbsp;3-stage&nbsp;scheme&nbsp;of&nbsp;stats&nbsp;accumulation</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1620796">//&nbsp;is&nbsp;required&nbsp;to&nbsp;obtain&nbsp;a&nbsp;consistent&nbsp;picture&nbsp;of&nbsp;mallocs&nbsp;and&nbsp;frees</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1620864">//&nbsp;for&nbsp;some&nbsp;point&nbsp;in&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1620892">//&nbsp;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;mallocs&nbsp;come&nbsp;in&nbsp;real&nbsp;time,&nbsp;while&nbsp;frees</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1620955">//&nbsp;come&nbsp;only&nbsp;after&nbsp;a&nbsp;GC&nbsp;during&nbsp;concurrent&nbsp;sweeping.&nbsp;So&nbsp;if&nbsp;we&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621023">//&nbsp;naively&nbsp;count&nbsp;them,&nbsp;we&nbsp;would&nbsp;get&nbsp;a&nbsp;skew&nbsp;toward&nbsp;mallocs.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621083">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621087">//&nbsp;Mallocs&nbsp;are&nbsp;accounted&nbsp;in&nbsp;recent&nbsp;stats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621130">//&nbsp;Explicit&nbsp;frees&nbsp;are&nbsp;accounted&nbsp;in&nbsp;recent&nbsp;stats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621180">//&nbsp;GC&nbsp;frees&nbsp;are&nbsp;accounted&nbsp;in&nbsp;prev&nbsp;stats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621222">//&nbsp;After&nbsp;GC&nbsp;prev&nbsp;stats&nbsp;are&nbsp;added&nbsp;to&nbsp;final&nbsp;stats&nbsp;and</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621275">//&nbsp;recent&nbsp;stats&nbsp;are&nbsp;moved&nbsp;into&nbsp;prev&nbsp;stats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621319">allocs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1621331">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621340">frees</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1621352">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621361">alloc_bytes</span>&nbsp;<span class="builtintype" id="1621373">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621382">free_bytes</span>&nbsp;&nbsp;<span class="builtintype" id="1621394">uintptr</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621404">//&nbsp;changes&nbsp;between&nbsp;next-to-last&nbsp;GC&nbsp;and&nbsp;last&nbsp;GC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621452">prev_allocs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1621469">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621478">prev_frees</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1621495">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621504">prev_alloc_bytes</span>&nbsp;<span class="builtintype" id="1621521">uintptr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621530">prev_free_bytes</span>&nbsp;&nbsp;<span class="builtintype" id="1621547">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621557">//&nbsp;changes&nbsp;since&nbsp;last&nbsp;GC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621583">recent_allocs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1621602">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621611">recent_frees</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1621630">uintptr</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621639">recent_alloc_bytes</span>&nbsp;<span class="builtintype" id="1621658">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621667">recent_free_bytes</span>&nbsp;&nbsp;<span class="builtintype" id="1621686">uintptr</span><br>
<span class="lineno"></span><span class="op" id="1621694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1621697">//&nbsp;A&nbsp;blockRecord&nbsp;is&nbsp;the&nbsp;bucket&nbsp;data&nbsp;for&nbsp;a&nbsp;bucket&nbsp;of&nbsp;type&nbsp;blockProfile,</span><br>
<span class="lineno">85</span><span class="comment" id="1621768">//&nbsp;part&nbsp;of&nbsp;the&nbsp;blocking&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="1621801">type</span>&nbsp;<span class="ident" id="1621806">blockRecord</span>&nbsp;<span class="keyword" id="1621818">struct</span>&nbsp;<span class="op" id="1621825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621828">count</span>&nbsp;&nbsp;<span class="builtintype" id="1621835">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621842">cycles</span>&nbsp;<span class="builtintype" id="1621849">int64</span><br>
<span class="lineno"></span><span class="op" id="1621855">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="1621858">var</span>&nbsp;<span class="op" id="1621862">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621865">mbuckets</span>&nbsp;&nbsp;<span class="op" id="1621875">*</span><span class="ident" id="1621876"><a href="/gostd/runtime/mprof.go.html#1620458">bucket</a></span>&nbsp;<span class="comment" id="1621883">//&nbsp;memory&nbsp;profile&nbsp;buckets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621910">bbuckets</span>&nbsp;&nbsp;<span class="op" id="1621920">*</span><span class="ident" id="1621921"><a href="/gostd/runtime/mprof.go.html#1620458">bucket</a></span>&nbsp;<span class="comment" id="1621928">//&nbsp;blocking&nbsp;profile&nbsp;buckets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621957">buckhash</span>&nbsp;&nbsp;<span class="op" id="1621967">*</span><span class="op" id="1621968">[</span><span class="num" id="1621969">179999</span><span class="op" id="1621975">]</span><span class="op" id="1621976">*</span><span class="ident" id="1621977"><a href="/gostd/runtime/mprof.go.html#1620458">bucket</a></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621985">bucketmem</span>&nbsp;<span class="builtintype" id="1621995">uintptr</span><br>
<span class="lineno"></span><span class="op" id="1622003">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1622006">//&nbsp;newBucket&nbsp;allocates&nbsp;a&nbsp;bucket&nbsp;with&nbsp;the&nbsp;given&nbsp;type&nbsp;and&nbsp;number&nbsp;of&nbsp;stack&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="1622087">func</span>&nbsp;<span class="ident" id="1622092">newBucket</span><span class="op" id="1622101">(</span><span class="ident" id="1622102">typ</span>&nbsp;<span class="ident" id="1622106"><a href="/gostd/runtime/mprof.go.html#1620055">bucketType</a></span><span class="op" id="1622116">,</span>&nbsp;<span class="ident" id="1622118">nstk</span>&nbsp;<span class="builtintype" id="1622123">int</span><span class="op" id="1622126">)</span>&nbsp;<span class="op" id="1622128">*</span><span class="ident" id="1622129"><a href="/gostd/runtime/mprof.go.html#1620458">bucket</a></span>&nbsp;<span class="op" id="1622136">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1622139">size</span>&nbsp;<span class="op" id="1622144">:=</span>&nbsp;<span class="ident" id="1622147"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1622153">.</span><span class="ident" id="1622154">Sizeof</span><span class="op" id="1622160">(</span><span class="ident" id="1622161"><a href="/gostd/runtime/mprof.go.html#1620458">bucket</a></span><span class="op" id="1622167">{</span><span class="op" id="1622168">}</span><span class="op" id="1622169">)</span>&nbsp;<span class="op" id="1622171">+</span>&nbsp;<span class="builtintype" id="1622173">uintptr</span><span class="op" id="1622180">(</span><span class="ident" id="1622181"><a href="/gostd/runtime/mprof.go.html#1622118">nstk</a></span><span class="op" id="1622185">)</span><span class="op" id="1622186">*</span><span class="ident" id="1622187"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1622193">.</span><span class="ident" id="1622194">Sizeof</span><span class="op" id="1622200">(</span><span class="builtintype" id="1622201">uintptr</span><span class="op" id="1622208">(</span><span class="num" id="1622209">0</span><span class="op" id="1622210">)</span><span class="op" id="1622211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1622214">switch</span>&nbsp;<span class="ident" id="1622221"><a href="/gostd/runtime/mprof.go.html#1622102">typ</a></span>&nbsp;<span class="op" id="1622225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1622228">default</span><span class="op" id="1622235">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1622239"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1622246">(</span><span class="string" id="1622247">&#34;invalid&nbsp;profile&nbsp;bucket&nbsp;type&#34;</span><span class="op" id="1622276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1622279">case</span>&nbsp;<span class="ident" id="1622284"><a href="/gostd/runtime/mprof.go.html#1619887">memProfile</a></span><span class="op" id="1622294">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1622298"><a href="/gostd/runtime/mprof.go.html#1622139">size</a></span>&nbsp;<span class="op" id="1622303">+=</span>&nbsp;<span class="ident" id="1622306"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1622312">.</span><span class="ident" id="1622313">Sizeof</span><span class="op" id="1622319">(</span><span class="ident" id="1622320"><a href="/gostd/runtime/mprof.go.html#1620713">memRecord</a></span><span class="op" id="1622329">{</span><span class="op" id="1622330">}</span><span class="op" id="1622331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1622334">case</span>&nbsp;<span class="ident" id="1622339"><a href="/gostd/runtime/mprof.go.html#1619921">blockProfile</a></span><span class="op" id="1622351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1622355"><a href="/gostd/runtime/mprof.go.html#1622139">size</a></span>&nbsp;<span class="op" id="1622360">+=</span>&nbsp;<span class="ident" id="1622363"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1622369">.</span><span class="ident" id="1622370">Sizeof</span><span class="op" id="1622376">(</span><span class="ident" id="1622377"><a href="/gostd/runtime/mprof.go.html#1621806">blockRecord</a></span><span class="op" id="1622388">{</span><span class="op" id="1622389">}</span><span class="op" id="1622390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1622393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1622397">b</span>&nbsp;<span class="op" id="1622399">:=</span>&nbsp;<span class="op" id="1622402">(</span><span class="op" id="1622403">*</span><span class="ident" id="1622404"><a href="/gostd/runtime/mprof.go.html#1620458">bucket</a></span><span class="op" id="1622410">)</span><span class="op" id="1622411">(</span><span class="ident" id="1622412"><a href="/gostd/runtime/malloc.go.html#1612082">persistentalloc</a></span><span class="op" id="1622427">(</span><span class="ident" id="1622428"><a href="/gostd/runtime/mprof.go.html#1622139">size</a></span><span class="op" id="1622432">,</span>&nbsp;<span class="num" id="1622434">0</span><span class="op" id="1622435">,</span>&nbsp;<span class="op" id="1622437">&amp;</span><span class="ident" id="1622438"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793070">memstats</a></span><span class="op" id="1622446">.</span><span class="ident" id="1622447"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1792822">buckhash_sys</a></span><span class="op" id="1622459">)</span><span class="op" id="1622460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1622463"><a href="/gostd/runtime/mprof.go.html#1621985">bucketmem</a></span>&nbsp;<span class="op" id="1622473">+=</span>&nbsp;<span class="ident" id="1622476"><a href="/gostd/runtime/mprof.go.html#1622139">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1622482"><a href="/gostd/runtime/mprof.go.html#1622397">b</a></span><span class="op" id="1622483">.</span><span class="ident" id="1622484"><a href="/gostd/runtime/mprof.go.html#1620509">typ</a></span>&nbsp;<span class="op" id="1622488">=</span>&nbsp;<span class="ident" id="1622490"><a href="/gostd/runtime/mprof.go.html#1622102">typ</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1622495"><a href="/gostd/runtime/mprof.go.html#1622397">b</a></span><span class="op" id="1622496">.</span><span class="ident" id="1622497"><a href="/gostd/runtime/mprof.go.html#1620591">nstk</a></span>&nbsp;<span class="op" id="1622502">=</span>&nbsp;<span class="builtintype" id="1622504">uintptr</span><span class="op" id="1622511">(</span><span class="ident" id="1622512"><a href="/gostd/runtime/mprof.go.html#1622118">nstk</a></span><span class="op" id="1622516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1622519">return</span>&nbsp;<span class="ident" id="1622526"><a href="/gostd/runtime/mprof.go.html#1622397">b</a></span><br>
<span class="lineno">115</span><span class="op" id="1622528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1622531">//&nbsp;stk&nbsp;returns&nbsp;the&nbsp;slice&nbsp;in&nbsp;b&nbsp;holding&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="1622580">func</span>&nbsp;<span class="op" id="1622585">(</span><span class="ident" id="1622586">b</span>&nbsp;<span class="op" id="1622588">*</span><span class="ident" id="1622589"><a href="/gostd/runtime/mprof.go.html#1620458">bucket</a></span><span class="op" id="1622595">)</span>&nbsp;<span class="ident" id="1622597">stk</span><span class="op" id="1622600">(</span><span class="op" id="1622601">)</span>&nbsp;<span class="op" id="1622603">[</span><span class="op" id="1622604">]</span><span class="builtintype" id="1622605">uintptr</span>&nbsp;<span class="op" id="1622613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1622616">stk</span>&nbsp;<span class="op" id="1622620">:=</span>&nbsp;<span class="op" id="1622623">(</span><span class="op" id="1622624">*</span><span class="op" id="1622625">[</span><span class="ident" id="1622626"><a href="/gostd/runtime/mprof.go.html#1620033">maxStack</a></span><span class="op" id="1622634">]</span><span class="builtintype" id="1622635">uintptr</span><span class="op" id="1622642">)</span><span class="op" id="1622643">(</span><span class="ident" id="1622644"><a href="/gostd/runtime/stubs.go.html#1738643">add</a></span><span class="op" id="1622647">(</span><span class="ident" id="1622648"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1622654">.</span><span class="ident" id="1622655">Pointer</span><span class="op" id="1622662">(</span><span class="ident" id="1622663"><a href="/gostd/runtime/mprof.go.html#1622586">b</a></span><span class="op" id="1622664">)</span><span class="op" id="1622665">,</span>&nbsp;<span class="ident" id="1622667"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1622673">.</span><span class="ident" id="1622674">Sizeof</span><span class="op" id="1622680">(</span><span class="op" id="1622681">*</span><span class="ident" id="1622682"><a href="/gostd/runtime/mprof.go.html#1622586">b</a></span><span class="op" id="1622683">)</span><span class="op" id="1622684">)</span><span class="op" id="1622685">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1622688">return</span>&nbsp;<span class="ident" id="1622695"><a href="/gostd/runtime/mprof.go.html#1622616">stk</a></span><span class="op" id="1622698">[</span><span class="op" id="1622699">:</span><span class="ident" id="1622700"><a href="/gostd/runtime/mprof.go.html#1622586">b</a></span><span class="op" id="1622701">.</span><span class="ident" id="1622702"><a href="/gostd/runtime/mprof.go.html#1620591">nstk</a></span><span class="op" id="1622706">:</span><span class="ident" id="1622707"><a href="/gostd/runtime/mprof.go.html#1622586">b</a></span><span class="op" id="1622708">.</span><span class="ident" id="1622709"><a href="/gostd/runtime/mprof.go.html#1620591">nstk</a></span><span class="op" id="1622713">]</span><br>
<span class="lineno"></span><span class="op" id="1622715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1622718">//&nbsp;mp&nbsp;returns&nbsp;the&nbsp;memRecord&nbsp;associated&nbsp;with&nbsp;the&nbsp;memProfile&nbsp;bucket&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="1622787">func</span>&nbsp;<span class="op" id="1622792">(</span><span class="ident" id="1622793">b</span>&nbsp;<span class="op" id="1622795">*</span><span class="ident" id="1622796"><a href="/gostd/runtime/mprof.go.html#1620458">bucket</a></span><span class="op" id="1622802">)</span>&nbsp;<span class="ident" id="1622804">mp</span><span class="op" id="1622806">(</span><span class="op" id="1622807">)</span>&nbsp;<span class="op" id="1622809">*</span><span class="ident" id="1622810"><a href="/gostd/runtime/mprof.go.html#1620713">memRecord</a></span>&nbsp;<span class="op" id="1622820">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1622823">if</span>&nbsp;<span class="ident" id="1622826"><a href="/gostd/runtime/mprof.go.html#1622793">b</a></span><span class="op" id="1622827">.</span><span class="ident" id="1622828"><a href="/gostd/runtime/mprof.go.html#1620509">typ</a></span>&nbsp;<span class="op" id="1622832">!=</span>&nbsp;<span class="ident" id="1622835"><a href="/gostd/runtime/mprof.go.html#1619887">memProfile</a></span>&nbsp;<span class="op" id="1622846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1622850"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1622857">(</span><span class="string" id="1622858">&#34;bad&nbsp;use&nbsp;of&nbsp;bucket.mp&#34;</span><span class="op" id="1622880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1622883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1622886">data</span>&nbsp;<span class="op" id="1622891">:=</span>&nbsp;<span class="ident" id="1622894"><a href="/gostd/runtime/stubs.go.html#1738643">add</a></span><span class="op" id="1622897">(</span><span class="ident" id="1622898"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1622904">.</span><span class="ident" id="1622905">Pointer</span><span class="op" id="1622912">(</span><span class="ident" id="1622913"><a href="/gostd/runtime/mprof.go.html#1622793">b</a></span><span class="op" id="1622914">)</span><span class="op" id="1622915">,</span>&nbsp;<span class="ident" id="1622917"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1622923">.</span><span class="ident" id="1622924">Sizeof</span><span class="op" id="1622930">(</span><span class="op" id="1622931">*</span><span class="ident" id="1622932"><a href="/gostd/runtime/mprof.go.html#1622793">b</a></span><span class="op" id="1622933">)</span><span class="op" id="1622934">+</span><span class="ident" id="1622935"><a href="/gostd/runtime/mprof.go.html#1622793">b</a></span><span class="op" id="1622936">.</span><span class="ident" id="1622937"><a href="/gostd/runtime/mprof.go.html#1620591">nstk</a></span><span class="op" id="1622941">*</span><span class="ident" id="1622942"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1622948">.</span><span class="ident" id="1622949">Sizeof</span><span class="op" id="1622955">(</span><span class="builtintype" id="1622956">uintptr</span><span class="op" id="1622963">(</span><span class="num" id="1622964">0</span><span class="op" id="1622965">)</span><span class="op" id="1622966">)</span><span class="op" id="1622967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1622970">return</span>&nbsp;<span class="op" id="1622977">(</span><span class="op" id="1622978">*</span><span class="ident" id="1622979"><a href="/gostd/runtime/mprof.go.html#1620713">memRecord</a></span><span class="op" id="1622988">)</span><span class="op" id="1622989">(</span><span class="ident" id="1622990"><a href="/gostd/runtime/mprof.go.html#1622886">data</a></span><span class="op" id="1622994">)</span><br>
<span class="lineno">130</span><span class="op" id="1622996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1622999">//&nbsp;bp&nbsp;returns&nbsp;the&nbsp;blockRecord&nbsp;associated&nbsp;with&nbsp;the&nbsp;blockProfile&nbsp;bucket&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="1623072">func</span>&nbsp;<span class="op" id="1623077">(</span><span class="ident" id="1623078">b</span>&nbsp;<span class="op" id="1623080">*</span><span class="ident" id="1623081"><a href="/gostd/runtime/mprof.go.html#1620458">bucket</a></span><span class="op" id="1623087">)</span>&nbsp;<span class="ident" id="1623089">bp</span><span class="op" id="1623091">(</span><span class="op" id="1623092">)</span>&nbsp;<span class="op" id="1623094">*</span><span class="ident" id="1623095"><a href="/gostd/runtime/mprof.go.html#1621806">blockRecord</a></span>&nbsp;<span class="op" id="1623107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623110">if</span>&nbsp;<span class="ident" id="1623113"><a href="/gostd/runtime/mprof.go.html#1623078">b</a></span><span class="op" id="1623114">.</span><span class="ident" id="1623115"><a href="/gostd/runtime/mprof.go.html#1620509">typ</a></span>&nbsp;<span class="op" id="1623119">!=</span>&nbsp;<span class="ident" id="1623122"><a href="/gostd/runtime/mprof.go.html#1619921">blockProfile</a></span>&nbsp;<span class="op" id="1623135">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623139"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1623146">(</span><span class="string" id="1623147">&#34;bad&nbsp;use&nbsp;of&nbsp;bucket.bp&#34;</span><span class="op" id="1623169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1623172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623175">data</span>&nbsp;<span class="op" id="1623180">:=</span>&nbsp;<span class="ident" id="1623183"><a href="/gostd/runtime/stubs.go.html#1738643">add</a></span><span class="op" id="1623186">(</span><span class="ident" id="1623187"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1623193">.</span><span class="ident" id="1623194">Pointer</span><span class="op" id="1623201">(</span><span class="ident" id="1623202"><a href="/gostd/runtime/mprof.go.html#1623078">b</a></span><span class="op" id="1623203">)</span><span class="op" id="1623204">,</span>&nbsp;<span class="ident" id="1623206"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1623212">.</span><span class="ident" id="1623213">Sizeof</span><span class="op" id="1623219">(</span><span class="op" id="1623220">*</span><span class="ident" id="1623221"><a href="/gostd/runtime/mprof.go.html#1623078">b</a></span><span class="op" id="1623222">)</span><span class="op" id="1623223">+</span><span class="ident" id="1623224"><a href="/gostd/runtime/mprof.go.html#1623078">b</a></span><span class="op" id="1623225">.</span><span class="ident" id="1623226"><a href="/gostd/runtime/mprof.go.html#1620591">nstk</a></span><span class="op" id="1623230">*</span><span class="ident" id="1623231"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1623237">.</span><span class="ident" id="1623238">Sizeof</span><span class="op" id="1623244">(</span><span class="builtintype" id="1623245">uintptr</span><span class="op" id="1623252">(</span><span class="num" id="1623253">0</span><span class="op" id="1623254">)</span><span class="op" id="1623255">)</span><span class="op" id="1623256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623259">return</span>&nbsp;<span class="op" id="1623266">(</span><span class="op" id="1623267">*</span><span class="ident" id="1623268"><a href="/gostd/runtime/mprof.go.html#1621806">blockRecord</a></span><span class="op" id="1623279">)</span><span class="op" id="1623280">(</span><span class="ident" id="1623281"><a href="/gostd/runtime/mprof.go.html#1623175">data</a></span><span class="op" id="1623285">)</span><br>
<span class="lineno"></span><span class="op" id="1623287">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="1623290">//&nbsp;Return&nbsp;the&nbsp;bucket&nbsp;for&nbsp;stk[0:nstk],&nbsp;allocating&nbsp;new&nbsp;bucket&nbsp;if&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="1623361">func</span>&nbsp;<span class="ident" id="1623366">stkbucket</span><span class="op" id="1623375">(</span><span class="ident" id="1623376">typ</span>&nbsp;<span class="ident" id="1623380"><a href="/gostd/runtime/mprof.go.html#1620055">bucketType</a></span><span class="op" id="1623390">,</span>&nbsp;<span class="ident" id="1623392">size</span>&nbsp;<span class="builtintype" id="1623397">uintptr</span><span class="op" id="1623404">,</span>&nbsp;<span class="ident" id="1623406">stk</span>&nbsp;<span class="op" id="1623410">[</span><span class="op" id="1623411">]</span><span class="builtintype" id="1623412">uintptr</span><span class="op" id="1623419">,</span>&nbsp;<span class="ident" id="1623421">alloc</span>&nbsp;<span class="builtintype" id="1623427">bool</span><span class="op" id="1623431">)</span>&nbsp;<span class="op" id="1623433">*</span><span class="ident" id="1623434"><a href="/gostd/runtime/mprof.go.html#1620458">bucket</a></span>&nbsp;<span class="op" id="1623441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623444">if</span>&nbsp;<span class="ident" id="1623447"><a href="/gostd/runtime/mprof.go.html#1621957">buckhash</a></span>&nbsp;<span class="op" id="1623456">==</span>&nbsp;<span class="builtintype" id="1623459">nil</span>&nbsp;<span class="op" id="1623463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623467"><a href="/gostd/runtime/mprof.go.html#1621957">buckhash</a></span>&nbsp;<span class="op" id="1623476">=</span>&nbsp;<span class="op" id="1623478">(</span><span class="op" id="1623479">*</span><span class="op" id="1623480">[</span><span class="ident" id="1623481"><a href="/gostd/runtime/mprof.go.html#1619966">buckHashSize</a></span><span class="op" id="1623493">]</span><span class="op" id="1623494">*</span><span class="ident" id="1623495"><a href="/gostd/runtime/mprof.go.html#1620458">bucket</a></span><span class="op" id="1623501">)</span><span class="op" id="1623502">(</span><span class="ident" id="1623503"><a href="/gostd/runtime/mprof.go.html#1624308">sysAlloc</a></span><span class="op" id="1623511">(</span><span class="ident" id="1623512"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1623518">.</span><span class="ident" id="1623519">Sizeof</span><span class="op" id="1623525">(</span><span class="op" id="1623526">*</span><span class="ident" id="1623527"><a href="/gostd/runtime/mprof.go.html#1621957">buckhash</a></span><span class="op" id="1623535">)</span><span class="op" id="1623536">,</span>&nbsp;<span class="op" id="1623538">&amp;</span><span class="ident" id="1623539"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793070">memstats</a></span><span class="op" id="1623547">.</span><span class="ident" id="1623548"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1792822">buckhash_sys</a></span><span class="op" id="1623560">)</span><span class="op" id="1623561">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623565">if</span>&nbsp;<span class="ident" id="1623568"><a href="/gostd/runtime/mprof.go.html#1621957">buckhash</a></span>&nbsp;<span class="op" id="1623577">==</span>&nbsp;<span class="builtintype" id="1623580">nil</span>&nbsp;<span class="op" id="1623584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623589"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1623596">(</span><span class="string" id="1623597">&#34;runtime:&nbsp;cannot&nbsp;allocate&nbsp;memory&#34;</span><span class="op" id="1623630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1623634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1623637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1623641">//&nbsp;Hash&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623657">var</span>&nbsp;<span class="ident" id="1623661">h</span>&nbsp;<span class="builtintype" id="1623663">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623672">for</span>&nbsp;<span class="ident" id="1623676">_</span><span class="op" id="1623677">,</span>&nbsp;<span class="ident" id="1623679">pc</span>&nbsp;<span class="op" id="1623682">:=</span>&nbsp;<span class="keyword" id="1623685">range</span>&nbsp;<span class="ident" id="1623691"><a href="/gostd/runtime/mprof.go.html#1623406">stk</a></span>&nbsp;<span class="op" id="1623695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623699"><a href="/gostd/runtime/mprof.go.html#1623661">h</a></span>&nbsp;<span class="op" id="1623701">+=</span>&nbsp;<span class="ident" id="1623704"><a href="/gostd/runtime/mprof.go.html#1623679">pc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623709"><a href="/gostd/runtime/mprof.go.html#1623661">h</a></span>&nbsp;<span class="op" id="1623711">+=</span>&nbsp;<span class="ident" id="1623714"><a href="/gostd/runtime/mprof.go.html#1623661">h</a></span>&nbsp;<span class="op" id="1623716">&lt;&lt;</span>&nbsp;<span class="num" id="1623719">10</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623724"><a href="/gostd/runtime/mprof.go.html#1623661">h</a></span>&nbsp;<span class="op" id="1623726">^=</span>&nbsp;<span class="ident" id="1623729"><a href="/gostd/runtime/mprof.go.html#1623661">h</a></span>&nbsp;<span class="op" id="1623731">&gt;&gt;</span>&nbsp;<span class="num" id="1623734">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1623737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1623740">//&nbsp;hash&nbsp;in&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623757"><a href="/gostd/runtime/mprof.go.html#1623661">h</a></span>&nbsp;<span class="op" id="1623759">+=</span>&nbsp;<span class="ident" id="1623762"><a href="/gostd/runtime/mprof.go.html#1623392">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623768"><a href="/gostd/runtime/mprof.go.html#1623661">h</a></span>&nbsp;<span class="op" id="1623770">+=</span>&nbsp;<span class="ident" id="1623773"><a href="/gostd/runtime/mprof.go.html#1623661">h</a></span>&nbsp;<span class="op" id="1623775">&lt;&lt;</span>&nbsp;<span class="num" id="1623778">10</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623782"><a href="/gostd/runtime/mprof.go.html#1623661">h</a></span>&nbsp;<span class="op" id="1623784">^=</span>&nbsp;<span class="ident" id="1623787"><a href="/gostd/runtime/mprof.go.html#1623661">h</a></span>&nbsp;<span class="op" id="1623789">&gt;&gt;</span>&nbsp;<span class="num" id="1623792">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1623795">//&nbsp;finalize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623808"><a href="/gostd/runtime/mprof.go.html#1623661">h</a></span>&nbsp;<span class="op" id="1623810">+=</span>&nbsp;<span class="ident" id="1623813"><a href="/gostd/runtime/mprof.go.html#1623661">h</a></span>&nbsp;<span class="op" id="1623815">&lt;&lt;</span>&nbsp;<span class="num" id="1623818">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623821"><a href="/gostd/runtime/mprof.go.html#1623661">h</a></span>&nbsp;<span class="op" id="1623823">^=</span>&nbsp;<span class="ident" id="1623826"><a href="/gostd/runtime/mprof.go.html#1623661">h</a></span>&nbsp;<span class="op" id="1623828">&gt;&gt;</span>&nbsp;<span class="num" id="1623831">11</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623836">i</span>&nbsp;<span class="op" id="1623838">:=</span>&nbsp;<span class="builtintype" id="1623841">int</span><span class="op" id="1623844">(</span><span class="ident" id="1623845"><a href="/gostd/runtime/mprof.go.html#1623661">h</a></span>&nbsp;<span class="op" id="1623847">%</span>&nbsp;<span class="ident" id="1623849"><a href="/gostd/runtime/mprof.go.html#1619966">buckHashSize</a></span><span class="op" id="1623861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623864">for</span>&nbsp;<span class="ident" id="1623868">b</span>&nbsp;<span class="op" id="1623870">:=</span>&nbsp;<span class="ident" id="1623873"><a href="/gostd/runtime/mprof.go.html#1621957">buckhash</a></span><span class="op" id="1623881">[</span><span class="ident" id="1623882"><a href="/gostd/runtime/mprof.go.html#1623836">i</a></span><span class="op" id="1623883">]</span><span class="op" id="1623884">;</span>&nbsp;<span class="ident" id="1623886"><a href="/gostd/runtime/mprof.go.html#1623868">b</a></span>&nbsp;<span class="op" id="1623888">!=</span>&nbsp;<span class="builtintype" id="1623891">nil</span><span class="op" id="1623894">;</span>&nbsp;<span class="ident" id="1623896"><a href="/gostd/runtime/mprof.go.html#1623868">b</a></span>&nbsp;<span class="op" id="1623898">=</span>&nbsp;<span class="ident" id="1623900"><a href="/gostd/runtime/mprof.go.html#1623868">b</a></span><span class="op" id="1623901">.</span><span class="ident" id="1623902"><a href="/gostd/runtime/mprof.go.html#1620475">next</a></span>&nbsp;<span class="op" id="1623907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623911">if</span>&nbsp;<span class="ident" id="1623914"><a href="/gostd/runtime/mprof.go.html#1623868">b</a></span><span class="op" id="1623915">.</span><span class="ident" id="1623916"><a href="/gostd/runtime/mprof.go.html#1620509">typ</a></span>&nbsp;<span class="op" id="1623920">==</span>&nbsp;<span class="ident" id="1623923"><a href="/gostd/runtime/mprof.go.html#1623376">typ</a></span>&nbsp;<span class="op" id="1623927">&amp;&amp;</span>&nbsp;<span class="ident" id="1623930"><a href="/gostd/runtime/mprof.go.html#1623868">b</a></span><span class="op" id="1623931">.</span><span class="ident" id="1623932"><a href="/gostd/runtime/mprof.go.html#1620557">hash</a></span>&nbsp;<span class="op" id="1623937">==</span>&nbsp;<span class="ident" id="1623940"><a href="/gostd/runtime/mprof.go.html#1623661">h</a></span>&nbsp;<span class="op" id="1623942">&amp;&amp;</span>&nbsp;<span class="ident" id="1623945"><a href="/gostd/runtime/mprof.go.html#1623868">b</a></span><span class="op" id="1623946">.</span><span class="ident" id="1623947"><a href="/gostd/runtime/mprof.go.html#1620574">size</a></span>&nbsp;<span class="op" id="1623952">==</span>&nbsp;<span class="ident" id="1623955"><a href="/gostd/runtime/mprof.go.html#1623392">size</a></span>&nbsp;<span class="op" id="1623960">&amp;&amp;</span>&nbsp;<span class="ident" id="1623963"><a href="/gostd/runtime/mprof.go.html#1624363">eqslice</a></span><span class="op" id="1623970">(</span><span class="ident" id="1623971"><a href="/gostd/runtime/mprof.go.html#1623868">b</a></span><span class="op" id="1623972">.</span><span class="ident" id="1623973"><a href="/gostd/runtime/mprof.go.html#1622597">stk</a></span><span class="op" id="1623976">(</span><span class="op" id="1623977">)</span><span class="op" id="1623978">,</span>&nbsp;<span class="ident" id="1623980"><a href="/gostd/runtime/mprof.go.html#1623406">stk</a></span><span class="op" id="1623983">)</span>&nbsp;<span class="op" id="1623985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623990">return</span>&nbsp;<span class="ident" id="1623997"><a href="/gostd/runtime/mprof.go.html#1623868">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1624001">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1624004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1624008">if</span>&nbsp;<span class="op" id="1624011">!</span><span class="ident" id="1624012"><a href="/gostd/runtime/mprof.go.html#1623421">alloc</a></span>&nbsp;<span class="op" id="1624018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1624022">return</span>&nbsp;<span class="builtintype" id="1624029">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1624034">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1624038">//&nbsp;Create&nbsp;new&nbsp;bucket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624061">b</span>&nbsp;<span class="op" id="1624063">:=</span>&nbsp;<span class="ident" id="1624066"><a href="/gostd/runtime/mprof.go.html#1622092">newBucket</a></span><span class="op" id="1624075">(</span><span class="ident" id="1624076"><a href="/gostd/runtime/mprof.go.html#1623376">typ</a></span><span class="op" id="1624079">,</span>&nbsp;<span class="builtinfunc" id="1624081">len</span><span class="op" id="1624084">(</span><span class="ident" id="1624085"><a href="/gostd/runtime/mprof.go.html#1623406">stk</a></span><span class="op" id="1624088">)</span><span class="op" id="1624089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1624092">copy</span><span class="op" id="1624096">(</span><span class="ident" id="1624097"><a href="/gostd/runtime/mprof.go.html#1624061">b</a></span><span class="op" id="1624098">.</span><span class="ident" id="1624099"><a href="/gostd/runtime/mprof.go.html#1622597">stk</a></span><span class="op" id="1624102">(</span><span class="op" id="1624103">)</span><span class="op" id="1624104">,</span>&nbsp;<span class="ident" id="1624106"><a href="/gostd/runtime/mprof.go.html#1623406">stk</a></span><span class="op" id="1624109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624112"><a href="/gostd/runtime/mprof.go.html#1624061">b</a></span><span class="op" id="1624113">.</span><span class="ident" id="1624114"><a href="/gostd/runtime/mprof.go.html#1620557">hash</a></span>&nbsp;<span class="op" id="1624119">=</span>&nbsp;<span class="ident" id="1624121"><a href="/gostd/runtime/mprof.go.html#1623661">h</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624124"><a href="/gostd/runtime/mprof.go.html#1624061">b</a></span><span class="op" id="1624125">.</span><span class="ident" id="1624126"><a href="/gostd/runtime/mprof.go.html#1620574">size</a></span>&nbsp;<span class="op" id="1624131">=</span>&nbsp;<span class="ident" id="1624133"><a href="/gostd/runtime/mprof.go.html#1623392">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624139"><a href="/gostd/runtime/mprof.go.html#1624061">b</a></span><span class="op" id="1624140">.</span><span class="ident" id="1624141"><a href="/gostd/runtime/mprof.go.html#1620475">next</a></span>&nbsp;<span class="op" id="1624146">=</span>&nbsp;<span class="ident" id="1624148"><a href="/gostd/runtime/mprof.go.html#1621957">buckhash</a></span><span class="op" id="1624156">[</span><span class="ident" id="1624157"><a href="/gostd/runtime/mprof.go.html#1623836">i</a></span><span class="op" id="1624158">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624161"><a href="/gostd/runtime/mprof.go.html#1621957">buckhash</a></span><span class="op" id="1624169">[</span><span class="ident" id="1624170"><a href="/gostd/runtime/mprof.go.html#1623836">i</a></span><span class="op" id="1624171">]</span>&nbsp;<span class="op" id="1624173">=</span>&nbsp;<span class="ident" id="1624175"><a href="/gostd/runtime/mprof.go.html#1624061">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1624178">if</span>&nbsp;<span class="ident" id="1624181"><a href="/gostd/runtime/mprof.go.html#1623376">typ</a></span>&nbsp;<span class="op" id="1624185">==</span>&nbsp;<span class="ident" id="1624188"><a href="/gostd/runtime/mprof.go.html#1619887">memProfile</a></span>&nbsp;<span class="op" id="1624199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624203"><a href="/gostd/runtime/mprof.go.html#1624061">b</a></span><span class="op" id="1624204">.</span><span class="ident" id="1624205"><a href="/gostd/runtime/mprof.go.html#1620492">allnext</a></span>&nbsp;<span class="op" id="1624213">=</span>&nbsp;<span class="ident" id="1624215"><a href="/gostd/runtime/mprof.go.html#1621865">mbuckets</a></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624226"><a href="/gostd/runtime/mprof.go.html#1621865">mbuckets</a></span>&nbsp;<span class="op" id="1624235">=</span>&nbsp;<span class="ident" id="1624237"><a href="/gostd/runtime/mprof.go.html#1624061">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1624240">}</span>&nbsp;<span class="keyword" id="1624242">else</span>&nbsp;<span class="op" id="1624247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624251"><a href="/gostd/runtime/mprof.go.html#1624061">b</a></span><span class="op" id="1624252">.</span><span class="ident" id="1624253"><a href="/gostd/runtime/mprof.go.html#1620492">allnext</a></span>&nbsp;<span class="op" id="1624261">=</span>&nbsp;<span class="ident" id="1624263"><a href="/gostd/runtime/mprof.go.html#1621910">bbuckets</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624274"><a href="/gostd/runtime/mprof.go.html#1621910">bbuckets</a></span>&nbsp;<span class="op" id="1624283">=</span>&nbsp;<span class="ident" id="1624285"><a href="/gostd/runtime/mprof.go.html#1624061">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1624288">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1624291">return</span>&nbsp;<span class="ident" id="1624298"><a href="/gostd/runtime/mprof.go.html#1624061">b</a></span><br>
<span class="lineno"></span><span class="op" id="1624300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1624303">func</span>&nbsp;<span class="ident" id="1624308">sysAlloc</span><span class="op" id="1624316">(</span><span class="ident" id="1624317">n</span>&nbsp;<span class="builtintype" id="1624319">uintptr</span><span class="op" id="1624326">,</span>&nbsp;<span class="ident" id="1624328">stat</span>&nbsp;<span class="op" id="1624333">*</span><span class="builtintype" id="1624334">uint64</span><span class="op" id="1624340">)</span>&nbsp;<span class="ident" id="1624342"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1624348">.</span><span class="ident" id="1624349">Pointer</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="keyword" id="1624358">func</span>&nbsp;<span class="ident" id="1624363">eqslice</span><span class="op" id="1624370">(</span><span class="ident" id="1624371">x</span><span class="op" id="1624372">,</span>&nbsp;<span class="ident" id="1624374">y</span>&nbsp;<span class="op" id="1624376">[</span><span class="op" id="1624377">]</span><span class="builtintype" id="1624378">uintptr</span><span class="op" id="1624385">)</span>&nbsp;<span class="builtintype" id="1624387">bool</span>&nbsp;<span class="op" id="1624392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1624395">if</span>&nbsp;<span class="builtinfunc" id="1624398">len</span><span class="op" id="1624401">(</span><span class="ident" id="1624402"><a href="/gostd/runtime/mprof.go.html#1624371">x</a></span><span class="op" id="1624403">)</span>&nbsp;<span class="op" id="1624405">!=</span>&nbsp;<span class="builtinfunc" id="1624408">len</span><span class="op" id="1624411">(</span><span class="ident" id="1624412"><a href="/gostd/runtime/mprof.go.html#1624374">y</a></span><span class="op" id="1624413">)</span>&nbsp;<span class="op" id="1624415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1624419">return</span>&nbsp;<span class="builtintype" id="1624426">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1624433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1624436">for</span>&nbsp;<span class="ident" id="1624440">i</span><span class="op" id="1624441">,</span>&nbsp;<span class="ident" id="1624443">xi</span>&nbsp;<span class="op" id="1624446">:=</span>&nbsp;<span class="keyword" id="1624449">range</span>&nbsp;<span class="ident" id="1624455"><a href="/gostd/runtime/mprof.go.html#1624371">x</a></span>&nbsp;<span class="op" id="1624457">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1624461">if</span>&nbsp;<span class="ident" id="1624464"><a href="/gostd/runtime/mprof.go.html#1624443">xi</a></span>&nbsp;<span class="op" id="1624467">!=</span>&nbsp;<span class="ident" id="1624470"><a href="/gostd/runtime/mprof.go.html#1624374">y</a></span><span class="op" id="1624471">[</span><span class="ident" id="1624472"><a href="/gostd/runtime/mprof.go.html#1624440">i</a></span><span class="op" id="1624473">]</span>&nbsp;<span class="op" id="1624475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1624480">return</span>&nbsp;<span class="builtintype" id="1624487">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1624495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1624498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1624501">return</span>&nbsp;<span class="builtintype" id="1624508">true</span><br>
<span class="lineno">205</span><span class="op" id="1624513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1624516">func</span>&nbsp;<span class="ident" id="1624521">mprof_GC</span><span class="op" id="1624529">(</span><span class="op" id="1624530">)</span>&nbsp;<span class="op" id="1624532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1624535">for</span>&nbsp;<span class="ident" id="1624539">b</span>&nbsp;<span class="op" id="1624541">:=</span>&nbsp;<span class="ident" id="1624544"><a href="/gostd/runtime/mprof.go.html#1621865">mbuckets</a></span><span class="op" id="1624552">;</span>&nbsp;<span class="ident" id="1624554"><a href="/gostd/runtime/mprof.go.html#1624539">b</a></span>&nbsp;<span class="op" id="1624556">!=</span>&nbsp;<span class="builtintype" id="1624559">nil</span><span class="op" id="1624562">;</span>&nbsp;<span class="ident" id="1624564"><a href="/gostd/runtime/mprof.go.html#1624539">b</a></span>&nbsp;<span class="op" id="1624566">=</span>&nbsp;<span class="ident" id="1624568"><a href="/gostd/runtime/mprof.go.html#1624539">b</a></span><span class="op" id="1624569">.</span><span class="ident" id="1624570"><a href="/gostd/runtime/mprof.go.html#1620492">allnext</a></span>&nbsp;<span class="op" id="1624578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624582">mp</span>&nbsp;<span class="op" id="1624585">:=</span>&nbsp;<span class="ident" id="1624588"><a href="/gostd/runtime/mprof.go.html#1624539">b</a></span><span class="op" id="1624589">.</span><span class="ident" id="1624590"><a href="/gostd/runtime/mprof.go.html#1622804">mp</a></span><span class="op" id="1624592">(</span><span class="op" id="1624593">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624597"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624599">.</span><span class="ident" id="1624600"><a href="/gostd/runtime/mprof.go.html#1621319">allocs</a></span>&nbsp;<span class="op" id="1624607">+=</span>&nbsp;<span class="ident" id="1624610"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624612">.</span><span class="ident" id="1624613"><a href="/gostd/runtime/mprof.go.html#1621452">prev_allocs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624627"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624629">.</span><span class="ident" id="1624630"><a href="/gostd/runtime/mprof.go.html#1621340">frees</a></span>&nbsp;<span class="op" id="1624636">+=</span>&nbsp;<span class="ident" id="1624639"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624641">.</span><span class="ident" id="1624642"><a href="/gostd/runtime/mprof.go.html#1621478">prev_frees</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624655"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624657">.</span><span class="ident" id="1624658"><a href="/gostd/runtime/mprof.go.html#1621361">alloc_bytes</a></span>&nbsp;<span class="op" id="1624670">+=</span>&nbsp;<span class="ident" id="1624673"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624675">.</span><span class="ident" id="1624676"><a href="/gostd/runtime/mprof.go.html#1621504">prev_alloc_bytes</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624695"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624697">.</span><span class="ident" id="1624698"><a href="/gostd/runtime/mprof.go.html#1621382">free_bytes</a></span>&nbsp;<span class="op" id="1624709">+=</span>&nbsp;<span class="ident" id="1624712"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624714">.</span><span class="ident" id="1624715"><a href="/gostd/runtime/mprof.go.html#1621530">prev_free_bytes</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624734"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624736">.</span><span class="ident" id="1624737"><a href="/gostd/runtime/mprof.go.html#1621452">prev_allocs</a></span>&nbsp;<span class="op" id="1624749">=</span>&nbsp;<span class="ident" id="1624751"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624753">.</span><span class="ident" id="1624754"><a href="/gostd/runtime/mprof.go.html#1621583">recent_allocs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624770"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624772">.</span><span class="ident" id="1624773"><a href="/gostd/runtime/mprof.go.html#1621478">prev_frees</a></span>&nbsp;<span class="op" id="1624784">=</span>&nbsp;<span class="ident" id="1624786"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624788">.</span><span class="ident" id="1624789"><a href="/gostd/runtime/mprof.go.html#1621611">recent_frees</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624804"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624806">.</span><span class="ident" id="1624807"><a href="/gostd/runtime/mprof.go.html#1621504">prev_alloc_bytes</a></span>&nbsp;<span class="op" id="1624824">=</span>&nbsp;<span class="ident" id="1624826"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624828">.</span><span class="ident" id="1624829"><a href="/gostd/runtime/mprof.go.html#1621639">recent_alloc_bytes</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624850"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624852">.</span><span class="ident" id="1624853"><a href="/gostd/runtime/mprof.go.html#1621530">prev_free_bytes</a></span>&nbsp;<span class="op" id="1624869">=</span>&nbsp;<span class="ident" id="1624871"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624873">.</span><span class="ident" id="1624874"><a href="/gostd/runtime/mprof.go.html#1621667">recent_free_bytes</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624895"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624897">.</span><span class="ident" id="1624898"><a href="/gostd/runtime/mprof.go.html#1621583">recent_allocs</a></span>&nbsp;<span class="op" id="1624912">=</span>&nbsp;<span class="num" id="1624914">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624918"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624920">.</span><span class="ident" id="1624921"><a href="/gostd/runtime/mprof.go.html#1621611">recent_frees</a></span>&nbsp;<span class="op" id="1624934">=</span>&nbsp;<span class="num" id="1624936">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624940"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624942">.</span><span class="ident" id="1624943"><a href="/gostd/runtime/mprof.go.html#1621639">recent_alloc_bytes</a></span>&nbsp;<span class="op" id="1624962">=</span>&nbsp;<span class="num" id="1624964">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624968"><a href="/gostd/runtime/mprof.go.html#1624582">mp</a></span><span class="op" id="1624970">.</span><span class="ident" id="1624971"><a href="/gostd/runtime/mprof.go.html#1621667">recent_free_bytes</a></span>&nbsp;<span class="op" id="1624989">=</span>&nbsp;<span class="num" id="1624991">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1624994">}</span><br>
<span class="lineno">225</span><span class="op" id="1624996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1624999">//&nbsp;Record&nbsp;that&nbsp;a&nbsp;gc&nbsp;just&nbsp;happened:&nbsp;all&nbsp;the&nbsp;&#39;recent&#39;&nbsp;statistics&nbsp;are&nbsp;now&nbsp;real.</span><br>
<span class="lineno"></span><span class="keyword" id="1625076">func</span>&nbsp;<span class="ident" id="1625081">mProf_GC</span><span class="op" id="1625089">(</span><span class="op" id="1625090">)</span>&nbsp;<span class="op" id="1625092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625095"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1625099">(</span><span class="op" id="1625100">&amp;</span><span class="ident" id="1625101"><a href="/gostd/runtime/mprof.go.html#1619691">proflock</a></span><span class="op" id="1625109">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625112"><a href="/gostd/runtime/mprof.go.html#1624521">mprof_GC</a></span><span class="op" id="1625120">(</span><span class="op" id="1625121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625124"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1625130">(</span><span class="op" id="1625131">&amp;</span><span class="ident" id="1625132"><a href="/gostd/runtime/mprof.go.html#1619691">proflock</a></span><span class="op" id="1625140">)</span><br>
<span class="lineno"></span><span class="op" id="1625142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1625145">//&nbsp;Called&nbsp;by&nbsp;malloc&nbsp;to&nbsp;record&nbsp;a&nbsp;profiled&nbsp;block.</span><br>
<span class="lineno">235</span><span class="keyword" id="1625193">func</span>&nbsp;<span class="ident" id="1625198">mProf_Malloc</span><span class="op" id="1625210">(</span><span class="ident" id="1625211">p</span>&nbsp;<span class="ident" id="1625213"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1625219">.</span><span class="ident" id="1625220">Pointer</span><span class="op" id="1625227">,</span>&nbsp;<span class="ident" id="1625229">size</span>&nbsp;<span class="builtintype" id="1625234">uintptr</span><span class="op" id="1625241">)</span>&nbsp;<span class="op" id="1625243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1625246">var</span>&nbsp;<span class="ident" id="1625250">stk</span>&nbsp;<span class="op" id="1625254">[</span><span class="ident" id="1625255"><a href="/gostd/runtime/mprof.go.html#1620033">maxStack</a></span><span class="op" id="1625263">]</span><span class="builtintype" id="1625264">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625273">nstk</span>&nbsp;<span class="op" id="1625278">:=</span>&nbsp;<span class="ident" id="1625281"><a href="/gostd/runtime/traceback.go.html#1780592">callers</a></span><span class="op" id="1625288">(</span><span class="num" id="1625289">4</span><span class="op" id="1625290">,</span>&nbsp;<span class="op" id="1625292">&amp;</span><span class="ident" id="1625293"><a href="/gostd/runtime/mprof.go.html#1625250">stk</a></span><span class="op" id="1625296">[</span><span class="num" id="1625297">0</span><span class="op" id="1625298">]</span><span class="op" id="1625299">,</span>&nbsp;<span class="builtinfunc" id="1625301">len</span><span class="op" id="1625304">(</span><span class="ident" id="1625305"><a href="/gostd/runtime/mprof.go.html#1625250">stk</a></span><span class="op" id="1625308">)</span><span class="op" id="1625309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625312"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1625316">(</span><span class="op" id="1625317">&amp;</span><span class="ident" id="1625318"><a href="/gostd/runtime/mprof.go.html#1619691">proflock</a></span><span class="op" id="1625326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625329">b</span>&nbsp;<span class="op" id="1625331">:=</span>&nbsp;<span class="ident" id="1625334"><a href="/gostd/runtime/mprof.go.html#1623366">stkbucket</a></span><span class="op" id="1625343">(</span><span class="ident" id="1625344"><a href="/gostd/runtime/mprof.go.html#1619887">memProfile</a></span><span class="op" id="1625354">,</span>&nbsp;<span class="ident" id="1625356"><a href="/gostd/runtime/mprof.go.html#1625229">size</a></span><span class="op" id="1625360">,</span>&nbsp;<span class="ident" id="1625362"><a href="/gostd/runtime/mprof.go.html#1625250">stk</a></span><span class="op" id="1625365">[</span><span class="op" id="1625366">:</span><span class="ident" id="1625367"><a href="/gostd/runtime/mprof.go.html#1625273">nstk</a></span><span class="op" id="1625371">]</span><span class="op" id="1625372">,</span>&nbsp;<span class="builtintype" id="1625374">true</span><span class="op" id="1625378">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625381">mp</span>&nbsp;<span class="op" id="1625384">:=</span>&nbsp;<span class="ident" id="1625387"><a href="/gostd/runtime/mprof.go.html#1625329">b</a></span><span class="op" id="1625388">.</span><span class="ident" id="1625389"><a href="/gostd/runtime/mprof.go.html#1622804">mp</a></span><span class="op" id="1625391">(</span><span class="op" id="1625392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625395"><a href="/gostd/runtime/mprof.go.html#1625381">mp</a></span><span class="op" id="1625397">.</span><span class="ident" id="1625398"><a href="/gostd/runtime/mprof.go.html#1621583">recent_allocs</a></span><span class="op" id="1625411">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625415"><a href="/gostd/runtime/mprof.go.html#1625381">mp</a></span><span class="op" id="1625417">.</span><span class="ident" id="1625418"><a href="/gostd/runtime/mprof.go.html#1621639">recent_alloc_bytes</a></span>&nbsp;<span class="op" id="1625437">+=</span>&nbsp;<span class="ident" id="1625440"><a href="/gostd/runtime/mprof.go.html#1625229">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625446"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1625452">(</span><span class="op" id="1625453">&amp;</span><span class="ident" id="1625454"><a href="/gostd/runtime/mprof.go.html#1619691">proflock</a></span><span class="op" id="1625462">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1625466">//&nbsp;Setprofilebucket&nbsp;locks&nbsp;a&nbsp;bunch&nbsp;of&nbsp;other&nbsp;mutexes,&nbsp;so&nbsp;we&nbsp;call&nbsp;it&nbsp;outside&nbsp;of&nbsp;proflock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1625554">//&nbsp;This&nbsp;reduces&nbsp;potential&nbsp;contention&nbsp;and&nbsp;chances&nbsp;of&nbsp;deadlocks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1625618">//&nbsp;Since&nbsp;the&nbsp;object&nbsp;must&nbsp;be&nbsp;alive&nbsp;during&nbsp;call&nbsp;to&nbsp;mProf_Malloc,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1625682">//&nbsp;it&#39;s&nbsp;fine&nbsp;to&nbsp;do&nbsp;this&nbsp;non-atomically.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625723"><a href="/gostd/runtime/mprof.go.html#1625792">setprofilebucket</a></span><span class="op" id="1625739">(</span><span class="ident" id="1625740"><a href="/gostd/runtime/mprof.go.html#1625211">p</a></span><span class="op" id="1625741">,</span>&nbsp;<span class="ident" id="1625743"><a href="/gostd/runtime/mprof.go.html#1625329">b</a></span><span class="op" id="1625744">)</span><br>
<span class="lineno">250</span><span class="op" id="1625746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1625749">func</span>&nbsp;<span class="ident" id="1625754">setprofilebucket_m</span><span class="op" id="1625772">(</span><span class="op" id="1625773">)</span>&nbsp;<span class="comment" id="1625775">//&nbsp;mheap.c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1625787">func</span>&nbsp;<span class="ident" id="1625792">setprofilebucket</span><span class="op" id="1625808">(</span><span class="ident" id="1625809">p</span>&nbsp;<span class="ident" id="1625811"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1625817">.</span><span class="ident" id="1625818">Pointer</span><span class="op" id="1625825">,</span>&nbsp;<span class="ident" id="1625827">b</span>&nbsp;<span class="op" id="1625829">*</span><span class="ident" id="1625830"><a href="/gostd/runtime/mprof.go.html#1620458">bucket</a></span><span class="op" id="1625836">)</span>&nbsp;<span class="op" id="1625838">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625841">g</span>&nbsp;<span class="op" id="1625843">:=</span>&nbsp;<span class="ident" id="1625846"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1625850">(</span><span class="op" id="1625851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625854"><a href="/gostd/runtime/mprof.go.html#1625841">g</a></span><span class="op" id="1625855">.</span><span class="ident" id="1625856"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1625857">.</span><span class="ident" id="1625858"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788547">ptrarg</a></span><span class="op" id="1625864">[</span><span class="num" id="1625865">0</span><span class="op" id="1625866">]</span>&nbsp;<span class="op" id="1625868">=</span>&nbsp;<span class="ident" id="1625870"><a href="/gostd/runtime/mprof.go.html#1625809">p</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625873"><a href="/gostd/runtime/mprof.go.html#1625841">g</a></span><span class="op" id="1625874">.</span><span class="ident" id="1625875"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1625876">.</span><span class="ident" id="1625877"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788547">ptrarg</a></span><span class="op" id="1625883">[</span><span class="num" id="1625884">1</span><span class="op" id="1625885">]</span>&nbsp;<span class="op" id="1625887">=</span>&nbsp;<span class="ident" id="1625889"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1625895">.</span><span class="ident" id="1625896">Pointer</span><span class="op" id="1625903">(</span><span class="ident" id="1625904"><a href="/gostd/runtime/mprof.go.html#1625827">b</a></span><span class="op" id="1625905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625908"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1625911">(</span><span class="ident" id="1625912"><a href="/gostd/runtime/mprof.go.html#1625754">setprofilebucket_m</a></span><span class="op" id="1625930">)</span><br>
<span class="lineno"></span><span class="op" id="1625932">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="1625935">//&nbsp;Called&nbsp;when&nbsp;freeing&nbsp;a&nbsp;profiled&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="1625976">func</span>&nbsp;<span class="ident" id="1625981">mProf_Free</span><span class="op" id="1625991">(</span><span class="ident" id="1625992">b</span>&nbsp;<span class="op" id="1625994">*</span><span class="ident" id="1625995"><a href="/gostd/runtime/mprof.go.html#1620458">bucket</a></span><span class="op" id="1626001">,</span>&nbsp;<span class="ident" id="1626003">size</span>&nbsp;<span class="builtintype" id="1626008">uintptr</span><span class="op" id="1626015">,</span>&nbsp;<span class="ident" id="1626017">freed</span>&nbsp;<span class="builtintype" id="1626023">bool</span><span class="op" id="1626027">)</span>&nbsp;<span class="op" id="1626029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626032"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1626036">(</span><span class="op" id="1626037">&amp;</span><span class="ident" id="1626038"><a href="/gostd/runtime/mprof.go.html#1619691">proflock</a></span><span class="op" id="1626046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626049">mp</span>&nbsp;<span class="op" id="1626052">:=</span>&nbsp;<span class="ident" id="1626055"><a href="/gostd/runtime/mprof.go.html#1625992">b</a></span><span class="op" id="1626056">.</span><span class="ident" id="1626057"><a href="/gostd/runtime/mprof.go.html#1622804">mp</a></span><span class="op" id="1626059">(</span><span class="op" id="1626060">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1626063">if</span>&nbsp;<span class="ident" id="1626066"><a href="/gostd/runtime/mprof.go.html#1626017">freed</a></span>&nbsp;<span class="op" id="1626072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626076"><a href="/gostd/runtime/mprof.go.html#1626049">mp</a></span><span class="op" id="1626078">.</span><span class="ident" id="1626079"><a href="/gostd/runtime/mprof.go.html#1621611">recent_frees</a></span><span class="op" id="1626091">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626096"><a href="/gostd/runtime/mprof.go.html#1626049">mp</a></span><span class="op" id="1626098">.</span><span class="ident" id="1626099"><a href="/gostd/runtime/mprof.go.html#1621667">recent_free_bytes</a></span>&nbsp;<span class="op" id="1626117">+=</span>&nbsp;<span class="ident" id="1626120"><a href="/gostd/runtime/mprof.go.html#1626003">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1626126">}</span>&nbsp;<span class="keyword" id="1626128">else</span>&nbsp;<span class="op" id="1626133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626137"><a href="/gostd/runtime/mprof.go.html#1626049">mp</a></span><span class="op" id="1626139">.</span><span class="ident" id="1626140"><a href="/gostd/runtime/mprof.go.html#1621478">prev_frees</a></span><span class="op" id="1626150">++</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626155"><a href="/gostd/runtime/mprof.go.html#1626049">mp</a></span><span class="op" id="1626157">.</span><span class="ident" id="1626158"><a href="/gostd/runtime/mprof.go.html#1621530">prev_free_bytes</a></span>&nbsp;<span class="op" id="1626174">+=</span>&nbsp;<span class="ident" id="1626177"><a href="/gostd/runtime/mprof.go.html#1626003">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1626183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626186"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1626192">(</span><span class="op" id="1626193">&amp;</span><span class="ident" id="1626194"><a href="/gostd/runtime/mprof.go.html#1619691">proflock</a></span><span class="op" id="1626202">)</span><br>
<span class="lineno"></span><span class="op" id="1626204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="1626207">var</span>&nbsp;<span class="ident" id="1626211">blockprofilerate</span>&nbsp;<span class="builtintype" id="1626228">uint64</span>&nbsp;<span class="comment" id="1626235">//&nbsp;in&nbsp;CPU&nbsp;ticks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1626252">//&nbsp;SetBlockProfileRate&nbsp;controls&nbsp;the&nbsp;fraction&nbsp;of&nbsp;goroutine&nbsp;blocking&nbsp;events</span><br>
<span class="lineno"></span><span class="comment" id="1626326">//&nbsp;that&nbsp;are&nbsp;reported&nbsp;in&nbsp;the&nbsp;blocking&nbsp;profile.&nbsp;&nbsp;The&nbsp;profiler&nbsp;aims&nbsp;to&nbsp;sample</span><br>
<span class="lineno"></span><span class="comment" id="1626401">//&nbsp;an&nbsp;average&nbsp;of&nbsp;one&nbsp;blocking&nbsp;event&nbsp;per&nbsp;rate&nbsp;nanoseconds&nbsp;spent&nbsp;blocked.</span><br>
<span class="lineno">280</span><span class="comment" id="1626473">//</span><br>
<span class="lineno"></span><span class="comment" id="1626476">//&nbsp;To&nbsp;include&nbsp;every&nbsp;blocking&nbsp;event&nbsp;in&nbsp;the&nbsp;profile,&nbsp;pass&nbsp;rate&nbsp;=&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="1626542">//&nbsp;To&nbsp;turn&nbsp;off&nbsp;profiling&nbsp;entirely,&nbsp;pass&nbsp;rate&nbsp;&lt;=&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="1626593">func</span>&nbsp;<span class="ident" id="1626598">SetBlockProfileRate</span><span class="op" id="1626617">(</span><span class="ident" id="1626618">rate</span>&nbsp;<span class="builtintype" id="1626623">int</span><span class="op" id="1626626">)</span>&nbsp;<span class="op" id="1626628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1626631">var</span>&nbsp;<span class="ident" id="1626635">r</span>&nbsp;<span class="builtintype" id="1626637">int64</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1626644">if</span>&nbsp;<span class="ident" id="1626647"><a href="/gostd/runtime/mprof.go.html#1626618">rate</a></span>&nbsp;<span class="op" id="1626652">&lt;=</span>&nbsp;<span class="num" id="1626655">0</span>&nbsp;<span class="op" id="1626657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626661"><a href="/gostd/runtime/mprof.go.html#1626635">r</a></span>&nbsp;<span class="op" id="1626663">=</span>&nbsp;<span class="num" id="1626665">0</span>&nbsp;<span class="comment" id="1626667">//&nbsp;disable&nbsp;profiling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1626689">}</span>&nbsp;<span class="keyword" id="1626691">else</span>&nbsp;<span class="keyword" id="1626696">if</span>&nbsp;<span class="ident" id="1626699"><a href="/gostd/runtime/mprof.go.html#1626618">rate</a></span>&nbsp;<span class="op" id="1626704">==</span>&nbsp;<span class="num" id="1626707">1</span>&nbsp;<span class="op" id="1626709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626713"><a href="/gostd/runtime/mprof.go.html#1626635">r</a></span>&nbsp;<span class="op" id="1626715">=</span>&nbsp;<span class="num" id="1626717">1</span>&nbsp;<span class="comment" id="1626719">//&nbsp;profile&nbsp;everything</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1626742">}</span>&nbsp;<span class="keyword" id="1626744">else</span>&nbsp;<span class="op" id="1626749">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1626753">//&nbsp;convert&nbsp;ns&nbsp;to&nbsp;cycles,&nbsp;use&nbsp;float64&nbsp;to&nbsp;prevent&nbsp;overflow&nbsp;during&nbsp;multiplication</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626834"><a href="/gostd/runtime/mprof.go.html#1626635">r</a></span>&nbsp;<span class="op" id="1626836">=</span>&nbsp;<span class="builtintype" id="1626838">int64</span><span class="op" id="1626843">(</span><span class="builtintype" id="1626844">float64</span><span class="op" id="1626851">(</span><span class="ident" id="1626852"><a href="/gostd/runtime/mprof.go.html#1626618">rate</a></span><span class="op" id="1626856">)</span>&nbsp;<span class="op" id="1626858">*</span>&nbsp;<span class="builtintype" id="1626860">float64</span><span class="op" id="1626867">(</span><span class="ident" id="1626868"><a href="/gostd/runtime/runtime.go.html#1685075">tickspersecond</a></span><span class="op" id="1626882">(</span><span class="op" id="1626883">)</span><span class="op" id="1626884">)</span>&nbsp;<span class="op" id="1626886">/</span>&nbsp;<span class="op" id="1626888">(</span><span class="num" id="1626889">1000</span>&nbsp;<span class="op" id="1626894">*</span>&nbsp;<span class="num" id="1626896">1000</span>&nbsp;<span class="op" id="1626901">*</span>&nbsp;<span class="num" id="1626903">1000</span><span class="op" id="1626907">)</span><span class="op" id="1626908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1626912">if</span>&nbsp;<span class="ident" id="1626915"><a href="/gostd/runtime/mprof.go.html#1626635">r</a></span>&nbsp;<span class="op" id="1626917">==</span>&nbsp;<span class="num" id="1626920">0</span>&nbsp;<span class="op" id="1626922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626927"><a href="/gostd/runtime/mprof.go.html#1626635">r</a></span>&nbsp;<span class="op" id="1626929">=</span>&nbsp;<span class="num" id="1626931">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1626935">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1626938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626942"><a href="/gostd/runtime/atomic.go.html#1481672">atomicstore64</a></span><span class="op" id="1626955">(</span><span class="op" id="1626956">&amp;</span><span class="ident" id="1626957"><a href="/gostd/runtime/mprof.go.html#1626211">blockprofilerate</a></span><span class="op" id="1626973">,</span>&nbsp;<span class="builtintype" id="1626975">uint64</span><span class="op" id="1626981">(</span><span class="ident" id="1626982"><a href="/gostd/runtime/mprof.go.html#1626635">r</a></span><span class="op" id="1626983">)</span><span class="op" id="1626984">)</span><br>
<span class="lineno"></span><span class="op" id="1626986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="1626989">func</span>&nbsp;<span class="ident" id="1626994">blockevent</span><span class="op" id="1627004">(</span><span class="ident" id="1627005">cycles</span>&nbsp;<span class="builtintype" id="1627012">int64</span><span class="op" id="1627017">,</span>&nbsp;<span class="ident" id="1627019">skip</span>&nbsp;<span class="builtintype" id="1627024">int</span><span class="op" id="1627027">)</span>&nbsp;<span class="op" id="1627029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627032">if</span>&nbsp;<span class="ident" id="1627035"><a href="/gostd/runtime/mprof.go.html#1627005">cycles</a></span>&nbsp;<span class="op" id="1627042">&lt;=</span>&nbsp;<span class="num" id="1627045">0</span>&nbsp;<span class="op" id="1627047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627051"><a href="/gostd/runtime/mprof.go.html#1627005">cycles</a></span>&nbsp;<span class="op" id="1627058">=</span>&nbsp;<span class="num" id="1627060">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627066">rate</span>&nbsp;<span class="op" id="1627071">:=</span>&nbsp;<span class="builtintype" id="1627074">int64</span><span class="op" id="1627079">(</span><span class="ident" id="1627080"><a href="/gostd/runtime/atomic.go.html#1481381">atomicload64</a></span><span class="op" id="1627092">(</span><span class="op" id="1627093">&amp;</span><span class="ident" id="1627094"><a href="/gostd/runtime/mprof.go.html#1626211">blockprofilerate</a></span><span class="op" id="1627110">)</span><span class="op" id="1627111">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627114">if</span>&nbsp;<span class="ident" id="1627117"><a href="/gostd/runtime/mprof.go.html#1627066">rate</a></span>&nbsp;<span class="op" id="1627122">&lt;=</span>&nbsp;<span class="num" id="1627125">0</span>&nbsp;<span class="op" id="1627127">||</span>&nbsp;<span class="op" id="1627130">(</span><span class="ident" id="1627131"><a href="/gostd/runtime/mprof.go.html#1627066">rate</a></span>&nbsp;<span class="op" id="1627136">&gt;</span>&nbsp;<span class="ident" id="1627138"><a href="/gostd/runtime/mprof.go.html#1627005">cycles</a></span>&nbsp;<span class="op" id="1627145">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1627148">int64</span><span class="op" id="1627153">(</span><span class="ident" id="1627154"><a href="/gostd/runtime/stubs.go.html#1742945">fastrand1</a></span><span class="op" id="1627163">(</span><span class="op" id="1627164">)</span><span class="op" id="1627165">)</span><span class="op" id="1627166">%</span><span class="ident" id="1627167"><a href="/gostd/runtime/mprof.go.html#1627066">rate</a></span>&nbsp;<span class="op" id="1627172">&gt;</span>&nbsp;<span class="ident" id="1627174"><a href="/gostd/runtime/mprof.go.html#1627005">cycles</a></span><span class="op" id="1627180">)</span>&nbsp;<span class="op" id="1627182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627186">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627197">gp</span>&nbsp;<span class="op" id="1627200">:=</span>&nbsp;<span class="ident" id="1627203"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1627207">(</span><span class="op" id="1627208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627211">var</span>&nbsp;<span class="ident" id="1627215">nstk</span>&nbsp;<span class="builtintype" id="1627220">int</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627225">var</span>&nbsp;<span class="ident" id="1627229">stk</span>&nbsp;<span class="op" id="1627233">[</span><span class="ident" id="1627234"><a href="/gostd/runtime/mprof.go.html#1620033">maxStack</a></span><span class="op" id="1627242">]</span><span class="builtintype" id="1627243">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627252">if</span>&nbsp;<span class="ident" id="1627255"><a href="/gostd/runtime/mprof.go.html#1627197">gp</a></span><span class="op" id="1627257">.</span><span class="ident" id="1627258"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1627259">.</span><span class="ident" id="1627260"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787912">curg</a></span>&nbsp;<span class="op" id="1627265">==</span>&nbsp;<span class="builtintype" id="1627268">nil</span>&nbsp;<span class="op" id="1627272">||</span>&nbsp;<span class="ident" id="1627275"><a href="/gostd/runtime/mprof.go.html#1627197">gp</a></span><span class="op" id="1627277">.</span><span class="ident" id="1627278"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1627279">.</span><span class="ident" id="1627280"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787912">curg</a></span>&nbsp;<span class="op" id="1627285">==</span>&nbsp;<span class="ident" id="1627288"><a href="/gostd/runtime/mprof.go.html#1627197">gp</a></span>&nbsp;<span class="op" id="1627291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627295"><a href="/gostd/runtime/mprof.go.html#1627215">nstk</a></span>&nbsp;<span class="op" id="1627300">=</span>&nbsp;<span class="ident" id="1627302"><a href="/gostd/runtime/traceback.go.html#1780592">callers</a></span><span class="op" id="1627309">(</span><span class="ident" id="1627310"><a href="/gostd/runtime/mprof.go.html#1627019">skip</a></span><span class="op" id="1627314">,</span>&nbsp;<span class="op" id="1627316">&amp;</span><span class="ident" id="1627317"><a href="/gostd/runtime/mprof.go.html#1627229">stk</a></span><span class="op" id="1627320">[</span><span class="num" id="1627321">0</span><span class="op" id="1627322">]</span><span class="op" id="1627323">,</span>&nbsp;<span class="builtinfunc" id="1627325">len</span><span class="op" id="1627328">(</span><span class="ident" id="1627329"><a href="/gostd/runtime/mprof.go.html#1627229">stk</a></span><span class="op" id="1627332">)</span><span class="op" id="1627333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627336">}</span>&nbsp;<span class="keyword" id="1627338">else</span>&nbsp;<span class="op" id="1627343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627347"><a href="/gostd/runtime/mprof.go.html#1627215">nstk</a></span>&nbsp;<span class="op" id="1627352">=</span>&nbsp;<span class="ident" id="1627354"><a href="/gostd/runtime/traceback.go.html#1780846">gcallers</a></span><span class="op" id="1627362">(</span><span class="ident" id="1627363"><a href="/gostd/runtime/mprof.go.html#1627197">gp</a></span><span class="op" id="1627365">.</span><span class="ident" id="1627366"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1627367">.</span><span class="ident" id="1627368"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787912">curg</a></span><span class="op" id="1627372">,</span>&nbsp;<span class="ident" id="1627374"><a href="/gostd/runtime/mprof.go.html#1627019">skip</a></span><span class="op" id="1627378">,</span>&nbsp;<span class="op" id="1627380">&amp;</span><span class="ident" id="1627381"><a href="/gostd/runtime/mprof.go.html#1627229">stk</a></span><span class="op" id="1627384">[</span><span class="num" id="1627385">0</span><span class="op" id="1627386">]</span><span class="op" id="1627387">,</span>&nbsp;<span class="builtinfunc" id="1627389">len</span><span class="op" id="1627392">(</span><span class="ident" id="1627393"><a href="/gostd/runtime/mprof.go.html#1627229">stk</a></span><span class="op" id="1627396">)</span><span class="op" id="1627397">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627403"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1627407">(</span><span class="op" id="1627408">&amp;</span><span class="ident" id="1627409"><a href="/gostd/runtime/mprof.go.html#1619691">proflock</a></span><span class="op" id="1627417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627420">b</span>&nbsp;<span class="op" id="1627422">:=</span>&nbsp;<span class="ident" id="1627425"><a href="/gostd/runtime/mprof.go.html#1623366">stkbucket</a></span><span class="op" id="1627434">(</span><span class="ident" id="1627435"><a href="/gostd/runtime/mprof.go.html#1619921">blockProfile</a></span><span class="op" id="1627447">,</span>&nbsp;<span class="num" id="1627449">0</span><span class="op" id="1627450">,</span>&nbsp;<span class="ident" id="1627452"><a href="/gostd/runtime/mprof.go.html#1627229">stk</a></span><span class="op" id="1627455">[</span><span class="op" id="1627456">:</span><span class="ident" id="1627457"><a href="/gostd/runtime/mprof.go.html#1627215">nstk</a></span><span class="op" id="1627461">]</span><span class="op" id="1627462">,</span>&nbsp;<span class="builtintype" id="1627464">true</span><span class="op" id="1627468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627471"><a href="/gostd/runtime/mprof.go.html#1627420">b</a></span><span class="op" id="1627472">.</span><span class="ident" id="1627473"><a href="/gostd/runtime/mprof.go.html#1623089">bp</a></span><span class="op" id="1627475">(</span><span class="op" id="1627476">)</span><span class="op" id="1627477">.</span><span class="ident" id="1627478"><a href="/gostd/runtime/mprof.go.html#1621828">count</a></span><span class="op" id="1627483">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627487"><a href="/gostd/runtime/mprof.go.html#1627420">b</a></span><span class="op" id="1627488">.</span><span class="ident" id="1627489"><a href="/gostd/runtime/mprof.go.html#1623089">bp</a></span><span class="op" id="1627491">(</span><span class="op" id="1627492">)</span><span class="op" id="1627493">.</span><span class="ident" id="1627494"><a href="/gostd/runtime/mprof.go.html#1621842">cycles</a></span>&nbsp;<span class="op" id="1627501">+=</span>&nbsp;<span class="ident" id="1627504"><a href="/gostd/runtime/mprof.go.html#1627005">cycles</a></span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627512"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1627518">(</span><span class="op" id="1627519">&amp;</span><span class="ident" id="1627520"><a href="/gostd/runtime/mprof.go.html#1619691">proflock</a></span><span class="op" id="1627528">)</span><br>
<span class="lineno"></span><span class="op" id="1627530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1627533">//&nbsp;Go&nbsp;interface&nbsp;to&nbsp;profile&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="comment" id="1627567">//&nbsp;A&nbsp;StackRecord&nbsp;describes&nbsp;a&nbsp;single&nbsp;execution&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="1627620">type</span>&nbsp;<span class="ident" id="1627625">StackRecord</span>&nbsp;<span class="keyword" id="1627637">struct</span>&nbsp;<span class="op" id="1627644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627647">Stack0</span>&nbsp;<span class="op" id="1627654">[</span><span class="num" id="1627655">32</span><span class="op" id="1627657">]</span><span class="builtintype" id="1627658">uintptr</span>&nbsp;<span class="comment" id="1627666">//&nbsp;stack&nbsp;trace&nbsp;for&nbsp;this&nbsp;record;&nbsp;ends&nbsp;at&nbsp;first&nbsp;0&nbsp;entry</span><br>
<span class="lineno"></span><span class="op" id="1627720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span><span class="comment" id="1627723">//&nbsp;Stack&nbsp;returns&nbsp;the&nbsp;stack&nbsp;trace&nbsp;associated&nbsp;with&nbsp;the&nbsp;record,</span><br>
<span class="lineno"></span><span class="comment" id="1627784">//&nbsp;a&nbsp;prefix&nbsp;of&nbsp;r.Stack0.</span><br>
<span class="lineno"></span><span class="keyword" id="1627809">func</span>&nbsp;<span class="op" id="1627814">(</span><span class="ident" id="1627815">r</span>&nbsp;<span class="op" id="1627817">*</span><span class="ident" id="1627818"><a href="/gostd/runtime/mprof.go.html#1627625">StackRecord</a></span><span class="op" id="1627829">)</span>&nbsp;<span class="ident" id="1627831">Stack</span><span class="op" id="1627836">(</span><span class="op" id="1627837">)</span>&nbsp;<span class="op" id="1627839">[</span><span class="op" id="1627840">]</span><span class="builtintype" id="1627841">uintptr</span>&nbsp;<span class="op" id="1627849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627852">for</span>&nbsp;<span class="ident" id="1627856">i</span><span class="op" id="1627857">,</span>&nbsp;<span class="ident" id="1627859">v</span>&nbsp;<span class="op" id="1627861">:=</span>&nbsp;<span class="keyword" id="1627864">range</span>&nbsp;<span class="ident" id="1627870"><a href="/gostd/runtime/mprof.go.html#1627815">r</a></span><span class="op" id="1627871">.</span><span class="ident" id="1627872"><a href="/gostd/runtime/mprof.go.html#1627647">Stack0</a></span>&nbsp;<span class="op" id="1627879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627883">if</span>&nbsp;<span class="ident" id="1627886"><a href="/gostd/runtime/mprof.go.html#1627859">v</a></span>&nbsp;<span class="op" id="1627888">==</span>&nbsp;<span class="num" id="1627891">0</span>&nbsp;<span class="op" id="1627893">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627898">return</span>&nbsp;<span class="ident" id="1627905"><a href="/gostd/runtime/mprof.go.html#1627815">r</a></span><span class="op" id="1627906">.</span><span class="ident" id="1627907"><a href="/gostd/runtime/mprof.go.html#1627647">Stack0</a></span><span class="op" id="1627913">[</span><span class="num" id="1627914">0</span><span class="op" id="1627915">:</span><span class="ident" id="1627916"><a href="/gostd/runtime/mprof.go.html#1627856">i</a></span><span class="op" id="1627917">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627927">return</span>&nbsp;<span class="ident" id="1627934"><a href="/gostd/runtime/mprof.go.html#1627815">r</a></span><span class="op" id="1627935">.</span><span class="ident" id="1627936"><a href="/gostd/runtime/mprof.go.html#1627647">Stack0</a></span><span class="op" id="1627942">[</span><span class="num" id="1627943">0</span><span class="op" id="1627944">:</span><span class="op" id="1627945">]</span><br>
<span class="lineno"></span><span class="op" id="1627947">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="comment" id="1627950">//&nbsp;MemProfileRate&nbsp;controls&nbsp;the&nbsp;fraction&nbsp;of&nbsp;memory&nbsp;allocations</span><br>
<span class="lineno"></span><span class="comment" id="1628012">//&nbsp;that&nbsp;are&nbsp;recorded&nbsp;and&nbsp;reported&nbsp;in&nbsp;the&nbsp;memory&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="1628069">//&nbsp;The&nbsp;profiler&nbsp;aims&nbsp;to&nbsp;sample&nbsp;an&nbsp;average&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1628114">//&nbsp;one&nbsp;allocation&nbsp;per&nbsp;MemProfileRate&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno">345</span><span class="comment" id="1628168">//</span><br>
<span class="lineno"></span><span class="comment" id="1628171">//&nbsp;To&nbsp;include&nbsp;every&nbsp;allocated&nbsp;block&nbsp;in&nbsp;the&nbsp;profile,&nbsp;set&nbsp;MemProfileRate&nbsp;to&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="1628248">//&nbsp;To&nbsp;turn&nbsp;off&nbsp;profiling&nbsp;entirely,&nbsp;set&nbsp;MemProfileRate&nbsp;to&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="1628308">//</span><br>
<span class="lineno"></span><span class="comment" id="1628311">//&nbsp;The&nbsp;tools&nbsp;that&nbsp;process&nbsp;the&nbsp;memory&nbsp;profiles&nbsp;assume&nbsp;that&nbsp;the</span><br>
<span class="lineno">350</span><span class="comment" id="1628373">//&nbsp;profile&nbsp;rate&nbsp;is&nbsp;constant&nbsp;across&nbsp;the&nbsp;lifetime&nbsp;of&nbsp;the&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="1628436">//&nbsp;and&nbsp;equal&nbsp;to&nbsp;the&nbsp;current&nbsp;value.&nbsp;&nbsp;Programs&nbsp;that&nbsp;change&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1628497">//&nbsp;memory&nbsp;profiling&nbsp;rate&nbsp;should&nbsp;do&nbsp;so&nbsp;just&nbsp;once,&nbsp;as&nbsp;early&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1628558">//&nbsp;possible&nbsp;in&nbsp;the&nbsp;execution&nbsp;of&nbsp;the&nbsp;program&nbsp;(for&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="1628616">//&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;main).</span><br>
<span class="lineno">355</span><span class="keyword" id="1628646">var</span>&nbsp;<span class="ident" id="1628650">MemProfileRate</span>&nbsp;<span class="builtintype" id="1628665">int</span>&nbsp;<span class="op" id="1628669">=</span>&nbsp;<span class="num" id="1628671">512</span>&nbsp;<span class="op" id="1628675">*</span>&nbsp;<span class="num" id="1628677">1024</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1628683">//&nbsp;A&nbsp;MemProfileRecord&nbsp;describes&nbsp;the&nbsp;live&nbsp;objects&nbsp;allocated</span><br>
<span class="lineno"></span><span class="comment" id="1628742">//&nbsp;by&nbsp;a&nbsp;particular&nbsp;call&nbsp;sequence&nbsp;(stack&nbsp;trace).</span><br>
<span class="lineno"></span><span class="keyword" id="1628790">type</span>&nbsp;<span class="ident" id="1628795">MemProfileRecord</span>&nbsp;<span class="keyword" id="1628812">struct</span>&nbsp;<span class="op" id="1628819">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628822">AllocBytes</span><span class="op" id="1628832">,</span>&nbsp;<span class="ident" id="1628834">FreeBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1628848">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1628860">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated,&nbsp;freed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628897">AllocObjects</span><span class="op" id="1628909">,</span>&nbsp;<span class="ident" id="1628911">FreeObjects</span>&nbsp;<span class="builtintype" id="1628923">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1628935">//&nbsp;number&nbsp;of&nbsp;objects&nbsp;allocated,&nbsp;freed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628974">Stack0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1629000">[</span><span class="num" id="1629001">32</span><span class="op" id="1629003">]</span><span class="builtintype" id="1629004">uintptr</span>&nbsp;<span class="comment" id="1629012">//&nbsp;stack&nbsp;trace&nbsp;for&nbsp;this&nbsp;record;&nbsp;ends&nbsp;at&nbsp;first&nbsp;0&nbsp;entry</span><br>
<span class="lineno"></span><span class="op" id="1629066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="1629069">//&nbsp;InUseBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;use&nbsp;(AllocBytes&nbsp;-&nbsp;FreeBytes).</span><br>
<span class="lineno"></span><span class="keyword" id="1629144">func</span>&nbsp;<span class="op" id="1629149">(</span><span class="ident" id="1629150">r</span>&nbsp;<span class="op" id="1629152">*</span><span class="ident" id="1629153"><a href="/gostd/runtime/mprof.go.html#1628795">MemProfileRecord</a></span><span class="op" id="1629169">)</span>&nbsp;<span class="ident" id="1629171">InUseBytes</span><span class="op" id="1629181">(</span><span class="op" id="1629182">)</span>&nbsp;<span class="builtintype" id="1629184">int64</span>&nbsp;<span class="op" id="1629190">{</span>&nbsp;<span class="keyword" id="1629192">return</span>&nbsp;<span class="ident" id="1629199"><a href="/gostd/runtime/mprof.go.html#1629150">r</a></span><span class="op" id="1629200">.</span><span class="ident" id="1629201"><a href="/gostd/runtime/mprof.go.html#1628822">AllocBytes</a></span>&nbsp;<span class="op" id="1629212">-</span>&nbsp;<span class="ident" id="1629214"><a href="/gostd/runtime/mprof.go.html#1629150">r</a></span><span class="op" id="1629215">.</span><span class="ident" id="1629216"><a href="/gostd/runtime/mprof.go.html#1628834">FreeBytes</a></span>&nbsp;<span class="op" id="1629226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1629229">//&nbsp;InUseObjects&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;objects&nbsp;in&nbsp;use&nbsp;(AllocObjects&nbsp;-&nbsp;FreeObjects).</span><br>
<span class="lineno"></span><span class="keyword" id="1629312">func</span>&nbsp;<span class="op" id="1629317">(</span><span class="ident" id="1629318">r</span>&nbsp;<span class="op" id="1629320">*</span><span class="ident" id="1629321"><a href="/gostd/runtime/mprof.go.html#1628795">MemProfileRecord</a></span><span class="op" id="1629337">)</span>&nbsp;<span class="ident" id="1629339">InUseObjects</span><span class="op" id="1629351">(</span><span class="op" id="1629352">)</span>&nbsp;<span class="builtintype" id="1629354">int64</span>&nbsp;<span class="op" id="1629360">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1629363">return</span>&nbsp;<span class="ident" id="1629370"><a href="/gostd/runtime/mprof.go.html#1629318">r</a></span><span class="op" id="1629371">.</span><span class="ident" id="1629372"><a href="/gostd/runtime/mprof.go.html#1628897">AllocObjects</a></span>&nbsp;<span class="op" id="1629385">-</span>&nbsp;<span class="ident" id="1629387"><a href="/gostd/runtime/mprof.go.html#1629318">r</a></span><span class="op" id="1629388">.</span><span class="ident" id="1629389"><a href="/gostd/runtime/mprof.go.html#1628911">FreeObjects</a></span><br>
<span class="lineno"></span><span class="op" id="1629401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1629404">//&nbsp;Stack&nbsp;returns&nbsp;the&nbsp;stack&nbsp;trace&nbsp;associated&nbsp;with&nbsp;the&nbsp;record,</span><br>
<span class="lineno"></span><span class="comment" id="1629465">//&nbsp;a&nbsp;prefix&nbsp;of&nbsp;r.Stack0.</span><br>
<span class="lineno">375</span><span class="keyword" id="1629490">func</span>&nbsp;<span class="op" id="1629495">(</span><span class="ident" id="1629496">r</span>&nbsp;<span class="op" id="1629498">*</span><span class="ident" id="1629499"><a href="/gostd/runtime/mprof.go.html#1628795">MemProfileRecord</a></span><span class="op" id="1629515">)</span>&nbsp;<span class="ident" id="1629517">Stack</span><span class="op" id="1629522">(</span><span class="op" id="1629523">)</span>&nbsp;<span class="op" id="1629525">[</span><span class="op" id="1629526">]</span><span class="builtintype" id="1629527">uintptr</span>&nbsp;<span class="op" id="1629535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1629538">for</span>&nbsp;<span class="ident" id="1629542">i</span><span class="op" id="1629543">,</span>&nbsp;<span class="ident" id="1629545">v</span>&nbsp;<span class="op" id="1629547">:=</span>&nbsp;<span class="keyword" id="1629550">range</span>&nbsp;<span class="ident" id="1629556"><a href="/gostd/runtime/mprof.go.html#1629496">r</a></span><span class="op" id="1629557">.</span><span class="ident" id="1629558"><a href="/gostd/runtime/mprof.go.html#1628974">Stack0</a></span>&nbsp;<span class="op" id="1629565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1629569">if</span>&nbsp;<span class="ident" id="1629572"><a href="/gostd/runtime/mprof.go.html#1629545">v</a></span>&nbsp;<span class="op" id="1629574">==</span>&nbsp;<span class="num" id="1629577">0</span>&nbsp;<span class="op" id="1629579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1629584">return</span>&nbsp;<span class="ident" id="1629591"><a href="/gostd/runtime/mprof.go.html#1629496">r</a></span><span class="op" id="1629592">.</span><span class="ident" id="1629593"><a href="/gostd/runtime/mprof.go.html#1628974">Stack0</a></span><span class="op" id="1629599">[</span><span class="num" id="1629600">0</span><span class="op" id="1629601">:</span><span class="ident" id="1629602"><a href="/gostd/runtime/mprof.go.html#1629542">i</a></span><span class="op" id="1629603">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1629607">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1629610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1629613">return</span>&nbsp;<span class="ident" id="1629620"><a href="/gostd/runtime/mprof.go.html#1629496">r</a></span><span class="op" id="1629621">.</span><span class="ident" id="1629622"><a href="/gostd/runtime/mprof.go.html#1628974">Stack0</a></span><span class="op" id="1629628">[</span><span class="num" id="1629629">0</span><span class="op" id="1629630">:</span><span class="op" id="1629631">]</span><br>
<span class="lineno"></span><span class="op" id="1629633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1629636">//&nbsp;MemProfile&nbsp;returns&nbsp;n,&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;current&nbsp;memory&nbsp;profile.</span><br>
<span class="lineno">385</span><span class="comment" id="1629714">//&nbsp;If&nbsp;len(p)&nbsp;&gt;=&nbsp;n,&nbsp;MemProfile&nbsp;copies&nbsp;the&nbsp;profile&nbsp;into&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;true.</span><br>
<span class="lineno"></span><span class="comment" id="1629791">//&nbsp;If&nbsp;len(p)&nbsp;&lt;&nbsp;n,&nbsp;MemProfile&nbsp;does&nbsp;not&nbsp;change&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="1629860">//</span><br>
<span class="lineno"></span><span class="comment" id="1629863">//&nbsp;If&nbsp;inuseZero&nbsp;is&nbsp;true,&nbsp;the&nbsp;profile&nbsp;includes&nbsp;allocation&nbsp;records</span><br>
<span class="lineno"></span><span class="comment" id="1629928">//&nbsp;where&nbsp;r.AllocBytes&nbsp;&gt;&nbsp;0&nbsp;but&nbsp;r.AllocBytes&nbsp;==&nbsp;r.FreeBytes.</span><br>
<span class="lineno">390</span><span class="comment" id="1629987">//&nbsp;These&nbsp;are&nbsp;sites&nbsp;where&nbsp;memory&nbsp;was&nbsp;allocated,&nbsp;but&nbsp;it&nbsp;has&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="1630049">//&nbsp;been&nbsp;released&nbsp;back&nbsp;to&nbsp;the&nbsp;runtime.</span><br>
<span class="lineno"></span><span class="comment" id="1630087">//</span><br>
<span class="lineno"></span><span class="comment" id="1630090">//&nbsp;Most&nbsp;clients&nbsp;should&nbsp;use&nbsp;the&nbsp;runtime/pprof&nbsp;package&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="1630146">//&nbsp;the&nbsp;testing&nbsp;package&#39;s&nbsp;-test.memprofile&nbsp;flag&nbsp;instead</span><br>
<span class="lineno">395</span><span class="comment" id="1630201">//&nbsp;of&nbsp;calling&nbsp;MemProfile&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="1630236">func</span>&nbsp;<span class="ident" id="1630241">MemProfile</span><span class="op" id="1630251">(</span><span class="ident" id="1630252">p</span>&nbsp;<span class="op" id="1630254">[</span><span class="op" id="1630255">]</span><span class="ident" id="1630256"><a href="/gostd/runtime/mprof.go.html#1628795">MemProfileRecord</a></span><span class="op" id="1630272">,</span>&nbsp;<span class="ident" id="1630274">inuseZero</span>&nbsp;<span class="builtintype" id="1630284">bool</span><span class="op" id="1630288">)</span>&nbsp;<span class="op" id="1630290">(</span><span class="ident" id="1630291">n</span>&nbsp;<span class="builtintype" id="1630293">int</span><span class="op" id="1630296">,</span>&nbsp;<span class="ident" id="1630298">ok</span>&nbsp;<span class="builtintype" id="1630301">bool</span><span class="op" id="1630305">)</span>&nbsp;<span class="op" id="1630307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1630310"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1630314">(</span><span class="op" id="1630315">&amp;</span><span class="ident" id="1630316"><a href="/gostd/runtime/mprof.go.html#1619691">proflock</a></span><span class="op" id="1630324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1630327">clear</span>&nbsp;<span class="op" id="1630333">:=</span>&nbsp;<span class="builtintype" id="1630336">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1630342">for</span>&nbsp;<span class="ident" id="1630346">b</span>&nbsp;<span class="op" id="1630348">:=</span>&nbsp;<span class="ident" id="1630351"><a href="/gostd/runtime/mprof.go.html#1621865">mbuckets</a></span><span class="op" id="1630359">;</span>&nbsp;<span class="ident" id="1630361"><a href="/gostd/runtime/mprof.go.html#1630346">b</a></span>&nbsp;<span class="op" id="1630363">!=</span>&nbsp;<span class="builtintype" id="1630366">nil</span><span class="op" id="1630369">;</span>&nbsp;<span class="ident" id="1630371"><a href="/gostd/runtime/mprof.go.html#1630346">b</a></span>&nbsp;<span class="op" id="1630373">=</span>&nbsp;<span class="ident" id="1630375"><a href="/gostd/runtime/mprof.go.html#1630346">b</a></span><span class="op" id="1630376">.</span><span class="ident" id="1630377"><a href="/gostd/runtime/mprof.go.html#1620492">allnext</a></span>&nbsp;<span class="op" id="1630385">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1630389">mp</span>&nbsp;<span class="op" id="1630392">:=</span>&nbsp;<span class="ident" id="1630395"><a href="/gostd/runtime/mprof.go.html#1630346">b</a></span><span class="op" id="1630396">.</span><span class="ident" id="1630397"><a href="/gostd/runtime/mprof.go.html#1622804">mp</a></span><span class="op" id="1630399">(</span><span class="op" id="1630400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1630404">if</span>&nbsp;<span class="ident" id="1630407"><a href="/gostd/runtime/mprof.go.html#1630274">inuseZero</a></span>&nbsp;<span class="op" id="1630417">||</span>&nbsp;<span class="ident" id="1630420"><a href="/gostd/runtime/mprof.go.html#1630389">mp</a></span><span class="op" id="1630422">.</span><span class="ident" id="1630423"><a href="/gostd/runtime/mprof.go.html#1621361">alloc_bytes</a></span>&nbsp;<span class="op" id="1630435">!=</span>&nbsp;<span class="ident" id="1630438"><a href="/gostd/runtime/mprof.go.html#1630389">mp</a></span><span class="op" id="1630440">.</span><span class="ident" id="1630441"><a href="/gostd/runtime/mprof.go.html#1621382">free_bytes</a></span>&nbsp;<span class="op" id="1630452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1630457"><a href="/gostd/runtime/mprof.go.html#1630291">n</a></span><span class="op" id="1630458">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1630463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1630467">if</span>&nbsp;<span class="ident" id="1630470"><a href="/gostd/runtime/mprof.go.html#1630389">mp</a></span><span class="op" id="1630472">.</span><span class="ident" id="1630473"><a href="/gostd/runtime/mprof.go.html#1621319">allocs</a></span>&nbsp;<span class="op" id="1630480">!=</span>&nbsp;<span class="num" id="1630483">0</span>&nbsp;<span class="op" id="1630485">||</span>&nbsp;<span class="ident" id="1630488"><a href="/gostd/runtime/mprof.go.html#1630389">mp</a></span><span class="op" id="1630490">.</span><span class="ident" id="1630491"><a href="/gostd/runtime/mprof.go.html#1621340">frees</a></span>&nbsp;<span class="op" id="1630497">!=</span>&nbsp;<span class="num" id="1630500">0</span>&nbsp;<span class="op" id="1630502">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1630507"><a href="/gostd/runtime/mprof.go.html#1630327">clear</a></span>&nbsp;<span class="op" id="1630513">=</span>&nbsp;<span class="builtintype" id="1630515">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1630523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1630526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1630529">if</span>&nbsp;<span class="ident" id="1630532"><a href="/gostd/runtime/mprof.go.html#1630327">clear</a></span>&nbsp;<span class="op" id="1630538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1630542">//&nbsp;Absolutely&nbsp;no&nbsp;data,&nbsp;suggesting&nbsp;that&nbsp;a&nbsp;garbage&nbsp;collection</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1630604">//&nbsp;has&nbsp;not&nbsp;yet&nbsp;happened.&nbsp;In&nbsp;order&nbsp;to&nbsp;allow&nbsp;profiling&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1630664">//&nbsp;garbage&nbsp;collection&nbsp;is&nbsp;disabled&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;execution,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1630733">//&nbsp;accumulate&nbsp;stats&nbsp;as&nbsp;if&nbsp;a&nbsp;GC&nbsp;just&nbsp;happened,&nbsp;and&nbsp;recount&nbsp;buckets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1630802"><a href="/gostd/runtime/mprof.go.html#1624521">mprof_GC</a></span><span class="op" id="1630810">(</span><span class="op" id="1630811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1630815"><a href="/gostd/runtime/mprof.go.html#1624521">mprof_GC</a></span><span class="op" id="1630823">(</span><span class="op" id="1630824">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1630828"><a href="/gostd/runtime/mprof.go.html#1630291">n</a></span>&nbsp;<span class="op" id="1630830">=</span>&nbsp;<span class="num" id="1630832">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1630836">for</span>&nbsp;<span class="ident" id="1630840">b</span>&nbsp;<span class="op" id="1630842">:=</span>&nbsp;<span class="ident" id="1630845"><a href="/gostd/runtime/mprof.go.html#1621865">mbuckets</a></span><span class="op" id="1630853">;</span>&nbsp;<span class="ident" id="1630855"><a href="/gostd/runtime/mprof.go.html#1630840">b</a></span>&nbsp;<span class="op" id="1630857">!=</span>&nbsp;<span class="builtintype" id="1630860">nil</span><span class="op" id="1630863">;</span>&nbsp;<span class="ident" id="1630865"><a href="/gostd/runtime/mprof.go.html#1630840">b</a></span>&nbsp;<span class="op" id="1630867">=</span>&nbsp;<span class="ident" id="1630869"><a href="/gostd/runtime/mprof.go.html#1630840">b</a></span><span class="op" id="1630870">.</span><span class="ident" id="1630871"><a href="/gostd/runtime/mprof.go.html#1620492">allnext</a></span>&nbsp;<span class="op" id="1630879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1630884">mp</span>&nbsp;<span class="op" id="1630887">:=</span>&nbsp;<span class="ident" id="1630890"><a href="/gostd/runtime/mprof.go.html#1630840">b</a></span><span class="op" id="1630891">.</span><span class="ident" id="1630892"><a href="/gostd/runtime/mprof.go.html#1622804">mp</a></span><span class="op" id="1630894">(</span><span class="op" id="1630895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1630900">if</span>&nbsp;<span class="ident" id="1630903"><a href="/gostd/runtime/mprof.go.html#1630274">inuseZero</a></span>&nbsp;<span class="op" id="1630913">||</span>&nbsp;<span class="ident" id="1630916"><a href="/gostd/runtime/mprof.go.html#1630884">mp</a></span><span class="op" id="1630918">.</span><span class="ident" id="1630919"><a href="/gostd/runtime/mprof.go.html#1621361">alloc_bytes</a></span>&nbsp;<span class="op" id="1630931">!=</span>&nbsp;<span class="ident" id="1630934"><a href="/gostd/runtime/mprof.go.html#1630884">mp</a></span><span class="op" id="1630936">.</span><span class="ident" id="1630937"><a href="/gostd/runtime/mprof.go.html#1621382">free_bytes</a></span>&nbsp;<span class="op" id="1630948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1630954"><a href="/gostd/runtime/mprof.go.html#1630291">n</a></span><span class="op" id="1630955">++</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1630961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1630965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1630968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1630971">if</span>&nbsp;<span class="ident" id="1630974"><a href="/gostd/runtime/mprof.go.html#1630291">n</a></span>&nbsp;<span class="op" id="1630976">&lt;=</span>&nbsp;<span class="builtinfunc" id="1630979">len</span><span class="op" id="1630982">(</span><span class="ident" id="1630983"><a href="/gostd/runtime/mprof.go.html#1630252">p</a></span><span class="op" id="1630984">)</span>&nbsp;<span class="op" id="1630986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1630990"><a href="/gostd/runtime/mprof.go.html#1630298">ok</a></span>&nbsp;<span class="op" id="1630993">=</span>&nbsp;<span class="builtintype" id="1630995">true</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631002">idx</span>&nbsp;<span class="op" id="1631006">:=</span>&nbsp;<span class="num" id="1631009">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1631013">for</span>&nbsp;<span class="ident" id="1631017">b</span>&nbsp;<span class="op" id="1631019">:=</span>&nbsp;<span class="ident" id="1631022"><a href="/gostd/runtime/mprof.go.html#1621865">mbuckets</a></span><span class="op" id="1631030">;</span>&nbsp;<span class="ident" id="1631032"><a href="/gostd/runtime/mprof.go.html#1631017">b</a></span>&nbsp;<span class="op" id="1631034">!=</span>&nbsp;<span class="builtintype" id="1631037">nil</span><span class="op" id="1631040">;</span>&nbsp;<span class="ident" id="1631042"><a href="/gostd/runtime/mprof.go.html#1631017">b</a></span>&nbsp;<span class="op" id="1631044">=</span>&nbsp;<span class="ident" id="1631046"><a href="/gostd/runtime/mprof.go.html#1631017">b</a></span><span class="op" id="1631047">.</span><span class="ident" id="1631048"><a href="/gostd/runtime/mprof.go.html#1620492">allnext</a></span>&nbsp;<span class="op" id="1631056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631061">mp</span>&nbsp;<span class="op" id="1631064">:=</span>&nbsp;<span class="ident" id="1631067"><a href="/gostd/runtime/mprof.go.html#1631017">b</a></span><span class="op" id="1631068">.</span><span class="ident" id="1631069"><a href="/gostd/runtime/mprof.go.html#1622804">mp</a></span><span class="op" id="1631071">(</span><span class="op" id="1631072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1631077">if</span>&nbsp;<span class="ident" id="1631080"><a href="/gostd/runtime/mprof.go.html#1630274">inuseZero</a></span>&nbsp;<span class="op" id="1631090">||</span>&nbsp;<span class="ident" id="1631093"><a href="/gostd/runtime/mprof.go.html#1631061">mp</a></span><span class="op" id="1631095">.</span><span class="ident" id="1631096"><a href="/gostd/runtime/mprof.go.html#1621361">alloc_bytes</a></span>&nbsp;<span class="op" id="1631108">!=</span>&nbsp;<span class="ident" id="1631111"><a href="/gostd/runtime/mprof.go.html#1631061">mp</a></span><span class="op" id="1631113">.</span><span class="ident" id="1631114"><a href="/gostd/runtime/mprof.go.html#1621382">free_bytes</a></span>&nbsp;<span class="op" id="1631125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631131"><a href="/gostd/runtime/mprof.go.html#1631231">record</a></span><span class="op" id="1631137">(</span><span class="op" id="1631138">&amp;</span><span class="ident" id="1631139"><a href="/gostd/runtime/mprof.go.html#1630252">p</a></span><span class="op" id="1631140">[</span><span class="ident" id="1631141"><a href="/gostd/runtime/mprof.go.html#1631002">idx</a></span><span class="op" id="1631144">]</span><span class="op" id="1631145">,</span>&nbsp;<span class="ident" id="1631147"><a href="/gostd/runtime/mprof.go.html#1631017">b</a></span><span class="op" id="1631148">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631154"><a href="/gostd/runtime/mprof.go.html#1631002">idx</a></span><span class="op" id="1631157">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1631163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1631167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1631170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631173"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1631179">(</span><span class="op" id="1631180">&amp;</span><span class="ident" id="1631181"><a href="/gostd/runtime/mprof.go.html#1619691">proflock</a></span><span class="op" id="1631189">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1631192">return</span><br>
<span class="lineno"></span><span class="op" id="1631199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1631202">//&nbsp;Write&nbsp;b&#39;s&nbsp;data&nbsp;to&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="1631226">func</span>&nbsp;<span class="ident" id="1631231">record</span><span class="op" id="1631237">(</span><span class="ident" id="1631238">r</span>&nbsp;<span class="op" id="1631240">*</span><span class="ident" id="1631241"><a href="/gostd/runtime/mprof.go.html#1628795">MemProfileRecord</a></span><span class="op" id="1631257">,</span>&nbsp;<span class="ident" id="1631259">b</span>&nbsp;<span class="op" id="1631261">*</span><span class="ident" id="1631262"><a href="/gostd/runtime/mprof.go.html#1620458">bucket</a></span><span class="op" id="1631268">)</span>&nbsp;<span class="op" id="1631270">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631273">mp</span>&nbsp;<span class="op" id="1631276">:=</span>&nbsp;<span class="ident" id="1631279"><a href="/gostd/runtime/mprof.go.html#1631259">b</a></span><span class="op" id="1631280">.</span><span class="ident" id="1631281"><a href="/gostd/runtime/mprof.go.html#1622804">mp</a></span><span class="op" id="1631283">(</span><span class="op" id="1631284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631287"><a href="/gostd/runtime/mprof.go.html#1631238">r</a></span><span class="op" id="1631288">.</span><span class="ident" id="1631289"><a href="/gostd/runtime/mprof.go.html#1628822">AllocBytes</a></span>&nbsp;<span class="op" id="1631300">=</span>&nbsp;<span class="builtintype" id="1631302">int64</span><span class="op" id="1631307">(</span><span class="ident" id="1631308"><a href="/gostd/runtime/mprof.go.html#1631273">mp</a></span><span class="op" id="1631310">.</span><span class="ident" id="1631311"><a href="/gostd/runtime/mprof.go.html#1621361">alloc_bytes</a></span><span class="op" id="1631322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631325"><a href="/gostd/runtime/mprof.go.html#1631238">r</a></span><span class="op" id="1631326">.</span><span class="ident" id="1631327"><a href="/gostd/runtime/mprof.go.html#1628834">FreeBytes</a></span>&nbsp;<span class="op" id="1631337">=</span>&nbsp;<span class="builtintype" id="1631339">int64</span><span class="op" id="1631344">(</span><span class="ident" id="1631345"><a href="/gostd/runtime/mprof.go.html#1631273">mp</a></span><span class="op" id="1631347">.</span><span class="ident" id="1631348"><a href="/gostd/runtime/mprof.go.html#1621382">free_bytes</a></span><span class="op" id="1631358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631361"><a href="/gostd/runtime/mprof.go.html#1631238">r</a></span><span class="op" id="1631362">.</span><span class="ident" id="1631363"><a href="/gostd/runtime/mprof.go.html#1628897">AllocObjects</a></span>&nbsp;<span class="op" id="1631376">=</span>&nbsp;<span class="builtintype" id="1631378">int64</span><span class="op" id="1631383">(</span><span class="ident" id="1631384"><a href="/gostd/runtime/mprof.go.html#1631273">mp</a></span><span class="op" id="1631386">.</span><span class="ident" id="1631387"><a href="/gostd/runtime/mprof.go.html#1621319">allocs</a></span><span class="op" id="1631393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631396"><a href="/gostd/runtime/mprof.go.html#1631238">r</a></span><span class="op" id="1631397">.</span><span class="ident" id="1631398"><a href="/gostd/runtime/mprof.go.html#1628911">FreeObjects</a></span>&nbsp;<span class="op" id="1631410">=</span>&nbsp;<span class="builtintype" id="1631412">int64</span><span class="op" id="1631417">(</span><span class="ident" id="1631418"><a href="/gostd/runtime/mprof.go.html#1631273">mp</a></span><span class="op" id="1631420">.</span><span class="ident" id="1631421"><a href="/gostd/runtime/mprof.go.html#1621340">frees</a></span><span class="op" id="1631426">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1631429">copy</span><span class="op" id="1631433">(</span><span class="ident" id="1631434"><a href="/gostd/runtime/mprof.go.html#1631238">r</a></span><span class="op" id="1631435">.</span><span class="ident" id="1631436"><a href="/gostd/runtime/mprof.go.html#1628974">Stack0</a></span><span class="op" id="1631442">[</span><span class="op" id="1631443">:</span><span class="op" id="1631444">]</span><span class="op" id="1631445">,</span>&nbsp;<span class="ident" id="1631447"><a href="/gostd/runtime/mprof.go.html#1631259">b</a></span><span class="op" id="1631448">.</span><span class="ident" id="1631449"><a href="/gostd/runtime/mprof.go.html#1622597">stk</a></span><span class="op" id="1631452">(</span><span class="op" id="1631453">)</span><span class="op" id="1631454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1631457">for</span>&nbsp;<span class="ident" id="1631461">i</span>&nbsp;<span class="op" id="1631463">:=</span>&nbsp;<span class="builtintype" id="1631466">int</span><span class="op" id="1631469">(</span><span class="ident" id="1631470"><a href="/gostd/runtime/mprof.go.html#1631259">b</a></span><span class="op" id="1631471">.</span><span class="ident" id="1631472"><a href="/gostd/runtime/mprof.go.html#1620591">nstk</a></span><span class="op" id="1631476">)</span><span class="op" id="1631477">;</span>&nbsp;<span class="ident" id="1631479"><a href="/gostd/runtime/mprof.go.html#1631461">i</a></span>&nbsp;<span class="op" id="1631481">&lt;</span>&nbsp;<span class="builtinfunc" id="1631483">len</span><span class="op" id="1631486">(</span><span class="ident" id="1631487"><a href="/gostd/runtime/mprof.go.html#1631238">r</a></span><span class="op" id="1631488">.</span><span class="ident" id="1631489"><a href="/gostd/runtime/mprof.go.html#1628974">Stack0</a></span><span class="op" id="1631495">)</span><span class="op" id="1631496">;</span>&nbsp;<span class="ident" id="1631498"><a href="/gostd/runtime/mprof.go.html#1631461">i</a></span><span class="op" id="1631499">++</span>&nbsp;<span class="op" id="1631502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631506"><a href="/gostd/runtime/mprof.go.html#1631238">r</a></span><span class="op" id="1631507">.</span><span class="ident" id="1631508"><a href="/gostd/runtime/mprof.go.html#1628974">Stack0</a></span><span class="op" id="1631514">[</span><span class="ident" id="1631515"><a href="/gostd/runtime/mprof.go.html#1631461">i</a></span><span class="op" id="1631516">]</span>&nbsp;<span class="op" id="1631518">=</span>&nbsp;<span class="num" id="1631520">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1631523">}</span><br>
<span class="lineno"></span><span class="op" id="1631525">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="keyword" id="1631528">func</span>&nbsp;<span class="ident" id="1631533">iterate_memprof</span><span class="op" id="1631548">(</span><span class="ident" id="1631549">fn</span>&nbsp;<span class="keyword" id="1631552">func</span><span class="op" id="1631556">(</span><span class="op" id="1631557">*</span><span class="ident" id="1631558"><a href="/gostd/runtime/mprof.go.html#1620458">bucket</a></span><span class="op" id="1631564">,</span>&nbsp;<span class="builtintype" id="1631566">uintptr</span><span class="op" id="1631573">,</span>&nbsp;<span class="op" id="1631575">*</span><span class="builtintype" id="1631576">uintptr</span><span class="op" id="1631583">,</span>&nbsp;<span class="builtintype" id="1631585">uintptr</span><span class="op" id="1631592">,</span>&nbsp;<span class="builtintype" id="1631594">uintptr</span><span class="op" id="1631601">,</span>&nbsp;<span class="builtintype" id="1631603">uintptr</span><span class="op" id="1631610">)</span><span class="op" id="1631611">)</span>&nbsp;<span class="op" id="1631613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631616"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1631620">(</span><span class="op" id="1631621">&amp;</span><span class="ident" id="1631622"><a href="/gostd/runtime/mprof.go.html#1619691">proflock</a></span><span class="op" id="1631630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1631633">for</span>&nbsp;<span class="ident" id="1631637">b</span>&nbsp;<span class="op" id="1631639">:=</span>&nbsp;<span class="ident" id="1631642"><a href="/gostd/runtime/mprof.go.html#1621865">mbuckets</a></span><span class="op" id="1631650">;</span>&nbsp;<span class="ident" id="1631652"><a href="/gostd/runtime/mprof.go.html#1631637">b</a></span>&nbsp;<span class="op" id="1631654">!=</span>&nbsp;<span class="builtintype" id="1631657">nil</span><span class="op" id="1631660">;</span>&nbsp;<span class="ident" id="1631662"><a href="/gostd/runtime/mprof.go.html#1631637">b</a></span>&nbsp;<span class="op" id="1631664">=</span>&nbsp;<span class="ident" id="1631666"><a href="/gostd/runtime/mprof.go.html#1631637">b</a></span><span class="op" id="1631667">.</span><span class="ident" id="1631668"><a href="/gostd/runtime/mprof.go.html#1620492">allnext</a></span>&nbsp;<span class="op" id="1631676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631680">mp</span>&nbsp;<span class="op" id="1631683">:=</span>&nbsp;<span class="ident" id="1631686"><a href="/gostd/runtime/mprof.go.html#1631637">b</a></span><span class="op" id="1631687">.</span><span class="ident" id="1631688"><a href="/gostd/runtime/mprof.go.html#1622804">mp</a></span><span class="op" id="1631690">(</span><span class="op" id="1631691">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631695"><a href="/gostd/runtime/mprof.go.html#1631549">fn</a></span><span class="op" id="1631697">(</span><span class="ident" id="1631698"><a href="/gostd/runtime/mprof.go.html#1631637">b</a></span><span class="op" id="1631699">,</span>&nbsp;<span class="builtintype" id="1631701">uintptr</span><span class="op" id="1631708">(</span><span class="ident" id="1631709"><a href="/gostd/runtime/mprof.go.html#1631637">b</a></span><span class="op" id="1631710">.</span><span class="ident" id="1631711"><a href="/gostd/runtime/mprof.go.html#1620591">nstk</a></span><span class="op" id="1631715">)</span><span class="op" id="1631716">,</span>&nbsp;<span class="op" id="1631718">&amp;</span><span class="ident" id="1631719"><a href="/gostd/runtime/mprof.go.html#1631637">b</a></span><span class="op" id="1631720">.</span><span class="ident" id="1631721"><a href="/gostd/runtime/mprof.go.html#1622597">stk</a></span><span class="op" id="1631724">(</span><span class="op" id="1631725">)</span><span class="op" id="1631726">[</span><span class="num" id="1631727">0</span><span class="op" id="1631728">]</span><span class="op" id="1631729">,</span>&nbsp;<span class="ident" id="1631731"><a href="/gostd/runtime/mprof.go.html#1631637">b</a></span><span class="op" id="1631732">.</span><span class="ident" id="1631733"><a href="/gostd/runtime/mprof.go.html#1620574">size</a></span><span class="op" id="1631737">,</span>&nbsp;<span class="ident" id="1631739"><a href="/gostd/runtime/mprof.go.html#1631680">mp</a></span><span class="op" id="1631741">.</span><span class="ident" id="1631742"><a href="/gostd/runtime/mprof.go.html#1621319">allocs</a></span><span class="op" id="1631748">,</span>&nbsp;<span class="ident" id="1631750"><a href="/gostd/runtime/mprof.go.html#1631680">mp</a></span><span class="op" id="1631752">.</span><span class="ident" id="1631753"><a href="/gostd/runtime/mprof.go.html#1621340">frees</a></span><span class="op" id="1631758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1631761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631764"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1631770">(</span><span class="op" id="1631771">&amp;</span><span class="ident" id="1631772"><a href="/gostd/runtime/mprof.go.html#1619691">proflock</a></span><span class="op" id="1631780">)</span><br>
<span class="lineno"></span><span class="op" id="1631782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="comment" id="1631785">//&nbsp;BlockProfileRecord&nbsp;describes&nbsp;blocking&nbsp;events&nbsp;originated</span><br>
<span class="lineno"></span><span class="comment" id="1631844">//&nbsp;at&nbsp;a&nbsp;particular&nbsp;call&nbsp;sequence&nbsp;(stack&nbsp;trace).</span><br>
<span class="lineno"></span><span class="keyword" id="1631892">type</span>&nbsp;<span class="ident" id="1631897">BlockProfileRecord</span>&nbsp;<span class="keyword" id="1631916">struct</span>&nbsp;<span class="op" id="1631923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631926">Count</span>&nbsp;&nbsp;<span class="builtintype" id="1631933">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631940">Cycles</span>&nbsp;<span class="builtintype" id="1631947">int64</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631954"><a href="/gostd/runtime/mprof.go.html#1627625">StackRecord</a></span><br>
<span class="lineno"></span><span class="op" id="1631966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1631969">//&nbsp;BlockProfile&nbsp;returns&nbsp;n,&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;current&nbsp;blocking&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="1632051">//&nbsp;If&nbsp;len(p)&nbsp;&gt;=&nbsp;n,&nbsp;BlockProfile&nbsp;copies&nbsp;the&nbsp;profile&nbsp;into&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;true.</span><br>
<span class="lineno">470</span><span class="comment" id="1632130">//&nbsp;If&nbsp;len(p)&nbsp;&lt;&nbsp;n,&nbsp;BlockProfile&nbsp;does&nbsp;not&nbsp;change&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="1632201">//</span><br>
<span class="lineno"></span><span class="comment" id="1632204">//&nbsp;Most&nbsp;clients&nbsp;should&nbsp;use&nbsp;the&nbsp;runtime/pprof&nbsp;package&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="1632260">//&nbsp;the&nbsp;testing&nbsp;package&#39;s&nbsp;-test.blockprofile&nbsp;flag&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="1632317">//&nbsp;of&nbsp;calling&nbsp;BlockProfile&nbsp;directly.</span><br>
<span class="lineno">475</span><span class="keyword" id="1632354">func</span>&nbsp;<span class="ident" id="1632359">BlockProfile</span><span class="op" id="1632371">(</span><span class="ident" id="1632372">p</span>&nbsp;<span class="op" id="1632374">[</span><span class="op" id="1632375">]</span><span class="ident" id="1632376"><a href="/gostd/runtime/mprof.go.html#1631897">BlockProfileRecord</a></span><span class="op" id="1632394">)</span>&nbsp;<span class="op" id="1632396">(</span><span class="ident" id="1632397">n</span>&nbsp;<span class="builtintype" id="1632399">int</span><span class="op" id="1632402">,</span>&nbsp;<span class="ident" id="1632404">ok</span>&nbsp;<span class="builtintype" id="1632407">bool</span><span class="op" id="1632411">)</span>&nbsp;<span class="op" id="1632413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632416"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1632420">(</span><span class="op" id="1632421">&amp;</span><span class="ident" id="1632422"><a href="/gostd/runtime/mprof.go.html#1619691">proflock</a></span><span class="op" id="1632430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1632433">for</span>&nbsp;<span class="ident" id="1632437">b</span>&nbsp;<span class="op" id="1632439">:=</span>&nbsp;<span class="ident" id="1632442"><a href="/gostd/runtime/mprof.go.html#1621910">bbuckets</a></span><span class="op" id="1632450">;</span>&nbsp;<span class="ident" id="1632452"><a href="/gostd/runtime/mprof.go.html#1632437">b</a></span>&nbsp;<span class="op" id="1632454">!=</span>&nbsp;<span class="builtintype" id="1632457">nil</span><span class="op" id="1632460">;</span>&nbsp;<span class="ident" id="1632462"><a href="/gostd/runtime/mprof.go.html#1632437">b</a></span>&nbsp;<span class="op" id="1632464">=</span>&nbsp;<span class="ident" id="1632466"><a href="/gostd/runtime/mprof.go.html#1632437">b</a></span><span class="op" id="1632467">.</span><span class="ident" id="1632468"><a href="/gostd/runtime/mprof.go.html#1620492">allnext</a></span>&nbsp;<span class="op" id="1632476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632480"><a href="/gostd/runtime/mprof.go.html#1632397">n</a></span><span class="op" id="1632481">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1632485">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1632488">if</span>&nbsp;<span class="ident" id="1632491"><a href="/gostd/runtime/mprof.go.html#1632397">n</a></span>&nbsp;<span class="op" id="1632493">&lt;=</span>&nbsp;<span class="builtinfunc" id="1632496">len</span><span class="op" id="1632499">(</span><span class="ident" id="1632500"><a href="/gostd/runtime/mprof.go.html#1632372">p</a></span><span class="op" id="1632501">)</span>&nbsp;<span class="op" id="1632503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632507"><a href="/gostd/runtime/mprof.go.html#1632404">ok</a></span>&nbsp;<span class="op" id="1632510">=</span>&nbsp;<span class="builtintype" id="1632512">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1632519">for</span>&nbsp;<span class="ident" id="1632523">b</span>&nbsp;<span class="op" id="1632525">:=</span>&nbsp;<span class="ident" id="1632528"><a href="/gostd/runtime/mprof.go.html#1621910">bbuckets</a></span><span class="op" id="1632536">;</span>&nbsp;<span class="ident" id="1632538"><a href="/gostd/runtime/mprof.go.html#1632523">b</a></span>&nbsp;<span class="op" id="1632540">!=</span>&nbsp;<span class="builtintype" id="1632543">nil</span><span class="op" id="1632546">;</span>&nbsp;<span class="ident" id="1632548"><a href="/gostd/runtime/mprof.go.html#1632523">b</a></span>&nbsp;<span class="op" id="1632550">=</span>&nbsp;<span class="ident" id="1632552"><a href="/gostd/runtime/mprof.go.html#1632523">b</a></span><span class="op" id="1632553">.</span><span class="ident" id="1632554"><a href="/gostd/runtime/mprof.go.html#1620492">allnext</a></span>&nbsp;<span class="op" id="1632562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632567">bp</span>&nbsp;<span class="op" id="1632570">:=</span>&nbsp;<span class="ident" id="1632573"><a href="/gostd/runtime/mprof.go.html#1632523">b</a></span><span class="op" id="1632574">.</span><span class="ident" id="1632575"><a href="/gostd/runtime/mprof.go.html#1623089">bp</a></span><span class="op" id="1632577">(</span><span class="op" id="1632578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632583">r</span>&nbsp;<span class="op" id="1632585">:=</span>&nbsp;<span class="op" id="1632588">&amp;</span><span class="ident" id="1632589"><a href="/gostd/runtime/mprof.go.html#1632372">p</a></span><span class="op" id="1632590">[</span><span class="num" id="1632591">0</span><span class="op" id="1632592">]</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632597"><a href="/gostd/runtime/mprof.go.html#1632583">r</a></span><span class="op" id="1632598">.</span><span class="ident" id="1632599"><a href="/gostd/runtime/mprof.go.html#1631926">Count</a></span>&nbsp;<span class="op" id="1632605">=</span>&nbsp;<span class="builtintype" id="1632607">int64</span><span class="op" id="1632612">(</span><span class="ident" id="1632613"><a href="/gostd/runtime/mprof.go.html#1632567">bp</a></span><span class="op" id="1632615">.</span><span class="ident" id="1632616"><a href="/gostd/runtime/mprof.go.html#1621828">count</a></span><span class="op" id="1632621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632626"><a href="/gostd/runtime/mprof.go.html#1632583">r</a></span><span class="op" id="1632627">.</span><span class="ident" id="1632628"><a href="/gostd/runtime/mprof.go.html#1631940">Cycles</a></span>&nbsp;<span class="op" id="1632635">=</span>&nbsp;<span class="builtintype" id="1632637">int64</span><span class="op" id="1632642">(</span><span class="ident" id="1632643"><a href="/gostd/runtime/mprof.go.html#1632567">bp</a></span><span class="op" id="1632645">.</span><span class="ident" id="1632646"><a href="/gostd/runtime/mprof.go.html#1621842">cycles</a></span><span class="op" id="1632652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632657">i</span>&nbsp;<span class="op" id="1632659">:=</span>&nbsp;<span class="builtinfunc" id="1632662">copy</span><span class="op" id="1632666">(</span><span class="ident" id="1632667"><a href="/gostd/runtime/mprof.go.html#1632583">r</a></span><span class="op" id="1632668">.</span><span class="ident" id="1632669"><a href="/gostd/runtime/mprof.go.html#1627647">Stack0</a></span><span class="op" id="1632675">[</span><span class="op" id="1632676">:</span><span class="op" id="1632677">]</span><span class="op" id="1632678">,</span>&nbsp;<span class="ident" id="1632680"><a href="/gostd/runtime/mprof.go.html#1632523">b</a></span><span class="op" id="1632681">.</span><span class="ident" id="1632682"><a href="/gostd/runtime/mprof.go.html#1622597">stk</a></span><span class="op" id="1632685">(</span><span class="op" id="1632686">)</span><span class="op" id="1632687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1632692">for</span>&nbsp;<span class="op" id="1632696">;</span>&nbsp;<span class="ident" id="1632698"><a href="/gostd/runtime/mprof.go.html#1632657">i</a></span>&nbsp;<span class="op" id="1632700">&lt;</span>&nbsp;<span class="builtinfunc" id="1632702">len</span><span class="op" id="1632705">(</span><span class="ident" id="1632706"><a href="/gostd/runtime/mprof.go.html#1632583">r</a></span><span class="op" id="1632707">.</span><span class="ident" id="1632708"><a href="/gostd/runtime/mprof.go.html#1627647">Stack0</a></span><span class="op" id="1632714">)</span><span class="op" id="1632715">;</span>&nbsp;<span class="ident" id="1632717"><a href="/gostd/runtime/mprof.go.html#1632657">i</a></span><span class="op" id="1632718">++</span>&nbsp;<span class="op" id="1632721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632727"><a href="/gostd/runtime/mprof.go.html#1632583">r</a></span><span class="op" id="1632728">.</span><span class="ident" id="1632729"><a href="/gostd/runtime/mprof.go.html#1627647">Stack0</a></span><span class="op" id="1632735">[</span><span class="ident" id="1632736"><a href="/gostd/runtime/mprof.go.html#1632657">i</a></span><span class="op" id="1632737">]</span>&nbsp;<span class="op" id="1632739">=</span>&nbsp;<span class="num" id="1632741">0</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1632746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632751"><a href="/gostd/runtime/mprof.go.html#1632372">p</a></span>&nbsp;<span class="op" id="1632753">=</span>&nbsp;<span class="ident" id="1632755"><a href="/gostd/runtime/mprof.go.html#1632372">p</a></span><span class="op" id="1632756">[</span><span class="num" id="1632757">1</span><span class="op" id="1632758">:</span><span class="op" id="1632759">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1632763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1632766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632769"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1632775">(</span><span class="op" id="1632776">&amp;</span><span class="ident" id="1632777"><a href="/gostd/runtime/mprof.go.html#1619691">proflock</a></span><span class="op" id="1632785">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1632788">return</span><br>
<span class="lineno"></span><span class="op" id="1632795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1632798">//&nbsp;ThreadCreateProfile&nbsp;returns&nbsp;n,&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;thread&nbsp;creation&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="1632886">//&nbsp;If&nbsp;len(p)&nbsp;&gt;=&nbsp;n,&nbsp;ThreadCreateProfile&nbsp;copies&nbsp;the&nbsp;profile&nbsp;into&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;true.</span><br>
<span class="lineno">500</span><span class="comment" id="1632972">//&nbsp;If&nbsp;len(p)&nbsp;&lt;&nbsp;n,&nbsp;ThreadCreateProfile&nbsp;does&nbsp;not&nbsp;change&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="1633050">//</span><br>
<span class="lineno"></span><span class="comment" id="1633053">//&nbsp;Most&nbsp;clients&nbsp;should&nbsp;use&nbsp;the&nbsp;runtime/pprof&nbsp;package&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="1633114">//&nbsp;of&nbsp;calling&nbsp;ThreadCreateProfile&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="1633158">func</span>&nbsp;<span class="ident" id="1633163">ThreadCreateProfile</span><span class="op" id="1633182">(</span><span class="ident" id="1633183">p</span>&nbsp;<span class="op" id="1633185">[</span><span class="op" id="1633186">]</span><span class="ident" id="1633187"><a href="/gostd/runtime/mprof.go.html#1627625">StackRecord</a></span><span class="op" id="1633198">)</span>&nbsp;<span class="op" id="1633200">(</span><span class="ident" id="1633201">n</span>&nbsp;<span class="builtintype" id="1633203">int</span><span class="op" id="1633206">,</span>&nbsp;<span class="ident" id="1633208">ok</span>&nbsp;<span class="builtintype" id="1633211">bool</span><span class="op" id="1633215">)</span>&nbsp;<span class="op" id="1633217">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633220">first</span>&nbsp;<span class="op" id="1633226">:=</span>&nbsp;<span class="op" id="1633229">(</span><span class="op" id="1633230">*</span><span class="ident" id="1633231"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787810">m</a></span><span class="op" id="1633232">)</span><span class="op" id="1633233">(</span><span class="ident" id="1633234"><a href="/gostd/runtime/atomic.go.html#1481434">atomicloadp</a></span><span class="op" id="1633245">(</span><span class="ident" id="1633246"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1633252">.</span><span class="ident" id="1633253">Pointer</span><span class="op" id="1633260">(</span><span class="op" id="1633261">&amp;</span><span class="ident" id="1633262"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791242">allm</a></span><span class="op" id="1633266">)</span><span class="op" id="1633267">)</span><span class="op" id="1633268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1633271">for</span>&nbsp;<span class="ident" id="1633275">mp</span>&nbsp;<span class="op" id="1633278">:=</span>&nbsp;<span class="ident" id="1633281"><a href="/gostd/runtime/mprof.go.html#1633220">first</a></span><span class="op" id="1633286">;</span>&nbsp;<span class="ident" id="1633288"><a href="/gostd/runtime/mprof.go.html#1633275">mp</a></span>&nbsp;<span class="op" id="1633291">!=</span>&nbsp;<span class="builtintype" id="1633294">nil</span><span class="op" id="1633297">;</span>&nbsp;<span class="ident" id="1633299"><a href="/gostd/runtime/mprof.go.html#1633275">mp</a></span>&nbsp;<span class="op" id="1633302">=</span>&nbsp;<span class="ident" id="1633304"><a href="/gostd/runtime/mprof.go.html#1633275">mp</a></span><span class="op" id="1633306">.</span><span class="ident" id="1633307"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788183">alllink</a></span>&nbsp;<span class="op" id="1633315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633319"><a href="/gostd/runtime/mprof.go.html#1633201">n</a></span><span class="op" id="1633320">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1633324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1633327">if</span>&nbsp;<span class="ident" id="1633330"><a href="/gostd/runtime/mprof.go.html#1633201">n</a></span>&nbsp;<span class="op" id="1633332">&lt;=</span>&nbsp;<span class="builtinfunc" id="1633335">len</span><span class="op" id="1633338">(</span><span class="ident" id="1633339"><a href="/gostd/runtime/mprof.go.html#1633183">p</a></span><span class="op" id="1633340">)</span>&nbsp;<span class="op" id="1633342">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633346"><a href="/gostd/runtime/mprof.go.html#1633208">ok</a></span>&nbsp;<span class="op" id="1633349">=</span>&nbsp;<span class="builtintype" id="1633351">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633358">i</span>&nbsp;<span class="op" id="1633360">:=</span>&nbsp;<span class="num" id="1633363">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1633367">for</span>&nbsp;<span class="ident" id="1633371">mp</span>&nbsp;<span class="op" id="1633374">:=</span>&nbsp;<span class="ident" id="1633377"><a href="/gostd/runtime/mprof.go.html#1633220">first</a></span><span class="op" id="1633382">;</span>&nbsp;<span class="ident" id="1633384"><a href="/gostd/runtime/mprof.go.html#1633371">mp</a></span>&nbsp;<span class="op" id="1633387">!=</span>&nbsp;<span class="builtintype" id="1633390">nil</span><span class="op" id="1633393">;</span>&nbsp;<span class="ident" id="1633395"><a href="/gostd/runtime/mprof.go.html#1633371">mp</a></span>&nbsp;<span class="op" id="1633398">=</span>&nbsp;<span class="ident" id="1633400"><a href="/gostd/runtime/mprof.go.html#1633371">mp</a></span><span class="op" id="1633402">.</span><span class="ident" id="1633403"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788183">alllink</a></span>&nbsp;<span class="op" id="1633411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1633416">for</span>&nbsp;<span class="ident" id="1633420">s</span>&nbsp;<span class="op" id="1633422">:=</span>&nbsp;<span class="keyword" id="1633425">range</span>&nbsp;<span class="ident" id="1633431"><a href="/gostd/runtime/mprof.go.html#1633371">mp</a></span><span class="op" id="1633433">.</span><span class="ident" id="1633434"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788254">createstack</a></span>&nbsp;<span class="op" id="1633446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633452"><a href="/gostd/runtime/mprof.go.html#1633183">p</a></span><span class="op" id="1633453">[</span><span class="ident" id="1633454"><a href="/gostd/runtime/mprof.go.html#1633358">i</a></span><span class="op" id="1633455">]</span><span class="op" id="1633456">.</span><span class="ident" id="1633457"><a href="/gostd/runtime/mprof.go.html#1627647">Stack0</a></span><span class="op" id="1633463">[</span><span class="ident" id="1633464"><a href="/gostd/runtime/mprof.go.html#1633420">s</a></span><span class="op" id="1633465">]</span>&nbsp;<span class="op" id="1633467">=</span>&nbsp;<span class="builtintype" id="1633469">uintptr</span><span class="op" id="1633476">(</span><span class="ident" id="1633477"><a href="/gostd/runtime/mprof.go.html#1633371">mp</a></span><span class="op" id="1633479">.</span><span class="ident" id="1633480"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788254">createstack</a></span><span class="op" id="1633491">[</span><span class="ident" id="1633492"><a href="/gostd/runtime/mprof.go.html#1633420">s</a></span><span class="op" id="1633493">]</span><span class="op" id="1633494">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1633499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633504"><a href="/gostd/runtime/mprof.go.html#1633358">i</a></span><span class="op" id="1633505">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1633510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1633513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1633516">return</span><br>
<span class="lineno">520</span><span class="op" id="1633523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1633526">var</span>&nbsp;<span class="ident" id="1633530">allgs</span>&nbsp;<span class="op" id="1633536">[</span><span class="op" id="1633537">]</span><span class="op" id="1633538">*</span><span class="ident" id="1633539"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787271">g</a></span>&nbsp;<span class="comment" id="1633541">//&nbsp;proc.c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1633552">//&nbsp;GoroutineProfile&nbsp;returns&nbsp;n,&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;active&nbsp;goroutine&nbsp;stack&nbsp;profile.</span><br>
<span class="lineno">525</span><span class="comment" id="1633644">//&nbsp;If&nbsp;len(p)&nbsp;&gt;=&nbsp;n,&nbsp;GoroutineProfile&nbsp;copies&nbsp;the&nbsp;profile&nbsp;into&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;true.</span><br>
<span class="lineno"></span><span class="comment" id="1633727">//&nbsp;If&nbsp;len(p)&nbsp;&lt;&nbsp;n,&nbsp;GoroutineProfile&nbsp;does&nbsp;not&nbsp;change&nbsp;p&nbsp;and&nbsp;returns&nbsp;n,&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="1633802">//</span><br>
<span class="lineno"></span><span class="comment" id="1633805">//&nbsp;Most&nbsp;clients&nbsp;should&nbsp;use&nbsp;the&nbsp;runtime/pprof&nbsp;package&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="1633866">//&nbsp;of&nbsp;calling&nbsp;GoroutineProfile&nbsp;directly.</span><br>
<span class="lineno">530</span><span class="keyword" id="1633907">func</span>&nbsp;<span class="ident" id="1633912">GoroutineProfile</span><span class="op" id="1633928">(</span><span class="ident" id="1633929">p</span>&nbsp;<span class="op" id="1633931">[</span><span class="op" id="1633932">]</span><span class="ident" id="1633933"><a href="/gostd/runtime/mprof.go.html#1627625">StackRecord</a></span><span class="op" id="1633944">)</span>&nbsp;<span class="op" id="1633946">(</span><span class="ident" id="1633947">n</span>&nbsp;<span class="builtintype" id="1633949">int</span><span class="op" id="1633952">,</span>&nbsp;<span class="ident" id="1633954">ok</span>&nbsp;<span class="builtintype" id="1633957">bool</span><span class="op" id="1633961">)</span>&nbsp;<span class="op" id="1633963">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633967"><a href="/gostd/runtime/mprof.go.html#1633947">n</a></span>&nbsp;<span class="op" id="1633969">=</span>&nbsp;<span class="ident" id="1633971"><a href="/gostd/runtime/debug.go.html#1522186">NumGoroutine</a></span><span class="op" id="1633983">(</span><span class="op" id="1633984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1633987">if</span>&nbsp;<span class="ident" id="1633990"><a href="/gostd/runtime/mprof.go.html#1633947">n</a></span>&nbsp;<span class="op" id="1633992">&lt;=</span>&nbsp;<span class="builtinfunc" id="1633995">len</span><span class="op" id="1633998">(</span><span class="ident" id="1633999"><a href="/gostd/runtime/mprof.go.html#1633929">p</a></span><span class="op" id="1634000">)</span>&nbsp;<span class="op" id="1634002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634006">gp</span>&nbsp;<span class="op" id="1634009">:=</span>&nbsp;<span class="ident" id="1634012"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1634016">(</span><span class="op" id="1634017">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634021"><a href="/gostd/runtime/sema.go.html#1702898">semacquire</a></span><span class="op" id="1634031">(</span><span class="op" id="1634032">&amp;</span><span class="ident" id="1634033"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791594">worldsema</a></span><span class="op" id="1634042">,</span>&nbsp;<span class="builtintype" id="1634044">false</span><span class="op" id="1634049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634053"><a href="/gostd/runtime/mprof.go.html#1634006">gp</a></span><span class="op" id="1634055">.</span><span class="ident" id="1634056"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1634057">.</span><span class="ident" id="1634058"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787994">gcing</a></span>&nbsp;<span class="op" id="1634064">=</span>&nbsp;<span class="num" id="1634066">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634070"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1634073">(</span><span class="ident" id="1634074"><a href="/gostd/runtime/stubs.go.html#1742794">stoptheworld</a></span><span class="op" id="1634086">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634091"><a href="/gostd/runtime/mprof.go.html#1633947">n</a></span>&nbsp;<span class="op" id="1634093">=</span>&nbsp;<span class="ident" id="1634095"><a href="/gostd/runtime/debug.go.html#1522186">NumGoroutine</a></span><span class="op" id="1634107">(</span><span class="op" id="1634108">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1634112">if</span>&nbsp;<span class="ident" id="1634115"><a href="/gostd/runtime/mprof.go.html#1633947">n</a></span>&nbsp;<span class="op" id="1634117">&lt;=</span>&nbsp;<span class="builtinfunc" id="1634120">len</span><span class="op" id="1634123">(</span><span class="ident" id="1634124"><a href="/gostd/runtime/mprof.go.html#1633929">p</a></span><span class="op" id="1634125">)</span>&nbsp;<span class="op" id="1634127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634132"><a href="/gostd/runtime/mprof.go.html#1633954">ok</a></span>&nbsp;<span class="op" id="1634135">=</span>&nbsp;<span class="builtintype" id="1634137">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634145">r</span>&nbsp;<span class="op" id="1634147">:=</span>&nbsp;<span class="ident" id="1634150"><a href="/gostd/runtime/mprof.go.html#1633929">p</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634155">sp</span>&nbsp;<span class="op" id="1634158">:=</span>&nbsp;<span class="ident" id="1634161"><a href="/gostd/runtime/stubs.go.html#1746458">getcallersp</a></span><span class="op" id="1634172">(</span><span class="ident" id="1634173"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1634179">.</span><span class="ident" id="1634180">Pointer</span><span class="op" id="1634187">(</span><span class="op" id="1634188">&amp;</span><span class="ident" id="1634189"><a href="/gostd/runtime/mprof.go.html#1633929">p</a></span><span class="op" id="1634190">)</span><span class="op" id="1634191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634196">pc</span>&nbsp;<span class="op" id="1634199">:=</span>&nbsp;<span class="ident" id="1634202"><a href="/gostd/runtime/stubs.go.html#1746397">getcallerpc</a></span><span class="op" id="1634213">(</span><span class="ident" id="1634214"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1634220">.</span><span class="ident" id="1634221">Pointer</span><span class="op" id="1634228">(</span><span class="op" id="1634229">&amp;</span><span class="ident" id="1634230"><a href="/gostd/runtime/mprof.go.html#1633929">p</a></span><span class="op" id="1634231">)</span><span class="op" id="1634232">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634237"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1634240">(</span><span class="keyword" id="1634241">func</span><span class="op" id="1634245">(</span><span class="op" id="1634246">)</span>&nbsp;<span class="op" id="1634248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634254"><a href="/gostd/runtime/mprof.go.html#1634559">saveg</a></span><span class="op" id="1634259">(</span><span class="ident" id="1634260"><a href="/gostd/runtime/mprof.go.html#1634196">pc</a></span><span class="op" id="1634262">,</span>&nbsp;<span class="ident" id="1634264"><a href="/gostd/runtime/mprof.go.html#1634155">sp</a></span><span class="op" id="1634266">,</span>&nbsp;<span class="ident" id="1634268"><a href="/gostd/runtime/mprof.go.html#1634006">gp</a></span><span class="op" id="1634270">,</span>&nbsp;<span class="op" id="1634272">&amp;</span><span class="ident" id="1634273"><a href="/gostd/runtime/mprof.go.html#1634145">r</a></span><span class="op" id="1634274">[</span><span class="num" id="1634275">0</span><span class="op" id="1634276">]</span><span class="op" id="1634277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1634282">}</span><span class="op" id="1634283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634288"><a href="/gostd/runtime/mprof.go.html#1634145">r</a></span>&nbsp;<span class="op" id="1634290">=</span>&nbsp;<span class="ident" id="1634292"><a href="/gostd/runtime/mprof.go.html#1634145">r</a></span><span class="op" id="1634293">[</span><span class="num" id="1634294">1</span><span class="op" id="1634295">:</span><span class="op" id="1634296">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1634301">for</span>&nbsp;<span class="ident" id="1634305">_</span><span class="op" id="1634306">,</span>&nbsp;<span class="ident" id="1634308">gp1</span>&nbsp;<span class="op" id="1634312">:=</span>&nbsp;<span class="keyword" id="1634315">range</span>&nbsp;<span class="ident" id="1634321"><a href="/gostd/runtime/mprof.go.html#1633530">allgs</a></span>&nbsp;<span class="op" id="1634327">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1634333">if</span>&nbsp;<span class="ident" id="1634336"><a href="/gostd/runtime/mprof.go.html#1634308">gp1</a></span>&nbsp;<span class="op" id="1634340">==</span>&nbsp;<span class="ident" id="1634343"><a href="/gostd/runtime/mprof.go.html#1634006">gp</a></span>&nbsp;<span class="op" id="1634346">||</span>&nbsp;<span class="ident" id="1634349"><a href="/gostd/runtime/stubs.go.html#1738998">readgstatus</a></span><span class="op" id="1634360">(</span><span class="ident" id="1634361"><a href="/gostd/runtime/mprof.go.html#1634308">gp1</a></span><span class="op" id="1634364">)</span>&nbsp;<span class="op" id="1634366">==</span>&nbsp;<span class="ident" id="1634369"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1785882">_Gdead</a></span>&nbsp;<span class="op" id="1634376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1634383">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1634396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634402"><a href="/gostd/runtime/mprof.go.html#1634559">saveg</a></span><span class="op" id="1634407">(</span><span class="op" id="1634408">^</span><span class="builtintype" id="1634409">uintptr</span><span class="op" id="1634416">(</span><span class="num" id="1634417">0</span><span class="op" id="1634418">)</span><span class="op" id="1634419">,</span>&nbsp;<span class="op" id="1634421">^</span><span class="builtintype" id="1634422">uintptr</span><span class="op" id="1634429">(</span><span class="num" id="1634430">0</span><span class="op" id="1634431">)</span><span class="op" id="1634432">,</span>&nbsp;<span class="ident" id="1634434"><a href="/gostd/runtime/mprof.go.html#1634308">gp1</a></span><span class="op" id="1634437">,</span>&nbsp;<span class="op" id="1634439">&amp;</span><span class="ident" id="1634440"><a href="/gostd/runtime/mprof.go.html#1634145">r</a></span><span class="op" id="1634441">[</span><span class="num" id="1634442">0</span><span class="op" id="1634443">]</span><span class="op" id="1634444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634450"><a href="/gostd/runtime/mprof.go.html#1634145">r</a></span>&nbsp;<span class="op" id="1634452">=</span>&nbsp;<span class="ident" id="1634454"><a href="/gostd/runtime/mprof.go.html#1634145">r</a></span><span class="op" id="1634455">[</span><span class="num" id="1634456">1</span><span class="op" id="1634457">:</span><span class="op" id="1634458">]</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1634463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1634467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634472"><a href="/gostd/runtime/mprof.go.html#1634006">gp</a></span><span class="op" id="1634474">.</span><span class="ident" id="1634475"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1634476">.</span><span class="ident" id="1634477"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787994">gcing</a></span>&nbsp;<span class="op" id="1634483">=</span>&nbsp;<span class="num" id="1634485">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634489"><a href="/gostd/runtime/sema.go.html#1703982">semrelease</a></span><span class="op" id="1634499">(</span><span class="op" id="1634500">&amp;</span><span class="ident" id="1634501"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791594">worldsema</a></span><span class="op" id="1634510">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634514"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1634517">(</span><span class="ident" id="1634518"><a href="/gostd/runtime/stubs.go.html#1742773">starttheworld</a></span><span class="op" id="1634531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1634534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1634538">return</span>&nbsp;<span class="ident" id="1634545"><a href="/gostd/runtime/mprof.go.html#1633947">n</a></span><span class="op" id="1634546">,</span>&nbsp;<span class="ident" id="1634548"><a href="/gostd/runtime/mprof.go.html#1633954">ok</a></span><br>
<span class="lineno"></span><span class="op" id="1634551">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="keyword" id="1634554">func</span>&nbsp;<span class="ident" id="1634559">saveg</span><span class="op" id="1634564">(</span><span class="ident" id="1634565">pc</span><span class="op" id="1634567">,</span>&nbsp;<span class="ident" id="1634569">sp</span>&nbsp;<span class="builtintype" id="1634572">uintptr</span><span class="op" id="1634579">,</span>&nbsp;<span class="ident" id="1634581">gp</span>&nbsp;<span class="op" id="1634584">*</span><span class="ident" id="1634585"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787271">g</a></span><span class="op" id="1634586">,</span>&nbsp;<span class="ident" id="1634588">r</span>&nbsp;<span class="op" id="1634590">*</span><span class="ident" id="1634591"><a href="/gostd/runtime/mprof.go.html#1627625">StackRecord</a></span><span class="op" id="1634602">)</span>&nbsp;<span class="op" id="1634604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634607">n</span>&nbsp;<span class="op" id="1634609">:=</span>&nbsp;<span class="ident" id="1634612"><a href="/gostd/runtime/traceback.go.html#1766210">gentraceback</a></span><span class="op" id="1634624">(</span><span class="ident" id="1634625"><a href="/gostd/runtime/mprof.go.html#1634565">pc</a></span><span class="op" id="1634627">,</span>&nbsp;<span class="ident" id="1634629"><a href="/gostd/runtime/mprof.go.html#1634569">sp</a></span><span class="op" id="1634631">,</span>&nbsp;<span class="num" id="1634633">0</span><span class="op" id="1634634">,</span>&nbsp;<span class="ident" id="1634636"><a href="/gostd/runtime/mprof.go.html#1634581">gp</a></span><span class="op" id="1634638">,</span>&nbsp;<span class="num" id="1634640">0</span><span class="op" id="1634641">,</span>&nbsp;<span class="op" id="1634643">&amp;</span><span class="ident" id="1634644"><a href="/gostd/runtime/mprof.go.html#1634588">r</a></span><span class="op" id="1634645">.</span><span class="ident" id="1634646"><a href="/gostd/runtime/mprof.go.html#1627647">Stack0</a></span><span class="op" id="1634652">[</span><span class="num" id="1634653">0</span><span class="op" id="1634654">]</span><span class="op" id="1634655">,</span>&nbsp;<span class="builtinfunc" id="1634657">len</span><span class="op" id="1634660">(</span><span class="ident" id="1634661"><a href="/gostd/runtime/mprof.go.html#1634588">r</a></span><span class="op" id="1634662">.</span><span class="ident" id="1634663"><a href="/gostd/runtime/mprof.go.html#1627647">Stack0</a></span><span class="op" id="1634669">)</span><span class="op" id="1634670">,</span>&nbsp;<span class="builtintype" id="1634672">nil</span><span class="op" id="1634675">,</span>&nbsp;<span class="builtintype" id="1634677">nil</span><span class="op" id="1634680">,</span>&nbsp;<span class="num" id="1634682">0</span><span class="op" id="1634683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1634686">if</span>&nbsp;<span class="ident" id="1634689"><a href="/gostd/runtime/mprof.go.html#1634607">n</a></span>&nbsp;<span class="op" id="1634691">&lt;</span>&nbsp;<span class="builtinfunc" id="1634693">len</span><span class="op" id="1634696">(</span><span class="ident" id="1634697"><a href="/gostd/runtime/mprof.go.html#1634588">r</a></span><span class="op" id="1634698">.</span><span class="ident" id="1634699"><a href="/gostd/runtime/mprof.go.html#1627647">Stack0</a></span><span class="op" id="1634705">)</span>&nbsp;<span class="op" id="1634707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634711"><a href="/gostd/runtime/mprof.go.html#1634588">r</a></span><span class="op" id="1634712">.</span><span class="ident" id="1634713"><a href="/gostd/runtime/mprof.go.html#1627647">Stack0</a></span><span class="op" id="1634719">[</span><span class="ident" id="1634720"><a href="/gostd/runtime/mprof.go.html#1634607">n</a></span><span class="op" id="1634721">]</span>&nbsp;<span class="op" id="1634723">=</span>&nbsp;<span class="num" id="1634725">0</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1634728">}</span><br>
<span class="lineno"></span><span class="op" id="1634730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1634733">//&nbsp;Stack&nbsp;formats&nbsp;a&nbsp;stack&nbsp;trace&nbsp;of&nbsp;the&nbsp;calling&nbsp;goroutine&nbsp;into&nbsp;buf</span><br>
<span class="lineno"></span><span class="comment" id="1634798">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;to&nbsp;buf.</span><br>
<span class="lineno">575</span><span class="comment" id="1634849">//&nbsp;If&nbsp;all&nbsp;is&nbsp;true,&nbsp;Stack&nbsp;formats&nbsp;stack&nbsp;traces&nbsp;of&nbsp;all&nbsp;other&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="1634919">//&nbsp;into&nbsp;buf&nbsp;after&nbsp;the&nbsp;trace&nbsp;for&nbsp;the&nbsp;current&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="1634974">func</span>&nbsp;<span class="ident" id="1634979">Stack</span><span class="op" id="1634984">(</span><span class="ident" id="1634985">buf</span>&nbsp;<span class="op" id="1634989">[</span><span class="op" id="1634990">]</span><span class="builtintype" id="1634991">byte</span><span class="op" id="1634995">,</span>&nbsp;<span class="ident" id="1634997">all</span>&nbsp;<span class="builtintype" id="1635001">bool</span><span class="op" id="1635005">)</span>&nbsp;<span class="builtintype" id="1635007">int</span>&nbsp;<span class="op" id="1635011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635014">mp</span>&nbsp;<span class="op" id="1635017">:=</span>&nbsp;<span class="ident" id="1635020"><a href="/gostd/runtime/stubs.go.html#1738934">acquirem</a></span><span class="op" id="1635028">(</span><span class="op" id="1635029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635032">gp</span>&nbsp;<span class="op" id="1635035">:=</span>&nbsp;<span class="ident" id="1635038"><a href="/gostd/runtime/mprof.go.html#1635014">mp</a></span><span class="op" id="1635040">.</span><span class="ident" id="1635041"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787912">curg</a></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1635047">if</span>&nbsp;<span class="ident" id="1635050"><a href="/gostd/runtime/mprof.go.html#1634997">all</a></span>&nbsp;<span class="op" id="1635054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635058"><a href="/gostd/runtime/sema.go.html#1702898">semacquire</a></span><span class="op" id="1635068">(</span><span class="op" id="1635069">&amp;</span><span class="ident" id="1635070"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791594">worldsema</a></span><span class="op" id="1635079">,</span>&nbsp;<span class="builtintype" id="1635081">false</span><span class="op" id="1635086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635090"><a href="/gostd/runtime/mprof.go.html#1635014">mp</a></span><span class="op" id="1635092">.</span><span class="ident" id="1635093"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787994">gcing</a></span>&nbsp;<span class="op" id="1635099">=</span>&nbsp;<span class="num" id="1635101">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635105"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1635113">(</span><span class="ident" id="1635114"><a href="/gostd/runtime/mprof.go.html#1635014">mp</a></span><span class="op" id="1635116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635120"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1635123">(</span><span class="ident" id="1635124"><a href="/gostd/runtime/stubs.go.html#1742794">stoptheworld</a></span><span class="op" id="1635136">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1635140">if</span>&nbsp;<span class="ident" id="1635143"><a href="/gostd/runtime/mprof.go.html#1635014">mp</a></span>&nbsp;<span class="op" id="1635146">!=</span>&nbsp;<span class="ident" id="1635149"><a href="/gostd/runtime/stubs.go.html#1738934">acquirem</a></span><span class="op" id="1635157">(</span><span class="op" id="1635158">)</span>&nbsp;<span class="op" id="1635160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635165"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1635172">(</span><span class="string" id="1635173">&#34;Stack:&nbsp;rescheduled&#34;</span><span class="op" id="1635193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1635197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1635200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635204">n</span>&nbsp;<span class="op" id="1635206">:=</span>&nbsp;<span class="num" id="1635209">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1635212">if</span>&nbsp;<span class="builtinfunc" id="1635215">len</span><span class="op" id="1635218">(</span><span class="ident" id="1635219"><a href="/gostd/runtime/mprof.go.html#1634985">buf</a></span><span class="op" id="1635222">)</span>&nbsp;<span class="op" id="1635224">&gt;</span>&nbsp;<span class="num" id="1635226">0</span>&nbsp;<span class="op" id="1635228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635232">sp</span>&nbsp;<span class="op" id="1635235">:=</span>&nbsp;<span class="ident" id="1635238"><a href="/gostd/runtime/stubs.go.html#1746458">getcallersp</a></span><span class="op" id="1635249">(</span><span class="ident" id="1635250"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1635256">.</span><span class="ident" id="1635257">Pointer</span><span class="op" id="1635264">(</span><span class="op" id="1635265">&amp;</span><span class="ident" id="1635266"><a href="/gostd/runtime/mprof.go.html#1634985">buf</a></span><span class="op" id="1635269">)</span><span class="op" id="1635270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635274">pc</span>&nbsp;<span class="op" id="1635277">:=</span>&nbsp;<span class="ident" id="1635280"><a href="/gostd/runtime/stubs.go.html#1746397">getcallerpc</a></span><span class="op" id="1635291">(</span><span class="ident" id="1635292"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1635298">.</span><span class="ident" id="1635299">Pointer</span><span class="op" id="1635306">(</span><span class="op" id="1635307">&amp;</span><span class="ident" id="1635308"><a href="/gostd/runtime/mprof.go.html#1634985">buf</a></span><span class="op" id="1635311">)</span><span class="op" id="1635312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635316"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1635319">(</span><span class="keyword" id="1635320">func</span><span class="op" id="1635324">(</span><span class="op" id="1635325">)</span>&nbsp;<span class="op" id="1635327">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635332">g0</span>&nbsp;<span class="op" id="1635335">:=</span>&nbsp;<span class="ident" id="1635338"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1635342">(</span><span class="op" id="1635343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635348"><a href="/gostd/runtime/mprof.go.html#1635332">g0</a></span><span class="op" id="1635350">.</span><span class="ident" id="1635351"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787672">writebuf</a></span>&nbsp;<span class="op" id="1635360">=</span>&nbsp;<span class="ident" id="1635362"><a href="/gostd/runtime/mprof.go.html#1634985">buf</a></span><span class="op" id="1635365">[</span><span class="num" id="1635366">0</span><span class="op" id="1635367">:</span><span class="num" id="1635368">0</span><span class="op" id="1635369">:</span><span class="builtinfunc" id="1635370">len</span><span class="op" id="1635373">(</span><span class="ident" id="1635374"><a href="/gostd/runtime/mprof.go.html#1634985">buf</a></span><span class="op" id="1635377">)</span><span class="op" id="1635378">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635383"><a href="/gostd/runtime/traceback.go.html#1782290">goroutineheader</a></span><span class="op" id="1635398">(</span><span class="ident" id="1635399"><a href="/gostd/runtime/mprof.go.html#1635032">gp</a></span><span class="op" id="1635401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635406"><a href="/gostd/runtime/traceback.go.html#1779268">traceback</a></span><span class="op" id="1635415">(</span><span class="ident" id="1635416"><a href="/gostd/runtime/mprof.go.html#1635274">pc</a></span><span class="op" id="1635418">,</span>&nbsp;<span class="ident" id="1635420"><a href="/gostd/runtime/mprof.go.html#1635232">sp</a></span><span class="op" id="1635422">,</span>&nbsp;<span class="num" id="1635424">0</span><span class="op" id="1635425">,</span>&nbsp;<span class="ident" id="1635427"><a href="/gostd/runtime/mprof.go.html#1635032">gp</a></span><span class="op" id="1635429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1635434">if</span>&nbsp;<span class="ident" id="1635437"><a href="/gostd/runtime/mprof.go.html#1634997">all</a></span>&nbsp;<span class="op" id="1635441">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635447"><a href="/gostd/runtime/traceback.go.html#1783208">tracebackothers</a></span><span class="op" id="1635462">(</span><span class="ident" id="1635463"><a href="/gostd/runtime/mprof.go.html#1635032">gp</a></span><span class="op" id="1635465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1635470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635475"><a href="/gostd/runtime/mprof.go.html#1635204">n</a></span>&nbsp;<span class="op" id="1635477">=</span>&nbsp;<span class="builtinfunc" id="1635479">len</span><span class="op" id="1635482">(</span><span class="ident" id="1635483"><a href="/gostd/runtime/mprof.go.html#1635332">g0</a></span><span class="op" id="1635485">.</span><span class="ident" id="1635486"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787672">writebuf</a></span><span class="op" id="1635494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635499"><a href="/gostd/runtime/mprof.go.html#1635332">g0</a></span><span class="op" id="1635501">.</span><span class="ident" id="1635502"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787672">writebuf</a></span>&nbsp;<span class="op" id="1635511">=</span>&nbsp;<span class="builtintype" id="1635513">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1635519">}</span><span class="op" id="1635520">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1635523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1635527">if</span>&nbsp;<span class="ident" id="1635530"><a href="/gostd/runtime/mprof.go.html#1634997">all</a></span>&nbsp;<span class="op" id="1635534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635538"><a href="/gostd/runtime/mprof.go.html#1635014">mp</a></span><span class="op" id="1635540">.</span><span class="ident" id="1635541"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787994">gcing</a></span>&nbsp;<span class="op" id="1635547">=</span>&nbsp;<span class="num" id="1635549">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635553"><a href="/gostd/runtime/sema.go.html#1703982">semrelease</a></span><span class="op" id="1635563">(</span><span class="op" id="1635564">&amp;</span><span class="ident" id="1635565"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791594">worldsema</a></span><span class="op" id="1635574">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635578"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1635581">(</span><span class="ident" id="1635582"><a href="/gostd/runtime/stubs.go.html#1742773">starttheworld</a></span><span class="op" id="1635595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1635598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635601"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1635609">(</span><span class="ident" id="1635610"><a href="/gostd/runtime/mprof.go.html#1635014">mp</a></span><span class="op" id="1635612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1635615">return</span>&nbsp;<span class="ident" id="1635622"><a href="/gostd/runtime/mprof.go.html#1635204">n</a></span><br>
<span class="lineno"></span><span class="op" id="1635624">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="comment" id="1635627">//&nbsp;Tracing&nbsp;of&nbsp;alloc/free/gc.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1635657">var</span>&nbsp;<span class="ident" id="1635661">tracelock</span>&nbsp;<span class="ident" id="1635671"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786208">mutex</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">620</span><span class="keyword" id="1635678">func</span>&nbsp;<span class="ident" id="1635683">tracealloc</span><span class="op" id="1635693">(</span><span class="ident" id="1635694">p</span>&nbsp;<span class="ident" id="1635696"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1635702">.</span><span class="ident" id="1635703">Pointer</span><span class="op" id="1635710">,</span>&nbsp;<span class="ident" id="1635712">size</span>&nbsp;<span class="builtintype" id="1635717">uintptr</span><span class="op" id="1635724">,</span>&nbsp;<span class="ident" id="1635726">typ</span>&nbsp;<span class="op" id="1635730">*</span><span class="ident" id="1635731"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795605">_type</a></span><span class="op" id="1635736">)</span>&nbsp;<span class="op" id="1635738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635741"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1635745">(</span><span class="op" id="1635746">&amp;</span><span class="ident" id="1635747"><a href="/gostd/runtime/mprof.go.html#1635661">tracelock</a></span><span class="op" id="1635756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635759">gp</span>&nbsp;<span class="op" id="1635762">:=</span>&nbsp;<span class="ident" id="1635765"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1635769">(</span><span class="op" id="1635770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635773"><a href="/gostd/runtime/mprof.go.html#1635759">gp</a></span><span class="op" id="1635775">.</span><span class="ident" id="1635776"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1635777">.</span><span class="ident" id="1635778"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788455">traceback</a></span>&nbsp;<span class="op" id="1635788">=</span>&nbsp;<span class="num" id="1635790">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1635793">if</span>&nbsp;<span class="ident" id="1635796"><a href="/gostd/runtime/mprof.go.html#1635726">typ</a></span>&nbsp;<span class="op" id="1635800">==</span>&nbsp;<span class="builtintype" id="1635803">nil</span>&nbsp;<span class="op" id="1635807">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1635811">print</span><span class="op" id="1635816">(</span><span class="string" id="1635817">&#34;tracealloc(&#34;</span><span class="op" id="1635830">,</span>&nbsp;<span class="ident" id="1635832"><a href="/gostd/runtime/mprof.go.html#1635694">p</a></span><span class="op" id="1635833">,</span>&nbsp;<span class="string" id="1635835">&#34;,&nbsp;&#34;</span><span class="op" id="1635839">,</span>&nbsp;<span class="ident" id="1635841"><a href="/gostd/runtime/print1.go.html#1664817">hex</a></span><span class="op" id="1635844">(</span><span class="ident" id="1635845"><a href="/gostd/runtime/mprof.go.html#1635712">size</a></span><span class="op" id="1635849">)</span><span class="op" id="1635850">,</span>&nbsp;<span class="string" id="1635852">&#34;)\n&#34;</span><span class="op" id="1635857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1635860">}</span>&nbsp;<span class="keyword" id="1635862">else</span>&nbsp;<span class="op" id="1635867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1635871">print</span><span class="op" id="1635876">(</span><span class="string" id="1635877">&#34;tracealloc(&#34;</span><span class="op" id="1635890">,</span>&nbsp;<span class="ident" id="1635892"><a href="/gostd/runtime/mprof.go.html#1635694">p</a></span><span class="op" id="1635893">,</span>&nbsp;<span class="string" id="1635895">&#34;,&nbsp;&#34;</span><span class="op" id="1635899">,</span>&nbsp;<span class="ident" id="1635901"><a href="/gostd/runtime/print1.go.html#1664817">hex</a></span><span class="op" id="1635904">(</span><span class="ident" id="1635905"><a href="/gostd/runtime/mprof.go.html#1635712">size</a></span><span class="op" id="1635909">)</span><span class="op" id="1635910">,</span>&nbsp;<span class="string" id="1635912">&#34;,&nbsp;&#34;</span><span class="op" id="1635916">,</span>&nbsp;<span class="op" id="1635918">*</span><span class="ident" id="1635919"><a href="/gostd/runtime/mprof.go.html#1635726">typ</a></span><span class="op" id="1635922">.</span><span class="ident" id="1635923"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795741">_string</a></span><span class="op" id="1635930">,</span>&nbsp;<span class="string" id="1635932">&#34;)\n&#34;</span><span class="op" id="1635937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1635940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1635943">if</span>&nbsp;<span class="ident" id="1635946"><a href="/gostd/runtime/mprof.go.html#1635759">gp</a></span><span class="op" id="1635948">.</span><span class="ident" id="1635949"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1635950">.</span><span class="ident" id="1635951"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787912">curg</a></span>&nbsp;<span class="op" id="1635956">==</span>&nbsp;<span class="builtintype" id="1635959">nil</span>&nbsp;<span class="op" id="1635963">||</span>&nbsp;<span class="ident" id="1635966"><a href="/gostd/runtime/mprof.go.html#1635759">gp</a></span>&nbsp;<span class="op" id="1635969">==</span>&nbsp;<span class="ident" id="1635972"><a href="/gostd/runtime/mprof.go.html#1635759">gp</a></span><span class="op" id="1635974">.</span><span class="ident" id="1635975"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1635976">.</span><span class="ident" id="1635977"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787912">curg</a></span>&nbsp;<span class="op" id="1635982">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635986"><a href="/gostd/runtime/traceback.go.html#1782290">goroutineheader</a></span><span class="op" id="1636001">(</span><span class="ident" id="1636002"><a href="/gostd/runtime/mprof.go.html#1635759">gp</a></span><span class="op" id="1636004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636008">pc</span>&nbsp;<span class="op" id="1636011">:=</span>&nbsp;<span class="ident" id="1636014"><a href="/gostd/runtime/stubs.go.html#1746397">getcallerpc</a></span><span class="op" id="1636025">(</span><span class="ident" id="1636026"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1636032">.</span><span class="ident" id="1636033">Pointer</span><span class="op" id="1636040">(</span><span class="op" id="1636041">&amp;</span><span class="ident" id="1636042"><a href="/gostd/runtime/mprof.go.html#1635694">p</a></span><span class="op" id="1636043">)</span><span class="op" id="1636044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636048">sp</span>&nbsp;<span class="op" id="1636051">:=</span>&nbsp;<span class="ident" id="1636054"><a href="/gostd/runtime/stubs.go.html#1746458">getcallersp</a></span><span class="op" id="1636065">(</span><span class="ident" id="1636066"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1636072">.</span><span class="ident" id="1636073">Pointer</span><span class="op" id="1636080">(</span><span class="op" id="1636081">&amp;</span><span class="ident" id="1636082"><a href="/gostd/runtime/mprof.go.html#1635694">p</a></span><span class="op" id="1636083">)</span><span class="op" id="1636084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636088"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1636091">(</span><span class="keyword" id="1636092">func</span><span class="op" id="1636096">(</span><span class="op" id="1636097">)</span>&nbsp;<span class="op" id="1636099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636104"><a href="/gostd/runtime/traceback.go.html#1779268">traceback</a></span><span class="op" id="1636113">(</span><span class="ident" id="1636114"><a href="/gostd/runtime/mprof.go.html#1636008">pc</a></span><span class="op" id="1636116">,</span>&nbsp;<span class="ident" id="1636118"><a href="/gostd/runtime/mprof.go.html#1636048">sp</a></span><span class="op" id="1636120">,</span>&nbsp;<span class="num" id="1636122">0</span><span class="op" id="1636123">,</span>&nbsp;<span class="ident" id="1636125"><a href="/gostd/runtime/mprof.go.html#1635759">gp</a></span><span class="op" id="1636127">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1636131">}</span><span class="op" id="1636132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1636135">}</span>&nbsp;<span class="keyword" id="1636137">else</span>&nbsp;<span class="op" id="1636142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636146"><a href="/gostd/runtime/traceback.go.html#1782290">goroutineheader</a></span><span class="op" id="1636161">(</span><span class="ident" id="1636162"><a href="/gostd/runtime/mprof.go.html#1635759">gp</a></span><span class="op" id="1636164">.</span><span class="ident" id="1636165"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1636166">.</span><span class="ident" id="1636167"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787912">curg</a></span><span class="op" id="1636171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636175"><a href="/gostd/runtime/traceback.go.html#1779268">traceback</a></span><span class="op" id="1636184">(</span><span class="op" id="1636185">^</span><span class="builtintype" id="1636186">uintptr</span><span class="op" id="1636193">(</span><span class="num" id="1636194">0</span><span class="op" id="1636195">)</span><span class="op" id="1636196">,</span>&nbsp;<span class="op" id="1636198">^</span><span class="builtintype" id="1636199">uintptr</span><span class="op" id="1636206">(</span><span class="num" id="1636207">0</span><span class="op" id="1636208">)</span><span class="op" id="1636209">,</span>&nbsp;<span class="num" id="1636211">0</span><span class="op" id="1636212">,</span>&nbsp;<span class="ident" id="1636214"><a href="/gostd/runtime/mprof.go.html#1635759">gp</a></span><span class="op" id="1636216">.</span><span class="ident" id="1636217"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1636218">.</span><span class="ident" id="1636219"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787912">curg</a></span><span class="op" id="1636223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1636226">}</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1636229">print</span><span class="op" id="1636234">(</span><span class="string" id="1636235">&#34;\n&#34;</span><span class="op" id="1636239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636242"><a href="/gostd/runtime/mprof.go.html#1635759">gp</a></span><span class="op" id="1636244">.</span><span class="ident" id="1636245"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1636246">.</span><span class="ident" id="1636247"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788455">traceback</a></span>&nbsp;<span class="op" id="1636257">=</span>&nbsp;<span class="num" id="1636259">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636262"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1636268">(</span><span class="op" id="1636269">&amp;</span><span class="ident" id="1636270"><a href="/gostd/runtime/mprof.go.html#1635661">tracelock</a></span><span class="op" id="1636279">)</span><br>
<span class="lineno"></span><span class="op" id="1636281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span><span class="keyword" id="1636284">func</span>&nbsp;<span class="ident" id="1636289">tracefree</span><span class="op" id="1636298">(</span><span class="ident" id="1636299">p</span>&nbsp;<span class="ident" id="1636301"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1636307">.</span><span class="ident" id="1636308">Pointer</span><span class="op" id="1636315">,</span>&nbsp;<span class="ident" id="1636317">size</span>&nbsp;<span class="builtintype" id="1636322">uintptr</span><span class="op" id="1636329">)</span>&nbsp;<span class="op" id="1636331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636334"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1636338">(</span><span class="op" id="1636339">&amp;</span><span class="ident" id="1636340"><a href="/gostd/runtime/mprof.go.html#1635661">tracelock</a></span><span class="op" id="1636349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636352">gp</span>&nbsp;<span class="op" id="1636355">:=</span>&nbsp;<span class="ident" id="1636358"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1636362">(</span><span class="op" id="1636363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636366"><a href="/gostd/runtime/mprof.go.html#1636352">gp</a></span><span class="op" id="1636368">.</span><span class="ident" id="1636369"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1636370">.</span><span class="ident" id="1636371"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788455">traceback</a></span>&nbsp;<span class="op" id="1636381">=</span>&nbsp;<span class="num" id="1636383">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1636386">print</span><span class="op" id="1636391">(</span><span class="string" id="1636392">&#34;tracefree(&#34;</span><span class="op" id="1636404">,</span>&nbsp;<span class="ident" id="1636406"><a href="/gostd/runtime/mprof.go.html#1636299">p</a></span><span class="op" id="1636407">,</span>&nbsp;<span class="string" id="1636409">&#34;,&nbsp;&#34;</span><span class="op" id="1636413">,</span>&nbsp;<span class="ident" id="1636415"><a href="/gostd/runtime/print1.go.html#1664817">hex</a></span><span class="op" id="1636418">(</span><span class="ident" id="1636419"><a href="/gostd/runtime/mprof.go.html#1636317">size</a></span><span class="op" id="1636423">)</span><span class="op" id="1636424">,</span>&nbsp;<span class="string" id="1636426">&#34;)\n&#34;</span><span class="op" id="1636431">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636434"><a href="/gostd/runtime/traceback.go.html#1782290">goroutineheader</a></span><span class="op" id="1636449">(</span><span class="ident" id="1636450"><a href="/gostd/runtime/mprof.go.html#1636352">gp</a></span><span class="op" id="1636452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636455">pc</span>&nbsp;<span class="op" id="1636458">:=</span>&nbsp;<span class="ident" id="1636461"><a href="/gostd/runtime/stubs.go.html#1746397">getcallerpc</a></span><span class="op" id="1636472">(</span><span class="ident" id="1636473"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1636479">.</span><span class="ident" id="1636480">Pointer</span><span class="op" id="1636487">(</span><span class="op" id="1636488">&amp;</span><span class="ident" id="1636489"><a href="/gostd/runtime/mprof.go.html#1636299">p</a></span><span class="op" id="1636490">)</span><span class="op" id="1636491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636494">sp</span>&nbsp;<span class="op" id="1636497">:=</span>&nbsp;<span class="ident" id="1636500"><a href="/gostd/runtime/stubs.go.html#1746458">getcallersp</a></span><span class="op" id="1636511">(</span><span class="ident" id="1636512"><a href="/gostd/runtime/mprof.go.html#1619600">unsafe</a></span><span class="op" id="1636518">.</span><span class="ident" id="1636519">Pointer</span><span class="op" id="1636526">(</span><span class="op" id="1636527">&amp;</span><span class="ident" id="1636528"><a href="/gostd/runtime/mprof.go.html#1636299">p</a></span><span class="op" id="1636529">)</span><span class="op" id="1636530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636533"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1636536">(</span><span class="keyword" id="1636537">func</span><span class="op" id="1636541">(</span><span class="op" id="1636542">)</span>&nbsp;<span class="op" id="1636544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636548"><a href="/gostd/runtime/traceback.go.html#1779268">traceback</a></span><span class="op" id="1636557">(</span><span class="ident" id="1636558"><a href="/gostd/runtime/mprof.go.html#1636455">pc</a></span><span class="op" id="1636560">,</span>&nbsp;<span class="ident" id="1636562"><a href="/gostd/runtime/mprof.go.html#1636494">sp</a></span><span class="op" id="1636564">,</span>&nbsp;<span class="num" id="1636566">0</span><span class="op" id="1636567">,</span>&nbsp;<span class="ident" id="1636569"><a href="/gostd/runtime/mprof.go.html#1636352">gp</a></span><span class="op" id="1636571">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1636574">}</span><span class="op" id="1636575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1636578">print</span><span class="op" id="1636583">(</span><span class="string" id="1636584">&#34;\n&#34;</span><span class="op" id="1636588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636591"><a href="/gostd/runtime/mprof.go.html#1636352">gp</a></span><span class="op" id="1636593">.</span><span class="ident" id="1636594"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1636595">.</span><span class="ident" id="1636596"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788455">traceback</a></span>&nbsp;<span class="op" id="1636606">=</span>&nbsp;<span class="num" id="1636608">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636611"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1636617">(</span><span class="op" id="1636618">&amp;</span><span class="ident" id="1636619"><a href="/gostd/runtime/mprof.go.html#1635661">tracelock</a></span><span class="op" id="1636628">)</span><br>
<span class="lineno"></span><span class="op" id="1636630">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="keyword" id="1636633">func</span>&nbsp;<span class="ident" id="1636638">tracegc</span><span class="op" id="1636645">(</span><span class="op" id="1636646">)</span>&nbsp;<span class="op" id="1636648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636651"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1636655">(</span><span class="op" id="1636656">&amp;</span><span class="ident" id="1636657"><a href="/gostd/runtime/mprof.go.html#1635661">tracelock</a></span><span class="op" id="1636666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636669">gp</span>&nbsp;<span class="op" id="1636672">:=</span>&nbsp;<span class="ident" id="1636675"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1636679">(</span><span class="op" id="1636680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636683"><a href="/gostd/runtime/mprof.go.html#1636669">gp</a></span><span class="op" id="1636685">.</span><span class="ident" id="1636686"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1636687">.</span><span class="ident" id="1636688"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788455">traceback</a></span>&nbsp;<span class="op" id="1636698">=</span>&nbsp;<span class="num" id="1636700">2</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1636703">print</span><span class="op" id="1636708">(</span><span class="string" id="1636709">&#34;tracegc()\n&#34;</span><span class="op" id="1636722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1636725">//&nbsp;running&nbsp;on&nbsp;m-&gt;g0&nbsp;stack;&nbsp;show&nbsp;all&nbsp;non-g0&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636780"><a href="/gostd/runtime/traceback.go.html#1783208">tracebackothers</a></span><span class="op" id="1636795">(</span><span class="ident" id="1636796"><a href="/gostd/runtime/mprof.go.html#1636669">gp</a></span><span class="op" id="1636798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1636801">print</span><span class="op" id="1636806">(</span><span class="string" id="1636807">&#34;end&nbsp;tracegc\n&#34;</span><span class="op" id="1636822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1636825">print</span><span class="op" id="1636830">(</span><span class="string" id="1636831">&#34;\n&#34;</span><span class="op" id="1636835">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636838"><a href="/gostd/runtime/mprof.go.html#1636669">gp</a></span><span class="op" id="1636840">.</span><span class="ident" id="1636841"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787643">m</a></span><span class="op" id="1636842">.</span><span class="ident" id="1636843"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788455">traceback</a></span>&nbsp;<span class="op" id="1636853">=</span>&nbsp;<span class="num" id="1636855">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1636858"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1636864">(</span><span class="op" id="1636865">&amp;</span><span class="ident" id="1636866"><a href="/gostd/runtime/mprof.go.html#1635661">tracelock</a></span><span class="op" id="1636875">)</span><br>
<span class="lineno"></span><span class="op" id="1636877">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
