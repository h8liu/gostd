<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3633021">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3633076">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3633130">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3633181">//&nbsp;OFB&nbsp;(Output&nbsp;Feedback)&nbsp;Mode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3633213">package</span>&nbsp;<span class="ident" id="3633221">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3633229">type</span>&nbsp;<span class="ident" id="3633234">ofb</span>&nbsp;<span class="keyword" id="3633238">struct</span>&nbsp;<span class="op" id="3633245">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633248">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633256">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633263">cipher</span>&nbsp;&nbsp;<span class="op" id="3633271">[</span><span class="op" id="3633272">]</span><span class="builtintype" id="3633273">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633279">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3633287">[</span><span class="op" id="3633288">]</span><span class="builtintype" id="3633289">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633295">outUsed</span>&nbsp;<span class="builtintype" id="3633303">int</span><br>
<span class="lineno"></span><span class="op" id="3633307">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3633310">//&nbsp;NewOFB&nbsp;returns&nbsp;a&nbsp;Stream&nbsp;that&nbsp;encrypts&nbsp;or&nbsp;decrypts&nbsp;using&nbsp;the&nbsp;block&nbsp;cipher&nbsp;b</span><br>
<span class="lineno"></span><span class="comment" id="3633388">//&nbsp;in&nbsp;output&nbsp;feedback&nbsp;mode.&nbsp;The&nbsp;initialization&nbsp;vector&nbsp;iv&#39;s&nbsp;length&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span><span class="comment" id="3633468">//&nbsp;to&nbsp;b&#39;s&nbsp;block&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="3633490">func</span>&nbsp;<span class="ident" id="3633495">NewOFB</span><span class="op" id="3633501">(</span><span class="ident" id="3633502">b</span>&nbsp;<span class="ident" id="3633504">Block</span><span class="op" id="3633509">,</span>&nbsp;<span class="ident" id="3633511">iv</span>&nbsp;<span class="op" id="3633514">[</span><span class="op" id="3633515">]</span><span class="builtintype" id="3633516">byte</span><span class="op" id="3633520">)</span>&nbsp;<span class="ident" id="3633522">Stream</span>&nbsp;<span class="op" id="3633529">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633532">blockSize</span>&nbsp;<span class="op" id="3633542">:=</span>&nbsp;<span class="ident" id="3633545">b</span><span class="op" id="3633546">.</span><span class="ident" id="3633547">BlockSize</span><span class="op" id="3633556">(</span><span class="op" id="3633557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633560">if</span>&nbsp;<span class="builtinfunc" id="3633563">len</span><span class="op" id="3633566">(</span><span class="ident" id="3633567">iv</span><span class="op" id="3633569">)</span>&nbsp;<span class="op" id="3633571">!=</span>&nbsp;<span class="ident" id="3633574">blockSize</span>&nbsp;<span class="op" id="3633584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633588">return</span>&nbsp;<span class="ident" id="3633595">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3633600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633603">bufSize</span>&nbsp;<span class="op" id="3633611">:=</span>&nbsp;<span class="ident" id="3633614">streamBufferSize</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633632">if</span>&nbsp;<span class="ident" id="3633635">bufSize</span>&nbsp;<span class="op" id="3633643">&lt;</span>&nbsp;<span class="ident" id="3633645">blockSize</span>&nbsp;<span class="op" id="3633655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633659">bufSize</span>&nbsp;<span class="op" id="3633667">=</span>&nbsp;<span class="ident" id="3633669">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3633680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633683">x</span>&nbsp;<span class="op" id="3633685">:=</span>&nbsp;<span class="op" id="3633688">&amp;</span><span class="ident" id="3633689">ofb</span><span class="op" id="3633692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633696">b</span><span class="op" id="3633697">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3633705">b</span><span class="op" id="3633706">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633710">cipher</span><span class="op" id="3633716">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="3633719">make</span><span class="op" id="3633723">(</span><span class="op" id="3633724">[</span><span class="op" id="3633725">]</span><span class="builtintype" id="3633726">byte</span><span class="op" id="3633730">,</span>&nbsp;<span class="ident" id="3633732">blockSize</span><span class="op" id="3633741">)</span><span class="op" id="3633742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633746">out</span><span class="op" id="3633749">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3633755">make</span><span class="op" id="3633759">(</span><span class="op" id="3633760">[</span><span class="op" id="3633761">]</span><span class="builtintype" id="3633762">byte</span><span class="op" id="3633766">,</span>&nbsp;<span class="num" id="3633768">0</span><span class="op" id="3633769">,</span>&nbsp;<span class="ident" id="3633771">bufSize</span><span class="op" id="3633778">)</span><span class="op" id="3633779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633783">outUsed</span><span class="op" id="3633790">:</span>&nbsp;<span class="num" id="3633792">0</span><span class="op" id="3633793">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3633796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3633800">copy</span><span class="op" id="3633804">(</span><span class="ident" id="3633805">x</span><span class="op" id="3633806">.</span><span class="ident" id="3633807">cipher</span><span class="op" id="3633813">,</span>&nbsp;<span class="ident" id="3633815">iv</span><span class="op" id="3633817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633820">return</span>&nbsp;<span class="ident" id="3633827">x</span><br>
<span class="lineno"></span><span class="op" id="3633829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3633832">func</span>&nbsp;<span class="op" id="3633837">(</span><span class="ident" id="3633838">x</span>&nbsp;<span class="op" id="3633840">*</span><span class="ident" id="3633841">ofb</span><span class="op" id="3633844">)</span>&nbsp;<span class="ident" id="3633846">refill</span><span class="op" id="3633852">(</span><span class="op" id="3633853">)</span>&nbsp;<span class="op" id="3633855">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633858">bs</span>&nbsp;<span class="op" id="3633861">:=</span>&nbsp;<span class="ident" id="3633864">x</span><span class="op" id="3633865">.</span><span class="ident" id="3633866">b</span><span class="op" id="3633867">.</span><span class="ident" id="3633868">BlockSize</span><span class="op" id="3633877">(</span><span class="op" id="3633878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633881">remain</span>&nbsp;<span class="op" id="3633888">:=</span>&nbsp;<span class="builtinfunc" id="3633891">len</span><span class="op" id="3633894">(</span><span class="ident" id="3633895">x</span><span class="op" id="3633896">.</span><span class="ident" id="3633897">out</span><span class="op" id="3633900">)</span>&nbsp;<span class="op" id="3633902">-</span>&nbsp;<span class="ident" id="3633904">x</span><span class="op" id="3633905">.</span><span class="ident" id="3633906">outUsed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633915">if</span>&nbsp;<span class="ident" id="3633918">remain</span>&nbsp;<span class="op" id="3633925">&gt;</span>&nbsp;<span class="ident" id="3633927">x</span><span class="op" id="3633928">.</span><span class="ident" id="3633929">outUsed</span>&nbsp;<span class="op" id="3633937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3633941">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3633949">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3633952">copy</span><span class="op" id="3633956">(</span><span class="ident" id="3633957">x</span><span class="op" id="3633958">.</span><span class="ident" id="3633959">out</span><span class="op" id="3633962">,</span>&nbsp;<span class="ident" id="3633964">x</span><span class="op" id="3633965">.</span><span class="ident" id="3633966">out</span><span class="op" id="3633969">[</span><span class="ident" id="3633970">x</span><span class="op" id="3633971">.</span><span class="ident" id="3633972">outUsed</span><span class="op" id="3633979">:</span><span class="op" id="3633980">]</span><span class="op" id="3633981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633984">x</span><span class="op" id="3633985">.</span><span class="ident" id="3633986">out</span>&nbsp;<span class="op" id="3633990">=</span>&nbsp;<span class="ident" id="3633992">x</span><span class="op" id="3633993">.</span><span class="ident" id="3633994">out</span><span class="op" id="3633997">[</span><span class="op" id="3633998">:</span><span class="builtinfunc" id="3633999">cap</span><span class="op" id="3634002">(</span><span class="ident" id="3634003">x</span><span class="op" id="3634004">.</span><span class="ident" id="3634005">out</span><span class="op" id="3634008">)</span><span class="op" id="3634009">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634012">for</span>&nbsp;<span class="ident" id="3634016">remain</span>&nbsp;<span class="op" id="3634023">&lt;</span>&nbsp;<span class="builtinfunc" id="3634025">len</span><span class="op" id="3634028">(</span><span class="ident" id="3634029">x</span><span class="op" id="3634030">.</span><span class="ident" id="3634031">out</span><span class="op" id="3634034">)</span><span class="op" id="3634035">-</span><span class="ident" id="3634036">bs</span>&nbsp;<span class="op" id="3634039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634043">x</span><span class="op" id="3634044">.</span><span class="ident" id="3634045">b</span><span class="op" id="3634046">.</span><span class="ident" id="3634047">Encrypt</span><span class="op" id="3634054">(</span><span class="ident" id="3634055">x</span><span class="op" id="3634056">.</span><span class="ident" id="3634057">cipher</span><span class="op" id="3634063">,</span>&nbsp;<span class="ident" id="3634065">x</span><span class="op" id="3634066">.</span><span class="ident" id="3634067">cipher</span><span class="op" id="3634073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3634077">copy</span><span class="op" id="3634081">(</span><span class="ident" id="3634082">x</span><span class="op" id="3634083">.</span><span class="ident" id="3634084">out</span><span class="op" id="3634087">[</span><span class="ident" id="3634088">remain</span><span class="op" id="3634094">:</span><span class="op" id="3634095">]</span><span class="op" id="3634096">,</span>&nbsp;<span class="ident" id="3634098">x</span><span class="op" id="3634099">.</span><span class="ident" id="3634100">cipher</span><span class="op" id="3634106">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634110">remain</span>&nbsp;<span class="op" id="3634117">+=</span>&nbsp;<span class="ident" id="3634120">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634127">x</span><span class="op" id="3634128">.</span><span class="ident" id="3634129">out</span>&nbsp;<span class="op" id="3634133">=</span>&nbsp;<span class="ident" id="3634135">x</span><span class="op" id="3634136">.</span><span class="ident" id="3634137">out</span><span class="op" id="3634140">[</span><span class="op" id="3634141">:</span><span class="ident" id="3634142">remain</span><span class="op" id="3634148">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634151">x</span><span class="op" id="3634152">.</span><span class="ident" id="3634153">outUsed</span>&nbsp;<span class="op" id="3634161">=</span>&nbsp;<span class="num" id="3634163">0</span><br>
<span class="lineno"></span><span class="op" id="3634165">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="3634168">func</span>&nbsp;<span class="op" id="3634173">(</span><span class="ident" id="3634174">x</span>&nbsp;<span class="op" id="3634176">*</span><span class="ident" id="3634177">ofb</span><span class="op" id="3634180">)</span>&nbsp;<span class="ident" id="3634182">XORKeyStream</span><span class="op" id="3634194">(</span><span class="ident" id="3634195">dst</span><span class="op" id="3634198">,</span>&nbsp;<span class="ident" id="3634200">src</span>&nbsp;<span class="op" id="3634204">[</span><span class="op" id="3634205">]</span><span class="builtintype" id="3634206">byte</span><span class="op" id="3634210">)</span>&nbsp;<span class="op" id="3634212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634215">for</span>&nbsp;<span class="builtinfunc" id="3634219">len</span><span class="op" id="3634222">(</span><span class="ident" id="3634223">src</span><span class="op" id="3634226">)</span>&nbsp;<span class="op" id="3634228">&gt;</span>&nbsp;<span class="num" id="3634230">0</span>&nbsp;<span class="op" id="3634232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634236">if</span>&nbsp;<span class="ident" id="3634239">x</span><span class="op" id="3634240">.</span><span class="ident" id="3634241">outUsed</span>&nbsp;<span class="op" id="3634249">&gt;=</span>&nbsp;<span class="builtinfunc" id="3634252">len</span><span class="op" id="3634255">(</span><span class="ident" id="3634256">x</span><span class="op" id="3634257">.</span><span class="ident" id="3634258">out</span><span class="op" id="3634261">)</span><span class="op" id="3634262">-</span><span class="ident" id="3634263">x</span><span class="op" id="3634264">.</span><span class="ident" id="3634265">b</span><span class="op" id="3634266">.</span><span class="ident" id="3634267">BlockSize</span><span class="op" id="3634276">(</span><span class="op" id="3634277">)</span>&nbsp;<span class="op" id="3634279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634284">x</span><span class="op" id="3634285">.</span><span class="ident" id="3634286">refill</span><span class="op" id="3634292">(</span><span class="op" id="3634293">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634301">n</span>&nbsp;<span class="op" id="3634303">:=</span>&nbsp;<span class="ident" id="3634306">xorBytes</span><span class="op" id="3634314">(</span><span class="ident" id="3634315">dst</span><span class="op" id="3634318">,</span>&nbsp;<span class="ident" id="3634320">src</span><span class="op" id="3634323">,</span>&nbsp;<span class="ident" id="3634325">x</span><span class="op" id="3634326">.</span><span class="ident" id="3634327">out</span><span class="op" id="3634330">[</span><span class="ident" id="3634331">x</span><span class="op" id="3634332">.</span><span class="ident" id="3634333">outUsed</span><span class="op" id="3634340">:</span><span class="op" id="3634341">]</span><span class="op" id="3634342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634346">dst</span>&nbsp;<span class="op" id="3634350">=</span>&nbsp;<span class="ident" id="3634352">dst</span><span class="op" id="3634355">[</span><span class="ident" id="3634356">n</span><span class="op" id="3634357">:</span><span class="op" id="3634358">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634362">src</span>&nbsp;<span class="op" id="3634366">=</span>&nbsp;<span class="ident" id="3634368">src</span><span class="op" id="3634371">[</span><span class="ident" id="3634372">n</span><span class="op" id="3634373">:</span><span class="op" id="3634374">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634378">x</span><span class="op" id="3634379">.</span><span class="ident" id="3634380">outUsed</span>&nbsp;<span class="op" id="3634388">+=</span>&nbsp;<span class="ident" id="3634391">n</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634394">}</span><br>
<span class="lineno"></span><span class="op" id="3634396">}</span>
</div>
</body>
</html>
