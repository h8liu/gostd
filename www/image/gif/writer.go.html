<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6265000">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6265055">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6265109">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6265160">package</span>&nbsp;<span class="ident" id="6265168">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6265173">import</span>&nbsp;<span class="op" id="6265180">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6265183">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6265192">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6265208">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6265218">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6265227">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6265242">&#34;image/color/palette&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6265265">&#34;image/draw&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6265279">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6265284">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6265287">//&nbsp;Graphic&nbsp;control&nbsp;extension&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="6265324">const</span>&nbsp;<span class="op" id="6265330">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265333">gcLabel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6265345">=</span>&nbsp;<span class="num" id="6265347">0xF9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265353">gcBlockSize</span>&nbsp;<span class="op" id="6265365">=</span>&nbsp;<span class="num" id="6265367">0x04</span><br>
<span class="lineno"></span><span class="op" id="6265372">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6265375">var</span>&nbsp;<span class="ident" id="6265379">log2Lookup</span>&nbsp;<span class="op" id="6265390">=</span>&nbsp;<span class="op" id="6265392">[</span><span class="num" id="6265393">8</span><span class="op" id="6265394">]</span><span class="builtintype" id="6265395">int</span><span class="op" id="6265398">{</span><span class="num" id="6265399">2</span><span class="op" id="6265400">,</span>&nbsp;<span class="num" id="6265402">4</span><span class="op" id="6265403">,</span>&nbsp;<span class="num" id="6265405">8</span><span class="op" id="6265406">,</span>&nbsp;<span class="num" id="6265408">16</span><span class="op" id="6265410">,</span>&nbsp;<span class="num" id="6265412">32</span><span class="op" id="6265414">,</span>&nbsp;<span class="num" id="6265416">64</span><span class="op" id="6265418">,</span>&nbsp;<span class="num" id="6265420">128</span><span class="op" id="6265423">,</span>&nbsp;<span class="num" id="6265425">256</span><span class="op" id="6265428">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="6265431">func</span>&nbsp;<span class="ident" id="6265436">log2</span><span class="op" id="6265440">(</span><span class="ident" id="6265441">x</span>&nbsp;<span class="builtintype" id="6265443">int</span><span class="op" id="6265446">)</span>&nbsp;<span class="builtintype" id="6265448">int</span>&nbsp;<span class="op" id="6265452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265455">for</span>&nbsp;<span class="ident" id="6265459">i</span><span class="op" id="6265460">,</span>&nbsp;<span class="ident" id="6265462">v</span>&nbsp;<span class="op" id="6265464">:=</span>&nbsp;<span class="keyword" id="6265467">range</span>&nbsp;<span class="ident" id="6265473"><a href="/image/gif/writer.go.html#6265379">log2Lookup</a></span>&nbsp;<span class="op" id="6265484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265488">if</span>&nbsp;<span class="ident" id="6265491"><a href="/image/gif/writer.go.html#6265441">x</a></span>&nbsp;<span class="op" id="6265493">&lt;=</span>&nbsp;<span class="ident" id="6265496"><a href="/image/gif/writer.go.html#6265462">v</a></span>&nbsp;<span class="op" id="6265498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265503">return</span>&nbsp;<span class="ident" id="6265510"><a href="/image/gif/writer.go.html#6265459">i</a></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6265517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6265520">return</span>&nbsp;<span class="op" id="6265527">-</span><span class="num" id="6265528">1</span><br>
<span class="lineno"></span><span class="op" id="6265530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="6265533">//&nbsp;Little-endian.</span><br>
<span class="lineno"></span><span class="keyword" id="6265551">func</span>&nbsp;<span class="ident" id="6265556">writeUint16</span><span class="op" id="6265567">(</span><span class="ident" id="6265568">b</span>&nbsp;<span class="op" id="6265570">[</span><span class="op" id="6265571">]</span><span class="builtintype" id="6265572">uint8</span><span class="op" id="6265577">,</span>&nbsp;<span class="ident" id="6265579">u</span>&nbsp;<span class="builtintype" id="6265581">uint16</span><span class="op" id="6265587">)</span>&nbsp;<span class="op" id="6265589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265592"><a href="/image/gif/writer.go.html#6265568">b</a></span><span class="op" id="6265593">[</span><span class="num" id="6265594">0</span><span class="op" id="6265595">]</span>&nbsp;<span class="op" id="6265597">=</span>&nbsp;<span class="builtintype" id="6265599">uint8</span><span class="op" id="6265604">(</span><span class="ident" id="6265605"><a href="/image/gif/writer.go.html#6265579">u</a></span><span class="op" id="6265606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265609"><a href="/image/gif/writer.go.html#6265568">b</a></span><span class="op" id="6265610">[</span><span class="num" id="6265611">1</span><span class="op" id="6265612">]</span>&nbsp;<span class="op" id="6265614">=</span>&nbsp;<span class="builtintype" id="6265616">uint8</span><span class="op" id="6265621">(</span><span class="ident" id="6265622"><a href="/image/gif/writer.go.html#6265579">u</a></span>&nbsp;<span class="op" id="6265624">&gt;&gt;</span>&nbsp;<span class="num" id="6265627">8</span><span class="op" id="6265628">)</span><br>
<span class="lineno"></span><span class="op" id="6265630">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="6265633">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6265665">type</span>&nbsp;<span class="ident" id="6265670">writer</span>&nbsp;<span class="keyword" id="6265677">interface</span>&nbsp;<span class="op" id="6265687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265690">Flush</span><span class="op" id="6265695">(</span><span class="op" id="6265696">)</span>&nbsp;<span class="builtintype" id="6265698">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265705"><a href="/image/gif/writer.go.html#6265279">io</a></span><span class="op" id="6265707">.</span><span class="ident" id="6265708">Writer</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265716"><a href="/image/gif/writer.go.html#6265279">io</a></span><span class="op" id="6265718">.</span><span class="ident" id="6265719">ByteWriter</span><br>
<span class="lineno"></span><span class="op" id="6265730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6265733">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;GIF&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="6265780">type</span>&nbsp;<span class="ident" id="6265785">encoder</span>&nbsp;<span class="keyword" id="6265793">struct</span>&nbsp;<span class="op" id="6265800">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6265803">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6265878">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265949">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6265953"><a href="/image/gif/writer.go.html#6265670">writer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6265961">err</span>&nbsp;<span class="builtintype" id="6265965">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6265972">//&nbsp;g&nbsp;is&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;data&nbsp;that&nbsp;is&nbsp;being&nbsp;encoded.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266028">g</span>&nbsp;<span class="op" id="6266030">*</span><span class="ident" id="6266031"><a href="/image/gif/reader.go.html#6264003">GIF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6266036">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.&nbsp;It&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;write&nbsp;the&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266120">buf</span>&nbsp;<span class="op" id="6266124">[</span><span class="num" id="6266125">1024</span><span class="op" id="6266129">]</span><span class="builtintype" id="6266130">byte</span><br>
<span class="lineno"></span><span class="op" id="6266135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6266138">//&nbsp;blockWriter&nbsp;writes&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="6266205">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6266271">//&nbsp;writer&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;encoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6266335">//&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="6266348">type</span>&nbsp;<span class="ident" id="6266353">blockWriter</span>&nbsp;<span class="keyword" id="6266365">struct</span>&nbsp;<span class="op" id="6266372">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266375">e</span>&nbsp;<span class="op" id="6266377">*</span><span class="ident" id="6266378"><a href="/image/gif/writer.go.html#6265785">encoder</a></span><br>
<span class="lineno"></span><span class="op" id="6266386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6266389">func</span>&nbsp;<span class="op" id="6266394">(</span><span class="ident" id="6266395">b</span>&nbsp;<span class="ident" id="6266397"><a href="/image/gif/writer.go.html#6266353">blockWriter</a></span><span class="op" id="6266408">)</span>&nbsp;<span class="ident" id="6266410">Write</span><span class="op" id="6266415">(</span><span class="ident" id="6266416">data</span>&nbsp;<span class="op" id="6266421">[</span><span class="op" id="6266422">]</span><span class="builtintype" id="6266423">byte</span><span class="op" id="6266427">)</span>&nbsp;<span class="op" id="6266429">(</span><span class="builtintype" id="6266430">int</span><span class="op" id="6266433">,</span>&nbsp;<span class="builtintype" id="6266435">error</span><span class="op" id="6266440">)</span>&nbsp;<span class="op" id="6266442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266445">if</span>&nbsp;<span class="ident" id="6266448"><a href="/image/gif/writer.go.html#6266395">b</a></span><span class="op" id="6266449">.</span><span class="ident" id="6266450">e</span><span class="op" id="6266451">.</span><span class="ident" id="6266452">err</span>&nbsp;<span class="op" id="6266456">!=</span>&nbsp;<span class="ident" id="6266459">nil</span>&nbsp;<span class="op" id="6266463">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266467">return</span>&nbsp;<span class="num" id="6266474">0</span><span class="op" id="6266475">,</span>&nbsp;<span class="ident" id="6266477"><a href="/image/gif/writer.go.html#6266395">b</a></span><span class="op" id="6266478">.</span><span class="ident" id="6266479">e</span><span class="op" id="6266480">.</span><span class="ident" id="6266481">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266489">if</span>&nbsp;<span class="builtinfunc" id="6266492">len</span><span class="op" id="6266495">(</span><span class="ident" id="6266496"><a href="/image/gif/writer.go.html#6266416">data</a></span><span class="op" id="6266500">)</span>&nbsp;<span class="op" id="6266502">==</span>&nbsp;<span class="num" id="6266505">0</span>&nbsp;<span class="op" id="6266507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266511">return</span>&nbsp;<span class="num" id="6266518">0</span><span class="op" id="6266519">,</span>&nbsp;<span class="ident" id="6266521">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266526">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266529">total</span>&nbsp;<span class="op" id="6266535">:=</span>&nbsp;<span class="num" id="6266538">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266541">for</span>&nbsp;<span class="ident" id="6266545"><a href="/image/gif/writer.go.html#6266529">total</a></span>&nbsp;<span class="op" id="6266551">&lt;</span>&nbsp;<span class="builtinfunc" id="6266553">len</span><span class="op" id="6266556">(</span><span class="ident" id="6266557"><a href="/image/gif/writer.go.html#6266416">data</a></span><span class="op" id="6266561">)</span>&nbsp;<span class="op" id="6266563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266567">n</span>&nbsp;<span class="op" id="6266569">:=</span>&nbsp;<span class="builtinfunc" id="6266572">copy</span><span class="op" id="6266576">(</span><span class="ident" id="6266577"><a href="/image/gif/writer.go.html#6266395">b</a></span><span class="op" id="6266578">.</span><span class="ident" id="6266579">e</span><span class="op" id="6266580">.</span><span class="ident" id="6266581">buf</span><span class="op" id="6266584">[</span><span class="num" id="6266585">1</span><span class="op" id="6266586">:</span><span class="num" id="6266587">256</span><span class="op" id="6266590">]</span><span class="op" id="6266591">,</span>&nbsp;<span class="ident" id="6266593"><a href="/image/gif/writer.go.html#6266416">data</a></span><span class="op" id="6266597">[</span><span class="ident" id="6266598"><a href="/image/gif/writer.go.html#6266529">total</a></span><span class="op" id="6266603">:</span><span class="op" id="6266604">]</span><span class="op" id="6266605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266609"><a href="/image/gif/writer.go.html#6266529">total</a></span>&nbsp;<span class="op" id="6266615">+=</span>&nbsp;<span class="ident" id="6266618"><a href="/image/gif/writer.go.html#6266567">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266622"><a href="/image/gif/writer.go.html#6266395">b</a></span><span class="op" id="6266623">.</span><span class="ident" id="6266624">e</span><span class="op" id="6266625">.</span><span class="ident" id="6266626">buf</span><span class="op" id="6266629">[</span><span class="num" id="6266630">0</span><span class="op" id="6266631">]</span>&nbsp;<span class="op" id="6266633">=</span>&nbsp;<span class="builtintype" id="6266635">uint8</span><span class="op" id="6266640">(</span><span class="ident" id="6266641"><a href="/image/gif/writer.go.html#6266567">n</a></span><span class="op" id="6266642">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266647"><a href="/image/gif/writer.go.html#6266567">n</a></span><span class="op" id="6266648">,</span>&nbsp;<span class="ident" id="6266650"><a href="/image/gif/writer.go.html#6266395">b</a></span><span class="op" id="6266651">.</span><span class="ident" id="6266652">e</span><span class="op" id="6266653">.</span><span class="ident" id="6266654">err</span>&nbsp;<span class="op" id="6266658">=</span>&nbsp;<span class="ident" id="6266660"><a href="/image/gif/writer.go.html#6266395">b</a></span><span class="op" id="6266661">.</span><span class="ident" id="6266662">e</span><span class="op" id="6266663">.</span><span class="ident" id="6266664">w</span><span class="op" id="6266665">.</span><span class="ident" id="6266666">Write</span><span class="op" id="6266671">(</span><span class="ident" id="6266672"><a href="/image/gif/writer.go.html#6266395">b</a></span><span class="op" id="6266673">.</span><span class="ident" id="6266674">e</span><span class="op" id="6266675">.</span><span class="ident" id="6266676">buf</span><span class="op" id="6266679">[</span><span class="op" id="6266680">:</span><span class="ident" id="6266681"><a href="/image/gif/writer.go.html#6266567">n</a></span><span class="op" id="6266682">+</span><span class="num" id="6266683">1</span><span class="op" id="6266684">]</span><span class="op" id="6266685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266689">if</span>&nbsp;<span class="ident" id="6266692"><a href="/image/gif/writer.go.html#6266395">b</a></span><span class="op" id="6266693">.</span><span class="ident" id="6266694">e</span><span class="op" id="6266695">.</span><span class="ident" id="6266696">err</span>&nbsp;<span class="op" id="6266700">!=</span>&nbsp;<span class="ident" id="6266703">nil</span>&nbsp;<span class="op" id="6266707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266712">return</span>&nbsp;<span class="num" id="6266719">0</span><span class="op" id="6266720">,</span>&nbsp;<span class="ident" id="6266722"><a href="/image/gif/writer.go.html#6266395">b</a></span><span class="op" id="6266723">.</span><span class="ident" id="6266724">e</span><span class="op" id="6266725">.</span><span class="ident" id="6266726">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266732">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266738">return</span>&nbsp;<span class="ident" id="6266745"><a href="/image/gif/writer.go.html#6266529">total</a></span><span class="op" id="6266750">,</span>&nbsp;<span class="ident" id="6266752"><a href="/image/gif/writer.go.html#6266395">b</a></span><span class="op" id="6266753">.</span><span class="ident" id="6266754">e</span><span class="op" id="6266755">.</span><span class="ident" id="6266756">err</span><br>
<span class="lineno"></span><span class="op" id="6266760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6266763">func</span>&nbsp;<span class="op" id="6266768">(</span><span class="ident" id="6266769">e</span>&nbsp;<span class="op" id="6266771">*</span><span class="ident" id="6266772"><a href="/image/gif/writer.go.html#6265785">encoder</a></span><span class="op" id="6266779">)</span>&nbsp;<span class="ident" id="6266781">flush</span><span class="op" id="6266786">(</span><span class="op" id="6266787">)</span>&nbsp;<span class="op" id="6266789">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266792">if</span>&nbsp;<span class="ident" id="6266795"><a href="/image/gif/writer.go.html#6266769">e</a></span><span class="op" id="6266796">.</span><span class="ident" id="6266797">err</span>&nbsp;<span class="op" id="6266801">!=</span>&nbsp;<span class="ident" id="6266804">nil</span>&nbsp;<span class="op" id="6266808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266812">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266823"><a href="/image/gif/writer.go.html#6266769">e</a></span><span class="op" id="6266824">.</span><span class="ident" id="6266825">err</span>&nbsp;<span class="op" id="6266829">=</span>&nbsp;<span class="ident" id="6266831"><a href="/image/gif/writer.go.html#6266769">e</a></span><span class="op" id="6266832">.</span><span class="ident" id="6266833">w</span><span class="op" id="6266834">.</span><span class="ident" id="6266835">Flush</span><span class="op" id="6266840">(</span><span class="op" id="6266841">)</span><br>
<span class="lineno"></span><span class="op" id="6266843">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="6266846">func</span>&nbsp;<span class="op" id="6266851">(</span><span class="ident" id="6266852">e</span>&nbsp;<span class="op" id="6266854">*</span><span class="ident" id="6266855"><a href="/image/gif/writer.go.html#6265785">encoder</a></span><span class="op" id="6266862">)</span>&nbsp;<span class="ident" id="6266864">write</span><span class="op" id="6266869">(</span><span class="ident" id="6266870">p</span>&nbsp;<span class="op" id="6266872">[</span><span class="op" id="6266873">]</span><span class="builtintype" id="6266874">byte</span><span class="op" id="6266878">)</span>&nbsp;<span class="op" id="6266880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266883">if</span>&nbsp;<span class="ident" id="6266886"><a href="/image/gif/writer.go.html#6266852">e</a></span><span class="op" id="6266887">.</span><span class="ident" id="6266888">err</span>&nbsp;<span class="op" id="6266892">!=</span>&nbsp;<span class="ident" id="6266895">nil</span>&nbsp;<span class="op" id="6266899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266903">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6266911">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6266914">_</span><span class="op" id="6266915">,</span>&nbsp;<span class="ident" id="6266917"><a href="/image/gif/writer.go.html#6266852">e</a></span><span class="op" id="6266918">.</span><span class="ident" id="6266919">err</span>&nbsp;<span class="op" id="6266923">=</span>&nbsp;<span class="ident" id="6266925"><a href="/image/gif/writer.go.html#6266852">e</a></span><span class="op" id="6266926">.</span><span class="ident" id="6266927">w</span><span class="op" id="6266928">.</span><span class="ident" id="6266929">Write</span><span class="op" id="6266934">(</span><span class="ident" id="6266935"><a href="/image/gif/writer.go.html#6266870">p</a></span><span class="op" id="6266936">)</span><br>
<span class="lineno"></span><span class="op" id="6266938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6266941">func</span>&nbsp;<span class="op" id="6266946">(</span><span class="ident" id="6266947">e</span>&nbsp;<span class="op" id="6266949">*</span><span class="ident" id="6266950"><a href="/image/gif/writer.go.html#6265785">encoder</a></span><span class="op" id="6266957">)</span>&nbsp;<span class="ident" id="6266959">writeByte</span><span class="op" id="6266968">(</span><span class="ident" id="6266969">b</span>&nbsp;<span class="builtintype" id="6266971">byte</span><span class="op" id="6266975">)</span>&nbsp;<span class="op" id="6266977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6266980">if</span>&nbsp;<span class="ident" id="6266983"><a href="/image/gif/writer.go.html#6266947">e</a></span><span class="op" id="6266984">.</span><span class="ident" id="6266985">err</span>&nbsp;<span class="op" id="6266989">!=</span>&nbsp;<span class="ident" id="6266992">nil</span>&nbsp;<span class="op" id="6266996">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267000">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267011"><a href="/image/gif/writer.go.html#6266947">e</a></span><span class="op" id="6267012">.</span><span class="ident" id="6267013">err</span>&nbsp;<span class="op" id="6267017">=</span>&nbsp;<span class="ident" id="6267019"><a href="/image/gif/writer.go.html#6266947">e</a></span><span class="op" id="6267020">.</span><span class="ident" id="6267021">w</span><span class="op" id="6267022">.</span><span class="ident" id="6267023">WriteByte</span><span class="op" id="6267032">(</span><span class="ident" id="6267033"><a href="/image/gif/writer.go.html#6266969">b</a></span><span class="op" id="6267034">)</span><br>
<span class="lineno"></span><span class="op" id="6267036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6267039">func</span>&nbsp;<span class="op" id="6267044">(</span><span class="ident" id="6267045">e</span>&nbsp;<span class="op" id="6267047">*</span><span class="ident" id="6267048"><a href="/image/gif/writer.go.html#6265785">encoder</a></span><span class="op" id="6267055">)</span>&nbsp;<span class="ident" id="6267057">writeHeader</span><span class="op" id="6267068">(</span><span class="op" id="6267069">)</span>&nbsp;<span class="op" id="6267071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267074">if</span>&nbsp;<span class="ident" id="6267077"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267078">.</span><span class="ident" id="6267079">err</span>&nbsp;<span class="op" id="6267083">!=</span>&nbsp;<span class="ident" id="6267086">nil</span>&nbsp;<span class="op" id="6267090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267094">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267105">_</span><span class="op" id="6267106">,</span>&nbsp;<span class="ident" id="6267108"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267109">.</span><span class="ident" id="6267110">err</span>&nbsp;<span class="op" id="6267114">=</span>&nbsp;<span class="ident" id="6267116"><a href="/image/gif/writer.go.html#6265279">io</a></span><span class="op" id="6267118">.</span><span class="ident" id="6267119">WriteString</span><span class="op" id="6267130">(</span><span class="ident" id="6267131"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267132">.</span><span class="ident" id="6267133">w</span><span class="op" id="6267134">,</span>&nbsp;<span class="string" id="6267136">&#34;GIF89a&#34;</span><span class="op" id="6267144">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267147">if</span>&nbsp;<span class="ident" id="6267150"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267151">.</span><span class="ident" id="6267152">err</span>&nbsp;<span class="op" id="6267156">!=</span>&nbsp;<span class="ident" id="6267159">nil</span>&nbsp;<span class="op" id="6267163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267167">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267179">pm</span>&nbsp;<span class="op" id="6267182">:=</span>&nbsp;<span class="ident" id="6267185"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267186">.</span><span class="ident" id="6267187">g</span><span class="op" id="6267188">.</span><span class="ident" id="6267189">Image</span><span class="op" id="6267194">[</span><span class="num" id="6267195">0</span><span class="op" id="6267196">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6267199">//&nbsp;Logical&nbsp;screen&nbsp;width&nbsp;and&nbsp;height.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267236"><a href="/image/gif/writer.go.html#6265556">writeUint16</a></span><span class="op" id="6267247">(</span><span class="ident" id="6267248"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267249">.</span><span class="ident" id="6267250">buf</span><span class="op" id="6267253">[</span><span class="num" id="6267254">0</span><span class="op" id="6267255">:</span><span class="num" id="6267256">2</span><span class="op" id="6267257">]</span><span class="op" id="6267258">,</span>&nbsp;<span class="builtintype" id="6267260">uint16</span><span class="op" id="6267266">(</span><span class="ident" id="6267267"><a href="/image/gif/writer.go.html#6267179">pm</a></span><span class="op" id="6267269">.</span><span class="ident" id="6267270">Bounds</span><span class="op" id="6267276">(</span><span class="op" id="6267277">)</span><span class="op" id="6267278">.</span><span class="ident" id="6267279">Dx</span><span class="op" id="6267281">(</span><span class="op" id="6267282">)</span><span class="op" id="6267283">)</span><span class="op" id="6267284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267287"><a href="/image/gif/writer.go.html#6265556">writeUint16</a></span><span class="op" id="6267298">(</span><span class="ident" id="6267299"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267300">.</span><span class="ident" id="6267301">buf</span><span class="op" id="6267304">[</span><span class="num" id="6267305">2</span><span class="op" id="6267306">:</span><span class="num" id="6267307">4</span><span class="op" id="6267308">]</span><span class="op" id="6267309">,</span>&nbsp;<span class="builtintype" id="6267311">uint16</span><span class="op" id="6267317">(</span><span class="ident" id="6267318"><a href="/image/gif/writer.go.html#6267179">pm</a></span><span class="op" id="6267320">.</span><span class="ident" id="6267321">Bounds</span><span class="op" id="6267327">(</span><span class="op" id="6267328">)</span><span class="op" id="6267329">.</span><span class="ident" id="6267330">Dy</span><span class="op" id="6267332">(</span><span class="op" id="6267333">)</span><span class="op" id="6267334">)</span><span class="op" id="6267335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267338"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267339">.</span><span class="ident" id="6267340">write</span><span class="op" id="6267345">(</span><span class="ident" id="6267346"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267347">.</span><span class="ident" id="6267348">buf</span><span class="op" id="6267351">[</span><span class="op" id="6267352">:</span><span class="num" id="6267353">4</span><span class="op" id="6267354">]</span><span class="op" id="6267355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6267359">//&nbsp;All&nbsp;frames&nbsp;have&nbsp;a&nbsp;local&nbsp;color&nbsp;table,&nbsp;so&nbsp;a&nbsp;global&nbsp;color&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6267424">//&nbsp;is&nbsp;not&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267443"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267444">.</span><span class="ident" id="6267445">buf</span><span class="op" id="6267448">[</span><span class="num" id="6267449">0</span><span class="op" id="6267450">]</span>&nbsp;<span class="op" id="6267452">=</span>&nbsp;<span class="num" id="6267454">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267460"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267461">.</span><span class="ident" id="6267462">buf</span><span class="op" id="6267465">[</span><span class="num" id="6267466">1</span><span class="op" id="6267467">]</span>&nbsp;<span class="op" id="6267469">=</span>&nbsp;<span class="num" id="6267471">0x00</span>&nbsp;<span class="comment" id="6267476">//&nbsp;Background&nbsp;Color&nbsp;Index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267504"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267505">.</span><span class="ident" id="6267506">buf</span><span class="op" id="6267509">[</span><span class="num" id="6267510">2</span><span class="op" id="6267511">]</span>&nbsp;<span class="op" id="6267513">=</span>&nbsp;<span class="num" id="6267515">0x00</span>&nbsp;<span class="comment" id="6267520">//&nbsp;Pixel&nbsp;Aspect&nbsp;Ratio.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267544"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267545">.</span><span class="ident" id="6267546">write</span><span class="op" id="6267551">(</span><span class="ident" id="6267552"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267553">.</span><span class="ident" id="6267554">buf</span><span class="op" id="6267557">[</span><span class="op" id="6267558">:</span><span class="num" id="6267559">3</span><span class="op" id="6267560">]</span><span class="op" id="6267561">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6267565">//&nbsp;Add&nbsp;animation&nbsp;info&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267602">if</span>&nbsp;<span class="builtinfunc" id="6267605">len</span><span class="op" id="6267608">(</span><span class="ident" id="6267609"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267610">.</span><span class="ident" id="6267611">g</span><span class="op" id="6267612">.</span><span class="ident" id="6267613">Image</span><span class="op" id="6267618">)</span>&nbsp;<span class="op" id="6267620">&gt;</span>&nbsp;<span class="num" id="6267622">1</span>&nbsp;<span class="op" id="6267624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267628"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267629">.</span><span class="ident" id="6267630">buf</span><span class="op" id="6267633">[</span><span class="num" id="6267634">0</span><span class="op" id="6267635">]</span>&nbsp;<span class="op" id="6267637">=</span>&nbsp;<span class="num" id="6267639">0x21</span>&nbsp;<span class="comment" id="6267644">//&nbsp;Extension&nbsp;Introducer.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267671"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267672">.</span><span class="ident" id="6267673">buf</span><span class="op" id="6267676">[</span><span class="num" id="6267677">1</span><span class="op" id="6267678">]</span>&nbsp;<span class="op" id="6267680">=</span>&nbsp;<span class="num" id="6267682">0xff</span>&nbsp;<span class="comment" id="6267687">//&nbsp;Application&nbsp;Label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267711"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267712">.</span><span class="ident" id="6267713">buf</span><span class="op" id="6267716">[</span><span class="num" id="6267717">2</span><span class="op" id="6267718">]</span>&nbsp;<span class="op" id="6267720">=</span>&nbsp;<span class="num" id="6267722">0x0b</span>&nbsp;<span class="comment" id="6267727">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267744"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267745">.</span><span class="ident" id="6267746">write</span><span class="op" id="6267751">(</span><span class="ident" id="6267752"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267753">.</span><span class="ident" id="6267754">buf</span><span class="op" id="6267757">[</span><span class="op" id="6267758">:</span><span class="num" id="6267759">3</span><span class="op" id="6267760">]</span><span class="op" id="6267761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267765">_</span><span class="op" id="6267766">,</span>&nbsp;<span class="ident" id="6267768"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267769">.</span><span class="ident" id="6267770">err</span>&nbsp;<span class="op" id="6267774">=</span>&nbsp;<span class="ident" id="6267776"><a href="/image/gif/writer.go.html#6265279">io</a></span><span class="op" id="6267778">.</span><span class="ident" id="6267779">WriteString</span><span class="op" id="6267790">(</span><span class="ident" id="6267791"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267792">.</span><span class="ident" id="6267793">w</span><span class="op" id="6267794">,</span>&nbsp;<span class="string" id="6267796">&#34;NETSCAPE2.0&#34;</span><span class="op" id="6267809">)</span>&nbsp;<span class="comment" id="6267811">//&nbsp;Application&nbsp;Identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267840">if</span>&nbsp;<span class="ident" id="6267843"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267844">.</span><span class="ident" id="6267845">err</span>&nbsp;<span class="op" id="6267849">!=</span>&nbsp;<span class="ident" id="6267852">nil</span>&nbsp;<span class="op" id="6267856">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6267861">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6267870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267874"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267875">.</span><span class="ident" id="6267876">buf</span><span class="op" id="6267879">[</span><span class="num" id="6267880">0</span><span class="op" id="6267881">]</span>&nbsp;<span class="op" id="6267883">=</span>&nbsp;<span class="num" id="6267885">0x03</span>&nbsp;<span class="comment" id="6267890">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267907"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267908">.</span><span class="ident" id="6267909">buf</span><span class="op" id="6267912">[</span><span class="num" id="6267913">1</span><span class="op" id="6267914">]</span>&nbsp;<span class="op" id="6267916">=</span>&nbsp;<span class="num" id="6267918">0x01</span>&nbsp;<span class="comment" id="6267923">//&nbsp;Sub-block&nbsp;Index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267945"><a href="/image/gif/writer.go.html#6265556">writeUint16</a></span><span class="op" id="6267956">(</span><span class="ident" id="6267957"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267958">.</span><span class="ident" id="6267959">buf</span><span class="op" id="6267962">[</span><span class="num" id="6267963">2</span><span class="op" id="6267964">:</span><span class="num" id="6267965">4</span><span class="op" id="6267966">]</span><span class="op" id="6267967">,</span>&nbsp;<span class="builtintype" id="6267969">uint16</span><span class="op" id="6267975">(</span><span class="ident" id="6267976"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267977">.</span><span class="ident" id="6267978">g</span><span class="op" id="6267979">.</span><span class="ident" id="6267980">LoopCount</span><span class="op" id="6267989">)</span><span class="op" id="6267990">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6267994"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6267995">.</span><span class="ident" id="6267996">buf</span><span class="op" id="6267999">[</span><span class="num" id="6268000">4</span><span class="op" id="6268001">]</span>&nbsp;<span class="op" id="6268003">=</span>&nbsp;<span class="num" id="6268005">0x00</span>&nbsp;<span class="comment" id="6268010">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268033"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6268034">.</span><span class="ident" id="6268035">write</span><span class="op" id="6268040">(</span><span class="ident" id="6268041"><a href="/image/gif/writer.go.html#6267045">e</a></span><span class="op" id="6268042">.</span><span class="ident" id="6268043">buf</span><span class="op" id="6268046">[</span><span class="op" id="6268047">:</span><span class="num" id="6268048">5</span><span class="op" id="6268049">]</span><span class="op" id="6268050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268053">}</span><br>
<span class="lineno"></span><span class="op" id="6268055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="6268058">func</span>&nbsp;<span class="op" id="6268063">(</span><span class="ident" id="6268064">e</span>&nbsp;<span class="op" id="6268066">*</span><span class="ident" id="6268067"><a href="/image/gif/writer.go.html#6265785">encoder</a></span><span class="op" id="6268074">)</span>&nbsp;<span class="ident" id="6268076">writeColorTable</span><span class="op" id="6268091">(</span><span class="ident" id="6268092">p</span>&nbsp;<span class="ident" id="6268094"><a href="/image/gif/writer.go.html#6265227">color</a></span><span class="op" id="6268099">.</span><span class="ident" id="6268100">Palette</span><span class="op" id="6268107">,</span>&nbsp;<span class="ident" id="6268109">size</span>&nbsp;<span class="builtintype" id="6268114">int</span><span class="op" id="6268117">)</span>&nbsp;<span class="op" id="6268119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268122">if</span>&nbsp;<span class="ident" id="6268125"><a href="/image/gif/writer.go.html#6268064">e</a></span><span class="op" id="6268126">.</span><span class="ident" id="6268127">err</span>&nbsp;<span class="op" id="6268131">!=</span>&nbsp;<span class="ident" id="6268134">nil</span>&nbsp;<span class="op" id="6268138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268142">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268154">for</span>&nbsp;<span class="ident" id="6268158">i</span>&nbsp;<span class="op" id="6268160">:=</span>&nbsp;<span class="num" id="6268163">0</span><span class="op" id="6268164">;</span>&nbsp;<span class="ident" id="6268166"><a href="/image/gif/writer.go.html#6268158">i</a></span>&nbsp;<span class="op" id="6268168">&lt;</span>&nbsp;<span class="ident" id="6268170"><a href="/image/gif/writer.go.html#6265379">log2Lookup</a></span><span class="op" id="6268180">[</span><span class="ident" id="6268181"><a href="/image/gif/writer.go.html#6268109">size</a></span><span class="op" id="6268185">]</span><span class="op" id="6268186">;</span>&nbsp;<span class="ident" id="6268188"><a href="/image/gif/writer.go.html#6268158">i</a></span><span class="op" id="6268189">++</span>&nbsp;<span class="op" id="6268192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268196">if</span>&nbsp;<span class="ident" id="6268199"><a href="/image/gif/writer.go.html#6268158">i</a></span>&nbsp;<span class="op" id="6268201">&lt;</span>&nbsp;<span class="builtinfunc" id="6268203">len</span><span class="op" id="6268206">(</span><span class="ident" id="6268207"><a href="/image/gif/writer.go.html#6268092">p</a></span><span class="op" id="6268208">)</span>&nbsp;<span class="op" id="6268210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268215">r</span><span class="op" id="6268216">,</span>&nbsp;<span class="ident" id="6268218">g</span><span class="op" id="6268219">,</span>&nbsp;<span class="ident" id="6268221">b</span><span class="op" id="6268222">,</span>&nbsp;<span class="ident" id="6268224">_</span>&nbsp;<span class="op" id="6268226">:=</span>&nbsp;<span class="ident" id="6268229"><a href="/image/gif/writer.go.html#6268092">p</a></span><span class="op" id="6268230">[</span><span class="ident" id="6268231"><a href="/image/gif/writer.go.html#6268158">i</a></span><span class="op" id="6268232">]</span><span class="op" id="6268233">.</span><span class="ident" id="6268234">RGBA</span><span class="op" id="6268238">(</span><span class="op" id="6268239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268244"><a href="/image/gif/writer.go.html#6268064">e</a></span><span class="op" id="6268245">.</span><span class="ident" id="6268246">buf</span><span class="op" id="6268249">[</span><span class="num" id="6268250">3</span><span class="op" id="6268251">*</span><span class="ident" id="6268252"><a href="/image/gif/writer.go.html#6268158">i</a></span><span class="op" id="6268253">+</span><span class="num" id="6268254">0</span><span class="op" id="6268255">]</span>&nbsp;<span class="op" id="6268257">=</span>&nbsp;<span class="builtintype" id="6268259">uint8</span><span class="op" id="6268264">(</span><span class="ident" id="6268265"><a href="/image/gif/writer.go.html#6268215">r</a></span>&nbsp;<span class="op" id="6268267">&gt;&gt;</span>&nbsp;<span class="num" id="6268270">8</span><span class="op" id="6268271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268276"><a href="/image/gif/writer.go.html#6268064">e</a></span><span class="op" id="6268277">.</span><span class="ident" id="6268278">buf</span><span class="op" id="6268281">[</span><span class="num" id="6268282">3</span><span class="op" id="6268283">*</span><span class="ident" id="6268284"><a href="/image/gif/writer.go.html#6268158">i</a></span><span class="op" id="6268285">+</span><span class="num" id="6268286">1</span><span class="op" id="6268287">]</span>&nbsp;<span class="op" id="6268289">=</span>&nbsp;<span class="builtintype" id="6268291">uint8</span><span class="op" id="6268296">(</span><span class="ident" id="6268297"><a href="/image/gif/writer.go.html#6268218">g</a></span>&nbsp;<span class="op" id="6268299">&gt;&gt;</span>&nbsp;<span class="num" id="6268302">8</span><span class="op" id="6268303">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268308"><a href="/image/gif/writer.go.html#6268064">e</a></span><span class="op" id="6268309">.</span><span class="ident" id="6268310">buf</span><span class="op" id="6268313">[</span><span class="num" id="6268314">3</span><span class="op" id="6268315">*</span><span class="ident" id="6268316"><a href="/image/gif/writer.go.html#6268158">i</a></span><span class="op" id="6268317">+</span><span class="num" id="6268318">2</span><span class="op" id="6268319">]</span>&nbsp;<span class="op" id="6268321">=</span>&nbsp;<span class="builtintype" id="6268323">uint8</span><span class="op" id="6268328">(</span><span class="ident" id="6268329"><a href="/image/gif/writer.go.html#6268221">b</a></span>&nbsp;<span class="op" id="6268331">&gt;&gt;</span>&nbsp;<span class="num" id="6268334">8</span><span class="op" id="6268335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268339">}</span>&nbsp;<span class="keyword" id="6268341">else</span>&nbsp;<span class="op" id="6268346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6268351">//&nbsp;Pad&nbsp;with&nbsp;black.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268373"><a href="/image/gif/writer.go.html#6268064">e</a></span><span class="op" id="6268374">.</span><span class="ident" id="6268375">buf</span><span class="op" id="6268378">[</span><span class="num" id="6268379">3</span><span class="op" id="6268380">*</span><span class="ident" id="6268381"><a href="/image/gif/writer.go.html#6268158">i</a></span><span class="op" id="6268382">+</span><span class="num" id="6268383">0</span><span class="op" id="6268384">]</span>&nbsp;<span class="op" id="6268386">=</span>&nbsp;<span class="num" id="6268388">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268396"><a href="/image/gif/writer.go.html#6268064">e</a></span><span class="op" id="6268397">.</span><span class="ident" id="6268398">buf</span><span class="op" id="6268401">[</span><span class="num" id="6268402">3</span><span class="op" id="6268403">*</span><span class="ident" id="6268404"><a href="/image/gif/writer.go.html#6268158">i</a></span><span class="op" id="6268405">+</span><span class="num" id="6268406">1</span><span class="op" id="6268407">]</span>&nbsp;<span class="op" id="6268409">=</span>&nbsp;<span class="num" id="6268411">0x00</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268419"><a href="/image/gif/writer.go.html#6268064">e</a></span><span class="op" id="6268420">.</span><span class="ident" id="6268421">buf</span><span class="op" id="6268424">[</span><span class="num" id="6268425">3</span><span class="op" id="6268426">*</span><span class="ident" id="6268427"><a href="/image/gif/writer.go.html#6268158">i</a></span><span class="op" id="6268428">+</span><span class="num" id="6268429">2</span><span class="op" id="6268430">]</span>&nbsp;<span class="op" id="6268432">=</span>&nbsp;<span class="num" id="6268434">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268447"><a href="/image/gif/writer.go.html#6268064">e</a></span><span class="op" id="6268448">.</span><span class="ident" id="6268449">write</span><span class="op" id="6268454">(</span><span class="ident" id="6268455"><a href="/image/gif/writer.go.html#6268064">e</a></span><span class="op" id="6268456">.</span><span class="ident" id="6268457">buf</span><span class="op" id="6268460">[</span><span class="op" id="6268461">:</span><span class="num" id="6268462">3</span><span class="op" id="6268463">*</span><span class="ident" id="6268464"><a href="/image/gif/writer.go.html#6265379">log2Lookup</a></span><span class="op" id="6268474">[</span><span class="ident" id="6268475"><a href="/image/gif/writer.go.html#6268109">size</a></span><span class="op" id="6268479">]</span><span class="op" id="6268480">]</span><span class="op" id="6268481">)</span><br>
<span class="lineno"></span><span class="op" id="6268483">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6268486">func</span>&nbsp;<span class="op" id="6268491">(</span><span class="ident" id="6268492">e</span>&nbsp;<span class="op" id="6268494">*</span><span class="ident" id="6268495"><a href="/image/gif/writer.go.html#6265785">encoder</a></span><span class="op" id="6268502">)</span>&nbsp;<span class="ident" id="6268504">writeImageBlock</span><span class="op" id="6268519">(</span><span class="ident" id="6268520">pm</span>&nbsp;<span class="op" id="6268523">*</span><span class="ident" id="6268524"><a href="/image/gif/writer.go.html#6265218">image</a></span><span class="op" id="6268529">.</span><span class="ident" id="6268530">Paletted</span><span class="op" id="6268538">,</span>&nbsp;<span class="ident" id="6268540">delay</span>&nbsp;<span class="builtintype" id="6268546">int</span><span class="op" id="6268549">)</span>&nbsp;<span class="op" id="6268551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268554">if</span>&nbsp;<span class="ident" id="6268557"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6268558">.</span><span class="ident" id="6268559">err</span>&nbsp;<span class="op" id="6268563">!=</span>&nbsp;<span class="ident" id="6268566">nil</span>&nbsp;<span class="op" id="6268570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268574">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268582">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268586">if</span>&nbsp;<span class="builtinfunc" id="6268589">len</span><span class="op" id="6268592">(</span><span class="ident" id="6268593"><a href="/image/gif/writer.go.html#6268520">pm</a></span><span class="op" id="6268595">.</span><span class="ident" id="6268596">Palette</span><span class="op" id="6268603">)</span>&nbsp;<span class="op" id="6268605">==</span>&nbsp;<span class="num" id="6268608">0</span>&nbsp;<span class="op" id="6268610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268614"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6268615">.</span><span class="ident" id="6268616">err</span>&nbsp;<span class="op" id="6268620">=</span>&nbsp;<span class="ident" id="6268622"><a href="/image/gif/writer.go.html#6265208">errors</a></span><span class="op" id="6268628">.</span><span class="ident" id="6268629">New</span><span class="op" id="6268632">(</span><span class="string" id="6268633">&#34;gif:&nbsp;cannot&nbsp;encode&nbsp;image&nbsp;block&nbsp;with&nbsp;empty&nbsp;palette&#34;</span><span class="op" id="6268684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268688">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268696">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268700">b</span>&nbsp;<span class="op" id="6268702">:=</span>&nbsp;<span class="ident" id="6268705"><a href="/image/gif/writer.go.html#6268520">pm</a></span><span class="op" id="6268707">.</span><span class="ident" id="6268708">Bounds</span><span class="op" id="6268714">(</span><span class="op" id="6268715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268718">if</span>&nbsp;<span class="ident" id="6268721"><a href="/image/gif/writer.go.html#6268700">b</a></span><span class="op" id="6268722">.</span><span class="ident" id="6268723">Dx</span><span class="op" id="6268725">(</span><span class="op" id="6268726">)</span>&nbsp;<span class="op" id="6268728">&gt;=</span>&nbsp;<span class="num" id="6268731">1</span><span class="op" id="6268732">&lt;&lt;</span><span class="num" id="6268734">16</span>&nbsp;<span class="op" id="6268737">||</span>&nbsp;<span class="ident" id="6268740"><a href="/image/gif/writer.go.html#6268700">b</a></span><span class="op" id="6268741">.</span><span class="ident" id="6268742">Dy</span><span class="op" id="6268744">(</span><span class="op" id="6268745">)</span>&nbsp;<span class="op" id="6268747">&gt;=</span>&nbsp;<span class="num" id="6268750">1</span><span class="op" id="6268751">&lt;&lt;</span><span class="num" id="6268753">16</span>&nbsp;<span class="op" id="6268756">||</span>&nbsp;<span class="ident" id="6268759"><a href="/image/gif/writer.go.html#6268700">b</a></span><span class="op" id="6268760">.</span><span class="ident" id="6268761">Min</span><span class="op" id="6268764">.</span><span class="ident" id="6268765">X</span>&nbsp;<span class="op" id="6268767">&lt;</span>&nbsp;<span class="num" id="6268769">0</span>&nbsp;<span class="op" id="6268771">||</span>&nbsp;<span class="ident" id="6268774"><a href="/image/gif/writer.go.html#6268700">b</a></span><span class="op" id="6268775">.</span><span class="ident" id="6268776">Min</span><span class="op" id="6268779">.</span><span class="ident" id="6268780">X</span>&nbsp;<span class="op" id="6268782">&gt;=</span>&nbsp;<span class="num" id="6268785">1</span><span class="op" id="6268786">&lt;&lt;</span><span class="num" id="6268788">16</span>&nbsp;<span class="op" id="6268791">||</span>&nbsp;<span class="ident" id="6268794"><a href="/image/gif/writer.go.html#6268700">b</a></span><span class="op" id="6268795">.</span><span class="ident" id="6268796">Min</span><span class="op" id="6268799">.</span><span class="ident" id="6268800">Y</span>&nbsp;<span class="op" id="6268802">&lt;</span>&nbsp;<span class="num" id="6268804">0</span>&nbsp;<span class="op" id="6268806">||</span>&nbsp;<span class="ident" id="6268809"><a href="/image/gif/writer.go.html#6268700">b</a></span><span class="op" id="6268810">.</span><span class="ident" id="6268811">Min</span><span class="op" id="6268814">.</span><span class="ident" id="6268815">Y</span>&nbsp;<span class="op" id="6268817">&gt;=</span>&nbsp;<span class="num" id="6268820">1</span><span class="op" id="6268821">&lt;&lt;</span><span class="num" id="6268823">16</span>&nbsp;<span class="op" id="6268826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268830"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6268831">.</span><span class="ident" id="6268832">err</span>&nbsp;<span class="op" id="6268836">=</span>&nbsp;<span class="ident" id="6268838"><a href="/image/gif/writer.go.html#6265208">errors</a></span><span class="op" id="6268844">.</span><span class="ident" id="6268845">New</span><span class="op" id="6268848">(</span><span class="string" id="6268849">&#34;gif:&nbsp;image&nbsp;block&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="6268890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268894">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6268902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6268906">transparentIndex</span>&nbsp;<span class="op" id="6268923">:=</span>&nbsp;<span class="op" id="6268926">-</span><span class="num" id="6268927">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268930">for</span>&nbsp;<span class="ident" id="6268934">i</span><span class="op" id="6268935">,</span>&nbsp;<span class="ident" id="6268937">c</span>&nbsp;<span class="op" id="6268939">:=</span>&nbsp;<span class="keyword" id="6268942">range</span>&nbsp;<span class="ident" id="6268948"><a href="/image/gif/writer.go.html#6268520">pm</a></span><span class="op" id="6268950">.</span><span class="ident" id="6268951">Palette</span>&nbsp;<span class="op" id="6268959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6268963">if</span>&nbsp;<span class="ident" id="6268966">_</span><span class="op" id="6268967">,</span>&nbsp;<span class="ident" id="6268969">_</span><span class="op" id="6268970">,</span>&nbsp;<span class="ident" id="6268972">_</span><span class="op" id="6268973">,</span>&nbsp;<span class="ident" id="6268975">a</span>&nbsp;<span class="op" id="6268977">:=</span>&nbsp;<span class="ident" id="6268980"><a href="/image/gif/writer.go.html#6268937">c</a></span><span class="op" id="6268981">.</span><span class="ident" id="6268982">RGBA</span><span class="op" id="6268986">(</span><span class="op" id="6268987">)</span><span class="op" id="6268988">;</span>&nbsp;<span class="ident" id="6268990"><a href="/image/gif/writer.go.html#6268975">a</a></span>&nbsp;<span class="op" id="6268992">==</span>&nbsp;<span class="num" id="6268995">0</span>&nbsp;<span class="op" id="6268997">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269002"><a href="/image/gif/writer.go.html#6268906">transparentIndex</a></span>&nbsp;<span class="op" id="6269019">=</span>&nbsp;<span class="ident" id="6269021"><a href="/image/gif/writer.go.html#6268934">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269026">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6269034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6269037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269041">if</span>&nbsp;<span class="ident" id="6269044"><a href="/image/gif/writer.go.html#6268540">delay</a></span>&nbsp;<span class="op" id="6269050">&gt;</span>&nbsp;<span class="num" id="6269052">0</span>&nbsp;<span class="op" id="6269054">||</span>&nbsp;<span class="ident" id="6269057"><a href="/image/gif/writer.go.html#6268906">transparentIndex</a></span>&nbsp;<span class="op" id="6269074">!=</span>&nbsp;<span class="op" id="6269077">-</span><span class="num" id="6269078">1</span>&nbsp;<span class="op" id="6269080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269084"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269085">.</span><span class="ident" id="6269086">buf</span><span class="op" id="6269089">[</span><span class="num" id="6269090">0</span><span class="op" id="6269091">]</span>&nbsp;<span class="op" id="6269093">=</span>&nbsp;<span class="ident" id="6269095"><a href="/image/gif/reader.go.html#6254367">sExtension</a></span>&nbsp;&nbsp;<span class="comment" id="6269107">//&nbsp;Extension&nbsp;Introducer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269134"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269135">.</span><span class="ident" id="6269136">buf</span><span class="op" id="6269139">[</span><span class="num" id="6269140">1</span><span class="op" id="6269141">]</span>&nbsp;<span class="op" id="6269143">=</span>&nbsp;<span class="ident" id="6269145"><a href="/image/gif/writer.go.html#6265333">gcLabel</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6269157">//&nbsp;Graphic&nbsp;Control&nbsp;Label.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269185"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269186">.</span><span class="ident" id="6269187">buf</span><span class="op" id="6269190">[</span><span class="num" id="6269191">2</span><span class="op" id="6269192">]</span>&nbsp;<span class="op" id="6269194">=</span>&nbsp;<span class="ident" id="6269196"><a href="/image/gif/writer.go.html#6265353">gcBlockSize</a></span>&nbsp;<span class="comment" id="6269208">//&nbsp;Block&nbsp;Size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269225">if</span>&nbsp;<span class="ident" id="6269228"><a href="/image/gif/writer.go.html#6268906">transparentIndex</a></span>&nbsp;<span class="op" id="6269245">!=</span>&nbsp;<span class="op" id="6269248">-</span><span class="num" id="6269249">1</span>&nbsp;<span class="op" id="6269251">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269256"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269257">.</span><span class="ident" id="6269258">buf</span><span class="op" id="6269261">[</span><span class="num" id="6269262">3</span><span class="op" id="6269263">]</span>&nbsp;<span class="op" id="6269265">=</span>&nbsp;<span class="num" id="6269267">0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6269274">}</span>&nbsp;<span class="keyword" id="6269276">else</span>&nbsp;<span class="op" id="6269281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269286"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269287">.</span><span class="ident" id="6269288">buf</span><span class="op" id="6269291">[</span><span class="num" id="6269292">3</span><span class="op" id="6269293">]</span>&nbsp;<span class="op" id="6269295">=</span>&nbsp;<span class="num" id="6269297">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6269304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269308"><a href="/image/gif/writer.go.html#6265556">writeUint16</a></span><span class="op" id="6269319">(</span><span class="ident" id="6269320"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269321">.</span><span class="ident" id="6269322">buf</span><span class="op" id="6269325">[</span><span class="num" id="6269326">4</span><span class="op" id="6269327">:</span><span class="num" id="6269328">6</span><span class="op" id="6269329">]</span><span class="op" id="6269330">,</span>&nbsp;<span class="builtintype" id="6269332">uint16</span><span class="op" id="6269338">(</span><span class="ident" id="6269339"><a href="/image/gif/writer.go.html#6268540">delay</a></span><span class="op" id="6269344">)</span><span class="op" id="6269345">)</span>&nbsp;<span class="comment" id="6269347">//&nbsp;Delay&nbsp;Time&nbsp;(1/100ths&nbsp;of&nbsp;a&nbsp;second)</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6269387">//&nbsp;Transparent&nbsp;color&nbsp;index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6269417">if</span>&nbsp;<span class="ident" id="6269420"><a href="/image/gif/writer.go.html#6268906">transparentIndex</a></span>&nbsp;<span class="op" id="6269437">!=</span>&nbsp;<span class="op" id="6269440">-</span><span class="num" id="6269441">1</span>&nbsp;<span class="op" id="6269443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269448"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269449">.</span><span class="ident" id="6269450">buf</span><span class="op" id="6269453">[</span><span class="num" id="6269454">6</span><span class="op" id="6269455">]</span>&nbsp;<span class="op" id="6269457">=</span>&nbsp;<span class="builtintype" id="6269459">uint8</span><span class="op" id="6269464">(</span><span class="ident" id="6269465"><a href="/image/gif/writer.go.html#6268906">transparentIndex</a></span><span class="op" id="6269481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6269485">}</span>&nbsp;<span class="keyword" id="6269487">else</span>&nbsp;<span class="op" id="6269492">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269497"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269498">.</span><span class="ident" id="6269499">buf</span><span class="op" id="6269502">[</span><span class="num" id="6269503">6</span><span class="op" id="6269504">]</span>&nbsp;<span class="op" id="6269506">=</span>&nbsp;<span class="num" id="6269508">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6269515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269519"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269520">.</span><span class="ident" id="6269521">buf</span><span class="op" id="6269524">[</span><span class="num" id="6269525">7</span><span class="op" id="6269526">]</span>&nbsp;<span class="op" id="6269528">=</span>&nbsp;<span class="num" id="6269530">0x00</span>&nbsp;<span class="comment" id="6269535">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269558"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269559">.</span><span class="ident" id="6269560">write</span><span class="op" id="6269565">(</span><span class="ident" id="6269566"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269567">.</span><span class="ident" id="6269568">buf</span><span class="op" id="6269571">[</span><span class="op" id="6269572">:</span><span class="num" id="6269573">8</span><span class="op" id="6269574">]</span><span class="op" id="6269575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6269578">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269581"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269582">.</span><span class="ident" id="6269583">buf</span><span class="op" id="6269586">[</span><span class="num" id="6269587">0</span><span class="op" id="6269588">]</span>&nbsp;<span class="op" id="6269590">=</span>&nbsp;<span class="ident" id="6269592"><a href="/image/gif/reader.go.html#6254392">sImageDescriptor</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269610"><a href="/image/gif/writer.go.html#6265556">writeUint16</a></span><span class="op" id="6269621">(</span><span class="ident" id="6269622"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269623">.</span><span class="ident" id="6269624">buf</span><span class="op" id="6269627">[</span><span class="num" id="6269628">1</span><span class="op" id="6269629">:</span><span class="num" id="6269630">3</span><span class="op" id="6269631">]</span><span class="op" id="6269632">,</span>&nbsp;<span class="builtintype" id="6269634">uint16</span><span class="op" id="6269640">(</span><span class="ident" id="6269641"><a href="/image/gif/writer.go.html#6268700">b</a></span><span class="op" id="6269642">.</span><span class="ident" id="6269643">Min</span><span class="op" id="6269646">.</span><span class="ident" id="6269647">X</span><span class="op" id="6269648">)</span><span class="op" id="6269649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269652"><a href="/image/gif/writer.go.html#6265556">writeUint16</a></span><span class="op" id="6269663">(</span><span class="ident" id="6269664"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269665">.</span><span class="ident" id="6269666">buf</span><span class="op" id="6269669">[</span><span class="num" id="6269670">3</span><span class="op" id="6269671">:</span><span class="num" id="6269672">5</span><span class="op" id="6269673">]</span><span class="op" id="6269674">,</span>&nbsp;<span class="builtintype" id="6269676">uint16</span><span class="op" id="6269682">(</span><span class="ident" id="6269683"><a href="/image/gif/writer.go.html#6268700">b</a></span><span class="op" id="6269684">.</span><span class="ident" id="6269685">Min</span><span class="op" id="6269688">.</span><span class="ident" id="6269689">Y</span><span class="op" id="6269690">)</span><span class="op" id="6269691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269694"><a href="/image/gif/writer.go.html#6265556">writeUint16</a></span><span class="op" id="6269705">(</span><span class="ident" id="6269706"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269707">.</span><span class="ident" id="6269708">buf</span><span class="op" id="6269711">[</span><span class="num" id="6269712">5</span><span class="op" id="6269713">:</span><span class="num" id="6269714">7</span><span class="op" id="6269715">]</span><span class="op" id="6269716">,</span>&nbsp;<span class="builtintype" id="6269718">uint16</span><span class="op" id="6269724">(</span><span class="ident" id="6269725"><a href="/image/gif/writer.go.html#6268700">b</a></span><span class="op" id="6269726">.</span><span class="ident" id="6269727">Dx</span><span class="op" id="6269729">(</span><span class="op" id="6269730">)</span><span class="op" id="6269731">)</span><span class="op" id="6269732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269735"><a href="/image/gif/writer.go.html#6265556">writeUint16</a></span><span class="op" id="6269746">(</span><span class="ident" id="6269747"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269748">.</span><span class="ident" id="6269749">buf</span><span class="op" id="6269752">[</span><span class="num" id="6269753">7</span><span class="op" id="6269754">:</span><span class="num" id="6269755">9</span><span class="op" id="6269756">]</span><span class="op" id="6269757">,</span>&nbsp;<span class="builtintype" id="6269759">uint16</span><span class="op" id="6269765">(</span><span class="ident" id="6269766"><a href="/image/gif/writer.go.html#6268700">b</a></span><span class="op" id="6269767">.</span><span class="ident" id="6269768">Dy</span><span class="op" id="6269770">(</span><span class="op" id="6269771">)</span><span class="op" id="6269772">)</span><span class="op" id="6269773">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269776"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269777">.</span><span class="ident" id="6269778">write</span><span class="op" id="6269783">(</span><span class="ident" id="6269784"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269785">.</span><span class="ident" id="6269786">buf</span><span class="op" id="6269789">[</span><span class="op" id="6269790">:</span><span class="num" id="6269791">9</span><span class="op" id="6269792">]</span><span class="op" id="6269793">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269797">paddedSize</span>&nbsp;<span class="op" id="6269808">:=</span>&nbsp;<span class="ident" id="6269811"><a href="/image/gif/writer.go.html#6265436">log2</a></span><span class="op" id="6269815">(</span><span class="builtinfunc" id="6269816">len</span><span class="op" id="6269819">(</span><span class="ident" id="6269820"><a href="/image/gif/writer.go.html#6268520">pm</a></span><span class="op" id="6269822">.</span><span class="ident" id="6269823">Palette</span><span class="op" id="6269830">)</span><span class="op" id="6269831">)</span>&nbsp;<span class="comment" id="6269833">//&nbsp;Size&nbsp;of&nbsp;Local&nbsp;Color&nbsp;Table:&nbsp;2^(1+n).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6269873">//&nbsp;Interlacing&nbsp;is&nbsp;not&nbsp;supported.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269907"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269908">.</span><span class="ident" id="6269909">writeByte</span><span class="op" id="6269918">(</span><span class="num" id="6269919">0x80</span>&nbsp;<span class="op" id="6269924">|</span>&nbsp;<span class="builtintype" id="6269926">uint8</span><span class="op" id="6269931">(</span><span class="ident" id="6269932"><a href="/image/gif/writer.go.html#6269797">paddedSize</a></span><span class="op" id="6269942">)</span><span class="op" id="6269943">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6269947">//&nbsp;Local&nbsp;Color&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6269970"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6269971">.</span><span class="ident" id="6269972">writeColorTable</span><span class="op" id="6269987">(</span><span class="ident" id="6269988"><a href="/image/gif/writer.go.html#6268520">pm</a></span><span class="op" id="6269990">.</span><span class="ident" id="6269991">Palette</span><span class="op" id="6269998">,</span>&nbsp;<span class="ident" id="6270000"><a href="/image/gif/writer.go.html#6269797">paddedSize</a></span><span class="op" id="6270010">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270014">litWidth</span>&nbsp;<span class="op" id="6270023">:=</span>&nbsp;<span class="ident" id="6270026"><a href="/image/gif/writer.go.html#6269797">paddedSize</a></span>&nbsp;<span class="op" id="6270037">+</span>&nbsp;<span class="num" id="6270039">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270042">if</span>&nbsp;<span class="ident" id="6270045"><a href="/image/gif/writer.go.html#6270014">litWidth</a></span>&nbsp;<span class="op" id="6270054">&lt;</span>&nbsp;<span class="num" id="6270056">2</span>&nbsp;<span class="op" id="6270058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270062"><a href="/image/gif/writer.go.html#6270014">litWidth</a></span>&nbsp;<span class="op" id="6270071">=</span>&nbsp;<span class="num" id="6270073">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6270076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270079"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6270080">.</span><span class="ident" id="6270081">writeByte</span><span class="op" id="6270090">(</span><span class="builtintype" id="6270091">uint8</span><span class="op" id="6270096">(</span><span class="ident" id="6270097"><a href="/image/gif/writer.go.html#6270014">litWidth</a></span><span class="op" id="6270105">)</span><span class="op" id="6270106">)</span>&nbsp;<span class="comment" id="6270108">//&nbsp;LZW&nbsp;Minimum&nbsp;Code&nbsp;Size.</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270136">lzww</span>&nbsp;<span class="op" id="6270141">:=</span>&nbsp;<span class="ident" id="6270144"><a href="/image/gif/writer.go.html#6265192">lzw</a></span><span class="op" id="6270147">.</span><span class="ident" id="6270148">NewWriter</span><span class="op" id="6270157">(</span><span class="ident" id="6270158"><a href="/image/gif/writer.go.html#6266353">blockWriter</a></span><span class="op" id="6270169">{</span><span class="ident" id="6270170">e</span><span class="op" id="6270171">:</span>&nbsp;<span class="ident" id="6270173"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6270174">}</span><span class="op" id="6270175">,</span>&nbsp;<span class="ident" id="6270177"><a href="/image/gif/writer.go.html#6265192">lzw</a></span><span class="op" id="6270180">.</span><span class="ident" id="6270181">LSB</span><span class="op" id="6270184">,</span>&nbsp;<span class="ident" id="6270186"><a href="/image/gif/writer.go.html#6270014">litWidth</a></span><span class="op" id="6270194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270197">if</span>&nbsp;<span class="ident" id="6270200">dx</span>&nbsp;<span class="op" id="6270203">:=</span>&nbsp;<span class="ident" id="6270206"><a href="/image/gif/writer.go.html#6268700">b</a></span><span class="op" id="6270207">.</span><span class="ident" id="6270208">Dx</span><span class="op" id="6270210">(</span><span class="op" id="6270211">)</span><span class="op" id="6270212">;</span>&nbsp;<span class="ident" id="6270214"><a href="/image/gif/writer.go.html#6270200">dx</a></span>&nbsp;<span class="op" id="6270217">==</span>&nbsp;<span class="ident" id="6270220"><a href="/image/gif/writer.go.html#6268520">pm</a></span><span class="op" id="6270222">.</span><span class="ident" id="6270223">Stride</span>&nbsp;<span class="op" id="6270230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270234">_</span><span class="op" id="6270235">,</span>&nbsp;<span class="ident" id="6270237"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6270238">.</span><span class="ident" id="6270239">err</span>&nbsp;<span class="op" id="6270243">=</span>&nbsp;<span class="ident" id="6270245"><a href="/image/gif/writer.go.html#6270136">lzww</a></span><span class="op" id="6270249">.</span><span class="ident" id="6270250">Write</span><span class="op" id="6270255">(</span><span class="ident" id="6270256"><a href="/image/gif/writer.go.html#6268520">pm</a></span><span class="op" id="6270258">.</span><span class="ident" id="6270259">Pix</span><span class="op" id="6270262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270266">if</span>&nbsp;<span class="ident" id="6270269"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6270270">.</span><span class="ident" id="6270271">err</span>&nbsp;<span class="op" id="6270275">!=</span>&nbsp;<span class="ident" id="6270278">nil</span>&nbsp;<span class="op" id="6270282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270287"><a href="/image/gif/writer.go.html#6270136">lzww</a></span><span class="op" id="6270291">.</span><span class="ident" id="6270292">Close</span><span class="op" id="6270297">(</span><span class="op" id="6270298">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270303">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6270312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6270315">}</span>&nbsp;<span class="keyword" id="6270317">else</span>&nbsp;<span class="op" id="6270322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270326">for</span>&nbsp;<span class="ident" id="6270330">i</span><span class="op" id="6270331">,</span>&nbsp;<span class="ident" id="6270333">y</span>&nbsp;<span class="op" id="6270335">:=</span>&nbsp;<span class="num" id="6270338">0</span><span class="op" id="6270339">,</span>&nbsp;<span class="ident" id="6270341"><a href="/image/gif/writer.go.html#6268700">b</a></span><span class="op" id="6270342">.</span><span class="ident" id="6270343">Min</span><span class="op" id="6270346">.</span><span class="ident" id="6270347">Y</span><span class="op" id="6270348">;</span>&nbsp;<span class="ident" id="6270350"><a href="/image/gif/writer.go.html#6270333">y</a></span>&nbsp;<span class="op" id="6270352">&lt;</span>&nbsp;<span class="ident" id="6270354"><a href="/image/gif/writer.go.html#6268700">b</a></span><span class="op" id="6270355">.</span><span class="ident" id="6270356">Max</span><span class="op" id="6270359">.</span><span class="ident" id="6270360">Y</span><span class="op" id="6270361">;</span>&nbsp;<span class="ident" id="6270363"><a href="/image/gif/writer.go.html#6270330">i</a></span><span class="op" id="6270364">,</span>&nbsp;<span class="ident" id="6270366"><a href="/image/gif/writer.go.html#6270333">y</a></span>&nbsp;<span class="op" id="6270368">=</span>&nbsp;<span class="ident" id="6270370"><a href="/image/gif/writer.go.html#6270330">i</a></span><span class="op" id="6270371">+</span><span class="ident" id="6270372"><a href="/image/gif/writer.go.html#6268520">pm</a></span><span class="op" id="6270374">.</span><span class="ident" id="6270375">Stride</span><span class="op" id="6270381">,</span>&nbsp;<span class="ident" id="6270383"><a href="/image/gif/writer.go.html#6270333">y</a></span><span class="op" id="6270384">+</span><span class="num" id="6270385">1</span>&nbsp;<span class="op" id="6270387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270392">_</span><span class="op" id="6270393">,</span>&nbsp;<span class="ident" id="6270395"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6270396">.</span><span class="ident" id="6270397">err</span>&nbsp;<span class="op" id="6270401">=</span>&nbsp;<span class="ident" id="6270403"><a href="/image/gif/writer.go.html#6270136">lzww</a></span><span class="op" id="6270407">.</span><span class="ident" id="6270408">Write</span><span class="op" id="6270413">(</span><span class="ident" id="6270414"><a href="/image/gif/writer.go.html#6268520">pm</a></span><span class="op" id="6270416">.</span><span class="ident" id="6270417">Pix</span><span class="op" id="6270420">[</span><span class="ident" id="6270421"><a href="/image/gif/writer.go.html#6270330">i</a></span>&nbsp;<span class="op" id="6270423">:</span>&nbsp;<span class="ident" id="6270425"><a href="/image/gif/writer.go.html#6270330">i</a></span><span class="op" id="6270426">+</span><span class="ident" id="6270427"><a href="/image/gif/writer.go.html#6270200">dx</a></span><span class="op" id="6270429">]</span><span class="op" id="6270430">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270435">if</span>&nbsp;<span class="ident" id="6270438"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6270439">.</span><span class="ident" id="6270440">err</span>&nbsp;<span class="op" id="6270444">!=</span>&nbsp;<span class="ident" id="6270447">nil</span>&nbsp;<span class="op" id="6270451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270457"><a href="/image/gif/writer.go.html#6270136">lzww</a></span><span class="op" id="6270461">.</span><span class="ident" id="6270462">Close</span><span class="op" id="6270467">(</span><span class="op" id="6270468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6270474">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6270484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6270488">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6270491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270494"><a href="/image/gif/writer.go.html#6270136">lzww</a></span><span class="op" id="6270498">.</span><span class="ident" id="6270499">Close</span><span class="op" id="6270504">(</span><span class="op" id="6270505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270508"><a href="/image/gif/writer.go.html#6268492">e</a></span><span class="op" id="6270509">.</span><span class="ident" id="6270510">writeByte</span><span class="op" id="6270519">(</span><span class="num" id="6270520">0x00</span><span class="op" id="6270524">)</span>&nbsp;<span class="comment" id="6270526">//&nbsp;Block&nbsp;Terminator.</span><br>
<span class="lineno"></span><span class="op" id="6270547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="6270550">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="6270590">type</span>&nbsp;<span class="ident" id="6270595">Options</span>&nbsp;<span class="keyword" id="6270603">struct</span>&nbsp;<span class="op" id="6270610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6270613">//&nbsp;NumColors&nbsp;is&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;colors&nbsp;used&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6270678">//&nbsp;It&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;256.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270707">NumColors</span>&nbsp;<span class="builtintype" id="6270717">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6270723">//&nbsp;Quantizer&nbsp;is&nbsp;used&nbsp;to&nbsp;produce&nbsp;a&nbsp;palette&nbsp;with&nbsp;size&nbsp;NumColors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6270787">//&nbsp;palette.Plan9&nbsp;is&nbsp;used&nbsp;in&nbsp;place&nbsp;of&nbsp;a&nbsp;nil&nbsp;Quantizer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270842">Quantizer</span>&nbsp;<span class="ident" id="6270852"><a href="/image/gif/writer.go.html#6265265">draw</a></span><span class="op" id="6270856">.</span><span class="ident" id="6270857">Quantizer</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6270869">//&nbsp;Drawer&nbsp;is&nbsp;used&nbsp;to&nbsp;convert&nbsp;the&nbsp;source&nbsp;image&nbsp;to&nbsp;the&nbsp;desired&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6270940">//&nbsp;draw.FloydSteinberg&nbsp;is&nbsp;used&nbsp;in&nbsp;place&nbsp;of&nbsp;a&nbsp;nil&nbsp;Drawer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6270998">Drawer</span>&nbsp;<span class="ident" id="6271005"><a href="/image/gif/writer.go.html#6265265">draw</a></span><span class="op" id="6271009">.</span><span class="ident" id="6271010">Drawer</span><br>
<span class="lineno"></span><span class="op" id="6271017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="6271020">//&nbsp;EncodeAll&nbsp;writes&nbsp;the&nbsp;images&nbsp;in&nbsp;g&nbsp;to&nbsp;w&nbsp;in&nbsp;GIF&nbsp;format&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6271084">//&nbsp;given&nbsp;loop&nbsp;count&nbsp;and&nbsp;delay&nbsp;between&nbsp;frames.</span><br>
<span class="lineno"></span><span class="keyword" id="6271130">func</span>&nbsp;<span class="ident" id="6271135">EncodeAll</span><span class="op" id="6271144">(</span><span class="ident" id="6271145">w</span>&nbsp;<span class="ident" id="6271147"><a href="/image/gif/writer.go.html#6265279">io</a></span><span class="op" id="6271149">.</span><span class="ident" id="6271150">Writer</span><span class="op" id="6271156">,</span>&nbsp;<span class="ident" id="6271158">g</span>&nbsp;<span class="op" id="6271160">*</span><span class="ident" id="6271161"><a href="/image/gif/reader.go.html#6264003">GIF</a></span><span class="op" id="6271164">)</span>&nbsp;<span class="builtintype" id="6271166">error</span>&nbsp;<span class="op" id="6271172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271175">if</span>&nbsp;<span class="builtinfunc" id="6271178">len</span><span class="op" id="6271181">(</span><span class="ident" id="6271182"><a href="/image/gif/writer.go.html#6271158">g</a></span><span class="op" id="6271183">.</span><span class="ident" id="6271184">Image</span><span class="op" id="6271189">)</span>&nbsp;<span class="op" id="6271191">==</span>&nbsp;<span class="num" id="6271194">0</span>&nbsp;<span class="op" id="6271196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271200">return</span>&nbsp;<span class="ident" id="6271207"><a href="/image/gif/writer.go.html#6265208">errors</a></span><span class="op" id="6271213">.</span><span class="ident" id="6271214">New</span><span class="op" id="6271217">(</span><span class="string" id="6271218">&#34;gif:&nbsp;must&nbsp;provide&nbsp;at&nbsp;least&nbsp;one&nbsp;image&#34;</span><span class="op" id="6271256">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6271259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271263">if</span>&nbsp;<span class="builtinfunc" id="6271266">len</span><span class="op" id="6271269">(</span><span class="ident" id="6271270"><a href="/image/gif/writer.go.html#6271158">g</a></span><span class="op" id="6271271">.</span><span class="ident" id="6271272">Image</span><span class="op" id="6271277">)</span>&nbsp;<span class="op" id="6271279">!=</span>&nbsp;<span class="builtinfunc" id="6271282">len</span><span class="op" id="6271285">(</span><span class="ident" id="6271286"><a href="/image/gif/writer.go.html#6271158">g</a></span><span class="op" id="6271287">.</span><span class="ident" id="6271288">Delay</span><span class="op" id="6271293">)</span>&nbsp;<span class="op" id="6271295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271299">return</span>&nbsp;<span class="ident" id="6271306"><a href="/image/gif/writer.go.html#6265208">errors</a></span><span class="op" id="6271312">.</span><span class="ident" id="6271313">New</span><span class="op" id="6271316">(</span><span class="string" id="6271317">&#34;gif:&nbsp;mismatched&nbsp;image&nbsp;and&nbsp;delay&nbsp;lengths&#34;</span><span class="op" id="6271358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6271361">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271364">if</span>&nbsp;<span class="ident" id="6271367"><a href="/image/gif/writer.go.html#6271158">g</a></span><span class="op" id="6271368">.</span><span class="ident" id="6271369">LoopCount</span>&nbsp;<span class="op" id="6271379">&lt;</span>&nbsp;<span class="num" id="6271381">0</span>&nbsp;<span class="op" id="6271383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6271387"><a href="/image/gif/writer.go.html#6271158">g</a></span><span class="op" id="6271388">.</span><span class="ident" id="6271389">LoopCount</span>&nbsp;<span class="op" id="6271399">=</span>&nbsp;<span class="num" id="6271401">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6271404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6271408">e</span>&nbsp;<span class="op" id="6271410">:=</span>&nbsp;<span class="ident" id="6271413"><a href="/image/gif/writer.go.html#6265785">encoder</a></span><span class="op" id="6271420">{</span><span class="ident" id="6271421">g</span><span class="op" id="6271422">:</span>&nbsp;<span class="ident" id="6271424"><a href="/image/gif/writer.go.html#6271158">g</a></span><span class="op" id="6271425">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271428">if</span>&nbsp;<span class="ident" id="6271431">ww</span><span class="op" id="6271433">,</span>&nbsp;<span class="ident" id="6271435">ok</span>&nbsp;<span class="op" id="6271438">:=</span>&nbsp;<span class="ident" id="6271441"><a href="/image/gif/writer.go.html#6271145">w</a></span><span class="op" id="6271442">.</span><span class="op" id="6271443">(</span><span class="ident" id="6271444"><a href="/image/gif/writer.go.html#6265670">writer</a></span><span class="op" id="6271450">)</span><span class="op" id="6271451">;</span>&nbsp;<span class="ident" id="6271453"><a href="/image/gif/writer.go.html#6271435">ok</a></span>&nbsp;<span class="op" id="6271456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6271460"><a href="/image/gif/writer.go.html#6271408">e</a></span><span class="op" id="6271461">.</span><span class="ident" id="6271462">w</span>&nbsp;<span class="op" id="6271464">=</span>&nbsp;<span class="ident" id="6271466"><a href="/image/gif/writer.go.html#6271431">ww</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6271470">}</span>&nbsp;<span class="keyword" id="6271472">else</span>&nbsp;<span class="op" id="6271477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6271481"><a href="/image/gif/writer.go.html#6271408">e</a></span><span class="op" id="6271482">.</span><span class="ident" id="6271483">w</span>&nbsp;<span class="op" id="6271485">=</span>&nbsp;<span class="ident" id="6271487"><a href="/image/gif/writer.go.html#6265183">bufio</a></span><span class="op" id="6271492">.</span><span class="ident" id="6271493">NewWriter</span><span class="op" id="6271502">(</span><span class="ident" id="6271503"><a href="/image/gif/writer.go.html#6271145">w</a></span><span class="op" id="6271504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6271507">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6271511"><a href="/image/gif/writer.go.html#6271408">e</a></span><span class="op" id="6271512">.</span><span class="ident" id="6271513">writeHeader</span><span class="op" id="6271524">(</span><span class="op" id="6271525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271528">for</span>&nbsp;<span class="ident" id="6271532">i</span><span class="op" id="6271533">,</span>&nbsp;<span class="ident" id="6271535">pm</span>&nbsp;<span class="op" id="6271538">:=</span>&nbsp;<span class="keyword" id="6271541">range</span>&nbsp;<span class="ident" id="6271547"><a href="/image/gif/writer.go.html#6271158">g</a></span><span class="op" id="6271548">.</span><span class="ident" id="6271549">Image</span>&nbsp;<span class="op" id="6271555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6271559"><a href="/image/gif/writer.go.html#6271408">e</a></span><span class="op" id="6271560">.</span><span class="ident" id="6271561">writeImageBlock</span><span class="op" id="6271576">(</span><span class="ident" id="6271577"><a href="/image/gif/writer.go.html#6271535">pm</a></span><span class="op" id="6271579">,</span>&nbsp;<span class="ident" id="6271581"><a href="/image/gif/writer.go.html#6271158">g</a></span><span class="op" id="6271582">.</span><span class="ident" id="6271583">Delay</span><span class="op" id="6271588">[</span><span class="ident" id="6271589"><a href="/image/gif/writer.go.html#6271532">i</a></span><span class="op" id="6271590">]</span><span class="op" id="6271591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6271594">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6271597"><a href="/image/gif/writer.go.html#6271408">e</a></span><span class="op" id="6271598">.</span><span class="ident" id="6271599">writeByte</span><span class="op" id="6271608">(</span><span class="ident" id="6271609"><a href="/image/gif/reader.go.html#6254417">sTrailer</a></span><span class="op" id="6271617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6271620"><a href="/image/gif/writer.go.html#6271408">e</a></span><span class="op" id="6271621">.</span><span class="ident" id="6271622">flush</span><span class="op" id="6271627">(</span><span class="op" id="6271628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271631">return</span>&nbsp;<span class="ident" id="6271638"><a href="/image/gif/writer.go.html#6271408">e</a></span><span class="op" id="6271639">.</span><span class="ident" id="6271640">err</span><br>
<span class="lineno"></span><span class="op" id="6271644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="6271647">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;GIF&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="6271696">func</span>&nbsp;<span class="ident" id="6271701">Encode</span><span class="op" id="6271707">(</span><span class="ident" id="6271708">w</span>&nbsp;<span class="ident" id="6271710"><a href="/image/gif/writer.go.html#6265279">io</a></span><span class="op" id="6271712">.</span><span class="ident" id="6271713">Writer</span><span class="op" id="6271719">,</span>&nbsp;<span class="ident" id="6271721">m</span>&nbsp;<span class="ident" id="6271723"><a href="/image/gif/writer.go.html#6265218">image</a></span><span class="op" id="6271728">.</span><span class="ident" id="6271729">Image</span><span class="op" id="6271734">,</span>&nbsp;<span class="ident" id="6271736">o</span>&nbsp;<span class="op" id="6271738">*</span><span class="ident" id="6271739"><a href="/image/gif/writer.go.html#6270595">Options</a></span><span class="op" id="6271746">)</span>&nbsp;<span class="builtintype" id="6271748">error</span>&nbsp;<span class="op" id="6271754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6271757">//&nbsp;Check&nbsp;for&nbsp;bounds&nbsp;and&nbsp;size&nbsp;restrictions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6271801">b</span>&nbsp;<span class="op" id="6271803">:=</span>&nbsp;<span class="ident" id="6271806"><a href="/image/gif/writer.go.html#6271721">m</a></span><span class="op" id="6271807">.</span><span class="ident" id="6271808">Bounds</span><span class="op" id="6271814">(</span><span class="op" id="6271815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271818">if</span>&nbsp;<span class="ident" id="6271821"><a href="/image/gif/writer.go.html#6271801">b</a></span><span class="op" id="6271822">.</span><span class="ident" id="6271823">Dx</span><span class="op" id="6271825">(</span><span class="op" id="6271826">)</span>&nbsp;<span class="op" id="6271828">&gt;=</span>&nbsp;<span class="num" id="6271831">1</span><span class="op" id="6271832">&lt;&lt;</span><span class="num" id="6271834">16</span>&nbsp;<span class="op" id="6271837">||</span>&nbsp;<span class="ident" id="6271840"><a href="/image/gif/writer.go.html#6271801">b</a></span><span class="op" id="6271841">.</span><span class="ident" id="6271842">Dy</span><span class="op" id="6271844">(</span><span class="op" id="6271845">)</span>&nbsp;<span class="op" id="6271847">&gt;=</span>&nbsp;<span class="num" id="6271850">1</span><span class="op" id="6271851">&lt;&lt;</span><span class="num" id="6271853">16</span>&nbsp;<span class="op" id="6271856">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271860">return</span>&nbsp;<span class="ident" id="6271867"><a href="/image/gif/writer.go.html#6265208">errors</a></span><span class="op" id="6271873">.</span><span class="ident" id="6271874">New</span><span class="op" id="6271877">(</span><span class="string" id="6271878">&#34;gif:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="6271913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6271916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6271920">opts</span>&nbsp;<span class="op" id="6271925">:=</span>&nbsp;<span class="ident" id="6271928"><a href="/image/gif/writer.go.html#6270595">Options</a></span><span class="op" id="6271935">{</span><span class="op" id="6271936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271939">if</span>&nbsp;<span class="ident" id="6271942"><a href="/image/gif/writer.go.html#6271736">o</a></span>&nbsp;<span class="op" id="6271944">!=</span>&nbsp;<span class="ident" id="6271947">nil</span>&nbsp;<span class="op" id="6271951">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6271955"><a href="/image/gif/writer.go.html#6271920">opts</a></span>&nbsp;<span class="op" id="6271960">=</span>&nbsp;<span class="op" id="6271962">*</span><span class="ident" id="6271963"><a href="/image/gif/writer.go.html#6271736">o</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6271966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6271969">if</span>&nbsp;<span class="ident" id="6271972"><a href="/image/gif/writer.go.html#6271920">opts</a></span><span class="op" id="6271976">.</span><span class="ident" id="6271977">NumColors</span>&nbsp;<span class="op" id="6271987">&lt;</span>&nbsp;<span class="num" id="6271989">1</span>&nbsp;<span class="op" id="6271991">||</span>&nbsp;<span class="num" id="6271994">256</span>&nbsp;<span class="op" id="6271998">&lt;</span>&nbsp;<span class="ident" id="6272000"><a href="/image/gif/writer.go.html#6271920">opts</a></span><span class="op" id="6272004">.</span><span class="ident" id="6272005">NumColors</span>&nbsp;<span class="op" id="6272015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272019"><a href="/image/gif/writer.go.html#6271920">opts</a></span><span class="op" id="6272023">.</span><span class="ident" id="6272024">NumColors</span>&nbsp;<span class="op" id="6272034">=</span>&nbsp;<span class="num" id="6272036">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272041">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272044">if</span>&nbsp;<span class="ident" id="6272047"><a href="/image/gif/writer.go.html#6271920">opts</a></span><span class="op" id="6272051">.</span><span class="ident" id="6272052">Drawer</span>&nbsp;<span class="op" id="6272059">==</span>&nbsp;<span class="ident" id="6272062">nil</span>&nbsp;<span class="op" id="6272066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272070"><a href="/image/gif/writer.go.html#6271920">opts</a></span><span class="op" id="6272074">.</span><span class="ident" id="6272075">Drawer</span>&nbsp;<span class="op" id="6272082">=</span>&nbsp;<span class="ident" id="6272084"><a href="/image/gif/writer.go.html#6265265">draw</a></span><span class="op" id="6272088">.</span><span class="ident" id="6272089">FloydSteinberg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272109">pm</span><span class="op" id="6272111">,</span>&nbsp;<span class="ident" id="6272113">ok</span>&nbsp;<span class="op" id="6272116">:=</span>&nbsp;<span class="ident" id="6272119"><a href="/image/gif/writer.go.html#6271721">m</a></span><span class="op" id="6272120">.</span><span class="op" id="6272121">(</span><span class="op" id="6272122">*</span><span class="ident" id="6272123"><a href="/image/gif/writer.go.html#6265218">image</a></span><span class="op" id="6272128">.</span><span class="ident" id="6272129">Paletted</span><span class="op" id="6272137">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272140">if</span>&nbsp;<span class="op" id="6272143">!</span><span class="ident" id="6272144"><a href="/image/gif/writer.go.html#6272113">ok</a></span>&nbsp;<span class="op" id="6272147">||</span>&nbsp;<span class="builtinfunc" id="6272150">len</span><span class="op" id="6272153">(</span><span class="ident" id="6272154"><a href="/image/gif/writer.go.html#6272109">pm</a></span><span class="op" id="6272156">.</span><span class="ident" id="6272157">Palette</span><span class="op" id="6272164">)</span>&nbsp;<span class="op" id="6272166">&gt;</span>&nbsp;<span class="ident" id="6272168"><a href="/image/gif/writer.go.html#6271920">opts</a></span><span class="op" id="6272172">.</span><span class="ident" id="6272173">NumColors</span>&nbsp;<span class="op" id="6272183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6272187">//&nbsp;TODO:&nbsp;Pick&nbsp;a&nbsp;better&nbsp;sub-sample&nbsp;of&nbsp;the&nbsp;Plan&nbsp;9&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272246"><a href="/image/gif/writer.go.html#6272109">pm</a></span>&nbsp;<span class="op" id="6272249">=</span>&nbsp;<span class="ident" id="6272251"><a href="/image/gif/writer.go.html#6265218">image</a></span><span class="op" id="6272256">.</span><span class="ident" id="6272257">NewPaletted</span><span class="op" id="6272268">(</span><span class="ident" id="6272269"><a href="/image/gif/writer.go.html#6271801">b</a></span><span class="op" id="6272270">,</span>&nbsp;<span class="ident" id="6272272"><a href="/image/gif/writer.go.html#6265242">palette</a></span><span class="op" id="6272279">.</span><span class="ident" id="6272280">Plan9</span><span class="op" id="6272285">[</span><span class="op" id="6272286">:</span><span class="ident" id="6272287"><a href="/image/gif/writer.go.html#6271920">opts</a></span><span class="op" id="6272291">.</span><span class="ident" id="6272292">NumColors</span><span class="op" id="6272301">]</span><span class="op" id="6272302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272306">if</span>&nbsp;<span class="ident" id="6272309"><a href="/image/gif/writer.go.html#6271920">opts</a></span><span class="op" id="6272313">.</span><span class="ident" id="6272314">Quantizer</span>&nbsp;<span class="op" id="6272324">!=</span>&nbsp;<span class="ident" id="6272327">nil</span>&nbsp;<span class="op" id="6272331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272336"><a href="/image/gif/writer.go.html#6272109">pm</a></span><span class="op" id="6272338">.</span><span class="ident" id="6272339">Palette</span>&nbsp;<span class="op" id="6272347">=</span>&nbsp;<span class="ident" id="6272349"><a href="/image/gif/writer.go.html#6271920">opts</a></span><span class="op" id="6272353">.</span><span class="ident" id="6272354">Quantizer</span><span class="op" id="6272363">.</span><span class="ident" id="6272364">Quantize</span><span class="op" id="6272372">(</span><span class="builtinfunc" id="6272373">make</span><span class="op" id="6272377">(</span><span class="ident" id="6272378"><a href="/image/gif/writer.go.html#6265227">color</a></span><span class="op" id="6272383">.</span><span class="ident" id="6272384">Palette</span><span class="op" id="6272391">,</span>&nbsp;<span class="num" id="6272393">0</span><span class="op" id="6272394">,</span>&nbsp;<span class="ident" id="6272396"><a href="/image/gif/writer.go.html#6271920">opts</a></span><span class="op" id="6272400">.</span><span class="ident" id="6272401">NumColors</span><span class="op" id="6272410">)</span><span class="op" id="6272411">,</span>&nbsp;<span class="ident" id="6272413"><a href="/image/gif/writer.go.html#6271721">m</a></span><span class="op" id="6272414">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272422"><a href="/image/gif/writer.go.html#6271920">opts</a></span><span class="op" id="6272426">.</span><span class="ident" id="6272427">Drawer</span><span class="op" id="6272433">.</span><span class="ident" id="6272434">Draw</span><span class="op" id="6272438">(</span><span class="ident" id="6272439"><a href="/image/gif/writer.go.html#6272109">pm</a></span><span class="op" id="6272441">,</span>&nbsp;<span class="ident" id="6272443"><a href="/image/gif/writer.go.html#6271801">b</a></span><span class="op" id="6272444">,</span>&nbsp;<span class="ident" id="6272446"><a href="/image/gif/writer.go.html#6271721">m</a></span><span class="op" id="6272447">,</span>&nbsp;<span class="ident" id="6272449"><a href="/image/gif/writer.go.html#6265218">image</a></span><span class="op" id="6272454">.</span><span class="ident" id="6272455">ZP</span><span class="op" id="6272457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6272464">return</span>&nbsp;<span class="ident" id="6272471"><a href="/image/gif/writer.go.html#6271135">EncodeAll</a></span><span class="op" id="6272480">(</span><span class="ident" id="6272481"><a href="/image/gif/writer.go.html#6271708">w</a></span><span class="op" id="6272482">,</span>&nbsp;<span class="op" id="6272484">&amp;</span><span class="ident" id="6272485"><a href="/image/gif/reader.go.html#6264003">GIF</a></span><span class="op" id="6272488">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272492">Image</span><span class="op" id="6272497">:</span>&nbsp;<span class="op" id="6272499">[</span><span class="op" id="6272500">]</span><span class="op" id="6272501">*</span><span class="ident" id="6272502"><a href="/image/gif/writer.go.html#6265218">image</a></span><span class="op" id="6272507">.</span><span class="ident" id="6272508">Paletted</span><span class="op" id="6272516">{</span><span class="ident" id="6272517"><a href="/image/gif/writer.go.html#6272109">pm</a></span><span class="op" id="6272519">}</span><span class="op" id="6272520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6272524">Delay</span><span class="op" id="6272529">:</span>&nbsp;<span class="op" id="6272531">[</span><span class="op" id="6272532">]</span><span class="builtintype" id="6272533">int</span><span class="op" id="6272536">{</span><span class="num" id="6272537">0</span><span class="op" id="6272538">}</span><span class="op" id="6272539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6272542">}</span><span class="op" id="6272543">)</span><br>
<span class="lineno"></span><span class="op" id="6272545">}</span>
</div>
</body>
</html>
