<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5773782">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5773837">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5773891">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5773942">package</span>&nbsp;<span class="ident" id="5773950">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5773959">import</span>&nbsp;<span class="op" id="5773966">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5773969">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5773977">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5773984">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5773990">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5774001">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5774009">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5774024">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5774031">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5774034">var</span>&nbsp;<span class="ident" id="5774038">matchBenchmarks</span>&nbsp;<span class="op" id="5774054">=</span>&nbsp;<span class="ident" id="5774056">flag</span><span class="op" id="5774060">.</span><span class="ident" id="5774061">String</span><span class="op" id="5774067">(</span><span class="string" id="5774068">&#34;test.bench&#34;</span><span class="op" id="5774080">,</span>&nbsp;<span class="string" id="5774082">&#34;&#34;</span><span class="op" id="5774084">,</span>&nbsp;<span class="string" id="5774086">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;benchmarks&nbsp;to&nbsp;run&#34;</span><span class="op" id="5774134">)</span><br>
<span class="lineno"></span><span class="keyword" id="5774136">var</span>&nbsp;<span class="ident" id="5774140">benchTime</span>&nbsp;<span class="op" id="5774150">=</span>&nbsp;<span class="ident" id="5774152">flag</span><span class="op" id="5774156">.</span><span class="ident" id="5774157">Duration</span><span class="op" id="5774165">(</span><span class="string" id="5774166">&#34;test.benchtime&#34;</span><span class="op" id="5774182">,</span>&nbsp;<span class="num" id="5774184">1</span><span class="op" id="5774185">*</span><span class="ident" id="5774186">time</span><span class="op" id="5774190">.</span><span class="ident" id="5774191">Second</span><span class="op" id="5774197">,</span>&nbsp;<span class="string" id="5774199">&#34;approximate&nbsp;run&nbsp;time&nbsp;for&nbsp;each&nbsp;benchmark&#34;</span><span class="op" id="5774240">)</span><br>
<span class="lineno"></span><span class="keyword" id="5774242">var</span>&nbsp;<span class="ident" id="5774246">benchmarkMemory</span>&nbsp;<span class="op" id="5774262">=</span>&nbsp;<span class="ident" id="5774264">flag</span><span class="op" id="5774268">.</span><span class="ident" id="5774269">Bool</span><span class="op" id="5774273">(</span><span class="string" id="5774274">&#34;test.benchmem&#34;</span><span class="op" id="5774289">,</span>&nbsp;<span class="builtintype" id="5774291">false</span><span class="op" id="5774296">,</span>&nbsp;<span class="string" id="5774298">&#34;print&nbsp;memory&nbsp;allocations&nbsp;for&nbsp;benchmarks&#34;</span><span class="op" id="5774339">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5774342">//&nbsp;Global&nbsp;lock&nbsp;to&nbsp;ensure&nbsp;only&nbsp;one&nbsp;benchmark&nbsp;runs&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="5774402">var</span>&nbsp;<span class="ident" id="5774406">benchmarkLock</span>&nbsp;<span class="ident" id="5774420">sync</span><span class="op" id="5774424">.</span><span class="ident" id="5774425">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5774432">//&nbsp;Used&nbsp;for&nbsp;every&nbsp;benchmark&nbsp;for&nbsp;measuring&nbsp;memory.</span><br>
<span class="lineno">25</span><span class="keyword" id="5774482">var</span>&nbsp;<span class="ident" id="5774486">memStats</span>&nbsp;<span class="ident" id="5774495">runtime</span><span class="op" id="5774502">.</span><span class="ident" id="5774503">MemStats</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5774513">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5774602">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5774631">type</span>&nbsp;<span class="ident" id="5774636">InternalBenchmark</span>&nbsp;<span class="keyword" id="5774654">struct</span>&nbsp;<span class="op" id="5774661">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774664">Name</span>&nbsp;<span class="builtintype" id="5774669">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774677">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5774682">func</span><span class="op" id="5774686">(</span><span class="ident" id="5774687">b</span>&nbsp;<span class="op" id="5774689">*</span><span class="ident" id="5774690">B</span><span class="op" id="5774691">)</span><br>
<span class="lineno"></span><span class="op" id="5774693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5774696">//&nbsp;B&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Benchmark&nbsp;functions&nbsp;to&nbsp;manage&nbsp;benchmark</span><br>
<span class="lineno">35</span><span class="comment" id="5774761">//&nbsp;timing&nbsp;and&nbsp;to&nbsp;specify&nbsp;the&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="5774819">type</span>&nbsp;<span class="ident" id="5774824">B</span>&nbsp;<span class="keyword" id="5774826">struct</span>&nbsp;<span class="op" id="5774833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774836">common</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774844">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5774861">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774866">previousN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5774883">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5774897">//&nbsp;number&nbsp;of&nbsp;iterations&nbsp;in&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5774942">previousDuration</span>&nbsp;<span class="ident" id="5774959">time</span><span class="op" id="5774963">.</span><span class="ident" id="5774964">Duration</span>&nbsp;<span class="comment" id="5774973">//&nbsp;total&nbsp;duration&nbsp;of&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775012">benchmark</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5775029">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775048">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5775065">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775072">timerOn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5775089">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775095">showAllocResult</span>&nbsp;&nbsp;<span class="builtintype" id="5775112">bool</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775118">result</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5775135">BenchmarkResult</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775152">parallelism</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5775169">int</span>&nbsp;<span class="comment" id="5775173">//&nbsp;RunParallel&nbsp;creates&nbsp;parallelism*GOMAXPROCS&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775231">//&nbsp;The&nbsp;initial&nbsp;states&nbsp;of&nbsp;memStats.Mallocs&nbsp;and&nbsp;memStats.TotalAlloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775299">startAllocs</span>&nbsp;<span class="ident" id="5775311">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775319">startBytes</span>&nbsp;&nbsp;<span class="ident" id="5775331">uint64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5775339">//&nbsp;The&nbsp;net&nbsp;total&nbsp;of&nbsp;this&nbsp;test&nbsp;after&nbsp;being&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775387">netAllocs</span>&nbsp;<span class="ident" id="5775397">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775405">netBytes</span>&nbsp;&nbsp;<span class="ident" id="5775415">uint64</span><br>
<span class="lineno"></span><span class="op" id="5775422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="5775425">//&nbsp;StartTimer&nbsp;starts&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;automatically</span><br>
<span class="lineno"></span><span class="comment" id="5775500">//&nbsp;before&nbsp;a&nbsp;benchmark&nbsp;starts,&nbsp;but&nbsp;it&nbsp;can&nbsp;also&nbsp;used&nbsp;to&nbsp;resume&nbsp;timing&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="5775574">//&nbsp;a&nbsp;call&nbsp;to&nbsp;StopTimer.</span><br>
<span class="lineno"></span><span class="keyword" id="5775598">func</span>&nbsp;<span class="op" id="5775603">(</span><span class="ident" id="5775604">b</span>&nbsp;<span class="op" id="5775606">*</span><span class="ident" id="5775607">B</span><span class="op" id="5775608">)</span>&nbsp;<span class="ident" id="5775610">StartTimer</span><span class="op" id="5775620">(</span><span class="op" id="5775621">)</span>&nbsp;<span class="op" id="5775623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775626">if</span>&nbsp;<span class="op" id="5775629">!</span><span class="ident" id="5775630">b</span><span class="op" id="5775631">.</span><span class="ident" id="5775632">timerOn</span>&nbsp;<span class="op" id="5775640">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775644">runtime</span><span class="op" id="5775651">.</span><span class="ident" id="5775652">ReadMemStats</span><span class="op" id="5775664">(</span><span class="op" id="5775665">&amp;</span><span class="ident" id="5775666">memStats</span><span class="op" id="5775674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775678">b</span><span class="op" id="5775679">.</span><span class="ident" id="5775680">startAllocs</span>&nbsp;<span class="op" id="5775692">=</span>&nbsp;<span class="ident" id="5775694">memStats</span><span class="op" id="5775702">.</span><span class="ident" id="5775703">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775713">b</span><span class="op" id="5775714">.</span><span class="ident" id="5775715">startBytes</span>&nbsp;<span class="op" id="5775726">=</span>&nbsp;<span class="ident" id="5775728">memStats</span><span class="op" id="5775736">.</span><span class="ident" id="5775737">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775750">b</span><span class="op" id="5775751">.</span><span class="ident" id="5775752">start</span>&nbsp;<span class="op" id="5775758">=</span>&nbsp;<span class="ident" id="5775760">time</span><span class="op" id="5775764">.</span><span class="ident" id="5775765">Now</span><span class="op" id="5775768">(</span><span class="op" id="5775769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775773">b</span><span class="op" id="5775774">.</span><span class="ident" id="5775775">timerOn</span>&nbsp;<span class="op" id="5775783">=</span>&nbsp;<span class="builtintype" id="5775785">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5775791">}</span><br>
<span class="lineno"></span><span class="op" id="5775793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5775796">//&nbsp;StopTimer&nbsp;stops&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;pause&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="5775867">//&nbsp;while&nbsp;performing&nbsp;complex&nbsp;initialization&nbsp;that&nbsp;you&nbsp;don&#39;t</span><br>
<span class="lineno">70</span><span class="comment" id="5775925">//&nbsp;want&nbsp;to&nbsp;measure.</span><br>
<span class="lineno"></span><span class="keyword" id="5775945">func</span>&nbsp;<span class="op" id="5775950">(</span><span class="ident" id="5775951">b</span>&nbsp;<span class="op" id="5775953">*</span><span class="ident" id="5775954">B</span><span class="op" id="5775955">)</span>&nbsp;<span class="ident" id="5775957">StopTimer</span><span class="op" id="5775966">(</span><span class="op" id="5775967">)</span>&nbsp;<span class="op" id="5775969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5775972">if</span>&nbsp;<span class="ident" id="5775975">b</span><span class="op" id="5775976">.</span><span class="ident" id="5775977">timerOn</span>&nbsp;<span class="op" id="5775985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5775989">b</span><span class="op" id="5775990">.</span><span class="ident" id="5775991">duration</span>&nbsp;<span class="op" id="5776000">+=</span>&nbsp;<span class="ident" id="5776003">time</span><span class="op" id="5776007">.</span><span class="ident" id="5776008">Now</span><span class="op" id="5776011">(</span><span class="op" id="5776012">)</span><span class="op" id="5776013">.</span><span class="ident" id="5776014">Sub</span><span class="op" id="5776017">(</span><span class="ident" id="5776018">b</span><span class="op" id="5776019">.</span><span class="ident" id="5776020">start</span><span class="op" id="5776025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776029">runtime</span><span class="op" id="5776036">.</span><span class="ident" id="5776037">ReadMemStats</span><span class="op" id="5776049">(</span><span class="op" id="5776050">&amp;</span><span class="ident" id="5776051">memStats</span><span class="op" id="5776059">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776063">b</span><span class="op" id="5776064">.</span><span class="ident" id="5776065">netAllocs</span>&nbsp;<span class="op" id="5776075">+=</span>&nbsp;<span class="ident" id="5776078">memStats</span><span class="op" id="5776086">.</span><span class="ident" id="5776087">Mallocs</span>&nbsp;<span class="op" id="5776095">-</span>&nbsp;<span class="ident" id="5776097">b</span><span class="op" id="5776098">.</span><span class="ident" id="5776099">startAllocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776113">b</span><span class="op" id="5776114">.</span><span class="ident" id="5776115">netBytes</span>&nbsp;<span class="op" id="5776124">+=</span>&nbsp;<span class="ident" id="5776127">memStats</span><span class="op" id="5776135">.</span><span class="ident" id="5776136">TotalAlloc</span>&nbsp;<span class="op" id="5776147">-</span>&nbsp;<span class="ident" id="5776149">b</span><span class="op" id="5776150">.</span><span class="ident" id="5776151">startBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776164">b</span><span class="op" id="5776165">.</span><span class="ident" id="5776166">timerOn</span>&nbsp;<span class="op" id="5776174">=</span>&nbsp;<span class="builtintype" id="5776176">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776183">}</span><br>
<span class="lineno"></span><span class="op" id="5776185">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="5776188">//&nbsp;ResetTimer&nbsp;zeros&nbsp;the&nbsp;elapsed&nbsp;benchmark&nbsp;time&nbsp;and&nbsp;memory&nbsp;allocation&nbsp;counters.</span><br>
<span class="lineno"></span><span class="comment" id="5776267">//&nbsp;It&nbsp;does&nbsp;not&nbsp;affect&nbsp;whether&nbsp;the&nbsp;timer&nbsp;is&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="5776319">func</span>&nbsp;<span class="op" id="5776324">(</span><span class="ident" id="5776325">b</span>&nbsp;<span class="op" id="5776327">*</span><span class="ident" id="5776328">B</span><span class="op" id="5776329">)</span>&nbsp;<span class="ident" id="5776331">ResetTimer</span><span class="op" id="5776341">(</span><span class="op" id="5776342">)</span>&nbsp;<span class="op" id="5776344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776347">if</span>&nbsp;<span class="ident" id="5776350">b</span><span class="op" id="5776351">.</span><span class="ident" id="5776352">timerOn</span>&nbsp;<span class="op" id="5776360">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776364">runtime</span><span class="op" id="5776371">.</span><span class="ident" id="5776372">ReadMemStats</span><span class="op" id="5776384">(</span><span class="op" id="5776385">&amp;</span><span class="ident" id="5776386">memStats</span><span class="op" id="5776394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776398">b</span><span class="op" id="5776399">.</span><span class="ident" id="5776400">startAllocs</span>&nbsp;<span class="op" id="5776412">=</span>&nbsp;<span class="ident" id="5776414">memStats</span><span class="op" id="5776422">.</span><span class="ident" id="5776423">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776433">b</span><span class="op" id="5776434">.</span><span class="ident" id="5776435">startBytes</span>&nbsp;<span class="op" id="5776446">=</span>&nbsp;<span class="ident" id="5776448">memStats</span><span class="op" id="5776456">.</span><span class="ident" id="5776457">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776470">b</span><span class="op" id="5776471">.</span><span class="ident" id="5776472">start</span>&nbsp;<span class="op" id="5776478">=</span>&nbsp;<span class="ident" id="5776480">time</span><span class="op" id="5776484">.</span><span class="ident" id="5776485">Now</span><span class="op" id="5776488">(</span><span class="op" id="5776489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5776492">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776495">b</span><span class="op" id="5776496">.</span><span class="ident" id="5776497">duration</span>&nbsp;<span class="op" id="5776506">=</span>&nbsp;<span class="num" id="5776508">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776511">b</span><span class="op" id="5776512">.</span><span class="ident" id="5776513">netAllocs</span>&nbsp;<span class="op" id="5776523">=</span>&nbsp;<span class="num" id="5776525">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776528">b</span><span class="op" id="5776529">.</span><span class="ident" id="5776530">netBytes</span>&nbsp;<span class="op" id="5776539">=</span>&nbsp;<span class="num" id="5776541">0</span><br>
<span class="lineno"></span><span class="op" id="5776543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5776546">//&nbsp;SetBytes&nbsp;records&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;processed&nbsp;in&nbsp;a&nbsp;single&nbsp;operation.</span><br>
<span class="lineno"></span><span class="comment" id="5776619">//&nbsp;If&nbsp;this&nbsp;is&nbsp;called,&nbsp;the&nbsp;benchmark&nbsp;will&nbsp;report&nbsp;ns/op&nbsp;and&nbsp;MB/s.</span><br>
<span class="lineno"></span><span class="keyword" id="5776683">func</span>&nbsp;<span class="op" id="5776688">(</span><span class="ident" id="5776689">b</span>&nbsp;<span class="op" id="5776691">*</span><span class="ident" id="5776692">B</span><span class="op" id="5776693">)</span>&nbsp;<span class="ident" id="5776695">SetBytes</span><span class="op" id="5776703">(</span><span class="ident" id="5776704">n</span>&nbsp;<span class="ident" id="5776706">int64</span><span class="op" id="5776711">)</span>&nbsp;<span class="op" id="5776713">{</span>&nbsp;<span class="ident" id="5776715">b</span><span class="op" id="5776716">.</span><span class="ident" id="5776717">bytes</span>&nbsp;<span class="op" id="5776723">=</span>&nbsp;<span class="ident" id="5776725">n</span>&nbsp;<span class="op" id="5776727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5776730">//&nbsp;ReportAllocs&nbsp;enables&nbsp;malloc&nbsp;statistics&nbsp;for&nbsp;this&nbsp;benchmark.</span><br>
<span class="lineno">100</span><span class="comment" id="5776792">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;setting&nbsp;-test.benchmem,&nbsp;but&nbsp;it&nbsp;only&nbsp;affects&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5776863">//&nbsp;benchmark&nbsp;function&nbsp;that&nbsp;calls&nbsp;ReportAllocs.</span><br>
<span class="lineno"></span><span class="keyword" id="5776910">func</span>&nbsp;<span class="op" id="5776915">(</span><span class="ident" id="5776916">b</span>&nbsp;<span class="op" id="5776918">*</span><span class="ident" id="5776919">B</span><span class="op" id="5776920">)</span>&nbsp;<span class="ident" id="5776922">ReportAllocs</span><span class="op" id="5776934">(</span><span class="op" id="5776935">)</span>&nbsp;<span class="op" id="5776937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5776940">b</span><span class="op" id="5776941">.</span><span class="ident" id="5776942">showAllocResult</span>&nbsp;<span class="op" id="5776958">=</span>&nbsp;<span class="builtintype" id="5776960">true</span><br>
<span class="lineno"></span><span class="op" id="5776965">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="5776968">func</span>&nbsp;<span class="op" id="5776973">(</span><span class="ident" id="5776974">b</span>&nbsp;<span class="op" id="5776976">*</span><span class="ident" id="5776977">B</span><span class="op" id="5776978">)</span>&nbsp;<span class="ident" id="5776980">nsPerOp</span><span class="op" id="5776987">(</span><span class="op" id="5776988">)</span>&nbsp;<span class="ident" id="5776990">int64</span>&nbsp;<span class="op" id="5776996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5776999">if</span>&nbsp;<span class="ident" id="5777002">b</span><span class="op" id="5777003">.</span><span class="ident" id="5777004">N</span>&nbsp;<span class="op" id="5777006">&lt;=</span>&nbsp;<span class="num" id="5777009">0</span>&nbsp;<span class="op" id="5777011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777015">return</span>&nbsp;<span class="num" id="5777022">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777025">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777028">return</span>&nbsp;<span class="ident" id="5777035">b</span><span class="op" id="5777036">.</span><span class="ident" id="5777037">duration</span><span class="op" id="5777045">.</span><span class="ident" id="5777046">Nanoseconds</span><span class="op" id="5777057">(</span><span class="op" id="5777058">)</span>&nbsp;<span class="op" id="5777060">/</span>&nbsp;<span class="ident" id="5777062">int64</span><span class="op" id="5777067">(</span><span class="ident" id="5777068">b</span><span class="op" id="5777069">.</span><span class="ident" id="5777070">N</span><span class="op" id="5777071">)</span><br>
<span class="lineno"></span><span class="op" id="5777073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5777076">//&nbsp;runN&nbsp;runs&nbsp;a&nbsp;single&nbsp;benchmark&nbsp;for&nbsp;the&nbsp;specified&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span><span class="keyword" id="5777148">func</span>&nbsp;<span class="op" id="5777153">(</span><span class="ident" id="5777154">b</span>&nbsp;<span class="op" id="5777156">*</span><span class="ident" id="5777157">B</span><span class="op" id="5777158">)</span>&nbsp;<span class="ident" id="5777160">runN</span><span class="op" id="5777164">(</span><span class="ident" id="5777165">n</span>&nbsp;<span class="builtintype" id="5777167">int</span><span class="op" id="5777170">)</span>&nbsp;<span class="op" id="5777172">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777175">benchmarkLock</span><span class="op" id="5777188">.</span><span class="ident" id="5777189">Lock</span><span class="op" id="5777193">(</span><span class="op" id="5777194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777197">defer</span>&nbsp;<span class="ident" id="5777203">benchmarkLock</span><span class="op" id="5777216">.</span><span class="ident" id="5777217">Unlock</span><span class="op" id="5777223">(</span><span class="op" id="5777224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5777227">//&nbsp;Try&nbsp;to&nbsp;get&nbsp;a&nbsp;comparable&nbsp;environment&nbsp;for&nbsp;each&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5777280">//&nbsp;by&nbsp;clearing&nbsp;garbage&nbsp;from&nbsp;previous&nbsp;runs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777324">runtime</span><span class="op" id="5777331">.</span><span class="ident" id="5777332">GC</span><span class="op" id="5777334">(</span><span class="op" id="5777335">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777338">b</span><span class="op" id="5777339">.</span><span class="ident" id="5777340">N</span>&nbsp;<span class="op" id="5777342">=</span>&nbsp;<span class="ident" id="5777344">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777347">b</span><span class="op" id="5777348">.</span><span class="ident" id="5777349">parallelism</span>&nbsp;<span class="op" id="5777361">=</span>&nbsp;<span class="num" id="5777363">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777366">b</span><span class="op" id="5777367">.</span><span class="ident" id="5777368">ResetTimer</span><span class="op" id="5777378">(</span><span class="op" id="5777379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777382">b</span><span class="op" id="5777383">.</span><span class="ident" id="5777384">StartTimer</span><span class="op" id="5777394">(</span><span class="op" id="5777395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777398">b</span><span class="op" id="5777399">.</span><span class="ident" id="5777400">benchmark</span><span class="op" id="5777409">.</span><span class="ident" id="5777410">F</span><span class="op" id="5777411">(</span><span class="ident" id="5777412">b</span><span class="op" id="5777413">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777416">b</span><span class="op" id="5777417">.</span><span class="ident" id="5777418">StopTimer</span><span class="op" id="5777427">(</span><span class="op" id="5777428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777431">b</span><span class="op" id="5777432">.</span><span class="ident" id="5777433">previousN</span>&nbsp;<span class="op" id="5777443">=</span>&nbsp;<span class="ident" id="5777445">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777448">b</span><span class="op" id="5777449">.</span><span class="ident" id="5777450">previousDuration</span>&nbsp;<span class="op" id="5777467">=</span>&nbsp;<span class="ident" id="5777469">b</span><span class="op" id="5777470">.</span><span class="ident" id="5777471">duration</span><br>
<span class="lineno"></span><span class="op" id="5777480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5777483">func</span>&nbsp;<span class="ident" id="5777488">min</span><span class="op" id="5777491">(</span><span class="ident" id="5777492">x</span><span class="op" id="5777493">,</span>&nbsp;<span class="ident" id="5777495">y</span>&nbsp;<span class="builtintype" id="5777497">int</span><span class="op" id="5777500">)</span>&nbsp;<span class="builtintype" id="5777502">int</span>&nbsp;<span class="op" id="5777506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777509">if</span>&nbsp;<span class="ident" id="5777512">x</span>&nbsp;<span class="op" id="5777514">&gt;</span>&nbsp;<span class="ident" id="5777516">y</span>&nbsp;<span class="op" id="5777518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777522">return</span>&nbsp;<span class="ident" id="5777529">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777535">return</span>&nbsp;<span class="ident" id="5777542">x</span><br>
<span class="lineno">135</span><span class="op" id="5777544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5777547">func</span>&nbsp;<span class="ident" id="5777552">max</span><span class="op" id="5777555">(</span><span class="ident" id="5777556">x</span><span class="op" id="5777557">,</span>&nbsp;<span class="ident" id="5777559">y</span>&nbsp;<span class="builtintype" id="5777561">int</span><span class="op" id="5777564">)</span>&nbsp;<span class="builtintype" id="5777566">int</span>&nbsp;<span class="op" id="5777570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777573">if</span>&nbsp;<span class="ident" id="5777576">x</span>&nbsp;<span class="op" id="5777578">&lt;</span>&nbsp;<span class="ident" id="5777580">y</span>&nbsp;<span class="op" id="5777582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777586">return</span>&nbsp;<span class="ident" id="5777593">y</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777599">return</span>&nbsp;<span class="ident" id="5777606">x</span><br>
<span class="lineno"></span><span class="op" id="5777608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5777611">//&nbsp;roundDown10&nbsp;rounds&nbsp;a&nbsp;number&nbsp;down&nbsp;to&nbsp;the&nbsp;nearest&nbsp;power&nbsp;of&nbsp;10.</span><br>
<span class="lineno">145</span><span class="keyword" id="5777675">func</span>&nbsp;<span class="ident" id="5777680">roundDown10</span><span class="op" id="5777691">(</span><span class="ident" id="5777692">n</span>&nbsp;<span class="builtintype" id="5777694">int</span><span class="op" id="5777697">)</span>&nbsp;<span class="builtintype" id="5777699">int</span>&nbsp;<span class="op" id="5777703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777706">var</span>&nbsp;<span class="ident" id="5777710">tens</span>&nbsp;<span class="op" id="5777715">=</span>&nbsp;<span class="num" id="5777717">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5777720">//&nbsp;tens&nbsp;=&nbsp;floor(log_10(n))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777748">for</span>&nbsp;<span class="ident" id="5777752">n</span>&nbsp;<span class="op" id="5777754">&gt;=</span>&nbsp;<span class="num" id="5777757">10</span>&nbsp;<span class="op" id="5777760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777764">n</span>&nbsp;<span class="op" id="5777766">=</span>&nbsp;<span class="ident" id="5777768">n</span>&nbsp;<span class="op" id="5777770">/</span>&nbsp;<span class="num" id="5777772">10</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777777">tens</span><span class="op" id="5777781">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5777788">//&nbsp;result&nbsp;=&nbsp;10^tens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777809">result</span>&nbsp;<span class="op" id="5777816">:=</span>&nbsp;<span class="num" id="5777819">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777822">for</span>&nbsp;<span class="ident" id="5777826">i</span>&nbsp;<span class="op" id="5777828">:=</span>&nbsp;<span class="num" id="5777831">0</span><span class="op" id="5777832">;</span>&nbsp;<span class="ident" id="5777834">i</span>&nbsp;<span class="op" id="5777836">&lt;</span>&nbsp;<span class="ident" id="5777838">tens</span><span class="op" id="5777842">;</span>&nbsp;<span class="ident" id="5777844">i</span><span class="op" id="5777845">++</span>&nbsp;<span class="op" id="5777848">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777852">result</span>&nbsp;<span class="op" id="5777859">*=</span>&nbsp;<span class="num" id="5777862">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5777866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5777869">return</span>&nbsp;<span class="ident" id="5777876">result</span><br>
<span class="lineno"></span><span class="op" id="5777883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5777886">//&nbsp;roundUp&nbsp;rounds&nbsp;x&nbsp;up&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;the&nbsp;form&nbsp;[1eX,&nbsp;2eX,&nbsp;3eX,&nbsp;5eX].</span><br>
<span class="lineno"></span><span class="keyword" id="5777955">func</span>&nbsp;<span class="ident" id="5777960">roundUp</span><span class="op" id="5777967">(</span><span class="ident" id="5777968">n</span>&nbsp;<span class="builtintype" id="5777970">int</span><span class="op" id="5777973">)</span>&nbsp;<span class="builtintype" id="5777975">int</span>&nbsp;<span class="op" id="5777979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5777982">base</span>&nbsp;<span class="op" id="5777987">:=</span>&nbsp;<span class="ident" id="5777990">roundDown10</span><span class="op" id="5778001">(</span><span class="ident" id="5778002">n</span><span class="op" id="5778003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778006">switch</span>&nbsp;<span class="op" id="5778013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778016">case</span>&nbsp;<span class="ident" id="5778021">n</span>&nbsp;<span class="op" id="5778023">&lt;=</span>&nbsp;<span class="ident" id="5778026">base</span><span class="op" id="5778030">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778034">return</span>&nbsp;<span class="ident" id="5778041">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778047">case</span>&nbsp;<span class="ident" id="5778052">n</span>&nbsp;<span class="op" id="5778054">&lt;=</span>&nbsp;<span class="op" id="5778057">(</span><span class="num" id="5778058">2</span>&nbsp;<span class="op" id="5778060">*</span>&nbsp;<span class="ident" id="5778062">base</span><span class="op" id="5778066">)</span><span class="op" id="5778067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778071">return</span>&nbsp;<span class="num" id="5778078">2</span>&nbsp;<span class="op" id="5778080">*</span>&nbsp;<span class="ident" id="5778082">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778088">case</span>&nbsp;<span class="ident" id="5778093">n</span>&nbsp;<span class="op" id="5778095">&lt;=</span>&nbsp;<span class="op" id="5778098">(</span><span class="num" id="5778099">3</span>&nbsp;<span class="op" id="5778101">*</span>&nbsp;<span class="ident" id="5778103">base</span><span class="op" id="5778107">)</span><span class="op" id="5778108">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778112">return</span>&nbsp;<span class="num" id="5778119">3</span>&nbsp;<span class="op" id="5778121">*</span>&nbsp;<span class="ident" id="5778123">base</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778129">case</span>&nbsp;<span class="ident" id="5778134">n</span>&nbsp;<span class="op" id="5778136">&lt;=</span>&nbsp;<span class="op" id="5778139">(</span><span class="num" id="5778140">5</span>&nbsp;<span class="op" id="5778142">*</span>&nbsp;<span class="ident" id="5778144">base</span><span class="op" id="5778148">)</span><span class="op" id="5778149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778153">return</span>&nbsp;<span class="num" id="5778160">5</span>&nbsp;<span class="op" id="5778162">*</span>&nbsp;<span class="ident" id="5778164">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778170">default</span><span class="op" id="5778177">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778181">return</span>&nbsp;<span class="num" id="5778188">10</span>&nbsp;<span class="op" id="5778191">*</span>&nbsp;<span class="ident" id="5778193">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778199">}</span><br>
<span class="lineno">175</span><span class="op" id="5778201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5778204">//&nbsp;run&nbsp;times&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="5778265">func</span>&nbsp;<span class="op" id="5778270">(</span><span class="ident" id="5778271">b</span>&nbsp;<span class="op" id="5778273">*</span><span class="ident" id="5778274">B</span><span class="op" id="5778275">)</span>&nbsp;<span class="ident" id="5778277">run</span><span class="op" id="5778280">(</span><span class="op" id="5778281">)</span>&nbsp;<span class="ident" id="5778283">BenchmarkResult</span>&nbsp;<span class="op" id="5778299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778302">go</span>&nbsp;<span class="ident" id="5778305">b</span><span class="op" id="5778306">.</span><span class="ident" id="5778307">launch</span><span class="op" id="5778313">(</span><span class="op" id="5778314">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778317">&lt;-</span><span class="ident" id="5778319">b</span><span class="op" id="5778320">.</span><span class="ident" id="5778321">signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778329">return</span>&nbsp;<span class="ident" id="5778336">b</span><span class="op" id="5778337">.</span><span class="ident" id="5778338">result</span><br>
<span class="lineno"></span><span class="op" id="5778345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5778348">//&nbsp;launch&nbsp;launches&nbsp;the&nbsp;benchmark&nbsp;function.&nbsp;&nbsp;It&nbsp;gradually&nbsp;increases&nbsp;the&nbsp;number</span><br>
<span class="lineno">185</span><span class="comment" id="5778426">//&nbsp;of&nbsp;benchmark&nbsp;iterations&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;runs&nbsp;for&nbsp;the&nbsp;requested&nbsp;benchtime.</span><br>
<span class="lineno"></span><span class="comment" id="5778507">//&nbsp;It&nbsp;prints&nbsp;timing&nbsp;information&nbsp;in&nbsp;this&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5778552">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptesting.BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp100000&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp19&nbsp;ns/op</span><br>
<span class="lineno"></span><span class="comment" id="5778596">//&nbsp;launch&nbsp;is&nbsp;run&nbsp;by&nbsp;the&nbsp;run&nbsp;function&nbsp;as&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="5778658">func</span>&nbsp;<span class="op" id="5778663">(</span><span class="ident" id="5778664">b</span>&nbsp;<span class="op" id="5778666">*</span><span class="ident" id="5778667">B</span><span class="op" id="5778668">)</span>&nbsp;<span class="ident" id="5778670">launch</span><span class="op" id="5778676">(</span><span class="op" id="5778677">)</span>&nbsp;<span class="op" id="5778679">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778682">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;a&nbsp;single&nbsp;iteration&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;expensive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778751">n</span>&nbsp;<span class="op" id="5778753">:=</span>&nbsp;<span class="num" id="5778756">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778760">//&nbsp;Signal&nbsp;that&nbsp;we&#39;re&nbsp;done&nbsp;whether&nbsp;we&nbsp;return&nbsp;normally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778814">//&nbsp;or&nbsp;by&nbsp;FailNow&#39;s&nbsp;runtime.Goexit.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778850">defer</span>&nbsp;<span class="keyword" id="5778856">func</span><span class="op" id="5778860">(</span><span class="op" id="5778861">)</span>&nbsp;<span class="op" id="5778863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778867">b</span><span class="op" id="5778868">.</span><span class="ident" id="5778869">signal</span>&nbsp;<span class="op" id="5778876">&lt;-</span>&nbsp;<span class="ident" id="5778879">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5778882">}</span><span class="op" id="5778883">(</span><span class="op" id="5778884">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778888">b</span><span class="op" id="5778889">.</span><span class="ident" id="5778890">runN</span><span class="op" id="5778894">(</span><span class="ident" id="5778895">n</span><span class="op" id="5778896">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5778899">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;specified&nbsp;amount&nbsp;of&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778964">d</span>&nbsp;<span class="op" id="5778966">:=</span>&nbsp;<span class="op" id="5778969">*</span><span class="ident" id="5778970">benchTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778981">for</span>&nbsp;<span class="op" id="5778985">!</span><span class="ident" id="5778986">b</span><span class="op" id="5778987">.</span><span class="ident" id="5778988">failed</span>&nbsp;<span class="op" id="5778995">&amp;&amp;</span>&nbsp;<span class="ident" id="5778998">b</span><span class="op" id="5778999">.</span><span class="ident" id="5779000">duration</span>&nbsp;<span class="op" id="5779009">&lt;</span>&nbsp;<span class="ident" id="5779011">d</span>&nbsp;<span class="op" id="5779013">&amp;&amp;</span>&nbsp;<span class="ident" id="5779016">n</span>&nbsp;<span class="op" id="5779018">&lt;</span>&nbsp;<span class="num" id="5779020">1e9</span>&nbsp;<span class="op" id="5779024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779028">last</span>&nbsp;<span class="op" id="5779033">:=</span>&nbsp;<span class="ident" id="5779036">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779040">//&nbsp;Predict&nbsp;required&nbsp;iterations.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779074">if</span>&nbsp;<span class="ident" id="5779077">b</span><span class="op" id="5779078">.</span><span class="ident" id="5779079">nsPerOp</span><span class="op" id="5779086">(</span><span class="op" id="5779087">)</span>&nbsp;<span class="op" id="5779089">==</span>&nbsp;<span class="num" id="5779092">0</span>&nbsp;<span class="op" id="5779094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779099">n</span>&nbsp;<span class="op" id="5779101">=</span>&nbsp;<span class="num" id="5779103">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5779109">}</span>&nbsp;<span class="keyword" id="5779111">else</span>&nbsp;<span class="op" id="5779116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779121">n</span>&nbsp;<span class="op" id="5779123">=</span>&nbsp;<span class="builtintype" id="5779125">int</span><span class="op" id="5779128">(</span><span class="ident" id="5779129">d</span><span class="op" id="5779130">.</span><span class="ident" id="5779131">Nanoseconds</span><span class="op" id="5779142">(</span><span class="op" id="5779143">)</span>&nbsp;<span class="op" id="5779145">/</span>&nbsp;<span class="ident" id="5779147">b</span><span class="op" id="5779148">.</span><span class="ident" id="5779149">nsPerOp</span><span class="op" id="5779156">(</span><span class="op" id="5779157">)</span><span class="op" id="5779158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5779162">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779166">//&nbsp;Run&nbsp;more&nbsp;iterations&nbsp;than&nbsp;we&nbsp;think&nbsp;we&#39;ll&nbsp;need&nbsp;(1.2x).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779224">//&nbsp;Don&#39;t&nbsp;grow&nbsp;too&nbsp;fast&nbsp;in&nbsp;case&nbsp;we&nbsp;had&nbsp;timing&nbsp;errors&nbsp;previously.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779290">//&nbsp;Be&nbsp;sure&nbsp;to&nbsp;run&nbsp;at&nbsp;least&nbsp;one&nbsp;more&nbsp;than&nbsp;last&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779344">n</span>&nbsp;<span class="op" id="5779346">=</span>&nbsp;<span class="ident" id="5779348">max</span><span class="op" id="5779351">(</span><span class="ident" id="5779352">min</span><span class="op" id="5779355">(</span><span class="ident" id="5779356">n</span><span class="op" id="5779357">+</span><span class="ident" id="5779358">n</span><span class="op" id="5779359">/</span><span class="num" id="5779360">5</span><span class="op" id="5779361">,</span>&nbsp;<span class="num" id="5779363">100</span><span class="op" id="5779366">*</span><span class="ident" id="5779367">last</span><span class="op" id="5779371">)</span><span class="op" id="5779372">,</span>&nbsp;<span class="ident" id="5779374">last</span><span class="op" id="5779378">+</span><span class="num" id="5779379">1</span><span class="op" id="5779380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779384">//&nbsp;Round&nbsp;up&nbsp;to&nbsp;something&nbsp;easy&nbsp;to&nbsp;read.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779425">n</span>&nbsp;<span class="op" id="5779427">=</span>&nbsp;<span class="ident" id="5779429">roundUp</span><span class="op" id="5779436">(</span><span class="ident" id="5779437">n</span><span class="op" id="5779438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779442">b</span><span class="op" id="5779443">.</span><span class="ident" id="5779444">runN</span><span class="op" id="5779448">(</span><span class="ident" id="5779449">n</span><span class="op" id="5779450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5779453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779456">b</span><span class="op" id="5779457">.</span><span class="ident" id="5779458">result</span>&nbsp;<span class="op" id="5779465">=</span>&nbsp;<span class="ident" id="5779467">BenchmarkResult</span><span class="op" id="5779482">{</span><span class="ident" id="5779483">b</span><span class="op" id="5779484">.</span><span class="ident" id="5779485">N</span><span class="op" id="5779486">,</span>&nbsp;<span class="ident" id="5779488">b</span><span class="op" id="5779489">.</span><span class="ident" id="5779490">duration</span><span class="op" id="5779498">,</span>&nbsp;<span class="ident" id="5779500">b</span><span class="op" id="5779501">.</span><span class="ident" id="5779502">bytes</span><span class="op" id="5779507">,</span>&nbsp;<span class="ident" id="5779509">b</span><span class="op" id="5779510">.</span><span class="ident" id="5779511">netAllocs</span><span class="op" id="5779520">,</span>&nbsp;<span class="ident" id="5779522">b</span><span class="op" id="5779523">.</span><span class="ident" id="5779524">netBytes</span><span class="op" id="5779532">}</span><br>
<span class="lineno"></span><span class="op" id="5779534">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5779537">//&nbsp;The&nbsp;results&nbsp;of&nbsp;a&nbsp;benchmark&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="5779572">type</span>&nbsp;<span class="ident" id="5779577">BenchmarkResult</span>&nbsp;<span class="keyword" id="5779593">struct</span>&nbsp;<span class="op" id="5779600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779603">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5779613">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5779627">//&nbsp;The&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779657">T</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5779667">time</span><span class="op" id="5779671">.</span><span class="ident" id="5779672">Duration</span>&nbsp;<span class="comment" id="5779681">//&nbsp;The&nbsp;total&nbsp;time&nbsp;taken.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779707">Bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5779717">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5779731">//&nbsp;Bytes&nbsp;processed&nbsp;in&nbsp;one&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779769">MemAllocs</span>&nbsp;<span class="ident" id="5779779">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5779793">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;memory&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779837">MemBytes</span>&nbsp;&nbsp;<span class="ident" id="5779847">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5779861">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno"></span><span class="op" id="5779901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="5779904">func</span>&nbsp;<span class="op" id="5779909">(</span><span class="ident" id="5779910">r</span>&nbsp;<span class="ident" id="5779912">BenchmarkResult</span><span class="op" id="5779927">)</span>&nbsp;<span class="ident" id="5779929">NsPerOp</span><span class="op" id="5779936">(</span><span class="op" id="5779937">)</span>&nbsp;<span class="ident" id="5779939">int64</span>&nbsp;<span class="op" id="5779945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779948">if</span>&nbsp;<span class="ident" id="5779951">r</span><span class="op" id="5779952">.</span><span class="ident" id="5779953">N</span>&nbsp;<span class="op" id="5779955">&lt;=</span>&nbsp;<span class="num" id="5779958">0</span>&nbsp;<span class="op" id="5779960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779964">return</span>&nbsp;<span class="num" id="5779971">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5779974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5779977">return</span>&nbsp;<span class="ident" id="5779984">r</span><span class="op" id="5779985">.</span><span class="ident" id="5779986">T</span><span class="op" id="5779987">.</span><span class="ident" id="5779988">Nanoseconds</span><span class="op" id="5779999">(</span><span class="op" id="5780000">)</span>&nbsp;<span class="op" id="5780002">/</span>&nbsp;<span class="ident" id="5780004">int64</span><span class="op" id="5780009">(</span><span class="ident" id="5780010">r</span><span class="op" id="5780011">.</span><span class="ident" id="5780012">N</span><span class="op" id="5780013">)</span><br>
<span class="lineno">235</span><span class="op" id="5780015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5780018">func</span>&nbsp;<span class="op" id="5780023">(</span><span class="ident" id="5780024">r</span>&nbsp;<span class="ident" id="5780026">BenchmarkResult</span><span class="op" id="5780041">)</span>&nbsp;<span class="ident" id="5780043">mbPerSec</span><span class="op" id="5780051">(</span><span class="op" id="5780052">)</span>&nbsp;<span class="builtintype" id="5780054">float64</span>&nbsp;<span class="op" id="5780062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780065">if</span>&nbsp;<span class="ident" id="5780068">r</span><span class="op" id="5780069">.</span><span class="ident" id="5780070">Bytes</span>&nbsp;<span class="op" id="5780076">&lt;=</span>&nbsp;<span class="num" id="5780079">0</span>&nbsp;<span class="op" id="5780081">||</span>&nbsp;<span class="ident" id="5780084">r</span><span class="op" id="5780085">.</span><span class="ident" id="5780086">T</span>&nbsp;<span class="op" id="5780088">&lt;=</span>&nbsp;<span class="num" id="5780091">0</span>&nbsp;<span class="op" id="5780093">||</span>&nbsp;<span class="ident" id="5780096">r</span><span class="op" id="5780097">.</span><span class="ident" id="5780098">N</span>&nbsp;<span class="op" id="5780100">&lt;=</span>&nbsp;<span class="num" id="5780103">0</span>&nbsp;<span class="op" id="5780105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780109">return</span>&nbsp;<span class="num" id="5780116">0</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780122">return</span>&nbsp;<span class="op" id="5780129">(</span><span class="builtintype" id="5780130">float64</span><span class="op" id="5780137">(</span><span class="ident" id="5780138">r</span><span class="op" id="5780139">.</span><span class="ident" id="5780140">Bytes</span><span class="op" id="5780145">)</span>&nbsp;<span class="op" id="5780147">*</span>&nbsp;<span class="builtintype" id="5780149">float64</span><span class="op" id="5780156">(</span><span class="ident" id="5780157">r</span><span class="op" id="5780158">.</span><span class="ident" id="5780159">N</span><span class="op" id="5780160">)</span>&nbsp;<span class="op" id="5780162">/</span>&nbsp;<span class="num" id="5780164">1e6</span><span class="op" id="5780167">)</span>&nbsp;<span class="op" id="5780169">/</span>&nbsp;<span class="ident" id="5780171">r</span><span class="op" id="5780172">.</span><span class="ident" id="5780173">T</span><span class="op" id="5780174">.</span><span class="ident" id="5780175">Seconds</span><span class="op" id="5780182">(</span><span class="op" id="5780183">)</span><br>
<span class="lineno"></span><span class="op" id="5780185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5780188">func</span>&nbsp;<span class="op" id="5780193">(</span><span class="ident" id="5780194">r</span>&nbsp;<span class="ident" id="5780196">BenchmarkResult</span><span class="op" id="5780211">)</span>&nbsp;<span class="ident" id="5780213">AllocsPerOp</span><span class="op" id="5780224">(</span><span class="op" id="5780225">)</span>&nbsp;<span class="ident" id="5780227">int64</span>&nbsp;<span class="op" id="5780233">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780236">if</span>&nbsp;<span class="ident" id="5780239">r</span><span class="op" id="5780240">.</span><span class="ident" id="5780241">N</span>&nbsp;<span class="op" id="5780243">&lt;=</span>&nbsp;<span class="num" id="5780246">0</span>&nbsp;<span class="op" id="5780248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780252">return</span>&nbsp;<span class="num" id="5780259">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780265">return</span>&nbsp;<span class="ident" id="5780272">int64</span><span class="op" id="5780277">(</span><span class="ident" id="5780278">r</span><span class="op" id="5780279">.</span><span class="ident" id="5780280">MemAllocs</span><span class="op" id="5780289">)</span>&nbsp;<span class="op" id="5780291">/</span>&nbsp;<span class="ident" id="5780293">int64</span><span class="op" id="5780298">(</span><span class="ident" id="5780299">r</span><span class="op" id="5780300">.</span><span class="ident" id="5780301">N</span><span class="op" id="5780302">)</span><br>
<span class="lineno"></span><span class="op" id="5780304">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="5780307">func</span>&nbsp;<span class="op" id="5780312">(</span><span class="ident" id="5780313">r</span>&nbsp;<span class="ident" id="5780315">BenchmarkResult</span><span class="op" id="5780330">)</span>&nbsp;<span class="ident" id="5780332">AllocedBytesPerOp</span><span class="op" id="5780349">(</span><span class="op" id="5780350">)</span>&nbsp;<span class="ident" id="5780352">int64</span>&nbsp;<span class="op" id="5780358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780361">if</span>&nbsp;<span class="ident" id="5780364">r</span><span class="op" id="5780365">.</span><span class="ident" id="5780366">N</span>&nbsp;<span class="op" id="5780368">&lt;=</span>&nbsp;<span class="num" id="5780371">0</span>&nbsp;<span class="op" id="5780373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780377">return</span>&nbsp;<span class="num" id="5780384">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780387">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780390">return</span>&nbsp;<span class="ident" id="5780397">int64</span><span class="op" id="5780402">(</span><span class="ident" id="5780403">r</span><span class="op" id="5780404">.</span><span class="ident" id="5780405">MemBytes</span><span class="op" id="5780413">)</span>&nbsp;<span class="op" id="5780415">/</span>&nbsp;<span class="ident" id="5780417">int64</span><span class="op" id="5780422">(</span><span class="ident" id="5780423">r</span><span class="op" id="5780424">.</span><span class="ident" id="5780425">N</span><span class="op" id="5780426">)</span><br>
<span class="lineno"></span><span class="op" id="5780428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5780431">func</span>&nbsp;<span class="op" id="5780436">(</span><span class="ident" id="5780437">r</span>&nbsp;<span class="ident" id="5780439">BenchmarkResult</span><span class="op" id="5780454">)</span>&nbsp;<span class="ident" id="5780456">String</span><span class="op" id="5780462">(</span><span class="op" id="5780463">)</span>&nbsp;<span class="builtintype" id="5780465">string</span>&nbsp;<span class="op" id="5780472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780475">mbs</span>&nbsp;<span class="op" id="5780479">:=</span>&nbsp;<span class="ident" id="5780482">r</span><span class="op" id="5780483">.</span><span class="ident" id="5780484">mbPerSec</span><span class="op" id="5780492">(</span><span class="op" id="5780493">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780496">mb</span>&nbsp;<span class="op" id="5780499">:=</span>&nbsp;<span class="string" id="5780502">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780506">if</span>&nbsp;<span class="ident" id="5780509">mbs</span>&nbsp;<span class="op" id="5780513">!=</span>&nbsp;<span class="num" id="5780516">0</span>&nbsp;<span class="op" id="5780518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780522">mb</span>&nbsp;<span class="op" id="5780525">=</span>&nbsp;<span class="ident" id="5780527">fmt</span><span class="op" id="5780530">.</span><span class="ident" id="5780531">Sprintf</span><span class="op" id="5780538">(</span><span class="string" id="5780539">&#34;\t%7.2f&nbsp;MB/s&#34;</span><span class="op" id="5780553">,</span>&nbsp;<span class="ident" id="5780555">mbs</span><span class="op" id="5780558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780564">nsop</span>&nbsp;<span class="op" id="5780569">:=</span>&nbsp;<span class="ident" id="5780572">r</span><span class="op" id="5780573">.</span><span class="ident" id="5780574">NsPerOp</span><span class="op" id="5780581">(</span><span class="op" id="5780582">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780585">ns</span>&nbsp;<span class="op" id="5780588">:=</span>&nbsp;<span class="ident" id="5780591">fmt</span><span class="op" id="5780594">.</span><span class="ident" id="5780595">Sprintf</span><span class="op" id="5780602">(</span><span class="string" id="5780603">&#34;%10d&nbsp;ns/op&#34;</span><span class="op" id="5780615">,</span>&nbsp;<span class="ident" id="5780617">nsop</span><span class="op" id="5780621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780624">if</span>&nbsp;<span class="ident" id="5780627">r</span><span class="op" id="5780628">.</span><span class="ident" id="5780629">N</span>&nbsp;<span class="op" id="5780631">&gt;</span>&nbsp;<span class="num" id="5780633">0</span>&nbsp;<span class="op" id="5780635">&amp;&amp;</span>&nbsp;<span class="ident" id="5780638">nsop</span>&nbsp;<span class="op" id="5780643">&lt;</span>&nbsp;<span class="num" id="5780645">100</span>&nbsp;<span class="op" id="5780649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5780653">//&nbsp;The&nbsp;format&nbsp;specifiers&nbsp;here&nbsp;make&nbsp;sure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5780700">//&nbsp;the&nbsp;ones&nbsp;digits&nbsp;line&nbsp;up&nbsp;for&nbsp;all&nbsp;three&nbsp;possible&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780761">if</span>&nbsp;<span class="ident" id="5780764">nsop</span>&nbsp;<span class="op" id="5780769">&lt;</span>&nbsp;<span class="num" id="5780771">10</span>&nbsp;<span class="op" id="5780774">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780779">ns</span>&nbsp;<span class="op" id="5780782">=</span>&nbsp;<span class="ident" id="5780784">fmt</span><span class="op" id="5780787">.</span><span class="ident" id="5780788">Sprintf</span><span class="op" id="5780795">(</span><span class="string" id="5780796">&#34;%13.2f&nbsp;ns/op&#34;</span><span class="op" id="5780810">,</span>&nbsp;<span class="builtintype" id="5780812">float64</span><span class="op" id="5780819">(</span><span class="ident" id="5780820">r</span><span class="op" id="5780821">.</span><span class="ident" id="5780822">T</span><span class="op" id="5780823">.</span><span class="ident" id="5780824">Nanoseconds</span><span class="op" id="5780835">(</span><span class="op" id="5780836">)</span><span class="op" id="5780837">)</span><span class="op" id="5780838">/</span><span class="builtintype" id="5780839">float64</span><span class="op" id="5780846">(</span><span class="ident" id="5780847">r</span><span class="op" id="5780848">.</span><span class="ident" id="5780849">N</span><span class="op" id="5780850">)</span><span class="op" id="5780851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780855">}</span>&nbsp;<span class="keyword" id="5780857">else</span>&nbsp;<span class="op" id="5780862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780867">ns</span>&nbsp;<span class="op" id="5780870">=</span>&nbsp;<span class="ident" id="5780872">fmt</span><span class="op" id="5780875">.</span><span class="ident" id="5780876">Sprintf</span><span class="op" id="5780883">(</span><span class="string" id="5780884">&#34;%12.1f&nbsp;ns/op&#34;</span><span class="op" id="5780898">,</span>&nbsp;<span class="builtintype" id="5780900">float64</span><span class="op" id="5780907">(</span><span class="ident" id="5780908">r</span><span class="op" id="5780909">.</span><span class="ident" id="5780910">T</span><span class="op" id="5780911">.</span><span class="ident" id="5780912">Nanoseconds</span><span class="op" id="5780923">(</span><span class="op" id="5780924">)</span><span class="op" id="5780925">)</span><span class="op" id="5780926">/</span><span class="builtintype" id="5780927">float64</span><span class="op" id="5780934">(</span><span class="ident" id="5780935">r</span><span class="op" id="5780936">.</span><span class="ident" id="5780937">N</span><span class="op" id="5780938">)</span><span class="op" id="5780939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780946">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780949">return</span>&nbsp;<span class="ident" id="5780956">fmt</span><span class="op" id="5780959">.</span><span class="ident" id="5780960">Sprintf</span><span class="op" id="5780967">(</span><span class="string" id="5780968">&#34;%8d\t%s%s&#34;</span><span class="op" id="5780979">,</span>&nbsp;<span class="ident" id="5780981">r</span><span class="op" id="5780982">.</span><span class="ident" id="5780983">N</span><span class="op" id="5780984">,</span>&nbsp;<span class="ident" id="5780986">ns</span><span class="op" id="5780988">,</span>&nbsp;<span class="ident" id="5780990">mb</span><span class="op" id="5780992">)</span><br>
<span class="lineno"></span><span class="op" id="5780994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5780997">func</span>&nbsp;<span class="op" id="5781002">(</span><span class="ident" id="5781003">r</span>&nbsp;<span class="ident" id="5781005">BenchmarkResult</span><span class="op" id="5781020">)</span>&nbsp;<span class="ident" id="5781022">MemString</span><span class="op" id="5781031">(</span><span class="op" id="5781032">)</span>&nbsp;<span class="builtintype" id="5781034">string</span>&nbsp;<span class="op" id="5781041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781044">return</span>&nbsp;<span class="ident" id="5781051">fmt</span><span class="op" id="5781054">.</span><span class="ident" id="5781055">Sprintf</span><span class="op" id="5781062">(</span><span class="string" id="5781063">&#34;%8d&nbsp;B/op\t%8d&nbsp;allocs/op&#34;</span><span class="op" id="5781088">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781092">r</span><span class="op" id="5781093">.</span><span class="ident" id="5781094">AllocedBytesPerOp</span><span class="op" id="5781111">(</span><span class="op" id="5781112">)</span><span class="op" id="5781113">,</span>&nbsp;<span class="ident" id="5781115">r</span><span class="op" id="5781116">.</span><span class="ident" id="5781117">AllocsPerOp</span><span class="op" id="5781128">(</span><span class="op" id="5781129">)</span><span class="op" id="5781130">)</span><br>
<span class="lineno"></span><span class="op" id="5781132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5781135">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5781228">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno">285</span><span class="keyword" id="5781257">func</span>&nbsp;<span class="ident" id="5781262">RunBenchmarks</span><span class="op" id="5781275">(</span><span class="ident" id="5781276">matchString</span>&nbsp;<span class="keyword" id="5781288">func</span><span class="op" id="5781292">(</span><span class="ident" id="5781293">pat</span><span class="op" id="5781296">,</span>&nbsp;<span class="ident" id="5781298">str</span>&nbsp;<span class="builtintype" id="5781302">string</span><span class="op" id="5781308">)</span>&nbsp;<span class="op" id="5781310">(</span><span class="builtintype" id="5781311">bool</span><span class="op" id="5781315">,</span>&nbsp;<span class="builtintype" id="5781317">error</span><span class="op" id="5781322">)</span><span class="op" id="5781323">,</span>&nbsp;<span class="ident" id="5781325">benchmarks</span>&nbsp;<span class="op" id="5781336">[</span><span class="op" id="5781337">]</span><span class="ident" id="5781338">InternalBenchmark</span><span class="op" id="5781355">)</span>&nbsp;<span class="op" id="5781357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781360">//&nbsp;If&nbsp;no&nbsp;flag&nbsp;was&nbsp;specified,&nbsp;don&#39;t&nbsp;run&nbsp;benchmarks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781412">if</span>&nbsp;<span class="builtinfunc" id="5781415">len</span><span class="op" id="5781418">(</span><span class="op" id="5781419">*</span><span class="ident" id="5781420">matchBenchmarks</span><span class="op" id="5781435">)</span>&nbsp;<span class="op" id="5781437">==</span>&nbsp;<span class="num" id="5781440">0</span>&nbsp;<span class="op" id="5781442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781446">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781454">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781457">for</span>&nbsp;<span class="ident" id="5781461">_</span><span class="op" id="5781462">,</span>&nbsp;<span class="ident" id="5781464">Benchmark</span>&nbsp;<span class="op" id="5781474">:=</span>&nbsp;<span class="keyword" id="5781477">range</span>&nbsp;<span class="ident" id="5781483">benchmarks</span>&nbsp;<span class="op" id="5781494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781498">matched</span><span class="op" id="5781505">,</span>&nbsp;<span class="ident" id="5781507">err</span>&nbsp;<span class="op" id="5781511">:=</span>&nbsp;<span class="ident" id="5781514">matchString</span><span class="op" id="5781525">(</span><span class="op" id="5781526">*</span><span class="ident" id="5781527">matchBenchmarks</span><span class="op" id="5781542">,</span>&nbsp;<span class="ident" id="5781544">Benchmark</span><span class="op" id="5781553">.</span><span class="ident" id="5781554">Name</span><span class="op" id="5781558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781562">if</span>&nbsp;<span class="ident" id="5781565">err</span>&nbsp;<span class="op" id="5781569">!=</span>&nbsp;<span class="ident" id="5781572">nil</span>&nbsp;<span class="op" id="5781576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781581">fmt</span><span class="op" id="5781584">.</span><span class="ident" id="5781585">Fprintf</span><span class="op" id="5781592">(</span><span class="ident" id="5781593">os</span><span class="op" id="5781595">.</span><span class="ident" id="5781596">Stderr</span><span class="op" id="5781602">,</span>&nbsp;<span class="string" id="5781604">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.bench:&nbsp;%s\n&#34;</span><span class="op" id="5781651">,</span>&nbsp;<span class="ident" id="5781653">err</span><span class="op" id="5781656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781661">os</span><span class="op" id="5781663">.</span><span class="ident" id="5781664">Exit</span><span class="op" id="5781668">(</span><span class="num" id="5781669">1</span><span class="op" id="5781670">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781678">if</span>&nbsp;<span class="op" id="5781681">!</span><span class="ident" id="5781682">matched</span>&nbsp;<span class="op" id="5781690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781695">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781710">for</span>&nbsp;<span class="ident" id="5781714">_</span><span class="op" id="5781715">,</span>&nbsp;<span class="ident" id="5781717">procs</span>&nbsp;<span class="op" id="5781723">:=</span>&nbsp;<span class="keyword" id="5781726">range</span>&nbsp;<span class="ident" id="5781732">cpuList</span>&nbsp;<span class="op" id="5781740">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781745">runtime</span><span class="op" id="5781752">.</span><span class="ident" id="5781753">GOMAXPROCS</span><span class="op" id="5781763">(</span><span class="ident" id="5781764">procs</span><span class="op" id="5781769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781774">b</span>&nbsp;<span class="op" id="5781776">:=</span>&nbsp;<span class="op" id="5781779">&amp;</span><span class="ident" id="5781780">B</span><span class="op" id="5781781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781787">common</span><span class="op" id="5781793">:</span>&nbsp;<span class="ident" id="5781795">common</span><span class="op" id="5781801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781808">signal</span><span class="op" id="5781814">:</span>&nbsp;<span class="builtinfunc" id="5781816">make</span><span class="op" id="5781820">(</span><span class="keyword" id="5781821">chan</span>&nbsp;<span class="keyword" id="5781826">interface</span><span class="op" id="5781835">{</span><span class="op" id="5781836">}</span><span class="op" id="5781837">)</span><span class="op" id="5781838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781844">}</span><span class="op" id="5781845">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781851">benchmark</span><span class="op" id="5781860">:</span>&nbsp;<span class="ident" id="5781862">Benchmark</span><span class="op" id="5781871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781881">benchName</span>&nbsp;<span class="op" id="5781891">:=</span>&nbsp;<span class="ident" id="5781894">Benchmark</span><span class="op" id="5781903">.</span><span class="ident" id="5781904">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781912">if</span>&nbsp;<span class="ident" id="5781915">procs</span>&nbsp;<span class="op" id="5781921">!=</span>&nbsp;<span class="num" id="5781924">1</span>&nbsp;<span class="op" id="5781926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781932">benchName</span>&nbsp;<span class="op" id="5781942">=</span>&nbsp;<span class="ident" id="5781944">fmt</span><span class="op" id="5781947">.</span><span class="ident" id="5781948">Sprintf</span><span class="op" id="5781955">(</span><span class="string" id="5781956">&#34;%s-%d&#34;</span><span class="op" id="5781963">,</span>&nbsp;<span class="ident" id="5781965">Benchmark</span><span class="op" id="5781974">.</span><span class="ident" id="5781975">Name</span><span class="op" id="5781979">,</span>&nbsp;<span class="ident" id="5781981">procs</span><span class="op" id="5781986">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781996">fmt</span><span class="op" id="5781999">.</span><span class="ident" id="5782000">Printf</span><span class="op" id="5782006">(</span><span class="string" id="5782007">&#34;%s\t&#34;</span><span class="op" id="5782013">,</span>&nbsp;<span class="ident" id="5782015">benchName</span><span class="op" id="5782024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782029">r</span>&nbsp;<span class="op" id="5782031">:=</span>&nbsp;<span class="ident" id="5782034">b</span><span class="op" id="5782035">.</span><span class="ident" id="5782036">run</span><span class="op" id="5782039">(</span><span class="op" id="5782040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782045">if</span>&nbsp;<span class="ident" id="5782048">b</span><span class="op" id="5782049">.</span><span class="ident" id="5782050">failed</span>&nbsp;<span class="op" id="5782057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5782063">//&nbsp;The&nbsp;output&nbsp;could&nbsp;be&nbsp;very&nbsp;long&nbsp;here,&nbsp;but&nbsp;probably&nbsp;isn&#39;t.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5782126">//&nbsp;We&nbsp;print&nbsp;it&nbsp;all,&nbsp;regardless,&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;trim&nbsp;the&nbsp;reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5782203">//&nbsp;the&nbsp;benchmark&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782232">fmt</span><span class="op" id="5782235">.</span><span class="ident" id="5782236">Printf</span><span class="op" id="5782242">(</span><span class="string" id="5782243">&#34;---&nbsp;FAIL:&nbsp;%s\n%s&#34;</span><span class="op" id="5782261">,</span>&nbsp;<span class="ident" id="5782263">benchName</span><span class="op" id="5782272">,</span>&nbsp;<span class="ident" id="5782274">b</span><span class="op" id="5782275">.</span><span class="ident" id="5782276">output</span><span class="op" id="5782282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782288">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782300">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782305">results</span>&nbsp;<span class="op" id="5782313">:=</span>&nbsp;<span class="ident" id="5782316">r</span><span class="op" id="5782317">.</span><span class="ident" id="5782318">String</span><span class="op" id="5782324">(</span><span class="op" id="5782325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782330">if</span>&nbsp;<span class="op" id="5782333">*</span><span class="ident" id="5782334">benchmarkMemory</span>&nbsp;<span class="op" id="5782350">||</span>&nbsp;<span class="ident" id="5782353">b</span><span class="op" id="5782354">.</span><span class="ident" id="5782355">showAllocResult</span>&nbsp;<span class="op" id="5782371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782377">results</span>&nbsp;<span class="op" id="5782385">+=</span>&nbsp;<span class="string" id="5782388">&#34;\t&#34;</span>&nbsp;<span class="op" id="5782393">+</span>&nbsp;<span class="ident" id="5782395">r</span><span class="op" id="5782396">.</span><span class="ident" id="5782397">MemString</span><span class="op" id="5782406">(</span><span class="op" id="5782407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782417">fmt</span><span class="op" id="5782420">.</span><span class="ident" id="5782421">Println</span><span class="op" id="5782428">(</span><span class="ident" id="5782429">results</span><span class="op" id="5782436">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5782441">//&nbsp;Unlike&nbsp;with&nbsp;tests,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;-chatty&nbsp;flag&nbsp;and&nbsp;always&nbsp;print&nbsp;output&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5782521">//&nbsp;benchmarks&nbsp;since&nbsp;the&nbsp;output&nbsp;generation&nbsp;time&nbsp;will&nbsp;skew&nbsp;the&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782594">if</span>&nbsp;<span class="builtinfunc" id="5782597">len</span><span class="op" id="5782600">(</span><span class="ident" id="5782601">b</span><span class="op" id="5782602">.</span><span class="ident" id="5782603">output</span><span class="op" id="5782609">)</span>&nbsp;<span class="op" id="5782611">&gt;</span>&nbsp;<span class="num" id="5782613">0</span>&nbsp;<span class="op" id="5782615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782621">b</span><span class="op" id="5782622">.</span><span class="ident" id="5782623">trimOutput</span><span class="op" id="5782633">(</span><span class="op" id="5782634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782640">fmt</span><span class="op" id="5782643">.</span><span class="ident" id="5782644">Printf</span><span class="op" id="5782650">(</span><span class="string" id="5782651">&#34;---&nbsp;BENCH:&nbsp;%s\n%s&#34;</span><span class="op" id="5782670">,</span>&nbsp;<span class="ident" id="5782672">benchName</span><span class="op" id="5782681">,</span>&nbsp;<span class="ident" id="5782683">b</span><span class="op" id="5782684">.</span><span class="ident" id="5782685">output</span><span class="op" id="5782691">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782701">if</span>&nbsp;<span class="ident" id="5782704">p</span>&nbsp;<span class="op" id="5782706">:=</span>&nbsp;<span class="ident" id="5782709">runtime</span><span class="op" id="5782716">.</span><span class="ident" id="5782717">GOMAXPROCS</span><span class="op" id="5782727">(</span><span class="op" id="5782728">-</span><span class="num" id="5782729">1</span><span class="op" id="5782730">)</span><span class="op" id="5782731">;</span>&nbsp;<span class="ident" id="5782733">p</span>&nbsp;<span class="op" id="5782735">!=</span>&nbsp;<span class="ident" id="5782738">procs</span>&nbsp;<span class="op" id="5782744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782750">fmt</span><span class="op" id="5782753">.</span><span class="ident" id="5782754">Fprintf</span><span class="op" id="5782761">(</span><span class="ident" id="5782762">os</span><span class="op" id="5782764">.</span><span class="ident" id="5782765">Stderr</span><span class="op" id="5782771">,</span>&nbsp;<span class="string" id="5782773">&#34;testing:&nbsp;%s&nbsp;left&nbsp;GOMAXPROCS&nbsp;set&nbsp;to&nbsp;%d\n&#34;</span><span class="op" id="5782814">,</span>&nbsp;<span class="ident" id="5782816">benchName</span><span class="op" id="5782825">,</span>&nbsp;<span class="ident" id="5782827">p</span><span class="op" id="5782828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782837">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782840">}</span><br>
<span class="lineno"></span><span class="op" id="5782842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5782845">//&nbsp;trimOutput&nbsp;shortens&nbsp;the&nbsp;output&nbsp;from&nbsp;a&nbsp;benchmark,&nbsp;which&nbsp;can&nbsp;be&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="5782921">func</span>&nbsp;<span class="op" id="5782926">(</span><span class="ident" id="5782927">b</span>&nbsp;<span class="op" id="5782929">*</span><span class="ident" id="5782930">B</span><span class="op" id="5782931">)</span>&nbsp;<span class="ident" id="5782933">trimOutput</span><span class="op" id="5782943">(</span><span class="op" id="5782944">)</span>&nbsp;<span class="op" id="5782946">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5782949">//&nbsp;The&nbsp;output&nbsp;is&nbsp;likely&nbsp;to&nbsp;appear&nbsp;multiple&nbsp;times&nbsp;because&nbsp;the&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5783021">//&nbsp;is&nbsp;run&nbsp;multiple&nbsp;times,&nbsp;but&nbsp;at&nbsp;least&nbsp;it&nbsp;will&nbsp;be&nbsp;seen.&nbsp;This&nbsp;is&nbsp;not&nbsp;a&nbsp;big&nbsp;deal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5783101">//&nbsp;because&nbsp;benchmarks&nbsp;rarely&nbsp;print,&nbsp;but&nbsp;just&nbsp;in&nbsp;case,&nbsp;we&nbsp;trim&nbsp;it&nbsp;if&nbsp;it&#39;s&nbsp;too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783185">const</span>&nbsp;<span class="ident" id="5783191">maxNewlines</span>&nbsp;<span class="op" id="5783203">=</span>&nbsp;<span class="num" id="5783205">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783209">for</span>&nbsp;<span class="ident" id="5783213">nlCount</span><span class="op" id="5783220">,</span>&nbsp;<span class="ident" id="5783222">j</span>&nbsp;<span class="op" id="5783224">:=</span>&nbsp;<span class="num" id="5783227">0</span><span class="op" id="5783228">,</span>&nbsp;<span class="num" id="5783230">0</span><span class="op" id="5783231">;</span>&nbsp;<span class="ident" id="5783233">j</span>&nbsp;<span class="op" id="5783235">&lt;</span>&nbsp;<span class="builtinfunc" id="5783237">len</span><span class="op" id="5783240">(</span><span class="ident" id="5783241">b</span><span class="op" id="5783242">.</span><span class="ident" id="5783243">output</span><span class="op" id="5783249">)</span><span class="op" id="5783250">;</span>&nbsp;<span class="ident" id="5783252">j</span><span class="op" id="5783253">++</span>&nbsp;<span class="op" id="5783256">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783260">if</span>&nbsp;<span class="ident" id="5783263">b</span><span class="op" id="5783264">.</span><span class="ident" id="5783265">output</span><span class="op" id="5783271">[</span><span class="ident" id="5783272">j</span><span class="op" id="5783273">]</span>&nbsp;<span class="op" id="5783275">==</span>&nbsp;<span class="string" id="5783278">&#39;\n&#39;</span>&nbsp;<span class="op" id="5783283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783288">nlCount</span><span class="op" id="5783295">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783301">if</span>&nbsp;<span class="ident" id="5783304">nlCount</span>&nbsp;<span class="op" id="5783312">&gt;=</span>&nbsp;<span class="ident" id="5783315">maxNewlines</span>&nbsp;<span class="op" id="5783327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783333">b</span><span class="op" id="5783334">.</span><span class="ident" id="5783335">output</span>&nbsp;<span class="op" id="5783342">=</span>&nbsp;<span class="builtinfunc" id="5783344">append</span><span class="op" id="5783350">(</span><span class="ident" id="5783351">b</span><span class="op" id="5783352">.</span><span class="ident" id="5783353">output</span><span class="op" id="5783359">[</span><span class="op" id="5783360">:</span><span class="ident" id="5783361">j</span><span class="op" id="5783362">]</span><span class="op" id="5783363">,</span>&nbsp;<span class="string" id="5783365">&#34;\n\t...&nbsp;[output&nbsp;truncated]\n&#34;</span><span class="op" id="5783395">...</span><span class="op" id="5783398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783404">break</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783420">}</span><br>
<span class="lineno"></span><span class="op" id="5783422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="5783425">//&nbsp;A&nbsp;PB&nbsp;is&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;for&nbsp;running&nbsp;parallel&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="keyword" id="5783489">type</span>&nbsp;<span class="ident" id="5783494">PB</span>&nbsp;<span class="keyword" id="5783497">struct</span>&nbsp;<span class="op" id="5783504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783507">globalN</span>&nbsp;<span class="op" id="5783515">*</span><span class="ident" id="5783516">uint64</span>&nbsp;<span class="comment" id="5783523">//&nbsp;shared&nbsp;between&nbsp;all&nbsp;worker&nbsp;goroutines&nbsp;iteration&nbsp;counter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783582">grain</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5783590">uint64</span>&nbsp;&nbsp;<span class="comment" id="5783598">//&nbsp;acquire&nbsp;that&nbsp;many&nbsp;iterations&nbsp;from&nbsp;globalN&nbsp;at&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783652">cache</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5783660">uint64</span>&nbsp;&nbsp;<span class="comment" id="5783668">//&nbsp;local&nbsp;cache&nbsp;of&nbsp;acquired&nbsp;iterations</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783707">bN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5783715">uint64</span>&nbsp;&nbsp;<span class="comment" id="5783723">//&nbsp;total&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;execute&nbsp;(b.N)</span><br>
<span class="lineno"></span><span class="op" id="5783770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5783773">//&nbsp;Next&nbsp;reports&nbsp;whether&nbsp;there&nbsp;are&nbsp;more&nbsp;iterations&nbsp;to&nbsp;execute.</span><br>
<span class="lineno"></span><span class="keyword" id="5783835">func</span>&nbsp;<span class="op" id="5783840">(</span><span class="ident" id="5783841">pb</span>&nbsp;<span class="op" id="5783844">*</span><span class="ident" id="5783845">PB</span><span class="op" id="5783847">)</span>&nbsp;<span class="ident" id="5783849">Next</span><span class="op" id="5783853">(</span><span class="op" id="5783854">)</span>&nbsp;<span class="builtintype" id="5783856">bool</span>&nbsp;<span class="op" id="5783861">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783864">if</span>&nbsp;<span class="ident" id="5783867">pb</span><span class="op" id="5783869">.</span><span class="ident" id="5783870">cache</span>&nbsp;<span class="op" id="5783876">==</span>&nbsp;<span class="num" id="5783879">0</span>&nbsp;<span class="op" id="5783881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783885">n</span>&nbsp;<span class="op" id="5783887">:=</span>&nbsp;<span class="ident" id="5783890">atomic</span><span class="op" id="5783896">.</span><span class="ident" id="5783897">AddUint64</span><span class="op" id="5783906">(</span><span class="ident" id="5783907">pb</span><span class="op" id="5783909">.</span><span class="ident" id="5783910">globalN</span><span class="op" id="5783917">,</span>&nbsp;<span class="ident" id="5783919">pb</span><span class="op" id="5783921">.</span><span class="ident" id="5783922">grain</span><span class="op" id="5783927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783931">if</span>&nbsp;<span class="ident" id="5783934">n</span>&nbsp;<span class="op" id="5783936">&lt;=</span>&nbsp;<span class="ident" id="5783939">pb</span><span class="op" id="5783941">.</span><span class="ident" id="5783942">bN</span>&nbsp;<span class="op" id="5783945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783950">pb</span><span class="op" id="5783952">.</span><span class="ident" id="5783953">cache</span>&nbsp;<span class="op" id="5783959">=</span>&nbsp;<span class="ident" id="5783961">pb</span><span class="op" id="5783963">.</span><span class="ident" id="5783964">grain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783972">}</span>&nbsp;<span class="keyword" id="5783974">else</span>&nbsp;<span class="keyword" id="5783979">if</span>&nbsp;<span class="ident" id="5783982">n</span>&nbsp;<span class="op" id="5783984">&lt;</span>&nbsp;<span class="ident" id="5783986">pb</span><span class="op" id="5783988">.</span><span class="ident" id="5783989">bN</span><span class="op" id="5783991">+</span><span class="ident" id="5783992">pb</span><span class="op" id="5783994">.</span><span class="ident" id="5783995">grain</span>&nbsp;<span class="op" id="5784001">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784006">pb</span><span class="op" id="5784008">.</span><span class="ident" id="5784009">cache</span>&nbsp;<span class="op" id="5784015">=</span>&nbsp;<span class="ident" id="5784017">pb</span><span class="op" id="5784019">.</span><span class="ident" id="5784020">bN</span>&nbsp;<span class="op" id="5784023">+</span>&nbsp;<span class="ident" id="5784025">pb</span><span class="op" id="5784027">.</span><span class="ident" id="5784028">grain</span>&nbsp;<span class="op" id="5784034">-</span>&nbsp;<span class="ident" id="5784036">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784040">}</span>&nbsp;<span class="keyword" id="5784042">else</span>&nbsp;<span class="op" id="5784047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784052">return</span>&nbsp;<span class="builtintype" id="5784059">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784070">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784073">pb</span><span class="op" id="5784075">.</span><span class="ident" id="5784076">cache</span><span class="op" id="5784081">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784085">return</span>&nbsp;<span class="builtintype" id="5784092">true</span><br>
<span class="lineno"></span><span class="op" id="5784097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5784100">//&nbsp;RunParallel&nbsp;runs&nbsp;a&nbsp;benchmark&nbsp;in&nbsp;parallel.</span><br>
<span class="lineno">380</span><span class="comment" id="5784145">//&nbsp;It&nbsp;creates&nbsp;multiple&nbsp;goroutines&nbsp;and&nbsp;distributes&nbsp;b.N&nbsp;iterations&nbsp;among&nbsp;them.</span><br>
<span class="lineno"></span><span class="comment" id="5784222">//&nbsp;The&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;defaults&nbsp;to&nbsp;GOMAXPROCS.&nbsp;To&nbsp;increase&nbsp;parallelism&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5784302">//&nbsp;non-CPU-bound&nbsp;benchmarks,&nbsp;call&nbsp;SetParallelism&nbsp;before&nbsp;RunParallel.</span><br>
<span class="lineno"></span><span class="comment" id="5784371">//&nbsp;RunParallel&nbsp;is&nbsp;usually&nbsp;used&nbsp;with&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="5784430">//</span><br>
<span class="lineno">385</span><span class="comment" id="5784433">//&nbsp;The&nbsp;body&nbsp;function&nbsp;will&nbsp;be&nbsp;run&nbsp;in&nbsp;each&nbsp;goroutine.&nbsp;It&nbsp;should&nbsp;set&nbsp;up&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5784506">//&nbsp;goroutine-local&nbsp;state&nbsp;and&nbsp;then&nbsp;iterate&nbsp;until&nbsp;pb.Next&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5784577">//&nbsp;It&nbsp;should&nbsp;not&nbsp;use&nbsp;the&nbsp;StartTimer,&nbsp;StopTimer,&nbsp;or&nbsp;ResetTimer&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="5784650">//&nbsp;because&nbsp;they&nbsp;have&nbsp;global&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="5784686">func</span>&nbsp;<span class="op" id="5784691">(</span><span class="ident" id="5784692">b</span>&nbsp;<span class="op" id="5784694">*</span><span class="ident" id="5784695">B</span><span class="op" id="5784696">)</span>&nbsp;<span class="ident" id="5784698">RunParallel</span><span class="op" id="5784709">(</span><span class="ident" id="5784710">body</span>&nbsp;<span class="keyword" id="5784715">func</span><span class="op" id="5784719">(</span><span class="op" id="5784720">*</span><span class="ident" id="5784721">PB</span><span class="op" id="5784723">)</span><span class="op" id="5784724">)</span>&nbsp;<span class="op" id="5784726">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5784729">//&nbsp;Calculate&nbsp;grain&nbsp;size&nbsp;as&nbsp;number&nbsp;of&nbsp;iterations&nbsp;that&nbsp;take&nbsp;~100s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5784797">//&nbsp;100s&nbsp;is&nbsp;enough&nbsp;to&nbsp;amortize&nbsp;the&nbsp;overhead&nbsp;and&nbsp;provide&nbsp;sufficient</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5784866">//&nbsp;dynamic&nbsp;load&nbsp;balancing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784894">grain</span>&nbsp;<span class="op" id="5784900">:=</span>&nbsp;<span class="ident" id="5784903">uint64</span><span class="op" id="5784909">(</span><span class="num" id="5784910">0</span><span class="op" id="5784911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784914">if</span>&nbsp;<span class="ident" id="5784917">b</span><span class="op" id="5784918">.</span><span class="ident" id="5784919">previousN</span>&nbsp;<span class="op" id="5784929">&gt;</span>&nbsp;<span class="num" id="5784931">0</span>&nbsp;<span class="op" id="5784933">&amp;&amp;</span>&nbsp;<span class="ident" id="5784936">b</span><span class="op" id="5784937">.</span><span class="ident" id="5784938">previousDuration</span>&nbsp;<span class="op" id="5784955">&gt;</span>&nbsp;<span class="num" id="5784957">0</span>&nbsp;<span class="op" id="5784959">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784963">grain</span>&nbsp;<span class="op" id="5784969">=</span>&nbsp;<span class="num" id="5784971">1e5</span>&nbsp;<span class="op" id="5784975">*</span>&nbsp;<span class="ident" id="5784977">uint64</span><span class="op" id="5784983">(</span><span class="ident" id="5784984">b</span><span class="op" id="5784985">.</span><span class="ident" id="5784986">previousN</span><span class="op" id="5784995">)</span>&nbsp;<span class="op" id="5784997">/</span>&nbsp;<span class="ident" id="5784999">uint64</span><span class="op" id="5785005">(</span><span class="ident" id="5785006">b</span><span class="op" id="5785007">.</span><span class="ident" id="5785008">previousDuration</span><span class="op" id="5785024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785030">if</span>&nbsp;<span class="ident" id="5785033">grain</span>&nbsp;<span class="op" id="5785039">&lt;</span>&nbsp;<span class="num" id="5785041">1</span>&nbsp;<span class="op" id="5785043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785047">grain</span>&nbsp;<span class="op" id="5785053">=</span>&nbsp;<span class="num" id="5785055">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785058">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5785061">//&nbsp;We&nbsp;expect&nbsp;the&nbsp;inner&nbsp;loop&nbsp;and&nbsp;function&nbsp;call&nbsp;to&nbsp;take&nbsp;at&nbsp;least&nbsp;10ns,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5785131">//&nbsp;so&nbsp;do&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;100s/10ns=1e4&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785186">if</span>&nbsp;<span class="ident" id="5785189">grain</span>&nbsp;<span class="op" id="5785195">&gt;</span>&nbsp;<span class="num" id="5785197">1e4</span>&nbsp;<span class="op" id="5785201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785205">grain</span>&nbsp;<span class="op" id="5785211">=</span>&nbsp;<span class="num" id="5785213">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785218">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785222">n</span>&nbsp;<span class="op" id="5785224">:=</span>&nbsp;<span class="ident" id="5785227">uint64</span><span class="op" id="5785233">(</span><span class="num" id="5785234">0</span><span class="op" id="5785235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785238">numProcs</span>&nbsp;<span class="op" id="5785247">:=</span>&nbsp;<span class="ident" id="5785250">b</span><span class="op" id="5785251">.</span><span class="ident" id="5785252">parallelism</span>&nbsp;<span class="op" id="5785264">*</span>&nbsp;<span class="ident" id="5785266">runtime</span><span class="op" id="5785273">.</span><span class="ident" id="5785274">GOMAXPROCS</span><span class="op" id="5785284">(</span><span class="num" id="5785285">0</span><span class="op" id="5785286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785289">var</span>&nbsp;<span class="ident" id="5785293">wg</span>&nbsp;<span class="ident" id="5785296">sync</span><span class="op" id="5785300">.</span><span class="ident" id="5785301">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785312">wg</span><span class="op" id="5785314">.</span><span class="ident" id="5785315">Add</span><span class="op" id="5785318">(</span><span class="ident" id="5785319">numProcs</span><span class="op" id="5785327">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785330">for</span>&nbsp;<span class="ident" id="5785334">p</span>&nbsp;<span class="op" id="5785336">:=</span>&nbsp;<span class="num" id="5785339">0</span><span class="op" id="5785340">;</span>&nbsp;<span class="ident" id="5785342">p</span>&nbsp;<span class="op" id="5785344">&lt;</span>&nbsp;<span class="ident" id="5785346">numProcs</span><span class="op" id="5785354">;</span>&nbsp;<span class="ident" id="5785356">p</span><span class="op" id="5785357">++</span>&nbsp;<span class="op" id="5785360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785364">go</span>&nbsp;<span class="keyword" id="5785367">func</span><span class="op" id="5785371">(</span><span class="op" id="5785372">)</span>&nbsp;<span class="op" id="5785374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785379">defer</span>&nbsp;<span class="ident" id="5785385">wg</span><span class="op" id="5785387">.</span><span class="ident" id="5785388">Done</span><span class="op" id="5785392">(</span><span class="op" id="5785393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785398">pb</span>&nbsp;<span class="op" id="5785401">:=</span>&nbsp;<span class="op" id="5785404">&amp;</span><span class="ident" id="5785405">PB</span><span class="op" id="5785407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785413">globalN</span><span class="op" id="5785420">:</span>&nbsp;<span class="op" id="5785422">&amp;</span><span class="ident" id="5785423">n</span><span class="op" id="5785424">,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785430">grain</span><span class="op" id="5785435">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5785439">grain</span><span class="op" id="5785444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785450">bN</span><span class="op" id="5785452">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5785459">uint64</span><span class="op" id="5785465">(</span><span class="ident" id="5785466">b</span><span class="op" id="5785467">.</span><span class="ident" id="5785468">N</span><span class="op" id="5785469">)</span><span class="op" id="5785470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785480">body</span><span class="op" id="5785484">(</span><span class="ident" id="5785485">pb</span><span class="op" id="5785487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785491">}</span><span class="op" id="5785492">(</span><span class="op" id="5785493">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785499">wg</span><span class="op" id="5785501">.</span><span class="ident" id="5785502">Wait</span><span class="op" id="5785506">(</span><span class="op" id="5785507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785510">if</span>&nbsp;<span class="ident" id="5785513">n</span>&nbsp;<span class="op" id="5785515">&lt;=</span>&nbsp;<span class="ident" id="5785518">uint64</span><span class="op" id="5785524">(</span><span class="ident" id="5785525">b</span><span class="op" id="5785526">.</span><span class="ident" id="5785527">N</span><span class="op" id="5785528">)</span>&nbsp;<span class="op" id="5785530">&amp;&amp;</span>&nbsp;<span class="op" id="5785533">!</span><span class="ident" id="5785534">b</span><span class="op" id="5785535">.</span><span class="ident" id="5785536">Failed</span><span class="op" id="5785542">(</span><span class="op" id="5785543">)</span>&nbsp;<span class="op" id="5785545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785549">b</span><span class="op" id="5785550">.</span><span class="ident" id="5785551">Fatal</span><span class="op" id="5785556">(</span><span class="string" id="5785557">&#34;RunParallel:&nbsp;body&nbsp;exited&nbsp;without&nbsp;pb.Next()&nbsp;==&nbsp;false&#34;</span><span class="op" id="5785610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785613">}</span><br>
<span class="lineno">425</span><span class="op" id="5785615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5785618">//&nbsp;SetParallelism&nbsp;sets&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;to&nbsp;p*GOMAXPROCS.</span><br>
<span class="lineno"></span><span class="comment" id="5785703">//&nbsp;There&nbsp;is&nbsp;usually&nbsp;no&nbsp;need&nbsp;to&nbsp;call&nbsp;SetParallelism&nbsp;for&nbsp;CPU-bound&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="comment" id="5785780">//&nbsp;If&nbsp;p&nbsp;is&nbsp;less&nbsp;than&nbsp;1,&nbsp;this&nbsp;call&nbsp;will&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">430</span><span class="keyword" id="5785835">func</span>&nbsp;<span class="op" id="5785840">(</span><span class="ident" id="5785841">b</span>&nbsp;<span class="op" id="5785843">*</span><span class="ident" id="5785844">B</span><span class="op" id="5785845">)</span>&nbsp;<span class="ident" id="5785847">SetParallelism</span><span class="op" id="5785861">(</span><span class="ident" id="5785862">p</span>&nbsp;<span class="builtintype" id="5785864">int</span><span class="op" id="5785867">)</span>&nbsp;<span class="op" id="5785869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785872">if</span>&nbsp;<span class="ident" id="5785875">p</span>&nbsp;<span class="op" id="5785877">&gt;=</span>&nbsp;<span class="num" id="5785880">1</span>&nbsp;<span class="op" id="5785882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785886">b</span><span class="op" id="5785887">.</span><span class="ident" id="5785888">parallelism</span>&nbsp;<span class="op" id="5785900">=</span>&nbsp;<span class="ident" id="5785902">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785905">}</span><br>
<span class="lineno"></span><span class="op" id="5785907">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="5785910">//&nbsp;Benchmark&nbsp;benchmarks&nbsp;a&nbsp;single&nbsp;function.&nbsp;Useful&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span><span class="comment" id="5785973">//&nbsp;custom&nbsp;benchmarks&nbsp;that&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5786033">func</span>&nbsp;<span class="ident" id="5786038">Benchmark</span><span class="op" id="5786047">(</span><span class="ident" id="5786048">f</span>&nbsp;<span class="keyword" id="5786050">func</span><span class="op" id="5786054">(</span><span class="ident" id="5786055">b</span>&nbsp;<span class="op" id="5786057">*</span><span class="ident" id="5786058">B</span><span class="op" id="5786059">)</span><span class="op" id="5786060">)</span>&nbsp;<span class="ident" id="5786062">BenchmarkResult</span>&nbsp;<span class="op" id="5786078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786081">b</span>&nbsp;<span class="op" id="5786083">:=</span>&nbsp;<span class="op" id="5786086">&amp;</span><span class="ident" id="5786087">B</span><span class="op" id="5786088">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786092">common</span><span class="op" id="5786098">:</span>&nbsp;<span class="ident" id="5786100">common</span><span class="op" id="5786106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786111">signal</span><span class="op" id="5786117">:</span>&nbsp;<span class="builtinfunc" id="5786119">make</span><span class="op" id="5786123">(</span><span class="keyword" id="5786124">chan</span>&nbsp;<span class="keyword" id="5786129">interface</span><span class="op" id="5786138">{</span><span class="op" id="5786139">}</span><span class="op" id="5786140">)</span><span class="op" id="5786141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5786145">}</span><span class="op" id="5786146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786150">benchmark</span><span class="op" id="5786159">:</span>&nbsp;<span class="ident" id="5786161">InternalBenchmark</span><span class="op" id="5786178">{</span><span class="string" id="5786179">&#34;&#34;</span><span class="op" id="5786181">,</span>&nbsp;<span class="ident" id="5786183">f</span><span class="op" id="5786184">}</span><span class="op" id="5786185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5786188">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5786191">return</span>&nbsp;<span class="ident" id="5786198">b</span><span class="op" id="5786199">.</span><span class="ident" id="5786200">run</span><span class="op" id="5786203">(</span><span class="op" id="5786204">)</span><br>
<span class="lineno"></span><span class="op" id="5786206">}</span>
</div>
</body>
</html>
