<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2542293">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2542348">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2542402">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2542453">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2542523">//&nbsp;Parse&nbsp;&#34;zoneinfo&#34;&nbsp;time&nbsp;zone&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2542559">//&nbsp;This&nbsp;is&nbsp;a&nbsp;fairly&nbsp;standard&nbsp;file&nbsp;format&nbsp;used&nbsp;on&nbsp;OS&nbsp;X,&nbsp;Linux,&nbsp;BSD,&nbsp;Sun,&nbsp;and&nbsp;others.</span><br>
<span class="lineno"></span><span class="comment" id="2542643">//&nbsp;See&nbsp;tzfile(5),&nbsp;http://en.wikipedia.org/wiki/Zoneinfo,</span><br>
<span class="lineno">10</span><span class="comment" id="2542700">//&nbsp;and&nbsp;ftp://munnari.oz.au/pub/oldtz/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2542739">package</span>&nbsp;<span class="ident" id="2542747">time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2542753">import</span>&nbsp;<span class="op" id="2542760">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2542763">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2542773">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2542784">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2542794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="2542797">func</span>&nbsp;<span class="ident" id="2542802">initTestingZone</span><span class="op" id="2542817">(</span><span class="op" id="2542818">)</span>&nbsp;<span class="op" id="2542820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2542823">z</span><span class="op" id="2542824">,</span>&nbsp;<span class="ident" id="2542826">err</span>&nbsp;<span class="op" id="2542830">:=</span>&nbsp;<span class="ident" id="2542833">loadZoneFile</span><span class="op" id="2542845">(</span><span class="ident" id="2542846">runtime</span><span class="op" id="2542853">.</span><span class="ident" id="2542854">GOROOT</span><span class="op" id="2542860">(</span><span class="op" id="2542861">)</span><span class="op" id="2542862">+</span><span class="string" id="2542863">&#34;/lib/time/zoneinfo.zip&#34;</span><span class="op" id="2542887">,</span>&nbsp;<span class="string" id="2542889">&#34;America/Los_Angeles&#34;</span><span class="op" id="2542910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2542913">if</span>&nbsp;<span class="ident" id="2542916">err</span>&nbsp;<span class="op" id="2542920">!=</span>&nbsp;<span class="ident" id="2542923">nil</span>&nbsp;<span class="op" id="2542927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2542931">panic</span><span class="op" id="2542936">(</span><span class="string" id="2542937">&#34;cannot&nbsp;load&nbsp;America/Los_Angeles&nbsp;for&nbsp;testing:&nbsp;&#34;</span>&nbsp;<span class="op" id="2542985">+</span>&nbsp;<span class="ident" id="2542987">err</span><span class="op" id="2542990">.</span><span class="ident" id="2542991">Error</span><span class="op" id="2542996">(</span><span class="op" id="2542997">)</span><span class="op" id="2542998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2543001">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2543004">z</span><span class="op" id="2543005">.</span><span class="ident" id="2543006">name</span>&nbsp;<span class="op" id="2543011">=</span>&nbsp;<span class="string" id="2543013">&#34;Local&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2543022">localLoc</span>&nbsp;<span class="op" id="2543031">=</span>&nbsp;<span class="op" id="2543033">*</span><span class="ident" id="2543034">z</span><br>
<span class="lineno"></span><span class="op" id="2543036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2543039">//&nbsp;Many&nbsp;systems&nbsp;use&nbsp;/usr/share/zoneinfo,&nbsp;Solaris&nbsp;2&nbsp;has</span><br>
<span class="lineno">30</span><span class="comment" id="2543094">//&nbsp;/usr/share/lib/zoneinfo,&nbsp;IRIX&nbsp;6&nbsp;has&nbsp;/usr/lib/locale/TZ.</span><br>
<span class="lineno"></span><span class="keyword" id="2543153">var</span>&nbsp;<span class="ident" id="2543157">zoneDirs</span>&nbsp;<span class="op" id="2543166">=</span>&nbsp;<span class="op" id="2543168">[</span><span class="op" id="2543169">]</span><span class="builtintype" id="2543170">string</span><span class="op" id="2543176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2543179">&#34;/usr/share/zoneinfo/&#34;</span><span class="op" id="2543201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2543204">&#34;/usr/share/lib/zoneinfo/&#34;</span><span class="op" id="2543230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2543233">&#34;/usr/lib/locale/TZ/&#34;</span><span class="op" id="2543254">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2543257">runtime</span><span class="op" id="2543264">.</span><span class="ident" id="2543265">GOROOT</span><span class="op" id="2543271">(</span><span class="op" id="2543272">)</span>&nbsp;<span class="op" id="2543274">+</span>&nbsp;<span class="string" id="2543276">&#34;/lib/time/zoneinfo.zip&#34;</span><span class="op" id="2543300">,</span><br>
<span class="lineno"></span><span class="op" id="2543302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2543305">var</span>&nbsp;<span class="ident" id="2543309">origZoneDirs</span>&nbsp;<span class="op" id="2543322">=</span>&nbsp;<span class="ident" id="2543324">zoneDirs</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2543334">func</span>&nbsp;<span class="ident" id="2543339">forceZipFileForTesting</span><span class="op" id="2543361">(</span><span class="ident" id="2543362">zipOnly</span>&nbsp;<span class="builtintype" id="2543370">bool</span><span class="op" id="2543374">)</span>&nbsp;<span class="op" id="2543376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2543379">zoneDirs</span>&nbsp;<span class="op" id="2543388">=</span>&nbsp;<span class="builtinfunc" id="2543390">make</span><span class="op" id="2543394">(</span><span class="op" id="2543395">[</span><span class="op" id="2543396">]</span><span class="builtintype" id="2543397">string</span><span class="op" id="2543403">,</span>&nbsp;<span class="builtinfunc" id="2543405">len</span><span class="op" id="2543408">(</span><span class="ident" id="2543409">origZoneDirs</span><span class="op" id="2543421">)</span><span class="op" id="2543422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2543425">copy</span><span class="op" id="2543429">(</span><span class="ident" id="2543430">zoneDirs</span><span class="op" id="2543438">,</span>&nbsp;<span class="ident" id="2543440">origZoneDirs</span><span class="op" id="2543452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2543455">if</span>&nbsp;<span class="ident" id="2543458">zipOnly</span>&nbsp;<span class="op" id="2543466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2543470">for</span>&nbsp;<span class="ident" id="2543474">i</span>&nbsp;<span class="op" id="2543476">:=</span>&nbsp;<span class="num" id="2543479">0</span><span class="op" id="2543480">;</span>&nbsp;<span class="ident" id="2543482">i</span>&nbsp;<span class="op" id="2543484">&lt;</span>&nbsp;<span class="builtinfunc" id="2543486">len</span><span class="op" id="2543489">(</span><span class="ident" id="2543490">zoneDirs</span><span class="op" id="2543498">)</span><span class="op" id="2543499">-</span><span class="num" id="2543500">1</span><span class="op" id="2543501">;</span>&nbsp;<span class="ident" id="2543503">i</span><span class="op" id="2543504">++</span>&nbsp;<span class="op" id="2543507">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2543512">zoneDirs</span><span class="op" id="2543520">[</span><span class="ident" id="2543521">i</span><span class="op" id="2543522">]</span>&nbsp;<span class="op" id="2543524">=</span>&nbsp;<span class="string" id="2543526">&#34;/XXXNOEXIST&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2543542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2543545">}</span><br>
<span class="lineno"></span><span class="op" id="2543547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="2543550">func</span>&nbsp;<span class="ident" id="2543555">initLocal</span><span class="op" id="2543564">(</span><span class="op" id="2543565">)</span>&nbsp;<span class="op" id="2543567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2543570">//&nbsp;consult&nbsp;$TZ&nbsp;to&nbsp;find&nbsp;the&nbsp;time&nbsp;zone&nbsp;to&nbsp;use.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2543616">//&nbsp;no&nbsp;$TZ&nbsp;means&nbsp;use&nbsp;the&nbsp;system&nbsp;default&nbsp;/etc/localtime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2543672">//&nbsp;$TZ=&#34;&#34;&nbsp;means&nbsp;use&nbsp;UTC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2543698">//&nbsp;$TZ=&#34;foo&#34;&nbsp;means&nbsp;use&nbsp;/usr/share/zoneinfo/foo.</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2543748">tz</span><span class="op" id="2543750">,</span>&nbsp;<span class="ident" id="2543752">ok</span>&nbsp;<span class="op" id="2543755">:=</span>&nbsp;<span class="ident" id="2543758">syscall</span><span class="op" id="2543765">.</span><span class="ident" id="2543766">Getenv</span><span class="op" id="2543772">(</span><span class="string" id="2543773">&#34;TZ&#34;</span><span class="op" id="2543777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2543780">switch</span>&nbsp;<span class="op" id="2543787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2543790">case</span>&nbsp;<span class="op" id="2543795">!</span><span class="ident" id="2543796">ok</span><span class="op" id="2543798">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2543802">z</span><span class="op" id="2543803">,</span>&nbsp;<span class="ident" id="2543805">err</span>&nbsp;<span class="op" id="2543809">:=</span>&nbsp;<span class="ident" id="2543812">loadZoneFile</span><span class="op" id="2543824">(</span><span class="string" id="2543825">&#34;&#34;</span><span class="op" id="2543827">,</span>&nbsp;<span class="string" id="2543829">&#34;/etc/localtime&#34;</span><span class="op" id="2543845">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2543849">if</span>&nbsp;<span class="ident" id="2543852">err</span>&nbsp;<span class="op" id="2543856">==</span>&nbsp;<span class="ident" id="2543859">nil</span>&nbsp;<span class="op" id="2543863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2543868">localLoc</span>&nbsp;<span class="op" id="2543877">=</span>&nbsp;<span class="op" id="2543879">*</span><span class="ident" id="2543880">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2543885">localLoc</span><span class="op" id="2543893">.</span><span class="ident" id="2543894">name</span>&nbsp;<span class="op" id="2543899">=</span>&nbsp;<span class="string" id="2543901">&#34;Local&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2543912">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2543921">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2543924">case</span>&nbsp;<span class="ident" id="2543929">tz</span>&nbsp;<span class="op" id="2543932">!=</span>&nbsp;<span class="string" id="2543935">&#34;&#34;</span>&nbsp;<span class="op" id="2543938">&amp;&amp;</span>&nbsp;<span class="ident" id="2543941">tz</span>&nbsp;<span class="op" id="2543944">!=</span>&nbsp;<span class="string" id="2543947">&#34;UTC&#34;</span><span class="op" id="2543952">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2543956">if</span>&nbsp;<span class="ident" id="2543959">z</span><span class="op" id="2543960">,</span>&nbsp;<span class="ident" id="2543962">err</span>&nbsp;<span class="op" id="2543966">:=</span>&nbsp;<span class="ident" id="2543969">loadLocation</span><span class="op" id="2543981">(</span><span class="ident" id="2543982">tz</span><span class="op" id="2543984">)</span><span class="op" id="2543985">;</span>&nbsp;<span class="ident" id="2543987">err</span>&nbsp;<span class="op" id="2543991">==</span>&nbsp;<span class="ident" id="2543994">nil</span>&nbsp;<span class="op" id="2543998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2544003">localLoc</span>&nbsp;<span class="op" id="2544012">=</span>&nbsp;<span class="op" id="2544014">*</span><span class="ident" id="2544015">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2544020">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2544029">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2544032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2544036">//&nbsp;Fall&nbsp;back&nbsp;to&nbsp;UTC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2544058">localLoc</span><span class="op" id="2544066">.</span><span class="ident" id="2544067">name</span>&nbsp;<span class="op" id="2544072">=</span>&nbsp;<span class="string" id="2544074">&#34;UTC&#34;</span><br>
<span class="lineno"></span><span class="op" id="2544080">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="2544083">func</span>&nbsp;<span class="ident" id="2544088">loadLocation</span><span class="op" id="2544100">(</span><span class="ident" id="2544101">name</span>&nbsp;<span class="builtintype" id="2544106">string</span><span class="op" id="2544112">)</span>&nbsp;<span class="op" id="2544114">(</span><span class="op" id="2544115">*</span><span class="ident" id="2544116">Location</span><span class="op" id="2544124">,</span>&nbsp;<span class="builtintype" id="2544126">error</span><span class="op" id="2544131">)</span>&nbsp;<span class="op" id="2544133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2544136">for</span>&nbsp;<span class="ident" id="2544140">_</span><span class="op" id="2544141">,</span>&nbsp;<span class="ident" id="2544143">zoneDir</span>&nbsp;<span class="op" id="2544151">:=</span>&nbsp;<span class="keyword" id="2544154">range</span>&nbsp;<span class="ident" id="2544160">zoneDirs</span>&nbsp;<span class="op" id="2544169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2544173">if</span>&nbsp;<span class="ident" id="2544176">z</span><span class="op" id="2544177">,</span>&nbsp;<span class="ident" id="2544179">err</span>&nbsp;<span class="op" id="2544183">:=</span>&nbsp;<span class="ident" id="2544186">loadZoneFile</span><span class="op" id="2544198">(</span><span class="ident" id="2544199">zoneDir</span><span class="op" id="2544206">,</span>&nbsp;<span class="ident" id="2544208">name</span><span class="op" id="2544212">)</span><span class="op" id="2544213">;</span>&nbsp;<span class="ident" id="2544215">err</span>&nbsp;<span class="op" id="2544219">==</span>&nbsp;<span class="ident" id="2544222">nil</span>&nbsp;<span class="op" id="2544226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2544231">z</span><span class="op" id="2544232">.</span><span class="ident" id="2544233">name</span>&nbsp;<span class="op" id="2544238">=</span>&nbsp;<span class="ident" id="2544240">name</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2544248">return</span>&nbsp;<span class="ident" id="2544255">z</span><span class="op" id="2544256">,</span>&nbsp;<span class="ident" id="2544258">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2544264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2544267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2544270">return</span>&nbsp;<span class="ident" id="2544277">nil</span><span class="op" id="2544280">,</span>&nbsp;<span class="ident" id="2544282">errors</span><span class="op" id="2544288">.</span><span class="ident" id="2544289">New</span><span class="op" id="2544292">(</span><span class="string" id="2544293">&#34;unknown&nbsp;time&nbsp;zone&nbsp;&#34;</span>&nbsp;<span class="op" id="2544314">+</span>&nbsp;<span class="ident" id="2544316">name</span><span class="op" id="2544320">)</span><br>
<span class="lineno"></span><span class="op" id="2544322">}</span>
</div>
</body>
</html>
