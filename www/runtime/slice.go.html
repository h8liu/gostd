<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1700359">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1700414">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1700468">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1700519">package</span>&nbsp;<span class="ident" id="1700527">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1700536">import</span>&nbsp;<span class="op" id="1700543">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1700546">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1700555">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1700558">type</span>&nbsp;<span class="ident" id="1700563">sliceStruct</span>&nbsp;<span class="keyword" id="1700575">struct</span>&nbsp;<span class="op" id="1700582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1700585">array</span>&nbsp;<span class="ident" id="1700591">unsafe</span><span class="op" id="1700597">.</span><span class="ident" id="1700598">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1700607">len</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1700613">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1700618">cap</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1700624">int</span><br>
<span class="lineno">15</span><span class="op" id="1700628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1700631">//&nbsp;TODO:&nbsp;take&nbsp;uintptrs&nbsp;instead&nbsp;of&nbsp;int64s?</span><br>
<span class="lineno"></span><span class="keyword" id="1700673">func</span>&nbsp;<span class="ident" id="1700678">makeslice</span><span class="op" id="1700687">(</span><span class="ident" id="1700688">t</span>&nbsp;<span class="op" id="1700690">*</span><span class="ident" id="1700691">slicetype</span><span class="op" id="1700700">,</span>&nbsp;<span class="ident" id="1700702">len64</span>&nbsp;<span class="ident" id="1700708">int64</span><span class="op" id="1700713">,</span>&nbsp;<span class="ident" id="1700715">cap64</span>&nbsp;<span class="ident" id="1700721">int64</span><span class="op" id="1700726">)</span>&nbsp;<span class="ident" id="1700728">sliceStruct</span>&nbsp;<span class="op" id="1700740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1700743">//&nbsp;NOTE:&nbsp;The&nbsp;len&nbsp;&gt;&nbsp;MaxMem/elemsize&nbsp;check&nbsp;here&nbsp;is&nbsp;not&nbsp;strictly&nbsp;necessary,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1700817">//&nbsp;but&nbsp;it&nbsp;produces&nbsp;a&nbsp;&#39;len&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error&nbsp;instead&nbsp;of&nbsp;a&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1700902">//&nbsp;when&nbsp;someone&nbsp;does&nbsp;make([]T,&nbsp;bignumber).&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;is&nbsp;true&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1700978">//&nbsp;but&nbsp;since&nbsp;the&nbsp;cap&nbsp;is&nbsp;only&nbsp;being&nbsp;supplied&nbsp;implicitly,&nbsp;saying&nbsp;len&nbsp;is&nbsp;clearer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1701058">//&nbsp;See&nbsp;issue&nbsp;4085.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1701078">len</span>&nbsp;<span class="op" id="1701082">:=</span>&nbsp;<span class="builtintype" id="1701085">int</span><span class="op" id="1701088">(</span><span class="ident" id="1701089">len64</span><span class="op" id="1701094">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1701097">if</span>&nbsp;<span class="ident" id="1701100">len64</span>&nbsp;<span class="op" id="1701106">&lt;</span>&nbsp;<span class="num" id="1701108">0</span>&nbsp;<span class="op" id="1701110">||</span>&nbsp;<span class="ident" id="1701113">int64</span><span class="op" id="1701118">(</span><span class="builtinfunc" id="1701119">len</span><span class="op" id="1701122">)</span>&nbsp;<span class="op" id="1701124">!=</span>&nbsp;<span class="ident" id="1701127">len64</span>&nbsp;<span class="op" id="1701133">||</span>&nbsp;<span class="ident" id="1701136">t</span><span class="op" id="1701137">.</span><span class="ident" id="1701138">elem</span><span class="op" id="1701142">.</span><span class="ident" id="1701143">size</span>&nbsp;<span class="op" id="1701148">&gt;</span>&nbsp;<span class="num" id="1701150">0</span>&nbsp;<span class="op" id="1701152">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1701155">uintptr</span><span class="op" id="1701162">(</span><span class="builtinfunc" id="1701163">len</span><span class="op" id="1701166">)</span>&nbsp;<span class="op" id="1701168">&gt;</span>&nbsp;<span class="ident" id="1701170">maxmem</span><span class="op" id="1701176">/</span><span class="builtintype" id="1701177">uintptr</span><span class="op" id="1701184">(</span><span class="ident" id="1701185">t</span><span class="op" id="1701186">.</span><span class="ident" id="1701187">elem</span><span class="op" id="1701191">.</span><span class="ident" id="1701192">size</span><span class="op" id="1701196">)</span>&nbsp;<span class="op" id="1701198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1701202">panic</span><span class="op" id="1701207">(</span><span class="ident" id="1701208">errorString</span><span class="op" id="1701219">(</span><span class="string" id="1701220">&#34;makeslice:&nbsp;len&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1701249">)</span><span class="op" id="1701250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1701253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1701256">cap</span>&nbsp;<span class="op" id="1701260">:=</span>&nbsp;<span class="builtintype" id="1701263">int</span><span class="op" id="1701266">(</span><span class="ident" id="1701267">cap64</span><span class="op" id="1701272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1701275">if</span>&nbsp;<span class="builtinfunc" id="1701278">cap</span>&nbsp;<span class="op" id="1701282">&lt;</span>&nbsp;<span class="builtinfunc" id="1701284">len</span>&nbsp;<span class="op" id="1701288">||</span>&nbsp;<span class="ident" id="1701291">int64</span><span class="op" id="1701296">(</span><span class="builtinfunc" id="1701297">cap</span><span class="op" id="1701300">)</span>&nbsp;<span class="op" id="1701302">!=</span>&nbsp;<span class="ident" id="1701305">cap64</span>&nbsp;<span class="op" id="1701311">||</span>&nbsp;<span class="ident" id="1701314">t</span><span class="op" id="1701315">.</span><span class="ident" id="1701316">elem</span><span class="op" id="1701320">.</span><span class="ident" id="1701321">size</span>&nbsp;<span class="op" id="1701326">&gt;</span>&nbsp;<span class="num" id="1701328">0</span>&nbsp;<span class="op" id="1701330">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1701333">uintptr</span><span class="op" id="1701340">(</span><span class="builtinfunc" id="1701341">cap</span><span class="op" id="1701344">)</span>&nbsp;<span class="op" id="1701346">&gt;</span>&nbsp;<span class="ident" id="1701348">maxmem</span><span class="op" id="1701354">/</span><span class="builtintype" id="1701355">uintptr</span><span class="op" id="1701362">(</span><span class="ident" id="1701363">t</span><span class="op" id="1701364">.</span><span class="ident" id="1701365">elem</span><span class="op" id="1701369">.</span><span class="ident" id="1701370">size</span><span class="op" id="1701374">)</span>&nbsp;<span class="op" id="1701376">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1701380">panic</span><span class="op" id="1701385">(</span><span class="ident" id="1701386">errorString</span><span class="op" id="1701397">(</span><span class="string" id="1701398">&#34;makeslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1701427">)</span><span class="op" id="1701428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1701431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1701434">p</span>&nbsp;<span class="op" id="1701436">:=</span>&nbsp;<span class="ident" id="1701439">newarray</span><span class="op" id="1701447">(</span><span class="ident" id="1701448">t</span><span class="op" id="1701449">.</span><span class="ident" id="1701450">elem</span><span class="op" id="1701454">,</span>&nbsp;<span class="builtintype" id="1701456">uintptr</span><span class="op" id="1701463">(</span><span class="builtinfunc" id="1701464">cap</span><span class="op" id="1701467">)</span><span class="op" id="1701468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1701471">return</span>&nbsp;<span class="ident" id="1701478">sliceStruct</span><span class="op" id="1701489">{</span><span class="ident" id="1701490">p</span><span class="op" id="1701491">,</span>&nbsp;<span class="builtinfunc" id="1701493">len</span><span class="op" id="1701496">,</span>&nbsp;<span class="builtinfunc" id="1701498">cap</span><span class="op" id="1701501">}</span><br>
<span class="lineno"></span><span class="op" id="1701503">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1701506">//&nbsp;TODO:&nbsp;take&nbsp;uintptr&nbsp;instead&nbsp;of&nbsp;int64?</span><br>
<span class="lineno"></span><span class="keyword" id="1701546">func</span>&nbsp;<span class="ident" id="1701551">growslice</span><span class="op" id="1701560">(</span><span class="ident" id="1701561">t</span>&nbsp;<span class="op" id="1701563">*</span><span class="ident" id="1701564">slicetype</span><span class="op" id="1701573">,</span>&nbsp;<span class="ident" id="1701575">old</span>&nbsp;<span class="ident" id="1701579">sliceStruct</span><span class="op" id="1701590">,</span>&nbsp;<span class="ident" id="1701592">n</span>&nbsp;<span class="ident" id="1701594">int64</span><span class="op" id="1701599">)</span>&nbsp;<span class="ident" id="1701601">sliceStruct</span>&nbsp;<span class="op" id="1701613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1701616">if</span>&nbsp;<span class="ident" id="1701619">n</span>&nbsp;<span class="op" id="1701621">&lt;</span>&nbsp;<span class="num" id="1701623">1</span>&nbsp;<span class="op" id="1701625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1701629">panic</span><span class="op" id="1701634">(</span><span class="ident" id="1701635">errorString</span><span class="op" id="1701646">(</span><span class="string" id="1701647">&#34;growslice:&nbsp;invalid&nbsp;n&#34;</span><span class="op" id="1701669">)</span><span class="op" id="1701670">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1701673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1701677">cap64</span>&nbsp;<span class="op" id="1701683">:=</span>&nbsp;<span class="ident" id="1701686">int64</span><span class="op" id="1701691">(</span><span class="ident" id="1701692">old</span><span class="op" id="1701695">.</span><span class="builtinfunc" id="1701696">cap</span><span class="op" id="1701699">)</span>&nbsp;<span class="op" id="1701701">+</span>&nbsp;<span class="ident" id="1701703">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1701706">cap</span>&nbsp;<span class="op" id="1701710">:=</span>&nbsp;<span class="builtintype" id="1701713">int</span><span class="op" id="1701716">(</span><span class="ident" id="1701717">cap64</span><span class="op" id="1701722">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1701726">if</span>&nbsp;<span class="ident" id="1701729">int64</span><span class="op" id="1701734">(</span><span class="builtinfunc" id="1701735">cap</span><span class="op" id="1701738">)</span>&nbsp;<span class="op" id="1701740">!=</span>&nbsp;<span class="ident" id="1701743">cap64</span>&nbsp;<span class="op" id="1701749">||</span>&nbsp;<span class="builtinfunc" id="1701752">cap</span>&nbsp;<span class="op" id="1701756">&lt;</span>&nbsp;<span class="ident" id="1701758">old</span><span class="op" id="1701761">.</span><span class="builtinfunc" id="1701762">cap</span>&nbsp;<span class="op" id="1701766">||</span>&nbsp;<span class="ident" id="1701769">t</span><span class="op" id="1701770">.</span><span class="ident" id="1701771">elem</span><span class="op" id="1701775">.</span><span class="ident" id="1701776">size</span>&nbsp;<span class="op" id="1701781">&gt;</span>&nbsp;<span class="num" id="1701783">0</span>&nbsp;<span class="op" id="1701785">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1701788">uintptr</span><span class="op" id="1701795">(</span><span class="builtinfunc" id="1701796">cap</span><span class="op" id="1701799">)</span>&nbsp;<span class="op" id="1701801">&gt;</span>&nbsp;<span class="ident" id="1701803">maxmem</span><span class="op" id="1701809">/</span><span class="builtintype" id="1701810">uintptr</span><span class="op" id="1701817">(</span><span class="ident" id="1701818">t</span><span class="op" id="1701819">.</span><span class="ident" id="1701820">elem</span><span class="op" id="1701824">.</span><span class="ident" id="1701825">size</span><span class="op" id="1701829">)</span>&nbsp;<span class="op" id="1701831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1701835">panic</span><span class="op" id="1701840">(</span><span class="ident" id="1701841">errorString</span><span class="op" id="1701852">(</span><span class="string" id="1701853">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1701882">)</span><span class="op" id="1701883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1701886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1701890">if</span>&nbsp;<span class="ident" id="1701893">raceenabled</span>&nbsp;<span class="op" id="1701905">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1701909">callerpc</span>&nbsp;<span class="op" id="1701918">:=</span>&nbsp;<span class="ident" id="1701921">getcallerpc</span><span class="op" id="1701932">(</span><span class="ident" id="1701933">unsafe</span><span class="op" id="1701939">.</span><span class="ident" id="1701940">Pointer</span><span class="op" id="1701947">(</span><span class="op" id="1701948">&amp;</span><span class="ident" id="1701949">t</span><span class="op" id="1701950">)</span><span class="op" id="1701951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1701955">racereadrangepc</span><span class="op" id="1701970">(</span><span class="ident" id="1701971">old</span><span class="op" id="1701974">.</span><span class="ident" id="1701975">array</span><span class="op" id="1701980">,</span>&nbsp;<span class="builtintype" id="1701982">uintptr</span><span class="op" id="1701989">(</span><span class="ident" id="1701990">old</span><span class="op" id="1701993">.</span><span class="builtinfunc" id="1701994">len</span><span class="op" id="1701997">*</span><span class="builtintype" id="1701998">int</span><span class="op" id="1702001">(</span><span class="ident" id="1702002">t</span><span class="op" id="1702003">.</span><span class="ident" id="1702004">elem</span><span class="op" id="1702008">.</span><span class="ident" id="1702009">size</span><span class="op" id="1702013">)</span><span class="op" id="1702014">)</span><span class="op" id="1702015">,</span>&nbsp;<span class="ident" id="1702017">callerpc</span><span class="op" id="1702025">,</span>&nbsp;<span class="ident" id="1702027">funcPC</span><span class="op" id="1702033">(</span><span class="ident" id="1702034">growslice</span><span class="op" id="1702043">)</span><span class="op" id="1702044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1702047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702051">et</span>&nbsp;<span class="op" id="1702054">:=</span>&nbsp;<span class="ident" id="1702057">t</span><span class="op" id="1702058">.</span><span class="ident" id="1702059">elem</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702065">if</span>&nbsp;<span class="ident" id="1702068">et</span><span class="op" id="1702070">.</span><span class="ident" id="1702071">size</span>&nbsp;<span class="op" id="1702076">==</span>&nbsp;<span class="num" id="1702079">0</span>&nbsp;<span class="op" id="1702081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702085">return</span>&nbsp;<span class="ident" id="1702092">sliceStruct</span><span class="op" id="1702103">{</span><span class="ident" id="1702104">old</span><span class="op" id="1702107">.</span><span class="ident" id="1702108">array</span><span class="op" id="1702113">,</span>&nbsp;<span class="ident" id="1702115">old</span><span class="op" id="1702118">.</span><span class="builtinfunc" id="1702119">len</span><span class="op" id="1702122">,</span>&nbsp;<span class="builtinfunc" id="1702124">cap</span><span class="op" id="1702127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1702130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702134">newcap</span>&nbsp;<span class="op" id="1702141">:=</span>&nbsp;<span class="ident" id="1702144">old</span><span class="op" id="1702147">.</span><span class="builtinfunc" id="1702148">cap</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702153">if</span>&nbsp;<span class="ident" id="1702156">newcap</span><span class="op" id="1702162">+</span><span class="ident" id="1702163">newcap</span>&nbsp;<span class="op" id="1702170">&lt;</span>&nbsp;<span class="builtinfunc" id="1702172">cap</span>&nbsp;<span class="op" id="1702176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702180">newcap</span>&nbsp;<span class="op" id="1702187">=</span>&nbsp;<span class="builtinfunc" id="1702189">cap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1702194">}</span>&nbsp;<span class="keyword" id="1702196">else</span>&nbsp;<span class="op" id="1702201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702205">for</span>&nbsp;<span class="op" id="1702209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702214">if</span>&nbsp;<span class="ident" id="1702217">old</span><span class="op" id="1702220">.</span><span class="builtinfunc" id="1702221">len</span>&nbsp;<span class="op" id="1702225">&lt;</span>&nbsp;<span class="num" id="1702227">1024</span>&nbsp;<span class="op" id="1702232">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702238">newcap</span>&nbsp;<span class="op" id="1702245">+=</span>&nbsp;<span class="ident" id="1702248">newcap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1702258">}</span>&nbsp;<span class="keyword" id="1702260">else</span>&nbsp;<span class="op" id="1702265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702271">newcap</span>&nbsp;<span class="op" id="1702278">+=</span>&nbsp;<span class="ident" id="1702281">newcap</span>&nbsp;<span class="op" id="1702288">/</span>&nbsp;<span class="num" id="1702290">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1702295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702300">if</span>&nbsp;<span class="ident" id="1702303">newcap</span>&nbsp;<span class="op" id="1702310">&gt;=</span>&nbsp;<span class="builtinfunc" id="1702313">cap</span>&nbsp;<span class="op" id="1702317">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702323">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1702332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1702336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1702339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702343">if</span>&nbsp;<span class="builtintype" id="1702346">uintptr</span><span class="op" id="1702353">(</span><span class="ident" id="1702354">newcap</span><span class="op" id="1702360">)</span>&nbsp;<span class="op" id="1702362">&gt;=</span>&nbsp;<span class="ident" id="1702365">maxmem</span><span class="op" id="1702371">/</span><span class="builtintype" id="1702372">uintptr</span><span class="op" id="1702379">(</span><span class="ident" id="1702380">et</span><span class="op" id="1702382">.</span><span class="ident" id="1702383">size</span><span class="op" id="1702387">)</span>&nbsp;<span class="op" id="1702389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1702393">panic</span><span class="op" id="1702398">(</span><span class="ident" id="1702399">errorString</span><span class="op" id="1702410">(</span><span class="string" id="1702411">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1702440">)</span><span class="op" id="1702441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1702444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702447">lenmem</span>&nbsp;<span class="op" id="1702454">:=</span>&nbsp;<span class="builtintype" id="1702457">uintptr</span><span class="op" id="1702464">(</span><span class="ident" id="1702465">old</span><span class="op" id="1702468">.</span><span class="builtinfunc" id="1702469">len</span><span class="op" id="1702472">)</span>&nbsp;<span class="op" id="1702474">*</span>&nbsp;<span class="builtintype" id="1702476">uintptr</span><span class="op" id="1702483">(</span><span class="ident" id="1702484">et</span><span class="op" id="1702486">.</span><span class="ident" id="1702487">size</span><span class="op" id="1702491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702494">capmem</span>&nbsp;<span class="op" id="1702501">:=</span>&nbsp;<span class="ident" id="1702504">goroundupsize</span><span class="op" id="1702517">(</span><span class="builtintype" id="1702518">uintptr</span><span class="op" id="1702525">(</span><span class="ident" id="1702526">newcap</span><span class="op" id="1702532">)</span>&nbsp;<span class="op" id="1702534">*</span>&nbsp;<span class="builtintype" id="1702536">uintptr</span><span class="op" id="1702543">(</span><span class="ident" id="1702544">et</span><span class="op" id="1702546">.</span><span class="ident" id="1702547">size</span><span class="op" id="1702551">)</span><span class="op" id="1702552">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702555">newcap</span>&nbsp;<span class="op" id="1702562">=</span>&nbsp;<span class="builtintype" id="1702564">int</span><span class="op" id="1702567">(</span><span class="ident" id="1702568">capmem</span>&nbsp;<span class="op" id="1702575">/</span>&nbsp;<span class="builtintype" id="1702577">uintptr</span><span class="op" id="1702584">(</span><span class="ident" id="1702585">et</span><span class="op" id="1702587">.</span><span class="ident" id="1702588">size</span><span class="op" id="1702592">)</span><span class="op" id="1702593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702596">var</span>&nbsp;<span class="ident" id="1702600">p</span>&nbsp;<span class="ident" id="1702602">unsafe</span><span class="op" id="1702608">.</span><span class="ident" id="1702609">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702618">if</span>&nbsp;<span class="ident" id="1702621">et</span><span class="op" id="1702623">.</span><span class="ident" id="1702624">kind</span><span class="op" id="1702628">&amp;</span><span class="ident" id="1702629">kindNoPointers</span>&nbsp;<span class="op" id="1702644">!=</span>&nbsp;<span class="num" id="1702647">0</span>&nbsp;<span class="op" id="1702649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702653">p</span>&nbsp;<span class="op" id="1702655">=</span>&nbsp;<span class="ident" id="1702657">rawmem</span><span class="op" id="1702663">(</span><span class="ident" id="1702664">capmem</span><span class="op" id="1702670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702674">memclr</span><span class="op" id="1702680">(</span><span class="ident" id="1702681">add</span><span class="op" id="1702684">(</span><span class="ident" id="1702685">p</span><span class="op" id="1702686">,</span>&nbsp;<span class="ident" id="1702688">lenmem</span><span class="op" id="1702694">)</span><span class="op" id="1702695">,</span>&nbsp;<span class="ident" id="1702697">capmem</span><span class="op" id="1702703">-</span><span class="ident" id="1702704">lenmem</span><span class="op" id="1702710">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1702713">}</span>&nbsp;<span class="keyword" id="1702715">else</span>&nbsp;<span class="op" id="1702720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1702724">//&nbsp;Note:&nbsp;can&#39;t&nbsp;use&nbsp;rawmem&nbsp;(which&nbsp;avoids&nbsp;zeroing&nbsp;of&nbsp;memory),&nbsp;because&nbsp;then&nbsp;GC&nbsp;can&nbsp;scan&nbsp;unitialized&nbsp;memory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702830">p</span>&nbsp;<span class="op" id="1702832">=</span>&nbsp;<span class="ident" id="1702834">newarray</span><span class="op" id="1702842">(</span><span class="ident" id="1702843">et</span><span class="op" id="1702845">,</span>&nbsp;<span class="builtintype" id="1702847">uintptr</span><span class="op" id="1702854">(</span><span class="ident" id="1702855">newcap</span><span class="op" id="1702861">)</span><span class="op" id="1702862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1702865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1702868">memmove</span><span class="op" id="1702875">(</span><span class="ident" id="1702876">p</span><span class="op" id="1702877">,</span>&nbsp;<span class="ident" id="1702879">old</span><span class="op" id="1702882">.</span><span class="ident" id="1702883">array</span><span class="op" id="1702888">,</span>&nbsp;<span class="ident" id="1702890">lenmem</span><span class="op" id="1702896">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1702900">return</span>&nbsp;<span class="ident" id="1702907">sliceStruct</span><span class="op" id="1702918">{</span><span class="ident" id="1702919">p</span><span class="op" id="1702920">,</span>&nbsp;<span class="ident" id="1702922">old</span><span class="op" id="1702925">.</span><span class="builtinfunc" id="1702926">len</span><span class="op" id="1702929">,</span>&nbsp;<span class="ident" id="1702931">newcap</span><span class="op" id="1702937">}</span><br>
<span class="lineno"></span><span class="op" id="1702939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1702942">func</span>&nbsp;<span class="ident" id="1702947">slicecopy</span><span class="op" id="1702956">(</span><span class="ident" id="1702957">to</span>&nbsp;<span class="ident" id="1702960">sliceStruct</span><span class="op" id="1702971">,</span>&nbsp;<span class="ident" id="1702973">fm</span>&nbsp;<span class="ident" id="1702976">sliceStruct</span><span class="op" id="1702987">,</span>&nbsp;<span class="ident" id="1702989">width</span>&nbsp;<span class="builtintype" id="1702995">uintptr</span><span class="op" id="1703002">)</span>&nbsp;<span class="builtintype" id="1703004">int</span>&nbsp;<span class="op" id="1703008">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1703011">if</span>&nbsp;<span class="ident" id="1703014">fm</span><span class="op" id="1703016">.</span><span class="builtinfunc" id="1703017">len</span>&nbsp;<span class="op" id="1703021">==</span>&nbsp;<span class="num" id="1703024">0</span>&nbsp;<span class="op" id="1703026">||</span>&nbsp;<span class="ident" id="1703029">to</span><span class="op" id="1703031">.</span><span class="builtinfunc" id="1703032">len</span>&nbsp;<span class="op" id="1703036">==</span>&nbsp;<span class="num" id="1703039">0</span>&nbsp;<span class="op" id="1703041">||</span>&nbsp;<span class="ident" id="1703044">width</span>&nbsp;<span class="op" id="1703050">==</span>&nbsp;<span class="num" id="1703053">0</span>&nbsp;<span class="op" id="1703055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1703059">return</span>&nbsp;<span class="num" id="1703066">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1703069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703073">n</span>&nbsp;<span class="op" id="1703075">:=</span>&nbsp;<span class="ident" id="1703078">fm</span><span class="op" id="1703080">.</span><span class="builtinfunc" id="1703081">len</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1703086">if</span>&nbsp;<span class="ident" id="1703089">to</span><span class="op" id="1703091">.</span><span class="builtinfunc" id="1703092">len</span>&nbsp;<span class="op" id="1703096">&lt;</span>&nbsp;<span class="ident" id="1703098">n</span>&nbsp;<span class="op" id="1703100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703104">n</span>&nbsp;<span class="op" id="1703106">=</span>&nbsp;<span class="ident" id="1703108">to</span><span class="op" id="1703110">.</span><span class="builtinfunc" id="1703111">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1703116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1703120">if</span>&nbsp;<span class="ident" id="1703123">raceenabled</span>&nbsp;<span class="op" id="1703135">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703139">callerpc</span>&nbsp;<span class="op" id="1703148">:=</span>&nbsp;<span class="ident" id="1703151">getcallerpc</span><span class="op" id="1703162">(</span><span class="ident" id="1703163">unsafe</span><span class="op" id="1703169">.</span><span class="ident" id="1703170">Pointer</span><span class="op" id="1703177">(</span><span class="op" id="1703178">&amp;</span><span class="ident" id="1703179">to</span><span class="op" id="1703181">)</span><span class="op" id="1703182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703186">pc</span>&nbsp;<span class="op" id="1703189">:=</span>&nbsp;<span class="ident" id="1703192">funcPC</span><span class="op" id="1703198">(</span><span class="ident" id="1703199">slicecopy</span><span class="op" id="1703208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703212">racewriterangepc</span><span class="op" id="1703228">(</span><span class="ident" id="1703229">to</span><span class="op" id="1703231">.</span><span class="ident" id="1703232">array</span><span class="op" id="1703237">,</span>&nbsp;<span class="builtintype" id="1703239">uintptr</span><span class="op" id="1703246">(</span><span class="ident" id="1703247">n</span><span class="op" id="1703248">*</span><span class="builtintype" id="1703249">int</span><span class="op" id="1703252">(</span><span class="ident" id="1703253">width</span><span class="op" id="1703258">)</span><span class="op" id="1703259">)</span><span class="op" id="1703260">,</span>&nbsp;<span class="ident" id="1703262">callerpc</span><span class="op" id="1703270">,</span>&nbsp;<span class="ident" id="1703272">pc</span><span class="op" id="1703274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703278">racereadrangepc</span><span class="op" id="1703293">(</span><span class="ident" id="1703294">fm</span><span class="op" id="1703296">.</span><span class="ident" id="1703297">array</span><span class="op" id="1703302">,</span>&nbsp;<span class="builtintype" id="1703304">uintptr</span><span class="op" id="1703311">(</span><span class="ident" id="1703312">n</span><span class="op" id="1703313">*</span><span class="builtintype" id="1703314">int</span><span class="op" id="1703317">(</span><span class="ident" id="1703318">width</span><span class="op" id="1703323">)</span><span class="op" id="1703324">)</span><span class="op" id="1703325">,</span>&nbsp;<span class="ident" id="1703327">callerpc</span><span class="op" id="1703335">,</span>&nbsp;<span class="ident" id="1703337">pc</span><span class="op" id="1703339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1703342">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703346">size</span>&nbsp;<span class="op" id="1703351">:=</span>&nbsp;<span class="builtintype" id="1703354">uintptr</span><span class="op" id="1703361">(</span><span class="ident" id="1703362">n</span><span class="op" id="1703363">)</span>&nbsp;<span class="op" id="1703365">*</span>&nbsp;<span class="ident" id="1703367">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1703374">if</span>&nbsp;<span class="ident" id="1703377">size</span>&nbsp;<span class="op" id="1703382">==</span>&nbsp;<span class="num" id="1703385">1</span>&nbsp;<span class="op" id="1703387">{</span>&nbsp;<span class="comment" id="1703389">//&nbsp;common&nbsp;case&nbsp;worth&nbsp;about&nbsp;2x&nbsp;to&nbsp;do&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1703432">//&nbsp;TODO:&nbsp;is&nbsp;this&nbsp;still&nbsp;worth&nbsp;it&nbsp;with&nbsp;new&nbsp;memmove&nbsp;impl?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1703489">*</span><span class="op" id="1703490">(</span><span class="op" id="1703491">*</span><span class="builtintype" id="1703492">byte</span><span class="op" id="1703496">)</span><span class="op" id="1703497">(</span><span class="ident" id="1703498">to</span><span class="op" id="1703500">.</span><span class="ident" id="1703501">array</span><span class="op" id="1703506">)</span>&nbsp;<span class="op" id="1703508">=</span>&nbsp;<span class="op" id="1703510">*</span><span class="op" id="1703511">(</span><span class="op" id="1703512">*</span><span class="builtintype" id="1703513">byte</span><span class="op" id="1703517">)</span><span class="op" id="1703518">(</span><span class="ident" id="1703519">fm</span><span class="op" id="1703521">.</span><span class="ident" id="1703522">array</span><span class="op" id="1703527">)</span>&nbsp;<span class="comment" id="1703529">//&nbsp;known&nbsp;to&nbsp;be&nbsp;a&nbsp;byte&nbsp;pointer</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1703560">}</span>&nbsp;<span class="keyword" id="1703562">else</span>&nbsp;<span class="op" id="1703567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703571">memmove</span><span class="op" id="1703578">(</span><span class="ident" id="1703579">to</span><span class="op" id="1703581">.</span><span class="ident" id="1703582">array</span><span class="op" id="1703587">,</span>&nbsp;<span class="ident" id="1703589">fm</span><span class="op" id="1703591">.</span><span class="ident" id="1703592">array</span><span class="op" id="1703597">,</span>&nbsp;<span class="ident" id="1703599">size</span><span class="op" id="1703603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1703606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1703609">return</span>&nbsp;<span class="builtintype" id="1703616">int</span><span class="op" id="1703619">(</span><span class="ident" id="1703620">n</span><span class="op" id="1703621">)</span><br>
<span class="lineno"></span><span class="op" id="1703623">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="1703626">func</span>&nbsp;<span class="ident" id="1703631">slicestringcopy</span><span class="op" id="1703646">(</span><span class="ident" id="1703647">to</span>&nbsp;<span class="op" id="1703650">[</span><span class="op" id="1703651">]</span><span class="builtintype" id="1703652">byte</span><span class="op" id="1703656">,</span>&nbsp;<span class="ident" id="1703658">fm</span>&nbsp;<span class="builtintype" id="1703661">string</span><span class="op" id="1703667">)</span>&nbsp;<span class="builtintype" id="1703669">int</span>&nbsp;<span class="op" id="1703673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1703676">if</span>&nbsp;<span class="builtinfunc" id="1703679">len</span><span class="op" id="1703682">(</span><span class="ident" id="1703683">fm</span><span class="op" id="1703685">)</span>&nbsp;<span class="op" id="1703687">==</span>&nbsp;<span class="num" id="1703690">0</span>&nbsp;<span class="op" id="1703692">||</span>&nbsp;<span class="builtinfunc" id="1703695">len</span><span class="op" id="1703698">(</span><span class="ident" id="1703699">to</span><span class="op" id="1703701">)</span>&nbsp;<span class="op" id="1703703">==</span>&nbsp;<span class="num" id="1703706">0</span>&nbsp;<span class="op" id="1703708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1703712">return</span>&nbsp;<span class="num" id="1703719">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1703722">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703726">n</span>&nbsp;<span class="op" id="1703728">:=</span>&nbsp;<span class="builtinfunc" id="1703731">len</span><span class="op" id="1703734">(</span><span class="ident" id="1703735">fm</span><span class="op" id="1703737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1703740">if</span>&nbsp;<span class="builtinfunc" id="1703743">len</span><span class="op" id="1703746">(</span><span class="ident" id="1703747">to</span><span class="op" id="1703749">)</span>&nbsp;<span class="op" id="1703751">&lt;</span>&nbsp;<span class="ident" id="1703753">n</span>&nbsp;<span class="op" id="1703755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703759">n</span>&nbsp;<span class="op" id="1703761">=</span>&nbsp;<span class="builtinfunc" id="1703763">len</span><span class="op" id="1703766">(</span><span class="ident" id="1703767">to</span><span class="op" id="1703769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1703772">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1703776">if</span>&nbsp;<span class="ident" id="1703779">raceenabled</span>&nbsp;<span class="op" id="1703791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703795">callerpc</span>&nbsp;<span class="op" id="1703804">:=</span>&nbsp;<span class="ident" id="1703807">getcallerpc</span><span class="op" id="1703818">(</span><span class="ident" id="1703819">unsafe</span><span class="op" id="1703825">.</span><span class="ident" id="1703826">Pointer</span><span class="op" id="1703833">(</span><span class="op" id="1703834">&amp;</span><span class="ident" id="1703835">to</span><span class="op" id="1703837">)</span><span class="op" id="1703838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703842">pc</span>&nbsp;<span class="op" id="1703845">:=</span>&nbsp;<span class="ident" id="1703848">funcPC</span><span class="op" id="1703854">(</span><span class="ident" id="1703855">slicestringcopy</span><span class="op" id="1703870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703874">racewriterangepc</span><span class="op" id="1703890">(</span><span class="ident" id="1703891">unsafe</span><span class="op" id="1703897">.</span><span class="ident" id="1703898">Pointer</span><span class="op" id="1703905">(</span><span class="op" id="1703906">&amp;</span><span class="ident" id="1703907">to</span><span class="op" id="1703909">[</span><span class="num" id="1703910">0</span><span class="op" id="1703911">]</span><span class="op" id="1703912">)</span><span class="op" id="1703913">,</span>&nbsp;<span class="builtintype" id="1703915">uintptr</span><span class="op" id="1703922">(</span><span class="ident" id="1703923">n</span><span class="op" id="1703924">)</span><span class="op" id="1703925">,</span>&nbsp;<span class="ident" id="1703927">callerpc</span><span class="op" id="1703935">,</span>&nbsp;<span class="ident" id="1703937">pc</span><span class="op" id="1703939">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1703942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1703946">memmove</span><span class="op" id="1703953">(</span><span class="ident" id="1703954">unsafe</span><span class="op" id="1703960">.</span><span class="ident" id="1703961">Pointer</span><span class="op" id="1703968">(</span><span class="op" id="1703969">&amp;</span><span class="ident" id="1703970">to</span><span class="op" id="1703972">[</span><span class="num" id="1703973">0</span><span class="op" id="1703974">]</span><span class="op" id="1703975">)</span><span class="op" id="1703976">,</span>&nbsp;<span class="ident" id="1703978">unsafe</span><span class="op" id="1703984">.</span><span class="ident" id="1703985">Pointer</span><span class="op" id="1703992">(</span><span class="op" id="1703993">(</span><span class="op" id="1703994">*</span><span class="ident" id="1703995">stringStruct</span><span class="op" id="1704007">)</span><span class="op" id="1704008">(</span><span class="ident" id="1704009">unsafe</span><span class="op" id="1704015">.</span><span class="ident" id="1704016">Pointer</span><span class="op" id="1704023">(</span><span class="op" id="1704024">&amp;</span><span class="ident" id="1704025">fm</span><span class="op" id="1704027">)</span><span class="op" id="1704028">)</span><span class="op" id="1704029">.</span><span class="ident" id="1704030">str</span><span class="op" id="1704033">)</span><span class="op" id="1704034">,</span>&nbsp;<span class="builtintype" id="1704036">uintptr</span><span class="op" id="1704043">(</span><span class="ident" id="1704044">n</span><span class="op" id="1704045">)</span><span class="op" id="1704046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1704049">return</span>&nbsp;<span class="ident" id="1704056">n</span><br>
<span class="lineno"></span><span class="op" id="1704058">}</span>
</div>
</body>
</html>
