<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html" class="current">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3356134">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3356189">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3356243">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3356294">//&nbsp;Package&nbsp;parser&nbsp;implements&nbsp;a&nbsp;parser&nbsp;for&nbsp;Go&nbsp;source&nbsp;files.&nbsp;Input&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3356366">//&nbsp;provided&nbsp;in&nbsp;a&nbsp;variety&nbsp;of&nbsp;forms&nbsp;(see&nbsp;the&nbsp;various&nbsp;Parse*&nbsp;functions);&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3356440">//&nbsp;output&nbsp;is&nbsp;an&nbsp;abstract&nbsp;syntax&nbsp;tree&nbsp;(AST)&nbsp;representing&nbsp;the&nbsp;Go&nbsp;source.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="3356515">//&nbsp;parser&nbsp;is&nbsp;invoked&nbsp;through&nbsp;one&nbsp;of&nbsp;the&nbsp;Parse*&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="3356573">//</span><br>
<span class="lineno">10</span><span class="keyword" id="3356576">package</span>&nbsp;<span class="ident" id="3356584">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3356592">import</span>&nbsp;<span class="op" id="3356599">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3356602">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3356609">&#34;go/ast&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3356619">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3356633">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3356645">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3356656">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3356667">&#34;unicode&#34;</span><br>
<span class="lineno">20</span><span class="op" id="3356677">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3356680">//&nbsp;The&nbsp;parser&nbsp;structure&nbsp;holds&nbsp;the&nbsp;parser&#39;s&nbsp;internal&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="3356739">type</span>&nbsp;<span class="ident" id="3356744">parser</span>&nbsp;<span class="keyword" id="3356751">struct</span>&nbsp;<span class="op" id="3356758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356761">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3356769">*</span><span class="ident" id="3356770">token</span><span class="op" id="3356775">.</span><span class="ident" id="3356776">File</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356782">errors</span>&nbsp;&nbsp;<span class="ident" id="3356790">scanner</span><span class="op" id="3356797">.</span><span class="ident" id="3356798">ErrorList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356809">scanner</span>&nbsp;<span class="ident" id="3356817">scanner</span><span class="op" id="3356824">.</span><span class="ident" id="3356825">Scanner</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3356835">//&nbsp;Tracing/debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356857">mode</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3356864">Mode</span>&nbsp;<span class="comment" id="3356869">//&nbsp;parsing&nbsp;mode</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356886">trace</span>&nbsp;&nbsp;<span class="builtintype" id="3356893">bool</span>&nbsp;<span class="comment" id="3356898">//&nbsp;==&nbsp;(mode&nbsp;&amp;&nbsp;Trace&nbsp;!=&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356925">indent</span>&nbsp;<span class="builtintype" id="3356932">int</span>&nbsp;&nbsp;<span class="comment" id="3356937">//&nbsp;indentation&nbsp;used&nbsp;for&nbsp;tracing&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3356978">//&nbsp;Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356991">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3357003">[</span><span class="op" id="3357004">]</span><span class="op" id="3357005">*</span><span class="ident" id="3357006">ast</span><span class="op" id="3357009">.</span><span class="ident" id="3357010">CommentGroup</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357024">leadComment</span>&nbsp;<span class="op" id="3357036">*</span><span class="ident" id="3357037">ast</span><span class="op" id="3357040">.</span><span class="ident" id="3357041">CommentGroup</span>&nbsp;<span class="comment" id="3357054">//&nbsp;last&nbsp;lead&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357076">lineComment</span>&nbsp;<span class="op" id="3357088">*</span><span class="ident" id="3357089">ast</span><span class="op" id="3357092">.</span><span class="ident" id="3357093">CommentGroup</span>&nbsp;<span class="comment" id="3357106">//&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3357129">//&nbsp;Next&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357144">pos</span>&nbsp;<span class="ident" id="3357148">token</span><span class="op" id="3357153">.</span><span class="ident" id="3357154">Pos</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3357160">//&nbsp;token&nbsp;position</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357179">tok</span>&nbsp;<span class="ident" id="3357183">token</span><span class="op" id="3357188">.</span><span class="ident" id="3357189">Token</span>&nbsp;<span class="comment" id="3357195">//&nbsp;one&nbsp;token&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357220">lit</span>&nbsp;<span class="builtintype" id="3357224">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3357236">//&nbsp;token&nbsp;literal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3357255">//&nbsp;Error&nbsp;recovery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3357274">//&nbsp;(used&nbsp;to&nbsp;limit&nbsp;the&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;functions</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3357334">//&nbsp;w/o&nbsp;making&nbsp;scanning&nbsp;progress&nbsp;-&nbsp;avoids&nbsp;potential&nbsp;endless</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3357394">//&nbsp;loops&nbsp;across&nbsp;multiple&nbsp;parser&nbsp;functions&nbsp;during&nbsp;error&nbsp;recovery)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357460">syncPos</span>&nbsp;<span class="ident" id="3357468">token</span><span class="op" id="3357473">.</span><span class="ident" id="3357474">Pos</span>&nbsp;<span class="comment" id="3357478">//&nbsp;last&nbsp;synchronization&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357512">syncCnt</span>&nbsp;<span class="builtintype" id="3357520">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3357530">//&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;without&nbsp;progress</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3357579">//&nbsp;Non-syntactic&nbsp;parser&nbsp;control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357612">exprLev</span>&nbsp;<span class="builtintype" id="3357620">int</span>&nbsp;&nbsp;<span class="comment" id="3357625">//&nbsp;&lt;&nbsp;0:&nbsp;in&nbsp;control&nbsp;clause,&nbsp;&gt;=&nbsp;0:&nbsp;in&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357673">inRhs</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3357681">bool</span>&nbsp;<span class="comment" id="3357686">//&nbsp;if&nbsp;set,&nbsp;the&nbsp;parser&nbsp;is&nbsp;parsing&nbsp;a&nbsp;rhs&nbsp;expression</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3357738">//&nbsp;Ordinary&nbsp;identifier&nbsp;scopes</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357769">pkgScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3357780">*</span><span class="ident" id="3357781">ast</span><span class="op" id="3357784">.</span><span class="ident" id="3357785">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3357798">//&nbsp;pkgScope.Outer&nbsp;==&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357824">topScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3357835">*</span><span class="ident" id="3357836">ast</span><span class="op" id="3357839">.</span><span class="ident" id="3357840">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3357853">//&nbsp;top-most&nbsp;scope;&nbsp;may&nbsp;be&nbsp;pkgScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357889">unresolved</span>&nbsp;<span class="op" id="3357900">[</span><span class="op" id="3357901">]</span><span class="op" id="3357902">*</span><span class="ident" id="3357903">ast</span><span class="op" id="3357906">.</span><span class="ident" id="3357907">Ident</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3357918">//&nbsp;unresolved&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357945">imports</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3357956">[</span><span class="op" id="3357957">]</span><span class="op" id="3357958">*</span><span class="ident" id="3357959">ast</span><span class="op" id="3357962">.</span><span class="ident" id="3357963">ImportSpec</span>&nbsp;<span class="comment" id="3357974">//&nbsp;list&nbsp;of&nbsp;imports</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3357995">//&nbsp;Label&nbsp;scopes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3358012">//&nbsp;(maintained&nbsp;by&nbsp;open/close&nbsp;LabelScope)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358054">labelScope</span>&nbsp;&nbsp;<span class="op" id="3358066">*</span><span class="ident" id="3358067">ast</span><span class="op" id="3358070">.</span><span class="ident" id="3358071">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3358081">//&nbsp;label&nbsp;scope&nbsp;for&nbsp;current&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358118">targetStack</span>&nbsp;<span class="op" id="3358130">[</span><span class="op" id="3358131">]</span><span class="op" id="3358132">[</span><span class="op" id="3358133">]</span><span class="op" id="3358134">*</span><span class="ident" id="3358135">ast</span><span class="op" id="3358138">.</span><span class="ident" id="3358139">Ident</span>&nbsp;<span class="comment" id="3358145">//&nbsp;stack&nbsp;of&nbsp;unresolved&nbsp;labels</span><br>
<span class="lineno"></span><span class="op" id="3358175">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3358178">func</span>&nbsp;<span class="op" id="3358183">(</span><span class="ident" id="3358184">p</span>&nbsp;<span class="op" id="3358186">*</span><span class="ident" id="3358187">parser</span><span class="op" id="3358193">)</span>&nbsp;<span class="ident" id="3358195">init</span><span class="op" id="3358199">(</span><span class="ident" id="3358200">fset</span>&nbsp;<span class="op" id="3358205">*</span><span class="ident" id="3358206">token</span><span class="op" id="3358211">.</span><span class="ident" id="3358212">FileSet</span><span class="op" id="3358219">,</span>&nbsp;<span class="ident" id="3358221">filename</span>&nbsp;<span class="builtintype" id="3358230">string</span><span class="op" id="3358236">,</span>&nbsp;<span class="ident" id="3358238">src</span>&nbsp;<span class="op" id="3358242">[</span><span class="op" id="3358243">]</span><span class="builtintype" id="3358244">byte</span><span class="op" id="3358248">,</span>&nbsp;<span class="ident" id="3358250">mode</span>&nbsp;<span class="ident" id="3358255">Mode</span><span class="op" id="3358259">)</span>&nbsp;<span class="op" id="3358261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358264">p</span><span class="op" id="3358265">.</span><span class="ident" id="3358266">file</span>&nbsp;<span class="op" id="3358271">=</span>&nbsp;<span class="ident" id="3358273">fset</span><span class="op" id="3358277">.</span><span class="ident" id="3358278">AddFile</span><span class="op" id="3358285">(</span><span class="ident" id="3358286">filename</span><span class="op" id="3358294">,</span>&nbsp;<span class="op" id="3358296">-</span><span class="num" id="3358297">1</span><span class="op" id="3358298">,</span>&nbsp;<span class="builtinfunc" id="3358300">len</span><span class="op" id="3358303">(</span><span class="ident" id="3358304">src</span><span class="op" id="3358307">)</span><span class="op" id="3358308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358311">var</span>&nbsp;<span class="ident" id="3358315">m</span>&nbsp;<span class="ident" id="3358317">scanner</span><span class="op" id="3358324">.</span><span class="ident" id="3358325">Mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358331">if</span>&nbsp;<span class="ident" id="3358334">mode</span><span class="op" id="3358338">&amp;</span><span class="ident" id="3358339">ParseComments</span>&nbsp;<span class="op" id="3358353">!=</span>&nbsp;<span class="num" id="3358356">0</span>&nbsp;<span class="op" id="3358358">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358362">m</span>&nbsp;<span class="op" id="3358364">=</span>&nbsp;<span class="ident" id="3358366">scanner</span><span class="op" id="3358373">.</span><span class="ident" id="3358374">ScanComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3358388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358391">eh</span>&nbsp;<span class="op" id="3358394">:=</span>&nbsp;<span class="keyword" id="3358397">func</span><span class="op" id="3358401">(</span><span class="ident" id="3358402">pos</span>&nbsp;<span class="ident" id="3358406">token</span><span class="op" id="3358411">.</span><span class="ident" id="3358412">Position</span><span class="op" id="3358420">,</span>&nbsp;<span class="ident" id="3358422">msg</span>&nbsp;<span class="builtintype" id="3358426">string</span><span class="op" id="3358432">)</span>&nbsp;<span class="op" id="3358434">{</span>&nbsp;<span class="ident" id="3358436">p</span><span class="op" id="3358437">.</span><span class="ident" id="3358438">errors</span><span class="op" id="3358444">.</span><span class="ident" id="3358445">Add</span><span class="op" id="3358448">(</span><span class="ident" id="3358449">pos</span><span class="op" id="3358452">,</span>&nbsp;<span class="ident" id="3358454">msg</span><span class="op" id="3358457">)</span>&nbsp;<span class="op" id="3358459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358462">p</span><span class="op" id="3358463">.</span><span class="ident" id="3358464">scanner</span><span class="op" id="3358471">.</span><span class="ident" id="3358472">Init</span><span class="op" id="3358476">(</span><span class="ident" id="3358477">p</span><span class="op" id="3358478">.</span><span class="ident" id="3358479">file</span><span class="op" id="3358483">,</span>&nbsp;<span class="ident" id="3358485">src</span><span class="op" id="3358488">,</span>&nbsp;<span class="ident" id="3358490">eh</span><span class="op" id="3358492">,</span>&nbsp;<span class="ident" id="3358494">m</span><span class="op" id="3358495">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358499">p</span><span class="op" id="3358500">.</span><span class="ident" id="3358501">mode</span>&nbsp;<span class="op" id="3358506">=</span>&nbsp;<span class="ident" id="3358508">mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358514">p</span><span class="op" id="3358515">.</span><span class="ident" id="3358516">trace</span>&nbsp;<span class="op" id="3358522">=</span>&nbsp;<span class="ident" id="3358524">mode</span><span class="op" id="3358528">&amp;</span><span class="ident" id="3358529">Trace</span>&nbsp;<span class="op" id="3358535">!=</span>&nbsp;<span class="num" id="3358538">0</span>&nbsp;<span class="comment" id="3358540">//&nbsp;for&nbsp;convenience&nbsp;(p.trace&nbsp;is&nbsp;used&nbsp;frequently)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358590">p</span><span class="op" id="3358591">.</span><span class="ident" id="3358592">next</span><span class="op" id="3358596">(</span><span class="op" id="3358597">)</span><br>
<span class="lineno"></span><span class="op" id="3358599">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="3358602">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3358682">//&nbsp;Scoping&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3358702">func</span>&nbsp;<span class="op" id="3358707">(</span><span class="ident" id="3358708">p</span>&nbsp;<span class="op" id="3358710">*</span><span class="ident" id="3358711">parser</span><span class="op" id="3358717">)</span>&nbsp;<span class="ident" id="3358719">openScope</span><span class="op" id="3358728">(</span><span class="op" id="3358729">)</span>&nbsp;<span class="op" id="3358731">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358734">p</span><span class="op" id="3358735">.</span><span class="ident" id="3358736">topScope</span>&nbsp;<span class="op" id="3358745">=</span>&nbsp;<span class="ident" id="3358747">ast</span><span class="op" id="3358750">.</span><span class="ident" id="3358751">NewScope</span><span class="op" id="3358759">(</span><span class="ident" id="3358760">p</span><span class="op" id="3358761">.</span><span class="ident" id="3358762">topScope</span><span class="op" id="3358770">)</span><br>
<span class="lineno"></span><span class="op" id="3358772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3358775">func</span>&nbsp;<span class="op" id="3358780">(</span><span class="ident" id="3358781">p</span>&nbsp;<span class="op" id="3358783">*</span><span class="ident" id="3358784">parser</span><span class="op" id="3358790">)</span>&nbsp;<span class="ident" id="3358792">closeScope</span><span class="op" id="3358802">(</span><span class="op" id="3358803">)</span>&nbsp;<span class="op" id="3358805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358808">p</span><span class="op" id="3358809">.</span><span class="ident" id="3358810">topScope</span>&nbsp;<span class="op" id="3358819">=</span>&nbsp;<span class="ident" id="3358821">p</span><span class="op" id="3358822">.</span><span class="ident" id="3358823">topScope</span><span class="op" id="3358831">.</span><span class="ident" id="3358832">Outer</span><br>
<span class="lineno">90</span><span class="op" id="3358838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3358841">func</span>&nbsp;<span class="op" id="3358846">(</span><span class="ident" id="3358847">p</span>&nbsp;<span class="op" id="3358849">*</span><span class="ident" id="3358850">parser</span><span class="op" id="3358856">)</span>&nbsp;<span class="ident" id="3358858">openLabelScope</span><span class="op" id="3358872">(</span><span class="op" id="3358873">)</span>&nbsp;<span class="op" id="3358875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358878">p</span><span class="op" id="3358879">.</span><span class="ident" id="3358880">labelScope</span>&nbsp;<span class="op" id="3358891">=</span>&nbsp;<span class="ident" id="3358893">ast</span><span class="op" id="3358896">.</span><span class="ident" id="3358897">NewScope</span><span class="op" id="3358905">(</span><span class="ident" id="3358906">p</span><span class="op" id="3358907">.</span><span class="ident" id="3358908">labelScope</span><span class="op" id="3358918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358921">p</span><span class="op" id="3358922">.</span><span class="ident" id="3358923">targetStack</span>&nbsp;<span class="op" id="3358935">=</span>&nbsp;<span class="builtinfunc" id="3358937">append</span><span class="op" id="3358943">(</span><span class="ident" id="3358944">p</span><span class="op" id="3358945">.</span><span class="ident" id="3358946">targetStack</span><span class="op" id="3358957">,</span>&nbsp;<span class="ident" id="3358959">nil</span><span class="op" id="3358962">)</span><br>
<span class="lineno">95</span><span class="op" id="3358964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3358967">func</span>&nbsp;<span class="op" id="3358972">(</span><span class="ident" id="3358973">p</span>&nbsp;<span class="op" id="3358975">*</span><span class="ident" id="3358976">parser</span><span class="op" id="3358982">)</span>&nbsp;<span class="ident" id="3358984">closeLabelScope</span><span class="op" id="3358999">(</span><span class="op" id="3359000">)</span>&nbsp;<span class="op" id="3359002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359005">//&nbsp;resolve&nbsp;labels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359024">n</span>&nbsp;<span class="op" id="3359026">:=</span>&nbsp;<span class="builtinfunc" id="3359029">len</span><span class="op" id="3359032">(</span><span class="ident" id="3359033">p</span><span class="op" id="3359034">.</span><span class="ident" id="3359035">targetStack</span><span class="op" id="3359046">)</span>&nbsp;<span class="op" id="3359048">-</span>&nbsp;<span class="num" id="3359050">1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359053">scope</span>&nbsp;<span class="op" id="3359059">:=</span>&nbsp;<span class="ident" id="3359062">p</span><span class="op" id="3359063">.</span><span class="ident" id="3359064">labelScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359076">for</span>&nbsp;<span class="ident" id="3359080">_</span><span class="op" id="3359081">,</span>&nbsp;<span class="ident" id="3359083">ident</span>&nbsp;<span class="op" id="3359089">:=</span>&nbsp;<span class="keyword" id="3359092">range</span>&nbsp;<span class="ident" id="3359098">p</span><span class="op" id="3359099">.</span><span class="ident" id="3359100">targetStack</span><span class="op" id="3359111">[</span><span class="ident" id="3359112">n</span><span class="op" id="3359113">]</span>&nbsp;<span class="op" id="3359115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359119">ident</span><span class="op" id="3359124">.</span><span class="ident" id="3359125">Obj</span>&nbsp;<span class="op" id="3359129">=</span>&nbsp;<span class="ident" id="3359131">scope</span><span class="op" id="3359136">.</span><span class="ident" id="3359137">Lookup</span><span class="op" id="3359143">(</span><span class="ident" id="3359144">ident</span><span class="op" id="3359149">.</span><span class="ident" id="3359150">Name</span><span class="op" id="3359154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359158">if</span>&nbsp;<span class="ident" id="3359161">ident</span><span class="op" id="3359166">.</span><span class="ident" id="3359167">Obj</span>&nbsp;<span class="op" id="3359171">==</span>&nbsp;<span class="ident" id="3359174">nil</span>&nbsp;<span class="op" id="3359178">&amp;&amp;</span>&nbsp;<span class="ident" id="3359181">p</span><span class="op" id="3359182">.</span><span class="ident" id="3359183">mode</span><span class="op" id="3359187">&amp;</span><span class="ident" id="3359188">DeclarationErrors</span>&nbsp;<span class="op" id="3359206">!=</span>&nbsp;<span class="num" id="3359209">0</span>&nbsp;<span class="op" id="3359211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359216">p</span><span class="op" id="3359217">.</span><span class="builtintype" id="3359218">error</span><span class="op" id="3359223">(</span><span class="ident" id="3359224">ident</span><span class="op" id="3359229">.</span><span class="ident" id="3359230">Pos</span><span class="op" id="3359233">(</span><span class="op" id="3359234">)</span><span class="op" id="3359235">,</span>&nbsp;<span class="ident" id="3359237">fmt</span><span class="op" id="3359240">.</span><span class="ident" id="3359241">Sprintf</span><span class="op" id="3359248">(</span><span class="string" id="3359249">&#34;label&nbsp;%s&nbsp;undefined&#34;</span><span class="op" id="3359269">,</span>&nbsp;<span class="ident" id="3359271">ident</span><span class="op" id="3359276">.</span><span class="ident" id="3359277">Name</span><span class="op" id="3359281">)</span><span class="op" id="3359282">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3359286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3359289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359292">//&nbsp;pop&nbsp;label&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359312">p</span><span class="op" id="3359313">.</span><span class="ident" id="3359314">targetStack</span>&nbsp;<span class="op" id="3359326">=</span>&nbsp;<span class="ident" id="3359328">p</span><span class="op" id="3359329">.</span><span class="ident" id="3359330">targetStack</span><span class="op" id="3359341">[</span><span class="num" id="3359342">0</span><span class="op" id="3359343">:</span><span class="ident" id="3359344">n</span><span class="op" id="3359345">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359348">p</span><span class="op" id="3359349">.</span><span class="ident" id="3359350">labelScope</span>&nbsp;<span class="op" id="3359361">=</span>&nbsp;<span class="ident" id="3359363">p</span><span class="op" id="3359364">.</span><span class="ident" id="3359365">labelScope</span><span class="op" id="3359375">.</span><span class="ident" id="3359376">Outer</span><br>
<span class="lineno">110</span><span class="op" id="3359382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3359385">func</span>&nbsp;<span class="op" id="3359390">(</span><span class="ident" id="3359391">p</span>&nbsp;<span class="op" id="3359393">*</span><span class="ident" id="3359394">parser</span><span class="op" id="3359400">)</span>&nbsp;<span class="ident" id="3359402">declare</span><span class="op" id="3359409">(</span><span class="ident" id="3359410">decl</span><span class="op" id="3359414">,</span>&nbsp;<span class="ident" id="3359416">data</span>&nbsp;<span class="keyword" id="3359421">interface</span><span class="op" id="3359430">{</span><span class="op" id="3359431">}</span><span class="op" id="3359432">,</span>&nbsp;<span class="ident" id="3359434">scope</span>&nbsp;<span class="op" id="3359440">*</span><span class="ident" id="3359441">ast</span><span class="op" id="3359444">.</span><span class="ident" id="3359445">Scope</span><span class="op" id="3359450">,</span>&nbsp;<span class="ident" id="3359452">kind</span>&nbsp;<span class="ident" id="3359457">ast</span><span class="op" id="3359460">.</span><span class="ident" id="3359461">ObjKind</span><span class="op" id="3359468">,</span>&nbsp;<span class="ident" id="3359470">idents</span>&nbsp;<span class="op" id="3359477">...</span><span class="op" id="3359480">*</span><span class="ident" id="3359481">ast</span><span class="op" id="3359484">.</span><span class="ident" id="3359485">Ident</span><span class="op" id="3359490">)</span>&nbsp;<span class="op" id="3359492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359495">for</span>&nbsp;<span class="ident" id="3359499">_</span><span class="op" id="3359500">,</span>&nbsp;<span class="ident" id="3359502">ident</span>&nbsp;<span class="op" id="3359508">:=</span>&nbsp;<span class="keyword" id="3359511">range</span>&nbsp;<span class="ident" id="3359517">idents</span>&nbsp;<span class="op" id="3359524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359528">assert</span><span class="op" id="3359534">(</span><span class="ident" id="3359535">ident</span><span class="op" id="3359540">.</span><span class="ident" id="3359541">Obj</span>&nbsp;<span class="op" id="3359545">==</span>&nbsp;<span class="ident" id="3359548">nil</span><span class="op" id="3359551">,</span>&nbsp;<span class="string" id="3359553">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="3359594">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359598">obj</span>&nbsp;<span class="op" id="3359602">:=</span>&nbsp;<span class="ident" id="3359605">ast</span><span class="op" id="3359608">.</span><span class="ident" id="3359609">NewObj</span><span class="op" id="3359615">(</span><span class="ident" id="3359616">kind</span><span class="op" id="3359620">,</span>&nbsp;<span class="ident" id="3359622">ident</span><span class="op" id="3359627">.</span><span class="ident" id="3359628">Name</span><span class="op" id="3359632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359636">//&nbsp;remember&nbsp;the&nbsp;corresponding&nbsp;declaration&nbsp;for&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359698">//&nbsp;errors&nbsp;and&nbsp;global&nbsp;variable&nbsp;resolution/typechecking&nbsp;phase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359760">obj</span><span class="op" id="3359763">.</span><span class="ident" id="3359764">Decl</span>&nbsp;<span class="op" id="3359769">=</span>&nbsp;<span class="ident" id="3359771">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359778">obj</span><span class="op" id="3359781">.</span><span class="ident" id="3359782">Data</span>&nbsp;<span class="op" id="3359787">=</span>&nbsp;<span class="ident" id="3359789">data</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359796">ident</span><span class="op" id="3359801">.</span><span class="ident" id="3359802">Obj</span>&nbsp;<span class="op" id="3359806">=</span>&nbsp;<span class="ident" id="3359808">obj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359814">if</span>&nbsp;<span class="ident" id="3359817">ident</span><span class="op" id="3359822">.</span><span class="ident" id="3359823">Name</span>&nbsp;<span class="op" id="3359828">!=</span>&nbsp;<span class="string" id="3359831">&#34;_&#34;</span>&nbsp;<span class="op" id="3359835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359840">if</span>&nbsp;<span class="ident" id="3359843">alt</span>&nbsp;<span class="op" id="3359847">:=</span>&nbsp;<span class="ident" id="3359850">scope</span><span class="op" id="3359855">.</span><span class="ident" id="3359856">Insert</span><span class="op" id="3359862">(</span><span class="ident" id="3359863">obj</span><span class="op" id="3359866">)</span><span class="op" id="3359867">;</span>&nbsp;<span class="ident" id="3359869">alt</span>&nbsp;<span class="op" id="3359873">!=</span>&nbsp;<span class="ident" id="3359876">nil</span>&nbsp;<span class="op" id="3359880">&amp;&amp;</span>&nbsp;<span class="ident" id="3359883">p</span><span class="op" id="3359884">.</span><span class="ident" id="3359885">mode</span><span class="op" id="3359889">&amp;</span><span class="ident" id="3359890">DeclarationErrors</span>&nbsp;<span class="op" id="3359908">!=</span>&nbsp;<span class="num" id="3359911">0</span>&nbsp;<span class="op" id="3359913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359919">prevDecl</span>&nbsp;<span class="op" id="3359928">:=</span>&nbsp;<span class="string" id="3359931">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359938">if</span>&nbsp;<span class="ident" id="3359941">pos</span>&nbsp;<span class="op" id="3359945">:=</span>&nbsp;<span class="ident" id="3359948">alt</span><span class="op" id="3359951">.</span><span class="ident" id="3359952">Pos</span><span class="op" id="3359955">(</span><span class="op" id="3359956">)</span><span class="op" id="3359957">;</span>&nbsp;<span class="ident" id="3359959">pos</span><span class="op" id="3359962">.</span><span class="ident" id="3359963">IsValid</span><span class="op" id="3359970">(</span><span class="op" id="3359971">)</span>&nbsp;<span class="op" id="3359973">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359980">prevDecl</span>&nbsp;<span class="op" id="3359989">=</span>&nbsp;<span class="ident" id="3359991">fmt</span><span class="op" id="3359994">.</span><span class="ident" id="3359995">Sprintf</span><span class="op" id="3360002">(</span><span class="string" id="3360003">&#34;\n\tprevious&nbsp;declaration&nbsp;at&nbsp;%s&#34;</span><span class="op" id="3360035">,</span>&nbsp;<span class="ident" id="3360037">p</span><span class="op" id="3360038">.</span><span class="ident" id="3360039">file</span><span class="op" id="3360043">.</span><span class="ident" id="3360044">Position</span><span class="op" id="3360052">(</span><span class="ident" id="3360053">pos</span><span class="op" id="3360056">)</span><span class="op" id="3360057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360069">p</span><span class="op" id="3360070">.</span><span class="builtintype" id="3360071">error</span><span class="op" id="3360076">(</span><span class="ident" id="3360077">ident</span><span class="op" id="3360082">.</span><span class="ident" id="3360083">Pos</span><span class="op" id="3360086">(</span><span class="op" id="3360087">)</span><span class="op" id="3360088">,</span>&nbsp;<span class="ident" id="3360090">fmt</span><span class="op" id="3360093">.</span><span class="ident" id="3360094">Sprintf</span><span class="op" id="3360101">(</span><span class="string" id="3360102">&#34;%s&nbsp;redeclared&nbsp;in&nbsp;this&nbsp;block%s&#34;</span><span class="op" id="3360133">,</span>&nbsp;<span class="ident" id="3360135">ident</span><span class="op" id="3360140">.</span><span class="ident" id="3360141">Name</span><span class="op" id="3360145">,</span>&nbsp;<span class="ident" id="3360147">prevDecl</span><span class="op" id="3360155">)</span><span class="op" id="3360156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360165">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360168">}</span><br>
<span class="lineno"></span><span class="op" id="3360170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3360173">func</span>&nbsp;<span class="op" id="3360178">(</span><span class="ident" id="3360179">p</span>&nbsp;<span class="op" id="3360181">*</span><span class="ident" id="3360182">parser</span><span class="op" id="3360188">)</span>&nbsp;<span class="ident" id="3360190">shortVarDecl</span><span class="op" id="3360202">(</span><span class="ident" id="3360203">decl</span>&nbsp;<span class="op" id="3360208">*</span><span class="ident" id="3360209">ast</span><span class="op" id="3360212">.</span><span class="ident" id="3360213">AssignStmt</span><span class="op" id="3360223">,</span>&nbsp;<span class="ident" id="3360225">list</span>&nbsp;<span class="op" id="3360230">[</span><span class="op" id="3360231">]</span><span class="ident" id="3360232">ast</span><span class="op" id="3360235">.</span><span class="ident" id="3360236">Expr</span><span class="op" id="3360240">)</span>&nbsp;<span class="op" id="3360242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3360245">//&nbsp;Go&nbsp;spec:&nbsp;A&nbsp;short&nbsp;variable&nbsp;declaration&nbsp;may&nbsp;redeclare&nbsp;variables</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3360311">//&nbsp;provided&nbsp;they&nbsp;were&nbsp;originally&nbsp;declared&nbsp;in&nbsp;the&nbsp;same&nbsp;block&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3360377">//&nbsp;the&nbsp;same&nbsp;type,&nbsp;and&nbsp;at&nbsp;least&nbsp;one&nbsp;of&nbsp;the&nbsp;non-blank&nbsp;variables&nbsp;is&nbsp;new.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360448">n</span>&nbsp;<span class="op" id="3360450">:=</span>&nbsp;<span class="num" id="3360453">0</span>&nbsp;<span class="comment" id="3360455">//&nbsp;number&nbsp;of&nbsp;new&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360483">for</span>&nbsp;<span class="ident" id="3360487">_</span><span class="op" id="3360488">,</span>&nbsp;<span class="ident" id="3360490">x</span>&nbsp;<span class="op" id="3360492">:=</span>&nbsp;<span class="keyword" id="3360495">range</span>&nbsp;<span class="ident" id="3360501">list</span>&nbsp;<span class="op" id="3360506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360510">if</span>&nbsp;<span class="ident" id="3360513">ident</span><span class="op" id="3360518">,</span>&nbsp;<span class="ident" id="3360520">isIdent</span>&nbsp;<span class="op" id="3360528">:=</span>&nbsp;<span class="ident" id="3360531">x</span><span class="op" id="3360532">.</span><span class="op" id="3360533">(</span><span class="op" id="3360534">*</span><span class="ident" id="3360535">ast</span><span class="op" id="3360538">.</span><span class="ident" id="3360539">Ident</span><span class="op" id="3360544">)</span><span class="op" id="3360545">;</span>&nbsp;<span class="ident" id="3360547">isIdent</span>&nbsp;<span class="op" id="3360555">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360560">assert</span><span class="op" id="3360566">(</span><span class="ident" id="3360567">ident</span><span class="op" id="3360572">.</span><span class="ident" id="3360573">Obj</span>&nbsp;<span class="op" id="3360577">==</span>&nbsp;<span class="ident" id="3360580">nil</span><span class="op" id="3360583">,</span>&nbsp;<span class="string" id="3360585">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="3360626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360631">obj</span>&nbsp;<span class="op" id="3360635">:=</span>&nbsp;<span class="ident" id="3360638">ast</span><span class="op" id="3360641">.</span><span class="ident" id="3360642">NewObj</span><span class="op" id="3360648">(</span><span class="ident" id="3360649">ast</span><span class="op" id="3360652">.</span><span class="ident" id="3360653">Var</span><span class="op" id="3360656">,</span>&nbsp;<span class="ident" id="3360658">ident</span><span class="op" id="3360663">.</span><span class="ident" id="3360664">Name</span><span class="op" id="3360668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3360673">//&nbsp;remember&nbsp;corresponding&nbsp;assignment&nbsp;for&nbsp;other&nbsp;tools</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360729">obj</span><span class="op" id="3360732">.</span><span class="ident" id="3360733">Decl</span>&nbsp;<span class="op" id="3360738">=</span>&nbsp;<span class="ident" id="3360740">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360748">ident</span><span class="op" id="3360753">.</span><span class="ident" id="3360754">Obj</span>&nbsp;<span class="op" id="3360758">=</span>&nbsp;<span class="ident" id="3360760">obj</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360767">if</span>&nbsp;<span class="ident" id="3360770">ident</span><span class="op" id="3360775">.</span><span class="ident" id="3360776">Name</span>&nbsp;<span class="op" id="3360781">!=</span>&nbsp;<span class="string" id="3360784">&#34;_&#34;</span>&nbsp;<span class="op" id="3360788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360794">if</span>&nbsp;<span class="ident" id="3360797">alt</span>&nbsp;<span class="op" id="3360801">:=</span>&nbsp;<span class="ident" id="3360804">p</span><span class="op" id="3360805">.</span><span class="ident" id="3360806">topScope</span><span class="op" id="3360814">.</span><span class="ident" id="3360815">Insert</span><span class="op" id="3360821">(</span><span class="ident" id="3360822">obj</span><span class="op" id="3360825">)</span><span class="op" id="3360826">;</span>&nbsp;<span class="ident" id="3360828">alt</span>&nbsp;<span class="op" id="3360832">!=</span>&nbsp;<span class="ident" id="3360835">nil</span>&nbsp;<span class="op" id="3360839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360846">ident</span><span class="op" id="3360851">.</span><span class="ident" id="3360852">Obj</span>&nbsp;<span class="op" id="3360856">=</span>&nbsp;<span class="ident" id="3360858">alt</span>&nbsp;<span class="comment" id="3360862">//&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360883">}</span>&nbsp;<span class="keyword" id="3360885">else</span>&nbsp;<span class="op" id="3360890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360897">n</span><span class="op" id="3360898">++</span>&nbsp;<span class="comment" id="3360901">//&nbsp;new&nbsp;declaration</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360933">}</span>&nbsp;<span class="keyword" id="3360935">else</span>&nbsp;<span class="op" id="3360940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360945">p</span><span class="op" id="3360946">.</span><span class="ident" id="3360947">errorExpected</span><span class="op" id="3360960">(</span><span class="ident" id="3360961">x</span><span class="op" id="3360962">.</span><span class="ident" id="3360963">Pos</span><span class="op" id="3360966">(</span><span class="op" id="3360967">)</span><span class="op" id="3360968">,</span>&nbsp;<span class="string" id="3360970">&#34;identifier&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="3361001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361005">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361011">if</span>&nbsp;<span class="ident" id="3361014">n</span>&nbsp;<span class="op" id="3361016">==</span>&nbsp;<span class="num" id="3361019">0</span>&nbsp;<span class="op" id="3361021">&amp;&amp;</span>&nbsp;<span class="ident" id="3361024">p</span><span class="op" id="3361025">.</span><span class="ident" id="3361026">mode</span><span class="op" id="3361030">&amp;</span><span class="ident" id="3361031">DeclarationErrors</span>&nbsp;<span class="op" id="3361049">!=</span>&nbsp;<span class="num" id="3361052">0</span>&nbsp;<span class="op" id="3361054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361058">p</span><span class="op" id="3361059">.</span><span class="builtintype" id="3361060">error</span><span class="op" id="3361065">(</span><span class="ident" id="3361066">list</span><span class="op" id="3361070">[</span><span class="num" id="3361071">0</span><span class="op" id="3361072">]</span><span class="op" id="3361073">.</span><span class="ident" id="3361074">Pos</span><span class="op" id="3361077">(</span><span class="op" id="3361078">)</span><span class="op" id="3361079">,</span>&nbsp;<span class="string" id="3361081">&#34;no&nbsp;new&nbsp;variables&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="3361118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361121">}</span><br>
<span class="lineno"></span><span class="op" id="3361123">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="3361126">//&nbsp;The&nbsp;unresolved&nbsp;object&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;to&nbsp;mark&nbsp;identifiers&nbsp;that&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="3361206">//&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;identifiers.&nbsp;The&nbsp;sentinel&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;verifying</span><br>
<span class="lineno"></span><span class="comment" id="3361288">//&nbsp;internal&nbsp;consistency.</span><br>
<span class="lineno"></span><span class="keyword" id="3361313">var</span>&nbsp;<span class="ident" id="3361317">unresolved</span>&nbsp;<span class="op" id="3361328">=</span>&nbsp;<span class="builtinfunc" id="3361330">new</span><span class="op" id="3361333">(</span><span class="ident" id="3361334">ast</span><span class="op" id="3361337">.</span><span class="ident" id="3361338">Object</span><span class="op" id="3361344">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="3361347">//&nbsp;If&nbsp;x&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;tryResolve&nbsp;attempts&nbsp;to&nbsp;resolve&nbsp;x&nbsp;by&nbsp;looking&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="3361420">//&nbsp;the&nbsp;object&nbsp;it&nbsp;denotes.&nbsp;If&nbsp;no&nbsp;object&nbsp;is&nbsp;found&nbsp;and&nbsp;collectUnresolved&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3361493">//&nbsp;set,&nbsp;x&nbsp;is&nbsp;marked&nbsp;as&nbsp;unresolved&nbsp;and&nbsp;collected&nbsp;in&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved</span><br>
<span class="lineno"></span><span class="comment" id="3361567">//&nbsp;identifiers.</span><br>
<span class="lineno">170</span><span class="comment" id="3361583">//</span><br>
<span class="lineno"></span><span class="keyword" id="3361586">func</span>&nbsp;<span class="op" id="3361591">(</span><span class="ident" id="3361592">p</span>&nbsp;<span class="op" id="3361594">*</span><span class="ident" id="3361595">parser</span><span class="op" id="3361601">)</span>&nbsp;<span class="ident" id="3361603">tryResolve</span><span class="op" id="3361613">(</span><span class="ident" id="3361614">x</span>&nbsp;<span class="ident" id="3361616">ast</span><span class="op" id="3361619">.</span><span class="ident" id="3361620">Expr</span><span class="op" id="3361624">,</span>&nbsp;<span class="ident" id="3361626">collectUnresolved</span>&nbsp;<span class="builtintype" id="3361644">bool</span><span class="op" id="3361648">)</span>&nbsp;<span class="op" id="3361650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3361653">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;if&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;identifier&nbsp;or&nbsp;the&nbsp;blank&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361721">ident</span><span class="op" id="3361726">,</span>&nbsp;<span class="ident" id="3361728">_</span>&nbsp;<span class="op" id="3361730">:=</span>&nbsp;<span class="ident" id="3361733">x</span><span class="op" id="3361734">.</span><span class="op" id="3361735">(</span><span class="op" id="3361736">*</span><span class="ident" id="3361737">ast</span><span class="op" id="3361740">.</span><span class="ident" id="3361741">Ident</span><span class="op" id="3361746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361749">if</span>&nbsp;<span class="ident" id="3361752">ident</span>&nbsp;<span class="op" id="3361758">==</span>&nbsp;<span class="ident" id="3361761">nil</span>&nbsp;<span class="op" id="3361765">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361769">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361780">assert</span><span class="op" id="3361786">(</span><span class="ident" id="3361787">ident</span><span class="op" id="3361792">.</span><span class="ident" id="3361793">Obj</span>&nbsp;<span class="op" id="3361797">==</span>&nbsp;<span class="ident" id="3361800">nil</span><span class="op" id="3361803">,</span>&nbsp;<span class="string" id="3361805">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="3361846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361849">if</span>&nbsp;<span class="ident" id="3361852">ident</span><span class="op" id="3361857">.</span><span class="ident" id="3361858">Name</span>&nbsp;<span class="op" id="3361863">==</span>&nbsp;<span class="string" id="3361866">&#34;_&#34;</span>&nbsp;<span class="op" id="3361870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361874">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3361885">//&nbsp;try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361919">for</span>&nbsp;<span class="ident" id="3361923">s</span>&nbsp;<span class="op" id="3361925">:=</span>&nbsp;<span class="ident" id="3361928">p</span><span class="op" id="3361929">.</span><span class="ident" id="3361930">topScope</span><span class="op" id="3361938">;</span>&nbsp;<span class="ident" id="3361940">s</span>&nbsp;<span class="op" id="3361942">!=</span>&nbsp;<span class="ident" id="3361945">nil</span><span class="op" id="3361948">;</span>&nbsp;<span class="ident" id="3361950">s</span>&nbsp;<span class="op" id="3361952">=</span>&nbsp;<span class="ident" id="3361954">s</span><span class="op" id="3361955">.</span><span class="ident" id="3361956">Outer</span>&nbsp;<span class="op" id="3361962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361966">if</span>&nbsp;<span class="ident" id="3361969">obj</span>&nbsp;<span class="op" id="3361973">:=</span>&nbsp;<span class="ident" id="3361976">s</span><span class="op" id="3361977">.</span><span class="ident" id="3361978">Lookup</span><span class="op" id="3361984">(</span><span class="ident" id="3361985">ident</span><span class="op" id="3361990">.</span><span class="ident" id="3361991">Name</span><span class="op" id="3361995">)</span><span class="op" id="3361996">;</span>&nbsp;<span class="ident" id="3361998">obj</span>&nbsp;<span class="op" id="3362002">!=</span>&nbsp;<span class="ident" id="3362005">nil</span>&nbsp;<span class="op" id="3362009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362014">ident</span><span class="op" id="3362019">.</span><span class="ident" id="3362020">Obj</span>&nbsp;<span class="op" id="3362024">=</span>&nbsp;<span class="ident" id="3362026">obj</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362033">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3362042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3362045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3362048">//&nbsp;all&nbsp;local&nbsp;scopes&nbsp;are&nbsp;known,&nbsp;so&nbsp;any&nbsp;unresolved&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3362109">//&nbsp;must&nbsp;be&nbsp;found&nbsp;either&nbsp;in&nbsp;the&nbsp;file&nbsp;scope,&nbsp;package&nbsp;scope</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3362167">//&nbsp;(perhaps&nbsp;in&nbsp;another&nbsp;file),&nbsp;or&nbsp;universe&nbsp;scope&nbsp;---&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3362228">//&nbsp;them&nbsp;so&nbsp;that&nbsp;they&nbsp;can&nbsp;be&nbsp;resolved&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362272">if</span>&nbsp;<span class="ident" id="3362275">collectUnresolved</span>&nbsp;<span class="op" id="3362293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362297">ident</span><span class="op" id="3362302">.</span><span class="ident" id="3362303">Obj</span>&nbsp;<span class="op" id="3362307">=</span>&nbsp;<span class="ident" id="3362309">unresolved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362322">p</span><span class="op" id="3362323">.</span><span class="ident" id="3362324">unresolved</span>&nbsp;<span class="op" id="3362335">=</span>&nbsp;<span class="builtinfunc" id="3362337">append</span><span class="op" id="3362343">(</span><span class="ident" id="3362344">p</span><span class="op" id="3362345">.</span><span class="ident" id="3362346">unresolved</span><span class="op" id="3362356">,</span>&nbsp;<span class="ident" id="3362358">ident</span><span class="op" id="3362363">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3362366">}</span><br>
<span class="lineno"></span><span class="op" id="3362368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3362371">func</span>&nbsp;<span class="op" id="3362376">(</span><span class="ident" id="3362377">p</span>&nbsp;<span class="op" id="3362379">*</span><span class="ident" id="3362380">parser</span><span class="op" id="3362386">)</span>&nbsp;<span class="ident" id="3362388">resolve</span><span class="op" id="3362395">(</span><span class="ident" id="3362396">x</span>&nbsp;<span class="ident" id="3362398">ast</span><span class="op" id="3362401">.</span><span class="ident" id="3362402">Expr</span><span class="op" id="3362406">)</span>&nbsp;<span class="op" id="3362408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362411">p</span><span class="op" id="3362412">.</span><span class="ident" id="3362413">tryResolve</span><span class="op" id="3362423">(</span><span class="ident" id="3362424">x</span><span class="op" id="3362425">,</span>&nbsp;<span class="builtintype" id="3362427">true</span><span class="op" id="3362431">)</span><br>
<span class="lineno">200</span><span class="op" id="3362433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3362436">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3362516">//&nbsp;Parsing&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="3362536">func</span>&nbsp;<span class="op" id="3362541">(</span><span class="ident" id="3362542">p</span>&nbsp;<span class="op" id="3362544">*</span><span class="ident" id="3362545">parser</span><span class="op" id="3362551">)</span>&nbsp;<span class="ident" id="3362553">printTrace</span><span class="op" id="3362563">(</span><span class="ident" id="3362564">a</span>&nbsp;<span class="op" id="3362566">...</span><span class="keyword" id="3362569">interface</span><span class="op" id="3362578">{</span><span class="op" id="3362579">}</span><span class="op" id="3362580">)</span>&nbsp;<span class="op" id="3362582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362585">const</span>&nbsp;<span class="ident" id="3362591">dots</span>&nbsp;<span class="op" id="3362596">=</span>&nbsp;<span class="string" id="3362598">&#34;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362666">const</span>&nbsp;<span class="ident" id="3362672">n</span>&nbsp;<span class="op" id="3362674">=</span>&nbsp;<span class="builtinfunc" id="3362676">len</span><span class="op" id="3362679">(</span><span class="ident" id="3362680">dots</span><span class="op" id="3362684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362687">pos</span>&nbsp;<span class="op" id="3362691">:=</span>&nbsp;<span class="ident" id="3362694">p</span><span class="op" id="3362695">.</span><span class="ident" id="3362696">file</span><span class="op" id="3362700">.</span><span class="ident" id="3362701">Position</span><span class="op" id="3362709">(</span><span class="ident" id="3362710">p</span><span class="op" id="3362711">.</span><span class="ident" id="3362712">pos</span><span class="op" id="3362715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362718">fmt</span><span class="op" id="3362721">.</span><span class="ident" id="3362722">Printf</span><span class="op" id="3362728">(</span><span class="string" id="3362729">&#34;%5d:%3d:&nbsp;&#34;</span><span class="op" id="3362740">,</span>&nbsp;<span class="ident" id="3362742">pos</span><span class="op" id="3362745">.</span><span class="ident" id="3362746">Line</span><span class="op" id="3362750">,</span>&nbsp;<span class="ident" id="3362752">pos</span><span class="op" id="3362755">.</span><span class="ident" id="3362756">Column</span><span class="op" id="3362762">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362765">i</span>&nbsp;<span class="op" id="3362767">:=</span>&nbsp;<span class="num" id="3362770">2</span>&nbsp;<span class="op" id="3362772">*</span>&nbsp;<span class="ident" id="3362774">p</span><span class="op" id="3362775">.</span><span class="ident" id="3362776">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362784">for</span>&nbsp;<span class="ident" id="3362788">i</span>&nbsp;<span class="op" id="3362790">&gt;</span>&nbsp;<span class="ident" id="3362792">n</span>&nbsp;<span class="op" id="3362794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362798">fmt</span><span class="op" id="3362801">.</span><span class="ident" id="3362802">Print</span><span class="op" id="3362807">(</span><span class="ident" id="3362808">dots</span><span class="op" id="3362812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362816">i</span>&nbsp;<span class="op" id="3362818">-=</span>&nbsp;<span class="ident" id="3362821">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3362824">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3362827">//&nbsp;i&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362838">fmt</span><span class="op" id="3362841">.</span><span class="ident" id="3362842">Print</span><span class="op" id="3362847">(</span><span class="ident" id="3362848">dots</span><span class="op" id="3362852">[</span><span class="num" id="3362853">0</span><span class="op" id="3362854">:</span><span class="ident" id="3362855">i</span><span class="op" id="3362856">]</span><span class="op" id="3362857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362860">fmt</span><span class="op" id="3362863">.</span><span class="ident" id="3362864">Println</span><span class="op" id="3362871">(</span><span class="ident" id="3362872">a</span><span class="op" id="3362873">...</span><span class="op" id="3362876">)</span><br>
<span class="lineno"></span><span class="op" id="3362878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="keyword" id="3362881">func</span>&nbsp;<span class="ident" id="3362886">trace</span><span class="op" id="3362891">(</span><span class="ident" id="3362892">p</span>&nbsp;<span class="op" id="3362894">*</span><span class="ident" id="3362895">parser</span><span class="op" id="3362901">,</span>&nbsp;<span class="ident" id="3362903">msg</span>&nbsp;<span class="builtintype" id="3362907">string</span><span class="op" id="3362913">)</span>&nbsp;<span class="op" id="3362915">*</span><span class="ident" id="3362916">parser</span>&nbsp;<span class="op" id="3362923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362926">p</span><span class="op" id="3362927">.</span><span class="ident" id="3362928">printTrace</span><span class="op" id="3362938">(</span><span class="ident" id="3362939">msg</span><span class="op" id="3362942">,</span>&nbsp;<span class="string" id="3362944">&#34;(&#34;</span><span class="op" id="3362947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362950">p</span><span class="op" id="3362951">.</span><span class="ident" id="3362952">indent</span><span class="op" id="3362958">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362962">return</span>&nbsp;<span class="ident" id="3362969">p</span><br>
<span class="lineno"></span><span class="op" id="3362971">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="3362974">//&nbsp;Usage&nbsp;pattern:&nbsp;defer&nbsp;un(trace(p,&nbsp;&#34;...&#34;))</span><br>
<span class="lineno"></span><span class="keyword" id="3363018">func</span>&nbsp;<span class="ident" id="3363023">un</span><span class="op" id="3363025">(</span><span class="ident" id="3363026">p</span>&nbsp;<span class="op" id="3363028">*</span><span class="ident" id="3363029">parser</span><span class="op" id="3363035">)</span>&nbsp;<span class="op" id="3363037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363040">p</span><span class="op" id="3363041">.</span><span class="ident" id="3363042">indent</span><span class="op" id="3363048">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363052">p</span><span class="op" id="3363053">.</span><span class="ident" id="3363054">printTrace</span><span class="op" id="3363064">(</span><span class="string" id="3363065">&#34;)&#34;</span><span class="op" id="3363068">)</span><br>
<span class="lineno">230</span><span class="op" id="3363070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3363073">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="3363103">func</span>&nbsp;<span class="op" id="3363108">(</span><span class="ident" id="3363109">p</span>&nbsp;<span class="op" id="3363111">*</span><span class="ident" id="3363112">parser</span><span class="op" id="3363118">)</span>&nbsp;<span class="ident" id="3363120">next0</span><span class="op" id="3363125">(</span><span class="op" id="3363126">)</span>&nbsp;<span class="op" id="3363128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3363131">//&nbsp;Because&nbsp;of&nbsp;one-token&nbsp;look-ahead,&nbsp;print&nbsp;the&nbsp;previous&nbsp;token</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3363193">//&nbsp;when&nbsp;tracing&nbsp;as&nbsp;it&nbsp;provides&nbsp;a&nbsp;more&nbsp;readable&nbsp;output.&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3363253">//&nbsp;very&nbsp;first&nbsp;token&nbsp;(!p.pos.IsValid())&nbsp;is&nbsp;not&nbsp;initialized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3363312">//&nbsp;(it&nbsp;is&nbsp;token.ILLEGAL),&nbsp;so&nbsp;don&#39;t&nbsp;print&nbsp;it&nbsp;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363359">if</span>&nbsp;<span class="ident" id="3363362">p</span><span class="op" id="3363363">.</span><span class="ident" id="3363364">trace</span>&nbsp;<span class="op" id="3363370">&amp;&amp;</span>&nbsp;<span class="ident" id="3363373">p</span><span class="op" id="3363374">.</span><span class="ident" id="3363375">pos</span><span class="op" id="3363378">.</span><span class="ident" id="3363379">IsValid</span><span class="op" id="3363386">(</span><span class="op" id="3363387">)</span>&nbsp;<span class="op" id="3363389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363393">s</span>&nbsp;<span class="op" id="3363395">:=</span>&nbsp;<span class="ident" id="3363398">p</span><span class="op" id="3363399">.</span><span class="ident" id="3363400">tok</span><span class="op" id="3363403">.</span><span class="ident" id="3363404">String</span><span class="op" id="3363410">(</span><span class="op" id="3363411">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363415">switch</span>&nbsp;<span class="op" id="3363422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363426">case</span>&nbsp;<span class="ident" id="3363431">p</span><span class="op" id="3363432">.</span><span class="ident" id="3363433">tok</span><span class="op" id="3363436">.</span><span class="ident" id="3363437">IsLiteral</span><span class="op" id="3363446">(</span><span class="op" id="3363447">)</span><span class="op" id="3363448">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363453">p</span><span class="op" id="3363454">.</span><span class="ident" id="3363455">printTrace</span><span class="op" id="3363465">(</span><span class="ident" id="3363466">s</span><span class="op" id="3363467">,</span>&nbsp;<span class="ident" id="3363469">p</span><span class="op" id="3363470">.</span><span class="ident" id="3363471">lit</span><span class="op" id="3363474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363478">case</span>&nbsp;<span class="ident" id="3363483">p</span><span class="op" id="3363484">.</span><span class="ident" id="3363485">tok</span><span class="op" id="3363488">.</span><span class="ident" id="3363489">IsOperator</span><span class="op" id="3363499">(</span><span class="op" id="3363500">)</span><span class="op" id="3363501">,</span>&nbsp;<span class="ident" id="3363503">p</span><span class="op" id="3363504">.</span><span class="ident" id="3363505">tok</span><span class="op" id="3363508">.</span><span class="ident" id="3363509">IsKeyword</span><span class="op" id="3363518">(</span><span class="op" id="3363519">)</span><span class="op" id="3363520">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363525">p</span><span class="op" id="3363526">.</span><span class="ident" id="3363527">printTrace</span><span class="op" id="3363537">(</span><span class="string" id="3363538">&#34;\&#34;&#34;</span>&nbsp;<span class="op" id="3363543">+</span>&nbsp;<span class="ident" id="3363545">s</span>&nbsp;<span class="op" id="3363547">+</span>&nbsp;<span class="string" id="3363549">&#34;\&#34;&#34;</span><span class="op" id="3363553">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363557">default</span><span class="op" id="3363564">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363569">p</span><span class="op" id="3363570">.</span><span class="ident" id="3363571">printTrace</span><span class="op" id="3363581">(</span><span class="ident" id="3363582">s</span><span class="op" id="3363583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3363587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3363590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363594">p</span><span class="op" id="3363595">.</span><span class="ident" id="3363596">pos</span><span class="op" id="3363599">,</span>&nbsp;<span class="ident" id="3363601">p</span><span class="op" id="3363602">.</span><span class="ident" id="3363603">tok</span><span class="op" id="3363606">,</span>&nbsp;<span class="ident" id="3363608">p</span><span class="op" id="3363609">.</span><span class="ident" id="3363610">lit</span>&nbsp;<span class="op" id="3363614">=</span>&nbsp;<span class="ident" id="3363616">p</span><span class="op" id="3363617">.</span><span class="ident" id="3363618">scanner</span><span class="op" id="3363625">.</span><span class="ident" id="3363626">Scan</span><span class="op" id="3363630">(</span><span class="op" id="3363631">)</span><br>
<span class="lineno"></span><span class="op" id="3363633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3363636">//&nbsp;Consume&nbsp;a&nbsp;comment&nbsp;and&nbsp;return&nbsp;it&nbsp;and&nbsp;the&nbsp;line&nbsp;on&nbsp;which&nbsp;it&nbsp;ends.</span><br>
<span class="lineno"></span><span class="keyword" id="3363702">func</span>&nbsp;<span class="op" id="3363707">(</span><span class="ident" id="3363708">p</span>&nbsp;<span class="op" id="3363710">*</span><span class="ident" id="3363711">parser</span><span class="op" id="3363717">)</span>&nbsp;<span class="ident" id="3363719">consumeComment</span><span class="op" id="3363733">(</span><span class="op" id="3363734">)</span>&nbsp;<span class="op" id="3363736">(</span><span class="ident" id="3363737">comment</span>&nbsp;<span class="op" id="3363745">*</span><span class="ident" id="3363746">ast</span><span class="op" id="3363749">.</span><span class="ident" id="3363750">Comment</span><span class="op" id="3363757">,</span>&nbsp;<span class="ident" id="3363759">endline</span>&nbsp;<span class="builtintype" id="3363767">int</span><span class="op" id="3363770">)</span>&nbsp;<span class="op" id="3363772">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3363775">//&nbsp;/*-style&nbsp;comments&nbsp;may&nbsp;end&nbsp;on&nbsp;a&nbsp;different&nbsp;line&nbsp;than&nbsp;where&nbsp;they&nbsp;start.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3363848">//&nbsp;Scan&nbsp;the&nbsp;comment&nbsp;for&nbsp;&#39;\n&#39;&nbsp;chars&nbsp;and&nbsp;adjust&nbsp;endline&nbsp;accordingly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3363916">endline</span>&nbsp;<span class="op" id="3363924">=</span>&nbsp;<span class="ident" id="3363926">p</span><span class="op" id="3363927">.</span><span class="ident" id="3363928">file</span><span class="op" id="3363932">.</span><span class="ident" id="3363933">Line</span><span class="op" id="3363937">(</span><span class="ident" id="3363938">p</span><span class="op" id="3363939">.</span><span class="ident" id="3363940">pos</span><span class="op" id="3363943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3363946">if</span>&nbsp;<span class="ident" id="3363949">p</span><span class="op" id="3363950">.</span><span class="ident" id="3363951">lit</span><span class="op" id="3363954">[</span><span class="num" id="3363955">1</span><span class="op" id="3363956">]</span>&nbsp;<span class="op" id="3363958">==</span>&nbsp;<span class="string" id="3363961">&#39;*&#39;</span>&nbsp;<span class="op" id="3363965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3363969">//&nbsp;don&#39;t&nbsp;use&nbsp;range&nbsp;here&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;decode&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364035">for</span>&nbsp;<span class="ident" id="3364039">i</span>&nbsp;<span class="op" id="3364041">:=</span>&nbsp;<span class="num" id="3364044">0</span><span class="op" id="3364045">;</span>&nbsp;<span class="ident" id="3364047">i</span>&nbsp;<span class="op" id="3364049">&lt;</span>&nbsp;<span class="builtinfunc" id="3364051">len</span><span class="op" id="3364054">(</span><span class="ident" id="3364055">p</span><span class="op" id="3364056">.</span><span class="ident" id="3364057">lit</span><span class="op" id="3364060">)</span><span class="op" id="3364061">;</span>&nbsp;<span class="ident" id="3364063">i</span><span class="op" id="3364064">++</span>&nbsp;<span class="op" id="3364067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364072">if</span>&nbsp;<span class="ident" id="3364075">p</span><span class="op" id="3364076">.</span><span class="ident" id="3364077">lit</span><span class="op" id="3364080">[</span><span class="ident" id="3364081">i</span><span class="op" id="3364082">]</span>&nbsp;<span class="op" id="3364084">==</span>&nbsp;<span class="string" id="3364087">&#39;\n&#39;</span>&nbsp;<span class="op" id="3364092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364098">endline</span><span class="op" id="3364105">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364115">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364122">comment</span>&nbsp;<span class="op" id="3364130">=</span>&nbsp;<span class="op" id="3364132">&amp;</span><span class="ident" id="3364133">ast</span><span class="op" id="3364136">.</span><span class="ident" id="3364137">Comment</span><span class="op" id="3364144">{</span><span class="ident" id="3364145">Slash</span><span class="op" id="3364150">:</span>&nbsp;<span class="ident" id="3364152">p</span><span class="op" id="3364153">.</span><span class="ident" id="3364154">pos</span><span class="op" id="3364157">,</span>&nbsp;<span class="ident" id="3364159">Text</span><span class="op" id="3364163">:</span>&nbsp;<span class="ident" id="3364165">p</span><span class="op" id="3364166">.</span><span class="ident" id="3364167">lit</span><span class="op" id="3364170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364173">p</span><span class="op" id="3364174">.</span><span class="ident" id="3364175">next0</span><span class="op" id="3364180">(</span><span class="op" id="3364181">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364185">return</span><br>
<span class="lineno"></span><span class="op" id="3364192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3364195">//&nbsp;Consume&nbsp;a&nbsp;group&nbsp;of&nbsp;adjacent&nbsp;comments,&nbsp;add&nbsp;it&nbsp;to&nbsp;the&nbsp;parser&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3364259">//&nbsp;comments&nbsp;list,&nbsp;and&nbsp;return&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;line&nbsp;at&nbsp;which</span><br>
<span class="lineno">275</span><span class="comment" id="3364323">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;in&nbsp;the&nbsp;group&nbsp;ends.&nbsp;A&nbsp;non-comment&nbsp;token&nbsp;or&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3364387">//&nbsp;empty&nbsp;lines&nbsp;terminate&nbsp;a&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="3364429">//</span><br>
<span class="lineno"></span><span class="keyword" id="3364432">func</span>&nbsp;<span class="op" id="3364437">(</span><span class="ident" id="3364438">p</span>&nbsp;<span class="op" id="3364440">*</span><span class="ident" id="3364441">parser</span><span class="op" id="3364447">)</span>&nbsp;<span class="ident" id="3364449">consumeCommentGroup</span><span class="op" id="3364468">(</span><span class="ident" id="3364469">n</span>&nbsp;<span class="builtintype" id="3364471">int</span><span class="op" id="3364474">)</span>&nbsp;<span class="op" id="3364476">(</span><span class="ident" id="3364477">comments</span>&nbsp;<span class="op" id="3364486">*</span><span class="ident" id="3364487">ast</span><span class="op" id="3364490">.</span><span class="ident" id="3364491">CommentGroup</span><span class="op" id="3364503">,</span>&nbsp;<span class="ident" id="3364505">endline</span>&nbsp;<span class="builtintype" id="3364513">int</span><span class="op" id="3364516">)</span>&nbsp;<span class="op" id="3364518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364521">var</span>&nbsp;<span class="ident" id="3364525">list</span>&nbsp;<span class="op" id="3364530">[</span><span class="op" id="3364531">]</span><span class="op" id="3364532">*</span><span class="ident" id="3364533">ast</span><span class="op" id="3364536">.</span><span class="ident" id="3364537">Comment</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364546">endline</span>&nbsp;<span class="op" id="3364554">=</span>&nbsp;<span class="ident" id="3364556">p</span><span class="op" id="3364557">.</span><span class="ident" id="3364558">file</span><span class="op" id="3364562">.</span><span class="ident" id="3364563">Line</span><span class="op" id="3364567">(</span><span class="ident" id="3364568">p</span><span class="op" id="3364569">.</span><span class="ident" id="3364570">pos</span><span class="op" id="3364573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364576">for</span>&nbsp;<span class="ident" id="3364580">p</span><span class="op" id="3364581">.</span><span class="ident" id="3364582">tok</span>&nbsp;<span class="op" id="3364586">==</span>&nbsp;<span class="ident" id="3364589">token</span><span class="op" id="3364594">.</span><span class="ident" id="3364595">COMMENT</span>&nbsp;<span class="op" id="3364603">&amp;&amp;</span>&nbsp;<span class="ident" id="3364606">p</span><span class="op" id="3364607">.</span><span class="ident" id="3364608">file</span><span class="op" id="3364612">.</span><span class="ident" id="3364613">Line</span><span class="op" id="3364617">(</span><span class="ident" id="3364618">p</span><span class="op" id="3364619">.</span><span class="ident" id="3364620">pos</span><span class="op" id="3364623">)</span>&nbsp;<span class="op" id="3364625">&lt;=</span>&nbsp;<span class="ident" id="3364628">endline</span><span class="op" id="3364635">+</span><span class="ident" id="3364636">n</span>&nbsp;<span class="op" id="3364638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364642">var</span>&nbsp;<span class="ident" id="3364646">comment</span>&nbsp;<span class="op" id="3364654">*</span><span class="ident" id="3364655">ast</span><span class="op" id="3364658">.</span><span class="ident" id="3364659">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364669">comment</span><span class="op" id="3364676">,</span>&nbsp;<span class="ident" id="3364678">endline</span>&nbsp;<span class="op" id="3364686">=</span>&nbsp;<span class="ident" id="3364688">p</span><span class="op" id="3364689">.</span><span class="ident" id="3364690">consumeComment</span><span class="op" id="3364704">(</span><span class="op" id="3364705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364709">list</span>&nbsp;<span class="op" id="3364714">=</span>&nbsp;<span class="builtinfunc" id="3364716">append</span><span class="op" id="3364722">(</span><span class="ident" id="3364723">list</span><span class="op" id="3364727">,</span>&nbsp;<span class="ident" id="3364729">comment</span><span class="op" id="3364736">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3364739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3364743">//&nbsp;add&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;comments&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364786">comments</span>&nbsp;<span class="op" id="3364795">=</span>&nbsp;<span class="op" id="3364797">&amp;</span><span class="ident" id="3364798">ast</span><span class="op" id="3364801">.</span><span class="ident" id="3364802">CommentGroup</span><span class="op" id="3364814">{</span><span class="ident" id="3364815">List</span><span class="op" id="3364819">:</span>&nbsp;<span class="ident" id="3364821">list</span><span class="op" id="3364825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3364828">p</span><span class="op" id="3364829">.</span><span class="ident" id="3364830">comments</span>&nbsp;<span class="op" id="3364839">=</span>&nbsp;<span class="builtinfunc" id="3364841">append</span><span class="op" id="3364847">(</span><span class="ident" id="3364848">p</span><span class="op" id="3364849">.</span><span class="ident" id="3364850">comments</span><span class="op" id="3364858">,</span>&nbsp;<span class="ident" id="3364860">comments</span><span class="op" id="3364868">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3364872">return</span><br>
<span class="lineno"></span><span class="op" id="3364879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3364882">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;non-comment&nbsp;token.&nbsp;In&nbsp;the&nbsp;process,&nbsp;collect</span><br>
<span class="lineno">295</span><span class="comment" id="3364948">//&nbsp;any&nbsp;comment&nbsp;groups&nbsp;encountered,&nbsp;and&nbsp;remember&nbsp;the&nbsp;last&nbsp;lead&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3365014">//&nbsp;and&nbsp;line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="3365036">//</span><br>
<span class="lineno"></span><span class="comment" id="3365039">//&nbsp;A&nbsp;lead&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;starts&nbsp;and&nbsp;ends&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3365102">//&nbsp;line&nbsp;without&nbsp;any&nbsp;other&nbsp;tokens&nbsp;and&nbsp;that&nbsp;is&nbsp;followed&nbsp;by&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno">300</span><span class="comment" id="3365173">//&nbsp;token&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="3365231">//</span><br>
<span class="lineno"></span><span class="comment" id="3365234">//&nbsp;A&nbsp;line&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;follows&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno"></span><span class="comment" id="3365298">//&nbsp;token&nbsp;on&nbsp;the&nbsp;same&nbsp;line,&nbsp;and&nbsp;that&nbsp;has&nbsp;no&nbsp;tokens&nbsp;after&nbsp;it&nbsp;on&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3365369">//&nbsp;where&nbsp;it&nbsp;ends.</span><br>
<span class="lineno">305</span><span class="comment" id="3365387">//</span><br>
<span class="lineno"></span><span class="comment" id="3365390">//&nbsp;Lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;may&nbsp;be&nbsp;considered&nbsp;documentation&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3365456">//&nbsp;stored&nbsp;in&nbsp;the&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="3365478">//</span><br>
<span class="lineno"></span><span class="keyword" id="3365481">func</span>&nbsp;<span class="op" id="3365486">(</span><span class="ident" id="3365487">p</span>&nbsp;<span class="op" id="3365489">*</span><span class="ident" id="3365490">parser</span><span class="op" id="3365496">)</span>&nbsp;<span class="ident" id="3365498">next</span><span class="op" id="3365502">(</span><span class="op" id="3365503">)</span>&nbsp;<span class="op" id="3365505">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365508">p</span><span class="op" id="3365509">.</span><span class="ident" id="3365510">leadComment</span>&nbsp;<span class="op" id="3365522">=</span>&nbsp;<span class="ident" id="3365524">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365529">p</span><span class="op" id="3365530">.</span><span class="ident" id="3365531">lineComment</span>&nbsp;<span class="op" id="3365543">=</span>&nbsp;<span class="ident" id="3365545">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365550">prev</span>&nbsp;<span class="op" id="3365555">:=</span>&nbsp;<span class="ident" id="3365558">p</span><span class="op" id="3365559">.</span><span class="ident" id="3365560">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365565">p</span><span class="op" id="3365566">.</span><span class="ident" id="3365567">next0</span><span class="op" id="3365572">(</span><span class="op" id="3365573">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365577">if</span>&nbsp;<span class="ident" id="3365580">p</span><span class="op" id="3365581">.</span><span class="ident" id="3365582">tok</span>&nbsp;<span class="op" id="3365586">==</span>&nbsp;<span class="ident" id="3365589">token</span><span class="op" id="3365594">.</span><span class="ident" id="3365595">COMMENT</span>&nbsp;<span class="op" id="3365603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365607">var</span>&nbsp;<span class="ident" id="3365611">comment</span>&nbsp;<span class="op" id="3365619">*</span><span class="ident" id="3365620">ast</span><span class="op" id="3365623">.</span><span class="ident" id="3365624">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365639">var</span>&nbsp;<span class="ident" id="3365643">endline</span>&nbsp;<span class="builtintype" id="3365651">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365658">if</span>&nbsp;<span class="ident" id="3365661">p</span><span class="op" id="3365662">.</span><span class="ident" id="3365663">file</span><span class="op" id="3365667">.</span><span class="ident" id="3365668">Line</span><span class="op" id="3365672">(</span><span class="ident" id="3365673">p</span><span class="op" id="3365674">.</span><span class="ident" id="3365675">pos</span><span class="op" id="3365678">)</span>&nbsp;<span class="op" id="3365680">==</span>&nbsp;<span class="ident" id="3365683">p</span><span class="op" id="3365684">.</span><span class="ident" id="3365685">file</span><span class="op" id="3365689">.</span><span class="ident" id="3365690">Line</span><span class="op" id="3365694">(</span><span class="ident" id="3365695">prev</span><span class="op" id="3365699">)</span>&nbsp;<span class="op" id="3365701">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3365706">//&nbsp;The&nbsp;comment&nbsp;is&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;token;&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3365766">//&nbsp;cannot&nbsp;be&nbsp;a&nbsp;lead&nbsp;comment&nbsp;but&nbsp;may&nbsp;be&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3365824">comment</span><span class="op" id="3365831">,</span>&nbsp;<span class="ident" id="3365833">endline</span>&nbsp;<span class="op" id="3365841">=</span>&nbsp;<span class="ident" id="3365843">p</span><span class="op" id="3365844">.</span><span class="ident" id="3365845">consumeCommentGroup</span><span class="op" id="3365864">(</span><span class="num" id="3365865">0</span><span class="op" id="3365866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3365871">if</span>&nbsp;<span class="ident" id="3365874">p</span><span class="op" id="3365875">.</span><span class="ident" id="3365876">file</span><span class="op" id="3365880">.</span><span class="ident" id="3365881">Line</span><span class="op" id="3365885">(</span><span class="ident" id="3365886">p</span><span class="op" id="3365887">.</span><span class="ident" id="3365888">pos</span><span class="op" id="3365891">)</span>&nbsp;<span class="op" id="3365893">!=</span>&nbsp;<span class="ident" id="3365896">endline</span>&nbsp;<span class="op" id="3365904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3365910">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;on&nbsp;a&nbsp;different&nbsp;line,&nbsp;thus</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3365961">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366010">p</span><span class="op" id="3366011">.</span><span class="ident" id="3366012">lineComment</span>&nbsp;<span class="op" id="3366024">=</span>&nbsp;<span class="ident" id="3366026">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3366046">//&nbsp;consume&nbsp;successor&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366086">endline</span>&nbsp;<span class="op" id="3366094">=</span>&nbsp;<span class="op" id="3366096">-</span><span class="num" id="3366097">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366101">for</span>&nbsp;<span class="ident" id="3366105">p</span><span class="op" id="3366106">.</span><span class="ident" id="3366107">tok</span>&nbsp;<span class="op" id="3366111">==</span>&nbsp;<span class="ident" id="3366114">token</span><span class="op" id="3366119">.</span><span class="ident" id="3366120">COMMENT</span>&nbsp;<span class="op" id="3366128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366133">comment</span><span class="op" id="3366140">,</span>&nbsp;<span class="ident" id="3366142">endline</span>&nbsp;<span class="op" id="3366150">=</span>&nbsp;<span class="ident" id="3366152">p</span><span class="op" id="3366153">.</span><span class="ident" id="3366154">consumeCommentGroup</span><span class="op" id="3366173">(</span><span class="num" id="3366174">1</span><span class="op" id="3366175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366179">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366184">if</span>&nbsp;<span class="ident" id="3366187">endline</span><span class="op" id="3366194">+</span><span class="num" id="3366195">1</span>&nbsp;<span class="op" id="3366197">==</span>&nbsp;<span class="ident" id="3366200">p</span><span class="op" id="3366201">.</span><span class="ident" id="3366202">file</span><span class="op" id="3366206">.</span><span class="ident" id="3366207">Line</span><span class="op" id="3366211">(</span><span class="ident" id="3366212">p</span><span class="op" id="3366213">.</span><span class="ident" id="3366214">pos</span><span class="op" id="3366217">)</span>&nbsp;<span class="op" id="3366219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3366224">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;following&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3366292">//&nbsp;comment&nbsp;group,&nbsp;thus&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;lead&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366360">p</span><span class="op" id="3366361">.</span><span class="ident" id="3366362">leadComment</span>&nbsp;<span class="op" id="3366374">=</span>&nbsp;<span class="ident" id="3366376">comment</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366389">}</span><br>
<span class="lineno"></span><span class="op" id="3366391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3366394">//&nbsp;A&nbsp;bailout&nbsp;panic&nbsp;is&nbsp;raised&nbsp;to&nbsp;indicate&nbsp;early&nbsp;termination.</span><br>
<span class="lineno">345</span><span class="keyword" id="3366454">type</span>&nbsp;<span class="ident" id="3366459">bailout</span>&nbsp;<span class="keyword" id="3366467">struct</span><span class="op" id="3366473">{</span><span class="op" id="3366474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3366477">func</span>&nbsp;<span class="op" id="3366482">(</span><span class="ident" id="3366483">p</span>&nbsp;<span class="op" id="3366485">*</span><span class="ident" id="3366486">parser</span><span class="op" id="3366492">)</span>&nbsp;<span class="builtintype" id="3366494">error</span><span class="op" id="3366499">(</span><span class="ident" id="3366500">pos</span>&nbsp;<span class="ident" id="3366504">token</span><span class="op" id="3366509">.</span><span class="ident" id="3366510">Pos</span><span class="op" id="3366513">,</span>&nbsp;<span class="ident" id="3366515">msg</span>&nbsp;<span class="builtintype" id="3366519">string</span><span class="op" id="3366525">)</span>&nbsp;<span class="op" id="3366527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366530">epos</span>&nbsp;<span class="op" id="3366535">:=</span>&nbsp;<span class="ident" id="3366538">p</span><span class="op" id="3366539">.</span><span class="ident" id="3366540">file</span><span class="op" id="3366544">.</span><span class="ident" id="3366545">Position</span><span class="op" id="3366553">(</span><span class="ident" id="3366554">pos</span><span class="op" id="3366557">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3366561">//&nbsp;If&nbsp;AllErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;discard&nbsp;errors&nbsp;reported&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3366631">//&nbsp;as&nbsp;the&nbsp;last&nbsp;recorded&nbsp;error&nbsp;and&nbsp;stop&nbsp;parsing&nbsp;if&nbsp;there&nbsp;are&nbsp;more&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3366702">//&nbsp;10&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366717">if</span>&nbsp;<span class="ident" id="3366720">p</span><span class="op" id="3366721">.</span><span class="ident" id="3366722">mode</span><span class="op" id="3366726">&amp;</span><span class="ident" id="3366727">AllErrors</span>&nbsp;<span class="op" id="3366737">==</span>&nbsp;<span class="num" id="3366740">0</span>&nbsp;<span class="op" id="3366742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366746">n</span>&nbsp;<span class="op" id="3366748">:=</span>&nbsp;<span class="builtinfunc" id="3366751">len</span><span class="op" id="3366754">(</span><span class="ident" id="3366755">p</span><span class="op" id="3366756">.</span><span class="ident" id="3366757">errors</span><span class="op" id="3366763">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366767">if</span>&nbsp;<span class="ident" id="3366770">n</span>&nbsp;<span class="op" id="3366772">&gt;</span>&nbsp;<span class="num" id="3366774">0</span>&nbsp;<span class="op" id="3366776">&amp;&amp;</span>&nbsp;<span class="ident" id="3366779">p</span><span class="op" id="3366780">.</span><span class="ident" id="3366781">errors</span><span class="op" id="3366787">[</span><span class="ident" id="3366788">n</span><span class="op" id="3366789">-</span><span class="num" id="3366790">1</span><span class="op" id="3366791">]</span><span class="op" id="3366792">.</span><span class="ident" id="3366793">Pos</span><span class="op" id="3366796">.</span><span class="ident" id="3366797">Line</span>&nbsp;<span class="op" id="3366802">==</span>&nbsp;<span class="ident" id="3366805">epos</span><span class="op" id="3366809">.</span><span class="ident" id="3366810">Line</span>&nbsp;<span class="op" id="3366815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366820">return</span>&nbsp;<span class="comment" id="3366827">//&nbsp;discard&nbsp;-&nbsp;likely&nbsp;a&nbsp;spurious&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3366870">if</span>&nbsp;<span class="ident" id="3366873">n</span>&nbsp;<span class="op" id="3366875">&gt;</span>&nbsp;<span class="num" id="3366877">10</span>&nbsp;<span class="op" id="3366880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3366885">panic</span><span class="op" id="3366890">(</span><span class="ident" id="3366891">bailout</span><span class="op" id="3366898">{</span><span class="op" id="3366899">}</span><span class="op" id="3366900">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3366907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366911">p</span><span class="op" id="3366912">.</span><span class="ident" id="3366913">errors</span><span class="op" id="3366919">.</span><span class="ident" id="3366920">Add</span><span class="op" id="3366923">(</span><span class="ident" id="3366924">epos</span><span class="op" id="3366928">,</span>&nbsp;<span class="ident" id="3366930">msg</span><span class="op" id="3366933">)</span><br>
<span class="lineno"></span><span class="op" id="3366935">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="3366938">func</span>&nbsp;<span class="op" id="3366943">(</span><span class="ident" id="3366944">p</span>&nbsp;<span class="op" id="3366946">*</span><span class="ident" id="3366947">parser</span><span class="op" id="3366953">)</span>&nbsp;<span class="ident" id="3366955">errorExpected</span><span class="op" id="3366968">(</span><span class="ident" id="3366969">pos</span>&nbsp;<span class="ident" id="3366973">token</span><span class="op" id="3366978">.</span><span class="ident" id="3366979">Pos</span><span class="op" id="3366982">,</span>&nbsp;<span class="ident" id="3366984">msg</span>&nbsp;<span class="builtintype" id="3366988">string</span><span class="op" id="3366994">)</span>&nbsp;<span class="op" id="3366996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3366999">msg</span>&nbsp;<span class="op" id="3367003">=</span>&nbsp;<span class="string" id="3367005">&#34;expected&nbsp;&#34;</span>&nbsp;<span class="op" id="3367017">+</span>&nbsp;<span class="ident" id="3367019">msg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367024">if</span>&nbsp;<span class="ident" id="3367027">pos</span>&nbsp;<span class="op" id="3367031">==</span>&nbsp;<span class="ident" id="3367034">p</span><span class="op" id="3367035">.</span><span class="ident" id="3367036">pos</span>&nbsp;<span class="op" id="3367040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3367044">//&nbsp;the&nbsp;error&nbsp;happened&nbsp;at&nbsp;the&nbsp;current&nbsp;position;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3367093">//&nbsp;make&nbsp;the&nbsp;error&nbsp;message&nbsp;more&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367135">if</span>&nbsp;<span class="ident" id="3367138">p</span><span class="op" id="3367139">.</span><span class="ident" id="3367140">tok</span>&nbsp;<span class="op" id="3367144">==</span>&nbsp;<span class="ident" id="3367147">token</span><span class="op" id="3367152">.</span><span class="ident" id="3367153">SEMICOLON</span>&nbsp;<span class="op" id="3367163">&amp;&amp;</span>&nbsp;<span class="ident" id="3367166">p</span><span class="op" id="3367167">.</span><span class="ident" id="3367168">lit</span>&nbsp;<span class="op" id="3367172">==</span>&nbsp;<span class="string" id="3367175">&#34;\n&#34;</span>&nbsp;<span class="op" id="3367180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367185">msg</span>&nbsp;<span class="op" id="3367189">+=</span>&nbsp;<span class="string" id="3367192">&#34;,&nbsp;found&nbsp;newline&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367212">}</span>&nbsp;<span class="keyword" id="3367214">else</span>&nbsp;<span class="op" id="3367219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367224">msg</span>&nbsp;<span class="op" id="3367228">+=</span>&nbsp;<span class="string" id="3367231">&#34;,&nbsp;found&nbsp;&#39;&#34;</span>&nbsp;<span class="op" id="3367243">+</span>&nbsp;<span class="ident" id="3367245">p</span><span class="op" id="3367246">.</span><span class="ident" id="3367247">tok</span><span class="op" id="3367250">.</span><span class="ident" id="3367251">String</span><span class="op" id="3367257">(</span><span class="op" id="3367258">)</span>&nbsp;<span class="op" id="3367260">+</span>&nbsp;<span class="string" id="3367262">&#34;&#39;&#34;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367269">if</span>&nbsp;<span class="ident" id="3367272">p</span><span class="op" id="3367273">.</span><span class="ident" id="3367274">tok</span><span class="op" id="3367277">.</span><span class="ident" id="3367278">IsLiteral</span><span class="op" id="3367287">(</span><span class="op" id="3367288">)</span>&nbsp;<span class="op" id="3367290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367296">msg</span>&nbsp;<span class="op" id="3367300">+=</span>&nbsp;<span class="string" id="3367303">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3367307">+</span>&nbsp;<span class="ident" id="3367309">p</span><span class="op" id="3367310">.</span><span class="ident" id="3367311">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367325">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367328">p</span><span class="op" id="3367329">.</span><span class="builtintype" id="3367330">error</span><span class="op" id="3367335">(</span><span class="ident" id="3367336">pos</span><span class="op" id="3367339">,</span>&nbsp;<span class="ident" id="3367341">msg</span><span class="op" id="3367344">)</span><br>
<span class="lineno"></span><span class="op" id="3367346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3367349">func</span>&nbsp;<span class="op" id="3367354">(</span><span class="ident" id="3367355">p</span>&nbsp;<span class="op" id="3367357">*</span><span class="ident" id="3367358">parser</span><span class="op" id="3367364">)</span>&nbsp;<span class="ident" id="3367366">expect</span><span class="op" id="3367372">(</span><span class="ident" id="3367373">tok</span>&nbsp;<span class="ident" id="3367377">token</span><span class="op" id="3367382">.</span><span class="ident" id="3367383">Token</span><span class="op" id="3367388">)</span>&nbsp;<span class="ident" id="3367390">token</span><span class="op" id="3367395">.</span><span class="ident" id="3367396">Pos</span>&nbsp;<span class="op" id="3367400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367403">pos</span>&nbsp;<span class="op" id="3367407">:=</span>&nbsp;<span class="ident" id="3367410">p</span><span class="op" id="3367411">.</span><span class="ident" id="3367412">pos</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367417">if</span>&nbsp;<span class="ident" id="3367420">p</span><span class="op" id="3367421">.</span><span class="ident" id="3367422">tok</span>&nbsp;<span class="op" id="3367426">!=</span>&nbsp;<span class="ident" id="3367429">tok</span>&nbsp;<span class="op" id="3367433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367437">p</span><span class="op" id="3367438">.</span><span class="ident" id="3367439">errorExpected</span><span class="op" id="3367452">(</span><span class="ident" id="3367453">pos</span><span class="op" id="3367456">,</span>&nbsp;<span class="string" id="3367458">&#34;&#39;&#34;</span><span class="op" id="3367461">+</span><span class="ident" id="3367462">tok</span><span class="op" id="3367465">.</span><span class="ident" id="3367466">String</span><span class="op" id="3367472">(</span><span class="op" id="3367473">)</span><span class="op" id="3367474">+</span><span class="string" id="3367475">&#34;&#39;&#34;</span><span class="op" id="3367478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367484">p</span><span class="op" id="3367485">.</span><span class="ident" id="3367486">next</span><span class="op" id="3367490">(</span><span class="op" id="3367491">)</span>&nbsp;<span class="comment" id="3367493">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367511">return</span>&nbsp;<span class="ident" id="3367518">pos</span><br>
<span class="lineno">390</span><span class="op" id="3367522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3367525">//&nbsp;expectClosing&nbsp;is&nbsp;like&nbsp;expect&nbsp;but&nbsp;provides&nbsp;a&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3367593">//&nbsp;for&nbsp;the&nbsp;common&nbsp;case&nbsp;of&nbsp;a&nbsp;missing&nbsp;comma&nbsp;before&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span><span class="comment" id="3367653">//</span><br>
<span class="lineno">395</span><span class="keyword" id="3367656">func</span>&nbsp;<span class="op" id="3367661">(</span><span class="ident" id="3367662">p</span>&nbsp;<span class="op" id="3367664">*</span><span class="ident" id="3367665">parser</span><span class="op" id="3367671">)</span>&nbsp;<span class="ident" id="3367673">expectClosing</span><span class="op" id="3367686">(</span><span class="ident" id="3367687">tok</span>&nbsp;<span class="ident" id="3367691">token</span><span class="op" id="3367696">.</span><span class="ident" id="3367697">Token</span><span class="op" id="3367702">,</span>&nbsp;<span class="ident" id="3367704">context</span>&nbsp;<span class="builtintype" id="3367712">string</span><span class="op" id="3367718">)</span>&nbsp;<span class="ident" id="3367720">token</span><span class="op" id="3367725">.</span><span class="ident" id="3367726">Pos</span>&nbsp;<span class="op" id="3367730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367733">if</span>&nbsp;<span class="ident" id="3367736">p</span><span class="op" id="3367737">.</span><span class="ident" id="3367738">tok</span>&nbsp;<span class="op" id="3367742">!=</span>&nbsp;<span class="ident" id="3367745">tok</span>&nbsp;<span class="op" id="3367749">&amp;&amp;</span>&nbsp;<span class="ident" id="3367752">p</span><span class="op" id="3367753">.</span><span class="ident" id="3367754">tok</span>&nbsp;<span class="op" id="3367758">==</span>&nbsp;<span class="ident" id="3367761">token</span><span class="op" id="3367766">.</span><span class="ident" id="3367767">SEMICOLON</span>&nbsp;<span class="op" id="3367777">&amp;&amp;</span>&nbsp;<span class="ident" id="3367780">p</span><span class="op" id="3367781">.</span><span class="ident" id="3367782">lit</span>&nbsp;<span class="op" id="3367786">==</span>&nbsp;<span class="string" id="3367789">&#34;\n&#34;</span>&nbsp;<span class="op" id="3367794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367798">p</span><span class="op" id="3367799">.</span><span class="builtintype" id="3367800">error</span><span class="op" id="3367805">(</span><span class="ident" id="3367806">p</span><span class="op" id="3367807">.</span><span class="ident" id="3367808">pos</span><span class="op" id="3367811">,</span>&nbsp;<span class="string" id="3367813">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="3367845">+</span><span class="ident" id="3367846">context</span><span class="op" id="3367853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3367857">p</span><span class="op" id="3367858">.</span><span class="ident" id="3367859">next</span><span class="op" id="3367863">(</span><span class="op" id="3367864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3367867">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367870">return</span>&nbsp;<span class="ident" id="3367877">p</span><span class="op" id="3367878">.</span><span class="ident" id="3367879">expect</span><span class="op" id="3367885">(</span><span class="ident" id="3367886">tok</span><span class="op" id="3367889">)</span><br>
<span class="lineno"></span><span class="op" id="3367891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3367894">func</span>&nbsp;<span class="op" id="3367899">(</span><span class="ident" id="3367900">p</span>&nbsp;<span class="op" id="3367902">*</span><span class="ident" id="3367903">parser</span><span class="op" id="3367909">)</span>&nbsp;<span class="ident" id="3367911">expectSemi</span><span class="op" id="3367921">(</span><span class="op" id="3367922">)</span>&nbsp;<span class="op" id="3367924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3367927">//&nbsp;semicolon&nbsp;is&nbsp;optional&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;}&#39;</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3367981">if</span>&nbsp;<span class="ident" id="3367984">p</span><span class="op" id="3367985">.</span><span class="ident" id="3367986">tok</span>&nbsp;<span class="op" id="3367990">!=</span>&nbsp;<span class="ident" id="3367993">token</span><span class="op" id="3367998">.</span><span class="ident" id="3367999">RPAREN</span>&nbsp;<span class="op" id="3368006">&amp;&amp;</span>&nbsp;<span class="ident" id="3368009">p</span><span class="op" id="3368010">.</span><span class="ident" id="3368011">tok</span>&nbsp;<span class="op" id="3368015">!=</span>&nbsp;<span class="ident" id="3368018">token</span><span class="op" id="3368023">.</span><span class="ident" id="3368024">RBRACE</span>&nbsp;<span class="op" id="3368031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368035">if</span>&nbsp;<span class="ident" id="3368038">p</span><span class="op" id="3368039">.</span><span class="ident" id="3368040">tok</span>&nbsp;<span class="op" id="3368044">==</span>&nbsp;<span class="ident" id="3368047">token</span><span class="op" id="3368052">.</span><span class="ident" id="3368053">SEMICOLON</span>&nbsp;<span class="op" id="3368063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368068">p</span><span class="op" id="3368069">.</span><span class="ident" id="3368070">next</span><span class="op" id="3368074">(</span><span class="op" id="3368075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368079">}</span>&nbsp;<span class="keyword" id="3368081">else</span>&nbsp;<span class="op" id="3368086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368091">p</span><span class="op" id="3368092">.</span><span class="ident" id="3368093">errorExpected</span><span class="op" id="3368106">(</span><span class="ident" id="3368107">p</span><span class="op" id="3368108">.</span><span class="ident" id="3368109">pos</span><span class="op" id="3368112">,</span>&nbsp;<span class="string" id="3368114">&#34;&#39;;&#39;&#34;</span><span class="op" id="3368119">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368124">syncStmt</span><span class="op" id="3368132">(</span><span class="ident" id="3368133">p</span><span class="op" id="3368134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368141">}</span><br>
<span class="lineno"></span><span class="op" id="3368143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="3368146">func</span>&nbsp;<span class="op" id="3368151">(</span><span class="ident" id="3368152">p</span>&nbsp;<span class="op" id="3368154">*</span><span class="ident" id="3368155">parser</span><span class="op" id="3368161">)</span>&nbsp;<span class="ident" id="3368163">atComma</span><span class="op" id="3368170">(</span><span class="ident" id="3368171">context</span>&nbsp;<span class="builtintype" id="3368179">string</span><span class="op" id="3368185">)</span>&nbsp;<span class="builtintype" id="3368187">bool</span>&nbsp;<span class="op" id="3368192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368195">if</span>&nbsp;<span class="ident" id="3368198">p</span><span class="op" id="3368199">.</span><span class="ident" id="3368200">tok</span>&nbsp;<span class="op" id="3368204">==</span>&nbsp;<span class="ident" id="3368207">token</span><span class="op" id="3368212">.</span><span class="ident" id="3368213">COMMA</span>&nbsp;<span class="op" id="3368219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368223">return</span>&nbsp;<span class="builtintype" id="3368230">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368239">if</span>&nbsp;<span class="ident" id="3368242">p</span><span class="op" id="3368243">.</span><span class="ident" id="3368244">tok</span>&nbsp;<span class="op" id="3368248">==</span>&nbsp;<span class="ident" id="3368251">token</span><span class="op" id="3368256">.</span><span class="ident" id="3368257">SEMICOLON</span>&nbsp;<span class="op" id="3368267">&amp;&amp;</span>&nbsp;<span class="ident" id="3368270">p</span><span class="op" id="3368271">.</span><span class="ident" id="3368272">lit</span>&nbsp;<span class="op" id="3368276">==</span>&nbsp;<span class="string" id="3368279">&#34;\n&#34;</span>&nbsp;<span class="op" id="3368284">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368288">p</span><span class="op" id="3368289">.</span><span class="builtintype" id="3368290">error</span><span class="op" id="3368295">(</span><span class="ident" id="3368296">p</span><span class="op" id="3368297">.</span><span class="ident" id="3368298">pos</span><span class="op" id="3368301">,</span>&nbsp;<span class="string" id="3368303">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="3368335">+</span><span class="ident" id="3368336">context</span><span class="op" id="3368343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368347">return</span>&nbsp;<span class="builtintype" id="3368354">true</span>&nbsp;<span class="comment" id="3368359">//&nbsp;&#34;insert&#34;&nbsp;the&nbsp;comma&nbsp;and&nbsp;continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368399">return</span>&nbsp;<span class="builtintype" id="3368406">false</span><br>
<span class="lineno">425</span><span class="op" id="3368412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3368415">func</span>&nbsp;<span class="ident" id="3368420">assert</span><span class="op" id="3368426">(</span><span class="ident" id="3368427">cond</span>&nbsp;<span class="builtintype" id="3368432">bool</span><span class="op" id="3368436">,</span>&nbsp;<span class="ident" id="3368438">msg</span>&nbsp;<span class="builtintype" id="3368442">string</span><span class="op" id="3368448">)</span>&nbsp;<span class="op" id="3368450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368453">if</span>&nbsp;<span class="op" id="3368456">!</span><span class="ident" id="3368457">cond</span>&nbsp;<span class="op" id="3368462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3368466">panic</span><span class="op" id="3368471">(</span><span class="string" id="3368472">&#34;go/parser&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="3368501">+</span>&nbsp;<span class="ident" id="3368503">msg</span><span class="op" id="3368506">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3368509">}</span><br>
<span class="lineno"></span><span class="op" id="3368511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3368514">//&nbsp;syncStmt&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="3368558">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno">435</span><span class="comment" id="3368602">//</span><br>
<span class="lineno"></span><span class="keyword" id="3368605">func</span>&nbsp;<span class="ident" id="3368610">syncStmt</span><span class="op" id="3368618">(</span><span class="ident" id="3368619">p</span>&nbsp;<span class="op" id="3368621">*</span><span class="ident" id="3368622">parser</span><span class="op" id="3368628">)</span>&nbsp;<span class="op" id="3368630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368633">for</span>&nbsp;<span class="op" id="3368637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368641">switch</span>&nbsp;<span class="ident" id="3368648">p</span><span class="op" id="3368649">.</span><span class="ident" id="3368650">tok</span>&nbsp;<span class="op" id="3368654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3368658">case</span>&nbsp;<span class="ident" id="3368663">token</span><span class="op" id="3368668">.</span><span class="ident" id="3368669">BREAK</span><span class="op" id="3368674">,</span>&nbsp;<span class="ident" id="3368676">token</span><span class="op" id="3368681">.</span><span class="ident" id="3368682">CONST</span><span class="op" id="3368687">,</span>&nbsp;<span class="ident" id="3368689">token</span><span class="op" id="3368694">.</span><span class="ident" id="3368695">CONTINUE</span><span class="op" id="3368703">,</span>&nbsp;<span class="ident" id="3368705">token</span><span class="op" id="3368710">.</span><span class="ident" id="3368711">DEFER</span><span class="op" id="3368716">,</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368721">token</span><span class="op" id="3368726">.</span><span class="ident" id="3368727">FALLTHROUGH</span><span class="op" id="3368738">,</span>&nbsp;<span class="ident" id="3368740">token</span><span class="op" id="3368745">.</span><span class="ident" id="3368746">FOR</span><span class="op" id="3368749">,</span>&nbsp;<span class="ident" id="3368751">token</span><span class="op" id="3368756">.</span><span class="ident" id="3368757">GO</span><span class="op" id="3368759">,</span>&nbsp;<span class="ident" id="3368761">token</span><span class="op" id="3368766">.</span><span class="ident" id="3368767">GOTO</span><span class="op" id="3368771">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368776">token</span><span class="op" id="3368781">.</span><span class="ident" id="3368782">IF</span><span class="op" id="3368784">,</span>&nbsp;<span class="ident" id="3368786">token</span><span class="op" id="3368791">.</span><span class="ident" id="3368792">RETURN</span><span class="op" id="3368798">,</span>&nbsp;<span class="ident" id="3368800">token</span><span class="op" id="3368805">.</span><span class="ident" id="3368806">SELECT</span><span class="op" id="3368812">,</span>&nbsp;<span class="ident" id="3368814">token</span><span class="op" id="3368819">.</span><span class="ident" id="3368820">SWITCH</span><span class="op" id="3368826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3368831">token</span><span class="op" id="3368836">.</span><span class="ident" id="3368837">TYPE</span><span class="op" id="3368841">,</span>&nbsp;<span class="ident" id="3368843">token</span><span class="op" id="3368848">.</span><span class="ident" id="3368849">VAR</span><span class="op" id="3368852">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3368857">//&nbsp;Return&nbsp;only&nbsp;if&nbsp;parser&nbsp;made&nbsp;some&nbsp;progress&nbsp;since&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3368915">//&nbsp;sync&nbsp;or&nbsp;if&nbsp;it&nbsp;has&nbsp;not&nbsp;reached&nbsp;10&nbsp;sync&nbsp;calls&nbsp;without</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3368973">//&nbsp;progress.&nbsp;Otherwise&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;token&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3369029">//&nbsp;avoid&nbsp;an&nbsp;endless&nbsp;parser&nbsp;loop&nbsp;(it&nbsp;is&nbsp;possible&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3369085">//&nbsp;both&nbsp;parseOperand&nbsp;and&nbsp;parseStmt&nbsp;call&nbsp;syncStmt&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3369141">//&nbsp;correctly&nbsp;do&nbsp;not&nbsp;advance,&nbsp;thus&nbsp;the&nbsp;need&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3369195">//&nbsp;invocation&nbsp;limit&nbsp;p.syncCnt).</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369230">if</span>&nbsp;<span class="ident" id="3369233">p</span><span class="op" id="3369234">.</span><span class="ident" id="3369235">pos</span>&nbsp;<span class="op" id="3369239">==</span>&nbsp;<span class="ident" id="3369242">p</span><span class="op" id="3369243">.</span><span class="ident" id="3369244">syncPos</span>&nbsp;<span class="op" id="3369252">&amp;&amp;</span>&nbsp;<span class="ident" id="3369255">p</span><span class="op" id="3369256">.</span><span class="ident" id="3369257">syncCnt</span>&nbsp;<span class="op" id="3369265">&lt;</span>&nbsp;<span class="num" id="3369267">10</span>&nbsp;<span class="op" id="3369270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369276">p</span><span class="op" id="3369277">.</span><span class="ident" id="3369278">syncCnt</span><span class="op" id="3369285">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369292">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369307">if</span>&nbsp;<span class="ident" id="3369310">p</span><span class="op" id="3369311">.</span><span class="ident" id="3369312">pos</span>&nbsp;<span class="op" id="3369316">&gt;</span>&nbsp;<span class="ident" id="3369318">p</span><span class="op" id="3369319">.</span><span class="ident" id="3369320">syncPos</span>&nbsp;<span class="op" id="3369328">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369334">p</span><span class="op" id="3369335">.</span><span class="ident" id="3369336">syncPos</span>&nbsp;<span class="op" id="3369344">=</span>&nbsp;<span class="ident" id="3369346">p</span><span class="op" id="3369347">.</span><span class="ident" id="3369348">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369356">p</span><span class="op" id="3369357">.</span><span class="ident" id="3369358">syncCnt</span>&nbsp;<span class="op" id="3369366">=</span>&nbsp;<span class="num" id="3369368">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369374">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3369389">//&nbsp;Reaching&nbsp;here&nbsp;indicates&nbsp;a&nbsp;parser&nbsp;bug,&nbsp;likely&nbsp;an</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3369443">//&nbsp;incorrect&nbsp;token&nbsp;list&nbsp;in&nbsp;this&nbsp;function,&nbsp;but&nbsp;it&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3369500">//&nbsp;leads&nbsp;to&nbsp;skipping&nbsp;of&nbsp;possibly&nbsp;correct&nbsp;code&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3369554">//&nbsp;previous&nbsp;error&nbsp;is&nbsp;present,&nbsp;and&nbsp;thus&nbsp;is&nbsp;preferred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3369609">//&nbsp;over&nbsp;a&nbsp;non-terminating&nbsp;parse.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369644">case</span>&nbsp;<span class="ident" id="3369649">token</span><span class="op" id="3369654">.</span><span class="ident" id="3369655">EOF</span><span class="op" id="3369658">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369663">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369676">p</span><span class="op" id="3369677">.</span><span class="ident" id="3369678">next</span><span class="op" id="3369682">(</span><span class="op" id="3369683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369686">}</span><br>
<span class="lineno"></span><span class="op" id="3369688">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="3369691">//&nbsp;syncDecl&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;declaration.</span><br>
<span class="lineno"></span><span class="comment" id="3369737">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3369781">//</span><br>
<span class="lineno"></span><span class="keyword" id="3369784">func</span>&nbsp;<span class="ident" id="3369789">syncDecl</span><span class="op" id="3369797">(</span><span class="ident" id="3369798">p</span>&nbsp;<span class="op" id="3369800">*</span><span class="ident" id="3369801">parser</span><span class="op" id="3369807">)</span>&nbsp;<span class="op" id="3369809">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369812">for</span>&nbsp;<span class="op" id="3369816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369820">switch</span>&nbsp;<span class="ident" id="3369827">p</span><span class="op" id="3369828">.</span><span class="ident" id="3369829">tok</span>&nbsp;<span class="op" id="3369833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369837">case</span>&nbsp;<span class="ident" id="3369842">token</span><span class="op" id="3369847">.</span><span class="ident" id="3369848">CONST</span><span class="op" id="3369853">,</span>&nbsp;<span class="ident" id="3369855">token</span><span class="op" id="3369860">.</span><span class="ident" id="3369861">TYPE</span><span class="op" id="3369865">,</span>&nbsp;<span class="ident" id="3369867">token</span><span class="op" id="3369872">.</span><span class="ident" id="3369873">VAR</span><span class="op" id="3369876">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3369881">//&nbsp;see&nbsp;comments&nbsp;in&nbsp;syncStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369912">if</span>&nbsp;<span class="ident" id="3369915">p</span><span class="op" id="3369916">.</span><span class="ident" id="3369917">pos</span>&nbsp;<span class="op" id="3369921">==</span>&nbsp;<span class="ident" id="3369924">p</span><span class="op" id="3369925">.</span><span class="ident" id="3369926">syncPos</span>&nbsp;<span class="op" id="3369934">&amp;&amp;</span>&nbsp;<span class="ident" id="3369937">p</span><span class="op" id="3369938">.</span><span class="ident" id="3369939">syncCnt</span>&nbsp;<span class="op" id="3369947">&lt;</span>&nbsp;<span class="num" id="3369949">10</span>&nbsp;<span class="op" id="3369952">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3369958">p</span><span class="op" id="3369959">.</span><span class="ident" id="3369960">syncCnt</span><span class="op" id="3369967">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369974">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3369984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3369989">if</span>&nbsp;<span class="ident" id="3369992">p</span><span class="op" id="3369993">.</span><span class="ident" id="3369994">pos</span>&nbsp;<span class="op" id="3369998">&gt;</span>&nbsp;<span class="ident" id="3370000">p</span><span class="op" id="3370001">.</span><span class="ident" id="3370002">syncPos</span>&nbsp;<span class="op" id="3370010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3370016">p</span><span class="op" id="3370017">.</span><span class="ident" id="3370018">syncPos</span>&nbsp;<span class="op" id="3370026">=</span>&nbsp;<span class="ident" id="3370028">p</span><span class="op" id="3370029">.</span><span class="ident" id="3370030">pos</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3370038">p</span><span class="op" id="3370039">.</span><span class="ident" id="3370040">syncCnt</span>&nbsp;<span class="op" id="3370048">=</span>&nbsp;<span class="num" id="3370050">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370056">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370070">case</span>&nbsp;<span class="ident" id="3370075">token</span><span class="op" id="3370080">.</span><span class="ident" id="3370081">EOF</span><span class="op" id="3370084">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370089">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3370102">p</span><span class="op" id="3370103">.</span><span class="ident" id="3370104">next</span><span class="op" id="3370108">(</span><span class="op" id="3370109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370112">}</span><br>
<span class="lineno"></span><span class="op" id="3370114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="3370117">//&nbsp;safePos&nbsp;returns&nbsp;a&nbsp;valid&nbsp;file&nbsp;position&nbsp;for&nbsp;a&nbsp;given&nbsp;position:&nbsp;If&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="3370187">//&nbsp;is&nbsp;valid&nbsp;to&nbsp;begin&nbsp;with,&nbsp;safePos&nbsp;returns&nbsp;pos.&nbsp;If&nbsp;pos&nbsp;is&nbsp;out-of-range,</span><br>
<span class="lineno"></span><span class="comment" id="3370259">//&nbsp;safePos&nbsp;returns&nbsp;the&nbsp;EOF&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="3370296">//</span><br>
<span class="lineno"></span><span class="comment" id="3370299">//&nbsp;This&nbsp;is&nbsp;hack&nbsp;to&nbsp;work&nbsp;around&nbsp;&#34;artificial&#34;&nbsp;end&nbsp;positions&nbsp;in&nbsp;the&nbsp;AST&nbsp;which</span><br>
<span class="lineno">500</span><span class="comment" id="3370374">//&nbsp;are&nbsp;computed&nbsp;by&nbsp;adding&nbsp;1&nbsp;to&nbsp;(presumably&nbsp;valid)&nbsp;token&nbsp;positions.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3370448">//&nbsp;token&nbsp;positions&nbsp;are&nbsp;invalid&nbsp;due&nbsp;to&nbsp;parse&nbsp;errors,&nbsp;the&nbsp;resulting&nbsp;end&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="3370527">//&nbsp;may&nbsp;be&nbsp;past&nbsp;the&nbsp;file&#39;s&nbsp;EOF&nbsp;position,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to&nbsp;panics&nbsp;if&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3370602">//&nbsp;later&nbsp;on.</span><br>
<span class="lineno"></span><span class="comment" id="3370615">//</span><br>
<span class="lineno">505</span><span class="keyword" id="3370618">func</span>&nbsp;<span class="op" id="3370623">(</span><span class="ident" id="3370624">p</span>&nbsp;<span class="op" id="3370626">*</span><span class="ident" id="3370627">parser</span><span class="op" id="3370633">)</span>&nbsp;<span class="ident" id="3370635">safePos</span><span class="op" id="3370642">(</span><span class="ident" id="3370643">pos</span>&nbsp;<span class="ident" id="3370647">token</span><span class="op" id="3370652">.</span><span class="ident" id="3370653">Pos</span><span class="op" id="3370656">)</span>&nbsp;<span class="op" id="3370658">(</span><span class="ident" id="3370659">res</span>&nbsp;<span class="ident" id="3370663">token</span><span class="op" id="3370668">.</span><span class="ident" id="3370669">Pos</span><span class="op" id="3370672">)</span>&nbsp;<span class="op" id="3370674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370677">defer</span>&nbsp;<span class="keyword" id="3370683">func</span><span class="op" id="3370687">(</span><span class="op" id="3370688">)</span>&nbsp;<span class="op" id="3370690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370694">if</span>&nbsp;<span class="builtinfunc" id="3370697">recover</span><span class="op" id="3370704">(</span><span class="op" id="3370705">)</span>&nbsp;<span class="op" id="3370707">!=</span>&nbsp;<span class="ident" id="3370710">nil</span>&nbsp;<span class="op" id="3370714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3370719">res</span>&nbsp;<span class="op" id="3370723">=</span>&nbsp;<span class="ident" id="3370725">token</span><span class="op" id="3370730">.</span><span class="ident" id="3370731">Pos</span><span class="op" id="3370734">(</span><span class="ident" id="3370735">p</span><span class="op" id="3370736">.</span><span class="ident" id="3370737">file</span><span class="op" id="3370741">.</span><span class="ident" id="3370742">Base</span><span class="op" id="3370746">(</span><span class="op" id="3370747">)</span>&nbsp;<span class="op" id="3370749">+</span>&nbsp;<span class="ident" id="3370751">p</span><span class="op" id="3370752">.</span><span class="ident" id="3370753">file</span><span class="op" id="3370757">.</span><span class="ident" id="3370758">Size</span><span class="op" id="3370762">(</span><span class="op" id="3370763">)</span><span class="op" id="3370764">)</span>&nbsp;<span class="comment" id="3370766">//&nbsp;EOF&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370784">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3370787">}</span><span class="op" id="3370788">(</span><span class="op" id="3370789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3370792">_</span>&nbsp;<span class="op" id="3370794">=</span>&nbsp;<span class="ident" id="3370796">p</span><span class="op" id="3370797">.</span><span class="ident" id="3370798">file</span><span class="op" id="3370802">.</span><span class="ident" id="3370803">Offset</span><span class="op" id="3370809">(</span><span class="ident" id="3370810">pos</span><span class="op" id="3370813">)</span>&nbsp;<span class="comment" id="3370815">//&nbsp;trigger&nbsp;a&nbsp;panic&nbsp;if&nbsp;position&nbsp;is&nbsp;out-of-range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3370863">return</span>&nbsp;<span class="ident" id="3370870">pos</span><br>
<span class="lineno"></span><span class="op" id="3370874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="comment" id="3370877">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3370957">//&nbsp;Identifiers</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3370973">func</span>&nbsp;<span class="op" id="3370978">(</span><span class="ident" id="3370979">p</span>&nbsp;<span class="op" id="3370981">*</span><span class="ident" id="3370982">parser</span><span class="op" id="3370988">)</span>&nbsp;<span class="ident" id="3370990">parseIdent</span><span class="op" id="3371000">(</span><span class="op" id="3371001">)</span>&nbsp;<span class="op" id="3371003">*</span><span class="ident" id="3371004">ast</span><span class="op" id="3371007">.</span><span class="ident" id="3371008">Ident</span>&nbsp;<span class="op" id="3371014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371017">pos</span>&nbsp;<span class="op" id="3371021">:=</span>&nbsp;<span class="ident" id="3371024">p</span><span class="op" id="3371025">.</span><span class="ident" id="3371026">pos</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371031">name</span>&nbsp;<span class="op" id="3371036">:=</span>&nbsp;<span class="string" id="3371039">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371044">if</span>&nbsp;<span class="ident" id="3371047">p</span><span class="op" id="3371048">.</span><span class="ident" id="3371049">tok</span>&nbsp;<span class="op" id="3371053">==</span>&nbsp;<span class="ident" id="3371056">token</span><span class="op" id="3371061">.</span><span class="ident" id="3371062">IDENT</span>&nbsp;<span class="op" id="3371068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371072">name</span>&nbsp;<span class="op" id="3371077">=</span>&nbsp;<span class="ident" id="3371079">p</span><span class="op" id="3371080">.</span><span class="ident" id="3371081">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371087">p</span><span class="op" id="3371088">.</span><span class="ident" id="3371089">next</span><span class="op" id="3371093">(</span><span class="op" id="3371094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371097">}</span>&nbsp;<span class="keyword" id="3371099">else</span>&nbsp;<span class="op" id="3371104">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371108">p</span><span class="op" id="3371109">.</span><span class="ident" id="3371110">expect</span><span class="op" id="3371116">(</span><span class="ident" id="3371117">token</span><span class="op" id="3371122">.</span><span class="ident" id="3371123">IDENT</span><span class="op" id="3371128">)</span>&nbsp;<span class="comment" id="3371130">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371165">return</span>&nbsp;<span class="op" id="3371172">&amp;</span><span class="ident" id="3371173">ast</span><span class="op" id="3371176">.</span><span class="ident" id="3371177">Ident</span><span class="op" id="3371182">{</span><span class="ident" id="3371183">NamePos</span><span class="op" id="3371190">:</span>&nbsp;<span class="ident" id="3371192">pos</span><span class="op" id="3371195">,</span>&nbsp;<span class="ident" id="3371197">Name</span><span class="op" id="3371201">:</span>&nbsp;<span class="ident" id="3371203">name</span><span class="op" id="3371207">}</span><br>
<span class="lineno"></span><span class="op" id="3371209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="keyword" id="3371212">func</span>&nbsp;<span class="op" id="3371217">(</span><span class="ident" id="3371218">p</span>&nbsp;<span class="op" id="3371220">*</span><span class="ident" id="3371221">parser</span><span class="op" id="3371227">)</span>&nbsp;<span class="ident" id="3371229">parseIdentList</span><span class="op" id="3371243">(</span><span class="op" id="3371244">)</span>&nbsp;<span class="op" id="3371246">(</span><span class="ident" id="3371247">list</span>&nbsp;<span class="op" id="3371252">[</span><span class="op" id="3371253">]</span><span class="op" id="3371254">*</span><span class="ident" id="3371255">ast</span><span class="op" id="3371258">.</span><span class="ident" id="3371259">Ident</span><span class="op" id="3371264">)</span>&nbsp;<span class="op" id="3371266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371269">if</span>&nbsp;<span class="ident" id="3371272">p</span><span class="op" id="3371273">.</span><span class="ident" id="3371274">trace</span>&nbsp;<span class="op" id="3371280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371284">defer</span>&nbsp;<span class="ident" id="3371290">un</span><span class="op" id="3371292">(</span><span class="ident" id="3371293">trace</span><span class="op" id="3371298">(</span><span class="ident" id="3371299">p</span><span class="op" id="3371300">,</span>&nbsp;<span class="string" id="3371302">&#34;IdentList&#34;</span><span class="op" id="3371313">)</span><span class="op" id="3371314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371321">list</span>&nbsp;<span class="op" id="3371326">=</span>&nbsp;<span class="builtinfunc" id="3371328">append</span><span class="op" id="3371334">(</span><span class="ident" id="3371335">list</span><span class="op" id="3371339">,</span>&nbsp;<span class="ident" id="3371341">p</span><span class="op" id="3371342">.</span><span class="ident" id="3371343">parseIdent</span><span class="op" id="3371353">(</span><span class="op" id="3371354">)</span><span class="op" id="3371355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371358">for</span>&nbsp;<span class="ident" id="3371362">p</span><span class="op" id="3371363">.</span><span class="ident" id="3371364">tok</span>&nbsp;<span class="op" id="3371368">==</span>&nbsp;<span class="ident" id="3371371">token</span><span class="op" id="3371376">.</span><span class="ident" id="3371377">COMMA</span>&nbsp;<span class="op" id="3371383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371387">p</span><span class="op" id="3371388">.</span><span class="ident" id="3371389">next</span><span class="op" id="3371393">(</span><span class="op" id="3371394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371398">list</span>&nbsp;<span class="op" id="3371403">=</span>&nbsp;<span class="builtinfunc" id="3371405">append</span><span class="op" id="3371411">(</span><span class="ident" id="3371412">list</span><span class="op" id="3371416">,</span>&nbsp;<span class="ident" id="3371418">p</span><span class="op" id="3371419">.</span><span class="ident" id="3371420">parseIdent</span><span class="op" id="3371430">(</span><span class="op" id="3371431">)</span><span class="op" id="3371432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371435">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371439">return</span><br>
<span class="lineno"></span><span class="op" id="3371446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3371449">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">545</span><span class="comment" id="3371529">//&nbsp;Common&nbsp;productions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3371552">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set,&nbsp;result&nbsp;list&nbsp;elements&nbsp;which&nbsp;are&nbsp;identifiers&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="3371631">func</span>&nbsp;<span class="op" id="3371636">(</span><span class="ident" id="3371637">p</span>&nbsp;<span class="op" id="3371639">*</span><span class="ident" id="3371640">parser</span><span class="op" id="3371646">)</span>&nbsp;<span class="ident" id="3371648">parseExprList</span><span class="op" id="3371661">(</span><span class="ident" id="3371662">lhs</span>&nbsp;<span class="builtintype" id="3371666">bool</span><span class="op" id="3371670">)</span>&nbsp;<span class="op" id="3371672">(</span><span class="ident" id="3371673">list</span>&nbsp;<span class="op" id="3371678">[</span><span class="op" id="3371679">]</span><span class="ident" id="3371680">ast</span><span class="op" id="3371683">.</span><span class="ident" id="3371684">Expr</span><span class="op" id="3371688">)</span>&nbsp;<span class="op" id="3371690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371693">if</span>&nbsp;<span class="ident" id="3371696">p</span><span class="op" id="3371697">.</span><span class="ident" id="3371698">trace</span>&nbsp;<span class="op" id="3371704">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371708">defer</span>&nbsp;<span class="ident" id="3371714">un</span><span class="op" id="3371716">(</span><span class="ident" id="3371717">trace</span><span class="op" id="3371722">(</span><span class="ident" id="3371723">p</span><span class="op" id="3371724">,</span>&nbsp;<span class="string" id="3371726">&#34;ExpressionList&#34;</span><span class="op" id="3371742">)</span><span class="op" id="3371743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371750">list</span>&nbsp;<span class="op" id="3371755">=</span>&nbsp;<span class="builtinfunc" id="3371757">append</span><span class="op" id="3371763">(</span><span class="ident" id="3371764">list</span><span class="op" id="3371768">,</span>&nbsp;<span class="ident" id="3371770">p</span><span class="op" id="3371771">.</span><span class="ident" id="3371772">checkExpr</span><span class="op" id="3371781">(</span><span class="ident" id="3371782">p</span><span class="op" id="3371783">.</span><span class="ident" id="3371784">parseExpr</span><span class="op" id="3371793">(</span><span class="ident" id="3371794">lhs</span><span class="op" id="3371797">)</span><span class="op" id="3371798">)</span><span class="op" id="3371799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371802">for</span>&nbsp;<span class="ident" id="3371806">p</span><span class="op" id="3371807">.</span><span class="ident" id="3371808">tok</span>&nbsp;<span class="op" id="3371812">==</span>&nbsp;<span class="ident" id="3371815">token</span><span class="op" id="3371820">.</span><span class="ident" id="3371821">COMMA</span>&nbsp;<span class="op" id="3371827">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371831">p</span><span class="op" id="3371832">.</span><span class="ident" id="3371833">next</span><span class="op" id="3371837">(</span><span class="op" id="3371838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371842">list</span>&nbsp;<span class="op" id="3371847">=</span>&nbsp;<span class="builtinfunc" id="3371849">append</span><span class="op" id="3371855">(</span><span class="ident" id="3371856">list</span><span class="op" id="3371860">,</span>&nbsp;<span class="ident" id="3371862">p</span><span class="op" id="3371863">.</span><span class="ident" id="3371864">checkExpr</span><span class="op" id="3371873">(</span><span class="ident" id="3371874">p</span><span class="op" id="3371875">.</span><span class="ident" id="3371876">parseExpr</span><span class="op" id="3371885">(</span><span class="ident" id="3371886">lhs</span><span class="op" id="3371889">)</span><span class="op" id="3371890">)</span><span class="op" id="3371891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3371894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3371898">return</span><br>
<span class="lineno">560</span><span class="op" id="3371905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3371908">func</span>&nbsp;<span class="op" id="3371913">(</span><span class="ident" id="3371914">p</span>&nbsp;<span class="op" id="3371916">*</span><span class="ident" id="3371917">parser</span><span class="op" id="3371923">)</span>&nbsp;<span class="ident" id="3371925">parseLhsList</span><span class="op" id="3371937">(</span><span class="op" id="3371938">)</span>&nbsp;<span class="op" id="3371940">[</span><span class="op" id="3371941">]</span><span class="ident" id="3371942">ast</span><span class="op" id="3371945">.</span><span class="ident" id="3371946">Expr</span>&nbsp;<span class="op" id="3371951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371954">old</span>&nbsp;<span class="op" id="3371958">:=</span>&nbsp;<span class="ident" id="3371961">p</span><span class="op" id="3371962">.</span><span class="ident" id="3371963">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371970">p</span><span class="op" id="3371971">.</span><span class="ident" id="3371972">inRhs</span>&nbsp;<span class="op" id="3371978">=</span>&nbsp;<span class="builtintype" id="3371980">false</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3371987">list</span>&nbsp;<span class="op" id="3371992">:=</span>&nbsp;<span class="ident" id="3371995">p</span><span class="op" id="3371996">.</span><span class="ident" id="3371997">parseExprList</span><span class="op" id="3372010">(</span><span class="builtintype" id="3372011">true</span><span class="op" id="3372015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372018">switch</span>&nbsp;<span class="ident" id="3372025">p</span><span class="op" id="3372026">.</span><span class="ident" id="3372027">tok</span>&nbsp;<span class="op" id="3372031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372034">case</span>&nbsp;<span class="ident" id="3372039">token</span><span class="op" id="3372044">.</span><span class="ident" id="3372045">DEFINE</span><span class="op" id="3372051">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3372055">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;short&nbsp;variable&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3372096">//&nbsp;but&nbsp;doesn&#39;t&nbsp;enter&nbsp;scope&nbsp;until&nbsp;later:</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3372138">//&nbsp;caller&nbsp;must&nbsp;call&nbsp;p.shortVarDecl(p.makeIdentList(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3372198">//&nbsp;at&nbsp;appropriate&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372223">case</span>&nbsp;<span class="ident" id="3372228">token</span><span class="op" id="3372233">.</span><span class="ident" id="3372234">COLON</span><span class="op" id="3372239">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3372243">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;label&nbsp;declaration&nbsp;or&nbsp;a&nbsp;communication&nbsp;clause&nbsp;of&nbsp;a&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3372313">//&nbsp;statement&nbsp;(parseLhsList&nbsp;is&nbsp;not&nbsp;called&nbsp;when&nbsp;parsing&nbsp;the&nbsp;case&nbsp;clause</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3372385">//&nbsp;of&nbsp;a&nbsp;switch&nbsp;statement):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3372414">//&nbsp;-&nbsp;labels&nbsp;are&nbsp;declared&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;parseLhsList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3372471">//&nbsp;-&nbsp;for&nbsp;communication&nbsp;clauses,&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;stand-alone&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3372542">//&nbsp;&nbsp;&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;we&nbsp;have&nbsp;a&nbsp;syntax&nbsp;error;&nbsp;there&nbsp;is&nbsp;no&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3372611">//&nbsp;&nbsp;&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372656">default</span><span class="op" id="3372663">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3372667">//&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;declared&nbsp;elsewhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372711">for</span>&nbsp;<span class="ident" id="3372715">_</span><span class="op" id="3372716">,</span>&nbsp;<span class="ident" id="3372718">x</span>&nbsp;<span class="op" id="3372720">:=</span>&nbsp;<span class="keyword" id="3372723">range</span>&nbsp;<span class="ident" id="3372729">list</span>&nbsp;<span class="op" id="3372734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372739">p</span><span class="op" id="3372740">.</span><span class="ident" id="3372741">resolve</span><span class="op" id="3372748">(</span><span class="ident" id="3372749">x</span><span class="op" id="3372750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372754">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3372757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372760">p</span><span class="op" id="3372761">.</span><span class="ident" id="3372762">inRhs</span>&nbsp;<span class="op" id="3372768">=</span>&nbsp;<span class="ident" id="3372770">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372775">return</span>&nbsp;<span class="ident" id="3372782">list</span><br>
<span class="lineno"></span><span class="op" id="3372787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="keyword" id="3372790">func</span>&nbsp;<span class="op" id="3372795">(</span><span class="ident" id="3372796">p</span>&nbsp;<span class="op" id="3372798">*</span><span class="ident" id="3372799">parser</span><span class="op" id="3372805">)</span>&nbsp;<span class="ident" id="3372807">parseRhsList</span><span class="op" id="3372819">(</span><span class="op" id="3372820">)</span>&nbsp;<span class="op" id="3372822">[</span><span class="op" id="3372823">]</span><span class="ident" id="3372824">ast</span><span class="op" id="3372827">.</span><span class="ident" id="3372828">Expr</span>&nbsp;<span class="op" id="3372833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372836">old</span>&nbsp;<span class="op" id="3372840">:=</span>&nbsp;<span class="ident" id="3372843">p</span><span class="op" id="3372844">.</span><span class="ident" id="3372845">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372852">p</span><span class="op" id="3372853">.</span><span class="ident" id="3372854">inRhs</span>&nbsp;<span class="op" id="3372860">=</span>&nbsp;<span class="builtintype" id="3372862">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372868">list</span>&nbsp;<span class="op" id="3372873">:=</span>&nbsp;<span class="ident" id="3372876">p</span><span class="op" id="3372877">.</span><span class="ident" id="3372878">parseExprList</span><span class="op" id="3372891">(</span><span class="builtintype" id="3372892">false</span><span class="op" id="3372897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3372900">p</span><span class="op" id="3372901">.</span><span class="ident" id="3372902">inRhs</span>&nbsp;<span class="op" id="3372908">=</span>&nbsp;<span class="ident" id="3372910">old</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3372915">return</span>&nbsp;<span class="ident" id="3372922">list</span><br>
<span class="lineno"></span><span class="op" id="3372927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3372930">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3373010">//&nbsp;Types</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="3373020">func</span>&nbsp;<span class="op" id="3373025">(</span><span class="ident" id="3373026">p</span>&nbsp;<span class="op" id="3373028">*</span><span class="ident" id="3373029">parser</span><span class="op" id="3373035">)</span>&nbsp;<span class="ident" id="3373037">parseType</span><span class="op" id="3373046">(</span><span class="op" id="3373047">)</span>&nbsp;<span class="ident" id="3373049">ast</span><span class="op" id="3373052">.</span><span class="ident" id="3373053">Expr</span>&nbsp;<span class="op" id="3373058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373061">if</span>&nbsp;<span class="ident" id="3373064">p</span><span class="op" id="3373065">.</span><span class="ident" id="3373066">trace</span>&nbsp;<span class="op" id="3373072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373076">defer</span>&nbsp;<span class="ident" id="3373082">un</span><span class="op" id="3373084">(</span><span class="ident" id="3373085">trace</span><span class="op" id="3373090">(</span><span class="ident" id="3373091">p</span><span class="op" id="3373092">,</span>&nbsp;<span class="string" id="3373094">&#34;Type&#34;</span><span class="op" id="3373100">)</span><span class="op" id="3373101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373104">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373108">typ</span>&nbsp;<span class="op" id="3373112">:=</span>&nbsp;<span class="ident" id="3373115">p</span><span class="op" id="3373116">.</span><span class="ident" id="3373117">tryType</span><span class="op" id="3373124">(</span><span class="op" id="3373125">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373129">if</span>&nbsp;<span class="ident" id="3373132">typ</span>&nbsp;<span class="op" id="3373136">==</span>&nbsp;<span class="ident" id="3373139">nil</span>&nbsp;<span class="op" id="3373143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373147">pos</span>&nbsp;<span class="op" id="3373151">:=</span>&nbsp;<span class="ident" id="3373154">p</span><span class="op" id="3373155">.</span><span class="ident" id="3373156">pos</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373162">p</span><span class="op" id="3373163">.</span><span class="ident" id="3373164">errorExpected</span><span class="op" id="3373177">(</span><span class="ident" id="3373178">pos</span><span class="op" id="3373181">,</span>&nbsp;<span class="string" id="3373183">&#34;type&#34;</span><span class="op" id="3373189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373193">p</span><span class="op" id="3373194">.</span><span class="ident" id="3373195">next</span><span class="op" id="3373199">(</span><span class="op" id="3373200">)</span>&nbsp;<span class="comment" id="3373202">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373221">return</span>&nbsp;<span class="op" id="3373228">&amp;</span><span class="ident" id="3373229">ast</span><span class="op" id="3373232">.</span><span class="ident" id="3373233">BadExpr</span><span class="op" id="3373240">{</span><span class="ident" id="3373241">From</span><span class="op" id="3373245">:</span>&nbsp;<span class="ident" id="3373247">pos</span><span class="op" id="3373250">,</span>&nbsp;<span class="ident" id="3373252">To</span><span class="op" id="3373254">:</span>&nbsp;<span class="ident" id="3373256">p</span><span class="op" id="3373257">.</span><span class="ident" id="3373258">pos</span><span class="op" id="3373261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373268">return</span>&nbsp;<span class="ident" id="3373275">typ</span><br>
<span class="lineno"></span><span class="op" id="3373279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3373282">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="3373337">func</span>&nbsp;<span class="op" id="3373342">(</span><span class="ident" id="3373343">p</span>&nbsp;<span class="op" id="3373345">*</span><span class="ident" id="3373346">parser</span><span class="op" id="3373352">)</span>&nbsp;<span class="ident" id="3373354">parseTypeName</span><span class="op" id="3373367">(</span><span class="op" id="3373368">)</span>&nbsp;<span class="ident" id="3373370">ast</span><span class="op" id="3373373">.</span><span class="ident" id="3373374">Expr</span>&nbsp;<span class="op" id="3373379">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373382">if</span>&nbsp;<span class="ident" id="3373385">p</span><span class="op" id="3373386">.</span><span class="ident" id="3373387">trace</span>&nbsp;<span class="op" id="3373393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373397">defer</span>&nbsp;<span class="ident" id="3373403">un</span><span class="op" id="3373405">(</span><span class="ident" id="3373406">trace</span><span class="op" id="3373411">(</span><span class="ident" id="3373412">p</span><span class="op" id="3373413">,</span>&nbsp;<span class="string" id="3373415">&#34;TypeName&#34;</span><span class="op" id="3373425">)</span><span class="op" id="3373426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373433">ident</span>&nbsp;<span class="op" id="3373439">:=</span>&nbsp;<span class="ident" id="3373442">p</span><span class="op" id="3373443">.</span><span class="ident" id="3373444">parseIdent</span><span class="op" id="3373454">(</span><span class="op" id="3373455">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3373458">//&nbsp;don&#39;t&nbsp;resolve&nbsp;ident&nbsp;yet&nbsp;-&nbsp;it&nbsp;may&nbsp;be&nbsp;a&nbsp;parameter&nbsp;or&nbsp;field&nbsp;name</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373525">if</span>&nbsp;<span class="ident" id="3373528">p</span><span class="op" id="3373529">.</span><span class="ident" id="3373530">tok</span>&nbsp;<span class="op" id="3373534">==</span>&nbsp;<span class="ident" id="3373537">token</span><span class="op" id="3373542">.</span><span class="ident" id="3373543">PERIOD</span>&nbsp;<span class="op" id="3373550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3373554">//&nbsp;ident&nbsp;is&nbsp;a&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373583">p</span><span class="op" id="3373584">.</span><span class="ident" id="3373585">next</span><span class="op" id="3373589">(</span><span class="op" id="3373590">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373594">p</span><span class="op" id="3373595">.</span><span class="ident" id="3373596">resolve</span><span class="op" id="3373603">(</span><span class="ident" id="3373604">ident</span><span class="op" id="3373609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373613">sel</span>&nbsp;<span class="op" id="3373617">:=</span>&nbsp;<span class="ident" id="3373620">p</span><span class="op" id="3373621">.</span><span class="ident" id="3373622">parseIdent</span><span class="op" id="3373632">(</span><span class="op" id="3373633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373637">return</span>&nbsp;<span class="op" id="3373644">&amp;</span><span class="ident" id="3373645">ast</span><span class="op" id="3373648">.</span><span class="ident" id="3373649">SelectorExpr</span><span class="op" id="3373661">{</span><span class="ident" id="3373662">X</span><span class="op" id="3373663">:</span>&nbsp;<span class="ident" id="3373665">ident</span><span class="op" id="3373670">,</span>&nbsp;<span class="ident" id="3373672">Sel</span><span class="op" id="3373675">:</span>&nbsp;<span class="ident" id="3373677">sel</span><span class="op" id="3373680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373687">return</span>&nbsp;<span class="ident" id="3373694">ident</span><br>
<span class="lineno"></span><span class="op" id="3373700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3373703">func</span>&nbsp;<span class="op" id="3373708">(</span><span class="ident" id="3373709">p</span>&nbsp;<span class="op" id="3373711">*</span><span class="ident" id="3373712">parser</span><span class="op" id="3373718">)</span>&nbsp;<span class="ident" id="3373720">parseArrayType</span><span class="op" id="3373734">(</span><span class="op" id="3373735">)</span>&nbsp;<span class="ident" id="3373737">ast</span><span class="op" id="3373740">.</span><span class="ident" id="3373741">Expr</span>&nbsp;<span class="op" id="3373746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373749">if</span>&nbsp;<span class="ident" id="3373752">p</span><span class="op" id="3373753">.</span><span class="ident" id="3373754">trace</span>&nbsp;<span class="op" id="3373760">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373764">defer</span>&nbsp;<span class="ident" id="3373770">un</span><span class="op" id="3373772">(</span><span class="ident" id="3373773">trace</span><span class="op" id="3373778">(</span><span class="ident" id="3373779">p</span><span class="op" id="3373780">,</span>&nbsp;<span class="string" id="3373782">&#34;ArrayType&#34;</span><span class="op" id="3373793">)</span><span class="op" id="3373794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3373797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373801">lbrack</span>&nbsp;<span class="op" id="3373808">:=</span>&nbsp;<span class="ident" id="3373811">p</span><span class="op" id="3373812">.</span><span class="ident" id="3373813">expect</span><span class="op" id="3373819">(</span><span class="ident" id="3373820">token</span><span class="op" id="3373825">.</span><span class="ident" id="3373826">LBRACK</span><span class="op" id="3373832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373835">p</span><span class="op" id="3373836">.</span><span class="ident" id="3373837">exprLev</span><span class="op" id="3373844">++</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373848">var</span>&nbsp;<span class="builtinfunc" id="3373852">len</span>&nbsp;<span class="ident" id="3373856">ast</span><span class="op" id="3373859">.</span><span class="ident" id="3373860">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3373866">//&nbsp;always&nbsp;permit&nbsp;ellipsis&nbsp;for&nbsp;more&nbsp;fault-tolerant&nbsp;parsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3373925">if</span>&nbsp;<span class="ident" id="3373928">p</span><span class="op" id="3373929">.</span><span class="ident" id="3373930">tok</span>&nbsp;<span class="op" id="3373934">==</span>&nbsp;<span class="ident" id="3373937">token</span><span class="op" id="3373942">.</span><span class="ident" id="3373943">ELLIPSIS</span>&nbsp;<span class="op" id="3373952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3373956">len</span>&nbsp;<span class="op" id="3373960">=</span>&nbsp;<span class="op" id="3373962">&amp;</span><span class="ident" id="3373963">ast</span><span class="op" id="3373966">.</span><span class="ident" id="3373967">Ellipsis</span><span class="op" id="3373975">{</span><span class="ident" id="3373976">Ellipsis</span><span class="op" id="3373984">:</span>&nbsp;<span class="ident" id="3373986">p</span><span class="op" id="3373987">.</span><span class="ident" id="3373988">pos</span><span class="op" id="3373991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3373995">p</span><span class="op" id="3373996">.</span><span class="ident" id="3373997">next</span><span class="op" id="3374001">(</span><span class="op" id="3374002">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374005">}</span>&nbsp;<span class="keyword" id="3374007">else</span>&nbsp;<span class="keyword" id="3374012">if</span>&nbsp;<span class="ident" id="3374015">p</span><span class="op" id="3374016">.</span><span class="ident" id="3374017">tok</span>&nbsp;<span class="op" id="3374021">!=</span>&nbsp;<span class="ident" id="3374024">token</span><span class="op" id="3374029">.</span><span class="ident" id="3374030">RBRACK</span>&nbsp;<span class="op" id="3374037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3374041">len</span>&nbsp;<span class="op" id="3374045">=</span>&nbsp;<span class="ident" id="3374047">p</span><span class="op" id="3374048">.</span><span class="ident" id="3374049">parseRhs</span><span class="op" id="3374057">(</span><span class="op" id="3374058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374064">p</span><span class="op" id="3374065">.</span><span class="ident" id="3374066">exprLev</span><span class="op" id="3374073">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374077">p</span><span class="op" id="3374078">.</span><span class="ident" id="3374079">expect</span><span class="op" id="3374085">(</span><span class="ident" id="3374086">token</span><span class="op" id="3374091">.</span><span class="ident" id="3374092">RBRACK</span><span class="op" id="3374098">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374101">elt</span>&nbsp;<span class="op" id="3374105">:=</span>&nbsp;<span class="ident" id="3374108">p</span><span class="op" id="3374109">.</span><span class="ident" id="3374110">parseType</span><span class="op" id="3374119">(</span><span class="op" id="3374120">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374124">return</span>&nbsp;<span class="op" id="3374131">&amp;</span><span class="ident" id="3374132">ast</span><span class="op" id="3374135">.</span><span class="ident" id="3374136">ArrayType</span><span class="op" id="3374145">{</span><span class="ident" id="3374146">Lbrack</span><span class="op" id="3374152">:</span>&nbsp;<span class="ident" id="3374154">lbrack</span><span class="op" id="3374160">,</span>&nbsp;<span class="ident" id="3374162">Len</span><span class="op" id="3374165">:</span>&nbsp;<span class="builtinfunc" id="3374167">len</span><span class="op" id="3374170">,</span>&nbsp;<span class="ident" id="3374172">Elt</span><span class="op" id="3374175">:</span>&nbsp;<span class="ident" id="3374177">elt</span><span class="op" id="3374180">}</span><br>
<span class="lineno"></span><span class="op" id="3374182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="keyword" id="3374185">func</span>&nbsp;<span class="op" id="3374190">(</span><span class="ident" id="3374191">p</span>&nbsp;<span class="op" id="3374193">*</span><span class="ident" id="3374194">parser</span><span class="op" id="3374200">)</span>&nbsp;<span class="ident" id="3374202">makeIdentList</span><span class="op" id="3374215">(</span><span class="ident" id="3374216">list</span>&nbsp;<span class="op" id="3374221">[</span><span class="op" id="3374222">]</span><span class="ident" id="3374223">ast</span><span class="op" id="3374226">.</span><span class="ident" id="3374227">Expr</span><span class="op" id="3374231">)</span>&nbsp;<span class="op" id="3374233">[</span><span class="op" id="3374234">]</span><span class="op" id="3374235">*</span><span class="ident" id="3374236">ast</span><span class="op" id="3374239">.</span><span class="ident" id="3374240">Ident</span>&nbsp;<span class="op" id="3374246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374249">idents</span>&nbsp;<span class="op" id="3374256">:=</span>&nbsp;<span class="builtinfunc" id="3374259">make</span><span class="op" id="3374263">(</span><span class="op" id="3374264">[</span><span class="op" id="3374265">]</span><span class="op" id="3374266">*</span><span class="ident" id="3374267">ast</span><span class="op" id="3374270">.</span><span class="ident" id="3374271">Ident</span><span class="op" id="3374276">,</span>&nbsp;<span class="builtinfunc" id="3374278">len</span><span class="op" id="3374281">(</span><span class="ident" id="3374282">list</span><span class="op" id="3374286">)</span><span class="op" id="3374287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374290">for</span>&nbsp;<span class="ident" id="3374294">i</span><span class="op" id="3374295">,</span>&nbsp;<span class="ident" id="3374297">x</span>&nbsp;<span class="op" id="3374299">:=</span>&nbsp;<span class="keyword" id="3374302">range</span>&nbsp;<span class="ident" id="3374308">list</span>&nbsp;<span class="op" id="3374313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374317">ident</span><span class="op" id="3374322">,</span>&nbsp;<span class="ident" id="3374324">isIdent</span>&nbsp;<span class="op" id="3374332">:=</span>&nbsp;<span class="ident" id="3374335">x</span><span class="op" id="3374336">.</span><span class="op" id="3374337">(</span><span class="op" id="3374338">*</span><span class="ident" id="3374339">ast</span><span class="op" id="3374342">.</span><span class="ident" id="3374343">Ident</span><span class="op" id="3374348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374352">if</span>&nbsp;<span class="op" id="3374355">!</span><span class="ident" id="3374356">isIdent</span>&nbsp;<span class="op" id="3374364">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374369">if</span>&nbsp;<span class="ident" id="3374372">_</span><span class="op" id="3374373">,</span>&nbsp;<span class="ident" id="3374375">isBad</span>&nbsp;<span class="op" id="3374381">:=</span>&nbsp;<span class="ident" id="3374384">x</span><span class="op" id="3374385">.</span><span class="op" id="3374386">(</span><span class="op" id="3374387">*</span><span class="ident" id="3374388">ast</span><span class="op" id="3374391">.</span><span class="ident" id="3374392">BadExpr</span><span class="op" id="3374399">)</span><span class="op" id="3374400">;</span>&nbsp;<span class="op" id="3374402">!</span><span class="ident" id="3374403">isBad</span>&nbsp;<span class="op" id="3374409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374415">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374458">p</span><span class="op" id="3374459">.</span><span class="ident" id="3374460">errorExpected</span><span class="op" id="3374473">(</span><span class="ident" id="3374474">x</span><span class="op" id="3374475">.</span><span class="ident" id="3374476">Pos</span><span class="op" id="3374479">(</span><span class="op" id="3374480">)</span><span class="op" id="3374481">,</span>&nbsp;<span class="string" id="3374483">&#34;identifier&#34;</span><span class="op" id="3374495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374505">ident</span>&nbsp;<span class="op" id="3374511">=</span>&nbsp;<span class="op" id="3374513">&amp;</span><span class="ident" id="3374514">ast</span><span class="op" id="3374517">.</span><span class="ident" id="3374518">Ident</span><span class="op" id="3374523">{</span><span class="ident" id="3374524">NamePos</span><span class="op" id="3374531">:</span>&nbsp;<span class="ident" id="3374533">x</span><span class="op" id="3374534">.</span><span class="ident" id="3374535">Pos</span><span class="op" id="3374538">(</span><span class="op" id="3374539">)</span><span class="op" id="3374540">,</span>&nbsp;<span class="ident" id="3374542">Name</span><span class="op" id="3374546">:</span>&nbsp;<span class="string" id="3374548">&#34;_&#34;</span><span class="op" id="3374551">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374559">idents</span><span class="op" id="3374565">[</span><span class="ident" id="3374566">i</span><span class="op" id="3374567">]</span>&nbsp;<span class="op" id="3374569">=</span>&nbsp;<span class="ident" id="3374571">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374581">return</span>&nbsp;<span class="ident" id="3374588">idents</span><br>
<span class="lineno"></span><span class="op" id="3374595">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="3374598">func</span>&nbsp;<span class="op" id="3374603">(</span><span class="ident" id="3374604">p</span>&nbsp;<span class="op" id="3374606">*</span><span class="ident" id="3374607">parser</span><span class="op" id="3374613">)</span>&nbsp;<span class="ident" id="3374615">parseFieldDecl</span><span class="op" id="3374629">(</span><span class="ident" id="3374630">scope</span>&nbsp;<span class="op" id="3374636">*</span><span class="ident" id="3374637">ast</span><span class="op" id="3374640">.</span><span class="ident" id="3374641">Scope</span><span class="op" id="3374646">)</span>&nbsp;<span class="op" id="3374648">*</span><span class="ident" id="3374649">ast</span><span class="op" id="3374652">.</span><span class="ident" id="3374653">Field</span>&nbsp;<span class="op" id="3374659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374662">if</span>&nbsp;<span class="ident" id="3374665">p</span><span class="op" id="3374666">.</span><span class="ident" id="3374667">trace</span>&nbsp;<span class="op" id="3374673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374677">defer</span>&nbsp;<span class="ident" id="3374683">un</span><span class="op" id="3374685">(</span><span class="ident" id="3374686">trace</span><span class="op" id="3374691">(</span><span class="ident" id="3374692">p</span><span class="op" id="3374693">,</span>&nbsp;<span class="string" id="3374695">&#34;FieldDecl&#34;</span><span class="op" id="3374706">)</span><span class="op" id="3374707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374710">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374714">doc</span>&nbsp;<span class="op" id="3374718">:=</span>&nbsp;<span class="ident" id="3374721">p</span><span class="op" id="3374722">.</span><span class="ident" id="3374723">leadComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374737">//&nbsp;FieldDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374751">list</span><span class="op" id="3374755">,</span>&nbsp;<span class="ident" id="3374757">typ</span>&nbsp;<span class="op" id="3374761">:=</span>&nbsp;<span class="ident" id="3374764">p</span><span class="op" id="3374765">.</span><span class="ident" id="3374766">parseVarList</span><span class="op" id="3374778">(</span><span class="builtintype" id="3374779">false</span><span class="op" id="3374784">)</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374788">//&nbsp;Tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374796">var</span>&nbsp;<span class="ident" id="3374800">tag</span>&nbsp;<span class="op" id="3374804">*</span><span class="ident" id="3374805">ast</span><span class="op" id="3374808">.</span><span class="ident" id="3374809">BasicLit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374819">if</span>&nbsp;<span class="ident" id="3374822">p</span><span class="op" id="3374823">.</span><span class="ident" id="3374824">tok</span>&nbsp;<span class="op" id="3374828">==</span>&nbsp;<span class="ident" id="3374831">token</span><span class="op" id="3374836">.</span><span class="ident" id="3374837">STRING</span>&nbsp;<span class="op" id="3374844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374848">tag</span>&nbsp;<span class="op" id="3374852">=</span>&nbsp;<span class="op" id="3374854">&amp;</span><span class="ident" id="3374855">ast</span><span class="op" id="3374858">.</span><span class="ident" id="3374859">BasicLit</span><span class="op" id="3374867">{</span><span class="ident" id="3374868">ValuePos</span><span class="op" id="3374876">:</span>&nbsp;<span class="ident" id="3374878">p</span><span class="op" id="3374879">.</span><span class="ident" id="3374880">pos</span><span class="op" id="3374883">,</span>&nbsp;<span class="ident" id="3374885">Kind</span><span class="op" id="3374889">:</span>&nbsp;<span class="ident" id="3374891">p</span><span class="op" id="3374892">.</span><span class="ident" id="3374893">tok</span><span class="op" id="3374896">,</span>&nbsp;<span class="ident" id="3374898">Value</span><span class="op" id="3374903">:</span>&nbsp;<span class="ident" id="3374905">p</span><span class="op" id="3374906">.</span><span class="ident" id="3374907">lit</span><span class="op" id="3374910">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3374914">p</span><span class="op" id="3374915">.</span><span class="ident" id="3374916">next</span><span class="op" id="3374920">(</span><span class="op" id="3374921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3374924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374928">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374945">var</span>&nbsp;<span class="ident" id="3374949">idents</span>&nbsp;<span class="op" id="3374956">[</span><span class="op" id="3374957">]</span><span class="op" id="3374958">*</span><span class="ident" id="3374959">ast</span><span class="op" id="3374962">.</span><span class="ident" id="3374963">Ident</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3374970">if</span>&nbsp;<span class="ident" id="3374973">typ</span>&nbsp;<span class="op" id="3374977">!=</span>&nbsp;<span class="ident" id="3374980">nil</span>&nbsp;<span class="op" id="3374984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3374988">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375013">idents</span>&nbsp;<span class="op" id="3375020">=</span>&nbsp;<span class="ident" id="3375022">p</span><span class="op" id="3375023">.</span><span class="ident" id="3375024">makeIdentList</span><span class="op" id="3375037">(</span><span class="ident" id="3375038">list</span><span class="op" id="3375042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375045">}</span>&nbsp;<span class="keyword" id="3375047">else</span>&nbsp;<span class="op" id="3375052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3375056">//&nbsp;[&#34;*&#34;]&nbsp;TypeName&nbsp;(AnonymousField)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375093">typ</span>&nbsp;<span class="op" id="3375097">=</span>&nbsp;<span class="ident" id="3375099">list</span><span class="op" id="3375103">[</span><span class="num" id="3375104">0</span><span class="op" id="3375105">]</span>&nbsp;<span class="comment" id="3375107">//&nbsp;we&nbsp;always&nbsp;have&nbsp;at&nbsp;least&nbsp;one&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375148">if</span>&nbsp;<span class="ident" id="3375151">n</span>&nbsp;<span class="op" id="3375153">:=</span>&nbsp;<span class="builtinfunc" id="3375156">len</span><span class="op" id="3375159">(</span><span class="ident" id="3375160">list</span><span class="op" id="3375164">)</span><span class="op" id="3375165">;</span>&nbsp;<span class="ident" id="3375167">n</span>&nbsp;<span class="op" id="3375169">&gt;</span>&nbsp;<span class="num" id="3375171">1</span>&nbsp;<span class="op" id="3375173">||</span>&nbsp;<span class="op" id="3375176">!</span><span class="ident" id="3375177">isTypeName</span><span class="op" id="3375187">(</span><span class="ident" id="3375188">deref</span><span class="op" id="3375193">(</span><span class="ident" id="3375194">typ</span><span class="op" id="3375197">)</span><span class="op" id="3375198">)</span>&nbsp;<span class="op" id="3375200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375205">pos</span>&nbsp;<span class="op" id="3375209">:=</span>&nbsp;<span class="ident" id="3375212">typ</span><span class="op" id="3375215">.</span><span class="ident" id="3375216">Pos</span><span class="op" id="3375219">(</span><span class="op" id="3375220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375225">p</span><span class="op" id="3375226">.</span><span class="ident" id="3375227">errorExpected</span><span class="op" id="3375240">(</span><span class="ident" id="3375241">pos</span><span class="op" id="3375244">,</span>&nbsp;<span class="string" id="3375246">&#34;anonymous&nbsp;field&#34;</span><span class="op" id="3375263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375268">typ</span>&nbsp;<span class="op" id="3375272">=</span>&nbsp;<span class="op" id="3375274">&amp;</span><span class="ident" id="3375275">ast</span><span class="op" id="3375278">.</span><span class="ident" id="3375279">BadExpr</span><span class="op" id="3375286">{</span><span class="ident" id="3375287">From</span><span class="op" id="3375291">:</span>&nbsp;<span class="ident" id="3375293">pos</span><span class="op" id="3375296">,</span>&nbsp;<span class="ident" id="3375298">To</span><span class="op" id="3375300">:</span>&nbsp;<span class="ident" id="3375302">p</span><span class="op" id="3375303">.</span><span class="ident" id="3375304">safePos</span><span class="op" id="3375311">(</span><span class="ident" id="3375312">list</span><span class="op" id="3375316">[</span><span class="ident" id="3375317">n</span><span class="op" id="3375318">-</span><span class="num" id="3375319">1</span><span class="op" id="3375320">]</span><span class="op" id="3375321">.</span><span class="ident" id="3375322">End</span><span class="op" id="3375325">(</span><span class="op" id="3375326">)</span><span class="op" id="3375327">)</span><span class="op" id="3375328">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375339">p</span><span class="op" id="3375340">.</span><span class="ident" id="3375341">expectSemi</span><span class="op" id="3375351">(</span><span class="op" id="3375352">)</span>&nbsp;<span class="comment" id="3375354">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375395">field</span>&nbsp;<span class="op" id="3375401">:=</span>&nbsp;<span class="op" id="3375404">&amp;</span><span class="ident" id="3375405">ast</span><span class="op" id="3375408">.</span><span class="ident" id="3375409">Field</span><span class="op" id="3375414">{</span><span class="ident" id="3375415">Doc</span><span class="op" id="3375418">:</span>&nbsp;<span class="ident" id="3375420">doc</span><span class="op" id="3375423">,</span>&nbsp;<span class="ident" id="3375425">Names</span><span class="op" id="3375430">:</span>&nbsp;<span class="ident" id="3375432">idents</span><span class="op" id="3375438">,</span>&nbsp;<span class="ident" id="3375440">Type</span><span class="op" id="3375444">:</span>&nbsp;<span class="ident" id="3375446">typ</span><span class="op" id="3375449">,</span>&nbsp;<span class="ident" id="3375451">Tag</span><span class="op" id="3375454">:</span>&nbsp;<span class="ident" id="3375456">tag</span><span class="op" id="3375459">,</span>&nbsp;<span class="ident" id="3375461">Comment</span><span class="op" id="3375468">:</span>&nbsp;<span class="ident" id="3375470">p</span><span class="op" id="3375471">.</span><span class="ident" id="3375472">lineComment</span><span class="op" id="3375483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375486">p</span><span class="op" id="3375487">.</span><span class="ident" id="3375488">declare</span><span class="op" id="3375495">(</span><span class="ident" id="3375496">field</span><span class="op" id="3375501">,</span>&nbsp;<span class="ident" id="3375503">nil</span><span class="op" id="3375506">,</span>&nbsp;<span class="ident" id="3375508">scope</span><span class="op" id="3375513">,</span>&nbsp;<span class="ident" id="3375515">ast</span><span class="op" id="3375518">.</span><span class="ident" id="3375519">Var</span><span class="op" id="3375522">,</span>&nbsp;<span class="ident" id="3375524">idents</span><span class="op" id="3375530">...</span><span class="op" id="3375533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375536">p</span><span class="op" id="3375537">.</span><span class="ident" id="3375538">resolve</span><span class="op" id="3375545">(</span><span class="ident" id="3375546">typ</span><span class="op" id="3375549">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375553">return</span>&nbsp;<span class="ident" id="3375560">field</span><br>
<span class="lineno">715</span><span class="op" id="3375566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3375569">func</span>&nbsp;<span class="op" id="3375574">(</span><span class="ident" id="3375575">p</span>&nbsp;<span class="op" id="3375577">*</span><span class="ident" id="3375578">parser</span><span class="op" id="3375584">)</span>&nbsp;<span class="ident" id="3375586">parseStructType</span><span class="op" id="3375601">(</span><span class="op" id="3375602">)</span>&nbsp;<span class="op" id="3375604">*</span><span class="ident" id="3375605">ast</span><span class="op" id="3375608">.</span><span class="ident" id="3375609">StructType</span>&nbsp;<span class="op" id="3375620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375623">if</span>&nbsp;<span class="ident" id="3375626">p</span><span class="op" id="3375627">.</span><span class="ident" id="3375628">trace</span>&nbsp;<span class="op" id="3375634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375638">defer</span>&nbsp;<span class="ident" id="3375644">un</span><span class="op" id="3375646">(</span><span class="ident" id="3375647">trace</span><span class="op" id="3375652">(</span><span class="ident" id="3375653">p</span><span class="op" id="3375654">,</span>&nbsp;<span class="string" id="3375656">&#34;StructType&#34;</span><span class="op" id="3375668">)</span><span class="op" id="3375669">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3375672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375676">pos</span>&nbsp;<span class="op" id="3375680">:=</span>&nbsp;<span class="ident" id="3375683">p</span><span class="op" id="3375684">.</span><span class="ident" id="3375685">expect</span><span class="op" id="3375691">(</span><span class="ident" id="3375692">token</span><span class="op" id="3375697">.</span><span class="ident" id="3375698">STRUCT</span><span class="op" id="3375704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375707">lbrace</span>&nbsp;<span class="op" id="3375714">:=</span>&nbsp;<span class="ident" id="3375717">p</span><span class="op" id="3375718">.</span><span class="ident" id="3375719">expect</span><span class="op" id="3375725">(</span><span class="ident" id="3375726">token</span><span class="op" id="3375731">.</span><span class="ident" id="3375732">LBRACE</span><span class="op" id="3375738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3375741">scope</span>&nbsp;<span class="op" id="3375747">:=</span>&nbsp;<span class="ident" id="3375750">ast</span><span class="op" id="3375753">.</span><span class="ident" id="3375754">NewScope</span><span class="op" id="3375762">(</span><span class="ident" id="3375763">nil</span><span class="op" id="3375766">)</span>&nbsp;<span class="comment" id="3375768">//&nbsp;struct&nbsp;scope</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375785">var</span>&nbsp;<span class="ident" id="3375789">list</span>&nbsp;<span class="op" id="3375794">[</span><span class="op" id="3375795">]</span><span class="op" id="3375796">*</span><span class="ident" id="3375797">ast</span><span class="op" id="3375800">.</span><span class="ident" id="3375801">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3375808">for</span>&nbsp;<span class="ident" id="3375812">p</span><span class="op" id="3375813">.</span><span class="ident" id="3375814">tok</span>&nbsp;<span class="op" id="3375818">==</span>&nbsp;<span class="ident" id="3375821">token</span><span class="op" id="3375826">.</span><span class="ident" id="3375827">IDENT</span>&nbsp;<span class="op" id="3375833">||</span>&nbsp;<span class="ident" id="3375836">p</span><span class="op" id="3375837">.</span><span class="ident" id="3375838">tok</span>&nbsp;<span class="op" id="3375842">==</span>&nbsp;<span class="ident" id="3375845">token</span><span class="op" id="3375850">.</span><span class="ident" id="3375851">MUL</span>&nbsp;<span class="op" id="3375855">||</span>&nbsp;<span class="ident" id="3375858">p</span><span class="op" id="3375859">.</span><span class="ident" id="3375860">tok</span>&nbsp;<span class="op" id="3375864">==</span>&nbsp;<span class="ident" id="3375867">token</span><span class="op" id="3375872">.</span><span class="ident" id="3375873">LPAREN</span>&nbsp;<span class="op" id="3375880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3375884">//&nbsp;a&nbsp;field&nbsp;declaration&nbsp;cannot&nbsp;start&nbsp;with&nbsp;a&nbsp;&#39;(&#39;&nbsp;but&nbsp;we&nbsp;accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3375947">//&nbsp;it&nbsp;here&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;better&nbsp;error&nbsp;messages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3376010">//&nbsp;(parseFieldDecl&nbsp;will&nbsp;check&nbsp;and&nbsp;complain&nbsp;if&nbsp;necessary)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376069">list</span>&nbsp;<span class="op" id="3376074">=</span>&nbsp;<span class="builtinfunc" id="3376076">append</span><span class="op" id="3376082">(</span><span class="ident" id="3376083">list</span><span class="op" id="3376087">,</span>&nbsp;<span class="ident" id="3376089">p</span><span class="op" id="3376090">.</span><span class="ident" id="3376091">parseFieldDecl</span><span class="op" id="3376105">(</span><span class="ident" id="3376106">scope</span><span class="op" id="3376111">)</span><span class="op" id="3376112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3376115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376118">rbrace</span>&nbsp;<span class="op" id="3376125">:=</span>&nbsp;<span class="ident" id="3376128">p</span><span class="op" id="3376129">.</span><span class="ident" id="3376130">expect</span><span class="op" id="3376136">(</span><span class="ident" id="3376137">token</span><span class="op" id="3376142">.</span><span class="ident" id="3376143">RBRACE</span><span class="op" id="3376149">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376153">return</span>&nbsp;<span class="op" id="3376160">&amp;</span><span class="ident" id="3376161">ast</span><span class="op" id="3376164">.</span><span class="ident" id="3376165">StructType</span><span class="op" id="3376175">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376179">Struct</span><span class="op" id="3376185">:</span>&nbsp;<span class="ident" id="3376187">pos</span><span class="op" id="3376190">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376194">Fields</span><span class="op" id="3376200">:</span>&nbsp;<span class="op" id="3376202">&amp;</span><span class="ident" id="3376203">ast</span><span class="op" id="3376206">.</span><span class="ident" id="3376207">FieldList</span><span class="op" id="3376216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376221">Opening</span><span class="op" id="3376228">:</span>&nbsp;<span class="ident" id="3376230">lbrace</span><span class="op" id="3376236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376241">List</span><span class="op" id="3376245">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3376250">list</span><span class="op" id="3376254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376259">Closing</span><span class="op" id="3376266">:</span>&nbsp;<span class="ident" id="3376268">rbrace</span><span class="op" id="3376274">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3376278">}</span><span class="op" id="3376279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3376282">}</span><br>
<span class="lineno"></span><span class="op" id="3376284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3376287">func</span>&nbsp;<span class="op" id="3376292">(</span><span class="ident" id="3376293">p</span>&nbsp;<span class="op" id="3376295">*</span><span class="ident" id="3376296">parser</span><span class="op" id="3376302">)</span>&nbsp;<span class="ident" id="3376304">parsePointerType</span><span class="op" id="3376320">(</span><span class="op" id="3376321">)</span>&nbsp;<span class="op" id="3376323">*</span><span class="ident" id="3376324">ast</span><span class="op" id="3376327">.</span><span class="ident" id="3376328">StarExpr</span>&nbsp;<span class="op" id="3376337">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376340">if</span>&nbsp;<span class="ident" id="3376343">p</span><span class="op" id="3376344">.</span><span class="ident" id="3376345">trace</span>&nbsp;<span class="op" id="3376351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376355">defer</span>&nbsp;<span class="ident" id="3376361">un</span><span class="op" id="3376363">(</span><span class="ident" id="3376364">trace</span><span class="op" id="3376369">(</span><span class="ident" id="3376370">p</span><span class="op" id="3376371">,</span>&nbsp;<span class="string" id="3376373">&#34;PointerType&#34;</span><span class="op" id="3376386">)</span><span class="op" id="3376387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3376390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376394">star</span>&nbsp;<span class="op" id="3376399">:=</span>&nbsp;<span class="ident" id="3376402">p</span><span class="op" id="3376403">.</span><span class="ident" id="3376404">expect</span><span class="op" id="3376410">(</span><span class="ident" id="3376411">token</span><span class="op" id="3376416">.</span><span class="ident" id="3376417">MUL</span><span class="op" id="3376420">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376423">base</span>&nbsp;<span class="op" id="3376428">:=</span>&nbsp;<span class="ident" id="3376431">p</span><span class="op" id="3376432">.</span><span class="ident" id="3376433">parseType</span><span class="op" id="3376442">(</span><span class="op" id="3376443">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376447">return</span>&nbsp;<span class="op" id="3376454">&amp;</span><span class="ident" id="3376455">ast</span><span class="op" id="3376458">.</span><span class="ident" id="3376459">StarExpr</span><span class="op" id="3376467">{</span><span class="ident" id="3376468">Star</span><span class="op" id="3376472">:</span>&nbsp;<span class="ident" id="3376474">star</span><span class="op" id="3376478">,</span>&nbsp;<span class="ident" id="3376480">X</span><span class="op" id="3376481">:</span>&nbsp;<span class="ident" id="3376483">base</span><span class="op" id="3376487">}</span><br>
<span class="lineno"></span><span class="op" id="3376489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="3376492">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="3376547">func</span>&nbsp;<span class="op" id="3376552">(</span><span class="ident" id="3376553">p</span>&nbsp;<span class="op" id="3376555">*</span><span class="ident" id="3376556">parser</span><span class="op" id="3376562">)</span>&nbsp;<span class="ident" id="3376564">tryVarType</span><span class="op" id="3376574">(</span><span class="ident" id="3376575">isParam</span>&nbsp;<span class="builtintype" id="3376583">bool</span><span class="op" id="3376587">)</span>&nbsp;<span class="ident" id="3376589">ast</span><span class="op" id="3376592">.</span><span class="ident" id="3376593">Expr</span>&nbsp;<span class="op" id="3376598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376601">if</span>&nbsp;<span class="ident" id="3376604">isParam</span>&nbsp;<span class="op" id="3376612">&amp;&amp;</span>&nbsp;<span class="ident" id="3376615">p</span><span class="op" id="3376616">.</span><span class="ident" id="3376617">tok</span>&nbsp;<span class="op" id="3376621">==</span>&nbsp;<span class="ident" id="3376624">token</span><span class="op" id="3376629">.</span><span class="ident" id="3376630">ELLIPSIS</span>&nbsp;<span class="op" id="3376639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376643">pos</span>&nbsp;<span class="op" id="3376647">:=</span>&nbsp;<span class="ident" id="3376650">p</span><span class="op" id="3376651">.</span><span class="ident" id="3376652">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376658">p</span><span class="op" id="3376659">.</span><span class="ident" id="3376660">next</span><span class="op" id="3376664">(</span><span class="op" id="3376665">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376669">typ</span>&nbsp;<span class="op" id="3376673">:=</span>&nbsp;<span class="ident" id="3376676">p</span><span class="op" id="3376677">.</span><span class="ident" id="3376678">tryIdentOrType</span><span class="op" id="3376692">(</span><span class="op" id="3376693">)</span>&nbsp;<span class="comment" id="3376695">//&nbsp;don&#39;t&nbsp;use&nbsp;parseType&nbsp;so&nbsp;we&nbsp;can&nbsp;provide&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376759">if</span>&nbsp;<span class="ident" id="3376762">typ</span>&nbsp;<span class="op" id="3376766">!=</span>&nbsp;<span class="ident" id="3376769">nil</span>&nbsp;<span class="op" id="3376773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376778">p</span><span class="op" id="3376779">.</span><span class="ident" id="3376780">resolve</span><span class="op" id="3376787">(</span><span class="ident" id="3376788">typ</span><span class="op" id="3376791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3376795">}</span>&nbsp;<span class="keyword" id="3376797">else</span>&nbsp;<span class="op" id="3376802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376807">p</span><span class="op" id="3376808">.</span><span class="builtintype" id="3376809">error</span><span class="op" id="3376814">(</span><span class="ident" id="3376815">pos</span><span class="op" id="3376818">,</span>&nbsp;<span class="string" id="3376820">&#34;&#39;...&#39;&nbsp;parameter&nbsp;is&nbsp;missing&nbsp;type&#34;</span><span class="op" id="3376853">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3376858">typ</span>&nbsp;<span class="op" id="3376862">=</span>&nbsp;<span class="op" id="3376864">&amp;</span><span class="ident" id="3376865">ast</span><span class="op" id="3376868">.</span><span class="ident" id="3376869">BadExpr</span><span class="op" id="3376876">{</span><span class="ident" id="3376877">From</span><span class="op" id="3376881">:</span>&nbsp;<span class="ident" id="3376883">pos</span><span class="op" id="3376886">,</span>&nbsp;<span class="ident" id="3376888">To</span><span class="op" id="3376890">:</span>&nbsp;<span class="ident" id="3376892">p</span><span class="op" id="3376893">.</span><span class="ident" id="3376894">pos</span><span class="op" id="3376897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3376901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376905">return</span>&nbsp;<span class="op" id="3376912">&amp;</span><span class="ident" id="3376913">ast</span><span class="op" id="3376916">.</span><span class="ident" id="3376917">Ellipsis</span><span class="op" id="3376925">{</span><span class="ident" id="3376926">Ellipsis</span><span class="op" id="3376934">:</span>&nbsp;<span class="ident" id="3376936">pos</span><span class="op" id="3376939">,</span>&nbsp;<span class="ident" id="3376941">Elt</span><span class="op" id="3376944">:</span>&nbsp;<span class="ident" id="3376946">typ</span><span class="op" id="3376949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3376952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3376955">return</span>&nbsp;<span class="ident" id="3376962">p</span><span class="op" id="3376963">.</span><span class="ident" id="3376964">tryIdentOrType</span><span class="op" id="3376978">(</span><span class="op" id="3376979">)</span><br>
<span class="lineno">770</span><span class="op" id="3376981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3376984">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="3377039">func</span>&nbsp;<span class="op" id="3377044">(</span><span class="ident" id="3377045">p</span>&nbsp;<span class="op" id="3377047">*</span><span class="ident" id="3377048">parser</span><span class="op" id="3377054">)</span>&nbsp;<span class="ident" id="3377056">parseVarType</span><span class="op" id="3377068">(</span><span class="ident" id="3377069">isParam</span>&nbsp;<span class="builtintype" id="3377077">bool</span><span class="op" id="3377081">)</span>&nbsp;<span class="ident" id="3377083">ast</span><span class="op" id="3377086">.</span><span class="ident" id="3377087">Expr</span>&nbsp;<span class="op" id="3377092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3377095">typ</span>&nbsp;<span class="op" id="3377099">:=</span>&nbsp;<span class="ident" id="3377102">p</span><span class="op" id="3377103">.</span><span class="ident" id="3377104">tryVarType</span><span class="op" id="3377114">(</span><span class="ident" id="3377115">isParam</span><span class="op" id="3377122">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377125">if</span>&nbsp;<span class="ident" id="3377128">typ</span>&nbsp;<span class="op" id="3377132">==</span>&nbsp;<span class="ident" id="3377135">nil</span>&nbsp;<span class="op" id="3377139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3377143">pos</span>&nbsp;<span class="op" id="3377147">:=</span>&nbsp;<span class="ident" id="3377150">p</span><span class="op" id="3377151">.</span><span class="ident" id="3377152">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3377158">p</span><span class="op" id="3377159">.</span><span class="ident" id="3377160">errorExpected</span><span class="op" id="3377173">(</span><span class="ident" id="3377174">pos</span><span class="op" id="3377177">,</span>&nbsp;<span class="string" id="3377179">&#34;type&#34;</span><span class="op" id="3377185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3377189">p</span><span class="op" id="3377190">.</span><span class="ident" id="3377191">next</span><span class="op" id="3377195">(</span><span class="op" id="3377196">)</span>&nbsp;<span class="comment" id="3377198">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3377217">typ</span>&nbsp;<span class="op" id="3377221">=</span>&nbsp;<span class="op" id="3377223">&amp;</span><span class="ident" id="3377224">ast</span><span class="op" id="3377227">.</span><span class="ident" id="3377228">BadExpr</span><span class="op" id="3377235">{</span><span class="ident" id="3377236">From</span><span class="op" id="3377240">:</span>&nbsp;<span class="ident" id="3377242">pos</span><span class="op" id="3377245">,</span>&nbsp;<span class="ident" id="3377247">To</span><span class="op" id="3377249">:</span>&nbsp;<span class="ident" id="3377251">p</span><span class="op" id="3377252">.</span><span class="ident" id="3377253">pos</span><span class="op" id="3377256">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3377259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377262">return</span>&nbsp;<span class="ident" id="3377269">typ</span><br>
<span class="lineno"></span><span class="op" id="3377273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3377276">//&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;results&nbsp;are&nbsp;identifiers,&nbsp;they&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">785</span><span class="keyword" id="3377341">func</span>&nbsp;<span class="op" id="3377346">(</span><span class="ident" id="3377347">p</span>&nbsp;<span class="op" id="3377349">*</span><span class="ident" id="3377350">parser</span><span class="op" id="3377356">)</span>&nbsp;<span class="ident" id="3377358">parseVarList</span><span class="op" id="3377370">(</span><span class="ident" id="3377371">isParam</span>&nbsp;<span class="builtintype" id="3377379">bool</span><span class="op" id="3377383">)</span>&nbsp;<span class="op" id="3377385">(</span><span class="ident" id="3377386">list</span>&nbsp;<span class="op" id="3377391">[</span><span class="op" id="3377392">]</span><span class="ident" id="3377393">ast</span><span class="op" id="3377396">.</span><span class="ident" id="3377397">Expr</span><span class="op" id="3377401">,</span>&nbsp;<span class="ident" id="3377403">typ</span>&nbsp;<span class="ident" id="3377407">ast</span><span class="op" id="3377410">.</span><span class="ident" id="3377411">Expr</span><span class="op" id="3377415">)</span>&nbsp;<span class="op" id="3377417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377420">if</span>&nbsp;<span class="ident" id="3377423">p</span><span class="op" id="3377424">.</span><span class="ident" id="3377425">trace</span>&nbsp;<span class="op" id="3377431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377435">defer</span>&nbsp;<span class="ident" id="3377441">un</span><span class="op" id="3377443">(</span><span class="ident" id="3377444">trace</span><span class="op" id="3377449">(</span><span class="ident" id="3377450">p</span><span class="op" id="3377451">,</span>&nbsp;<span class="string" id="3377453">&#34;VarList&#34;</span><span class="op" id="3377462">)</span><span class="op" id="3377463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3377466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3377470">//&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers&nbsp;looks&nbsp;like&nbsp;a&nbsp;list&nbsp;of&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3377528">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3377532">//&nbsp;parse/tryVarType&nbsp;accepts&nbsp;any&nbsp;type&nbsp;(including&nbsp;parenthesized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3377595">//&nbsp;ones)&nbsp;even&nbsp;though&nbsp;the&nbsp;syntax&nbsp;does&nbsp;not&nbsp;permit&nbsp;them&nbsp;here:&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3377658">//&nbsp;accept&nbsp;them&nbsp;all&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;complain&nbsp;later</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377721">for</span>&nbsp;<span class="ident" id="3377725">typ</span>&nbsp;<span class="op" id="3377729">:=</span>&nbsp;<span class="ident" id="3377732">p</span><span class="op" id="3377733">.</span><span class="ident" id="3377734">parseVarType</span><span class="op" id="3377746">(</span><span class="ident" id="3377747">isParam</span><span class="op" id="3377754">)</span><span class="op" id="3377755">;</span>&nbsp;<span class="ident" id="3377757">typ</span>&nbsp;<span class="op" id="3377761">!=</span>&nbsp;<span class="ident" id="3377764">nil</span><span class="op" id="3377767">;</span>&nbsp;<span class="op" id="3377769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3377773">list</span>&nbsp;<span class="op" id="3377778">=</span>&nbsp;<span class="builtinfunc" id="3377780">append</span><span class="op" id="3377786">(</span><span class="ident" id="3377787">list</span><span class="op" id="3377791">,</span>&nbsp;<span class="ident" id="3377793">typ</span><span class="op" id="3377796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377800">if</span>&nbsp;<span class="ident" id="3377803">p</span><span class="op" id="3377804">.</span><span class="ident" id="3377805">tok</span>&nbsp;<span class="op" id="3377809">!=</span>&nbsp;<span class="ident" id="3377812">token</span><span class="op" id="3377817">.</span><span class="ident" id="3377818">COMMA</span>&nbsp;<span class="op" id="3377824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3377829">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3377837">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3377841">p</span><span class="op" id="3377842">.</span><span class="ident" id="3377843">next</span><span class="op" id="3377847">(</span><span class="op" id="3377848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3377852">typ</span>&nbsp;<span class="op" id="3377856">=</span>&nbsp;<span class="ident" id="3377858">p</span><span class="op" id="3377859">.</span><span class="ident" id="3377860">tryVarType</span><span class="op" id="3377870">(</span><span class="ident" id="3377871">isParam</span><span class="op" id="3377878">)</span>&nbsp;<span class="comment" id="3377880">//&nbsp;maybe&nbsp;nil&nbsp;as&nbsp;in:&nbsp;func&nbsp;f(int,)&nbsp;{}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3377917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3377921">//&nbsp;if&nbsp;we&nbsp;had&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers,&nbsp;it&nbsp;must&nbsp;be&nbsp;followed&nbsp;by&nbsp;a&nbsp;type</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3377988">typ</span>&nbsp;<span class="op" id="3377992">=</span>&nbsp;<span class="ident" id="3377994">p</span><span class="op" id="3377995">.</span><span class="ident" id="3377996">tryVarType</span><span class="op" id="3378006">(</span><span class="ident" id="3378007">isParam</span><span class="op" id="3378014">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3378018">return</span><br>
<span class="lineno"></span><span class="op" id="3378025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="3378028">func</span>&nbsp;<span class="op" id="3378033">(</span><span class="ident" id="3378034">p</span>&nbsp;<span class="op" id="3378036">*</span><span class="ident" id="3378037">parser</span><span class="op" id="3378043">)</span>&nbsp;<span class="ident" id="3378045">parseParameterList</span><span class="op" id="3378063">(</span><span class="ident" id="3378064">scope</span>&nbsp;<span class="op" id="3378070">*</span><span class="ident" id="3378071">ast</span><span class="op" id="3378074">.</span><span class="ident" id="3378075">Scope</span><span class="op" id="3378080">,</span>&nbsp;<span class="ident" id="3378082">ellipsisOk</span>&nbsp;<span class="builtintype" id="3378093">bool</span><span class="op" id="3378097">)</span>&nbsp;<span class="op" id="3378099">(</span><span class="ident" id="3378100">params</span>&nbsp;<span class="op" id="3378107">[</span><span class="op" id="3378108">]</span><span class="op" id="3378109">*</span><span class="ident" id="3378110">ast</span><span class="op" id="3378113">.</span><span class="ident" id="3378114">Field</span><span class="op" id="3378119">)</span>&nbsp;<span class="op" id="3378121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3378124">if</span>&nbsp;<span class="ident" id="3378127">p</span><span class="op" id="3378128">.</span><span class="ident" id="3378129">trace</span>&nbsp;<span class="op" id="3378135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3378139">defer</span>&nbsp;<span class="ident" id="3378145">un</span><span class="op" id="3378147">(</span><span class="ident" id="3378148">trace</span><span class="op" id="3378153">(</span><span class="ident" id="3378154">p</span><span class="op" id="3378155">,</span>&nbsp;<span class="string" id="3378157">&#34;ParameterList&#34;</span><span class="op" id="3378172">)</span><span class="op" id="3378173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3378176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3378180">//&nbsp;ParameterDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378198">list</span><span class="op" id="3378202">,</span>&nbsp;<span class="ident" id="3378204">typ</span>&nbsp;<span class="op" id="3378208">:=</span>&nbsp;<span class="ident" id="3378211">p</span><span class="op" id="3378212">.</span><span class="ident" id="3378213">parseVarList</span><span class="op" id="3378225">(</span><span class="ident" id="3378226">ellipsisOk</span><span class="op" id="3378236">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3378240">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3378257">if</span>&nbsp;<span class="ident" id="3378260">typ</span>&nbsp;<span class="op" id="3378264">!=</span>&nbsp;<span class="ident" id="3378267">nil</span>&nbsp;<span class="op" id="3378271">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3378275">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378300">idents</span>&nbsp;<span class="op" id="3378307">:=</span>&nbsp;<span class="ident" id="3378310">p</span><span class="op" id="3378311">.</span><span class="ident" id="3378312">makeIdentList</span><span class="op" id="3378325">(</span><span class="ident" id="3378326">list</span><span class="op" id="3378330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378334">field</span>&nbsp;<span class="op" id="3378340">:=</span>&nbsp;<span class="op" id="3378343">&amp;</span><span class="ident" id="3378344">ast</span><span class="op" id="3378347">.</span><span class="ident" id="3378348">Field</span><span class="op" id="3378353">{</span><span class="ident" id="3378354">Names</span><span class="op" id="3378359">:</span>&nbsp;<span class="ident" id="3378361">idents</span><span class="op" id="3378367">,</span>&nbsp;<span class="ident" id="3378369">Type</span><span class="op" id="3378373">:</span>&nbsp;<span class="ident" id="3378375">typ</span><span class="op" id="3378378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378382">params</span>&nbsp;<span class="op" id="3378389">=</span>&nbsp;<span class="builtinfunc" id="3378391">append</span><span class="op" id="3378397">(</span><span class="ident" id="3378398">params</span><span class="op" id="3378404">,</span>&nbsp;<span class="ident" id="3378406">field</span><span class="op" id="3378411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3378415">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3378476">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378532">p</span><span class="op" id="3378533">.</span><span class="ident" id="3378534">declare</span><span class="op" id="3378541">(</span><span class="ident" id="3378542">field</span><span class="op" id="3378547">,</span>&nbsp;<span class="ident" id="3378549">nil</span><span class="op" id="3378552">,</span>&nbsp;<span class="ident" id="3378554">scope</span><span class="op" id="3378559">,</span>&nbsp;<span class="ident" id="3378561">ast</span><span class="op" id="3378564">.</span><span class="ident" id="3378565">Var</span><span class="op" id="3378568">,</span>&nbsp;<span class="ident" id="3378570">idents</span><span class="op" id="3378576">...</span><span class="op" id="3378579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378583">p</span><span class="op" id="3378584">.</span><span class="ident" id="3378585">resolve</span><span class="op" id="3378592">(</span><span class="ident" id="3378593">typ</span><span class="op" id="3378596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3378600">if</span>&nbsp;<span class="op" id="3378603">!</span><span class="ident" id="3378604">p</span><span class="op" id="3378605">.</span><span class="ident" id="3378606">atComma</span><span class="op" id="3378613">(</span><span class="string" id="3378614">&#34;parameter&nbsp;list&#34;</span><span class="op" id="3378630">)</span>&nbsp;<span class="op" id="3378632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3378637">return</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3378646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378650">p</span><span class="op" id="3378651">.</span><span class="ident" id="3378652">next</span><span class="op" id="3378656">(</span><span class="op" id="3378657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3378661">for</span>&nbsp;<span class="ident" id="3378665">p</span><span class="op" id="3378666">.</span><span class="ident" id="3378667">tok</span>&nbsp;<span class="op" id="3378671">!=</span>&nbsp;<span class="ident" id="3378674">token</span><span class="op" id="3378679">.</span><span class="ident" id="3378680">RPAREN</span>&nbsp;<span class="op" id="3378687">&amp;&amp;</span>&nbsp;<span class="ident" id="3378690">p</span><span class="op" id="3378691">.</span><span class="ident" id="3378692">tok</span>&nbsp;<span class="op" id="3378696">!=</span>&nbsp;<span class="ident" id="3378699">token</span><span class="op" id="3378704">.</span><span class="ident" id="3378705">EOF</span>&nbsp;<span class="op" id="3378709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378714">idents</span>&nbsp;<span class="op" id="3378721">:=</span>&nbsp;<span class="ident" id="3378724">p</span><span class="op" id="3378725">.</span><span class="ident" id="3378726">parseIdentList</span><span class="op" id="3378740">(</span><span class="op" id="3378741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378746">typ</span>&nbsp;<span class="op" id="3378750">:=</span>&nbsp;<span class="ident" id="3378753">p</span><span class="op" id="3378754">.</span><span class="ident" id="3378755">parseVarType</span><span class="op" id="3378767">(</span><span class="ident" id="3378768">ellipsisOk</span><span class="op" id="3378778">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378783">field</span>&nbsp;<span class="op" id="3378789">:=</span>&nbsp;<span class="op" id="3378792">&amp;</span><span class="ident" id="3378793">ast</span><span class="op" id="3378796">.</span><span class="ident" id="3378797">Field</span><span class="op" id="3378802">{</span><span class="ident" id="3378803">Names</span><span class="op" id="3378808">:</span>&nbsp;<span class="ident" id="3378810">idents</span><span class="op" id="3378816">,</span>&nbsp;<span class="ident" id="3378818">Type</span><span class="op" id="3378822">:</span>&nbsp;<span class="ident" id="3378824">typ</span><span class="op" id="3378827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378832">params</span>&nbsp;<span class="op" id="3378839">=</span>&nbsp;<span class="builtinfunc" id="3378841">append</span><span class="op" id="3378847">(</span><span class="ident" id="3378848">params</span><span class="op" id="3378854">,</span>&nbsp;<span class="ident" id="3378856">field</span><span class="op" id="3378861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3378866">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3378928">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3378985">p</span><span class="op" id="3378986">.</span><span class="ident" id="3378987">declare</span><span class="op" id="3378994">(</span><span class="ident" id="3378995">field</span><span class="op" id="3379000">,</span>&nbsp;<span class="ident" id="3379002">nil</span><span class="op" id="3379005">,</span>&nbsp;<span class="ident" id="3379007">scope</span><span class="op" id="3379012">,</span>&nbsp;<span class="ident" id="3379014">ast</span><span class="op" id="3379017">.</span><span class="ident" id="3379018">Var</span><span class="op" id="3379021">,</span>&nbsp;<span class="ident" id="3379023">idents</span><span class="op" id="3379029">...</span><span class="op" id="3379032">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3379037">p</span><span class="op" id="3379038">.</span><span class="ident" id="3379039">resolve</span><span class="op" id="3379046">(</span><span class="ident" id="3379047">typ</span><span class="op" id="3379050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379055">if</span>&nbsp;<span class="op" id="3379058">!</span><span class="ident" id="3379059">p</span><span class="op" id="3379060">.</span><span class="ident" id="3379061">atComma</span><span class="op" id="3379068">(</span><span class="string" id="3379069">&#34;parameter&nbsp;list&#34;</span><span class="op" id="3379085">)</span>&nbsp;<span class="op" id="3379087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379093">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3379102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3379107">p</span><span class="op" id="3379108">.</span><span class="ident" id="3379109">next</span><span class="op" id="3379113">(</span><span class="op" id="3379114">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3379118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379122">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3379130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3379134">//&nbsp;Type&nbsp;{&nbsp;&#34;,&#34;&nbsp;Type&nbsp;}&nbsp;(anonymous&nbsp;parameters)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3379179">params</span>&nbsp;<span class="op" id="3379186">=</span>&nbsp;<span class="builtinfunc" id="3379188">make</span><span class="op" id="3379192">(</span><span class="op" id="3379193">[</span><span class="op" id="3379194">]</span><span class="op" id="3379195">*</span><span class="ident" id="3379196">ast</span><span class="op" id="3379199">.</span><span class="ident" id="3379200">Field</span><span class="op" id="3379205">,</span>&nbsp;<span class="builtinfunc" id="3379207">len</span><span class="op" id="3379210">(</span><span class="ident" id="3379211">list</span><span class="op" id="3379215">)</span><span class="op" id="3379216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379219">for</span>&nbsp;<span class="ident" id="3379223">i</span><span class="op" id="3379224">,</span>&nbsp;<span class="ident" id="3379226">typ</span>&nbsp;<span class="op" id="3379230">:=</span>&nbsp;<span class="keyword" id="3379233">range</span>&nbsp;<span class="ident" id="3379239">list</span>&nbsp;<span class="op" id="3379244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3379248">p</span><span class="op" id="3379249">.</span><span class="ident" id="3379250">resolve</span><span class="op" id="3379257">(</span><span class="ident" id="3379258">typ</span><span class="op" id="3379261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3379265">params</span><span class="op" id="3379271">[</span><span class="ident" id="3379272">i</span><span class="op" id="3379273">]</span>&nbsp;<span class="op" id="3379275">=</span>&nbsp;<span class="op" id="3379277">&amp;</span><span class="ident" id="3379278">ast</span><span class="op" id="3379281">.</span><span class="ident" id="3379282">Field</span><span class="op" id="3379287">{</span><span class="ident" id="3379288">Type</span><span class="op" id="3379292">:</span>&nbsp;<span class="ident" id="3379294">typ</span><span class="op" id="3379297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3379300">}</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379303">return</span><br>
<span class="lineno"></span><span class="op" id="3379310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3379313">func</span>&nbsp;<span class="op" id="3379318">(</span><span class="ident" id="3379319">p</span>&nbsp;<span class="op" id="3379321">*</span><span class="ident" id="3379322">parser</span><span class="op" id="3379328">)</span>&nbsp;<span class="ident" id="3379330">parseParameters</span><span class="op" id="3379345">(</span><span class="ident" id="3379346">scope</span>&nbsp;<span class="op" id="3379352">*</span><span class="ident" id="3379353">ast</span><span class="op" id="3379356">.</span><span class="ident" id="3379357">Scope</span><span class="op" id="3379362">,</span>&nbsp;<span class="ident" id="3379364">ellipsisOk</span>&nbsp;<span class="builtintype" id="3379375">bool</span><span class="op" id="3379379">)</span>&nbsp;<span class="op" id="3379381">*</span><span class="ident" id="3379382">ast</span><span class="op" id="3379385">.</span><span class="ident" id="3379386">FieldList</span>&nbsp;<span class="op" id="3379396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379399">if</span>&nbsp;<span class="ident" id="3379402">p</span><span class="op" id="3379403">.</span><span class="ident" id="3379404">trace</span>&nbsp;<span class="op" id="3379410">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379414">defer</span>&nbsp;<span class="ident" id="3379420">un</span><span class="op" id="3379422">(</span><span class="ident" id="3379423">trace</span><span class="op" id="3379428">(</span><span class="ident" id="3379429">p</span><span class="op" id="3379430">,</span>&nbsp;<span class="string" id="3379432">&#34;Parameters&#34;</span><span class="op" id="3379444">)</span><span class="op" id="3379445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3379448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379452">var</span>&nbsp;<span class="ident" id="3379456">params</span>&nbsp;<span class="op" id="3379463">[</span><span class="op" id="3379464">]</span><span class="op" id="3379465">*</span><span class="ident" id="3379466">ast</span><span class="op" id="3379469">.</span><span class="ident" id="3379470">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3379477">lparen</span>&nbsp;<span class="op" id="3379484">:=</span>&nbsp;<span class="ident" id="3379487">p</span><span class="op" id="3379488">.</span><span class="ident" id="3379489">expect</span><span class="op" id="3379495">(</span><span class="ident" id="3379496">token</span><span class="op" id="3379501">.</span><span class="ident" id="3379502">LPAREN</span><span class="op" id="3379508">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379511">if</span>&nbsp;<span class="ident" id="3379514">p</span><span class="op" id="3379515">.</span><span class="ident" id="3379516">tok</span>&nbsp;<span class="op" id="3379520">!=</span>&nbsp;<span class="ident" id="3379523">token</span><span class="op" id="3379528">.</span><span class="ident" id="3379529">RPAREN</span>&nbsp;<span class="op" id="3379536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3379540">params</span>&nbsp;<span class="op" id="3379547">=</span>&nbsp;<span class="ident" id="3379549">p</span><span class="op" id="3379550">.</span><span class="ident" id="3379551">parseParameterList</span><span class="op" id="3379569">(</span><span class="ident" id="3379570">scope</span><span class="op" id="3379575">,</span>&nbsp;<span class="ident" id="3379577">ellipsisOk</span><span class="op" id="3379587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3379590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3379593">rparen</span>&nbsp;<span class="op" id="3379600">:=</span>&nbsp;<span class="ident" id="3379603">p</span><span class="op" id="3379604">.</span><span class="ident" id="3379605">expect</span><span class="op" id="3379611">(</span><span class="ident" id="3379612">token</span><span class="op" id="3379617">.</span><span class="ident" id="3379618">RPAREN</span><span class="op" id="3379624">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379628">return</span>&nbsp;<span class="op" id="3379635">&amp;</span><span class="ident" id="3379636">ast</span><span class="op" id="3379639">.</span><span class="ident" id="3379640">FieldList</span><span class="op" id="3379649">{</span><span class="ident" id="3379650">Opening</span><span class="op" id="3379657">:</span>&nbsp;<span class="ident" id="3379659">lparen</span><span class="op" id="3379665">,</span>&nbsp;<span class="ident" id="3379667">List</span><span class="op" id="3379671">:</span>&nbsp;<span class="ident" id="3379673">params</span><span class="op" id="3379679">,</span>&nbsp;<span class="ident" id="3379681">Closing</span><span class="op" id="3379688">:</span>&nbsp;<span class="ident" id="3379690">rparen</span><span class="op" id="3379696">}</span><br>
<span class="lineno"></span><span class="op" id="3379698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3379701">func</span>&nbsp;<span class="op" id="3379706">(</span><span class="ident" id="3379707">p</span>&nbsp;<span class="op" id="3379709">*</span><span class="ident" id="3379710">parser</span><span class="op" id="3379716">)</span>&nbsp;<span class="ident" id="3379718">parseResult</span><span class="op" id="3379729">(</span><span class="ident" id="3379730">scope</span>&nbsp;<span class="op" id="3379736">*</span><span class="ident" id="3379737">ast</span><span class="op" id="3379740">.</span><span class="ident" id="3379741">Scope</span><span class="op" id="3379746">)</span>&nbsp;<span class="op" id="3379748">*</span><span class="ident" id="3379749">ast</span><span class="op" id="3379752">.</span><span class="ident" id="3379753">FieldList</span>&nbsp;<span class="op" id="3379763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379766">if</span>&nbsp;<span class="ident" id="3379769">p</span><span class="op" id="3379770">.</span><span class="ident" id="3379771">trace</span>&nbsp;<span class="op" id="3379777">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379781">defer</span>&nbsp;<span class="ident" id="3379787">un</span><span class="op" id="3379789">(</span><span class="ident" id="3379790">trace</span><span class="op" id="3379795">(</span><span class="ident" id="3379796">p</span><span class="op" id="3379797">,</span>&nbsp;<span class="string" id="3379799">&#34;Result&#34;</span><span class="op" id="3379807">)</span><span class="op" id="3379808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3379811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379815">if</span>&nbsp;<span class="ident" id="3379818">p</span><span class="op" id="3379819">.</span><span class="ident" id="3379820">tok</span>&nbsp;<span class="op" id="3379824">==</span>&nbsp;<span class="ident" id="3379827">token</span><span class="op" id="3379832">.</span><span class="ident" id="3379833">LPAREN</span>&nbsp;<span class="op" id="3379840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379844">return</span>&nbsp;<span class="ident" id="3379851">p</span><span class="op" id="3379852">.</span><span class="ident" id="3379853">parseParameters</span><span class="op" id="3379868">(</span><span class="ident" id="3379869">scope</span><span class="op" id="3379874">,</span>&nbsp;<span class="builtintype" id="3379876">false</span><span class="op" id="3379881">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3379884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3379888">typ</span>&nbsp;<span class="op" id="3379892">:=</span>&nbsp;<span class="ident" id="3379895">p</span><span class="op" id="3379896">.</span><span class="ident" id="3379897">tryType</span><span class="op" id="3379904">(</span><span class="op" id="3379905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379908">if</span>&nbsp;<span class="ident" id="3379911">typ</span>&nbsp;<span class="op" id="3379915">!=</span>&nbsp;<span class="ident" id="3379918">nil</span>&nbsp;<span class="op" id="3379922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3379926">list</span>&nbsp;<span class="op" id="3379931">:=</span>&nbsp;<span class="builtinfunc" id="3379934">make</span><span class="op" id="3379938">(</span><span class="op" id="3379939">[</span><span class="op" id="3379940">]</span><span class="op" id="3379941">*</span><span class="ident" id="3379942">ast</span><span class="op" id="3379945">.</span><span class="ident" id="3379946">Field</span><span class="op" id="3379951">,</span>&nbsp;<span class="num" id="3379953">1</span><span class="op" id="3379954">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3379958">list</span><span class="op" id="3379962">[</span><span class="num" id="3379963">0</span><span class="op" id="3379964">]</span>&nbsp;<span class="op" id="3379966">=</span>&nbsp;<span class="op" id="3379968">&amp;</span><span class="ident" id="3379969">ast</span><span class="op" id="3379972">.</span><span class="ident" id="3379973">Field</span><span class="op" id="3379978">{</span><span class="ident" id="3379979">Type</span><span class="op" id="3379983">:</span>&nbsp;<span class="ident" id="3379985">typ</span><span class="op" id="3379988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3379992">return</span>&nbsp;<span class="op" id="3379999">&amp;</span><span class="ident" id="3380000">ast</span><span class="op" id="3380003">.</span><span class="ident" id="3380004">FieldList</span><span class="op" id="3380013">{</span><span class="ident" id="3380014">List</span><span class="op" id="3380018">:</span>&nbsp;<span class="ident" id="3380020">list</span><span class="op" id="3380024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3380027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380031">return</span>&nbsp;<span class="ident" id="3380038">nil</span><br>
<span class="lineno">890</span><span class="op" id="3380042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3380045">func</span>&nbsp;<span class="op" id="3380050">(</span><span class="ident" id="3380051">p</span>&nbsp;<span class="op" id="3380053">*</span><span class="ident" id="3380054">parser</span><span class="op" id="3380060">)</span>&nbsp;<span class="ident" id="3380062">parseSignature</span><span class="op" id="3380076">(</span><span class="ident" id="3380077">scope</span>&nbsp;<span class="op" id="3380083">*</span><span class="ident" id="3380084">ast</span><span class="op" id="3380087">.</span><span class="ident" id="3380088">Scope</span><span class="op" id="3380093">)</span>&nbsp;<span class="op" id="3380095">(</span><span class="ident" id="3380096">params</span><span class="op" id="3380102">,</span>&nbsp;<span class="ident" id="3380104">results</span>&nbsp;<span class="op" id="3380112">*</span><span class="ident" id="3380113">ast</span><span class="op" id="3380116">.</span><span class="ident" id="3380117">FieldList</span><span class="op" id="3380126">)</span>&nbsp;<span class="op" id="3380128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380131">if</span>&nbsp;<span class="ident" id="3380134">p</span><span class="op" id="3380135">.</span><span class="ident" id="3380136">trace</span>&nbsp;<span class="op" id="3380142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380146">defer</span>&nbsp;<span class="ident" id="3380152">un</span><span class="op" id="3380154">(</span><span class="ident" id="3380155">trace</span><span class="op" id="3380160">(</span><span class="ident" id="3380161">p</span><span class="op" id="3380162">,</span>&nbsp;<span class="string" id="3380164">&#34;Signature&#34;</span><span class="op" id="3380175">)</span><span class="op" id="3380176">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3380179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3380183">params</span>&nbsp;<span class="op" id="3380190">=</span>&nbsp;<span class="ident" id="3380192">p</span><span class="op" id="3380193">.</span><span class="ident" id="3380194">parseParameters</span><span class="op" id="3380209">(</span><span class="ident" id="3380210">scope</span><span class="op" id="3380215">,</span>&nbsp;<span class="builtintype" id="3380217">true</span><span class="op" id="3380221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3380224">results</span>&nbsp;<span class="op" id="3380232">=</span>&nbsp;<span class="ident" id="3380234">p</span><span class="op" id="3380235">.</span><span class="ident" id="3380236">parseResult</span><span class="op" id="3380247">(</span><span class="ident" id="3380248">scope</span><span class="op" id="3380253">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380257">return</span><br>
<span class="lineno"></span><span class="op" id="3380264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3380267">func</span>&nbsp;<span class="op" id="3380272">(</span><span class="ident" id="3380273">p</span>&nbsp;<span class="op" id="3380275">*</span><span class="ident" id="3380276">parser</span><span class="op" id="3380282">)</span>&nbsp;<span class="ident" id="3380284">parseFuncType</span><span class="op" id="3380297">(</span><span class="op" id="3380298">)</span>&nbsp;<span class="op" id="3380300">(</span><span class="op" id="3380301">*</span><span class="ident" id="3380302">ast</span><span class="op" id="3380305">.</span><span class="ident" id="3380306">FuncType</span><span class="op" id="3380314">,</span>&nbsp;<span class="op" id="3380316">*</span><span class="ident" id="3380317">ast</span><span class="op" id="3380320">.</span><span class="ident" id="3380321">Scope</span><span class="op" id="3380326">)</span>&nbsp;<span class="op" id="3380328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380331">if</span>&nbsp;<span class="ident" id="3380334">p</span><span class="op" id="3380335">.</span><span class="ident" id="3380336">trace</span>&nbsp;<span class="op" id="3380342">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380346">defer</span>&nbsp;<span class="ident" id="3380352">un</span><span class="op" id="3380354">(</span><span class="ident" id="3380355">trace</span><span class="op" id="3380360">(</span><span class="ident" id="3380361">p</span><span class="op" id="3380362">,</span>&nbsp;<span class="string" id="3380364">&#34;FuncType&#34;</span><span class="op" id="3380374">)</span><span class="op" id="3380375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3380378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3380382">pos</span>&nbsp;<span class="op" id="3380386">:=</span>&nbsp;<span class="ident" id="3380389">p</span><span class="op" id="3380390">.</span><span class="ident" id="3380391">expect</span><span class="op" id="3380397">(</span><span class="ident" id="3380398">token</span><span class="op" id="3380403">.</span><span class="ident" id="3380404">FUNC</span><span class="op" id="3380408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3380411">scope</span>&nbsp;<span class="op" id="3380417">:=</span>&nbsp;<span class="ident" id="3380420">ast</span><span class="op" id="3380423">.</span><span class="ident" id="3380424">NewScope</span><span class="op" id="3380432">(</span><span class="ident" id="3380433">p</span><span class="op" id="3380434">.</span><span class="ident" id="3380435">topScope</span><span class="op" id="3380443">)</span>&nbsp;<span class="comment" id="3380445">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3380464">params</span><span class="op" id="3380470">,</span>&nbsp;<span class="ident" id="3380472">results</span>&nbsp;<span class="op" id="3380480">:=</span>&nbsp;<span class="ident" id="3380483">p</span><span class="op" id="3380484">.</span><span class="ident" id="3380485">parseSignature</span><span class="op" id="3380499">(</span><span class="ident" id="3380500">scope</span><span class="op" id="3380505">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380509">return</span>&nbsp;<span class="op" id="3380516">&amp;</span><span class="ident" id="3380517">ast</span><span class="op" id="3380520">.</span><span class="ident" id="3380521">FuncType</span><span class="op" id="3380529">{</span><span class="ident" id="3380530">Func</span><span class="op" id="3380534">:</span>&nbsp;<span class="ident" id="3380536">pos</span><span class="op" id="3380539">,</span>&nbsp;<span class="ident" id="3380541">Params</span><span class="op" id="3380547">:</span>&nbsp;<span class="ident" id="3380549">params</span><span class="op" id="3380555">,</span>&nbsp;<span class="ident" id="3380557">Results</span><span class="op" id="3380564">:</span>&nbsp;<span class="ident" id="3380566">results</span><span class="op" id="3380573">}</span><span class="op" id="3380574">,</span>&nbsp;<span class="ident" id="3380576">scope</span><br>
<span class="lineno"></span><span class="op" id="3380582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="3380585">func</span>&nbsp;<span class="op" id="3380590">(</span><span class="ident" id="3380591">p</span>&nbsp;<span class="op" id="3380593">*</span><span class="ident" id="3380594">parser</span><span class="op" id="3380600">)</span>&nbsp;<span class="ident" id="3380602">parseMethodSpec</span><span class="op" id="3380617">(</span><span class="ident" id="3380618">scope</span>&nbsp;<span class="op" id="3380624">*</span><span class="ident" id="3380625">ast</span><span class="op" id="3380628">.</span><span class="ident" id="3380629">Scope</span><span class="op" id="3380634">)</span>&nbsp;<span class="op" id="3380636">*</span><span class="ident" id="3380637">ast</span><span class="op" id="3380640">.</span><span class="ident" id="3380641">Field</span>&nbsp;<span class="op" id="3380647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380650">if</span>&nbsp;<span class="ident" id="3380653">p</span><span class="op" id="3380654">.</span><span class="ident" id="3380655">trace</span>&nbsp;<span class="op" id="3380661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380665">defer</span>&nbsp;<span class="ident" id="3380671">un</span><span class="op" id="3380673">(</span><span class="ident" id="3380674">trace</span><span class="op" id="3380679">(</span><span class="ident" id="3380680">p</span><span class="op" id="3380681">,</span>&nbsp;<span class="string" id="3380683">&#34;MethodSpec&#34;</span><span class="op" id="3380695">)</span><span class="op" id="3380696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3380699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3380703">doc</span>&nbsp;<span class="op" id="3380707">:=</span>&nbsp;<span class="ident" id="3380710">p</span><span class="op" id="3380711">.</span><span class="ident" id="3380712">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380725">var</span>&nbsp;<span class="ident" id="3380729">idents</span>&nbsp;<span class="op" id="3380736">[</span><span class="op" id="3380737">]</span><span class="op" id="3380738">*</span><span class="ident" id="3380739">ast</span><span class="op" id="3380742">.</span><span class="ident" id="3380743">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380750">var</span>&nbsp;<span class="ident" id="3380754">typ</span>&nbsp;<span class="ident" id="3380758">ast</span><span class="op" id="3380761">.</span><span class="ident" id="3380762">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3380768">x</span>&nbsp;<span class="op" id="3380770">:=</span>&nbsp;<span class="ident" id="3380773">p</span><span class="op" id="3380774">.</span><span class="ident" id="3380775">parseTypeName</span><span class="op" id="3380788">(</span><span class="op" id="3380789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3380792">if</span>&nbsp;<span class="ident" id="3380795">ident</span><span class="op" id="3380800">,</span>&nbsp;<span class="ident" id="3380802">isIdent</span>&nbsp;<span class="op" id="3380810">:=</span>&nbsp;<span class="ident" id="3380813">x</span><span class="op" id="3380814">.</span><span class="op" id="3380815">(</span><span class="op" id="3380816">*</span><span class="ident" id="3380817">ast</span><span class="op" id="3380820">.</span><span class="ident" id="3380821">Ident</span><span class="op" id="3380826">)</span><span class="op" id="3380827">;</span>&nbsp;<span class="ident" id="3380829">isIdent</span>&nbsp;<span class="op" id="3380837">&amp;&amp;</span>&nbsp;<span class="ident" id="3380840">p</span><span class="op" id="3380841">.</span><span class="ident" id="3380842">tok</span>&nbsp;<span class="op" id="3380846">==</span>&nbsp;<span class="ident" id="3380849">token</span><span class="op" id="3380854">.</span><span class="ident" id="3380855">LPAREN</span>&nbsp;<span class="op" id="3380862">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3380866">//&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3380878">idents</span>&nbsp;<span class="op" id="3380885">=</span>&nbsp;<span class="op" id="3380887">[</span><span class="op" id="3380888">]</span><span class="op" id="3380889">*</span><span class="ident" id="3380890">ast</span><span class="op" id="3380893">.</span><span class="ident" id="3380894">Ident</span><span class="op" id="3380899">{</span><span class="ident" id="3380900">ident</span><span class="op" id="3380905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3380909">scope</span>&nbsp;<span class="op" id="3380915">:=</span>&nbsp;<span class="ident" id="3380918">ast</span><span class="op" id="3380921">.</span><span class="ident" id="3380922">NewScope</span><span class="op" id="3380930">(</span><span class="ident" id="3380931">nil</span><span class="op" id="3380934">)</span>&nbsp;<span class="comment" id="3380936">//&nbsp;method&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3380954">params</span><span class="op" id="3380960">,</span>&nbsp;<span class="ident" id="3380962">results</span>&nbsp;<span class="op" id="3380970">:=</span>&nbsp;<span class="ident" id="3380973">p</span><span class="op" id="3380974">.</span><span class="ident" id="3380975">parseSignature</span><span class="op" id="3380989">(</span><span class="ident" id="3380990">scope</span><span class="op" id="3380995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3380999">typ</span>&nbsp;<span class="op" id="3381003">=</span>&nbsp;<span class="op" id="3381005">&amp;</span><span class="ident" id="3381006">ast</span><span class="op" id="3381009">.</span><span class="ident" id="3381010">FuncType</span><span class="op" id="3381018">{</span><span class="ident" id="3381019">Func</span><span class="op" id="3381023">:</span>&nbsp;<span class="ident" id="3381025">token</span><span class="op" id="3381030">.</span><span class="ident" id="3381031">NoPos</span><span class="op" id="3381036">,</span>&nbsp;<span class="ident" id="3381038">Params</span><span class="op" id="3381044">:</span>&nbsp;<span class="ident" id="3381046">params</span><span class="op" id="3381052">,</span>&nbsp;<span class="ident" id="3381054">Results</span><span class="op" id="3381061">:</span>&nbsp;<span class="ident" id="3381063">results</span><span class="op" id="3381070">}</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3381073">}</span>&nbsp;<span class="keyword" id="3381075">else</span>&nbsp;<span class="op" id="3381080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3381084">//&nbsp;embedded&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381108">typ</span>&nbsp;<span class="op" id="3381112">=</span>&nbsp;<span class="ident" id="3381114">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381118">p</span><span class="op" id="3381119">.</span><span class="ident" id="3381120">resolve</span><span class="op" id="3381127">(</span><span class="ident" id="3381128">typ</span><span class="op" id="3381131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3381134">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381137">p</span><span class="op" id="3381138">.</span><span class="ident" id="3381139">expectSemi</span><span class="op" id="3381149">(</span><span class="op" id="3381150">)</span>&nbsp;<span class="comment" id="3381152">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381193">spec</span>&nbsp;<span class="op" id="3381198">:=</span>&nbsp;<span class="op" id="3381201">&amp;</span><span class="ident" id="3381202">ast</span><span class="op" id="3381205">.</span><span class="ident" id="3381206">Field</span><span class="op" id="3381211">{</span><span class="ident" id="3381212">Doc</span><span class="op" id="3381215">:</span>&nbsp;<span class="ident" id="3381217">doc</span><span class="op" id="3381220">,</span>&nbsp;<span class="ident" id="3381222">Names</span><span class="op" id="3381227">:</span>&nbsp;<span class="ident" id="3381229">idents</span><span class="op" id="3381235">,</span>&nbsp;<span class="ident" id="3381237">Type</span><span class="op" id="3381241">:</span>&nbsp;<span class="ident" id="3381243">typ</span><span class="op" id="3381246">,</span>&nbsp;<span class="ident" id="3381248">Comment</span><span class="op" id="3381255">:</span>&nbsp;<span class="ident" id="3381257">p</span><span class="op" id="3381258">.</span><span class="ident" id="3381259">lineComment</span><span class="op" id="3381270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381273">p</span><span class="op" id="3381274">.</span><span class="ident" id="3381275">declare</span><span class="op" id="3381282">(</span><span class="ident" id="3381283">spec</span><span class="op" id="3381287">,</span>&nbsp;<span class="ident" id="3381289">nil</span><span class="op" id="3381292">,</span>&nbsp;<span class="ident" id="3381294">scope</span><span class="op" id="3381299">,</span>&nbsp;<span class="ident" id="3381301">ast</span><span class="op" id="3381304">.</span><span class="ident" id="3381305">Fun</span><span class="op" id="3381308">,</span>&nbsp;<span class="ident" id="3381310">idents</span><span class="op" id="3381316">...</span><span class="op" id="3381319">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3381323">return</span>&nbsp;<span class="ident" id="3381330">spec</span><br>
<span class="lineno"></span><span class="op" id="3381335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3381338">func</span>&nbsp;<span class="op" id="3381343">(</span><span class="ident" id="3381344">p</span>&nbsp;<span class="op" id="3381346">*</span><span class="ident" id="3381347">parser</span><span class="op" id="3381353">)</span>&nbsp;<span class="ident" id="3381355">parseInterfaceType</span><span class="op" id="3381373">(</span><span class="op" id="3381374">)</span>&nbsp;<span class="op" id="3381376">*</span><span class="ident" id="3381377">ast</span><span class="op" id="3381380">.</span><span class="ident" id="3381381">InterfaceType</span>&nbsp;<span class="op" id="3381395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3381398">if</span>&nbsp;<span class="ident" id="3381401">p</span><span class="op" id="3381402">.</span><span class="ident" id="3381403">trace</span>&nbsp;<span class="op" id="3381409">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3381413">defer</span>&nbsp;<span class="ident" id="3381419">un</span><span class="op" id="3381421">(</span><span class="ident" id="3381422">trace</span><span class="op" id="3381427">(</span><span class="ident" id="3381428">p</span><span class="op" id="3381429">,</span>&nbsp;<span class="string" id="3381431">&#34;InterfaceType&#34;</span><span class="op" id="3381446">)</span><span class="op" id="3381447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3381450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381454">pos</span>&nbsp;<span class="op" id="3381458">:=</span>&nbsp;<span class="ident" id="3381461">p</span><span class="op" id="3381462">.</span><span class="ident" id="3381463">expect</span><span class="op" id="3381469">(</span><span class="ident" id="3381470">token</span><span class="op" id="3381475">.</span><span class="ident" id="3381476">INTERFACE</span><span class="op" id="3381485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381488">lbrace</span>&nbsp;<span class="op" id="3381495">:=</span>&nbsp;<span class="ident" id="3381498">p</span><span class="op" id="3381499">.</span><span class="ident" id="3381500">expect</span><span class="op" id="3381506">(</span><span class="ident" id="3381507">token</span><span class="op" id="3381512">.</span><span class="ident" id="3381513">LBRACE</span><span class="op" id="3381519">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381522">scope</span>&nbsp;<span class="op" id="3381528">:=</span>&nbsp;<span class="ident" id="3381531">ast</span><span class="op" id="3381534">.</span><span class="ident" id="3381535">NewScope</span><span class="op" id="3381543">(</span><span class="ident" id="3381544">nil</span><span class="op" id="3381547">)</span>&nbsp;<span class="comment" id="3381549">//&nbsp;interface&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3381569">var</span>&nbsp;<span class="ident" id="3381573">list</span>&nbsp;<span class="op" id="3381578">[</span><span class="op" id="3381579">]</span><span class="op" id="3381580">*</span><span class="ident" id="3381581">ast</span><span class="op" id="3381584">.</span><span class="ident" id="3381585">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3381592">for</span>&nbsp;<span class="ident" id="3381596">p</span><span class="op" id="3381597">.</span><span class="ident" id="3381598">tok</span>&nbsp;<span class="op" id="3381602">==</span>&nbsp;<span class="ident" id="3381605">token</span><span class="op" id="3381610">.</span><span class="ident" id="3381611">IDENT</span>&nbsp;<span class="op" id="3381617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381621">list</span>&nbsp;<span class="op" id="3381626">=</span>&nbsp;<span class="builtinfunc" id="3381628">append</span><span class="op" id="3381634">(</span><span class="ident" id="3381635">list</span><span class="op" id="3381639">,</span>&nbsp;<span class="ident" id="3381641">p</span><span class="op" id="3381642">.</span><span class="ident" id="3381643">parseMethodSpec</span><span class="op" id="3381658">(</span><span class="ident" id="3381659">scope</span><span class="op" id="3381664">)</span><span class="op" id="3381665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3381668">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381671">rbrace</span>&nbsp;<span class="op" id="3381678">:=</span>&nbsp;<span class="ident" id="3381681">p</span><span class="op" id="3381682">.</span><span class="ident" id="3381683">expect</span><span class="op" id="3381689">(</span><span class="ident" id="3381690">token</span><span class="op" id="3381695">.</span><span class="ident" id="3381696">RBRACE</span><span class="op" id="3381702">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3381706">return</span>&nbsp;<span class="op" id="3381713">&amp;</span><span class="ident" id="3381714">ast</span><span class="op" id="3381717">.</span><span class="ident" id="3381718">InterfaceType</span><span class="op" id="3381731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381735">Interface</span><span class="op" id="3381744">:</span>&nbsp;<span class="ident" id="3381746">pos</span><span class="op" id="3381749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381753">Methods</span><span class="op" id="3381760">:</span>&nbsp;<span class="op" id="3381762">&amp;</span><span class="ident" id="3381763">ast</span><span class="op" id="3381766">.</span><span class="ident" id="3381767">FieldList</span><span class="op" id="3381776">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381781">Opening</span><span class="op" id="3381788">:</span>&nbsp;<span class="ident" id="3381790">lbrace</span><span class="op" id="3381796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381801">List</span><span class="op" id="3381805">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3381810">list</span><span class="op" id="3381814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381819">Closing</span><span class="op" id="3381826">:</span>&nbsp;<span class="ident" id="3381828">rbrace</span><span class="op" id="3381834">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3381838">}</span><span class="op" id="3381839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3381842">}</span><br>
<span class="lineno">965</span><span class="op" id="3381844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3381847">func</span>&nbsp;<span class="op" id="3381852">(</span><span class="ident" id="3381853">p</span>&nbsp;<span class="op" id="3381855">*</span><span class="ident" id="3381856">parser</span><span class="op" id="3381862">)</span>&nbsp;<span class="ident" id="3381864">parseMapType</span><span class="op" id="3381876">(</span><span class="op" id="3381877">)</span>&nbsp;<span class="op" id="3381879">*</span><span class="ident" id="3381880">ast</span><span class="op" id="3381883">.</span><span class="ident" id="3381884">MapType</span>&nbsp;<span class="op" id="3381892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3381895">if</span>&nbsp;<span class="ident" id="3381898">p</span><span class="op" id="3381899">.</span><span class="ident" id="3381900">trace</span>&nbsp;<span class="op" id="3381906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3381910">defer</span>&nbsp;<span class="ident" id="3381916">un</span><span class="op" id="3381918">(</span><span class="ident" id="3381919">trace</span><span class="op" id="3381924">(</span><span class="ident" id="3381925">p</span><span class="op" id="3381926">,</span>&nbsp;<span class="string" id="3381928">&#34;MapType&#34;</span><span class="op" id="3381937">)</span><span class="op" id="3381938">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3381941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381945">pos</span>&nbsp;<span class="op" id="3381949">:=</span>&nbsp;<span class="ident" id="3381952">p</span><span class="op" id="3381953">.</span><span class="ident" id="3381954">expect</span><span class="op" id="3381960">(</span><span class="ident" id="3381961">token</span><span class="op" id="3381966">.</span><span class="ident" id="3381967">MAP</span><span class="op" id="3381970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381973">p</span><span class="op" id="3381974">.</span><span class="ident" id="3381975">expect</span><span class="op" id="3381981">(</span><span class="ident" id="3381982">token</span><span class="op" id="3381987">.</span><span class="ident" id="3381988">LBRACK</span><span class="op" id="3381994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3381997">key</span>&nbsp;<span class="op" id="3382001">:=</span>&nbsp;<span class="ident" id="3382004">p</span><span class="op" id="3382005">.</span><span class="ident" id="3382006">parseType</span><span class="op" id="3382015">(</span><span class="op" id="3382016">)</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382019">p</span><span class="op" id="3382020">.</span><span class="ident" id="3382021">expect</span><span class="op" id="3382027">(</span><span class="ident" id="3382028">token</span><span class="op" id="3382033">.</span><span class="ident" id="3382034">RBRACK</span><span class="op" id="3382040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382043">value</span>&nbsp;<span class="op" id="3382049">:=</span>&nbsp;<span class="ident" id="3382052">p</span><span class="op" id="3382053">.</span><span class="ident" id="3382054">parseType</span><span class="op" id="3382063">(</span><span class="op" id="3382064">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382068">return</span>&nbsp;<span class="op" id="3382075">&amp;</span><span class="ident" id="3382076">ast</span><span class="op" id="3382079">.</span><span class="ident" id="3382080">MapType</span><span class="op" id="3382087">{</span><span class="ident" id="3382088">Map</span><span class="op" id="3382091">:</span>&nbsp;<span class="ident" id="3382093">pos</span><span class="op" id="3382096">,</span>&nbsp;<span class="ident" id="3382098">Key</span><span class="op" id="3382101">:</span>&nbsp;<span class="ident" id="3382103">key</span><span class="op" id="3382106">,</span>&nbsp;<span class="ident" id="3382108">Value</span><span class="op" id="3382113">:</span>&nbsp;<span class="ident" id="3382115">value</span><span class="op" id="3382120">}</span><br>
<span class="lineno"></span><span class="op" id="3382122">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span><span class="keyword" id="3382125">func</span>&nbsp;<span class="op" id="3382130">(</span><span class="ident" id="3382131">p</span>&nbsp;<span class="op" id="3382133">*</span><span class="ident" id="3382134">parser</span><span class="op" id="3382140">)</span>&nbsp;<span class="ident" id="3382142">parseChanType</span><span class="op" id="3382155">(</span><span class="op" id="3382156">)</span>&nbsp;<span class="op" id="3382158">*</span><span class="ident" id="3382159">ast</span><span class="op" id="3382162">.</span><span class="ident" id="3382163">ChanType</span>&nbsp;<span class="op" id="3382172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382175">if</span>&nbsp;<span class="ident" id="3382178">p</span><span class="op" id="3382179">.</span><span class="ident" id="3382180">trace</span>&nbsp;<span class="op" id="3382186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382190">defer</span>&nbsp;<span class="ident" id="3382196">un</span><span class="op" id="3382198">(</span><span class="ident" id="3382199">trace</span><span class="op" id="3382204">(</span><span class="ident" id="3382205">p</span><span class="op" id="3382206">,</span>&nbsp;<span class="string" id="3382208">&#34;ChanType&#34;</span><span class="op" id="3382218">)</span><span class="op" id="3382219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3382222">}</span><br>
<span class="lineno">985</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382226">pos</span>&nbsp;<span class="op" id="3382230">:=</span>&nbsp;<span class="ident" id="3382233">p</span><span class="op" id="3382234">.</span><span class="ident" id="3382235">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382240">dir</span>&nbsp;<span class="op" id="3382244">:=</span>&nbsp;<span class="ident" id="3382247">ast</span><span class="op" id="3382250">.</span><span class="ident" id="3382251">SEND</span>&nbsp;<span class="op" id="3382256">|</span>&nbsp;<span class="ident" id="3382258">ast</span><span class="op" id="3382261">.</span><span class="ident" id="3382262">RECV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382268">var</span>&nbsp;<span class="ident" id="3382272">arrow</span>&nbsp;<span class="ident" id="3382278">token</span><span class="op" id="3382283">.</span><span class="ident" id="3382284">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382289">if</span>&nbsp;<span class="ident" id="3382292">p</span><span class="op" id="3382293">.</span><span class="ident" id="3382294">tok</span>&nbsp;<span class="op" id="3382298">==</span>&nbsp;<span class="ident" id="3382301">token</span><span class="op" id="3382306">.</span><span class="ident" id="3382307">CHAN</span>&nbsp;<span class="op" id="3382312">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382316">p</span><span class="op" id="3382317">.</span><span class="ident" id="3382318">next</span><span class="op" id="3382322">(</span><span class="op" id="3382323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382327">if</span>&nbsp;<span class="ident" id="3382330">p</span><span class="op" id="3382331">.</span><span class="ident" id="3382332">tok</span>&nbsp;<span class="op" id="3382336">==</span>&nbsp;<span class="ident" id="3382339">token</span><span class="op" id="3382344">.</span><span class="ident" id="3382345">ARROW</span>&nbsp;<span class="op" id="3382351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382356">arrow</span>&nbsp;<span class="op" id="3382362">=</span>&nbsp;<span class="ident" id="3382364">p</span><span class="op" id="3382365">.</span><span class="ident" id="3382366">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382373">p</span><span class="op" id="3382374">.</span><span class="ident" id="3382375">next</span><span class="op" id="3382379">(</span><span class="op" id="3382380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382385">dir</span>&nbsp;<span class="op" id="3382389">=</span>&nbsp;<span class="ident" id="3382391">ast</span><span class="op" id="3382394">.</span><span class="ident" id="3382395">SEND</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3382402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3382405">}</span>&nbsp;<span class="keyword" id="3382407">else</span>&nbsp;<span class="op" id="3382412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382416">arrow</span>&nbsp;<span class="op" id="3382422">=</span>&nbsp;<span class="ident" id="3382424">p</span><span class="op" id="3382425">.</span><span class="ident" id="3382426">expect</span><span class="op" id="3382432">(</span><span class="ident" id="3382433">token</span><span class="op" id="3382438">.</span><span class="ident" id="3382439">ARROW</span><span class="op" id="3382444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382448">p</span><span class="op" id="3382449">.</span><span class="ident" id="3382450">expect</span><span class="op" id="3382456">(</span><span class="ident" id="3382457">token</span><span class="op" id="3382462">.</span><span class="ident" id="3382463">CHAN</span><span class="op" id="3382467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382471">dir</span>&nbsp;<span class="op" id="3382475">=</span>&nbsp;<span class="ident" id="3382477">ast</span><span class="op" id="3382480">.</span><span class="ident" id="3382481">RECV</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3382487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382490">value</span>&nbsp;<span class="op" id="3382496">:=</span>&nbsp;<span class="ident" id="3382499">p</span><span class="op" id="3382500">.</span><span class="ident" id="3382501">parseType</span><span class="op" id="3382510">(</span><span class="op" id="3382511">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382515">return</span>&nbsp;<span class="op" id="3382522">&amp;</span><span class="ident" id="3382523">ast</span><span class="op" id="3382526">.</span><span class="ident" id="3382527">ChanType</span><span class="op" id="3382535">{</span><span class="ident" id="3382536">Begin</span><span class="op" id="3382541">:</span>&nbsp;<span class="ident" id="3382543">pos</span><span class="op" id="3382546">,</span>&nbsp;<span class="ident" id="3382548">Arrow</span><span class="op" id="3382553">:</span>&nbsp;<span class="ident" id="3382555">arrow</span><span class="op" id="3382560">,</span>&nbsp;<span class="ident" id="3382562">Dir</span><span class="op" id="3382565">:</span>&nbsp;<span class="ident" id="3382567">dir</span><span class="op" id="3382570">,</span>&nbsp;<span class="ident" id="3382572">Value</span><span class="op" id="3382577">:</span>&nbsp;<span class="ident" id="3382579">value</span><span class="op" id="3382584">}</span><br>
<span class="lineno"></span><span class="op" id="3382586">}</span><br>
<span class="lineno">1005</span><br>
<span class="lineno"></span><span class="comment" id="3382589">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="3382644">func</span>&nbsp;<span class="op" id="3382649">(</span><span class="ident" id="3382650">p</span>&nbsp;<span class="op" id="3382652">*</span><span class="ident" id="3382653">parser</span><span class="op" id="3382659">)</span>&nbsp;<span class="ident" id="3382661">tryIdentOrType</span><span class="op" id="3382675">(</span><span class="op" id="3382676">)</span>&nbsp;<span class="ident" id="3382678">ast</span><span class="op" id="3382681">.</span><span class="ident" id="3382682">Expr</span>&nbsp;<span class="op" id="3382687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382690">switch</span>&nbsp;<span class="ident" id="3382697">p</span><span class="op" id="3382698">.</span><span class="ident" id="3382699">tok</span>&nbsp;<span class="op" id="3382703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382706">case</span>&nbsp;<span class="ident" id="3382711">token</span><span class="op" id="3382716">.</span><span class="ident" id="3382717">IDENT</span><span class="op" id="3382722">:</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382726">return</span>&nbsp;<span class="ident" id="3382733">p</span><span class="op" id="3382734">.</span><span class="ident" id="3382735">parseTypeName</span><span class="op" id="3382748">(</span><span class="op" id="3382749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382752">case</span>&nbsp;<span class="ident" id="3382757">token</span><span class="op" id="3382762">.</span><span class="ident" id="3382763">LBRACK</span><span class="op" id="3382769">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382773">return</span>&nbsp;<span class="ident" id="3382780">p</span><span class="op" id="3382781">.</span><span class="ident" id="3382782">parseArrayType</span><span class="op" id="3382796">(</span><span class="op" id="3382797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382800">case</span>&nbsp;<span class="ident" id="3382805">token</span><span class="op" id="3382810">.</span><span class="ident" id="3382811">STRUCT</span><span class="op" id="3382817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382821">return</span>&nbsp;<span class="ident" id="3382828">p</span><span class="op" id="3382829">.</span><span class="ident" id="3382830">parseStructType</span><span class="op" id="3382845">(</span><span class="op" id="3382846">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382849">case</span>&nbsp;<span class="ident" id="3382854">token</span><span class="op" id="3382859">.</span><span class="ident" id="3382860">MUL</span><span class="op" id="3382863">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382867">return</span>&nbsp;<span class="ident" id="3382874">p</span><span class="op" id="3382875">.</span><span class="ident" id="3382876">parsePointerType</span><span class="op" id="3382892">(</span><span class="op" id="3382893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382896">case</span>&nbsp;<span class="ident" id="3382901">token</span><span class="op" id="3382906">.</span><span class="ident" id="3382907">FUNC</span><span class="op" id="3382911">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3382915">typ</span><span class="op" id="3382918">,</span>&nbsp;<span class="ident" id="3382920">_</span>&nbsp;<span class="op" id="3382922">:=</span>&nbsp;<span class="ident" id="3382925">p</span><span class="op" id="3382926">.</span><span class="ident" id="3382927">parseFuncType</span><span class="op" id="3382940">(</span><span class="op" id="3382941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382945">return</span>&nbsp;<span class="ident" id="3382952">typ</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382957">case</span>&nbsp;<span class="ident" id="3382962">token</span><span class="op" id="3382967">.</span><span class="ident" id="3382968">INTERFACE</span><span class="op" id="3382977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3382981">return</span>&nbsp;<span class="ident" id="3382988">p</span><span class="op" id="3382989">.</span><span class="ident" id="3382990">parseInterfaceType</span><span class="op" id="3383008">(</span><span class="op" id="3383009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383012">case</span>&nbsp;<span class="ident" id="3383017">token</span><span class="op" id="3383022">.</span><span class="ident" id="3383023">MAP</span><span class="op" id="3383026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383030">return</span>&nbsp;<span class="ident" id="3383037">p</span><span class="op" id="3383038">.</span><span class="ident" id="3383039">parseMapType</span><span class="op" id="3383051">(</span><span class="op" id="3383052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383055">case</span>&nbsp;<span class="ident" id="3383060">token</span><span class="op" id="3383065">.</span><span class="ident" id="3383066">CHAN</span><span class="op" id="3383070">,</span>&nbsp;<span class="ident" id="3383072">token</span><span class="op" id="3383077">.</span><span class="ident" id="3383078">ARROW</span><span class="op" id="3383083">:</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383087">return</span>&nbsp;<span class="ident" id="3383094">p</span><span class="op" id="3383095">.</span><span class="ident" id="3383096">parseChanType</span><span class="op" id="3383109">(</span><span class="op" id="3383110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383113">case</span>&nbsp;<span class="ident" id="3383118">token</span><span class="op" id="3383123">.</span><span class="ident" id="3383124">LPAREN</span><span class="op" id="3383130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383134">lparen</span>&nbsp;<span class="op" id="3383141">:=</span>&nbsp;<span class="ident" id="3383144">p</span><span class="op" id="3383145">.</span><span class="ident" id="3383146">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383152">p</span><span class="op" id="3383153">.</span><span class="ident" id="3383154">next</span><span class="op" id="3383158">(</span><span class="op" id="3383159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383163">typ</span>&nbsp;<span class="op" id="3383167">:=</span>&nbsp;<span class="ident" id="3383170">p</span><span class="op" id="3383171">.</span><span class="ident" id="3383172">parseType</span><span class="op" id="3383181">(</span><span class="op" id="3383182">)</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383186">rparen</span>&nbsp;<span class="op" id="3383193">:=</span>&nbsp;<span class="ident" id="3383196">p</span><span class="op" id="3383197">.</span><span class="ident" id="3383198">expect</span><span class="op" id="3383204">(</span><span class="ident" id="3383205">token</span><span class="op" id="3383210">.</span><span class="ident" id="3383211">RPAREN</span><span class="op" id="3383217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383221">return</span>&nbsp;<span class="op" id="3383228">&amp;</span><span class="ident" id="3383229">ast</span><span class="op" id="3383232">.</span><span class="ident" id="3383233">ParenExpr</span><span class="op" id="3383242">{</span><span class="ident" id="3383243">Lparen</span><span class="op" id="3383249">:</span>&nbsp;<span class="ident" id="3383251">lparen</span><span class="op" id="3383257">,</span>&nbsp;<span class="ident" id="3383259">X</span><span class="op" id="3383260">:</span>&nbsp;<span class="ident" id="3383262">typ</span><span class="op" id="3383265">,</span>&nbsp;<span class="ident" id="3383267">Rparen</span><span class="op" id="3383273">:</span>&nbsp;<span class="ident" id="3383275">rparen</span><span class="op" id="3383281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3383288">//&nbsp;no&nbsp;type&nbsp;found</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383306">return</span>&nbsp;<span class="ident" id="3383313">nil</span><br>
<span class="lineno"></span><span class="op" id="3383317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3383320">func</span>&nbsp;<span class="op" id="3383325">(</span><span class="ident" id="3383326">p</span>&nbsp;<span class="op" id="3383328">*</span><span class="ident" id="3383329">parser</span><span class="op" id="3383335">)</span>&nbsp;<span class="ident" id="3383337">tryType</span><span class="op" id="3383344">(</span><span class="op" id="3383345">)</span>&nbsp;<span class="ident" id="3383347">ast</span><span class="op" id="3383350">.</span><span class="ident" id="3383351">Expr</span>&nbsp;<span class="op" id="3383356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383359">typ</span>&nbsp;<span class="op" id="3383363">:=</span>&nbsp;<span class="ident" id="3383366">p</span><span class="op" id="3383367">.</span><span class="ident" id="3383368">tryIdentOrType</span><span class="op" id="3383382">(</span><span class="op" id="3383383">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383386">if</span>&nbsp;<span class="ident" id="3383389">typ</span>&nbsp;<span class="op" id="3383393">!=</span>&nbsp;<span class="ident" id="3383396">nil</span>&nbsp;<span class="op" id="3383400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383404">p</span><span class="op" id="3383405">.</span><span class="ident" id="3383406">resolve</span><span class="op" id="3383413">(</span><span class="ident" id="3383414">typ</span><span class="op" id="3383417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383423">return</span>&nbsp;<span class="ident" id="3383430">typ</span><br>
<span class="lineno"></span><span class="op" id="3383434">}</span><br>
<span class="lineno">1045</span><br>
<span class="lineno"></span><span class="comment" id="3383437">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3383517">//&nbsp;Blocks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3383528">func</span>&nbsp;<span class="op" id="3383533">(</span><span class="ident" id="3383534">p</span>&nbsp;<span class="op" id="3383536">*</span><span class="ident" id="3383537">parser</span><span class="op" id="3383543">)</span>&nbsp;<span class="ident" id="3383545">parseStmtList</span><span class="op" id="3383558">(</span><span class="op" id="3383559">)</span>&nbsp;<span class="op" id="3383561">(</span><span class="ident" id="3383562">list</span>&nbsp;<span class="op" id="3383567">[</span><span class="op" id="3383568">]</span><span class="ident" id="3383569">ast</span><span class="op" id="3383572">.</span><span class="ident" id="3383573">Stmt</span><span class="op" id="3383577">)</span>&nbsp;<span class="op" id="3383579">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383582">if</span>&nbsp;<span class="ident" id="3383585">p</span><span class="op" id="3383586">.</span><span class="ident" id="3383587">trace</span>&nbsp;<span class="op" id="3383593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383597">defer</span>&nbsp;<span class="ident" id="3383603">un</span><span class="op" id="3383605">(</span><span class="ident" id="3383606">trace</span><span class="op" id="3383611">(</span><span class="ident" id="3383612">p</span><span class="op" id="3383613">,</span>&nbsp;<span class="string" id="3383615">&#34;StatementList&#34;</span><span class="op" id="3383630">)</span><span class="op" id="3383631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383638">for</span>&nbsp;<span class="ident" id="3383642">p</span><span class="op" id="3383643">.</span><span class="ident" id="3383644">tok</span>&nbsp;<span class="op" id="3383648">!=</span>&nbsp;<span class="ident" id="3383651">token</span><span class="op" id="3383656">.</span><span class="ident" id="3383657">CASE</span>&nbsp;<span class="op" id="3383662">&amp;&amp;</span>&nbsp;<span class="ident" id="3383665">p</span><span class="op" id="3383666">.</span><span class="ident" id="3383667">tok</span>&nbsp;<span class="op" id="3383671">!=</span>&nbsp;<span class="ident" id="3383674">token</span><span class="op" id="3383679">.</span><span class="ident" id="3383680">DEFAULT</span>&nbsp;<span class="op" id="3383688">&amp;&amp;</span>&nbsp;<span class="ident" id="3383691">p</span><span class="op" id="3383692">.</span><span class="ident" id="3383693">tok</span>&nbsp;<span class="op" id="3383697">!=</span>&nbsp;<span class="ident" id="3383700">token</span><span class="op" id="3383705">.</span><span class="ident" id="3383706">RBRACE</span>&nbsp;<span class="op" id="3383713">&amp;&amp;</span>&nbsp;<span class="ident" id="3383716">p</span><span class="op" id="3383717">.</span><span class="ident" id="3383718">tok</span>&nbsp;<span class="op" id="3383722">!=</span>&nbsp;<span class="ident" id="3383725">token</span><span class="op" id="3383730">.</span><span class="ident" id="3383731">EOF</span>&nbsp;<span class="op" id="3383735">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383739">list</span>&nbsp;<span class="op" id="3383744">=</span>&nbsp;<span class="builtinfunc" id="3383746">append</span><span class="op" id="3383752">(</span><span class="ident" id="3383753">list</span><span class="op" id="3383757">,</span>&nbsp;<span class="ident" id="3383759">p</span><span class="op" id="3383760">.</span><span class="ident" id="3383761">parseStmt</span><span class="op" id="3383770">(</span><span class="op" id="3383771">)</span><span class="op" id="3383772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383779">return</span><br>
<span class="lineno"></span><span class="op" id="3383786">}</span><br>
<span class="lineno">1060</span><br>
<span class="lineno"></span><span class="keyword" id="3383789">func</span>&nbsp;<span class="op" id="3383794">(</span><span class="ident" id="3383795">p</span>&nbsp;<span class="op" id="3383797">*</span><span class="ident" id="3383798">parser</span><span class="op" id="3383804">)</span>&nbsp;<span class="ident" id="3383806">parseBody</span><span class="op" id="3383815">(</span><span class="ident" id="3383816">scope</span>&nbsp;<span class="op" id="3383822">*</span><span class="ident" id="3383823">ast</span><span class="op" id="3383826">.</span><span class="ident" id="3383827">Scope</span><span class="op" id="3383832">)</span>&nbsp;<span class="op" id="3383834">*</span><span class="ident" id="3383835">ast</span><span class="op" id="3383838">.</span><span class="ident" id="3383839">BlockStmt</span>&nbsp;<span class="op" id="3383849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383852">if</span>&nbsp;<span class="ident" id="3383855">p</span><span class="op" id="3383856">.</span><span class="ident" id="3383857">trace</span>&nbsp;<span class="op" id="3383863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3383867">defer</span>&nbsp;<span class="ident" id="3383873">un</span><span class="op" id="3383875">(</span><span class="ident" id="3383876">trace</span><span class="op" id="3383881">(</span><span class="ident" id="3383882">p</span><span class="op" id="3383883">,</span>&nbsp;<span class="string" id="3383885">&#34;Body&#34;</span><span class="op" id="3383891">)</span><span class="op" id="3383892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3383895">}</span><br>
<span class="lineno">1065</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383899">lbrace</span>&nbsp;<span class="op" id="3383906">:=</span>&nbsp;<span class="ident" id="3383909">p</span><span class="op" id="3383910">.</span><span class="ident" id="3383911">expect</span><span class="op" id="3383917">(</span><span class="ident" id="3383918">token</span><span class="op" id="3383923">.</span><span class="ident" id="3383924">LBRACE</span><span class="op" id="3383930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383933">p</span><span class="op" id="3383934">.</span><span class="ident" id="3383935">topScope</span>&nbsp;<span class="op" id="3383944">=</span>&nbsp;<span class="ident" id="3383946">scope</span>&nbsp;<span class="comment" id="3383952">//&nbsp;open&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383976">p</span><span class="op" id="3383977">.</span><span class="ident" id="3383978">openLabelScope</span><span class="op" id="3383992">(</span><span class="op" id="3383993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3383996">list</span>&nbsp;<span class="op" id="3384001">:=</span>&nbsp;<span class="ident" id="3384004">p</span><span class="op" id="3384005">.</span><span class="ident" id="3384006">parseStmtList</span><span class="op" id="3384019">(</span><span class="op" id="3384020">)</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384023">p</span><span class="op" id="3384024">.</span><span class="ident" id="3384025">closeLabelScope</span><span class="op" id="3384040">(</span><span class="op" id="3384041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384044">p</span><span class="op" id="3384045">.</span><span class="ident" id="3384046">closeScope</span><span class="op" id="3384056">(</span><span class="op" id="3384057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384060">rbrace</span>&nbsp;<span class="op" id="3384067">:=</span>&nbsp;<span class="ident" id="3384070">p</span><span class="op" id="3384071">.</span><span class="ident" id="3384072">expect</span><span class="op" id="3384078">(</span><span class="ident" id="3384079">token</span><span class="op" id="3384084">.</span><span class="ident" id="3384085">RBRACE</span><span class="op" id="3384091">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384095">return</span>&nbsp;<span class="op" id="3384102">&amp;</span><span class="ident" id="3384103">ast</span><span class="op" id="3384106">.</span><span class="ident" id="3384107">BlockStmt</span><span class="op" id="3384116">{</span><span class="ident" id="3384117">Lbrace</span><span class="op" id="3384123">:</span>&nbsp;<span class="ident" id="3384125">lbrace</span><span class="op" id="3384131">,</span>&nbsp;<span class="ident" id="3384133">List</span><span class="op" id="3384137">:</span>&nbsp;<span class="ident" id="3384139">list</span><span class="op" id="3384143">,</span>&nbsp;<span class="ident" id="3384145">Rbrace</span><span class="op" id="3384151">:</span>&nbsp;<span class="ident" id="3384153">rbrace</span><span class="op" id="3384159">}</span><br>
<span class="lineno">1075</span><span class="op" id="3384161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3384164">func</span>&nbsp;<span class="op" id="3384169">(</span><span class="ident" id="3384170">p</span>&nbsp;<span class="op" id="3384172">*</span><span class="ident" id="3384173">parser</span><span class="op" id="3384179">)</span>&nbsp;<span class="ident" id="3384181">parseBlockStmt</span><span class="op" id="3384195">(</span><span class="op" id="3384196">)</span>&nbsp;<span class="op" id="3384198">*</span><span class="ident" id="3384199">ast</span><span class="op" id="3384202">.</span><span class="ident" id="3384203">BlockStmt</span>&nbsp;<span class="op" id="3384213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384216">if</span>&nbsp;<span class="ident" id="3384219">p</span><span class="op" id="3384220">.</span><span class="ident" id="3384221">trace</span>&nbsp;<span class="op" id="3384227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384231">defer</span>&nbsp;<span class="ident" id="3384237">un</span><span class="op" id="3384239">(</span><span class="ident" id="3384240">trace</span><span class="op" id="3384245">(</span><span class="ident" id="3384246">p</span><span class="op" id="3384247">,</span>&nbsp;<span class="string" id="3384249">&#34;BlockStmt&#34;</span><span class="op" id="3384260">)</span><span class="op" id="3384261">)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3384264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384268">lbrace</span>&nbsp;<span class="op" id="3384275">:=</span>&nbsp;<span class="ident" id="3384278">p</span><span class="op" id="3384279">.</span><span class="ident" id="3384280">expect</span><span class="op" id="3384286">(</span><span class="ident" id="3384287">token</span><span class="op" id="3384292">.</span><span class="ident" id="3384293">LBRACE</span><span class="op" id="3384299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384302">p</span><span class="op" id="3384303">.</span><span class="ident" id="3384304">openScope</span><span class="op" id="3384313">(</span><span class="op" id="3384314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384317">list</span>&nbsp;<span class="op" id="3384322">:=</span>&nbsp;<span class="ident" id="3384325">p</span><span class="op" id="3384326">.</span><span class="ident" id="3384327">parseStmtList</span><span class="op" id="3384340">(</span><span class="op" id="3384341">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384344">p</span><span class="op" id="3384345">.</span><span class="ident" id="3384346">closeScope</span><span class="op" id="3384356">(</span><span class="op" id="3384357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384360">rbrace</span>&nbsp;<span class="op" id="3384367">:=</span>&nbsp;<span class="ident" id="3384370">p</span><span class="op" id="3384371">.</span><span class="ident" id="3384372">expect</span><span class="op" id="3384378">(</span><span class="ident" id="3384379">token</span><span class="op" id="3384384">.</span><span class="ident" id="3384385">RBRACE</span><span class="op" id="3384391">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384395">return</span>&nbsp;<span class="op" id="3384402">&amp;</span><span class="ident" id="3384403">ast</span><span class="op" id="3384406">.</span><span class="ident" id="3384407">BlockStmt</span><span class="op" id="3384416">{</span><span class="ident" id="3384417">Lbrace</span><span class="op" id="3384423">:</span>&nbsp;<span class="ident" id="3384425">lbrace</span><span class="op" id="3384431">,</span>&nbsp;<span class="ident" id="3384433">List</span><span class="op" id="3384437">:</span>&nbsp;<span class="ident" id="3384439">list</span><span class="op" id="3384443">,</span>&nbsp;<span class="ident" id="3384445">Rbrace</span><span class="op" id="3384451">:</span>&nbsp;<span class="ident" id="3384453">rbrace</span><span class="op" id="3384459">}</span><br>
<span class="lineno"></span><span class="op" id="3384461">}</span><br>
<span class="lineno">1090</span><br>
<span class="lineno"></span><span class="comment" id="3384464">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3384544">//&nbsp;Expressions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3384560">func</span>&nbsp;<span class="op" id="3384565">(</span><span class="ident" id="3384566">p</span>&nbsp;<span class="op" id="3384568">*</span><span class="ident" id="3384569">parser</span><span class="op" id="3384575">)</span>&nbsp;<span class="ident" id="3384577">parseFuncTypeOrLit</span><span class="op" id="3384595">(</span><span class="op" id="3384596">)</span>&nbsp;<span class="ident" id="3384598">ast</span><span class="op" id="3384601">.</span><span class="ident" id="3384602">Expr</span>&nbsp;<span class="op" id="3384607">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384610">if</span>&nbsp;<span class="ident" id="3384613">p</span><span class="op" id="3384614">.</span><span class="ident" id="3384615">trace</span>&nbsp;<span class="op" id="3384621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384625">defer</span>&nbsp;<span class="ident" id="3384631">un</span><span class="op" id="3384633">(</span><span class="ident" id="3384634">trace</span><span class="op" id="3384639">(</span><span class="ident" id="3384640">p</span><span class="op" id="3384641">,</span>&nbsp;<span class="string" id="3384643">&#34;FuncTypeOrLit&#34;</span><span class="op" id="3384658">)</span><span class="op" id="3384659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3384662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384666">typ</span><span class="op" id="3384669">,</span>&nbsp;<span class="ident" id="3384671">scope</span>&nbsp;<span class="op" id="3384677">:=</span>&nbsp;<span class="ident" id="3384680">p</span><span class="op" id="3384681">.</span><span class="ident" id="3384682">parseFuncType</span><span class="op" id="3384695">(</span><span class="op" id="3384696">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384699">if</span>&nbsp;<span class="ident" id="3384702">p</span><span class="op" id="3384703">.</span><span class="ident" id="3384704">tok</span>&nbsp;<span class="op" id="3384708">!=</span>&nbsp;<span class="ident" id="3384711">token</span><span class="op" id="3384716">.</span><span class="ident" id="3384717">LBRACE</span>&nbsp;<span class="op" id="3384724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3384728">//&nbsp;function&nbsp;type&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384752">return</span>&nbsp;<span class="ident" id="3384759">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3384764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384768">p</span><span class="op" id="3384769">.</span><span class="ident" id="3384770">exprLev</span><span class="op" id="3384777">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384781">body</span>&nbsp;<span class="op" id="3384786">:=</span>&nbsp;<span class="ident" id="3384789">p</span><span class="op" id="3384790">.</span><span class="ident" id="3384791">parseBody</span><span class="op" id="3384800">(</span><span class="ident" id="3384801">scope</span><span class="op" id="3384806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3384809">p</span><span class="op" id="3384810">.</span><span class="ident" id="3384811">exprLev</span><span class="op" id="3384818">--</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3384823">return</span>&nbsp;<span class="op" id="3384830">&amp;</span><span class="ident" id="3384831">ast</span><span class="op" id="3384834">.</span><span class="ident" id="3384835">FuncLit</span><span class="op" id="3384842">{</span><span class="ident" id="3384843">Type</span><span class="op" id="3384847">:</span>&nbsp;<span class="ident" id="3384849">typ</span><span class="op" id="3384852">,</span>&nbsp;<span class="ident" id="3384854">Body</span><span class="op" id="3384858">:</span>&nbsp;<span class="ident" id="3384860">body</span><span class="op" id="3384864">}</span><br>
<span class="lineno">1110</span><span class="op" id="3384866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3384869">//&nbsp;parseOperand&nbsp;may&nbsp;return&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;raw&nbsp;type&nbsp;(incl.&nbsp;array</span><br>
<span class="lineno"></span><span class="comment" id="3384937">//&nbsp;types&nbsp;of&nbsp;the&nbsp;form&nbsp;[...]T.&nbsp;Callers&nbsp;must&nbsp;verify&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="3384998">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1115</span><span class="comment" id="3385068">//</span><br>
<span class="lineno"></span><span class="keyword" id="3385071">func</span>&nbsp;<span class="op" id="3385076">(</span><span class="ident" id="3385077">p</span>&nbsp;<span class="op" id="3385079">*</span><span class="ident" id="3385080">parser</span><span class="op" id="3385086">)</span>&nbsp;<span class="ident" id="3385088">parseOperand</span><span class="op" id="3385100">(</span><span class="ident" id="3385101">lhs</span>&nbsp;<span class="builtintype" id="3385105">bool</span><span class="op" id="3385109">)</span>&nbsp;<span class="ident" id="3385111">ast</span><span class="op" id="3385114">.</span><span class="ident" id="3385115">Expr</span>&nbsp;<span class="op" id="3385120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385123">if</span>&nbsp;<span class="ident" id="3385126">p</span><span class="op" id="3385127">.</span><span class="ident" id="3385128">trace</span>&nbsp;<span class="op" id="3385134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385138">defer</span>&nbsp;<span class="ident" id="3385144">un</span><span class="op" id="3385146">(</span><span class="ident" id="3385147">trace</span><span class="op" id="3385152">(</span><span class="ident" id="3385153">p</span><span class="op" id="3385154">,</span>&nbsp;<span class="string" id="3385156">&#34;Operand&#34;</span><span class="op" id="3385165">)</span><span class="op" id="3385166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3385169">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385173">switch</span>&nbsp;<span class="ident" id="3385180">p</span><span class="op" id="3385181">.</span><span class="ident" id="3385182">tok</span>&nbsp;<span class="op" id="3385186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385189">case</span>&nbsp;<span class="ident" id="3385194">token</span><span class="op" id="3385199">.</span><span class="ident" id="3385200">IDENT</span><span class="op" id="3385205">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385209">x</span>&nbsp;<span class="op" id="3385211">:=</span>&nbsp;<span class="ident" id="3385214">p</span><span class="op" id="3385215">.</span><span class="ident" id="3385216">parseIdent</span><span class="op" id="3385226">(</span><span class="op" id="3385227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385231">if</span>&nbsp;<span class="op" id="3385234">!</span><span class="ident" id="3385235">lhs</span>&nbsp;<span class="op" id="3385239">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385244">p</span><span class="op" id="3385245">.</span><span class="ident" id="3385246">resolve</span><span class="op" id="3385253">(</span><span class="ident" id="3385254">x</span><span class="op" id="3385255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3385259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385263">return</span>&nbsp;<span class="ident" id="3385270">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385274">case</span>&nbsp;<span class="ident" id="3385279">token</span><span class="op" id="3385284">.</span><span class="ident" id="3385285">INT</span><span class="op" id="3385288">,</span>&nbsp;<span class="ident" id="3385290">token</span><span class="op" id="3385295">.</span><span class="ident" id="3385296">FLOAT</span><span class="op" id="3385301">,</span>&nbsp;<span class="ident" id="3385303">token</span><span class="op" id="3385308">.</span><span class="ident" id="3385309">IMAG</span><span class="op" id="3385313">,</span>&nbsp;<span class="ident" id="3385315">token</span><span class="op" id="3385320">.</span><span class="ident" id="3385321">CHAR</span><span class="op" id="3385325">,</span>&nbsp;<span class="ident" id="3385327">token</span><span class="op" id="3385332">.</span><span class="ident" id="3385333">STRING</span><span class="op" id="3385339">:</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385343">x</span>&nbsp;<span class="op" id="3385345">:=</span>&nbsp;<span class="op" id="3385348">&amp;</span><span class="ident" id="3385349">ast</span><span class="op" id="3385352">.</span><span class="ident" id="3385353">BasicLit</span><span class="op" id="3385361">{</span><span class="ident" id="3385362">ValuePos</span><span class="op" id="3385370">:</span>&nbsp;<span class="ident" id="3385372">p</span><span class="op" id="3385373">.</span><span class="ident" id="3385374">pos</span><span class="op" id="3385377">,</span>&nbsp;<span class="ident" id="3385379">Kind</span><span class="op" id="3385383">:</span>&nbsp;<span class="ident" id="3385385">p</span><span class="op" id="3385386">.</span><span class="ident" id="3385387">tok</span><span class="op" id="3385390">,</span>&nbsp;<span class="ident" id="3385392">Value</span><span class="op" id="3385397">:</span>&nbsp;<span class="ident" id="3385399">p</span><span class="op" id="3385400">.</span><span class="ident" id="3385401">lit</span><span class="op" id="3385404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385408">p</span><span class="op" id="3385409">.</span><span class="ident" id="3385410">next</span><span class="op" id="3385414">(</span><span class="op" id="3385415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385419">return</span>&nbsp;<span class="ident" id="3385426">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385430">case</span>&nbsp;<span class="ident" id="3385435">token</span><span class="op" id="3385440">.</span><span class="ident" id="3385441">LPAREN</span><span class="op" id="3385447">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385451">lparen</span>&nbsp;<span class="op" id="3385458">:=</span>&nbsp;<span class="ident" id="3385461">p</span><span class="op" id="3385462">.</span><span class="ident" id="3385463">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385469">p</span><span class="op" id="3385470">.</span><span class="ident" id="3385471">next</span><span class="op" id="3385475">(</span><span class="op" id="3385476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385480">p</span><span class="op" id="3385481">.</span><span class="ident" id="3385482">exprLev</span><span class="op" id="3385489">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385494">x</span>&nbsp;<span class="op" id="3385496">:=</span>&nbsp;<span class="ident" id="3385499">p</span><span class="op" id="3385500">.</span><span class="ident" id="3385501">parseRhsOrType</span><span class="op" id="3385515">(</span><span class="op" id="3385516">)</span>&nbsp;<span class="comment" id="3385518">//&nbsp;types&nbsp;may&nbsp;be&nbsp;parenthesized:&nbsp;(some&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385563">p</span><span class="op" id="3385564">.</span><span class="ident" id="3385565">exprLev</span><span class="op" id="3385572">--</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385577">rparen</span>&nbsp;<span class="op" id="3385584">:=</span>&nbsp;<span class="ident" id="3385587">p</span><span class="op" id="3385588">.</span><span class="ident" id="3385589">expect</span><span class="op" id="3385595">(</span><span class="ident" id="3385596">token</span><span class="op" id="3385601">.</span><span class="ident" id="3385602">RPAREN</span><span class="op" id="3385608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385612">return</span>&nbsp;<span class="op" id="3385619">&amp;</span><span class="ident" id="3385620">ast</span><span class="op" id="3385623">.</span><span class="ident" id="3385624">ParenExpr</span><span class="op" id="3385633">{</span><span class="ident" id="3385634">Lparen</span><span class="op" id="3385640">:</span>&nbsp;<span class="ident" id="3385642">lparen</span><span class="op" id="3385648">,</span>&nbsp;<span class="ident" id="3385650">X</span><span class="op" id="3385651">:</span>&nbsp;<span class="ident" id="3385653">x</span><span class="op" id="3385654">,</span>&nbsp;<span class="ident" id="3385656">Rparen</span><span class="op" id="3385662">:</span>&nbsp;<span class="ident" id="3385664">rparen</span><span class="op" id="3385670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385674">case</span>&nbsp;<span class="ident" id="3385679">token</span><span class="op" id="3385684">.</span><span class="ident" id="3385685">FUNC</span><span class="op" id="3385689">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385693">return</span>&nbsp;<span class="ident" id="3385700">p</span><span class="op" id="3385701">.</span><span class="ident" id="3385702">parseFuncTypeOrLit</span><span class="op" id="3385720">(</span><span class="op" id="3385721">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3385724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385728">if</span>&nbsp;<span class="ident" id="3385731">typ</span>&nbsp;<span class="op" id="3385735">:=</span>&nbsp;<span class="ident" id="3385738">p</span><span class="op" id="3385739">.</span><span class="ident" id="3385740">tryIdentOrType</span><span class="op" id="3385754">(</span><span class="op" id="3385755">)</span><span class="op" id="3385756">;</span>&nbsp;<span class="ident" id="3385758">typ</span>&nbsp;<span class="op" id="3385762">!=</span>&nbsp;<span class="ident" id="3385765">nil</span>&nbsp;<span class="op" id="3385769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3385773">//&nbsp;could&nbsp;be&nbsp;type&nbsp;for&nbsp;composite&nbsp;literal&nbsp;or&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385828">_</span><span class="op" id="3385829">,</span>&nbsp;<span class="ident" id="3385831">isIdent</span>&nbsp;<span class="op" id="3385839">:=</span>&nbsp;<span class="ident" id="3385842">typ</span><span class="op" id="3385845">.</span><span class="op" id="3385846">(</span><span class="op" id="3385847">*</span><span class="ident" id="3385848">ast</span><span class="op" id="3385851">.</span><span class="ident" id="3385852">Ident</span><span class="op" id="3385857">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385861">assert</span><span class="op" id="3385867">(</span><span class="op" id="3385868">!</span><span class="ident" id="3385869">isIdent</span><span class="op" id="3385876">,</span>&nbsp;<span class="string" id="3385878">&#34;type&nbsp;cannot&nbsp;be&nbsp;identifier&#34;</span><span class="op" id="3385905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3385909">return</span>&nbsp;<span class="ident" id="3385916">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3385921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3385925">//&nbsp;we&nbsp;have&nbsp;an&nbsp;error</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385946">pos</span>&nbsp;<span class="op" id="3385950">:=</span>&nbsp;<span class="ident" id="3385953">p</span><span class="op" id="3385954">.</span><span class="ident" id="3385955">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385960">p</span><span class="op" id="3385961">.</span><span class="ident" id="3385962">errorExpected</span><span class="op" id="3385975">(</span><span class="ident" id="3385976">pos</span><span class="op" id="3385979">,</span>&nbsp;<span class="string" id="3385981">&#34;operand&#34;</span><span class="op" id="3385990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3385993">syncStmt</span><span class="op" id="3386001">(</span><span class="ident" id="3386002">p</span><span class="op" id="3386003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386006">return</span>&nbsp;<span class="op" id="3386013">&amp;</span><span class="ident" id="3386014">ast</span><span class="op" id="3386017">.</span><span class="ident" id="3386018">BadExpr</span><span class="op" id="3386025">{</span><span class="ident" id="3386026">From</span><span class="op" id="3386030">:</span>&nbsp;<span class="ident" id="3386032">pos</span><span class="op" id="3386035">,</span>&nbsp;<span class="ident" id="3386037">To</span><span class="op" id="3386039">:</span>&nbsp;<span class="ident" id="3386041">p</span><span class="op" id="3386042">.</span><span class="ident" id="3386043">pos</span><span class="op" id="3386046">}</span><br>
<span class="lineno"></span><span class="op" id="3386048">}</span><br>
<span class="lineno">1160</span><br>
<span class="lineno"></span><span class="keyword" id="3386051">func</span>&nbsp;<span class="op" id="3386056">(</span><span class="ident" id="3386057">p</span>&nbsp;<span class="op" id="3386059">*</span><span class="ident" id="3386060">parser</span><span class="op" id="3386066">)</span>&nbsp;<span class="ident" id="3386068">parseSelector</span><span class="op" id="3386081">(</span><span class="ident" id="3386082">x</span>&nbsp;<span class="ident" id="3386084">ast</span><span class="op" id="3386087">.</span><span class="ident" id="3386088">Expr</span><span class="op" id="3386092">)</span>&nbsp;<span class="ident" id="3386094">ast</span><span class="op" id="3386097">.</span><span class="ident" id="3386098">Expr</span>&nbsp;<span class="op" id="3386103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386106">if</span>&nbsp;<span class="ident" id="3386109">p</span><span class="op" id="3386110">.</span><span class="ident" id="3386111">trace</span>&nbsp;<span class="op" id="3386117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386121">defer</span>&nbsp;<span class="ident" id="3386127">un</span><span class="op" id="3386129">(</span><span class="ident" id="3386130">trace</span><span class="op" id="3386135">(</span><span class="ident" id="3386136">p</span><span class="op" id="3386137">,</span>&nbsp;<span class="string" id="3386139">&#34;Selector&#34;</span><span class="op" id="3386149">)</span><span class="op" id="3386150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3386153">}</span><br>
<span class="lineno">1165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386157">sel</span>&nbsp;<span class="op" id="3386161">:=</span>&nbsp;<span class="ident" id="3386164">p</span><span class="op" id="3386165">.</span><span class="ident" id="3386166">parseIdent</span><span class="op" id="3386176">(</span><span class="op" id="3386177">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386181">return</span>&nbsp;<span class="op" id="3386188">&amp;</span><span class="ident" id="3386189">ast</span><span class="op" id="3386192">.</span><span class="ident" id="3386193">SelectorExpr</span><span class="op" id="3386205">{</span><span class="ident" id="3386206">X</span><span class="op" id="3386207">:</span>&nbsp;<span class="ident" id="3386209">x</span><span class="op" id="3386210">,</span>&nbsp;<span class="ident" id="3386212">Sel</span><span class="op" id="3386215">:</span>&nbsp;<span class="ident" id="3386217">sel</span><span class="op" id="3386220">}</span><br>
<span class="lineno"></span><span class="op" id="3386222">}</span><br>
<span class="lineno">1170</span><br>
<span class="lineno"></span><span class="keyword" id="3386225">func</span>&nbsp;<span class="op" id="3386230">(</span><span class="ident" id="3386231">p</span>&nbsp;<span class="op" id="3386233">*</span><span class="ident" id="3386234">parser</span><span class="op" id="3386240">)</span>&nbsp;<span class="ident" id="3386242">parseTypeAssertion</span><span class="op" id="3386260">(</span><span class="ident" id="3386261">x</span>&nbsp;<span class="ident" id="3386263">ast</span><span class="op" id="3386266">.</span><span class="ident" id="3386267">Expr</span><span class="op" id="3386271">)</span>&nbsp;<span class="ident" id="3386273">ast</span><span class="op" id="3386276">.</span><span class="ident" id="3386277">Expr</span>&nbsp;<span class="op" id="3386282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386285">if</span>&nbsp;<span class="ident" id="3386288">p</span><span class="op" id="3386289">.</span><span class="ident" id="3386290">trace</span>&nbsp;<span class="op" id="3386296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386300">defer</span>&nbsp;<span class="ident" id="3386306">un</span><span class="op" id="3386308">(</span><span class="ident" id="3386309">trace</span><span class="op" id="3386314">(</span><span class="ident" id="3386315">p</span><span class="op" id="3386316">,</span>&nbsp;<span class="string" id="3386318">&#34;TypeAssertion&#34;</span><span class="op" id="3386333">)</span><span class="op" id="3386334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3386337">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386341">lparen</span>&nbsp;<span class="op" id="3386348">:=</span>&nbsp;<span class="ident" id="3386351">p</span><span class="op" id="3386352">.</span><span class="ident" id="3386353">expect</span><span class="op" id="3386359">(</span><span class="ident" id="3386360">token</span><span class="op" id="3386365">.</span><span class="ident" id="3386366">LPAREN</span><span class="op" id="3386372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386375">var</span>&nbsp;<span class="ident" id="3386379">typ</span>&nbsp;<span class="ident" id="3386383">ast</span><span class="op" id="3386386">.</span><span class="ident" id="3386387">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386393">if</span>&nbsp;<span class="ident" id="3386396">p</span><span class="op" id="3386397">.</span><span class="ident" id="3386398">tok</span>&nbsp;<span class="op" id="3386402">==</span>&nbsp;<span class="ident" id="3386405">token</span><span class="op" id="3386410">.</span><span class="ident" id="3386411">TYPE</span>&nbsp;<span class="op" id="3386416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3386420">//&nbsp;type&nbsp;switch:&nbsp;typ&nbsp;==&nbsp;nil</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386449">p</span><span class="op" id="3386450">.</span><span class="ident" id="3386451">next</span><span class="op" id="3386455">(</span><span class="op" id="3386456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3386459">}</span>&nbsp;<span class="keyword" id="3386461">else</span>&nbsp;<span class="op" id="3386466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386470">typ</span>&nbsp;<span class="op" id="3386474">=</span>&nbsp;<span class="ident" id="3386476">p</span><span class="op" id="3386477">.</span><span class="ident" id="3386478">parseType</span><span class="op" id="3386487">(</span><span class="op" id="3386488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3386491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386494">rparen</span>&nbsp;<span class="op" id="3386501">:=</span>&nbsp;<span class="ident" id="3386504">p</span><span class="op" id="3386505">.</span><span class="ident" id="3386506">expect</span><span class="op" id="3386512">(</span><span class="ident" id="3386513">token</span><span class="op" id="3386518">.</span><span class="ident" id="3386519">RPAREN</span><span class="op" id="3386525">)</span><br>
<span class="lineno">1185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386529">return</span>&nbsp;<span class="op" id="3386536">&amp;</span><span class="ident" id="3386537">ast</span><span class="op" id="3386540">.</span><span class="ident" id="3386541">TypeAssertExpr</span><span class="op" id="3386555">{</span><span class="ident" id="3386556">X</span><span class="op" id="3386557">:</span>&nbsp;<span class="ident" id="3386559">x</span><span class="op" id="3386560">,</span>&nbsp;<span class="ident" id="3386562">Type</span><span class="op" id="3386566">:</span>&nbsp;<span class="ident" id="3386568">typ</span><span class="op" id="3386571">,</span>&nbsp;<span class="ident" id="3386573">Lparen</span><span class="op" id="3386579">:</span>&nbsp;<span class="ident" id="3386581">lparen</span><span class="op" id="3386587">,</span>&nbsp;<span class="ident" id="3386589">Rparen</span><span class="op" id="3386595">:</span>&nbsp;<span class="ident" id="3386597">rparen</span><span class="op" id="3386603">}</span><br>
<span class="lineno"></span><span class="op" id="3386605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3386608">func</span>&nbsp;<span class="op" id="3386613">(</span><span class="ident" id="3386614">p</span>&nbsp;<span class="op" id="3386616">*</span><span class="ident" id="3386617">parser</span><span class="op" id="3386623">)</span>&nbsp;<span class="ident" id="3386625">parseIndexOrSlice</span><span class="op" id="3386642">(</span><span class="ident" id="3386643">x</span>&nbsp;<span class="ident" id="3386645">ast</span><span class="op" id="3386648">.</span><span class="ident" id="3386649">Expr</span><span class="op" id="3386653">)</span>&nbsp;<span class="ident" id="3386655">ast</span><span class="op" id="3386658">.</span><span class="ident" id="3386659">Expr</span>&nbsp;<span class="op" id="3386664">{</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386667">if</span>&nbsp;<span class="ident" id="3386670">p</span><span class="op" id="3386671">.</span><span class="ident" id="3386672">trace</span>&nbsp;<span class="op" id="3386678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386682">defer</span>&nbsp;<span class="ident" id="3386688">un</span><span class="op" id="3386690">(</span><span class="ident" id="3386691">trace</span><span class="op" id="3386696">(</span><span class="ident" id="3386697">p</span><span class="op" id="3386698">,</span>&nbsp;<span class="string" id="3386700">&#34;IndexOrSlice&#34;</span><span class="op" id="3386714">)</span><span class="op" id="3386715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3386718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386722">const</span>&nbsp;<span class="ident" id="3386728">N</span>&nbsp;<span class="op" id="3386730">=</span>&nbsp;<span class="num" id="3386732">3</span>&nbsp;<span class="comment" id="3386734">//&nbsp;change&nbsp;the&nbsp;3&nbsp;to&nbsp;2&nbsp;to&nbsp;disable&nbsp;3-index&nbsp;slices</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386782">lbrack</span>&nbsp;<span class="op" id="3386789">:=</span>&nbsp;<span class="ident" id="3386792">p</span><span class="op" id="3386793">.</span><span class="ident" id="3386794">expect</span><span class="op" id="3386800">(</span><span class="ident" id="3386801">token</span><span class="op" id="3386806">.</span><span class="ident" id="3386807">LBRACK</span><span class="op" id="3386813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386816">p</span><span class="op" id="3386817">.</span><span class="ident" id="3386818">exprLev</span><span class="op" id="3386825">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386829">var</span>&nbsp;<span class="ident" id="3386833">index</span>&nbsp;<span class="op" id="3386839">[</span><span class="ident" id="3386840">N</span><span class="op" id="3386841">]</span><span class="ident" id="3386842">ast</span><span class="op" id="3386845">.</span><span class="ident" id="3386846">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386852">var</span>&nbsp;<span class="ident" id="3386856">colons</span>&nbsp;<span class="op" id="3386863">[</span><span class="ident" id="3386864">N</span>&nbsp;<span class="op" id="3386866">-</span>&nbsp;<span class="num" id="3386868">1</span><span class="op" id="3386869">]</span><span class="ident" id="3386870">token</span><span class="op" id="3386875">.</span><span class="ident" id="3386876">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386881">if</span>&nbsp;<span class="ident" id="3386884">p</span><span class="op" id="3386885">.</span><span class="ident" id="3386886">tok</span>&nbsp;<span class="op" id="3386890">!=</span>&nbsp;<span class="ident" id="3386893">token</span><span class="op" id="3386898">.</span><span class="ident" id="3386899">COLON</span>&nbsp;<span class="op" id="3386905">{</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386909">index</span><span class="op" id="3386914">[</span><span class="num" id="3386915">0</span><span class="op" id="3386916">]</span>&nbsp;<span class="op" id="3386918">=</span>&nbsp;<span class="ident" id="3386920">p</span><span class="op" id="3386921">.</span><span class="ident" id="3386922">parseRhs</span><span class="op" id="3386930">(</span><span class="op" id="3386931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3386934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3386937">ncolons</span>&nbsp;<span class="op" id="3386945">:=</span>&nbsp;<span class="num" id="3386948">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3386951">for</span>&nbsp;<span class="ident" id="3386955">p</span><span class="op" id="3386956">.</span><span class="ident" id="3386957">tok</span>&nbsp;<span class="op" id="3386961">==</span>&nbsp;<span class="ident" id="3386964">token</span><span class="op" id="3386969">.</span><span class="ident" id="3386970">COLON</span>&nbsp;<span class="op" id="3386976">&amp;&amp;</span>&nbsp;<span class="ident" id="3386979">ncolons</span>&nbsp;<span class="op" id="3386987">&lt;</span>&nbsp;<span class="builtinfunc" id="3386989">len</span><span class="op" id="3386992">(</span><span class="ident" id="3386993">colons</span><span class="op" id="3386999">)</span>&nbsp;<span class="op" id="3387001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387005">colons</span><span class="op" id="3387011">[</span><span class="ident" id="3387012">ncolons</span><span class="op" id="3387019">]</span>&nbsp;<span class="op" id="3387021">=</span>&nbsp;<span class="ident" id="3387023">p</span><span class="op" id="3387024">.</span><span class="ident" id="3387025">pos</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387031">ncolons</span><span class="op" id="3387038">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387043">p</span><span class="op" id="3387044">.</span><span class="ident" id="3387045">next</span><span class="op" id="3387049">(</span><span class="op" id="3387050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387054">if</span>&nbsp;<span class="ident" id="3387057">p</span><span class="op" id="3387058">.</span><span class="ident" id="3387059">tok</span>&nbsp;<span class="op" id="3387063">!=</span>&nbsp;<span class="ident" id="3387066">token</span><span class="op" id="3387071">.</span><span class="ident" id="3387072">COLON</span>&nbsp;<span class="op" id="3387078">&amp;&amp;</span>&nbsp;<span class="ident" id="3387081">p</span><span class="op" id="3387082">.</span><span class="ident" id="3387083">tok</span>&nbsp;<span class="op" id="3387087">!=</span>&nbsp;<span class="ident" id="3387090">token</span><span class="op" id="3387095">.</span><span class="ident" id="3387096">RBRACK</span>&nbsp;<span class="op" id="3387103">&amp;&amp;</span>&nbsp;<span class="ident" id="3387106">p</span><span class="op" id="3387107">.</span><span class="ident" id="3387108">tok</span>&nbsp;<span class="op" id="3387112">!=</span>&nbsp;<span class="ident" id="3387115">token</span><span class="op" id="3387120">.</span><span class="ident" id="3387121">EOF</span>&nbsp;<span class="op" id="3387125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387130">index</span><span class="op" id="3387135">[</span><span class="ident" id="3387136">ncolons</span><span class="op" id="3387143">]</span>&nbsp;<span class="op" id="3387145">=</span>&nbsp;<span class="ident" id="3387147">p</span><span class="op" id="3387148">.</span><span class="ident" id="3387149">parseRhs</span><span class="op" id="3387157">(</span><span class="op" id="3387158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387162">}</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387168">p</span><span class="op" id="3387169">.</span><span class="ident" id="3387170">exprLev</span><span class="op" id="3387177">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387181">rbrack</span>&nbsp;<span class="op" id="3387188">:=</span>&nbsp;<span class="ident" id="3387191">p</span><span class="op" id="3387192">.</span><span class="ident" id="3387193">expect</span><span class="op" id="3387199">(</span><span class="ident" id="3387200">token</span><span class="op" id="3387205">.</span><span class="ident" id="3387206">RBRACK</span><span class="op" id="3387212">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387216">if</span>&nbsp;<span class="ident" id="3387219">ncolons</span>&nbsp;<span class="op" id="3387227">&gt;</span>&nbsp;<span class="num" id="3387229">0</span>&nbsp;<span class="op" id="3387231">{</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387235">//&nbsp;slice&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387257">slice3</span>&nbsp;<span class="op" id="3387264">:=</span>&nbsp;<span class="builtintype" id="3387267">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387275">if</span>&nbsp;<span class="ident" id="3387278">ncolons</span>&nbsp;<span class="op" id="3387286">==</span>&nbsp;<span class="num" id="3387289">2</span>&nbsp;<span class="op" id="3387291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387296">slice3</span>&nbsp;<span class="op" id="3387303">=</span>&nbsp;<span class="builtintype" id="3387305">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387313">//&nbsp;Check&nbsp;presence&nbsp;of&nbsp;2nd&nbsp;and&nbsp;3rd&nbsp;index&nbsp;here&nbsp;rather&nbsp;than&nbsp;during&nbsp;type-checking</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3387393">//&nbsp;to&nbsp;prevent&nbsp;erroneous&nbsp;programs&nbsp;from&nbsp;passing&nbsp;through&nbsp;gofmt&nbsp;(was&nbsp;issue&nbsp;7305).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387474">if</span>&nbsp;<span class="ident" id="3387477">index</span><span class="op" id="3387482">[</span><span class="num" id="3387483">1</span><span class="op" id="3387484">]</span>&nbsp;<span class="op" id="3387486">==</span>&nbsp;<span class="ident" id="3387489">nil</span>&nbsp;<span class="op" id="3387493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387499">p</span><span class="op" id="3387500">.</span><span class="builtintype" id="3387501">error</span><span class="op" id="3387506">(</span><span class="ident" id="3387507">colons</span><span class="op" id="3387513">[</span><span class="num" id="3387514">0</span><span class="op" id="3387515">]</span><span class="op" id="3387516">,</span>&nbsp;<span class="string" id="3387518">&#34;2nd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="3387555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387561">index</span><span class="op" id="3387566">[</span><span class="num" id="3387567">1</span><span class="op" id="3387568">]</span>&nbsp;<span class="op" id="3387570">=</span>&nbsp;<span class="op" id="3387572">&amp;</span><span class="ident" id="3387573">ast</span><span class="op" id="3387576">.</span><span class="ident" id="3387577">BadExpr</span><span class="op" id="3387584">{</span><span class="ident" id="3387585">From</span><span class="op" id="3387589">:</span>&nbsp;<span class="ident" id="3387591">colons</span><span class="op" id="3387597">[</span><span class="num" id="3387598">0</span><span class="op" id="3387599">]</span>&nbsp;<span class="op" id="3387601">+</span>&nbsp;<span class="num" id="3387603">1</span><span class="op" id="3387604">,</span>&nbsp;<span class="ident" id="3387606">To</span><span class="op" id="3387608">:</span>&nbsp;<span class="ident" id="3387610">colons</span><span class="op" id="3387616">[</span><span class="num" id="3387617">1</span><span class="op" id="3387618">]</span><span class="op" id="3387619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387624">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387629">if</span>&nbsp;<span class="ident" id="3387632">index</span><span class="op" id="3387637">[</span><span class="num" id="3387638">2</span><span class="op" id="3387639">]</span>&nbsp;<span class="op" id="3387641">==</span>&nbsp;<span class="ident" id="3387644">nil</span>&nbsp;<span class="op" id="3387648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387654">p</span><span class="op" id="3387655">.</span><span class="builtintype" id="3387656">error</span><span class="op" id="3387661">(</span><span class="ident" id="3387662">colons</span><span class="op" id="3387668">[</span><span class="num" id="3387669">1</span><span class="op" id="3387670">]</span><span class="op" id="3387671">,</span>&nbsp;<span class="string" id="3387673">&#34;3rd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="3387710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3387716">index</span><span class="op" id="3387721">[</span><span class="num" id="3387722">2</span><span class="op" id="3387723">]</span>&nbsp;<span class="op" id="3387725">=</span>&nbsp;<span class="op" id="3387727">&amp;</span><span class="ident" id="3387728">ast</span><span class="op" id="3387731">.</span><span class="ident" id="3387732">BadExpr</span><span class="op" id="3387739">{</span><span class="ident" id="3387740">From</span><span class="op" id="3387744">:</span>&nbsp;<span class="ident" id="3387746">colons</span><span class="op" id="3387752">[</span><span class="num" id="3387753">1</span><span class="op" id="3387754">]</span>&nbsp;<span class="op" id="3387756">+</span>&nbsp;<span class="num" id="3387758">1</span><span class="op" id="3387759">,</span>&nbsp;<span class="ident" id="3387761">To</span><span class="op" id="3387763">:</span>&nbsp;<span class="ident" id="3387765">rbrack</span><span class="op" id="3387771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387780">}</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387784">return</span>&nbsp;<span class="op" id="3387791">&amp;</span><span class="ident" id="3387792">ast</span><span class="op" id="3387795">.</span><span class="ident" id="3387796">SliceExpr</span><span class="op" id="3387805">{</span><span class="ident" id="3387806">X</span><span class="op" id="3387807">:</span>&nbsp;<span class="ident" id="3387809">x</span><span class="op" id="3387810">,</span>&nbsp;<span class="ident" id="3387812">Lbrack</span><span class="op" id="3387818">:</span>&nbsp;<span class="ident" id="3387820">lbrack</span><span class="op" id="3387826">,</span>&nbsp;<span class="ident" id="3387828">Low</span><span class="op" id="3387831">:</span>&nbsp;<span class="ident" id="3387833">index</span><span class="op" id="3387838">[</span><span class="num" id="3387839">0</span><span class="op" id="3387840">]</span><span class="op" id="3387841">,</span>&nbsp;<span class="ident" id="3387843">High</span><span class="op" id="3387847">:</span>&nbsp;<span class="ident" id="3387849">index</span><span class="op" id="3387854">[</span><span class="num" id="3387855">1</span><span class="op" id="3387856">]</span><span class="op" id="3387857">,</span>&nbsp;<span class="ident" id="3387859">Max</span><span class="op" id="3387862">:</span>&nbsp;<span class="ident" id="3387864">index</span><span class="op" id="3387869">[</span><span class="num" id="3387870">2</span><span class="op" id="3387871">]</span><span class="op" id="3387872">,</span>&nbsp;<span class="ident" id="3387874">Slice3</span><span class="op" id="3387880">:</span>&nbsp;<span class="ident" id="3387882">slice3</span><span class="op" id="3387888">,</span>&nbsp;<span class="ident" id="3387890">Rbrack</span><span class="op" id="3387896">:</span>&nbsp;<span class="ident" id="3387898">rbrack</span><span class="op" id="3387904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3387907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3387911">return</span>&nbsp;<span class="op" id="3387918">&amp;</span><span class="ident" id="3387919">ast</span><span class="op" id="3387922">.</span><span class="ident" id="3387923">IndexExpr</span><span class="op" id="3387932">{</span><span class="ident" id="3387933">X</span><span class="op" id="3387934">:</span>&nbsp;<span class="ident" id="3387936">x</span><span class="op" id="3387937">,</span>&nbsp;<span class="ident" id="3387939">Lbrack</span><span class="op" id="3387945">:</span>&nbsp;<span class="ident" id="3387947">lbrack</span><span class="op" id="3387953">,</span>&nbsp;<span class="ident" id="3387955">Index</span><span class="op" id="3387960">:</span>&nbsp;<span class="ident" id="3387962">index</span><span class="op" id="3387967">[</span><span class="num" id="3387968">0</span><span class="op" id="3387969">]</span><span class="op" id="3387970">,</span>&nbsp;<span class="ident" id="3387972">Rbrack</span><span class="op" id="3387978">:</span>&nbsp;<span class="ident" id="3387980">rbrack</span><span class="op" id="3387986">}</span><br>
<span class="lineno"></span><span class="op" id="3387988">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span><span class="keyword" id="3387991">func</span>&nbsp;<span class="op" id="3387996">(</span><span class="ident" id="3387997">p</span>&nbsp;<span class="op" id="3387999">*</span><span class="ident" id="3388000">parser</span><span class="op" id="3388006">)</span>&nbsp;<span class="ident" id="3388008">parseCallOrConversion</span><span class="op" id="3388029">(</span><span class="ident" id="3388030">fun</span>&nbsp;<span class="ident" id="3388034">ast</span><span class="op" id="3388037">.</span><span class="ident" id="3388038">Expr</span><span class="op" id="3388042">)</span>&nbsp;<span class="op" id="3388044">*</span><span class="ident" id="3388045">ast</span><span class="op" id="3388048">.</span><span class="ident" id="3388049">CallExpr</span>&nbsp;<span class="op" id="3388058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388061">if</span>&nbsp;<span class="ident" id="3388064">p</span><span class="op" id="3388065">.</span><span class="ident" id="3388066">trace</span>&nbsp;<span class="op" id="3388072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388076">defer</span>&nbsp;<span class="ident" id="3388082">un</span><span class="op" id="3388084">(</span><span class="ident" id="3388085">trace</span><span class="op" id="3388090">(</span><span class="ident" id="3388091">p</span><span class="op" id="3388092">,</span>&nbsp;<span class="string" id="3388094">&#34;CallOrConversion&#34;</span><span class="op" id="3388112">)</span><span class="op" id="3388113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388116">}</span><br>
<span class="lineno">1240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388120">lparen</span>&nbsp;<span class="op" id="3388127">:=</span>&nbsp;<span class="ident" id="3388130">p</span><span class="op" id="3388131">.</span><span class="ident" id="3388132">expect</span><span class="op" id="3388138">(</span><span class="ident" id="3388139">token</span><span class="op" id="3388144">.</span><span class="ident" id="3388145">LPAREN</span><span class="op" id="3388151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388154">p</span><span class="op" id="3388155">.</span><span class="ident" id="3388156">exprLev</span><span class="op" id="3388163">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388167">var</span>&nbsp;<span class="ident" id="3388171">list</span>&nbsp;<span class="op" id="3388176">[</span><span class="op" id="3388177">]</span><span class="ident" id="3388178">ast</span><span class="op" id="3388181">.</span><span class="ident" id="3388182">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388188">var</span>&nbsp;<span class="ident" id="3388192">ellipsis</span>&nbsp;<span class="ident" id="3388201">token</span><span class="op" id="3388206">.</span><span class="ident" id="3388207">Pos</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388212">for</span>&nbsp;<span class="ident" id="3388216">p</span><span class="op" id="3388217">.</span><span class="ident" id="3388218">tok</span>&nbsp;<span class="op" id="3388222">!=</span>&nbsp;<span class="ident" id="3388225">token</span><span class="op" id="3388230">.</span><span class="ident" id="3388231">RPAREN</span>&nbsp;<span class="op" id="3388238">&amp;&amp;</span>&nbsp;<span class="ident" id="3388241">p</span><span class="op" id="3388242">.</span><span class="ident" id="3388243">tok</span>&nbsp;<span class="op" id="3388247">!=</span>&nbsp;<span class="ident" id="3388250">token</span><span class="op" id="3388255">.</span><span class="ident" id="3388256">EOF</span>&nbsp;<span class="op" id="3388260">&amp;&amp;</span>&nbsp;<span class="op" id="3388263">!</span><span class="ident" id="3388264">ellipsis</span><span class="op" id="3388272">.</span><span class="ident" id="3388273">IsValid</span><span class="op" id="3388280">(</span><span class="op" id="3388281">)</span>&nbsp;<span class="op" id="3388283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388287">list</span>&nbsp;<span class="op" id="3388292">=</span>&nbsp;<span class="builtinfunc" id="3388294">append</span><span class="op" id="3388300">(</span><span class="ident" id="3388301">list</span><span class="op" id="3388305">,</span>&nbsp;<span class="ident" id="3388307">p</span><span class="op" id="3388308">.</span><span class="ident" id="3388309">parseRhsOrType</span><span class="op" id="3388323">(</span><span class="op" id="3388324">)</span><span class="op" id="3388325">)</span>&nbsp;<span class="comment" id="3388327">//&nbsp;builtins&nbsp;may&nbsp;expect&nbsp;a&nbsp;type:&nbsp;make(some&nbsp;type,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388381">if</span>&nbsp;<span class="ident" id="3388384">p</span><span class="op" id="3388385">.</span><span class="ident" id="3388386">tok</span>&nbsp;<span class="op" id="3388390">==</span>&nbsp;<span class="ident" id="3388393">token</span><span class="op" id="3388398">.</span><span class="ident" id="3388399">ELLIPSIS</span>&nbsp;<span class="op" id="3388408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388413">ellipsis</span>&nbsp;<span class="op" id="3388422">=</span>&nbsp;<span class="ident" id="3388424">p</span><span class="op" id="3388425">.</span><span class="ident" id="3388426">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388433">p</span><span class="op" id="3388434">.</span><span class="ident" id="3388435">next</span><span class="op" id="3388439">(</span><span class="op" id="3388440">)</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388448">if</span>&nbsp;<span class="op" id="3388451">!</span><span class="ident" id="3388452">p</span><span class="op" id="3388453">.</span><span class="ident" id="3388454">atComma</span><span class="op" id="3388461">(</span><span class="string" id="3388462">&#34;argument&nbsp;list&#34;</span><span class="op" id="3388477">)</span>&nbsp;<span class="op" id="3388479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388484">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388496">p</span><span class="op" id="3388497">.</span><span class="ident" id="3388498">next</span><span class="op" id="3388502">(</span><span class="op" id="3388503">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388509">p</span><span class="op" id="3388510">.</span><span class="ident" id="3388511">exprLev</span><span class="op" id="3388518">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3388522">rparen</span>&nbsp;<span class="op" id="3388529">:=</span>&nbsp;<span class="ident" id="3388532">p</span><span class="op" id="3388533">.</span><span class="ident" id="3388534">expectClosing</span><span class="op" id="3388547">(</span><span class="ident" id="3388548">token</span><span class="op" id="3388553">.</span><span class="ident" id="3388554">RPAREN</span><span class="op" id="3388560">,</span>&nbsp;<span class="string" id="3388562">&#34;argument&nbsp;list&#34;</span><span class="op" id="3388577">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388581">return</span>&nbsp;<span class="op" id="3388588">&amp;</span><span class="ident" id="3388589">ast</span><span class="op" id="3388592">.</span><span class="ident" id="3388593">CallExpr</span><span class="op" id="3388601">{</span><span class="ident" id="3388602">Fun</span><span class="op" id="3388605">:</span>&nbsp;<span class="ident" id="3388607">fun</span><span class="op" id="3388610">,</span>&nbsp;<span class="ident" id="3388612">Lparen</span><span class="op" id="3388618">:</span>&nbsp;<span class="ident" id="3388620">lparen</span><span class="op" id="3388626">,</span>&nbsp;<span class="ident" id="3388628">Args</span><span class="op" id="3388632">:</span>&nbsp;<span class="ident" id="3388634">list</span><span class="op" id="3388638">,</span>&nbsp;<span class="ident" id="3388640">Ellipsis</span><span class="op" id="3388648">:</span>&nbsp;<span class="ident" id="3388650">ellipsis</span><span class="op" id="3388658">,</span>&nbsp;<span class="ident" id="3388660">Rparen</span><span class="op" id="3388666">:</span>&nbsp;<span class="ident" id="3388668">rparen</span><span class="op" id="3388674">}</span><br>
<span class="lineno">1260</span><span class="op" id="3388676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3388679">func</span>&nbsp;<span class="op" id="3388684">(</span><span class="ident" id="3388685">p</span>&nbsp;<span class="op" id="3388687">*</span><span class="ident" id="3388688">parser</span><span class="op" id="3388694">)</span>&nbsp;<span class="ident" id="3388696">parseElement</span><span class="op" id="3388708">(</span><span class="ident" id="3388709">keyOk</span>&nbsp;<span class="builtintype" id="3388715">bool</span><span class="op" id="3388719">)</span>&nbsp;<span class="ident" id="3388721">ast</span><span class="op" id="3388724">.</span><span class="ident" id="3388725">Expr</span>&nbsp;<span class="op" id="3388730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388733">if</span>&nbsp;<span class="ident" id="3388736">p</span><span class="op" id="3388737">.</span><span class="ident" id="3388738">trace</span>&nbsp;<span class="op" id="3388744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388748">defer</span>&nbsp;<span class="ident" id="3388754">un</span><span class="op" id="3388756">(</span><span class="ident" id="3388757">trace</span><span class="op" id="3388762">(</span><span class="ident" id="3388763">p</span><span class="op" id="3388764">,</span>&nbsp;<span class="string" id="3388766">&#34;Element&#34;</span><span class="op" id="3388775">)</span><span class="op" id="3388776">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388783">if</span>&nbsp;<span class="ident" id="3388786">p</span><span class="op" id="3388787">.</span><span class="ident" id="3388788">tok</span>&nbsp;<span class="op" id="3388792">==</span>&nbsp;<span class="ident" id="3388795">token</span><span class="op" id="3388800">.</span><span class="ident" id="3388801">LBRACE</span>&nbsp;<span class="op" id="3388808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3388812">return</span>&nbsp;<span class="ident" id="3388819">p</span><span class="op" id="3388820">.</span><span class="ident" id="3388821">parseLiteralValue</span><span class="op" id="3388838">(</span><span class="ident" id="3388839">nil</span><span class="op" id="3388842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3388845">}</span><br>
<span class="lineno">1270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3388849">//&nbsp;Because&nbsp;the&nbsp;parser&nbsp;doesn&#39;t&nbsp;know&nbsp;the&nbsp;composite&nbsp;literal&nbsp;type,&nbsp;it&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3388923">//&nbsp;know&nbsp;if&nbsp;a&nbsp;key&nbsp;that&#39;s&nbsp;an&nbsp;identifier&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;name&nbsp;or&nbsp;a&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3388995">//&nbsp;denoting&nbsp;a&nbsp;value.&nbsp;The&nbsp;former&nbsp;is&nbsp;not&nbsp;resolved&nbsp;by&nbsp;the&nbsp;parser&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389065">//&nbsp;resolver.</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389079">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389083">//&nbsp;Instead,&nbsp;_try_&nbsp;to&nbsp;resolve&nbsp;such&nbsp;a&nbsp;key&nbsp;if&nbsp;possible.&nbsp;If&nbsp;it&nbsp;resolves,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389153">//&nbsp;it&nbsp;a)&nbsp;has&nbsp;correctly&nbsp;resolved,&nbsp;or&nbsp;b)&nbsp;incorrectly&nbsp;resolved&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389222">//&nbsp;the&nbsp;key&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;matching&nbsp;another&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389293">//&nbsp;In&nbsp;the&nbsp;former&nbsp;case&nbsp;we&nbsp;are&nbsp;done,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;we&nbsp;don&#39;t</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389361">//&nbsp;care&nbsp;because&nbsp;the&nbsp;type&nbsp;checker&nbsp;will&nbsp;do&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389428">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389432">//&nbsp;If&nbsp;the&nbsp;key&nbsp;does&nbsp;not&nbsp;resolve,&nbsp;it&nbsp;a)&nbsp;must&nbsp;be&nbsp;defined&nbsp;at&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389498">//&nbsp;level&nbsp;in&nbsp;another&nbsp;file&nbsp;of&nbsp;the&nbsp;same&nbsp;package,&nbsp;the&nbsp;universe&nbsp;scope,&nbsp;or&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389571">//&nbsp;undeclared;&nbsp;or&nbsp;b)&nbsp;it&nbsp;is&nbsp;a&nbsp;struct&nbsp;field.&nbsp;In&nbsp;the&nbsp;former&nbsp;case,&nbsp;the&nbsp;type</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389644">//&nbsp;checker&nbsp;can&nbsp;do&nbsp;a&nbsp;top-level&nbsp;lookup,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;it&nbsp;will&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389717">//&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389746">x</span>&nbsp;<span class="op" id="3389748">:=</span>&nbsp;<span class="ident" id="3389751">p</span><span class="op" id="3389752">.</span><span class="ident" id="3389753">checkExpr</span><span class="op" id="3389762">(</span><span class="ident" id="3389763">p</span><span class="op" id="3389764">.</span><span class="ident" id="3389765">parseExpr</span><span class="op" id="3389774">(</span><span class="ident" id="3389775">keyOk</span><span class="op" id="3389780">)</span><span class="op" id="3389781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389784">if</span>&nbsp;<span class="ident" id="3389787">keyOk</span>&nbsp;<span class="op" id="3389793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3389797">if</span>&nbsp;<span class="ident" id="3389800">p</span><span class="op" id="3389801">.</span><span class="ident" id="3389802">tok</span>&nbsp;<span class="op" id="3389806">==</span>&nbsp;<span class="ident" id="3389809">token</span><span class="op" id="3389814">.</span><span class="ident" id="3389815">COLON</span>&nbsp;<span class="op" id="3389821">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389826">colon</span>&nbsp;<span class="op" id="3389832">:=</span>&nbsp;<span class="ident" id="3389835">p</span><span class="op" id="3389836">.</span><span class="ident" id="3389837">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3389844">p</span><span class="op" id="3389845">.</span><span class="ident" id="3389846">next</span><span class="op" id="3389850">(</span><span class="op" id="3389851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389856">//&nbsp;Try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;key&nbsp;but&nbsp;don&#39;t&nbsp;collect&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389906">//&nbsp;as&nbsp;unresolved&nbsp;identifier&nbsp;if&nbsp;it&nbsp;fails&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3389957">//&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;(possibly&nbsp;false)&nbsp;errors&nbsp;about</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3390006">//&nbsp;undeclared&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390030">p</span><span class="op" id="3390031">.</span><span class="ident" id="3390032">tryResolve</span><span class="op" id="3390042">(</span><span class="ident" id="3390043">x</span><span class="op" id="3390044">,</span>&nbsp;<span class="builtintype" id="3390046">false</span><span class="op" id="3390051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390056">return</span>&nbsp;<span class="op" id="3390063">&amp;</span><span class="ident" id="3390064">ast</span><span class="op" id="3390067">.</span><span class="ident" id="3390068">KeyValueExpr</span><span class="op" id="3390080">{</span><span class="ident" id="3390081">Key</span><span class="op" id="3390084">:</span>&nbsp;<span class="ident" id="3390086">x</span><span class="op" id="3390087">,</span>&nbsp;<span class="ident" id="3390089">Colon</span><span class="op" id="3390094">:</span>&nbsp;<span class="ident" id="3390096">colon</span><span class="op" id="3390101">,</span>&nbsp;<span class="ident" id="3390103">Value</span><span class="op" id="3390108">:</span>&nbsp;<span class="ident" id="3390110">p</span><span class="op" id="3390111">.</span><span class="ident" id="3390112">parseElement</span><span class="op" id="3390124">(</span><span class="builtintype" id="3390125">false</span><span class="op" id="3390130">)</span><span class="op" id="3390131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390139">p</span><span class="op" id="3390140">.</span><span class="ident" id="3390141">resolve</span><span class="op" id="3390148">(</span><span class="ident" id="3390149">x</span><span class="op" id="3390150">)</span>&nbsp;<span class="comment" id="3390152">//&nbsp;not&nbsp;a&nbsp;key</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390170">return</span>&nbsp;<span class="ident" id="3390177">x</span><br>
<span class="lineno"></span><span class="op" id="3390179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1305</span><span class="keyword" id="3390182">func</span>&nbsp;<span class="op" id="3390187">(</span><span class="ident" id="3390188">p</span>&nbsp;<span class="op" id="3390190">*</span><span class="ident" id="3390191">parser</span><span class="op" id="3390197">)</span>&nbsp;<span class="ident" id="3390199">parseElementList</span><span class="op" id="3390215">(</span><span class="op" id="3390216">)</span>&nbsp;<span class="op" id="3390218">(</span><span class="ident" id="3390219">list</span>&nbsp;<span class="op" id="3390224">[</span><span class="op" id="3390225">]</span><span class="ident" id="3390226">ast</span><span class="op" id="3390229">.</span><span class="ident" id="3390230">Expr</span><span class="op" id="3390234">)</span>&nbsp;<span class="op" id="3390236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390239">if</span>&nbsp;<span class="ident" id="3390242">p</span><span class="op" id="3390243">.</span><span class="ident" id="3390244">trace</span>&nbsp;<span class="op" id="3390250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390254">defer</span>&nbsp;<span class="ident" id="3390260">un</span><span class="op" id="3390262">(</span><span class="ident" id="3390263">trace</span><span class="op" id="3390268">(</span><span class="ident" id="3390269">p</span><span class="op" id="3390270">,</span>&nbsp;<span class="string" id="3390272">&#34;ElementList&#34;</span><span class="op" id="3390285">)</span><span class="op" id="3390286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390293">for</span>&nbsp;<span class="ident" id="3390297">p</span><span class="op" id="3390298">.</span><span class="ident" id="3390299">tok</span>&nbsp;<span class="op" id="3390303">!=</span>&nbsp;<span class="ident" id="3390306">token</span><span class="op" id="3390311">.</span><span class="ident" id="3390312">RBRACE</span>&nbsp;<span class="op" id="3390319">&amp;&amp;</span>&nbsp;<span class="ident" id="3390322">p</span><span class="op" id="3390323">.</span><span class="ident" id="3390324">tok</span>&nbsp;<span class="op" id="3390328">!=</span>&nbsp;<span class="ident" id="3390331">token</span><span class="op" id="3390336">.</span><span class="ident" id="3390337">EOF</span>&nbsp;<span class="op" id="3390341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390345">list</span>&nbsp;<span class="op" id="3390350">=</span>&nbsp;<span class="builtinfunc" id="3390352">append</span><span class="op" id="3390358">(</span><span class="ident" id="3390359">list</span><span class="op" id="3390363">,</span>&nbsp;<span class="ident" id="3390365">p</span><span class="op" id="3390366">.</span><span class="ident" id="3390367">parseElement</span><span class="op" id="3390379">(</span><span class="builtintype" id="3390380">true</span><span class="op" id="3390384">)</span><span class="op" id="3390385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390389">if</span>&nbsp;<span class="op" id="3390392">!</span><span class="ident" id="3390393">p</span><span class="op" id="3390394">.</span><span class="ident" id="3390395">atComma</span><span class="op" id="3390402">(</span><span class="string" id="3390403">&#34;composite&nbsp;literal&#34;</span><span class="op" id="3390422">)</span>&nbsp;<span class="op" id="3390424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390429">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390437">}</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390441">p</span><span class="op" id="3390442">.</span><span class="ident" id="3390443">next</span><span class="op" id="3390447">(</span><span class="op" id="3390448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390455">return</span><br>
<span class="lineno"></span><span class="op" id="3390462">}</span><br>
<span class="lineno">1320</span><br>
<span class="lineno"></span><span class="keyword" id="3390465">func</span>&nbsp;<span class="op" id="3390470">(</span><span class="ident" id="3390471">p</span>&nbsp;<span class="op" id="3390473">*</span><span class="ident" id="3390474">parser</span><span class="op" id="3390480">)</span>&nbsp;<span class="ident" id="3390482">parseLiteralValue</span><span class="op" id="3390499">(</span><span class="ident" id="3390500">typ</span>&nbsp;<span class="ident" id="3390504">ast</span><span class="op" id="3390507">.</span><span class="ident" id="3390508">Expr</span><span class="op" id="3390512">)</span>&nbsp;<span class="ident" id="3390514">ast</span><span class="op" id="3390517">.</span><span class="ident" id="3390518">Expr</span>&nbsp;<span class="op" id="3390523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390526">if</span>&nbsp;<span class="ident" id="3390529">p</span><span class="op" id="3390530">.</span><span class="ident" id="3390531">trace</span>&nbsp;<span class="op" id="3390537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390541">defer</span>&nbsp;<span class="ident" id="3390547">un</span><span class="op" id="3390549">(</span><span class="ident" id="3390550">trace</span><span class="op" id="3390555">(</span><span class="ident" id="3390556">p</span><span class="op" id="3390557">,</span>&nbsp;<span class="string" id="3390559">&#34;LiteralValue&#34;</span><span class="op" id="3390573">)</span><span class="op" id="3390574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390577">}</span><br>
<span class="lineno">1325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390581">lbrace</span>&nbsp;<span class="op" id="3390588">:=</span>&nbsp;<span class="ident" id="3390591">p</span><span class="op" id="3390592">.</span><span class="ident" id="3390593">expect</span><span class="op" id="3390599">(</span><span class="ident" id="3390600">token</span><span class="op" id="3390605">.</span><span class="ident" id="3390606">LBRACE</span><span class="op" id="3390612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390615">var</span>&nbsp;<span class="ident" id="3390619">elts</span>&nbsp;<span class="op" id="3390624">[</span><span class="op" id="3390625">]</span><span class="ident" id="3390626">ast</span><span class="op" id="3390629">.</span><span class="ident" id="3390630">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390636">p</span><span class="op" id="3390637">.</span><span class="ident" id="3390638">exprLev</span><span class="op" id="3390645">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390649">if</span>&nbsp;<span class="ident" id="3390652">p</span><span class="op" id="3390653">.</span><span class="ident" id="3390654">tok</span>&nbsp;<span class="op" id="3390658">!=</span>&nbsp;<span class="ident" id="3390661">token</span><span class="op" id="3390666">.</span><span class="ident" id="3390667">RBRACE</span>&nbsp;<span class="op" id="3390674">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390678">elts</span>&nbsp;<span class="op" id="3390683">=</span>&nbsp;<span class="ident" id="3390685">p</span><span class="op" id="3390686">.</span><span class="ident" id="3390687">parseElementList</span><span class="op" id="3390703">(</span><span class="op" id="3390704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3390707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390710">p</span><span class="op" id="3390711">.</span><span class="ident" id="3390712">exprLev</span><span class="op" id="3390719">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3390723">rbrace</span>&nbsp;<span class="op" id="3390730">:=</span>&nbsp;<span class="ident" id="3390733">p</span><span class="op" id="3390734">.</span><span class="ident" id="3390735">expectClosing</span><span class="op" id="3390748">(</span><span class="ident" id="3390749">token</span><span class="op" id="3390754">.</span><span class="ident" id="3390755">RBRACE</span><span class="op" id="3390761">,</span>&nbsp;<span class="string" id="3390763">&#34;composite&nbsp;literal&#34;</span><span class="op" id="3390782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390785">return</span>&nbsp;<span class="op" id="3390792">&amp;</span><span class="ident" id="3390793">ast</span><span class="op" id="3390796">.</span><span class="ident" id="3390797">CompositeLit</span><span class="op" id="3390809">{</span><span class="ident" id="3390810">Type</span><span class="op" id="3390814">:</span>&nbsp;<span class="ident" id="3390816">typ</span><span class="op" id="3390819">,</span>&nbsp;<span class="ident" id="3390821">Lbrace</span><span class="op" id="3390827">:</span>&nbsp;<span class="ident" id="3390829">lbrace</span><span class="op" id="3390835">,</span>&nbsp;<span class="ident" id="3390837">Elts</span><span class="op" id="3390841">:</span>&nbsp;<span class="ident" id="3390843">elts</span><span class="op" id="3390847">,</span>&nbsp;<span class="ident" id="3390849">Rbrace</span><span class="op" id="3390855">:</span>&nbsp;<span class="ident" id="3390857">rbrace</span><span class="op" id="3390863">}</span><br>
<span class="lineno">1335</span><span class="op" id="3390865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3390868">//&nbsp;checkExpr&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;(and&nbsp;not&nbsp;a&nbsp;type).</span><br>
<span class="lineno"></span><span class="keyword" id="3390930">func</span>&nbsp;<span class="op" id="3390935">(</span><span class="ident" id="3390936">p</span>&nbsp;<span class="op" id="3390938">*</span><span class="ident" id="3390939">parser</span><span class="op" id="3390945">)</span>&nbsp;<span class="ident" id="3390947">checkExpr</span><span class="op" id="3390956">(</span><span class="ident" id="3390957">x</span>&nbsp;<span class="ident" id="3390959">ast</span><span class="op" id="3390962">.</span><span class="ident" id="3390963">Expr</span><span class="op" id="3390967">)</span>&nbsp;<span class="ident" id="3390969">ast</span><span class="op" id="3390972">.</span><span class="ident" id="3390973">Expr</span>&nbsp;<span class="op" id="3390978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3390981">switch</span>&nbsp;<span class="ident" id="3390988">unparen</span><span class="op" id="3390995">(</span><span class="ident" id="3390996">x</span><span class="op" id="3390997">)</span><span class="op" id="3390998">.</span><span class="op" id="3390999">(</span><span class="keyword" id="3391000">type</span><span class="op" id="3391004">)</span>&nbsp;<span class="op" id="3391006">{</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391009">case</span>&nbsp;<span class="op" id="3391014">*</span><span class="ident" id="3391015">ast</span><span class="op" id="3391018">.</span><span class="ident" id="3391019">BadExpr</span><span class="op" id="3391026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391029">case</span>&nbsp;<span class="op" id="3391034">*</span><span class="ident" id="3391035">ast</span><span class="op" id="3391038">.</span><span class="ident" id="3391039">Ident</span><span class="op" id="3391044">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391047">case</span>&nbsp;<span class="op" id="3391052">*</span><span class="ident" id="3391053">ast</span><span class="op" id="3391056">.</span><span class="ident" id="3391057">BasicLit</span><span class="op" id="3391065">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391068">case</span>&nbsp;<span class="op" id="3391073">*</span><span class="ident" id="3391074">ast</span><span class="op" id="3391077">.</span><span class="ident" id="3391078">FuncLit</span><span class="op" id="3391085">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391088">case</span>&nbsp;<span class="op" id="3391093">*</span><span class="ident" id="3391094">ast</span><span class="op" id="3391097">.</span><span class="ident" id="3391098">CompositeLit</span><span class="op" id="3391110">:</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391113">case</span>&nbsp;<span class="op" id="3391118">*</span><span class="ident" id="3391119">ast</span><span class="op" id="3391122">.</span><span class="ident" id="3391123">ParenExpr</span><span class="op" id="3391132">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3391136">panic</span><span class="op" id="3391141">(</span><span class="string" id="3391142">&#34;unreachable&#34;</span><span class="op" id="3391155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391158">case</span>&nbsp;<span class="op" id="3391163">*</span><span class="ident" id="3391164">ast</span><span class="op" id="3391167">.</span><span class="ident" id="3391168">SelectorExpr</span><span class="op" id="3391180">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391183">case</span>&nbsp;<span class="op" id="3391188">*</span><span class="ident" id="3391189">ast</span><span class="op" id="3391192">.</span><span class="ident" id="3391193">IndexExpr</span><span class="op" id="3391202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391205">case</span>&nbsp;<span class="op" id="3391210">*</span><span class="ident" id="3391211">ast</span><span class="op" id="3391214">.</span><span class="ident" id="3391215">SliceExpr</span><span class="op" id="3391224">:</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391227">case</span>&nbsp;<span class="op" id="3391232">*</span><span class="ident" id="3391233">ast</span><span class="op" id="3391236">.</span><span class="ident" id="3391237">TypeAssertExpr</span><span class="op" id="3391251">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3391255">//&nbsp;If&nbsp;t.Type&nbsp;==&nbsp;nil&nbsp;we&nbsp;have&nbsp;a&nbsp;type&nbsp;assertion&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3391314">//&nbsp;y.(type),&nbsp;which&nbsp;is&nbsp;only&nbsp;allowed&nbsp;in&nbsp;type&nbsp;switch&nbsp;expressions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3391379">//&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;exclude&nbsp;those&nbsp;but&nbsp;for&nbsp;the&nbsp;case&nbsp;where&nbsp;we&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3391444">//&nbsp;a&nbsp;type&nbsp;switch.&nbsp;Instead&nbsp;be&nbsp;lenient&nbsp;and&nbsp;test&nbsp;this&nbsp;in&nbsp;the&nbsp;type</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3391509">//&nbsp;checker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391522">case</span>&nbsp;<span class="op" id="3391527">*</span><span class="ident" id="3391528">ast</span><span class="op" id="3391531">.</span><span class="ident" id="3391532">CallExpr</span><span class="op" id="3391540">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391543">case</span>&nbsp;<span class="op" id="3391548">*</span><span class="ident" id="3391549">ast</span><span class="op" id="3391552">.</span><span class="ident" id="3391553">StarExpr</span><span class="op" id="3391561">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391564">case</span>&nbsp;<span class="op" id="3391569">*</span><span class="ident" id="3391570">ast</span><span class="op" id="3391573">.</span><span class="ident" id="3391574">UnaryExpr</span><span class="op" id="3391583">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391586">case</span>&nbsp;<span class="op" id="3391591">*</span><span class="ident" id="3391592">ast</span><span class="op" id="3391595">.</span><span class="ident" id="3391596">BinaryExpr</span><span class="op" id="3391606">:</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391609">default</span><span class="op" id="3391616">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3391620">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;proper&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391668">p</span><span class="op" id="3391669">.</span><span class="ident" id="3391670">errorExpected</span><span class="op" id="3391683">(</span><span class="ident" id="3391684">x</span><span class="op" id="3391685">.</span><span class="ident" id="3391686">Pos</span><span class="op" id="3391689">(</span><span class="op" id="3391690">)</span><span class="op" id="3391691">,</span>&nbsp;<span class="string" id="3391693">&#34;expression&#34;</span><span class="op" id="3391705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391709">x</span>&nbsp;<span class="op" id="3391711">=</span>&nbsp;<span class="op" id="3391713">&amp;</span><span class="ident" id="3391714">ast</span><span class="op" id="3391717">.</span><span class="ident" id="3391718">BadExpr</span><span class="op" id="3391725">{</span><span class="ident" id="3391726">From</span><span class="op" id="3391730">:</span>&nbsp;<span class="ident" id="3391732">x</span><span class="op" id="3391733">.</span><span class="ident" id="3391734">Pos</span><span class="op" id="3391737">(</span><span class="op" id="3391738">)</span><span class="op" id="3391739">,</span>&nbsp;<span class="ident" id="3391741">To</span><span class="op" id="3391743">:</span>&nbsp;<span class="ident" id="3391745">p</span><span class="op" id="3391746">.</span><span class="ident" id="3391747">safePos</span><span class="op" id="3391754">(</span><span class="ident" id="3391755">x</span><span class="op" id="3391756">.</span><span class="ident" id="3391757">End</span><span class="op" id="3391760">(</span><span class="op" id="3391761">)</span><span class="op" id="3391762">)</span><span class="op" id="3391763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3391766">}</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391769">return</span>&nbsp;<span class="ident" id="3391776">x</span><br>
<span class="lineno"></span><span class="op" id="3391778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3391781">//&nbsp;isTypeName&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;(qualified)&nbsp;TypeName.</span><br>
<span class="lineno"></span><span class="keyword" id="3391841">func</span>&nbsp;<span class="ident" id="3391846">isTypeName</span><span class="op" id="3391856">(</span><span class="ident" id="3391857">x</span>&nbsp;<span class="ident" id="3391859">ast</span><span class="op" id="3391862">.</span><span class="ident" id="3391863">Expr</span><span class="op" id="3391867">)</span>&nbsp;<span class="builtintype" id="3391869">bool</span>&nbsp;<span class="op" id="3391874">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391877">switch</span>&nbsp;<span class="ident" id="3391884">t</span>&nbsp;<span class="op" id="3391886">:=</span>&nbsp;<span class="ident" id="3391889">x</span><span class="op" id="3391890">.</span><span class="op" id="3391891">(</span><span class="keyword" id="3391892">type</span><span class="op" id="3391896">)</span>&nbsp;<span class="op" id="3391898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391901">case</span>&nbsp;<span class="op" id="3391906">*</span><span class="ident" id="3391907">ast</span><span class="op" id="3391910">.</span><span class="ident" id="3391911">BadExpr</span><span class="op" id="3391918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391921">case</span>&nbsp;<span class="op" id="3391926">*</span><span class="ident" id="3391927">ast</span><span class="op" id="3391930">.</span><span class="ident" id="3391931">Ident</span><span class="op" id="3391936">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391939">case</span>&nbsp;<span class="op" id="3391944">*</span><span class="ident" id="3391945">ast</span><span class="op" id="3391948">.</span><span class="ident" id="3391949">SelectorExpr</span><span class="op" id="3391961">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3391965">_</span><span class="op" id="3391966">,</span>&nbsp;<span class="ident" id="3391968">isIdent</span>&nbsp;<span class="op" id="3391976">:=</span>&nbsp;<span class="ident" id="3391979">t</span><span class="op" id="3391980">.</span><span class="ident" id="3391981">X</span><span class="op" id="3391982">.</span><span class="op" id="3391983">(</span><span class="op" id="3391984">*</span><span class="ident" id="3391985">ast</span><span class="op" id="3391988">.</span><span class="ident" id="3391989">Ident</span><span class="op" id="3391994">)</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3391998">return</span>&nbsp;<span class="ident" id="3392005">isIdent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392014">default</span><span class="op" id="3392021">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392025">return</span>&nbsp;<span class="builtintype" id="3392032">false</span>&nbsp;<span class="comment" id="3392038">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392080">return</span>&nbsp;<span class="builtintype" id="3392087">true</span><br>
<span class="lineno">1380</span><span class="op" id="3392092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3392095">//&nbsp;isLiteralType&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="3392166">func</span>&nbsp;<span class="ident" id="3392171">isLiteralType</span><span class="op" id="3392184">(</span><span class="ident" id="3392185">x</span>&nbsp;<span class="ident" id="3392187">ast</span><span class="op" id="3392190">.</span><span class="ident" id="3392191">Expr</span><span class="op" id="3392195">)</span>&nbsp;<span class="builtintype" id="3392197">bool</span>&nbsp;<span class="op" id="3392202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392205">switch</span>&nbsp;<span class="ident" id="3392212">t</span>&nbsp;<span class="op" id="3392214">:=</span>&nbsp;<span class="ident" id="3392217">x</span><span class="op" id="3392218">.</span><span class="op" id="3392219">(</span><span class="keyword" id="3392220">type</span><span class="op" id="3392224">)</span>&nbsp;<span class="op" id="3392226">{</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392229">case</span>&nbsp;<span class="op" id="3392234">*</span><span class="ident" id="3392235">ast</span><span class="op" id="3392238">.</span><span class="ident" id="3392239">BadExpr</span><span class="op" id="3392246">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392249">case</span>&nbsp;<span class="op" id="3392254">*</span><span class="ident" id="3392255">ast</span><span class="op" id="3392258">.</span><span class="ident" id="3392259">Ident</span><span class="op" id="3392264">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392267">case</span>&nbsp;<span class="op" id="3392272">*</span><span class="ident" id="3392273">ast</span><span class="op" id="3392276">.</span><span class="ident" id="3392277">SelectorExpr</span><span class="op" id="3392289">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392293">_</span><span class="op" id="3392294">,</span>&nbsp;<span class="ident" id="3392296">isIdent</span>&nbsp;<span class="op" id="3392304">:=</span>&nbsp;<span class="ident" id="3392307">t</span><span class="op" id="3392308">.</span><span class="ident" id="3392309">X</span><span class="op" id="3392310">.</span><span class="op" id="3392311">(</span><span class="op" id="3392312">*</span><span class="ident" id="3392313">ast</span><span class="op" id="3392316">.</span><span class="ident" id="3392317">Ident</span><span class="op" id="3392322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392326">return</span>&nbsp;<span class="ident" id="3392333">isIdent</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392342">case</span>&nbsp;<span class="op" id="3392347">*</span><span class="ident" id="3392348">ast</span><span class="op" id="3392351">.</span><span class="ident" id="3392352">ArrayType</span><span class="op" id="3392361">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392364">case</span>&nbsp;<span class="op" id="3392369">*</span><span class="ident" id="3392370">ast</span><span class="op" id="3392373">.</span><span class="ident" id="3392374">StructType</span><span class="op" id="3392384">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392387">case</span>&nbsp;<span class="op" id="3392392">*</span><span class="ident" id="3392393">ast</span><span class="op" id="3392396">.</span><span class="ident" id="3392397">MapType</span><span class="op" id="3392404">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392407">default</span><span class="op" id="3392414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392418">return</span>&nbsp;<span class="builtintype" id="3392425">false</span>&nbsp;<span class="comment" id="3392431">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;types</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392492">return</span>&nbsp;<span class="builtintype" id="3392499">true</span><br>
<span class="lineno"></span><span class="op" id="3392504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3392507">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;*T,&nbsp;deref&nbsp;returns&nbsp;T,&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno">1400</span><span class="keyword" id="3392575">func</span>&nbsp;<span class="ident" id="3392580">deref</span><span class="op" id="3392585">(</span><span class="ident" id="3392586">x</span>&nbsp;<span class="ident" id="3392588">ast</span><span class="op" id="3392591">.</span><span class="ident" id="3392592">Expr</span><span class="op" id="3392596">)</span>&nbsp;<span class="ident" id="3392598">ast</span><span class="op" id="3392601">.</span><span class="ident" id="3392602">Expr</span>&nbsp;<span class="op" id="3392607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392610">if</span>&nbsp;<span class="ident" id="3392613">p</span><span class="op" id="3392614">,</span>&nbsp;<span class="ident" id="3392616">isPtr</span>&nbsp;<span class="op" id="3392622">:=</span>&nbsp;<span class="ident" id="3392625">x</span><span class="op" id="3392626">.</span><span class="op" id="3392627">(</span><span class="op" id="3392628">*</span><span class="ident" id="3392629">ast</span><span class="op" id="3392632">.</span><span class="ident" id="3392633">StarExpr</span><span class="op" id="3392641">)</span><span class="op" id="3392642">;</span>&nbsp;<span class="ident" id="3392644">isPtr</span>&nbsp;<span class="op" id="3392650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392654">x</span>&nbsp;<span class="op" id="3392656">=</span>&nbsp;<span class="ident" id="3392658">p</span><span class="op" id="3392659">.</span><span class="ident" id="3392660">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392666">return</span>&nbsp;<span class="ident" id="3392673">x</span><br>
<span class="lineno">1405</span><span class="op" id="3392675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3392678">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;(T),&nbsp;unparen&nbsp;returns&nbsp;unparen(T),&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3392758">func</span>&nbsp;<span class="ident" id="3392763">unparen</span><span class="op" id="3392770">(</span><span class="ident" id="3392771">x</span>&nbsp;<span class="ident" id="3392773">ast</span><span class="op" id="3392776">.</span><span class="ident" id="3392777">Expr</span><span class="op" id="3392781">)</span>&nbsp;<span class="ident" id="3392783">ast</span><span class="op" id="3392786">.</span><span class="ident" id="3392787">Expr</span>&nbsp;<span class="op" id="3392792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392795">if</span>&nbsp;<span class="ident" id="3392798">p</span><span class="op" id="3392799">,</span>&nbsp;<span class="ident" id="3392801">isParen</span>&nbsp;<span class="op" id="3392809">:=</span>&nbsp;<span class="ident" id="3392812">x</span><span class="op" id="3392813">.</span><span class="op" id="3392814">(</span><span class="op" id="3392815">*</span><span class="ident" id="3392816">ast</span><span class="op" id="3392819">.</span><span class="ident" id="3392820">ParenExpr</span><span class="op" id="3392829">)</span><span class="op" id="3392830">;</span>&nbsp;<span class="ident" id="3392832">isParen</span>&nbsp;<span class="op" id="3392840">{</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392844">x</span>&nbsp;<span class="op" id="3392846">=</span>&nbsp;<span class="ident" id="3392848">unparen</span><span class="op" id="3392855">(</span><span class="ident" id="3392856">p</span><span class="op" id="3392857">.</span><span class="ident" id="3392858">X</span><span class="op" id="3392859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3392862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3392865">return</span>&nbsp;<span class="ident" id="3392872">x</span><br>
<span class="lineno"></span><span class="op" id="3392874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1415</span><span class="comment" id="3392877">//&nbsp;checkExprOrType&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="3392937">//&nbsp;(and&nbsp;not&nbsp;a&nbsp;raw&nbsp;type&nbsp;such&nbsp;as&nbsp;[...]T).</span><br>
<span class="lineno"></span><span class="comment" id="3392977">//</span><br>
<span class="lineno"></span><span class="keyword" id="3392980">func</span>&nbsp;<span class="op" id="3392985">(</span><span class="ident" id="3392986">p</span>&nbsp;<span class="op" id="3392988">*</span><span class="ident" id="3392989">parser</span><span class="op" id="3392995">)</span>&nbsp;<span class="ident" id="3392997">checkExprOrType</span><span class="op" id="3393012">(</span><span class="ident" id="3393013">x</span>&nbsp;<span class="ident" id="3393015">ast</span><span class="op" id="3393018">.</span><span class="ident" id="3393019">Expr</span><span class="op" id="3393023">)</span>&nbsp;<span class="ident" id="3393025">ast</span><span class="op" id="3393028">.</span><span class="ident" id="3393029">Expr</span>&nbsp;<span class="op" id="3393034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393037">switch</span>&nbsp;<span class="ident" id="3393044">t</span>&nbsp;<span class="op" id="3393046">:=</span>&nbsp;<span class="ident" id="3393049">unparen</span><span class="op" id="3393056">(</span><span class="ident" id="3393057">x</span><span class="op" id="3393058">)</span><span class="op" id="3393059">.</span><span class="op" id="3393060">(</span><span class="keyword" id="3393061">type</span><span class="op" id="3393065">)</span>&nbsp;<span class="op" id="3393067">{</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393070">case</span>&nbsp;<span class="op" id="3393075">*</span><span class="ident" id="3393076">ast</span><span class="op" id="3393079">.</span><span class="ident" id="3393080">ParenExpr</span><span class="op" id="3393089">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3393093">panic</span><span class="op" id="3393098">(</span><span class="string" id="3393099">&#34;unreachable&#34;</span><span class="op" id="3393112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393115">case</span>&nbsp;<span class="op" id="3393120">*</span><span class="ident" id="3393121">ast</span><span class="op" id="3393124">.</span><span class="ident" id="3393125">UnaryExpr</span><span class="op" id="3393134">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393137">case</span>&nbsp;<span class="op" id="3393142">*</span><span class="ident" id="3393143">ast</span><span class="op" id="3393146">.</span><span class="ident" id="3393147">ArrayType</span><span class="op" id="3393156">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393160">if</span>&nbsp;<span class="builtinfunc" id="3393163">len</span><span class="op" id="3393166">,</span>&nbsp;<span class="ident" id="3393168">isEllipsis</span>&nbsp;<span class="op" id="3393179">:=</span>&nbsp;<span class="ident" id="3393182">t</span><span class="op" id="3393183">.</span><span class="ident" id="3393184">Len</span><span class="op" id="3393187">.</span><span class="op" id="3393188">(</span><span class="op" id="3393189">*</span><span class="ident" id="3393190">ast</span><span class="op" id="3393193">.</span><span class="ident" id="3393194">Ellipsis</span><span class="op" id="3393202">)</span><span class="op" id="3393203">;</span>&nbsp;<span class="ident" id="3393205">isEllipsis</span>&nbsp;<span class="op" id="3393216">{</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393221">p</span><span class="op" id="3393222">.</span><span class="builtintype" id="3393223">error</span><span class="op" id="3393228">(</span><span class="builtinfunc" id="3393229">len</span><span class="op" id="3393232">.</span><span class="ident" id="3393233">Pos</span><span class="op" id="3393236">(</span><span class="op" id="3393237">)</span><span class="op" id="3393238">,</span>&nbsp;<span class="string" id="3393240">&#34;expected&nbsp;array&nbsp;length,&nbsp;found&nbsp;&#39;...&#39;&#34;</span><span class="op" id="3393276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393281">x</span>&nbsp;<span class="op" id="3393283">=</span>&nbsp;<span class="op" id="3393285">&amp;</span><span class="ident" id="3393286">ast</span><span class="op" id="3393289">.</span><span class="ident" id="3393290">BadExpr</span><span class="op" id="3393297">{</span><span class="ident" id="3393298">From</span><span class="op" id="3393302">:</span>&nbsp;<span class="ident" id="3393304">x</span><span class="op" id="3393305">.</span><span class="ident" id="3393306">Pos</span><span class="op" id="3393309">(</span><span class="op" id="3393310">)</span><span class="op" id="3393311">,</span>&nbsp;<span class="ident" id="3393313">To</span><span class="op" id="3393315">:</span>&nbsp;<span class="ident" id="3393317">p</span><span class="op" id="3393318">.</span><span class="ident" id="3393319">safePos</span><span class="op" id="3393326">(</span><span class="ident" id="3393327">x</span><span class="op" id="3393328">.</span><span class="ident" id="3393329">End</span><span class="op" id="3393332">(</span><span class="op" id="3393333">)</span><span class="op" id="3393334">)</span><span class="op" id="3393335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3393339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3393342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3393346">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;expressions&nbsp;or&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393391">return</span>&nbsp;<span class="ident" id="3393398">x</span><br>
<span class="lineno"></span><span class="op" id="3393400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3393403">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1435</span><span class="keyword" id="3393473">func</span>&nbsp;<span class="op" id="3393478">(</span><span class="ident" id="3393479">p</span>&nbsp;<span class="op" id="3393481">*</span><span class="ident" id="3393482">parser</span><span class="op" id="3393488">)</span>&nbsp;<span class="ident" id="3393490">parsePrimaryExpr</span><span class="op" id="3393506">(</span><span class="ident" id="3393507">lhs</span>&nbsp;<span class="builtintype" id="3393511">bool</span><span class="op" id="3393515">)</span>&nbsp;<span class="ident" id="3393517">ast</span><span class="op" id="3393520">.</span><span class="ident" id="3393521">Expr</span>&nbsp;<span class="op" id="3393526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393529">if</span>&nbsp;<span class="ident" id="3393532">p</span><span class="op" id="3393533">.</span><span class="ident" id="3393534">trace</span>&nbsp;<span class="op" id="3393540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393544">defer</span>&nbsp;<span class="ident" id="3393550">un</span><span class="op" id="3393552">(</span><span class="ident" id="3393553">trace</span><span class="op" id="3393558">(</span><span class="ident" id="3393559">p</span><span class="op" id="3393560">,</span>&nbsp;<span class="string" id="3393562">&#34;PrimaryExpr&#34;</span><span class="op" id="3393575">)</span><span class="op" id="3393576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3393579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393583">x</span>&nbsp;<span class="op" id="3393585">:=</span>&nbsp;<span class="ident" id="3393588">p</span><span class="op" id="3393589">.</span><span class="ident" id="3393590">parseOperand</span><span class="op" id="3393602">(</span><span class="ident" id="3393603">lhs</span><span class="op" id="3393606">)</span><br>
<span class="lineno"></span><span class="ident" id="3393608">L</span><span class="op" id="3393609">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393612">for</span>&nbsp;<span class="op" id="3393616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393620">switch</span>&nbsp;<span class="ident" id="3393627">p</span><span class="op" id="3393628">.</span><span class="ident" id="3393629">tok</span>&nbsp;<span class="op" id="3393633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393637">case</span>&nbsp;<span class="ident" id="3393642">token</span><span class="op" id="3393647">.</span><span class="ident" id="3393648">PERIOD</span><span class="op" id="3393654">:</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393659">p</span><span class="op" id="3393660">.</span><span class="ident" id="3393661">next</span><span class="op" id="3393665">(</span><span class="op" id="3393666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393671">if</span>&nbsp;<span class="ident" id="3393674">lhs</span>&nbsp;<span class="op" id="3393678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393684">p</span><span class="op" id="3393685">.</span><span class="ident" id="3393686">resolve</span><span class="op" id="3393693">(</span><span class="ident" id="3393694">x</span><span class="op" id="3393695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3393700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393705">switch</span>&nbsp;<span class="ident" id="3393712">p</span><span class="op" id="3393713">.</span><span class="ident" id="3393714">tok</span>&nbsp;<span class="op" id="3393718">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393723">case</span>&nbsp;<span class="ident" id="3393728">token</span><span class="op" id="3393733">.</span><span class="ident" id="3393734">IDENT</span><span class="op" id="3393739">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393745">x</span>&nbsp;<span class="op" id="3393747">=</span>&nbsp;<span class="ident" id="3393749">p</span><span class="op" id="3393750">.</span><span class="ident" id="3393751">parseSelector</span><span class="op" id="3393764">(</span><span class="ident" id="3393765">p</span><span class="op" id="3393766">.</span><span class="ident" id="3393767">checkExprOrType</span><span class="op" id="3393782">(</span><span class="ident" id="3393783">x</span><span class="op" id="3393784">)</span><span class="op" id="3393785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393790">case</span>&nbsp;<span class="ident" id="3393795">token</span><span class="op" id="3393800">.</span><span class="ident" id="3393801">LPAREN</span><span class="op" id="3393807">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393813">x</span>&nbsp;<span class="op" id="3393815">=</span>&nbsp;<span class="ident" id="3393817">p</span><span class="op" id="3393818">.</span><span class="ident" id="3393819">parseTypeAssertion</span><span class="op" id="3393837">(</span><span class="ident" id="3393838">p</span><span class="op" id="3393839">.</span><span class="ident" id="3393840">checkExpr</span><span class="op" id="3393849">(</span><span class="ident" id="3393850">x</span><span class="op" id="3393851">)</span><span class="op" id="3393852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3393857">default</span><span class="op" id="3393864">:</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393870">pos</span>&nbsp;<span class="op" id="3393874">:=</span>&nbsp;<span class="ident" id="3393877">p</span><span class="op" id="3393878">.</span><span class="ident" id="3393879">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393887">p</span><span class="op" id="3393888">.</span><span class="ident" id="3393889">errorExpected</span><span class="op" id="3393902">(</span><span class="ident" id="3393903">pos</span><span class="op" id="3393906">,</span>&nbsp;<span class="string" id="3393908">&#34;selector&nbsp;or&nbsp;type&nbsp;assertion&#34;</span><span class="op" id="3393936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393942">p</span><span class="op" id="3393943">.</span><span class="ident" id="3393944">next</span><span class="op" id="3393948">(</span><span class="op" id="3393949">)</span>&nbsp;<span class="comment" id="3393951">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393972">x</span>&nbsp;<span class="op" id="3393974">=</span>&nbsp;<span class="op" id="3393976">&amp;</span><span class="ident" id="3393977">ast</span><span class="op" id="3393980">.</span><span class="ident" id="3393981">BadExpr</span><span class="op" id="3393988">{</span><span class="ident" id="3393989">From</span><span class="op" id="3393993">:</span>&nbsp;<span class="ident" id="3393995">pos</span><span class="op" id="3393998">,</span>&nbsp;<span class="ident" id="3394000">To</span><span class="op" id="3394002">:</span>&nbsp;<span class="ident" id="3394004">p</span><span class="op" id="3394005">.</span><span class="ident" id="3394006">pos</span><span class="op" id="3394009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3394014">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394018">case</span>&nbsp;<span class="ident" id="3394023">token</span><span class="op" id="3394028">.</span><span class="ident" id="3394029">LBRACK</span><span class="op" id="3394035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394040">if</span>&nbsp;<span class="ident" id="3394043">lhs</span>&nbsp;<span class="op" id="3394047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394053">p</span><span class="op" id="3394054">.</span><span class="ident" id="3394055">resolve</span><span class="op" id="3394062">(</span><span class="ident" id="3394063">x</span><span class="op" id="3394064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3394069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394074">x</span>&nbsp;<span class="op" id="3394076">=</span>&nbsp;<span class="ident" id="3394078">p</span><span class="op" id="3394079">.</span><span class="ident" id="3394080">parseIndexOrSlice</span><span class="op" id="3394097">(</span><span class="ident" id="3394098">p</span><span class="op" id="3394099">.</span><span class="ident" id="3394100">checkExpr</span><span class="op" id="3394109">(</span><span class="ident" id="3394110">x</span><span class="op" id="3394111">)</span><span class="op" id="3394112">)</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394116">case</span>&nbsp;<span class="ident" id="3394121">token</span><span class="op" id="3394126">.</span><span class="ident" id="3394127">LPAREN</span><span class="op" id="3394133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394138">if</span>&nbsp;<span class="ident" id="3394141">lhs</span>&nbsp;<span class="op" id="3394145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394151">p</span><span class="op" id="3394152">.</span><span class="ident" id="3394153">resolve</span><span class="op" id="3394160">(</span><span class="ident" id="3394161">x</span><span class="op" id="3394162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3394167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394172">x</span>&nbsp;<span class="op" id="3394174">=</span>&nbsp;<span class="ident" id="3394176">p</span><span class="op" id="3394177">.</span><span class="ident" id="3394178">parseCallOrConversion</span><span class="op" id="3394199">(</span><span class="ident" id="3394200">p</span><span class="op" id="3394201">.</span><span class="ident" id="3394202">checkExprOrType</span><span class="op" id="3394217">(</span><span class="ident" id="3394218">x</span><span class="op" id="3394219">)</span><span class="op" id="3394220">)</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394224">case</span>&nbsp;<span class="ident" id="3394229">token</span><span class="op" id="3394234">.</span><span class="ident" id="3394235">LBRACE</span><span class="op" id="3394241">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394246">if</span>&nbsp;<span class="ident" id="3394249">isLiteralType</span><span class="op" id="3394262">(</span><span class="ident" id="3394263">x</span><span class="op" id="3394264">)</span>&nbsp;<span class="op" id="3394266">&amp;&amp;</span>&nbsp;<span class="op" id="3394269">(</span><span class="ident" id="3394270">p</span><span class="op" id="3394271">.</span><span class="ident" id="3394272">exprLev</span>&nbsp;<span class="op" id="3394280">&gt;=</span>&nbsp;<span class="num" id="3394283">0</span>&nbsp;<span class="op" id="3394285">||</span>&nbsp;<span class="op" id="3394288">!</span><span class="ident" id="3394289">isTypeName</span><span class="op" id="3394299">(</span><span class="ident" id="3394300">x</span><span class="op" id="3394301">)</span><span class="op" id="3394302">)</span>&nbsp;<span class="op" id="3394304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394310">if</span>&nbsp;<span class="ident" id="3394313">lhs</span>&nbsp;<span class="op" id="3394317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394324">p</span><span class="op" id="3394325">.</span><span class="ident" id="3394326">resolve</span><span class="op" id="3394333">(</span><span class="ident" id="3394334">x</span><span class="op" id="3394335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3394341">}</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394347">x</span>&nbsp;<span class="op" id="3394349">=</span>&nbsp;<span class="ident" id="3394351">p</span><span class="op" id="3394352">.</span><span class="ident" id="3394353">parseLiteralValue</span><span class="op" id="3394370">(</span><span class="ident" id="3394371">x</span><span class="op" id="3394372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3394377">}</span>&nbsp;<span class="keyword" id="3394379">else</span>&nbsp;<span class="op" id="3394384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394390">break</span>&nbsp;<span class="ident" id="3394396">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3394401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394405">default</span><span class="op" id="3394412">:</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394417">break</span>&nbsp;<span class="ident" id="3394423">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3394427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394431">lhs</span>&nbsp;<span class="op" id="3394435">=</span>&nbsp;<span class="builtintype" id="3394437">false</span>&nbsp;<span class="comment" id="3394443">//&nbsp;no&nbsp;need&nbsp;to&nbsp;try&nbsp;to&nbsp;resolve&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3394479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394483">return</span>&nbsp;<span class="ident" id="3394490">x</span><br>
<span class="lineno"></span><span class="op" id="3394492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3394495">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="3394565">func</span>&nbsp;<span class="op" id="3394570">(</span><span class="ident" id="3394571">p</span>&nbsp;<span class="op" id="3394573">*</span><span class="ident" id="3394574">parser</span><span class="op" id="3394580">)</span>&nbsp;<span class="ident" id="3394582">parseUnaryExpr</span><span class="op" id="3394596">(</span><span class="ident" id="3394597">lhs</span>&nbsp;<span class="builtintype" id="3394601">bool</span><span class="op" id="3394605">)</span>&nbsp;<span class="ident" id="3394607">ast</span><span class="op" id="3394610">.</span><span class="ident" id="3394611">Expr</span>&nbsp;<span class="op" id="3394616">{</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394619">if</span>&nbsp;<span class="ident" id="3394622">p</span><span class="op" id="3394623">.</span><span class="ident" id="3394624">trace</span>&nbsp;<span class="op" id="3394630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394634">defer</span>&nbsp;<span class="ident" id="3394640">un</span><span class="op" id="3394642">(</span><span class="ident" id="3394643">trace</span><span class="op" id="3394648">(</span><span class="ident" id="3394649">p</span><span class="op" id="3394650">,</span>&nbsp;<span class="string" id="3394652">&#34;UnaryExpr&#34;</span><span class="op" id="3394663">)</span><span class="op" id="3394664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3394667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394671">switch</span>&nbsp;<span class="ident" id="3394678">p</span><span class="op" id="3394679">.</span><span class="ident" id="3394680">tok</span>&nbsp;<span class="op" id="3394684">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394687">case</span>&nbsp;<span class="ident" id="3394692">token</span><span class="op" id="3394697">.</span><span class="ident" id="3394698">ADD</span><span class="op" id="3394701">,</span>&nbsp;<span class="ident" id="3394703">token</span><span class="op" id="3394708">.</span><span class="ident" id="3394709">SUB</span><span class="op" id="3394712">,</span>&nbsp;<span class="ident" id="3394714">token</span><span class="op" id="3394719">.</span><span class="ident" id="3394720">NOT</span><span class="op" id="3394723">,</span>&nbsp;<span class="ident" id="3394725">token</span><span class="op" id="3394730">.</span><span class="ident" id="3394731">XOR</span><span class="op" id="3394734">,</span>&nbsp;<span class="ident" id="3394736">token</span><span class="op" id="3394741">.</span><span class="ident" id="3394742">AND</span><span class="op" id="3394745">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394749">pos</span><span class="op" id="3394752">,</span>&nbsp;<span class="ident" id="3394754">op</span>&nbsp;<span class="op" id="3394757">:=</span>&nbsp;<span class="ident" id="3394760">p</span><span class="op" id="3394761">.</span><span class="ident" id="3394762">pos</span><span class="op" id="3394765">,</span>&nbsp;<span class="ident" id="3394767">p</span><span class="op" id="3394768">.</span><span class="ident" id="3394769">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394775">p</span><span class="op" id="3394776">.</span><span class="ident" id="3394777">next</span><span class="op" id="3394781">(</span><span class="op" id="3394782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394786">x</span>&nbsp;<span class="op" id="3394788">:=</span>&nbsp;<span class="ident" id="3394791">p</span><span class="op" id="3394792">.</span><span class="ident" id="3394793">parseUnaryExpr</span><span class="op" id="3394807">(</span><span class="builtintype" id="3394808">false</span><span class="op" id="3394813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394817">return</span>&nbsp;<span class="op" id="3394824">&amp;</span><span class="ident" id="3394825">ast</span><span class="op" id="3394828">.</span><span class="ident" id="3394829">UnaryExpr</span><span class="op" id="3394838">{</span><span class="ident" id="3394839">OpPos</span><span class="op" id="3394844">:</span>&nbsp;<span class="ident" id="3394846">pos</span><span class="op" id="3394849">,</span>&nbsp;<span class="ident" id="3394851">Op</span><span class="op" id="3394853">:</span>&nbsp;<span class="ident" id="3394855">op</span><span class="op" id="3394857">,</span>&nbsp;<span class="ident" id="3394859">X</span><span class="op" id="3394860">:</span>&nbsp;<span class="ident" id="3394862">p</span><span class="op" id="3394863">.</span><span class="ident" id="3394864">checkExpr</span><span class="op" id="3394873">(</span><span class="ident" id="3394874">x</span><span class="op" id="3394875">)</span><span class="op" id="3394876">}</span><br>
<span class="lineno">1500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394880">case</span>&nbsp;<span class="ident" id="3394885">token</span><span class="op" id="3394890">.</span><span class="ident" id="3394891">ARROW</span><span class="op" id="3394896">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3394900">//&nbsp;channel&nbsp;type&nbsp;or&nbsp;receive&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394940">arrow</span>&nbsp;<span class="op" id="3394946">:=</span>&nbsp;<span class="ident" id="3394949">p</span><span class="op" id="3394950">.</span><span class="ident" id="3394951">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394957">p</span><span class="op" id="3394958">.</span><span class="ident" id="3394959">next</span><span class="op" id="3394963">(</span><span class="op" id="3394964">)</span><br>
<span class="lineno">1505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3394969">//&nbsp;If&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;token.CHAN&nbsp;we&nbsp;still&nbsp;don&#39;t&nbsp;know&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395032">//&nbsp;is&nbsp;a&nbsp;channel&nbsp;type&nbsp;or&nbsp;a&nbsp;receive&nbsp;operation&nbsp;-&nbsp;we&nbsp;only&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395093">//&nbsp;once&nbsp;we&nbsp;have&nbsp;found&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;unary&nbsp;expression.&nbsp;There</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395156">//&nbsp;are&nbsp;two&nbsp;cases:</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395176">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395181">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;type&nbsp;&nbsp;=&gt;&nbsp;(&lt;-type)&nbsp;must&nbsp;be&nbsp;channel&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395230">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;expr&nbsp;&nbsp;=&gt;&nbsp;&lt;-(expr)&nbsp;is&nbsp;a&nbsp;receive&nbsp;from&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395290">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395295">//&nbsp;In&nbsp;the&nbsp;first&nbsp;case,&nbsp;the&nbsp;arrow&nbsp;must&nbsp;be&nbsp;re-associated&nbsp;with</span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395356">//&nbsp;the&nbsp;channel&nbsp;type&nbsp;parsed&nbsp;already:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395394">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395399">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&nbsp;type)&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395442">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&lt;-&nbsp;type)&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;(&lt;-type))</span><br>
<span class="lineno"></span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395490">x</span>&nbsp;<span class="op" id="3395492">:=</span>&nbsp;<span class="ident" id="3395495">p</span><span class="op" id="3395496">.</span><span class="ident" id="3395497">parseUnaryExpr</span><span class="op" id="3395511">(</span><span class="builtintype" id="3395512">false</span><span class="op" id="3395517">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395522">//&nbsp;determine&nbsp;which&nbsp;case&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395556">if</span>&nbsp;<span class="ident" id="3395559">typ</span><span class="op" id="3395562">,</span>&nbsp;<span class="ident" id="3395564">ok</span>&nbsp;<span class="op" id="3395567">:=</span>&nbsp;<span class="ident" id="3395570">x</span><span class="op" id="3395571">.</span><span class="op" id="3395572">(</span><span class="op" id="3395573">*</span><span class="ident" id="3395574">ast</span><span class="op" id="3395577">.</span><span class="ident" id="3395578">ChanType</span><span class="op" id="3395586">)</span><span class="op" id="3395587">;</span>&nbsp;<span class="ident" id="3395589">ok</span>&nbsp;<span class="op" id="3395592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395597">//&nbsp;(&lt;-type)</span><br>
<span class="lineno">1525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395613">//&nbsp;re-associate&nbsp;position&nbsp;info&nbsp;and&nbsp;&lt;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395653">dir</span>&nbsp;<span class="op" id="3395657">:=</span>&nbsp;<span class="ident" id="3395660">ast</span><span class="op" id="3395663">.</span><span class="ident" id="3395664">SEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395672">for</span>&nbsp;<span class="ident" id="3395676">ok</span>&nbsp;<span class="op" id="3395679">&amp;&amp;</span>&nbsp;<span class="ident" id="3395682">dir</span>&nbsp;<span class="op" id="3395686">==</span>&nbsp;<span class="ident" id="3395689">ast</span><span class="op" id="3395692">.</span><span class="ident" id="3395693">SEND</span>&nbsp;<span class="op" id="3395698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395704">if</span>&nbsp;<span class="ident" id="3395707">typ</span><span class="op" id="3395710">.</span><span class="ident" id="3395711">Dir</span>&nbsp;<span class="op" id="3395715">==</span>&nbsp;<span class="ident" id="3395718">ast</span><span class="op" id="3395721">.</span><span class="ident" id="3395722">RECV</span>&nbsp;<span class="op" id="3395727">{</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395734">//&nbsp;error:&nbsp;(&lt;-type)&nbsp;is&nbsp;(&lt;-(&lt;-chan&nbsp;T))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395776">p</span><span class="op" id="3395777">.</span><span class="ident" id="3395778">errorExpected</span><span class="op" id="3395791">(</span><span class="ident" id="3395792">typ</span><span class="op" id="3395795">.</span><span class="ident" id="3395796">Arrow</span><span class="op" id="3395801">,</span>&nbsp;<span class="string" id="3395803">&#34;&#39;chan&#39;&#34;</span><span class="op" id="3395811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3395817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395823">arrow</span><span class="op" id="3395828">,</span>&nbsp;<span class="ident" id="3395830">typ</span><span class="op" id="3395833">.</span><span class="ident" id="3395834">Begin</span><span class="op" id="3395839">,</span>&nbsp;<span class="ident" id="3395841">typ</span><span class="op" id="3395844">.</span><span class="ident" id="3395845">Arrow</span>&nbsp;<span class="op" id="3395851">=</span>&nbsp;<span class="ident" id="3395853">typ</span><span class="op" id="3395856">.</span><span class="ident" id="3395857">Arrow</span><span class="op" id="3395862">,</span>&nbsp;<span class="ident" id="3395864">arrow</span><span class="op" id="3395869">,</span>&nbsp;<span class="ident" id="3395871">arrow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395881">dir</span><span class="op" id="3395884">,</span>&nbsp;<span class="ident" id="3395886">typ</span><span class="op" id="3395889">.</span><span class="ident" id="3395890">Dir</span>&nbsp;<span class="op" id="3395894">=</span>&nbsp;<span class="ident" id="3395896">typ</span><span class="op" id="3395899">.</span><span class="ident" id="3395900">Dir</span><span class="op" id="3395903">,</span>&nbsp;<span class="ident" id="3395905">ast</span><span class="op" id="3395908">.</span><span class="ident" id="3395909">RECV</span><br>
<span class="lineno">1535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395918">typ</span><span class="op" id="3395921">,</span>&nbsp;<span class="ident" id="3395923">ok</span>&nbsp;<span class="op" id="3395926">=</span>&nbsp;<span class="ident" id="3395928">typ</span><span class="op" id="3395931">.</span><span class="ident" id="3395932">Value</span><span class="op" id="3395937">.</span><span class="op" id="3395938">(</span><span class="op" id="3395939">*</span><span class="ident" id="3395940">ast</span><span class="op" id="3395943">.</span><span class="ident" id="3395944">ChanType</span><span class="op" id="3395952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3395957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395962">if</span>&nbsp;<span class="ident" id="3395965">dir</span>&nbsp;<span class="op" id="3395969">==</span>&nbsp;<span class="ident" id="3395972">ast</span><span class="op" id="3395975">.</span><span class="ident" id="3395976">SEND</span>&nbsp;<span class="op" id="3395981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395987">p</span><span class="op" id="3395988">.</span><span class="ident" id="3395989">errorExpected</span><span class="op" id="3396002">(</span><span class="ident" id="3396003">arrow</span><span class="op" id="3396008">,</span>&nbsp;<span class="string" id="3396010">&#34;channel&nbsp;type&#34;</span><span class="op" id="3396024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3396029">}</span><br>
<span class="lineno">1540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396035">return</span>&nbsp;<span class="ident" id="3396042">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3396046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3396051">//&nbsp;&lt;-(expr)</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396065">return</span>&nbsp;<span class="op" id="3396072">&amp;</span><span class="ident" id="3396073">ast</span><span class="op" id="3396076">.</span><span class="ident" id="3396077">UnaryExpr</span><span class="op" id="3396086">{</span><span class="ident" id="3396087">OpPos</span><span class="op" id="3396092">:</span>&nbsp;<span class="ident" id="3396094">arrow</span><span class="op" id="3396099">,</span>&nbsp;<span class="ident" id="3396101">Op</span><span class="op" id="3396103">:</span>&nbsp;<span class="ident" id="3396105">token</span><span class="op" id="3396110">.</span><span class="ident" id="3396111">ARROW</span><span class="op" id="3396116">,</span>&nbsp;<span class="ident" id="3396118">X</span><span class="op" id="3396119">:</span>&nbsp;<span class="ident" id="3396121">p</span><span class="op" id="3396122">.</span><span class="ident" id="3396123">checkExpr</span><span class="op" id="3396132">(</span><span class="ident" id="3396133">x</span><span class="op" id="3396134">)</span><span class="op" id="3396135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396139">case</span>&nbsp;<span class="ident" id="3396144">token</span><span class="op" id="3396149">.</span><span class="ident" id="3396150">MUL</span><span class="op" id="3396153">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3396157">//&nbsp;pointer&nbsp;type&nbsp;or&nbsp;unary&nbsp;&#34;*&#34;&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396199">pos</span>&nbsp;<span class="op" id="3396203">:=</span>&nbsp;<span class="ident" id="3396206">p</span><span class="op" id="3396207">.</span><span class="ident" id="3396208">pos</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396214">p</span><span class="op" id="3396215">.</span><span class="ident" id="3396216">next</span><span class="op" id="3396220">(</span><span class="op" id="3396221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396225">x</span>&nbsp;<span class="op" id="3396227">:=</span>&nbsp;<span class="ident" id="3396230">p</span><span class="op" id="3396231">.</span><span class="ident" id="3396232">parseUnaryExpr</span><span class="op" id="3396246">(</span><span class="builtintype" id="3396247">false</span><span class="op" id="3396252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396256">return</span>&nbsp;<span class="op" id="3396263">&amp;</span><span class="ident" id="3396264">ast</span><span class="op" id="3396267">.</span><span class="ident" id="3396268">StarExpr</span><span class="op" id="3396276">{</span><span class="ident" id="3396277">Star</span><span class="op" id="3396281">:</span>&nbsp;<span class="ident" id="3396283">pos</span><span class="op" id="3396286">,</span>&nbsp;<span class="ident" id="3396288">X</span><span class="op" id="3396289">:</span>&nbsp;<span class="ident" id="3396291">p</span><span class="op" id="3396292">.</span><span class="ident" id="3396293">checkExprOrType</span><span class="op" id="3396308">(</span><span class="ident" id="3396309">x</span><span class="op" id="3396310">)</span><span class="op" id="3396311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3396314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396318">return</span>&nbsp;<span class="ident" id="3396325">p</span><span class="op" id="3396326">.</span><span class="ident" id="3396327">parsePrimaryExpr</span><span class="op" id="3396343">(</span><span class="ident" id="3396344">lhs</span><span class="op" id="3396347">)</span><br>
<span class="lineno"></span><span class="op" id="3396349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3396352">func</span>&nbsp;<span class="op" id="3396357">(</span><span class="ident" id="3396358">p</span>&nbsp;<span class="op" id="3396360">*</span><span class="ident" id="3396361">parser</span><span class="op" id="3396367">)</span>&nbsp;<span class="ident" id="3396369">tokPrec</span><span class="op" id="3396376">(</span><span class="op" id="3396377">)</span>&nbsp;<span class="op" id="3396379">(</span><span class="ident" id="3396380">token</span><span class="op" id="3396385">.</span><span class="ident" id="3396386">Token</span><span class="op" id="3396391">,</span>&nbsp;<span class="builtintype" id="3396393">int</span><span class="op" id="3396396">)</span>&nbsp;<span class="op" id="3396398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396401">tok</span>&nbsp;<span class="op" id="3396405">:=</span>&nbsp;<span class="ident" id="3396408">p</span><span class="op" id="3396409">.</span><span class="ident" id="3396410">tok</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396415">if</span>&nbsp;<span class="ident" id="3396418">p</span><span class="op" id="3396419">.</span><span class="ident" id="3396420">inRhs</span>&nbsp;<span class="op" id="3396426">&amp;&amp;</span>&nbsp;<span class="ident" id="3396429">tok</span>&nbsp;<span class="op" id="3396433">==</span>&nbsp;<span class="ident" id="3396436">token</span><span class="op" id="3396441">.</span><span class="ident" id="3396442">ASSIGN</span>&nbsp;<span class="op" id="3396449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396453">tok</span>&nbsp;<span class="op" id="3396457">=</span>&nbsp;<span class="ident" id="3396459">token</span><span class="op" id="3396464">.</span><span class="ident" id="3396465">EQL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3396470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396473">return</span>&nbsp;<span class="ident" id="3396480">tok</span><span class="op" id="3396483">,</span>&nbsp;<span class="ident" id="3396485">tok</span><span class="op" id="3396488">.</span><span class="ident" id="3396489">Precedence</span><span class="op" id="3396499">(</span><span class="op" id="3396500">)</span><br>
<span class="lineno"></span><span class="op" id="3396502">}</span><br>
<span class="lineno">1565</span><br>
<span class="lineno"></span><span class="comment" id="3396505">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="3396575">func</span>&nbsp;<span class="op" id="3396580">(</span><span class="ident" id="3396581">p</span>&nbsp;<span class="op" id="3396583">*</span><span class="ident" id="3396584">parser</span><span class="op" id="3396590">)</span>&nbsp;<span class="ident" id="3396592">parseBinaryExpr</span><span class="op" id="3396607">(</span><span class="ident" id="3396608">lhs</span>&nbsp;<span class="builtintype" id="3396612">bool</span><span class="op" id="3396616">,</span>&nbsp;<span class="ident" id="3396618">prec1</span>&nbsp;<span class="builtintype" id="3396624">int</span><span class="op" id="3396627">)</span>&nbsp;<span class="ident" id="3396629">ast</span><span class="op" id="3396632">.</span><span class="ident" id="3396633">Expr</span>&nbsp;<span class="op" id="3396638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396641">if</span>&nbsp;<span class="ident" id="3396644">p</span><span class="op" id="3396645">.</span><span class="ident" id="3396646">trace</span>&nbsp;<span class="op" id="3396652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396656">defer</span>&nbsp;<span class="ident" id="3396662">un</span><span class="op" id="3396664">(</span><span class="ident" id="3396665">trace</span><span class="op" id="3396670">(</span><span class="ident" id="3396671">p</span><span class="op" id="3396672">,</span>&nbsp;<span class="string" id="3396674">&#34;BinaryExpr&#34;</span><span class="op" id="3396686">)</span><span class="op" id="3396687">)</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3396690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396694">x</span>&nbsp;<span class="op" id="3396696">:=</span>&nbsp;<span class="ident" id="3396699">p</span><span class="op" id="3396700">.</span><span class="ident" id="3396701">parseUnaryExpr</span><span class="op" id="3396715">(</span><span class="ident" id="3396716">lhs</span><span class="op" id="3396719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396722">for</span>&nbsp;<span class="ident" id="3396726">_</span><span class="op" id="3396727">,</span>&nbsp;<span class="ident" id="3396729">prec</span>&nbsp;<span class="op" id="3396734">:=</span>&nbsp;<span class="ident" id="3396737">p</span><span class="op" id="3396738">.</span><span class="ident" id="3396739">tokPrec</span><span class="op" id="3396746">(</span><span class="op" id="3396747">)</span><span class="op" id="3396748">;</span>&nbsp;<span class="ident" id="3396750">prec</span>&nbsp;<span class="op" id="3396755">&gt;=</span>&nbsp;<span class="ident" id="3396758">prec1</span><span class="op" id="3396763">;</span>&nbsp;<span class="ident" id="3396765">prec</span><span class="op" id="3396769">--</span>&nbsp;<span class="op" id="3396772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396776">for</span>&nbsp;<span class="op" id="3396780">{</span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396785">op</span><span class="op" id="3396787">,</span>&nbsp;<span class="ident" id="3396789">oprec</span>&nbsp;<span class="op" id="3396795">:=</span>&nbsp;<span class="ident" id="3396798">p</span><span class="op" id="3396799">.</span><span class="ident" id="3396800">tokPrec</span><span class="op" id="3396807">(</span><span class="op" id="3396808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396813">if</span>&nbsp;<span class="ident" id="3396816">oprec</span>&nbsp;<span class="op" id="3396822">!=</span>&nbsp;<span class="ident" id="3396825">prec</span>&nbsp;<span class="op" id="3396830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396836">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3396845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396850">pos</span>&nbsp;<span class="op" id="3396854">:=</span>&nbsp;<span class="ident" id="3396857">p</span><span class="op" id="3396858">.</span><span class="ident" id="3396859">expect</span><span class="op" id="3396865">(</span><span class="ident" id="3396866">op</span><span class="op" id="3396868">)</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396873">if</span>&nbsp;<span class="ident" id="3396876">lhs</span>&nbsp;<span class="op" id="3396880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396886">p</span><span class="op" id="3396887">.</span><span class="ident" id="3396888">resolve</span><span class="op" id="3396895">(</span><span class="ident" id="3396896">x</span><span class="op" id="3396897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396903">lhs</span>&nbsp;<span class="op" id="3396907">=</span>&nbsp;<span class="builtintype" id="3396909">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3396918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396923">y</span>&nbsp;<span class="op" id="3396925">:=</span>&nbsp;<span class="ident" id="3396928">p</span><span class="op" id="3396929">.</span><span class="ident" id="3396930">parseBinaryExpr</span><span class="op" id="3396945">(</span><span class="builtintype" id="3396946">false</span><span class="op" id="3396951">,</span>&nbsp;<span class="ident" id="3396953">prec</span><span class="op" id="3396957">+</span><span class="num" id="3396958">1</span><span class="op" id="3396959">)</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396964">x</span>&nbsp;<span class="op" id="3396966">=</span>&nbsp;<span class="op" id="3396968">&amp;</span><span class="ident" id="3396969">ast</span><span class="op" id="3396972">.</span><span class="ident" id="3396973">BinaryExpr</span><span class="op" id="3396983">{</span><span class="ident" id="3396984">X</span><span class="op" id="3396985">:</span>&nbsp;<span class="ident" id="3396987">p</span><span class="op" id="3396988">.</span><span class="ident" id="3396989">checkExpr</span><span class="op" id="3396998">(</span><span class="ident" id="3396999">x</span><span class="op" id="3397000">)</span><span class="op" id="3397001">,</span>&nbsp;<span class="ident" id="3397003">OpPos</span><span class="op" id="3397008">:</span>&nbsp;<span class="ident" id="3397010">pos</span><span class="op" id="3397013">,</span>&nbsp;<span class="ident" id="3397015">Op</span><span class="op" id="3397017">:</span>&nbsp;<span class="ident" id="3397019">op</span><span class="op" id="3397021">,</span>&nbsp;<span class="ident" id="3397023">Y</span><span class="op" id="3397024">:</span>&nbsp;<span class="ident" id="3397026">p</span><span class="op" id="3397027">.</span><span class="ident" id="3397028">checkExpr</span><span class="op" id="3397037">(</span><span class="ident" id="3397038">y</span><span class="op" id="3397039">)</span><span class="op" id="3397040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3397044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3397047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397051">return</span>&nbsp;<span class="ident" id="3397058">x</span><br>
<span class="lineno">1590</span><span class="op" id="3397060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3397063">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="comment" id="3397133">//&nbsp;The&nbsp;result&nbsp;may&nbsp;be&nbsp;a&nbsp;type&nbsp;or&nbsp;even&nbsp;a&nbsp;raw&nbsp;type&nbsp;([...]int).&nbsp;Callers&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="3397205">//&nbsp;check&nbsp;the&nbsp;result&nbsp;(using&nbsp;checkExpr&nbsp;or&nbsp;checkExprOrType),&nbsp;depending&nbsp;on</span><br>
<span class="lineno">1595</span><span class="comment" id="3397276">//&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="3397288">func</span>&nbsp;<span class="op" id="3397293">(</span><span class="ident" id="3397294">p</span>&nbsp;<span class="op" id="3397296">*</span><span class="ident" id="3397297">parser</span><span class="op" id="3397303">)</span>&nbsp;<span class="ident" id="3397305">parseExpr</span><span class="op" id="3397314">(</span><span class="ident" id="3397315">lhs</span>&nbsp;<span class="builtintype" id="3397319">bool</span><span class="op" id="3397323">)</span>&nbsp;<span class="ident" id="3397325">ast</span><span class="op" id="3397328">.</span><span class="ident" id="3397329">Expr</span>&nbsp;<span class="op" id="3397334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397337">if</span>&nbsp;<span class="ident" id="3397340">p</span><span class="op" id="3397341">.</span><span class="ident" id="3397342">trace</span>&nbsp;<span class="op" id="3397348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397352">defer</span>&nbsp;<span class="ident" id="3397358">un</span><span class="op" id="3397360">(</span><span class="ident" id="3397361">trace</span><span class="op" id="3397366">(</span><span class="ident" id="3397367">p</span><span class="op" id="3397368">,</span>&nbsp;<span class="string" id="3397370">&#34;Expression&#34;</span><span class="op" id="3397382">)</span><span class="op" id="3397383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3397386">}</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397390">return</span>&nbsp;<span class="ident" id="3397397">p</span><span class="op" id="3397398">.</span><span class="ident" id="3397399">parseBinaryExpr</span><span class="op" id="3397414">(</span><span class="ident" id="3397415">lhs</span><span class="op" id="3397418">,</span>&nbsp;<span class="ident" id="3397420">token</span><span class="op" id="3397425">.</span><span class="ident" id="3397426">LowestPrec</span><span class="op" id="3397436">+</span><span class="num" id="3397437">1</span><span class="op" id="3397438">)</span><br>
<span class="lineno"></span><span class="op" id="3397440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3397443">func</span>&nbsp;<span class="op" id="3397448">(</span><span class="ident" id="3397449">p</span>&nbsp;<span class="op" id="3397451">*</span><span class="ident" id="3397452">parser</span><span class="op" id="3397458">)</span>&nbsp;<span class="ident" id="3397460">parseRhs</span><span class="op" id="3397468">(</span><span class="op" id="3397469">)</span>&nbsp;<span class="ident" id="3397471">ast</span><span class="op" id="3397474">.</span><span class="ident" id="3397475">Expr</span>&nbsp;<span class="op" id="3397480">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397483">old</span>&nbsp;<span class="op" id="3397487">:=</span>&nbsp;<span class="ident" id="3397490">p</span><span class="op" id="3397491">.</span><span class="ident" id="3397492">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397499">p</span><span class="op" id="3397500">.</span><span class="ident" id="3397501">inRhs</span>&nbsp;<span class="op" id="3397507">=</span>&nbsp;<span class="builtintype" id="3397509">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397515">x</span>&nbsp;<span class="op" id="3397517">:=</span>&nbsp;<span class="ident" id="3397520">p</span><span class="op" id="3397521">.</span><span class="ident" id="3397522">checkExpr</span><span class="op" id="3397531">(</span><span class="ident" id="3397532">p</span><span class="op" id="3397533">.</span><span class="ident" id="3397534">parseExpr</span><span class="op" id="3397543">(</span><span class="builtintype" id="3397544">false</span><span class="op" id="3397549">)</span><span class="op" id="3397550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397553">p</span><span class="op" id="3397554">.</span><span class="ident" id="3397555">inRhs</span>&nbsp;<span class="op" id="3397561">=</span>&nbsp;<span class="ident" id="3397563">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397568">return</span>&nbsp;<span class="ident" id="3397575">x</span><br>
<span class="lineno">1610</span><span class="op" id="3397577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3397580">func</span>&nbsp;<span class="op" id="3397585">(</span><span class="ident" id="3397586">p</span>&nbsp;<span class="op" id="3397588">*</span><span class="ident" id="3397589">parser</span><span class="op" id="3397595">)</span>&nbsp;<span class="ident" id="3397597">parseRhsOrType</span><span class="op" id="3397611">(</span><span class="op" id="3397612">)</span>&nbsp;<span class="ident" id="3397614">ast</span><span class="op" id="3397617">.</span><span class="ident" id="3397618">Expr</span>&nbsp;<span class="op" id="3397623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397626">old</span>&nbsp;<span class="op" id="3397630">:=</span>&nbsp;<span class="ident" id="3397633">p</span><span class="op" id="3397634">.</span><span class="ident" id="3397635">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397642">p</span><span class="op" id="3397643">.</span><span class="ident" id="3397644">inRhs</span>&nbsp;<span class="op" id="3397650">=</span>&nbsp;<span class="builtintype" id="3397652">true</span><br>
<span class="lineno">1615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397658">x</span>&nbsp;<span class="op" id="3397660">:=</span>&nbsp;<span class="ident" id="3397663">p</span><span class="op" id="3397664">.</span><span class="ident" id="3397665">checkExprOrType</span><span class="op" id="3397680">(</span><span class="ident" id="3397681">p</span><span class="op" id="3397682">.</span><span class="ident" id="3397683">parseExpr</span><span class="op" id="3397692">(</span><span class="builtintype" id="3397693">false</span><span class="op" id="3397698">)</span><span class="op" id="3397699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397702">p</span><span class="op" id="3397703">.</span><span class="ident" id="3397704">inRhs</span>&nbsp;<span class="op" id="3397710">=</span>&nbsp;<span class="ident" id="3397712">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397717">return</span>&nbsp;<span class="ident" id="3397724">x</span><br>
<span class="lineno"></span><span class="op" id="3397726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1620</span><span class="comment" id="3397729">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3397809">//&nbsp;Statements</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3397824">//&nbsp;Parsing&nbsp;modes&nbsp;for&nbsp;parseSimpleStmt.</span><br>
<span class="lineno"></span><span class="keyword" id="3397862">const</span>&nbsp;<span class="op" id="3397868">(</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397871">basic</span>&nbsp;<span class="op" id="3397877">=</span>&nbsp;<span class="ident" id="3397879">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397885">labelOk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397894">rangeOk</span><br>
<span class="lineno"></span><span class="op" id="3397902">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1630</span><span class="comment" id="3397905">//&nbsp;parseSimpleStmt&nbsp;returns&nbsp;true&nbsp;as&nbsp;2nd&nbsp;result&nbsp;if&nbsp;it&nbsp;parsed&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span><span class="comment" id="3397979">//&nbsp;of&nbsp;a&nbsp;range&nbsp;clause&nbsp;(with&nbsp;mode&nbsp;==&nbsp;rangeOk).&nbsp;The&nbsp;returned&nbsp;statement&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3398053">//&nbsp;assignment&nbsp;with&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3398127">//&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;.&nbsp;No&nbsp;guarantees&nbsp;are&nbsp;given&nbsp;for&nbsp;the&nbsp;left-hand&nbsp;side.</span><br>
<span class="lineno"></span><span class="keyword" id="3398198">func</span>&nbsp;<span class="op" id="3398203">(</span><span class="ident" id="3398204">p</span>&nbsp;<span class="op" id="3398206">*</span><span class="ident" id="3398207">parser</span><span class="op" id="3398213">)</span>&nbsp;<span class="ident" id="3398215">parseSimpleStmt</span><span class="op" id="3398230">(</span><span class="ident" id="3398231">mode</span>&nbsp;<span class="builtintype" id="3398236">int</span><span class="op" id="3398239">)</span>&nbsp;<span class="op" id="3398241">(</span><span class="ident" id="3398242">ast</span><span class="op" id="3398245">.</span><span class="ident" id="3398246">Stmt</span><span class="op" id="3398250">,</span>&nbsp;<span class="builtintype" id="3398252">bool</span><span class="op" id="3398256">)</span>&nbsp;<span class="op" id="3398258">{</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398261">if</span>&nbsp;<span class="ident" id="3398264">p</span><span class="op" id="3398265">.</span><span class="ident" id="3398266">trace</span>&nbsp;<span class="op" id="3398272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398276">defer</span>&nbsp;<span class="ident" id="3398282">un</span><span class="op" id="3398284">(</span><span class="ident" id="3398285">trace</span><span class="op" id="3398290">(</span><span class="ident" id="3398291">p</span><span class="op" id="3398292">,</span>&nbsp;<span class="string" id="3398294">&#34;SimpleStmt&#34;</span><span class="op" id="3398306">)</span><span class="op" id="3398307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398314">x</span>&nbsp;<span class="op" id="3398316">:=</span>&nbsp;<span class="ident" id="3398319">p</span><span class="op" id="3398320">.</span><span class="ident" id="3398321">parseLhsList</span><span class="op" id="3398333">(</span><span class="op" id="3398334">)</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398338">switch</span>&nbsp;<span class="ident" id="3398345">p</span><span class="op" id="3398346">.</span><span class="ident" id="3398347">tok</span>&nbsp;<span class="op" id="3398351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398354">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398361">token</span><span class="op" id="3398366">.</span><span class="ident" id="3398367">DEFINE</span><span class="op" id="3398373">,</span>&nbsp;<span class="ident" id="3398375">token</span><span class="op" id="3398380">.</span><span class="ident" id="3398381">ASSIGN</span><span class="op" id="3398387">,</span>&nbsp;<span class="ident" id="3398389">token</span><span class="op" id="3398394">.</span><span class="ident" id="3398395">ADD_ASSIGN</span><span class="op" id="3398405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398409">token</span><span class="op" id="3398414">.</span><span class="ident" id="3398415">SUB_ASSIGN</span><span class="op" id="3398425">,</span>&nbsp;<span class="ident" id="3398427">token</span><span class="op" id="3398432">.</span><span class="ident" id="3398433">MUL_ASSIGN</span><span class="op" id="3398443">,</span>&nbsp;<span class="ident" id="3398445">token</span><span class="op" id="3398450">.</span><span class="ident" id="3398451">QUO_ASSIGN</span><span class="op" id="3398461">,</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398465">token</span><span class="op" id="3398470">.</span><span class="ident" id="3398471">REM_ASSIGN</span><span class="op" id="3398481">,</span>&nbsp;<span class="ident" id="3398483">token</span><span class="op" id="3398488">.</span><span class="ident" id="3398489">AND_ASSIGN</span><span class="op" id="3398499">,</span>&nbsp;<span class="ident" id="3398501">token</span><span class="op" id="3398506">.</span><span class="ident" id="3398507">OR_ASSIGN</span><span class="op" id="3398516">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398520">token</span><span class="op" id="3398525">.</span><span class="ident" id="3398526">XOR_ASSIGN</span><span class="op" id="3398536">,</span>&nbsp;<span class="ident" id="3398538">token</span><span class="op" id="3398543">.</span><span class="ident" id="3398544">SHL_ASSIGN</span><span class="op" id="3398554">,</span>&nbsp;<span class="ident" id="3398556">token</span><span class="op" id="3398561">.</span><span class="ident" id="3398562">SHR_ASSIGN</span><span class="op" id="3398572">,</span>&nbsp;<span class="ident" id="3398574">token</span><span class="op" id="3398579">.</span><span class="ident" id="3398580">AND_NOT_ASSIGN</span><span class="op" id="3398594">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3398598">//&nbsp;assignment&nbsp;statement,&nbsp;possibly&nbsp;part&nbsp;of&nbsp;a&nbsp;range&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398657">pos</span><span class="op" id="3398660">,</span>&nbsp;<span class="ident" id="3398662">tok</span>&nbsp;<span class="op" id="3398666">:=</span>&nbsp;<span class="ident" id="3398669">p</span><span class="op" id="3398670">.</span><span class="ident" id="3398671">pos</span><span class="op" id="3398674">,</span>&nbsp;<span class="ident" id="3398676">p</span><span class="op" id="3398677">.</span><span class="ident" id="3398678">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398684">p</span><span class="op" id="3398685">.</span><span class="ident" id="3398686">next</span><span class="op" id="3398690">(</span><span class="op" id="3398691">)</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398695">var</span>&nbsp;<span class="ident" id="3398699">y</span>&nbsp;<span class="op" id="3398701">[</span><span class="op" id="3398702">]</span><span class="ident" id="3398703">ast</span><span class="op" id="3398706">.</span><span class="ident" id="3398707">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398714">isRange</span>&nbsp;<span class="op" id="3398722">:=</span>&nbsp;<span class="builtintype" id="3398725">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398733">if</span>&nbsp;<span class="ident" id="3398736">mode</span>&nbsp;<span class="op" id="3398741">==</span>&nbsp;<span class="ident" id="3398744">rangeOk</span>&nbsp;<span class="op" id="3398752">&amp;&amp;</span>&nbsp;<span class="ident" id="3398755">p</span><span class="op" id="3398756">.</span><span class="ident" id="3398757">tok</span>&nbsp;<span class="op" id="3398761">==</span>&nbsp;<span class="ident" id="3398764">token</span><span class="op" id="3398769">.</span><span class="ident" id="3398770">RANGE</span>&nbsp;<span class="op" id="3398776">&amp;&amp;</span>&nbsp;<span class="op" id="3398779">(</span><span class="ident" id="3398780">tok</span>&nbsp;<span class="op" id="3398784">==</span>&nbsp;<span class="ident" id="3398787">token</span><span class="op" id="3398792">.</span><span class="ident" id="3398793">DEFINE</span>&nbsp;<span class="op" id="3398800">||</span>&nbsp;<span class="ident" id="3398803">tok</span>&nbsp;<span class="op" id="3398807">==</span>&nbsp;<span class="ident" id="3398810">token</span><span class="op" id="3398815">.</span><span class="ident" id="3398816">ASSIGN</span><span class="op" id="3398822">)</span>&nbsp;<span class="op" id="3398824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398829">pos</span>&nbsp;<span class="op" id="3398833">:=</span>&nbsp;<span class="ident" id="3398836">p</span><span class="op" id="3398837">.</span><span class="ident" id="3398838">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398845">p</span><span class="op" id="3398846">.</span><span class="ident" id="3398847">next</span><span class="op" id="3398851">(</span><span class="op" id="3398852">)</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398857">y</span>&nbsp;<span class="op" id="3398859">=</span>&nbsp;<span class="op" id="3398861">[</span><span class="op" id="3398862">]</span><span class="ident" id="3398863">ast</span><span class="op" id="3398866">.</span><span class="ident" id="3398867">Expr</span><span class="op" id="3398871">{</span><span class="op" id="3398872">&amp;</span><span class="ident" id="3398873">ast</span><span class="op" id="3398876">.</span><span class="ident" id="3398877">UnaryExpr</span><span class="op" id="3398886">{</span><span class="ident" id="3398887">OpPos</span><span class="op" id="3398892">:</span>&nbsp;<span class="ident" id="3398894">pos</span><span class="op" id="3398897">,</span>&nbsp;<span class="ident" id="3398899">Op</span><span class="op" id="3398901">:</span>&nbsp;<span class="ident" id="3398903">token</span><span class="op" id="3398908">.</span><span class="ident" id="3398909">RANGE</span><span class="op" id="3398914">,</span>&nbsp;<span class="ident" id="3398916">X</span><span class="op" id="3398917">:</span>&nbsp;<span class="ident" id="3398919">p</span><span class="op" id="3398920">.</span><span class="ident" id="3398921">parseRhs</span><span class="op" id="3398929">(</span><span class="op" id="3398930">)</span><span class="op" id="3398931">}</span><span class="op" id="3398932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398937">isRange</span>&nbsp;<span class="op" id="3398945">=</span>&nbsp;<span class="builtintype" id="3398947">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398954">}</span>&nbsp;<span class="keyword" id="3398956">else</span>&nbsp;<span class="op" id="3398961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398966">y</span>&nbsp;<span class="op" id="3398968">=</span>&nbsp;<span class="ident" id="3398970">p</span><span class="op" id="3398971">.</span><span class="ident" id="3398972">parseRhsList</span><span class="op" id="3398984">(</span><span class="op" id="3398985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398989">}</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398993">as</span>&nbsp;<span class="op" id="3398996">:=</span>&nbsp;<span class="op" id="3398999">&amp;</span><span class="ident" id="3399000">ast</span><span class="op" id="3399003">.</span><span class="ident" id="3399004">AssignStmt</span><span class="op" id="3399014">{</span><span class="ident" id="3399015">Lhs</span><span class="op" id="3399018">:</span>&nbsp;<span class="ident" id="3399020">x</span><span class="op" id="3399021">,</span>&nbsp;<span class="ident" id="3399023">TokPos</span><span class="op" id="3399029">:</span>&nbsp;<span class="ident" id="3399031">pos</span><span class="op" id="3399034">,</span>&nbsp;<span class="ident" id="3399036">Tok</span><span class="op" id="3399039">:</span>&nbsp;<span class="ident" id="3399041">tok</span><span class="op" id="3399044">,</span>&nbsp;<span class="ident" id="3399046">Rhs</span><span class="op" id="3399049">:</span>&nbsp;<span class="ident" id="3399051">y</span><span class="op" id="3399052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399056">if</span>&nbsp;<span class="ident" id="3399059">tok</span>&nbsp;<span class="op" id="3399063">==</span>&nbsp;<span class="ident" id="3399066">token</span><span class="op" id="3399071">.</span><span class="ident" id="3399072">DEFINE</span>&nbsp;<span class="op" id="3399079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399084">p</span><span class="op" id="3399085">.</span><span class="ident" id="3399086">shortVarDecl</span><span class="op" id="3399098">(</span><span class="ident" id="3399099">as</span><span class="op" id="3399101">,</span>&nbsp;<span class="ident" id="3399103">x</span><span class="op" id="3399104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399112">return</span>&nbsp;<span class="ident" id="3399119">as</span><span class="op" id="3399121">,</span>&nbsp;<span class="ident" id="3399123">isRange</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399136">if</span>&nbsp;<span class="builtinfunc" id="3399139">len</span><span class="op" id="3399142">(</span><span class="ident" id="3399143">x</span><span class="op" id="3399144">)</span>&nbsp;<span class="op" id="3399146">&gt;</span>&nbsp;<span class="num" id="3399148">1</span>&nbsp;<span class="op" id="3399150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399154">p</span><span class="op" id="3399155">.</span><span class="ident" id="3399156">errorExpected</span><span class="op" id="3399169">(</span><span class="ident" id="3399170">x</span><span class="op" id="3399171">[</span><span class="num" id="3399172">0</span><span class="op" id="3399173">]</span><span class="op" id="3399174">.</span><span class="ident" id="3399175">Pos</span><span class="op" id="3399178">(</span><span class="op" id="3399179">)</span><span class="op" id="3399180">,</span>&nbsp;<span class="string" id="3399182">&#34;1&nbsp;expression&#34;</span><span class="op" id="3399196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3399200">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399239">switch</span>&nbsp;<span class="ident" id="3399246">p</span><span class="op" id="3399247">.</span><span class="ident" id="3399248">tok</span>&nbsp;<span class="op" id="3399252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399255">case</span>&nbsp;<span class="ident" id="3399260">token</span><span class="op" id="3399265">.</span><span class="ident" id="3399266">COLON</span><span class="op" id="3399271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3399275">//&nbsp;labeled&nbsp;statement</span><br>
<span class="lineno">1675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399298">colon</span>&nbsp;<span class="op" id="3399304">:=</span>&nbsp;<span class="ident" id="3399307">p</span><span class="op" id="3399308">.</span><span class="ident" id="3399309">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399315">p</span><span class="op" id="3399316">.</span><span class="ident" id="3399317">next</span><span class="op" id="3399321">(</span><span class="op" id="3399322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399326">if</span>&nbsp;<span class="ident" id="3399329">label</span><span class="op" id="3399334">,</span>&nbsp;<span class="ident" id="3399336">isIdent</span>&nbsp;<span class="op" id="3399344">:=</span>&nbsp;<span class="ident" id="3399347">x</span><span class="op" id="3399348">[</span><span class="num" id="3399349">0</span><span class="op" id="3399350">]</span><span class="op" id="3399351">.</span><span class="op" id="3399352">(</span><span class="op" id="3399353">*</span><span class="ident" id="3399354">ast</span><span class="op" id="3399357">.</span><span class="ident" id="3399358">Ident</span><span class="op" id="3399363">)</span><span class="op" id="3399364">;</span>&nbsp;<span class="ident" id="3399366">mode</span>&nbsp;<span class="op" id="3399371">==</span>&nbsp;<span class="ident" id="3399374">labelOk</span>&nbsp;<span class="op" id="3399382">&amp;&amp;</span>&nbsp;<span class="ident" id="3399385">isIdent</span>&nbsp;<span class="op" id="3399393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3399398">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;label&nbsp;is&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3399462">//&nbsp;in&nbsp;which&nbsp;it&nbsp;is&nbsp;declared&nbsp;and&nbsp;excludes&nbsp;the&nbsp;body&nbsp;of&nbsp;any&nbsp;nested</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3399528">//&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399544">stmt</span>&nbsp;<span class="op" id="3399549">:=</span>&nbsp;<span class="op" id="3399552">&amp;</span><span class="ident" id="3399553">ast</span><span class="op" id="3399556">.</span><span class="ident" id="3399557">LabeledStmt</span><span class="op" id="3399568">{</span><span class="ident" id="3399569">Label</span><span class="op" id="3399574">:</span>&nbsp;<span class="ident" id="3399576">label</span><span class="op" id="3399581">,</span>&nbsp;<span class="ident" id="3399583">Colon</span><span class="op" id="3399588">:</span>&nbsp;<span class="ident" id="3399590">colon</span><span class="op" id="3399595">,</span>&nbsp;<span class="ident" id="3399597">Stmt</span><span class="op" id="3399601">:</span>&nbsp;<span class="ident" id="3399603">p</span><span class="op" id="3399604">.</span><span class="ident" id="3399605">parseStmt</span><span class="op" id="3399614">(</span><span class="op" id="3399615">)</span><span class="op" id="3399616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399621">p</span><span class="op" id="3399622">.</span><span class="ident" id="3399623">declare</span><span class="op" id="3399630">(</span><span class="ident" id="3399631">stmt</span><span class="op" id="3399635">,</span>&nbsp;<span class="ident" id="3399637">nil</span><span class="op" id="3399640">,</span>&nbsp;<span class="ident" id="3399642">p</span><span class="op" id="3399643">.</span><span class="ident" id="3399644">labelScope</span><span class="op" id="3399654">,</span>&nbsp;<span class="ident" id="3399656">ast</span><span class="op" id="3399659">.</span><span class="ident" id="3399660">Lbl</span><span class="op" id="3399663">,</span>&nbsp;<span class="ident" id="3399665">label</span><span class="op" id="3399670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399675">return</span>&nbsp;<span class="ident" id="3399682">stmt</span><span class="op" id="3399686">,</span>&nbsp;<span class="builtintype" id="3399688">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399696">}</span><br>
<span class="lineno">1685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3399700">//&nbsp;The&nbsp;label&nbsp;declaration&nbsp;typically&nbsp;starts&nbsp;at&nbsp;x[0].Pos(),&nbsp;but&nbsp;the&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3399773">//&nbsp;declaration&nbsp;may&nbsp;be&nbsp;erroneous&nbsp;due&nbsp;to&nbsp;a&nbsp;token&nbsp;after&nbsp;that&nbsp;position&nbsp;(and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3399847">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;).&nbsp;If&nbsp;SpuriousErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;the&nbsp;(only)&nbsp;error&nbsp;re-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3399920">//&nbsp;ported&nbsp;for&nbsp;the&nbsp;line&nbsp;is&nbsp;the&nbsp;illegal&nbsp;label&nbsp;error&nbsp;instead&nbsp;of&nbsp;the&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3399993">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;&nbsp;that&nbsp;caused&nbsp;the&nbsp;problem.&nbsp;Thus,&nbsp;use&nbsp;the&nbsp;(latest)&nbsp;colon</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3400067">//&nbsp;position&nbsp;for&nbsp;error&nbsp;reporting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400102">p</span><span class="op" id="3400103">.</span><span class="builtintype" id="3400104">error</span><span class="op" id="3400109">(</span><span class="ident" id="3400110">colon</span><span class="op" id="3400115">,</span>&nbsp;<span class="string" id="3400117">&#34;illegal&nbsp;label&nbsp;declaration&#34;</span><span class="op" id="3400144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400148">return</span>&nbsp;<span class="op" id="3400155">&amp;</span><span class="ident" id="3400156">ast</span><span class="op" id="3400159">.</span><span class="ident" id="3400160">BadStmt</span><span class="op" id="3400167">{</span><span class="ident" id="3400168">From</span><span class="op" id="3400172">:</span>&nbsp;<span class="ident" id="3400174">x</span><span class="op" id="3400175">[</span><span class="num" id="3400176">0</span><span class="op" id="3400177">]</span><span class="op" id="3400178">.</span><span class="ident" id="3400179">Pos</span><span class="op" id="3400182">(</span><span class="op" id="3400183">)</span><span class="op" id="3400184">,</span>&nbsp;<span class="ident" id="3400186">To</span><span class="op" id="3400188">:</span>&nbsp;<span class="ident" id="3400190">colon</span>&nbsp;<span class="op" id="3400196">+</span>&nbsp;<span class="num" id="3400198">1</span><span class="op" id="3400199">}</span><span class="op" id="3400200">,</span>&nbsp;<span class="builtintype" id="3400202">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400210">case</span>&nbsp;<span class="ident" id="3400215">token</span><span class="op" id="3400220">.</span><span class="ident" id="3400221">ARROW</span><span class="op" id="3400226">:</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3400230">//&nbsp;send&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400250">arrow</span>&nbsp;<span class="op" id="3400256">:=</span>&nbsp;<span class="ident" id="3400259">p</span><span class="op" id="3400260">.</span><span class="ident" id="3400261">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400267">p</span><span class="op" id="3400268">.</span><span class="ident" id="3400269">next</span><span class="op" id="3400273">(</span><span class="op" id="3400274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400278">y</span>&nbsp;<span class="op" id="3400280">:=</span>&nbsp;<span class="ident" id="3400283">p</span><span class="op" id="3400284">.</span><span class="ident" id="3400285">parseRhs</span><span class="op" id="3400293">(</span><span class="op" id="3400294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400298">return</span>&nbsp;<span class="op" id="3400305">&amp;</span><span class="ident" id="3400306">ast</span><span class="op" id="3400309">.</span><span class="ident" id="3400310">SendStmt</span><span class="op" id="3400318">{</span><span class="ident" id="3400319">Chan</span><span class="op" id="3400323">:</span>&nbsp;<span class="ident" id="3400325">x</span><span class="op" id="3400326">[</span><span class="num" id="3400327">0</span><span class="op" id="3400328">]</span><span class="op" id="3400329">,</span>&nbsp;<span class="ident" id="3400331">Arrow</span><span class="op" id="3400336">:</span>&nbsp;<span class="ident" id="3400338">arrow</span><span class="op" id="3400343">,</span>&nbsp;<span class="ident" id="3400345">Value</span><span class="op" id="3400350">:</span>&nbsp;<span class="ident" id="3400352">y</span><span class="op" id="3400353">}</span><span class="op" id="3400354">,</span>&nbsp;<span class="builtintype" id="3400356">false</span><br>
<span class="lineno">1700</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400364">case</span>&nbsp;<span class="ident" id="3400369">token</span><span class="op" id="3400374">.</span><span class="ident" id="3400375">INC</span><span class="op" id="3400378">,</span>&nbsp;<span class="ident" id="3400380">token</span><span class="op" id="3400385">.</span><span class="ident" id="3400386">DEC</span><span class="op" id="3400389">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3400393">//&nbsp;increment&nbsp;or&nbsp;decrement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400421">s</span>&nbsp;<span class="op" id="3400423">:=</span>&nbsp;<span class="op" id="3400426">&amp;</span><span class="ident" id="3400427">ast</span><span class="op" id="3400430">.</span><span class="ident" id="3400431">IncDecStmt</span><span class="op" id="3400441">{</span><span class="ident" id="3400442">X</span><span class="op" id="3400443">:</span>&nbsp;<span class="ident" id="3400445">x</span><span class="op" id="3400446">[</span><span class="num" id="3400447">0</span><span class="op" id="3400448">]</span><span class="op" id="3400449">,</span>&nbsp;<span class="ident" id="3400451">TokPos</span><span class="op" id="3400457">:</span>&nbsp;<span class="ident" id="3400459">p</span><span class="op" id="3400460">.</span><span class="ident" id="3400461">pos</span><span class="op" id="3400464">,</span>&nbsp;<span class="ident" id="3400466">Tok</span><span class="op" id="3400469">:</span>&nbsp;<span class="ident" id="3400471">p</span><span class="op" id="3400472">.</span><span class="ident" id="3400473">tok</span><span class="op" id="3400476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400480">p</span><span class="op" id="3400481">.</span><span class="ident" id="3400482">next</span><span class="op" id="3400486">(</span><span class="op" id="3400487">)</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400491">return</span>&nbsp;<span class="ident" id="3400498">s</span><span class="op" id="3400499">,</span>&nbsp;<span class="builtintype" id="3400501">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3400508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3400512">//&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400527">return</span>&nbsp;<span class="op" id="3400534">&amp;</span><span class="ident" id="3400535">ast</span><span class="op" id="3400538">.</span><span class="ident" id="3400539">ExprStmt</span><span class="op" id="3400547">{</span><span class="ident" id="3400548">X</span><span class="op" id="3400549">:</span>&nbsp;<span class="ident" id="3400551">x</span><span class="op" id="3400552">[</span><span class="num" id="3400553">0</span><span class="op" id="3400554">]</span><span class="op" id="3400555">}</span><span class="op" id="3400556">,</span>&nbsp;<span class="builtintype" id="3400558">false</span><br>
<span class="lineno">1710</span><span class="op" id="3400564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3400567">func</span>&nbsp;<span class="op" id="3400572">(</span><span class="ident" id="3400573">p</span>&nbsp;<span class="op" id="3400575">*</span><span class="ident" id="3400576">parser</span><span class="op" id="3400582">)</span>&nbsp;<span class="ident" id="3400584">parseCallExpr</span><span class="op" id="3400597">(</span><span class="ident" id="3400598">callType</span>&nbsp;<span class="builtintype" id="3400607">string</span><span class="op" id="3400613">)</span>&nbsp;<span class="op" id="3400615">*</span><span class="ident" id="3400616">ast</span><span class="op" id="3400619">.</span><span class="ident" id="3400620">CallExpr</span>&nbsp;<span class="op" id="3400629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400632">x</span>&nbsp;<span class="op" id="3400634">:=</span>&nbsp;<span class="ident" id="3400637">p</span><span class="op" id="3400638">.</span><span class="ident" id="3400639">parseRhsOrType</span><span class="op" id="3400653">(</span><span class="op" id="3400654">)</span>&nbsp;<span class="comment" id="3400656">//&nbsp;could&nbsp;be&nbsp;a&nbsp;conversion:&nbsp;(some&nbsp;type)(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400698">if</span>&nbsp;<span class="ident" id="3400701">call</span><span class="op" id="3400705">,</span>&nbsp;<span class="ident" id="3400707">isCall</span>&nbsp;<span class="op" id="3400714">:=</span>&nbsp;<span class="ident" id="3400717">x</span><span class="op" id="3400718">.</span><span class="op" id="3400719">(</span><span class="op" id="3400720">*</span><span class="ident" id="3400721">ast</span><span class="op" id="3400724">.</span><span class="ident" id="3400725">CallExpr</span><span class="op" id="3400733">)</span><span class="op" id="3400734">;</span>&nbsp;<span class="ident" id="3400736">isCall</span>&nbsp;<span class="op" id="3400743">{</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400747">return</span>&nbsp;<span class="ident" id="3400754">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3400760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400763">if</span>&nbsp;<span class="ident" id="3400766">_</span><span class="op" id="3400767">,</span>&nbsp;<span class="ident" id="3400769">isBad</span>&nbsp;<span class="op" id="3400775">:=</span>&nbsp;<span class="ident" id="3400778">x</span><span class="op" id="3400779">.</span><span class="op" id="3400780">(</span><span class="op" id="3400781">*</span><span class="ident" id="3400782">ast</span><span class="op" id="3400785">.</span><span class="ident" id="3400786">BadExpr</span><span class="op" id="3400793">)</span><span class="op" id="3400794">;</span>&nbsp;<span class="op" id="3400796">!</span><span class="ident" id="3400797">isBad</span>&nbsp;<span class="op" id="3400803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3400807">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400848">p</span><span class="op" id="3400849">.</span><span class="builtintype" id="3400850">error</span><span class="op" id="3400855">(</span><span class="ident" id="3400856">p</span><span class="op" id="3400857">.</span><span class="ident" id="3400858">safePos</span><span class="op" id="3400865">(</span><span class="ident" id="3400866">x</span><span class="op" id="3400867">.</span><span class="ident" id="3400868">End</span><span class="op" id="3400871">(</span><span class="op" id="3400872">)</span><span class="op" id="3400873">)</span><span class="op" id="3400874">,</span>&nbsp;<span class="ident" id="3400876">fmt</span><span class="op" id="3400879">.</span><span class="ident" id="3400880">Sprintf</span><span class="op" id="3400887">(</span><span class="string" id="3400888">&#34;function&nbsp;must&nbsp;be&nbsp;invoked&nbsp;in&nbsp;%s&nbsp;statement&#34;</span><span class="op" id="3400930">,</span>&nbsp;<span class="ident" id="3400932">callType</span><span class="op" id="3400940">)</span><span class="op" id="3400941">)</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3400944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400947">return</span>&nbsp;<span class="ident" id="3400954">nil</span><br>
<span class="lineno"></span><span class="op" id="3400958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3400961">func</span>&nbsp;<span class="op" id="3400966">(</span><span class="ident" id="3400967">p</span>&nbsp;<span class="op" id="3400969">*</span><span class="ident" id="3400970">parser</span><span class="op" id="3400976">)</span>&nbsp;<span class="ident" id="3400978">parseGoStmt</span><span class="op" id="3400989">(</span><span class="op" id="3400990">)</span>&nbsp;<span class="ident" id="3400992">ast</span><span class="op" id="3400995">.</span><span class="ident" id="3400996">Stmt</span>&nbsp;<span class="op" id="3401001">{</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401004">if</span>&nbsp;<span class="ident" id="3401007">p</span><span class="op" id="3401008">.</span><span class="ident" id="3401009">trace</span>&nbsp;<span class="op" id="3401015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401019">defer</span>&nbsp;<span class="ident" id="3401025">un</span><span class="op" id="3401027">(</span><span class="ident" id="3401028">trace</span><span class="op" id="3401033">(</span><span class="ident" id="3401034">p</span><span class="op" id="3401035">,</span>&nbsp;<span class="string" id="3401037">&#34;GoStmt&#34;</span><span class="op" id="3401045">)</span><span class="op" id="3401046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3401049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401053">pos</span>&nbsp;<span class="op" id="3401057">:=</span>&nbsp;<span class="ident" id="3401060">p</span><span class="op" id="3401061">.</span><span class="ident" id="3401062">expect</span><span class="op" id="3401068">(</span><span class="ident" id="3401069">token</span><span class="op" id="3401074">.</span><span class="ident" id="3401075">GO</span><span class="op" id="3401077">)</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401080">call</span>&nbsp;<span class="op" id="3401085">:=</span>&nbsp;<span class="ident" id="3401088">p</span><span class="op" id="3401089">.</span><span class="ident" id="3401090">parseCallExpr</span><span class="op" id="3401103">(</span><span class="string" id="3401104">&#34;go&#34;</span><span class="op" id="3401108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401111">p</span><span class="op" id="3401112">.</span><span class="ident" id="3401113">expectSemi</span><span class="op" id="3401123">(</span><span class="op" id="3401124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401127">if</span>&nbsp;<span class="ident" id="3401130">call</span>&nbsp;<span class="op" id="3401135">==</span>&nbsp;<span class="ident" id="3401138">nil</span>&nbsp;<span class="op" id="3401142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401146">return</span>&nbsp;<span class="op" id="3401153">&amp;</span><span class="ident" id="3401154">ast</span><span class="op" id="3401157">.</span><span class="ident" id="3401158">BadStmt</span><span class="op" id="3401165">{</span><span class="ident" id="3401166">From</span><span class="op" id="3401170">:</span>&nbsp;<span class="ident" id="3401172">pos</span><span class="op" id="3401175">,</span>&nbsp;<span class="ident" id="3401177">To</span><span class="op" id="3401179">:</span>&nbsp;<span class="ident" id="3401181">pos</span>&nbsp;<span class="op" id="3401185">+</span>&nbsp;<span class="num" id="3401187">2</span><span class="op" id="3401188">}</span>&nbsp;<span class="comment" id="3401190">//&nbsp;len(&#34;go&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3401204">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401208">return</span>&nbsp;<span class="op" id="3401215">&amp;</span><span class="ident" id="3401216">ast</span><span class="op" id="3401219">.</span><span class="ident" id="3401220">GoStmt</span><span class="op" id="3401226">{</span><span class="ident" id="3401227">Go</span><span class="op" id="3401229">:</span>&nbsp;<span class="ident" id="3401231">pos</span><span class="op" id="3401234">,</span>&nbsp;<span class="ident" id="3401236">Call</span><span class="op" id="3401240">:</span>&nbsp;<span class="ident" id="3401242">call</span><span class="op" id="3401246">}</span><br>
<span class="lineno"></span><span class="op" id="3401248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3401251">func</span>&nbsp;<span class="op" id="3401256">(</span><span class="ident" id="3401257">p</span>&nbsp;<span class="op" id="3401259">*</span><span class="ident" id="3401260">parser</span><span class="op" id="3401266">)</span>&nbsp;<span class="ident" id="3401268">parseDeferStmt</span><span class="op" id="3401282">(</span><span class="op" id="3401283">)</span>&nbsp;<span class="ident" id="3401285">ast</span><span class="op" id="3401288">.</span><span class="ident" id="3401289">Stmt</span>&nbsp;<span class="op" id="3401294">{</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401297">if</span>&nbsp;<span class="ident" id="3401300">p</span><span class="op" id="3401301">.</span><span class="ident" id="3401302">trace</span>&nbsp;<span class="op" id="3401308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401312">defer</span>&nbsp;<span class="ident" id="3401318">un</span><span class="op" id="3401320">(</span><span class="ident" id="3401321">trace</span><span class="op" id="3401326">(</span><span class="ident" id="3401327">p</span><span class="op" id="3401328">,</span>&nbsp;<span class="string" id="3401330">&#34;DeferStmt&#34;</span><span class="op" id="3401341">)</span><span class="op" id="3401342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3401345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401349">pos</span>&nbsp;<span class="op" id="3401353">:=</span>&nbsp;<span class="ident" id="3401356">p</span><span class="op" id="3401357">.</span><span class="ident" id="3401358">expect</span><span class="op" id="3401364">(</span><span class="ident" id="3401365">token</span><span class="op" id="3401370">.</span><span class="ident" id="3401371">DEFER</span><span class="op" id="3401376">)</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401379">call</span>&nbsp;<span class="op" id="3401384">:=</span>&nbsp;<span class="ident" id="3401387">p</span><span class="op" id="3401388">.</span><span class="ident" id="3401389">parseCallExpr</span><span class="op" id="3401402">(</span><span class="string" id="3401403">&#34;defer&#34;</span><span class="op" id="3401410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401413">p</span><span class="op" id="3401414">.</span><span class="ident" id="3401415">expectSemi</span><span class="op" id="3401425">(</span><span class="op" id="3401426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401429">if</span>&nbsp;<span class="ident" id="3401432">call</span>&nbsp;<span class="op" id="3401437">==</span>&nbsp;<span class="ident" id="3401440">nil</span>&nbsp;<span class="op" id="3401444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401448">return</span>&nbsp;<span class="op" id="3401455">&amp;</span><span class="ident" id="3401456">ast</span><span class="op" id="3401459">.</span><span class="ident" id="3401460">BadStmt</span><span class="op" id="3401467">{</span><span class="ident" id="3401468">From</span><span class="op" id="3401472">:</span>&nbsp;<span class="ident" id="3401474">pos</span><span class="op" id="3401477">,</span>&nbsp;<span class="ident" id="3401479">To</span><span class="op" id="3401481">:</span>&nbsp;<span class="ident" id="3401483">pos</span>&nbsp;<span class="op" id="3401487">+</span>&nbsp;<span class="num" id="3401489">5</span><span class="op" id="3401490">}</span>&nbsp;<span class="comment" id="3401492">//&nbsp;len(&#34;defer&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3401509">}</span><br>
<span class="lineno">1750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401513">return</span>&nbsp;<span class="op" id="3401520">&amp;</span><span class="ident" id="3401521">ast</span><span class="op" id="3401524">.</span><span class="ident" id="3401525">DeferStmt</span><span class="op" id="3401534">{</span><span class="ident" id="3401535">Defer</span><span class="op" id="3401540">:</span>&nbsp;<span class="ident" id="3401542">pos</span><span class="op" id="3401545">,</span>&nbsp;<span class="ident" id="3401547">Call</span><span class="op" id="3401551">:</span>&nbsp;<span class="ident" id="3401553">call</span><span class="op" id="3401557">}</span><br>
<span class="lineno"></span><span class="op" id="3401559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3401562">func</span>&nbsp;<span class="op" id="3401567">(</span><span class="ident" id="3401568">p</span>&nbsp;<span class="op" id="3401570">*</span><span class="ident" id="3401571">parser</span><span class="op" id="3401577">)</span>&nbsp;<span class="ident" id="3401579">parseReturnStmt</span><span class="op" id="3401594">(</span><span class="op" id="3401595">)</span>&nbsp;<span class="op" id="3401597">*</span><span class="ident" id="3401598">ast</span><span class="op" id="3401601">.</span><span class="ident" id="3401602">ReturnStmt</span>&nbsp;<span class="op" id="3401613">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401616">if</span>&nbsp;<span class="ident" id="3401619">p</span><span class="op" id="3401620">.</span><span class="ident" id="3401621">trace</span>&nbsp;<span class="op" id="3401627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401631">defer</span>&nbsp;<span class="ident" id="3401637">un</span><span class="op" id="3401639">(</span><span class="ident" id="3401640">trace</span><span class="op" id="3401645">(</span><span class="ident" id="3401646">p</span><span class="op" id="3401647">,</span>&nbsp;<span class="string" id="3401649">&#34;ReturnStmt&#34;</span><span class="op" id="3401661">)</span><span class="op" id="3401662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3401665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401669">pos</span>&nbsp;<span class="op" id="3401673">:=</span>&nbsp;<span class="ident" id="3401676">p</span><span class="op" id="3401677">.</span><span class="ident" id="3401678">pos</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401683">p</span><span class="op" id="3401684">.</span><span class="ident" id="3401685">expect</span><span class="op" id="3401691">(</span><span class="ident" id="3401692">token</span><span class="op" id="3401697">.</span><span class="ident" id="3401698">RETURN</span><span class="op" id="3401704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401707">var</span>&nbsp;<span class="ident" id="3401711">x</span>&nbsp;<span class="op" id="3401713">[</span><span class="op" id="3401714">]</span><span class="ident" id="3401715">ast</span><span class="op" id="3401718">.</span><span class="ident" id="3401719">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401725">if</span>&nbsp;<span class="ident" id="3401728">p</span><span class="op" id="3401729">.</span><span class="ident" id="3401730">tok</span>&nbsp;<span class="op" id="3401734">!=</span>&nbsp;<span class="ident" id="3401737">token</span><span class="op" id="3401742">.</span><span class="ident" id="3401743">SEMICOLON</span>&nbsp;<span class="op" id="3401753">&amp;&amp;</span>&nbsp;<span class="ident" id="3401756">p</span><span class="op" id="3401757">.</span><span class="ident" id="3401758">tok</span>&nbsp;<span class="op" id="3401762">!=</span>&nbsp;<span class="ident" id="3401765">token</span><span class="op" id="3401770">.</span><span class="ident" id="3401771">RBRACE</span>&nbsp;<span class="op" id="3401778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401782">x</span>&nbsp;<span class="op" id="3401784">=</span>&nbsp;<span class="ident" id="3401786">p</span><span class="op" id="3401787">.</span><span class="ident" id="3401788">parseRhsList</span><span class="op" id="3401800">(</span><span class="op" id="3401801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3401804">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401807">p</span><span class="op" id="3401808">.</span><span class="ident" id="3401809">expectSemi</span><span class="op" id="3401819">(</span><span class="op" id="3401820">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401824">return</span>&nbsp;<span class="op" id="3401831">&amp;</span><span class="ident" id="3401832">ast</span><span class="op" id="3401835">.</span><span class="ident" id="3401836">ReturnStmt</span><span class="op" id="3401846">{</span><span class="ident" id="3401847">Return</span><span class="op" id="3401853">:</span>&nbsp;<span class="ident" id="3401855">pos</span><span class="op" id="3401858">,</span>&nbsp;<span class="ident" id="3401860">Results</span><span class="op" id="3401867">:</span>&nbsp;<span class="ident" id="3401869">x</span><span class="op" id="3401870">}</span><br>
<span class="lineno"></span><span class="op" id="3401872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1770</span><span class="keyword" id="3401875">func</span>&nbsp;<span class="op" id="3401880">(</span><span class="ident" id="3401881">p</span>&nbsp;<span class="op" id="3401883">*</span><span class="ident" id="3401884">parser</span><span class="op" id="3401890">)</span>&nbsp;<span class="ident" id="3401892">parseBranchStmt</span><span class="op" id="3401907">(</span><span class="ident" id="3401908">tok</span>&nbsp;<span class="ident" id="3401912">token</span><span class="op" id="3401917">.</span><span class="ident" id="3401918">Token</span><span class="op" id="3401923">)</span>&nbsp;<span class="op" id="3401925">*</span><span class="ident" id="3401926">ast</span><span class="op" id="3401929">.</span><span class="ident" id="3401930">BranchStmt</span>&nbsp;<span class="op" id="3401941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401944">if</span>&nbsp;<span class="ident" id="3401947">p</span><span class="op" id="3401948">.</span><span class="ident" id="3401949">trace</span>&nbsp;<span class="op" id="3401955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401959">defer</span>&nbsp;<span class="ident" id="3401965">un</span><span class="op" id="3401967">(</span><span class="ident" id="3401968">trace</span><span class="op" id="3401973">(</span><span class="ident" id="3401974">p</span><span class="op" id="3401975">,</span>&nbsp;<span class="string" id="3401977">&#34;BranchStmt&#34;</span><span class="op" id="3401989">)</span><span class="op" id="3401990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3401993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401997">pos</span>&nbsp;<span class="op" id="3402001">:=</span>&nbsp;<span class="ident" id="3402004">p</span><span class="op" id="3402005">.</span><span class="ident" id="3402006">expect</span><span class="op" id="3402012">(</span><span class="ident" id="3402013">tok</span><span class="op" id="3402016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402019">var</span>&nbsp;<span class="ident" id="3402023">label</span>&nbsp;<span class="op" id="3402029">*</span><span class="ident" id="3402030">ast</span><span class="op" id="3402033">.</span><span class="ident" id="3402034">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402041">if</span>&nbsp;<span class="ident" id="3402044">tok</span>&nbsp;<span class="op" id="3402048">!=</span>&nbsp;<span class="ident" id="3402051">token</span><span class="op" id="3402056">.</span><span class="ident" id="3402057">FALLTHROUGH</span>&nbsp;<span class="op" id="3402069">&amp;&amp;</span>&nbsp;<span class="ident" id="3402072">p</span><span class="op" id="3402073">.</span><span class="ident" id="3402074">tok</span>&nbsp;<span class="op" id="3402078">==</span>&nbsp;<span class="ident" id="3402081">token</span><span class="op" id="3402086">.</span><span class="ident" id="3402087">IDENT</span>&nbsp;<span class="op" id="3402093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402097">label</span>&nbsp;<span class="op" id="3402103">=</span>&nbsp;<span class="ident" id="3402105">p</span><span class="op" id="3402106">.</span><span class="ident" id="3402107">parseIdent</span><span class="op" id="3402117">(</span><span class="op" id="3402118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402122">//&nbsp;add&nbsp;to&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;targets</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402161">n</span>&nbsp;<span class="op" id="3402163">:=</span>&nbsp;<span class="builtinfunc" id="3402166">len</span><span class="op" id="3402169">(</span><span class="ident" id="3402170">p</span><span class="op" id="3402171">.</span><span class="ident" id="3402172">targetStack</span><span class="op" id="3402183">)</span>&nbsp;<span class="op" id="3402185">-</span>&nbsp;<span class="num" id="3402187">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402191">p</span><span class="op" id="3402192">.</span><span class="ident" id="3402193">targetStack</span><span class="op" id="3402204">[</span><span class="ident" id="3402205">n</span><span class="op" id="3402206">]</span>&nbsp;<span class="op" id="3402208">=</span>&nbsp;<span class="builtinfunc" id="3402210">append</span><span class="op" id="3402216">(</span><span class="ident" id="3402217">p</span><span class="op" id="3402218">.</span><span class="ident" id="3402219">targetStack</span><span class="op" id="3402230">[</span><span class="ident" id="3402231">n</span><span class="op" id="3402232">]</span><span class="op" id="3402233">,</span>&nbsp;<span class="ident" id="3402235">label</span><span class="op" id="3402240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402246">p</span><span class="op" id="3402247">.</span><span class="ident" id="3402248">expectSemi</span><span class="op" id="3402258">(</span><span class="op" id="3402259">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402263">return</span>&nbsp;<span class="op" id="3402270">&amp;</span><span class="ident" id="3402271">ast</span><span class="op" id="3402274">.</span><span class="ident" id="3402275">BranchStmt</span><span class="op" id="3402285">{</span><span class="ident" id="3402286">TokPos</span><span class="op" id="3402292">:</span>&nbsp;<span class="ident" id="3402294">pos</span><span class="op" id="3402297">,</span>&nbsp;<span class="ident" id="3402299">Tok</span><span class="op" id="3402302">:</span>&nbsp;<span class="ident" id="3402304">tok</span><span class="op" id="3402307">,</span>&nbsp;<span class="ident" id="3402309">Label</span><span class="op" id="3402314">:</span>&nbsp;<span class="ident" id="3402316">label</span><span class="op" id="3402321">}</span><br>
<span class="lineno"></span><span class="op" id="3402323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3402326">func</span>&nbsp;<span class="op" id="3402331">(</span><span class="ident" id="3402332">p</span>&nbsp;<span class="op" id="3402334">*</span><span class="ident" id="3402335">parser</span><span class="op" id="3402341">)</span>&nbsp;<span class="ident" id="3402343">makeExpr</span><span class="op" id="3402351">(</span><span class="ident" id="3402352">s</span>&nbsp;<span class="ident" id="3402354">ast</span><span class="op" id="3402357">.</span><span class="ident" id="3402358">Stmt</span><span class="op" id="3402362">,</span>&nbsp;<span class="ident" id="3402364">kind</span>&nbsp;<span class="builtintype" id="3402369">string</span><span class="op" id="3402375">)</span>&nbsp;<span class="ident" id="3402377">ast</span><span class="op" id="3402380">.</span><span class="ident" id="3402381">Expr</span>&nbsp;<span class="op" id="3402386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402389">if</span>&nbsp;<span class="ident" id="3402392">s</span>&nbsp;<span class="op" id="3402394">==</span>&nbsp;<span class="ident" id="3402397">nil</span>&nbsp;<span class="op" id="3402401">{</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402405">return</span>&nbsp;<span class="ident" id="3402412">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402420">if</span>&nbsp;<span class="ident" id="3402423">es</span><span class="op" id="3402425">,</span>&nbsp;<span class="ident" id="3402427">isExpr</span>&nbsp;<span class="op" id="3402434">:=</span>&nbsp;<span class="ident" id="3402437">s</span><span class="op" id="3402438">.</span><span class="op" id="3402439">(</span><span class="op" id="3402440">*</span><span class="ident" id="3402441">ast</span><span class="op" id="3402444">.</span><span class="ident" id="3402445">ExprStmt</span><span class="op" id="3402453">)</span><span class="op" id="3402454">;</span>&nbsp;<span class="ident" id="3402456">isExpr</span>&nbsp;<span class="op" id="3402463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402467">return</span>&nbsp;<span class="ident" id="3402474">p</span><span class="op" id="3402475">.</span><span class="ident" id="3402476">checkExpr</span><span class="op" id="3402485">(</span><span class="ident" id="3402486">es</span><span class="op" id="3402488">.</span><span class="ident" id="3402489">X</span><span class="op" id="3402490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402493">}</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402496">p</span><span class="op" id="3402497">.</span><span class="builtintype" id="3402498">error</span><span class="op" id="3402503">(</span><span class="ident" id="3402504">s</span><span class="op" id="3402505">.</span><span class="ident" id="3402506">Pos</span><span class="op" id="3402509">(</span><span class="op" id="3402510">)</span><span class="op" id="3402511">,</span>&nbsp;<span class="ident" id="3402513">fmt</span><span class="op" id="3402516">.</span><span class="ident" id="3402517">Sprintf</span><span class="op" id="3402524">(</span><span class="string" id="3402525">&#34;expected&nbsp;%s,&nbsp;found&nbsp;simple&nbsp;statement&nbsp;(missing&nbsp;parentheses&nbsp;around&nbsp;composite&nbsp;literal?)&#34;</span><span class="op" id="3402610">,</span>&nbsp;<span class="ident" id="3402612">kind</span><span class="op" id="3402616">)</span><span class="op" id="3402617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402620">return</span>&nbsp;<span class="op" id="3402627">&amp;</span><span class="ident" id="3402628">ast</span><span class="op" id="3402631">.</span><span class="ident" id="3402632">BadExpr</span><span class="op" id="3402639">{</span><span class="ident" id="3402640">From</span><span class="op" id="3402644">:</span>&nbsp;<span class="ident" id="3402646">s</span><span class="op" id="3402647">.</span><span class="ident" id="3402648">Pos</span><span class="op" id="3402651">(</span><span class="op" id="3402652">)</span><span class="op" id="3402653">,</span>&nbsp;<span class="ident" id="3402655">To</span><span class="op" id="3402657">:</span>&nbsp;<span class="ident" id="3402659">p</span><span class="op" id="3402660">.</span><span class="ident" id="3402661">safePos</span><span class="op" id="3402668">(</span><span class="ident" id="3402669">s</span><span class="op" id="3402670">.</span><span class="ident" id="3402671">End</span><span class="op" id="3402674">(</span><span class="op" id="3402675">)</span><span class="op" id="3402676">)</span><span class="op" id="3402677">}</span><br>
<span class="lineno"></span><span class="op" id="3402679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3402682">func</span>&nbsp;<span class="op" id="3402687">(</span><span class="ident" id="3402688">p</span>&nbsp;<span class="op" id="3402690">*</span><span class="ident" id="3402691">parser</span><span class="op" id="3402697">)</span>&nbsp;<span class="ident" id="3402699">parseIfStmt</span><span class="op" id="3402710">(</span><span class="op" id="3402711">)</span>&nbsp;<span class="op" id="3402713">*</span><span class="ident" id="3402714">ast</span><span class="op" id="3402717">.</span><span class="ident" id="3402718">IfStmt</span>&nbsp;<span class="op" id="3402725">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402728">if</span>&nbsp;<span class="ident" id="3402731">p</span><span class="op" id="3402732">.</span><span class="ident" id="3402733">trace</span>&nbsp;<span class="op" id="3402739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402743">defer</span>&nbsp;<span class="ident" id="3402749">un</span><span class="op" id="3402751">(</span><span class="ident" id="3402752">trace</span><span class="op" id="3402757">(</span><span class="ident" id="3402758">p</span><span class="op" id="3402759">,</span>&nbsp;<span class="string" id="3402761">&#34;IfStmt&#34;</span><span class="op" id="3402769">)</span><span class="op" id="3402770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402777">pos</span>&nbsp;<span class="op" id="3402781">:=</span>&nbsp;<span class="ident" id="3402784">p</span><span class="op" id="3402785">.</span><span class="ident" id="3402786">expect</span><span class="op" id="3402792">(</span><span class="ident" id="3402793">token</span><span class="op" id="3402798">.</span><span class="ident" id="3402799">IF</span><span class="op" id="3402801">)</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402804">p</span><span class="op" id="3402805">.</span><span class="ident" id="3402806">openScope</span><span class="op" id="3402815">(</span><span class="op" id="3402816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402819">defer</span>&nbsp;<span class="ident" id="3402825">p</span><span class="op" id="3402826">.</span><span class="ident" id="3402827">closeScope</span><span class="op" id="3402837">(</span><span class="op" id="3402838">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402842">var</span>&nbsp;<span class="ident" id="3402846">s</span>&nbsp;<span class="ident" id="3402848">ast</span><span class="op" id="3402851">.</span><span class="ident" id="3402852">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402858">var</span>&nbsp;<span class="ident" id="3402862">x</span>&nbsp;<span class="ident" id="3402864">ast</span><span class="op" id="3402867">.</span><span class="ident" id="3402868">Expr</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402878">prevLev</span>&nbsp;<span class="op" id="3402886">:=</span>&nbsp;<span class="ident" id="3402889">p</span><span class="op" id="3402890">.</span><span class="ident" id="3402891">exprLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402901">p</span><span class="op" id="3402902">.</span><span class="ident" id="3402903">exprLev</span>&nbsp;<span class="op" id="3402911">=</span>&nbsp;<span class="op" id="3402913">-</span><span class="num" id="3402914">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402918">if</span>&nbsp;<span class="ident" id="3402921">p</span><span class="op" id="3402922">.</span><span class="ident" id="3402923">tok</span>&nbsp;<span class="op" id="3402927">==</span>&nbsp;<span class="ident" id="3402930">token</span><span class="op" id="3402935">.</span><span class="ident" id="3402936">SEMICOLON</span>&nbsp;<span class="op" id="3402946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402951">p</span><span class="op" id="3402952">.</span><span class="ident" id="3402953">next</span><span class="op" id="3402957">(</span><span class="op" id="3402958">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402963">x</span>&nbsp;<span class="op" id="3402965">=</span>&nbsp;<span class="ident" id="3402967">p</span><span class="op" id="3402968">.</span><span class="ident" id="3402969">parseRhs</span><span class="op" id="3402977">(</span><span class="op" id="3402978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402982">}</span>&nbsp;<span class="keyword" id="3402984">else</span>&nbsp;<span class="op" id="3402989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402994">s</span><span class="op" id="3402995">,</span>&nbsp;<span class="ident" id="3402997">_</span>&nbsp;<span class="op" id="3402999">=</span>&nbsp;<span class="ident" id="3403001">p</span><span class="op" id="3403002">.</span><span class="ident" id="3403003">parseSimpleStmt</span><span class="op" id="3403018">(</span><span class="ident" id="3403019">basic</span><span class="op" id="3403024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403029">if</span>&nbsp;<span class="ident" id="3403032">p</span><span class="op" id="3403033">.</span><span class="ident" id="3403034">tok</span>&nbsp;<span class="op" id="3403038">==</span>&nbsp;<span class="ident" id="3403041">token</span><span class="op" id="3403046">.</span><span class="ident" id="3403047">SEMICOLON</span>&nbsp;<span class="op" id="3403057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403063">p</span><span class="op" id="3403064">.</span><span class="ident" id="3403065">next</span><span class="op" id="3403069">(</span><span class="op" id="3403070">)</span><br>
<span class="lineno">1820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403076">x</span>&nbsp;<span class="op" id="3403078">=</span>&nbsp;<span class="ident" id="3403080">p</span><span class="op" id="3403081">.</span><span class="ident" id="3403082">parseRhs</span><span class="op" id="3403090">(</span><span class="op" id="3403091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403096">}</span>&nbsp;<span class="keyword" id="3403098">else</span>&nbsp;<span class="op" id="3403103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403109">x</span>&nbsp;<span class="op" id="3403111">=</span>&nbsp;<span class="ident" id="3403113">p</span><span class="op" id="3403114">.</span><span class="ident" id="3403115">makeExpr</span><span class="op" id="3403123">(</span><span class="ident" id="3403124">s</span><span class="op" id="3403125">,</span>&nbsp;<span class="string" id="3403127">&#34;boolean&nbsp;expression&#34;</span><span class="op" id="3403147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403153">s</span>&nbsp;<span class="op" id="3403155">=</span>&nbsp;<span class="ident" id="3403157">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403164">}</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403172">p</span><span class="op" id="3403173">.</span><span class="ident" id="3403174">exprLev</span>&nbsp;<span class="op" id="3403182">=</span>&nbsp;<span class="ident" id="3403184">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403197">body</span>&nbsp;<span class="op" id="3403202">:=</span>&nbsp;<span class="ident" id="3403205">p</span><span class="op" id="3403206">.</span><span class="ident" id="3403207">parseBlockStmt</span><span class="op" id="3403221">(</span><span class="op" id="3403222">)</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403225">var</span>&nbsp;<span class="ident" id="3403229">else_</span>&nbsp;<span class="ident" id="3403235">ast</span><span class="op" id="3403238">.</span><span class="ident" id="3403239">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403245">if</span>&nbsp;<span class="ident" id="3403248">p</span><span class="op" id="3403249">.</span><span class="ident" id="3403250">tok</span>&nbsp;<span class="op" id="3403254">==</span>&nbsp;<span class="ident" id="3403257">token</span><span class="op" id="3403262">.</span><span class="ident" id="3403263">ELSE</span>&nbsp;<span class="op" id="3403268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403272">p</span><span class="op" id="3403273">.</span><span class="ident" id="3403274">next</span><span class="op" id="3403278">(</span><span class="op" id="3403279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403283">else_</span>&nbsp;<span class="op" id="3403289">=</span>&nbsp;<span class="ident" id="3403291">p</span><span class="op" id="3403292">.</span><span class="ident" id="3403293">parseStmt</span><span class="op" id="3403302">(</span><span class="op" id="3403303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403306">}</span>&nbsp;<span class="keyword" id="3403308">else</span>&nbsp;<span class="op" id="3403313">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403317">p</span><span class="op" id="3403318">.</span><span class="ident" id="3403319">expectSemi</span><span class="op" id="3403329">(</span><span class="op" id="3403330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403337">return</span>&nbsp;<span class="op" id="3403344">&amp;</span><span class="ident" id="3403345">ast</span><span class="op" id="3403348">.</span><span class="ident" id="3403349">IfStmt</span><span class="op" id="3403355">{</span><span class="ident" id="3403356">If</span><span class="op" id="3403358">:</span>&nbsp;<span class="ident" id="3403360">pos</span><span class="op" id="3403363">,</span>&nbsp;<span class="ident" id="3403365">Init</span><span class="op" id="3403369">:</span>&nbsp;<span class="ident" id="3403371">s</span><span class="op" id="3403372">,</span>&nbsp;<span class="ident" id="3403374">Cond</span><span class="op" id="3403378">:</span>&nbsp;<span class="ident" id="3403380">x</span><span class="op" id="3403381">,</span>&nbsp;<span class="ident" id="3403383">Body</span><span class="op" id="3403387">:</span>&nbsp;<span class="ident" id="3403389">body</span><span class="op" id="3403393">,</span>&nbsp;<span class="ident" id="3403395">Else</span><span class="op" id="3403399">:</span>&nbsp;<span class="ident" id="3403401">else_</span><span class="op" id="3403406">}</span><br>
<span class="lineno"></span><span class="op" id="3403408">}</span><br>
<span class="lineno">1840</span><br>
<span class="lineno"></span><span class="keyword" id="3403411">func</span>&nbsp;<span class="op" id="3403416">(</span><span class="ident" id="3403417">p</span>&nbsp;<span class="op" id="3403419">*</span><span class="ident" id="3403420">parser</span><span class="op" id="3403426">)</span>&nbsp;<span class="ident" id="3403428">parseTypeList</span><span class="op" id="3403441">(</span><span class="op" id="3403442">)</span>&nbsp;<span class="op" id="3403444">(</span><span class="ident" id="3403445">list</span>&nbsp;<span class="op" id="3403450">[</span><span class="op" id="3403451">]</span><span class="ident" id="3403452">ast</span><span class="op" id="3403455">.</span><span class="ident" id="3403456">Expr</span><span class="op" id="3403460">)</span>&nbsp;<span class="op" id="3403462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403465">if</span>&nbsp;<span class="ident" id="3403468">p</span><span class="op" id="3403469">.</span><span class="ident" id="3403470">trace</span>&nbsp;<span class="op" id="3403476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403480">defer</span>&nbsp;<span class="ident" id="3403486">un</span><span class="op" id="3403488">(</span><span class="ident" id="3403489">trace</span><span class="op" id="3403494">(</span><span class="ident" id="3403495">p</span><span class="op" id="3403496">,</span>&nbsp;<span class="string" id="3403498">&#34;TypeList&#34;</span><span class="op" id="3403508">)</span><span class="op" id="3403509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403512">}</span><br>
<span class="lineno">1845</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403516">list</span>&nbsp;<span class="op" id="3403521">=</span>&nbsp;<span class="builtinfunc" id="3403523">append</span><span class="op" id="3403529">(</span><span class="ident" id="3403530">list</span><span class="op" id="3403534">,</span>&nbsp;<span class="ident" id="3403536">p</span><span class="op" id="3403537">.</span><span class="ident" id="3403538">parseType</span><span class="op" id="3403547">(</span><span class="op" id="3403548">)</span><span class="op" id="3403549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403552">for</span>&nbsp;<span class="ident" id="3403556">p</span><span class="op" id="3403557">.</span><span class="ident" id="3403558">tok</span>&nbsp;<span class="op" id="3403562">==</span>&nbsp;<span class="ident" id="3403565">token</span><span class="op" id="3403570">.</span><span class="ident" id="3403571">COMMA</span>&nbsp;<span class="op" id="3403577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403581">p</span><span class="op" id="3403582">.</span><span class="ident" id="3403583">next</span><span class="op" id="3403587">(</span><span class="op" id="3403588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403592">list</span>&nbsp;<span class="op" id="3403597">=</span>&nbsp;<span class="builtinfunc" id="3403599">append</span><span class="op" id="3403605">(</span><span class="ident" id="3403606">list</span><span class="op" id="3403610">,</span>&nbsp;<span class="ident" id="3403612">p</span><span class="op" id="3403613">.</span><span class="ident" id="3403614">parseType</span><span class="op" id="3403623">(</span><span class="op" id="3403624">)</span><span class="op" id="3403625">)</span><br>
<span class="lineno">1850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403632">return</span><br>
<span class="lineno"></span><span class="op" id="3403639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1855</span><span class="keyword" id="3403642">func</span>&nbsp;<span class="op" id="3403647">(</span><span class="ident" id="3403648">p</span>&nbsp;<span class="op" id="3403650">*</span><span class="ident" id="3403651">parser</span><span class="op" id="3403657">)</span>&nbsp;<span class="ident" id="3403659">parseCaseClause</span><span class="op" id="3403674">(</span><span class="ident" id="3403675">typeSwitch</span>&nbsp;<span class="builtintype" id="3403686">bool</span><span class="op" id="3403690">)</span>&nbsp;<span class="op" id="3403692">*</span><span class="ident" id="3403693">ast</span><span class="op" id="3403696">.</span><span class="ident" id="3403697">CaseClause</span>&nbsp;<span class="op" id="3403708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403711">if</span>&nbsp;<span class="ident" id="3403714">p</span><span class="op" id="3403715">.</span><span class="ident" id="3403716">trace</span>&nbsp;<span class="op" id="3403722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403726">defer</span>&nbsp;<span class="ident" id="3403732">un</span><span class="op" id="3403734">(</span><span class="ident" id="3403735">trace</span><span class="op" id="3403740">(</span><span class="ident" id="3403741">p</span><span class="op" id="3403742">,</span>&nbsp;<span class="string" id="3403744">&#34;CaseClause&#34;</span><span class="op" id="3403756">)</span><span class="op" id="3403757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403764">pos</span>&nbsp;<span class="op" id="3403768">:=</span>&nbsp;<span class="ident" id="3403771">p</span><span class="op" id="3403772">.</span><span class="ident" id="3403773">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403778">var</span>&nbsp;<span class="ident" id="3403782">list</span>&nbsp;<span class="op" id="3403787">[</span><span class="op" id="3403788">]</span><span class="ident" id="3403789">ast</span><span class="op" id="3403792">.</span><span class="ident" id="3403793">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403799">if</span>&nbsp;<span class="ident" id="3403802">p</span><span class="op" id="3403803">.</span><span class="ident" id="3403804">tok</span>&nbsp;<span class="op" id="3403808">==</span>&nbsp;<span class="ident" id="3403811">token</span><span class="op" id="3403816">.</span><span class="ident" id="3403817">CASE</span>&nbsp;<span class="op" id="3403822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403826">p</span><span class="op" id="3403827">.</span><span class="ident" id="3403828">next</span><span class="op" id="3403832">(</span><span class="op" id="3403833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403837">if</span>&nbsp;<span class="ident" id="3403840">typeSwitch</span>&nbsp;<span class="op" id="3403851">{</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403856">list</span>&nbsp;<span class="op" id="3403861">=</span>&nbsp;<span class="ident" id="3403863">p</span><span class="op" id="3403864">.</span><span class="ident" id="3403865">parseTypeList</span><span class="op" id="3403878">(</span><span class="op" id="3403879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403883">}</span>&nbsp;<span class="keyword" id="3403885">else</span>&nbsp;<span class="op" id="3403890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403895">list</span>&nbsp;<span class="op" id="3403900">=</span>&nbsp;<span class="ident" id="3403902">p</span><span class="op" id="3403903">.</span><span class="ident" id="3403904">parseRhsList</span><span class="op" id="3403916">(</span><span class="op" id="3403917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403924">}</span>&nbsp;<span class="keyword" id="3403926">else</span>&nbsp;<span class="op" id="3403931">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403935">p</span><span class="op" id="3403936">.</span><span class="ident" id="3403937">expect</span><span class="op" id="3403943">(</span><span class="ident" id="3403944">token</span><span class="op" id="3403949">.</span><span class="ident" id="3403950">DEFAULT</span><span class="op" id="3403957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403964">colon</span>&nbsp;<span class="op" id="3403970">:=</span>&nbsp;<span class="ident" id="3403973">p</span><span class="op" id="3403974">.</span><span class="ident" id="3403975">expect</span><span class="op" id="3403981">(</span><span class="ident" id="3403982">token</span><span class="op" id="3403987">.</span><span class="ident" id="3403988">COLON</span><span class="op" id="3403993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403996">p</span><span class="op" id="3403997">.</span><span class="ident" id="3403998">openScope</span><span class="op" id="3404007">(</span><span class="op" id="3404008">)</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404011">body</span>&nbsp;<span class="op" id="3404016">:=</span>&nbsp;<span class="ident" id="3404019">p</span><span class="op" id="3404020">.</span><span class="ident" id="3404021">parseStmtList</span><span class="op" id="3404034">(</span><span class="op" id="3404035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404038">p</span><span class="op" id="3404039">.</span><span class="ident" id="3404040">closeScope</span><span class="op" id="3404050">(</span><span class="op" id="3404051">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404055">return</span>&nbsp;<span class="op" id="3404062">&amp;</span><span class="ident" id="3404063">ast</span><span class="op" id="3404066">.</span><span class="ident" id="3404067">CaseClause</span><span class="op" id="3404077">{</span><span class="ident" id="3404078">Case</span><span class="op" id="3404082">:</span>&nbsp;<span class="ident" id="3404084">pos</span><span class="op" id="3404087">,</span>&nbsp;<span class="ident" id="3404089">List</span><span class="op" id="3404093">:</span>&nbsp;<span class="ident" id="3404095">list</span><span class="op" id="3404099">,</span>&nbsp;<span class="ident" id="3404101">Colon</span><span class="op" id="3404106">:</span>&nbsp;<span class="ident" id="3404108">colon</span><span class="op" id="3404113">,</span>&nbsp;<span class="ident" id="3404115">Body</span><span class="op" id="3404119">:</span>&nbsp;<span class="ident" id="3404121">body</span><span class="op" id="3404125">}</span><br>
<span class="lineno"></span><span class="op" id="3404127">}</span><br>
<span class="lineno">1880</span><br>
<span class="lineno"></span><span class="keyword" id="3404130">func</span>&nbsp;<span class="ident" id="3404135">isTypeSwitchAssert</span><span class="op" id="3404153">(</span><span class="ident" id="3404154">x</span>&nbsp;<span class="ident" id="3404156">ast</span><span class="op" id="3404159">.</span><span class="ident" id="3404160">Expr</span><span class="op" id="3404164">)</span>&nbsp;<span class="builtintype" id="3404166">bool</span>&nbsp;<span class="op" id="3404171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404174">a</span><span class="op" id="3404175">,</span>&nbsp;<span class="ident" id="3404177">ok</span>&nbsp;<span class="op" id="3404180">:=</span>&nbsp;<span class="ident" id="3404183">x</span><span class="op" id="3404184">.</span><span class="op" id="3404185">(</span><span class="op" id="3404186">*</span><span class="ident" id="3404187">ast</span><span class="op" id="3404190">.</span><span class="ident" id="3404191">TypeAssertExpr</span><span class="op" id="3404205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404208">return</span>&nbsp;<span class="ident" id="3404215">ok</span>&nbsp;<span class="op" id="3404218">&amp;&amp;</span>&nbsp;<span class="ident" id="3404221">a</span><span class="op" id="3404222">.</span><span class="ident" id="3404223">Type</span>&nbsp;<span class="op" id="3404228">==</span>&nbsp;<span class="ident" id="3404231">nil</span><br>
<span class="lineno"></span><span class="op" id="3404235">}</span><br>
<span class="lineno">1885</span><br>
<span class="lineno"></span><span class="keyword" id="3404238">func</span>&nbsp;<span class="ident" id="3404243">isTypeSwitchGuard</span><span class="op" id="3404260">(</span><span class="ident" id="3404261">s</span>&nbsp;<span class="ident" id="3404263">ast</span><span class="op" id="3404266">.</span><span class="ident" id="3404267">Stmt</span><span class="op" id="3404271">)</span>&nbsp;<span class="builtintype" id="3404273">bool</span>&nbsp;<span class="op" id="3404278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404281">switch</span>&nbsp;<span class="ident" id="3404288">t</span>&nbsp;<span class="op" id="3404290">:=</span>&nbsp;<span class="ident" id="3404293">s</span><span class="op" id="3404294">.</span><span class="op" id="3404295">(</span><span class="keyword" id="3404296">type</span><span class="op" id="3404300">)</span>&nbsp;<span class="op" id="3404302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404305">case</span>&nbsp;<span class="op" id="3404310">*</span><span class="ident" id="3404311">ast</span><span class="op" id="3404314">.</span><span class="ident" id="3404315">ExprStmt</span><span class="op" id="3404323">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404327">//&nbsp;x.(nil)</span><br>
<span class="lineno">1890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404340">return</span>&nbsp;<span class="ident" id="3404347">isTypeSwitchAssert</span><span class="op" id="3404365">(</span><span class="ident" id="3404366">t</span><span class="op" id="3404367">.</span><span class="ident" id="3404368">X</span><span class="op" id="3404369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404372">case</span>&nbsp;<span class="op" id="3404377">*</span><span class="ident" id="3404378">ast</span><span class="op" id="3404381">.</span><span class="ident" id="3404382">AssignStmt</span><span class="op" id="3404392">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404396">//&nbsp;v&nbsp;:=&nbsp;x.(nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404414">return</span>&nbsp;<span class="builtinfunc" id="3404421">len</span><span class="op" id="3404424">(</span><span class="ident" id="3404425">t</span><span class="op" id="3404426">.</span><span class="ident" id="3404427">Lhs</span><span class="op" id="3404430">)</span>&nbsp;<span class="op" id="3404432">==</span>&nbsp;<span class="num" id="3404435">1</span>&nbsp;<span class="op" id="3404437">&amp;&amp;</span>&nbsp;<span class="ident" id="3404440">t</span><span class="op" id="3404441">.</span><span class="ident" id="3404442">Tok</span>&nbsp;<span class="op" id="3404446">==</span>&nbsp;<span class="ident" id="3404449">token</span><span class="op" id="3404454">.</span><span class="ident" id="3404455">DEFINE</span>&nbsp;<span class="op" id="3404462">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3404465">len</span><span class="op" id="3404468">(</span><span class="ident" id="3404469">t</span><span class="op" id="3404470">.</span><span class="ident" id="3404471">Rhs</span><span class="op" id="3404474">)</span>&nbsp;<span class="op" id="3404476">==</span>&nbsp;<span class="num" id="3404479">1</span>&nbsp;<span class="op" id="3404481">&amp;&amp;</span>&nbsp;<span class="ident" id="3404484">isTypeSwitchAssert</span><span class="op" id="3404502">(</span><span class="ident" id="3404503">t</span><span class="op" id="3404504">.</span><span class="ident" id="3404505">Rhs</span><span class="op" id="3404508">[</span><span class="num" id="3404509">0</span><span class="op" id="3404510">]</span><span class="op" id="3404511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3404514">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404517">return</span>&nbsp;<span class="builtintype" id="3404524">false</span><br>
<span class="lineno"></span><span class="op" id="3404530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3404533">func</span>&nbsp;<span class="op" id="3404538">(</span><span class="ident" id="3404539">p</span>&nbsp;<span class="op" id="3404541">*</span><span class="ident" id="3404542">parser</span><span class="op" id="3404548">)</span>&nbsp;<span class="ident" id="3404550">parseSwitchStmt</span><span class="op" id="3404565">(</span><span class="op" id="3404566">)</span>&nbsp;<span class="ident" id="3404568">ast</span><span class="op" id="3404571">.</span><span class="ident" id="3404572">Stmt</span>&nbsp;<span class="op" id="3404577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404580">if</span>&nbsp;<span class="ident" id="3404583">p</span><span class="op" id="3404584">.</span><span class="ident" id="3404585">trace</span>&nbsp;<span class="op" id="3404591">{</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404595">defer</span>&nbsp;<span class="ident" id="3404601">un</span><span class="op" id="3404603">(</span><span class="ident" id="3404604">trace</span><span class="op" id="3404609">(</span><span class="ident" id="3404610">p</span><span class="op" id="3404611">,</span>&nbsp;<span class="string" id="3404613">&#34;SwitchStmt&#34;</span><span class="op" id="3404625">)</span><span class="op" id="3404626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3404629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404633">pos</span>&nbsp;<span class="op" id="3404637">:=</span>&nbsp;<span class="ident" id="3404640">p</span><span class="op" id="3404641">.</span><span class="ident" id="3404642">expect</span><span class="op" id="3404648">(</span><span class="ident" id="3404649">token</span><span class="op" id="3404654">.</span><span class="ident" id="3404655">SWITCH</span><span class="op" id="3404661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404664">p</span><span class="op" id="3404665">.</span><span class="ident" id="3404666">openScope</span><span class="op" id="3404675">(</span><span class="op" id="3404676">)</span><br>
<span class="lineno">1905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404679">defer</span>&nbsp;<span class="ident" id="3404685">p</span><span class="op" id="3404686">.</span><span class="ident" id="3404687">closeScope</span><span class="op" id="3404697">(</span><span class="op" id="3404698">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404702">var</span>&nbsp;<span class="ident" id="3404706">s1</span><span class="op" id="3404708">,</span>&nbsp;<span class="ident" id="3404710">s2</span>&nbsp;<span class="ident" id="3404713">ast</span><span class="op" id="3404716">.</span><span class="ident" id="3404717">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404723">if</span>&nbsp;<span class="ident" id="3404726">p</span><span class="op" id="3404727">.</span><span class="ident" id="3404728">tok</span>&nbsp;<span class="op" id="3404732">!=</span>&nbsp;<span class="ident" id="3404735">token</span><span class="op" id="3404740">.</span><span class="ident" id="3404741">LBRACE</span>&nbsp;<span class="op" id="3404748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404752">prevLev</span>&nbsp;<span class="op" id="3404760">:=</span>&nbsp;<span class="ident" id="3404763">p</span><span class="op" id="3404764">.</span><span class="ident" id="3404765">exprLev</span><br>
<span class="lineno">1910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404775">p</span><span class="op" id="3404776">.</span><span class="ident" id="3404777">exprLev</span>&nbsp;<span class="op" id="3404785">=</span>&nbsp;<span class="op" id="3404787">-</span><span class="num" id="3404788">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404792">if</span>&nbsp;<span class="ident" id="3404795">p</span><span class="op" id="3404796">.</span><span class="ident" id="3404797">tok</span>&nbsp;<span class="op" id="3404801">!=</span>&nbsp;<span class="ident" id="3404804">token</span><span class="op" id="3404809">.</span><span class="ident" id="3404810">SEMICOLON</span>&nbsp;<span class="op" id="3404820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404825">s2</span><span class="op" id="3404827">,</span>&nbsp;<span class="ident" id="3404829">_</span>&nbsp;<span class="op" id="3404831">=</span>&nbsp;<span class="ident" id="3404833">p</span><span class="op" id="3404834">.</span><span class="ident" id="3404835">parseSimpleStmt</span><span class="op" id="3404850">(</span><span class="ident" id="3404851">basic</span><span class="op" id="3404856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3404860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404864">if</span>&nbsp;<span class="ident" id="3404867">p</span><span class="op" id="3404868">.</span><span class="ident" id="3404869">tok</span>&nbsp;<span class="op" id="3404873">==</span>&nbsp;<span class="ident" id="3404876">token</span><span class="op" id="3404881">.</span><span class="ident" id="3404882">SEMICOLON</span>&nbsp;<span class="op" id="3404892">{</span><br>
<span class="lineno">1915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404897">p</span><span class="op" id="3404898">.</span><span class="ident" id="3404899">next</span><span class="op" id="3404903">(</span><span class="op" id="3404904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404909">s1</span>&nbsp;<span class="op" id="3404912">=</span>&nbsp;<span class="ident" id="3404914">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404920">s2</span>&nbsp;<span class="op" id="3404923">=</span>&nbsp;<span class="ident" id="3404925">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404932">if</span>&nbsp;<span class="ident" id="3404935">p</span><span class="op" id="3404936">.</span><span class="ident" id="3404937">tok</span>&nbsp;<span class="op" id="3404941">!=</span>&nbsp;<span class="ident" id="3404944">token</span><span class="op" id="3404949">.</span><span class="ident" id="3404950">LBRACE</span>&nbsp;<span class="op" id="3404957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3404963">//&nbsp;A&nbsp;TypeSwitchGuard&nbsp;may&nbsp;declare&nbsp;a&nbsp;variable&nbsp;in&nbsp;addition</span><br>
<span class="lineno">1920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405023">//&nbsp;to&nbsp;the&nbsp;variable&nbsp;declared&nbsp;in&nbsp;the&nbsp;initial&nbsp;SimpleStmt.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405082">//&nbsp;Introduce&nbsp;extra&nbsp;scope&nbsp;to&nbsp;avoid&nbsp;redeclaration&nbsp;errors:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405142">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405149">//&nbsp;&nbsp;&nbsp;&nbspswitch&nbsp;t&nbsp;:=&nbsp;0;&nbsp;t&nbsp;:=&nbsp;x.(T)&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405190">//</span><br>
<span class="lineno">1925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405197">//&nbsp;(this&nbsp;code&nbsp;is&nbsp;not&nbsp;valid&nbsp;Go&nbsp;because&nbsp;the&nbsp;first&nbsp;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405251">//&nbsp;cannot&nbsp;be&nbsp;accessed&nbsp;and&nbsp;thus&nbsp;is&nbsp;never&nbsp;used,&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405311">//&nbsp;scope&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;correct&nbsp;error&nbsp;message).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405366">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405373">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;type&nbsp;switch,&nbsp;s2&nbsp;must&nbsp;be&nbsp;an&nbsp;expression.</span><br>
<span class="lineno">1930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3405438">//&nbsp;Having&nbsp;the&nbsp;extra&nbsp;nested&nbsp;but&nbsp;empty&nbsp;scope&nbsp;won&#39;t&nbsp;affect&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405502">p</span><span class="op" id="3405503">.</span><span class="ident" id="3405504">openScope</span><span class="op" id="3405513">(</span><span class="op" id="3405514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405520">defer</span>&nbsp;<span class="ident" id="3405526">p</span><span class="op" id="3405527">.</span><span class="ident" id="3405528">closeScope</span><span class="op" id="3405538">(</span><span class="op" id="3405539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405545">s2</span><span class="op" id="3405547">,</span>&nbsp;<span class="ident" id="3405549">_</span>&nbsp;<span class="op" id="3405551">=</span>&nbsp;<span class="ident" id="3405553">p</span><span class="op" id="3405554">.</span><span class="ident" id="3405555">parseSimpleStmt</span><span class="op" id="3405570">(</span><span class="ident" id="3405571">basic</span><span class="op" id="3405576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3405581">}</span><br>
<span class="lineno">1935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3405585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405589">p</span><span class="op" id="3405590">.</span><span class="ident" id="3405591">exprLev</span>&nbsp;<span class="op" id="3405599">=</span>&nbsp;<span class="ident" id="3405601">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3405610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405614">typeSwitch</span>&nbsp;<span class="op" id="3405625">:=</span>&nbsp;<span class="ident" id="3405628">isTypeSwitchGuard</span><span class="op" id="3405645">(</span><span class="ident" id="3405646">s2</span><span class="op" id="3405648">)</span><br>
<span class="lineno">1940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405651">lbrace</span>&nbsp;<span class="op" id="3405658">:=</span>&nbsp;<span class="ident" id="3405661">p</span><span class="op" id="3405662">.</span><span class="ident" id="3405663">expect</span><span class="op" id="3405669">(</span><span class="ident" id="3405670">token</span><span class="op" id="3405675">.</span><span class="ident" id="3405676">LBRACE</span><span class="op" id="3405682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405685">var</span>&nbsp;<span class="ident" id="3405689">list</span>&nbsp;<span class="op" id="3405694">[</span><span class="op" id="3405695">]</span><span class="ident" id="3405696">ast</span><span class="op" id="3405699">.</span><span class="ident" id="3405700">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405706">for</span>&nbsp;<span class="ident" id="3405710">p</span><span class="op" id="3405711">.</span><span class="ident" id="3405712">tok</span>&nbsp;<span class="op" id="3405716">==</span>&nbsp;<span class="ident" id="3405719">token</span><span class="op" id="3405724">.</span><span class="ident" id="3405725">CASE</span>&nbsp;<span class="op" id="3405730">||</span>&nbsp;<span class="ident" id="3405733">p</span><span class="op" id="3405734">.</span><span class="ident" id="3405735">tok</span>&nbsp;<span class="op" id="3405739">==</span>&nbsp;<span class="ident" id="3405742">token</span><span class="op" id="3405747">.</span><span class="ident" id="3405748">DEFAULT</span>&nbsp;<span class="op" id="3405756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405760">list</span>&nbsp;<span class="op" id="3405765">=</span>&nbsp;<span class="builtinfunc" id="3405767">append</span><span class="op" id="3405773">(</span><span class="ident" id="3405774">list</span><span class="op" id="3405778">,</span>&nbsp;<span class="ident" id="3405780">p</span><span class="op" id="3405781">.</span><span class="ident" id="3405782">parseCaseClause</span><span class="op" id="3405797">(</span><span class="ident" id="3405798">typeSwitch</span><span class="op" id="3405808">)</span><span class="op" id="3405809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3405812">}</span><br>
<span class="lineno">1945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405815">rbrace</span>&nbsp;<span class="op" id="3405822">:=</span>&nbsp;<span class="ident" id="3405825">p</span><span class="op" id="3405826">.</span><span class="ident" id="3405827">expect</span><span class="op" id="3405833">(</span><span class="ident" id="3405834">token</span><span class="op" id="3405839">.</span><span class="ident" id="3405840">RBRACE</span><span class="op" id="3405846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405849">p</span><span class="op" id="3405850">.</span><span class="ident" id="3405851">expectSemi</span><span class="op" id="3405861">(</span><span class="op" id="3405862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405865">body</span>&nbsp;<span class="op" id="3405870">:=</span>&nbsp;<span class="op" id="3405873">&amp;</span><span class="ident" id="3405874">ast</span><span class="op" id="3405877">.</span><span class="ident" id="3405878">BlockStmt</span><span class="op" id="3405887">{</span><span class="ident" id="3405888">Lbrace</span><span class="op" id="3405894">:</span>&nbsp;<span class="ident" id="3405896">lbrace</span><span class="op" id="3405902">,</span>&nbsp;<span class="ident" id="3405904">List</span><span class="op" id="3405908">:</span>&nbsp;<span class="ident" id="3405910">list</span><span class="op" id="3405914">,</span>&nbsp;<span class="ident" id="3405916">Rbrace</span><span class="op" id="3405922">:</span>&nbsp;<span class="ident" id="3405924">rbrace</span><span class="op" id="3405930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405934">if</span>&nbsp;<span class="ident" id="3405937">typeSwitch</span>&nbsp;<span class="op" id="3405948">{</span><br>
<span class="lineno">1950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405952">return</span>&nbsp;<span class="op" id="3405959">&amp;</span><span class="ident" id="3405960">ast</span><span class="op" id="3405963">.</span><span class="ident" id="3405964">TypeSwitchStmt</span><span class="op" id="3405978">{</span><span class="ident" id="3405979">Switch</span><span class="op" id="3405985">:</span>&nbsp;<span class="ident" id="3405987">pos</span><span class="op" id="3405990">,</span>&nbsp;<span class="ident" id="3405992">Init</span><span class="op" id="3405996">:</span>&nbsp;<span class="ident" id="3405998">s1</span><span class="op" id="3406000">,</span>&nbsp;<span class="ident" id="3406002">Assign</span><span class="op" id="3406008">:</span>&nbsp;<span class="ident" id="3406010">s2</span><span class="op" id="3406012">,</span>&nbsp;<span class="ident" id="3406014">Body</span><span class="op" id="3406018">:</span>&nbsp;<span class="ident" id="3406020">body</span><span class="op" id="3406024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406031">return</span>&nbsp;<span class="op" id="3406038">&amp;</span><span class="ident" id="3406039">ast</span><span class="op" id="3406042">.</span><span class="ident" id="3406043">SwitchStmt</span><span class="op" id="3406053">{</span><span class="ident" id="3406054">Switch</span><span class="op" id="3406060">:</span>&nbsp;<span class="ident" id="3406062">pos</span><span class="op" id="3406065">,</span>&nbsp;<span class="ident" id="3406067">Init</span><span class="op" id="3406071">:</span>&nbsp;<span class="ident" id="3406073">s1</span><span class="op" id="3406075">,</span>&nbsp;<span class="ident" id="3406077">Tag</span><span class="op" id="3406080">:</span>&nbsp;<span class="ident" id="3406082">p</span><span class="op" id="3406083">.</span><span class="ident" id="3406084">makeExpr</span><span class="op" id="3406092">(</span><span class="ident" id="3406093">s2</span><span class="op" id="3406095">,</span>&nbsp;<span class="string" id="3406097">&#34;switch&nbsp;expression&#34;</span><span class="op" id="3406116">)</span><span class="op" id="3406117">,</span>&nbsp;<span class="ident" id="3406119">Body</span><span class="op" id="3406123">:</span>&nbsp;<span class="ident" id="3406125">body</span><span class="op" id="3406129">}</span><br>
<span class="lineno"></span><span class="op" id="3406131">}</span><br>
<span class="lineno">1955</span><br>
<span class="lineno"></span><span class="keyword" id="3406134">func</span>&nbsp;<span class="op" id="3406139">(</span><span class="ident" id="3406140">p</span>&nbsp;<span class="op" id="3406142">*</span><span class="ident" id="3406143">parser</span><span class="op" id="3406149">)</span>&nbsp;<span class="ident" id="3406151">parseCommClause</span><span class="op" id="3406166">(</span><span class="op" id="3406167">)</span>&nbsp;<span class="op" id="3406169">*</span><span class="ident" id="3406170">ast</span><span class="op" id="3406173">.</span><span class="ident" id="3406174">CommClause</span>&nbsp;<span class="op" id="3406185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406188">if</span>&nbsp;<span class="ident" id="3406191">p</span><span class="op" id="3406192">.</span><span class="ident" id="3406193">trace</span>&nbsp;<span class="op" id="3406199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406203">defer</span>&nbsp;<span class="ident" id="3406209">un</span><span class="op" id="3406211">(</span><span class="ident" id="3406212">trace</span><span class="op" id="3406217">(</span><span class="ident" id="3406218">p</span><span class="op" id="3406219">,</span>&nbsp;<span class="string" id="3406221">&#34;CommClause&#34;</span><span class="op" id="3406233">)</span><span class="op" id="3406234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406237">}</span><br>
<span class="lineno">1960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406241">p</span><span class="op" id="3406242">.</span><span class="ident" id="3406243">openScope</span><span class="op" id="3406252">(</span><span class="op" id="3406253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406256">pos</span>&nbsp;<span class="op" id="3406260">:=</span>&nbsp;<span class="ident" id="3406263">p</span><span class="op" id="3406264">.</span><span class="ident" id="3406265">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406270">var</span>&nbsp;<span class="ident" id="3406274">comm</span>&nbsp;<span class="ident" id="3406279">ast</span><span class="op" id="3406282">.</span><span class="ident" id="3406283">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406289">if</span>&nbsp;<span class="ident" id="3406292">p</span><span class="op" id="3406293">.</span><span class="ident" id="3406294">tok</span>&nbsp;<span class="op" id="3406298">==</span>&nbsp;<span class="ident" id="3406301">token</span><span class="op" id="3406306">.</span><span class="ident" id="3406307">CASE</span>&nbsp;<span class="op" id="3406312">{</span><br>
<span class="lineno">1965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406316">p</span><span class="op" id="3406317">.</span><span class="ident" id="3406318">next</span><span class="op" id="3406322">(</span><span class="op" id="3406323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406327">lhs</span>&nbsp;<span class="op" id="3406331">:=</span>&nbsp;<span class="ident" id="3406334">p</span><span class="op" id="3406335">.</span><span class="ident" id="3406336">parseLhsList</span><span class="op" id="3406348">(</span><span class="op" id="3406349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406353">if</span>&nbsp;<span class="ident" id="3406356">p</span><span class="op" id="3406357">.</span><span class="ident" id="3406358">tok</span>&nbsp;<span class="op" id="3406362">==</span>&nbsp;<span class="ident" id="3406365">token</span><span class="op" id="3406370">.</span><span class="ident" id="3406371">ARROW</span>&nbsp;<span class="op" id="3406377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406382">//&nbsp;SendStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406397">if</span>&nbsp;<span class="builtinfunc" id="3406400">len</span><span class="op" id="3406403">(</span><span class="ident" id="3406404">lhs</span><span class="op" id="3406407">)</span>&nbsp;<span class="op" id="3406409">&gt;</span>&nbsp;<span class="num" id="3406411">1</span>&nbsp;<span class="op" id="3406413">{</span><br>
<span class="lineno">1970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406419">p</span><span class="op" id="3406420">.</span><span class="ident" id="3406421">errorExpected</span><span class="op" id="3406434">(</span><span class="ident" id="3406435">lhs</span><span class="op" id="3406438">[</span><span class="num" id="3406439">0</span><span class="op" id="3406440">]</span><span class="op" id="3406441">.</span><span class="ident" id="3406442">Pos</span><span class="op" id="3406445">(</span><span class="op" id="3406446">)</span><span class="op" id="3406447">,</span>&nbsp;<span class="string" id="3406449">&#34;1&nbsp;expression&#34;</span><span class="op" id="3406463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406469">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406511">arrow</span>&nbsp;<span class="op" id="3406517">:=</span>&nbsp;<span class="ident" id="3406520">p</span><span class="op" id="3406521">.</span><span class="ident" id="3406522">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406529">p</span><span class="op" id="3406530">.</span><span class="ident" id="3406531">next</span><span class="op" id="3406535">(</span><span class="op" id="3406536">)</span><br>
<span class="lineno">1975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406541">rhs</span>&nbsp;<span class="op" id="3406545">:=</span>&nbsp;<span class="ident" id="3406548">p</span><span class="op" id="3406549">.</span><span class="ident" id="3406550">parseRhs</span><span class="op" id="3406558">(</span><span class="op" id="3406559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406564">comm</span>&nbsp;<span class="op" id="3406569">=</span>&nbsp;<span class="op" id="3406571">&amp;</span><span class="ident" id="3406572">ast</span><span class="op" id="3406575">.</span><span class="ident" id="3406576">SendStmt</span><span class="op" id="3406584">{</span><span class="ident" id="3406585">Chan</span><span class="op" id="3406589">:</span>&nbsp;<span class="ident" id="3406591">lhs</span><span class="op" id="3406594">[</span><span class="num" id="3406595">0</span><span class="op" id="3406596">]</span><span class="op" id="3406597">,</span>&nbsp;<span class="ident" id="3406599">Arrow</span><span class="op" id="3406604">:</span>&nbsp;<span class="ident" id="3406606">arrow</span><span class="op" id="3406611">,</span>&nbsp;<span class="ident" id="3406613">Value</span><span class="op" id="3406618">:</span>&nbsp;<span class="ident" id="3406620">rhs</span><span class="op" id="3406623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406627">}</span>&nbsp;<span class="keyword" id="3406629">else</span>&nbsp;<span class="op" id="3406634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406639">//&nbsp;RecvStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406654">if</span>&nbsp;<span class="ident" id="3406657">tok</span>&nbsp;<span class="op" id="3406661">:=</span>&nbsp;<span class="ident" id="3406664">p</span><span class="op" id="3406665">.</span><span class="ident" id="3406666">tok</span><span class="op" id="3406669">;</span>&nbsp;<span class="ident" id="3406671">tok</span>&nbsp;<span class="op" id="3406675">==</span>&nbsp;<span class="ident" id="3406678">token</span><span class="op" id="3406683">.</span><span class="ident" id="3406684">ASSIGN</span>&nbsp;<span class="op" id="3406691">||</span>&nbsp;<span class="ident" id="3406694">tok</span>&nbsp;<span class="op" id="3406698">==</span>&nbsp;<span class="ident" id="3406701">token</span><span class="op" id="3406706">.</span><span class="ident" id="3406707">DEFINE</span>&nbsp;<span class="op" id="3406714">{</span><br>
<span class="lineno">1980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406720">//&nbsp;RecvStmt&nbsp;with&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406752">if</span>&nbsp;<span class="builtinfunc" id="3406755">len</span><span class="op" id="3406758">(</span><span class="ident" id="3406759">lhs</span><span class="op" id="3406762">)</span>&nbsp;<span class="op" id="3406764">&gt;</span>&nbsp;<span class="num" id="3406766">2</span>&nbsp;<span class="op" id="3406768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406775">p</span><span class="op" id="3406776">.</span><span class="ident" id="3406777">errorExpected</span><span class="op" id="3406790">(</span><span class="ident" id="3406791">lhs</span><span class="op" id="3406794">[</span><span class="num" id="3406795">0</span><span class="op" id="3406796">]</span><span class="op" id="3406797">.</span><span class="ident" id="3406798">Pos</span><span class="op" id="3406801">(</span><span class="op" id="3406802">)</span><span class="op" id="3406803">,</span>&nbsp;<span class="string" id="3406805">&#34;1&nbsp;or&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="3406825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3406832">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;two&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406876">lhs</span>&nbsp;<span class="op" id="3406880">=</span>&nbsp;<span class="ident" id="3406882">lhs</span><span class="op" id="3406885">[</span><span class="num" id="3406886">0</span><span class="op" id="3406887">:</span><span class="num" id="3406888">2</span><span class="op" id="3406889">]</span><br>
<span class="lineno">1985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406901">pos</span>&nbsp;<span class="op" id="3406905">:=</span>&nbsp;<span class="ident" id="3406908">p</span><span class="op" id="3406909">.</span><span class="ident" id="3406910">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406918">p</span><span class="op" id="3406919">.</span><span class="ident" id="3406920">next</span><span class="op" id="3406924">(</span><span class="op" id="3406925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406931">rhs</span>&nbsp;<span class="op" id="3406935">:=</span>&nbsp;<span class="ident" id="3406938">p</span><span class="op" id="3406939">.</span><span class="ident" id="3406940">parseRhs</span><span class="op" id="3406948">(</span><span class="op" id="3406949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406955">as</span>&nbsp;<span class="op" id="3406958">:=</span>&nbsp;<span class="op" id="3406961">&amp;</span><span class="ident" id="3406962">ast</span><span class="op" id="3406965">.</span><span class="ident" id="3406966">AssignStmt</span><span class="op" id="3406976">{</span><span class="ident" id="3406977">Lhs</span><span class="op" id="3406980">:</span>&nbsp;<span class="ident" id="3406982">lhs</span><span class="op" id="3406985">,</span>&nbsp;<span class="ident" id="3406987">TokPos</span><span class="op" id="3406993">:</span>&nbsp;<span class="ident" id="3406995">pos</span><span class="op" id="3406998">,</span>&nbsp;<span class="ident" id="3407000">Tok</span><span class="op" id="3407003">:</span>&nbsp;<span class="ident" id="3407005">tok</span><span class="op" id="3407008">,</span>&nbsp;<span class="ident" id="3407010">Rhs</span><span class="op" id="3407013">:</span>&nbsp;<span class="op" id="3407015">[</span><span class="op" id="3407016">]</span><span class="ident" id="3407017">ast</span><span class="op" id="3407020">.</span><span class="ident" id="3407021">Expr</span><span class="op" id="3407025">{</span><span class="ident" id="3407026">rhs</span><span class="op" id="3407029">}</span><span class="op" id="3407030">}</span><br>
<span class="lineno">1990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407036">if</span>&nbsp;<span class="ident" id="3407039">tok</span>&nbsp;<span class="op" id="3407043">==</span>&nbsp;<span class="ident" id="3407046">token</span><span class="op" id="3407051">.</span><span class="ident" id="3407052">DEFINE</span>&nbsp;<span class="op" id="3407059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407066">p</span><span class="op" id="3407067">.</span><span class="ident" id="3407068">shortVarDecl</span><span class="op" id="3407080">(</span><span class="ident" id="3407081">as</span><span class="op" id="3407083">,</span>&nbsp;<span class="ident" id="3407085">lhs</span><span class="op" id="3407088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407100">comm</span>&nbsp;<span class="op" id="3407105">=</span>&nbsp;<span class="ident" id="3407107">as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407113">}</span>&nbsp;<span class="keyword" id="3407115">else</span>&nbsp;<span class="op" id="3407120">{</span><br>
<span class="lineno">1995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3407126">//&nbsp;lhs&nbsp;must&nbsp;be&nbsp;single&nbsp;receive&nbsp;operation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407170">if</span>&nbsp;<span class="builtinfunc" id="3407173">len</span><span class="op" id="3407176">(</span><span class="ident" id="3407177">lhs</span><span class="op" id="3407180">)</span>&nbsp;<span class="op" id="3407182">&gt;</span>&nbsp;<span class="num" id="3407184">1</span>&nbsp;<span class="op" id="3407186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407193">p</span><span class="op" id="3407194">.</span><span class="ident" id="3407195">errorExpected</span><span class="op" id="3407208">(</span><span class="ident" id="3407209">lhs</span><span class="op" id="3407212">[</span><span class="num" id="3407213">0</span><span class="op" id="3407214">]</span><span class="op" id="3407215">.</span><span class="ident" id="3407216">Pos</span><span class="op" id="3407219">(</span><span class="op" id="3407220">)</span><span class="op" id="3407221">,</span>&nbsp;<span class="string" id="3407223">&#34;1&nbsp;expression&#34;</span><span class="op" id="3407237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3407244">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407282">}</span><br>
<span class="lineno">2000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407288">comm</span>&nbsp;<span class="op" id="3407293">=</span>&nbsp;<span class="op" id="3407295">&amp;</span><span class="ident" id="3407296">ast</span><span class="op" id="3407299">.</span><span class="ident" id="3407300">ExprStmt</span><span class="op" id="3407308">{</span><span class="ident" id="3407309">X</span><span class="op" id="3407310">:</span>&nbsp;<span class="ident" id="3407312">lhs</span><span class="op" id="3407315">[</span><span class="num" id="3407316">0</span><span class="op" id="3407317">]</span><span class="op" id="3407318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407330">}</span>&nbsp;<span class="keyword" id="3407332">else</span>&nbsp;<span class="op" id="3407337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407341">p</span><span class="op" id="3407342">.</span><span class="ident" id="3407343">expect</span><span class="op" id="3407349">(</span><span class="ident" id="3407350">token</span><span class="op" id="3407355">.</span><span class="ident" id="3407356">DEFAULT</span><span class="op" id="3407363">)</span><br>
<span class="lineno">2005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407370">colon</span>&nbsp;<span class="op" id="3407376">:=</span>&nbsp;<span class="ident" id="3407379">p</span><span class="op" id="3407380">.</span><span class="ident" id="3407381">expect</span><span class="op" id="3407387">(</span><span class="ident" id="3407388">token</span><span class="op" id="3407393">.</span><span class="ident" id="3407394">COLON</span><span class="op" id="3407399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407402">body</span>&nbsp;<span class="op" id="3407407">:=</span>&nbsp;<span class="ident" id="3407410">p</span><span class="op" id="3407411">.</span><span class="ident" id="3407412">parseStmtList</span><span class="op" id="3407425">(</span><span class="op" id="3407426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407429">p</span><span class="op" id="3407430">.</span><span class="ident" id="3407431">closeScope</span><span class="op" id="3407441">(</span><span class="op" id="3407442">)</span><br>
<span class="lineno">2010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407446">return</span>&nbsp;<span class="op" id="3407453">&amp;</span><span class="ident" id="3407454">ast</span><span class="op" id="3407457">.</span><span class="ident" id="3407458">CommClause</span><span class="op" id="3407468">{</span><span class="ident" id="3407469">Case</span><span class="op" id="3407473">:</span>&nbsp;<span class="ident" id="3407475">pos</span><span class="op" id="3407478">,</span>&nbsp;<span class="ident" id="3407480">Comm</span><span class="op" id="3407484">:</span>&nbsp;<span class="ident" id="3407486">comm</span><span class="op" id="3407490">,</span>&nbsp;<span class="ident" id="3407492">Colon</span><span class="op" id="3407497">:</span>&nbsp;<span class="ident" id="3407499">colon</span><span class="op" id="3407504">,</span>&nbsp;<span class="ident" id="3407506">Body</span><span class="op" id="3407510">:</span>&nbsp;<span class="ident" id="3407512">body</span><span class="op" id="3407516">}</span><br>
<span class="lineno"></span><span class="op" id="3407518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3407521">func</span>&nbsp;<span class="op" id="3407526">(</span><span class="ident" id="3407527">p</span>&nbsp;<span class="op" id="3407529">*</span><span class="ident" id="3407530">parser</span><span class="op" id="3407536">)</span>&nbsp;<span class="ident" id="3407538">parseSelectStmt</span><span class="op" id="3407553">(</span><span class="op" id="3407554">)</span>&nbsp;<span class="op" id="3407556">*</span><span class="ident" id="3407557">ast</span><span class="op" id="3407560">.</span><span class="ident" id="3407561">SelectStmt</span>&nbsp;<span class="op" id="3407572">{</span><br>
<span class="lineno">2015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407575">if</span>&nbsp;<span class="ident" id="3407578">p</span><span class="op" id="3407579">.</span><span class="ident" id="3407580">trace</span>&nbsp;<span class="op" id="3407586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407590">defer</span>&nbsp;<span class="ident" id="3407596">un</span><span class="op" id="3407598">(</span><span class="ident" id="3407599">trace</span><span class="op" id="3407604">(</span><span class="ident" id="3407605">p</span><span class="op" id="3407606">,</span>&nbsp;<span class="string" id="3407608">&#34;SelectStmt&#34;</span><span class="op" id="3407620">)</span><span class="op" id="3407621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407628">pos</span>&nbsp;<span class="op" id="3407632">:=</span>&nbsp;<span class="ident" id="3407635">p</span><span class="op" id="3407636">.</span><span class="ident" id="3407637">expect</span><span class="op" id="3407643">(</span><span class="ident" id="3407644">token</span><span class="op" id="3407649">.</span><span class="ident" id="3407650">SELECT</span><span class="op" id="3407656">)</span><br>
<span class="lineno">2020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407659">lbrace</span>&nbsp;<span class="op" id="3407666">:=</span>&nbsp;<span class="ident" id="3407669">p</span><span class="op" id="3407670">.</span><span class="ident" id="3407671">expect</span><span class="op" id="3407677">(</span><span class="ident" id="3407678">token</span><span class="op" id="3407683">.</span><span class="ident" id="3407684">LBRACE</span><span class="op" id="3407690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407693">var</span>&nbsp;<span class="ident" id="3407697">list</span>&nbsp;<span class="op" id="3407702">[</span><span class="op" id="3407703">]</span><span class="ident" id="3407704">ast</span><span class="op" id="3407707">.</span><span class="ident" id="3407708">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407714">for</span>&nbsp;<span class="ident" id="3407718">p</span><span class="op" id="3407719">.</span><span class="ident" id="3407720">tok</span>&nbsp;<span class="op" id="3407724">==</span>&nbsp;<span class="ident" id="3407727">token</span><span class="op" id="3407732">.</span><span class="ident" id="3407733">CASE</span>&nbsp;<span class="op" id="3407738">||</span>&nbsp;<span class="ident" id="3407741">p</span><span class="op" id="3407742">.</span><span class="ident" id="3407743">tok</span>&nbsp;<span class="op" id="3407747">==</span>&nbsp;<span class="ident" id="3407750">token</span><span class="op" id="3407755">.</span><span class="ident" id="3407756">DEFAULT</span>&nbsp;<span class="op" id="3407764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407768">list</span>&nbsp;<span class="op" id="3407773">=</span>&nbsp;<span class="builtinfunc" id="3407775">append</span><span class="op" id="3407781">(</span><span class="ident" id="3407782">list</span><span class="op" id="3407786">,</span>&nbsp;<span class="ident" id="3407788">p</span><span class="op" id="3407789">.</span><span class="ident" id="3407790">parseCommClause</span><span class="op" id="3407805">(</span><span class="op" id="3407806">)</span><span class="op" id="3407807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407810">}</span><br>
<span class="lineno">2025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407813">rbrace</span>&nbsp;<span class="op" id="3407820">:=</span>&nbsp;<span class="ident" id="3407823">p</span><span class="op" id="3407824">.</span><span class="ident" id="3407825">expect</span><span class="op" id="3407831">(</span><span class="ident" id="3407832">token</span><span class="op" id="3407837">.</span><span class="ident" id="3407838">RBRACE</span><span class="op" id="3407844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407847">p</span><span class="op" id="3407848">.</span><span class="ident" id="3407849">expectSemi</span><span class="op" id="3407859">(</span><span class="op" id="3407860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407863">body</span>&nbsp;<span class="op" id="3407868">:=</span>&nbsp;<span class="op" id="3407871">&amp;</span><span class="ident" id="3407872">ast</span><span class="op" id="3407875">.</span><span class="ident" id="3407876">BlockStmt</span><span class="op" id="3407885">{</span><span class="ident" id="3407886">Lbrace</span><span class="op" id="3407892">:</span>&nbsp;<span class="ident" id="3407894">lbrace</span><span class="op" id="3407900">,</span>&nbsp;<span class="ident" id="3407902">List</span><span class="op" id="3407906">:</span>&nbsp;<span class="ident" id="3407908">list</span><span class="op" id="3407912">,</span>&nbsp;<span class="ident" id="3407914">Rbrace</span><span class="op" id="3407920">:</span>&nbsp;<span class="ident" id="3407922">rbrace</span><span class="op" id="3407928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407932">return</span>&nbsp;<span class="op" id="3407939">&amp;</span><span class="ident" id="3407940">ast</span><span class="op" id="3407943">.</span><span class="ident" id="3407944">SelectStmt</span><span class="op" id="3407954">{</span><span class="ident" id="3407955">Select</span><span class="op" id="3407961">:</span>&nbsp;<span class="ident" id="3407963">pos</span><span class="op" id="3407966">,</span>&nbsp;<span class="ident" id="3407968">Body</span><span class="op" id="3407972">:</span>&nbsp;<span class="ident" id="3407974">body</span><span class="op" id="3407978">}</span><br>
<span class="lineno">2030</span><span class="op" id="3407980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3407983">func</span>&nbsp;<span class="op" id="3407988">(</span><span class="ident" id="3407989">p</span>&nbsp;<span class="op" id="3407991">*</span><span class="ident" id="3407992">parser</span><span class="op" id="3407998">)</span>&nbsp;<span class="ident" id="3408000">parseForStmt</span><span class="op" id="3408012">(</span><span class="op" id="3408013">)</span>&nbsp;<span class="ident" id="3408015">ast</span><span class="op" id="3408018">.</span><span class="ident" id="3408019">Stmt</span>&nbsp;<span class="op" id="3408024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408027">if</span>&nbsp;<span class="ident" id="3408030">p</span><span class="op" id="3408031">.</span><span class="ident" id="3408032">trace</span>&nbsp;<span class="op" id="3408038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408042">defer</span>&nbsp;<span class="ident" id="3408048">un</span><span class="op" id="3408050">(</span><span class="ident" id="3408051">trace</span><span class="op" id="3408056">(</span><span class="ident" id="3408057">p</span><span class="op" id="3408058">,</span>&nbsp;<span class="string" id="3408060">&#34;ForStmt&#34;</span><span class="op" id="3408069">)</span><span class="op" id="3408070">)</span><br>
<span class="lineno">2035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408077">pos</span>&nbsp;<span class="op" id="3408081">:=</span>&nbsp;<span class="ident" id="3408084">p</span><span class="op" id="3408085">.</span><span class="ident" id="3408086">expect</span><span class="op" id="3408092">(</span><span class="ident" id="3408093">token</span><span class="op" id="3408098">.</span><span class="ident" id="3408099">FOR</span><span class="op" id="3408102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408105">p</span><span class="op" id="3408106">.</span><span class="ident" id="3408107">openScope</span><span class="op" id="3408116">(</span><span class="op" id="3408117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408120">defer</span>&nbsp;<span class="ident" id="3408126">p</span><span class="op" id="3408127">.</span><span class="ident" id="3408128">closeScope</span><span class="op" id="3408138">(</span><span class="op" id="3408139">)</span><br>
<span class="lineno">2040</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408143">var</span>&nbsp;<span class="ident" id="3408147">s1</span><span class="op" id="3408149">,</span>&nbsp;<span class="ident" id="3408151">s2</span><span class="op" id="3408153">,</span>&nbsp;<span class="ident" id="3408155">s3</span>&nbsp;<span class="ident" id="3408158">ast</span><span class="op" id="3408161">.</span><span class="ident" id="3408162">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408168">var</span>&nbsp;<span class="ident" id="3408172">isRange</span>&nbsp;<span class="builtintype" id="3408180">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408186">if</span>&nbsp;<span class="ident" id="3408189">p</span><span class="op" id="3408190">.</span><span class="ident" id="3408191">tok</span>&nbsp;<span class="op" id="3408195">!=</span>&nbsp;<span class="ident" id="3408198">token</span><span class="op" id="3408203">.</span><span class="ident" id="3408204">LBRACE</span>&nbsp;<span class="op" id="3408211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408215">prevLev</span>&nbsp;<span class="op" id="3408223">:=</span>&nbsp;<span class="ident" id="3408226">p</span><span class="op" id="3408227">.</span><span class="ident" id="3408228">exprLev</span><br>
<span class="lineno">2045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408238">p</span><span class="op" id="3408239">.</span><span class="ident" id="3408240">exprLev</span>&nbsp;<span class="op" id="3408248">=</span>&nbsp;<span class="op" id="3408250">-</span><span class="num" id="3408251">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408255">if</span>&nbsp;<span class="ident" id="3408258">p</span><span class="op" id="3408259">.</span><span class="ident" id="3408260">tok</span>&nbsp;<span class="op" id="3408264">!=</span>&nbsp;<span class="ident" id="3408267">token</span><span class="op" id="3408272">.</span><span class="ident" id="3408273">SEMICOLON</span>&nbsp;<span class="op" id="3408283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408288">if</span>&nbsp;<span class="ident" id="3408291">p</span><span class="op" id="3408292">.</span><span class="ident" id="3408293">tok</span>&nbsp;<span class="op" id="3408297">==</span>&nbsp;<span class="ident" id="3408300">token</span><span class="op" id="3408305">.</span><span class="ident" id="3408306">RANGE</span>&nbsp;<span class="op" id="3408312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3408318">//&nbsp;&#34;for&nbsp;range&nbsp;x&#34;&nbsp;(nil&nbsp;lhs&nbsp;in&nbsp;assignment)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408363">pos</span>&nbsp;<span class="op" id="3408367">:=</span>&nbsp;<span class="ident" id="3408370">p</span><span class="op" id="3408371">.</span><span class="ident" id="3408372">pos</span><br>
<span class="lineno">2050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408380">p</span><span class="op" id="3408381">.</span><span class="ident" id="3408382">next</span><span class="op" id="3408386">(</span><span class="op" id="3408387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408393">y</span>&nbsp;<span class="op" id="3408395">:=</span>&nbsp;<span class="op" id="3408398">[</span><span class="op" id="3408399">]</span><span class="ident" id="3408400">ast</span><span class="op" id="3408403">.</span><span class="ident" id="3408404">Expr</span><span class="op" id="3408408">{</span><span class="op" id="3408409">&amp;</span><span class="ident" id="3408410">ast</span><span class="op" id="3408413">.</span><span class="ident" id="3408414">UnaryExpr</span><span class="op" id="3408423">{</span><span class="ident" id="3408424">OpPos</span><span class="op" id="3408429">:</span>&nbsp;<span class="ident" id="3408431">pos</span><span class="op" id="3408434">,</span>&nbsp;<span class="ident" id="3408436">Op</span><span class="op" id="3408438">:</span>&nbsp;<span class="ident" id="3408440">token</span><span class="op" id="3408445">.</span><span class="ident" id="3408446">RANGE</span><span class="op" id="3408451">,</span>&nbsp;<span class="ident" id="3408453">X</span><span class="op" id="3408454">:</span>&nbsp;<span class="ident" id="3408456">p</span><span class="op" id="3408457">.</span><span class="ident" id="3408458">parseRhs</span><span class="op" id="3408466">(</span><span class="op" id="3408467">)</span><span class="op" id="3408468">}</span><span class="op" id="3408469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408475">s2</span>&nbsp;<span class="op" id="3408478">=</span>&nbsp;<span class="op" id="3408480">&amp;</span><span class="ident" id="3408481">ast</span><span class="op" id="3408484">.</span><span class="ident" id="3408485">AssignStmt</span><span class="op" id="3408495">{</span><span class="ident" id="3408496">Rhs</span><span class="op" id="3408499">:</span>&nbsp;<span class="ident" id="3408501">y</span><span class="op" id="3408502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408508">isRange</span>&nbsp;<span class="op" id="3408516">=</span>&nbsp;<span class="builtintype" id="3408518">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408526">}</span>&nbsp;<span class="keyword" id="3408528">else</span>&nbsp;<span class="op" id="3408533">{</span><br>
<span class="lineno">2055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408539">s2</span><span class="op" id="3408541">,</span>&nbsp;<span class="ident" id="3408543">isRange</span>&nbsp;<span class="op" id="3408551">=</span>&nbsp;<span class="ident" id="3408553">p</span><span class="op" id="3408554">.</span><span class="ident" id="3408555">parseSimpleStmt</span><span class="op" id="3408570">(</span><span class="ident" id="3408571">rangeOk</span><span class="op" id="3408578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408591">if</span>&nbsp;<span class="op" id="3408594">!</span><span class="ident" id="3408595">isRange</span>&nbsp;<span class="op" id="3408603">&amp;&amp;</span>&nbsp;<span class="ident" id="3408606">p</span><span class="op" id="3408607">.</span><span class="ident" id="3408608">tok</span>&nbsp;<span class="op" id="3408612">==</span>&nbsp;<span class="ident" id="3408615">token</span><span class="op" id="3408620">.</span><span class="ident" id="3408621">SEMICOLON</span>&nbsp;<span class="op" id="3408631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408636">p</span><span class="op" id="3408637">.</span><span class="ident" id="3408638">next</span><span class="op" id="3408642">(</span><span class="op" id="3408643">)</span><br>
<span class="lineno">2060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408648">s1</span>&nbsp;<span class="op" id="3408651">=</span>&nbsp;<span class="ident" id="3408653">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408659">s2</span>&nbsp;<span class="op" id="3408662">=</span>&nbsp;<span class="ident" id="3408664">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408671">if</span>&nbsp;<span class="ident" id="3408674">p</span><span class="op" id="3408675">.</span><span class="ident" id="3408676">tok</span>&nbsp;<span class="op" id="3408680">!=</span>&nbsp;<span class="ident" id="3408683">token</span><span class="op" id="3408688">.</span><span class="ident" id="3408689">SEMICOLON</span>&nbsp;<span class="op" id="3408699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408705">s2</span><span class="op" id="3408707">,</span>&nbsp;<span class="ident" id="3408709">_</span>&nbsp;<span class="op" id="3408711">=</span>&nbsp;<span class="ident" id="3408713">p</span><span class="op" id="3408714">.</span><span class="ident" id="3408715">parseSimpleStmt</span><span class="op" id="3408730">(</span><span class="ident" id="3408731">basic</span><span class="op" id="3408736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408741">}</span><br>
<span class="lineno">2065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408746">p</span><span class="op" id="3408747">.</span><span class="ident" id="3408748">expectSemi</span><span class="op" id="3408758">(</span><span class="op" id="3408759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408764">if</span>&nbsp;<span class="ident" id="3408767">p</span><span class="op" id="3408768">.</span><span class="ident" id="3408769">tok</span>&nbsp;<span class="op" id="3408773">!=</span>&nbsp;<span class="ident" id="3408776">token</span><span class="op" id="3408781">.</span><span class="ident" id="3408782">LBRACE</span>&nbsp;<span class="op" id="3408789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408795">s3</span><span class="op" id="3408797">,</span>&nbsp;<span class="ident" id="3408799">_</span>&nbsp;<span class="op" id="3408801">=</span>&nbsp;<span class="ident" id="3408803">p</span><span class="op" id="3408804">.</span><span class="ident" id="3408805">parseSimpleStmt</span><span class="op" id="3408820">(</span><span class="ident" id="3408821">basic</span><span class="op" id="3408826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408835">}</span><br>
<span class="lineno">2070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408839">p</span><span class="op" id="3408840">.</span><span class="ident" id="3408841">exprLev</span>&nbsp;<span class="op" id="3408849">=</span>&nbsp;<span class="ident" id="3408851">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408864">body</span>&nbsp;<span class="op" id="3408869">:=</span>&nbsp;<span class="ident" id="3408872">p</span><span class="op" id="3408873">.</span><span class="ident" id="3408874">parseBlockStmt</span><span class="op" id="3408888">(</span><span class="op" id="3408889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408892">p</span><span class="op" id="3408893">.</span><span class="ident" id="3408894">expectSemi</span><span class="op" id="3408904">(</span><span class="op" id="3408905">)</span><br>
<span class="lineno">2075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408909">if</span>&nbsp;<span class="ident" id="3408912">isRange</span>&nbsp;<span class="op" id="3408920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408924">as</span>&nbsp;<span class="op" id="3408927">:=</span>&nbsp;<span class="ident" id="3408930">s2</span><span class="op" id="3408932">.</span><span class="op" id="3408933">(</span><span class="op" id="3408934">*</span><span class="ident" id="3408935">ast</span><span class="op" id="3408938">.</span><span class="ident" id="3408939">AssignStmt</span><span class="op" id="3408949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3408953">//&nbsp;check&nbsp;lhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408968">var</span>&nbsp;<span class="ident" id="3408972">key</span><span class="op" id="3408975">,</span>&nbsp;<span class="ident" id="3408977">value</span>&nbsp;<span class="ident" id="3408983">ast</span><span class="op" id="3408986">.</span><span class="ident" id="3408987">Expr</span><br>
<span class="lineno">2080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408994">switch</span>&nbsp;<span class="builtinfunc" id="3409001">len</span><span class="op" id="3409004">(</span><span class="ident" id="3409005">as</span><span class="op" id="3409007">.</span><span class="ident" id="3409008">Lhs</span><span class="op" id="3409011">)</span>&nbsp;<span class="op" id="3409013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409017">case</span>&nbsp;<span class="num" id="3409022">0</span><span class="op" id="3409023">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3409028">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409047">case</span>&nbsp;<span class="num" id="3409052">1</span><span class="op" id="3409053">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409058">key</span>&nbsp;<span class="op" id="3409062">=</span>&nbsp;<span class="ident" id="3409064">as</span><span class="op" id="3409066">.</span><span class="ident" id="3409067">Lhs</span><span class="op" id="3409070">[</span><span class="num" id="3409071">0</span><span class="op" id="3409072">]</span><br>
<span class="lineno">2085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409076">case</span>&nbsp;<span class="num" id="3409081">2</span><span class="op" id="3409082">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409087">key</span><span class="op" id="3409090">,</span>&nbsp;<span class="ident" id="3409092">value</span>&nbsp;<span class="op" id="3409098">=</span>&nbsp;<span class="ident" id="3409100">as</span><span class="op" id="3409102">.</span><span class="ident" id="3409103">Lhs</span><span class="op" id="3409106">[</span><span class="num" id="3409107">0</span><span class="op" id="3409108">]</span><span class="op" id="3409109">,</span>&nbsp;<span class="ident" id="3409111">as</span><span class="op" id="3409113">.</span><span class="ident" id="3409114">Lhs</span><span class="op" id="3409117">[</span><span class="num" id="3409118">1</span><span class="op" id="3409119">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409123">default</span><span class="op" id="3409130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409135">p</span><span class="op" id="3409136">.</span><span class="ident" id="3409137">errorExpected</span><span class="op" id="3409150">(</span><span class="ident" id="3409151">as</span><span class="op" id="3409153">.</span><span class="ident" id="3409154">Lhs</span><span class="op" id="3409157">[</span><span class="builtinfunc" id="3409158">len</span><span class="op" id="3409161">(</span><span class="ident" id="3409162">as</span><span class="op" id="3409164">.</span><span class="ident" id="3409165">Lhs</span><span class="op" id="3409168">)</span><span class="op" id="3409169">-</span><span class="num" id="3409170">1</span><span class="op" id="3409171">]</span><span class="op" id="3409172">.</span><span class="ident" id="3409173">Pos</span><span class="op" id="3409176">(</span><span class="op" id="3409177">)</span><span class="op" id="3409178">,</span>&nbsp;<span class="string" id="3409180">&#34;at&nbsp;most&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="3409203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409208">return</span>&nbsp;<span class="op" id="3409215">&amp;</span><span class="ident" id="3409216">ast</span><span class="op" id="3409219">.</span><span class="ident" id="3409220">BadStmt</span><span class="op" id="3409227">{</span><span class="ident" id="3409228">From</span><span class="op" id="3409232">:</span>&nbsp;<span class="ident" id="3409234">pos</span><span class="op" id="3409237">,</span>&nbsp;<span class="ident" id="3409239">To</span><span class="op" id="3409241">:</span>&nbsp;<span class="ident" id="3409243">p</span><span class="op" id="3409244">.</span><span class="ident" id="3409245">safePos</span><span class="op" id="3409252">(</span><span class="ident" id="3409253">body</span><span class="op" id="3409257">.</span><span class="ident" id="3409258">End</span><span class="op" id="3409261">(</span><span class="op" id="3409262">)</span><span class="op" id="3409263">)</span><span class="op" id="3409264">}</span><br>
<span class="lineno">2090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3409272">//&nbsp;parseSimpleStmt&nbsp;returned&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3409325">//&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409381">x</span>&nbsp;<span class="op" id="3409383">:=</span>&nbsp;<span class="ident" id="3409386">as</span><span class="op" id="3409388">.</span><span class="ident" id="3409389">Rhs</span><span class="op" id="3409392">[</span><span class="num" id="3409393">0</span><span class="op" id="3409394">]</span><span class="op" id="3409395">.</span><span class="op" id="3409396">(</span><span class="op" id="3409397">*</span><span class="ident" id="3409398">ast</span><span class="op" id="3409401">.</span><span class="ident" id="3409402">UnaryExpr</span><span class="op" id="3409411">)</span><span class="op" id="3409412">.</span><span class="ident" id="3409413">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409417">return</span>&nbsp;<span class="op" id="3409424">&amp;</span><span class="ident" id="3409425">ast</span><span class="op" id="3409428">.</span><span class="ident" id="3409429">RangeStmt</span><span class="op" id="3409438">{</span><br>
<span class="lineno">2095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409443">For</span><span class="op" id="3409446">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3409451">pos</span><span class="op" id="3409454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409459">Key</span><span class="op" id="3409462">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3409467">key</span><span class="op" id="3409470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409475">Value</span><span class="op" id="3409480">:</span>&nbsp;&nbsp;<span class="ident" id="3409483">value</span><span class="op" id="3409488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409493">TokPos</span><span class="op" id="3409499">:</span>&nbsp;<span class="ident" id="3409501">as</span><span class="op" id="3409503">.</span><span class="ident" id="3409504">TokPos</span><span class="op" id="3409510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409515">Tok</span><span class="op" id="3409518">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3409523">as</span><span class="op" id="3409525">.</span><span class="ident" id="3409526">Tok</span><span class="op" id="3409529">,</span><br>
<span class="lineno">2100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409534">X</span><span class="op" id="3409535">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3409542">x</span><span class="op" id="3409543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409548">Body</span><span class="op" id="3409552">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3409556">body</span><span class="op" id="3409560">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3409571">//&nbsp;regular&nbsp;for&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409597">return</span>&nbsp;<span class="op" id="3409604">&amp;</span><span class="ident" id="3409605">ast</span><span class="op" id="3409608">.</span><span class="ident" id="3409609">ForStmt</span><span class="op" id="3409616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409620">For</span><span class="op" id="3409623">:</span>&nbsp;&nbsp;<span class="ident" id="3409626">pos</span><span class="op" id="3409629">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409633">Init</span><span class="op" id="3409637">:</span>&nbsp;<span class="ident" id="3409639">s1</span><span class="op" id="3409641">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409645">Cond</span><span class="op" id="3409649">:</span>&nbsp;<span class="ident" id="3409651">p</span><span class="op" id="3409652">.</span><span class="ident" id="3409653">makeExpr</span><span class="op" id="3409661">(</span><span class="ident" id="3409662">s2</span><span class="op" id="3409664">,</span>&nbsp;<span class="string" id="3409666">&#34;boolean&nbsp;or&nbsp;range&nbsp;expression&#34;</span><span class="op" id="3409695">)</span><span class="op" id="3409696">,</span><br>
<span class="lineno">2110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409700">Post</span><span class="op" id="3409704">:</span>&nbsp;<span class="ident" id="3409706">s3</span><span class="op" id="3409708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409712">Body</span><span class="op" id="3409716">:</span>&nbsp;<span class="ident" id="3409718">body</span><span class="op" id="3409722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409725">}</span><br>
<span class="lineno"></span><span class="op" id="3409727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2115</span><span class="keyword" id="3409730">func</span>&nbsp;<span class="op" id="3409735">(</span><span class="ident" id="3409736">p</span>&nbsp;<span class="op" id="3409738">*</span><span class="ident" id="3409739">parser</span><span class="op" id="3409745">)</span>&nbsp;<span class="ident" id="3409747">parseStmt</span><span class="op" id="3409756">(</span><span class="op" id="3409757">)</span>&nbsp;<span class="op" id="3409759">(</span><span class="ident" id="3409760">s</span>&nbsp;<span class="ident" id="3409762">ast</span><span class="op" id="3409765">.</span><span class="ident" id="3409766">Stmt</span><span class="op" id="3409770">)</span>&nbsp;<span class="op" id="3409772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409775">if</span>&nbsp;<span class="ident" id="3409778">p</span><span class="op" id="3409779">.</span><span class="ident" id="3409780">trace</span>&nbsp;<span class="op" id="3409786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409790">defer</span>&nbsp;<span class="ident" id="3409796">un</span><span class="op" id="3409798">(</span><span class="ident" id="3409799">trace</span><span class="op" id="3409804">(</span><span class="ident" id="3409805">p</span><span class="op" id="3409806">,</span>&nbsp;<span class="string" id="3409808">&#34;Statement&#34;</span><span class="op" id="3409819">)</span><span class="op" id="3409820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409827">switch</span>&nbsp;<span class="ident" id="3409834">p</span><span class="op" id="3409835">.</span><span class="ident" id="3409836">tok</span>&nbsp;<span class="op" id="3409840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409843">case</span>&nbsp;<span class="ident" id="3409848">token</span><span class="op" id="3409853">.</span><span class="ident" id="3409854">CONST</span><span class="op" id="3409859">,</span>&nbsp;<span class="ident" id="3409861">token</span><span class="op" id="3409866">.</span><span class="ident" id="3409867">TYPE</span><span class="op" id="3409871">,</span>&nbsp;<span class="ident" id="3409873">token</span><span class="op" id="3409878">.</span><span class="ident" id="3409879">VAR</span><span class="op" id="3409882">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409886">s</span>&nbsp;<span class="op" id="3409888">=</span>&nbsp;<span class="op" id="3409890">&amp;</span><span class="ident" id="3409891">ast</span><span class="op" id="3409894">.</span><span class="ident" id="3409895">DeclStmt</span><span class="op" id="3409903">{</span><span class="ident" id="3409904">Decl</span><span class="op" id="3409908">:</span>&nbsp;<span class="ident" id="3409910">p</span><span class="op" id="3409911">.</span><span class="ident" id="3409912">parseDecl</span><span class="op" id="3409921">(</span><span class="ident" id="3409922">syncStmt</span><span class="op" id="3409930">)</span><span class="op" id="3409931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409934">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3409941">//&nbsp;tokens&nbsp;that&nbsp;may&nbsp;start&nbsp;an&nbsp;expression</span><br>
<span class="lineno">2125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409982">token</span><span class="op" id="3409987">.</span><span class="ident" id="3409988">IDENT</span><span class="op" id="3409993">,</span>&nbsp;<span class="ident" id="3409995">token</span><span class="op" id="3410000">.</span><span class="ident" id="3410001">INT</span><span class="op" id="3410004">,</span>&nbsp;<span class="ident" id="3410006">token</span><span class="op" id="3410011">.</span><span class="ident" id="3410012">FLOAT</span><span class="op" id="3410017">,</span>&nbsp;<span class="ident" id="3410019">token</span><span class="op" id="3410024">.</span><span class="ident" id="3410025">IMAG</span><span class="op" id="3410029">,</span>&nbsp;<span class="ident" id="3410031">token</span><span class="op" id="3410036">.</span><span class="ident" id="3410037">CHAR</span><span class="op" id="3410041">,</span>&nbsp;<span class="ident" id="3410043">token</span><span class="op" id="3410048">.</span><span class="ident" id="3410049">STRING</span><span class="op" id="3410055">,</span>&nbsp;<span class="ident" id="3410057">token</span><span class="op" id="3410062">.</span><span class="ident" id="3410063">FUNC</span><span class="op" id="3410067">,</span>&nbsp;<span class="ident" id="3410069">token</span><span class="op" id="3410074">.</span><span class="ident" id="3410075">LPAREN</span><span class="op" id="3410081">,</span>&nbsp;<span class="comment" id="3410083">//&nbsp;operands</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410097">token</span><span class="op" id="3410102">.</span><span class="ident" id="3410103">LBRACK</span><span class="op" id="3410109">,</span>&nbsp;<span class="ident" id="3410111">token</span><span class="op" id="3410116">.</span><span class="ident" id="3410117">STRUCT</span><span class="op" id="3410123">,</span>&nbsp;<span class="comment" id="3410125">//&nbsp;composite&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410146">token</span><span class="op" id="3410151">.</span><span class="ident" id="3410152">ADD</span><span class="op" id="3410155">,</span>&nbsp;<span class="ident" id="3410157">token</span><span class="op" id="3410162">.</span><span class="ident" id="3410163">SUB</span><span class="op" id="3410166">,</span>&nbsp;<span class="ident" id="3410168">token</span><span class="op" id="3410173">.</span><span class="ident" id="3410174">MUL</span><span class="op" id="3410177">,</span>&nbsp;<span class="ident" id="3410179">token</span><span class="op" id="3410184">.</span><span class="ident" id="3410185">AND</span><span class="op" id="3410188">,</span>&nbsp;<span class="ident" id="3410190">token</span><span class="op" id="3410195">.</span><span class="ident" id="3410196">XOR</span><span class="op" id="3410199">,</span>&nbsp;<span class="ident" id="3410201">token</span><span class="op" id="3410206">.</span><span class="ident" id="3410207">ARROW</span><span class="op" id="3410212">,</span>&nbsp;<span class="ident" id="3410214">token</span><span class="op" id="3410219">.</span><span class="ident" id="3410220">NOT</span><span class="op" id="3410223">:</span>&nbsp;<span class="comment" id="3410225">//&nbsp;unary&nbsp;operators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410246">s</span><span class="op" id="3410247">,</span>&nbsp;<span class="ident" id="3410249">_</span>&nbsp;<span class="op" id="3410251">=</span>&nbsp;<span class="ident" id="3410253">p</span><span class="op" id="3410254">.</span><span class="ident" id="3410255">parseSimpleStmt</span><span class="op" id="3410270">(</span><span class="ident" id="3410271">labelOk</span><span class="op" id="3410278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3410282">//&nbsp;because&nbsp;of&nbsp;the&nbsp;required&nbsp;look-ahead,&nbsp;labeled&nbsp;statements&nbsp;are</span><br>
<span class="lineno">2130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3410346">//&nbsp;parsed&nbsp;by&nbsp;parseSimpleStmt&nbsp;-&nbsp;don&#39;t&nbsp;expect&nbsp;a&nbsp;semicolon&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3410410">//&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410420">if</span>&nbsp;<span class="ident" id="3410423">_</span><span class="op" id="3410424">,</span>&nbsp;<span class="ident" id="3410426">isLabeledStmt</span>&nbsp;<span class="op" id="3410440">:=</span>&nbsp;<span class="ident" id="3410443">s</span><span class="op" id="3410444">.</span><span class="op" id="3410445">(</span><span class="op" id="3410446">*</span><span class="ident" id="3410447">ast</span><span class="op" id="3410450">.</span><span class="ident" id="3410451">LabeledStmt</span><span class="op" id="3410462">)</span><span class="op" id="3410463">;</span>&nbsp;<span class="op" id="3410465">!</span><span class="ident" id="3410466">isLabeledStmt</span>&nbsp;<span class="op" id="3410480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410485">p</span><span class="op" id="3410486">.</span><span class="ident" id="3410487">expectSemi</span><span class="op" id="3410497">(</span><span class="op" id="3410498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3410502">}</span><br>
<span class="lineno">2135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410505">case</span>&nbsp;<span class="ident" id="3410510">token</span><span class="op" id="3410515">.</span><span class="ident" id="3410516">GO</span><span class="op" id="3410518">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410522">s</span>&nbsp;<span class="op" id="3410524">=</span>&nbsp;<span class="ident" id="3410526">p</span><span class="op" id="3410527">.</span><span class="ident" id="3410528">parseGoStmt</span><span class="op" id="3410539">(</span><span class="op" id="3410540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410543">case</span>&nbsp;<span class="ident" id="3410548">token</span><span class="op" id="3410553">.</span><span class="ident" id="3410554">DEFER</span><span class="op" id="3410559">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410563">s</span>&nbsp;<span class="op" id="3410565">=</span>&nbsp;<span class="ident" id="3410567">p</span><span class="op" id="3410568">.</span><span class="ident" id="3410569">parseDeferStmt</span><span class="op" id="3410583">(</span><span class="op" id="3410584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410587">case</span>&nbsp;<span class="ident" id="3410592">token</span><span class="op" id="3410597">.</span><span class="ident" id="3410598">RETURN</span><span class="op" id="3410604">:</span><br>
<span class="lineno">2140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410608">s</span>&nbsp;<span class="op" id="3410610">=</span>&nbsp;<span class="ident" id="3410612">p</span><span class="op" id="3410613">.</span><span class="ident" id="3410614">parseReturnStmt</span><span class="op" id="3410629">(</span><span class="op" id="3410630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410633">case</span>&nbsp;<span class="ident" id="3410638">token</span><span class="op" id="3410643">.</span><span class="ident" id="3410644">BREAK</span><span class="op" id="3410649">,</span>&nbsp;<span class="ident" id="3410651">token</span><span class="op" id="3410656">.</span><span class="ident" id="3410657">CONTINUE</span><span class="op" id="3410665">,</span>&nbsp;<span class="ident" id="3410667">token</span><span class="op" id="3410672">.</span><span class="ident" id="3410673">GOTO</span><span class="op" id="3410677">,</span>&nbsp;<span class="ident" id="3410679">token</span><span class="op" id="3410684">.</span><span class="ident" id="3410685">FALLTHROUGH</span><span class="op" id="3410696">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410700">s</span>&nbsp;<span class="op" id="3410702">=</span>&nbsp;<span class="ident" id="3410704">p</span><span class="op" id="3410705">.</span><span class="ident" id="3410706">parseBranchStmt</span><span class="op" id="3410721">(</span><span class="ident" id="3410722">p</span><span class="op" id="3410723">.</span><span class="ident" id="3410724">tok</span><span class="op" id="3410727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410730">case</span>&nbsp;<span class="ident" id="3410735">token</span><span class="op" id="3410740">.</span><span class="ident" id="3410741">LBRACE</span><span class="op" id="3410747">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410751">s</span>&nbsp;<span class="op" id="3410753">=</span>&nbsp;<span class="ident" id="3410755">p</span><span class="op" id="3410756">.</span><span class="ident" id="3410757">parseBlockStmt</span><span class="op" id="3410771">(</span><span class="op" id="3410772">)</span><br>
<span class="lineno">2145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410776">p</span><span class="op" id="3410777">.</span><span class="ident" id="3410778">expectSemi</span><span class="op" id="3410788">(</span><span class="op" id="3410789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410792">case</span>&nbsp;<span class="ident" id="3410797">token</span><span class="op" id="3410802">.</span><span class="ident" id="3410803">IF</span><span class="op" id="3410805">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410809">s</span>&nbsp;<span class="op" id="3410811">=</span>&nbsp;<span class="ident" id="3410813">p</span><span class="op" id="3410814">.</span><span class="ident" id="3410815">parseIfStmt</span><span class="op" id="3410826">(</span><span class="op" id="3410827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410830">case</span>&nbsp;<span class="ident" id="3410835">token</span><span class="op" id="3410840">.</span><span class="ident" id="3410841">SWITCH</span><span class="op" id="3410847">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410851">s</span>&nbsp;<span class="op" id="3410853">=</span>&nbsp;<span class="ident" id="3410855">p</span><span class="op" id="3410856">.</span><span class="ident" id="3410857">parseSwitchStmt</span><span class="op" id="3410872">(</span><span class="op" id="3410873">)</span><br>
<span class="lineno">2150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410876">case</span>&nbsp;<span class="ident" id="3410881">token</span><span class="op" id="3410886">.</span><span class="ident" id="3410887">SELECT</span><span class="op" id="3410893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410897">s</span>&nbsp;<span class="op" id="3410899">=</span>&nbsp;<span class="ident" id="3410901">p</span><span class="op" id="3410902">.</span><span class="ident" id="3410903">parseSelectStmt</span><span class="op" id="3410918">(</span><span class="op" id="3410919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410922">case</span>&nbsp;<span class="ident" id="3410927">token</span><span class="op" id="3410932">.</span><span class="ident" id="3410933">FOR</span><span class="op" id="3410936">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410940">s</span>&nbsp;<span class="op" id="3410942">=</span>&nbsp;<span class="ident" id="3410944">p</span><span class="op" id="3410945">.</span><span class="ident" id="3410946">parseForStmt</span><span class="op" id="3410958">(</span><span class="op" id="3410959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410962">case</span>&nbsp;<span class="ident" id="3410967">token</span><span class="op" id="3410972">.</span><span class="ident" id="3410973">SEMICOLON</span><span class="op" id="3410982">:</span><br>
<span class="lineno">2155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410986">s</span>&nbsp;<span class="op" id="3410988">=</span>&nbsp;<span class="op" id="3410990">&amp;</span><span class="ident" id="3410991">ast</span><span class="op" id="3410994">.</span><span class="ident" id="3410995">EmptyStmt</span><span class="op" id="3411004">{</span><span class="ident" id="3411005">Semicolon</span><span class="op" id="3411014">:</span>&nbsp;<span class="ident" id="3411016">p</span><span class="op" id="3411017">.</span><span class="ident" id="3411018">pos</span><span class="op" id="3411021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411025">p</span><span class="op" id="3411026">.</span><span class="ident" id="3411027">next</span><span class="op" id="3411031">(</span><span class="op" id="3411032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411035">case</span>&nbsp;<span class="ident" id="3411040">token</span><span class="op" id="3411045">.</span><span class="ident" id="3411046">RBRACE</span><span class="op" id="3411052">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3411056">//&nbsp;a&nbsp;semicolon&nbsp;may&nbsp;be&nbsp;omitted&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#34;}&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411109">s</span>&nbsp;<span class="op" id="3411111">=</span>&nbsp;<span class="op" id="3411113">&amp;</span><span class="ident" id="3411114">ast</span><span class="op" id="3411117">.</span><span class="ident" id="3411118">EmptyStmt</span><span class="op" id="3411127">{</span><span class="ident" id="3411128">Semicolon</span><span class="op" id="3411137">:</span>&nbsp;<span class="ident" id="3411139">p</span><span class="op" id="3411140">.</span><span class="ident" id="3411141">pos</span><span class="op" id="3411144">}</span><br>
<span class="lineno">2160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411147">default</span><span class="op" id="3411154">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3411158">//&nbsp;no&nbsp;statement&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411182">pos</span>&nbsp;<span class="op" id="3411186">:=</span>&nbsp;<span class="ident" id="3411189">p</span><span class="op" id="3411190">.</span><span class="ident" id="3411191">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411197">p</span><span class="op" id="3411198">.</span><span class="ident" id="3411199">errorExpected</span><span class="op" id="3411212">(</span><span class="ident" id="3411213">pos</span><span class="op" id="3411216">,</span>&nbsp;<span class="string" id="3411218">&#34;statement&#34;</span><span class="op" id="3411229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411233">syncStmt</span><span class="op" id="3411241">(</span><span class="ident" id="3411242">p</span><span class="op" id="3411243">)</span><br>
<span class="lineno">2165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411247">s</span>&nbsp;<span class="op" id="3411249">=</span>&nbsp;<span class="op" id="3411251">&amp;</span><span class="ident" id="3411252">ast</span><span class="op" id="3411255">.</span><span class="ident" id="3411256">BadStmt</span><span class="op" id="3411263">{</span><span class="ident" id="3411264">From</span><span class="op" id="3411268">:</span>&nbsp;<span class="ident" id="3411270">pos</span><span class="op" id="3411273">,</span>&nbsp;<span class="ident" id="3411275">To</span><span class="op" id="3411277">:</span>&nbsp;<span class="ident" id="3411279">p</span><span class="op" id="3411280">.</span><span class="ident" id="3411281">pos</span><span class="op" id="3411284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411291">return</span><br>
<span class="lineno"></span><span class="op" id="3411298">}</span><br>
<span class="lineno">2170</span><br>
<span class="lineno"></span><span class="comment" id="3411301">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3411381">//&nbsp;Declarations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3411398">type</span>&nbsp;<span class="ident" id="3411403">parseSpecFunction</span>&nbsp;<span class="keyword" id="3411421">func</span><span class="op" id="3411425">(</span><span class="ident" id="3411426">doc</span>&nbsp;<span class="op" id="3411430">*</span><span class="ident" id="3411431">ast</span><span class="op" id="3411434">.</span><span class="ident" id="3411435">CommentGroup</span><span class="op" id="3411447">,</span>&nbsp;<span class="ident" id="3411449">keyword</span>&nbsp;<span class="ident" id="3411457">token</span><span class="op" id="3411462">.</span><span class="ident" id="3411463">Token</span><span class="op" id="3411468">,</span>&nbsp;<span class="ident" id="3411470">iota</span>&nbsp;<span class="builtintype" id="3411475">int</span><span class="op" id="3411478">)</span>&nbsp;<span class="ident" id="3411480">ast</span><span class="op" id="3411483">.</span><span class="ident" id="3411484">Spec</span><br>
<span class="lineno">2175</span><br>
<span class="lineno"></span><span class="keyword" id="3411490">func</span>&nbsp;<span class="ident" id="3411495">isValidImport</span><span class="op" id="3411508">(</span><span class="ident" id="3411509">lit</span>&nbsp;<span class="builtintype" id="3411513">string</span><span class="op" id="3411519">)</span>&nbsp;<span class="builtintype" id="3411521">bool</span>&nbsp;<span class="op" id="3411526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411529">const</span>&nbsp;<span class="ident" id="3411535">illegalChars</span>&nbsp;<span class="op" id="3411548">=</span>&nbsp;<span class="string" id="3411550">`!&#34;#$%&amp;&#39;()*,:;&lt;=&gt;?[\]^{|}`</span>&nbsp;<span class="op" id="3411577">+</span>&nbsp;<span class="string" id="3411579">&#34;`\uFFFD&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411590">s</span><span class="op" id="3411591">,</span>&nbsp;<span class="ident" id="3411593">_</span>&nbsp;<span class="op" id="3411595">:=</span>&nbsp;<span class="ident" id="3411598">strconv</span><span class="op" id="3411605">.</span><span class="ident" id="3411606">Unquote</span><span class="op" id="3411613">(</span><span class="ident" id="3411614">lit</span><span class="op" id="3411617">)</span>&nbsp;<span class="comment" id="3411619">//&nbsp;go/scanner&nbsp;returns&nbsp;a&nbsp;legal&nbsp;string&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411665">for</span>&nbsp;<span class="ident" id="3411669">_</span><span class="op" id="3411670">,</span>&nbsp;<span class="ident" id="3411672">r</span>&nbsp;<span class="op" id="3411674">:=</span>&nbsp;<span class="keyword" id="3411677">range</span>&nbsp;<span class="ident" id="3411683">s</span>&nbsp;<span class="op" id="3411685">{</span><br>
<span class="lineno">2180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411689">if</span>&nbsp;<span class="op" id="3411692">!</span><span class="ident" id="3411693">unicode</span><span class="op" id="3411700">.</span><span class="ident" id="3411701">IsGraphic</span><span class="op" id="3411710">(</span><span class="ident" id="3411711">r</span><span class="op" id="3411712">)</span>&nbsp;<span class="op" id="3411714">||</span>&nbsp;<span class="ident" id="3411717">unicode</span><span class="op" id="3411724">.</span><span class="ident" id="3411725">IsSpace</span><span class="op" id="3411732">(</span><span class="ident" id="3411733">r</span><span class="op" id="3411734">)</span>&nbsp;<span class="op" id="3411736">||</span>&nbsp;<span class="ident" id="3411739">strings</span><span class="op" id="3411746">.</span><span class="ident" id="3411747">ContainsRune</span><span class="op" id="3411759">(</span><span class="ident" id="3411760">illegalChars</span><span class="op" id="3411772">,</span>&nbsp;<span class="ident" id="3411774">r</span><span class="op" id="3411775">)</span>&nbsp;<span class="op" id="3411777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411782">return</span>&nbsp;<span class="builtintype" id="3411789">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411803">return</span>&nbsp;<span class="ident" id="3411810">s</span>&nbsp;<span class="op" id="3411812">!=</span>&nbsp;<span class="string" id="3411815">&#34;&#34;</span><br>
<span class="lineno">2185</span><span class="op" id="3411818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3411821">func</span>&nbsp;<span class="op" id="3411826">(</span><span class="ident" id="3411827">p</span>&nbsp;<span class="op" id="3411829">*</span><span class="ident" id="3411830">parser</span><span class="op" id="3411836">)</span>&nbsp;<span class="ident" id="3411838">parseImportSpec</span><span class="op" id="3411853">(</span><span class="ident" id="3411854">doc</span>&nbsp;<span class="op" id="3411858">*</span><span class="ident" id="3411859">ast</span><span class="op" id="3411862">.</span><span class="ident" id="3411863">CommentGroup</span><span class="op" id="3411875">,</span>&nbsp;<span class="ident" id="3411877">_</span>&nbsp;<span class="ident" id="3411879">token</span><span class="op" id="3411884">.</span><span class="ident" id="3411885">Token</span><span class="op" id="3411890">,</span>&nbsp;<span class="ident" id="3411892">_</span>&nbsp;<span class="builtintype" id="3411894">int</span><span class="op" id="3411897">)</span>&nbsp;<span class="ident" id="3411899">ast</span><span class="op" id="3411902">.</span><span class="ident" id="3411903">Spec</span>&nbsp;<span class="op" id="3411908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411911">if</span>&nbsp;<span class="ident" id="3411914">p</span><span class="op" id="3411915">.</span><span class="ident" id="3411916">trace</span>&nbsp;<span class="op" id="3411922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411926">defer</span>&nbsp;<span class="ident" id="3411932">un</span><span class="op" id="3411934">(</span><span class="ident" id="3411935">trace</span><span class="op" id="3411940">(</span><span class="ident" id="3411941">p</span><span class="op" id="3411942">,</span>&nbsp;<span class="string" id="3411944">&#34;ImportSpec&#34;</span><span class="op" id="3411956">)</span><span class="op" id="3411957">)</span><br>
<span class="lineno">2190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411964">var</span>&nbsp;<span class="ident" id="3411968">ident</span>&nbsp;<span class="op" id="3411974">*</span><span class="ident" id="3411975">ast</span><span class="op" id="3411978">.</span><span class="ident" id="3411979">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411986">switch</span>&nbsp;<span class="ident" id="3411993">p</span><span class="op" id="3411994">.</span><span class="ident" id="3411995">tok</span>&nbsp;<span class="op" id="3411999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412002">case</span>&nbsp;<span class="ident" id="3412007">token</span><span class="op" id="3412012">.</span><span class="ident" id="3412013">PERIOD</span><span class="op" id="3412019">:</span><br>
<span class="lineno">2195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412023">ident</span>&nbsp;<span class="op" id="3412029">=</span>&nbsp;<span class="op" id="3412031">&amp;</span><span class="ident" id="3412032">ast</span><span class="op" id="3412035">.</span><span class="ident" id="3412036">Ident</span><span class="op" id="3412041">{</span><span class="ident" id="3412042">NamePos</span><span class="op" id="3412049">:</span>&nbsp;<span class="ident" id="3412051">p</span><span class="op" id="3412052">.</span><span class="ident" id="3412053">pos</span><span class="op" id="3412056">,</span>&nbsp;<span class="ident" id="3412058">Name</span><span class="op" id="3412062">:</span>&nbsp;<span class="string" id="3412064">&#34;.&#34;</span><span class="op" id="3412067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412071">p</span><span class="op" id="3412072">.</span><span class="ident" id="3412073">next</span><span class="op" id="3412077">(</span><span class="op" id="3412078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412081">case</span>&nbsp;<span class="ident" id="3412086">token</span><span class="op" id="3412091">.</span><span class="ident" id="3412092">IDENT</span><span class="op" id="3412097">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412101">ident</span>&nbsp;<span class="op" id="3412107">=</span>&nbsp;<span class="ident" id="3412109">p</span><span class="op" id="3412110">.</span><span class="ident" id="3412111">parseIdent</span><span class="op" id="3412121">(</span><span class="op" id="3412122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412125">}</span><br>
<span class="lineno">2200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412129">pos</span>&nbsp;<span class="op" id="3412133">:=</span>&nbsp;<span class="ident" id="3412136">p</span><span class="op" id="3412137">.</span><span class="ident" id="3412138">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412143">var</span>&nbsp;<span class="ident" id="3412147">path</span>&nbsp;<span class="builtintype" id="3412152">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412160">if</span>&nbsp;<span class="ident" id="3412163">p</span><span class="op" id="3412164">.</span><span class="ident" id="3412165">tok</span>&nbsp;<span class="op" id="3412169">==</span>&nbsp;<span class="ident" id="3412172">token</span><span class="op" id="3412177">.</span><span class="ident" id="3412178">STRING</span>&nbsp;<span class="op" id="3412185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412189">path</span>&nbsp;<span class="op" id="3412194">=</span>&nbsp;<span class="ident" id="3412196">p</span><span class="op" id="3412197">.</span><span class="ident" id="3412198">lit</span><br>
<span class="lineno">2205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412204">if</span>&nbsp;<span class="op" id="3412207">!</span><span class="ident" id="3412208">isValidImport</span><span class="op" id="3412221">(</span><span class="ident" id="3412222">path</span><span class="op" id="3412226">)</span>&nbsp;<span class="op" id="3412228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412233">p</span><span class="op" id="3412234">.</span><span class="builtintype" id="3412235">error</span><span class="op" id="3412240">(</span><span class="ident" id="3412241">pos</span><span class="op" id="3412244">,</span>&nbsp;<span class="string" id="3412246">&#34;invalid&nbsp;import&nbsp;path:&nbsp;&#34;</span><span class="op" id="3412269">+</span><span class="ident" id="3412270">path</span><span class="op" id="3412274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412282">p</span><span class="op" id="3412283">.</span><span class="ident" id="3412284">next</span><span class="op" id="3412288">(</span><span class="op" id="3412289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412292">}</span>&nbsp;<span class="keyword" id="3412294">else</span>&nbsp;<span class="op" id="3412299">{</span><br>
<span class="lineno">2210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412303">p</span><span class="op" id="3412304">.</span><span class="ident" id="3412305">expect</span><span class="op" id="3412311">(</span><span class="ident" id="3412312">token</span><span class="op" id="3412317">.</span><span class="ident" id="3412318">STRING</span><span class="op" id="3412324">)</span>&nbsp;<span class="comment" id="3412326">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412361">p</span><span class="op" id="3412362">.</span><span class="ident" id="3412363">expectSemi</span><span class="op" id="3412373">(</span><span class="op" id="3412374">)</span>&nbsp;<span class="comment" id="3412376">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412417">//&nbsp;collect&nbsp;imports</span><br>
<span class="lineno">2215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412437">spec</span>&nbsp;<span class="op" id="3412442">:=</span>&nbsp;<span class="op" id="3412445">&amp;</span><span class="ident" id="3412446">ast</span><span class="op" id="3412449">.</span><span class="ident" id="3412450">ImportSpec</span><span class="op" id="3412460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412464">Doc</span><span class="op" id="3412467">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3412473">doc</span><span class="op" id="3412476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412480">Name</span><span class="op" id="3412484">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3412489">ident</span><span class="op" id="3412494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412498">Path</span><span class="op" id="3412502">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3412507">&amp;</span><span class="ident" id="3412508">ast</span><span class="op" id="3412511">.</span><span class="ident" id="3412512">BasicLit</span><span class="op" id="3412520">{</span><span class="ident" id="3412521">ValuePos</span><span class="op" id="3412529">:</span>&nbsp;<span class="ident" id="3412531">pos</span><span class="op" id="3412534">,</span>&nbsp;<span class="ident" id="3412536">Kind</span><span class="op" id="3412540">:</span>&nbsp;<span class="ident" id="3412542">token</span><span class="op" id="3412547">.</span><span class="ident" id="3412548">STRING</span><span class="op" id="3412554">,</span>&nbsp;<span class="ident" id="3412556">Value</span><span class="op" id="3412561">:</span>&nbsp;<span class="ident" id="3412563">path</span><span class="op" id="3412567">}</span><span class="op" id="3412568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412572">Comment</span><span class="op" id="3412579">:</span>&nbsp;<span class="ident" id="3412581">p</span><span class="op" id="3412582">.</span><span class="ident" id="3412583">lineComment</span><span class="op" id="3412594">,</span><br>
<span class="lineno">2220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412600">p</span><span class="op" id="3412601">.</span><span class="ident" id="3412602">imports</span>&nbsp;<span class="op" id="3412610">=</span>&nbsp;<span class="builtinfunc" id="3412612">append</span><span class="op" id="3412618">(</span><span class="ident" id="3412619">p</span><span class="op" id="3412620">.</span><span class="ident" id="3412621">imports</span><span class="op" id="3412628">,</span>&nbsp;<span class="ident" id="3412630">spec</span><span class="op" id="3412634">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412638">return</span>&nbsp;<span class="ident" id="3412645">spec</span><br>
<span class="lineno"></span><span class="op" id="3412650">}</span><br>
<span class="lineno">2225</span><br>
<span class="lineno"></span><span class="keyword" id="3412653">func</span>&nbsp;<span class="op" id="3412658">(</span><span class="ident" id="3412659">p</span>&nbsp;<span class="op" id="3412661">*</span><span class="ident" id="3412662">parser</span><span class="op" id="3412668">)</span>&nbsp;<span class="ident" id="3412670">parseValueSpec</span><span class="op" id="3412684">(</span><span class="ident" id="3412685">doc</span>&nbsp;<span class="op" id="3412689">*</span><span class="ident" id="3412690">ast</span><span class="op" id="3412693">.</span><span class="ident" id="3412694">CommentGroup</span><span class="op" id="3412706">,</span>&nbsp;<span class="ident" id="3412708">keyword</span>&nbsp;<span class="ident" id="3412716">token</span><span class="op" id="3412721">.</span><span class="ident" id="3412722">Token</span><span class="op" id="3412727">,</span>&nbsp;<span class="ident" id="3412729">iota</span>&nbsp;<span class="builtintype" id="3412734">int</span><span class="op" id="3412737">)</span>&nbsp;<span class="ident" id="3412739">ast</span><span class="op" id="3412742">.</span><span class="ident" id="3412743">Spec</span>&nbsp;<span class="op" id="3412748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412751">if</span>&nbsp;<span class="ident" id="3412754">p</span><span class="op" id="3412755">.</span><span class="ident" id="3412756">trace</span>&nbsp;<span class="op" id="3412762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412766">defer</span>&nbsp;<span class="ident" id="3412772">un</span><span class="op" id="3412774">(</span><span class="ident" id="3412775">trace</span><span class="op" id="3412780">(</span><span class="ident" id="3412781">p</span><span class="op" id="3412782">,</span>&nbsp;<span class="ident" id="3412784">keyword</span><span class="op" id="3412791">.</span><span class="ident" id="3412792">String</span><span class="op" id="3412798">(</span><span class="op" id="3412799">)</span><span class="op" id="3412800">+</span><span class="string" id="3412801">&#34;Spec&#34;</span><span class="op" id="3412807">)</span><span class="op" id="3412808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412811">}</span><br>
<span class="lineno">2230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412815">idents</span>&nbsp;<span class="op" id="3412822">:=</span>&nbsp;<span class="ident" id="3412825">p</span><span class="op" id="3412826">.</span><span class="ident" id="3412827">parseIdentList</span><span class="op" id="3412841">(</span><span class="op" id="3412842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412845">typ</span>&nbsp;<span class="op" id="3412849">:=</span>&nbsp;<span class="ident" id="3412852">p</span><span class="op" id="3412853">.</span><span class="ident" id="3412854">tryType</span><span class="op" id="3412861">(</span><span class="op" id="3412862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412865">var</span>&nbsp;<span class="ident" id="3412869">values</span>&nbsp;<span class="op" id="3412876">[</span><span class="op" id="3412877">]</span><span class="ident" id="3412878">ast</span><span class="op" id="3412881">.</span><span class="ident" id="3412882">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412888">//&nbsp;always&nbsp;permit&nbsp;optional&nbsp;initialization&nbsp;for&nbsp;more&nbsp;tolerant&nbsp;parsing</span><br>
<span class="lineno">2235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412956">if</span>&nbsp;<span class="ident" id="3412959">p</span><span class="op" id="3412960">.</span><span class="ident" id="3412961">tok</span>&nbsp;<span class="op" id="3412965">==</span>&nbsp;<span class="ident" id="3412968">token</span><span class="op" id="3412973">.</span><span class="ident" id="3412974">ASSIGN</span>&nbsp;<span class="op" id="3412981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412985">p</span><span class="op" id="3412986">.</span><span class="ident" id="3412987">next</span><span class="op" id="3412991">(</span><span class="op" id="3412992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412996">values</span>&nbsp;<span class="op" id="3413003">=</span>&nbsp;<span class="ident" id="3413005">p</span><span class="op" id="3413006">.</span><span class="ident" id="3413007">parseRhsList</span><span class="op" id="3413019">(</span><span class="op" id="3413020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413026">p</span><span class="op" id="3413027">.</span><span class="ident" id="3413028">expectSemi</span><span class="op" id="3413038">(</span><span class="op" id="3413039">)</span>&nbsp;<span class="comment" id="3413041">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno">2240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3413082">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;constant&nbsp;or&nbsp;variable&nbsp;identifier&nbsp;declared&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3413158">//&nbsp;a&nbsp;function&nbsp;begins&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;ConstSpec&nbsp;or&nbsp;VarSpec&nbsp;and&nbsp;ends&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3413231">//&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3413278">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno">2245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413351">spec</span>&nbsp;<span class="op" id="3413356">:=</span>&nbsp;<span class="op" id="3413359">&amp;</span><span class="ident" id="3413360">ast</span><span class="op" id="3413363">.</span><span class="ident" id="3413364">ValueSpec</span><span class="op" id="3413373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413377">Doc</span><span class="op" id="3413380">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3413386">doc</span><span class="op" id="3413389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413393">Names</span><span class="op" id="3413398">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3413402">idents</span><span class="op" id="3413408">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413412">Type</span><span class="op" id="3413416">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3413421">typ</span><span class="op" id="3413424">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413428">Values</span><span class="op" id="3413434">:</span>&nbsp;&nbsp;<span class="ident" id="3413437">values</span><span class="op" id="3413443">,</span><br>
<span class="lineno">2250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413447">Comment</span><span class="op" id="3413454">:</span>&nbsp;<span class="ident" id="3413456">p</span><span class="op" id="3413457">.</span><span class="ident" id="3413458">lineComment</span><span class="op" id="3413469">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413475">kind</span>&nbsp;<span class="op" id="3413480">:=</span>&nbsp;<span class="ident" id="3413483">ast</span><span class="op" id="3413486">.</span><span class="ident" id="3413487">Con</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413492">if</span>&nbsp;<span class="ident" id="3413495">keyword</span>&nbsp;<span class="op" id="3413503">==</span>&nbsp;<span class="ident" id="3413506">token</span><span class="op" id="3413511">.</span><span class="ident" id="3413512">VAR</span>&nbsp;<span class="op" id="3413516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413520">kind</span>&nbsp;<span class="op" id="3413525">=</span>&nbsp;<span class="ident" id="3413527">ast</span><span class="op" id="3413530">.</span><span class="ident" id="3413531">Var</span><br>
<span class="lineno">2255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413539">p</span><span class="op" id="3413540">.</span><span class="ident" id="3413541">declare</span><span class="op" id="3413548">(</span><span class="ident" id="3413549">spec</span><span class="op" id="3413553">,</span>&nbsp;<span class="ident" id="3413555">iota</span><span class="op" id="3413559">,</span>&nbsp;<span class="ident" id="3413561">p</span><span class="op" id="3413562">.</span><span class="ident" id="3413563">topScope</span><span class="op" id="3413571">,</span>&nbsp;<span class="ident" id="3413573">kind</span><span class="op" id="3413577">,</span>&nbsp;<span class="ident" id="3413579">idents</span><span class="op" id="3413585">...</span><span class="op" id="3413588">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413592">return</span>&nbsp;<span class="ident" id="3413599">spec</span><br>
<span class="lineno"></span><span class="op" id="3413604">}</span><br>
<span class="lineno">2260</span><br>
<span class="lineno"></span><span class="keyword" id="3413607">func</span>&nbsp;<span class="op" id="3413612">(</span><span class="ident" id="3413613">p</span>&nbsp;<span class="op" id="3413615">*</span><span class="ident" id="3413616">parser</span><span class="op" id="3413622">)</span>&nbsp;<span class="ident" id="3413624">parseTypeSpec</span><span class="op" id="3413637">(</span><span class="ident" id="3413638">doc</span>&nbsp;<span class="op" id="3413642">*</span><span class="ident" id="3413643">ast</span><span class="op" id="3413646">.</span><span class="ident" id="3413647">CommentGroup</span><span class="op" id="3413659">,</span>&nbsp;<span class="ident" id="3413661">_</span>&nbsp;<span class="ident" id="3413663">token</span><span class="op" id="3413668">.</span><span class="ident" id="3413669">Token</span><span class="op" id="3413674">,</span>&nbsp;<span class="ident" id="3413676">_</span>&nbsp;<span class="builtintype" id="3413678">int</span><span class="op" id="3413681">)</span>&nbsp;<span class="ident" id="3413683">ast</span><span class="op" id="3413686">.</span><span class="ident" id="3413687">Spec</span>&nbsp;<span class="op" id="3413692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413695">if</span>&nbsp;<span class="ident" id="3413698">p</span><span class="op" id="3413699">.</span><span class="ident" id="3413700">trace</span>&nbsp;<span class="op" id="3413706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413710">defer</span>&nbsp;<span class="ident" id="3413716">un</span><span class="op" id="3413718">(</span><span class="ident" id="3413719">trace</span><span class="op" id="3413724">(</span><span class="ident" id="3413725">p</span><span class="op" id="3413726">,</span>&nbsp;<span class="string" id="3413728">&#34;TypeSpec&#34;</span><span class="op" id="3413738">)</span><span class="op" id="3413739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413742">}</span><br>
<span class="lineno">2265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413746">ident</span>&nbsp;<span class="op" id="3413752">:=</span>&nbsp;<span class="ident" id="3413755">p</span><span class="op" id="3413756">.</span><span class="ident" id="3413757">parseIdent</span><span class="op" id="3413767">(</span><span class="op" id="3413768">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3413772">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;type&nbsp;identifier&nbsp;declared&nbsp;inside&nbsp;a&nbsp;function&nbsp;begins</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3413850">//&nbsp;at&nbsp;the&nbsp;identifier&nbsp;in&nbsp;the&nbsp;TypeSpec&nbsp;and&nbsp;ends&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost</span><br>
<span class="lineno">2270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3413925">//&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3413947">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414020">spec</span>&nbsp;<span class="op" id="3414025">:=</span>&nbsp;<span class="op" id="3414028">&amp;</span><span class="ident" id="3414029">ast</span><span class="op" id="3414032">.</span><span class="ident" id="3414033">TypeSpec</span><span class="op" id="3414041">{</span><span class="ident" id="3414042">Doc</span><span class="op" id="3414045">:</span>&nbsp;<span class="ident" id="3414047">doc</span><span class="op" id="3414050">,</span>&nbsp;<span class="ident" id="3414052">Name</span><span class="op" id="3414056">:</span>&nbsp;<span class="ident" id="3414058">ident</span><span class="op" id="3414063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414066">p</span><span class="op" id="3414067">.</span><span class="ident" id="3414068">declare</span><span class="op" id="3414075">(</span><span class="ident" id="3414076">spec</span><span class="op" id="3414080">,</span>&nbsp;<span class="ident" id="3414082">nil</span><span class="op" id="3414085">,</span>&nbsp;<span class="ident" id="3414087">p</span><span class="op" id="3414088">.</span><span class="ident" id="3414089">topScope</span><span class="op" id="3414097">,</span>&nbsp;<span class="ident" id="3414099">ast</span><span class="op" id="3414102">.</span><span class="ident" id="3414103">Typ</span><span class="op" id="3414106">,</span>&nbsp;<span class="ident" id="3414108">ident</span><span class="op" id="3414113">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414117">spec</span><span class="op" id="3414121">.</span><span class="ident" id="3414122">Type</span>&nbsp;<span class="op" id="3414127">=</span>&nbsp;<span class="ident" id="3414129">p</span><span class="op" id="3414130">.</span><span class="ident" id="3414131">parseType</span><span class="op" id="3414140">(</span><span class="op" id="3414141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414144">p</span><span class="op" id="3414145">.</span><span class="ident" id="3414146">expectSemi</span><span class="op" id="3414156">(</span><span class="op" id="3414157">)</span>&nbsp;<span class="comment" id="3414159">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414199">spec</span><span class="op" id="3414203">.</span><span class="ident" id="3414204">Comment</span>&nbsp;<span class="op" id="3414212">=</span>&nbsp;<span class="ident" id="3414214">p</span><span class="op" id="3414215">.</span><span class="ident" id="3414216">lineComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414230">return</span>&nbsp;<span class="ident" id="3414237">spec</span><br>
<span class="lineno">2280</span><span class="op" id="3414242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3414245">func</span>&nbsp;<span class="op" id="3414250">(</span><span class="ident" id="3414251">p</span>&nbsp;<span class="op" id="3414253">*</span><span class="ident" id="3414254">parser</span><span class="op" id="3414260">)</span>&nbsp;<span class="ident" id="3414262">parseGenDecl</span><span class="op" id="3414274">(</span><span class="ident" id="3414275">keyword</span>&nbsp;<span class="ident" id="3414283">token</span><span class="op" id="3414288">.</span><span class="ident" id="3414289">Token</span><span class="op" id="3414294">,</span>&nbsp;<span class="ident" id="3414296">f</span>&nbsp;<span class="ident" id="3414298">parseSpecFunction</span><span class="op" id="3414315">)</span>&nbsp;<span class="op" id="3414317">*</span><span class="ident" id="3414318">ast</span><span class="op" id="3414321">.</span><span class="ident" id="3414322">GenDecl</span>&nbsp;<span class="op" id="3414330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414333">if</span>&nbsp;<span class="ident" id="3414336">p</span><span class="op" id="3414337">.</span><span class="ident" id="3414338">trace</span>&nbsp;<span class="op" id="3414344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414348">defer</span>&nbsp;<span class="ident" id="3414354">un</span><span class="op" id="3414356">(</span><span class="ident" id="3414357">trace</span><span class="op" id="3414362">(</span><span class="ident" id="3414363">p</span><span class="op" id="3414364">,</span>&nbsp;<span class="string" id="3414366">&#34;GenDecl(&#34;</span><span class="op" id="3414376">+</span><span class="ident" id="3414377">keyword</span><span class="op" id="3414384">.</span><span class="ident" id="3414385">String</span><span class="op" id="3414391">(</span><span class="op" id="3414392">)</span><span class="op" id="3414393">+</span><span class="string" id="3414394">&#34;)&#34;</span><span class="op" id="3414397">)</span><span class="op" id="3414398">)</span><br>
<span class="lineno">2285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414405">doc</span>&nbsp;<span class="op" id="3414409">:=</span>&nbsp;<span class="ident" id="3414412">p</span><span class="op" id="3414413">.</span><span class="ident" id="3414414">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414427">pos</span>&nbsp;<span class="op" id="3414431">:=</span>&nbsp;<span class="ident" id="3414434">p</span><span class="op" id="3414435">.</span><span class="ident" id="3414436">expect</span><span class="op" id="3414442">(</span><span class="ident" id="3414443">keyword</span><span class="op" id="3414450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414453">var</span>&nbsp;<span class="ident" id="3414457">lparen</span><span class="op" id="3414463">,</span>&nbsp;<span class="ident" id="3414465">rparen</span>&nbsp;<span class="ident" id="3414472">token</span><span class="op" id="3414477">.</span><span class="ident" id="3414478">Pos</span><br>
<span class="lineno">2290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414483">var</span>&nbsp;<span class="ident" id="3414487">list</span>&nbsp;<span class="op" id="3414492">[</span><span class="op" id="3414493">]</span><span class="ident" id="3414494">ast</span><span class="op" id="3414497">.</span><span class="ident" id="3414498">Spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414504">if</span>&nbsp;<span class="ident" id="3414507">p</span><span class="op" id="3414508">.</span><span class="ident" id="3414509">tok</span>&nbsp;<span class="op" id="3414513">==</span>&nbsp;<span class="ident" id="3414516">token</span><span class="op" id="3414521">.</span><span class="ident" id="3414522">LPAREN</span>&nbsp;<span class="op" id="3414529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414533">lparen</span>&nbsp;<span class="op" id="3414540">=</span>&nbsp;<span class="ident" id="3414542">p</span><span class="op" id="3414543">.</span><span class="ident" id="3414544">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414550">p</span><span class="op" id="3414551">.</span><span class="ident" id="3414552">next</span><span class="op" id="3414556">(</span><span class="op" id="3414557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414561">for</span>&nbsp;<span class="ident" id="3414565">iota</span>&nbsp;<span class="op" id="3414570">:=</span>&nbsp;<span class="num" id="3414573">0</span><span class="op" id="3414574">;</span>&nbsp;<span class="ident" id="3414576">p</span><span class="op" id="3414577">.</span><span class="ident" id="3414578">tok</span>&nbsp;<span class="op" id="3414582">!=</span>&nbsp;<span class="ident" id="3414585">token</span><span class="op" id="3414590">.</span><span class="ident" id="3414591">RPAREN</span>&nbsp;<span class="op" id="3414598">&amp;&amp;</span>&nbsp;<span class="ident" id="3414601">p</span><span class="op" id="3414602">.</span><span class="ident" id="3414603">tok</span>&nbsp;<span class="op" id="3414607">!=</span>&nbsp;<span class="ident" id="3414610">token</span><span class="op" id="3414615">.</span><span class="ident" id="3414616">EOF</span><span class="op" id="3414619">;</span>&nbsp;<span class="ident" id="3414621">iota</span><span class="op" id="3414625">++</span>&nbsp;<span class="op" id="3414628">{</span><br>
<span class="lineno">2295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414633">list</span>&nbsp;<span class="op" id="3414638">=</span>&nbsp;<span class="builtinfunc" id="3414640">append</span><span class="op" id="3414646">(</span><span class="ident" id="3414647">list</span><span class="op" id="3414651">,</span>&nbsp;<span class="ident" id="3414653">f</span><span class="op" id="3414654">(</span><span class="ident" id="3414655">p</span><span class="op" id="3414656">.</span><span class="ident" id="3414657">leadComment</span><span class="op" id="3414668">,</span>&nbsp;<span class="ident" id="3414670">keyword</span><span class="op" id="3414677">,</span>&nbsp;<span class="ident" id="3414679">iota</span><span class="op" id="3414683">)</span><span class="op" id="3414684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414692">rparen</span>&nbsp;<span class="op" id="3414699">=</span>&nbsp;<span class="ident" id="3414701">p</span><span class="op" id="3414702">.</span><span class="ident" id="3414703">expect</span><span class="op" id="3414709">(</span><span class="ident" id="3414710">token</span><span class="op" id="3414715">.</span><span class="ident" id="3414716">RPAREN</span><span class="op" id="3414722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414726">p</span><span class="op" id="3414727">.</span><span class="ident" id="3414728">expectSemi</span><span class="op" id="3414738">(</span><span class="op" id="3414739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414742">}</span>&nbsp;<span class="keyword" id="3414744">else</span>&nbsp;<span class="op" id="3414749">{</span><br>
<span class="lineno">2300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414753">list</span>&nbsp;<span class="op" id="3414758">=</span>&nbsp;<span class="builtinfunc" id="3414760">append</span><span class="op" id="3414766">(</span><span class="ident" id="3414767">list</span><span class="op" id="3414771">,</span>&nbsp;<span class="ident" id="3414773">f</span><span class="op" id="3414774">(</span><span class="ident" id="3414775">nil</span><span class="op" id="3414778">,</span>&nbsp;<span class="ident" id="3414780">keyword</span><span class="op" id="3414787">,</span>&nbsp;<span class="num" id="3414789">0</span><span class="op" id="3414790">)</span><span class="op" id="3414791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414798">return</span>&nbsp;<span class="op" id="3414805">&amp;</span><span class="ident" id="3414806">ast</span><span class="op" id="3414809">.</span><span class="ident" id="3414810">GenDecl</span><span class="op" id="3414817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414821">Doc</span><span class="op" id="3414824">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3414829">doc</span><span class="op" id="3414832">,</span><br>
<span class="lineno">2305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414836">TokPos</span><span class="op" id="3414842">:</span>&nbsp;<span class="ident" id="3414844">pos</span><span class="op" id="3414847">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414851">Tok</span><span class="op" id="3414854">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3414859">keyword</span><span class="op" id="3414866">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414870">Lparen</span><span class="op" id="3414876">:</span>&nbsp;<span class="ident" id="3414878">lparen</span><span class="op" id="3414884">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414888">Specs</span><span class="op" id="3414893">:</span>&nbsp;&nbsp;<span class="ident" id="3414896">list</span><span class="op" id="3414900">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414904">Rparen</span><span class="op" id="3414910">:</span>&nbsp;<span class="ident" id="3414912">rparen</span><span class="op" id="3414918">,</span><br>
<span class="lineno">2310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414921">}</span><br>
<span class="lineno"></span><span class="op" id="3414923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3414926">func</span>&nbsp;<span class="op" id="3414931">(</span><span class="ident" id="3414932">p</span>&nbsp;<span class="op" id="3414934">*</span><span class="ident" id="3414935">parser</span><span class="op" id="3414941">)</span>&nbsp;<span class="ident" id="3414943">parseFuncDecl</span><span class="op" id="3414956">(</span><span class="op" id="3414957">)</span>&nbsp;<span class="op" id="3414959">*</span><span class="ident" id="3414960">ast</span><span class="op" id="3414963">.</span><span class="ident" id="3414964">FuncDecl</span>&nbsp;<span class="op" id="3414973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414976">if</span>&nbsp;<span class="ident" id="3414979">p</span><span class="op" id="3414980">.</span><span class="ident" id="3414981">trace</span>&nbsp;<span class="op" id="3414987">{</span><br>
<span class="lineno">2315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414991">defer</span>&nbsp;<span class="ident" id="3414997">un</span><span class="op" id="3414999">(</span><span class="ident" id="3415000">trace</span><span class="op" id="3415005">(</span><span class="ident" id="3415006">p</span><span class="op" id="3415007">,</span>&nbsp;<span class="string" id="3415009">&#34;FunctionDecl&#34;</span><span class="op" id="3415023">)</span><span class="op" id="3415024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415031">doc</span>&nbsp;<span class="op" id="3415035">:=</span>&nbsp;<span class="ident" id="3415038">p</span><span class="op" id="3415039">.</span><span class="ident" id="3415040">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415053">pos</span>&nbsp;<span class="op" id="3415057">:=</span>&nbsp;<span class="ident" id="3415060">p</span><span class="op" id="3415061">.</span><span class="ident" id="3415062">expect</span><span class="op" id="3415068">(</span><span class="ident" id="3415069">token</span><span class="op" id="3415074">.</span><span class="ident" id="3415075">FUNC</span><span class="op" id="3415079">)</span><br>
<span class="lineno">2320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415082">scope</span>&nbsp;<span class="op" id="3415088">:=</span>&nbsp;<span class="ident" id="3415091">ast</span><span class="op" id="3415094">.</span><span class="ident" id="3415095">NewScope</span><span class="op" id="3415103">(</span><span class="ident" id="3415104">p</span><span class="op" id="3415105">.</span><span class="ident" id="3415106">topScope</span><span class="op" id="3415114">)</span>&nbsp;<span class="comment" id="3415116">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415136">var</span>&nbsp;<span class="ident" id="3415140">recv</span>&nbsp;<span class="op" id="3415145">*</span><span class="ident" id="3415146">ast</span><span class="op" id="3415149">.</span><span class="ident" id="3415150">FieldList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415161">if</span>&nbsp;<span class="ident" id="3415164">p</span><span class="op" id="3415165">.</span><span class="ident" id="3415166">tok</span>&nbsp;<span class="op" id="3415170">==</span>&nbsp;<span class="ident" id="3415173">token</span><span class="op" id="3415178">.</span><span class="ident" id="3415179">LPAREN</span>&nbsp;<span class="op" id="3415186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415190">recv</span>&nbsp;<span class="op" id="3415195">=</span>&nbsp;<span class="ident" id="3415197">p</span><span class="op" id="3415198">.</span><span class="ident" id="3415199">parseParameters</span><span class="op" id="3415214">(</span><span class="ident" id="3415215">scope</span><span class="op" id="3415220">,</span>&nbsp;<span class="builtintype" id="3415222">false</span><span class="op" id="3415227">)</span><br>
<span class="lineno">2325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415234">ident</span>&nbsp;<span class="op" id="3415240">:=</span>&nbsp;<span class="ident" id="3415243">p</span><span class="op" id="3415244">.</span><span class="ident" id="3415245">parseIdent</span><span class="op" id="3415255">(</span><span class="op" id="3415256">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415260">params</span><span class="op" id="3415266">,</span>&nbsp;<span class="ident" id="3415268">results</span>&nbsp;<span class="op" id="3415276">:=</span>&nbsp;<span class="ident" id="3415279">p</span><span class="op" id="3415280">.</span><span class="ident" id="3415281">parseSignature</span><span class="op" id="3415295">(</span><span class="ident" id="3415296">scope</span><span class="op" id="3415301">)</span><br>
<span class="lineno">2330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415305">var</span>&nbsp;<span class="ident" id="3415309">body</span>&nbsp;<span class="op" id="3415314">*</span><span class="ident" id="3415315">ast</span><span class="op" id="3415318">.</span><span class="ident" id="3415319">BlockStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415330">if</span>&nbsp;<span class="ident" id="3415333">p</span><span class="op" id="3415334">.</span><span class="ident" id="3415335">tok</span>&nbsp;<span class="op" id="3415339">==</span>&nbsp;<span class="ident" id="3415342">token</span><span class="op" id="3415347">.</span><span class="ident" id="3415348">LBRACE</span>&nbsp;<span class="op" id="3415355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415359">body</span>&nbsp;<span class="op" id="3415364">=</span>&nbsp;<span class="ident" id="3415366">p</span><span class="op" id="3415367">.</span><span class="ident" id="3415368">parseBody</span><span class="op" id="3415377">(</span><span class="ident" id="3415378">scope</span><span class="op" id="3415383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415386">}</span><br>
<span class="lineno">2335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415389">p</span><span class="op" id="3415390">.</span><span class="ident" id="3415391">expectSemi</span><span class="op" id="3415401">(</span><span class="op" id="3415402">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415406">decl</span>&nbsp;<span class="op" id="3415411">:=</span>&nbsp;<span class="op" id="3415414">&amp;</span><span class="ident" id="3415415">ast</span><span class="op" id="3415418">.</span><span class="ident" id="3415419">FuncDecl</span><span class="op" id="3415427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415431">Doc</span><span class="op" id="3415434">:</span>&nbsp;&nbsp;<span class="ident" id="3415437">doc</span><span class="op" id="3415440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415444">Recv</span><span class="op" id="3415448">:</span>&nbsp;<span class="ident" id="3415450">recv</span><span class="op" id="3415454">,</span><br>
<span class="lineno">2340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415458">Name</span><span class="op" id="3415462">:</span>&nbsp;<span class="ident" id="3415464">ident</span><span class="op" id="3415469">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415473">Type</span><span class="op" id="3415477">:</span>&nbsp;<span class="op" id="3415479">&amp;</span><span class="ident" id="3415480">ast</span><span class="op" id="3415483">.</span><span class="ident" id="3415484">FuncType</span><span class="op" id="3415492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415497">Func</span><span class="op" id="3415501">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3415506">pos</span><span class="op" id="3415509">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415514">Params</span><span class="op" id="3415520">:</span>&nbsp;&nbsp;<span class="ident" id="3415523">params</span><span class="op" id="3415529">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415534">Results</span><span class="op" id="3415541">:</span>&nbsp;<span class="ident" id="3415543">results</span><span class="op" id="3415550">,</span><br>
<span class="lineno">2345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415554">}</span><span class="op" id="3415555">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415559">Body</span><span class="op" id="3415563">:</span>&nbsp;<span class="ident" id="3415565">body</span><span class="op" id="3415569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415575">if</span>&nbsp;<span class="ident" id="3415578">recv</span>&nbsp;<span class="op" id="3415583">==</span>&nbsp;<span class="ident" id="3415586">nil</span>&nbsp;<span class="op" id="3415590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3415594">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;constant,&nbsp;type,</span><br>
<span class="lineno">2350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3415662">//&nbsp;variable,&nbsp;or&nbsp;function&nbsp;(but&nbsp;not&nbsp;method)&nbsp;declared&nbsp;at&nbsp;top&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3415728">//&nbsp;(outside&nbsp;any&nbsp;function)&nbsp;is&nbsp;the&nbsp;package&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3415778">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3415783">//&nbsp;init()&nbsp;functions&nbsp;cannot&nbsp;be&nbsp;referred&nbsp;to&nbsp;and&nbsp;there&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3415841">//&nbsp;be&nbsp;more&nbsp;than&nbsp;one&nbsp;-&nbsp;don&#39;t&nbsp;put&nbsp;them&nbsp;in&nbsp;the&nbsp;pkgScope</span><br>
<span class="lineno">2355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415896">if</span>&nbsp;<span class="ident" id="3415899">ident</span><span class="op" id="3415904">.</span><span class="ident" id="3415905">Name</span>&nbsp;<span class="op" id="3415910">!=</span>&nbsp;<span class="string" id="3415913">&#34;init&#34;</span>&nbsp;<span class="op" id="3415920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415925">p</span><span class="op" id="3415926">.</span><span class="ident" id="3415927">declare</span><span class="op" id="3415934">(</span><span class="ident" id="3415935">decl</span><span class="op" id="3415939">,</span>&nbsp;<span class="ident" id="3415941">nil</span><span class="op" id="3415944">,</span>&nbsp;<span class="ident" id="3415946">p</span><span class="op" id="3415947">.</span><span class="ident" id="3415948">pkgScope</span><span class="op" id="3415956">,</span>&nbsp;<span class="ident" id="3415958">ast</span><span class="op" id="3415961">.</span><span class="ident" id="3415962">Fun</span><span class="op" id="3415965">,</span>&nbsp;<span class="ident" id="3415967">ident</span><span class="op" id="3415972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415983">return</span>&nbsp;<span class="ident" id="3415990">decl</span><br>
<span class="lineno"></span><span class="op" id="3415995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3415998">func</span>&nbsp;<span class="op" id="3416003">(</span><span class="ident" id="3416004">p</span>&nbsp;<span class="op" id="3416006">*</span><span class="ident" id="3416007">parser</span><span class="op" id="3416013">)</span>&nbsp;<span class="ident" id="3416015">parseDecl</span><span class="op" id="3416024">(</span><span class="ident" id="3416025">sync</span>&nbsp;<span class="keyword" id="3416030">func</span><span class="op" id="3416034">(</span><span class="op" id="3416035">*</span><span class="ident" id="3416036">parser</span><span class="op" id="3416042">)</span><span class="op" id="3416043">)</span>&nbsp;<span class="ident" id="3416045">ast</span><span class="op" id="3416048">.</span><span class="ident" id="3416049">Decl</span>&nbsp;<span class="op" id="3416054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416057">if</span>&nbsp;<span class="ident" id="3416060">p</span><span class="op" id="3416061">.</span><span class="ident" id="3416062">trace</span>&nbsp;<span class="op" id="3416068">{</span><br>
<span class="lineno">2365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416072">defer</span>&nbsp;<span class="ident" id="3416078">un</span><span class="op" id="3416080">(</span><span class="ident" id="3416081">trace</span><span class="op" id="3416086">(</span><span class="ident" id="3416087">p</span><span class="op" id="3416088">,</span>&nbsp;<span class="string" id="3416090">&#34;Declaration&#34;</span><span class="op" id="3416103">)</span><span class="op" id="3416104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3416107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416111">var</span>&nbsp;<span class="ident" id="3416115">f</span>&nbsp;<span class="ident" id="3416117">parseSpecFunction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416136">switch</span>&nbsp;<span class="ident" id="3416143">p</span><span class="op" id="3416144">.</span><span class="ident" id="3416145">tok</span>&nbsp;<span class="op" id="3416149">{</span><br>
<span class="lineno">2370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416152">case</span>&nbsp;<span class="ident" id="3416157">token</span><span class="op" id="3416162">.</span><span class="ident" id="3416163">CONST</span><span class="op" id="3416168">,</span>&nbsp;<span class="ident" id="3416170">token</span><span class="op" id="3416175">.</span><span class="ident" id="3416176">VAR</span><span class="op" id="3416179">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416183">f</span>&nbsp;<span class="op" id="3416185">=</span>&nbsp;<span class="ident" id="3416187">p</span><span class="op" id="3416188">.</span><span class="ident" id="3416189">parseValueSpec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416206">case</span>&nbsp;<span class="ident" id="3416211">token</span><span class="op" id="3416216">.</span><span class="ident" id="3416217">TYPE</span><span class="op" id="3416221">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416225">f</span>&nbsp;<span class="op" id="3416227">=</span>&nbsp;<span class="ident" id="3416229">p</span><span class="op" id="3416230">.</span><span class="ident" id="3416231">parseTypeSpec</span><br>
<span class="lineno">2375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416247">case</span>&nbsp;<span class="ident" id="3416252">token</span><span class="op" id="3416257">.</span><span class="ident" id="3416258">FUNC</span><span class="op" id="3416262">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416266">return</span>&nbsp;<span class="ident" id="3416273">p</span><span class="op" id="3416274">.</span><span class="ident" id="3416275">parseFuncDecl</span><span class="op" id="3416288">(</span><span class="op" id="3416289">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416293">default</span><span class="op" id="3416300">:</span><br>
<span class="lineno">2380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416304">pos</span>&nbsp;<span class="op" id="3416308">:=</span>&nbsp;<span class="ident" id="3416311">p</span><span class="op" id="3416312">.</span><span class="ident" id="3416313">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416319">p</span><span class="op" id="3416320">.</span><span class="ident" id="3416321">errorExpected</span><span class="op" id="3416334">(</span><span class="ident" id="3416335">pos</span><span class="op" id="3416338">,</span>&nbsp;<span class="string" id="3416340">&#34;declaration&#34;</span><span class="op" id="3416353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416357">sync</span><span class="op" id="3416361">(</span><span class="ident" id="3416362">p</span><span class="op" id="3416363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416367">return</span>&nbsp;<span class="op" id="3416374">&amp;</span><span class="ident" id="3416375">ast</span><span class="op" id="3416378">.</span><span class="ident" id="3416379">BadDecl</span><span class="op" id="3416386">{</span><span class="ident" id="3416387">From</span><span class="op" id="3416391">:</span>&nbsp;<span class="ident" id="3416393">pos</span><span class="op" id="3416396">,</span>&nbsp;<span class="ident" id="3416398">To</span><span class="op" id="3416400">:</span>&nbsp;<span class="ident" id="3416402">p</span><span class="op" id="3416403">.</span><span class="ident" id="3416404">pos</span><span class="op" id="3416407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3416410">}</span><br>
<span class="lineno">2385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416414">return</span>&nbsp;<span class="ident" id="3416421">p</span><span class="op" id="3416422">.</span><span class="ident" id="3416423">parseGenDecl</span><span class="op" id="3416435">(</span><span class="ident" id="3416436">p</span><span class="op" id="3416437">.</span><span class="ident" id="3416438">tok</span><span class="op" id="3416441">,</span>&nbsp;<span class="ident" id="3416443">f</span><span class="op" id="3416444">)</span><br>
<span class="lineno"></span><span class="op" id="3416446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3416449">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">2390</span><span class="comment" id="3416529">//&nbsp;Source&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3416546">func</span>&nbsp;<span class="op" id="3416551">(</span><span class="ident" id="3416552">p</span>&nbsp;<span class="op" id="3416554">*</span><span class="ident" id="3416555">parser</span><span class="op" id="3416561">)</span>&nbsp;<span class="ident" id="3416563">parseFile</span><span class="op" id="3416572">(</span><span class="op" id="3416573">)</span>&nbsp;<span class="op" id="3416575">*</span><span class="ident" id="3416576">ast</span><span class="op" id="3416579">.</span><span class="ident" id="3416580">File</span>&nbsp;<span class="op" id="3416585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416588">if</span>&nbsp;<span class="ident" id="3416591">p</span><span class="op" id="3416592">.</span><span class="ident" id="3416593">trace</span>&nbsp;<span class="op" id="3416599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416603">defer</span>&nbsp;<span class="ident" id="3416609">un</span><span class="op" id="3416611">(</span><span class="ident" id="3416612">trace</span><span class="op" id="3416617">(</span><span class="ident" id="3416618">p</span><span class="op" id="3416619">,</span>&nbsp;<span class="string" id="3416621">&#34;File&#34;</span><span class="op" id="3416627">)</span><span class="op" id="3416628">)</span><br>
<span class="lineno">2395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3416631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3416635">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;scanning&nbsp;the&nbsp;first&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3416712">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416752">if</span>&nbsp;<span class="ident" id="3416755">p</span><span class="op" id="3416756">.</span><span class="ident" id="3416757">errors</span><span class="op" id="3416763">.</span><span class="ident" id="3416764">Len</span><span class="op" id="3416767">(</span><span class="op" id="3416768">)</span>&nbsp;<span class="op" id="3416770">!=</span>&nbsp;<span class="num" id="3416773">0</span>&nbsp;<span class="op" id="3416775">{</span><br>
<span class="lineno">2400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416779">return</span>&nbsp;<span class="ident" id="3416786">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3416791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3416795">//&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416814">doc</span>&nbsp;<span class="op" id="3416818">:=</span>&nbsp;<span class="ident" id="3416821">p</span><span class="op" id="3416822">.</span><span class="ident" id="3416823">leadComment</span><br>
<span class="lineno">2405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416836">pos</span>&nbsp;<span class="op" id="3416840">:=</span>&nbsp;<span class="ident" id="3416843">p</span><span class="op" id="3416844">.</span><span class="ident" id="3416845">expect</span><span class="op" id="3416851">(</span><span class="ident" id="3416852">token</span><span class="op" id="3416857">.</span><span class="ident" id="3416858">PACKAGE</span><span class="op" id="3416865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3416868">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;package&nbsp;clause&nbsp;is&nbsp;not&nbsp;a&nbsp;declaration;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3416922">//&nbsp;the&nbsp;package&nbsp;name&nbsp;does&nbsp;not&nbsp;appear&nbsp;in&nbsp;any&nbsp;scope.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416973">ident</span>&nbsp;<span class="op" id="3416979">:=</span>&nbsp;<span class="ident" id="3416982">p</span><span class="op" id="3416983">.</span><span class="ident" id="3416984">parseIdent</span><span class="op" id="3416994">(</span><span class="op" id="3416995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416998">if</span>&nbsp;<span class="ident" id="3417001">ident</span><span class="op" id="3417006">.</span><span class="ident" id="3417007">Name</span>&nbsp;<span class="op" id="3417012">==</span>&nbsp;<span class="string" id="3417015">&#34;_&#34;</span>&nbsp;<span class="op" id="3417019">&amp;&amp;</span>&nbsp;<span class="ident" id="3417022">p</span><span class="op" id="3417023">.</span><span class="ident" id="3417024">mode</span><span class="op" id="3417028">&amp;</span><span class="ident" id="3417029">DeclarationErrors</span>&nbsp;<span class="op" id="3417047">!=</span>&nbsp;<span class="num" id="3417050">0</span>&nbsp;<span class="op" id="3417052">{</span><br>
<span class="lineno">2410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417056">p</span><span class="op" id="3417057">.</span><span class="builtintype" id="3417058">error</span><span class="op" id="3417063">(</span><span class="ident" id="3417064">p</span><span class="op" id="3417065">.</span><span class="ident" id="3417066">pos</span><span class="op" id="3417069">,</span>&nbsp;<span class="string" id="3417071">&#34;invalid&nbsp;package&nbsp;name&nbsp;_&#34;</span><span class="op" id="3417095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417101">p</span><span class="op" id="3417102">.</span><span class="ident" id="3417103">expectSemi</span><span class="op" id="3417113">(</span><span class="op" id="3417114">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3417118">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;parsing&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno">2415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3417197">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417237">if</span>&nbsp;<span class="ident" id="3417240">p</span><span class="op" id="3417241">.</span><span class="ident" id="3417242">errors</span><span class="op" id="3417248">.</span><span class="ident" id="3417249">Len</span><span class="op" id="3417252">(</span><span class="op" id="3417253">)</span>&nbsp;<span class="op" id="3417255">!=</span>&nbsp;<span class="num" id="3417258">0</span>&nbsp;<span class="op" id="3417260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417264">return</span>&nbsp;<span class="ident" id="3417271">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417280">p</span><span class="op" id="3417281">.</span><span class="ident" id="3417282">openScope</span><span class="op" id="3417291">(</span><span class="op" id="3417292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417295">p</span><span class="op" id="3417296">.</span><span class="ident" id="3417297">pkgScope</span>&nbsp;<span class="op" id="3417306">=</span>&nbsp;<span class="ident" id="3417308">p</span><span class="op" id="3417309">.</span><span class="ident" id="3417310">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417320">var</span>&nbsp;<span class="ident" id="3417324">decls</span>&nbsp;<span class="op" id="3417330">[</span><span class="op" id="3417331">]</span><span class="ident" id="3417332">ast</span><span class="op" id="3417335">.</span><span class="ident" id="3417336">Decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417342">if</span>&nbsp;<span class="ident" id="3417345">p</span><span class="op" id="3417346">.</span><span class="ident" id="3417347">mode</span><span class="op" id="3417351">&amp;</span><span class="ident" id="3417352">PackageClauseOnly</span>&nbsp;<span class="op" id="3417370">==</span>&nbsp;<span class="num" id="3417373">0</span>&nbsp;<span class="op" id="3417375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3417379">//&nbsp;import&nbsp;decls</span><br>
<span class="lineno">2425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417397">for</span>&nbsp;<span class="ident" id="3417401">p</span><span class="op" id="3417402">.</span><span class="ident" id="3417403">tok</span>&nbsp;<span class="op" id="3417407">==</span>&nbsp;<span class="ident" id="3417410">token</span><span class="op" id="3417415">.</span><span class="ident" id="3417416">IMPORT</span>&nbsp;<span class="op" id="3417423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417428">decls</span>&nbsp;<span class="op" id="3417434">=</span>&nbsp;<span class="builtinfunc" id="3417436">append</span><span class="op" id="3417442">(</span><span class="ident" id="3417443">decls</span><span class="op" id="3417448">,</span>&nbsp;<span class="ident" id="3417450">p</span><span class="op" id="3417451">.</span><span class="ident" id="3417452">parseGenDecl</span><span class="op" id="3417464">(</span><span class="ident" id="3417465">token</span><span class="op" id="3417470">.</span><span class="ident" id="3417471">IMPORT</span><span class="op" id="3417477">,</span>&nbsp;<span class="ident" id="3417479">p</span><span class="op" id="3417480">.</span><span class="ident" id="3417481">parseImportSpec</span><span class="op" id="3417496">)</span><span class="op" id="3417497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417506">if</span>&nbsp;<span class="ident" id="3417509">p</span><span class="op" id="3417510">.</span><span class="ident" id="3417511">mode</span><span class="op" id="3417515">&amp;</span><span class="ident" id="3417516">ImportsOnly</span>&nbsp;<span class="op" id="3417528">==</span>&nbsp;<span class="num" id="3417531">0</span>&nbsp;<span class="op" id="3417533">{</span><br>
<span class="lineno">2430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3417538">//&nbsp;rest&nbsp;of&nbsp;package&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417565">for</span>&nbsp;<span class="ident" id="3417569">p</span><span class="op" id="3417570">.</span><span class="ident" id="3417571">tok</span>&nbsp;<span class="op" id="3417575">!=</span>&nbsp;<span class="ident" id="3417578">token</span><span class="op" id="3417583">.</span><span class="ident" id="3417584">EOF</span>&nbsp;<span class="op" id="3417588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417594">decls</span>&nbsp;<span class="op" id="3417600">=</span>&nbsp;<span class="builtinfunc" id="3417602">append</span><span class="op" id="3417608">(</span><span class="ident" id="3417609">decls</span><span class="op" id="3417614">,</span>&nbsp;<span class="ident" id="3417616">p</span><span class="op" id="3417617">.</span><span class="ident" id="3417618">parseDecl</span><span class="op" id="3417627">(</span><span class="ident" id="3417628">syncDecl</span><span class="op" id="3417636">)</span><span class="op" id="3417637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417646">}</span><br>
<span class="lineno">2435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417652">p</span><span class="op" id="3417653">.</span><span class="ident" id="3417654">closeScope</span><span class="op" id="3417664">(</span><span class="op" id="3417665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417668">assert</span><span class="op" id="3417674">(</span><span class="ident" id="3417675">p</span><span class="op" id="3417676">.</span><span class="ident" id="3417677">topScope</span>&nbsp;<span class="op" id="3417686">==</span>&nbsp;<span class="ident" id="3417689">nil</span><span class="op" id="3417692">,</span>&nbsp;<span class="string" id="3417694">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="3417713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417716">assert</span><span class="op" id="3417722">(</span><span class="ident" id="3417723">p</span><span class="op" id="3417724">.</span><span class="ident" id="3417725">labelScope</span>&nbsp;<span class="op" id="3417736">==</span>&nbsp;<span class="ident" id="3417739">nil</span><span class="op" id="3417742">,</span>&nbsp;<span class="string" id="3417744">&#34;unbalanced&nbsp;label&nbsp;scopes&#34;</span><span class="op" id="3417769">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3417773">//&nbsp;resolve&nbsp;global&nbsp;identifiers&nbsp;within&nbsp;the&nbsp;same&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417825">i</span>&nbsp;<span class="op" id="3417827">:=</span>&nbsp;<span class="num" id="3417830">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417833">for</span>&nbsp;<span class="ident" id="3417837">_</span><span class="op" id="3417838">,</span>&nbsp;<span class="ident" id="3417840">ident</span>&nbsp;<span class="op" id="3417846">:=</span>&nbsp;<span class="keyword" id="3417849">range</span>&nbsp;<span class="ident" id="3417855">p</span><span class="op" id="3417856">.</span><span class="ident" id="3417857">unresolved</span>&nbsp;<span class="op" id="3417868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3417872">//&nbsp;i&nbsp;&lt;=&nbsp;index&nbsp;for&nbsp;current&nbsp;ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417906">assert</span><span class="op" id="3417912">(</span><span class="ident" id="3417913">ident</span><span class="op" id="3417918">.</span><span class="ident" id="3417919">Obj</span>&nbsp;<span class="op" id="3417923">==</span>&nbsp;<span class="ident" id="3417926">unresolved</span><span class="op" id="3417936">,</span>&nbsp;<span class="string" id="3417938">&#34;object&nbsp;already&nbsp;resolved&#34;</span><span class="op" id="3417963">)</span><br>
<span class="lineno">2445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417967">ident</span><span class="op" id="3417972">.</span><span class="ident" id="3417973">Obj</span>&nbsp;<span class="op" id="3417977">=</span>&nbsp;<span class="ident" id="3417979">p</span><span class="op" id="3417980">.</span><span class="ident" id="3417981">pkgScope</span><span class="op" id="3417989">.</span><span class="ident" id="3417990">Lookup</span><span class="op" id="3417996">(</span><span class="ident" id="3417997">ident</span><span class="op" id="3418002">.</span><span class="ident" id="3418003">Name</span><span class="op" id="3418007">)</span>&nbsp;<span class="comment" id="3418009">//&nbsp;also&nbsp;removes&nbsp;unresolved&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418047">if</span>&nbsp;<span class="ident" id="3418050">ident</span><span class="op" id="3418055">.</span><span class="ident" id="3418056">Obj</span>&nbsp;<span class="op" id="3418060">==</span>&nbsp;<span class="ident" id="3418063">nil</span>&nbsp;<span class="op" id="3418067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418072">p</span><span class="op" id="3418073">.</span><span class="ident" id="3418074">unresolved</span><span class="op" id="3418084">[</span><span class="ident" id="3418085">i</span><span class="op" id="3418086">]</span>&nbsp;<span class="op" id="3418088">=</span>&nbsp;<span class="ident" id="3418090">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418099">i</span><span class="op" id="3418100">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418105">}</span><br>
<span class="lineno">2450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418112">return</span>&nbsp;<span class="op" id="3418119">&amp;</span><span class="ident" id="3418120">ast</span><span class="op" id="3418123">.</span><span class="ident" id="3418124">File</span><span class="op" id="3418128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418132">Doc</span><span class="op" id="3418135">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3418144">doc</span><span class="op" id="3418147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418151">Package</span><span class="op" id="3418158">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3418163">pos</span><span class="op" id="3418166">,</span><br>
<span class="lineno">2455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418170">Name</span><span class="op" id="3418174">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3418182">ident</span><span class="op" id="3418187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418191">Decls</span><span class="op" id="3418196">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3418203">decls</span><span class="op" id="3418208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418212">Scope</span><span class="op" id="3418217">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3418224">p</span><span class="op" id="3418225">.</span><span class="ident" id="3418226">pkgScope</span><span class="op" id="3418234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418238">Imports</span><span class="op" id="3418245">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3418250">p</span><span class="op" id="3418251">.</span><span class="ident" id="3418252">imports</span><span class="op" id="3418259">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418263">Unresolved</span><span class="op" id="3418273">:</span>&nbsp;<span class="ident" id="3418275">p</span><span class="op" id="3418276">.</span><span class="ident" id="3418277">unresolved</span><span class="op" id="3418287">[</span><span class="num" id="3418288">0</span><span class="op" id="3418289">:</span><span class="ident" id="3418290">i</span><span class="op" id="3418291">]</span><span class="op" id="3418292">,</span><br>
<span class="lineno">2460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418296">Comments</span><span class="op" id="3418304">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3418308">p</span><span class="op" id="3418309">.</span><span class="ident" id="3418310">comments</span><span class="op" id="3418318">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418321">}</span><br>
<span class="lineno"></span><span class="op" id="3418323">}</span>
</div>
</body>
</html>
