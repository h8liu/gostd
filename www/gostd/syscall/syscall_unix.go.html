<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2259491">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2259546">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2259600">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2259651">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2259716">package</span>&nbsp;<span class="ident" id="2259724">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2259733">import</span>&nbsp;<span class="op" id="2259740">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2259743">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2259754">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2259762">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2259771">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="2259774">var</span>&nbsp;<span class="op" id="2259778">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259781">Stdin</span>&nbsp;&nbsp;<span class="op" id="2259788">=</span>&nbsp;<span class="num" id="2259790">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259793">Stdout</span>&nbsp;<span class="op" id="2259800">=</span>&nbsp;<span class="num" id="2259802">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259805">Stderr</span>&nbsp;<span class="op" id="2259812">=</span>&nbsp;<span class="num" id="2259814">2</span><br>
<span class="lineno"></span><span class="op" id="2259816">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2259819">const</span>&nbsp;<span class="op" id="2259825">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259828">darwin64Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2259843">=</span>&nbsp;<span class="ident" id="2259845">runtime</span><span class="op" id="2259852">.</span><span class="ident" id="2259853">GOOS</span>&nbsp;<span class="op" id="2259858">==</span>&nbsp;<span class="string" id="2259861">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2259870">&amp;&amp;</span>&nbsp;<span class="ident" id="2259873">sizeofPtr</span>&nbsp;<span class="op" id="2259883">==</span>&nbsp;<span class="num" id="2259886">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259889">dragonfly64Bit</span>&nbsp;<span class="op" id="2259904">=</span>&nbsp;<span class="ident" id="2259906">runtime</span><span class="op" id="2259913">.</span><span class="ident" id="2259914">GOOS</span>&nbsp;<span class="op" id="2259919">==</span>&nbsp;<span class="string" id="2259922">&#34;dragonfly&#34;</span>&nbsp;<span class="op" id="2259934">&amp;&amp;</span>&nbsp;<span class="ident" id="2259937">sizeofPtr</span>&nbsp;<span class="op" id="2259947">==</span>&nbsp;<span class="num" id="2259950">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259953">netbsd32Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2259968">=</span>&nbsp;<span class="ident" id="2259970">runtime</span><span class="op" id="2259977">.</span><span class="ident" id="2259978">GOOS</span>&nbsp;<span class="op" id="2259983">==</span>&nbsp;<span class="string" id="2259986">&#34;netbsd&#34;</span>&nbsp;<span class="op" id="2259995">&amp;&amp;</span>&nbsp;<span class="ident" id="2259998">sizeofPtr</span>&nbsp;<span class="op" id="2260008">==</span>&nbsp;<span class="num" id="2260011">4</span><br>
<span class="lineno">25</span><span class="op" id="2260013">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2260016">func</span>&nbsp;<span class="ident" id="2260021">Syscall</span><span class="op" id="2260028">(</span><span class="ident" id="2260029">trap</span><span class="op" id="2260033">,</span>&nbsp;<span class="ident" id="2260035">a1</span><span class="op" id="2260037">,</span>&nbsp;<span class="ident" id="2260039">a2</span><span class="op" id="2260041">,</span>&nbsp;<span class="ident" id="2260043">a3</span>&nbsp;<span class="builtintype" id="2260046">uintptr</span><span class="op" id="2260053">)</span>&nbsp;<span class="op" id="2260055">(</span><span class="ident" id="2260056">r1</span><span class="op" id="2260058">,</span>&nbsp;<span class="ident" id="2260060">r2</span>&nbsp;<span class="builtintype" id="2260063">uintptr</span><span class="op" id="2260070">,</span>&nbsp;<span class="ident" id="2260072">err</span>&nbsp;<span class="ident" id="2260076">Errno</span><span class="op" id="2260081">)</span><br>
<span class="lineno"></span><span class="keyword" id="2260083">func</span>&nbsp;<span class="ident" id="2260088">Syscall6</span><span class="op" id="2260096">(</span><span class="ident" id="2260097">trap</span><span class="op" id="2260101">,</span>&nbsp;<span class="ident" id="2260103">a1</span><span class="op" id="2260105">,</span>&nbsp;<span class="ident" id="2260107">a2</span><span class="op" id="2260109">,</span>&nbsp;<span class="ident" id="2260111">a3</span><span class="op" id="2260113">,</span>&nbsp;<span class="ident" id="2260115">a4</span><span class="op" id="2260117">,</span>&nbsp;<span class="ident" id="2260119">a5</span><span class="op" id="2260121">,</span>&nbsp;<span class="ident" id="2260123">a6</span>&nbsp;<span class="builtintype" id="2260126">uintptr</span><span class="op" id="2260133">)</span>&nbsp;<span class="op" id="2260135">(</span><span class="ident" id="2260136">r1</span><span class="op" id="2260138">,</span>&nbsp;<span class="ident" id="2260140">r2</span>&nbsp;<span class="builtintype" id="2260143">uintptr</span><span class="op" id="2260150">,</span>&nbsp;<span class="ident" id="2260152">err</span>&nbsp;<span class="ident" id="2260156">Errno</span><span class="op" id="2260161">)</span><br>
<span class="lineno"></span><span class="keyword" id="2260163">func</span>&nbsp;<span class="ident" id="2260168">RawSyscall</span><span class="op" id="2260178">(</span><span class="ident" id="2260179">trap</span><span class="op" id="2260183">,</span>&nbsp;<span class="ident" id="2260185">a1</span><span class="op" id="2260187">,</span>&nbsp;<span class="ident" id="2260189">a2</span><span class="op" id="2260191">,</span>&nbsp;<span class="ident" id="2260193">a3</span>&nbsp;<span class="builtintype" id="2260196">uintptr</span><span class="op" id="2260203">)</span>&nbsp;<span class="op" id="2260205">(</span><span class="ident" id="2260206">r1</span><span class="op" id="2260208">,</span>&nbsp;<span class="ident" id="2260210">r2</span>&nbsp;<span class="builtintype" id="2260213">uintptr</span><span class="op" id="2260220">,</span>&nbsp;<span class="ident" id="2260222">err</span>&nbsp;<span class="ident" id="2260226">Errno</span><span class="op" id="2260231">)</span><br>
<span class="lineno">30</span><span class="keyword" id="2260233">func</span>&nbsp;<span class="ident" id="2260238">RawSyscall6</span><span class="op" id="2260249">(</span><span class="ident" id="2260250">trap</span><span class="op" id="2260254">,</span>&nbsp;<span class="ident" id="2260256">a1</span><span class="op" id="2260258">,</span>&nbsp;<span class="ident" id="2260260">a2</span><span class="op" id="2260262">,</span>&nbsp;<span class="ident" id="2260264">a3</span><span class="op" id="2260266">,</span>&nbsp;<span class="ident" id="2260268">a4</span><span class="op" id="2260270">,</span>&nbsp;<span class="ident" id="2260272">a5</span><span class="op" id="2260274">,</span>&nbsp;<span class="ident" id="2260276">a6</span>&nbsp;<span class="builtintype" id="2260279">uintptr</span><span class="op" id="2260286">)</span>&nbsp;<span class="op" id="2260288">(</span><span class="ident" id="2260289">r1</span><span class="op" id="2260291">,</span>&nbsp;<span class="ident" id="2260293">r2</span>&nbsp;<span class="builtintype" id="2260296">uintptr</span><span class="op" id="2260303">,</span>&nbsp;<span class="ident" id="2260305">err</span>&nbsp;<span class="ident" id="2260309">Errno</span><span class="op" id="2260314">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2260317">//&nbsp;Mmap&nbsp;manager,&nbsp;for&nbsp;use&nbsp;by&nbsp;operating&nbsp;system-specific&nbsp;implementations.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2260389">type</span>&nbsp;<span class="ident" id="2260394">mmapper</span>&nbsp;<span class="keyword" id="2260402">struct</span>&nbsp;<span class="op" id="2260409">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2260412">sync</span><span class="op" id="2260416">.</span><span class="ident" id="2260417">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2260424">active</span>&nbsp;<span class="keyword" id="2260431">map</span><span class="op" id="2260434">[</span><span class="op" id="2260435">*</span><span class="builtintype" id="2260436">byte</span><span class="op" id="2260440">]</span><span class="op" id="2260441">[</span><span class="op" id="2260442">]</span><span class="builtintype" id="2260443">byte</span>&nbsp;<span class="comment" id="2260448">//&nbsp;active&nbsp;mappings;&nbsp;key&nbsp;is&nbsp;last&nbsp;byte&nbsp;in&nbsp;mapping</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2260497">mmap</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="2260504">func</span><span class="op" id="2260508">(</span><span class="ident" id="2260509">addr</span><span class="op" id="2260513">,</span>&nbsp;<span class="ident" id="2260515">length</span>&nbsp;<span class="builtintype" id="2260522">uintptr</span><span class="op" id="2260529">,</span>&nbsp;<span class="ident" id="2260531">prot</span><span class="op" id="2260535">,</span>&nbsp;<span class="ident" id="2260537">flags</span><span class="op" id="2260542">,</span>&nbsp;<span class="ident" id="2260544">fd</span>&nbsp;<span class="builtintype" id="2260547">int</span><span class="op" id="2260550">,</span>&nbsp;<span class="ident" id="2260552">offset</span>&nbsp;<span class="ident" id="2260559">int64</span><span class="op" id="2260564">)</span>&nbsp;<span class="op" id="2260566">(</span><span class="builtintype" id="2260567">uintptr</span><span class="op" id="2260574">,</span>&nbsp;<span class="builtintype" id="2260576">error</span><span class="op" id="2260581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2260584">munmap</span>&nbsp;<span class="keyword" id="2260591">func</span><span class="op" id="2260595">(</span><span class="ident" id="2260596">addr</span>&nbsp;<span class="builtintype" id="2260601">uintptr</span><span class="op" id="2260608">,</span>&nbsp;<span class="ident" id="2260610">length</span>&nbsp;<span class="builtintype" id="2260617">uintptr</span><span class="op" id="2260624">)</span>&nbsp;<span class="builtintype" id="2260626">error</span><br>
<span class="lineno"></span><span class="op" id="2260632">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2260635">func</span>&nbsp;<span class="op" id="2260640">(</span><span class="ident" id="2260641">m</span>&nbsp;<span class="op" id="2260643">*</span><span class="ident" id="2260644">mmapper</span><span class="op" id="2260651">)</span>&nbsp;<span class="ident" id="2260653">Mmap</span><span class="op" id="2260657">(</span><span class="ident" id="2260658">fd</span>&nbsp;<span class="builtintype" id="2260661">int</span><span class="op" id="2260664">,</span>&nbsp;<span class="ident" id="2260666">offset</span>&nbsp;<span class="ident" id="2260673">int64</span><span class="op" id="2260678">,</span>&nbsp;<span class="ident" id="2260680">length</span>&nbsp;<span class="builtintype" id="2260687">int</span><span class="op" id="2260690">,</span>&nbsp;<span class="ident" id="2260692">prot</span>&nbsp;<span class="builtintype" id="2260697">int</span><span class="op" id="2260700">,</span>&nbsp;<span class="ident" id="2260702">flags</span>&nbsp;<span class="builtintype" id="2260708">int</span><span class="op" id="2260711">)</span>&nbsp;<span class="op" id="2260713">(</span><span class="ident" id="2260714">data</span>&nbsp;<span class="op" id="2260719">[</span><span class="op" id="2260720">]</span><span class="builtintype" id="2260721">byte</span><span class="op" id="2260725">,</span>&nbsp;<span class="ident" id="2260727">err</span>&nbsp;<span class="builtintype" id="2260731">error</span><span class="op" id="2260736">)</span>&nbsp;<span class="op" id="2260738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260741">if</span>&nbsp;<span class="ident" id="2260744">length</span>&nbsp;<span class="op" id="2260751">&lt;=</span>&nbsp;<span class="num" id="2260754">0</span>&nbsp;<span class="op" id="2260756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260760">return</span>&nbsp;<span class="ident" id="2260767">nil</span><span class="op" id="2260770">,</span>&nbsp;<span class="ident" id="2260772">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2260780">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2260784">//&nbsp;Map&nbsp;the&nbsp;requested&nbsp;memory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2260814">addr</span><span class="op" id="2260818">,</span>&nbsp;<span class="ident" id="2260820">errno</span>&nbsp;<span class="op" id="2260826">:=</span>&nbsp;<span class="ident" id="2260829">m</span><span class="op" id="2260830">.</span><span class="ident" id="2260831">mmap</span><span class="op" id="2260835">(</span><span class="num" id="2260836">0</span><span class="op" id="2260837">,</span>&nbsp;<span class="builtintype" id="2260839">uintptr</span><span class="op" id="2260846">(</span><span class="ident" id="2260847">length</span><span class="op" id="2260853">)</span><span class="op" id="2260854">,</span>&nbsp;<span class="ident" id="2260856">prot</span><span class="op" id="2260860">,</span>&nbsp;<span class="ident" id="2260862">flags</span><span class="op" id="2260867">,</span>&nbsp;<span class="ident" id="2260869">fd</span><span class="op" id="2260871">,</span>&nbsp;<span class="ident" id="2260873">offset</span><span class="op" id="2260879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260882">if</span>&nbsp;<span class="ident" id="2260885">errno</span>&nbsp;<span class="op" id="2260891">!=</span>&nbsp;<span class="ident" id="2260894">nil</span>&nbsp;<span class="op" id="2260898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260902">return</span>&nbsp;<span class="ident" id="2260909">nil</span><span class="op" id="2260912">,</span>&nbsp;<span class="ident" id="2260914">errno</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2260921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2260925">//&nbsp;Slice&nbsp;memory&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260949">var</span>&nbsp;<span class="ident" id="2260953">sl</span>&nbsp;<span class="op" id="2260956">=</span>&nbsp;<span class="keyword" id="2260958">struct</span>&nbsp;<span class="op" id="2260965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2260969">addr</span>&nbsp;<span class="builtintype" id="2260974">uintptr</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2260984">len</span>&nbsp;&nbsp;<span class="builtintype" id="2260989">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2260995">cap</span>&nbsp;&nbsp;<span class="builtintype" id="2261000">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2261005">}</span><span class="op" id="2261006">{</span><span class="ident" id="2261007">addr</span><span class="op" id="2261011">,</span>&nbsp;<span class="ident" id="2261013">length</span><span class="op" id="2261019">,</span>&nbsp;<span class="ident" id="2261021">length</span><span class="op" id="2261027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261031">//&nbsp;Use&nbsp;unsafe&nbsp;to&nbsp;turn&nbsp;sl&nbsp;into&nbsp;a&nbsp;[]byte.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2261072">b</span>&nbsp;<span class="op" id="2261074">:=</span>&nbsp;<span class="op" id="2261077">*</span><span class="op" id="2261078">(</span><span class="op" id="2261079">*</span><span class="op" id="2261080">[</span><span class="op" id="2261081">]</span><span class="builtintype" id="2261082">byte</span><span class="op" id="2261086">)</span><span class="op" id="2261087">(</span><span class="ident" id="2261088">unsafe</span><span class="op" id="2261094">.</span><span class="ident" id="2261095">Pointer</span><span class="op" id="2261102">(</span><span class="op" id="2261103">&amp;</span><span class="ident" id="2261104">sl</span><span class="op" id="2261106">)</span><span class="op" id="2261107">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261111">//&nbsp;Register&nbsp;mapping&nbsp;in&nbsp;m&nbsp;and&nbsp;return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2261152">p</span>&nbsp;<span class="op" id="2261154">:=</span>&nbsp;<span class="op" id="2261157">&amp;</span><span class="ident" id="2261158">b</span><span class="op" id="2261159">[</span><span class="builtinfunc" id="2261160">cap</span><span class="op" id="2261163">(</span><span class="ident" id="2261164">b</span><span class="op" id="2261165">)</span><span class="op" id="2261166">-</span><span class="num" id="2261167">1</span><span class="op" id="2261168">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2261171">m</span><span class="op" id="2261172">.</span><span class="ident" id="2261173">Lock</span><span class="op" id="2261177">(</span><span class="op" id="2261178">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2261181">defer</span>&nbsp;<span class="ident" id="2261187">m</span><span class="op" id="2261188">.</span><span class="ident" id="2261189">Unlock</span><span class="op" id="2261195">(</span><span class="op" id="2261196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2261199">m</span><span class="op" id="2261200">.</span><span class="ident" id="2261201">active</span><span class="op" id="2261207">[</span><span class="ident" id="2261208">p</span><span class="op" id="2261209">]</span>&nbsp;<span class="op" id="2261211">=</span>&nbsp;<span class="ident" id="2261213">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2261216">return</span>&nbsp;<span class="ident" id="2261223">b</span><span class="op" id="2261224">,</span>&nbsp;<span class="ident" id="2261226">nil</span><br>
<span class="lineno"></span><span class="op" id="2261230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="2261233">func</span>&nbsp;<span class="op" id="2261238">(</span><span class="ident" id="2261239">m</span>&nbsp;<span class="op" id="2261241">*</span><span class="ident" id="2261242">mmapper</span><span class="op" id="2261249">)</span>&nbsp;<span class="ident" id="2261251">Munmap</span><span class="op" id="2261257">(</span><span class="ident" id="2261258">data</span>&nbsp;<span class="op" id="2261263">[</span><span class="op" id="2261264">]</span><span class="builtintype" id="2261265">byte</span><span class="op" id="2261269">)</span>&nbsp;<span class="op" id="2261271">(</span><span class="ident" id="2261272">err</span>&nbsp;<span class="builtintype" id="2261276">error</span><span class="op" id="2261281">)</span>&nbsp;<span class="op" id="2261283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2261286">if</span>&nbsp;<span class="builtinfunc" id="2261289">len</span><span class="op" id="2261292">(</span><span class="ident" id="2261293">data</span><span class="op" id="2261297">)</span>&nbsp;<span class="op" id="2261299">==</span>&nbsp;<span class="num" id="2261302">0</span>&nbsp;<span class="op" id="2261304">||</span>&nbsp;<span class="builtinfunc" id="2261307">len</span><span class="op" id="2261310">(</span><span class="ident" id="2261311">data</span><span class="op" id="2261315">)</span>&nbsp;<span class="op" id="2261317">!=</span>&nbsp;<span class="builtinfunc" id="2261320">cap</span><span class="op" id="2261323">(</span><span class="ident" id="2261324">data</span><span class="op" id="2261328">)</span>&nbsp;<span class="op" id="2261330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2261334">return</span>&nbsp;<span class="ident" id="2261341">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2261349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261353">//&nbsp;Find&nbsp;the&nbsp;base&nbsp;of&nbsp;the&nbsp;mapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2261387">p</span>&nbsp;<span class="op" id="2261389">:=</span>&nbsp;<span class="op" id="2261392">&amp;</span><span class="ident" id="2261393">data</span><span class="op" id="2261397">[</span><span class="builtinfunc" id="2261398">cap</span><span class="op" id="2261401">(</span><span class="ident" id="2261402">data</span><span class="op" id="2261406">)</span><span class="op" id="2261407">-</span><span class="num" id="2261408">1</span><span class="op" id="2261409">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2261412">m</span><span class="op" id="2261413">.</span><span class="ident" id="2261414">Lock</span><span class="op" id="2261418">(</span><span class="op" id="2261419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2261422">defer</span>&nbsp;<span class="ident" id="2261428">m</span><span class="op" id="2261429">.</span><span class="ident" id="2261430">Unlock</span><span class="op" id="2261436">(</span><span class="op" id="2261437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2261440">b</span>&nbsp;<span class="op" id="2261442">:=</span>&nbsp;<span class="ident" id="2261445">m</span><span class="op" id="2261446">.</span><span class="ident" id="2261447">active</span><span class="op" id="2261453">[</span><span class="ident" id="2261454">p</span><span class="op" id="2261455">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2261458">if</span>&nbsp;<span class="ident" id="2261461">b</span>&nbsp;<span class="op" id="2261463">==</span>&nbsp;<span class="ident" id="2261466">nil</span>&nbsp;<span class="op" id="2261470">||</span>&nbsp;<span class="op" id="2261473">&amp;</span><span class="ident" id="2261474">b</span><span class="op" id="2261475">[</span><span class="num" id="2261476">0</span><span class="op" id="2261477">]</span>&nbsp;<span class="op" id="2261479">!=</span>&nbsp;<span class="op" id="2261482">&amp;</span><span class="ident" id="2261483">data</span><span class="op" id="2261487">[</span><span class="num" id="2261488">0</span><span class="op" id="2261489">]</span>&nbsp;<span class="op" id="2261491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2261495">return</span>&nbsp;<span class="ident" id="2261502">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2261510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261514">//&nbsp;Unmap&nbsp;the&nbsp;memory&nbsp;and&nbsp;update&nbsp;m.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2261549">if</span>&nbsp;<span class="ident" id="2261552">errno</span>&nbsp;<span class="op" id="2261558">:=</span>&nbsp;<span class="ident" id="2261561">m</span><span class="op" id="2261562">.</span><span class="ident" id="2261563">munmap</span><span class="op" id="2261569">(</span><span class="builtintype" id="2261570">uintptr</span><span class="op" id="2261577">(</span><span class="ident" id="2261578">unsafe</span><span class="op" id="2261584">.</span><span class="ident" id="2261585">Pointer</span><span class="op" id="2261592">(</span><span class="op" id="2261593">&amp;</span><span class="ident" id="2261594">b</span><span class="op" id="2261595">[</span><span class="num" id="2261596">0</span><span class="op" id="2261597">]</span><span class="op" id="2261598">)</span><span class="op" id="2261599">)</span><span class="op" id="2261600">,</span>&nbsp;<span class="builtintype" id="2261602">uintptr</span><span class="op" id="2261609">(</span><span class="builtinfunc" id="2261610">len</span><span class="op" id="2261613">(</span><span class="ident" id="2261614">b</span><span class="op" id="2261615">)</span><span class="op" id="2261616">)</span><span class="op" id="2261617">)</span><span class="op" id="2261618">;</span>&nbsp;<span class="ident" id="2261620">errno</span>&nbsp;<span class="op" id="2261626">!=</span>&nbsp;<span class="ident" id="2261629">nil</span>&nbsp;<span class="op" id="2261633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2261637">return</span>&nbsp;<span class="ident" id="2261644">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2261651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2261654">delete</span><span class="op" id="2261660">(</span><span class="ident" id="2261661">m</span><span class="op" id="2261662">.</span><span class="ident" id="2261663">active</span><span class="op" id="2261669">,</span>&nbsp;<span class="ident" id="2261671">p</span><span class="op" id="2261672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2261675">return</span>&nbsp;<span class="ident" id="2261682">nil</span><br>
<span class="lineno">90</span><span class="op" id="2261686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2261689">//&nbsp;An&nbsp;Errno&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;number&nbsp;describing&nbsp;an&nbsp;error&nbsp;condition.</span><br>
<span class="lineno"></span><span class="comment" id="2261754">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;error&nbsp;interface.&nbsp;&nbsp;The&nbsp;zero&nbsp;Errno&nbsp;is&nbsp;by&nbsp;convention</span><br>
<span class="lineno"></span><span class="comment" id="2261825">//&nbsp;a&nbsp;non-error,&nbsp;so&nbsp;code&nbsp;to&nbsp;convert&nbsp;from&nbsp;Errno&nbsp;to&nbsp;error&nbsp;should&nbsp;use:</span><br>
<span class="lineno">95</span><span class="comment" id="2261892">//&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span><span class="comment" id="2261905">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;errno&nbsp;!=&nbsp;0&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="2261924">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;errno</span><br>
<span class="lineno"></span><span class="comment" id="2261940">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="keyword" id="2261945">type</span>&nbsp;<span class="ident" id="2261950">Errno</span>&nbsp;<span class="builtintype" id="2261956">uintptr</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2261965">func</span>&nbsp;<span class="op" id="2261970">(</span><span class="ident" id="2261971">e</span>&nbsp;<span class="ident" id="2261973">Errno</span><span class="op" id="2261978">)</span>&nbsp;<span class="ident" id="2261980">Error</span><span class="op" id="2261985">(</span><span class="op" id="2261986">)</span>&nbsp;<span class="builtintype" id="2261988">string</span>&nbsp;<span class="op" id="2261995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2261998">if</span>&nbsp;<span class="num" id="2262001">0</span>&nbsp;<span class="op" id="2262003">&lt;=</span>&nbsp;<span class="builtintype" id="2262006">int</span><span class="op" id="2262009">(</span><span class="ident" id="2262010">e</span><span class="op" id="2262011">)</span>&nbsp;<span class="op" id="2262013">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2262016">int</span><span class="op" id="2262019">(</span><span class="ident" id="2262020">e</span><span class="op" id="2262021">)</span>&nbsp;<span class="op" id="2262023">&lt;</span>&nbsp;<span class="builtinfunc" id="2262025">len</span><span class="op" id="2262028">(</span><span class="ident" id="2262029">errors</span><span class="op" id="2262035">)</span>&nbsp;<span class="op" id="2262037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262041">s</span>&nbsp;<span class="op" id="2262043">:=</span>&nbsp;<span class="ident" id="2262046">errors</span><span class="op" id="2262052">[</span><span class="ident" id="2262053">e</span><span class="op" id="2262054">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262058">if</span>&nbsp;<span class="ident" id="2262061">s</span>&nbsp;<span class="op" id="2262063">!=</span>&nbsp;<span class="string" id="2262066">&#34;&#34;</span>&nbsp;<span class="op" id="2262069">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262074">return</span>&nbsp;<span class="ident" id="2262081">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2262085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2262088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262091">return</span>&nbsp;<span class="string" id="2262098">&#34;errno&nbsp;&#34;</span>&nbsp;<span class="op" id="2262107">+</span>&nbsp;<span class="ident" id="2262109">itoa</span><span class="op" id="2262113">(</span><span class="builtintype" id="2262114">int</span><span class="op" id="2262117">(</span><span class="ident" id="2262118">e</span><span class="op" id="2262119">)</span><span class="op" id="2262120">)</span><br>
<span class="lineno"></span><span class="op" id="2262122">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="2262125">func</span>&nbsp;<span class="op" id="2262130">(</span><span class="ident" id="2262131">e</span>&nbsp;<span class="ident" id="2262133">Errno</span><span class="op" id="2262138">)</span>&nbsp;<span class="ident" id="2262140">Temporary</span><span class="op" id="2262149">(</span><span class="op" id="2262150">)</span>&nbsp;<span class="builtintype" id="2262152">bool</span>&nbsp;<span class="op" id="2262157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262160">return</span>&nbsp;<span class="ident" id="2262167">e</span>&nbsp;<span class="op" id="2262169">==</span>&nbsp;<span class="ident" id="2262172">EINTR</span>&nbsp;<span class="op" id="2262178">||</span>&nbsp;<span class="ident" id="2262181">e</span>&nbsp;<span class="op" id="2262183">==</span>&nbsp;<span class="ident" id="2262186">EMFILE</span>&nbsp;<span class="op" id="2262193">||</span>&nbsp;<span class="ident" id="2262196">e</span>&nbsp;<span class="op" id="2262198">==</span>&nbsp;<span class="ident" id="2262201">ECONNRESET</span>&nbsp;<span class="op" id="2262212">||</span>&nbsp;<span class="ident" id="2262215">e</span>&nbsp;<span class="op" id="2262217">==</span>&nbsp;<span class="ident" id="2262220">ECONNABORTED</span>&nbsp;<span class="op" id="2262233">||</span>&nbsp;<span class="ident" id="2262236">e</span><span class="op" id="2262237">.</span><span class="ident" id="2262238">Timeout</span><span class="op" id="2262245">(</span><span class="op" id="2262246">)</span><br>
<span class="lineno"></span><span class="op" id="2262248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="2262251">func</span>&nbsp;<span class="op" id="2262256">(</span><span class="ident" id="2262257">e</span>&nbsp;<span class="ident" id="2262259">Errno</span><span class="op" id="2262264">)</span>&nbsp;<span class="ident" id="2262266">Timeout</span><span class="op" id="2262273">(</span><span class="op" id="2262274">)</span>&nbsp;<span class="builtintype" id="2262276">bool</span>&nbsp;<span class="op" id="2262281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262284">return</span>&nbsp;<span class="ident" id="2262291">e</span>&nbsp;<span class="op" id="2262293">==</span>&nbsp;<span class="ident" id="2262296">EAGAIN</span>&nbsp;<span class="op" id="2262303">||</span>&nbsp;<span class="ident" id="2262306">e</span>&nbsp;<span class="op" id="2262308">==</span>&nbsp;<span class="ident" id="2262311">EWOULDBLOCK</span>&nbsp;<span class="op" id="2262323">||</span>&nbsp;<span class="ident" id="2262326">e</span>&nbsp;<span class="op" id="2262328">==</span>&nbsp;<span class="ident" id="2262331">ETIMEDOUT</span><br>
<span class="lineno"></span><span class="op" id="2262341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2262344">//&nbsp;A&nbsp;Signal&nbsp;is&nbsp;a&nbsp;number&nbsp;describing&nbsp;a&nbsp;process&nbsp;signal.</span><br>
<span class="lineno">120</span><span class="comment" id="2262397">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;os.Signal&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="2262439">type</span>&nbsp;<span class="ident" id="2262444">Signal</span>&nbsp;<span class="builtintype" id="2262451">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2262456">func</span>&nbsp;<span class="op" id="2262461">(</span><span class="ident" id="2262462">s</span>&nbsp;<span class="ident" id="2262464">Signal</span><span class="op" id="2262470">)</span>&nbsp;<span class="ident" id="2262472">Signal</span><span class="op" id="2262478">(</span><span class="op" id="2262479">)</span>&nbsp;<span class="op" id="2262481">{</span><span class="op" id="2262482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2262485">func</span>&nbsp;<span class="op" id="2262490">(</span><span class="ident" id="2262491">s</span>&nbsp;<span class="ident" id="2262493">Signal</span><span class="op" id="2262499">)</span>&nbsp;<span class="ident" id="2262501">String</span><span class="op" id="2262507">(</span><span class="op" id="2262508">)</span>&nbsp;<span class="builtintype" id="2262510">string</span>&nbsp;<span class="op" id="2262517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262520">if</span>&nbsp;<span class="num" id="2262523">0</span>&nbsp;<span class="op" id="2262525">&lt;=</span>&nbsp;<span class="ident" id="2262528">s</span>&nbsp;<span class="op" id="2262530">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2262533">int</span><span class="op" id="2262536">(</span><span class="ident" id="2262537">s</span><span class="op" id="2262538">)</span>&nbsp;<span class="op" id="2262540">&lt;</span>&nbsp;<span class="builtinfunc" id="2262542">len</span><span class="op" id="2262545">(</span><span class="ident" id="2262546">signals</span><span class="op" id="2262553">)</span>&nbsp;<span class="op" id="2262555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262559">str</span>&nbsp;<span class="op" id="2262563">:=</span>&nbsp;<span class="ident" id="2262566">signals</span><span class="op" id="2262573">[</span><span class="ident" id="2262574">s</span><span class="op" id="2262575">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262579">if</span>&nbsp;<span class="ident" id="2262582">str</span>&nbsp;<span class="op" id="2262586">!=</span>&nbsp;<span class="string" id="2262589">&#34;&#34;</span>&nbsp;<span class="op" id="2262592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262597">return</span>&nbsp;<span class="ident" id="2262604">str</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2262610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2262613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262616">return</span>&nbsp;<span class="string" id="2262623">&#34;signal&nbsp;&#34;</span>&nbsp;<span class="op" id="2262633">+</span>&nbsp;<span class="ident" id="2262635">itoa</span><span class="op" id="2262639">(</span><span class="builtintype" id="2262640">int</span><span class="op" id="2262643">(</span><span class="ident" id="2262644">s</span><span class="op" id="2262645">)</span><span class="op" id="2262646">)</span><br>
<span class="lineno"></span><span class="op" id="2262648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="2262651">func</span>&nbsp;<span class="ident" id="2262656">Read</span><span class="op" id="2262660">(</span><span class="ident" id="2262661">fd</span>&nbsp;<span class="builtintype" id="2262664">int</span><span class="op" id="2262667">,</span>&nbsp;<span class="ident" id="2262669">p</span>&nbsp;<span class="op" id="2262671">[</span><span class="op" id="2262672">]</span><span class="builtintype" id="2262673">byte</span><span class="op" id="2262677">)</span>&nbsp;<span class="op" id="2262679">(</span><span class="ident" id="2262680">n</span>&nbsp;<span class="builtintype" id="2262682">int</span><span class="op" id="2262685">,</span>&nbsp;<span class="ident" id="2262687">err</span>&nbsp;<span class="builtintype" id="2262691">error</span><span class="op" id="2262696">)</span>&nbsp;<span class="op" id="2262698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262701">n</span><span class="op" id="2262702">,</span>&nbsp;<span class="ident" id="2262704">err</span>&nbsp;<span class="op" id="2262708">=</span>&nbsp;<span class="ident" id="2262710">read</span><span class="op" id="2262714">(</span><span class="ident" id="2262715">fd</span><span class="op" id="2262717">,</span>&nbsp;<span class="ident" id="2262719">p</span><span class="op" id="2262720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262723">if</span>&nbsp;<span class="ident" id="2262726">raceenabled</span>&nbsp;<span class="op" id="2262738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262742">if</span>&nbsp;<span class="ident" id="2262745">n</span>&nbsp;<span class="op" id="2262747">&gt;</span>&nbsp;<span class="num" id="2262749">0</span>&nbsp;<span class="op" id="2262751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262756">raceWriteRange</span><span class="op" id="2262770">(</span><span class="ident" id="2262771">unsafe</span><span class="op" id="2262777">.</span><span class="ident" id="2262778">Pointer</span><span class="op" id="2262785">(</span><span class="op" id="2262786">&amp;</span><span class="ident" id="2262787">p</span><span class="op" id="2262788">[</span><span class="num" id="2262789">0</span><span class="op" id="2262790">]</span><span class="op" id="2262791">)</span><span class="op" id="2262792">,</span>&nbsp;<span class="ident" id="2262794">n</span><span class="op" id="2262795">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2262799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262803">if</span>&nbsp;<span class="ident" id="2262806">err</span>&nbsp;<span class="op" id="2262810">==</span>&nbsp;<span class="ident" id="2262813">nil</span>&nbsp;<span class="op" id="2262817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262822">raceAcquire</span><span class="op" id="2262833">(</span><span class="ident" id="2262834">unsafe</span><span class="op" id="2262840">.</span><span class="ident" id="2262841">Pointer</span><span class="op" id="2262848">(</span><span class="op" id="2262849">&amp;</span><span class="ident" id="2262850">ioSync</span><span class="op" id="2262856">)</span><span class="op" id="2262857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2262861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2262864">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262867">return</span><br>
<span class="lineno"></span><span class="op" id="2262874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2262877">func</span>&nbsp;<span class="ident" id="2262882">Write</span><span class="op" id="2262887">(</span><span class="ident" id="2262888">fd</span>&nbsp;<span class="builtintype" id="2262891">int</span><span class="op" id="2262894">,</span>&nbsp;<span class="ident" id="2262896">p</span>&nbsp;<span class="op" id="2262898">[</span><span class="op" id="2262899">]</span><span class="builtintype" id="2262900">byte</span><span class="op" id="2262904">)</span>&nbsp;<span class="op" id="2262906">(</span><span class="ident" id="2262907">n</span>&nbsp;<span class="builtintype" id="2262909">int</span><span class="op" id="2262912">,</span>&nbsp;<span class="ident" id="2262914">err</span>&nbsp;<span class="builtintype" id="2262918">error</span><span class="op" id="2262923">)</span>&nbsp;<span class="op" id="2262925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262928">if</span>&nbsp;<span class="ident" id="2262931">raceenabled</span>&nbsp;<span class="op" id="2262943">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262947">raceReleaseMerge</span><span class="op" id="2262963">(</span><span class="ident" id="2262964">unsafe</span><span class="op" id="2262970">.</span><span class="ident" id="2262971">Pointer</span><span class="op" id="2262978">(</span><span class="op" id="2262979">&amp;</span><span class="ident" id="2262980">ioSync</span><span class="op" id="2262986">)</span><span class="op" id="2262987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2262990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262993">n</span><span class="op" id="2262994">,</span>&nbsp;<span class="ident" id="2262996">err</span>&nbsp;<span class="op" id="2263000">=</span>&nbsp;<span class="ident" id="2263002">write</span><span class="op" id="2263007">(</span><span class="ident" id="2263008">fd</span><span class="op" id="2263010">,</span>&nbsp;<span class="ident" id="2263012">p</span><span class="op" id="2263013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263016">if</span>&nbsp;<span class="ident" id="2263019">raceenabled</span>&nbsp;<span class="op" id="2263031">&amp;&amp;</span>&nbsp;<span class="ident" id="2263034">n</span>&nbsp;<span class="op" id="2263036">&gt;</span>&nbsp;<span class="num" id="2263038">0</span>&nbsp;<span class="op" id="2263040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2263044">raceReadRange</span><span class="op" id="2263057">(</span><span class="ident" id="2263058">unsafe</span><span class="op" id="2263064">.</span><span class="ident" id="2263065">Pointer</span><span class="op" id="2263072">(</span><span class="op" id="2263073">&amp;</span><span class="ident" id="2263074">p</span><span class="op" id="2263075">[</span><span class="num" id="2263076">0</span><span class="op" id="2263077">]</span><span class="op" id="2263078">)</span><span class="op" id="2263079">,</span>&nbsp;<span class="ident" id="2263081">n</span><span class="op" id="2263082">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2263085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263088">return</span><br>
<span class="lineno"></span><span class="op" id="2263095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2263098">//&nbsp;For&nbsp;testing:&nbsp;clients&nbsp;can&nbsp;set&nbsp;this&nbsp;flag&nbsp;to&nbsp;force</span><br>
<span class="lineno">160</span><span class="comment" id="2263149">//&nbsp;creation&nbsp;of&nbsp;IPv6&nbsp;sockets&nbsp;to&nbsp;return&nbsp;EAFNOSUPPORT.</span><br>
<span class="lineno"></span><span class="keyword" id="2263201">var</span>&nbsp;<span class="ident" id="2263205">SocketDisableIPv6</span>&nbsp;<span class="builtintype" id="2263223">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2263229">type</span>&nbsp;<span class="ident" id="2263234">Sockaddr</span>&nbsp;<span class="keyword" id="2263243">interface</span>&nbsp;<span class="op" id="2263253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2263256">sockaddr</span><span class="op" id="2263264">(</span><span class="op" id="2263265">)</span>&nbsp;<span class="op" id="2263267">(</span><span class="ident" id="2263268">ptr</span>&nbsp;<span class="ident" id="2263272">unsafe</span><span class="op" id="2263278">.</span><span class="ident" id="2263279">Pointer</span><span class="op" id="2263286">,</span>&nbsp;<span class="builtinfunc" id="2263288">len</span>&nbsp;<span class="ident" id="2263292">_Socklen</span><span class="op" id="2263300">,</span>&nbsp;<span class="ident" id="2263302">err</span>&nbsp;<span class="builtintype" id="2263306">error</span><span class="op" id="2263311">)</span>&nbsp;<span class="comment" id="2263313">//&nbsp;lowercase;&nbsp;only&nbsp;we&nbsp;can&nbsp;define&nbsp;Sockaddrs</span><br>
<span class="lineno">165</span><span class="op" id="2263356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2263359">type</span>&nbsp;<span class="ident" id="2263364">SockaddrInet4</span>&nbsp;<span class="keyword" id="2263378">struct</span>&nbsp;<span class="op" id="2263385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2263388">Port</span>&nbsp;<span class="builtintype" id="2263393">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2263398">Addr</span>&nbsp;<span class="op" id="2263403">[</span><span class="num" id="2263404">4</span><span class="op" id="2263405">]</span><span class="builtintype" id="2263406">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2263412">raw</span>&nbsp;&nbsp;<span class="ident" id="2263417">RawSockaddrInet4</span><br>
<span class="lineno"></span><span class="op" id="2263434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2263437">type</span>&nbsp;<span class="ident" id="2263442">SockaddrInet6</span>&nbsp;<span class="keyword" id="2263456">struct</span>&nbsp;<span class="op" id="2263463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2263466">Port</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2263473">int</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2263478">ZoneId</span>&nbsp;<span class="builtintype" id="2263485">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2263493">Addr</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2263500">[</span><span class="num" id="2263501">16</span><span class="op" id="2263503">]</span><span class="builtintype" id="2263504">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2263510">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2263517">RawSockaddrInet6</span><br>
<span class="lineno"></span><span class="op" id="2263534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="2263537">type</span>&nbsp;<span class="ident" id="2263542">SockaddrUnix</span>&nbsp;<span class="keyword" id="2263555">struct</span>&nbsp;<span class="op" id="2263562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2263565">Name</span>&nbsp;<span class="builtintype" id="2263570">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2263578">raw</span>&nbsp;&nbsp;<span class="ident" id="2263583">RawSockaddrUnix</span><br>
<span class="lineno"></span><span class="op" id="2263599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="2263602">func</span>&nbsp;<span class="ident" id="2263607">Bind</span><span class="op" id="2263611">(</span><span class="ident" id="2263612">fd</span>&nbsp;<span class="builtintype" id="2263615">int</span><span class="op" id="2263618">,</span>&nbsp;<span class="ident" id="2263620">sa</span>&nbsp;<span class="ident" id="2263623">Sockaddr</span><span class="op" id="2263631">)</span>&nbsp;<span class="op" id="2263633">(</span><span class="ident" id="2263634">err</span>&nbsp;<span class="builtintype" id="2263638">error</span><span class="op" id="2263643">)</span>&nbsp;<span class="op" id="2263645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2263648">ptr</span><span class="op" id="2263651">,</span>&nbsp;<span class="ident" id="2263653">n</span><span class="op" id="2263654">,</span>&nbsp;<span class="ident" id="2263656">err</span>&nbsp;<span class="op" id="2263660">:=</span>&nbsp;<span class="ident" id="2263663">sa</span><span class="op" id="2263665">.</span><span class="ident" id="2263666">sockaddr</span><span class="op" id="2263674">(</span><span class="op" id="2263675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263678">if</span>&nbsp;<span class="ident" id="2263681">err</span>&nbsp;<span class="op" id="2263685">!=</span>&nbsp;<span class="ident" id="2263688">nil</span>&nbsp;<span class="op" id="2263692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263696">return</span>&nbsp;<span class="ident" id="2263703">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2263708">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263711">return</span>&nbsp;<span class="ident" id="2263718">bind</span><span class="op" id="2263722">(</span><span class="ident" id="2263723">fd</span><span class="op" id="2263725">,</span>&nbsp;<span class="ident" id="2263727">ptr</span><span class="op" id="2263730">,</span>&nbsp;<span class="ident" id="2263732">n</span><span class="op" id="2263733">)</span><br>
<span class="lineno"></span><span class="op" id="2263735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2263738">func</span>&nbsp;<span class="ident" id="2263743">Connect</span><span class="op" id="2263750">(</span><span class="ident" id="2263751">fd</span>&nbsp;<span class="builtintype" id="2263754">int</span><span class="op" id="2263757">,</span>&nbsp;<span class="ident" id="2263759">sa</span>&nbsp;<span class="ident" id="2263762">Sockaddr</span><span class="op" id="2263770">)</span>&nbsp;<span class="op" id="2263772">(</span><span class="ident" id="2263773">err</span>&nbsp;<span class="builtintype" id="2263777">error</span><span class="op" id="2263782">)</span>&nbsp;<span class="op" id="2263784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2263787">ptr</span><span class="op" id="2263790">,</span>&nbsp;<span class="ident" id="2263792">n</span><span class="op" id="2263793">,</span>&nbsp;<span class="ident" id="2263795">err</span>&nbsp;<span class="op" id="2263799">:=</span>&nbsp;<span class="ident" id="2263802">sa</span><span class="op" id="2263804">.</span><span class="ident" id="2263805">sockaddr</span><span class="op" id="2263813">(</span><span class="op" id="2263814">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263817">if</span>&nbsp;<span class="ident" id="2263820">err</span>&nbsp;<span class="op" id="2263824">!=</span>&nbsp;<span class="ident" id="2263827">nil</span>&nbsp;<span class="op" id="2263831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263835">return</span>&nbsp;<span class="ident" id="2263842">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2263847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263850">return</span>&nbsp;<span class="ident" id="2263857">connect</span><span class="op" id="2263864">(</span><span class="ident" id="2263865">fd</span><span class="op" id="2263867">,</span>&nbsp;<span class="ident" id="2263869">ptr</span><span class="op" id="2263872">,</span>&nbsp;<span class="ident" id="2263874">n</span><span class="op" id="2263875">)</span><br>
<span class="lineno"></span><span class="op" id="2263877">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="2263880">func</span>&nbsp;<span class="ident" id="2263885">Getpeername</span><span class="op" id="2263896">(</span><span class="ident" id="2263897">fd</span>&nbsp;<span class="builtintype" id="2263900">int</span><span class="op" id="2263903">)</span>&nbsp;<span class="op" id="2263905">(</span><span class="ident" id="2263906">sa</span>&nbsp;<span class="ident" id="2263909">Sockaddr</span><span class="op" id="2263917">,</span>&nbsp;<span class="ident" id="2263919">err</span>&nbsp;<span class="builtintype" id="2263923">error</span><span class="op" id="2263928">)</span>&nbsp;<span class="op" id="2263930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263933">var</span>&nbsp;<span class="ident" id="2263937">rsa</span>&nbsp;<span class="ident" id="2263941">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263957">var</span>&nbsp;<span class="builtinfunc" id="2263961">len</span>&nbsp;<span class="ident" id="2263965">_Socklen</span>&nbsp;<span class="op" id="2263974">=</span>&nbsp;<span class="ident" id="2263976">SizeofSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263995">if</span>&nbsp;<span class="ident" id="2263998">err</span>&nbsp;<span class="op" id="2264002">=</span>&nbsp;<span class="ident" id="2264004">getpeername</span><span class="op" id="2264015">(</span><span class="ident" id="2264016">fd</span><span class="op" id="2264018">,</span>&nbsp;<span class="op" id="2264020">&amp;</span><span class="ident" id="2264021">rsa</span><span class="op" id="2264024">,</span>&nbsp;<span class="op" id="2264026">&amp;</span><span class="builtinfunc" id="2264027">len</span><span class="op" id="2264030">)</span><span class="op" id="2264031">;</span>&nbsp;<span class="ident" id="2264033">err</span>&nbsp;<span class="op" id="2264037">!=</span>&nbsp;<span class="ident" id="2264040">nil</span>&nbsp;<span class="op" id="2264044">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264048">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2264056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264059">return</span>&nbsp;<span class="ident" id="2264066">anyToSockaddr</span><span class="op" id="2264079">(</span><span class="op" id="2264080">&amp;</span><span class="ident" id="2264081">rsa</span><span class="op" id="2264084">)</span><br>
<span class="lineno"></span><span class="op" id="2264086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="2264089">func</span>&nbsp;<span class="ident" id="2264094">GetsockoptInt</span><span class="op" id="2264107">(</span><span class="ident" id="2264108">fd</span><span class="op" id="2264110">,</span>&nbsp;<span class="ident" id="2264112">level</span><span class="op" id="2264117">,</span>&nbsp;<span class="ident" id="2264119">opt</span>&nbsp;<span class="builtintype" id="2264123">int</span><span class="op" id="2264126">)</span>&nbsp;<span class="op" id="2264128">(</span><span class="ident" id="2264129">value</span>&nbsp;<span class="builtintype" id="2264135">int</span><span class="op" id="2264138">,</span>&nbsp;<span class="ident" id="2264140">err</span>&nbsp;<span class="builtintype" id="2264144">error</span><span class="op" id="2264149">)</span>&nbsp;<span class="op" id="2264151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264154">var</span>&nbsp;<span class="ident" id="2264158">n</span>&nbsp;<span class="builtintype" id="2264160">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264167">vallen</span>&nbsp;<span class="op" id="2264174">:=</span>&nbsp;<span class="ident" id="2264177">_Socklen</span><span class="op" id="2264185">(</span><span class="num" id="2264186">4</span><span class="op" id="2264187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264190">err</span>&nbsp;<span class="op" id="2264194">=</span>&nbsp;<span class="ident" id="2264196">getsockopt</span><span class="op" id="2264206">(</span><span class="ident" id="2264207">fd</span><span class="op" id="2264209">,</span>&nbsp;<span class="ident" id="2264211">level</span><span class="op" id="2264216">,</span>&nbsp;<span class="ident" id="2264218">opt</span><span class="op" id="2264221">,</span>&nbsp;<span class="ident" id="2264223">unsafe</span><span class="op" id="2264229">.</span><span class="ident" id="2264230">Pointer</span><span class="op" id="2264237">(</span><span class="op" id="2264238">&amp;</span><span class="ident" id="2264239">n</span><span class="op" id="2264240">)</span><span class="op" id="2264241">,</span>&nbsp;<span class="op" id="2264243">&amp;</span><span class="ident" id="2264244">vallen</span><span class="op" id="2264250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264253">return</span>&nbsp;<span class="builtintype" id="2264260">int</span><span class="op" id="2264263">(</span><span class="ident" id="2264264">n</span><span class="op" id="2264265">)</span><span class="op" id="2264266">,</span>&nbsp;<span class="ident" id="2264268">err</span><br>
<span class="lineno">215</span><span class="op" id="2264272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2264275">func</span>&nbsp;<span class="ident" id="2264280">Recvfrom</span><span class="op" id="2264288">(</span><span class="ident" id="2264289">fd</span>&nbsp;<span class="builtintype" id="2264292">int</span><span class="op" id="2264295">,</span>&nbsp;<span class="ident" id="2264297">p</span>&nbsp;<span class="op" id="2264299">[</span><span class="op" id="2264300">]</span><span class="builtintype" id="2264301">byte</span><span class="op" id="2264305">,</span>&nbsp;<span class="ident" id="2264307">flags</span>&nbsp;<span class="builtintype" id="2264313">int</span><span class="op" id="2264316">)</span>&nbsp;<span class="op" id="2264318">(</span><span class="ident" id="2264319">n</span>&nbsp;<span class="builtintype" id="2264321">int</span><span class="op" id="2264324">,</span>&nbsp;<span class="ident" id="2264326">from</span>&nbsp;<span class="ident" id="2264331">Sockaddr</span><span class="op" id="2264339">,</span>&nbsp;<span class="ident" id="2264341">err</span>&nbsp;<span class="builtintype" id="2264345">error</span><span class="op" id="2264350">)</span>&nbsp;<span class="op" id="2264352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264355">var</span>&nbsp;<span class="ident" id="2264359">rsa</span>&nbsp;<span class="ident" id="2264363">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264379">var</span>&nbsp;<span class="builtinfunc" id="2264383">len</span>&nbsp;<span class="ident" id="2264387">_Socklen</span>&nbsp;<span class="op" id="2264396">=</span>&nbsp;<span class="ident" id="2264398">SizeofSockaddrAny</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264417">if</span>&nbsp;<span class="ident" id="2264420">n</span><span class="op" id="2264421">,</span>&nbsp;<span class="ident" id="2264423">err</span>&nbsp;<span class="op" id="2264427">=</span>&nbsp;<span class="ident" id="2264429">recvfrom</span><span class="op" id="2264437">(</span><span class="ident" id="2264438">fd</span><span class="op" id="2264440">,</span>&nbsp;<span class="ident" id="2264442">p</span><span class="op" id="2264443">,</span>&nbsp;<span class="ident" id="2264445">flags</span><span class="op" id="2264450">,</span>&nbsp;<span class="op" id="2264452">&amp;</span><span class="ident" id="2264453">rsa</span><span class="op" id="2264456">,</span>&nbsp;<span class="op" id="2264458">&amp;</span><span class="builtinfunc" id="2264459">len</span><span class="op" id="2264462">)</span><span class="op" id="2264463">;</span>&nbsp;<span class="ident" id="2264465">err</span>&nbsp;<span class="op" id="2264469">!=</span>&nbsp;<span class="ident" id="2264472">nil</span>&nbsp;<span class="op" id="2264476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264480">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2264488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264491">if</span>&nbsp;<span class="ident" id="2264494">rsa</span><span class="op" id="2264497">.</span><span class="ident" id="2264498">Addr</span><span class="op" id="2264502">.</span><span class="ident" id="2264503">Family</span>&nbsp;<span class="op" id="2264510">!=</span>&nbsp;<span class="ident" id="2264513">AF_UNSPEC</span>&nbsp;<span class="op" id="2264523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264527">from</span><span class="op" id="2264531">,</span>&nbsp;<span class="ident" id="2264533">err</span>&nbsp;<span class="op" id="2264537">=</span>&nbsp;<span class="ident" id="2264539">anyToSockaddr</span><span class="op" id="2264552">(</span><span class="op" id="2264553">&amp;</span><span class="ident" id="2264554">rsa</span><span class="op" id="2264557">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2264560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264563">return</span><br>
<span class="lineno"></span><span class="op" id="2264570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2264573">func</span>&nbsp;<span class="ident" id="2264578">Sendto</span><span class="op" id="2264584">(</span><span class="ident" id="2264585">fd</span>&nbsp;<span class="builtintype" id="2264588">int</span><span class="op" id="2264591">,</span>&nbsp;<span class="ident" id="2264593">p</span>&nbsp;<span class="op" id="2264595">[</span><span class="op" id="2264596">]</span><span class="builtintype" id="2264597">byte</span><span class="op" id="2264601">,</span>&nbsp;<span class="ident" id="2264603">flags</span>&nbsp;<span class="builtintype" id="2264609">int</span><span class="op" id="2264612">,</span>&nbsp;<span class="ident" id="2264614">to</span>&nbsp;<span class="ident" id="2264617">Sockaddr</span><span class="op" id="2264625">)</span>&nbsp;<span class="op" id="2264627">(</span><span class="ident" id="2264628">err</span>&nbsp;<span class="builtintype" id="2264632">error</span><span class="op" id="2264637">)</span>&nbsp;<span class="op" id="2264639">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264642">ptr</span><span class="op" id="2264645">,</span>&nbsp;<span class="ident" id="2264647">n</span><span class="op" id="2264648">,</span>&nbsp;<span class="ident" id="2264650">err</span>&nbsp;<span class="op" id="2264654">:=</span>&nbsp;<span class="ident" id="2264657">to</span><span class="op" id="2264659">.</span><span class="ident" id="2264660">sockaddr</span><span class="op" id="2264668">(</span><span class="op" id="2264669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264672">if</span>&nbsp;<span class="ident" id="2264675">err</span>&nbsp;<span class="op" id="2264679">!=</span>&nbsp;<span class="ident" id="2264682">nil</span>&nbsp;<span class="op" id="2264686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264690">return</span>&nbsp;<span class="ident" id="2264697">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2264702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264705">return</span>&nbsp;<span class="ident" id="2264712">sendto</span><span class="op" id="2264718">(</span><span class="ident" id="2264719">fd</span><span class="op" id="2264721">,</span>&nbsp;<span class="ident" id="2264723">p</span><span class="op" id="2264724">,</span>&nbsp;<span class="ident" id="2264726">flags</span><span class="op" id="2264731">,</span>&nbsp;<span class="ident" id="2264733">ptr</span><span class="op" id="2264736">,</span>&nbsp;<span class="ident" id="2264738">n</span><span class="op" id="2264739">)</span><br>
<span class="lineno">235</span><span class="op" id="2264741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2264744">func</span>&nbsp;<span class="ident" id="2264749">SetsockoptByte</span><span class="op" id="2264763">(</span><span class="ident" id="2264764">fd</span><span class="op" id="2264766">,</span>&nbsp;<span class="ident" id="2264768">level</span><span class="op" id="2264773">,</span>&nbsp;<span class="ident" id="2264775">opt</span>&nbsp;<span class="builtintype" id="2264779">int</span><span class="op" id="2264782">,</span>&nbsp;<span class="ident" id="2264784">value</span>&nbsp;<span class="builtintype" id="2264790">byte</span><span class="op" id="2264794">)</span>&nbsp;<span class="op" id="2264796">(</span><span class="ident" id="2264797">err</span>&nbsp;<span class="builtintype" id="2264801">error</span><span class="op" id="2264806">)</span>&nbsp;<span class="op" id="2264808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264811">return</span>&nbsp;<span class="ident" id="2264818">setsockopt</span><span class="op" id="2264828">(</span><span class="ident" id="2264829">fd</span><span class="op" id="2264831">,</span>&nbsp;<span class="ident" id="2264833">level</span><span class="op" id="2264838">,</span>&nbsp;<span class="ident" id="2264840">opt</span><span class="op" id="2264843">,</span>&nbsp;<span class="ident" id="2264845">unsafe</span><span class="op" id="2264851">.</span><span class="ident" id="2264852">Pointer</span><span class="op" id="2264859">(</span><span class="op" id="2264860">&amp;</span><span class="ident" id="2264861">value</span><span class="op" id="2264866">)</span><span class="op" id="2264867">,</span>&nbsp;<span class="num" id="2264869">1</span><span class="op" id="2264870">)</span><br>
<span class="lineno"></span><span class="op" id="2264872">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="2264875">func</span>&nbsp;<span class="ident" id="2264880">SetsockoptInt</span><span class="op" id="2264893">(</span><span class="ident" id="2264894">fd</span><span class="op" id="2264896">,</span>&nbsp;<span class="ident" id="2264898">level</span><span class="op" id="2264903">,</span>&nbsp;<span class="ident" id="2264905">opt</span>&nbsp;<span class="builtintype" id="2264909">int</span><span class="op" id="2264912">,</span>&nbsp;<span class="ident" id="2264914">value</span>&nbsp;<span class="builtintype" id="2264920">int</span><span class="op" id="2264923">)</span>&nbsp;<span class="op" id="2264925">(</span><span class="ident" id="2264926">err</span>&nbsp;<span class="builtintype" id="2264930">error</span><span class="op" id="2264935">)</span>&nbsp;<span class="op" id="2264937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264940">var</span>&nbsp;<span class="ident" id="2264944">n</span>&nbsp;<span class="op" id="2264946">=</span>&nbsp;<span class="builtintype" id="2264948">int32</span><span class="op" id="2264953">(</span><span class="ident" id="2264954">value</span><span class="op" id="2264959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264962">return</span>&nbsp;<span class="ident" id="2264969">setsockopt</span><span class="op" id="2264979">(</span><span class="ident" id="2264980">fd</span><span class="op" id="2264982">,</span>&nbsp;<span class="ident" id="2264984">level</span><span class="op" id="2264989">,</span>&nbsp;<span class="ident" id="2264991">opt</span><span class="op" id="2264994">,</span>&nbsp;<span class="ident" id="2264996">unsafe</span><span class="op" id="2265002">.</span><span class="ident" id="2265003">Pointer</span><span class="op" id="2265010">(</span><span class="op" id="2265011">&amp;</span><span class="ident" id="2265012">n</span><span class="op" id="2265013">)</span><span class="op" id="2265014">,</span>&nbsp;<span class="num" id="2265016">4</span><span class="op" id="2265017">)</span><br>
<span class="lineno"></span><span class="op" id="2265019">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="2265022">func</span>&nbsp;<span class="ident" id="2265027">SetsockoptInet4Addr</span><span class="op" id="2265046">(</span><span class="ident" id="2265047">fd</span><span class="op" id="2265049">,</span>&nbsp;<span class="ident" id="2265051">level</span><span class="op" id="2265056">,</span>&nbsp;<span class="ident" id="2265058">opt</span>&nbsp;<span class="builtintype" id="2265062">int</span><span class="op" id="2265065">,</span>&nbsp;<span class="ident" id="2265067">value</span>&nbsp;<span class="op" id="2265073">[</span><span class="num" id="2265074">4</span><span class="op" id="2265075">]</span><span class="builtintype" id="2265076">byte</span><span class="op" id="2265080">)</span>&nbsp;<span class="op" id="2265082">(</span><span class="ident" id="2265083">err</span>&nbsp;<span class="builtintype" id="2265087">error</span><span class="op" id="2265092">)</span>&nbsp;<span class="op" id="2265094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265097">return</span>&nbsp;<span class="ident" id="2265104">setsockopt</span><span class="op" id="2265114">(</span><span class="ident" id="2265115">fd</span><span class="op" id="2265117">,</span>&nbsp;<span class="ident" id="2265119">level</span><span class="op" id="2265124">,</span>&nbsp;<span class="ident" id="2265126">opt</span><span class="op" id="2265129">,</span>&nbsp;<span class="ident" id="2265131">unsafe</span><span class="op" id="2265137">.</span><span class="ident" id="2265138">Pointer</span><span class="op" id="2265145">(</span><span class="op" id="2265146">&amp;</span><span class="ident" id="2265147">value</span><span class="op" id="2265152">[</span><span class="num" id="2265153">0</span><span class="op" id="2265154">]</span><span class="op" id="2265155">)</span><span class="op" id="2265156">,</span>&nbsp;<span class="num" id="2265158">4</span><span class="op" id="2265159">)</span><br>
<span class="lineno"></span><span class="op" id="2265161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="2265164">func</span>&nbsp;<span class="ident" id="2265169">SetsockoptIPMreq</span><span class="op" id="2265185">(</span><span class="ident" id="2265186">fd</span><span class="op" id="2265188">,</span>&nbsp;<span class="ident" id="2265190">level</span><span class="op" id="2265195">,</span>&nbsp;<span class="ident" id="2265197">opt</span>&nbsp;<span class="builtintype" id="2265201">int</span><span class="op" id="2265204">,</span>&nbsp;<span class="ident" id="2265206">mreq</span>&nbsp;<span class="op" id="2265211">*</span><span class="ident" id="2265212">IPMreq</span><span class="op" id="2265218">)</span>&nbsp;<span class="op" id="2265220">(</span><span class="ident" id="2265221">err</span>&nbsp;<span class="builtintype" id="2265225">error</span><span class="op" id="2265230">)</span>&nbsp;<span class="op" id="2265232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265235">return</span>&nbsp;<span class="ident" id="2265242">setsockopt</span><span class="op" id="2265252">(</span><span class="ident" id="2265253">fd</span><span class="op" id="2265255">,</span>&nbsp;<span class="ident" id="2265257">level</span><span class="op" id="2265262">,</span>&nbsp;<span class="ident" id="2265264">opt</span><span class="op" id="2265267">,</span>&nbsp;<span class="ident" id="2265269">unsafe</span><span class="op" id="2265275">.</span><span class="ident" id="2265276">Pointer</span><span class="op" id="2265283">(</span><span class="ident" id="2265284">mreq</span><span class="op" id="2265288">)</span><span class="op" id="2265289">,</span>&nbsp;<span class="ident" id="2265291">SizeofIPMreq</span><span class="op" id="2265303">)</span><br>
<span class="lineno"></span><span class="op" id="2265305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2265308">func</span>&nbsp;<span class="ident" id="2265313">SetsockoptIPv6Mreq</span><span class="op" id="2265331">(</span><span class="ident" id="2265332">fd</span><span class="op" id="2265334">,</span>&nbsp;<span class="ident" id="2265336">level</span><span class="op" id="2265341">,</span>&nbsp;<span class="ident" id="2265343">opt</span>&nbsp;<span class="builtintype" id="2265347">int</span><span class="op" id="2265350">,</span>&nbsp;<span class="ident" id="2265352">mreq</span>&nbsp;<span class="op" id="2265357">*</span><span class="ident" id="2265358">IPv6Mreq</span><span class="op" id="2265366">)</span>&nbsp;<span class="op" id="2265368">(</span><span class="ident" id="2265369">err</span>&nbsp;<span class="builtintype" id="2265373">error</span><span class="op" id="2265378">)</span>&nbsp;<span class="op" id="2265380">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265383">return</span>&nbsp;<span class="ident" id="2265390">setsockopt</span><span class="op" id="2265400">(</span><span class="ident" id="2265401">fd</span><span class="op" id="2265403">,</span>&nbsp;<span class="ident" id="2265405">level</span><span class="op" id="2265410">,</span>&nbsp;<span class="ident" id="2265412">opt</span><span class="op" id="2265415">,</span>&nbsp;<span class="ident" id="2265417">unsafe</span><span class="op" id="2265423">.</span><span class="ident" id="2265424">Pointer</span><span class="op" id="2265431">(</span><span class="ident" id="2265432">mreq</span><span class="op" id="2265436">)</span><span class="op" id="2265437">,</span>&nbsp;<span class="ident" id="2265439">SizeofIPv6Mreq</span><span class="op" id="2265453">)</span><br>
<span class="lineno"></span><span class="op" id="2265455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2265458">func</span>&nbsp;<span class="ident" id="2265463">SetsockoptICMPv6Filter</span><span class="op" id="2265485">(</span><span class="ident" id="2265486">fd</span><span class="op" id="2265488">,</span>&nbsp;<span class="ident" id="2265490">level</span><span class="op" id="2265495">,</span>&nbsp;<span class="ident" id="2265497">opt</span>&nbsp;<span class="builtintype" id="2265501">int</span><span class="op" id="2265504">,</span>&nbsp;<span class="ident" id="2265506">filter</span>&nbsp;<span class="op" id="2265513">*</span><span class="ident" id="2265514">ICMPv6Filter</span><span class="op" id="2265526">)</span>&nbsp;<span class="builtintype" id="2265528">error</span>&nbsp;<span class="op" id="2265534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265537">return</span>&nbsp;<span class="ident" id="2265544">setsockopt</span><span class="op" id="2265554">(</span><span class="ident" id="2265555">fd</span><span class="op" id="2265557">,</span>&nbsp;<span class="ident" id="2265559">level</span><span class="op" id="2265564">,</span>&nbsp;<span class="ident" id="2265566">opt</span><span class="op" id="2265569">,</span>&nbsp;<span class="ident" id="2265571">unsafe</span><span class="op" id="2265577">.</span><span class="ident" id="2265578">Pointer</span><span class="op" id="2265585">(</span><span class="ident" id="2265586">filter</span><span class="op" id="2265592">)</span><span class="op" id="2265593">,</span>&nbsp;<span class="ident" id="2265595">SizeofICMPv6Filter</span><span class="op" id="2265613">)</span><br>
<span class="lineno">260</span><span class="op" id="2265615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2265618">func</span>&nbsp;<span class="ident" id="2265623">SetsockoptLinger</span><span class="op" id="2265639">(</span><span class="ident" id="2265640">fd</span><span class="op" id="2265642">,</span>&nbsp;<span class="ident" id="2265644">level</span><span class="op" id="2265649">,</span>&nbsp;<span class="ident" id="2265651">opt</span>&nbsp;<span class="builtintype" id="2265655">int</span><span class="op" id="2265658">,</span>&nbsp;<span class="ident" id="2265660">l</span>&nbsp;<span class="op" id="2265662">*</span><span class="ident" id="2265663">Linger</span><span class="op" id="2265669">)</span>&nbsp;<span class="op" id="2265671">(</span><span class="ident" id="2265672">err</span>&nbsp;<span class="builtintype" id="2265676">error</span><span class="op" id="2265681">)</span>&nbsp;<span class="op" id="2265683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265686">return</span>&nbsp;<span class="ident" id="2265693">setsockopt</span><span class="op" id="2265703">(</span><span class="ident" id="2265704">fd</span><span class="op" id="2265706">,</span>&nbsp;<span class="ident" id="2265708">level</span><span class="op" id="2265713">,</span>&nbsp;<span class="ident" id="2265715">opt</span><span class="op" id="2265718">,</span>&nbsp;<span class="ident" id="2265720">unsafe</span><span class="op" id="2265726">.</span><span class="ident" id="2265727">Pointer</span><span class="op" id="2265734">(</span><span class="ident" id="2265735">l</span><span class="op" id="2265736">)</span><span class="op" id="2265737">,</span>&nbsp;<span class="ident" id="2265739">SizeofLinger</span><span class="op" id="2265751">)</span><br>
<span class="lineno"></span><span class="op" id="2265753">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="2265756">func</span>&nbsp;<span class="ident" id="2265761">SetsockoptString</span><span class="op" id="2265777">(</span><span class="ident" id="2265778">fd</span><span class="op" id="2265780">,</span>&nbsp;<span class="ident" id="2265782">level</span><span class="op" id="2265787">,</span>&nbsp;<span class="ident" id="2265789">opt</span>&nbsp;<span class="builtintype" id="2265793">int</span><span class="op" id="2265796">,</span>&nbsp;<span class="ident" id="2265798">s</span>&nbsp;<span class="builtintype" id="2265800">string</span><span class="op" id="2265806">)</span>&nbsp;<span class="op" id="2265808">(</span><span class="ident" id="2265809">err</span>&nbsp;<span class="builtintype" id="2265813">error</span><span class="op" id="2265818">)</span>&nbsp;<span class="op" id="2265820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265823">return</span>&nbsp;<span class="ident" id="2265830">setsockopt</span><span class="op" id="2265840">(</span><span class="ident" id="2265841">fd</span><span class="op" id="2265843">,</span>&nbsp;<span class="ident" id="2265845">level</span><span class="op" id="2265850">,</span>&nbsp;<span class="ident" id="2265852">opt</span><span class="op" id="2265855">,</span>&nbsp;<span class="ident" id="2265857">unsafe</span><span class="op" id="2265863">.</span><span class="ident" id="2265864">Pointer</span><span class="op" id="2265871">(</span><span class="op" id="2265872">&amp;</span><span class="op" id="2265873">[</span><span class="op" id="2265874">]</span><span class="builtintype" id="2265875">byte</span><span class="op" id="2265879">(</span><span class="ident" id="2265880">s</span><span class="op" id="2265881">)</span><span class="op" id="2265882">[</span><span class="num" id="2265883">0</span><span class="op" id="2265884">]</span><span class="op" id="2265885">)</span><span class="op" id="2265886">,</span>&nbsp;<span class="builtintype" id="2265888">uintptr</span><span class="op" id="2265895">(</span><span class="builtinfunc" id="2265896">len</span><span class="op" id="2265899">(</span><span class="ident" id="2265900">s</span><span class="op" id="2265901">)</span><span class="op" id="2265902">)</span><span class="op" id="2265903">)</span><br>
<span class="lineno"></span><span class="op" id="2265905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="2265908">func</span>&nbsp;<span class="ident" id="2265913">SetsockoptTimeval</span><span class="op" id="2265930">(</span><span class="ident" id="2265931">fd</span><span class="op" id="2265933">,</span>&nbsp;<span class="ident" id="2265935">level</span><span class="op" id="2265940">,</span>&nbsp;<span class="ident" id="2265942">opt</span>&nbsp;<span class="builtintype" id="2265946">int</span><span class="op" id="2265949">,</span>&nbsp;<span class="ident" id="2265951">tv</span>&nbsp;<span class="op" id="2265954">*</span><span class="ident" id="2265955">Timeval</span><span class="op" id="2265962">)</span>&nbsp;<span class="op" id="2265964">(</span><span class="ident" id="2265965">err</span>&nbsp;<span class="builtintype" id="2265969">error</span><span class="op" id="2265974">)</span>&nbsp;<span class="op" id="2265976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265979">return</span>&nbsp;<span class="ident" id="2265986">setsockopt</span><span class="op" id="2265996">(</span><span class="ident" id="2265997">fd</span><span class="op" id="2265999">,</span>&nbsp;<span class="ident" id="2266001">level</span><span class="op" id="2266006">,</span>&nbsp;<span class="ident" id="2266008">opt</span><span class="op" id="2266011">,</span>&nbsp;<span class="ident" id="2266013">unsafe</span><span class="op" id="2266019">.</span><span class="ident" id="2266020">Pointer</span><span class="op" id="2266027">(</span><span class="ident" id="2266028">tv</span><span class="op" id="2266030">)</span><span class="op" id="2266031">,</span>&nbsp;<span class="ident" id="2266033">unsafe</span><span class="op" id="2266039">.</span><span class="ident" id="2266040">Sizeof</span><span class="op" id="2266046">(</span><span class="op" id="2266047">*</span><span class="ident" id="2266048">tv</span><span class="op" id="2266050">)</span><span class="op" id="2266051">)</span><br>
<span class="lineno"></span><span class="op" id="2266053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2266056">func</span>&nbsp;<span class="ident" id="2266061">Socket</span><span class="op" id="2266067">(</span><span class="ident" id="2266068">domain</span><span class="op" id="2266074">,</span>&nbsp;<span class="ident" id="2266076">typ</span><span class="op" id="2266079">,</span>&nbsp;<span class="ident" id="2266081">proto</span>&nbsp;<span class="builtintype" id="2266087">int</span><span class="op" id="2266090">)</span>&nbsp;<span class="op" id="2266092">(</span><span class="ident" id="2266093">fd</span>&nbsp;<span class="builtintype" id="2266096">int</span><span class="op" id="2266099">,</span>&nbsp;<span class="ident" id="2266101">err</span>&nbsp;<span class="builtintype" id="2266105">error</span><span class="op" id="2266110">)</span>&nbsp;<span class="op" id="2266112">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266115">if</span>&nbsp;<span class="ident" id="2266118">domain</span>&nbsp;<span class="op" id="2266125">==</span>&nbsp;<span class="ident" id="2266128">AF_INET6</span>&nbsp;<span class="op" id="2266137">&amp;&amp;</span>&nbsp;<span class="ident" id="2266140">SocketDisableIPv6</span>&nbsp;<span class="op" id="2266158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266162">return</span>&nbsp;<span class="op" id="2266169">-</span><span class="num" id="2266170">1</span><span class="op" id="2266171">,</span>&nbsp;<span class="ident" id="2266173">EAFNOSUPPORT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2266187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266190">fd</span><span class="op" id="2266192">,</span>&nbsp;<span class="ident" id="2266194">err</span>&nbsp;<span class="op" id="2266198">=</span>&nbsp;<span class="ident" id="2266200">socket</span><span class="op" id="2266206">(</span><span class="ident" id="2266207">domain</span><span class="op" id="2266213">,</span>&nbsp;<span class="ident" id="2266215">typ</span><span class="op" id="2266218">,</span>&nbsp;<span class="ident" id="2266220">proto</span><span class="op" id="2266225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266228">return</span><br>
<span class="lineno">280</span><span class="op" id="2266235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2266238">func</span>&nbsp;<span class="ident" id="2266243">Socketpair</span><span class="op" id="2266253">(</span><span class="ident" id="2266254">domain</span><span class="op" id="2266260">,</span>&nbsp;<span class="ident" id="2266262">typ</span><span class="op" id="2266265">,</span>&nbsp;<span class="ident" id="2266267">proto</span>&nbsp;<span class="builtintype" id="2266273">int</span><span class="op" id="2266276">)</span>&nbsp;<span class="op" id="2266278">(</span><span class="ident" id="2266279">fd</span>&nbsp;<span class="op" id="2266282">[</span><span class="num" id="2266283">2</span><span class="op" id="2266284">]</span><span class="builtintype" id="2266285">int</span><span class="op" id="2266288">,</span>&nbsp;<span class="ident" id="2266290">err</span>&nbsp;<span class="builtintype" id="2266294">error</span><span class="op" id="2266299">)</span>&nbsp;<span class="op" id="2266301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266304">var</span>&nbsp;<span class="ident" id="2266308">fdx</span>&nbsp;<span class="op" id="2266312">[</span><span class="num" id="2266313">2</span><span class="op" id="2266314">]</span><span class="builtintype" id="2266315">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266322">err</span>&nbsp;<span class="op" id="2266326">=</span>&nbsp;<span class="ident" id="2266328">socketpair</span><span class="op" id="2266338">(</span><span class="ident" id="2266339">domain</span><span class="op" id="2266345">,</span>&nbsp;<span class="ident" id="2266347">typ</span><span class="op" id="2266350">,</span>&nbsp;<span class="ident" id="2266352">proto</span><span class="op" id="2266357">,</span>&nbsp;<span class="op" id="2266359">&amp;</span><span class="ident" id="2266360">fdx</span><span class="op" id="2266363">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266366">if</span>&nbsp;<span class="ident" id="2266369">err</span>&nbsp;<span class="op" id="2266373">==</span>&nbsp;<span class="ident" id="2266376">nil</span>&nbsp;<span class="op" id="2266380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266384">fd</span><span class="op" id="2266386">[</span><span class="num" id="2266387">0</span><span class="op" id="2266388">]</span>&nbsp;<span class="op" id="2266390">=</span>&nbsp;<span class="builtintype" id="2266392">int</span><span class="op" id="2266395">(</span><span class="ident" id="2266396">fdx</span><span class="op" id="2266399">[</span><span class="num" id="2266400">0</span><span class="op" id="2266401">]</span><span class="op" id="2266402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266406">fd</span><span class="op" id="2266408">[</span><span class="num" id="2266409">1</span><span class="op" id="2266410">]</span>&nbsp;<span class="op" id="2266412">=</span>&nbsp;<span class="builtintype" id="2266414">int</span><span class="op" id="2266417">(</span><span class="ident" id="2266418">fdx</span><span class="op" id="2266421">[</span><span class="num" id="2266422">1</span><span class="op" id="2266423">]</span><span class="op" id="2266424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2266427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266430">return</span><br>
<span class="lineno">290</span><span class="op" id="2266437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2266440">func</span>&nbsp;<span class="ident" id="2266445">Sendfile</span><span class="op" id="2266453">(</span><span class="ident" id="2266454">outfd</span>&nbsp;<span class="builtintype" id="2266460">int</span><span class="op" id="2266463">,</span>&nbsp;<span class="ident" id="2266465">infd</span>&nbsp;<span class="builtintype" id="2266470">int</span><span class="op" id="2266473">,</span>&nbsp;<span class="ident" id="2266475">offset</span>&nbsp;<span class="op" id="2266482">*</span><span class="ident" id="2266483">int64</span><span class="op" id="2266488">,</span>&nbsp;<span class="ident" id="2266490">count</span>&nbsp;<span class="builtintype" id="2266496">int</span><span class="op" id="2266499">)</span>&nbsp;<span class="op" id="2266501">(</span><span class="ident" id="2266502">written</span>&nbsp;<span class="builtintype" id="2266510">int</span><span class="op" id="2266513">,</span>&nbsp;<span class="ident" id="2266515">err</span>&nbsp;<span class="builtintype" id="2266519">error</span><span class="op" id="2266524">)</span>&nbsp;<span class="op" id="2266526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266529">if</span>&nbsp;<span class="ident" id="2266532">raceenabled</span>&nbsp;<span class="op" id="2266544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266548">raceReleaseMerge</span><span class="op" id="2266564">(</span><span class="ident" id="2266565">unsafe</span><span class="op" id="2266571">.</span><span class="ident" id="2266572">Pointer</span><span class="op" id="2266579">(</span><span class="op" id="2266580">&amp;</span><span class="ident" id="2266581">ioSync</span><span class="op" id="2266587">)</span><span class="op" id="2266588">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2266591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266594">return</span>&nbsp;<span class="ident" id="2266601">sendfile</span><span class="op" id="2266609">(</span><span class="ident" id="2266610">outfd</span><span class="op" id="2266615">,</span>&nbsp;<span class="ident" id="2266617">infd</span><span class="op" id="2266621">,</span>&nbsp;<span class="ident" id="2266623">offset</span><span class="op" id="2266629">,</span>&nbsp;<span class="ident" id="2266631">count</span><span class="op" id="2266636">)</span><br>
<span class="lineno"></span><span class="op" id="2266638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2266641">var</span>&nbsp;<span class="ident" id="2266645">ioSync</span>&nbsp;<span class="ident" id="2266652">int64</span>
</div>
</body>
</html>
