<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3472134">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3472190">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3472244">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3472295">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3472373">package</span>&nbsp;<span class="ident" id="3472381">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3472386">import</span>&nbsp;<span class="op" id="3472393">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3472396">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3472406">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3472412">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3472423">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3472430">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3472433">func</span>&nbsp;<span class="ident" id="3472438">unixSocket</span><span class="op" id="3472448">(</span><span class="ident" id="3472449">net</span>&nbsp;<span class="builtintype" id="3472453">string</span><span class="op" id="3472459">,</span>&nbsp;<span class="ident" id="3472461">laddr</span><span class="op" id="3472466">,</span>&nbsp;<span class="ident" id="3472468">raddr</span>&nbsp;<span class="ident" id="3472474">sockaddr</span><span class="op" id="3472482">,</span>&nbsp;<span class="ident" id="3472484">mode</span>&nbsp;<span class="builtintype" id="3472489">string</span><span class="op" id="3472495">,</span>&nbsp;<span class="ident" id="3472497">deadline</span>&nbsp;<span class="ident" id="3472506">time</span><span class="op" id="3472510">.</span><span class="ident" id="3472511">Time</span><span class="op" id="3472515">)</span>&nbsp;<span class="op" id="3472517">(</span><span class="op" id="3472518">*</span><span class="ident" id="3472519">netFD</span><span class="op" id="3472524">,</span>&nbsp;<span class="builtintype" id="3472526">error</span><span class="op" id="3472531">)</span>&nbsp;<span class="op" id="3472533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472536">var</span>&nbsp;<span class="ident" id="3472540">sotype</span>&nbsp;<span class="builtintype" id="3472547">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472552">switch</span>&nbsp;<span class="ident" id="3472559">net</span>&nbsp;<span class="op" id="3472563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472566">case</span>&nbsp;<span class="string" id="3472571">&#34;unix&#34;</span><span class="op" id="3472577">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472581">sotype</span>&nbsp;<span class="op" id="3472588">=</span>&nbsp;<span class="ident" id="3472590">syscall</span><span class="op" id="3472597">.</span><span class="ident" id="3472598">SOCK_STREAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472611">case</span>&nbsp;<span class="string" id="3472616">&#34;unixgram&#34;</span><span class="op" id="3472626">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472630">sotype</span>&nbsp;<span class="op" id="3472637">=</span>&nbsp;<span class="ident" id="3472639">syscall</span><span class="op" id="3472646">.</span><span class="ident" id="3472647">SOCK_DGRAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472659">case</span>&nbsp;<span class="string" id="3472664">&#34;unixpacket&#34;</span><span class="op" id="3472676">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472680">sotype</span>&nbsp;<span class="op" id="3472687">=</span>&nbsp;<span class="ident" id="3472689">syscall</span><span class="op" id="3472696">.</span><span class="ident" id="3472697">SOCK_SEQPACKET</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472713">default</span><span class="op" id="3472720">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472724">return</span>&nbsp;<span class="ident" id="3472731">nil</span><span class="op" id="3472734">,</span>&nbsp;<span class="ident" id="3472736">UnknownNetworkError</span><span class="op" id="3472755">(</span><span class="ident" id="3472756">net</span><span class="op" id="3472759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3472762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472766">switch</span>&nbsp;<span class="ident" id="3472773">mode</span>&nbsp;<span class="op" id="3472778">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472781">case</span>&nbsp;<span class="string" id="3472786">&#34;dial&#34;</span><span class="op" id="3472792">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472796">if</span>&nbsp;<span class="ident" id="3472799">laddr</span>&nbsp;<span class="op" id="3472805">!=</span>&nbsp;<span class="ident" id="3472808">nil</span>&nbsp;<span class="op" id="3472812">&amp;&amp;</span>&nbsp;<span class="ident" id="3472815">laddr</span><span class="op" id="3472820">.</span><span class="ident" id="3472821">isWildcard</span><span class="op" id="3472831">(</span><span class="op" id="3472832">)</span>&nbsp;<span class="op" id="3472834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472839">laddr</span>&nbsp;<span class="op" id="3472845">=</span>&nbsp;<span class="ident" id="3472847">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3472853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472857">if</span>&nbsp;<span class="ident" id="3472860">raddr</span>&nbsp;<span class="op" id="3472866">!=</span>&nbsp;<span class="ident" id="3472869">nil</span>&nbsp;<span class="op" id="3472873">&amp;&amp;</span>&nbsp;<span class="ident" id="3472876">raddr</span><span class="op" id="3472881">.</span><span class="ident" id="3472882">isWildcard</span><span class="op" id="3472892">(</span><span class="op" id="3472893">)</span>&nbsp;<span class="op" id="3472895">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472900">raddr</span>&nbsp;<span class="op" id="3472906">=</span>&nbsp;<span class="ident" id="3472908">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3472914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472918">if</span>&nbsp;<span class="ident" id="3472921">raddr</span>&nbsp;<span class="op" id="3472927">==</span>&nbsp;<span class="ident" id="3472930">nil</span>&nbsp;<span class="op" id="3472934">&amp;&amp;</span>&nbsp;<span class="op" id="3472937">(</span><span class="ident" id="3472938">sotype</span>&nbsp;<span class="op" id="3472945">!=</span>&nbsp;<span class="ident" id="3472948">syscall</span><span class="op" id="3472955">.</span><span class="ident" id="3472956">SOCK_DGRAM</span>&nbsp;<span class="op" id="3472967">||</span>&nbsp;<span class="ident" id="3472970">laddr</span>&nbsp;<span class="op" id="3472976">==</span>&nbsp;<span class="ident" id="3472979">nil</span><span class="op" id="3472982">)</span>&nbsp;<span class="op" id="3472984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472989">return</span>&nbsp;<span class="ident" id="3472996">nil</span><span class="op" id="3472999">,</span>&nbsp;<span class="ident" id="3473001">errMissingAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3473021">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473024">case</span>&nbsp;<span class="string" id="3473029">&#34;listen&#34;</span><span class="op" id="3473037">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473040">default</span><span class="op" id="3473047">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473051">return</span>&nbsp;<span class="ident" id="3473058">nil</span><span class="op" id="3473061">,</span>&nbsp;<span class="ident" id="3473063">errors</span><span class="op" id="3473069">.</span><span class="ident" id="3473070">New</span><span class="op" id="3473073">(</span><span class="string" id="3473074">&#34;unknown&nbsp;mode:&nbsp;&#34;</span>&nbsp;<span class="op" id="3473091">+</span>&nbsp;<span class="ident" id="3473093">mode</span><span class="op" id="3473097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3473100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3473104">fd</span><span class="op" id="3473106">,</span>&nbsp;<span class="ident" id="3473108">err</span>&nbsp;<span class="op" id="3473112">:=</span>&nbsp;<span class="ident" id="3473115">socket</span><span class="op" id="3473121">(</span><span class="ident" id="3473122">net</span><span class="op" id="3473125">,</span>&nbsp;<span class="ident" id="3473127">syscall</span><span class="op" id="3473134">.</span><span class="ident" id="3473135">AF_UNIX</span><span class="op" id="3473142">,</span>&nbsp;<span class="ident" id="3473144">sotype</span><span class="op" id="3473150">,</span>&nbsp;<span class="num" id="3473152">0</span><span class="op" id="3473153">,</span>&nbsp;<span class="ident" id="3473155">false</span><span class="op" id="3473160">,</span>&nbsp;<span class="ident" id="3473162">laddr</span><span class="op" id="3473167">,</span>&nbsp;<span class="ident" id="3473169">raddr</span><span class="op" id="3473174">,</span>&nbsp;<span class="ident" id="3473176">deadline</span><span class="op" id="3473184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473187">if</span>&nbsp;<span class="ident" id="3473190">err</span>&nbsp;<span class="op" id="3473194">!=</span>&nbsp;<span class="ident" id="3473197">nil</span>&nbsp;<span class="op" id="3473201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473205">return</span>&nbsp;<span class="ident" id="3473212">nil</span><span class="op" id="3473215">,</span>&nbsp;<span class="ident" id="3473217">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3473222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473225">return</span>&nbsp;<span class="ident" id="3473232">fd</span><span class="op" id="3473234">,</span>&nbsp;<span class="ident" id="3473236">nil</span><br>
<span class="lineno">50</span><span class="op" id="3473240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3473243">func</span>&nbsp;<span class="ident" id="3473248">sockaddrToUnix</span><span class="op" id="3473262">(</span><span class="ident" id="3473263">sa</span>&nbsp;<span class="ident" id="3473266">syscall</span><span class="op" id="3473273">.</span><span class="ident" id="3473274">Sockaddr</span><span class="op" id="3473282">)</span>&nbsp;<span class="ident" id="3473284">Addr</span>&nbsp;<span class="op" id="3473289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473292">if</span>&nbsp;<span class="ident" id="3473295">s</span><span class="op" id="3473296">,</span>&nbsp;<span class="ident" id="3473298">ok</span>&nbsp;<span class="op" id="3473301">:=</span>&nbsp;<span class="ident" id="3473304">sa</span><span class="op" id="3473306">.</span><span class="op" id="3473307">(</span><span class="op" id="3473308">*</span><span class="ident" id="3473309">syscall</span><span class="op" id="3473316">.</span><span class="ident" id="3473317">SockaddrUnix</span><span class="op" id="3473329">)</span><span class="op" id="3473330">;</span>&nbsp;<span class="ident" id="3473332">ok</span>&nbsp;<span class="op" id="3473335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473339">return</span>&nbsp;<span class="op" id="3473346">&amp;</span><span class="ident" id="3473347">UnixAddr</span><span class="op" id="3473355">{</span><span class="ident" id="3473356">Name</span><span class="op" id="3473360">:</span>&nbsp;<span class="ident" id="3473362">s</span><span class="op" id="3473363">.</span><span class="ident" id="3473364">Name</span><span class="op" id="3473368">,</span>&nbsp;<span class="ident" id="3473370">Net</span><span class="op" id="3473373">:</span>&nbsp;<span class="string" id="3473375">&#34;unix&#34;</span><span class="op" id="3473381">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3473384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473387">return</span>&nbsp;<span class="ident" id="3473394">nil</span><br>
<span class="lineno"></span><span class="op" id="3473398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3473401">func</span>&nbsp;<span class="ident" id="3473406">sockaddrToUnixgram</span><span class="op" id="3473424">(</span><span class="ident" id="3473425">sa</span>&nbsp;<span class="ident" id="3473428">syscall</span><span class="op" id="3473435">.</span><span class="ident" id="3473436">Sockaddr</span><span class="op" id="3473444">)</span>&nbsp;<span class="ident" id="3473446">Addr</span>&nbsp;<span class="op" id="3473451">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473454">if</span>&nbsp;<span class="ident" id="3473457">s</span><span class="op" id="3473458">,</span>&nbsp;<span class="ident" id="3473460">ok</span>&nbsp;<span class="op" id="3473463">:=</span>&nbsp;<span class="ident" id="3473466">sa</span><span class="op" id="3473468">.</span><span class="op" id="3473469">(</span><span class="op" id="3473470">*</span><span class="ident" id="3473471">syscall</span><span class="op" id="3473478">.</span><span class="ident" id="3473479">SockaddrUnix</span><span class="op" id="3473491">)</span><span class="op" id="3473492">;</span>&nbsp;<span class="ident" id="3473494">ok</span>&nbsp;<span class="op" id="3473497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473501">return</span>&nbsp;<span class="op" id="3473508">&amp;</span><span class="ident" id="3473509">UnixAddr</span><span class="op" id="3473517">{</span><span class="ident" id="3473518">Name</span><span class="op" id="3473522">:</span>&nbsp;<span class="ident" id="3473524">s</span><span class="op" id="3473525">.</span><span class="ident" id="3473526">Name</span><span class="op" id="3473530">,</span>&nbsp;<span class="ident" id="3473532">Net</span><span class="op" id="3473535">:</span>&nbsp;<span class="string" id="3473537">&#34;unixgram&#34;</span><span class="op" id="3473547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3473550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473553">return</span>&nbsp;<span class="ident" id="3473560">nil</span><br>
<span class="lineno"></span><span class="op" id="3473564">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3473567">func</span>&nbsp;<span class="ident" id="3473572">sockaddrToUnixpacket</span><span class="op" id="3473592">(</span><span class="ident" id="3473593">sa</span>&nbsp;<span class="ident" id="3473596">syscall</span><span class="op" id="3473603">.</span><span class="ident" id="3473604">Sockaddr</span><span class="op" id="3473612">)</span>&nbsp;<span class="ident" id="3473614">Addr</span>&nbsp;<span class="op" id="3473619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473622">if</span>&nbsp;<span class="ident" id="3473625">s</span><span class="op" id="3473626">,</span>&nbsp;<span class="ident" id="3473628">ok</span>&nbsp;<span class="op" id="3473631">:=</span>&nbsp;<span class="ident" id="3473634">sa</span><span class="op" id="3473636">.</span><span class="op" id="3473637">(</span><span class="op" id="3473638">*</span><span class="ident" id="3473639">syscall</span><span class="op" id="3473646">.</span><span class="ident" id="3473647">SockaddrUnix</span><span class="op" id="3473659">)</span><span class="op" id="3473660">;</span>&nbsp;<span class="ident" id="3473662">ok</span>&nbsp;<span class="op" id="3473665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473669">return</span>&nbsp;<span class="op" id="3473676">&amp;</span><span class="ident" id="3473677">UnixAddr</span><span class="op" id="3473685">{</span><span class="ident" id="3473686">Name</span><span class="op" id="3473690">:</span>&nbsp;<span class="ident" id="3473692">s</span><span class="op" id="3473693">.</span><span class="ident" id="3473694">Name</span><span class="op" id="3473698">,</span>&nbsp;<span class="ident" id="3473700">Net</span><span class="op" id="3473703">:</span>&nbsp;<span class="string" id="3473705">&#34;unixpacket&#34;</span><span class="op" id="3473717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3473720">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473723">return</span>&nbsp;<span class="ident" id="3473730">nil</span><br>
<span class="lineno"></span><span class="op" id="3473734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3473737">func</span>&nbsp;<span class="ident" id="3473742">sotypeToNet</span><span class="op" id="3473753">(</span><span class="ident" id="3473754">sotype</span>&nbsp;<span class="builtintype" id="3473761">int</span><span class="op" id="3473764">)</span>&nbsp;<span class="builtintype" id="3473766">string</span>&nbsp;<span class="op" id="3473773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473776">switch</span>&nbsp;<span class="ident" id="3473783">sotype</span>&nbsp;<span class="op" id="3473790">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473793">case</span>&nbsp;<span class="ident" id="3473798">syscall</span><span class="op" id="3473805">.</span><span class="ident" id="3473806">SOCK_STREAM</span><span class="op" id="3473817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473821">return</span>&nbsp;<span class="string" id="3473828">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473836">case</span>&nbsp;<span class="ident" id="3473841">syscall</span><span class="op" id="3473848">.</span><span class="ident" id="3473849">SOCK_DGRAM</span><span class="op" id="3473859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473863">return</span>&nbsp;<span class="string" id="3473870">&#34;unixgram&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473882">case</span>&nbsp;<span class="ident" id="3473887">syscall</span><span class="op" id="3473894">.</span><span class="ident" id="3473895">SOCK_SEQPACKET</span><span class="op" id="3473909">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473913">return</span>&nbsp;<span class="string" id="3473920">&#34;unixpacket&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473934">default</span><span class="op" id="3473941">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3473945">panic</span><span class="op" id="3473950">(</span><span class="string" id="3473951">&#34;sotypeToNet&nbsp;unknown&nbsp;socket&nbsp;type&#34;</span><span class="op" id="3473984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3473987">}</span><br>
<span class="lineno"></span><span class="op" id="3473989">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="3473992">func</span>&nbsp;<span class="op" id="3473997">(</span><span class="ident" id="3473998">a</span>&nbsp;<span class="op" id="3474000">*</span><span class="ident" id="3474001">UnixAddr</span><span class="op" id="3474009">)</span>&nbsp;<span class="ident" id="3474011">family</span><span class="op" id="3474017">(</span><span class="op" id="3474018">)</span>&nbsp;<span class="builtintype" id="3474020">int</span>&nbsp;<span class="op" id="3474024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3474027">return</span>&nbsp;<span class="ident" id="3474034">syscall</span><span class="op" id="3474041">.</span><span class="ident" id="3474042">AF_UNIX</span><br>
<span class="lineno"></span><span class="op" id="3474050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3474053">func</span>&nbsp;<span class="op" id="3474058">(</span><span class="ident" id="3474059">a</span>&nbsp;<span class="op" id="3474061">*</span><span class="ident" id="3474062">UnixAddr</span><span class="op" id="3474070">)</span>&nbsp;<span class="ident" id="3474072">isWildcard</span><span class="op" id="3474082">(</span><span class="op" id="3474083">)</span>&nbsp;<span class="builtintype" id="3474085">bool</span>&nbsp;<span class="op" id="3474090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3474093">return</span>&nbsp;<span class="ident" id="3474100">a</span>&nbsp;<span class="op" id="3474102">==</span>&nbsp;<span class="ident" id="3474105">nil</span>&nbsp;<span class="op" id="3474109">||</span>&nbsp;<span class="ident" id="3474112">a</span><span class="op" id="3474113">.</span><span class="ident" id="3474114">Name</span>&nbsp;<span class="op" id="3474119">==</span>&nbsp;<span class="string" id="3474122">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3474125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3474128">func</span>&nbsp;<span class="op" id="3474133">(</span><span class="ident" id="3474134">a</span>&nbsp;<span class="op" id="3474136">*</span><span class="ident" id="3474137">UnixAddr</span><span class="op" id="3474145">)</span>&nbsp;<span class="ident" id="3474147">sockaddr</span><span class="op" id="3474155">(</span><span class="ident" id="3474156">family</span>&nbsp;<span class="builtintype" id="3474163">int</span><span class="op" id="3474166">)</span>&nbsp;<span class="op" id="3474168">(</span><span class="ident" id="3474169">syscall</span><span class="op" id="3474176">.</span><span class="ident" id="3474177">Sockaddr</span><span class="op" id="3474185">,</span>&nbsp;<span class="builtintype" id="3474187">error</span><span class="op" id="3474192">)</span>&nbsp;<span class="op" id="3474194">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3474197">if</span>&nbsp;<span class="ident" id="3474200">a</span>&nbsp;<span class="op" id="3474202">==</span>&nbsp;<span class="ident" id="3474205">nil</span>&nbsp;<span class="op" id="3474209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3474213">return</span>&nbsp;<span class="ident" id="3474220">nil</span><span class="op" id="3474223">,</span>&nbsp;<span class="ident" id="3474225">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3474230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3474233">return</span>&nbsp;<span class="op" id="3474240">&amp;</span><span class="ident" id="3474241">syscall</span><span class="op" id="3474248">.</span><span class="ident" id="3474249">SockaddrUnix</span><span class="op" id="3474261">{</span><span class="ident" id="3474262">Name</span><span class="op" id="3474266">:</span>&nbsp;<span class="ident" id="3474268">a</span><span class="op" id="3474269">.</span><span class="ident" id="3474270">Name</span><span class="op" id="3474274">}</span><span class="op" id="3474275">,</span>&nbsp;<span class="ident" id="3474277">nil</span><br>
<span class="lineno"></span><span class="op" id="3474281">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="3474284">//&nbsp;UnixConn&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;interface&nbsp;for&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="3474355">//&nbsp;to&nbsp;Unix&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3474382">type</span>&nbsp;<span class="ident" id="3474387">UnixConn</span>&nbsp;<span class="keyword" id="3474396">struct</span>&nbsp;<span class="op" id="3474403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3474406">conn</span><br>
<span class="lineno">105</span><span class="op" id="3474411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3474414">func</span>&nbsp;<span class="ident" id="3474419">newUnixConn</span><span class="op" id="3474430">(</span><span class="ident" id="3474431">fd</span>&nbsp;<span class="op" id="3474434">*</span><span class="ident" id="3474435">netFD</span><span class="op" id="3474440">)</span>&nbsp;<span class="op" id="3474442">*</span><span class="ident" id="3474443">UnixConn</span>&nbsp;<span class="op" id="3474452">{</span>&nbsp;<span class="keyword" id="3474454">return</span>&nbsp;<span class="op" id="3474461">&amp;</span><span class="ident" id="3474462">UnixConn</span><span class="op" id="3474470">{</span><span class="ident" id="3474471">conn</span><span class="op" id="3474475">{</span><span class="ident" id="3474476">fd</span><span class="op" id="3474478">}</span><span class="op" id="3474479">}</span>&nbsp;<span class="op" id="3474481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3474484">//&nbsp;ReadFromUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.&nbsp;&nbsp;It</span><br>
<span class="lineno">110</span><span class="comment" id="3474555">//&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3474626">//&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3474641">//</span><br>
<span class="lineno"></span><span class="comment" id="3474644">//&nbsp;ReadFromUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3474709">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="3474776">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3474796">func</span>&nbsp;<span class="op" id="3474801">(</span><span class="ident" id="3474802">c</span>&nbsp;<span class="op" id="3474804">*</span><span class="ident" id="3474805">UnixConn</span><span class="op" id="3474813">)</span>&nbsp;<span class="ident" id="3474815">ReadFromUnix</span><span class="op" id="3474827">(</span><span class="ident" id="3474828">b</span>&nbsp;<span class="op" id="3474830">[</span><span class="op" id="3474831">]</span><span class="builtintype" id="3474832">byte</span><span class="op" id="3474836">)</span>&nbsp;<span class="op" id="3474838">(</span><span class="ident" id="3474839">n</span>&nbsp;<span class="builtintype" id="3474841">int</span><span class="op" id="3474844">,</span>&nbsp;<span class="ident" id="3474846">addr</span>&nbsp;<span class="op" id="3474851">*</span><span class="ident" id="3474852">UnixAddr</span><span class="op" id="3474860">,</span>&nbsp;<span class="ident" id="3474862">err</span>&nbsp;<span class="builtintype" id="3474866">error</span><span class="op" id="3474871">)</span>&nbsp;<span class="op" id="3474873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3474876">if</span>&nbsp;<span class="op" id="3474879">!</span><span class="ident" id="3474880">c</span><span class="op" id="3474881">.</span><span class="ident" id="3474882">ok</span><span class="op" id="3474884">(</span><span class="op" id="3474885">)</span>&nbsp;<span class="op" id="3474887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3474891">return</span>&nbsp;<span class="num" id="3474898">0</span><span class="op" id="3474899">,</span>&nbsp;<span class="ident" id="3474901">nil</span><span class="op" id="3474904">,</span>&nbsp;<span class="ident" id="3474906">syscall</span><span class="op" id="3474913">.</span><span class="ident" id="3474914">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3474922">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3474925">n</span><span class="op" id="3474926">,</span>&nbsp;<span class="ident" id="3474928">sa</span><span class="op" id="3474930">,</span>&nbsp;<span class="ident" id="3474932">err</span>&nbsp;<span class="op" id="3474936">:=</span>&nbsp;<span class="ident" id="3474939">c</span><span class="op" id="3474940">.</span><span class="ident" id="3474941">fd</span><span class="op" id="3474943">.</span><span class="ident" id="3474944">readFrom</span><span class="op" id="3474952">(</span><span class="ident" id="3474953">b</span><span class="op" id="3474954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3474957">switch</span>&nbsp;<span class="ident" id="3474964">sa</span>&nbsp;<span class="op" id="3474967">:=</span>&nbsp;<span class="ident" id="3474970">sa</span><span class="op" id="3474972">.</span><span class="op" id="3474973">(</span><span class="keyword" id="3474974">type</span><span class="op" id="3474978">)</span>&nbsp;<span class="op" id="3474980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3474983">case</span>&nbsp;<span class="op" id="3474988">*</span><span class="ident" id="3474989">syscall</span><span class="op" id="3474996">.</span><span class="ident" id="3474997">SockaddrUnix</span><span class="op" id="3475009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3475013">if</span>&nbsp;<span class="ident" id="3475016">sa</span><span class="op" id="3475018">.</span><span class="ident" id="3475019">Name</span>&nbsp;<span class="op" id="3475024">!=</span>&nbsp;<span class="string" id="3475027">&#34;&#34;</span>&nbsp;<span class="op" id="3475030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3475035">addr</span>&nbsp;<span class="op" id="3475040">=</span>&nbsp;<span class="op" id="3475042">&amp;</span><span class="ident" id="3475043">UnixAddr</span><span class="op" id="3475051">{</span><span class="ident" id="3475052">Name</span><span class="op" id="3475056">:</span>&nbsp;<span class="ident" id="3475058">sa</span><span class="op" id="3475060">.</span><span class="ident" id="3475061">Name</span><span class="op" id="3475065">,</span>&nbsp;<span class="ident" id="3475067">Net</span><span class="op" id="3475070">:</span>&nbsp;<span class="ident" id="3475072">sotypeToNet</span><span class="op" id="3475083">(</span><span class="ident" id="3475084">c</span><span class="op" id="3475085">.</span><span class="ident" id="3475086">fd</span><span class="op" id="3475088">.</span><span class="ident" id="3475089">sotype</span><span class="op" id="3475095">)</span><span class="op" id="3475096">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3475100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3475103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3475106">return</span><br>
<span class="lineno"></span><span class="op" id="3475113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3475116">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3475171">func</span>&nbsp;<span class="op" id="3475176">(</span><span class="ident" id="3475177">c</span>&nbsp;<span class="op" id="3475179">*</span><span class="ident" id="3475180">UnixConn</span><span class="op" id="3475188">)</span>&nbsp;<span class="ident" id="3475190">ReadFrom</span><span class="op" id="3475198">(</span><span class="ident" id="3475199">b</span>&nbsp;<span class="op" id="3475201">[</span><span class="op" id="3475202">]</span><span class="builtintype" id="3475203">byte</span><span class="op" id="3475207">)</span>&nbsp;<span class="op" id="3475209">(</span><span class="builtintype" id="3475210">int</span><span class="op" id="3475213">,</span>&nbsp;<span class="ident" id="3475215">Addr</span><span class="op" id="3475219">,</span>&nbsp;<span class="builtintype" id="3475221">error</span><span class="op" id="3475226">)</span>&nbsp;<span class="op" id="3475228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3475231">if</span>&nbsp;<span class="op" id="3475234">!</span><span class="ident" id="3475235">c</span><span class="op" id="3475236">.</span><span class="ident" id="3475237">ok</span><span class="op" id="3475239">(</span><span class="op" id="3475240">)</span>&nbsp;<span class="op" id="3475242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3475246">return</span>&nbsp;<span class="num" id="3475253">0</span><span class="op" id="3475254">,</span>&nbsp;<span class="ident" id="3475256">nil</span><span class="op" id="3475259">,</span>&nbsp;<span class="ident" id="3475261">syscall</span><span class="op" id="3475268">.</span><span class="ident" id="3475269">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3475277">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3475280">n</span><span class="op" id="3475281">,</span>&nbsp;<span class="ident" id="3475283">addr</span><span class="op" id="3475287">,</span>&nbsp;<span class="ident" id="3475289">err</span>&nbsp;<span class="op" id="3475293">:=</span>&nbsp;<span class="ident" id="3475296">c</span><span class="op" id="3475297">.</span><span class="ident" id="3475298">ReadFromUnix</span><span class="op" id="3475310">(</span><span class="ident" id="3475311">b</span><span class="op" id="3475312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3475315">return</span>&nbsp;<span class="ident" id="3475322">n</span><span class="op" id="3475323">,</span>&nbsp;<span class="ident" id="3475325">addr</span><span class="op" id="3475329">.</span><span class="ident" id="3475330">toAddr</span><span class="op" id="3475336">(</span><span class="op" id="3475337">)</span><span class="op" id="3475338">,</span>&nbsp;<span class="ident" id="3475340">err</span><br>
<span class="lineno"></span><span class="op" id="3475344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3475347">//&nbsp;ReadMsgUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno">140</span><span class="comment" id="3475416">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3475487">//&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the&nbsp;flags</span><br>
<span class="lineno"></span><span class="comment" id="3475558">//&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet,&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="3475628">func</span>&nbsp;<span class="op" id="3475633">(</span><span class="ident" id="3475634">c</span>&nbsp;<span class="op" id="3475636">*</span><span class="ident" id="3475637">UnixConn</span><span class="op" id="3475645">)</span>&nbsp;<span class="ident" id="3475647">ReadMsgUnix</span><span class="op" id="3475658">(</span><span class="ident" id="3475659">b</span><span class="op" id="3475660">,</span>&nbsp;<span class="ident" id="3475662">oob</span>&nbsp;<span class="op" id="3475666">[</span><span class="op" id="3475667">]</span><span class="builtintype" id="3475668">byte</span><span class="op" id="3475672">)</span>&nbsp;<span class="op" id="3475674">(</span><span class="ident" id="3475675">n</span><span class="op" id="3475676">,</span>&nbsp;<span class="ident" id="3475678">oobn</span><span class="op" id="3475682">,</span>&nbsp;<span class="ident" id="3475684">flags</span>&nbsp;<span class="builtintype" id="3475690">int</span><span class="op" id="3475693">,</span>&nbsp;<span class="ident" id="3475695">addr</span>&nbsp;<span class="op" id="3475700">*</span><span class="ident" id="3475701">UnixAddr</span><span class="op" id="3475709">,</span>&nbsp;<span class="ident" id="3475711">err</span>&nbsp;<span class="builtintype" id="3475715">error</span><span class="op" id="3475720">)</span>&nbsp;<span class="op" id="3475722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3475725">if</span>&nbsp;<span class="op" id="3475728">!</span><span class="ident" id="3475729">c</span><span class="op" id="3475730">.</span><span class="ident" id="3475731">ok</span><span class="op" id="3475733">(</span><span class="op" id="3475734">)</span>&nbsp;<span class="op" id="3475736">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3475740">return</span>&nbsp;<span class="num" id="3475747">0</span><span class="op" id="3475748">,</span>&nbsp;<span class="num" id="3475750">0</span><span class="op" id="3475751">,</span>&nbsp;<span class="num" id="3475753">0</span><span class="op" id="3475754">,</span>&nbsp;<span class="ident" id="3475756">nil</span><span class="op" id="3475759">,</span>&nbsp;<span class="ident" id="3475761">syscall</span><span class="op" id="3475768">.</span><span class="ident" id="3475769">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3475777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3475780">n</span><span class="op" id="3475781">,</span>&nbsp;<span class="ident" id="3475783">oobn</span><span class="op" id="3475787">,</span>&nbsp;<span class="ident" id="3475789">flags</span><span class="op" id="3475794">,</span>&nbsp;<span class="ident" id="3475796">sa</span><span class="op" id="3475798">,</span>&nbsp;<span class="ident" id="3475800">err</span>&nbsp;<span class="op" id="3475804">:=</span>&nbsp;<span class="ident" id="3475807">c</span><span class="op" id="3475808">.</span><span class="ident" id="3475809">fd</span><span class="op" id="3475811">.</span><span class="ident" id="3475812">readMsg</span><span class="op" id="3475819">(</span><span class="ident" id="3475820">b</span><span class="op" id="3475821">,</span>&nbsp;<span class="ident" id="3475823">oob</span><span class="op" id="3475826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3475829">switch</span>&nbsp;<span class="ident" id="3475836">sa</span>&nbsp;<span class="op" id="3475839">:=</span>&nbsp;<span class="ident" id="3475842">sa</span><span class="op" id="3475844">.</span><span class="op" id="3475845">(</span><span class="keyword" id="3475846">type</span><span class="op" id="3475850">)</span>&nbsp;<span class="op" id="3475852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3475855">case</span>&nbsp;<span class="op" id="3475860">*</span><span class="ident" id="3475861">syscall</span><span class="op" id="3475868">.</span><span class="ident" id="3475869">SockaddrUnix</span><span class="op" id="3475881">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3475885">if</span>&nbsp;<span class="ident" id="3475888">sa</span><span class="op" id="3475890">.</span><span class="ident" id="3475891">Name</span>&nbsp;<span class="op" id="3475896">!=</span>&nbsp;<span class="string" id="3475899">&#34;&#34;</span>&nbsp;<span class="op" id="3475902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3475907">addr</span>&nbsp;<span class="op" id="3475912">=</span>&nbsp;<span class="op" id="3475914">&amp;</span><span class="ident" id="3475915">UnixAddr</span><span class="op" id="3475923">{</span><span class="ident" id="3475924">Name</span><span class="op" id="3475928">:</span>&nbsp;<span class="ident" id="3475930">sa</span><span class="op" id="3475932">.</span><span class="ident" id="3475933">Name</span><span class="op" id="3475937">,</span>&nbsp;<span class="ident" id="3475939">Net</span><span class="op" id="3475942">:</span>&nbsp;<span class="ident" id="3475944">sotypeToNet</span><span class="op" id="3475955">(</span><span class="ident" id="3475956">c</span><span class="op" id="3475957">.</span><span class="ident" id="3475958">fd</span><span class="op" id="3475960">.</span><span class="ident" id="3475961">sotype</span><span class="op" id="3475967">)</span><span class="op" id="3475968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3475972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3475975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3475978">return</span><br>
<span class="lineno">155</span><span class="op" id="3475985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3475988">//&nbsp;WriteToUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3476062">//</span><br>
<span class="lineno"></span><span class="comment" id="3476065">//&nbsp;WriteToUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">160</span><span class="comment" id="3476129">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3476196">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3476265">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3476278">func</span>&nbsp;<span class="op" id="3476283">(</span><span class="ident" id="3476284">c</span>&nbsp;<span class="op" id="3476286">*</span><span class="ident" id="3476287">UnixConn</span><span class="op" id="3476295">)</span>&nbsp;<span class="ident" id="3476297">WriteToUnix</span><span class="op" id="3476308">(</span><span class="ident" id="3476309">b</span>&nbsp;<span class="op" id="3476311">[</span><span class="op" id="3476312">]</span><span class="builtintype" id="3476313">byte</span><span class="op" id="3476317">,</span>&nbsp;<span class="ident" id="3476319">addr</span>&nbsp;<span class="op" id="3476324">*</span><span class="ident" id="3476325">UnixAddr</span><span class="op" id="3476333">)</span>&nbsp;<span class="op" id="3476335">(</span><span class="ident" id="3476336">n</span>&nbsp;<span class="builtintype" id="3476338">int</span><span class="op" id="3476341">,</span>&nbsp;<span class="ident" id="3476343">err</span>&nbsp;<span class="builtintype" id="3476347">error</span><span class="op" id="3476352">)</span>&nbsp;<span class="op" id="3476354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3476357">if</span>&nbsp;<span class="op" id="3476360">!</span><span class="ident" id="3476361">c</span><span class="op" id="3476362">.</span><span class="ident" id="3476363">ok</span><span class="op" id="3476365">(</span><span class="op" id="3476366">)</span>&nbsp;<span class="op" id="3476368">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3476372">return</span>&nbsp;<span class="num" id="3476379">0</span><span class="op" id="3476380">,</span>&nbsp;<span class="ident" id="3476382">syscall</span><span class="op" id="3476389">.</span><span class="ident" id="3476390">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3476398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3476401">if</span>&nbsp;<span class="ident" id="3476404">c</span><span class="op" id="3476405">.</span><span class="ident" id="3476406">fd</span><span class="op" id="3476408">.</span><span class="ident" id="3476409">isConnected</span>&nbsp;<span class="op" id="3476421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3476425">return</span>&nbsp;<span class="num" id="3476432">0</span><span class="op" id="3476433">,</span>&nbsp;<span class="op" id="3476435">&amp;</span><span class="ident" id="3476436">OpError</span><span class="op" id="3476443">{</span><span class="ident" id="3476444">Op</span><span class="op" id="3476446">:</span>&nbsp;<span class="string" id="3476448">&#34;write&#34;</span><span class="op" id="3476455">,</span>&nbsp;<span class="ident" id="3476457">Net</span><span class="op" id="3476460">:</span>&nbsp;<span class="ident" id="3476462">c</span><span class="op" id="3476463">.</span><span class="ident" id="3476464">fd</span><span class="op" id="3476466">.</span><span class="ident" id="3476467">net</span><span class="op" id="3476470">,</span>&nbsp;<span class="ident" id="3476472">Addr</span><span class="op" id="3476476">:</span>&nbsp;<span class="ident" id="3476478">addr</span><span class="op" id="3476482">,</span>&nbsp;<span class="ident" id="3476484">Err</span><span class="op" id="3476487">:</span>&nbsp;<span class="ident" id="3476489">ErrWriteToConnected</span><span class="op" id="3476508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3476511">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3476514">if</span>&nbsp;<span class="ident" id="3476517">addr</span>&nbsp;<span class="op" id="3476522">==</span>&nbsp;<span class="ident" id="3476525">nil</span>&nbsp;<span class="op" id="3476529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3476533">return</span>&nbsp;<span class="num" id="3476540">0</span><span class="op" id="3476541">,</span>&nbsp;<span class="op" id="3476543">&amp;</span><span class="ident" id="3476544">OpError</span><span class="op" id="3476551">{</span><span class="ident" id="3476552">Op</span><span class="op" id="3476554">:</span>&nbsp;<span class="string" id="3476556">&#34;write&#34;</span><span class="op" id="3476563">,</span>&nbsp;<span class="ident" id="3476565">Net</span><span class="op" id="3476568">:</span>&nbsp;<span class="ident" id="3476570">c</span><span class="op" id="3476571">.</span><span class="ident" id="3476572">fd</span><span class="op" id="3476574">.</span><span class="ident" id="3476575">net</span><span class="op" id="3476578">,</span>&nbsp;<span class="ident" id="3476580">Addr</span><span class="op" id="3476584">:</span>&nbsp;<span class="ident" id="3476586">nil</span><span class="op" id="3476589">,</span>&nbsp;<span class="ident" id="3476591">Err</span><span class="op" id="3476594">:</span>&nbsp;<span class="ident" id="3476596">errMissingAddress</span><span class="op" id="3476613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3476616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3476619">if</span>&nbsp;<span class="ident" id="3476622">addr</span><span class="op" id="3476626">.</span><span class="ident" id="3476627">Net</span>&nbsp;<span class="op" id="3476631">!=</span>&nbsp;<span class="ident" id="3476634">sotypeToNet</span><span class="op" id="3476645">(</span><span class="ident" id="3476646">c</span><span class="op" id="3476647">.</span><span class="ident" id="3476648">fd</span><span class="op" id="3476650">.</span><span class="ident" id="3476651">sotype</span><span class="op" id="3476657">)</span>&nbsp;<span class="op" id="3476659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3476663">return</span>&nbsp;<span class="num" id="3476670">0</span><span class="op" id="3476671">,</span>&nbsp;<span class="ident" id="3476673">syscall</span><span class="op" id="3476680">.</span><span class="ident" id="3476681">EAFNOSUPPORT</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3476695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3476698">sa</span>&nbsp;<span class="op" id="3476701">:=</span>&nbsp;<span class="op" id="3476704">&amp;</span><span class="ident" id="3476705">syscall</span><span class="op" id="3476712">.</span><span class="ident" id="3476713">SockaddrUnix</span><span class="op" id="3476725">{</span><span class="ident" id="3476726">Name</span><span class="op" id="3476730">:</span>&nbsp;<span class="ident" id="3476732">addr</span><span class="op" id="3476736">.</span><span class="ident" id="3476737">Name</span><span class="op" id="3476741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3476744">return</span>&nbsp;<span class="ident" id="3476751">c</span><span class="op" id="3476752">.</span><span class="ident" id="3476753">fd</span><span class="op" id="3476755">.</span><span class="ident" id="3476756">writeTo</span><span class="op" id="3476763">(</span><span class="ident" id="3476764">b</span><span class="op" id="3476765">,</span>&nbsp;<span class="ident" id="3476767">sa</span><span class="op" id="3476769">)</span><br>
<span class="lineno"></span><span class="op" id="3476771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="3476774">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3476827">func</span>&nbsp;<span class="op" id="3476832">(</span><span class="ident" id="3476833">c</span>&nbsp;<span class="op" id="3476835">*</span><span class="ident" id="3476836">UnixConn</span><span class="op" id="3476844">)</span>&nbsp;<span class="ident" id="3476846">WriteTo</span><span class="op" id="3476853">(</span><span class="ident" id="3476854">b</span>&nbsp;<span class="op" id="3476856">[</span><span class="op" id="3476857">]</span><span class="builtintype" id="3476858">byte</span><span class="op" id="3476862">,</span>&nbsp;<span class="ident" id="3476864">addr</span>&nbsp;<span class="ident" id="3476869">Addr</span><span class="op" id="3476873">)</span>&nbsp;<span class="op" id="3476875">(</span><span class="ident" id="3476876">n</span>&nbsp;<span class="builtintype" id="3476878">int</span><span class="op" id="3476881">,</span>&nbsp;<span class="ident" id="3476883">err</span>&nbsp;<span class="builtintype" id="3476887">error</span><span class="op" id="3476892">)</span>&nbsp;<span class="op" id="3476894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3476897">if</span>&nbsp;<span class="op" id="3476900">!</span><span class="ident" id="3476901">c</span><span class="op" id="3476902">.</span><span class="ident" id="3476903">ok</span><span class="op" id="3476905">(</span><span class="op" id="3476906">)</span>&nbsp;<span class="op" id="3476908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3476912">return</span>&nbsp;<span class="num" id="3476919">0</span><span class="op" id="3476920">,</span>&nbsp;<span class="ident" id="3476922">syscall</span><span class="op" id="3476929">.</span><span class="ident" id="3476930">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3476938">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3476941">a</span><span class="op" id="3476942">,</span>&nbsp;<span class="ident" id="3476944">ok</span>&nbsp;<span class="op" id="3476947">:=</span>&nbsp;<span class="ident" id="3476950">addr</span><span class="op" id="3476954">.</span><span class="op" id="3476955">(</span><span class="op" id="3476956">*</span><span class="ident" id="3476957">UnixAddr</span><span class="op" id="3476965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3476968">if</span>&nbsp;<span class="op" id="3476971">!</span><span class="ident" id="3476972">ok</span>&nbsp;<span class="op" id="3476975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3476979">return</span>&nbsp;<span class="num" id="3476986">0</span><span class="op" id="3476987">,</span>&nbsp;<span class="op" id="3476989">&amp;</span><span class="ident" id="3476990">OpError</span><span class="op" id="3476997">{</span><span class="string" id="3476998">&#34;write&#34;</span><span class="op" id="3477005">,</span>&nbsp;<span class="ident" id="3477007">c</span><span class="op" id="3477008">.</span><span class="ident" id="3477009">fd</span><span class="op" id="3477011">.</span><span class="ident" id="3477012">net</span><span class="op" id="3477015">,</span>&nbsp;<span class="ident" id="3477017">addr</span><span class="op" id="3477021">,</span>&nbsp;<span class="ident" id="3477023">syscall</span><span class="op" id="3477030">.</span><span class="ident" id="3477031">EINVAL</span><span class="op" id="3477037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3477040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3477043">return</span>&nbsp;<span class="ident" id="3477050">c</span><span class="op" id="3477051">.</span><span class="ident" id="3477052">WriteToUnix</span><span class="op" id="3477063">(</span><span class="ident" id="3477064">b</span><span class="op" id="3477065">,</span>&nbsp;<span class="ident" id="3477067">a</span><span class="op" id="3477068">)</span><br>
<span class="lineno">190</span><span class="op" id="3477070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3477073">//&nbsp;WriteMsgUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3477140">//&nbsp;from&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3477208">//&nbsp;the&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">195</span><span class="keyword" id="3477264">func</span>&nbsp;<span class="op" id="3477269">(</span><span class="ident" id="3477270">c</span>&nbsp;<span class="op" id="3477272">*</span><span class="ident" id="3477273">UnixConn</span><span class="op" id="3477281">)</span>&nbsp;<span class="ident" id="3477283">WriteMsgUnix</span><span class="op" id="3477295">(</span><span class="ident" id="3477296">b</span><span class="op" id="3477297">,</span>&nbsp;<span class="ident" id="3477299">oob</span>&nbsp;<span class="op" id="3477303">[</span><span class="op" id="3477304">]</span><span class="builtintype" id="3477305">byte</span><span class="op" id="3477309">,</span>&nbsp;<span class="ident" id="3477311">addr</span>&nbsp;<span class="op" id="3477316">*</span><span class="ident" id="3477317">UnixAddr</span><span class="op" id="3477325">)</span>&nbsp;<span class="op" id="3477327">(</span><span class="ident" id="3477328">n</span><span class="op" id="3477329">,</span>&nbsp;<span class="ident" id="3477331">oobn</span>&nbsp;<span class="builtintype" id="3477336">int</span><span class="op" id="3477339">,</span>&nbsp;<span class="ident" id="3477341">err</span>&nbsp;<span class="builtintype" id="3477345">error</span><span class="op" id="3477350">)</span>&nbsp;<span class="op" id="3477352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3477355">if</span>&nbsp;<span class="op" id="3477358">!</span><span class="ident" id="3477359">c</span><span class="op" id="3477360">.</span><span class="ident" id="3477361">ok</span><span class="op" id="3477363">(</span><span class="op" id="3477364">)</span>&nbsp;<span class="op" id="3477366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3477370">return</span>&nbsp;<span class="num" id="3477377">0</span><span class="op" id="3477378">,</span>&nbsp;<span class="num" id="3477380">0</span><span class="op" id="3477381">,</span>&nbsp;<span class="ident" id="3477383">syscall</span><span class="op" id="3477390">.</span><span class="ident" id="3477391">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3477399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3477402">if</span>&nbsp;<span class="ident" id="3477405">c</span><span class="op" id="3477406">.</span><span class="ident" id="3477407">fd</span><span class="op" id="3477409">.</span><span class="ident" id="3477410">sotype</span>&nbsp;<span class="op" id="3477417">==</span>&nbsp;<span class="ident" id="3477420">syscall</span><span class="op" id="3477427">.</span><span class="ident" id="3477428">SOCK_DGRAM</span>&nbsp;<span class="op" id="3477439">&amp;&amp;</span>&nbsp;<span class="ident" id="3477442">c</span><span class="op" id="3477443">.</span><span class="ident" id="3477444">fd</span><span class="op" id="3477446">.</span><span class="ident" id="3477447">isConnected</span>&nbsp;<span class="op" id="3477459">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3477463">return</span>&nbsp;<span class="num" id="3477470">0</span><span class="op" id="3477471">,</span>&nbsp;<span class="num" id="3477473">0</span><span class="op" id="3477474">,</span>&nbsp;<span class="op" id="3477476">&amp;</span><span class="ident" id="3477477">OpError</span><span class="op" id="3477484">{</span><span class="ident" id="3477485">Op</span><span class="op" id="3477487">:</span>&nbsp;<span class="string" id="3477489">&#34;write&#34;</span><span class="op" id="3477496">,</span>&nbsp;<span class="ident" id="3477498">Net</span><span class="op" id="3477501">:</span>&nbsp;<span class="ident" id="3477503">c</span><span class="op" id="3477504">.</span><span class="ident" id="3477505">fd</span><span class="op" id="3477507">.</span><span class="ident" id="3477508">net</span><span class="op" id="3477511">,</span>&nbsp;<span class="ident" id="3477513">Addr</span><span class="op" id="3477517">:</span>&nbsp;<span class="ident" id="3477519">addr</span><span class="op" id="3477523">,</span>&nbsp;<span class="ident" id="3477525">Err</span><span class="op" id="3477528">:</span>&nbsp;<span class="ident" id="3477530">ErrWriteToConnected</span><span class="op" id="3477549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3477552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3477555">if</span>&nbsp;<span class="ident" id="3477558">addr</span>&nbsp;<span class="op" id="3477563">!=</span>&nbsp;<span class="ident" id="3477566">nil</span>&nbsp;<span class="op" id="3477570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3477574">if</span>&nbsp;<span class="ident" id="3477577">addr</span><span class="op" id="3477581">.</span><span class="ident" id="3477582">Net</span>&nbsp;<span class="op" id="3477586">!=</span>&nbsp;<span class="ident" id="3477589">sotypeToNet</span><span class="op" id="3477600">(</span><span class="ident" id="3477601">c</span><span class="op" id="3477602">.</span><span class="ident" id="3477603">fd</span><span class="op" id="3477605">.</span><span class="ident" id="3477606">sotype</span><span class="op" id="3477612">)</span>&nbsp;<span class="op" id="3477614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3477619">return</span>&nbsp;<span class="num" id="3477626">0</span><span class="op" id="3477627">,</span>&nbsp;<span class="num" id="3477629">0</span><span class="op" id="3477630">,</span>&nbsp;<span class="ident" id="3477632">syscall</span><span class="op" id="3477639">.</span><span class="ident" id="3477640">EAFNOSUPPORT</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3477655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3477659">sa</span>&nbsp;<span class="op" id="3477662">:=</span>&nbsp;<span class="op" id="3477665">&amp;</span><span class="ident" id="3477666">syscall</span><span class="op" id="3477673">.</span><span class="ident" id="3477674">SockaddrUnix</span><span class="op" id="3477686">{</span><span class="ident" id="3477687">Name</span><span class="op" id="3477691">:</span>&nbsp;<span class="ident" id="3477693">addr</span><span class="op" id="3477697">.</span><span class="ident" id="3477698">Name</span><span class="op" id="3477702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3477706">return</span>&nbsp;<span class="ident" id="3477713">c</span><span class="op" id="3477714">.</span><span class="ident" id="3477715">fd</span><span class="op" id="3477717">.</span><span class="ident" id="3477718">writeMsg</span><span class="op" id="3477726">(</span><span class="ident" id="3477727">b</span><span class="op" id="3477728">,</span>&nbsp;<span class="ident" id="3477730">oob</span><span class="op" id="3477733">,</span>&nbsp;<span class="ident" id="3477735">sa</span><span class="op" id="3477737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3477740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3477743">return</span>&nbsp;<span class="ident" id="3477750">c</span><span class="op" id="3477751">.</span><span class="ident" id="3477752">fd</span><span class="op" id="3477754">.</span><span class="ident" id="3477755">writeMsg</span><span class="op" id="3477763">(</span><span class="ident" id="3477764">b</span><span class="op" id="3477765">,</span>&nbsp;<span class="ident" id="3477767">oob</span><span class="op" id="3477770">,</span>&nbsp;<span class="ident" id="3477772">nil</span><span class="op" id="3477775">)</span><br>
<span class="lineno">210</span><span class="op" id="3477777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3477780">//&nbsp;CloseRead&nbsp;shuts&nbsp;down&nbsp;the&nbsp;reading&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3477852">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3477891">func</span>&nbsp;<span class="op" id="3477896">(</span><span class="ident" id="3477897">c</span>&nbsp;<span class="op" id="3477899">*</span><span class="ident" id="3477900">UnixConn</span><span class="op" id="3477908">)</span>&nbsp;<span class="ident" id="3477910">CloseRead</span><span class="op" id="3477919">(</span><span class="op" id="3477920">)</span>&nbsp;<span class="builtintype" id="3477922">error</span>&nbsp;<span class="op" id="3477928">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3477931">if</span>&nbsp;<span class="op" id="3477934">!</span><span class="ident" id="3477935">c</span><span class="op" id="3477936">.</span><span class="ident" id="3477937">ok</span><span class="op" id="3477939">(</span><span class="op" id="3477940">)</span>&nbsp;<span class="op" id="3477942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3477946">return</span>&nbsp;<span class="ident" id="3477953">syscall</span><span class="op" id="3477960">.</span><span class="ident" id="3477961">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3477969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3477972">return</span>&nbsp;<span class="ident" id="3477979">c</span><span class="op" id="3477980">.</span><span class="ident" id="3477981">fd</span><span class="op" id="3477983">.</span><span class="ident" id="3477984">closeRead</span><span class="op" id="3477993">(</span><span class="op" id="3477994">)</span><br>
<span class="lineno"></span><span class="op" id="3477996">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3477999">//&nbsp;CloseWrite&nbsp;shuts&nbsp;down&nbsp;the&nbsp;writing&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3478072">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3478111">func</span>&nbsp;<span class="op" id="3478116">(</span><span class="ident" id="3478117">c</span>&nbsp;<span class="op" id="3478119">*</span><span class="ident" id="3478120">UnixConn</span><span class="op" id="3478128">)</span>&nbsp;<span class="ident" id="3478130">CloseWrite</span><span class="op" id="3478140">(</span><span class="op" id="3478141">)</span>&nbsp;<span class="builtintype" id="3478143">error</span>&nbsp;<span class="op" id="3478149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3478152">if</span>&nbsp;<span class="op" id="3478155">!</span><span class="ident" id="3478156">c</span><span class="op" id="3478157">.</span><span class="ident" id="3478158">ok</span><span class="op" id="3478160">(</span><span class="op" id="3478161">)</span>&nbsp;<span class="op" id="3478163">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3478167">return</span>&nbsp;<span class="ident" id="3478174">syscall</span><span class="op" id="3478181">.</span><span class="ident" id="3478182">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3478190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3478193">return</span>&nbsp;<span class="ident" id="3478200">c</span><span class="op" id="3478201">.</span><span class="ident" id="3478202">fd</span><span class="op" id="3478204">.</span><span class="ident" id="3478205">closeWrite</span><span class="op" id="3478215">(</span><span class="op" id="3478216">)</span><br>
<span class="lineno"></span><span class="op" id="3478218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="3478221">//&nbsp;DialUnix&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3478290">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3478360">//&nbsp;nil,&nbsp;it&nbsp;is&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3478420">func</span>&nbsp;<span class="ident" id="3478425">DialUnix</span><span class="op" id="3478433">(</span><span class="ident" id="3478434">net</span>&nbsp;<span class="builtintype" id="3478438">string</span><span class="op" id="3478444">,</span>&nbsp;<span class="ident" id="3478446">laddr</span><span class="op" id="3478451">,</span>&nbsp;<span class="ident" id="3478453">raddr</span>&nbsp;<span class="op" id="3478459">*</span><span class="ident" id="3478460">UnixAddr</span><span class="op" id="3478468">)</span>&nbsp;<span class="op" id="3478470">(</span><span class="op" id="3478471">*</span><span class="ident" id="3478472">UnixConn</span><span class="op" id="3478480">,</span>&nbsp;<span class="builtintype" id="3478482">error</span><span class="op" id="3478487">)</span>&nbsp;<span class="op" id="3478489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3478492">switch</span>&nbsp;<span class="ident" id="3478499">net</span>&nbsp;<span class="op" id="3478503">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3478506">case</span>&nbsp;<span class="string" id="3478511">&#34;unix&#34;</span><span class="op" id="3478517">,</span>&nbsp;<span class="string" id="3478519">&#34;unixgram&#34;</span><span class="op" id="3478529">,</span>&nbsp;<span class="string" id="3478531">&#34;unixpacket&#34;</span><span class="op" id="3478543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3478546">default</span><span class="op" id="3478553">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3478557">return</span>&nbsp;<span class="ident" id="3478564">nil</span><span class="op" id="3478567">,</span>&nbsp;<span class="op" id="3478569">&amp;</span><span class="ident" id="3478570">OpError</span><span class="op" id="3478577">{</span><span class="ident" id="3478578">Op</span><span class="op" id="3478580">:</span>&nbsp;<span class="string" id="3478582">&#34;dial&#34;</span><span class="op" id="3478588">,</span>&nbsp;<span class="ident" id="3478590">Net</span><span class="op" id="3478593">:</span>&nbsp;<span class="ident" id="3478595">net</span><span class="op" id="3478598">,</span>&nbsp;<span class="ident" id="3478600">Addr</span><span class="op" id="3478604">:</span>&nbsp;<span class="ident" id="3478606">raddr</span><span class="op" id="3478611">,</span>&nbsp;<span class="ident" id="3478613">Err</span><span class="op" id="3478616">:</span>&nbsp;<span class="ident" id="3478618">UnknownNetworkError</span><span class="op" id="3478637">(</span><span class="ident" id="3478638">net</span><span class="op" id="3478641">)</span><span class="op" id="3478642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3478645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3478648">return</span>&nbsp;<span class="ident" id="3478655">dialUnix</span><span class="op" id="3478663">(</span><span class="ident" id="3478664">net</span><span class="op" id="3478667">,</span>&nbsp;<span class="ident" id="3478669">laddr</span><span class="op" id="3478674">,</span>&nbsp;<span class="ident" id="3478676">raddr</span><span class="op" id="3478681">,</span>&nbsp;<span class="ident" id="3478683">noDeadline</span><span class="op" id="3478693">)</span><br>
<span class="lineno">240</span><span class="op" id="3478695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3478698">func</span>&nbsp;<span class="ident" id="3478703">dialUnix</span><span class="op" id="3478711">(</span><span class="ident" id="3478712">net</span>&nbsp;<span class="builtintype" id="3478716">string</span><span class="op" id="3478722">,</span>&nbsp;<span class="ident" id="3478724">laddr</span><span class="op" id="3478729">,</span>&nbsp;<span class="ident" id="3478731">raddr</span>&nbsp;<span class="op" id="3478737">*</span><span class="ident" id="3478738">UnixAddr</span><span class="op" id="3478746">,</span>&nbsp;<span class="ident" id="3478748">deadline</span>&nbsp;<span class="ident" id="3478757">time</span><span class="op" id="3478761">.</span><span class="ident" id="3478762">Time</span><span class="op" id="3478766">)</span>&nbsp;<span class="op" id="3478768">(</span><span class="op" id="3478769">*</span><span class="ident" id="3478770">UnixConn</span><span class="op" id="3478778">,</span>&nbsp;<span class="builtintype" id="3478780">error</span><span class="op" id="3478785">)</span>&nbsp;<span class="op" id="3478787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3478790">fd</span><span class="op" id="3478792">,</span>&nbsp;<span class="ident" id="3478794">err</span>&nbsp;<span class="op" id="3478798">:=</span>&nbsp;<span class="ident" id="3478801">unixSocket</span><span class="op" id="3478811">(</span><span class="ident" id="3478812">net</span><span class="op" id="3478815">,</span>&nbsp;<span class="ident" id="3478817">laddr</span><span class="op" id="3478822">,</span>&nbsp;<span class="ident" id="3478824">raddr</span><span class="op" id="3478829">,</span>&nbsp;<span class="string" id="3478831">&#34;dial&#34;</span><span class="op" id="3478837">,</span>&nbsp;<span class="ident" id="3478839">deadline</span><span class="op" id="3478847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3478850">if</span>&nbsp;<span class="ident" id="3478853">err</span>&nbsp;<span class="op" id="3478857">!=</span>&nbsp;<span class="ident" id="3478860">nil</span>&nbsp;<span class="op" id="3478864">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3478868">return</span>&nbsp;<span class="ident" id="3478875">nil</span><span class="op" id="3478878">,</span>&nbsp;<span class="op" id="3478880">&amp;</span><span class="ident" id="3478881">OpError</span><span class="op" id="3478888">{</span><span class="ident" id="3478889">Op</span><span class="op" id="3478891">:</span>&nbsp;<span class="string" id="3478893">&#34;dial&#34;</span><span class="op" id="3478899">,</span>&nbsp;<span class="ident" id="3478901">Net</span><span class="op" id="3478904">:</span>&nbsp;<span class="ident" id="3478906">net</span><span class="op" id="3478909">,</span>&nbsp;<span class="ident" id="3478911">Addr</span><span class="op" id="3478915">:</span>&nbsp;<span class="ident" id="3478917">raddr</span><span class="op" id="3478922">,</span>&nbsp;<span class="ident" id="3478924">Err</span><span class="op" id="3478927">:</span>&nbsp;<span class="ident" id="3478929">err</span><span class="op" id="3478932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3478935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3478938">return</span>&nbsp;<span class="ident" id="3478945">newUnixConn</span><span class="op" id="3478956">(</span><span class="ident" id="3478957">fd</span><span class="op" id="3478959">)</span><span class="op" id="3478960">,</span>&nbsp;<span class="ident" id="3478962">nil</span><br>
<span class="lineno"></span><span class="op" id="3478966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="3478969">//&nbsp;UnixListener&nbsp;is&nbsp;a&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;listener.&nbsp;&nbsp;Clients&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="3479035">//&nbsp;typically&nbsp;use&nbsp;variables&nbsp;of&nbsp;type&nbsp;Listener&nbsp;instead&nbsp;of&nbsp;assuming&nbsp;Unix</span><br>
<span class="lineno"></span><span class="comment" id="3479104">//&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3479123">type</span>&nbsp;<span class="ident" id="3479128">UnixListener</span>&nbsp;<span class="keyword" id="3479141">struct</span>&nbsp;<span class="op" id="3479148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3479151">fd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3479156">*</span><span class="ident" id="3479157">netFD</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3479164">path</span>&nbsp;<span class="builtintype" id="3479169">string</span><br>
<span class="lineno"></span><span class="op" id="3479176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3479179">//&nbsp;ListenUnix&nbsp;announces&nbsp;on&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;laddr&nbsp;and&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3479249">//&nbsp;Unix&nbsp;listener.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno">260</span><span class="keyword" id="3479316">func</span>&nbsp;<span class="ident" id="3479321">ListenUnix</span><span class="op" id="3479331">(</span><span class="ident" id="3479332">net</span>&nbsp;<span class="builtintype" id="3479336">string</span><span class="op" id="3479342">,</span>&nbsp;<span class="ident" id="3479344">laddr</span>&nbsp;<span class="op" id="3479350">*</span><span class="ident" id="3479351">UnixAddr</span><span class="op" id="3479359">)</span>&nbsp;<span class="op" id="3479361">(</span><span class="op" id="3479362">*</span><span class="ident" id="3479363">UnixListener</span><span class="op" id="3479375">,</span>&nbsp;<span class="builtintype" id="3479377">error</span><span class="op" id="3479382">)</span>&nbsp;<span class="op" id="3479384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3479387">switch</span>&nbsp;<span class="ident" id="3479394">net</span>&nbsp;<span class="op" id="3479398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3479401">case</span>&nbsp;<span class="string" id="3479406">&#34;unix&#34;</span><span class="op" id="3479412">,</span>&nbsp;<span class="string" id="3479414">&#34;unixpacket&#34;</span><span class="op" id="3479426">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3479429">default</span><span class="op" id="3479436">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3479440">return</span>&nbsp;<span class="ident" id="3479447">nil</span><span class="op" id="3479450">,</span>&nbsp;<span class="op" id="3479452">&amp;</span><span class="ident" id="3479453">OpError</span><span class="op" id="3479460">{</span><span class="ident" id="3479461">Op</span><span class="op" id="3479463">:</span>&nbsp;<span class="string" id="3479465">&#34;listen&#34;</span><span class="op" id="3479473">,</span>&nbsp;<span class="ident" id="3479475">Net</span><span class="op" id="3479478">:</span>&nbsp;<span class="ident" id="3479480">net</span><span class="op" id="3479483">,</span>&nbsp;<span class="ident" id="3479485">Addr</span><span class="op" id="3479489">:</span>&nbsp;<span class="ident" id="3479491">laddr</span><span class="op" id="3479496">,</span>&nbsp;<span class="ident" id="3479498">Err</span><span class="op" id="3479501">:</span>&nbsp;<span class="ident" id="3479503">UnknownNetworkError</span><span class="op" id="3479522">(</span><span class="ident" id="3479523">net</span><span class="op" id="3479526">)</span><span class="op" id="3479527">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3479530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3479533">if</span>&nbsp;<span class="ident" id="3479536">laddr</span>&nbsp;<span class="op" id="3479542">==</span>&nbsp;<span class="ident" id="3479545">nil</span>&nbsp;<span class="op" id="3479549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3479553">return</span>&nbsp;<span class="ident" id="3479560">nil</span><span class="op" id="3479563">,</span>&nbsp;<span class="op" id="3479565">&amp;</span><span class="ident" id="3479566">OpError</span><span class="op" id="3479573">{</span><span class="ident" id="3479574">Op</span><span class="op" id="3479576">:</span>&nbsp;<span class="string" id="3479578">&#34;listen&#34;</span><span class="op" id="3479586">,</span>&nbsp;<span class="ident" id="3479588">Net</span><span class="op" id="3479591">:</span>&nbsp;<span class="ident" id="3479593">net</span><span class="op" id="3479596">,</span>&nbsp;<span class="ident" id="3479598">Addr</span><span class="op" id="3479602">:</span>&nbsp;<span class="ident" id="3479604">nil</span><span class="op" id="3479607">,</span>&nbsp;<span class="ident" id="3479609">Err</span><span class="op" id="3479612">:</span>&nbsp;<span class="ident" id="3479614">errMissingAddress</span><span class="op" id="3479631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3479634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3479637">fd</span><span class="op" id="3479639">,</span>&nbsp;<span class="ident" id="3479641">err</span>&nbsp;<span class="op" id="3479645">:=</span>&nbsp;<span class="ident" id="3479648">unixSocket</span><span class="op" id="3479658">(</span><span class="ident" id="3479659">net</span><span class="op" id="3479662">,</span>&nbsp;<span class="ident" id="3479664">laddr</span><span class="op" id="3479669">,</span>&nbsp;<span class="ident" id="3479671">nil</span><span class="op" id="3479674">,</span>&nbsp;<span class="string" id="3479676">&#34;listen&#34;</span><span class="op" id="3479684">,</span>&nbsp;<span class="ident" id="3479686">noDeadline</span><span class="op" id="3479696">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3479699">if</span>&nbsp;<span class="ident" id="3479702">err</span>&nbsp;<span class="op" id="3479706">!=</span>&nbsp;<span class="ident" id="3479709">nil</span>&nbsp;<span class="op" id="3479713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3479717">return</span>&nbsp;<span class="ident" id="3479724">nil</span><span class="op" id="3479727">,</span>&nbsp;<span class="op" id="3479729">&amp;</span><span class="ident" id="3479730">OpError</span><span class="op" id="3479737">{</span><span class="ident" id="3479738">Op</span><span class="op" id="3479740">:</span>&nbsp;<span class="string" id="3479742">&#34;listen&#34;</span><span class="op" id="3479750">,</span>&nbsp;<span class="ident" id="3479752">Net</span><span class="op" id="3479755">:</span>&nbsp;<span class="ident" id="3479757">net</span><span class="op" id="3479760">,</span>&nbsp;<span class="ident" id="3479762">Addr</span><span class="op" id="3479766">:</span>&nbsp;<span class="ident" id="3479768">laddr</span><span class="op" id="3479773">,</span>&nbsp;<span class="ident" id="3479775">Err</span><span class="op" id="3479778">:</span>&nbsp;<span class="ident" id="3479780">err</span><span class="op" id="3479783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3479786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3479789">return</span>&nbsp;<span class="op" id="3479796">&amp;</span><span class="ident" id="3479797">UnixListener</span><span class="op" id="3479809">{</span><span class="ident" id="3479810">fd</span><span class="op" id="3479812">,</span>&nbsp;<span class="ident" id="3479814">fd</span><span class="op" id="3479816">.</span><span class="ident" id="3479817">laddr</span><span class="op" id="3479822">.</span><span class="ident" id="3479823">String</span><span class="op" id="3479829">(</span><span class="op" id="3479830">)</span><span class="op" id="3479831">}</span><span class="op" id="3479832">,</span>&nbsp;<span class="ident" id="3479834">nil</span><br>
<span class="lineno"></span><span class="op" id="3479838">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="3479841">//&nbsp;AcceptUnix&nbsp;accepts&nbsp;the&nbsp;next&nbsp;incoming&nbsp;call&nbsp;and&nbsp;returns&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3479906">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3479921">func</span>&nbsp;<span class="op" id="3479926">(</span><span class="ident" id="3479927">l</span>&nbsp;<span class="op" id="3479929">*</span><span class="ident" id="3479930">UnixListener</span><span class="op" id="3479942">)</span>&nbsp;<span class="ident" id="3479944">AcceptUnix</span><span class="op" id="3479954">(</span><span class="op" id="3479955">)</span>&nbsp;<span class="op" id="3479957">(</span><span class="op" id="3479958">*</span><span class="ident" id="3479959">UnixConn</span><span class="op" id="3479967">,</span>&nbsp;<span class="builtintype" id="3479969">error</span><span class="op" id="3479974">)</span>&nbsp;<span class="op" id="3479976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3479979">if</span>&nbsp;<span class="ident" id="3479982">l</span>&nbsp;<span class="op" id="3479984">==</span>&nbsp;<span class="ident" id="3479987">nil</span>&nbsp;<span class="op" id="3479991">||</span>&nbsp;<span class="ident" id="3479994">l</span><span class="op" id="3479995">.</span><span class="ident" id="3479996">fd</span>&nbsp;<span class="op" id="3479999">==</span>&nbsp;<span class="ident" id="3480002">nil</span>&nbsp;<span class="op" id="3480006">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3480010">return</span>&nbsp;<span class="ident" id="3480017">nil</span><span class="op" id="3480020">,</span>&nbsp;<span class="ident" id="3480022">syscall</span><span class="op" id="3480029">.</span><span class="ident" id="3480030">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3480038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3480041">fd</span><span class="op" id="3480043">,</span>&nbsp;<span class="ident" id="3480045">err</span>&nbsp;<span class="op" id="3480049">:=</span>&nbsp;<span class="ident" id="3480052">l</span><span class="op" id="3480053">.</span><span class="ident" id="3480054">fd</span><span class="op" id="3480056">.</span><span class="ident" id="3480057">accept</span><span class="op" id="3480063">(</span><span class="op" id="3480064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3480067">if</span>&nbsp;<span class="ident" id="3480070">err</span>&nbsp;<span class="op" id="3480074">!=</span>&nbsp;<span class="ident" id="3480077">nil</span>&nbsp;<span class="op" id="3480081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3480085">return</span>&nbsp;<span class="ident" id="3480092">nil</span><span class="op" id="3480095">,</span>&nbsp;<span class="ident" id="3480097">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3480102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3480105">c</span>&nbsp;<span class="op" id="3480107">:=</span>&nbsp;<span class="ident" id="3480110">newUnixConn</span><span class="op" id="3480121">(</span><span class="ident" id="3480122">fd</span><span class="op" id="3480124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3480127">return</span>&nbsp;<span class="ident" id="3480134">c</span><span class="op" id="3480135">,</span>&nbsp;<span class="ident" id="3480137">nil</span><br>
<span class="lineno"></span><span class="op" id="3480141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="3480144">//&nbsp;Accept&nbsp;implements&nbsp;the&nbsp;Accept&nbsp;method&nbsp;in&nbsp;the&nbsp;Listener&nbsp;interface;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3480213">//&nbsp;waits&nbsp;for&nbsp;the&nbsp;next&nbsp;call&nbsp;and&nbsp;returns&nbsp;a&nbsp;generic&nbsp;Conn.</span><br>
<span class="lineno"></span><span class="keyword" id="3480268">func</span>&nbsp;<span class="op" id="3480273">(</span><span class="ident" id="3480274">l</span>&nbsp;<span class="op" id="3480276">*</span><span class="ident" id="3480277">UnixListener</span><span class="op" id="3480289">)</span>&nbsp;<span class="ident" id="3480291">Accept</span><span class="op" id="3480297">(</span><span class="op" id="3480298">)</span>&nbsp;<span class="op" id="3480300">(</span><span class="ident" id="3480301">c</span>&nbsp;<span class="ident" id="3480303">Conn</span><span class="op" id="3480307">,</span>&nbsp;<span class="ident" id="3480309">err</span>&nbsp;<span class="builtintype" id="3480313">error</span><span class="op" id="3480318">)</span>&nbsp;<span class="op" id="3480320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3480323">c1</span><span class="op" id="3480325">,</span>&nbsp;<span class="ident" id="3480327">err</span>&nbsp;<span class="op" id="3480331">:=</span>&nbsp;<span class="ident" id="3480334">l</span><span class="op" id="3480335">.</span><span class="ident" id="3480336">AcceptUnix</span><span class="op" id="3480346">(</span><span class="op" id="3480347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3480350">if</span>&nbsp;<span class="ident" id="3480353">err</span>&nbsp;<span class="op" id="3480357">!=</span>&nbsp;<span class="ident" id="3480360">nil</span>&nbsp;<span class="op" id="3480364">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3480368">return</span>&nbsp;<span class="ident" id="3480375">nil</span><span class="op" id="3480378">,</span>&nbsp;<span class="ident" id="3480380">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3480385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3480388">return</span>&nbsp;<span class="ident" id="3480395">c1</span><span class="op" id="3480397">,</span>&nbsp;<span class="ident" id="3480399">nil</span><br>
<span class="lineno"></span><span class="op" id="3480403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="3480406">//&nbsp;Close&nbsp;stops&nbsp;listening&nbsp;on&nbsp;the&nbsp;Unix&nbsp;address.&nbsp;&nbsp;Already&nbsp;accepted</span><br>
<span class="lineno"></span><span class="comment" id="3480470">//&nbsp;connections&nbsp;are&nbsp;not&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="3480501">func</span>&nbsp;<span class="op" id="3480506">(</span><span class="ident" id="3480507">l</span>&nbsp;<span class="op" id="3480509">*</span><span class="ident" id="3480510">UnixListener</span><span class="op" id="3480522">)</span>&nbsp;<span class="ident" id="3480524">Close</span><span class="op" id="3480529">(</span><span class="op" id="3480530">)</span>&nbsp;<span class="builtintype" id="3480532">error</span>&nbsp;<span class="op" id="3480538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3480541">if</span>&nbsp;<span class="ident" id="3480544">l</span>&nbsp;<span class="op" id="3480546">==</span>&nbsp;<span class="ident" id="3480549">nil</span>&nbsp;<span class="op" id="3480553">||</span>&nbsp;<span class="ident" id="3480556">l</span><span class="op" id="3480557">.</span><span class="ident" id="3480558">fd</span>&nbsp;<span class="op" id="3480561">==</span>&nbsp;<span class="ident" id="3480564">nil</span>&nbsp;<span class="op" id="3480568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3480572">return</span>&nbsp;<span class="ident" id="3480579">syscall</span><span class="op" id="3480586">.</span><span class="ident" id="3480587">EINVAL</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3480595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3480599">//&nbsp;The&nbsp;operating&nbsp;system&nbsp;doesn&#39;t&nbsp;clean&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3480641">//&nbsp;the&nbsp;file&nbsp;that&nbsp;announcing&nbsp;created,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3480682">//&nbsp;we&nbsp;have&nbsp;to&nbsp;clean&nbsp;it&nbsp;up&nbsp;ourselves.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3480720">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here--we&nbsp;can&#39;t&nbsp;know&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3480763">//&nbsp;sure&nbsp;whether&nbsp;someone&nbsp;else&nbsp;has&nbsp;come&nbsp;along</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3480808">//&nbsp;and&nbsp;replaced&nbsp;our&nbsp;socket&nbsp;name&nbsp;already--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3480851">//&nbsp;but&nbsp;this&nbsp;sequence&nbsp;(remove&nbsp;then&nbsp;close)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3480893">//&nbsp;is&nbsp;at&nbsp;least&nbsp;compatible&nbsp;with&nbsp;the&nbsp;auto-remove</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3480941">//&nbsp;sequence&nbsp;in&nbsp;ListenUnix.&nbsp;&nbsp;It&#39;s&nbsp;only&nbsp;non-Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3480987">//&nbsp;programs&nbsp;that&nbsp;can&nbsp;mess&nbsp;us&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3481021">if</span>&nbsp;<span class="ident" id="3481024">l</span><span class="op" id="3481025">.</span><span class="ident" id="3481026">path</span><span class="op" id="3481030">[</span><span class="num" id="3481031">0</span><span class="op" id="3481032">]</span>&nbsp;<span class="op" id="3481034">!=</span>&nbsp;<span class="string" id="3481037">&#39;@&#39;</span>&nbsp;<span class="op" id="3481041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3481045">syscall</span><span class="op" id="3481052">.</span><span class="ident" id="3481053">Unlink</span><span class="op" id="3481059">(</span><span class="ident" id="3481060">l</span><span class="op" id="3481061">.</span><span class="ident" id="3481062">path</span><span class="op" id="3481066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3481069">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3481072">return</span>&nbsp;<span class="ident" id="3481079">l</span><span class="op" id="3481080">.</span><span class="ident" id="3481081">fd</span><span class="op" id="3481083">.</span><span class="ident" id="3481084">Close</span><span class="op" id="3481089">(</span><span class="op" id="3481090">)</span><br>
<span class="lineno"></span><span class="op" id="3481092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3481095">//&nbsp;Addr&nbsp;returns&nbsp;the&nbsp;listener&#39;s&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3481143">func</span>&nbsp;<span class="op" id="3481148">(</span><span class="ident" id="3481149">l</span>&nbsp;<span class="op" id="3481151">*</span><span class="ident" id="3481152">UnixListener</span><span class="op" id="3481164">)</span>&nbsp;<span class="ident" id="3481166">Addr</span><span class="op" id="3481170">(</span><span class="op" id="3481171">)</span>&nbsp;<span class="ident" id="3481173">Addr</span>&nbsp;<span class="op" id="3481178">{</span>&nbsp;<span class="keyword" id="3481180">return</span>&nbsp;<span class="ident" id="3481187">l</span><span class="op" id="3481188">.</span><span class="ident" id="3481189">fd</span><span class="op" id="3481191">.</span><span class="ident" id="3481192">laddr</span>&nbsp;<span class="op" id="3481198">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="3481201">//&nbsp;SetDeadline&nbsp;sets&nbsp;the&nbsp;deadline&nbsp;associated&nbsp;with&nbsp;the&nbsp;listener.</span><br>
<span class="lineno"></span><span class="comment" id="3481264">//&nbsp;A&nbsp;zero&nbsp;time&nbsp;value&nbsp;disables&nbsp;the&nbsp;deadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3481308">func</span>&nbsp;<span class="op" id="3481313">(</span><span class="ident" id="3481314">l</span>&nbsp;<span class="op" id="3481316">*</span><span class="ident" id="3481317">UnixListener</span><span class="op" id="3481329">)</span>&nbsp;<span class="ident" id="3481331">SetDeadline</span><span class="op" id="3481342">(</span><span class="ident" id="3481343">t</span>&nbsp;<span class="ident" id="3481345">time</span><span class="op" id="3481349">.</span><span class="ident" id="3481350">Time</span><span class="op" id="3481354">)</span>&nbsp;<span class="op" id="3481356">(</span><span class="ident" id="3481357">err</span>&nbsp;<span class="builtintype" id="3481361">error</span><span class="op" id="3481366">)</span>&nbsp;<span class="op" id="3481368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3481371">if</span>&nbsp;<span class="ident" id="3481374">l</span>&nbsp;<span class="op" id="3481376">==</span>&nbsp;<span class="ident" id="3481379">nil</span>&nbsp;<span class="op" id="3481383">||</span>&nbsp;<span class="ident" id="3481386">l</span><span class="op" id="3481387">.</span><span class="ident" id="3481388">fd</span>&nbsp;<span class="op" id="3481391">==</span>&nbsp;<span class="ident" id="3481394">nil</span>&nbsp;<span class="op" id="3481398">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3481402">return</span>&nbsp;<span class="ident" id="3481409">syscall</span><span class="op" id="3481416">.</span><span class="ident" id="3481417">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3481425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3481428">return</span>&nbsp;<span class="ident" id="3481435">l</span><span class="op" id="3481436">.</span><span class="ident" id="3481437">fd</span><span class="op" id="3481439">.</span><span class="ident" id="3481440">setDeadline</span><span class="op" id="3481451">(</span><span class="ident" id="3481452">t</span><span class="op" id="3481453">)</span><br>
<span class="lineno"></span><span class="op" id="3481455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="3481458">//&nbsp;File&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;underlying&nbsp;os.File,&nbsp;set&nbsp;to&nbsp;blocking</span><br>
<span class="lineno"></span><span class="comment" id="3481524">//&nbsp;mode.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="3481594">//&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;l.</span><br>
<span class="lineno"></span><span class="comment" id="3481659">//</span><br>
<span class="lineno"></span><span class="comment" id="3481662">//&nbsp;The&nbsp;returned&nbsp;os.File&#39;s&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;different&nbsp;from&nbsp;the</span><br>
<span class="lineno">340</span><span class="comment" id="3481726">//&nbsp;connection&#39;s.&nbsp;&nbsp;Attempting&nbsp;to&nbsp;change&nbsp;properties&nbsp;of&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span><span class="comment" id="3481792">//&nbsp;using&nbsp;this&nbsp;duplicate&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;have&nbsp;the&nbsp;desired&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="3481856">func</span>&nbsp;<span class="op" id="3481861">(</span><span class="ident" id="3481862">l</span>&nbsp;<span class="op" id="3481864">*</span><span class="ident" id="3481865">UnixListener</span><span class="op" id="3481877">)</span>&nbsp;<span class="ident" id="3481879">File</span><span class="op" id="3481883">(</span><span class="op" id="3481884">)</span>&nbsp;<span class="op" id="3481886">(</span><span class="ident" id="3481887">f</span>&nbsp;<span class="op" id="3481889">*</span><span class="ident" id="3481890">os</span><span class="op" id="3481892">.</span><span class="ident" id="3481893">File</span><span class="op" id="3481897">,</span>&nbsp;<span class="ident" id="3481899">err</span>&nbsp;<span class="builtintype" id="3481903">error</span><span class="op" id="3481908">)</span>&nbsp;<span class="op" id="3481910">{</span>&nbsp;<span class="keyword" id="3481912">return</span>&nbsp;<span class="ident" id="3481919">l</span><span class="op" id="3481920">.</span><span class="ident" id="3481921">fd</span><span class="op" id="3481923">.</span><span class="ident" id="3481924">dup</span><span class="op" id="3481927">(</span><span class="op" id="3481928">)</span>&nbsp;<span class="op" id="3481930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3481933">//&nbsp;ListenUnixgram&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;Unix&nbsp;datagram&nbsp;packets&nbsp;addressed</span><br>
<span class="lineno">345</span><span class="comment" id="3482004">//&nbsp;to&nbsp;the&nbsp;local&nbsp;address&nbsp;laddr.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3482072">//&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo&nbsp;methods&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3482142">//&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;packets&nbsp;with&nbsp;per-packet&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3482201">func</span>&nbsp;<span class="ident" id="3482206">ListenUnixgram</span><span class="op" id="3482220">(</span><span class="ident" id="3482221">net</span>&nbsp;<span class="builtintype" id="3482225">string</span><span class="op" id="3482231">,</span>&nbsp;<span class="ident" id="3482233">laddr</span>&nbsp;<span class="op" id="3482239">*</span><span class="ident" id="3482240">UnixAddr</span><span class="op" id="3482248">)</span>&nbsp;<span class="op" id="3482250">(</span><span class="op" id="3482251">*</span><span class="ident" id="3482252">UnixConn</span><span class="op" id="3482260">,</span>&nbsp;<span class="builtintype" id="3482262">error</span><span class="op" id="3482267">)</span>&nbsp;<span class="op" id="3482269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3482272">switch</span>&nbsp;<span class="ident" id="3482279">net</span>&nbsp;<span class="op" id="3482283">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3482286">case</span>&nbsp;<span class="string" id="3482291">&#34;unixgram&#34;</span><span class="op" id="3482301">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3482304">default</span><span class="op" id="3482311">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3482315">return</span>&nbsp;<span class="ident" id="3482322">nil</span><span class="op" id="3482325">,</span>&nbsp;<span class="op" id="3482327">&amp;</span><span class="ident" id="3482328">OpError</span><span class="op" id="3482335">{</span><span class="ident" id="3482336">Op</span><span class="op" id="3482338">:</span>&nbsp;<span class="string" id="3482340">&#34;listen&#34;</span><span class="op" id="3482348">,</span>&nbsp;<span class="ident" id="3482350">Net</span><span class="op" id="3482353">:</span>&nbsp;<span class="ident" id="3482355">net</span><span class="op" id="3482358">,</span>&nbsp;<span class="ident" id="3482360">Addr</span><span class="op" id="3482364">:</span>&nbsp;<span class="ident" id="3482366">laddr</span><span class="op" id="3482371">,</span>&nbsp;<span class="ident" id="3482373">Err</span><span class="op" id="3482376">:</span>&nbsp;<span class="ident" id="3482378">UnknownNetworkError</span><span class="op" id="3482397">(</span><span class="ident" id="3482398">net</span><span class="op" id="3482401">)</span><span class="op" id="3482402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3482405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3482408">if</span>&nbsp;<span class="ident" id="3482411">laddr</span>&nbsp;<span class="op" id="3482417">==</span>&nbsp;<span class="ident" id="3482420">nil</span>&nbsp;<span class="op" id="3482424">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3482428">return</span>&nbsp;<span class="ident" id="3482435">nil</span><span class="op" id="3482438">,</span>&nbsp;<span class="op" id="3482440">&amp;</span><span class="ident" id="3482441">OpError</span><span class="op" id="3482448">{</span><span class="ident" id="3482449">Op</span><span class="op" id="3482451">:</span>&nbsp;<span class="string" id="3482453">&#34;listen&#34;</span><span class="op" id="3482461">,</span>&nbsp;<span class="ident" id="3482463">Net</span><span class="op" id="3482466">:</span>&nbsp;<span class="ident" id="3482468">net</span><span class="op" id="3482471">,</span>&nbsp;<span class="ident" id="3482473">Addr</span><span class="op" id="3482477">:</span>&nbsp;<span class="ident" id="3482479">nil</span><span class="op" id="3482482">,</span>&nbsp;<span class="ident" id="3482484">Err</span><span class="op" id="3482487">:</span>&nbsp;<span class="ident" id="3482489">errMissingAddress</span><span class="op" id="3482506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3482509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3482512">fd</span><span class="op" id="3482514">,</span>&nbsp;<span class="ident" id="3482516">err</span>&nbsp;<span class="op" id="3482520">:=</span>&nbsp;<span class="ident" id="3482523">unixSocket</span><span class="op" id="3482533">(</span><span class="ident" id="3482534">net</span><span class="op" id="3482537">,</span>&nbsp;<span class="ident" id="3482539">laddr</span><span class="op" id="3482544">,</span>&nbsp;<span class="ident" id="3482546">nil</span><span class="op" id="3482549">,</span>&nbsp;<span class="string" id="3482551">&#34;listen&#34;</span><span class="op" id="3482559">,</span>&nbsp;<span class="ident" id="3482561">noDeadline</span><span class="op" id="3482571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3482574">if</span>&nbsp;<span class="ident" id="3482577">err</span>&nbsp;<span class="op" id="3482581">!=</span>&nbsp;<span class="ident" id="3482584">nil</span>&nbsp;<span class="op" id="3482588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3482592">return</span>&nbsp;<span class="ident" id="3482599">nil</span><span class="op" id="3482602">,</span>&nbsp;<span class="op" id="3482604">&amp;</span><span class="ident" id="3482605">OpError</span><span class="op" id="3482612">{</span><span class="ident" id="3482613">Op</span><span class="op" id="3482615">:</span>&nbsp;<span class="string" id="3482617">&#34;listen&#34;</span><span class="op" id="3482625">,</span>&nbsp;<span class="ident" id="3482627">Net</span><span class="op" id="3482630">:</span>&nbsp;<span class="ident" id="3482632">net</span><span class="op" id="3482635">,</span>&nbsp;<span class="ident" id="3482637">Addr</span><span class="op" id="3482641">:</span>&nbsp;<span class="ident" id="3482643">laddr</span><span class="op" id="3482648">,</span>&nbsp;<span class="ident" id="3482650">Err</span><span class="op" id="3482653">:</span>&nbsp;<span class="ident" id="3482655">err</span><span class="op" id="3482658">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3482661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3482664">return</span>&nbsp;<span class="ident" id="3482671">newUnixConn</span><span class="op" id="3482682">(</span><span class="ident" id="3482683">fd</span><span class="op" id="3482685">)</span><span class="op" id="3482686">,</span>&nbsp;<span class="ident" id="3482688">nil</span><br>
<span class="lineno"></span><span class="op" id="3482692">}</span>
</div>
</body>
</html>
