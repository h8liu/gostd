<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1458852">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1458907">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1458961">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1459012">package</span>&nbsp;<span class="ident" id="1459020">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1459028">import</span>&nbsp;<span class="op" id="1459035">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1459038">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1459047">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1459050">//&nbsp;A&nbsp;Value&nbsp;provides&nbsp;an&nbsp;atomic&nbsp;load&nbsp;and&nbsp;store&nbsp;of&nbsp;a&nbsp;consistently&nbsp;typed&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1459126">//&nbsp;Values&nbsp;can&nbsp;be&nbsp;created&nbsp;as&nbsp;part&nbsp;of&nbsp;other&nbsp;data&nbsp;structures.</span><br>
<span class="lineno"></span><span class="comment" id="1459185">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Value&nbsp;returns&nbsp;nil&nbsp;from&nbsp;Load.</span><br>
<span class="lineno"></span><span class="comment" id="1459238">//&nbsp;Once&nbsp;Store&nbsp;has&nbsp;been&nbsp;called,&nbsp;a&nbsp;Value&nbsp;must&nbsp;not&nbsp;be&nbsp;copied.</span><br>
<span class="lineno">15</span><span class="keyword" id="1459297">type</span>&nbsp;<span class="ident" id="1459302">Value</span>&nbsp;<span class="keyword" id="1459308">struct</span>&nbsp;<span class="op" id="1459315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1459318">v</span>&nbsp;<span class="keyword" id="1459320">interface</span><span class="op" id="1459329">{</span><span class="op" id="1459330">}</span><br>
<span class="lineno"></span><span class="op" id="1459332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1459335">//&nbsp;ifaceWords&nbsp;is&nbsp;interface{}&nbsp;internal&nbsp;representation.</span><br>
<span class="lineno">20</span><span class="keyword" id="1459389">type</span>&nbsp;<span class="ident" id="1459394">ifaceWords</span>&nbsp;<span class="keyword" id="1459405">struct</span>&nbsp;<span class="op" id="1459412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1459415">typ</span>&nbsp;&nbsp;<span class="ident" id="1459420">unsafe</span><span class="op" id="1459426">.</span><span class="ident" id="1459427">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1459436">data</span>&nbsp;<span class="ident" id="1459441">unsafe</span><span class="op" id="1459447">.</span><span class="ident" id="1459448">Pointer</span><br>
<span class="lineno"></span><span class="op" id="1459456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1459459">//&nbsp;Load&nbsp;returns&nbsp;the&nbsp;value&nbsp;set&nbsp;by&nbsp;the&nbsp;most&nbsp;recent&nbsp;Store.</span><br>
<span class="lineno"></span><span class="comment" id="1459515">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;there&nbsp;has&nbsp;been&nbsp;no&nbsp;call&nbsp;to&nbsp;Store&nbsp;for&nbsp;this&nbsp;Value.</span><br>
<span class="lineno"></span><span class="keyword" id="1459584">func</span>&nbsp;<span class="op" id="1459589">(</span><span class="ident" id="1459590">v</span>&nbsp;<span class="op" id="1459592">*</span><span class="ident" id="1459593">Value</span><span class="op" id="1459598">)</span>&nbsp;<span class="ident" id="1459600">Load</span><span class="op" id="1459604">(</span><span class="op" id="1459605">)</span>&nbsp;<span class="op" id="1459607">(</span><span class="ident" id="1459608">x</span>&nbsp;<span class="keyword" id="1459610">interface</span><span class="op" id="1459619">{</span><span class="op" id="1459620">}</span><span class="op" id="1459621">)</span>&nbsp;<span class="op" id="1459623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1459626">vp</span>&nbsp;<span class="op" id="1459629">:=</span>&nbsp;<span class="op" id="1459632">(</span><span class="op" id="1459633">*</span><span class="ident" id="1459634">ifaceWords</span><span class="op" id="1459644">)</span><span class="op" id="1459645">(</span><span class="ident" id="1459646">unsafe</span><span class="op" id="1459652">.</span><span class="ident" id="1459653">Pointer</span><span class="op" id="1459660">(</span><span class="ident" id="1459661">v</span><span class="op" id="1459662">)</span><span class="op" id="1459663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1459666">typ</span>&nbsp;<span class="op" id="1459670">:=</span>&nbsp;<span class="ident" id="1459673">LoadPointer</span><span class="op" id="1459684">(</span><span class="op" id="1459685">&amp;</span><span class="ident" id="1459686">vp</span><span class="op" id="1459688">.</span><span class="ident" id="1459689">typ</span><span class="op" id="1459692">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1459695">if</span>&nbsp;<span class="ident" id="1459698">typ</span>&nbsp;<span class="op" id="1459702">==</span>&nbsp;<span class="ident" id="1459705">nil</span>&nbsp;<span class="op" id="1459709">||</span>&nbsp;<span class="builtintype" id="1459712">uintptr</span><span class="op" id="1459719">(</span><span class="ident" id="1459720">typ</span><span class="op" id="1459723">)</span>&nbsp;<span class="op" id="1459725">==</span>&nbsp;<span class="op" id="1459728">^</span><span class="builtintype" id="1459729">uintptr</span><span class="op" id="1459736">(</span><span class="num" id="1459737">0</span><span class="op" id="1459738">)</span>&nbsp;<span class="op" id="1459740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1459744">//&nbsp;First&nbsp;store&nbsp;not&nbsp;yet&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1459780">return</span>&nbsp;<span class="ident" id="1459787">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1459792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1459795">data</span>&nbsp;<span class="op" id="1459800">:=</span>&nbsp;<span class="ident" id="1459803">LoadPointer</span><span class="op" id="1459814">(</span><span class="op" id="1459815">&amp;</span><span class="ident" id="1459816">vp</span><span class="op" id="1459818">.</span><span class="ident" id="1459819">data</span><span class="op" id="1459823">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1459826">xp</span>&nbsp;<span class="op" id="1459829">:=</span>&nbsp;<span class="op" id="1459832">(</span><span class="op" id="1459833">*</span><span class="ident" id="1459834">ifaceWords</span><span class="op" id="1459844">)</span><span class="op" id="1459845">(</span><span class="ident" id="1459846">unsafe</span><span class="op" id="1459852">.</span><span class="ident" id="1459853">Pointer</span><span class="op" id="1459860">(</span><span class="op" id="1459861">&amp;</span><span class="ident" id="1459862">x</span><span class="op" id="1459863">)</span><span class="op" id="1459864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1459867">xp</span><span class="op" id="1459869">.</span><span class="ident" id="1459870">typ</span>&nbsp;<span class="op" id="1459874">=</span>&nbsp;<span class="ident" id="1459876">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1459881">xp</span><span class="op" id="1459883">.</span><span class="ident" id="1459884">data</span>&nbsp;<span class="op" id="1459889">=</span>&nbsp;<span class="ident" id="1459891">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1459897">return</span><br>
<span class="lineno"></span><span class="op" id="1459904">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="1459907">//&nbsp;Store&nbsp;sets&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;Value&nbsp;to&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1459950">//&nbsp;All&nbsp;calls&nbsp;to&nbsp;Store&nbsp;for&nbsp;a&nbsp;given&nbsp;Value&nbsp;must&nbsp;use&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="1460033">//&nbsp;Store&nbsp;of&nbsp;an&nbsp;inconsistent&nbsp;type&nbsp;panics,&nbsp;as&nbsp;does&nbsp;Store(nil).</span><br>
<span class="lineno"></span><span class="keyword" id="1460094">func</span>&nbsp;<span class="op" id="1460099">(</span><span class="ident" id="1460100">v</span>&nbsp;<span class="op" id="1460102">*</span><span class="ident" id="1460103">Value</span><span class="op" id="1460108">)</span>&nbsp;<span class="ident" id="1460110">Store</span><span class="op" id="1460115">(</span><span class="ident" id="1460116">x</span>&nbsp;<span class="keyword" id="1460118">interface</span><span class="op" id="1460127">{</span><span class="op" id="1460128">}</span><span class="op" id="1460129">)</span>&nbsp;<span class="op" id="1460131">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1460134">if</span>&nbsp;<span class="ident" id="1460137">x</span>&nbsp;<span class="op" id="1460139">==</span>&nbsp;<span class="ident" id="1460142">nil</span>&nbsp;<span class="op" id="1460146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1460150">panic</span><span class="op" id="1460155">(</span><span class="string" id="1460156">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;nil&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1460200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1460203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1460206">vp</span>&nbsp;<span class="op" id="1460209">:=</span>&nbsp;<span class="op" id="1460212">(</span><span class="op" id="1460213">*</span><span class="ident" id="1460214">ifaceWords</span><span class="op" id="1460224">)</span><span class="op" id="1460225">(</span><span class="ident" id="1460226">unsafe</span><span class="op" id="1460232">.</span><span class="ident" id="1460233">Pointer</span><span class="op" id="1460240">(</span><span class="ident" id="1460241">v</span><span class="op" id="1460242">)</span><span class="op" id="1460243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1460246">xp</span>&nbsp;<span class="op" id="1460249">:=</span>&nbsp;<span class="op" id="1460252">(</span><span class="op" id="1460253">*</span><span class="ident" id="1460254">ifaceWords</span><span class="op" id="1460264">)</span><span class="op" id="1460265">(</span><span class="ident" id="1460266">unsafe</span><span class="op" id="1460272">.</span><span class="ident" id="1460273">Pointer</span><span class="op" id="1460280">(</span><span class="op" id="1460281">&amp;</span><span class="ident" id="1460282">x</span><span class="op" id="1460283">)</span><span class="op" id="1460284">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1460287">for</span>&nbsp;<span class="op" id="1460291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1460295">typ</span>&nbsp;<span class="op" id="1460299">:=</span>&nbsp;<span class="ident" id="1460302">LoadPointer</span><span class="op" id="1460313">(</span><span class="op" id="1460314">&amp;</span><span class="ident" id="1460315">vp</span><span class="op" id="1460317">.</span><span class="ident" id="1460318">typ</span><span class="op" id="1460321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1460325">if</span>&nbsp;<span class="ident" id="1460328">typ</span>&nbsp;<span class="op" id="1460332">==</span>&nbsp;<span class="ident" id="1460335">nil</span>&nbsp;<span class="op" id="1460339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1460344">//&nbsp;Attempt&nbsp;to&nbsp;start&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1460380">//&nbsp;Disable&nbsp;preemption&nbsp;so&nbsp;that&nbsp;other&nbsp;goroutines&nbsp;can&nbsp;use</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1460438">//&nbsp;active&nbsp;spin&nbsp;wait&nbsp;to&nbsp;wait&nbsp;for&nbsp;completion;&nbsp;and&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1460497">//&nbsp;GC&nbsp;does&nbsp;not&nbsp;see&nbsp;the&nbsp;fake&nbsp;type&nbsp;accidentally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1460547">runtime_procPin</span><span class="op" id="1460562">(</span><span class="op" id="1460563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1460568">if</span>&nbsp;<span class="op" id="1460571">!</span><span class="ident" id="1460572">CompareAndSwapPointer</span><span class="op" id="1460593">(</span><span class="op" id="1460594">&amp;</span><span class="ident" id="1460595">vp</span><span class="op" id="1460597">.</span><span class="ident" id="1460598">typ</span><span class="op" id="1460601">,</span>&nbsp;<span class="ident" id="1460603">nil</span><span class="op" id="1460606">,</span>&nbsp;<span class="ident" id="1460608">unsafe</span><span class="op" id="1460614">.</span><span class="ident" id="1460615">Pointer</span><span class="op" id="1460622">(</span><span class="op" id="1460623">^</span><span class="builtintype" id="1460624">uintptr</span><span class="op" id="1460631">(</span><span class="num" id="1460632">0</span><span class="op" id="1460633">)</span><span class="op" id="1460634">)</span><span class="op" id="1460635">)</span>&nbsp;<span class="op" id="1460637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1460643">runtime_procUnpin</span><span class="op" id="1460660">(</span><span class="op" id="1460661">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1460667">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1460679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1460684">//&nbsp;Complete&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1460712">StorePointer</span><span class="op" id="1460724">(</span><span class="op" id="1460725">&amp;</span><span class="ident" id="1460726">vp</span><span class="op" id="1460728">.</span><span class="ident" id="1460729">data</span><span class="op" id="1460733">,</span>&nbsp;<span class="ident" id="1460735">xp</span><span class="op" id="1460737">.</span><span class="ident" id="1460738">data</span><span class="op" id="1460742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1460747">StorePointer</span><span class="op" id="1460759">(</span><span class="op" id="1460760">&amp;</span><span class="ident" id="1460761">vp</span><span class="op" id="1460763">.</span><span class="ident" id="1460764">typ</span><span class="op" id="1460767">,</span>&nbsp;<span class="ident" id="1460769">xp</span><span class="op" id="1460771">.</span><span class="ident" id="1460772">typ</span><span class="op" id="1460775">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1460780">runtime_procUnpin</span><span class="op" id="1460797">(</span><span class="op" id="1460798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1460803">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1460812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1460816">if</span>&nbsp;<span class="builtintype" id="1460819">uintptr</span><span class="op" id="1460826">(</span><span class="ident" id="1460827">typ</span><span class="op" id="1460830">)</span>&nbsp;<span class="op" id="1460832">==</span>&nbsp;<span class="op" id="1460835">^</span><span class="builtintype" id="1460836">uintptr</span><span class="op" id="1460843">(</span><span class="num" id="1460844">0</span><span class="op" id="1460845">)</span>&nbsp;<span class="op" id="1460847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1460852">//&nbsp;First&nbsp;store&nbsp;in&nbsp;progress.&nbsp;Wait.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1460889">//&nbsp;Since&nbsp;we&nbsp;disable&nbsp;preemption&nbsp;around&nbsp;the&nbsp;first&nbsp;store,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1460947">//&nbsp;we&nbsp;can&nbsp;wait&nbsp;with&nbsp;active&nbsp;spinning.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1460987">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1460998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1461002">//&nbsp;First&nbsp;store&nbsp;completed.&nbsp;Check&nbsp;type&nbsp;and&nbsp;overwrite&nbsp;data.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1461061">if</span>&nbsp;<span class="ident" id="1461064">typ</span>&nbsp;<span class="op" id="1461068">!=</span>&nbsp;<span class="ident" id="1461071">xp</span><span class="op" id="1461073">.</span><span class="ident" id="1461074">typ</span>&nbsp;<span class="op" id="1461078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1461083">panic</span><span class="op" id="1461088">(</span><span class="string" id="1461089">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;inconsistently&nbsp;typed&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1461150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1461154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1461158">StorePointer</span><span class="op" id="1461170">(</span><span class="op" id="1461171">&amp;</span><span class="ident" id="1461172">vp</span><span class="op" id="1461174">.</span><span class="ident" id="1461175">data</span><span class="op" id="1461179">,</span>&nbsp;<span class="ident" id="1461181">xp</span><span class="op" id="1461183">.</span><span class="ident" id="1461184">data</span><span class="op" id="1461188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1461192">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1461200">}</span><br>
<span class="lineno"></span><span class="op" id="1461202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1461205">//&nbsp;Disable/enable&nbsp;preemption,&nbsp;implemented&nbsp;in&nbsp;runtime.</span><br>
<span class="lineno"></span><span class="keyword" id="1461259">func</span>&nbsp;<span class="ident" id="1461264">runtime_procPin</span><span class="op" id="1461279">(</span><span class="op" id="1461280">)</span><br>
<span class="lineno">85</span><span class="keyword" id="1461282">func</span>&nbsp;<span class="ident" id="1461287">runtime_procUnpin</span><span class="op" id="1461304">(</span><span class="op" id="1461305">)</span>
</div>
</body>
</html>
