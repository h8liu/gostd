<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5164215">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5164270">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5164324">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5164375">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;export&nbsp;filtering&nbsp;of&nbsp;an&nbsp;AST.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5164428">package</span>&nbsp;<span class="ident" id="5164436">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5164441">import</span>&nbsp;<span class="op" id="5164448">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5164451">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5164461">&#34;go/token&#34;</span><br>
<span class="lineno"></span><span class="op" id="5164472">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5164475">//&nbsp;filterIdentList&nbsp;removes&nbsp;unexported&nbsp;names&nbsp;from&nbsp;list&nbsp;in&nbsp;place</span><br>
<span class="lineno">15</span><span class="comment" id="5164538">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;list.&nbsp;If&nbsp;blankOk&nbsp;is&nbsp;set,&nbsp;blank</span><br>
<span class="lineno"></span><span class="comment" id="5164598">//&nbsp;identifiers&nbsp;are&nbsp;considered&nbsp;exported&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="5164644">//</span><br>
<span class="lineno"></span><span class="keyword" id="5164647">func</span>&nbsp;<span class="ident" id="5164652">filterIdentList</span><span class="op" id="5164667">(</span><span class="ident" id="5164668">list</span>&nbsp;<span class="op" id="5164673">[</span><span class="op" id="5164674">]</span><span class="op" id="5164675">*</span><span class="ident" id="5164676">ast</span><span class="op" id="5164679">.</span><span class="ident" id="5164680">Ident</span><span class="op" id="5164685">,</span>&nbsp;<span class="ident" id="5164687">blankOk</span>&nbsp;<span class="builtintype" id="5164695">bool</span><span class="op" id="5164699">)</span>&nbsp;<span class="op" id="5164701">[</span><span class="op" id="5164702">]</span><span class="op" id="5164703">*</span><span class="ident" id="5164704">ast</span><span class="op" id="5164707">.</span><span class="ident" id="5164708">Ident</span>&nbsp;<span class="op" id="5164714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5164717">j</span>&nbsp;<span class="op" id="5164719">:=</span>&nbsp;<span class="num" id="5164722">0</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5164725">for</span>&nbsp;<span class="ident" id="5164729">_</span><span class="op" id="5164730">,</span>&nbsp;<span class="ident" id="5164732">x</span>&nbsp;<span class="op" id="5164734">:=</span>&nbsp;<span class="keyword" id="5164737">range</span>&nbsp;<span class="ident" id="5164743">list</span>&nbsp;<span class="op" id="5164748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5164752">if</span>&nbsp;<span class="ident" id="5164755">ast</span><span class="op" id="5164758">.</span><span class="ident" id="5164759">IsExported</span><span class="op" id="5164769">(</span><span class="ident" id="5164770">x</span><span class="op" id="5164771">.</span><span class="ident" id="5164772">Name</span><span class="op" id="5164776">)</span>&nbsp;<span class="op" id="5164778">||</span>&nbsp;<span class="op" id="5164781">(</span><span class="ident" id="5164782">blankOk</span>&nbsp;<span class="op" id="5164790">&amp;&amp;</span>&nbsp;<span class="ident" id="5164793">x</span><span class="op" id="5164794">.</span><span class="ident" id="5164795">Name</span>&nbsp;<span class="op" id="5164800">==</span>&nbsp;<span class="string" id="5164803">&#34;_&#34;</span><span class="op" id="5164806">)</span>&nbsp;<span class="op" id="5164808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5164813">list</span><span class="op" id="5164817">[</span><span class="ident" id="5164818">j</span><span class="op" id="5164819">]</span>&nbsp;<span class="op" id="5164821">=</span>&nbsp;<span class="ident" id="5164823">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5164828">j</span><span class="op" id="5164829">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5164834">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5164837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5164840">return</span>&nbsp;<span class="ident" id="5164847">list</span><span class="op" id="5164851">[</span><span class="num" id="5164852">0</span><span class="op" id="5164853">:</span><span class="ident" id="5164854">j</span><span class="op" id="5164855">]</span><br>
<span class="lineno"></span><span class="op" id="5164857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5164860">//&nbsp;removeErrorField&nbsp;removes&nbsp;anonymous&nbsp;fields&nbsp;named&nbsp;&#34;error&#34;&nbsp;from&nbsp;an&nbsp;interface.</span><br>
<span class="lineno">30</span><span class="comment" id="5164938">//&nbsp;This&nbsp;is&nbsp;called&nbsp;when&nbsp;&#34;error&#34;&nbsp;has&nbsp;been&nbsp;determined&nbsp;to&nbsp;be&nbsp;a&nbsp;local&nbsp;name,</span><br>
<span class="lineno"></span><span class="comment" id="5165009">//&nbsp;not&nbsp;the&nbsp;predeclared&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5165038">//</span><br>
<span class="lineno"></span><span class="keyword" id="5165041">func</span>&nbsp;<span class="ident" id="5165046">removeErrorField</span><span class="op" id="5165062">(</span><span class="ident" id="5165063">ityp</span>&nbsp;<span class="op" id="5165068">*</span><span class="ident" id="5165069">ast</span><span class="op" id="5165072">.</span><span class="ident" id="5165073">InterfaceType</span><span class="op" id="5165086">)</span>&nbsp;<span class="op" id="5165088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165091">list</span>&nbsp;<span class="op" id="5165096">:=</span>&nbsp;<span class="ident" id="5165099">ityp</span><span class="op" id="5165103">.</span><span class="ident" id="5165104">Methods</span><span class="op" id="5165111">.</span><span class="ident" id="5165112">List</span>&nbsp;<span class="comment" id="5165117">//&nbsp;we&nbsp;know&nbsp;that&nbsp;ityp.Methods&nbsp;!=&nbsp;nil</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165154">j</span>&nbsp;<span class="op" id="5165156">:=</span>&nbsp;<span class="num" id="5165159">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165162">for</span>&nbsp;<span class="ident" id="5165166">_</span><span class="op" id="5165167">,</span>&nbsp;<span class="ident" id="5165169">field</span>&nbsp;<span class="op" id="5165175">:=</span>&nbsp;<span class="keyword" id="5165178">range</span>&nbsp;<span class="ident" id="5165184">list</span>&nbsp;<span class="op" id="5165189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165193">keepField</span>&nbsp;<span class="op" id="5165203">:=</span>&nbsp;<span class="builtintype" id="5165206">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165213">if</span>&nbsp;<span class="ident" id="5165216">n</span>&nbsp;<span class="op" id="5165218">:=</span>&nbsp;<span class="builtinfunc" id="5165221">len</span><span class="op" id="5165224">(</span><span class="ident" id="5165225">field</span><span class="op" id="5165230">.</span><span class="ident" id="5165231">Names</span><span class="op" id="5165236">)</span><span class="op" id="5165237">;</span>&nbsp;<span class="ident" id="5165239">n</span>&nbsp;<span class="op" id="5165241">==</span>&nbsp;<span class="num" id="5165244">0</span>&nbsp;<span class="op" id="5165246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5165251">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165273">if</span>&nbsp;<span class="ident" id="5165276">fname</span><span class="op" id="5165281">,</span>&nbsp;<span class="ident" id="5165283">_</span>&nbsp;<span class="op" id="5165285">:=</span>&nbsp;<span class="ident" id="5165288">baseTypeName</span><span class="op" id="5165300">(</span><span class="ident" id="5165301">field</span><span class="op" id="5165306">.</span><span class="ident" id="5165307">Type</span><span class="op" id="5165311">)</span><span class="op" id="5165312">;</span>&nbsp;<span class="ident" id="5165314">fname</span>&nbsp;<span class="op" id="5165320">==</span>&nbsp;<span class="string" id="5165323">&#34;error&#34;</span>&nbsp;<span class="op" id="5165331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165337">keepField</span>&nbsp;<span class="op" id="5165347">=</span>&nbsp;<span class="builtintype" id="5165349">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5165358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5165362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165366">if</span>&nbsp;<span class="ident" id="5165369">keepField</span>&nbsp;<span class="op" id="5165379">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165384">list</span><span class="op" id="5165388">[</span><span class="ident" id="5165389">j</span><span class="op" id="5165390">]</span>&nbsp;<span class="op" id="5165392">=</span>&nbsp;<span class="ident" id="5165394">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165403">j</span><span class="op" id="5165404">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5165409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5165412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165415">if</span>&nbsp;<span class="ident" id="5165418">j</span>&nbsp;<span class="op" id="5165420">&lt;</span>&nbsp;<span class="builtinfunc" id="5165422">len</span><span class="op" id="5165425">(</span><span class="ident" id="5165426">list</span><span class="op" id="5165430">)</span>&nbsp;<span class="op" id="5165432">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165436">ityp</span><span class="op" id="5165440">.</span><span class="ident" id="5165441">Incomplete</span>&nbsp;<span class="op" id="5165452">=</span>&nbsp;<span class="builtintype" id="5165454">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5165460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165463">ityp</span><span class="op" id="5165467">.</span><span class="ident" id="5165468">Methods</span><span class="op" id="5165475">.</span><span class="ident" id="5165476">List</span>&nbsp;<span class="op" id="5165481">=</span>&nbsp;<span class="ident" id="5165483">list</span><span class="op" id="5165487">[</span><span class="num" id="5165488">0</span><span class="op" id="5165489">:</span><span class="ident" id="5165490">j</span><span class="op" id="5165491">]</span><br>
<span class="lineno"></span><span class="op" id="5165493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="5165496">//&nbsp;filterFieldList&nbsp;removes&nbsp;unexported&nbsp;fields&nbsp;(field&nbsp;names)&nbsp;from&nbsp;the&nbsp;field&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5165575">//&nbsp;in&nbsp;place&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;fields&nbsp;were&nbsp;removed.&nbsp;Anonymous&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5165649">//&nbsp;recorded&nbsp;with&nbsp;the&nbsp;parent&nbsp;type.&nbsp;filterType&nbsp;is&nbsp;called&nbsp;with&nbsp;the&nbsp;types&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5165722">//&nbsp;all&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="5165747">//</span><br>
<span class="lineno">60</span><span class="keyword" id="5165750">func</span>&nbsp;<span class="op" id="5165755">(</span><span class="ident" id="5165756">r</span>&nbsp;<span class="op" id="5165758">*</span><span class="ident" id="5165759">reader</span><span class="op" id="5165765">)</span>&nbsp;<span class="ident" id="5165767">filterFieldList</span><span class="op" id="5165782">(</span><span class="ident" id="5165783">parent</span>&nbsp;<span class="op" id="5165790">*</span><span class="ident" id="5165791">namedType</span><span class="op" id="5165800">,</span>&nbsp;<span class="ident" id="5165802">fields</span>&nbsp;<span class="op" id="5165809">*</span><span class="ident" id="5165810">ast</span><span class="op" id="5165813">.</span><span class="ident" id="5165814">FieldList</span><span class="op" id="5165823">,</span>&nbsp;<span class="ident" id="5165825">ityp</span>&nbsp;<span class="op" id="5165830">*</span><span class="ident" id="5165831">ast</span><span class="op" id="5165834">.</span><span class="ident" id="5165835">InterfaceType</span><span class="op" id="5165848">)</span>&nbsp;<span class="op" id="5165850">(</span><span class="ident" id="5165851">removedFields</span>&nbsp;<span class="builtintype" id="5165865">bool</span><span class="op" id="5165869">)</span>&nbsp;<span class="op" id="5165871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165874">if</span>&nbsp;<span class="ident" id="5165877">fields</span>&nbsp;<span class="op" id="5165884">==</span>&nbsp;<span class="ident" id="5165887">nil</span>&nbsp;<span class="op" id="5165891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165895">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5165903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165906">list</span>&nbsp;<span class="op" id="5165911">:=</span>&nbsp;<span class="ident" id="5165914">fields</span><span class="op" id="5165920">.</span><span class="ident" id="5165921">List</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165927">j</span>&nbsp;<span class="op" id="5165929">:=</span>&nbsp;<span class="num" id="5165932">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165935">for</span>&nbsp;<span class="ident" id="5165939">_</span><span class="op" id="5165940">,</span>&nbsp;<span class="ident" id="5165942">field</span>&nbsp;<span class="op" id="5165948">:=</span>&nbsp;<span class="keyword" id="5165951">range</span>&nbsp;<span class="ident" id="5165957">list</span>&nbsp;<span class="op" id="5165962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165966">keepField</span>&nbsp;<span class="op" id="5165976">:=</span>&nbsp;<span class="builtintype" id="5165979">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5165987">if</span>&nbsp;<span class="ident" id="5165990">n</span>&nbsp;<span class="op" id="5165992">:=</span>&nbsp;<span class="builtinfunc" id="5165995">len</span><span class="op" id="5165998">(</span><span class="ident" id="5165999">field</span><span class="op" id="5166004">.</span><span class="ident" id="5166005">Names</span><span class="op" id="5166010">)</span><span class="op" id="5166011">;</span>&nbsp;<span class="ident" id="5166013">n</span>&nbsp;<span class="op" id="5166015">==</span>&nbsp;<span class="num" id="5166018">0</span>&nbsp;<span class="op" id="5166020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5166025">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166047">fname</span>&nbsp;<span class="op" id="5166053">:=</span>&nbsp;<span class="ident" id="5166056">r</span><span class="op" id="5166057">.</span><span class="ident" id="5166058">recordAnonymousField</span><span class="op" id="5166078">(</span><span class="ident" id="5166079">parent</span><span class="op" id="5166085">,</span>&nbsp;<span class="ident" id="5166087">field</span><span class="op" id="5166092">.</span><span class="ident" id="5166093">Type</span><span class="op" id="5166097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166102">if</span>&nbsp;<span class="ident" id="5166105">ast</span><span class="op" id="5166108">.</span><span class="ident" id="5166109">IsExported</span><span class="op" id="5166119">(</span><span class="ident" id="5166120">fname</span><span class="op" id="5166125">)</span>&nbsp;<span class="op" id="5166127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166133">keepField</span>&nbsp;<span class="op" id="5166143">=</span>&nbsp;<span class="builtintype" id="5166145">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166153">}</span>&nbsp;<span class="keyword" id="5166155">else</span>&nbsp;<span class="keyword" id="5166160">if</span>&nbsp;<span class="ident" id="5166163">ityp</span>&nbsp;<span class="op" id="5166168">!=</span>&nbsp;<span class="ident" id="5166171">nil</span>&nbsp;<span class="op" id="5166175">&amp;&amp;</span>&nbsp;<span class="ident" id="5166178">fname</span>&nbsp;<span class="op" id="5166184">==</span>&nbsp;<span class="string" id="5166187">&#34;error&#34;</span>&nbsp;<span class="op" id="5166195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5166201">//&nbsp;possibly&nbsp;the&nbsp;predeclared&nbsp;error&nbsp;interface;&nbsp;keep</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5166255">//&nbsp;it&nbsp;for&nbsp;now&nbsp;but&nbsp;remember&nbsp;this&nbsp;interface&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5166309">//&nbsp;it&nbsp;can&nbsp;be&nbsp;fixed&nbsp;if&nbsp;error&nbsp;is&nbsp;also&nbsp;defined&nbsp;locally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166365">keepField</span>&nbsp;<span class="op" id="5166375">=</span>&nbsp;<span class="builtintype" id="5166377">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166386">r</span><span class="op" id="5166387">.</span><span class="ident" id="5166388">remember</span><span class="op" id="5166396">(</span><span class="ident" id="5166397">ityp</span><span class="op" id="5166401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166406">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166410">}</span>&nbsp;<span class="keyword" id="5166412">else</span>&nbsp;<span class="op" id="5166417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166422">field</span><span class="op" id="5166427">.</span><span class="ident" id="5166428">Names</span>&nbsp;<span class="op" id="5166434">=</span>&nbsp;<span class="ident" id="5166436">filterIdentList</span><span class="op" id="5166451">(</span><span class="ident" id="5166452">field</span><span class="op" id="5166457">.</span><span class="ident" id="5166458">Names</span><span class="op" id="5166463">,</span>&nbsp;<span class="builtintype" id="5166465">false</span><span class="op" id="5166470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166475">if</span>&nbsp;<span class="builtinfunc" id="5166478">len</span><span class="op" id="5166481">(</span><span class="ident" id="5166482">field</span><span class="op" id="5166487">.</span><span class="ident" id="5166488">Names</span><span class="op" id="5166493">)</span>&nbsp;<span class="op" id="5166495">&lt;</span>&nbsp;<span class="ident" id="5166497">n</span>&nbsp;<span class="op" id="5166499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166505">removedFields</span>&nbsp;<span class="op" id="5166519">=</span>&nbsp;<span class="builtintype" id="5166521">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166529">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166534">if</span>&nbsp;<span class="builtinfunc" id="5166537">len</span><span class="op" id="5166540">(</span><span class="ident" id="5166541">field</span><span class="op" id="5166546">.</span><span class="ident" id="5166547">Names</span><span class="op" id="5166552">)</span>&nbsp;<span class="op" id="5166554">&gt;</span>&nbsp;<span class="num" id="5166556">0</span>&nbsp;<span class="op" id="5166558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166564">keepField</span>&nbsp;<span class="op" id="5166574">=</span>&nbsp;<span class="builtintype" id="5166576">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166592">if</span>&nbsp;<span class="ident" id="5166595">keepField</span>&nbsp;<span class="op" id="5166605">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166610">r</span><span class="op" id="5166611">.</span><span class="ident" id="5166612">filterType</span><span class="op" id="5166622">(</span><span class="ident" id="5166623">nil</span><span class="op" id="5166626">,</span>&nbsp;<span class="ident" id="5166628">field</span><span class="op" id="5166633">.</span><span class="ident" id="5166634">Type</span><span class="op" id="5166638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166643">list</span><span class="op" id="5166647">[</span><span class="ident" id="5166648">j</span><span class="op" id="5166649">]</span>&nbsp;<span class="op" id="5166651">=</span>&nbsp;<span class="ident" id="5166653">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166662">j</span><span class="op" id="5166663">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166671">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166674">if</span>&nbsp;<span class="ident" id="5166677">j</span>&nbsp;<span class="op" id="5166679">&lt;</span>&nbsp;<span class="builtinfunc" id="5166681">len</span><span class="op" id="5166684">(</span><span class="ident" id="5166685">list</span><span class="op" id="5166689">)</span>&nbsp;<span class="op" id="5166691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166695">removedFields</span>&nbsp;<span class="op" id="5166709">=</span>&nbsp;<span class="builtintype" id="5166711">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166720">fields</span><span class="op" id="5166726">.</span><span class="ident" id="5166727">List</span>&nbsp;<span class="op" id="5166732">=</span>&nbsp;<span class="ident" id="5166734">list</span><span class="op" id="5166738">[</span><span class="num" id="5166739">0</span><span class="op" id="5166740">:</span><span class="ident" id="5166741">j</span><span class="op" id="5166742">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166745">return</span><br>
<span class="lineno">100</span><span class="op" id="5166752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5166755">//&nbsp;filterParamList&nbsp;applies&nbsp;filterType&nbsp;to&nbsp;each&nbsp;parameter&nbsp;type&nbsp;in&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="5166827">//</span><br>
<span class="lineno"></span><span class="keyword" id="5166830">func</span>&nbsp;<span class="op" id="5166835">(</span><span class="ident" id="5166836">r</span>&nbsp;<span class="op" id="5166838">*</span><span class="ident" id="5166839">reader</span><span class="op" id="5166845">)</span>&nbsp;<span class="ident" id="5166847">filterParamList</span><span class="op" id="5166862">(</span><span class="ident" id="5166863">fields</span>&nbsp;<span class="op" id="5166870">*</span><span class="ident" id="5166871">ast</span><span class="op" id="5166874">.</span><span class="ident" id="5166875">FieldList</span><span class="op" id="5166884">)</span>&nbsp;<span class="op" id="5166886">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166889">if</span>&nbsp;<span class="ident" id="5166892">fields</span>&nbsp;<span class="op" id="5166899">!=</span>&nbsp;<span class="ident" id="5166902">nil</span>&nbsp;<span class="op" id="5166906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166910">for</span>&nbsp;<span class="ident" id="5166914">_</span><span class="op" id="5166915">,</span>&nbsp;<span class="ident" id="5166917">f</span>&nbsp;<span class="op" id="5166919">:=</span>&nbsp;<span class="keyword" id="5166922">range</span>&nbsp;<span class="ident" id="5166928">fields</span><span class="op" id="5166934">.</span><span class="ident" id="5166935">List</span>&nbsp;<span class="op" id="5166940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166945">r</span><span class="op" id="5166946">.</span><span class="ident" id="5166947">filterType</span><span class="op" id="5166957">(</span><span class="ident" id="5166958">nil</span><span class="op" id="5166961">,</span>&nbsp;<span class="ident" id="5166963">f</span><span class="op" id="5166964">.</span><span class="ident" id="5166965">Type</span><span class="op" id="5166969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166976">}</span><br>
<span class="lineno">110</span><span class="op" id="5166978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5166981">//&nbsp;filterType&nbsp;strips&nbsp;any&nbsp;unexported&nbsp;struct&nbsp;fields&nbsp;or&nbsp;method&nbsp;types&nbsp;from&nbsp;typ</span><br>
<span class="lineno"></span><span class="comment" id="5167056">//&nbsp;in&nbsp;place.&nbsp;If&nbsp;fields&nbsp;(or&nbsp;methods)&nbsp;have&nbsp;been&nbsp;removed,&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="5167129">//&nbsp;struct&nbsp;or&nbsp;interface&nbsp;type&nbsp;has&nbsp;the&nbsp;Incomplete&nbsp;field&nbsp;set&nbsp;to&nbsp;true.</span><br>
<span class="lineno">115</span><span class="comment" id="5167195">//</span><br>
<span class="lineno"></span><span class="keyword" id="5167198">func</span>&nbsp;<span class="op" id="5167203">(</span><span class="ident" id="5167204">r</span>&nbsp;<span class="op" id="5167206">*</span><span class="ident" id="5167207">reader</span><span class="op" id="5167213">)</span>&nbsp;<span class="ident" id="5167215">filterType</span><span class="op" id="5167225">(</span><span class="ident" id="5167226">parent</span>&nbsp;<span class="op" id="5167233">*</span><span class="ident" id="5167234">namedType</span><span class="op" id="5167243">,</span>&nbsp;<span class="ident" id="5167245">typ</span>&nbsp;<span class="ident" id="5167249">ast</span><span class="op" id="5167252">.</span><span class="ident" id="5167253">Expr</span><span class="op" id="5167257">)</span>&nbsp;<span class="op" id="5167259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167262">switch</span>&nbsp;<span class="ident" id="5167269">t</span>&nbsp;<span class="op" id="5167271">:=</span>&nbsp;<span class="ident" id="5167274">typ</span><span class="op" id="5167277">.</span><span class="op" id="5167278">(</span><span class="keyword" id="5167279">type</span><span class="op" id="5167283">)</span>&nbsp;<span class="op" id="5167285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167288">case</span>&nbsp;<span class="op" id="5167293">*</span><span class="ident" id="5167294">ast</span><span class="op" id="5167297">.</span><span class="ident" id="5167298">Ident</span><span class="op" id="5167303">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5167307">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167325">case</span>&nbsp;<span class="op" id="5167330">*</span><span class="ident" id="5167331">ast</span><span class="op" id="5167334">.</span><span class="ident" id="5167335">ParenExpr</span><span class="op" id="5167344">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167348">r</span><span class="op" id="5167349">.</span><span class="ident" id="5167350">filterType</span><span class="op" id="5167360">(</span><span class="ident" id="5167361">nil</span><span class="op" id="5167364">,</span>&nbsp;<span class="ident" id="5167366">t</span><span class="op" id="5167367">.</span><span class="ident" id="5167368">X</span><span class="op" id="5167369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167372">case</span>&nbsp;<span class="op" id="5167377">*</span><span class="ident" id="5167378">ast</span><span class="op" id="5167381">.</span><span class="ident" id="5167382">ArrayType</span><span class="op" id="5167391">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167395">r</span><span class="op" id="5167396">.</span><span class="ident" id="5167397">filterType</span><span class="op" id="5167407">(</span><span class="ident" id="5167408">nil</span><span class="op" id="5167411">,</span>&nbsp;<span class="ident" id="5167413">t</span><span class="op" id="5167414">.</span><span class="ident" id="5167415">Elt</span><span class="op" id="5167418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167421">case</span>&nbsp;<span class="op" id="5167426">*</span><span class="ident" id="5167427">ast</span><span class="op" id="5167430">.</span><span class="ident" id="5167431">StructType</span><span class="op" id="5167441">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167445">if</span>&nbsp;<span class="ident" id="5167448">r</span><span class="op" id="5167449">.</span><span class="ident" id="5167450">filterFieldList</span><span class="op" id="5167465">(</span><span class="ident" id="5167466">parent</span><span class="op" id="5167472">,</span>&nbsp;<span class="ident" id="5167474">t</span><span class="op" id="5167475">.</span><span class="ident" id="5167476">Fields</span><span class="op" id="5167482">,</span>&nbsp;<span class="ident" id="5167484">nil</span><span class="op" id="5167487">)</span>&nbsp;<span class="op" id="5167489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167494">t</span><span class="op" id="5167495">.</span><span class="ident" id="5167496">Incomplete</span>&nbsp;<span class="op" id="5167507">=</span>&nbsp;<span class="builtintype" id="5167509">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5167516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167519">case</span>&nbsp;<span class="op" id="5167524">*</span><span class="ident" id="5167525">ast</span><span class="op" id="5167528">.</span><span class="ident" id="5167529">FuncType</span><span class="op" id="5167537">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167541">r</span><span class="op" id="5167542">.</span><span class="ident" id="5167543">filterParamList</span><span class="op" id="5167558">(</span><span class="ident" id="5167559">t</span><span class="op" id="5167560">.</span><span class="ident" id="5167561">Params</span><span class="op" id="5167567">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167571">r</span><span class="op" id="5167572">.</span><span class="ident" id="5167573">filterParamList</span><span class="op" id="5167588">(</span><span class="ident" id="5167589">t</span><span class="op" id="5167590">.</span><span class="ident" id="5167591">Results</span><span class="op" id="5167598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167601">case</span>&nbsp;<span class="op" id="5167606">*</span><span class="ident" id="5167607">ast</span><span class="op" id="5167610">.</span><span class="ident" id="5167611">InterfaceType</span><span class="op" id="5167624">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167628">if</span>&nbsp;<span class="ident" id="5167631">r</span><span class="op" id="5167632">.</span><span class="ident" id="5167633">filterFieldList</span><span class="op" id="5167648">(</span><span class="ident" id="5167649">parent</span><span class="op" id="5167655">,</span>&nbsp;<span class="ident" id="5167657">t</span><span class="op" id="5167658">.</span><span class="ident" id="5167659">Methods</span><span class="op" id="5167666">,</span>&nbsp;<span class="ident" id="5167668">t</span><span class="op" id="5167669">)</span>&nbsp;<span class="op" id="5167671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167676">t</span><span class="op" id="5167677">.</span><span class="ident" id="5167678">Incomplete</span>&nbsp;<span class="op" id="5167689">=</span>&nbsp;<span class="builtintype" id="5167691">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5167698">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167701">case</span>&nbsp;<span class="op" id="5167706">*</span><span class="ident" id="5167707">ast</span><span class="op" id="5167710">.</span><span class="ident" id="5167711">MapType</span><span class="op" id="5167718">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167722">r</span><span class="op" id="5167723">.</span><span class="ident" id="5167724">filterType</span><span class="op" id="5167734">(</span><span class="ident" id="5167735">nil</span><span class="op" id="5167738">,</span>&nbsp;<span class="ident" id="5167740">t</span><span class="op" id="5167741">.</span><span class="ident" id="5167742">Key</span><span class="op" id="5167745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167749">r</span><span class="op" id="5167750">.</span><span class="ident" id="5167751">filterType</span><span class="op" id="5167761">(</span><span class="ident" id="5167762">nil</span><span class="op" id="5167765">,</span>&nbsp;<span class="ident" id="5167767">t</span><span class="op" id="5167768">.</span><span class="ident" id="5167769">Value</span><span class="op" id="5167774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167777">case</span>&nbsp;<span class="op" id="5167782">*</span><span class="ident" id="5167783">ast</span><span class="op" id="5167786">.</span><span class="ident" id="5167787">ChanType</span><span class="op" id="5167795">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5167799">r</span><span class="op" id="5167800">.</span><span class="ident" id="5167801">filterType</span><span class="op" id="5167811">(</span><span class="ident" id="5167812">nil</span><span class="op" id="5167815">,</span>&nbsp;<span class="ident" id="5167817">t</span><span class="op" id="5167818">.</span><span class="ident" id="5167819">Value</span><span class="op" id="5167824">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5167827">}</span><br>
<span class="lineno"></span><span class="op" id="5167829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5167832">func</span>&nbsp;<span class="op" id="5167837">(</span><span class="ident" id="5167838">r</span>&nbsp;<span class="op" id="5167840">*</span><span class="ident" id="5167841">reader</span><span class="op" id="5167847">)</span>&nbsp;<span class="ident" id="5167849">filterSpec</span><span class="op" id="5167859">(</span><span class="ident" id="5167860">spec</span>&nbsp;<span class="ident" id="5167865">ast</span><span class="op" id="5167868">.</span><span class="ident" id="5167869">Spec</span><span class="op" id="5167873">,</span>&nbsp;<span class="ident" id="5167875">tok</span>&nbsp;<span class="ident" id="5167879">token</span><span class="op" id="5167884">.</span><span class="ident" id="5167885">Token</span><span class="op" id="5167890">)</span>&nbsp;<span class="builtintype" id="5167892">bool</span>&nbsp;<span class="op" id="5167897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167900">switch</span>&nbsp;<span class="ident" id="5167907">s</span>&nbsp;<span class="op" id="5167909">:=</span>&nbsp;<span class="ident" id="5167912">spec</span><span class="op" id="5167916">.</span><span class="op" id="5167917">(</span><span class="keyword" id="5167918">type</span><span class="op" id="5167922">)</span>&nbsp;<span class="op" id="5167924">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167927">case</span>&nbsp;<span class="op" id="5167932">*</span><span class="ident" id="5167933">ast</span><span class="op" id="5167936">.</span><span class="ident" id="5167937">ImportSpec</span><span class="op" id="5167947">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5167951">//&nbsp;always&nbsp;keep&nbsp;imports&nbsp;so&nbsp;we&nbsp;can&nbsp;collect&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5167999">return</span>&nbsp;<span class="builtintype" id="5168006">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168012">case</span>&nbsp;<span class="op" id="5168017">*</span><span class="ident" id="5168018">ast</span><span class="op" id="5168021">.</span><span class="ident" id="5168022">ValueSpec</span><span class="op" id="5168031">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5168035">//&nbsp;special&nbsp;case:&nbsp;consider&nbsp;blank&nbsp;constants&nbsp;as&nbsp;exported</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5168091">//&nbsp;(work-around&nbsp;for&nbsp;issue&nbsp;5397)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168125">s</span><span class="op" id="5168126">.</span><span class="ident" id="5168127">Names</span>&nbsp;<span class="op" id="5168133">=</span>&nbsp;<span class="ident" id="5168135">filterIdentList</span><span class="op" id="5168150">(</span><span class="ident" id="5168151">s</span><span class="op" id="5168152">.</span><span class="ident" id="5168153">Names</span><span class="op" id="5168158">,</span>&nbsp;<span class="ident" id="5168160">tok</span>&nbsp;<span class="op" id="5168164">==</span>&nbsp;<span class="ident" id="5168167">token</span><span class="op" id="5168172">.</span><span class="ident" id="5168173">CONST</span><span class="op" id="5168178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168182">if</span>&nbsp;<span class="builtinfunc" id="5168185">len</span><span class="op" id="5168188">(</span><span class="ident" id="5168189">s</span><span class="op" id="5168190">.</span><span class="ident" id="5168191">Names</span><span class="op" id="5168196">)</span>&nbsp;<span class="op" id="5168198">&gt;</span>&nbsp;<span class="num" id="5168200">0</span>&nbsp;<span class="op" id="5168202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168207">r</span><span class="op" id="5168208">.</span><span class="ident" id="5168209">filterType</span><span class="op" id="5168219">(</span><span class="ident" id="5168220">nil</span><span class="op" id="5168223">,</span>&nbsp;<span class="ident" id="5168225">s</span><span class="op" id="5168226">.</span><span class="ident" id="5168227">Type</span><span class="op" id="5168231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168236">return</span>&nbsp;<span class="builtintype" id="5168243">true</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5168250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168253">case</span>&nbsp;<span class="op" id="5168258">*</span><span class="ident" id="5168259">ast</span><span class="op" id="5168262">.</span><span class="ident" id="5168263">TypeSpec</span><span class="op" id="5168271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168275">if</span>&nbsp;<span class="ident" id="5168278">name</span>&nbsp;<span class="op" id="5168283">:=</span>&nbsp;<span class="ident" id="5168286">s</span><span class="op" id="5168287">.</span><span class="ident" id="5168288">Name</span><span class="op" id="5168292">.</span><span class="ident" id="5168293">Name</span><span class="op" id="5168297">;</span>&nbsp;<span class="ident" id="5168299">ast</span><span class="op" id="5168302">.</span><span class="ident" id="5168303">IsExported</span><span class="op" id="5168313">(</span><span class="ident" id="5168314">name</span><span class="op" id="5168318">)</span>&nbsp;<span class="op" id="5168320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168325">r</span><span class="op" id="5168326">.</span><span class="ident" id="5168327">filterType</span><span class="op" id="5168337">(</span><span class="ident" id="5168338">r</span><span class="op" id="5168339">.</span><span class="ident" id="5168340">lookupType</span><span class="op" id="5168350">(</span><span class="ident" id="5168351">s</span><span class="op" id="5168352">.</span><span class="ident" id="5168353">Name</span><span class="op" id="5168357">.</span><span class="ident" id="5168358">Name</span><span class="op" id="5168362">)</span><span class="op" id="5168363">,</span>&nbsp;<span class="ident" id="5168365">s</span><span class="op" id="5168366">.</span><span class="ident" id="5168367">Type</span><span class="op" id="5168371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168376">return</span>&nbsp;<span class="builtintype" id="5168383">true</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5168390">}</span>&nbsp;<span class="keyword" id="5168392">else</span>&nbsp;<span class="keyword" id="5168397">if</span>&nbsp;<span class="ident" id="5168400">name</span>&nbsp;<span class="op" id="5168405">==</span>&nbsp;<span class="string" id="5168408">&#34;error&#34;</span>&nbsp;<span class="op" id="5168416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5168421">//&nbsp;special&nbsp;case:&nbsp;remember&nbsp;that&nbsp;error&nbsp;is&nbsp;declared&nbsp;locally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168481">r</span><span class="op" id="5168482">.</span><span class="ident" id="5168483">errorDecl</span>&nbsp;<span class="op" id="5168493">=</span>&nbsp;<span class="builtintype" id="5168495">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5168502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5168505">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168508">return</span>&nbsp;<span class="builtintype" id="5168515">false</span><br>
<span class="lineno"></span><span class="op" id="5168521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5168524">func</span>&nbsp;<span class="op" id="5168529">(</span><span class="ident" id="5168530">r</span>&nbsp;<span class="op" id="5168532">*</span><span class="ident" id="5168533">reader</span><span class="op" id="5168539">)</span>&nbsp;<span class="ident" id="5168541">filterSpecList</span><span class="op" id="5168555">(</span><span class="ident" id="5168556">list</span>&nbsp;<span class="op" id="5168561">[</span><span class="op" id="5168562">]</span><span class="ident" id="5168563">ast</span><span class="op" id="5168566">.</span><span class="ident" id="5168567">Spec</span><span class="op" id="5168571">,</span>&nbsp;<span class="ident" id="5168573">tok</span>&nbsp;<span class="ident" id="5168577">token</span><span class="op" id="5168582">.</span><span class="ident" id="5168583">Token</span><span class="op" id="5168588">)</span>&nbsp;<span class="op" id="5168590">[</span><span class="op" id="5168591">]</span><span class="ident" id="5168592">ast</span><span class="op" id="5168595">.</span><span class="ident" id="5168596">Spec</span>&nbsp;<span class="op" id="5168601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168604">j</span>&nbsp;<span class="op" id="5168606">:=</span>&nbsp;<span class="num" id="5168609">0</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168612">for</span>&nbsp;<span class="ident" id="5168616">_</span><span class="op" id="5168617">,</span>&nbsp;<span class="ident" id="5168619">s</span>&nbsp;<span class="op" id="5168621">:=</span>&nbsp;<span class="keyword" id="5168624">range</span>&nbsp;<span class="ident" id="5168630">list</span>&nbsp;<span class="op" id="5168635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168639">if</span>&nbsp;<span class="ident" id="5168642">r</span><span class="op" id="5168643">.</span><span class="ident" id="5168644">filterSpec</span><span class="op" id="5168654">(</span><span class="ident" id="5168655">s</span><span class="op" id="5168656">,</span>&nbsp;<span class="ident" id="5168658">tok</span><span class="op" id="5168661">)</span>&nbsp;<span class="op" id="5168663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168668">list</span><span class="op" id="5168672">[</span><span class="ident" id="5168673">j</span><span class="op" id="5168674">]</span>&nbsp;<span class="op" id="5168676">=</span>&nbsp;<span class="ident" id="5168678">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168683">j</span><span class="op" id="5168684">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5168689">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5168692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168695">return</span>&nbsp;<span class="ident" id="5168702">list</span><span class="op" id="5168706">[</span><span class="num" id="5168707">0</span><span class="op" id="5168708">:</span><span class="ident" id="5168709">j</span><span class="op" id="5168710">]</span><br>
<span class="lineno"></span><span class="op" id="5168712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5168715">func</span>&nbsp;<span class="op" id="5168720">(</span><span class="ident" id="5168721">r</span>&nbsp;<span class="op" id="5168723">*</span><span class="ident" id="5168724">reader</span><span class="op" id="5168730">)</span>&nbsp;<span class="ident" id="5168732">filterDecl</span><span class="op" id="5168742">(</span><span class="ident" id="5168743">decl</span>&nbsp;<span class="ident" id="5168748">ast</span><span class="op" id="5168751">.</span><span class="ident" id="5168752">Decl</span><span class="op" id="5168756">)</span>&nbsp;<span class="builtintype" id="5168758">bool</span>&nbsp;<span class="op" id="5168763">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168766">switch</span>&nbsp;<span class="ident" id="5168773">d</span>&nbsp;<span class="op" id="5168775">:=</span>&nbsp;<span class="ident" id="5168778">decl</span><span class="op" id="5168782">.</span><span class="op" id="5168783">(</span><span class="keyword" id="5168784">type</span><span class="op" id="5168788">)</span>&nbsp;<span class="op" id="5168790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168793">case</span>&nbsp;<span class="op" id="5168798">*</span><span class="ident" id="5168799">ast</span><span class="op" id="5168802">.</span><span class="ident" id="5168803">GenDecl</span><span class="op" id="5168810">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5168814">d</span><span class="op" id="5168815">.</span><span class="ident" id="5168816">Specs</span>&nbsp;<span class="op" id="5168822">=</span>&nbsp;<span class="ident" id="5168824">r</span><span class="op" id="5168825">.</span><span class="ident" id="5168826">filterSpecList</span><span class="op" id="5168840">(</span><span class="ident" id="5168841">d</span><span class="op" id="5168842">.</span><span class="ident" id="5168843">Specs</span><span class="op" id="5168848">,</span>&nbsp;<span class="ident" id="5168850">d</span><span class="op" id="5168851">.</span><span class="ident" id="5168852">Tok</span><span class="op" id="5168855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168859">return</span>&nbsp;<span class="builtinfunc" id="5168866">len</span><span class="op" id="5168869">(</span><span class="ident" id="5168870">d</span><span class="op" id="5168871">.</span><span class="ident" id="5168872">Specs</span><span class="op" id="5168877">)</span>&nbsp;<span class="op" id="5168879">&gt;</span>&nbsp;<span class="num" id="5168881">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5168884">case</span>&nbsp;<span class="op" id="5168889">*</span><span class="ident" id="5168890">ast</span><span class="op" id="5168893">.</span><span class="ident" id="5168894">FuncDecl</span><span class="op" id="5168902">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5168906">//&nbsp;ok&nbsp;to&nbsp;filter&nbsp;these&nbsp;methods&nbsp;early&nbsp;because&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5168956">//&nbsp;conflicting&nbsp;method&nbsp;will&nbsp;be&nbsp;filtered&nbsp;here,&nbsp;too&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5169009">//&nbsp;thus,&nbsp;removing&nbsp;these&nbsp;methods&nbsp;early&nbsp;will&nbsp;not&nbsp;lead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5169063">//&nbsp;to&nbsp;the&nbsp;false&nbsp;removal&nbsp;of&nbsp;possible&nbsp;conflicts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169111">return</span>&nbsp;<span class="ident" id="5169118">ast</span><span class="op" id="5169121">.</span><span class="ident" id="5169122">IsExported</span><span class="op" id="5169132">(</span><span class="ident" id="5169133">d</span><span class="op" id="5169134">.</span><span class="ident" id="5169135">Name</span><span class="op" id="5169139">.</span><span class="ident" id="5169140">Name</span><span class="op" id="5169144">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169150">return</span>&nbsp;<span class="builtintype" id="5169157">false</span><br>
<span class="lineno"></span><span class="op" id="5169163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5169166">//&nbsp;fileExports&nbsp;removes&nbsp;unexported&nbsp;declarations&nbsp;from&nbsp;src&nbsp;in&nbsp;place.</span><br>
<span class="lineno">195</span><span class="comment" id="5169232">//</span><br>
<span class="lineno"></span><span class="keyword" id="5169235">func</span>&nbsp;<span class="op" id="5169240">(</span><span class="ident" id="5169241">r</span>&nbsp;<span class="op" id="5169243">*</span><span class="ident" id="5169244">reader</span><span class="op" id="5169250">)</span>&nbsp;<span class="ident" id="5169252">fileExports</span><span class="op" id="5169263">(</span><span class="ident" id="5169264">src</span>&nbsp;<span class="op" id="5169268">*</span><span class="ident" id="5169269">ast</span><span class="op" id="5169272">.</span><span class="ident" id="5169273">File</span><span class="op" id="5169277">)</span>&nbsp;<span class="op" id="5169279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169282">j</span>&nbsp;<span class="op" id="5169284">:=</span>&nbsp;<span class="num" id="5169287">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169290">for</span>&nbsp;<span class="ident" id="5169294">_</span><span class="op" id="5169295">,</span>&nbsp;<span class="ident" id="5169297">d</span>&nbsp;<span class="op" id="5169299">:=</span>&nbsp;<span class="keyword" id="5169302">range</span>&nbsp;<span class="ident" id="5169308">src</span><span class="op" id="5169311">.</span><span class="ident" id="5169312">Decls</span>&nbsp;<span class="op" id="5169318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5169322">if</span>&nbsp;<span class="ident" id="5169325">r</span><span class="op" id="5169326">.</span><span class="ident" id="5169327">filterDecl</span><span class="op" id="5169337">(</span><span class="ident" id="5169338">d</span><span class="op" id="5169339">)</span>&nbsp;<span class="op" id="5169341">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169346">src</span><span class="op" id="5169349">.</span><span class="ident" id="5169350">Decls</span><span class="op" id="5169355">[</span><span class="ident" id="5169356">j</span><span class="op" id="5169357">]</span>&nbsp;<span class="op" id="5169359">=</span>&nbsp;<span class="ident" id="5169361">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169366">j</span><span class="op" id="5169367">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5169375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5169378">src</span><span class="op" id="5169381">.</span><span class="ident" id="5169382">Decls</span>&nbsp;<span class="op" id="5169388">=</span>&nbsp;<span class="ident" id="5169390">src</span><span class="op" id="5169393">.</span><span class="ident" id="5169394">Decls</span><span class="op" id="5169399">[</span><span class="num" id="5169400">0</span><span class="op" id="5169401">:</span><span class="ident" id="5169402">j</span><span class="op" id="5169403">]</span><br>
<span class="lineno">205</span><span class="op" id="5169405">}</span>
</div>
</body>
</html>
