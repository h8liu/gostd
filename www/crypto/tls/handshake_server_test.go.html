<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7106375">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7106430">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7106484">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7106535">package</span>&nbsp;<span class="ident" id="7106543">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7106548">import</span>&nbsp;<span class="op" id="7106555">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7106558">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7106567">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7106583">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7106602">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7106616">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7106632">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7106648">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7106658">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7106665">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7106671">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7106683">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7106690">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7106696">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7106707">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7106724">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7106735">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7106746">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="7106753">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7106756">//&nbsp;zeroSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;returns&nbsp;an&nbsp;unlimited&nbsp;number&nbsp;of&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="7106834">type</span>&nbsp;<span class="ident" id="7106839">zeroSource</span>&nbsp;<span class="keyword" id="7106850">struct</span><span class="op" id="7106856">{</span><span class="op" id="7106857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7106860">func</span>&nbsp;<span class="op" id="7106865">(</span><span class="ident" id="7106866"><a href="/crypto/tls/handshake_server_test.go.html#7106839">zeroSource</a></span><span class="op" id="7106876">)</span>&nbsp;<span class="ident" id="7106878">Read</span><span class="op" id="7106882">(</span><span class="ident" id="7106883">b</span>&nbsp;<span class="op" id="7106885">[</span><span class="op" id="7106886">]</span><span class="builtintype" id="7106887">byte</span><span class="op" id="7106891">)</span>&nbsp;<span class="op" id="7106893">(</span><span class="ident" id="7106894">n</span>&nbsp;<span class="builtintype" id="7106896">int</span><span class="op" id="7106899">,</span>&nbsp;<span class="ident" id="7106901">err</span>&nbsp;<span class="builtintype" id="7106905">error</span><span class="op" id="7106910">)</span>&nbsp;<span class="op" id="7106912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106915">for</span>&nbsp;<span class="ident" id="7106919">i</span>&nbsp;<span class="op" id="7106921">:=</span>&nbsp;<span class="keyword" id="7106924">range</span>&nbsp;<span class="ident" id="7106930"><a href="/crypto/tls/handshake_server_test.go.html#7106883">b</a></span>&nbsp;<span class="op" id="7106932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7106936"><a href="/crypto/tls/handshake_server_test.go.html#7106883">b</a></span><span class="op" id="7106937">[</span><span class="ident" id="7106938"><a href="/crypto/tls/handshake_server_test.go.html#7106919">i</a></span><span class="op" id="7106939">]</span>&nbsp;<span class="op" id="7106941">=</span>&nbsp;<span class="num" id="7106943">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7106946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7106950">return</span>&nbsp;<span class="builtinfunc" id="7106957">len</span><span class="op" id="7106960">(</span><span class="ident" id="7106961"><a href="/crypto/tls/handshake_server_test.go.html#7106883">b</a></span><span class="op" id="7106962">)</span><span class="op" id="7106963">,</span>&nbsp;<span class="ident" id="7106965">nil</span><br>
<span class="lineno"></span><span class="op" id="7106969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7106972">var</span>&nbsp;<span class="ident" id="7106976">testConfig</span>&nbsp;<span class="op" id="7106987">*</span><span class="ident" id="7106988"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="7106996">func</span>&nbsp;<span class="ident" id="7107001">init</span><span class="op" id="7107005">(</span><span class="op" id="7107006">)</span>&nbsp;<span class="op" id="7107008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107011"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span>&nbsp;<span class="op" id="7107022">=</span>&nbsp;<span class="op" id="7107024">&amp;</span><span class="ident" id="7107025"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="7107031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107035">Time</span><span class="op" id="7107039">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7107055">func</span><span class="op" id="7107059">(</span><span class="op" id="7107060">)</span>&nbsp;<span class="ident" id="7107062"><a href="/crypto/tls/handshake_server_test.go.html#7106746">time</a></span><span class="op" id="7107066">.</span><span class="ident" id="7107067">Time</span>&nbsp;<span class="op" id="7107072">{</span>&nbsp;<span class="keyword" id="7107074">return</span>&nbsp;<span class="ident" id="7107081"><a href="/crypto/tls/handshake_server_test.go.html#7106746">time</a></span><span class="op" id="7107085">.</span><span class="ident" id="7107086">Unix</span><span class="op" id="7107090">(</span><span class="num" id="7107091">0</span><span class="op" id="7107092">,</span>&nbsp;<span class="num" id="7107094">0</span><span class="op" id="7107095">)</span>&nbsp;<span class="op" id="7107097">}</span><span class="op" id="7107098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107102">Rand</span><span class="op" id="7107106">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7107122"><a href="/crypto/tls/handshake_server_test.go.html#7106839">zeroSource</a></span><span class="op" id="7107132">{</span><span class="op" id="7107133">}</span><span class="op" id="7107134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107138">Certificates</span><span class="op" id="7107150">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7107158">make</span><span class="op" id="7107162">(</span><span class="op" id="7107163">[</span><span class="op" id="7107164">]</span><span class="ident" id="7107165"><a href="/crypto/tls/common.go.html#4123683">Certificate</a></span><span class="op" id="7107176">,</span>&nbsp;<span class="num" id="7107178">2</span><span class="op" id="7107179">)</span><span class="op" id="7107180">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107184">InsecureSkipVerify</span><span class="op" id="7107202">:</span>&nbsp;<span class="ident" id="7107204">true</span><span class="op" id="7107208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107212">MinVersion</span><span class="op" id="7107222">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7107232"><a href="/crypto/tls/common.go.html#4108136">VersionSSL30</a></span><span class="op" id="7107244">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107248">MaxVersion</span><span class="op" id="7107258">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7107268"><a href="/crypto/tls/common.go.html#4108205">VersionTLS12</a></span><span class="op" id="7107280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7107283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107286"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><span class="op" id="7107296">.</span><span class="ident" id="7107297">Certificates</span><span class="op" id="7107309">[</span><span class="num" id="7107310">0</span><span class="op" id="7107311">]</span><span class="op" id="7107312">.</span><span class="ident" id="7107313">Certificate</span>&nbsp;<span class="op" id="7107325">=</span>&nbsp;<span class="op" id="7107327">[</span><span class="op" id="7107328">]</span><span class="op" id="7107329">[</span><span class="op" id="7107330">]</span><span class="builtintype" id="7107331">byte</span><span class="op" id="7107335">{</span><span class="ident" id="7107336"><a href="/crypto/tls/handshake_server_test.go.html#7132055">testRSACertificate</a></span><span class="op" id="7107354">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107357"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><span class="op" id="7107367">.</span><span class="ident" id="7107368">Certificates</span><span class="op" id="7107380">[</span><span class="num" id="7107381">0</span><span class="op" id="7107382">]</span><span class="op" id="7107383">.</span><span class="ident" id="7107384">PrivateKey</span>&nbsp;<span class="op" id="7107395">=</span>&nbsp;<span class="ident" id="7107397"><a href="/crypto/tls/handshake_server_test.go.html#7135591">testRSAPrivateKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107416"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><span class="op" id="7107426">.</span><span class="ident" id="7107427">Certificates</span><span class="op" id="7107439">[</span><span class="num" id="7107440">1</span><span class="op" id="7107441">]</span><span class="op" id="7107442">.</span><span class="ident" id="7107443">Certificate</span>&nbsp;<span class="op" id="7107455">=</span>&nbsp;<span class="op" id="7107457">[</span><span class="op" id="7107458">]</span><span class="op" id="7107459">[</span><span class="op" id="7107460">]</span><span class="builtintype" id="7107461">byte</span><span class="op" id="7107465">{</span><span class="ident" id="7107466"><a href="/crypto/tls/handshake_server_test.go.html#7134549">testSNICertificate</a></span><span class="op" id="7107484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107487"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><span class="op" id="7107497">.</span><span class="ident" id="7107498">Certificates</span><span class="op" id="7107510">[</span><span class="num" id="7107511">1</span><span class="op" id="7107512">]</span><span class="op" id="7107513">.</span><span class="ident" id="7107514">PrivateKey</span>&nbsp;<span class="op" id="7107525">=</span>&nbsp;<span class="ident" id="7107527"><a href="/crypto/tls/handshake_server_test.go.html#7135591">testRSAPrivateKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107546"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><span class="op" id="7107556">.</span><span class="ident" id="7107557">BuildNameToCertificate</span><span class="op" id="7107579">(</span><span class="op" id="7107580">)</span><br>
<span class="lineno"></span><span class="op" id="7107582">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="7107585">func</span>&nbsp;<span class="ident" id="7107590">testClientHelloFailure</span><span class="op" id="7107612">(</span><span class="ident" id="7107613">t</span>&nbsp;<span class="op" id="7107615">*</span><span class="ident" id="7107616"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7107623">.</span><span class="ident" id="7107624">T</span><span class="op" id="7107625">,</span>&nbsp;<span class="ident" id="7107627">m</span>&nbsp;<span class="ident" id="7107629"><a href="/crypto/tls/common.go.html#4124572">handshakeMessage</a></span><span class="op" id="7107645">,</span>&nbsp;<span class="ident" id="7107647">expectedSubStr</span>&nbsp;<span class="builtintype" id="7107662">string</span><span class="op" id="7107668">)</span>&nbsp;<span class="op" id="7107670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7107673">//&nbsp;Create&nbsp;in-memory&nbsp;network&nbsp;connection,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7107714">//&nbsp;send&nbsp;message&nbsp;to&nbsp;server.&nbsp;&nbsp;Should&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7107757">//&nbsp;expected&nbsp;error.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107777">c</span><span class="op" id="7107778">,</span>&nbsp;<span class="ident" id="7107780">s</span>&nbsp;<span class="op" id="7107782">:=</span>&nbsp;<span class="ident" id="7107785"><a href="/crypto/tls/handshake_server_test.go.html#7106683">net</a></span><span class="op" id="7107788">.</span><span class="ident" id="7107789">Pipe</span><span class="op" id="7107793">(</span><span class="op" id="7107794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7107797">go</span>&nbsp;<span class="keyword" id="7107800">func</span><span class="op" id="7107804">(</span><span class="op" id="7107805">)</span>&nbsp;<span class="op" id="7107807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107811">cli</span>&nbsp;<span class="op" id="7107815">:=</span>&nbsp;<span class="ident" id="7107818"><a href="/crypto/tls/tls.go.html#4249732">Client</a></span><span class="op" id="7107824">(</span><span class="ident" id="7107825"><a href="/crypto/tls/handshake_server_test.go.html#7107777">c</a></span><span class="op" id="7107826">,</span>&nbsp;<span class="ident" id="7107828"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><span class="op" id="7107838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7107842">if</span>&nbsp;<span class="ident" id="7107845">ch</span><span class="op" id="7107847">,</span>&nbsp;<span class="ident" id="7107849">ok</span>&nbsp;<span class="op" id="7107852">:=</span>&nbsp;<span class="ident" id="7107855"><a href="/crypto/tls/handshake_server_test.go.html#7107627">m</a></span><span class="op" id="7107856">.</span><span class="op" id="7107857">(</span><span class="op" id="7107858">*</span><span class="ident" id="7107859"><a href="/crypto/tls/handshake_messages.go.html#4173962">clientHelloMsg</a></span><span class="op" id="7107873">)</span><span class="op" id="7107874">;</span>&nbsp;<span class="ident" id="7107876"><a href="/crypto/tls/handshake_server_test.go.html#7107849">ok</a></span>&nbsp;<span class="op" id="7107879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107884"><a href="/crypto/tls/handshake_server_test.go.html#7107811">cli</a></span><span class="op" id="7107887">.</span><span class="ident" id="7107888">vers</span>&nbsp;<span class="op" id="7107893">=</span>&nbsp;<span class="ident" id="7107895"><a href="/crypto/tls/handshake_server_test.go.html#7107845">ch</a></span><span class="op" id="7107897">.</span><span class="ident" id="7107898">vers</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7107905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107909"><a href="/crypto/tls/handshake_server_test.go.html#7107811">cli</a></span><span class="op" id="7107912">.</span><span class="ident" id="7107913">writeRecord</span><span class="op" id="7107924">(</span><span class="ident" id="7107925"><a href="/crypto/tls/common.go.html#4108718">recordTypeHandshake</a></span><span class="op" id="7107944">,</span>&nbsp;<span class="ident" id="7107946"><a href="/crypto/tls/handshake_server_test.go.html#7107627">m</a></span><span class="op" id="7107947">.</span><span class="ident" id="7107948">marshal</span><span class="op" id="7107955">(</span><span class="op" id="7107956">)</span><span class="op" id="7107957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107961"><a href="/crypto/tls/handshake_server_test.go.html#7107777">c</a></span><span class="op" id="7107962">.</span><span class="ident" id="7107963">Close</span><span class="op" id="7107968">(</span><span class="op" id="7107969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7107972">}</span><span class="op" id="7107973">(</span><span class="op" id="7107974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7107977">err</span>&nbsp;<span class="op" id="7107981">:=</span>&nbsp;<span class="ident" id="7107984"><a href="/crypto/tls/tls.go.html#4249440">Server</a></span><span class="op" id="7107990">(</span><span class="ident" id="7107991"><a href="/crypto/tls/handshake_server_test.go.html#7107780">s</a></span><span class="op" id="7107992">,</span>&nbsp;<span class="ident" id="7107994"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><span class="op" id="7108004">)</span><span class="op" id="7108005">.</span><span class="ident" id="7108006">Handshake</span><span class="op" id="7108015">(</span><span class="op" id="7108016">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108019"><a href="/crypto/tls/handshake_server_test.go.html#7107780">s</a></span><span class="op" id="7108020">.</span><span class="ident" id="7108021">Close</span><span class="op" id="7108026">(</span><span class="op" id="7108027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108030">if</span>&nbsp;<span class="ident" id="7108033"><a href="/crypto/tls/handshake_server_test.go.html#7107977">err</a></span>&nbsp;<span class="op" id="7108037">==</span>&nbsp;<span class="ident" id="7108040">nil</span>&nbsp;<span class="op" id="7108044">||</span>&nbsp;<span class="op" id="7108047">!</span><span class="ident" id="7108048"><a href="/crypto/tls/handshake_server_test.go.html#7106724">strings</a></span><span class="op" id="7108055">.</span><span class="ident" id="7108056">Contains</span><span class="op" id="7108064">(</span><span class="ident" id="7108065"><a href="/crypto/tls/handshake_server_test.go.html#7107977">err</a></span><span class="op" id="7108068">.</span><span class="ident" id="7108069">Error</span><span class="op" id="7108074">(</span><span class="op" id="7108075">)</span><span class="op" id="7108076">,</span>&nbsp;<span class="ident" id="7108078"><a href="/crypto/tls/handshake_server_test.go.html#7107647">expectedSubStr</a></span><span class="op" id="7108092">)</span>&nbsp;<span class="op" id="7108094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108098"><a href="/crypto/tls/handshake_server_test.go.html#7107613">t</a></span><span class="op" id="7108099">.</span><span class="ident" id="7108100">Errorf</span><span class="op" id="7108106">(</span><span class="string" id="7108107">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected&nbsp;to&nbsp;match&nbsp;substring&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="7108156">,</span>&nbsp;<span class="ident" id="7108158"><a href="/crypto/tls/handshake_server_test.go.html#7107977">err</a></span><span class="op" id="7108161">,</span>&nbsp;<span class="ident" id="7108163"><a href="/crypto/tls/handshake_server_test.go.html#7107647">expectedSubStr</a></span><span class="op" id="7108177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7108180">}</span><br>
<span class="lineno"></span><span class="op" id="7108182">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7108185">func</span>&nbsp;<span class="ident" id="7108190">TestSimpleError</span><span class="op" id="7108205">(</span><span class="ident" id="7108206">t</span>&nbsp;<span class="op" id="7108208">*</span><span class="ident" id="7108209"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7108216">.</span><span class="ident" id="7108217">T</span><span class="op" id="7108218">)</span>&nbsp;<span class="op" id="7108220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108223"><a href="/crypto/tls/handshake_server_test.go.html#7107590">testClientHelloFailure</a></span><span class="op" id="7108245">(</span><span class="ident" id="7108246"><a href="/crypto/tls/handshake_server_test.go.html#7108206">t</a></span><span class="op" id="7108247">,</span>&nbsp;<span class="op" id="7108249">&amp;</span><span class="ident" id="7108250"><a href="/crypto/tls/handshake_messages.go.html#4194114">serverHelloDoneMsg</a></span><span class="op" id="7108268">{</span><span class="op" id="7108269">}</span><span class="op" id="7108270">,</span>&nbsp;<span class="string" id="7108272">&#34;unexpected&nbsp;handshake&nbsp;message&#34;</span><span class="op" id="7108302">)</span><br>
<span class="lineno"></span><span class="op" id="7108304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7108307">var</span>&nbsp;<span class="ident" id="7108311">badProtocolVersions</span>&nbsp;<span class="op" id="7108331">=</span>&nbsp;<span class="op" id="7108333">[</span><span class="op" id="7108334">]</span><span class="builtintype" id="7108335">uint16</span><span class="op" id="7108341">{</span><span class="num" id="7108342">0x0000</span><span class="op" id="7108348">,</span>&nbsp;<span class="num" id="7108350">0x0005</span><span class="op" id="7108356">,</span>&nbsp;<span class="num" id="7108358">0x0100</span><span class="op" id="7108364">,</span>&nbsp;<span class="num" id="7108366">0x0105</span><span class="op" id="7108372">,</span>&nbsp;<span class="num" id="7108374">0x0200</span><span class="op" id="7108380">,</span>&nbsp;<span class="num" id="7108382">0x0205</span><span class="op" id="7108388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7108391">func</span>&nbsp;<span class="ident" id="7108396">TestRejectBadProtocolVersion</span><span class="op" id="7108424">(</span><span class="ident" id="7108425">t</span>&nbsp;<span class="op" id="7108427">*</span><span class="ident" id="7108428"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7108435">.</span><span class="ident" id="7108436">T</span><span class="op" id="7108437">)</span>&nbsp;<span class="op" id="7108439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7108442">for</span>&nbsp;<span class="ident" id="7108446">_</span><span class="op" id="7108447">,</span>&nbsp;<span class="ident" id="7108449">v</span>&nbsp;<span class="op" id="7108451">:=</span>&nbsp;<span class="keyword" id="7108454">range</span>&nbsp;<span class="ident" id="7108460"><a href="/crypto/tls/handshake_server_test.go.html#7108311">badProtocolVersions</a></span>&nbsp;<span class="op" id="7108480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108484"><a href="/crypto/tls/handshake_server_test.go.html#7107590">testClientHelloFailure</a></span><span class="op" id="7108506">(</span><span class="ident" id="7108507"><a href="/crypto/tls/handshake_server_test.go.html#7108425">t</a></span><span class="op" id="7108508">,</span>&nbsp;<span class="op" id="7108510">&amp;</span><span class="ident" id="7108511"><a href="/crypto/tls/handshake_messages.go.html#4173962">clientHelloMsg</a></span><span class="op" id="7108525">{</span><span class="ident" id="7108526">vers</span><span class="op" id="7108530">:</span>&nbsp;<span class="ident" id="7108532"><a href="/crypto/tls/handshake_server_test.go.html#7108449">v</a></span><span class="op" id="7108533">}</span><span class="op" id="7108534">,</span>&nbsp;<span class="string" id="7108536">&#34;unsupported,&nbsp;maximum&nbsp;protocol&nbsp;version&#34;</span><span class="op" id="7108575">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7108578">}</span><br>
<span class="lineno"></span><span class="op" id="7108580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7108583">func</span>&nbsp;<span class="ident" id="7108588">TestNoSuiteOverlap</span><span class="op" id="7108606">(</span><span class="ident" id="7108607">t</span>&nbsp;<span class="op" id="7108609">*</span><span class="ident" id="7108610"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7108617">.</span><span class="ident" id="7108618">T</span><span class="op" id="7108619">)</span>&nbsp;<span class="op" id="7108621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108624">clientHello</span>&nbsp;<span class="op" id="7108636">:=</span>&nbsp;<span class="op" id="7108639">&amp;</span><span class="ident" id="7108640"><a href="/crypto/tls/handshake_messages.go.html#4173962">clientHelloMsg</a></span><span class="op" id="7108654">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108658">vers</span><span class="op" id="7108662">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7108678">0x0301</span><span class="op" id="7108684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108688">cipherSuites</span><span class="op" id="7108700">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7108708">[</span><span class="op" id="7108709">]</span><span class="builtintype" id="7108710">uint16</span><span class="op" id="7108716">{</span><span class="num" id="7108717">0xff00</span><span class="op" id="7108723">}</span><span class="op" id="7108724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108728">compressionMethods</span><span class="op" id="7108746">:</span>&nbsp;<span class="op" id="7108748">[</span><span class="op" id="7108749">]</span><span class="builtintype" id="7108750">uint8</span><span class="op" id="7108755">{</span><span class="num" id="7108756">0</span><span class="op" id="7108757">}</span><span class="op" id="7108758">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7108761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108764"><a href="/crypto/tls/handshake_server_test.go.html#7107590">testClientHelloFailure</a></span><span class="op" id="7108786">(</span><span class="ident" id="7108787"><a href="/crypto/tls/handshake_server_test.go.html#7108607">t</a></span><span class="op" id="7108788">,</span>&nbsp;<span class="ident" id="7108790"><a href="/crypto/tls/handshake_server_test.go.html#7108624">clientHello</a></span><span class="op" id="7108801">,</span>&nbsp;<span class="string" id="7108803">&#34;no&nbsp;cipher&nbsp;suite&nbsp;supported&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;server&#34;</span><span class="op" id="7108856">)</span><br>
<span class="lineno">95</span><span class="op" id="7108858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7108861">func</span>&nbsp;<span class="ident" id="7108866">TestNoCompressionOverlap</span><span class="op" id="7108890">(</span><span class="ident" id="7108891">t</span>&nbsp;<span class="op" id="7108893">*</span><span class="ident" id="7108894"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7108901">.</span><span class="ident" id="7108902">T</span><span class="op" id="7108903">)</span>&nbsp;<span class="op" id="7108905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108908">clientHello</span>&nbsp;<span class="op" id="7108920">:=</span>&nbsp;<span class="op" id="7108923">&amp;</span><span class="ident" id="7108924"><a href="/crypto/tls/handshake_messages.go.html#4173962">clientHelloMsg</a></span><span class="op" id="7108938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108942">vers</span><span class="op" id="7108946">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7108962">0x0301</span><span class="op" id="7108968">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7108972">cipherSuites</span><span class="op" id="7108984">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7108992">[</span><span class="op" id="7108993">]</span><span class="builtintype" id="7108994">uint16</span><span class="op" id="7109000">{</span><span class="ident" id="7109001"><a href="/crypto/tls/cipher_suites.go.html#4106867">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7109025">}</span><span class="op" id="7109026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109030">compressionMethods</span><span class="op" id="7109048">:</span>&nbsp;<span class="op" id="7109050">[</span><span class="op" id="7109051">]</span><span class="builtintype" id="7109052">uint8</span><span class="op" id="7109057">{</span><span class="num" id="7109058">0xff</span><span class="op" id="7109062">}</span><span class="op" id="7109063">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7109066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109069"><a href="/crypto/tls/handshake_server_test.go.html#7107590">testClientHelloFailure</a></span><span class="op" id="7109091">(</span><span class="ident" id="7109092"><a href="/crypto/tls/handshake_server_test.go.html#7108891">t</a></span><span class="op" id="7109093">,</span>&nbsp;<span class="ident" id="7109095"><a href="/crypto/tls/handshake_server_test.go.html#7108908">clientHello</a></span><span class="op" id="7109106">,</span>&nbsp;<span class="string" id="7109108">&#34;client&nbsp;does&nbsp;not&nbsp;support&nbsp;uncompressed&nbsp;connections&#34;</span><span class="op" id="7109158">)</span><br>
<span class="lineno"></span><span class="op" id="7109160">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7109163">func</span>&nbsp;<span class="ident" id="7109168">TestTLS12OnlyCipherSuites</span><span class="op" id="7109193">(</span><span class="ident" id="7109194">t</span>&nbsp;<span class="op" id="7109196">*</span><span class="ident" id="7109197"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7109204">.</span><span class="ident" id="7109205">T</span><span class="op" id="7109206">)</span>&nbsp;<span class="op" id="7109208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7109211">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;Server&nbsp;doesn&#39;t&nbsp;select&nbsp;a&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suite&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7109282">//&nbsp;the&nbsp;client&nbsp;negotiates&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7109317">var</span>&nbsp;<span class="ident" id="7109321">zeros</span>&nbsp;<span class="op" id="7109327">[</span><span class="num" id="7109328">32</span><span class="op" id="7109330">]</span><span class="builtintype" id="7109331">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109338">clientHello</span>&nbsp;<span class="op" id="7109350">:=</span>&nbsp;<span class="op" id="7109353">&amp;</span><span class="ident" id="7109354"><a href="/crypto/tls/handshake_messages.go.html#4173962">clientHelloMsg</a></span><span class="op" id="7109368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109372">vers</span><span class="op" id="7109376">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7109380"><a href="/crypto/tls/common.go.html#4108182">VersionTLS11</a></span><span class="op" id="7109392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109396">random</span><span class="op" id="7109402">:</span>&nbsp;<span class="ident" id="7109404"><a href="/crypto/tls/handshake_server_test.go.html#7109321">zeros</a></span><span class="op" id="7109409">[</span><span class="op" id="7109410">:</span><span class="op" id="7109411">]</span><span class="op" id="7109412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109416">cipherSuites</span><span class="op" id="7109428">:</span>&nbsp;<span class="op" id="7109430">[</span><span class="op" id="7109431">]</span><span class="builtintype" id="7109432">uint16</span><span class="op" id="7109438">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7109443">//&nbsp;The&nbsp;Server,&nbsp;by&nbsp;default,&nbsp;will&nbsp;use&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7109495">//&nbsp;preference&nbsp;order.&nbsp;So&nbsp;the&nbsp;GCM&nbsp;cipher&nbsp;suite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7109543">//&nbsp;will&nbsp;be&nbsp;selected&nbsp;unless&nbsp;it&#39;s&nbsp;excluded&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7109595">//&nbsp;of&nbsp;the&nbsp;version&nbsp;in&nbsp;this&nbsp;ClientHello.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109637"><a href="/crypto/tls/cipher_suites.go.html#4107494">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</a></span><span class="op" id="7109674">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109679"><a href="/crypto/tls/cipher_suites.go.html#4106867">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7109703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7109707">}</span><span class="op" id="7109708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109712">compressionMethods</span><span class="op" id="7109730">:</span>&nbsp;<span class="op" id="7109732">[</span><span class="op" id="7109733">]</span><span class="builtintype" id="7109734">uint8</span><span class="op" id="7109739">{</span><span class="ident" id="7109740"><a href="/crypto/tls/common.go.html#4109324">compressionNone</a></span><span class="op" id="7109755">}</span><span class="op" id="7109756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109760">supportedCurves</span><span class="op" id="7109775">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7109780">[</span><span class="op" id="7109781">]</span><span class="ident" id="7109782"><a href="/crypto/tls/common.go.html#4110037">CurveID</a></span><span class="op" id="7109789">{</span><span class="ident" id="7109790"><a href="/crypto/tls/common.go.html#4110062">CurveP256</a></span><span class="op" id="7109799">,</span>&nbsp;<span class="ident" id="7109801"><a href="/crypto/tls/common.go.html#4110086">CurveP384</a></span><span class="op" id="7109810">,</span>&nbsp;<span class="ident" id="7109812"><a href="/crypto/tls/common.go.html#4110110">CurveP521</a></span><span class="op" id="7109821">}</span><span class="op" id="7109822">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109826">supportedPoints</span><span class="op" id="7109841">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7109846">[</span><span class="op" id="7109847">]</span><span class="builtintype" id="7109848">uint8</span><span class="op" id="7109853">{</span><span class="ident" id="7109854"><a href="/crypto/tls/common.go.html#4110267">pointFormatUncompressed</a></span><span class="op" id="7109877">}</span><span class="op" id="7109878">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7109881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109885">c</span><span class="op" id="7109886">,</span>&nbsp;<span class="ident" id="7109888">s</span>&nbsp;<span class="op" id="7109890">:=</span>&nbsp;<span class="ident" id="7109893"><a href="/crypto/tls/handshake_server_test.go.html#7106683">net</a></span><span class="op" id="7109896">.</span><span class="ident" id="7109897">Pipe</span><span class="op" id="7109901">(</span><span class="op" id="7109902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7109905">var</span>&nbsp;<span class="ident" id="7109909">reply</span>&nbsp;<span class="keyword" id="7109915">interface</span><span class="op" id="7109924">{</span><span class="op" id="7109925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7109928">var</span>&nbsp;<span class="ident" id="7109932">clientErr</span>&nbsp;<span class="builtintype" id="7109942">error</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7109949">go</span>&nbsp;<span class="keyword" id="7109952">func</span><span class="op" id="7109956">(</span><span class="op" id="7109957">)</span>&nbsp;<span class="op" id="7109959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109963">cli</span>&nbsp;<span class="op" id="7109967">:=</span>&nbsp;<span class="ident" id="7109970"><a href="/crypto/tls/tls.go.html#4249732">Client</a></span><span class="op" id="7109976">(</span><span class="ident" id="7109977"><a href="/crypto/tls/handshake_server_test.go.html#7109885">c</a></span><span class="op" id="7109978">,</span>&nbsp;<span class="ident" id="7109980"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><span class="op" id="7109990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7109994"><a href="/crypto/tls/handshake_server_test.go.html#7109963">cli</a></span><span class="op" id="7109997">.</span><span class="ident" id="7109998">vers</span>&nbsp;<span class="op" id="7110003">=</span>&nbsp;<span class="ident" id="7110005"><a href="/crypto/tls/handshake_server_test.go.html#7109338">clientHello</a></span><span class="op" id="7110016">.</span><span class="ident" id="7110017">vers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110024"><a href="/crypto/tls/handshake_server_test.go.html#7109963">cli</a></span><span class="op" id="7110027">.</span><span class="ident" id="7110028">writeRecord</span><span class="op" id="7110039">(</span><span class="ident" id="7110040"><a href="/crypto/tls/common.go.html#4108718">recordTypeHandshake</a></span><span class="op" id="7110059">,</span>&nbsp;<span class="ident" id="7110061"><a href="/crypto/tls/handshake_server_test.go.html#7109338">clientHello</a></span><span class="op" id="7110072">.</span><span class="ident" id="7110073">marshal</span><span class="op" id="7110080">(</span><span class="op" id="7110081">)</span><span class="op" id="7110082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110086"><a href="/crypto/tls/handshake_server_test.go.html#7109909">reply</a></span><span class="op" id="7110091">,</span>&nbsp;<span class="ident" id="7110093"><a href="/crypto/tls/handshake_server_test.go.html#7109932">clientErr</a></span>&nbsp;<span class="op" id="7110103">=</span>&nbsp;<span class="ident" id="7110105"><a href="/crypto/tls/handshake_server_test.go.html#7109963">cli</a></span><span class="op" id="7110108">.</span><span class="ident" id="7110109">readHandshake</span><span class="op" id="7110122">(</span><span class="op" id="7110123">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110127"><a href="/crypto/tls/handshake_server_test.go.html#7109885">c</a></span><span class="op" id="7110128">.</span><span class="ident" id="7110129">Close</span><span class="op" id="7110134">(</span><span class="op" id="7110135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110138">}</span><span class="op" id="7110139">(</span><span class="op" id="7110140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110143">config</span>&nbsp;<span class="op" id="7110150">:=</span>&nbsp;<span class="op" id="7110153">*</span><span class="ident" id="7110154"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110166"><a href="/crypto/tls/handshake_server_test.go.html#7110143">config</a></span><span class="op" id="7110172">.</span><span class="ident" id="7110173">CipherSuites</span>&nbsp;<span class="op" id="7110186">=</span>&nbsp;<span class="ident" id="7110188"><a href="/crypto/tls/handshake_server_test.go.html#7109338">clientHello</a></span><span class="op" id="7110199">.</span><span class="ident" id="7110200">cipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110214"><a href="/crypto/tls/tls.go.html#4249440">Server</a></span><span class="op" id="7110220">(</span><span class="ident" id="7110221"><a href="/crypto/tls/handshake_server_test.go.html#7109888">s</a></span><span class="op" id="7110222">,</span>&nbsp;<span class="op" id="7110224">&amp;</span><span class="ident" id="7110225"><a href="/crypto/tls/handshake_server_test.go.html#7110143">config</a></span><span class="op" id="7110231">)</span><span class="op" id="7110232">.</span><span class="ident" id="7110233">Handshake</span><span class="op" id="7110242">(</span><span class="op" id="7110243">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110246"><a href="/crypto/tls/handshake_server_test.go.html#7109888">s</a></span><span class="op" id="7110247">.</span><span class="ident" id="7110248">Close</span><span class="op" id="7110253">(</span><span class="op" id="7110254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110257">if</span>&nbsp;<span class="ident" id="7110260"><a href="/crypto/tls/handshake_server_test.go.html#7109932">clientErr</a></span>&nbsp;<span class="op" id="7110270">!=</span>&nbsp;<span class="ident" id="7110273">nil</span>&nbsp;<span class="op" id="7110277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110281"><a href="/crypto/tls/handshake_server_test.go.html#7109194">t</a></span><span class="op" id="7110282">.</span><span class="ident" id="7110283">Fatal</span><span class="op" id="7110288">(</span><span class="ident" id="7110289"><a href="/crypto/tls/handshake_server_test.go.html#7109932">clientErr</a></span><span class="op" id="7110298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110304">serverHello</span><span class="op" id="7110315">,</span>&nbsp;<span class="ident" id="7110317">ok</span>&nbsp;<span class="op" id="7110320">:=</span>&nbsp;<span class="ident" id="7110323"><a href="/crypto/tls/handshake_server_test.go.html#7109909">reply</a></span><span class="op" id="7110328">.</span><span class="op" id="7110329">(</span><span class="op" id="7110330">*</span><span class="ident" id="7110331"><a href="/crypto/tls/handshake_messages.go.html#4185078">serverHelloMsg</a></span><span class="op" id="7110345">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110348">if</span>&nbsp;<span class="op" id="7110351">!</span><span class="ident" id="7110352"><a href="/crypto/tls/handshake_server_test.go.html#7110317">ok</a></span>&nbsp;<span class="op" id="7110355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110359"><a href="/crypto/tls/handshake_server_test.go.html#7109194">t</a></span><span class="op" id="7110360">.</span><span class="ident" id="7110361">Fatalf</span><span class="op" id="7110367">(</span><span class="string" id="7110368">&#34;didn&#39;t&nbsp;get&nbsp;ServerHello&nbsp;message&nbsp;in&nbsp;reply.&nbsp;Got&nbsp;%v\n&#34;</span><span class="op" id="7110419">,</span>&nbsp;<span class="ident" id="7110421"><a href="/crypto/tls/handshake_server_test.go.html#7109909">reply</a></span><span class="op" id="7110426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110432">if</span>&nbsp;<span class="ident" id="7110435">s</span>&nbsp;<span class="op" id="7110437">:=</span>&nbsp;<span class="ident" id="7110440"><a href="/crypto/tls/handshake_server_test.go.html#7110304">serverHello</a></span><span class="op" id="7110451">.</span><span class="ident" id="7110452">cipherSuite</span><span class="op" id="7110463">;</span>&nbsp;<span class="ident" id="7110465"><a href="/crypto/tls/handshake_server_test.go.html#7110435">s</a></span>&nbsp;<span class="op" id="7110467">!=</span>&nbsp;<span class="ident" id="7110470"><a href="/crypto/tls/cipher_suites.go.html#4106867">TLS_RSA_WITH_RC4_128_SHA</a></span>&nbsp;<span class="op" id="7110495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110499"><a href="/crypto/tls/handshake_server_test.go.html#7109194">t</a></span><span class="op" id="7110500">.</span><span class="ident" id="7110501">Fatalf</span><span class="op" id="7110507">(</span><span class="string" id="7110508">&#34;bad&nbsp;cipher&nbsp;suite&nbsp;from&nbsp;server:&nbsp;%x&#34;</span><span class="op" id="7110542">,</span>&nbsp;<span class="ident" id="7110544"><a href="/crypto/tls/handshake_server_test.go.html#7110435">s</a></span><span class="op" id="7110545">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110548">}</span><br>
<span class="lineno"></span><span class="op" id="7110550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7110553">func</span>&nbsp;<span class="ident" id="7110558">TestAlertForwarding</span><span class="op" id="7110577">(</span><span class="ident" id="7110578">t</span>&nbsp;<span class="op" id="7110580">*</span><span class="ident" id="7110581"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7110588">.</span><span class="ident" id="7110589">T</span><span class="op" id="7110590">)</span>&nbsp;<span class="op" id="7110592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110595">c</span><span class="op" id="7110596">,</span>&nbsp;<span class="ident" id="7110598">s</span>&nbsp;<span class="op" id="7110600">:=</span>&nbsp;<span class="ident" id="7110603"><a href="/crypto/tls/handshake_server_test.go.html#7106683">net</a></span><span class="op" id="7110606">.</span><span class="ident" id="7110607">Pipe</span><span class="op" id="7110611">(</span><span class="op" id="7110612">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110615">go</span>&nbsp;<span class="keyword" id="7110618">func</span><span class="op" id="7110622">(</span><span class="op" id="7110623">)</span>&nbsp;<span class="op" id="7110625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110629"><a href="/crypto/tls/tls.go.html#4249732">Client</a></span><span class="op" id="7110635">(</span><span class="ident" id="7110636"><a href="/crypto/tls/handshake_server_test.go.html#7110595">c</a></span><span class="op" id="7110637">,</span>&nbsp;<span class="ident" id="7110639"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><span class="op" id="7110649">)</span><span class="op" id="7110650">.</span><span class="ident" id="7110651">sendAlert</span><span class="op" id="7110660">(</span><span class="ident" id="7110661"><a href="/crypto/tls/alert.go.html#4096472">alertUnknownCA</a></span><span class="op" id="7110675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110679"><a href="/crypto/tls/handshake_server_test.go.html#7110595">c</a></span><span class="op" id="7110680">.</span><span class="ident" id="7110681">Close</span><span class="op" id="7110686">(</span><span class="op" id="7110687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110690">}</span><span class="op" id="7110691">(</span><span class="op" id="7110692">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110696">err</span>&nbsp;<span class="op" id="7110700">:=</span>&nbsp;<span class="ident" id="7110703"><a href="/crypto/tls/tls.go.html#4249440">Server</a></span><span class="op" id="7110709">(</span><span class="ident" id="7110710"><a href="/crypto/tls/handshake_server_test.go.html#7110598">s</a></span><span class="op" id="7110711">,</span>&nbsp;<span class="ident" id="7110713"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><span class="op" id="7110723">)</span><span class="op" id="7110724">.</span><span class="ident" id="7110725">Handshake</span><span class="op" id="7110734">(</span><span class="op" id="7110735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110738"><a href="/crypto/tls/handshake_server_test.go.html#7110598">s</a></span><span class="op" id="7110739">.</span><span class="ident" id="7110740">Close</span><span class="op" id="7110745">(</span><span class="op" id="7110746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110749">if</span>&nbsp;<span class="ident" id="7110752">e</span><span class="op" id="7110753">,</span>&nbsp;<span class="ident" id="7110755">ok</span>&nbsp;<span class="op" id="7110758">:=</span>&nbsp;<span class="ident" id="7110761"><a href="/crypto/tls/handshake_server_test.go.html#7110696">err</a></span><span class="op" id="7110764">.</span><span class="op" id="7110765">(</span><span class="op" id="7110766">*</span><span class="ident" id="7110767"><a href="/crypto/tls/handshake_server_test.go.html#7106683">net</a></span><span class="op" id="7110770">.</span><span class="ident" id="7110771">OpError</span><span class="op" id="7110778">)</span><span class="op" id="7110779">;</span>&nbsp;<span class="op" id="7110781">!</span><span class="ident" id="7110782"><a href="/crypto/tls/handshake_server_test.go.html#7110755">ok</a></span>&nbsp;<span class="op" id="7110785">||</span>&nbsp;<span class="ident" id="7110788"><a href="/crypto/tls/handshake_server_test.go.html#7110752">e</a></span><span class="op" id="7110789">.</span><span class="ident" id="7110790">Err</span>&nbsp;<span class="op" id="7110794">!=</span>&nbsp;<span class="builtintype" id="7110797">error</span><span class="op" id="7110802">(</span><span class="ident" id="7110803"><a href="/crypto/tls/alert.go.html#4096472">alertUnknownCA</a></span><span class="op" id="7110817">)</span>&nbsp;<span class="op" id="7110819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110823"><a href="/crypto/tls/handshake_server_test.go.html#7110578">t</a></span><span class="op" id="7110824">.</span><span class="ident" id="7110825">Errorf</span><span class="op" id="7110831">(</span><span class="string" id="7110832">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="7110861">,</span>&nbsp;<span class="ident" id="7110863"><a href="/crypto/tls/handshake_server_test.go.html#7110696">err</a></span><span class="op" id="7110866">,</span>&nbsp;<span class="builtintype" id="7110868">error</span><span class="op" id="7110873">(</span><span class="ident" id="7110874"><a href="/crypto/tls/alert.go.html#4096472">alertUnknownCA</a></span><span class="op" id="7110888">)</span><span class="op" id="7110889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7110892">}</span><br>
<span class="lineno">165</span><span class="op" id="7110894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7110897">func</span>&nbsp;<span class="ident" id="7110902">TestClose</span><span class="op" id="7110911">(</span><span class="ident" id="7110912">t</span>&nbsp;<span class="op" id="7110914">*</span><span class="ident" id="7110915"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7110922">.</span><span class="ident" id="7110923">T</span><span class="op" id="7110924">)</span>&nbsp;<span class="op" id="7110926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110929">c</span><span class="op" id="7110930">,</span>&nbsp;<span class="ident" id="7110932">s</span>&nbsp;<span class="op" id="7110934">:=</span>&nbsp;<span class="ident" id="7110937"><a href="/crypto/tls/handshake_server_test.go.html#7106683">net</a></span><span class="op" id="7110940">.</span><span class="ident" id="7110941">Pipe</span><span class="op" id="7110945">(</span><span class="op" id="7110946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7110949">go</span>&nbsp;<span class="ident" id="7110952"><a href="/crypto/tls/handshake_server_test.go.html#7110929">c</a></span><span class="op" id="7110953">.</span><span class="ident" id="7110954">Close</span><span class="op" id="7110959">(</span><span class="op" id="7110960">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7110964">err</span>&nbsp;<span class="op" id="7110968">:=</span>&nbsp;<span class="ident" id="7110971"><a href="/crypto/tls/tls.go.html#4249440">Server</a></span><span class="op" id="7110977">(</span><span class="ident" id="7110978"><a href="/crypto/tls/handshake_server_test.go.html#7110932">s</a></span><span class="op" id="7110979">,</span>&nbsp;<span class="ident" id="7110981"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><span class="op" id="7110991">)</span><span class="op" id="7110992">.</span><span class="ident" id="7110993">Handshake</span><span class="op" id="7111002">(</span><span class="op" id="7111003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111006"><a href="/crypto/tls/handshake_server_test.go.html#7110932">s</a></span><span class="op" id="7111007">.</span><span class="ident" id="7111008">Close</span><span class="op" id="7111013">(</span><span class="op" id="7111014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111017">if</span>&nbsp;<span class="ident" id="7111020"><a href="/crypto/tls/handshake_server_test.go.html#7110964">err</a></span>&nbsp;<span class="op" id="7111024">!=</span>&nbsp;<span class="ident" id="7111027"><a href="/crypto/tls/handshake_server_test.go.html#7106665">io</a></span><span class="op" id="7111029">.</span><span class="ident" id="7111030">EOF</span>&nbsp;<span class="op" id="7111034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111038"><a href="/crypto/tls/handshake_server_test.go.html#7110912">t</a></span><span class="op" id="7111039">.</span><span class="ident" id="7111040">Errorf</span><span class="op" id="7111046">(</span><span class="string" id="7111047">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="7111076">,</span>&nbsp;<span class="ident" id="7111078"><a href="/crypto/tls/handshake_server_test.go.html#7110964">err</a></span><span class="op" id="7111081">,</span>&nbsp;<span class="ident" id="7111083"><a href="/crypto/tls/handshake_server_test.go.html#7106665">io</a></span><span class="op" id="7111085">.</span><span class="ident" id="7111086">EOF</span><span class="op" id="7111089">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7111092">}</span><br>
<span class="lineno"></span><span class="op" id="7111094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7111097">func</span>&nbsp;<span class="ident" id="7111102">testHandshake</span><span class="op" id="7111115">(</span><span class="ident" id="7111116">clientConfig</span><span class="op" id="7111128">,</span>&nbsp;<span class="ident" id="7111130">serverConfig</span>&nbsp;<span class="op" id="7111143">*</span><span class="ident" id="7111144"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="7111150">)</span>&nbsp;<span class="op" id="7111152">(</span><span class="ident" id="7111153">state</span>&nbsp;<span class="ident" id="7111159"><a href="/crypto/tls/common.go.html#4112190">ConnectionState</a></span><span class="op" id="7111174">,</span>&nbsp;<span class="ident" id="7111176">err</span>&nbsp;<span class="builtintype" id="7111180">error</span><span class="op" id="7111185">)</span>&nbsp;<span class="op" id="7111187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111190">c</span><span class="op" id="7111191">,</span>&nbsp;<span class="ident" id="7111193">s</span>&nbsp;<span class="op" id="7111195">:=</span>&nbsp;<span class="ident" id="7111198"><a href="/crypto/tls/handshake_server_test.go.html#7106683">net</a></span><span class="op" id="7111201">.</span><span class="ident" id="7111202">Pipe</span><span class="op" id="7111206">(</span><span class="op" id="7111207">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111210">done</span>&nbsp;<span class="op" id="7111215">:=</span>&nbsp;<span class="builtinfunc" id="7111218">make</span><span class="op" id="7111222">(</span><span class="keyword" id="7111223">chan</span>&nbsp;<span class="builtintype" id="7111228">bool</span><span class="op" id="7111232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111235">go</span>&nbsp;<span class="keyword" id="7111238">func</span><span class="op" id="7111242">(</span><span class="op" id="7111243">)</span>&nbsp;<span class="op" id="7111245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111249">cli</span>&nbsp;<span class="op" id="7111253">:=</span>&nbsp;<span class="ident" id="7111256"><a href="/crypto/tls/tls.go.html#4249732">Client</a></span><span class="op" id="7111262">(</span><span class="ident" id="7111263"><a href="/crypto/tls/handshake_server_test.go.html#7111190">c</a></span><span class="op" id="7111264">,</span>&nbsp;<span class="ident" id="7111266"><a href="/crypto/tls/handshake_server_test.go.html#7111116">clientConfig</a></span><span class="op" id="7111278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111282"><a href="/crypto/tls/handshake_server_test.go.html#7111249">cli</a></span><span class="op" id="7111285">.</span><span class="ident" id="7111286">Handshake</span><span class="op" id="7111295">(</span><span class="op" id="7111296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111300"><a href="/crypto/tls/handshake_server_test.go.html#7111190">c</a></span><span class="op" id="7111301">.</span><span class="ident" id="7111302">Close</span><span class="op" id="7111307">(</span><span class="op" id="7111308">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111312"><a href="/crypto/tls/handshake_server_test.go.html#7111210">done</a></span>&nbsp;<span class="op" id="7111317">&lt;-</span>&nbsp;<span class="ident" id="7111320">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7111326">}</span><span class="op" id="7111327">(</span><span class="op" id="7111328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111331">server</span>&nbsp;<span class="op" id="7111338">:=</span>&nbsp;<span class="ident" id="7111341"><a href="/crypto/tls/tls.go.html#4249440">Server</a></span><span class="op" id="7111347">(</span><span class="ident" id="7111348"><a href="/crypto/tls/handshake_server_test.go.html#7111193">s</a></span><span class="op" id="7111349">,</span>&nbsp;<span class="ident" id="7111351"><a href="/crypto/tls/handshake_server_test.go.html#7111130">serverConfig</a></span><span class="op" id="7111363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111366"><a href="/crypto/tls/handshake_server_test.go.html#7111176">err</a></span>&nbsp;<span class="op" id="7111370">=</span>&nbsp;<span class="ident" id="7111372"><a href="/crypto/tls/handshake_server_test.go.html#7111331">server</a></span><span class="op" id="7111378">.</span><span class="ident" id="7111379">Handshake</span><span class="op" id="7111388">(</span><span class="op" id="7111389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111392">if</span>&nbsp;<span class="ident" id="7111395"><a href="/crypto/tls/handshake_server_test.go.html#7111176">err</a></span>&nbsp;<span class="op" id="7111399">==</span>&nbsp;<span class="ident" id="7111402">nil</span>&nbsp;<span class="op" id="7111406">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111410"><a href="/crypto/tls/handshake_server_test.go.html#7111153">state</a></span>&nbsp;<span class="op" id="7111416">=</span>&nbsp;<span class="ident" id="7111418"><a href="/crypto/tls/handshake_server_test.go.html#7111331">server</a></span><span class="op" id="7111424">.</span><span class="ident" id="7111425">ConnectionState</span><span class="op" id="7111440">(</span><span class="op" id="7111441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7111444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111447"><a href="/crypto/tls/handshake_server_test.go.html#7111193">s</a></span><span class="op" id="7111448">.</span><span class="ident" id="7111449">Close</span><span class="op" id="7111454">(</span><span class="op" id="7111455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7111458">&lt;-</span><span class="ident" id="7111460"><a href="/crypto/tls/handshake_server_test.go.html#7111210">done</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111466">return</span><br>
<span class="lineno">195</span><span class="op" id="7111473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7111476">func</span>&nbsp;<span class="ident" id="7111481">TestVersion</span><span class="op" id="7111492">(</span><span class="ident" id="7111493">t</span>&nbsp;<span class="op" id="7111495">*</span><span class="ident" id="7111496"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7111503">.</span><span class="ident" id="7111504">T</span><span class="op" id="7111505">)</span>&nbsp;<span class="op" id="7111507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111510">serverConfig</span>&nbsp;<span class="op" id="7111523">:=</span>&nbsp;<span class="op" id="7111526">&amp;</span><span class="ident" id="7111527"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="7111533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111537">Certificates</span><span class="op" id="7111549">:</span>&nbsp;<span class="ident" id="7111551"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><span class="op" id="7111561">.</span><span class="ident" id="7111562">Certificates</span><span class="op" id="7111574">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111578">MaxVersion</span><span class="op" id="7111588">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7111592"><a href="/crypto/tls/common.go.html#4108182">VersionTLS11</a></span><span class="op" id="7111604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7111607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111610">clientConfig</span>&nbsp;<span class="op" id="7111623">:=</span>&nbsp;<span class="op" id="7111626">&amp;</span><span class="ident" id="7111627"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="7111633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111637">InsecureSkipVerify</span><span class="op" id="7111655">:</span>&nbsp;<span class="ident" id="7111657">true</span><span class="op" id="7111661">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7111664">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111667">state</span><span class="op" id="7111672">,</span>&nbsp;<span class="ident" id="7111674">err</span>&nbsp;<span class="op" id="7111678">:=</span>&nbsp;<span class="ident" id="7111681"><a href="/crypto/tls/handshake_server_test.go.html#7111102">testHandshake</a></span><span class="op" id="7111694">(</span><span class="ident" id="7111695"><a href="/crypto/tls/handshake_server_test.go.html#7111610">clientConfig</a></span><span class="op" id="7111707">,</span>&nbsp;<span class="ident" id="7111709"><a href="/crypto/tls/handshake_server_test.go.html#7111510">serverConfig</a></span><span class="op" id="7111721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111724">if</span>&nbsp;<span class="ident" id="7111727"><a href="/crypto/tls/handshake_server_test.go.html#7111674">err</a></span>&nbsp;<span class="op" id="7111731">!=</span>&nbsp;<span class="ident" id="7111734">nil</span>&nbsp;<span class="op" id="7111738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111742"><a href="/crypto/tls/handshake_server_test.go.html#7111493">t</a></span><span class="op" id="7111743">.</span><span class="ident" id="7111744">Fatalf</span><span class="op" id="7111750">(</span><span class="string" id="7111751">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7111773">,</span>&nbsp;<span class="ident" id="7111775"><a href="/crypto/tls/handshake_server_test.go.html#7111674">err</a></span><span class="op" id="7111778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7111781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7111784">if</span>&nbsp;<span class="ident" id="7111787"><a href="/crypto/tls/handshake_server_test.go.html#7111667">state</a></span><span class="op" id="7111792">.</span><span class="ident" id="7111793">Version</span>&nbsp;<span class="op" id="7111801">!=</span>&nbsp;<span class="ident" id="7111804"><a href="/crypto/tls/common.go.html#4108182">VersionTLS11</a></span>&nbsp;<span class="op" id="7111817">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111821"><a href="/crypto/tls/handshake_server_test.go.html#7111493">t</a></span><span class="op" id="7111822">.</span><span class="ident" id="7111823">Fatalf</span><span class="op" id="7111829">(</span><span class="string" id="7111830">&#34;Incorrect&nbsp;version&nbsp;%x,&nbsp;should&nbsp;be&nbsp;%x&#34;</span><span class="op" id="7111866">,</span>&nbsp;<span class="ident" id="7111868"><a href="/crypto/tls/handshake_server_test.go.html#7111667">state</a></span><span class="op" id="7111873">.</span><span class="ident" id="7111874">Version</span><span class="op" id="7111881">,</span>&nbsp;<span class="ident" id="7111883"><a href="/crypto/tls/common.go.html#4108182">VersionTLS11</a></span><span class="op" id="7111895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7111898">}</span><br>
<span class="lineno"></span><span class="op" id="7111900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7111903">func</span>&nbsp;<span class="ident" id="7111908">TestCipherSuitePreference</span><span class="op" id="7111933">(</span><span class="ident" id="7111934">t</span>&nbsp;<span class="op" id="7111936">*</span><span class="ident" id="7111937"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7111944">.</span><span class="ident" id="7111945">T</span><span class="op" id="7111946">)</span>&nbsp;<span class="op" id="7111948">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111951">serverConfig</span>&nbsp;<span class="op" id="7111964">:=</span>&nbsp;<span class="op" id="7111967">&amp;</span><span class="ident" id="7111968"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="7111974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7111978">CipherSuites</span><span class="op" id="7111990">:</span>&nbsp;<span class="op" id="7111992">[</span><span class="op" id="7111993">]</span><span class="builtintype" id="7111994">uint16</span><span class="op" id="7112000">{</span><span class="ident" id="7112001"><a href="/crypto/tls/cipher_suites.go.html#4106867">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7112025">,</span>&nbsp;<span class="ident" id="7112027"><a href="/crypto/tls/cipher_suites.go.html#4106981">TLS_RSA_WITH_AES_128_CBC_SHA</a></span><span class="op" id="7112055">,</span>&nbsp;<span class="ident" id="7112057"><a href="/crypto/tls/cipher_suites.go.html#4107266">TLS_ECDHE_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7112087">}</span><span class="op" id="7112088">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112092">Certificates</span><span class="op" id="7112104">:</span>&nbsp;<span class="ident" id="7112106"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><span class="op" id="7112116">.</span><span class="ident" id="7112117">Certificates</span><span class="op" id="7112129">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112133">MaxVersion</span><span class="op" id="7112143">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7112147"><a href="/crypto/tls/common.go.html#4108182">VersionTLS11</a></span><span class="op" id="7112159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112162">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112165">clientConfig</span>&nbsp;<span class="op" id="7112178">:=</span>&nbsp;<span class="op" id="7112181">&amp;</span><span class="ident" id="7112182"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><span class="op" id="7112188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112192">CipherSuites</span><span class="op" id="7112204">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7112212">[</span><span class="op" id="7112213">]</span><span class="builtintype" id="7112214">uint16</span><span class="op" id="7112220">{</span><span class="ident" id="7112221"><a href="/crypto/tls/cipher_suites.go.html#4106981">TLS_RSA_WITH_AES_128_CBC_SHA</a></span><span class="op" id="7112249">,</span>&nbsp;<span class="ident" id="7112251"><a href="/crypto/tls/cipher_suites.go.html#4106867">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="7112275">}</span><span class="op" id="7112276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112280">InsecureSkipVerify</span><span class="op" id="7112298">:</span>&nbsp;<span class="ident" id="7112300">true</span><span class="op" id="7112304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112310">state</span><span class="op" id="7112315">,</span>&nbsp;<span class="ident" id="7112317">err</span>&nbsp;<span class="op" id="7112321">:=</span>&nbsp;<span class="ident" id="7112324"><a href="/crypto/tls/handshake_server_test.go.html#7111102">testHandshake</a></span><span class="op" id="7112337">(</span><span class="ident" id="7112338"><a href="/crypto/tls/handshake_server_test.go.html#7112165">clientConfig</a></span><span class="op" id="7112350">,</span>&nbsp;<span class="ident" id="7112352"><a href="/crypto/tls/handshake_server_test.go.html#7111951">serverConfig</a></span><span class="op" id="7112364">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112367">if</span>&nbsp;<span class="ident" id="7112370"><a href="/crypto/tls/handshake_server_test.go.html#7112317">err</a></span>&nbsp;<span class="op" id="7112374">!=</span>&nbsp;<span class="ident" id="7112377">nil</span>&nbsp;<span class="op" id="7112381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112385"><a href="/crypto/tls/handshake_server_test.go.html#7111934">t</a></span><span class="op" id="7112386">.</span><span class="ident" id="7112387">Fatalf</span><span class="op" id="7112393">(</span><span class="string" id="7112394">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7112416">,</span>&nbsp;<span class="ident" id="7112418"><a href="/crypto/tls/handshake_server_test.go.html#7112317">err</a></span><span class="op" id="7112421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112427">if</span>&nbsp;<span class="ident" id="7112430"><a href="/crypto/tls/handshake_server_test.go.html#7112310">state</a></span><span class="op" id="7112435">.</span><span class="ident" id="7112436">CipherSuite</span>&nbsp;<span class="op" id="7112448">!=</span>&nbsp;<span class="ident" id="7112451"><a href="/crypto/tls/cipher_suites.go.html#4106981">TLS_RSA_WITH_AES_128_CBC_SHA</a></span>&nbsp;<span class="op" id="7112480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7112484">//&nbsp;By&nbsp;default&nbsp;the&nbsp;server&nbsp;should&nbsp;use&nbsp;the&nbsp;client&#39;s&nbsp;preference.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112547"><a href="/crypto/tls/handshake_server_test.go.html#7111934">t</a></span><span class="op" id="7112548">.</span><span class="ident" id="7112549">Fatalf</span><span class="op" id="7112555">(</span><span class="string" id="7112556">&#34;Client&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="7112598">,</span>&nbsp;<span class="ident" id="7112600"><a href="/crypto/tls/handshake_server_test.go.html#7112310">state</a></span><span class="op" id="7112605">.</span><span class="ident" id="7112606">CipherSuite</span><span class="op" id="7112617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112624"><a href="/crypto/tls/handshake_server_test.go.html#7111951">serverConfig</a></span><span class="op" id="7112636">.</span><span class="ident" id="7112637">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7112662">=</span>&nbsp;<span class="ident" id="7112664">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112670"><a href="/crypto/tls/handshake_server_test.go.html#7112310">state</a></span><span class="op" id="7112675">,</span>&nbsp;<span class="ident" id="7112677"><a href="/crypto/tls/handshake_server_test.go.html#7112317">err</a></span>&nbsp;<span class="op" id="7112681">=</span>&nbsp;<span class="ident" id="7112683"><a href="/crypto/tls/handshake_server_test.go.html#7111102">testHandshake</a></span><span class="op" id="7112696">(</span><span class="ident" id="7112697"><a href="/crypto/tls/handshake_server_test.go.html#7112165">clientConfig</a></span><span class="op" id="7112709">,</span>&nbsp;<span class="ident" id="7112711"><a href="/crypto/tls/handshake_server_test.go.html#7111951">serverConfig</a></span><span class="op" id="7112723">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112726">if</span>&nbsp;<span class="ident" id="7112729"><a href="/crypto/tls/handshake_server_test.go.html#7112317">err</a></span>&nbsp;<span class="op" id="7112733">!=</span>&nbsp;<span class="ident" id="7112736">nil</span>&nbsp;<span class="op" id="7112740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112744"><a href="/crypto/tls/handshake_server_test.go.html#7111934">t</a></span><span class="op" id="7112745">.</span><span class="ident" id="7112746">Fatalf</span><span class="op" id="7112752">(</span><span class="string" id="7112753">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7112775">,</span>&nbsp;<span class="ident" id="7112777"><a href="/crypto/tls/handshake_server_test.go.html#7112317">err</a></span><span class="op" id="7112780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7112786">if</span>&nbsp;<span class="ident" id="7112789"><a href="/crypto/tls/handshake_server_test.go.html#7112310">state</a></span><span class="op" id="7112794">.</span><span class="ident" id="7112795">CipherSuite</span>&nbsp;<span class="op" id="7112807">!=</span>&nbsp;<span class="ident" id="7112810"><a href="/crypto/tls/cipher_suites.go.html#4106867">TLS_RSA_WITH_RC4_128_SHA</a></span>&nbsp;<span class="op" id="7112835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7112839"><a href="/crypto/tls/handshake_server_test.go.html#7111934">t</a></span><span class="op" id="7112840">.</span><span class="ident" id="7112841">Fatalf</span><span class="op" id="7112847">(</span><span class="string" id="7112848">&#34;Server&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="7112890">,</span>&nbsp;<span class="ident" id="7112892"><a href="/crypto/tls/handshake_server_test.go.html#7112310">state</a></span><span class="op" id="7112897">.</span><span class="ident" id="7112898">CipherSuite</span><span class="op" id="7112909">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7112912">}</span><br>
<span class="lineno"></span><span class="op" id="7112914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7112917">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7112992">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="7113008">//&nbsp;serverTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;server&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7113088">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="7113107">type</span>&nbsp;<span class="ident" id="7113112">serverTest</span>&nbsp;<span class="keyword" id="7113123">struct</span>&nbsp;<span class="op" id="7113130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7113133">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7113206">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7113247">name</span>&nbsp;<span class="builtintype" id="7113252">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7113260">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7113326">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7113371">command</span>&nbsp;<span class="op" id="7113379">[</span><span class="op" id="7113380">]</span><span class="builtintype" id="7113381">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7113389">//&nbsp;expectedPeerCerts&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;PEM&nbsp;blocks&nbsp;of&nbsp;expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7113453">//&nbsp;certificates&nbsp;from&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7113487">expectedPeerCerts</span>&nbsp;<span class="op" id="7113505">[</span><span class="op" id="7113506">]</span><span class="builtintype" id="7113507">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7113515">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7113586">config</span>&nbsp;<span class="op" id="7113593">*</span><span class="ident" id="7113594"><a href="/crypto/tls/common.go.html#4116177">Config</a></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7113602">//&nbsp;expectAlert,&nbsp;if&nbsp;true,&nbsp;indicates&nbsp;that&nbsp;a&nbsp;fatal&nbsp;alert&nbsp;should&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7113676">//&nbsp;when&nbsp;handshaking&nbsp;with&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7113714">expectAlert</span>&nbsp;<span class="builtintype" id="7113726">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7113732">//&nbsp;expectHandshakeErrorIncluding,&nbsp;when&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7113801">//&nbsp;that&nbsp;must&nbsp;be&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;error&nbsp;resulting&nbsp;from&nbsp;the&nbsp;handshake.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7113873">expectHandshakeErrorIncluding</span>&nbsp;<span class="builtintype" id="7113903">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7113911">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7113980">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;false&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7114053">//&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7114090">validate</span>&nbsp;<span class="keyword" id="7114099">func</span><span class="op" id="7114103">(</span><span class="ident" id="7114104"><a href="/crypto/tls/common.go.html#4112190">ConnectionState</a></span><span class="op" id="7114119">)</span>&nbsp;<span class="builtintype" id="7114121">error</span><br>
<span class="lineno">270</span><span class="op" id="7114127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7114130">var</span>&nbsp;<span class="ident" id="7114134">defaultClientCommand</span>&nbsp;<span class="op" id="7114155">=</span>&nbsp;<span class="op" id="7114157">[</span><span class="op" id="7114158">]</span><span class="builtintype" id="7114159">string</span><span class="op" id="7114165">{</span><span class="string" id="7114166">&#34;openssl&#34;</span><span class="op" id="7114175">,</span>&nbsp;<span class="string" id="7114177">&#34;s_client&#34;</span><span class="op" id="7114187">,</span>&nbsp;<span class="string" id="7114189">&#34;-no_ticket&#34;</span><span class="op" id="7114201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7114204">//&nbsp;connFromCommand&nbsp;starts&nbsp;opens&nbsp;a&nbsp;listening&nbsp;socket&nbsp;and&nbsp;starts&nbsp;the&nbsp;reference</span><br>
<span class="lineno">275</span><span class="comment" id="7114280">//&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;it.&nbsp;It&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;that&nbsp;wraps&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="7114360">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="7114375">func</span>&nbsp;<span class="op" id="7114380">(</span><span class="ident" id="7114381">test</span>&nbsp;<span class="op" id="7114386">*</span><span class="ident" id="7114387"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7114397">)</span>&nbsp;<span class="ident" id="7114399">connFromCommand</span><span class="op" id="7114414">(</span><span class="op" id="7114415">)</span>&nbsp;<span class="op" id="7114417">(</span><span class="ident" id="7114418">conn</span>&nbsp;<span class="op" id="7114423">*</span><span class="ident" id="7114424"><a href="/crypto/tls/handshake_test.go.html#7138857">recordingConn</a></span><span class="op" id="7114437">,</span>&nbsp;<span class="ident" id="7114439">child</span>&nbsp;<span class="op" id="7114445">*</span><span class="ident" id="7114446"><a href="/crypto/tls/handshake_server_test.go.html#7106696">exec</a></span><span class="op" id="7114450">.</span><span class="ident" id="7114451">Cmd</span><span class="op" id="7114454">,</span>&nbsp;<span class="ident" id="7114456">err</span>&nbsp;<span class="builtintype" id="7114460">error</span><span class="op" id="7114465">)</span>&nbsp;<span class="op" id="7114467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7114470">l</span><span class="op" id="7114471">,</span>&nbsp;<span class="ident" id="7114473"><a href="/crypto/tls/handshake_server_test.go.html#7114456">err</a></span>&nbsp;<span class="op" id="7114477">:=</span>&nbsp;<span class="ident" id="7114480"><a href="/crypto/tls/handshake_server_test.go.html#7106683">net</a></span><span class="op" id="7114483">.</span><span class="ident" id="7114484">ListenTCP</span><span class="op" id="7114493">(</span><span class="string" id="7114494">&#34;tcp&#34;</span><span class="op" id="7114499">,</span>&nbsp;<span class="op" id="7114501">&amp;</span><span class="ident" id="7114502"><a href="/crypto/tls/handshake_server_test.go.html#7106683">net</a></span><span class="op" id="7114505">.</span><span class="ident" id="7114506">TCPAddr</span><span class="op" id="7114513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7114517">IP</span><span class="op" id="7114519">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7114523"><a href="/crypto/tls/handshake_server_test.go.html#7106683">net</a></span><span class="op" id="7114526">.</span><span class="ident" id="7114527">IPv4</span><span class="op" id="7114531">(</span><span class="num" id="7114532">127</span><span class="op" id="7114535">,</span>&nbsp;<span class="num" id="7114537">0</span><span class="op" id="7114538">,</span>&nbsp;<span class="num" id="7114540">0</span><span class="op" id="7114541">,</span>&nbsp;<span class="num" id="7114543">1</span><span class="op" id="7114544">)</span><span class="op" id="7114545">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7114549">Port</span><span class="op" id="7114553">:</span>&nbsp;<span class="num" id="7114555">0</span><span class="op" id="7114556">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7114559">}</span><span class="op" id="7114560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7114563">if</span>&nbsp;<span class="ident" id="7114566"><a href="/crypto/tls/handshake_server_test.go.html#7114456">err</a></span>&nbsp;<span class="op" id="7114570">!=</span>&nbsp;<span class="ident" id="7114573">nil</span>&nbsp;<span class="op" id="7114577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7114581">return</span>&nbsp;<span class="ident" id="7114588">nil</span><span class="op" id="7114591">,</span>&nbsp;<span class="ident" id="7114593">nil</span><span class="op" id="7114596">,</span>&nbsp;<span class="ident" id="7114598"><a href="/crypto/tls/handshake_server_test.go.html#7114456">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7114603">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7114606">defer</span>&nbsp;<span class="ident" id="7114612"><a href="/crypto/tls/handshake_server_test.go.html#7114470">l</a></span><span class="op" id="7114613">.</span><span class="ident" id="7114614">Close</span><span class="op" id="7114619">(</span><span class="op" id="7114620">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7114624">port</span>&nbsp;<span class="op" id="7114629">:=</span>&nbsp;<span class="ident" id="7114632"><a href="/crypto/tls/handshake_server_test.go.html#7114470">l</a></span><span class="op" id="7114633">.</span><span class="ident" id="7114634">Addr</span><span class="op" id="7114638">(</span><span class="op" id="7114639">)</span><span class="op" id="7114640">.</span><span class="op" id="7114641">(</span><span class="op" id="7114642">*</span><span class="ident" id="7114643"><a href="/crypto/tls/handshake_server_test.go.html#7106683">net</a></span><span class="op" id="7114646">.</span><span class="ident" id="7114647">TCPAddr</span><span class="op" id="7114654">)</span><span class="op" id="7114655">.</span><span class="ident" id="7114656">Port</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7114663">var</span>&nbsp;<span class="ident" id="7114667">command</span>&nbsp;<span class="op" id="7114675">[</span><span class="op" id="7114676">]</span><span class="builtintype" id="7114677">string</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7114685"><a href="/crypto/tls/handshake_server_test.go.html#7114667">command</a></span>&nbsp;<span class="op" id="7114693">=</span>&nbsp;<span class="builtinfunc" id="7114695">append</span><span class="op" id="7114701">(</span><span class="ident" id="7114702"><a href="/crypto/tls/handshake_server_test.go.html#7114667">command</a></span><span class="op" id="7114709">,</span>&nbsp;<span class="ident" id="7114711"><a href="/crypto/tls/handshake_server_test.go.html#7114381">test</a></span><span class="op" id="7114715">.</span><span class="ident" id="7114716">command</span><span class="op" id="7114723">...</span><span class="op" id="7114726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7114729">if</span>&nbsp;<span class="builtinfunc" id="7114732">len</span><span class="op" id="7114735">(</span><span class="ident" id="7114736"><a href="/crypto/tls/handshake_server_test.go.html#7114667">command</a></span><span class="op" id="7114743">)</span>&nbsp;<span class="op" id="7114745">==</span>&nbsp;<span class="num" id="7114748">0</span>&nbsp;<span class="op" id="7114750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7114754"><a href="/crypto/tls/handshake_server_test.go.html#7114667">command</a></span>&nbsp;<span class="op" id="7114762">=</span>&nbsp;<span class="ident" id="7114764"><a href="/crypto/tls/handshake_server_test.go.html#7114134">defaultClientCommand</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7114786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7114789"><a href="/crypto/tls/handshake_server_test.go.html#7114667">command</a></span>&nbsp;<span class="op" id="7114797">=</span>&nbsp;<span class="builtinfunc" id="7114799">append</span><span class="op" id="7114805">(</span><span class="ident" id="7114806"><a href="/crypto/tls/handshake_server_test.go.html#7114667">command</a></span><span class="op" id="7114813">,</span>&nbsp;<span class="string" id="7114815">&#34;-connect&#34;</span><span class="op" id="7114825">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7114828"><a href="/crypto/tls/handshake_server_test.go.html#7114667">command</a></span>&nbsp;<span class="op" id="7114836">=</span>&nbsp;<span class="builtinfunc" id="7114838">append</span><span class="op" id="7114844">(</span><span class="ident" id="7114845"><a href="/crypto/tls/handshake_server_test.go.html#7114667">command</a></span><span class="op" id="7114852">,</span>&nbsp;<span class="ident" id="7114854"><a href="/crypto/tls/handshake_server_test.go.html#7106658">fmt</a></span><span class="op" id="7114857">.</span><span class="ident" id="7114858">Sprintf</span><span class="op" id="7114865">(</span><span class="string" id="7114866">&#34;127.0.0.1:%d&#34;</span><span class="op" id="7114880">,</span>&nbsp;<span class="ident" id="7114882"><a href="/crypto/tls/handshake_server_test.go.html#7114624">port</a></span><span class="op" id="7114886">)</span><span class="op" id="7114887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7114890">cmd</span>&nbsp;<span class="op" id="7114894">:=</span>&nbsp;<span class="ident" id="7114897"><a href="/crypto/tls/handshake_server_test.go.html#7106696">exec</a></span><span class="op" id="7114901">.</span><span class="ident" id="7114902">Command</span><span class="op" id="7114909">(</span><span class="ident" id="7114910"><a href="/crypto/tls/handshake_server_test.go.html#7114667">command</a></span><span class="op" id="7114917">[</span><span class="num" id="7114918">0</span><span class="op" id="7114919">]</span><span class="op" id="7114920">,</span>&nbsp;<span class="ident" id="7114922"><a href="/crypto/tls/handshake_server_test.go.html#7114667">command</a></span><span class="op" id="7114929">[</span><span class="num" id="7114930">1</span><span class="op" id="7114931">:</span><span class="op" id="7114932">]</span><span class="op" id="7114933">...</span><span class="op" id="7114936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7114939"><a href="/crypto/tls/handshake_server_test.go.html#7114890">cmd</a></span><span class="op" id="7114942">.</span><span class="ident" id="7114943">Stdin</span>&nbsp;<span class="op" id="7114949">=</span>&nbsp;<span class="ident" id="7114951">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7114956">var</span>&nbsp;<span class="ident" id="7114960">output</span>&nbsp;<span class="ident" id="7114967"><a href="/crypto/tls/handshake_server_test.go.html#7106558">bytes</a></span><span class="op" id="7114972">.</span><span class="ident" id="7114973">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7114981"><a href="/crypto/tls/handshake_server_test.go.html#7114890">cmd</a></span><span class="op" id="7114984">.</span><span class="ident" id="7114985">Stdout</span>&nbsp;<span class="op" id="7114992">=</span>&nbsp;<span class="op" id="7114994">&amp;</span><span class="ident" id="7114995"><a href="/crypto/tls/handshake_server_test.go.html#7114960">output</a></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7115003"><a href="/crypto/tls/handshake_server_test.go.html#7114890">cmd</a></span><span class="op" id="7115006">.</span><span class="ident" id="7115007">Stderr</span>&nbsp;<span class="op" id="7115014">=</span>&nbsp;<span class="op" id="7115016">&amp;</span><span class="ident" id="7115017"><a href="/crypto/tls/handshake_server_test.go.html#7114960">output</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115025">if</span>&nbsp;<span class="ident" id="7115028">err</span>&nbsp;<span class="op" id="7115032">:=</span>&nbsp;<span class="ident" id="7115035"><a href="/crypto/tls/handshake_server_test.go.html#7114890">cmd</a></span><span class="op" id="7115038">.</span><span class="ident" id="7115039">Start</span><span class="op" id="7115044">(</span><span class="op" id="7115045">)</span><span class="op" id="7115046">;</span>&nbsp;<span class="ident" id="7115048"><a href="/crypto/tls/handshake_server_test.go.html#7115028">err</a></span>&nbsp;<span class="op" id="7115052">!=</span>&nbsp;<span class="ident" id="7115055">nil</span>&nbsp;<span class="op" id="7115059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115063">return</span>&nbsp;<span class="ident" id="7115070">nil</span><span class="op" id="7115073">,</span>&nbsp;<span class="ident" id="7115075">nil</span><span class="op" id="7115078">,</span>&nbsp;<span class="ident" id="7115080"><a href="/crypto/tls/handshake_server_test.go.html#7115028">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7115085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7115089">connChan</span>&nbsp;<span class="op" id="7115098">:=</span>&nbsp;<span class="builtinfunc" id="7115101">make</span><span class="op" id="7115105">(</span><span class="keyword" id="7115106">chan</span>&nbsp;<span class="keyword" id="7115111">interface</span><span class="op" id="7115120">{</span><span class="op" id="7115121">}</span><span class="op" id="7115122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115125">go</span>&nbsp;<span class="keyword" id="7115128">func</span><span class="op" id="7115132">(</span><span class="op" id="7115133">)</span>&nbsp;<span class="op" id="7115135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7115139">tcpConn</span><span class="op" id="7115146">,</span>&nbsp;<span class="ident" id="7115148">err</span>&nbsp;<span class="op" id="7115152">:=</span>&nbsp;<span class="ident" id="7115155"><a href="/crypto/tls/handshake_server_test.go.html#7114470">l</a></span><span class="op" id="7115156">.</span><span class="ident" id="7115157">Accept</span><span class="op" id="7115163">(</span><span class="op" id="7115164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115168">if</span>&nbsp;<span class="ident" id="7115171"><a href="/crypto/tls/handshake_server_test.go.html#7115148">err</a></span>&nbsp;<span class="op" id="7115175">!=</span>&nbsp;<span class="ident" id="7115178">nil</span>&nbsp;<span class="op" id="7115182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7115187"><a href="/crypto/tls/handshake_server_test.go.html#7115089">connChan</a></span>&nbsp;<span class="op" id="7115196">&lt;-</span>&nbsp;<span class="ident" id="7115199"><a href="/crypto/tls/handshake_server_test.go.html#7115148">err</a></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7115205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7115209"><a href="/crypto/tls/handshake_server_test.go.html#7115089">connChan</a></span>&nbsp;<span class="op" id="7115218">&lt;-</span>&nbsp;<span class="ident" id="7115221"><a href="/crypto/tls/handshake_server_test.go.html#7115139">tcpConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7115230">}</span><span class="op" id="7115231">(</span><span class="op" id="7115232">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115236">var</span>&nbsp;<span class="ident" id="7115240">tcpConn</span>&nbsp;<span class="ident" id="7115248"><a href="/crypto/tls/handshake_server_test.go.html#7106683">net</a></span><span class="op" id="7115251">.</span><span class="ident" id="7115252">Conn</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115258">select</span>&nbsp;<span class="op" id="7115265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115268">case</span>&nbsp;<span class="ident" id="7115273">connOrError</span>&nbsp;<span class="op" id="7115285">:=</span>&nbsp;<span class="op" id="7115288">&lt;-</span><span class="ident" id="7115290"><a href="/crypto/tls/handshake_server_test.go.html#7115089">connChan</a></span><span class="op" id="7115298">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115302">if</span>&nbsp;<span class="ident" id="7115305">err</span><span class="op" id="7115308">,</span>&nbsp;<span class="ident" id="7115310">ok</span>&nbsp;<span class="op" id="7115313">:=</span>&nbsp;<span class="ident" id="7115316"><a href="/crypto/tls/handshake_server_test.go.html#7115273">connOrError</a></span><span class="op" id="7115327">.</span><span class="op" id="7115328">(</span><span class="builtintype" id="7115329">error</span><span class="op" id="7115334">)</span><span class="op" id="7115335">;</span>&nbsp;<span class="ident" id="7115337"><a href="/crypto/tls/handshake_server_test.go.html#7115310">ok</a></span>&nbsp;<span class="op" id="7115340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115345">return</span>&nbsp;<span class="ident" id="7115352">nil</span><span class="op" id="7115355">,</span>&nbsp;<span class="ident" id="7115357">nil</span><span class="op" id="7115360">,</span>&nbsp;<span class="ident" id="7115362"><a href="/crypto/tls/handshake_server_test.go.html#7115305">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7115368">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7115372"><a href="/crypto/tls/handshake_server_test.go.html#7115240">tcpConn</a></span>&nbsp;<span class="op" id="7115380">=</span>&nbsp;<span class="ident" id="7115382"><a href="/crypto/tls/handshake_server_test.go.html#7115273">connOrError</a></span><span class="op" id="7115393">.</span><span class="op" id="7115394">(</span><span class="ident" id="7115395"><a href="/crypto/tls/handshake_server_test.go.html#7106683">net</a></span><span class="op" id="7115398">.</span><span class="ident" id="7115399">Conn</span><span class="op" id="7115403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115406">case</span>&nbsp;<span class="op" id="7115411">&lt;-</span><span class="ident" id="7115413"><a href="/crypto/tls/handshake_server_test.go.html#7106746">time</a></span><span class="op" id="7115417">.</span><span class="ident" id="7115418">After</span><span class="op" id="7115423">(</span><span class="num" id="7115424">2</span>&nbsp;<span class="op" id="7115426">*</span>&nbsp;<span class="ident" id="7115428"><a href="/crypto/tls/handshake_server_test.go.html#7106746">time</a></span><span class="op" id="7115432">.</span><span class="ident" id="7115433">Second</span><span class="op" id="7115439">)</span><span class="op" id="7115440">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7115444"><a href="/crypto/tls/handshake_server_test.go.html#7114960">output</a></span><span class="op" id="7115450">.</span><span class="ident" id="7115451">WriteTo</span><span class="op" id="7115458">(</span><span class="ident" id="7115459"><a href="/crypto/tls/handshake_server_test.go.html#7106690">os</a></span><span class="op" id="7115461">.</span><span class="ident" id="7115462">Stdout</span><span class="op" id="7115468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115472">return</span>&nbsp;<span class="ident" id="7115479">nil</span><span class="op" id="7115482">,</span>&nbsp;<span class="ident" id="7115484">nil</span><span class="op" id="7115487">,</span>&nbsp;<span class="ident" id="7115489"><a href="/crypto/tls/handshake_server_test.go.html#7106648">errors</a></span><span class="op" id="7115495">.</span><span class="ident" id="7115496">New</span><span class="op" id="7115499">(</span><span class="string" id="7115500">&#34;timed&nbsp;out&nbsp;waiting&nbsp;for&nbsp;connection&nbsp;from&nbsp;child&nbsp;process&#34;</span><span class="op" id="7115553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7115556">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7115560">record</span>&nbsp;<span class="op" id="7115567">:=</span>&nbsp;<span class="op" id="7115570">&amp;</span><span class="ident" id="7115571"><a href="/crypto/tls/handshake_test.go.html#7138857">recordingConn</a></span><span class="op" id="7115584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7115588">Conn</span><span class="op" id="7115592">:</span>&nbsp;<span class="ident" id="7115594"><a href="/crypto/tls/handshake_server_test.go.html#7115240">tcpConn</a></span><span class="op" id="7115601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7115604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115608">return</span>&nbsp;<span class="ident" id="7115615"><a href="/crypto/tls/handshake_server_test.go.html#7115560">record</a></span><span class="op" id="7115621">,</span>&nbsp;<span class="ident" id="7115623"><a href="/crypto/tls/handshake_server_test.go.html#7114890">cmd</a></span><span class="op" id="7115626">,</span>&nbsp;<span class="ident" id="7115628">nil</span><br>
<span class="lineno"></span><span class="op" id="7115632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7115635">func</span>&nbsp;<span class="op" id="7115640">(</span><span class="ident" id="7115641">test</span>&nbsp;<span class="op" id="7115646">*</span><span class="ident" id="7115647"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7115657">)</span>&nbsp;<span class="ident" id="7115659">dataPath</span><span class="op" id="7115667">(</span><span class="op" id="7115668">)</span>&nbsp;<span class="builtintype" id="7115670">string</span>&nbsp;<span class="op" id="7115677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115680">return</span>&nbsp;<span class="ident" id="7115687"><a href="/crypto/tls/handshake_server_test.go.html#7106707">filepath</a></span><span class="op" id="7115695">.</span><span class="ident" id="7115696">Join</span><span class="op" id="7115700">(</span><span class="string" id="7115701">&#34;testdata&#34;</span><span class="op" id="7115711">,</span>&nbsp;<span class="string" id="7115713">&#34;Server-&#34;</span><span class="op" id="7115722">+</span><span class="ident" id="7115723"><a href="/crypto/tls/handshake_server_test.go.html#7115641">test</a></span><span class="op" id="7115727">.</span><span class="ident" id="7115728">name</span><span class="op" id="7115732">)</span><br>
<span class="lineno">335</span><span class="op" id="7115734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7115737">func</span>&nbsp;<span class="op" id="7115742">(</span><span class="ident" id="7115743">test</span>&nbsp;<span class="op" id="7115748">*</span><span class="ident" id="7115749"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7115759">)</span>&nbsp;<span class="ident" id="7115761">loadData</span><span class="op" id="7115769">(</span><span class="op" id="7115770">)</span>&nbsp;<span class="op" id="7115772">(</span><span class="ident" id="7115773">flows</span>&nbsp;<span class="op" id="7115779">[</span><span class="op" id="7115780">]</span><span class="op" id="7115781">[</span><span class="op" id="7115782">]</span><span class="builtintype" id="7115783">byte</span><span class="op" id="7115787">,</span>&nbsp;<span class="ident" id="7115789">err</span>&nbsp;<span class="builtintype" id="7115793">error</span><span class="op" id="7115798">)</span>&nbsp;<span class="op" id="7115800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7115803">in</span><span class="op" id="7115805">,</span>&nbsp;<span class="ident" id="7115807"><a href="/crypto/tls/handshake_server_test.go.html#7115789">err</a></span>&nbsp;<span class="op" id="7115811">:=</span>&nbsp;<span class="ident" id="7115814"><a href="/crypto/tls/handshake_server_test.go.html#7106690">os</a></span><span class="op" id="7115816">.</span><span class="ident" id="7115817">Open</span><span class="op" id="7115821">(</span><span class="ident" id="7115822"><a href="/crypto/tls/handshake_server_test.go.html#7115743">test</a></span><span class="op" id="7115826">.</span><span class="ident" id="7115827">dataPath</span><span class="op" id="7115835">(</span><span class="op" id="7115836">)</span><span class="op" id="7115837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115840">if</span>&nbsp;<span class="ident" id="7115843"><a href="/crypto/tls/handshake_server_test.go.html#7115789">err</a></span>&nbsp;<span class="op" id="7115847">!=</span>&nbsp;<span class="ident" id="7115850">nil</span>&nbsp;<span class="op" id="7115854">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115858">return</span>&nbsp;<span class="ident" id="7115865">nil</span><span class="op" id="7115868">,</span>&nbsp;<span class="ident" id="7115870"><a href="/crypto/tls/handshake_server_test.go.html#7115789">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7115875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115878">defer</span>&nbsp;<span class="ident" id="7115884"><a href="/crypto/tls/handshake_server_test.go.html#7115803">in</a></span><span class="op" id="7115886">.</span><span class="ident" id="7115887">Close</span><span class="op" id="7115892">(</span><span class="op" id="7115893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115896">return</span>&nbsp;<span class="ident" id="7115903"><a href="/crypto/tls/handshake_test.go.html#7140168">parseTestData</a></span><span class="op" id="7115916">(</span><span class="ident" id="7115917"><a href="/crypto/tls/handshake_server_test.go.html#7115803">in</a></span><span class="op" id="7115919">)</span><br>
<span class="lineno"></span><span class="op" id="7115921">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="7115924">func</span>&nbsp;<span class="op" id="7115929">(</span><span class="ident" id="7115930">test</span>&nbsp;<span class="op" id="7115935">*</span><span class="ident" id="7115936"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7115946">)</span>&nbsp;<span class="ident" id="7115948">run</span><span class="op" id="7115951">(</span><span class="ident" id="7115952">t</span>&nbsp;<span class="op" id="7115954">*</span><span class="ident" id="7115955"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7115962">.</span><span class="ident" id="7115963">T</span><span class="op" id="7115964">,</span>&nbsp;<span class="ident" id="7115966">write</span>&nbsp;<span class="builtintype" id="7115972">bool</span><span class="op" id="7115976">)</span>&nbsp;<span class="op" id="7115978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7115981">var</span>&nbsp;<span class="ident" id="7115985">clientConn</span><span class="op" id="7115995">,</span>&nbsp;<span class="ident" id="7115997">serverConn</span>&nbsp;<span class="ident" id="7116008"><a href="/crypto/tls/handshake_server_test.go.html#7106683">net</a></span><span class="op" id="7116011">.</span><span class="ident" id="7116012">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7116018">var</span>&nbsp;<span class="ident" id="7116022">recordingConn</span>&nbsp;<span class="op" id="7116036">*</span><span class="ident" id="7116037"><a href="/crypto/tls/handshake_test.go.html#7138857">recordingConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7116052">var</span>&nbsp;<span class="ident" id="7116056">childProcess</span>&nbsp;<span class="op" id="7116069">*</span><span class="ident" id="7116070"><a href="/crypto/tls/handshake_server_test.go.html#7106696">exec</a></span><span class="op" id="7116074">.</span><span class="ident" id="7116075">Cmd</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7116081">if</span>&nbsp;<span class="ident" id="7116084"><a href="/crypto/tls/handshake_server_test.go.html#7115966">write</a></span>&nbsp;<span class="op" id="7116090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7116094">var</span>&nbsp;<span class="ident" id="7116098">err</span>&nbsp;<span class="builtintype" id="7116102">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116110"><a href="/crypto/tls/handshake_server_test.go.html#7116022">recordingConn</a></span><span class="op" id="7116123">,</span>&nbsp;<span class="ident" id="7116125"><a href="/crypto/tls/handshake_server_test.go.html#7116056">childProcess</a></span><span class="op" id="7116137">,</span>&nbsp;<span class="ident" id="7116139"><a href="/crypto/tls/handshake_server_test.go.html#7116098">err</a></span>&nbsp;<span class="op" id="7116143">=</span>&nbsp;<span class="ident" id="7116145"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7116149">.</span><span class="ident" id="7116150">connFromCommand</span><span class="op" id="7116165">(</span><span class="op" id="7116166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7116170">if</span>&nbsp;<span class="ident" id="7116173"><a href="/crypto/tls/handshake_server_test.go.html#7116098">err</a></span>&nbsp;<span class="op" id="7116177">!=</span>&nbsp;<span class="ident" id="7116180">nil</span>&nbsp;<span class="op" id="7116184">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116189"><a href="/crypto/tls/handshake_server_test.go.html#7115952">t</a></span><span class="op" id="7116190">.</span><span class="ident" id="7116191">Fatalf</span><span class="op" id="7116197">(</span><span class="string" id="7116198">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="7116230">,</span>&nbsp;<span class="ident" id="7116232"><a href="/crypto/tls/handshake_server_test.go.html#7116098">err</a></span><span class="op" id="7116235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7116239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116243"><a href="/crypto/tls/handshake_server_test.go.html#7115997">serverConn</a></span>&nbsp;<span class="op" id="7116254">=</span>&nbsp;<span class="ident" id="7116256"><a href="/crypto/tls/handshake_server_test.go.html#7116022">recordingConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7116271">}</span>&nbsp;<span class="keyword" id="7116273">else</span>&nbsp;<span class="op" id="7116278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116282"><a href="/crypto/tls/handshake_server_test.go.html#7115985">clientConn</a></span><span class="op" id="7116292">,</span>&nbsp;<span class="ident" id="7116294"><a href="/crypto/tls/handshake_server_test.go.html#7115997">serverConn</a></span>&nbsp;<span class="op" id="7116305">=</span>&nbsp;<span class="ident" id="7116307"><a href="/crypto/tls/handshake_server_test.go.html#7106683">net</a></span><span class="op" id="7116310">.</span><span class="ident" id="7116311">Pipe</span><span class="op" id="7116315">(</span><span class="op" id="7116316">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7116319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116322">config</span>&nbsp;<span class="op" id="7116329">:=</span>&nbsp;<span class="ident" id="7116332"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7116336">.</span><span class="ident" id="7116337">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7116345">if</span>&nbsp;<span class="ident" id="7116348"><a href="/crypto/tls/handshake_server_test.go.html#7116322">config</a></span>&nbsp;<span class="op" id="7116355">==</span>&nbsp;<span class="ident" id="7116358">nil</span>&nbsp;<span class="op" id="7116362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116366"><a href="/crypto/tls/handshake_server_test.go.html#7116322">config</a></span>&nbsp;<span class="op" id="7116373">=</span>&nbsp;<span class="ident" id="7116375"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7116387">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116390">server</span>&nbsp;<span class="op" id="7116397">:=</span>&nbsp;<span class="ident" id="7116400"><a href="/crypto/tls/tls.go.html#4249440">Server</a></span><span class="op" id="7116406">(</span><span class="ident" id="7116407"><a href="/crypto/tls/handshake_server_test.go.html#7115997">serverConn</a></span><span class="op" id="7116417">,</span>&nbsp;<span class="ident" id="7116419"><a href="/crypto/tls/handshake_server_test.go.html#7116322">config</a></span><span class="op" id="7116425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116428">connStateChan</span>&nbsp;<span class="op" id="7116442">:=</span>&nbsp;<span class="builtinfunc" id="7116445">make</span><span class="op" id="7116449">(</span><span class="keyword" id="7116450">chan</span>&nbsp;<span class="ident" id="7116455"><a href="/crypto/tls/common.go.html#4112190">ConnectionState</a></span><span class="op" id="7116470">,</span>&nbsp;<span class="num" id="7116472">1</span><span class="op" id="7116473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7116476">go</span>&nbsp;<span class="keyword" id="7116479">func</span><span class="op" id="7116483">(</span><span class="op" id="7116484">)</span>&nbsp;<span class="op" id="7116486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7116490">var</span>&nbsp;<span class="ident" id="7116494">err</span>&nbsp;<span class="builtintype" id="7116498">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7116506">if</span>&nbsp;<span class="ident" id="7116509">_</span><span class="op" id="7116510">,</span>&nbsp;<span class="ident" id="7116512"><a href="/crypto/tls/handshake_server_test.go.html#7116494">err</a></span>&nbsp;<span class="op" id="7116516">=</span>&nbsp;<span class="ident" id="7116518"><a href="/crypto/tls/handshake_server_test.go.html#7116390">server</a></span><span class="op" id="7116524">.</span><span class="ident" id="7116525">Write</span><span class="op" id="7116530">(</span><span class="op" id="7116531">[</span><span class="op" id="7116532">]</span><span class="builtintype" id="7116533">byte</span><span class="op" id="7116537">(</span><span class="string" id="7116538">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="7116554">)</span><span class="op" id="7116555">)</span><span class="op" id="7116556">;</span>&nbsp;<span class="ident" id="7116558"><a href="/crypto/tls/handshake_server_test.go.html#7116494">err</a></span>&nbsp;<span class="op" id="7116562">!=</span>&nbsp;<span class="ident" id="7116565">nil</span>&nbsp;<span class="op" id="7116569">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116574"><a href="/crypto/tls/handshake_server_test.go.html#7115952">t</a></span><span class="op" id="7116575">.</span><span class="ident" id="7116576">Logf</span><span class="op" id="7116580">(</span><span class="string" id="7116581">&#34;Error&nbsp;from&nbsp;Server.Write:&nbsp;%s&#34;</span><span class="op" id="7116610">,</span>&nbsp;<span class="ident" id="7116612"><a href="/crypto/tls/handshake_server_test.go.html#7116494">err</a></span><span class="op" id="7116615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7116619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7116623">if</span>&nbsp;<span class="builtinfunc" id="7116626">len</span><span class="op" id="7116629">(</span><span class="ident" id="7116630"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7116634">.</span><span class="ident" id="7116635">expectHandshakeErrorIncluding</span><span class="op" id="7116664">)</span>&nbsp;<span class="op" id="7116666">&gt;</span>&nbsp;<span class="num" id="7116668">0</span>&nbsp;<span class="op" id="7116670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7116675">if</span>&nbsp;<span class="ident" id="7116678"><a href="/crypto/tls/handshake_server_test.go.html#7116494">err</a></span>&nbsp;<span class="op" id="7116682">==</span>&nbsp;<span class="ident" id="7116685">nil</span>&nbsp;<span class="op" id="7116689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116695"><a href="/crypto/tls/handshake_server_test.go.html#7115952">t</a></span><span class="op" id="7116696">.</span><span class="ident" id="7116697">Errorf</span><span class="op" id="7116703">(</span><span class="string" id="7116704">&#34;Error&nbsp;expected,&nbsp;but&nbsp;no&nbsp;error&nbsp;returned&#34;</span><span class="op" id="7116743">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7116748">}</span>&nbsp;<span class="keyword" id="7116750">else</span>&nbsp;<span class="keyword" id="7116755">if</span>&nbsp;<span class="ident" id="7116758">s</span>&nbsp;<span class="op" id="7116760">:=</span>&nbsp;<span class="ident" id="7116763"><a href="/crypto/tls/handshake_server_test.go.html#7116494">err</a></span><span class="op" id="7116766">.</span><span class="ident" id="7116767">Error</span><span class="op" id="7116772">(</span><span class="op" id="7116773">)</span><span class="op" id="7116774">;</span>&nbsp;<span class="op" id="7116776">!</span><span class="ident" id="7116777"><a href="/crypto/tls/handshake_server_test.go.html#7106724">strings</a></span><span class="op" id="7116784">.</span><span class="ident" id="7116785">Contains</span><span class="op" id="7116793">(</span><span class="ident" id="7116794"><a href="/crypto/tls/handshake_server_test.go.html#7116758">s</a></span><span class="op" id="7116795">,</span>&nbsp;<span class="ident" id="7116797"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7116801">.</span><span class="ident" id="7116802">expectHandshakeErrorIncluding</span><span class="op" id="7116831">)</span>&nbsp;<span class="op" id="7116833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116839"><a href="/crypto/tls/handshake_server_test.go.html#7115952">t</a></span><span class="op" id="7116840">.</span><span class="ident" id="7116841">Errorf</span><span class="op" id="7116847">(</span><span class="string" id="7116848">&#34;Error&nbsp;expected&nbsp;containing&nbsp;&#39;%s&#39;&nbsp;but&nbsp;got&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="7116893">,</span>&nbsp;<span class="ident" id="7116895"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7116899">.</span><span class="ident" id="7116900">expectHandshakeErrorIncluding</span><span class="op" id="7116929">,</span>&nbsp;<span class="ident" id="7116931"><a href="/crypto/tls/handshake_server_test.go.html#7116758">s</a></span><span class="op" id="7116932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7116937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7116941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116945"><a href="/crypto/tls/handshake_server_test.go.html#7116390">server</a></span><span class="op" id="7116951">.</span><span class="ident" id="7116952">Close</span><span class="op" id="7116957">(</span><span class="op" id="7116958">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116962"><a href="/crypto/tls/handshake_server_test.go.html#7115997">serverConn</a></span><span class="op" id="7116972">.</span><span class="ident" id="7116973">Close</span><span class="op" id="7116978">(</span><span class="op" id="7116979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7116983"><a href="/crypto/tls/handshake_server_test.go.html#7116428">connStateChan</a></span>&nbsp;<span class="op" id="7116997">&lt;-</span>&nbsp;<span class="ident" id="7117000"><a href="/crypto/tls/handshake_server_test.go.html#7116390">server</a></span><span class="op" id="7117006">.</span><span class="ident" id="7117007">ConnectionState</span><span class="op" id="7117022">(</span><span class="op" id="7117023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117026">}</span><span class="op" id="7117027">(</span><span class="op" id="7117028">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117032">if</span>&nbsp;<span class="op" id="7117035">!</span><span class="ident" id="7117036"><a href="/crypto/tls/handshake_server_test.go.html#7115966">write</a></span>&nbsp;<span class="op" id="7117042">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117046">flows</span><span class="op" id="7117051">,</span>&nbsp;<span class="ident" id="7117053">err</span>&nbsp;<span class="op" id="7117057">:=</span>&nbsp;<span class="ident" id="7117060"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7117064">.</span><span class="ident" id="7117065">loadData</span><span class="op" id="7117073">(</span><span class="op" id="7117074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117078">if</span>&nbsp;<span class="ident" id="7117081"><a href="/crypto/tls/handshake_server_test.go.html#7117053">err</a></span>&nbsp;<span class="op" id="7117085">!=</span>&nbsp;<span class="ident" id="7117088">nil</span>&nbsp;<span class="op" id="7117092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117097">if</span>&nbsp;<span class="op" id="7117100">!</span><span class="ident" id="7117101"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7117105">.</span><span class="ident" id="7117106">expectAlert</span>&nbsp;<span class="op" id="7117118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117124"><a href="/crypto/tls/handshake_server_test.go.html#7115952">t</a></span><span class="op" id="7117125">.</span><span class="ident" id="7117126">Fatalf</span><span class="op" id="7117132">(</span><span class="string" id="7117133">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s&#34;</span><span class="op" id="7117166">,</span>&nbsp;<span class="ident" id="7117168"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7117172">.</span><span class="ident" id="7117173">name</span><span class="op" id="7117177">,</span>&nbsp;<span class="ident" id="7117179"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7117183">.</span><span class="ident" id="7117184">dataPath</span><span class="op" id="7117192">(</span><span class="op" id="7117193">)</span><span class="op" id="7117194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117199">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117207">for</span>&nbsp;<span class="ident" id="7117211">i</span><span class="op" id="7117212">,</span>&nbsp;<span class="ident" id="7117214">b</span>&nbsp;<span class="op" id="7117216">:=</span>&nbsp;<span class="keyword" id="7117219">range</span>&nbsp;<span class="ident" id="7117225"><a href="/crypto/tls/handshake_server_test.go.html#7117046">flows</a></span>&nbsp;<span class="op" id="7117231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117236">if</span>&nbsp;<span class="ident" id="7117239"><a href="/crypto/tls/handshake_server_test.go.html#7117211">i</a></span><span class="op" id="7117240">%</span><span class="num" id="7117241">2</span>&nbsp;<span class="op" id="7117243">==</span>&nbsp;<span class="num" id="7117246">0</span>&nbsp;<span class="op" id="7117248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117254"><a href="/crypto/tls/handshake_server_test.go.html#7115985">clientConn</a></span><span class="op" id="7117264">.</span><span class="ident" id="7117265">Write</span><span class="op" id="7117270">(</span><span class="ident" id="7117271"><a href="/crypto/tls/handshake_server_test.go.html#7117214">b</a></span><span class="op" id="7117272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117278">continue</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117295">bb</span>&nbsp;<span class="op" id="7117298">:=</span>&nbsp;<span class="builtinfunc" id="7117301">make</span><span class="op" id="7117305">(</span><span class="op" id="7117306">[</span><span class="op" id="7117307">]</span><span class="builtintype" id="7117308">byte</span><span class="op" id="7117312">,</span>&nbsp;<span class="builtinfunc" id="7117314">len</span><span class="op" id="7117317">(</span><span class="ident" id="7117318"><a href="/crypto/tls/handshake_server_test.go.html#7117214">b</a></span><span class="op" id="7117319">)</span><span class="op" id="7117320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117325">n</span><span class="op" id="7117326">,</span>&nbsp;<span class="ident" id="7117328">err</span>&nbsp;<span class="op" id="7117332">:=</span>&nbsp;<span class="ident" id="7117335"><a href="/crypto/tls/handshake_server_test.go.html#7106665">io</a></span><span class="op" id="7117337">.</span><span class="ident" id="7117338">ReadFull</span><span class="op" id="7117346">(</span><span class="ident" id="7117347"><a href="/crypto/tls/handshake_server_test.go.html#7115985">clientConn</a></span><span class="op" id="7117357">,</span>&nbsp;<span class="ident" id="7117359"><a href="/crypto/tls/handshake_server_test.go.html#7117295">bb</a></span><span class="op" id="7117361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117366">if</span>&nbsp;<span class="ident" id="7117369"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7117373">.</span><span class="ident" id="7117374">expectAlert</span>&nbsp;<span class="op" id="7117386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117392">if</span>&nbsp;<span class="ident" id="7117395"><a href="/crypto/tls/handshake_server_test.go.html#7117328">err</a></span>&nbsp;<span class="op" id="7117399">==</span>&nbsp;<span class="ident" id="7117402">nil</span>&nbsp;<span class="op" id="7117406">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117413"><a href="/crypto/tls/handshake_server_test.go.html#7115952">t</a></span><span class="op" id="7117414">.</span><span class="ident" id="7117415">Fatal</span><span class="op" id="7117420">(</span><span class="string" id="7117421">&#34;Expected&nbsp;read&nbsp;failure&nbsp;but&nbsp;read&nbsp;succeeded&#34;</span><span class="op" id="7117463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117474">}</span>&nbsp;<span class="keyword" id="7117476">else</span>&nbsp;<span class="op" id="7117481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117487">if</span>&nbsp;<span class="ident" id="7117490"><a href="/crypto/tls/handshake_server_test.go.html#7117328">err</a></span>&nbsp;<span class="op" id="7117494">!=</span>&nbsp;<span class="ident" id="7117497">nil</span>&nbsp;<span class="op" id="7117501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117508"><a href="/crypto/tls/handshake_server_test.go.html#7115952">t</a></span><span class="op" id="7117509">.</span><span class="ident" id="7117510">Fatalf</span><span class="op" id="7117516">(</span><span class="string" id="7117517">&#34;%s&nbsp;#%d:&nbsp;%s\nRead&nbsp;%d,&nbsp;wanted&nbsp;%d,&nbsp;got&nbsp;%x,&nbsp;wanted&nbsp;%x\n&#34;</span><span class="op" id="7117570">,</span>&nbsp;<span class="ident" id="7117572"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7117576">.</span><span class="ident" id="7117577">name</span><span class="op" id="7117581">,</span>&nbsp;<span class="ident" id="7117583"><a href="/crypto/tls/handshake_server_test.go.html#7117211">i</a></span><span class="op" id="7117584">+</span><span class="num" id="7117585">1</span><span class="op" id="7117586">,</span>&nbsp;<span class="ident" id="7117588"><a href="/crypto/tls/handshake_server_test.go.html#7117328">err</a></span><span class="op" id="7117591">,</span>&nbsp;<span class="ident" id="7117593"><a href="/crypto/tls/handshake_server_test.go.html#7117325">n</a></span><span class="op" id="7117594">,</span>&nbsp;<span class="builtinfunc" id="7117596">len</span><span class="op" id="7117599">(</span><span class="ident" id="7117600"><a href="/crypto/tls/handshake_server_test.go.html#7117295">bb</a></span><span class="op" id="7117602">)</span><span class="op" id="7117603">,</span>&nbsp;<span class="ident" id="7117605"><a href="/crypto/tls/handshake_server_test.go.html#7117295">bb</a></span><span class="op" id="7117607">[</span><span class="op" id="7117608">:</span><span class="ident" id="7117609"><a href="/crypto/tls/handshake_server_test.go.html#7117325">n</a></span><span class="op" id="7117610">]</span><span class="op" id="7117611">,</span>&nbsp;<span class="ident" id="7117613"><a href="/crypto/tls/handshake_server_test.go.html#7117214">b</a></span><span class="op" id="7117614">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117626">if</span>&nbsp;<span class="op" id="7117629">!</span><span class="ident" id="7117630"><a href="/crypto/tls/handshake_server_test.go.html#7106558">bytes</a></span><span class="op" id="7117635">.</span><span class="ident" id="7117636">Equal</span><span class="op" id="7117641">(</span><span class="ident" id="7117642"><a href="/crypto/tls/handshake_server_test.go.html#7117214">b</a></span><span class="op" id="7117643">,</span>&nbsp;<span class="ident" id="7117645"><a href="/crypto/tls/handshake_server_test.go.html#7117295">bb</a></span><span class="op" id="7117647">)</span>&nbsp;<span class="op" id="7117649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117656"><a href="/crypto/tls/handshake_server_test.go.html#7115952">t</a></span><span class="op" id="7117657">.</span><span class="ident" id="7117658">Fatalf</span><span class="op" id="7117664">(</span><span class="string" id="7117665">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="7117707">,</span>&nbsp;<span class="ident" id="7117709"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7117713">.</span><span class="ident" id="7117714">name</span><span class="op" id="7117718">,</span>&nbsp;<span class="ident" id="7117720"><a href="/crypto/tls/handshake_server_test.go.html#7117211">i</a></span><span class="op" id="7117721">+</span><span class="num" id="7117722">1</span><span class="op" id="7117723">,</span>&nbsp;<span class="ident" id="7117725"><a href="/crypto/tls/handshake_server_test.go.html#7117295">bb</a></span><span class="op" id="7117727">,</span>&nbsp;<span class="ident" id="7117729"><a href="/crypto/tls/handshake_server_test.go.html#7117214">b</a></span><span class="op" id="7117730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117741">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117749"><a href="/crypto/tls/handshake_server_test.go.html#7115985">clientConn</a></span><span class="op" id="7117759">.</span><span class="ident" id="7117760">Close</span><span class="op" id="7117765">(</span><span class="op" id="7117766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7117769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117773">connState</span>&nbsp;<span class="op" id="7117783">:=</span>&nbsp;<span class="op" id="7117786">&lt;-</span><span class="ident" id="7117788"><a href="/crypto/tls/handshake_server_test.go.html#7116428">connStateChan</a></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117803">peerCerts</span>&nbsp;<span class="op" id="7117813">:=</span>&nbsp;<span class="ident" id="7117816"><a href="/crypto/tls/handshake_server_test.go.html#7117773">connState</a></span><span class="op" id="7117825">.</span><span class="ident" id="7117826">PeerCertificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117844">if</span>&nbsp;<span class="builtinfunc" id="7117847">len</span><span class="op" id="7117850">(</span><span class="ident" id="7117851"><a href="/crypto/tls/handshake_server_test.go.html#7117803">peerCerts</a></span><span class="op" id="7117860">)</span>&nbsp;<span class="op" id="7117862">==</span>&nbsp;<span class="builtinfunc" id="7117865">len</span><span class="op" id="7117868">(</span><span class="ident" id="7117869"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7117873">.</span><span class="ident" id="7117874">expectedPeerCerts</span><span class="op" id="7117891">)</span>&nbsp;<span class="op" id="7117893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117897">for</span>&nbsp;<span class="ident" id="7117901">i</span><span class="op" id="7117902">,</span>&nbsp;<span class="ident" id="7117904">peerCert</span>&nbsp;<span class="op" id="7117913">:=</span>&nbsp;<span class="keyword" id="7117916">range</span>&nbsp;<span class="ident" id="7117922"><a href="/crypto/tls/handshake_server_test.go.html#7117803">peerCerts</a></span>&nbsp;<span class="op" id="7117932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7117937">block</span><span class="op" id="7117942">,</span>&nbsp;<span class="ident" id="7117944">_</span>&nbsp;<span class="op" id="7117946">:=</span>&nbsp;<span class="ident" id="7117949"><a href="/crypto/tls/handshake_server_test.go.html#7106632">pem</a></span><span class="op" id="7117952">.</span><span class="ident" id="7117953">Decode</span><span class="op" id="7117959">(</span><span class="op" id="7117960">[</span><span class="op" id="7117961">]</span><span class="builtintype" id="7117962">byte</span><span class="op" id="7117966">(</span><span class="ident" id="7117967"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7117971">.</span><span class="ident" id="7117972">expectedPeerCerts</span><span class="op" id="7117989">[</span><span class="ident" id="7117990"><a href="/crypto/tls/handshake_server_test.go.html#7117901">i</a></span><span class="op" id="7117991">]</span><span class="op" id="7117992">)</span><span class="op" id="7117993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7117998">if</span>&nbsp;<span class="op" id="7118001">!</span><span class="ident" id="7118002"><a href="/crypto/tls/handshake_server_test.go.html#7106558">bytes</a></span><span class="op" id="7118007">.</span><span class="ident" id="7118008">Equal</span><span class="op" id="7118013">(</span><span class="ident" id="7118014"><a href="/crypto/tls/handshake_server_test.go.html#7117937">block</a></span><span class="op" id="7118019">.</span><span class="ident" id="7118020">Bytes</span><span class="op" id="7118025">,</span>&nbsp;<span class="ident" id="7118027"><a href="/crypto/tls/handshake_server_test.go.html#7117904">peerCert</a></span><span class="op" id="7118035">.</span><span class="ident" id="7118036">Raw</span><span class="op" id="7118039">)</span>&nbsp;<span class="op" id="7118041">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118047"><a href="/crypto/tls/handshake_server_test.go.html#7115952">t</a></span><span class="op" id="7118048">.</span><span class="ident" id="7118049">Fatalf</span><span class="op" id="7118055">(</span><span class="string" id="7118056">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;cert&nbsp;%d&#34;</span><span class="op" id="7118086">,</span>&nbsp;<span class="ident" id="7118088"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7118092">.</span><span class="ident" id="7118093">name</span><span class="op" id="7118097">,</span>&nbsp;<span class="ident" id="7118099"><a href="/crypto/tls/handshake_server_test.go.html#7117901">i</a></span><span class="op" id="7118100">+</span><span class="num" id="7118101">1</span><span class="op" id="7118102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118114">}</span>&nbsp;<span class="keyword" id="7118116">else</span>&nbsp;<span class="op" id="7118121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118125"><a href="/crypto/tls/handshake_server_test.go.html#7115952">t</a></span><span class="op" id="7118126">.</span><span class="ident" id="7118127">Fatalf</span><span class="op" id="7118133">(</span><span class="string" id="7118134">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;list&nbsp;length:&nbsp;%d&nbsp;(wanted)&nbsp;!=&nbsp;%d&nbsp;(got)&#34;</span><span class="op" id="7118193">,</span>&nbsp;<span class="ident" id="7118195"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7118199">.</span><span class="ident" id="7118200">name</span><span class="op" id="7118204">,</span>&nbsp;<span class="builtinfunc" id="7118206">len</span><span class="op" id="7118209">(</span><span class="ident" id="7118210"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7118214">.</span><span class="ident" id="7118215">expectedPeerCerts</span><span class="op" id="7118232">)</span><span class="op" id="7118233">,</span>&nbsp;<span class="builtinfunc" id="7118235">len</span><span class="op" id="7118238">(</span><span class="ident" id="7118239"><a href="/crypto/tls/handshake_server_test.go.html#7117803">peerCerts</a></span><span class="op" id="7118248">)</span><span class="op" id="7118249">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7118256">if</span>&nbsp;<span class="ident" id="7118259"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7118263">.</span><span class="ident" id="7118264">validate</span>&nbsp;<span class="op" id="7118273">!=</span>&nbsp;<span class="ident" id="7118276">nil</span>&nbsp;<span class="op" id="7118280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7118284">if</span>&nbsp;<span class="ident" id="7118287">err</span>&nbsp;<span class="op" id="7118291">:=</span>&nbsp;<span class="ident" id="7118294"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7118298">.</span><span class="ident" id="7118299">validate</span><span class="op" id="7118307">(</span><span class="ident" id="7118308"><a href="/crypto/tls/handshake_server_test.go.html#7117773">connState</a></span><span class="op" id="7118317">)</span><span class="op" id="7118318">;</span>&nbsp;<span class="ident" id="7118320"><a href="/crypto/tls/handshake_server_test.go.html#7118287">err</a></span>&nbsp;<span class="op" id="7118324">!=</span>&nbsp;<span class="ident" id="7118327">nil</span>&nbsp;<span class="op" id="7118331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118336"><a href="/crypto/tls/handshake_server_test.go.html#7115952">t</a></span><span class="op" id="7118337">.</span><span class="ident" id="7118338">Fatalf</span><span class="op" id="7118344">(</span><span class="string" id="7118345">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7118383">,</span>&nbsp;<span class="ident" id="7118385"><a href="/crypto/tls/handshake_server_test.go.html#7118287">err</a></span><span class="op" id="7118388">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7118399">if</span>&nbsp;<span class="ident" id="7118402"><a href="/crypto/tls/handshake_server_test.go.html#7115966">write</a></span>&nbsp;<span class="op" id="7118408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118412">path</span>&nbsp;<span class="op" id="7118417">:=</span>&nbsp;<span class="ident" id="7118420"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7118424">.</span><span class="ident" id="7118425">dataPath</span><span class="op" id="7118433">(</span><span class="op" id="7118434">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118438">out</span><span class="op" id="7118441">,</span>&nbsp;<span class="ident" id="7118443">err</span>&nbsp;<span class="op" id="7118447">:=</span>&nbsp;<span class="ident" id="7118450"><a href="/crypto/tls/handshake_server_test.go.html#7106690">os</a></span><span class="op" id="7118452">.</span><span class="ident" id="7118453">OpenFile</span><span class="op" id="7118461">(</span><span class="ident" id="7118462"><a href="/crypto/tls/handshake_server_test.go.html#7118412">path</a></span><span class="op" id="7118466">,</span>&nbsp;<span class="ident" id="7118468"><a href="/crypto/tls/handshake_server_test.go.html#7106690">os</a></span><span class="op" id="7118470">.</span><span class="ident" id="7118471">O_WRONLY</span><span class="op" id="7118479">|</span><span class="ident" id="7118480"><a href="/crypto/tls/handshake_server_test.go.html#7106690">os</a></span><span class="op" id="7118482">.</span><span class="ident" id="7118483">O_CREATE</span><span class="op" id="7118491">|</span><span class="ident" id="7118492"><a href="/crypto/tls/handshake_server_test.go.html#7106690">os</a></span><span class="op" id="7118494">.</span><span class="ident" id="7118495">O_TRUNC</span><span class="op" id="7118502">,</span>&nbsp;<span class="num" id="7118504">0644</span><span class="op" id="7118508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7118512">if</span>&nbsp;<span class="ident" id="7118515"><a href="/crypto/tls/handshake_server_test.go.html#7118443">err</a></span>&nbsp;<span class="op" id="7118519">!=</span>&nbsp;<span class="ident" id="7118522">nil</span>&nbsp;<span class="op" id="7118526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118531"><a href="/crypto/tls/handshake_server_test.go.html#7115952">t</a></span><span class="op" id="7118532">.</span><span class="ident" id="7118533">Fatalf</span><span class="op" id="7118539">(</span><span class="string" id="7118540">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="7118574">,</span>&nbsp;<span class="ident" id="7118576"><a href="/crypto/tls/handshake_server_test.go.html#7118443">err</a></span><span class="op" id="7118579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7118587">defer</span>&nbsp;<span class="ident" id="7118593"><a href="/crypto/tls/handshake_server_test.go.html#7118438">out</a></span><span class="op" id="7118596">.</span><span class="ident" id="7118597">Close</span><span class="op" id="7118602">(</span><span class="op" id="7118603">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118607"><a href="/crypto/tls/handshake_server_test.go.html#7116022">recordingConn</a></span><span class="op" id="7118620">.</span><span class="ident" id="7118621">Close</span><span class="op" id="7118626">(</span><span class="op" id="7118627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7118631">if</span>&nbsp;<span class="builtinfunc" id="7118634">len</span><span class="op" id="7118637">(</span><span class="ident" id="7118638"><a href="/crypto/tls/handshake_server_test.go.html#7116022">recordingConn</a></span><span class="op" id="7118651">.</span><span class="ident" id="7118652">flows</span><span class="op" id="7118657">)</span>&nbsp;<span class="op" id="7118659">&lt;</span>&nbsp;<span class="num" id="7118661">3</span>&nbsp;<span class="op" id="7118663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118668"><a href="/crypto/tls/handshake_server_test.go.html#7116056">childProcess</a></span><span class="op" id="7118680">.</span><span class="ident" id="7118681">Stdout</span><span class="op" id="7118687">.</span><span class="op" id="7118688">(</span><span class="op" id="7118689">*</span><span class="ident" id="7118690"><a href="/crypto/tls/handshake_server_test.go.html#7106558">bytes</a></span><span class="op" id="7118695">.</span><span class="ident" id="7118696">Buffer</span><span class="op" id="7118702">)</span><span class="op" id="7118703">.</span><span class="ident" id="7118704">WriteTo</span><span class="op" id="7118711">(</span><span class="ident" id="7118712"><a href="/crypto/tls/handshake_server_test.go.html#7106690">os</a></span><span class="op" id="7118714">.</span><span class="ident" id="7118715">Stdout</span><span class="op" id="7118721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7118726">if</span>&nbsp;<span class="builtinfunc" id="7118729">len</span><span class="op" id="7118732">(</span><span class="ident" id="7118733"><a href="/crypto/tls/handshake_server_test.go.html#7115930">test</a></span><span class="op" id="7118737">.</span><span class="ident" id="7118738">expectHandshakeErrorIncluding</span><span class="op" id="7118767">)</span>&nbsp;<span class="op" id="7118769">==</span>&nbsp;<span class="num" id="7118772">0</span>&nbsp;<span class="op" id="7118774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118780"><a href="/crypto/tls/handshake_server_test.go.html#7115952">t</a></span><span class="op" id="7118781">.</span><span class="ident" id="7118782">Fatalf</span><span class="op" id="7118788">(</span><span class="string" id="7118789">&#34;Handshake&nbsp;failed&#34;</span><span class="op" id="7118807">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118820"><a href="/crypto/tls/handshake_server_test.go.html#7116022">recordingConn</a></span><span class="op" id="7118833">.</span><span class="ident" id="7118834">WriteTo</span><span class="op" id="7118841">(</span><span class="ident" id="7118842"><a href="/crypto/tls/handshake_server_test.go.html#7118438">out</a></span><span class="op" id="7118845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118849"><a href="/crypto/tls/handshake_server_test.go.html#7106658">fmt</a></span><span class="op" id="7118852">.</span><span class="ident" id="7118853">Printf</span><span class="op" id="7118859">(</span><span class="string" id="7118860">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="7118872">,</span>&nbsp;<span class="ident" id="7118874"><a href="/crypto/tls/handshake_server_test.go.html#7118412">path</a></span><span class="op" id="7118878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118882"><a href="/crypto/tls/handshake_server_test.go.html#7116056">childProcess</a></span><span class="op" id="7118894">.</span><span class="ident" id="7118895">Wait</span><span class="op" id="7118899">(</span><span class="op" id="7118900">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7118903">}</span><br>
<span class="lineno"></span><span class="op" id="7118905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7118908">func</span>&nbsp;<span class="ident" id="7118913">runServerTestForVersion</span><span class="op" id="7118936">(</span><span class="ident" id="7118937">t</span>&nbsp;<span class="op" id="7118939">*</span><span class="ident" id="7118940"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7118947">.</span><span class="ident" id="7118948">T</span><span class="op" id="7118949">,</span>&nbsp;<span class="ident" id="7118951">template</span>&nbsp;<span class="op" id="7118960">*</span><span class="ident" id="7118961"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7118971">,</span>&nbsp;<span class="ident" id="7118973">prefix</span><span class="op" id="7118979">,</span>&nbsp;<span class="ident" id="7118981">option</span>&nbsp;<span class="builtintype" id="7118988">string</span><span class="op" id="7118994">)</span>&nbsp;<span class="op" id="7118996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7118999">test</span>&nbsp;<span class="op" id="7119004">:=</span>&nbsp;<span class="op" id="7119007">*</span><span class="ident" id="7119008"><a href="/crypto/tls/handshake_server_test.go.html#7118951">template</a></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119018"><a href="/crypto/tls/handshake_server_test.go.html#7118999">test</a></span><span class="op" id="7119022">.</span><span class="ident" id="7119023">name</span>&nbsp;<span class="op" id="7119028">=</span>&nbsp;<span class="ident" id="7119030"><a href="/crypto/tls/handshake_server_test.go.html#7118973">prefix</a></span>&nbsp;<span class="op" id="7119037">+</span>&nbsp;<span class="ident" id="7119039"><a href="/crypto/tls/handshake_server_test.go.html#7118999">test</a></span><span class="op" id="7119043">.</span><span class="ident" id="7119044">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7119050">if</span>&nbsp;<span class="builtinfunc" id="7119053">len</span><span class="op" id="7119056">(</span><span class="ident" id="7119057"><a href="/crypto/tls/handshake_server_test.go.html#7118999">test</a></span><span class="op" id="7119061">.</span><span class="ident" id="7119062">command</span><span class="op" id="7119069">)</span>&nbsp;<span class="op" id="7119071">==</span>&nbsp;<span class="num" id="7119074">0</span>&nbsp;<span class="op" id="7119076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119080"><a href="/crypto/tls/handshake_server_test.go.html#7118999">test</a></span><span class="op" id="7119084">.</span><span class="ident" id="7119085">command</span>&nbsp;<span class="op" id="7119093">=</span>&nbsp;<span class="ident" id="7119095"><a href="/crypto/tls/handshake_server_test.go.html#7114134">defaultClientCommand</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7119117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119120"><a href="/crypto/tls/handshake_server_test.go.html#7118999">test</a></span><span class="op" id="7119124">.</span><span class="ident" id="7119125">command</span>&nbsp;<span class="op" id="7119133">=</span>&nbsp;<span class="builtinfunc" id="7119135">append</span><span class="op" id="7119141">(</span><span class="op" id="7119142">[</span><span class="op" id="7119143">]</span><span class="builtintype" id="7119144">string</span><span class="op" id="7119150">(</span><span class="ident" id="7119151">nil</span><span class="op" id="7119154">)</span><span class="op" id="7119155">,</span>&nbsp;<span class="ident" id="7119157"><a href="/crypto/tls/handshake_server_test.go.html#7118999">test</a></span><span class="op" id="7119161">.</span><span class="ident" id="7119162">command</span><span class="op" id="7119169">...</span><span class="op" id="7119172">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119175"><a href="/crypto/tls/handshake_server_test.go.html#7118999">test</a></span><span class="op" id="7119179">.</span><span class="ident" id="7119180">command</span>&nbsp;<span class="op" id="7119188">=</span>&nbsp;<span class="builtinfunc" id="7119190">append</span><span class="op" id="7119196">(</span><span class="ident" id="7119197"><a href="/crypto/tls/handshake_server_test.go.html#7118999">test</a></span><span class="op" id="7119201">.</span><span class="ident" id="7119202">command</span><span class="op" id="7119209">,</span>&nbsp;<span class="ident" id="7119211"><a href="/crypto/tls/handshake_server_test.go.html#7118981">option</a></span><span class="op" id="7119217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119220"><a href="/crypto/tls/handshake_server_test.go.html#7118999">test</a></span><span class="op" id="7119224">.</span><span class="ident" id="7119225">run</span><span class="op" id="7119228">(</span><span class="ident" id="7119229"><a href="/crypto/tls/handshake_server_test.go.html#7118937">t</a></span><span class="op" id="7119230">,</span>&nbsp;<span class="op" id="7119232">*</span><span class="ident" id="7119233"><a href="/crypto/tls/handshake_test.go.html#7138612">update</a></span><span class="op" id="7119239">)</span><br>
<span class="lineno"></span><span class="op" id="7119241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7119244">func</span>&nbsp;<span class="ident" id="7119249">runServerTestSSLv3</span><span class="op" id="7119267">(</span><span class="ident" id="7119268">t</span>&nbsp;<span class="op" id="7119270">*</span><span class="ident" id="7119271"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7119278">.</span><span class="ident" id="7119279">T</span><span class="op" id="7119280">,</span>&nbsp;<span class="ident" id="7119282">template</span>&nbsp;<span class="op" id="7119291">*</span><span class="ident" id="7119292"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7119302">)</span>&nbsp;<span class="op" id="7119304">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119307"><a href="/crypto/tls/handshake_server_test.go.html#7118913">runServerTestForVersion</a></span><span class="op" id="7119330">(</span><span class="ident" id="7119331"><a href="/crypto/tls/handshake_server_test.go.html#7119268">t</a></span><span class="op" id="7119332">,</span>&nbsp;<span class="ident" id="7119334"><a href="/crypto/tls/handshake_server_test.go.html#7119282">template</a></span><span class="op" id="7119342">,</span>&nbsp;<span class="string" id="7119344">&#34;SSLv3-&#34;</span><span class="op" id="7119352">,</span>&nbsp;<span class="string" id="7119354">&#34;-ssl3&#34;</span><span class="op" id="7119361">)</span><br>
<span class="lineno"></span><span class="op" id="7119363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7119366">func</span>&nbsp;<span class="ident" id="7119371">runServerTestTLS10</span><span class="op" id="7119389">(</span><span class="ident" id="7119390">t</span>&nbsp;<span class="op" id="7119392">*</span><span class="ident" id="7119393"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7119400">.</span><span class="ident" id="7119401">T</span><span class="op" id="7119402">,</span>&nbsp;<span class="ident" id="7119404">template</span>&nbsp;<span class="op" id="7119413">*</span><span class="ident" id="7119414"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7119424">)</span>&nbsp;<span class="op" id="7119426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119429"><a href="/crypto/tls/handshake_server_test.go.html#7118913">runServerTestForVersion</a></span><span class="op" id="7119452">(</span><span class="ident" id="7119453"><a href="/crypto/tls/handshake_server_test.go.html#7119390">t</a></span><span class="op" id="7119454">,</span>&nbsp;<span class="ident" id="7119456"><a href="/crypto/tls/handshake_server_test.go.html#7119404">template</a></span><span class="op" id="7119464">,</span>&nbsp;<span class="string" id="7119466">&#34;TLSv10-&#34;</span><span class="op" id="7119475">,</span>&nbsp;<span class="string" id="7119477">&#34;-tls1&#34;</span><span class="op" id="7119484">)</span><br>
<span class="lineno">470</span><span class="op" id="7119486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7119489">func</span>&nbsp;<span class="ident" id="7119494">runServerTestTLS11</span><span class="op" id="7119512">(</span><span class="ident" id="7119513">t</span>&nbsp;<span class="op" id="7119515">*</span><span class="ident" id="7119516"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7119523">.</span><span class="ident" id="7119524">T</span><span class="op" id="7119525">,</span>&nbsp;<span class="ident" id="7119527">template</span>&nbsp;<span class="op" id="7119536">*</span><span class="ident" id="7119537"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7119547">)</span>&nbsp;<span class="op" id="7119549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119552"><a href="/crypto/tls/handshake_server_test.go.html#7118913">runServerTestForVersion</a></span><span class="op" id="7119575">(</span><span class="ident" id="7119576"><a href="/crypto/tls/handshake_server_test.go.html#7119513">t</a></span><span class="op" id="7119577">,</span>&nbsp;<span class="ident" id="7119579"><a href="/crypto/tls/handshake_server_test.go.html#7119527">template</a></span><span class="op" id="7119587">,</span>&nbsp;<span class="string" id="7119589">&#34;TLSv11-&#34;</span><span class="op" id="7119598">,</span>&nbsp;<span class="string" id="7119600">&#34;-tls1_1&#34;</span><span class="op" id="7119609">)</span><br>
<span class="lineno"></span><span class="op" id="7119611">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="7119614">func</span>&nbsp;<span class="ident" id="7119619">runServerTestTLS12</span><span class="op" id="7119637">(</span><span class="ident" id="7119638">t</span>&nbsp;<span class="op" id="7119640">*</span><span class="ident" id="7119641"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7119648">.</span><span class="ident" id="7119649">T</span><span class="op" id="7119650">,</span>&nbsp;<span class="ident" id="7119652">template</span>&nbsp;<span class="op" id="7119661">*</span><span class="ident" id="7119662"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7119672">)</span>&nbsp;<span class="op" id="7119674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119677"><a href="/crypto/tls/handshake_server_test.go.html#7118913">runServerTestForVersion</a></span><span class="op" id="7119700">(</span><span class="ident" id="7119701"><a href="/crypto/tls/handshake_server_test.go.html#7119638">t</a></span><span class="op" id="7119702">,</span>&nbsp;<span class="ident" id="7119704"><a href="/crypto/tls/handshake_server_test.go.html#7119652">template</a></span><span class="op" id="7119712">,</span>&nbsp;<span class="string" id="7119714">&#34;TLSv12-&#34;</span><span class="op" id="7119723">,</span>&nbsp;<span class="string" id="7119725">&#34;-tls1_2&#34;</span><span class="op" id="7119734">)</span><br>
<span class="lineno"></span><span class="op" id="7119736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="7119739">func</span>&nbsp;<span class="ident" id="7119744">TestHandshakeServerRSARC4</span><span class="op" id="7119769">(</span><span class="ident" id="7119770">t</span>&nbsp;<span class="op" id="7119772">*</span><span class="ident" id="7119773"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7119780">.</span><span class="ident" id="7119781">T</span><span class="op" id="7119782">)</span>&nbsp;<span class="op" id="7119784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119787">test</span>&nbsp;<span class="op" id="7119792">:=</span>&nbsp;<span class="op" id="7119795">&amp;</span><span class="ident" id="7119796"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7119806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119810">name</span><span class="op" id="7119814">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7119819">&#34;RSA-RC4&#34;</span><span class="op" id="7119828">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119832">command</span><span class="op" id="7119839">:</span>&nbsp;<span class="op" id="7119841">[</span><span class="op" id="7119842">]</span><span class="builtintype" id="7119843">string</span><span class="op" id="7119849">{</span><span class="string" id="7119850">&#34;openssl&#34;</span><span class="op" id="7119859">,</span>&nbsp;<span class="string" id="7119861">&#34;s_client&#34;</span><span class="op" id="7119871">,</span>&nbsp;<span class="string" id="7119873">&#34;-no_ticket&#34;</span><span class="op" id="7119885">,</span>&nbsp;<span class="string" id="7119887">&#34;-cipher&#34;</span><span class="op" id="7119896">,</span>&nbsp;<span class="string" id="7119898">&#34;RC4-SHA&#34;</span><span class="op" id="7119907">}</span><span class="op" id="7119908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7119911">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119914"><a href="/crypto/tls/handshake_server_test.go.html#7119249">runServerTestSSLv3</a></span><span class="op" id="7119932">(</span><span class="ident" id="7119933"><a href="/crypto/tls/handshake_server_test.go.html#7119770">t</a></span><span class="op" id="7119934">,</span>&nbsp;<span class="ident" id="7119936"><a href="/crypto/tls/handshake_server_test.go.html#7119787">test</a></span><span class="op" id="7119940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119943"><a href="/crypto/tls/handshake_server_test.go.html#7119371">runServerTestTLS10</a></span><span class="op" id="7119961">(</span><span class="ident" id="7119962"><a href="/crypto/tls/handshake_server_test.go.html#7119770">t</a></span><span class="op" id="7119963">,</span>&nbsp;<span class="ident" id="7119965"><a href="/crypto/tls/handshake_server_test.go.html#7119787">test</a></span><span class="op" id="7119969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7119972"><a href="/crypto/tls/handshake_server_test.go.html#7119494">runServerTestTLS11</a></span><span class="op" id="7119990">(</span><span class="ident" id="7119991"><a href="/crypto/tls/handshake_server_test.go.html#7119770">t</a></span><span class="op" id="7119992">,</span>&nbsp;<span class="ident" id="7119994"><a href="/crypto/tls/handshake_server_test.go.html#7119787">test</a></span><span class="op" id="7119998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120001"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7120019">(</span><span class="ident" id="7120020"><a href="/crypto/tls/handshake_server_test.go.html#7119770">t</a></span><span class="op" id="7120021">,</span>&nbsp;<span class="ident" id="7120023"><a href="/crypto/tls/handshake_server_test.go.html#7119787">test</a></span><span class="op" id="7120027">)</span><br>
<span class="lineno"></span><span class="op" id="7120029">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="7120032">func</span>&nbsp;<span class="ident" id="7120037">TestHandshakeServerRSA3DES</span><span class="op" id="7120063">(</span><span class="ident" id="7120064">t</span>&nbsp;<span class="op" id="7120066">*</span><span class="ident" id="7120067"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7120074">.</span><span class="ident" id="7120075">T</span><span class="op" id="7120076">)</span>&nbsp;<span class="op" id="7120078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120081">test</span>&nbsp;<span class="op" id="7120086">:=</span>&nbsp;<span class="op" id="7120089">&amp;</span><span class="ident" id="7120090"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7120100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120104">name</span><span class="op" id="7120108">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7120113">&#34;RSA-3DES&#34;</span><span class="op" id="7120123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120127">command</span><span class="op" id="7120134">:</span>&nbsp;<span class="op" id="7120136">[</span><span class="op" id="7120137">]</span><span class="builtintype" id="7120138">string</span><span class="op" id="7120144">{</span><span class="string" id="7120145">&#34;openssl&#34;</span><span class="op" id="7120154">,</span>&nbsp;<span class="string" id="7120156">&#34;s_client&#34;</span><span class="op" id="7120166">,</span>&nbsp;<span class="string" id="7120168">&#34;-no_ticket&#34;</span><span class="op" id="7120180">,</span>&nbsp;<span class="string" id="7120182">&#34;-cipher&#34;</span><span class="op" id="7120191">,</span>&nbsp;<span class="string" id="7120193">&#34;DES-CBC3-SHA&#34;</span><span class="op" id="7120207">}</span><span class="op" id="7120208">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7120211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120214"><a href="/crypto/tls/handshake_server_test.go.html#7119249">runServerTestSSLv3</a></span><span class="op" id="7120232">(</span><span class="ident" id="7120233"><a href="/crypto/tls/handshake_server_test.go.html#7120064">t</a></span><span class="op" id="7120234">,</span>&nbsp;<span class="ident" id="7120236"><a href="/crypto/tls/handshake_server_test.go.html#7120081">test</a></span><span class="op" id="7120240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120243"><a href="/crypto/tls/handshake_server_test.go.html#7119371">runServerTestTLS10</a></span><span class="op" id="7120261">(</span><span class="ident" id="7120262"><a href="/crypto/tls/handshake_server_test.go.html#7120064">t</a></span><span class="op" id="7120263">,</span>&nbsp;<span class="ident" id="7120265"><a href="/crypto/tls/handshake_server_test.go.html#7120081">test</a></span><span class="op" id="7120269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120272"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7120290">(</span><span class="ident" id="7120291"><a href="/crypto/tls/handshake_server_test.go.html#7120064">t</a></span><span class="op" id="7120292">,</span>&nbsp;<span class="ident" id="7120294"><a href="/crypto/tls/handshake_server_test.go.html#7120081">test</a></span><span class="op" id="7120298">)</span><br>
<span class="lineno"></span><span class="op" id="7120300">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="7120303">func</span>&nbsp;<span class="ident" id="7120308">TestHandshakeServerRSAAES</span><span class="op" id="7120333">(</span><span class="ident" id="7120334">t</span>&nbsp;<span class="op" id="7120336">*</span><span class="ident" id="7120337"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7120344">.</span><span class="ident" id="7120345">T</span><span class="op" id="7120346">)</span>&nbsp;<span class="op" id="7120348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120351">test</span>&nbsp;<span class="op" id="7120356">:=</span>&nbsp;<span class="op" id="7120359">&amp;</span><span class="ident" id="7120360"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7120370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120374">name</span><span class="op" id="7120378">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7120383">&#34;RSA-AES&#34;</span><span class="op" id="7120392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120396">command</span><span class="op" id="7120403">:</span>&nbsp;<span class="op" id="7120405">[</span><span class="op" id="7120406">]</span><span class="builtintype" id="7120407">string</span><span class="op" id="7120413">{</span><span class="string" id="7120414">&#34;openssl&#34;</span><span class="op" id="7120423">,</span>&nbsp;<span class="string" id="7120425">&#34;s_client&#34;</span><span class="op" id="7120435">,</span>&nbsp;<span class="string" id="7120437">&#34;-no_ticket&#34;</span><span class="op" id="7120449">,</span>&nbsp;<span class="string" id="7120451">&#34;-cipher&#34;</span><span class="op" id="7120460">,</span>&nbsp;<span class="string" id="7120462">&#34;AES128-SHA&#34;</span><span class="op" id="7120474">}</span><span class="op" id="7120475">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7120478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120481"><a href="/crypto/tls/handshake_server_test.go.html#7119249">runServerTestSSLv3</a></span><span class="op" id="7120499">(</span><span class="ident" id="7120500"><a href="/crypto/tls/handshake_server_test.go.html#7120334">t</a></span><span class="op" id="7120501">,</span>&nbsp;<span class="ident" id="7120503"><a href="/crypto/tls/handshake_server_test.go.html#7120351">test</a></span><span class="op" id="7120507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120510"><a href="/crypto/tls/handshake_server_test.go.html#7119371">runServerTestTLS10</a></span><span class="op" id="7120528">(</span><span class="ident" id="7120529"><a href="/crypto/tls/handshake_server_test.go.html#7120334">t</a></span><span class="op" id="7120530">,</span>&nbsp;<span class="ident" id="7120532"><a href="/crypto/tls/handshake_server_test.go.html#7120351">test</a></span><span class="op" id="7120536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120539"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7120557">(</span><span class="ident" id="7120558"><a href="/crypto/tls/handshake_server_test.go.html#7120334">t</a></span><span class="op" id="7120559">,</span>&nbsp;<span class="ident" id="7120561"><a href="/crypto/tls/handshake_server_test.go.html#7120351">test</a></span><span class="op" id="7120565">)</span><br>
<span class="lineno"></span><span class="op" id="7120567">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="keyword" id="7120570">func</span>&nbsp;<span class="ident" id="7120575">TestHandshakeServerAESGCM</span><span class="op" id="7120600">(</span><span class="ident" id="7120601">t</span>&nbsp;<span class="op" id="7120603">*</span><span class="ident" id="7120604"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7120611">.</span><span class="ident" id="7120612">T</span><span class="op" id="7120613">)</span>&nbsp;<span class="op" id="7120615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120618">test</span>&nbsp;<span class="op" id="7120623">:=</span>&nbsp;<span class="op" id="7120626">&amp;</span><span class="ident" id="7120627"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7120637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120641">name</span><span class="op" id="7120645">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7120650">&#34;RSA-AES-GCM&#34;</span><span class="op" id="7120663">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120667">command</span><span class="op" id="7120674">:</span>&nbsp;<span class="op" id="7120676">[</span><span class="op" id="7120677">]</span><span class="builtintype" id="7120678">string</span><span class="op" id="7120684">{</span><span class="string" id="7120685">&#34;openssl&#34;</span><span class="op" id="7120694">,</span>&nbsp;<span class="string" id="7120696">&#34;s_client&#34;</span><span class="op" id="7120706">,</span>&nbsp;<span class="string" id="7120708">&#34;-no_ticket&#34;</span><span class="op" id="7120720">,</span>&nbsp;<span class="string" id="7120722">&#34;-cipher&#34;</span><span class="op" id="7120731">,</span>&nbsp;<span class="string" id="7120733">&#34;ECDHE-RSA-AES128-GCM-SHA256&#34;</span><span class="op" id="7120762">}</span><span class="op" id="7120763">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7120766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120769"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7120787">(</span><span class="ident" id="7120788"><a href="/crypto/tls/handshake_server_test.go.html#7120601">t</a></span><span class="op" id="7120789">,</span>&nbsp;<span class="ident" id="7120791"><a href="/crypto/tls/handshake_server_test.go.html#7120618">test</a></span><span class="op" id="7120795">)</span><br>
<span class="lineno"></span><span class="op" id="7120797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7120800">func</span>&nbsp;<span class="ident" id="7120805">TestHandshakeServerECDHEECDSAAES</span><span class="op" id="7120837">(</span><span class="ident" id="7120838">t</span>&nbsp;<span class="op" id="7120840">*</span><span class="ident" id="7120841"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7120848">.</span><span class="ident" id="7120849">T</span><span class="op" id="7120850">)</span>&nbsp;<span class="op" id="7120852">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120855">config</span>&nbsp;<span class="op" id="7120862">:=</span>&nbsp;<span class="op" id="7120865">*</span><span class="ident" id="7120866"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120878"><a href="/crypto/tls/handshake_server_test.go.html#7120855">config</a></span><span class="op" id="7120884">.</span><span class="ident" id="7120885">Certificates</span>&nbsp;<span class="op" id="7120898">=</span>&nbsp;<span class="builtinfunc" id="7120900">make</span><span class="op" id="7120904">(</span><span class="op" id="7120905">[</span><span class="op" id="7120906">]</span><span class="ident" id="7120907"><a href="/crypto/tls/common.go.html#4123683">Certificate</a></span><span class="op" id="7120918">,</span>&nbsp;<span class="num" id="7120920">1</span><span class="op" id="7120921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120924"><a href="/crypto/tls/handshake_server_test.go.html#7120855">config</a></span><span class="op" id="7120930">.</span><span class="ident" id="7120931">Certificates</span><span class="op" id="7120943">[</span><span class="num" id="7120944">0</span><span class="op" id="7120945">]</span><span class="op" id="7120946">.</span><span class="ident" id="7120947">Certificate</span>&nbsp;<span class="op" id="7120959">=</span>&nbsp;<span class="op" id="7120961">[</span><span class="op" id="7120962">]</span><span class="op" id="7120963">[</span><span class="op" id="7120964">]</span><span class="builtintype" id="7120965">byte</span><span class="op" id="7120969">{</span><span class="ident" id="7120970"><a href="/crypto/tls/handshake_server_test.go.html#7133477">testECDSACertificate</a></span><span class="op" id="7120990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7120993"><a href="/crypto/tls/handshake_server_test.go.html#7120855">config</a></span><span class="op" id="7120999">.</span><span class="ident" id="7121000">Certificates</span><span class="op" id="7121012">[</span><span class="num" id="7121013">0</span><span class="op" id="7121014">]</span><span class="op" id="7121015">.</span><span class="ident" id="7121016">PrivateKey</span>&nbsp;<span class="op" id="7121027">=</span>&nbsp;<span class="ident" id="7121029"><a href="/crypto/tls/handshake_server_test.go.html#7136719">testECDSAPrivateKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121050"><a href="/crypto/tls/handshake_server_test.go.html#7120855">config</a></span><span class="op" id="7121056">.</span><span class="ident" id="7121057">BuildNameToCertificate</span><span class="op" id="7121079">(</span><span class="op" id="7121080">)</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121084">test</span>&nbsp;<span class="op" id="7121089">:=</span>&nbsp;<span class="op" id="7121092">&amp;</span><span class="ident" id="7121093"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7121103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121107">name</span><span class="op" id="7121111">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7121116">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="7121133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121137">command</span><span class="op" id="7121144">:</span>&nbsp;<span class="op" id="7121146">[</span><span class="op" id="7121147">]</span><span class="builtintype" id="7121148">string</span><span class="op" id="7121154">{</span><span class="string" id="7121155">&#34;openssl&#34;</span><span class="op" id="7121164">,</span>&nbsp;<span class="string" id="7121166">&#34;s_client&#34;</span><span class="op" id="7121176">,</span>&nbsp;<span class="string" id="7121178">&#34;-no_ticket&#34;</span><span class="op" id="7121190">,</span>&nbsp;<span class="string" id="7121192">&#34;-cipher&#34;</span><span class="op" id="7121201">,</span>&nbsp;<span class="string" id="7121203">&#34;ECDHE-ECDSA-AES256-SHA&#34;</span><span class="op" id="7121227">}</span><span class="op" id="7121228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121232">config</span><span class="op" id="7121238">:</span>&nbsp;&nbsp;<span class="op" id="7121241">&amp;</span><span class="ident" id="7121242"><a href="/crypto/tls/handshake_server_test.go.html#7120855">config</a></span><span class="op" id="7121248">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7121251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121254"><a href="/crypto/tls/handshake_server_test.go.html#7119371">runServerTestTLS10</a></span><span class="op" id="7121272">(</span><span class="ident" id="7121273"><a href="/crypto/tls/handshake_server_test.go.html#7120838">t</a></span><span class="op" id="7121274">,</span>&nbsp;<span class="ident" id="7121276"><a href="/crypto/tls/handshake_server_test.go.html#7121084">test</a></span><span class="op" id="7121280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121283"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7121301">(</span><span class="ident" id="7121302"><a href="/crypto/tls/handshake_server_test.go.html#7120838">t</a></span><span class="op" id="7121303">,</span>&nbsp;<span class="ident" id="7121305"><a href="/crypto/tls/handshake_server_test.go.html#7121084">test</a></span><span class="op" id="7121309">)</span><br>
<span class="lineno"></span><span class="op" id="7121311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="7121314">func</span>&nbsp;<span class="ident" id="7121319">TestHandshakeServerALPN</span><span class="op" id="7121342">(</span><span class="ident" id="7121343">t</span>&nbsp;<span class="op" id="7121345">*</span><span class="ident" id="7121346"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7121353">.</span><span class="ident" id="7121354">T</span><span class="op" id="7121355">)</span>&nbsp;<span class="op" id="7121357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121360">config</span>&nbsp;<span class="op" id="7121367">:=</span>&nbsp;<span class="op" id="7121370">*</span><span class="ident" id="7121371"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121383"><a href="/crypto/tls/handshake_server_test.go.html#7121360">config</a></span><span class="op" id="7121389">.</span><span class="ident" id="7121390">NextProtos</span>&nbsp;<span class="op" id="7121401">=</span>&nbsp;<span class="op" id="7121403">[</span><span class="op" id="7121404">]</span><span class="builtintype" id="7121405">string</span><span class="op" id="7121411">{</span><span class="string" id="7121412">&#34;proto1&#34;</span><span class="op" id="7121420">,</span>&nbsp;<span class="string" id="7121422">&#34;proto2&#34;</span><span class="op" id="7121430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121434">test</span>&nbsp;<span class="op" id="7121439">:=</span>&nbsp;<span class="op" id="7121442">&amp;</span><span class="ident" id="7121443"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7121453">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121457">name</span><span class="op" id="7121461">:</span>&nbsp;<span class="string" id="7121463">&#34;ALPN&#34;</span><span class="op" id="7121469">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7121473">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7121539">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121582">command</span><span class="op" id="7121589">:</span>&nbsp;<span class="op" id="7121591">[</span><span class="op" id="7121592">]</span><span class="builtintype" id="7121593">string</span><span class="op" id="7121599">{</span><span class="string" id="7121600">&#34;openssl&#34;</span><span class="op" id="7121609">,</span>&nbsp;<span class="string" id="7121611">&#34;s_client&#34;</span><span class="op" id="7121621">,</span>&nbsp;<span class="string" id="7121623">&#34;-alpn&#34;</span><span class="op" id="7121630">,</span>&nbsp;<span class="string" id="7121632">&#34;proto2,proto1&#34;</span><span class="op" id="7121647">}</span><span class="op" id="7121648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121652">config</span><span class="op" id="7121658">:</span>&nbsp;&nbsp;<span class="op" id="7121661">&amp;</span><span class="ident" id="7121662"><a href="/crypto/tls/handshake_server_test.go.html#7121360">config</a></span><span class="op" id="7121668">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121672">validate</span><span class="op" id="7121680">:</span>&nbsp;<span class="keyword" id="7121682">func</span><span class="op" id="7121686">(</span><span class="ident" id="7121687">state</span>&nbsp;<span class="ident" id="7121693"><a href="/crypto/tls/common.go.html#4112190">ConnectionState</a></span><span class="op" id="7121708">)</span>&nbsp;<span class="builtintype" id="7121710">error</span>&nbsp;<span class="op" id="7121716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7121721">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7121780">if</span>&nbsp;<span class="ident" id="7121783"><a href="/crypto/tls/handshake_server_test.go.html#7121687">state</a></span><span class="op" id="7121788">.</span><span class="ident" id="7121789">NegotiatedProtocol</span>&nbsp;<span class="op" id="7121808">!=</span>&nbsp;<span class="string" id="7121811">&#34;proto1&#34;</span>&nbsp;<span class="op" id="7121820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7121826">return</span>&nbsp;<span class="ident" id="7121833"><a href="/crypto/tls/handshake_server_test.go.html#7106658">fmt</a></span><span class="op" id="7121836">.</span><span class="ident" id="7121837">Errorf</span><span class="op" id="7121843">(</span><span class="string" id="7121844">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="7121876">,</span>&nbsp;<span class="ident" id="7121878"><a href="/crypto/tls/handshake_server_test.go.html#7121687">state</a></span><span class="op" id="7121883">.</span><span class="ident" id="7121884">NegotiatedProtocol</span><span class="op" id="7121902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7121907">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7121912">return</span>&nbsp;<span class="ident" id="7121919">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7121925">}</span><span class="op" id="7121926">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7121929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7121932"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7121950">(</span><span class="ident" id="7121951"><a href="/crypto/tls/handshake_server_test.go.html#7121343">t</a></span><span class="op" id="7121952">,</span>&nbsp;<span class="ident" id="7121954"><a href="/crypto/tls/handshake_server_test.go.html#7121434">test</a></span><span class="op" id="7121958">)</span><br>
<span class="lineno"></span><span class="op" id="7121960">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="7121963">func</span>&nbsp;<span class="ident" id="7121968">TestHandshakeServerALPNNoMatch</span><span class="op" id="7121998">(</span><span class="ident" id="7121999">t</span>&nbsp;<span class="op" id="7122001">*</span><span class="ident" id="7122002"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7122009">.</span><span class="ident" id="7122010">T</span><span class="op" id="7122011">)</span>&nbsp;<span class="op" id="7122013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122016">config</span>&nbsp;<span class="op" id="7122023">:=</span>&nbsp;<span class="op" id="7122026">*</span><span class="ident" id="7122027"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122039"><a href="/crypto/tls/handshake_server_test.go.html#7122016">config</a></span><span class="op" id="7122045">.</span><span class="ident" id="7122046">NextProtos</span>&nbsp;<span class="op" id="7122057">=</span>&nbsp;<span class="op" id="7122059">[</span><span class="op" id="7122060">]</span><span class="builtintype" id="7122061">string</span><span class="op" id="7122067">{</span><span class="string" id="7122068">&#34;proto3&#34;</span><span class="op" id="7122076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122080">test</span>&nbsp;<span class="op" id="7122085">:=</span>&nbsp;<span class="op" id="7122088">&amp;</span><span class="ident" id="7122089"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7122099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122103">name</span><span class="op" id="7122107">:</span>&nbsp;<span class="string" id="7122109">&#34;ALPN-NoMatch&#34;</span><span class="op" id="7122123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7122127">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7122193">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122236">command</span><span class="op" id="7122243">:</span>&nbsp;<span class="op" id="7122245">[</span><span class="op" id="7122246">]</span><span class="builtintype" id="7122247">string</span><span class="op" id="7122253">{</span><span class="string" id="7122254">&#34;openssl&#34;</span><span class="op" id="7122263">,</span>&nbsp;<span class="string" id="7122265">&#34;s_client&#34;</span><span class="op" id="7122275">,</span>&nbsp;<span class="string" id="7122277">&#34;-alpn&#34;</span><span class="op" id="7122284">,</span>&nbsp;<span class="string" id="7122286">&#34;proto2,proto1&#34;</span><span class="op" id="7122301">}</span><span class="op" id="7122302">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122306">config</span><span class="op" id="7122312">:</span>&nbsp;&nbsp;<span class="op" id="7122315">&amp;</span><span class="ident" id="7122316"><a href="/crypto/tls/handshake_server_test.go.html#7122016">config</a></span><span class="op" id="7122322">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122326">validate</span><span class="op" id="7122334">:</span>&nbsp;<span class="keyword" id="7122336">func</span><span class="op" id="7122340">(</span><span class="ident" id="7122341">state</span>&nbsp;<span class="ident" id="7122347"><a href="/crypto/tls/common.go.html#4112190">ConnectionState</a></span><span class="op" id="7122362">)</span>&nbsp;<span class="builtintype" id="7122364">error</span>&nbsp;<span class="op" id="7122370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7122375">//&nbsp;Rather&nbsp;than&nbsp;reject&nbsp;the&nbsp;connection,&nbsp;Go&nbsp;doesn&#39;t&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7122434">//&nbsp;a&nbsp;protocol&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;overlap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122477">if</span>&nbsp;<span class="ident" id="7122480"><a href="/crypto/tls/handshake_server_test.go.html#7122341">state</a></span><span class="op" id="7122485">.</span><span class="ident" id="7122486">NegotiatedProtocol</span>&nbsp;<span class="op" id="7122505">!=</span>&nbsp;<span class="string" id="7122508">&#34;&#34;</span>&nbsp;<span class="op" id="7122511">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122517">return</span>&nbsp;<span class="ident" id="7122524"><a href="/crypto/tls/handshake_server_test.go.html#7106658">fmt</a></span><span class="op" id="7122527">.</span><span class="ident" id="7122528">Errorf</span><span class="op" id="7122534">(</span><span class="string" id="7122535">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="7122563">,</span>&nbsp;<span class="ident" id="7122565"><a href="/crypto/tls/handshake_server_test.go.html#7122341">state</a></span><span class="op" id="7122570">.</span><span class="ident" id="7122571">NegotiatedProtocol</span><span class="op" id="7122589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7122594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122599">return</span>&nbsp;<span class="ident" id="7122606">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7122612">}</span><span class="op" id="7122613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7122616">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122619"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7122637">(</span><span class="ident" id="7122638"><a href="/crypto/tls/handshake_server_test.go.html#7121999">t</a></span><span class="op" id="7122639">,</span>&nbsp;<span class="ident" id="7122641"><a href="/crypto/tls/handshake_server_test.go.html#7122080">test</a></span><span class="op" id="7122645">)</span><br>
<span class="lineno"></span><span class="op" id="7122647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7122650">//&nbsp;TestHandshakeServerSNI&nbsp;involves&nbsp;a&nbsp;client&nbsp;sending&nbsp;an&nbsp;SNI&nbsp;extension&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="7122722">//&nbsp;&#34;snitest.com&#34;,&nbsp;which&nbsp;happens&nbsp;to&nbsp;match&nbsp;the&nbsp;CN&nbsp;of&nbsp;testSNICertificate.&nbsp;The&nbsp;test</span><br>
<span class="lineno">580</span><span class="comment" id="7122802">//&nbsp;verifies&nbsp;that&nbsp;the&nbsp;server&nbsp;correctly&nbsp;selects&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="7122866">func</span>&nbsp;<span class="ident" id="7122871">TestHandshakeServerSNI</span><span class="op" id="7122893">(</span><span class="ident" id="7122894">t</span>&nbsp;<span class="op" id="7122896">*</span><span class="ident" id="7122897"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7122904">.</span><span class="ident" id="7122905">T</span><span class="op" id="7122906">)</span>&nbsp;<span class="op" id="7122908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122911">test</span>&nbsp;<span class="op" id="7122916">:=</span>&nbsp;<span class="op" id="7122919">&amp;</span><span class="ident" id="7122920"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7122930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122934">name</span><span class="op" id="7122938">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7122943">&#34;SNI&#34;</span><span class="op" id="7122948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122952">command</span><span class="op" id="7122959">:</span>&nbsp;<span class="op" id="7122961">[</span><span class="op" id="7122962">]</span><span class="builtintype" id="7122963">string</span><span class="op" id="7122969">{</span><span class="string" id="7122970">&#34;openssl&#34;</span><span class="op" id="7122979">,</span>&nbsp;<span class="string" id="7122981">&#34;s_client&#34;</span><span class="op" id="7122991">,</span>&nbsp;<span class="string" id="7122993">&#34;-no_ticket&#34;</span><span class="op" id="7123005">,</span>&nbsp;<span class="string" id="7123007">&#34;-cipher&#34;</span><span class="op" id="7123016">,</span>&nbsp;<span class="string" id="7123018">&#34;AES128-SHA&#34;</span><span class="op" id="7123030">,</span>&nbsp;<span class="string" id="7123032">&#34;-servername&#34;</span><span class="op" id="7123045">,</span>&nbsp;<span class="string" id="7123047">&#34;snitest.com&#34;</span><span class="op" id="7123060">}</span><span class="op" id="7123061">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123067"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7123085">(</span><span class="ident" id="7123086"><a href="/crypto/tls/handshake_server_test.go.html#7122894">t</a></span><span class="op" id="7123087">,</span>&nbsp;<span class="ident" id="7123089"><a href="/crypto/tls/handshake_server_test.go.html#7122911">test</a></span><span class="op" id="7123093">)</span><br>
<span class="lineno"></span><span class="op" id="7123095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7123098">//&nbsp;TestHandshakeServerSNICertForName&nbsp;is&nbsp;similar&nbsp;to&nbsp;TestHandshakeServerSNI,&nbsp;but</span><br>
<span class="lineno">590</span><span class="comment" id="7123177">//&nbsp;tests&nbsp;the&nbsp;dynamic&nbsp;GetCertificate&nbsp;method</span><br>
<span class="lineno"></span><span class="keyword" id="7123220">func</span>&nbsp;<span class="ident" id="7123225">TestHandshakeServerSNIGetCertificate</span><span class="op" id="7123261">(</span><span class="ident" id="7123262">t</span>&nbsp;<span class="op" id="7123264">*</span><span class="ident" id="7123265"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7123272">.</span><span class="ident" id="7123273">T</span><span class="op" id="7123274">)</span>&nbsp;<span class="op" id="7123276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123279">config</span>&nbsp;<span class="op" id="7123286">:=</span>&nbsp;<span class="op" id="7123289">*</span><span class="ident" id="7123290"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7123303">//&nbsp;Replace&nbsp;the&nbsp;NameToCertificate&nbsp;map&nbsp;with&nbsp;a&nbsp;GetCertificate&nbsp;function</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123372">nameToCert</span>&nbsp;<span class="op" id="7123383">:=</span>&nbsp;<span class="ident" id="7123386"><a href="/crypto/tls/handshake_server_test.go.html#7123279">config</a></span><span class="op" id="7123392">.</span><span class="ident" id="7123393">NameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123412"><a href="/crypto/tls/handshake_server_test.go.html#7123279">config</a></span><span class="op" id="7123418">.</span><span class="ident" id="7123419">NameToCertificate</span>&nbsp;<span class="op" id="7123437">=</span>&nbsp;<span class="ident" id="7123439">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123444"><a href="/crypto/tls/handshake_server_test.go.html#7123279">config</a></span><span class="op" id="7123450">.</span><span class="ident" id="7123451">GetCertificate</span>&nbsp;<span class="op" id="7123466">=</span>&nbsp;<span class="keyword" id="7123468">func</span><span class="op" id="7123472">(</span><span class="ident" id="7123473">clientHello</span>&nbsp;<span class="op" id="7123485">*</span><span class="ident" id="7123486"><a href="/crypto/tls/common.go.html#4115067">ClientHelloInfo</a></span><span class="op" id="7123501">)</span>&nbsp;<span class="op" id="7123503">(</span><span class="op" id="7123504">*</span><span class="ident" id="7123505"><a href="/crypto/tls/common.go.html#4123683">Certificate</a></span><span class="op" id="7123516">,</span>&nbsp;<span class="builtintype" id="7123518">error</span><span class="op" id="7123523">)</span>&nbsp;<span class="op" id="7123525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123529">cert</span><span class="op" id="7123533">,</span>&nbsp;<span class="ident" id="7123535">_</span>&nbsp;<span class="op" id="7123537">:=</span>&nbsp;<span class="ident" id="7123540"><a href="/crypto/tls/handshake_server_test.go.html#7123372">nameToCert</a></span><span class="op" id="7123550">[</span><span class="ident" id="7123551"><a href="/crypto/tls/handshake_server_test.go.html#7123473">clientHello</a></span><span class="op" id="7123562">.</span><span class="ident" id="7123563">ServerName</span><span class="op" id="7123573">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7123577">return</span>&nbsp;<span class="ident" id="7123584"><a href="/crypto/tls/handshake_server_test.go.html#7123529">cert</a></span><span class="op" id="7123588">,</span>&nbsp;<span class="ident" id="7123590">nil</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123598">test</span>&nbsp;<span class="op" id="7123603">:=</span>&nbsp;<span class="op" id="7123606">&amp;</span><span class="ident" id="7123607"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7123617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123621">name</span><span class="op" id="7123625">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7123630">&#34;SNI&#34;</span><span class="op" id="7123635">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123639">command</span><span class="op" id="7123646">:</span>&nbsp;<span class="op" id="7123648">[</span><span class="op" id="7123649">]</span><span class="builtintype" id="7123650">string</span><span class="op" id="7123656">{</span><span class="string" id="7123657">&#34;openssl&#34;</span><span class="op" id="7123666">,</span>&nbsp;<span class="string" id="7123668">&#34;s_client&#34;</span><span class="op" id="7123678">,</span>&nbsp;<span class="string" id="7123680">&#34;-no_ticket&#34;</span><span class="op" id="7123692">,</span>&nbsp;<span class="string" id="7123694">&#34;-cipher&#34;</span><span class="op" id="7123703">,</span>&nbsp;<span class="string" id="7123705">&#34;AES128-SHA&#34;</span><span class="op" id="7123717">,</span>&nbsp;<span class="string" id="7123719">&#34;-servername&#34;</span><span class="op" id="7123732">,</span>&nbsp;<span class="string" id="7123734">&#34;snitest.com&#34;</span><span class="op" id="7123747">}</span><span class="op" id="7123748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123752">config</span><span class="op" id="7123758">:</span>&nbsp;&nbsp;<span class="op" id="7123761">&amp;</span><span class="ident" id="7123762"><a href="/crypto/tls/handshake_server_test.go.html#7123279">config</a></span><span class="op" id="7123768">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123774"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7123792">(</span><span class="ident" id="7123793"><a href="/crypto/tls/handshake_server_test.go.html#7123262">t</a></span><span class="op" id="7123794">,</span>&nbsp;<span class="ident" id="7123796"><a href="/crypto/tls/handshake_server_test.go.html#7123598">test</a></span><span class="op" id="7123800">)</span><br>
<span class="lineno"></span><span class="op" id="7123802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7123805">//&nbsp;TestHandshakeServerSNICertForNameNotFound&nbsp;is&nbsp;similar&nbsp;to</span><br>
<span class="lineno">610</span><span class="comment" id="7123864">//&nbsp;TestHandshakeServerSNICertForName,&nbsp;but&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7123939">//&nbsp;GetCertificate&nbsp;method&nbsp;doesn&#39;t&nbsp;return&nbsp;a&nbsp;cert,&nbsp;we&nbsp;fall&nbsp;back&nbsp;to&nbsp;what&#39;s&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7124013">//&nbsp;the&nbsp;NameToCertificate&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="7124043">func</span>&nbsp;<span class="ident" id="7124048">TestHandshakeServerSNIGetCertificateNotFound</span><span class="op" id="7124092">(</span><span class="ident" id="7124093">t</span>&nbsp;<span class="op" id="7124095">*</span><span class="ident" id="7124096"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7124103">.</span><span class="ident" id="7124104">T</span><span class="op" id="7124105">)</span>&nbsp;<span class="op" id="7124107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124110">config</span>&nbsp;<span class="op" id="7124117">:=</span>&nbsp;<span class="op" id="7124120">*</span><span class="ident" id="7124121"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124134"><a href="/crypto/tls/handshake_server_test.go.html#7124110">config</a></span><span class="op" id="7124140">.</span><span class="ident" id="7124141">GetCertificate</span>&nbsp;<span class="op" id="7124156">=</span>&nbsp;<span class="keyword" id="7124158">func</span><span class="op" id="7124162">(</span><span class="ident" id="7124163">clientHello</span>&nbsp;<span class="op" id="7124175">*</span><span class="ident" id="7124176"><a href="/crypto/tls/common.go.html#4115067">ClientHelloInfo</a></span><span class="op" id="7124191">)</span>&nbsp;<span class="op" id="7124193">(</span><span class="op" id="7124194">*</span><span class="ident" id="7124195"><a href="/crypto/tls/common.go.html#4123683">Certificate</a></span><span class="op" id="7124206">,</span>&nbsp;<span class="builtintype" id="7124208">error</span><span class="op" id="7124213">)</span>&nbsp;<span class="op" id="7124215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124219">return</span>&nbsp;<span class="ident" id="7124226">nil</span><span class="op" id="7124229">,</span>&nbsp;<span class="ident" id="7124231">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124239">test</span>&nbsp;<span class="op" id="7124244">:=</span>&nbsp;<span class="op" id="7124247">&amp;</span><span class="ident" id="7124248"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7124258">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124262">name</span><span class="op" id="7124266">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7124271">&#34;SNI&#34;</span><span class="op" id="7124276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124280">command</span><span class="op" id="7124287">:</span>&nbsp;<span class="op" id="7124289">[</span><span class="op" id="7124290">]</span><span class="builtintype" id="7124291">string</span><span class="op" id="7124297">{</span><span class="string" id="7124298">&#34;openssl&#34;</span><span class="op" id="7124307">,</span>&nbsp;<span class="string" id="7124309">&#34;s_client&#34;</span><span class="op" id="7124319">,</span>&nbsp;<span class="string" id="7124321">&#34;-no_ticket&#34;</span><span class="op" id="7124333">,</span>&nbsp;<span class="string" id="7124335">&#34;-cipher&#34;</span><span class="op" id="7124344">,</span>&nbsp;<span class="string" id="7124346">&#34;AES128-SHA&#34;</span><span class="op" id="7124358">,</span>&nbsp;<span class="string" id="7124360">&#34;-servername&#34;</span><span class="op" id="7124373">,</span>&nbsp;<span class="string" id="7124375">&#34;snitest.com&#34;</span><span class="op" id="7124388">}</span><span class="op" id="7124389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124393">config</span><span class="op" id="7124399">:</span>&nbsp;&nbsp;<span class="op" id="7124402">&amp;</span><span class="ident" id="7124403"><a href="/crypto/tls/handshake_server_test.go.html#7124110">config</a></span><span class="op" id="7124409">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124415"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7124433">(</span><span class="ident" id="7124434"><a href="/crypto/tls/handshake_server_test.go.html#7124093">t</a></span><span class="op" id="7124435">,</span>&nbsp;<span class="ident" id="7124437"><a href="/crypto/tls/handshake_server_test.go.html#7124239">test</a></span><span class="op" id="7124441">)</span><br>
<span class="lineno">625</span><span class="op" id="7124443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7124446">//&nbsp;TestHandshakeServerSNICertForNameError&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;errors&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7124522">//&nbsp;GetCertificate&nbsp;result&nbsp;in&nbsp;a&nbsp;tls&nbsp;alert.</span><br>
<span class="lineno"></span><span class="keyword" id="7124563">func</span>&nbsp;<span class="ident" id="7124568">TestHandshakeServerSNIGetCertificateError</span><span class="op" id="7124609">(</span><span class="ident" id="7124610">t</span>&nbsp;<span class="op" id="7124612">*</span><span class="ident" id="7124613"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7124620">.</span><span class="ident" id="7124621">T</span><span class="op" id="7124622">)</span>&nbsp;<span class="op" id="7124624">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124627">config</span>&nbsp;<span class="op" id="7124634">:=</span>&nbsp;<span class="op" id="7124637">*</span><span class="ident" id="7124638"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124651"><a href="/crypto/tls/handshake_server_test.go.html#7124627">config</a></span><span class="op" id="7124657">.</span><span class="ident" id="7124658">GetCertificate</span>&nbsp;<span class="op" id="7124673">=</span>&nbsp;<span class="keyword" id="7124675">func</span><span class="op" id="7124679">(</span><span class="ident" id="7124680">clientHello</span>&nbsp;<span class="op" id="7124692">*</span><span class="ident" id="7124693"><a href="/crypto/tls/common.go.html#4115067">ClientHelloInfo</a></span><span class="op" id="7124708">)</span>&nbsp;<span class="op" id="7124710">(</span><span class="op" id="7124711">*</span><span class="ident" id="7124712"><a href="/crypto/tls/common.go.html#4123683">Certificate</a></span><span class="op" id="7124723">,</span>&nbsp;<span class="builtintype" id="7124725">error</span><span class="op" id="7124730">)</span>&nbsp;<span class="op" id="7124732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124736">return</span>&nbsp;<span class="ident" id="7124743">nil</span><span class="op" id="7124746">,</span>&nbsp;<span class="ident" id="7124748"><a href="/crypto/tls/handshake_server_test.go.html#7106658">fmt</a></span><span class="op" id="7124751">.</span><span class="ident" id="7124752">Errorf</span><span class="op" id="7124758">(</span><span class="string" id="7124759">&#34;Test&nbsp;error&nbsp;in&nbsp;GetCertificate&#34;</span><span class="op" id="7124789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124792">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124795">test</span>&nbsp;<span class="op" id="7124800">:=</span>&nbsp;<span class="op" id="7124803">&amp;</span><span class="ident" id="7124804"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7124814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124818">name</span><span class="op" id="7124822">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7124831">&#34;SNI&#34;</span><span class="op" id="7124836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124840">command</span><span class="op" id="7124847">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7124853">[</span><span class="op" id="7124854">]</span><span class="builtintype" id="7124855">string</span><span class="op" id="7124861">{</span><span class="string" id="7124862">&#34;openssl&#34;</span><span class="op" id="7124871">,</span>&nbsp;<span class="string" id="7124873">&#34;s_client&#34;</span><span class="op" id="7124883">,</span>&nbsp;<span class="string" id="7124885">&#34;-no_ticket&#34;</span><span class="op" id="7124897">,</span>&nbsp;<span class="string" id="7124899">&#34;-cipher&#34;</span><span class="op" id="7124908">,</span>&nbsp;<span class="string" id="7124910">&#34;AES128-SHA&#34;</span><span class="op" id="7124922">,</span>&nbsp;<span class="string" id="7124924">&#34;-servername&#34;</span><span class="op" id="7124937">,</span>&nbsp;<span class="string" id="7124939">&#34;snitest.com&#34;</span><span class="op" id="7124952">}</span><span class="op" id="7124953">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124957">config</span><span class="op" id="7124963">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7124970">&amp;</span><span class="ident" id="7124971"><a href="/crypto/tls/handshake_server_test.go.html#7124627">config</a></span><span class="op" id="7124977">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124981">expectAlert</span><span class="op" id="7124992">:</span>&nbsp;<span class="ident" id="7124994">true</span><span class="op" id="7124998">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125004"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7125022">(</span><span class="ident" id="7125023"><a href="/crypto/tls/handshake_server_test.go.html#7124610">t</a></span><span class="op" id="7125024">,</span>&nbsp;<span class="ident" id="7125026"><a href="/crypto/tls/handshake_server_test.go.html#7124795">test</a></span><span class="op" id="7125030">)</span><br>
<span class="lineno"></span><span class="op" id="7125032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7125035">//&nbsp;TestCipherSuiteCertPreferance&nbsp;ensures&nbsp;that&nbsp;we&nbsp;select&nbsp;an&nbsp;RSA&nbsp;ciphersuite&nbsp;with</span><br>
<span class="lineno">645</span><span class="comment" id="7125115">//&nbsp;an&nbsp;RSA&nbsp;certificate&nbsp;and&nbsp;an&nbsp;ECDSA&nbsp;ciphersuite&nbsp;with&nbsp;an&nbsp;ECDSA&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="7125189">func</span>&nbsp;<span class="ident" id="7125194">TestCipherSuiteCertPreferenceECDSA</span><span class="op" id="7125228">(</span><span class="ident" id="7125229">t</span>&nbsp;<span class="op" id="7125231">*</span><span class="ident" id="7125232"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7125239">.</span><span class="ident" id="7125240">T</span><span class="op" id="7125241">)</span>&nbsp;<span class="op" id="7125243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125246">config</span>&nbsp;<span class="op" id="7125253">:=</span>&nbsp;<span class="op" id="7125256">*</span><span class="ident" id="7125257"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125269"><a href="/crypto/tls/handshake_server_test.go.html#7125246">config</a></span><span class="op" id="7125275">.</span><span class="ident" id="7125276">CipherSuites</span>&nbsp;<span class="op" id="7125289">=</span>&nbsp;<span class="op" id="7125291">[</span><span class="op" id="7125292">]</span><span class="builtintype" id="7125293">uint16</span><span class="op" id="7125299">{</span><span class="ident" id="7125300"><a href="/crypto/tls/cipher_suites.go.html#4107209">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</a></span><span class="op" id="7125336">,</span>&nbsp;<span class="ident" id="7125338"><a href="/crypto/tls/cipher_suites.go.html#4107437">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</a></span><span class="op" id="7125372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125375"><a href="/crypto/tls/handshake_server_test.go.html#7125246">config</a></span><span class="op" id="7125381">.</span><span class="ident" id="7125382">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7125407">=</span>&nbsp;<span class="ident" id="7125409">true</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125416">test</span>&nbsp;<span class="op" id="7125421">:=</span>&nbsp;<span class="op" id="7125424">&amp;</span><span class="ident" id="7125425"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7125435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125439">name</span><span class="op" id="7125443">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7125447">&#34;CipherSuiteCertPreferenceRSA&#34;</span><span class="op" id="7125477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125481">config</span><span class="op" id="7125487">:</span>&nbsp;<span class="op" id="7125489">&amp;</span><span class="ident" id="7125490"><a href="/crypto/tls/handshake_server_test.go.html#7125246">config</a></span><span class="op" id="7125496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125499">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125502"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7125520">(</span><span class="ident" id="7125521"><a href="/crypto/tls/handshake_server_test.go.html#7125229">t</a></span><span class="op" id="7125522">,</span>&nbsp;<span class="ident" id="7125524"><a href="/crypto/tls/handshake_server_test.go.html#7125416">test</a></span><span class="op" id="7125528">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125532"><a href="/crypto/tls/handshake_server_test.go.html#7125246">config</a></span>&nbsp;<span class="op" id="7125539">=</span>&nbsp;<span class="op" id="7125541">*</span><span class="ident" id="7125542"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125554"><a href="/crypto/tls/handshake_server_test.go.html#7125246">config</a></span><span class="op" id="7125560">.</span><span class="ident" id="7125561">CipherSuites</span>&nbsp;<span class="op" id="7125574">=</span>&nbsp;<span class="op" id="7125576">[</span><span class="op" id="7125577">]</span><span class="builtintype" id="7125578">uint16</span><span class="op" id="7125584">{</span><span class="ident" id="7125585"><a href="/crypto/tls/cipher_suites.go.html#4107437">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</a></span><span class="op" id="7125619">,</span>&nbsp;<span class="ident" id="7125621"><a href="/crypto/tls/cipher_suites.go.html#4107209">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</a></span><span class="op" id="7125657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125660"><a href="/crypto/tls/handshake_server_test.go.html#7125246">config</a></span><span class="op" id="7125666">.</span><span class="ident" id="7125667">Certificates</span>&nbsp;<span class="op" id="7125680">=</span>&nbsp;<span class="op" id="7125682">[</span><span class="op" id="7125683">]</span><span class="ident" id="7125684"><a href="/crypto/tls/common.go.html#4123683">Certificate</a></span><span class="op" id="7125695">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125704">Certificate</span><span class="op" id="7125715">:</span>&nbsp;<span class="op" id="7125717">[</span><span class="op" id="7125718">]</span><span class="op" id="7125719">[</span><span class="op" id="7125720">]</span><span class="builtintype" id="7125721">byte</span><span class="op" id="7125725">{</span><span class="ident" id="7125726"><a href="/crypto/tls/handshake_server_test.go.html#7133477">testECDSACertificate</a></span><span class="op" id="7125746">}</span><span class="op" id="7125747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125752">PrivateKey</span><span class="op" id="7125762">:</span>&nbsp;&nbsp;<span class="ident" id="7125765"><a href="/crypto/tls/handshake_server_test.go.html#7136719">testECDSAPrivateKey</a></span><span class="op" id="7125784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125788">}</span><span class="op" id="7125789">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125792">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125795"><a href="/crypto/tls/handshake_server_test.go.html#7125246">config</a></span><span class="op" id="7125801">.</span><span class="ident" id="7125802">BuildNameToCertificate</span><span class="op" id="7125824">(</span><span class="op" id="7125825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125828"><a href="/crypto/tls/handshake_server_test.go.html#7125246">config</a></span><span class="op" id="7125834">.</span><span class="ident" id="7125835">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7125860">=</span>&nbsp;<span class="ident" id="7125862">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125869"><a href="/crypto/tls/handshake_server_test.go.html#7125416">test</a></span>&nbsp;<span class="op" id="7125874">=</span>&nbsp;<span class="op" id="7125876">&amp;</span><span class="ident" id="7125877"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7125887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125891">name</span><span class="op" id="7125895">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7125899">&#34;CipherSuiteCertPreferenceECDSA&#34;</span><span class="op" id="7125931">,</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125935">config</span><span class="op" id="7125941">:</span>&nbsp;<span class="op" id="7125943">&amp;</span><span class="ident" id="7125944"><a href="/crypto/tls/handshake_server_test.go.html#7125246">config</a></span><span class="op" id="7125950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125956"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7125974">(</span><span class="ident" id="7125975"><a href="/crypto/tls/handshake_server_test.go.html#7125229">t</a></span><span class="op" id="7125976">,</span>&nbsp;<span class="ident" id="7125978"><a href="/crypto/tls/handshake_server_test.go.html#7125416">test</a></span><span class="op" id="7125982">)</span><br>
<span class="lineno"></span><span class="op" id="7125984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="7125987">func</span>&nbsp;<span class="ident" id="7125992">TestResumption</span><span class="op" id="7126006">(</span><span class="ident" id="7126007">t</span>&nbsp;<span class="op" id="7126009">*</span><span class="ident" id="7126010"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7126017">.</span><span class="ident" id="7126018">T</span><span class="op" id="7126019">)</span>&nbsp;<span class="op" id="7126021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126024">sessionFilePath</span>&nbsp;<span class="op" id="7126040">:=</span>&nbsp;<span class="ident" id="7126043"><a href="/crypto/tls/handshake_test.go.html#7141468">tempFile</a></span><span class="op" id="7126051">(</span><span class="string" id="7126052">&#34;&#34;</span><span class="op" id="7126054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7126057">defer</span>&nbsp;<span class="ident" id="7126063"><a href="/crypto/tls/handshake_server_test.go.html#7106690">os</a></span><span class="op" id="7126065">.</span><span class="ident" id="7126066">Remove</span><span class="op" id="7126072">(</span><span class="ident" id="7126073"><a href="/crypto/tls/handshake_server_test.go.html#7126024">sessionFilePath</a></span><span class="op" id="7126088">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126092">test</span>&nbsp;<span class="op" id="7126097">:=</span>&nbsp;<span class="op" id="7126100">&amp;</span><span class="ident" id="7126101"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7126111">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126115">name</span><span class="op" id="7126119">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7126124">&#34;IssueTicket&#34;</span><span class="op" id="7126137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126141">command</span><span class="op" id="7126148">:</span>&nbsp;<span class="op" id="7126150">[</span><span class="op" id="7126151">]</span><span class="builtintype" id="7126152">string</span><span class="op" id="7126158">{</span><span class="string" id="7126159">&#34;openssl&#34;</span><span class="op" id="7126168">,</span>&nbsp;<span class="string" id="7126170">&#34;s_client&#34;</span><span class="op" id="7126180">,</span>&nbsp;<span class="string" id="7126182">&#34;-cipher&#34;</span><span class="op" id="7126191">,</span>&nbsp;<span class="string" id="7126193">&#34;RC4-SHA&#34;</span><span class="op" id="7126202">,</span>&nbsp;<span class="string" id="7126204">&#34;-sess_out&#34;</span><span class="op" id="7126215">,</span>&nbsp;<span class="ident" id="7126217"><a href="/crypto/tls/handshake_server_test.go.html#7126024">sessionFilePath</a></span><span class="op" id="7126232">}</span><span class="op" id="7126233">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126239"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7126257">(</span><span class="ident" id="7126258"><a href="/crypto/tls/handshake_server_test.go.html#7126007">t</a></span><span class="op" id="7126259">,</span>&nbsp;<span class="ident" id="7126261"><a href="/crypto/tls/handshake_server_test.go.html#7126092">test</a></span><span class="op" id="7126265">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126269"><a href="/crypto/tls/handshake_server_test.go.html#7126092">test</a></span>&nbsp;<span class="op" id="7126274">=</span>&nbsp;<span class="op" id="7126276">&amp;</span><span class="ident" id="7126277"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7126287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126291">name</span><span class="op" id="7126295">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7126300">&#34;Resume&#34;</span><span class="op" id="7126308">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126312">command</span><span class="op" id="7126319">:</span>&nbsp;<span class="op" id="7126321">[</span><span class="op" id="7126322">]</span><span class="builtintype" id="7126323">string</span><span class="op" id="7126329">{</span><span class="string" id="7126330">&#34;openssl&#34;</span><span class="op" id="7126339">,</span>&nbsp;<span class="string" id="7126341">&#34;s_client&#34;</span><span class="op" id="7126351">,</span>&nbsp;<span class="string" id="7126353">&#34;-cipher&#34;</span><span class="op" id="7126362">,</span>&nbsp;<span class="string" id="7126364">&#34;RC4-SHA&#34;</span><span class="op" id="7126373">,</span>&nbsp;<span class="string" id="7126375">&#34;-sess_in&#34;</span><span class="op" id="7126385">,</span>&nbsp;<span class="ident" id="7126387"><a href="/crypto/tls/handshake_server_test.go.html#7126024">sessionFilePath</a></span><span class="op" id="7126402">}</span><span class="op" id="7126403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126409"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7126427">(</span><span class="ident" id="7126428"><a href="/crypto/tls/handshake_server_test.go.html#7126007">t</a></span><span class="op" id="7126429">,</span>&nbsp;<span class="ident" id="7126431"><a href="/crypto/tls/handshake_server_test.go.html#7126092">test</a></span><span class="op" id="7126435">)</span><br>
<span class="lineno">690</span><span class="op" id="7126437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7126440">func</span>&nbsp;<span class="ident" id="7126445">TestResumptionDisabled</span><span class="op" id="7126467">(</span><span class="ident" id="7126468">t</span>&nbsp;<span class="op" id="7126470">*</span><span class="ident" id="7126471"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7126478">.</span><span class="ident" id="7126479">T</span><span class="op" id="7126480">)</span>&nbsp;<span class="op" id="7126482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126485">sessionFilePath</span>&nbsp;<span class="op" id="7126501">:=</span>&nbsp;<span class="ident" id="7126504"><a href="/crypto/tls/handshake_test.go.html#7141468">tempFile</a></span><span class="op" id="7126512">(</span><span class="string" id="7126513">&#34;&#34;</span><span class="op" id="7126515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7126518">defer</span>&nbsp;<span class="ident" id="7126524"><a href="/crypto/tls/handshake_server_test.go.html#7106690">os</a></span><span class="op" id="7126526">.</span><span class="ident" id="7126527">Remove</span><span class="op" id="7126533">(</span><span class="ident" id="7126534"><a href="/crypto/tls/handshake_server_test.go.html#7126485">sessionFilePath</a></span><span class="op" id="7126549">)</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126553">config</span>&nbsp;<span class="op" id="7126560">:=</span>&nbsp;<span class="op" id="7126563">*</span><span class="ident" id="7126564"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126577">test</span>&nbsp;<span class="op" id="7126582">:=</span>&nbsp;<span class="op" id="7126585">&amp;</span><span class="ident" id="7126586"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7126596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126600">name</span><span class="op" id="7126604">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7126609">&#34;IssueTicketPreDisable&#34;</span><span class="op" id="7126632">,</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126636">command</span><span class="op" id="7126643">:</span>&nbsp;<span class="op" id="7126645">[</span><span class="op" id="7126646">]</span><span class="builtintype" id="7126647">string</span><span class="op" id="7126653">{</span><span class="string" id="7126654">&#34;openssl&#34;</span><span class="op" id="7126663">,</span>&nbsp;<span class="string" id="7126665">&#34;s_client&#34;</span><span class="op" id="7126675">,</span>&nbsp;<span class="string" id="7126677">&#34;-cipher&#34;</span><span class="op" id="7126686">,</span>&nbsp;<span class="string" id="7126688">&#34;RC4-SHA&#34;</span><span class="op" id="7126697">,</span>&nbsp;<span class="string" id="7126699">&#34;-sess_out&#34;</span><span class="op" id="7126710">,</span>&nbsp;<span class="ident" id="7126712"><a href="/crypto/tls/handshake_server_test.go.html#7126485">sessionFilePath</a></span><span class="op" id="7126727">}</span><span class="op" id="7126728">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126732">config</span><span class="op" id="7126738">:</span>&nbsp;&nbsp;<span class="op" id="7126741">&amp;</span><span class="ident" id="7126742"><a href="/crypto/tls/handshake_server_test.go.html#7126553">config</a></span><span class="op" id="7126748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126754"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7126772">(</span><span class="ident" id="7126773"><a href="/crypto/tls/handshake_server_test.go.html#7126468">t</a></span><span class="op" id="7126774">,</span>&nbsp;<span class="ident" id="7126776"><a href="/crypto/tls/handshake_server_test.go.html#7126577">test</a></span><span class="op" id="7126780">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126784"><a href="/crypto/tls/handshake_server_test.go.html#7126553">config</a></span><span class="op" id="7126790">.</span><span class="ident" id="7126791">SessionTicketsDisabled</span>&nbsp;<span class="op" id="7126814">=</span>&nbsp;<span class="ident" id="7126816">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126823"><a href="/crypto/tls/handshake_server_test.go.html#7126577">test</a></span>&nbsp;<span class="op" id="7126828">=</span>&nbsp;<span class="op" id="7126830">&amp;</span><span class="ident" id="7126831"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7126841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126845">name</span><span class="op" id="7126849">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7126854">&#34;ResumeDisabled&#34;</span><span class="op" id="7126870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126874">command</span><span class="op" id="7126881">:</span>&nbsp;<span class="op" id="7126883">[</span><span class="op" id="7126884">]</span><span class="builtintype" id="7126885">string</span><span class="op" id="7126891">{</span><span class="string" id="7126892">&#34;openssl&#34;</span><span class="op" id="7126901">,</span>&nbsp;<span class="string" id="7126903">&#34;s_client&#34;</span><span class="op" id="7126913">,</span>&nbsp;<span class="string" id="7126915">&#34;-cipher&#34;</span><span class="op" id="7126924">,</span>&nbsp;<span class="string" id="7126926">&#34;RC4-SHA&#34;</span><span class="op" id="7126935">,</span>&nbsp;<span class="string" id="7126937">&#34;-sess_in&#34;</span><span class="op" id="7126947">,</span>&nbsp;<span class="ident" id="7126949"><a href="/crypto/tls/handshake_server_test.go.html#7126485">sessionFilePath</a></span><span class="op" id="7126964">}</span><span class="op" id="7126965">,</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126969">config</span><span class="op" id="7126975">:</span>&nbsp;&nbsp;<span class="op" id="7126978">&amp;</span><span class="ident" id="7126979"><a href="/crypto/tls/handshake_server_test.go.html#7126553">config</a></span><span class="op" id="7126985">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126991"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7127009">(</span><span class="ident" id="7127010"><a href="/crypto/tls/handshake_server_test.go.html#7126468">t</a></span><span class="op" id="7127011">,</span>&nbsp;<span class="ident" id="7127013"><a href="/crypto/tls/handshake_server_test.go.html#7126577">test</a></span><span class="op" id="7127017">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7127021">//&nbsp;One&nbsp;needs&nbsp;to&nbsp;manually&nbsp;confirm&nbsp;that&nbsp;the&nbsp;handshake&nbsp;in&nbsp;the&nbsp;golden&nbsp;data</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7127093">//&nbsp;file&nbsp;for&nbsp;ResumeDisabled&nbsp;does&nbsp;not&nbsp;include&nbsp;a&nbsp;resumption&nbsp;handshake.</span><br>
<span class="lineno"></span><span class="op" id="7127161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7127164">func</span>&nbsp;<span class="ident" id="7127169">TestFallbackSCSV</span><span class="op" id="7127185">(</span><span class="ident" id="7127186">t</span>&nbsp;<span class="op" id="7127188">*</span><span class="ident" id="7127189"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7127196">.</span><span class="ident" id="7127197">T</span><span class="op" id="7127198">)</span>&nbsp;<span class="op" id="7127200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127203">test</span>&nbsp;<span class="op" id="7127208">:=</span>&nbsp;<span class="op" id="7127211">&amp;</span><span class="ident" id="7127212"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7127222">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127226">name</span><span class="op" id="7127230">:</span>&nbsp;<span class="string" id="7127232">&#34;FallbackSCSV&#34;</span><span class="op" id="7127246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7127250">//&nbsp;OpenSSL&nbsp;1.0.1j&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;-fallback_scsv&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127311">command</span><span class="op" id="7127318">:</span>&nbsp;<span class="op" id="7127320">[</span><span class="op" id="7127321">]</span><span class="builtintype" id="7127322">string</span><span class="op" id="7127328">{</span><span class="string" id="7127329">&#34;openssl&#34;</span><span class="op" id="7127338">,</span>&nbsp;<span class="string" id="7127340">&#34;s_client&#34;</span><span class="op" id="7127350">,</span>&nbsp;<span class="string" id="7127352">&#34;-fallback_scsv&#34;</span><span class="op" id="7127368">}</span><span class="op" id="7127369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127373">expectHandshakeErrorIncluding</span><span class="op" id="7127402">:</span>&nbsp;<span class="string" id="7127404">&#34;inppropriate&nbsp;protocol&nbsp;fallback&#34;</span><span class="op" id="7127436">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7127439">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127442"><a href="/crypto/tls/handshake_server_test.go.html#7119494">runServerTestTLS11</a></span><span class="op" id="7127460">(</span><span class="ident" id="7127461"><a href="/crypto/tls/handshake_server_test.go.html#7127186">t</a></span><span class="op" id="7127462">,</span>&nbsp;<span class="ident" id="7127464"><a href="/crypto/tls/handshake_server_test.go.html#7127203">test</a></span><span class="op" id="7127468">)</span><br>
<span class="lineno"></span><span class="op" id="7127470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7127473">//&nbsp;cert.pem&nbsp;and&nbsp;key.pem&nbsp;were&nbsp;generated&nbsp;with&nbsp;generate_cert.go</span><br>
<span class="lineno"></span><span class="comment" id="7127534">//&nbsp;Thus,&nbsp;they&nbsp;have&nbsp;no&nbsp;ExtKeyUsage&nbsp;fields&nbsp;and&nbsp;trigger&nbsp;an&nbsp;error</span><br>
<span class="lineno">730</span><span class="comment" id="7127596">//&nbsp;when&nbsp;verification&nbsp;is&nbsp;turned&nbsp;on.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7127632">const</span>&nbsp;<span class="ident" id="7127638">clientCertificatePEM</span>&nbsp;<span class="op" id="7127659">=</span>&nbsp;<span class="string" id="7127661">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB7TCCAVigAwIBAgIBADALBgkqhkiG9w0BAQUwJjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno">735</span>bzESMBAGA1UEAxMJMTI3LjAuMC4xMB4XDTExMTIwODA3NTUxMloXDTEyMTIwNzA4<br>
<span class="lineno"></span>MDAxMlowJjEQMA4GA1UEChMHQWNtZSBDbzESMBAGA1UEAxMJMTI3LjAuMC4xMIGc<br>
<span class="lineno"></span>MAsGCSqGSIb3DQEBAQOBjAAwgYgCgYBO0Hsx44Jk2VnAwoekXh6LczPHY1PfZpIG<br>
<span class="lineno"></span>hPZk1Y/kNqcdK+izIDZFI7Xjla7t4PUgnI2V339aEu+H5Fto5OkOdOwEin/ekyfE<br>
<span class="lineno"></span>ARl6vfLcPRSr0FTKIQzQTW6HLlzF0rtNS0/Otiz3fojsfNcCkXSmHgwa2uNKWi7e<br>
<span class="lineno">740</span>E5xMQIhZkwIDAQABozIwMDAOBgNVHQ8BAf8EBAMCAKAwDQYDVR0OBAYEBAECAwQw<br>
<span class="lineno"></span>DwYDVR0jBAgwBoAEAQIDBDALBgkqhkiG9w0BAQUDgYEANh+zegx1yW43RmEr1b3A<br>
<span class="lineno"></span>p0vMRpqBWHyFeSnIyMZn3TJWRSt1tukkqVCavh9a+hoV2cxVlXIWg7nCto/9iIw4<br>
<span class="lineno"></span>hB2rXZIxE0/9gzvGnfERYraL7KtnvshksBFQRlgXa5kc0x38BvEO5ZaoDPl4ILdE<br>
<span class="lineno"></span>GFGNEH5PlGffo05wc46QkYU=<br>
<span class="lineno">745</span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7128394">const</span>&nbsp;<span class="ident" id="7128400">clientKeyPEM</span>&nbsp;<span class="op" id="7128413">=</span>&nbsp;<span class="string" id="7128415">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIICWgIBAAKBgE7QezHjgmTZWcDCh6ReHotzM8djU99mkgaE9mTVj+Q2px0r6LMg<br>
<span class="lineno">750</span>NkUjteOVru3g9SCcjZXff1oS74fkW2jk6Q507ASKf96TJ8QBGXq98tw9FKvQVMoh<br>
<span class="lineno"></span>DNBNbocuXMXSu01LT862LPd+iOx81wKRdKYeDBra40paLt4TnExAiFmTAgMBAAEC<br>
<span class="lineno"></span>gYBxvXd8yNteFTns8A/2yomEMC4yeosJJSpp1CsN3BJ7g8/qTnrVPxBy+RU+qr63<br>
<span class="lineno"></span>t2WquaOu/cr5P8iEsa6lk20tf8pjKLNXeX0b1RTzK8rJLbS7nGzP3tvOhL096VtQ<br>
<span class="lineno"></span>dAo4ROEaro0TzYpHmpciSvxVIeEIAAdFDObDJPKqcJAxyQJBAJizfYgK8Gzx9fsx<br>
<span class="lineno">755</span>hxp+VteCbVPg2euASH5Yv3K5LukRdKoSzHE2grUVQgN/LafC0eZibRanxHegYSr7<br>
<span class="lineno"></span>7qaswKUCQQCEIWor/X4XTMdVj3Oj+vpiw75y/S9gh682+myZL+d/02IEkwnB098P<br>
<span class="lineno"></span>RkKVpenBHyrGg0oeN5La7URILWKj7CPXAkBKo6F+d+phNjwIFoN1Xb/RA32w/D1I<br>
<span class="lineno"></span>saG9sF+UEhRt9AxUfW/U/tIQ9V0ZHHcSg1XaCM5Nvp934brdKdvTOKnJAkBD5h/3<br>
<span class="lineno"></span>Rybatlvg/fzBEaJFyq09zhngkxlZOUtBVTqzl17RVvY2orgH02U4HbCHy4phxOn7<br>
<span class="lineno">760</span>qTdQRYlHRftgnWK1AkANibn9PRYJ7mJyJ9Dyj2QeNcSkSTzrt0tPvUMf4+meJymN<br>
<span class="lineno"></span>1Ntu5+S1DLLzfxlaljWG6ylW6DNxujCyuXIV2rvA<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7129302">const</span>&nbsp;<span class="ident" id="7129308">clientECDSACertificatePEM</span>&nbsp;<span class="op" id="7129334">=</span>&nbsp;<span class="string" id="7129336">`<br>
<span class="lineno">765</span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/DCCAV4CCQCaMIRsJjXZFzAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTMyNTUzWhcNMjIxMTEyMTMyNTUzWjBBMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTEMMAoGA1UECBMDTlNXMRAwDgYDVQQHEwdQeXJtb250MRIwEAYDVQQDEwlK<br>
<span class="lineno">770</span>b2VsIFNpbmcwgZswEAYHKoZIzj0CAQYFK4EEACMDgYYABACVjJF1FMBexFe01MNv<br>
<span class="lineno"></span>ja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd3kfDdq0Z9kUs<br>
<span class="lineno"></span>jLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx+U56jb0JuK7q<br>
<span class="lineno"></span>ixgnTy5w/hOWusPTQBbNZU6sER7m8TAJBgcqhkjOPQQBA4GMADCBiAJCAOAUxGBg<br>
<span class="lineno"></span>C3JosDJdYUoCdFzCgbkWqD8pyDbHgf9stlvZcPE4O1BIKJTLCRpS8V3ujfK58PDa<br>
<span class="lineno">775</span>2RU6+b0DeoeiIzXsAkIBo9SKeDUcSpoj0gq+KxAxnZxfvuiRs9oa9V2jI/Umi0Vw<br>
<span class="lineno"></span>jWVim34BmT0Y9hCaOGGbLlfk+syxis7iI6CH8OFnUes=<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7130089">const</span>&nbsp;<span class="ident" id="7130095">clientECDSAKeyPEM</span>&nbsp;<span class="op" id="7130113">=</span>&nbsp;<span class="string" id="7130115">`<br>
<span class="lineno">780</span>-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBkJN9X4IqZIguiEVKMqeBUP5xtRsEv4HJEtOpOGLELwO53SD78Ew8<br>
<span class="lineno">785</span>k+wLWoqizS3NpQyMtrU8JFdWfj+C57UNkOugBwYFK4EEACOhgYkDgYYABACVjJF1<br>
<span class="lineno"></span>FMBexFe01MNvja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd<br>
<span class="lineno"></span>3kfDdq0Z9kUsjLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx<br>
<span class="lineno"></span>+U56jb0JuK7qixgnTy5w/hOWusPTQBbNZU6sER7m8Q==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno">790</span><br>
<span class="lineno"></span><span class="keyword" id="7130555">func</span>&nbsp;<span class="ident" id="7130560">TestClientAuth</span><span class="op" id="7130574">(</span><span class="ident" id="7130575">t</span>&nbsp;<span class="op" id="7130577">*</span><span class="ident" id="7130578"><a href="/crypto/tls/handshake_server_test.go.html#7106735">testing</a></span><span class="op" id="7130585">.</span><span class="ident" id="7130586">T</span><span class="op" id="7130587">)</span>&nbsp;<span class="op" id="7130589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130592">var</span>&nbsp;<span class="ident" id="7130596">certPath</span><span class="op" id="7130604">,</span>&nbsp;<span class="ident" id="7130606">keyPath</span><span class="op" id="7130613">,</span>&nbsp;<span class="ident" id="7130615">ecdsaCertPath</span><span class="op" id="7130628">,</span>&nbsp;<span class="ident" id="7130630">ecdsaKeyPath</span>&nbsp;<span class="builtintype" id="7130643">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130652">if</span>&nbsp;<span class="op" id="7130655">*</span><span class="ident" id="7130656"><a href="/crypto/tls/handshake_test.go.html#7138612">update</a></span>&nbsp;<span class="op" id="7130663">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130667"><a href="/crypto/tls/handshake_server_test.go.html#7130596">certPath</a></span>&nbsp;<span class="op" id="7130676">=</span>&nbsp;<span class="ident" id="7130678"><a href="/crypto/tls/handshake_test.go.html#7141468">tempFile</a></span><span class="op" id="7130686">(</span><span class="ident" id="7130687"><a href="/crypto/tls/handshake_server_test.go.html#7127638">clientCertificatePEM</a></span><span class="op" id="7130707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130711">defer</span>&nbsp;<span class="ident" id="7130717"><a href="/crypto/tls/handshake_server_test.go.html#7106690">os</a></span><span class="op" id="7130719">.</span><span class="ident" id="7130720">Remove</span><span class="op" id="7130726">(</span><span class="ident" id="7130727"><a href="/crypto/tls/handshake_server_test.go.html#7130596">certPath</a></span><span class="op" id="7130735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130739"><a href="/crypto/tls/handshake_server_test.go.html#7130606">keyPath</a></span>&nbsp;<span class="op" id="7130747">=</span>&nbsp;<span class="ident" id="7130749"><a href="/crypto/tls/handshake_test.go.html#7141468">tempFile</a></span><span class="op" id="7130757">(</span><span class="ident" id="7130758"><a href="/crypto/tls/handshake_server_test.go.html#7128400">clientKeyPEM</a></span><span class="op" id="7130770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130774">defer</span>&nbsp;<span class="ident" id="7130780"><a href="/crypto/tls/handshake_server_test.go.html#7106690">os</a></span><span class="op" id="7130782">.</span><span class="ident" id="7130783">Remove</span><span class="op" id="7130789">(</span><span class="ident" id="7130790"><a href="/crypto/tls/handshake_server_test.go.html#7130606">keyPath</a></span><span class="op" id="7130797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130801"><a href="/crypto/tls/handshake_server_test.go.html#7130615">ecdsaCertPath</a></span>&nbsp;<span class="op" id="7130815">=</span>&nbsp;<span class="ident" id="7130817"><a href="/crypto/tls/handshake_test.go.html#7141468">tempFile</a></span><span class="op" id="7130825">(</span><span class="ident" id="7130826"><a href="/crypto/tls/handshake_server_test.go.html#7129308">clientECDSACertificatePEM</a></span><span class="op" id="7130851">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130855">defer</span>&nbsp;<span class="ident" id="7130861"><a href="/crypto/tls/handshake_server_test.go.html#7106690">os</a></span><span class="op" id="7130863">.</span><span class="ident" id="7130864">Remove</span><span class="op" id="7130870">(</span><span class="ident" id="7130871"><a href="/crypto/tls/handshake_server_test.go.html#7130615">ecdsaCertPath</a></span><span class="op" id="7130884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130888"><a href="/crypto/tls/handshake_server_test.go.html#7130630">ecdsaKeyPath</a></span>&nbsp;<span class="op" id="7130901">=</span>&nbsp;<span class="ident" id="7130903"><a href="/crypto/tls/handshake_test.go.html#7141468">tempFile</a></span><span class="op" id="7130911">(</span><span class="ident" id="7130912"><a href="/crypto/tls/handshake_server_test.go.html#7130095">clientECDSAKeyPEM</a></span><span class="op" id="7130929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130933">defer</span>&nbsp;<span class="ident" id="7130939"><a href="/crypto/tls/handshake_server_test.go.html#7106690">os</a></span><span class="op" id="7130941">.</span><span class="ident" id="7130942">Remove</span><span class="op" id="7130948">(</span><span class="ident" id="7130949"><a href="/crypto/tls/handshake_server_test.go.html#7130630">ecdsaKeyPath</a></span><span class="op" id="7130961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7130964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130968">config</span>&nbsp;<span class="op" id="7130975">:=</span>&nbsp;<span class="op" id="7130978">*</span><span class="ident" id="7130979"><a href="/crypto/tls/handshake_server_test.go.html#7106976">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130991"><a href="/crypto/tls/handshake_server_test.go.html#7130968">config</a></span><span class="op" id="7130997">.</span><span class="ident" id="7130998">ClientAuth</span>&nbsp;<span class="op" id="7131009">=</span>&nbsp;<span class="ident" id="7131011"><a href="/crypto/tls/common.go.html#4113668">RequestClientCert</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131031">test</span>&nbsp;<span class="op" id="7131036">:=</span>&nbsp;<span class="op" id="7131039">&amp;</span><span class="ident" id="7131040"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7131050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131054">name</span><span class="op" id="7131058">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7131063">&#34;ClientAuthRequestedNotGiven&#34;</span><span class="op" id="7131092">,</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131096">command</span><span class="op" id="7131103">:</span>&nbsp;<span class="op" id="7131105">[</span><span class="op" id="7131106">]</span><span class="builtintype" id="7131107">string</span><span class="op" id="7131113">{</span><span class="string" id="7131114">&#34;openssl&#34;</span><span class="op" id="7131123">,</span>&nbsp;<span class="string" id="7131125">&#34;s_client&#34;</span><span class="op" id="7131135">,</span>&nbsp;<span class="string" id="7131137">&#34;-no_ticket&#34;</span><span class="op" id="7131149">,</span>&nbsp;<span class="string" id="7131151">&#34;-cipher&#34;</span><span class="op" id="7131160">,</span>&nbsp;<span class="string" id="7131162">&#34;RC4-SHA&#34;</span><span class="op" id="7131171">}</span><span class="op" id="7131172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131176">config</span><span class="op" id="7131182">:</span>&nbsp;&nbsp;<span class="op" id="7131185">&amp;</span><span class="ident" id="7131186"><a href="/crypto/tls/handshake_server_test.go.html#7130968">config</a></span><span class="op" id="7131192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131198"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7131216">(</span><span class="ident" id="7131217"><a href="/crypto/tls/handshake_server_test.go.html#7130575">t</a></span><span class="op" id="7131218">,</span>&nbsp;<span class="ident" id="7131220"><a href="/crypto/tls/handshake_server_test.go.html#7131031">test</a></span><span class="op" id="7131224">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131228"><a href="/crypto/tls/handshake_server_test.go.html#7131031">test</a></span>&nbsp;<span class="op" id="7131233">=</span>&nbsp;<span class="op" id="7131235">&amp;</span><span class="ident" id="7131236"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7131246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131250">name</span><span class="op" id="7131254">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7131269">&#34;ClientAuthRequestedAndGiven&#34;</span><span class="op" id="7131298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131302">command</span><span class="op" id="7131309">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7131321">[</span><span class="op" id="7131322">]</span><span class="builtintype" id="7131323">string</span><span class="op" id="7131329">{</span><span class="string" id="7131330">&#34;openssl&#34;</span><span class="op" id="7131339">,</span>&nbsp;<span class="string" id="7131341">&#34;s_client&#34;</span><span class="op" id="7131351">,</span>&nbsp;<span class="string" id="7131353">&#34;-no_ticket&#34;</span><span class="op" id="7131365">,</span>&nbsp;<span class="string" id="7131367">&#34;-cipher&#34;</span><span class="op" id="7131376">,</span>&nbsp;<span class="string" id="7131378">&#34;RC4-SHA&#34;</span><span class="op" id="7131387">,</span>&nbsp;<span class="string" id="7131389">&#34;-cert&#34;</span><span class="op" id="7131396">,</span>&nbsp;<span class="ident" id="7131398"><a href="/crypto/tls/handshake_server_test.go.html#7130596">certPath</a></span><span class="op" id="7131406">,</span>&nbsp;<span class="string" id="7131408">&#34;-key&#34;</span><span class="op" id="7131414">,</span>&nbsp;<span class="ident" id="7131416"><a href="/crypto/tls/handshake_server_test.go.html#7130606">keyPath</a></span><span class="op" id="7131423">}</span><span class="op" id="7131424">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131428">config</span><span class="op" id="7131434">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7131447">&amp;</span><span class="ident" id="7131448"><a href="/crypto/tls/handshake_server_test.go.html#7130968">config</a></span><span class="op" id="7131454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131458">expectedPeerCerts</span><span class="op" id="7131475">:</span>&nbsp;<span class="op" id="7131477">[</span><span class="op" id="7131478">]</span><span class="builtintype" id="7131479">string</span><span class="op" id="7131485">{</span><span class="ident" id="7131486"><a href="/crypto/tls/handshake_server_test.go.html#7127638">clientCertificatePEM</a></span><span class="op" id="7131506">}</span><span class="op" id="7131507">,</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131513"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7131531">(</span><span class="ident" id="7131532"><a href="/crypto/tls/handshake_server_test.go.html#7130575">t</a></span><span class="op" id="7131533">,</span>&nbsp;<span class="ident" id="7131535"><a href="/crypto/tls/handshake_server_test.go.html#7131031">test</a></span><span class="op" id="7131539">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131543"><a href="/crypto/tls/handshake_server_test.go.html#7131031">test</a></span>&nbsp;<span class="op" id="7131548">=</span>&nbsp;<span class="op" id="7131550">&amp;</span><span class="ident" id="7131551"><a href="/crypto/tls/handshake_server_test.go.html#7113112">serverTest</a></span><span class="op" id="7131561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131565">name</span><span class="op" id="7131569">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7131584">&#34;ClientAuthRequestedAndECDSAGiven&#34;</span><span class="op" id="7131618">,</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131622">command</span><span class="op" id="7131629">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7131641">[</span><span class="op" id="7131642">]</span><span class="builtintype" id="7131643">string</span><span class="op" id="7131649">{</span><span class="string" id="7131650">&#34;openssl&#34;</span><span class="op" id="7131659">,</span>&nbsp;<span class="string" id="7131661">&#34;s_client&#34;</span><span class="op" id="7131671">,</span>&nbsp;<span class="string" id="7131673">&#34;-no_ticket&#34;</span><span class="op" id="7131685">,</span>&nbsp;<span class="string" id="7131687">&#34;-cipher&#34;</span><span class="op" id="7131696">,</span>&nbsp;<span class="string" id="7131698">&#34;RC4-SHA&#34;</span><span class="op" id="7131707">,</span>&nbsp;<span class="string" id="7131709">&#34;-cert&#34;</span><span class="op" id="7131716">,</span>&nbsp;<span class="ident" id="7131718"><a href="/crypto/tls/handshake_server_test.go.html#7130615">ecdsaCertPath</a></span><span class="op" id="7131731">,</span>&nbsp;<span class="string" id="7131733">&#34;-key&#34;</span><span class="op" id="7131739">,</span>&nbsp;<span class="ident" id="7131741"><a href="/crypto/tls/handshake_server_test.go.html#7130630">ecdsaKeyPath</a></span><span class="op" id="7131753">}</span><span class="op" id="7131754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131758">config</span><span class="op" id="7131764">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7131777">&amp;</span><span class="ident" id="7131778"><a href="/crypto/tls/handshake_server_test.go.html#7130968">config</a></span><span class="op" id="7131784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131788">expectedPeerCerts</span><span class="op" id="7131805">:</span>&nbsp;<span class="op" id="7131807">[</span><span class="op" id="7131808">]</span><span class="builtintype" id="7131809">string</span><span class="op" id="7131815">{</span><span class="ident" id="7131816"><a href="/crypto/tls/handshake_server_test.go.html#7129308">clientECDSACertificatePEM</a></span><span class="op" id="7131841">}</span><span class="op" id="7131842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7131845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131848"><a href="/crypto/tls/handshake_server_test.go.html#7119619">runServerTestTLS12</a></span><span class="op" id="7131866">(</span><span class="ident" id="7131867"><a href="/crypto/tls/handshake_server_test.go.html#7130575">t</a></span><span class="op" id="7131868">,</span>&nbsp;<span class="ident" id="7131870"><a href="/crypto/tls/handshake_server_test.go.html#7131031">test</a></span><span class="op" id="7131874">)</span><br>
<span class="lineno">830</span><span class="op" id="7131876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7131879">func</span>&nbsp;<span class="ident" id="7131884">bigFromString</span><span class="op" id="7131897">(</span><span class="ident" id="7131898">s</span>&nbsp;<span class="builtintype" id="7131900">string</span><span class="op" id="7131906">)</span>&nbsp;<span class="op" id="7131908">*</span><span class="ident" id="7131909"><a href="/crypto/tls/handshake_server_test.go.html#7106671">big</a></span><span class="op" id="7131912">.</span><span class="ident" id="7131913">Int</span>&nbsp;<span class="op" id="7131917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131920">ret</span>&nbsp;<span class="op" id="7131924">:=</span>&nbsp;<span class="builtinfunc" id="7131927">new</span><span class="op" id="7131930">(</span><span class="ident" id="7131931"><a href="/crypto/tls/handshake_server_test.go.html#7106671">big</a></span><span class="op" id="7131934">.</span><span class="ident" id="7131935">Int</span><span class="op" id="7131938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7131941"><a href="/crypto/tls/handshake_server_test.go.html#7131920">ret</a></span><span class="op" id="7131944">.</span><span class="ident" id="7131945">SetString</span><span class="op" id="7131954">(</span><span class="ident" id="7131955"><a href="/crypto/tls/handshake_server_test.go.html#7131898">s</a></span><span class="op" id="7131956">,</span>&nbsp;<span class="num" id="7131958">10</span><span class="op" id="7131960">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7131963">return</span>&nbsp;<span class="ident" id="7131970"><a href="/crypto/tls/handshake_server_test.go.html#7131920">ret</a></span><br>
<span class="lineno"></span><span class="op" id="7131974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7131977">func</span>&nbsp;<span class="ident" id="7131982">fromHex</span><span class="op" id="7131989">(</span><span class="ident" id="7131990">s</span>&nbsp;<span class="builtintype" id="7131992">string</span><span class="op" id="7131998">)</span>&nbsp;<span class="op" id="7132000">[</span><span class="op" id="7132001">]</span><span class="builtintype" id="7132002">byte</span>&nbsp;<span class="op" id="7132007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7132010">b</span><span class="op" id="7132011">,</span>&nbsp;<span class="ident" id="7132013">_</span>&nbsp;<span class="op" id="7132015">:=</span>&nbsp;<span class="ident" id="7132018"><a href="/crypto/tls/handshake_server_test.go.html#7106616">hex</a></span><span class="op" id="7132021">.</span><span class="ident" id="7132022">DecodeString</span><span class="op" id="7132034">(</span><span class="ident" id="7132035"><a href="/crypto/tls/handshake_server_test.go.html#7131990">s</a></span><span class="op" id="7132036">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7132039">return</span>&nbsp;<span class="ident" id="7132046"><a href="/crypto/tls/handshake_server_test.go.html#7132010">b</a></span><br>
<span class="lineno"></span><span class="op" id="7132048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7132051">var</span>&nbsp;<span class="ident" id="7132055">testRSACertificate</span>&nbsp;<span class="op" id="7132074">=</span>&nbsp;<span class="ident" id="7132076"><a href="/crypto/tls/handshake_server_test.go.html#7131982">fromHex</a></span><span class="op" id="7132083">(</span><span class="string" id="7132084">&#34;308202b030820219a00302010202090085b0bba48a7fb8ca300d06092a864886f70d01010505003045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3130303432343039303933385a170d3131303432343039303933385a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a381a73081a4301d0603551d0e04160414b1ade2855acfcb28db69ce2369ded3268e18883930750603551d23046e306c8014b1ade2855acfcb28db69ce2369ded3268e188839a149a4473045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746482090085b0bba48a7fb8ca300c0603551d13040530030101ff300d06092a864886f70d010105050003818100086c4524c76bb159ab0c52ccf2b014d7879d7a6475b55a9566e4c52b8eae12661feb4f38b36e60d392fdf74108b52513b1187a24fb301dbaed98b917ece7d73159db95d31d78ea50565cd5825a2d5a5f33c4b6d8c97590968c0f5298b5cd981f89205ff2a01ca31b9694dda9fd57e970e8266d71999b266e3850296c90a7bdd9&#34;</span><span class="op" id="7133470">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span><span class="keyword" id="7133473">var</span>&nbsp;<span class="ident" id="7133477">testECDSACertificate</span>&nbsp;<span class="op" id="7133498">=</span>&nbsp;<span class="ident" id="7133500"><a href="/crypto/tls/handshake_server_test.go.html#7131982">fromHex</a></span><span class="op" id="7133507">(</span><span class="string" id="7133508">&#34;3082020030820162020900b8bf2d47a0d2ebf4300906072a8648ce3d04013045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3132313132323135303633325a170d3232313132303135303633325a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819b301006072a8648ce3d020106052b81040023038186000400c4a1edbe98f90b4873367ec316561122f23d53c33b4d213dcd6b75e6f6b0dc9adf26c1bcb287f072327cb3642f1c90bcea6823107efee325c0483a69e0286dd33700ef0462dd0da09c706283d881d36431aa9e9731bd96b068c09b23de76643f1a5c7fe9120e5858b65f70dd9bd8ead5d7f5d5ccb9b69f30665b669a20e227e5bffe3b300906072a8648ce3d040103818c0030818802420188a24febe245c5487d1bacf5ed989dae4770c05e1bb62fbdf1b64db76140d311a2ceee0b7e927eff769dc33b7ea53fcefa10e259ec472d7cacda4e970e15a06fd00242014dfcbe67139c2d050ebd3fa38c25c13313830d9406bbd4377af6ec7ac9862eddd711697f857c56defb31782be4c7780daecbbe9e4e3624317b6a0f399512078f2a&#34;</span><span class="op" id="7134542">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7134545">var</span>&nbsp;<span class="ident" id="7134549">testSNICertificate</span>&nbsp;<span class="op" id="7134568">=</span>&nbsp;<span class="ident" id="7134570"><a href="/crypto/tls/handshake_server_test.go.html#7131982">fromHex</a></span><span class="op" id="7134577">(</span><span class="string" id="7134578">&#34;308201f23082015da003020102020100300b06092a864886f70d01010530283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d301e170d3132303431313137343033355a170d3133303431313137343533355a30283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d30819d300b06092a864886f70d01010103818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a3323030300e0603551d0f0101ff0404030200a0300d0603551d0e0406040401020304300f0603551d2304083006800401020304300b06092a864886f70d0101050381810089c6455f1c1f5ef8eb1ab174ee2439059f5c4259bb1a8d86cdb1d056f56a717da40e95ab90f59e8deaf627c157995094db0802266eb34fc6842dea8a4b68d9c1389103ab84fb9e1f85d9b5d23ff2312c8670fbb540148245a4ebafe264d90c8a4cf4f85b0fac12ac2fc4a3154bad52462868af96c62c6525d652b6e31845bdcc&#34;</span><span class="op" id="7135584">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7135587">var</span>&nbsp;<span class="ident" id="7135591">testRSAPrivateKey</span>&nbsp;<span class="op" id="7135609">=</span>&nbsp;<span class="op" id="7135611">&amp;</span><span class="ident" id="7135612"><a href="/crypto/tls/handshake_server_test.go.html#7106602">rsa</a></span><span class="op" id="7135615">.</span><span class="ident" id="7135616">PrivateKey</span><span class="op" id="7135626">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135629">PublicKey</span><span class="op" id="7135638">:</span>&nbsp;<span class="ident" id="7135640"><a href="/crypto/tls/handshake_server_test.go.html#7106602">rsa</a></span><span class="op" id="7135643">.</span><span class="ident" id="7135644">PublicKey</span><span class="op" id="7135653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135657">N</span><span class="op" id="7135658">:</span>&nbsp;<span class="ident" id="7135660"><a href="/crypto/tls/handshake_server_test.go.html#7131884">bigFromString</a></span><span class="op" id="7135673">(</span><span class="string" id="7135674">&#34;131650079503776001033793877885499001334664249354723305978524647182322416328664556247316495448366990052837680518067798333412266673813370895702118944398081598789828837447552603077848001020611640547221687072142537202428102790818451901395596882588063427854225330436740647715202971973145151161964464812406232198521&#34;</span><span class="op" id="7135985">)</span><span class="op" id="7135986">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7135990">E</span><span class="op" id="7135991">:</span>&nbsp;<span class="num" id="7135993">65537</span><span class="op" id="7135998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7136001">}</span><span class="op" id="7136002">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136005">D</span><span class="op" id="7136006">:</span>&nbsp;<span class="ident" id="7136008"><a href="/crypto/tls/handshake_server_test.go.html#7131884">bigFromString</a></span><span class="op" id="7136021">(</span><span class="string" id="7136022">&#34;29354450337804273969007277378287027274721892607543397931919078829901848876371746653677097639302788129485893852488285045793268732234230875671682624082413996177431586734171663258657462237320300610850244186316880055243099640544518318093544057213190320837094958164973959123058337475052510833916491060913053867729&#34;</span><span class="op" id="7136332">)</span><span class="op" id="7136333">,</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136336">Primes</span><span class="op" id="7136342">:</span>&nbsp;<span class="op" id="7136344">[</span><span class="op" id="7136345">]</span><span class="op" id="7136346">*</span><span class="ident" id="7136347"><a href="/crypto/tls/handshake_server_test.go.html#7106671">big</a></span><span class="op" id="7136350">.</span><span class="ident" id="7136351">Int</span><span class="op" id="7136354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136358"><a href="/crypto/tls/handshake_server_test.go.html#7131884">bigFromString</a></span><span class="op" id="7136371">(</span><span class="string" id="7136372">&#34;11969277782311800166562047708379380720136961987713178380670422671426759650127150688426177829077494755200794297055316163155755835813760102405344560929062149&#34;</span><span class="op" id="7136529">)</span><span class="op" id="7136530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136534"><a href="/crypto/tls/handshake_server_test.go.html#7131884">bigFromString</a></span><span class="op" id="7136547">(</span><span class="string" id="7136548">&#34;10998999429884441391899182616418192492905073053684657075974935218461686523870125521822756579792315215543092255516093840728890783887287417039645833477273829&#34;</span><span class="op" id="7136705">)</span><span class="op" id="7136706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7136709">}</span><span class="op" id="7136710">,</span><br>
<span class="lineno"></span><span class="op" id="7136712">}</span><br>
<span class="lineno">860</span><br>
<span class="lineno"></span><span class="keyword" id="7136715">var</span>&nbsp;<span class="ident" id="7136719">testECDSAPrivateKey</span>&nbsp;<span class="op" id="7136739">=</span>&nbsp;<span class="op" id="7136741">&amp;</span><span class="ident" id="7136742"><a href="/crypto/tls/handshake_server_test.go.html#7106567">ecdsa</a></span><span class="op" id="7136747">.</span><span class="ident" id="7136748">PrivateKey</span><span class="op" id="7136758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136761">PublicKey</span><span class="op" id="7136770">:</span>&nbsp;<span class="ident" id="7136772"><a href="/crypto/tls/handshake_server_test.go.html#7106567">ecdsa</a></span><span class="op" id="7136777">.</span><span class="ident" id="7136778">PublicKey</span><span class="op" id="7136787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136791">Curve</span><span class="op" id="7136796">:</span>&nbsp;<span class="ident" id="7136798"><a href="/crypto/tls/handshake_server_test.go.html#7106583">elliptic</a></span><span class="op" id="7136806">.</span><span class="ident" id="7136807">P521</span><span class="op" id="7136811">(</span><span class="op" id="7136812">)</span><span class="op" id="7136813">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7136817">X</span><span class="op" id="7136818">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7136824"><a href="/crypto/tls/handshake_server_test.go.html#7131884">bigFromString</a></span><span class="op" id="7136837">(</span><span class="string" id="7136838">&#34;2636411247892461147287360222306590634450676461695221912739908880441342231985950069527906976759812296359387337367668045707086543273113073382714101597903639351&#34;</span><span class="op" id="7136997">)</span><span class="op" id="7136998">,</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137002">Y</span><span class="op" id="7137003">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7137009"><a href="/crypto/tls/handshake_server_test.go.html#7131884">bigFromString</a></span><span class="op" id="7137022">(</span><span class="string" id="7137023">&#34;3204695818431246682253994090650952614555094516658732116404513121125038617915183037601737180082382202488628239201196033284060130040574800684774115478859677243&#34;</span><span class="op" id="7137182">)</span><span class="op" id="7137183">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7137186">}</span><span class="op" id="7137187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7137190">D</span><span class="op" id="7137191">:</span>&nbsp;<span class="ident" id="7137193"><a href="/crypto/tls/handshake_server_test.go.html#7131884">bigFromString</a></span><span class="op" id="7137206">(</span><span class="string" id="7137207">&#34;5477294338614160138026852784385529180817726002953041720191098180813046231640184669647735805135001309477695746518160084669446643325196003346204701381388769751&#34;</span><span class="op" id="7137366">)</span><span class="op" id="7137367">,</span><br>
<span class="lineno"></span><span class="op" id="7137369">}</span>
</div>
</body>
</html>
