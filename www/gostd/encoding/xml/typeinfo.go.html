<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/xml</h2>
<ul>
<li><a href="/gostd/encoding/xml/atom_test.go.html">atom_test.go</a></li>
<li><a href="/gostd/encoding/xml/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/xml/marshal.go.html">marshal.go</a></li>
<li><a href="/gostd/encoding/xml/marshal_test.go.html">marshal_test.go</a></li>
<li><a href="/gostd/encoding/xml/read.go.html">read.go</a></li>
<li><a href="/gostd/encoding/xml/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/encoding/xml/typeinfo.go.html">typeinfo.go</a></li>
<li><a href="/gostd/encoding/xml/xml.go.html">xml.go</a></li>
<li><a href="/gostd/encoding/xml/xml_test.go.html">xml_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6422977">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6423033">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6423087">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6423138">package</span>&nbsp;<span class="ident" id="6423146">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6423151">import</span>&nbsp;<span class="op" id="6423158">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6423161">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6423168">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6423179">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6423190">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6423197">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6423200">//&nbsp;typeInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;type.</span><br>
<span class="lineno">15</span><span class="keyword" id="6423264">type</span>&nbsp;<span class="ident" id="6423269">typeInfo</span>&nbsp;<span class="keyword" id="6423278">struct</span>&nbsp;<span class="op" id="6423285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423288">xmlname</span>&nbsp;<span class="op" id="6423296">*</span><span class="ident" id="6423297">fieldInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423308">fields</span>&nbsp;&nbsp;<span class="op" id="6423316">[</span><span class="op" id="6423317">]</span><span class="ident" id="6423318">fieldInfo</span><br>
<span class="lineno"></span><span class="op" id="6423328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="6423331">//&nbsp;fieldInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="6423404">type</span>&nbsp;<span class="ident" id="6423409">fieldInfo</span>&nbsp;<span class="keyword" id="6423419">struct</span>&nbsp;<span class="op" id="6423426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423429">idx</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6423437">[</span><span class="op" id="6423438">]</span><span class="builtintype" id="6423439">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423444">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6423452">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423460">xmlns</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6423468">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423476">flags</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6423484">fieldFlags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423496">parents</span>&nbsp;<span class="op" id="6423504">[</span><span class="op" id="6423505">]</span><span class="builtintype" id="6423506">string</span><br>
<span class="lineno"></span><span class="op" id="6423513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6423516">type</span>&nbsp;<span class="ident" id="6423521">fieldFlags</span>&nbsp;<span class="builtintype" id="6423532">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="6423537">const</span>&nbsp;<span class="op" id="6423543">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423546">fElement</span>&nbsp;<span class="ident" id="6423555">fieldFlags</span>&nbsp;<span class="op" id="6423566">=</span>&nbsp;<span class="num" id="6423568">1</span>&nbsp;<span class="op" id="6423570">&lt;&lt;</span>&nbsp;<span class="ident" id="6423573">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423579">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423586">fCharData</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423597">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423608">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423618">fAny</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423625">fOmitEmpty</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423638">fMode</span>&nbsp;<span class="op" id="6423644">=</span>&nbsp;<span class="ident" id="6423646">fElement</span>&nbsp;<span class="op" id="6423655">|</span>&nbsp;<span class="ident" id="6423657">fAttr</span>&nbsp;<span class="op" id="6423663">|</span>&nbsp;<span class="ident" id="6423665">fCharData</span>&nbsp;<span class="op" id="6423675">|</span>&nbsp;<span class="ident" id="6423677">fInnerXml</span>&nbsp;<span class="op" id="6423687">|</span>&nbsp;<span class="ident" id="6423689">fComment</span>&nbsp;<span class="op" id="6423698">|</span>&nbsp;<span class="ident" id="6423700">fAny</span><br>
<span class="lineno"></span><span class="op" id="6423705">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6423708">var</span>&nbsp;<span class="ident" id="6423712">tinfoMap</span>&nbsp;<span class="op" id="6423721">=</span>&nbsp;<span class="builtinfunc" id="6423723">make</span><span class="op" id="6423727">(</span><span class="keyword" id="6423728">map</span><span class="op" id="6423731">[</span><span class="ident" id="6423732">reflect</span><span class="op" id="6423739">.</span><span class="ident" id="6423740">Type</span><span class="op" id="6423744">]</span><span class="op" id="6423745">*</span><span class="ident" id="6423746">typeInfo</span><span class="op" id="6423754">)</span><br>
<span class="lineno">45</span><span class="keyword" id="6423756">var</span>&nbsp;<span class="ident" id="6423760">tinfoLock</span>&nbsp;<span class="ident" id="6423770">sync</span><span class="op" id="6423774">.</span><span class="ident" id="6423775">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6423784">var</span>&nbsp;<span class="ident" id="6423788">nameType</span>&nbsp;<span class="op" id="6423797">=</span>&nbsp;<span class="ident" id="6423799">reflect</span><span class="op" id="6423806">.</span><span class="ident" id="6423807">TypeOf</span><span class="op" id="6423813">(</span><span class="ident" id="6423814">Name</span><span class="op" id="6423818">{</span><span class="op" id="6423819">}</span><span class="op" id="6423820">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6423823">//&nbsp;getTypeInfo&nbsp;returns&nbsp;the&nbsp;typeInfo&nbsp;structure&nbsp;with&nbsp;details&nbsp;necessary</span><br>
<span class="lineno">50</span><span class="comment" id="6423892">//&nbsp;for&nbsp;marshalling&nbsp;and&nbsp;unmarshalling&nbsp;typ.</span><br>
<span class="lineno"></span><span class="keyword" id="6423934">func</span>&nbsp;<span class="ident" id="6423939">getTypeInfo</span><span class="op" id="6423950">(</span><span class="ident" id="6423951">typ</span>&nbsp;<span class="ident" id="6423955">reflect</span><span class="op" id="6423962">.</span><span class="ident" id="6423963">Type</span><span class="op" id="6423967">)</span>&nbsp;<span class="op" id="6423969">(</span><span class="op" id="6423970">*</span><span class="ident" id="6423971">typeInfo</span><span class="op" id="6423979">,</span>&nbsp;<span class="builtintype" id="6423981">error</span><span class="op" id="6423986">)</span>&nbsp;<span class="op" id="6423988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423991">tinfoLock</span><span class="op" id="6424000">.</span><span class="ident" id="6424001">RLock</span><span class="op" id="6424006">(</span><span class="op" id="6424007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424010">tinfo</span><span class="op" id="6424015">,</span>&nbsp;<span class="ident" id="6424017">ok</span>&nbsp;<span class="op" id="6424020">:=</span>&nbsp;<span class="ident" id="6424023">tinfoMap</span><span class="op" id="6424031">[</span><span class="ident" id="6424032">typ</span><span class="op" id="6424035">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424038">tinfoLock</span><span class="op" id="6424047">.</span><span class="ident" id="6424048">RUnlock</span><span class="op" id="6424055">(</span><span class="op" id="6424056">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424059">if</span>&nbsp;<span class="ident" id="6424062">ok</span>&nbsp;<span class="op" id="6424065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424069">return</span>&nbsp;<span class="ident" id="6424076">tinfo</span><span class="op" id="6424081">,</span>&nbsp;<span class="ident" id="6424083">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424091">tinfo</span>&nbsp;<span class="op" id="6424097">=</span>&nbsp;<span class="op" id="6424099">&amp;</span><span class="ident" id="6424100">typeInfo</span><span class="op" id="6424108">{</span><span class="op" id="6424109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424112">if</span>&nbsp;<span class="ident" id="6424115">typ</span><span class="op" id="6424118">.</span><span class="ident" id="6424119">Kind</span><span class="op" id="6424123">(</span><span class="op" id="6424124">)</span>&nbsp;<span class="op" id="6424126">==</span>&nbsp;<span class="ident" id="6424129">reflect</span><span class="op" id="6424136">.</span><span class="ident" id="6424137">Struct</span>&nbsp;<span class="op" id="6424144">&amp;&amp;</span>&nbsp;<span class="ident" id="6424147">typ</span>&nbsp;<span class="op" id="6424151">!=</span>&nbsp;<span class="ident" id="6424154">nameType</span>&nbsp;<span class="op" id="6424163">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424167">n</span>&nbsp;<span class="op" id="6424169">:=</span>&nbsp;<span class="ident" id="6424172">typ</span><span class="op" id="6424175">.</span><span class="ident" id="6424176">NumField</span><span class="op" id="6424184">(</span><span class="op" id="6424185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424189">for</span>&nbsp;<span class="ident" id="6424193">i</span>&nbsp;<span class="op" id="6424195">:=</span>&nbsp;<span class="num" id="6424198">0</span><span class="op" id="6424199">;</span>&nbsp;<span class="ident" id="6424201">i</span>&nbsp;<span class="op" id="6424203">&lt;</span>&nbsp;<span class="ident" id="6424205">n</span><span class="op" id="6424206">;</span>&nbsp;<span class="ident" id="6424208">i</span><span class="op" id="6424209">++</span>&nbsp;<span class="op" id="6424212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424217">f</span>&nbsp;<span class="op" id="6424219">:=</span>&nbsp;<span class="ident" id="6424222">typ</span><span class="op" id="6424225">.</span><span class="ident" id="6424226">Field</span><span class="op" id="6424231">(</span><span class="ident" id="6424232">i</span><span class="op" id="6424233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424238">if</span>&nbsp;<span class="ident" id="6424241">f</span><span class="op" id="6424242">.</span><span class="ident" id="6424243">PkgPath</span>&nbsp;<span class="op" id="6424251">!=</span>&nbsp;<span class="string" id="6424254">&#34;&#34;</span>&nbsp;<span class="op" id="6424257">||</span>&nbsp;<span class="ident" id="6424260">f</span><span class="op" id="6424261">.</span><span class="ident" id="6424262">Tag</span><span class="op" id="6424265">.</span><span class="ident" id="6424266">Get</span><span class="op" id="6424269">(</span><span class="string" id="6424270">&#34;xml&#34;</span><span class="op" id="6424275">)</span>&nbsp;<span class="op" id="6424277">==</span>&nbsp;<span class="string" id="6424280">&#34;-&#34;</span>&nbsp;<span class="op" id="6424284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424290">continue</span>&nbsp;<span class="comment" id="6424299">//&nbsp;Private&nbsp;field</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6424325">//&nbsp;For&nbsp;embedded&nbsp;structs,&nbsp;embed&nbsp;its&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424371">if</span>&nbsp;<span class="ident" id="6424374">f</span><span class="op" id="6424375">.</span><span class="ident" id="6424376">Anonymous</span>&nbsp;<span class="op" id="6424386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424392">t</span>&nbsp;<span class="op" id="6424394">:=</span>&nbsp;<span class="ident" id="6424397">f</span><span class="op" id="6424398">.</span><span class="ident" id="6424399">Type</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424408">if</span>&nbsp;<span class="ident" id="6424411">t</span><span class="op" id="6424412">.</span><span class="ident" id="6424413">Kind</span><span class="op" id="6424417">(</span><span class="op" id="6424418">)</span>&nbsp;<span class="op" id="6424420">==</span>&nbsp;<span class="ident" id="6424423">reflect</span><span class="op" id="6424430">.</span><span class="ident" id="6424431">Ptr</span>&nbsp;<span class="op" id="6424435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424442">t</span>&nbsp;<span class="op" id="6424444">=</span>&nbsp;<span class="ident" id="6424446">t</span><span class="op" id="6424447">.</span><span class="ident" id="6424448">Elem</span><span class="op" id="6424452">(</span><span class="op" id="6424453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424465">if</span>&nbsp;<span class="ident" id="6424468">t</span><span class="op" id="6424469">.</span><span class="ident" id="6424470">Kind</span><span class="op" id="6424474">(</span><span class="op" id="6424475">)</span>&nbsp;<span class="op" id="6424477">==</span>&nbsp;<span class="ident" id="6424480">reflect</span><span class="op" id="6424487">.</span><span class="ident" id="6424488">Struct</span>&nbsp;<span class="op" id="6424495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424502">inner</span><span class="op" id="6424507">,</span>&nbsp;<span class="ident" id="6424509">err</span>&nbsp;<span class="op" id="6424513">:=</span>&nbsp;<span class="ident" id="6424516">getTypeInfo</span><span class="op" id="6424527">(</span><span class="ident" id="6424528">t</span><span class="op" id="6424529">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424536">if</span>&nbsp;<span class="ident" id="6424539">err</span>&nbsp;<span class="op" id="6424543">!=</span>&nbsp;<span class="ident" id="6424546">nil</span>&nbsp;<span class="op" id="6424550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424558">return</span>&nbsp;<span class="ident" id="6424565">nil</span><span class="op" id="6424568">,</span>&nbsp;<span class="ident" id="6424570">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424586">if</span>&nbsp;<span class="ident" id="6424589">tinfo</span><span class="op" id="6424594">.</span><span class="ident" id="6424595">xmlname</span>&nbsp;<span class="op" id="6424603">==</span>&nbsp;<span class="ident" id="6424606">nil</span>&nbsp;<span class="op" id="6424610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424618">tinfo</span><span class="op" id="6424623">.</span><span class="ident" id="6424624">xmlname</span>&nbsp;<span class="op" id="6424632">=</span>&nbsp;<span class="ident" id="6424634">inner</span><span class="op" id="6424639">.</span><span class="ident" id="6424640">xmlname</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424660">for</span>&nbsp;<span class="ident" id="6424664">_</span><span class="op" id="6424665">,</span>&nbsp;<span class="ident" id="6424667">finfo</span>&nbsp;<span class="op" id="6424673">:=</span>&nbsp;<span class="keyword" id="6424676">range</span>&nbsp;<span class="ident" id="6424682">inner</span><span class="op" id="6424687">.</span><span class="ident" id="6424688">fields</span>&nbsp;<span class="op" id="6424695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424703">finfo</span><span class="op" id="6424708">.</span><span class="ident" id="6424709">idx</span>&nbsp;<span class="op" id="6424713">=</span>&nbsp;<span class="builtinfunc" id="6424715">append</span><span class="op" id="6424721">(</span><span class="op" id="6424722">[</span><span class="op" id="6424723">]</span><span class="builtintype" id="6424724">int</span><span class="op" id="6424727">{</span><span class="ident" id="6424728">i</span><span class="op" id="6424729">}</span><span class="op" id="6424730">,</span>&nbsp;<span class="ident" id="6424732">finfo</span><span class="op" id="6424737">.</span><span class="ident" id="6424738">idx</span><span class="op" id="6424741">...</span><span class="op" id="6424744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424752">if</span>&nbsp;<span class="ident" id="6424755">err</span>&nbsp;<span class="op" id="6424759">:=</span>&nbsp;<span class="ident" id="6424762">addFieldInfo</span><span class="op" id="6424774">(</span><span class="ident" id="6424775">typ</span><span class="op" id="6424778">,</span>&nbsp;<span class="ident" id="6424780">tinfo</span><span class="op" id="6424785">,</span>&nbsp;<span class="op" id="6424787">&amp;</span><span class="ident" id="6424788">finfo</span><span class="op" id="6424793">)</span><span class="op" id="6424794">;</span>&nbsp;<span class="ident" id="6424796">err</span>&nbsp;<span class="op" id="6424800">!=</span>&nbsp;<span class="ident" id="6424803">nil</span>&nbsp;<span class="op" id="6424807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424816">return</span>&nbsp;<span class="ident" id="6424823">nil</span><span class="op" id="6424826">,</span>&nbsp;<span class="ident" id="6424828">err</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424852">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424870">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424876">finfo</span><span class="op" id="6424881">,</span>&nbsp;<span class="ident" id="6424883">err</span>&nbsp;<span class="op" id="6424887">:=</span>&nbsp;<span class="ident" id="6424890">structFieldInfo</span><span class="op" id="6424905">(</span><span class="ident" id="6424906">typ</span><span class="op" id="6424909">,</span>&nbsp;<span class="op" id="6424911">&amp;</span><span class="ident" id="6424912">f</span><span class="op" id="6424913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424918">if</span>&nbsp;<span class="ident" id="6424921">err</span>&nbsp;<span class="op" id="6424925">!=</span>&nbsp;<span class="ident" id="6424928">nil</span>&nbsp;<span class="op" id="6424932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424938">return</span>&nbsp;<span class="ident" id="6424945">nil</span><span class="op" id="6424948">,</span>&nbsp;<span class="ident" id="6424950">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424957">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424963">if</span>&nbsp;<span class="ident" id="6424966">f</span><span class="op" id="6424967">.</span><span class="ident" id="6424968">Name</span>&nbsp;<span class="op" id="6424973">==</span>&nbsp;<span class="string" id="6424976">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6424986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424992">tinfo</span><span class="op" id="6424997">.</span><span class="ident" id="6424998">xmlname</span>&nbsp;<span class="op" id="6425006">=</span>&nbsp;<span class="ident" id="6425008">finfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425018">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6425030">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6425036">//&nbsp;Add&nbsp;the&nbsp;field&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;conflict&nbsp;with&nbsp;other&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425098">if</span>&nbsp;<span class="ident" id="6425101">err</span>&nbsp;<span class="op" id="6425105">:=</span>&nbsp;<span class="ident" id="6425108">addFieldInfo</span><span class="op" id="6425120">(</span><span class="ident" id="6425121">typ</span><span class="op" id="6425124">,</span>&nbsp;<span class="ident" id="6425126">tinfo</span><span class="op" id="6425131">,</span>&nbsp;<span class="ident" id="6425133">finfo</span><span class="op" id="6425138">)</span><span class="op" id="6425139">;</span>&nbsp;<span class="ident" id="6425141">err</span>&nbsp;<span class="op" id="6425145">!=</span>&nbsp;<span class="ident" id="6425148">nil</span>&nbsp;<span class="op" id="6425152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425158">return</span>&nbsp;<span class="ident" id="6425165">nil</span><span class="op" id="6425168">,</span>&nbsp;<span class="ident" id="6425170">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6425177">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6425181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6425184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425187">tinfoLock</span><span class="op" id="6425196">.</span><span class="ident" id="6425197">Lock</span><span class="op" id="6425201">(</span><span class="op" id="6425202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425205">tinfoMap</span><span class="op" id="6425213">[</span><span class="ident" id="6425214">typ</span><span class="op" id="6425217">]</span>&nbsp;<span class="op" id="6425219">=</span>&nbsp;<span class="ident" id="6425221">tinfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425228">tinfoLock</span><span class="op" id="6425237">.</span><span class="ident" id="6425238">Unlock</span><span class="op" id="6425244">(</span><span class="op" id="6425245">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425248">return</span>&nbsp;<span class="ident" id="6425255">tinfo</span><span class="op" id="6425260">,</span>&nbsp;<span class="ident" id="6425262">nil</span><br>
<span class="lineno"></span><span class="op" id="6425266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6425269">//&nbsp;structFieldInfo&nbsp;builds&nbsp;and&nbsp;returns&nbsp;a&nbsp;fieldInfo&nbsp;for&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="6425326">func</span>&nbsp;<span class="ident" id="6425331">structFieldInfo</span><span class="op" id="6425346">(</span><span class="ident" id="6425347">typ</span>&nbsp;<span class="ident" id="6425351">reflect</span><span class="op" id="6425358">.</span><span class="ident" id="6425359">Type</span><span class="op" id="6425363">,</span>&nbsp;<span class="ident" id="6425365">f</span>&nbsp;<span class="op" id="6425367">*</span><span class="ident" id="6425368">reflect</span><span class="op" id="6425375">.</span><span class="ident" id="6425376">StructField</span><span class="op" id="6425387">)</span>&nbsp;<span class="op" id="6425389">(</span><span class="op" id="6425390">*</span><span class="ident" id="6425391">fieldInfo</span><span class="op" id="6425400">,</span>&nbsp;<span class="builtintype" id="6425402">error</span><span class="op" id="6425407">)</span>&nbsp;<span class="op" id="6425409">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425412">finfo</span>&nbsp;<span class="op" id="6425418">:=</span>&nbsp;<span class="op" id="6425421">&amp;</span><span class="ident" id="6425422">fieldInfo</span><span class="op" id="6425431">{</span><span class="ident" id="6425432">idx</span><span class="op" id="6425435">:</span>&nbsp;<span class="ident" id="6425437">f</span><span class="op" id="6425438">.</span><span class="ident" id="6425439">Index</span><span class="op" id="6425444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6425448">//&nbsp;Split&nbsp;the&nbsp;tag&nbsp;from&nbsp;the&nbsp;xml&nbsp;namespace&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425503">tag</span>&nbsp;<span class="op" id="6425507">:=</span>&nbsp;<span class="ident" id="6425510">f</span><span class="op" id="6425511">.</span><span class="ident" id="6425512">Tag</span><span class="op" id="6425515">.</span><span class="ident" id="6425516">Get</span><span class="op" id="6425519">(</span><span class="string" id="6425520">&#34;xml&#34;</span><span class="op" id="6425525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425528">if</span>&nbsp;<span class="ident" id="6425531">i</span>&nbsp;<span class="op" id="6425533">:=</span>&nbsp;<span class="ident" id="6425536">strings</span><span class="op" id="6425543">.</span><span class="ident" id="6425544">Index</span><span class="op" id="6425549">(</span><span class="ident" id="6425550">tag</span><span class="op" id="6425553">,</span>&nbsp;<span class="string" id="6425555">&#34;&nbsp;&#34;</span><span class="op" id="6425558">)</span><span class="op" id="6425559">;</span>&nbsp;<span class="ident" id="6425561">i</span>&nbsp;<span class="op" id="6425563">&gt;=</span>&nbsp;<span class="num" id="6425566">0</span>&nbsp;<span class="op" id="6425568">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425572">finfo</span><span class="op" id="6425577">.</span><span class="ident" id="6425578">xmlns</span><span class="op" id="6425583">,</span>&nbsp;<span class="ident" id="6425585">tag</span>&nbsp;<span class="op" id="6425589">=</span>&nbsp;<span class="ident" id="6425591">tag</span><span class="op" id="6425594">[</span><span class="op" id="6425595">:</span><span class="ident" id="6425596">i</span><span class="op" id="6425597">]</span><span class="op" id="6425598">,</span>&nbsp;<span class="ident" id="6425600">tag</span><span class="op" id="6425603">[</span><span class="ident" id="6425604">i</span><span class="op" id="6425605">+</span><span class="num" id="6425606">1</span><span class="op" id="6425607">:</span><span class="op" id="6425608">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6425611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6425615">//&nbsp;Parse&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425632">tokens</span>&nbsp;<span class="op" id="6425639">:=</span>&nbsp;<span class="ident" id="6425642">strings</span><span class="op" id="6425649">.</span><span class="ident" id="6425650">Split</span><span class="op" id="6425655">(</span><span class="ident" id="6425656">tag</span><span class="op" id="6425659">,</span>&nbsp;<span class="string" id="6425661">&#34;,&#34;</span><span class="op" id="6425664">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425667">if</span>&nbsp;<span class="builtinfunc" id="6425670">len</span><span class="op" id="6425673">(</span><span class="ident" id="6425674">tokens</span><span class="op" id="6425680">)</span>&nbsp;<span class="op" id="6425682">==</span>&nbsp;<span class="num" id="6425685">1</span>&nbsp;<span class="op" id="6425687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425691">finfo</span><span class="op" id="6425696">.</span><span class="ident" id="6425697">flags</span>&nbsp;<span class="op" id="6425703">=</span>&nbsp;<span class="ident" id="6425705">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6425715">}</span>&nbsp;<span class="keyword" id="6425717">else</span>&nbsp;<span class="op" id="6425722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425726">tag</span>&nbsp;<span class="op" id="6425730">=</span>&nbsp;<span class="ident" id="6425732">tokens</span><span class="op" id="6425738">[</span><span class="num" id="6425739">0</span><span class="op" id="6425740">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425744">for</span>&nbsp;<span class="ident" id="6425748">_</span><span class="op" id="6425749">,</span>&nbsp;<span class="ident" id="6425751">flag</span>&nbsp;<span class="op" id="6425756">:=</span>&nbsp;<span class="keyword" id="6425759">range</span>&nbsp;<span class="ident" id="6425765">tokens</span><span class="op" id="6425771">[</span><span class="num" id="6425772">1</span><span class="op" id="6425773">:</span><span class="op" id="6425774">]</span>&nbsp;<span class="op" id="6425776">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425781">switch</span>&nbsp;<span class="ident" id="6425788">flag</span>&nbsp;<span class="op" id="6425793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425798">case</span>&nbsp;<span class="string" id="6425803">&#34;attr&#34;</span><span class="op" id="6425809">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425815">finfo</span><span class="op" id="6425820">.</span><span class="ident" id="6425821">flags</span>&nbsp;<span class="op" id="6425827">|=</span>&nbsp;<span class="ident" id="6425830">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425839">case</span>&nbsp;<span class="string" id="6425844">&#34;chardata&#34;</span><span class="op" id="6425854">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425860">finfo</span><span class="op" id="6425865">.</span><span class="ident" id="6425866">flags</span>&nbsp;<span class="op" id="6425872">|=</span>&nbsp;<span class="ident" id="6425875">fCharData</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425888">case</span>&nbsp;<span class="string" id="6425893">&#34;innerxml&#34;</span><span class="op" id="6425903">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425909">finfo</span><span class="op" id="6425914">.</span><span class="ident" id="6425915">flags</span>&nbsp;<span class="op" id="6425921">|=</span>&nbsp;<span class="ident" id="6425924">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425937">case</span>&nbsp;<span class="string" id="6425942">&#34;comment&#34;</span><span class="op" id="6425951">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425957">finfo</span><span class="op" id="6425962">.</span><span class="ident" id="6425963">flags</span>&nbsp;<span class="op" id="6425969">|=</span>&nbsp;<span class="ident" id="6425972">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425984">case</span>&nbsp;<span class="string" id="6425989">&#34;any&#34;</span><span class="op" id="6425994">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426000">finfo</span><span class="op" id="6426005">.</span><span class="ident" id="6426006">flags</span>&nbsp;<span class="op" id="6426012">|=</span>&nbsp;<span class="ident" id="6426015">fAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426023">case</span>&nbsp;<span class="string" id="6426028">&#34;omitempty&#34;</span><span class="op" id="6426039">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426045">finfo</span><span class="op" id="6426050">.</span><span class="ident" id="6426051">flags</span>&nbsp;<span class="op" id="6426057">|=</span>&nbsp;<span class="ident" id="6426060">fOmitEmpty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426078">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6426083">//&nbsp;Validate&nbsp;the&nbsp;flags&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426113">valid</span>&nbsp;<span class="op" id="6426119">:=</span>&nbsp;<span class="builtintype" id="6426122">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426129">switch</span>&nbsp;<span class="ident" id="6426136">mode</span>&nbsp;<span class="op" id="6426141">:=</span>&nbsp;<span class="ident" id="6426144">finfo</span><span class="op" id="6426149">.</span><span class="ident" id="6426150">flags</span>&nbsp;<span class="op" id="6426156">&amp;</span>&nbsp;<span class="ident" id="6426158">fMode</span><span class="op" id="6426163">;</span>&nbsp;<span class="ident" id="6426165">mode</span>&nbsp;<span class="op" id="6426170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426174">case</span>&nbsp;<span class="num" id="6426179">0</span><span class="op" id="6426180">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426185">finfo</span><span class="op" id="6426190">.</span><span class="ident" id="6426191">flags</span>&nbsp;<span class="op" id="6426197">|=</span>&nbsp;<span class="ident" id="6426200">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426211">case</span>&nbsp;<span class="ident" id="6426216">fAttr</span><span class="op" id="6426221">,</span>&nbsp;<span class="ident" id="6426223">fCharData</span><span class="op" id="6426232">,</span>&nbsp;<span class="ident" id="6426234">fInnerXml</span><span class="op" id="6426243">,</span>&nbsp;<span class="ident" id="6426245">fComment</span><span class="op" id="6426253">,</span>&nbsp;<span class="ident" id="6426255">fAny</span><span class="op" id="6426259">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426264">if</span>&nbsp;<span class="ident" id="6426267">f</span><span class="op" id="6426268">.</span><span class="ident" id="6426269">Name</span>&nbsp;<span class="op" id="6426274">==</span>&nbsp;<span class="string" id="6426277">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6426287">||</span>&nbsp;<span class="ident" id="6426290">tag</span>&nbsp;<span class="op" id="6426294">!=</span>&nbsp;<span class="string" id="6426297">&#34;&#34;</span>&nbsp;<span class="op" id="6426300">&amp;&amp;</span>&nbsp;<span class="ident" id="6426303">mode</span>&nbsp;<span class="op" id="6426308">!=</span>&nbsp;<span class="ident" id="6426311">fAttr</span>&nbsp;<span class="op" id="6426317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426323">valid</span>&nbsp;<span class="op" id="6426329">=</span>&nbsp;<span class="builtintype" id="6426331">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426340">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426344">default</span><span class="op" id="6426351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6426356">//&nbsp;This&nbsp;will&nbsp;also&nbsp;catch&nbsp;multiple&nbsp;modes&nbsp;in&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426417">valid</span>&nbsp;<span class="op" id="6426423">=</span>&nbsp;<span class="builtintype" id="6426425">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426437">if</span>&nbsp;<span class="ident" id="6426440">finfo</span><span class="op" id="6426445">.</span><span class="ident" id="6426446">flags</span><span class="op" id="6426451">&amp;</span><span class="ident" id="6426452">fMode</span>&nbsp;<span class="op" id="6426458">==</span>&nbsp;<span class="ident" id="6426461">fAny</span>&nbsp;<span class="op" id="6426466">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426471">finfo</span><span class="op" id="6426476">.</span><span class="ident" id="6426477">flags</span>&nbsp;<span class="op" id="6426483">|=</span>&nbsp;<span class="ident" id="6426486">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426501">if</span>&nbsp;<span class="ident" id="6426504">finfo</span><span class="op" id="6426509">.</span><span class="ident" id="6426510">flags</span><span class="op" id="6426515">&amp;</span><span class="ident" id="6426516">fOmitEmpty</span>&nbsp;<span class="op" id="6426527">!=</span>&nbsp;<span class="num" id="6426530">0</span>&nbsp;<span class="op" id="6426532">&amp;&amp;</span>&nbsp;<span class="ident" id="6426535">finfo</span><span class="op" id="6426540">.</span><span class="ident" id="6426541">flags</span><span class="op" id="6426546">&amp;</span><span class="op" id="6426547">(</span><span class="ident" id="6426548">fElement</span><span class="op" id="6426556">|</span><span class="ident" id="6426557">fAttr</span><span class="op" id="6426562">)</span>&nbsp;<span class="op" id="6426564">==</span>&nbsp;<span class="num" id="6426567">0</span>&nbsp;<span class="op" id="6426569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426574">valid</span>&nbsp;<span class="op" id="6426580">=</span>&nbsp;<span class="builtintype" id="6426582">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426590">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426594">if</span>&nbsp;<span class="op" id="6426597">!</span><span class="ident" id="6426598">valid</span>&nbsp;<span class="op" id="6426604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426609">return</span>&nbsp;<span class="ident" id="6426616">nil</span><span class="op" id="6426619">,</span>&nbsp;<span class="ident" id="6426621">fmt</span><span class="op" id="6426624">.</span><span class="ident" id="6426625">Errorf</span><span class="op" id="6426631">(</span><span class="string" id="6426632">&#34;xml:&nbsp;invalid&nbsp;tag&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="6426677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426683">f</span><span class="op" id="6426684">.</span><span class="ident" id="6426685">Name</span><span class="op" id="6426689">,</span>&nbsp;<span class="ident" id="6426691">typ</span><span class="op" id="6426694">,</span>&nbsp;<span class="ident" id="6426696">f</span><span class="op" id="6426697">.</span><span class="ident" id="6426698">Tag</span><span class="op" id="6426701">.</span><span class="ident" id="6426702">Get</span><span class="op" id="6426705">(</span><span class="string" id="6426706">&#34;xml&#34;</span><span class="op" id="6426711">)</span><span class="op" id="6426712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426719">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6426723">//&nbsp;Use&nbsp;of&nbsp;xmlns&nbsp;without&nbsp;a&nbsp;name&nbsp;is&nbsp;not&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426771">if</span>&nbsp;<span class="ident" id="6426774">finfo</span><span class="op" id="6426779">.</span><span class="ident" id="6426780">xmlns</span>&nbsp;<span class="op" id="6426786">!=</span>&nbsp;<span class="string" id="6426789">&#34;&#34;</span>&nbsp;<span class="op" id="6426792">&amp;&amp;</span>&nbsp;<span class="ident" id="6426795">tag</span>&nbsp;<span class="op" id="6426799">==</span>&nbsp;<span class="string" id="6426802">&#34;&#34;</span>&nbsp;<span class="op" id="6426805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426809">return</span>&nbsp;<span class="ident" id="6426816">nil</span><span class="op" id="6426819">,</span>&nbsp;<span class="ident" id="6426821">fmt</span><span class="op" id="6426824">.</span><span class="ident" id="6426825">Errorf</span><span class="op" id="6426831">(</span><span class="string" id="6426832">&#34;xml:&nbsp;namespace&nbsp;without&nbsp;name&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="6426888">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426893">f</span><span class="op" id="6426894">.</span><span class="ident" id="6426895">Name</span><span class="op" id="6426899">,</span>&nbsp;<span class="ident" id="6426901">typ</span><span class="op" id="6426904">,</span>&nbsp;<span class="ident" id="6426906">f</span><span class="op" id="6426907">.</span><span class="ident" id="6426908">Tag</span><span class="op" id="6426911">.</span><span class="ident" id="6426912">Get</span><span class="op" id="6426915">(</span><span class="string" id="6426916">&#34;xml&#34;</span><span class="op" id="6426921">)</span><span class="op" id="6426922">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426929">if</span>&nbsp;<span class="ident" id="6426932">f</span><span class="op" id="6426933">.</span><span class="ident" id="6426934">Name</span>&nbsp;<span class="op" id="6426939">==</span>&nbsp;<span class="string" id="6426942">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6426952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6426956">//&nbsp;The&nbsp;XMLName&nbsp;field&nbsp;records&nbsp;the&nbsp;XML&nbsp;element&nbsp;name.&nbsp;Don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6427015">//&nbsp;process&nbsp;it&nbsp;as&nbsp;usual&nbsp;because&nbsp;its&nbsp;name&nbsp;should&nbsp;default&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6427075">//&nbsp;empty&nbsp;rather&nbsp;than&nbsp;to&nbsp;the&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6427117">finfo</span><span class="op" id="6427122">.</span><span class="ident" id="6427123">name</span>&nbsp;<span class="op" id="6427128">=</span>&nbsp;<span class="ident" id="6427130">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427136">return</span>&nbsp;<span class="ident" id="6427143">finfo</span><span class="op" id="6427148">,</span>&nbsp;<span class="ident" id="6427150">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6427155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427159">if</span>&nbsp;<span class="ident" id="6427162">tag</span>&nbsp;<span class="op" id="6427166">==</span>&nbsp;<span class="string" id="6427169">&#34;&#34;</span>&nbsp;<span class="op" id="6427172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6427176">//&nbsp;If&nbsp;the&nbsp;name&nbsp;part&nbsp;of&nbsp;the&nbsp;tag&nbsp;is&nbsp;completely&nbsp;empty,&nbsp;get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6427234">//&nbsp;default&nbsp;from&nbsp;XMLName&nbsp;of&nbsp;underlying&nbsp;struct&nbsp;if&nbsp;feasible,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6427294">//&nbsp;or&nbsp;field&nbsp;name&nbsp;otherwise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427324">if</span>&nbsp;<span class="ident" id="6427327">xmlname</span>&nbsp;<span class="op" id="6427335">:=</span>&nbsp;<span class="ident" id="6427338">lookupXMLName</span><span class="op" id="6427351">(</span><span class="ident" id="6427352">f</span><span class="op" id="6427353">.</span><span class="ident" id="6427354">Type</span><span class="op" id="6427358">)</span><span class="op" id="6427359">;</span>&nbsp;<span class="ident" id="6427361">xmlname</span>&nbsp;<span class="op" id="6427369">!=</span>&nbsp;<span class="ident" id="6427372">nil</span>&nbsp;<span class="op" id="6427376">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6427381">finfo</span><span class="op" id="6427386">.</span><span class="ident" id="6427387">xmlns</span><span class="op" id="6427392">,</span>&nbsp;<span class="ident" id="6427394">finfo</span><span class="op" id="6427399">.</span><span class="ident" id="6427400">name</span>&nbsp;<span class="op" id="6427405">=</span>&nbsp;<span class="ident" id="6427407">xmlname</span><span class="op" id="6427414">.</span><span class="ident" id="6427415">xmlns</span><span class="op" id="6427420">,</span>&nbsp;<span class="ident" id="6427422">xmlname</span><span class="op" id="6427429">.</span><span class="ident" id="6427430">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6427437">}</span>&nbsp;<span class="keyword" id="6427439">else</span>&nbsp;<span class="op" id="6427444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6427449">finfo</span><span class="op" id="6427454">.</span><span class="ident" id="6427455">name</span>&nbsp;<span class="op" id="6427460">=</span>&nbsp;<span class="ident" id="6427462">f</span><span class="op" id="6427463">.</span><span class="ident" id="6427464">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6427471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427475">return</span>&nbsp;<span class="ident" id="6427482">finfo</span><span class="op" id="6427487">,</span>&nbsp;<span class="ident" id="6427489">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6427494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6427498">//&nbsp;Prepare&nbsp;field&nbsp;name&nbsp;and&nbsp;parents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6427534">parents</span>&nbsp;<span class="op" id="6427542">:=</span>&nbsp;<span class="ident" id="6427545">strings</span><span class="op" id="6427552">.</span><span class="ident" id="6427553">Split</span><span class="op" id="6427558">(</span><span class="ident" id="6427559">tag</span><span class="op" id="6427562">,</span>&nbsp;<span class="string" id="6427564">&#34;&gt;&#34;</span><span class="op" id="6427567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427570">if</span>&nbsp;<span class="ident" id="6427573">parents</span><span class="op" id="6427580">[</span><span class="num" id="6427581">0</span><span class="op" id="6427582">]</span>&nbsp;<span class="op" id="6427584">==</span>&nbsp;<span class="string" id="6427587">&#34;&#34;</span>&nbsp;<span class="op" id="6427590">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6427594">parents</span><span class="op" id="6427601">[</span><span class="num" id="6427602">0</span><span class="op" id="6427603">]</span>&nbsp;<span class="op" id="6427605">=</span>&nbsp;<span class="ident" id="6427607">f</span><span class="op" id="6427608">.</span><span class="ident" id="6427609">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6427615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427618">if</span>&nbsp;<span class="ident" id="6427621">parents</span><span class="op" id="6427628">[</span><span class="builtinfunc" id="6427629">len</span><span class="op" id="6427632">(</span><span class="ident" id="6427633">parents</span><span class="op" id="6427640">)</span><span class="op" id="6427641">-</span><span class="num" id="6427642">1</span><span class="op" id="6427643">]</span>&nbsp;<span class="op" id="6427645">==</span>&nbsp;<span class="string" id="6427648">&#34;&#34;</span>&nbsp;<span class="op" id="6427651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427655">return</span>&nbsp;<span class="ident" id="6427662">nil</span><span class="op" id="6427665">,</span>&nbsp;<span class="ident" id="6427667">fmt</span><span class="op" id="6427670">.</span><span class="ident" id="6427671">Errorf</span><span class="op" id="6427677">(</span><span class="string" id="6427678">&#34;xml:&nbsp;trailing&nbsp;&#39;&gt;&#39;&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="6427720">,</span>&nbsp;<span class="ident" id="6427722">f</span><span class="op" id="6427723">.</span><span class="ident" id="6427724">Name</span><span class="op" id="6427728">,</span>&nbsp;<span class="ident" id="6427730">typ</span><span class="op" id="6427733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6427736">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6427739">finfo</span><span class="op" id="6427744">.</span><span class="ident" id="6427745">name</span>&nbsp;<span class="op" id="6427750">=</span>&nbsp;<span class="ident" id="6427752">parents</span><span class="op" id="6427759">[</span><span class="builtinfunc" id="6427760">len</span><span class="op" id="6427763">(</span><span class="ident" id="6427764">parents</span><span class="op" id="6427771">)</span><span class="op" id="6427772">-</span><span class="num" id="6427773">1</span><span class="op" id="6427774">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427777">if</span>&nbsp;<span class="builtinfunc" id="6427780">len</span><span class="op" id="6427783">(</span><span class="ident" id="6427784">parents</span><span class="op" id="6427791">)</span>&nbsp;<span class="op" id="6427793">&gt;</span>&nbsp;<span class="num" id="6427795">1</span>&nbsp;<span class="op" id="6427797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427801">if</span>&nbsp;<span class="op" id="6427804">(</span><span class="ident" id="6427805">finfo</span><span class="op" id="6427810">.</span><span class="ident" id="6427811">flags</span>&nbsp;<span class="op" id="6427817">&amp;</span>&nbsp;<span class="ident" id="6427819">fElement</span><span class="op" id="6427827">)</span>&nbsp;<span class="op" id="6427829">==</span>&nbsp;<span class="num" id="6427832">0</span>&nbsp;<span class="op" id="6427834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427839">return</span>&nbsp;<span class="ident" id="6427846">nil</span><span class="op" id="6427849">,</span>&nbsp;<span class="ident" id="6427851">fmt</span><span class="op" id="6427854">.</span><span class="ident" id="6427855">Errorf</span><span class="op" id="6427861">(</span><span class="string" id="6427862">&#34;xml:&nbsp;%s&nbsp;chain&nbsp;not&nbsp;valid&nbsp;with&nbsp;%s&nbsp;flag&#34;</span><span class="op" id="6427900">,</span>&nbsp;<span class="ident" id="6427902">tag</span><span class="op" id="6427905">,</span>&nbsp;<span class="ident" id="6427907">strings</span><span class="op" id="6427914">.</span><span class="ident" id="6427915">Join</span><span class="op" id="6427919">(</span><span class="ident" id="6427920">tokens</span><span class="op" id="6427926">[</span><span class="num" id="6427927">1</span><span class="op" id="6427928">:</span><span class="op" id="6427929">]</span><span class="op" id="6427930">,</span>&nbsp;<span class="string" id="6427932">&#34;,&#34;</span><span class="op" id="6427935">)</span><span class="op" id="6427936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6427940">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6427944">finfo</span><span class="op" id="6427949">.</span><span class="ident" id="6427950">parents</span>&nbsp;<span class="op" id="6427958">=</span>&nbsp;<span class="ident" id="6427960">parents</span><span class="op" id="6427967">[</span><span class="op" id="6427968">:</span><span class="builtinfunc" id="6427969">len</span><span class="op" id="6427972">(</span><span class="ident" id="6427973">parents</span><span class="op" id="6427980">)</span><span class="op" id="6427981">-</span><span class="num" id="6427982">1</span><span class="op" id="6427983">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6427986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6427990">//&nbsp;If&nbsp;the&nbsp;field&nbsp;type&nbsp;has&nbsp;an&nbsp;XMLName&nbsp;field,&nbsp;the&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6428055">//&nbsp;so&nbsp;that&nbsp;the&nbsp;behavior&nbsp;of&nbsp;both&nbsp;marshalling&nbsp;and&nbsp;unmarshalling</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6428118">//&nbsp;is&nbsp;straightforward&nbsp;and&nbsp;unambiguous.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428158">if</span>&nbsp;<span class="ident" id="6428161">finfo</span><span class="op" id="6428166">.</span><span class="ident" id="6428167">flags</span><span class="op" id="6428172">&amp;</span><span class="ident" id="6428173">fElement</span>&nbsp;<span class="op" id="6428182">!=</span>&nbsp;<span class="num" id="6428185">0</span>&nbsp;<span class="op" id="6428187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428191">ftyp</span>&nbsp;<span class="op" id="6428196">:=</span>&nbsp;<span class="ident" id="6428199">f</span><span class="op" id="6428200">.</span><span class="ident" id="6428201">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428208">xmlname</span>&nbsp;<span class="op" id="6428216">:=</span>&nbsp;<span class="ident" id="6428219">lookupXMLName</span><span class="op" id="6428232">(</span><span class="ident" id="6428233">ftyp</span><span class="op" id="6428237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428241">if</span>&nbsp;<span class="ident" id="6428244">xmlname</span>&nbsp;<span class="op" id="6428252">!=</span>&nbsp;<span class="ident" id="6428255">nil</span>&nbsp;<span class="op" id="6428259">&amp;&amp;</span>&nbsp;<span class="ident" id="6428262">xmlname</span><span class="op" id="6428269">.</span><span class="ident" id="6428270">name</span>&nbsp;<span class="op" id="6428275">!=</span>&nbsp;<span class="ident" id="6428278">finfo</span><span class="op" id="6428283">.</span><span class="ident" id="6428284">name</span>&nbsp;<span class="op" id="6428289">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428294">return</span>&nbsp;<span class="ident" id="6428301">nil</span><span class="op" id="6428304">,</span>&nbsp;<span class="ident" id="6428306">fmt</span><span class="op" id="6428309">.</span><span class="ident" id="6428310">Errorf</span><span class="op" id="6428316">(</span><span class="string" id="6428317">&#34;xml:&nbsp;name&nbsp;%q&nbsp;in&nbsp;tag&nbsp;of&nbsp;%s.%s&nbsp;conflicts&nbsp;with&nbsp;name&nbsp;%q&nbsp;in&nbsp;%s.XMLName&#34;</span><span class="op" id="6428384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428390">finfo</span><span class="op" id="6428395">.</span><span class="ident" id="6428396">name</span><span class="op" id="6428400">,</span>&nbsp;<span class="ident" id="6428402">typ</span><span class="op" id="6428405">,</span>&nbsp;<span class="ident" id="6428407">f</span><span class="op" id="6428408">.</span><span class="ident" id="6428409">Name</span><span class="op" id="6428413">,</span>&nbsp;<span class="ident" id="6428415">xmlname</span><span class="op" id="6428422">.</span><span class="ident" id="6428423">name</span><span class="op" id="6428427">,</span>&nbsp;<span class="ident" id="6428429">ftyp</span><span class="op" id="6428433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6428437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6428440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428443">return</span>&nbsp;<span class="ident" id="6428450">finfo</span><span class="op" id="6428455">,</span>&nbsp;<span class="ident" id="6428457">nil</span><br>
<span class="lineno">225</span><span class="op" id="6428461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6428464">//&nbsp;lookupXMLName&nbsp;returns&nbsp;the&nbsp;fieldInfo&nbsp;for&nbsp;typ&#39;s&nbsp;XMLName&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="6428527">//&nbsp;in&nbsp;case&nbsp;it&nbsp;exists&nbsp;and&nbsp;has&nbsp;a&nbsp;valid&nbsp;xml&nbsp;field&nbsp;tag,&nbsp;otherwise</span><br>
<span class="lineno"></span><span class="comment" id="6428589">//&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">230</span><span class="keyword" id="6428608">func</span>&nbsp;<span class="ident" id="6428613">lookupXMLName</span><span class="op" id="6428626">(</span><span class="ident" id="6428627">typ</span>&nbsp;<span class="ident" id="6428631">reflect</span><span class="op" id="6428638">.</span><span class="ident" id="6428639">Type</span><span class="op" id="6428643">)</span>&nbsp;<span class="op" id="6428645">(</span><span class="ident" id="6428646">xmlname</span>&nbsp;<span class="op" id="6428654">*</span><span class="ident" id="6428655">fieldInfo</span><span class="op" id="6428664">)</span>&nbsp;<span class="op" id="6428666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428669">for</span>&nbsp;<span class="ident" id="6428673">typ</span><span class="op" id="6428676">.</span><span class="ident" id="6428677">Kind</span><span class="op" id="6428681">(</span><span class="op" id="6428682">)</span>&nbsp;<span class="op" id="6428684">==</span>&nbsp;<span class="ident" id="6428687">reflect</span><span class="op" id="6428694">.</span><span class="ident" id="6428695">Ptr</span>&nbsp;<span class="op" id="6428699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428703">typ</span>&nbsp;<span class="op" id="6428707">=</span>&nbsp;<span class="ident" id="6428709">typ</span><span class="op" id="6428712">.</span><span class="ident" id="6428713">Elem</span><span class="op" id="6428717">(</span><span class="op" id="6428718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6428721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428724">if</span>&nbsp;<span class="ident" id="6428727">typ</span><span class="op" id="6428730">.</span><span class="ident" id="6428731">Kind</span><span class="op" id="6428735">(</span><span class="op" id="6428736">)</span>&nbsp;<span class="op" id="6428738">!=</span>&nbsp;<span class="ident" id="6428741">reflect</span><span class="op" id="6428748">.</span><span class="ident" id="6428749">Struct</span>&nbsp;<span class="op" id="6428756">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428760">return</span>&nbsp;<span class="ident" id="6428767">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6428772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428775">for</span>&nbsp;<span class="ident" id="6428779">i</span><span class="op" id="6428780">,</span>&nbsp;<span class="ident" id="6428782">n</span>&nbsp;<span class="op" id="6428784">:=</span>&nbsp;<span class="num" id="6428787">0</span><span class="op" id="6428788">,</span>&nbsp;<span class="ident" id="6428790">typ</span><span class="op" id="6428793">.</span><span class="ident" id="6428794">NumField</span><span class="op" id="6428802">(</span><span class="op" id="6428803">)</span><span class="op" id="6428804">;</span>&nbsp;<span class="ident" id="6428806">i</span>&nbsp;<span class="op" id="6428808">&lt;</span>&nbsp;<span class="ident" id="6428810">n</span><span class="op" id="6428811">;</span>&nbsp;<span class="ident" id="6428813">i</span><span class="op" id="6428814">++</span>&nbsp;<span class="op" id="6428817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428821">f</span>&nbsp;<span class="op" id="6428823">:=</span>&nbsp;<span class="ident" id="6428826">typ</span><span class="op" id="6428829">.</span><span class="ident" id="6428830">Field</span><span class="op" id="6428835">(</span><span class="ident" id="6428836">i</span><span class="op" id="6428837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428841">if</span>&nbsp;<span class="ident" id="6428844">f</span><span class="op" id="6428845">.</span><span class="ident" id="6428846">Name</span>&nbsp;<span class="op" id="6428851">!=</span>&nbsp;<span class="string" id="6428854">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6428864">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428869">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6428880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428884">finfo</span><span class="op" id="6428889">,</span>&nbsp;<span class="ident" id="6428891">err</span>&nbsp;<span class="op" id="6428895">:=</span>&nbsp;<span class="ident" id="6428898">structFieldInfo</span><span class="op" id="6428913">(</span><span class="ident" id="6428914">typ</span><span class="op" id="6428917">,</span>&nbsp;<span class="op" id="6428919">&amp;</span><span class="ident" id="6428920">f</span><span class="op" id="6428921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428925">if</span>&nbsp;<span class="ident" id="6428928">finfo</span><span class="op" id="6428933">.</span><span class="ident" id="6428934">name</span>&nbsp;<span class="op" id="6428939">!=</span>&nbsp;<span class="string" id="6428942">&#34;&#34;</span>&nbsp;<span class="op" id="6428945">&amp;&amp;</span>&nbsp;<span class="ident" id="6428948">err</span>&nbsp;<span class="op" id="6428952">==</span>&nbsp;<span class="ident" id="6428955">nil</span>&nbsp;<span class="op" id="6428959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428964">return</span>&nbsp;<span class="ident" id="6428971">finfo</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6428979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6428983">//&nbsp;Also&nbsp;consider&nbsp;errors&nbsp;as&nbsp;a&nbsp;non-existent&nbsp;field&nbsp;tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6429037">//&nbsp;and&nbsp;let&nbsp;getTypeInfo&nbsp;itself&nbsp;report&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429087">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6429094">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429097">return</span>&nbsp;<span class="ident" id="6429104">nil</span><br>
<span class="lineno"></span><span class="op" id="6429108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6429111">func</span>&nbsp;<span class="ident" id="6429116">min</span><span class="op" id="6429119">(</span><span class="ident" id="6429120">a</span><span class="op" id="6429121">,</span>&nbsp;<span class="ident" id="6429123">b</span>&nbsp;<span class="builtintype" id="6429125">int</span><span class="op" id="6429128">)</span>&nbsp;<span class="builtintype" id="6429130">int</span>&nbsp;<span class="op" id="6429134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429137">if</span>&nbsp;<span class="ident" id="6429140">a</span>&nbsp;<span class="op" id="6429142">&lt;=</span>&nbsp;<span class="ident" id="6429145">b</span>&nbsp;<span class="op" id="6429147">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429151">return</span>&nbsp;<span class="ident" id="6429158">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6429161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429164">return</span>&nbsp;<span class="ident" id="6429171">b</span><br>
<span class="lineno"></span><span class="op" id="6429173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="6429176">//&nbsp;addFieldInfo&nbsp;adds&nbsp;finfo&nbsp;to&nbsp;tinfo.fields&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="6429235">//&nbsp;conflicts,&nbsp;or&nbsp;if&nbsp;conflicts&nbsp;arise&nbsp;from&nbsp;previous&nbsp;fields&nbsp;that&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="6429302">//&nbsp;obtained&nbsp;from&nbsp;deeper&nbsp;embedded&nbsp;structures&nbsp;than&nbsp;finfo.&nbsp;In&nbsp;the&nbsp;latter</span><br>
<span class="lineno"></span><span class="comment" id="6429372">//&nbsp;case,&nbsp;the&nbsp;conflicting&nbsp;entries&nbsp;are&nbsp;dropped.</span><br>
<span class="lineno"></span><span class="comment" id="6429418">//&nbsp;A&nbsp;conflict&nbsp;occurs&nbsp;when&nbsp;the&nbsp;path&nbsp;(parent&nbsp;+&nbsp;name)&nbsp;to&nbsp;a&nbsp;field&nbsp;is</span><br>
<span class="lineno">265</span><span class="comment" id="6429483">//&nbsp;itself&nbsp;a&nbsp;prefix&nbsp;of&nbsp;another&nbsp;path,&nbsp;or&nbsp;when&nbsp;two&nbsp;paths&nbsp;match&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="comment" id="6429552">//&nbsp;It&nbsp;is&nbsp;okay&nbsp;for&nbsp;field&nbsp;paths&nbsp;to&nbsp;share&nbsp;a&nbsp;common,&nbsp;shorter&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6429617">func</span>&nbsp;<span class="ident" id="6429622">addFieldInfo</span><span class="op" id="6429634">(</span><span class="ident" id="6429635">typ</span>&nbsp;<span class="ident" id="6429639">reflect</span><span class="op" id="6429646">.</span><span class="ident" id="6429647">Type</span><span class="op" id="6429651">,</span>&nbsp;<span class="ident" id="6429653">tinfo</span>&nbsp;<span class="op" id="6429659">*</span><span class="ident" id="6429660">typeInfo</span><span class="op" id="6429668">,</span>&nbsp;<span class="ident" id="6429670">newf</span>&nbsp;<span class="op" id="6429675">*</span><span class="ident" id="6429676">fieldInfo</span><span class="op" id="6429685">)</span>&nbsp;<span class="builtintype" id="6429687">error</span>&nbsp;<span class="op" id="6429693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429696">var</span>&nbsp;<span class="ident" id="6429700">conflicts</span>&nbsp;<span class="op" id="6429710">[</span><span class="op" id="6429711">]</span><span class="builtintype" id="6429712">int</span><br>
<span class="lineno"></span><span class="ident" id="6429716">Loop</span><span class="op" id="6429720">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6429723">//&nbsp;First,&nbsp;figure&nbsp;all&nbsp;conflicts.&nbsp;Most&nbsp;working&nbsp;code&nbsp;will&nbsp;have&nbsp;none.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429790">for</span>&nbsp;<span class="ident" id="6429794">i</span>&nbsp;<span class="op" id="6429796">:=</span>&nbsp;<span class="keyword" id="6429799">range</span>&nbsp;<span class="ident" id="6429805">tinfo</span><span class="op" id="6429810">.</span><span class="ident" id="6429811">fields</span>&nbsp;<span class="op" id="6429818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6429822">oldf</span>&nbsp;<span class="op" id="6429827">:=</span>&nbsp;<span class="op" id="6429830">&amp;</span><span class="ident" id="6429831">tinfo</span><span class="op" id="6429836">.</span><span class="ident" id="6429837">fields</span><span class="op" id="6429843">[</span><span class="ident" id="6429844">i</span><span class="op" id="6429845">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429849">if</span>&nbsp;<span class="ident" id="6429852">oldf</span><span class="op" id="6429856">.</span><span class="ident" id="6429857">flags</span><span class="op" id="6429862">&amp;</span><span class="ident" id="6429863">fMode</span>&nbsp;<span class="op" id="6429869">!=</span>&nbsp;<span class="ident" id="6429872">newf</span><span class="op" id="6429876">.</span><span class="ident" id="6429877">flags</span><span class="op" id="6429882">&amp;</span><span class="ident" id="6429883">fMode</span>&nbsp;<span class="op" id="6429889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429894">continue</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6429905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429909">if</span>&nbsp;<span class="ident" id="6429912">oldf</span><span class="op" id="6429916">.</span><span class="ident" id="6429917">xmlns</span>&nbsp;<span class="op" id="6429923">!=</span>&nbsp;<span class="string" id="6429926">&#34;&#34;</span>&nbsp;<span class="op" id="6429929">&amp;&amp;</span>&nbsp;<span class="ident" id="6429932">newf</span><span class="op" id="6429936">.</span><span class="ident" id="6429937">xmlns</span>&nbsp;<span class="op" id="6429943">!=</span>&nbsp;<span class="string" id="6429946">&#34;&#34;</span>&nbsp;<span class="op" id="6429949">&amp;&amp;</span>&nbsp;<span class="ident" id="6429952">oldf</span><span class="op" id="6429956">.</span><span class="ident" id="6429957">xmlns</span>&nbsp;<span class="op" id="6429963">!=</span>&nbsp;<span class="ident" id="6429966">newf</span><span class="op" id="6429970">.</span><span class="ident" id="6429971">xmlns</span>&nbsp;<span class="op" id="6429977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429982">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6429993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6429997">minl</span>&nbsp;<span class="op" id="6430002">:=</span>&nbsp;<span class="ident" id="6430005">min</span><span class="op" id="6430008">(</span><span class="builtinfunc" id="6430009">len</span><span class="op" id="6430012">(</span><span class="ident" id="6430013">newf</span><span class="op" id="6430017">.</span><span class="ident" id="6430018">parents</span><span class="op" id="6430025">)</span><span class="op" id="6430026">,</span>&nbsp;<span class="builtinfunc" id="6430028">len</span><span class="op" id="6430031">(</span><span class="ident" id="6430032">oldf</span><span class="op" id="6430036">.</span><span class="ident" id="6430037">parents</span><span class="op" id="6430044">)</span><span class="op" id="6430045">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430049">for</span>&nbsp;<span class="ident" id="6430053">p</span>&nbsp;<span class="op" id="6430055">:=</span>&nbsp;<span class="num" id="6430058">0</span><span class="op" id="6430059">;</span>&nbsp;<span class="ident" id="6430061">p</span>&nbsp;<span class="op" id="6430063">&lt;</span>&nbsp;<span class="ident" id="6430065">minl</span><span class="op" id="6430069">;</span>&nbsp;<span class="ident" id="6430071">p</span><span class="op" id="6430072">++</span>&nbsp;<span class="op" id="6430075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430080">if</span>&nbsp;<span class="ident" id="6430083">oldf</span><span class="op" id="6430087">.</span><span class="ident" id="6430088">parents</span><span class="op" id="6430095">[</span><span class="ident" id="6430096">p</span><span class="op" id="6430097">]</span>&nbsp;<span class="op" id="6430099">!=</span>&nbsp;<span class="ident" id="6430102">newf</span><span class="op" id="6430106">.</span><span class="ident" id="6430107">parents</span><span class="op" id="6430114">[</span><span class="ident" id="6430115">p</span><span class="op" id="6430116">]</span>&nbsp;<span class="op" id="6430118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430124">continue</span>&nbsp;<span class="ident" id="6430133">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430145">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430149">if</span>&nbsp;<span class="builtinfunc" id="6430152">len</span><span class="op" id="6430155">(</span><span class="ident" id="6430156">oldf</span><span class="op" id="6430160">.</span><span class="ident" id="6430161">parents</span><span class="op" id="6430168">)</span>&nbsp;<span class="op" id="6430170">&gt;</span>&nbsp;<span class="builtinfunc" id="6430172">len</span><span class="op" id="6430175">(</span><span class="ident" id="6430176">newf</span><span class="op" id="6430180">.</span><span class="ident" id="6430181">parents</span><span class="op" id="6430188">)</span>&nbsp;<span class="op" id="6430190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430195">if</span>&nbsp;<span class="ident" id="6430198">oldf</span><span class="op" id="6430202">.</span><span class="ident" id="6430203">parents</span><span class="op" id="6430210">[</span><span class="builtinfunc" id="6430211">len</span><span class="op" id="6430214">(</span><span class="ident" id="6430215">newf</span><span class="op" id="6430219">.</span><span class="ident" id="6430220">parents</span><span class="op" id="6430227">)</span><span class="op" id="6430228">]</span>&nbsp;<span class="op" id="6430230">==</span>&nbsp;<span class="ident" id="6430233">newf</span><span class="op" id="6430237">.</span><span class="ident" id="6430238">name</span>&nbsp;<span class="op" id="6430243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430249">conflicts</span>&nbsp;<span class="op" id="6430259">=</span>&nbsp;<span class="builtinfunc" id="6430261">append</span><span class="op" id="6430267">(</span><span class="ident" id="6430268">conflicts</span><span class="op" id="6430277">,</span>&nbsp;<span class="ident" id="6430279">i</span><span class="op" id="6430280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430289">}</span>&nbsp;<span class="keyword" id="6430291">else</span>&nbsp;<span class="keyword" id="6430296">if</span>&nbsp;<span class="builtinfunc" id="6430299">len</span><span class="op" id="6430302">(</span><span class="ident" id="6430303">oldf</span><span class="op" id="6430307">.</span><span class="ident" id="6430308">parents</span><span class="op" id="6430315">)</span>&nbsp;<span class="op" id="6430317">&lt;</span>&nbsp;<span class="builtinfunc" id="6430319">len</span><span class="op" id="6430322">(</span><span class="ident" id="6430323">newf</span><span class="op" id="6430327">.</span><span class="ident" id="6430328">parents</span><span class="op" id="6430335">)</span>&nbsp;<span class="op" id="6430337">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430342">if</span>&nbsp;<span class="ident" id="6430345">newf</span><span class="op" id="6430349">.</span><span class="ident" id="6430350">parents</span><span class="op" id="6430357">[</span><span class="builtinfunc" id="6430358">len</span><span class="op" id="6430361">(</span><span class="ident" id="6430362">oldf</span><span class="op" id="6430366">.</span><span class="ident" id="6430367">parents</span><span class="op" id="6430374">)</span><span class="op" id="6430375">]</span>&nbsp;<span class="op" id="6430377">==</span>&nbsp;<span class="ident" id="6430380">oldf</span><span class="op" id="6430384">.</span><span class="ident" id="6430385">name</span>&nbsp;<span class="op" id="6430390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430396">conflicts</span>&nbsp;<span class="op" id="6430406">=</span>&nbsp;<span class="builtinfunc" id="6430408">append</span><span class="op" id="6430414">(</span><span class="ident" id="6430415">conflicts</span><span class="op" id="6430424">,</span>&nbsp;<span class="ident" id="6430426">i</span><span class="op" id="6430427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430436">}</span>&nbsp;<span class="keyword" id="6430438">else</span>&nbsp;<span class="op" id="6430443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430448">if</span>&nbsp;<span class="ident" id="6430451">newf</span><span class="op" id="6430455">.</span><span class="ident" id="6430456">name</span>&nbsp;<span class="op" id="6430461">==</span>&nbsp;<span class="ident" id="6430464">oldf</span><span class="op" id="6430468">.</span><span class="ident" id="6430469">name</span>&nbsp;<span class="op" id="6430474">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430480">conflicts</span>&nbsp;<span class="op" id="6430490">=</span>&nbsp;<span class="builtinfunc" id="6430492">append</span><span class="op" id="6430498">(</span><span class="ident" id="6430499">conflicts</span><span class="op" id="6430508">,</span>&nbsp;<span class="ident" id="6430510">i</span><span class="op" id="6430511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6430526">//&nbsp;Without&nbsp;conflicts,&nbsp;add&nbsp;the&nbsp;new&nbsp;field&nbsp;and&nbsp;return.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430579">if</span>&nbsp;<span class="ident" id="6430582">conflicts</span>&nbsp;<span class="op" id="6430592">==</span>&nbsp;<span class="ident" id="6430595">nil</span>&nbsp;<span class="op" id="6430599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430603">tinfo</span><span class="op" id="6430608">.</span><span class="ident" id="6430609">fields</span>&nbsp;<span class="op" id="6430616">=</span>&nbsp;<span class="builtinfunc" id="6430618">append</span><span class="op" id="6430624">(</span><span class="ident" id="6430625">tinfo</span><span class="op" id="6430630">.</span><span class="ident" id="6430631">fields</span><span class="op" id="6430637">,</span>&nbsp;<span class="op" id="6430639">*</span><span class="ident" id="6430640">newf</span><span class="op" id="6430644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430648">return</span>&nbsp;<span class="ident" id="6430655">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6430664">//&nbsp;If&nbsp;any&nbsp;conflict&nbsp;is&nbsp;shallower,&nbsp;ignore&nbsp;the&nbsp;new&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6430720">//&nbsp;This&nbsp;matches&nbsp;the&nbsp;Go&nbsp;field&nbsp;resolution&nbsp;on&nbsp;embedding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430775">for</span>&nbsp;<span class="ident" id="6430779">_</span><span class="op" id="6430780">,</span>&nbsp;<span class="ident" id="6430782">i</span>&nbsp;<span class="op" id="6430784">:=</span>&nbsp;<span class="keyword" id="6430787">range</span>&nbsp;<span class="ident" id="6430793">conflicts</span>&nbsp;<span class="op" id="6430803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430807">if</span>&nbsp;<span class="builtinfunc" id="6430810">len</span><span class="op" id="6430813">(</span><span class="ident" id="6430814">tinfo</span><span class="op" id="6430819">.</span><span class="ident" id="6430820">fields</span><span class="op" id="6430826">[</span><span class="ident" id="6430827">i</span><span class="op" id="6430828">]</span><span class="op" id="6430829">.</span><span class="ident" id="6430830">idx</span><span class="op" id="6430833">)</span>&nbsp;<span class="op" id="6430835">&lt;</span>&nbsp;<span class="builtinfunc" id="6430837">len</span><span class="op" id="6430840">(</span><span class="ident" id="6430841">newf</span><span class="op" id="6430845">.</span><span class="ident" id="6430846">idx</span><span class="op" id="6430849">)</span>&nbsp;<span class="op" id="6430851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430856">return</span>&nbsp;<span class="ident" id="6430863">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6430876">//&nbsp;Otherwise,&nbsp;if&nbsp;any&nbsp;of&nbsp;them&nbsp;is&nbsp;at&nbsp;the&nbsp;same&nbsp;depth&nbsp;level,&nbsp;it&#39;s&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430949">for</span>&nbsp;<span class="ident" id="6430953">_</span><span class="op" id="6430954">,</span>&nbsp;<span class="ident" id="6430956">i</span>&nbsp;<span class="op" id="6430958">:=</span>&nbsp;<span class="keyword" id="6430961">range</span>&nbsp;<span class="ident" id="6430967">conflicts</span>&nbsp;<span class="op" id="6430977">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430981">oldf</span>&nbsp;<span class="op" id="6430986">:=</span>&nbsp;<span class="op" id="6430989">&amp;</span><span class="ident" id="6430990">tinfo</span><span class="op" id="6430995">.</span><span class="ident" id="6430996">fields</span><span class="op" id="6431002">[</span><span class="ident" id="6431003">i</span><span class="op" id="6431004">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431008">if</span>&nbsp;<span class="builtinfunc" id="6431011">len</span><span class="op" id="6431014">(</span><span class="ident" id="6431015">oldf</span><span class="op" id="6431019">.</span><span class="ident" id="6431020">idx</span><span class="op" id="6431023">)</span>&nbsp;<span class="op" id="6431025">==</span>&nbsp;<span class="builtinfunc" id="6431028">len</span><span class="op" id="6431031">(</span><span class="ident" id="6431032">newf</span><span class="op" id="6431036">.</span><span class="ident" id="6431037">idx</span><span class="op" id="6431040">)</span>&nbsp;<span class="op" id="6431042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431047">f1</span>&nbsp;<span class="op" id="6431050">:=</span>&nbsp;<span class="ident" id="6431053">typ</span><span class="op" id="6431056">.</span><span class="ident" id="6431057">FieldByIndex</span><span class="op" id="6431069">(</span><span class="ident" id="6431070">oldf</span><span class="op" id="6431074">.</span><span class="ident" id="6431075">idx</span><span class="op" id="6431078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431083">f2</span>&nbsp;<span class="op" id="6431086">:=</span>&nbsp;<span class="ident" id="6431089">typ</span><span class="op" id="6431092">.</span><span class="ident" id="6431093">FieldByIndex</span><span class="op" id="6431105">(</span><span class="ident" id="6431106">newf</span><span class="op" id="6431110">.</span><span class="ident" id="6431111">idx</span><span class="op" id="6431114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431119">return</span>&nbsp;<span class="op" id="6431126">&amp;</span><span class="ident" id="6431127">TagPathError</span><span class="op" id="6431139">{</span><span class="ident" id="6431140">typ</span><span class="op" id="6431143">,</span>&nbsp;<span class="ident" id="6431145">f1</span><span class="op" id="6431147">.</span><span class="ident" id="6431148">Name</span><span class="op" id="6431152">,</span>&nbsp;<span class="ident" id="6431154">f1</span><span class="op" id="6431156">.</span><span class="ident" id="6431157">Tag</span><span class="op" id="6431160">.</span><span class="ident" id="6431161">Get</span><span class="op" id="6431164">(</span><span class="string" id="6431165">&#34;xml&#34;</span><span class="op" id="6431170">)</span><span class="op" id="6431171">,</span>&nbsp;<span class="ident" id="6431173">f2</span><span class="op" id="6431175">.</span><span class="ident" id="6431176">Name</span><span class="op" id="6431180">,</span>&nbsp;<span class="ident" id="6431182">f2</span><span class="op" id="6431184">.</span><span class="ident" id="6431185">Tag</span><span class="op" id="6431188">.</span><span class="ident" id="6431189">Get</span><span class="op" id="6431192">(</span><span class="string" id="6431193">&#34;xml&#34;</span><span class="op" id="6431198">)</span><span class="op" id="6431199">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6431210">//&nbsp;Otherwise,&nbsp;the&nbsp;new&nbsp;field&nbsp;is&nbsp;shallower,&nbsp;and&nbsp;thus&nbsp;takes&nbsp;precedence,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6431280">//&nbsp;so&nbsp;drop&nbsp;the&nbsp;conflicting&nbsp;fields&nbsp;from&nbsp;tinfo&nbsp;and&nbsp;append&nbsp;the&nbsp;new&nbsp;one.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431350">for</span>&nbsp;<span class="ident" id="6431354">c</span>&nbsp;<span class="op" id="6431356">:=</span>&nbsp;<span class="builtinfunc" id="6431359">len</span><span class="op" id="6431362">(</span><span class="ident" id="6431363">conflicts</span><span class="op" id="6431372">)</span>&nbsp;<span class="op" id="6431374">-</span>&nbsp;<span class="num" id="6431376">1</span><span class="op" id="6431377">;</span>&nbsp;<span class="ident" id="6431379">c</span>&nbsp;<span class="op" id="6431381">&gt;=</span>&nbsp;<span class="num" id="6431384">0</span><span class="op" id="6431385">;</span>&nbsp;<span class="ident" id="6431387">c</span><span class="op" id="6431388">--</span>&nbsp;<span class="op" id="6431391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431395">i</span>&nbsp;<span class="op" id="6431397">:=</span>&nbsp;<span class="ident" id="6431400">conflicts</span><span class="op" id="6431409">[</span><span class="ident" id="6431410">c</span><span class="op" id="6431411">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6431415">copy</span><span class="op" id="6431419">(</span><span class="ident" id="6431420">tinfo</span><span class="op" id="6431425">.</span><span class="ident" id="6431426">fields</span><span class="op" id="6431432">[</span><span class="ident" id="6431433">i</span><span class="op" id="6431434">:</span><span class="op" id="6431435">]</span><span class="op" id="6431436">,</span>&nbsp;<span class="ident" id="6431438">tinfo</span><span class="op" id="6431443">.</span><span class="ident" id="6431444">fields</span><span class="op" id="6431450">[</span><span class="ident" id="6431451">i</span><span class="op" id="6431452">+</span><span class="num" id="6431453">1</span><span class="op" id="6431454">:</span><span class="op" id="6431455">]</span><span class="op" id="6431456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431460">tinfo</span><span class="op" id="6431465">.</span><span class="ident" id="6431466">fields</span>&nbsp;<span class="op" id="6431473">=</span>&nbsp;<span class="ident" id="6431475">tinfo</span><span class="op" id="6431480">.</span><span class="ident" id="6431481">fields</span><span class="op" id="6431487">[</span><span class="op" id="6431488">:</span><span class="builtinfunc" id="6431489">len</span><span class="op" id="6431492">(</span><span class="ident" id="6431493">tinfo</span><span class="op" id="6431498">.</span><span class="ident" id="6431499">fields</span><span class="op" id="6431505">)</span><span class="op" id="6431506">-</span><span class="num" id="6431507">1</span><span class="op" id="6431508">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431511">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431514">tinfo</span><span class="op" id="6431519">.</span><span class="ident" id="6431520">fields</span>&nbsp;<span class="op" id="6431527">=</span>&nbsp;<span class="builtinfunc" id="6431529">append</span><span class="op" id="6431535">(</span><span class="ident" id="6431536">tinfo</span><span class="op" id="6431541">.</span><span class="ident" id="6431542">fields</span><span class="op" id="6431548">,</span>&nbsp;<span class="op" id="6431550">*</span><span class="ident" id="6431551">newf</span><span class="op" id="6431555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431558">return</span>&nbsp;<span class="ident" id="6431565">nil</span><br>
<span class="lineno"></span><span class="op" id="6431569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6431572">//&nbsp;A&nbsp;TagPathError&nbsp;represents&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;unmarshalling&nbsp;process</span><br>
<span class="lineno">335</span><span class="comment" id="6431639">//&nbsp;caused&nbsp;by&nbsp;the&nbsp;use&nbsp;of&nbsp;field&nbsp;tags&nbsp;with&nbsp;conflicting&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="6431698">type</span>&nbsp;<span class="ident" id="6431703">TagPathError</span>&nbsp;<span class="keyword" id="6431716">struct</span>&nbsp;<span class="op" id="6431723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431726">Struct</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431739">reflect</span><span class="op" id="6431746">.</span><span class="ident" id="6431747">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431753">Field1</span><span class="op" id="6431759">,</span>&nbsp;<span class="ident" id="6431761">Tag1</span>&nbsp;<span class="builtintype" id="6431766">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431774">Field2</span><span class="op" id="6431780">,</span>&nbsp;<span class="ident" id="6431782">Tag2</span>&nbsp;<span class="builtintype" id="6431787">string</span><br>
<span class="lineno">340</span><span class="op" id="6431794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6431797">func</span>&nbsp;<span class="op" id="6431802">(</span><span class="ident" id="6431803">e</span>&nbsp;<span class="op" id="6431805">*</span><span class="ident" id="6431806">TagPathError</span><span class="op" id="6431818">)</span>&nbsp;<span class="ident" id="6431820">Error</span><span class="op" id="6431825">(</span><span class="op" id="6431826">)</span>&nbsp;<span class="builtintype" id="6431828">string</span>&nbsp;<span class="op" id="6431835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431838">return</span>&nbsp;<span class="ident" id="6431845">fmt</span><span class="op" id="6431848">.</span><span class="ident" id="6431849">Sprintf</span><span class="op" id="6431856">(</span><span class="string" id="6431857">&#34;%s&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&nbsp;conflicts&nbsp;with&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&#34;</span><span class="op" id="6431918">,</span>&nbsp;<span class="ident" id="6431920">e</span><span class="op" id="6431921">.</span><span class="ident" id="6431922">Struct</span><span class="op" id="6431928">,</span>&nbsp;<span class="ident" id="6431930">e</span><span class="op" id="6431931">.</span><span class="ident" id="6431932">Field1</span><span class="op" id="6431938">,</span>&nbsp;<span class="ident" id="6431940">e</span><span class="op" id="6431941">.</span><span class="ident" id="6431942">Tag1</span><span class="op" id="6431946">,</span>&nbsp;<span class="ident" id="6431948">e</span><span class="op" id="6431949">.</span><span class="ident" id="6431950">Field2</span><span class="op" id="6431956">,</span>&nbsp;<span class="ident" id="6431958">e</span><span class="op" id="6431959">.</span><span class="ident" id="6431960">Tag2</span><span class="op" id="6431964">)</span><br>
<span class="lineno"></span><span class="op" id="6431966">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="comment" id="6431969">//&nbsp;value&nbsp;returns&nbsp;v&#39;s&nbsp;field&nbsp;value&nbsp;corresponding&nbsp;to&nbsp;finfo.</span><br>
<span class="lineno"></span><span class="comment" id="6432026">//&nbsp;It&#39;s&nbsp;equivalent&nbsp;to&nbsp;v.FieldByIndex(finfo.idx),&nbsp;but&nbsp;initializes</span><br>
<span class="lineno"></span><span class="comment" id="6432091">//&nbsp;and&nbsp;dereferences&nbsp;pointers&nbsp;as&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="6432134">func</span>&nbsp;<span class="op" id="6432139">(</span><span class="ident" id="6432140">finfo</span>&nbsp;<span class="op" id="6432146">*</span><span class="ident" id="6432147">fieldInfo</span><span class="op" id="6432156">)</span>&nbsp;<span class="ident" id="6432158">value</span><span class="op" id="6432163">(</span><span class="ident" id="6432164">v</span>&nbsp;<span class="ident" id="6432166">reflect</span><span class="op" id="6432173">.</span><span class="ident" id="6432174">Value</span><span class="op" id="6432179">)</span>&nbsp;<span class="ident" id="6432181">reflect</span><span class="op" id="6432188">.</span><span class="ident" id="6432189">Value</span>&nbsp;<span class="op" id="6432195">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432198">for</span>&nbsp;<span class="ident" id="6432202">i</span><span class="op" id="6432203">,</span>&nbsp;<span class="ident" id="6432205">x</span>&nbsp;<span class="op" id="6432207">:=</span>&nbsp;<span class="keyword" id="6432210">range</span>&nbsp;<span class="ident" id="6432216">finfo</span><span class="op" id="6432221">.</span><span class="ident" id="6432222">idx</span>&nbsp;<span class="op" id="6432226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432230">if</span>&nbsp;<span class="ident" id="6432233">i</span>&nbsp;<span class="op" id="6432235">&gt;</span>&nbsp;<span class="num" id="6432237">0</span>&nbsp;<span class="op" id="6432239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6432244">t</span>&nbsp;<span class="op" id="6432246">:=</span>&nbsp;<span class="ident" id="6432249">v</span><span class="op" id="6432250">.</span><span class="ident" id="6432251">Type</span><span class="op" id="6432255">(</span><span class="op" id="6432256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432261">if</span>&nbsp;<span class="ident" id="6432264">t</span><span class="op" id="6432265">.</span><span class="ident" id="6432266">Kind</span><span class="op" id="6432270">(</span><span class="op" id="6432271">)</span>&nbsp;<span class="op" id="6432273">==</span>&nbsp;<span class="ident" id="6432276">reflect</span><span class="op" id="6432283">.</span><span class="ident" id="6432284">Ptr</span>&nbsp;<span class="op" id="6432288">&amp;&amp;</span>&nbsp;<span class="ident" id="6432291">t</span><span class="op" id="6432292">.</span><span class="ident" id="6432293">Elem</span><span class="op" id="6432297">(</span><span class="op" id="6432298">)</span><span class="op" id="6432299">.</span><span class="ident" id="6432300">Kind</span><span class="op" id="6432304">(</span><span class="op" id="6432305">)</span>&nbsp;<span class="op" id="6432307">==</span>&nbsp;<span class="ident" id="6432310">reflect</span><span class="op" id="6432317">.</span><span class="ident" id="6432318">Struct</span>&nbsp;<span class="op" id="6432325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432331">if</span>&nbsp;<span class="ident" id="6432334">v</span><span class="op" id="6432335">.</span><span class="ident" id="6432336">IsNil</span><span class="op" id="6432341">(</span><span class="op" id="6432342">)</span>&nbsp;<span class="op" id="6432344">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6432351">v</span><span class="op" id="6432352">.</span><span class="ident" id="6432353">Set</span><span class="op" id="6432356">(</span><span class="ident" id="6432357">reflect</span><span class="op" id="6432364">.</span><span class="ident" id="6432365">New</span><span class="op" id="6432368">(</span><span class="ident" id="6432369">v</span><span class="op" id="6432370">.</span><span class="ident" id="6432371">Type</span><span class="op" id="6432375">(</span><span class="op" id="6432376">)</span><span class="op" id="6432377">.</span><span class="ident" id="6432378">Elem</span><span class="op" id="6432382">(</span><span class="op" id="6432383">)</span><span class="op" id="6432384">)</span><span class="op" id="6432385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6432391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6432397">v</span>&nbsp;<span class="op" id="6432399">=</span>&nbsp;<span class="ident" id="6432401">v</span><span class="op" id="6432402">.</span><span class="ident" id="6432403">Elem</span><span class="op" id="6432407">(</span><span class="op" id="6432408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6432413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6432417">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6432421">v</span>&nbsp;<span class="op" id="6432423">=</span>&nbsp;<span class="ident" id="6432425">v</span><span class="op" id="6432426">.</span><span class="ident" id="6432427">Field</span><span class="op" id="6432432">(</span><span class="ident" id="6432433">x</span><span class="op" id="6432434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6432437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432440">return</span>&nbsp;<span class="ident" id="6432447">v</span><br>
<span class="lineno"></span><span class="op" id="6432449">}</span>
</div>
</body>
</html>
