<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html" class="current">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7366707">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7366762">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7366816">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7366867">package</span>&nbsp;<span class="ident" id="7366875">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7366881">import</span>&nbsp;<span class="op" id="7366888">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7366891">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7366900">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7366909">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7366922">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7366933">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7366940">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="7366943">//&nbsp;TestEmpty&nbsp;tests&nbsp;that&nbsp;an&nbsp;empty&nbsp;payload&nbsp;still&nbsp;forms&nbsp;a&nbsp;valid&nbsp;GZIP&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="7367017">func</span>&nbsp;<span class="ident" id="7367022">TestEmpty</span><span class="op" id="7367031">(</span><span class="ident" id="7367032">t</span>&nbsp;<span class="op" id="7367034">*</span><span class="ident" id="7367035">testing</span><span class="op" id="7367042">.</span><span class="ident" id="7367043">T</span><span class="op" id="7367044">)</span>&nbsp;<span class="op" id="7367046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367049">buf</span>&nbsp;<span class="op" id="7367053">:=</span>&nbsp;<span class="builtinfunc" id="7367056">new</span><span class="op" id="7367059">(</span><span class="ident" id="7367060">bytes</span><span class="op" id="7367065">.</span><span class="ident" id="7367066">Buffer</span><span class="op" id="7367072">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7367076">if</span>&nbsp;<span class="ident" id="7367079">err</span>&nbsp;<span class="op" id="7367083">:=</span>&nbsp;<span class="ident" id="7367086">NewWriter</span><span class="op" id="7367095">(</span><span class="ident" id="7367096">buf</span><span class="op" id="7367099">)</span><span class="op" id="7367100">.</span><span class="ident" id="7367101">Close</span><span class="op" id="7367106">(</span><span class="op" id="7367107">)</span><span class="op" id="7367108">;</span>&nbsp;<span class="ident" id="7367110">err</span>&nbsp;<span class="op" id="7367114">!=</span>&nbsp;<span class="builtintype" id="7367117">nil</span>&nbsp;<span class="op" id="7367121">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367125">t</span><span class="op" id="7367126">.</span><span class="ident" id="7367127">Fatalf</span><span class="op" id="7367133">(</span><span class="string" id="7367134">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7367152">,</span>&nbsp;<span class="ident" id="7367154">err</span><span class="op" id="7367157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7367160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367164">r</span><span class="op" id="7367165">,</span>&nbsp;<span class="ident" id="7367167">err</span>&nbsp;<span class="op" id="7367171">:=</span>&nbsp;<span class="ident" id="7367174">NewReader</span><span class="op" id="7367183">(</span><span class="ident" id="7367184">buf</span><span class="op" id="7367187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7367190">if</span>&nbsp;<span class="ident" id="7367193">err</span>&nbsp;<span class="op" id="7367197">!=</span>&nbsp;<span class="builtintype" id="7367200">nil</span>&nbsp;<span class="op" id="7367204">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367208">t</span><span class="op" id="7367209">.</span><span class="ident" id="7367210">Fatalf</span><span class="op" id="7367216">(</span><span class="string" id="7367217">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7367232">,</span>&nbsp;<span class="ident" id="7367234">err</span><span class="op" id="7367237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7367240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367243">b</span><span class="op" id="7367244">,</span>&nbsp;<span class="ident" id="7367246">err</span>&nbsp;<span class="op" id="7367250">:=</span>&nbsp;<span class="ident" id="7367253">ioutil</span><span class="op" id="7367259">.</span><span class="ident" id="7367260">ReadAll</span><span class="op" id="7367267">(</span><span class="ident" id="7367268">r</span><span class="op" id="7367269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7367272">if</span>&nbsp;<span class="ident" id="7367275">err</span>&nbsp;<span class="op" id="7367279">!=</span>&nbsp;<span class="builtintype" id="7367282">nil</span>&nbsp;<span class="op" id="7367286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367290">t</span><span class="op" id="7367291">.</span><span class="ident" id="7367292">Fatalf</span><span class="op" id="7367298">(</span><span class="string" id="7367299">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="7367312">,</span>&nbsp;<span class="ident" id="7367314">err</span><span class="op" id="7367317">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7367320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7367323">if</span>&nbsp;<span class="builtinfunc" id="7367326">len</span><span class="op" id="7367329">(</span><span class="ident" id="7367330">b</span><span class="op" id="7367331">)</span>&nbsp;<span class="op" id="7367333">!=</span>&nbsp;<span class="num" id="7367336">0</span>&nbsp;<span class="op" id="7367338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367342">t</span><span class="op" id="7367343">.</span><span class="ident" id="7367344">Fatalf</span><span class="op" id="7367350">(</span><span class="string" id="7367351">&#34;got&nbsp;%d&nbsp;bytes,&nbsp;want&nbsp;0&#34;</span><span class="op" id="7367373">,</span>&nbsp;<span class="builtinfunc" id="7367375">len</span><span class="op" id="7367378">(</span><span class="ident" id="7367379">b</span><span class="op" id="7367380">)</span><span class="op" id="7367381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7367384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7367387">if</span>&nbsp;<span class="ident" id="7367390">err</span>&nbsp;<span class="op" id="7367394">:=</span>&nbsp;<span class="ident" id="7367397">r</span><span class="op" id="7367398">.</span><span class="ident" id="7367399">Close</span><span class="op" id="7367404">(</span><span class="op" id="7367405">)</span><span class="op" id="7367406">;</span>&nbsp;<span class="ident" id="7367408">err</span>&nbsp;<span class="op" id="7367412">!=</span>&nbsp;<span class="builtintype" id="7367415">nil</span>&nbsp;<span class="op" id="7367419">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367423">t</span><span class="op" id="7367424">.</span><span class="ident" id="7367425">Fatalf</span><span class="op" id="7367431">(</span><span class="string" id="7367432">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="7367450">,</span>&nbsp;<span class="ident" id="7367452">err</span><span class="op" id="7367455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7367458">}</span><br>
<span class="lineno"></span><span class="op" id="7367460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7367463">//&nbsp;TestRoundTrip&nbsp;tests&nbsp;that&nbsp;gzipping&nbsp;and&nbsp;then&nbsp;gunzipping&nbsp;is&nbsp;the&nbsp;identity</span><br>
<span class="lineno">40</span><span class="comment" id="7367536">//&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="7367549">func</span>&nbsp;<span class="ident" id="7367554">TestRoundTrip</span><span class="op" id="7367567">(</span><span class="ident" id="7367568">t</span>&nbsp;<span class="op" id="7367570">*</span><span class="ident" id="7367571">testing</span><span class="op" id="7367578">.</span><span class="ident" id="7367579">T</span><span class="op" id="7367580">)</span>&nbsp;<span class="op" id="7367582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367585">buf</span>&nbsp;<span class="op" id="7367589">:=</span>&nbsp;<span class="builtinfunc" id="7367592">new</span><span class="op" id="7367595">(</span><span class="ident" id="7367596">bytes</span><span class="op" id="7367601">.</span><span class="ident" id="7367602">Buffer</span><span class="op" id="7367608">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367612">w</span>&nbsp;<span class="op" id="7367614">:=</span>&nbsp;<span class="ident" id="7367617">NewWriter</span><span class="op" id="7367626">(</span><span class="ident" id="7367627">buf</span><span class="op" id="7367630">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367633">w</span><span class="op" id="7367634">.</span><span class="ident" id="7367635">Comment</span>&nbsp;<span class="op" id="7367643">=</span>&nbsp;<span class="string" id="7367645">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367656">w</span><span class="op" id="7367657">.</span><span class="ident" id="7367658">Extra</span>&nbsp;<span class="op" id="7367664">=</span>&nbsp;<span class="op" id="7367666">[</span><span class="op" id="7367667">]</span><span class="builtintype" id="7367668">byte</span><span class="op" id="7367672">(</span><span class="string" id="7367673">&#34;extra&#34;</span><span class="op" id="7367680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367683">w</span><span class="op" id="7367684">.</span><span class="ident" id="7367685">ModTime</span>&nbsp;<span class="op" id="7367693">=</span>&nbsp;<span class="ident" id="7367695">time</span><span class="op" id="7367699">.</span><span class="ident" id="7367700">Unix</span><span class="op" id="7367704">(</span><span class="num" id="7367705">1e8</span><span class="op" id="7367708">,</span>&nbsp;<span class="num" id="7367710">0</span><span class="op" id="7367711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367714">w</span><span class="op" id="7367715">.</span><span class="ident" id="7367716">Name</span>&nbsp;<span class="op" id="7367721">=</span>&nbsp;<span class="string" id="7367723">&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7367731">if</span>&nbsp;<span class="ident" id="7367734">_</span><span class="op" id="7367735">,</span>&nbsp;<span class="ident" id="7367737">err</span>&nbsp;<span class="op" id="7367741">:=</span>&nbsp;<span class="ident" id="7367744">w</span><span class="op" id="7367745">.</span><span class="ident" id="7367746">Write</span><span class="op" id="7367751">(</span><span class="op" id="7367752">[</span><span class="op" id="7367753">]</span><span class="builtintype" id="7367754">byte</span><span class="op" id="7367758">(</span><span class="string" id="7367759">&#34;payload&#34;</span><span class="op" id="7367768">)</span><span class="op" id="7367769">)</span><span class="op" id="7367770">;</span>&nbsp;<span class="ident" id="7367772">err</span>&nbsp;<span class="op" id="7367776">!=</span>&nbsp;<span class="builtintype" id="7367779">nil</span>&nbsp;<span class="op" id="7367783">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367787">t</span><span class="op" id="7367788">.</span><span class="ident" id="7367789">Fatalf</span><span class="op" id="7367795">(</span><span class="string" id="7367796">&#34;Write:&nbsp;%v&#34;</span><span class="op" id="7367807">,</span>&nbsp;<span class="ident" id="7367809">err</span><span class="op" id="7367812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7367815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7367818">if</span>&nbsp;<span class="ident" id="7367821">err</span>&nbsp;<span class="op" id="7367825">:=</span>&nbsp;<span class="ident" id="7367828">w</span><span class="op" id="7367829">.</span><span class="ident" id="7367830">Close</span><span class="op" id="7367835">(</span><span class="op" id="7367836">)</span><span class="op" id="7367837">;</span>&nbsp;<span class="ident" id="7367839">err</span>&nbsp;<span class="op" id="7367843">!=</span>&nbsp;<span class="builtintype" id="7367846">nil</span>&nbsp;<span class="op" id="7367850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367854">t</span><span class="op" id="7367855">.</span><span class="ident" id="7367856">Fatalf</span><span class="op" id="7367862">(</span><span class="string" id="7367863">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7367881">,</span>&nbsp;<span class="ident" id="7367883">err</span><span class="op" id="7367886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7367889">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367893">r</span><span class="op" id="7367894">,</span>&nbsp;<span class="ident" id="7367896">err</span>&nbsp;<span class="op" id="7367900">:=</span>&nbsp;<span class="ident" id="7367903">NewReader</span><span class="op" id="7367912">(</span><span class="ident" id="7367913">buf</span><span class="op" id="7367916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7367919">if</span>&nbsp;<span class="ident" id="7367922">err</span>&nbsp;<span class="op" id="7367926">!=</span>&nbsp;<span class="builtintype" id="7367929">nil</span>&nbsp;<span class="op" id="7367933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367937">t</span><span class="op" id="7367938">.</span><span class="ident" id="7367939">Fatalf</span><span class="op" id="7367945">(</span><span class="string" id="7367946">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7367961">,</span>&nbsp;<span class="ident" id="7367963">err</span><span class="op" id="7367966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7367969">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7367972">b</span><span class="op" id="7367973">,</span>&nbsp;<span class="ident" id="7367975">err</span>&nbsp;<span class="op" id="7367979">:=</span>&nbsp;<span class="ident" id="7367982">ioutil</span><span class="op" id="7367988">.</span><span class="ident" id="7367989">ReadAll</span><span class="op" id="7367996">(</span><span class="ident" id="7367997">r</span><span class="op" id="7367998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7368001">if</span>&nbsp;<span class="ident" id="7368004">err</span>&nbsp;<span class="op" id="7368008">!=</span>&nbsp;<span class="builtintype" id="7368011">nil</span>&nbsp;<span class="op" id="7368015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7368019">t</span><span class="op" id="7368020">.</span><span class="ident" id="7368021">Fatalf</span><span class="op" id="7368027">(</span><span class="string" id="7368028">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="7368041">,</span>&nbsp;<span class="ident" id="7368043">err</span><span class="op" id="7368046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7368049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7368052">if</span>&nbsp;<span class="builtintype" id="7368055">string</span><span class="op" id="7368061">(</span><span class="ident" id="7368062">b</span><span class="op" id="7368063">)</span>&nbsp;<span class="op" id="7368065">!=</span>&nbsp;<span class="string" id="7368068">&#34;payload&#34;</span>&nbsp;<span class="op" id="7368078">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7368082">t</span><span class="op" id="7368083">.</span><span class="ident" id="7368084">Fatalf</span><span class="op" id="7368090">(</span><span class="string" id="7368091">&#34;payload&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7368115">,</span>&nbsp;<span class="builtintype" id="7368117">string</span><span class="op" id="7368123">(</span><span class="ident" id="7368124">b</span><span class="op" id="7368125">)</span><span class="op" id="7368126">,</span>&nbsp;<span class="string" id="7368128">&#34;payload&#34;</span><span class="op" id="7368137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7368140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7368143">if</span>&nbsp;<span class="ident" id="7368146">r</span><span class="op" id="7368147">.</span><span class="ident" id="7368148">Comment</span>&nbsp;<span class="op" id="7368156">!=</span>&nbsp;<span class="string" id="7368159">&#34;comment&#34;</span>&nbsp;<span class="op" id="7368169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7368173">t</span><span class="op" id="7368174">.</span><span class="ident" id="7368175">Fatalf</span><span class="op" id="7368181">(</span><span class="string" id="7368182">&#34;comment&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7368206">,</span>&nbsp;<span class="ident" id="7368208">r</span><span class="op" id="7368209">.</span><span class="ident" id="7368210">Comment</span><span class="op" id="7368217">,</span>&nbsp;<span class="string" id="7368219">&#34;comment&#34;</span><span class="op" id="7368228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7368231">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7368234">if</span>&nbsp;<span class="builtintype" id="7368237">string</span><span class="op" id="7368243">(</span><span class="ident" id="7368244">r</span><span class="op" id="7368245">.</span><span class="ident" id="7368246">Extra</span><span class="op" id="7368251">)</span>&nbsp;<span class="op" id="7368253">!=</span>&nbsp;<span class="string" id="7368256">&#34;extra&#34;</span>&nbsp;<span class="op" id="7368264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7368268">t</span><span class="op" id="7368269">.</span><span class="ident" id="7368270">Fatalf</span><span class="op" id="7368276">(</span><span class="string" id="7368277">&#34;extra&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7368299">,</span>&nbsp;<span class="ident" id="7368301">r</span><span class="op" id="7368302">.</span><span class="ident" id="7368303">Extra</span><span class="op" id="7368308">,</span>&nbsp;<span class="string" id="7368310">&#34;extra&#34;</span><span class="op" id="7368317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7368320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7368323">if</span>&nbsp;<span class="ident" id="7368326">r</span><span class="op" id="7368327">.</span><span class="ident" id="7368328">ModTime</span><span class="op" id="7368335">.</span><span class="ident" id="7368336">Unix</span><span class="op" id="7368340">(</span><span class="op" id="7368341">)</span>&nbsp;<span class="op" id="7368343">!=</span>&nbsp;<span class="num" id="7368346">1e8</span>&nbsp;<span class="op" id="7368350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7368354">t</span><span class="op" id="7368355">.</span><span class="ident" id="7368356">Fatalf</span><span class="op" id="7368362">(</span><span class="string" id="7368363">&#34;mtime&nbsp;is&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7368385">,</span>&nbsp;<span class="ident" id="7368387">r</span><span class="op" id="7368388">.</span><span class="ident" id="7368389">ModTime</span><span class="op" id="7368396">.</span><span class="ident" id="7368397">Unix</span><span class="op" id="7368401">(</span><span class="op" id="7368402">)</span><span class="op" id="7368403">,</span>&nbsp;<span class="builtintype" id="7368405">uint32</span><span class="op" id="7368411">(</span><span class="num" id="7368412">1e8</span><span class="op" id="7368415">)</span><span class="op" id="7368416">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7368419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7368422">if</span>&nbsp;<span class="ident" id="7368425">r</span><span class="op" id="7368426">.</span><span class="ident" id="7368427">Name</span>&nbsp;<span class="op" id="7368432">!=</span>&nbsp;<span class="string" id="7368435">&#34;name&#34;</span>&nbsp;<span class="op" id="7368442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7368446">t</span><span class="op" id="7368447">.</span><span class="ident" id="7368448">Fatalf</span><span class="op" id="7368454">(</span><span class="string" id="7368455">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7368476">,</span>&nbsp;<span class="ident" id="7368478">r</span><span class="op" id="7368479">.</span><span class="ident" id="7368480">Name</span><span class="op" id="7368484">,</span>&nbsp;<span class="string" id="7368486">&#34;name&#34;</span><span class="op" id="7368492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7368495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7368498">if</span>&nbsp;<span class="ident" id="7368501">err</span>&nbsp;<span class="op" id="7368505">:=</span>&nbsp;<span class="ident" id="7368508">r</span><span class="op" id="7368509">.</span><span class="ident" id="7368510">Close</span><span class="op" id="7368515">(</span><span class="op" id="7368516">)</span><span class="op" id="7368517">;</span>&nbsp;<span class="ident" id="7368519">err</span>&nbsp;<span class="op" id="7368523">!=</span>&nbsp;<span class="builtintype" id="7368526">nil</span>&nbsp;<span class="op" id="7368530">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7368534">t</span><span class="op" id="7368535">.</span><span class="ident" id="7368536">Fatalf</span><span class="op" id="7368542">(</span><span class="string" id="7368543">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="7368561">,</span>&nbsp;<span class="ident" id="7368563">err</span><span class="op" id="7368566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7368569">}</span><br>
<span class="lineno"></span><span class="op" id="7368571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7368574">//&nbsp;TestLatin1&nbsp;tests&nbsp;the&nbsp;internal&nbsp;functions&nbsp;for&nbsp;converting&nbsp;to&nbsp;and&nbsp;from&nbsp;Latin-1.</span><br>
<span class="lineno">85</span><span class="keyword" id="7368653">func</span>&nbsp;<span class="ident" id="7368658">TestLatin1</span><span class="op" id="7368668">(</span><span class="ident" id="7368669">t</span>&nbsp;<span class="op" id="7368671">*</span><span class="ident" id="7368672">testing</span><span class="op" id="7368679">.</span><span class="ident" id="7368680">T</span><span class="op" id="7368681">)</span>&nbsp;<span class="op" id="7368683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7368686">latin1</span>&nbsp;<span class="op" id="7368693">:=</span>&nbsp;<span class="op" id="7368696">[</span><span class="op" id="7368697">]</span><span class="builtintype" id="7368698">byte</span><span class="op" id="7368702">{</span><span class="num" id="7368703">0xc4</span><span class="op" id="7368707">,</span>&nbsp;<span class="string" id="7368709">&#39;u&#39;</span><span class="op" id="7368712">,</span>&nbsp;<span class="num" id="7368714">0xdf</span><span class="op" id="7368718">,</span>&nbsp;<span class="string" id="7368720">&#39;e&#39;</span><span class="op" id="7368723">,</span>&nbsp;<span class="string" id="7368725">&#39;r&#39;</span><span class="op" id="7368728">,</span>&nbsp;<span class="string" id="7368730">&#39;u&#39;</span><span class="op" id="7368733">,</span>&nbsp;<span class="string" id="7368735">&#39;n&#39;</span><span class="op" id="7368738">,</span>&nbsp;<span class="string" id="7368740">&#39;g&#39;</span><span class="op" id="7368743">,</span>&nbsp;<span class="num" id="7368745">0</span><span class="op" id="7368746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7368749">utf8</span>&nbsp;<span class="op" id="7368754">:=</span>&nbsp;<span class="string" id="7368757">&#34;Äußerung&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7368771">z</span>&nbsp;<span class="op" id="7368773">:=</span>&nbsp;<span class="ident" id="7368776">Reader</span><span class="op" id="7368782">{</span><span class="ident" id="7368783">r</span><span class="op" id="7368784">:</span>&nbsp;<span class="ident" id="7368786">bufio</span><span class="op" id="7368791">.</span><span class="ident" id="7368792">NewReader</span><span class="op" id="7368801">(</span><span class="ident" id="7368802">bytes</span><span class="op" id="7368807">.</span><span class="ident" id="7368808">NewReader</span><span class="op" id="7368817">(</span><span class="ident" id="7368818">latin1</span><span class="op" id="7368824">)</span><span class="op" id="7368825">)</span><span class="op" id="7368826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7368829">s</span><span class="op" id="7368830">,</span>&nbsp;<span class="ident" id="7368832">err</span>&nbsp;<span class="op" id="7368836">:=</span>&nbsp;<span class="ident" id="7368839">z</span><span class="op" id="7368840">.</span><span class="ident" id="7368841">readString</span><span class="op" id="7368851">(</span><span class="op" id="7368852">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7368855">if</span>&nbsp;<span class="ident" id="7368858">err</span>&nbsp;<span class="op" id="7368862">!=</span>&nbsp;<span class="builtintype" id="7368865">nil</span>&nbsp;<span class="op" id="7368869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7368873">t</span><span class="op" id="7368874">.</span><span class="ident" id="7368875">Fatalf</span><span class="op" id="7368881">(</span><span class="string" id="7368882">&#34;readString:&nbsp;%v&#34;</span><span class="op" id="7368898">,</span>&nbsp;<span class="ident" id="7368900">err</span><span class="op" id="7368903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7368906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7368909">if</span>&nbsp;<span class="ident" id="7368912">s</span>&nbsp;<span class="op" id="7368914">!=</span>&nbsp;<span class="ident" id="7368917">utf8</span>&nbsp;<span class="op" id="7368922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7368926">t</span><span class="op" id="7368927">.</span><span class="ident" id="7368928">Fatalf</span><span class="op" id="7368934">(</span><span class="string" id="7368935">&#34;read&nbsp;latin-1:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7368966">,</span>&nbsp;<span class="ident" id="7368968">s</span><span class="op" id="7368969">,</span>&nbsp;<span class="ident" id="7368971">utf8</span><span class="op" id="7368975">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7368978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7368982">buf</span>&nbsp;<span class="op" id="7368986">:=</span>&nbsp;<span class="ident" id="7368989">bytes</span><span class="op" id="7368994">.</span><span class="ident" id="7368995">NewBuffer</span><span class="op" id="7369004">(</span><span class="builtinfunc" id="7369005">make</span><span class="op" id="7369009">(</span><span class="op" id="7369010">[</span><span class="op" id="7369011">]</span><span class="builtintype" id="7369012">byte</span><span class="op" id="7369016">,</span>&nbsp;<span class="num" id="7369018">0</span><span class="op" id="7369019">,</span>&nbsp;<span class="builtinfunc" id="7369021">len</span><span class="op" id="7369024">(</span><span class="ident" id="7369025">latin1</span><span class="op" id="7369031">)</span><span class="op" id="7369032">)</span><span class="op" id="7369033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7369036">c</span>&nbsp;<span class="op" id="7369038">:=</span>&nbsp;<span class="ident" id="7369041">Writer</span><span class="op" id="7369047">{</span><span class="ident" id="7369048">w</span><span class="op" id="7369049">:</span>&nbsp;<span class="ident" id="7369051">buf</span><span class="op" id="7369054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7369057">if</span>&nbsp;<span class="ident" id="7369060">err</span>&nbsp;<span class="op" id="7369064">=</span>&nbsp;<span class="ident" id="7369066">c</span><span class="op" id="7369067">.</span><span class="ident" id="7369068">writeString</span><span class="op" id="7369079">(</span><span class="ident" id="7369080">utf8</span><span class="op" id="7369084">)</span><span class="op" id="7369085">;</span>&nbsp;<span class="ident" id="7369087">err</span>&nbsp;<span class="op" id="7369091">!=</span>&nbsp;<span class="builtintype" id="7369094">nil</span>&nbsp;<span class="op" id="7369098">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7369102">t</span><span class="op" id="7369103">.</span><span class="ident" id="7369104">Fatalf</span><span class="op" id="7369110">(</span><span class="string" id="7369111">&#34;writeString:&nbsp;%v&#34;</span><span class="op" id="7369128">,</span>&nbsp;<span class="ident" id="7369130">err</span><span class="op" id="7369133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7369136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7369139">s</span>&nbsp;<span class="op" id="7369141">=</span>&nbsp;<span class="ident" id="7369143">buf</span><span class="op" id="7369146">.</span><span class="ident" id="7369147">String</span><span class="op" id="7369153">(</span><span class="op" id="7369154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7369157">if</span>&nbsp;<span class="ident" id="7369160">s</span>&nbsp;<span class="op" id="7369162">!=</span>&nbsp;<span class="builtintype" id="7369165">string</span><span class="op" id="7369171">(</span><span class="ident" id="7369172">latin1</span><span class="op" id="7369178">)</span>&nbsp;<span class="op" id="7369180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7369184">t</span><span class="op" id="7369185">.</span><span class="ident" id="7369186">Fatalf</span><span class="op" id="7369192">(</span><span class="string" id="7369193">&#34;write&nbsp;utf-8:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7369223">,</span>&nbsp;<span class="ident" id="7369225">s</span><span class="op" id="7369226">,</span>&nbsp;<span class="builtintype" id="7369228">string</span><span class="op" id="7369234">(</span><span class="ident" id="7369235">latin1</span><span class="op" id="7369241">)</span><span class="op" id="7369242">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7369245">}</span><br>
<span class="lineno"></span><span class="op" id="7369247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7369250">//&nbsp;TestLatin1RoundTrip&nbsp;tests&nbsp;that&nbsp;metadata&nbsp;that&nbsp;is&nbsp;representable&nbsp;in&nbsp;Latin-1</span><br>
<span class="lineno"></span><span class="comment" id="7369326">//&nbsp;survives&nbsp;a&nbsp;round&nbsp;trip.</span><br>
<span class="lineno">110</span><span class="keyword" id="7369352">func</span>&nbsp;<span class="ident" id="7369357">TestLatin1RoundTrip</span><span class="op" id="7369376">(</span><span class="ident" id="7369377">t</span>&nbsp;<span class="op" id="7369379">*</span><span class="ident" id="7369380">testing</span><span class="op" id="7369387">.</span><span class="ident" id="7369388">T</span><span class="op" id="7369389">)</span>&nbsp;<span class="op" id="7369391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7369394">testCases</span>&nbsp;<span class="op" id="7369404">:=</span>&nbsp;<span class="op" id="7369407">[</span><span class="op" id="7369408">]</span><span class="keyword" id="7369409">struct</span>&nbsp;<span class="op" id="7369416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7369420">name</span>&nbsp;<span class="builtintype" id="7369425">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7369434">ok</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7369439">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7369445">}</span><span class="op" id="7369446">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7369450">{</span><span class="string" id="7369451">&#34;&#34;</span><span class="op" id="7369453">,</span>&nbsp;<span class="builtintype" id="7369455">true</span><span class="op" id="7369459">}</span><span class="op" id="7369460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7369464">{</span><span class="string" id="7369465">&#34;ASCII&nbsp;is&nbsp;OK&#34;</span><span class="op" id="7369478">,</span>&nbsp;<span class="builtintype" id="7369480">true</span><span class="op" id="7369484">}</span><span class="op" id="7369485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7369489">{</span><span class="string" id="7369490">&#34;unless&nbsp;it&nbsp;contains&nbsp;a&nbsp;NUL\x00&#34;</span><span class="op" id="7369520">,</span>&nbsp;<span class="builtintype" id="7369522">false</span><span class="op" id="7369527">}</span><span class="op" id="7369528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7369532">{</span><span class="string" id="7369533">&#34;no&nbsp;matter&nbsp;where&nbsp;\x00&nbsp;occurs&#34;</span><span class="op" id="7369562">,</span>&nbsp;<span class="builtintype" id="7369564">false</span><span class="op" id="7369569">}</span><span class="op" id="7369570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7369574">{</span><span class="string" id="7369575">&#34;\x00\x00\x00&#34;</span><span class="op" id="7369589">,</span>&nbsp;<span class="builtintype" id="7369591">false</span><span class="op" id="7369596">}</span><span class="op" id="7369597">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7369601">{</span><span class="string" id="7369602">&#34;Látin-1&nbsp;also&nbsp;passes&nbsp;(U+00E1)&#34;</span><span class="op" id="7369633">,</span>&nbsp;<span class="builtintype" id="7369635">true</span><span class="op" id="7369639">}</span><span class="op" id="7369640">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7369644">{</span><span class="string" id="7369645">&#34;but&nbsp;LĀtin&nbsp;Extended-A&nbsp;(U+0100)&nbsp;does&nbsp;not&#34;</span><span class="op" id="7369686">,</span>&nbsp;<span class="builtintype" id="7369688">false</span><span class="op" id="7369693">}</span><span class="op" id="7369694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7369698">{</span><span class="string" id="7369699">&#34;neither&nbsp;does&nbsp;日本語&#34;</span><span class="op" id="7369723">,</span>&nbsp;<span class="builtintype" id="7369725">false</span><span class="op" id="7369730">}</span><span class="op" id="7369731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7369735">{</span><span class="string" id="7369736">&#34;invalid&nbsp;UTF-8&nbsp;also&nbsp;\xffails&#34;</span><span class="op" id="7369765">,</span>&nbsp;<span class="builtintype" id="7369767">false</span><span class="op" id="7369772">}</span><span class="op" id="7369773">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7369777">{</span><span class="string" id="7369778">&#34;\x00&nbsp;as&nbsp;does&nbsp;Látin-1&nbsp;with&nbsp;NUL&#34;</span><span class="op" id="7369810">,</span>&nbsp;<span class="builtintype" id="7369812">false</span><span class="op" id="7369817">}</span><span class="op" id="7369818">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7369821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7369824">for</span>&nbsp;<span class="ident" id="7369828">_</span><span class="op" id="7369829">,</span>&nbsp;<span class="ident" id="7369831">tc</span>&nbsp;<span class="op" id="7369834">:=</span>&nbsp;<span class="keyword" id="7369837">range</span>&nbsp;<span class="ident" id="7369843">testCases</span>&nbsp;<span class="op" id="7369853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7369857">buf</span>&nbsp;<span class="op" id="7369861">:=</span>&nbsp;<span class="builtinfunc" id="7369864">new</span><span class="op" id="7369867">(</span><span class="ident" id="7369868">bytes</span><span class="op" id="7369873">.</span><span class="ident" id="7369874">Buffer</span><span class="op" id="7369880">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7369885">w</span>&nbsp;<span class="op" id="7369887">:=</span>&nbsp;<span class="ident" id="7369890">NewWriter</span><span class="op" id="7369899">(</span><span class="ident" id="7369900">buf</span><span class="op" id="7369903">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7369907">w</span><span class="op" id="7369908">.</span><span class="ident" id="7369909">Name</span>&nbsp;<span class="op" id="7369914">=</span>&nbsp;<span class="ident" id="7369916">tc</span><span class="op" id="7369918">.</span><span class="ident" id="7369919">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7369926">err</span>&nbsp;<span class="op" id="7369930">:=</span>&nbsp;<span class="ident" id="7369933">w</span><span class="op" id="7369934">.</span><span class="ident" id="7369935">Close</span><span class="op" id="7369940">(</span><span class="op" id="7369941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7369945">if</span>&nbsp;<span class="op" id="7369948">(</span><span class="ident" id="7369949">err</span>&nbsp;<span class="op" id="7369953">==</span>&nbsp;<span class="builtintype" id="7369956">nil</span><span class="op" id="7369959">)</span>&nbsp;<span class="op" id="7369961">!=</span>&nbsp;<span class="ident" id="7369964">tc</span><span class="op" id="7369966">.</span><span class="ident" id="7369967">ok</span>&nbsp;<span class="op" id="7369970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7369975">t</span><span class="op" id="7369976">.</span><span class="ident" id="7369977">Errorf</span><span class="op" id="7369983">(</span><span class="string" id="7369984">&#34;Writer.Close:&nbsp;name&nbsp;=&nbsp;%q,&nbsp;err&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7370019">,</span>&nbsp;<span class="ident" id="7370021">tc</span><span class="op" id="7370023">.</span><span class="ident" id="7370024">name</span><span class="op" id="7370028">,</span>&nbsp;<span class="ident" id="7370030">err</span><span class="op" id="7370033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7370038">continue</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7370049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7370053">if</span>&nbsp;<span class="op" id="7370056">!</span><span class="ident" id="7370057">tc</span><span class="op" id="7370059">.</span><span class="ident" id="7370060">ok</span>&nbsp;<span class="op" id="7370063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7370068">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7370079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370084">r</span><span class="op" id="7370085">,</span>&nbsp;<span class="ident" id="7370087">err</span>&nbsp;<span class="op" id="7370091">:=</span>&nbsp;<span class="ident" id="7370094">NewReader</span><span class="op" id="7370103">(</span><span class="ident" id="7370104">buf</span><span class="op" id="7370107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7370111">if</span>&nbsp;<span class="ident" id="7370114">err</span>&nbsp;<span class="op" id="7370118">!=</span>&nbsp;<span class="builtintype" id="7370121">nil</span>&nbsp;<span class="op" id="7370125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370130">t</span><span class="op" id="7370131">.</span><span class="ident" id="7370132">Errorf</span><span class="op" id="7370138">(</span><span class="string" id="7370139">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7370154">,</span>&nbsp;<span class="ident" id="7370156">err</span><span class="op" id="7370159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7370164">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7370175">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370179">_</span><span class="op" id="7370180">,</span>&nbsp;<span class="ident" id="7370182">err</span>&nbsp;<span class="op" id="7370186">=</span>&nbsp;<span class="ident" id="7370188">ioutil</span><span class="op" id="7370194">.</span><span class="ident" id="7370195">ReadAll</span><span class="op" id="7370202">(</span><span class="ident" id="7370203">r</span><span class="op" id="7370204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7370208">if</span>&nbsp;<span class="ident" id="7370211">err</span>&nbsp;<span class="op" id="7370215">!=</span>&nbsp;<span class="builtintype" id="7370218">nil</span>&nbsp;<span class="op" id="7370222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370227">t</span><span class="op" id="7370228">.</span><span class="ident" id="7370229">Errorf</span><span class="op" id="7370235">(</span><span class="string" id="7370236">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="7370249">,</span>&nbsp;<span class="ident" id="7370251">err</span><span class="op" id="7370254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7370259">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7370270">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7370274">if</span>&nbsp;<span class="ident" id="7370277">r</span><span class="op" id="7370278">.</span><span class="ident" id="7370279">Name</span>&nbsp;<span class="op" id="7370284">!=</span>&nbsp;<span class="ident" id="7370287">tc</span><span class="op" id="7370289">.</span><span class="ident" id="7370290">name</span>&nbsp;<span class="op" id="7370295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370300">t</span><span class="op" id="7370301">.</span><span class="ident" id="7370302">Errorf</span><span class="op" id="7370308">(</span><span class="string" id="7370309">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7370330">,</span>&nbsp;<span class="ident" id="7370332">r</span><span class="op" id="7370333">.</span><span class="ident" id="7370334">Name</span><span class="op" id="7370338">,</span>&nbsp;<span class="ident" id="7370340">tc</span><span class="op" id="7370342">.</span><span class="ident" id="7370343">name</span><span class="op" id="7370347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7370352">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7370363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7370367">if</span>&nbsp;<span class="ident" id="7370370">err</span>&nbsp;<span class="op" id="7370374">:=</span>&nbsp;<span class="ident" id="7370377">r</span><span class="op" id="7370378">.</span><span class="ident" id="7370379">Close</span><span class="op" id="7370384">(</span><span class="op" id="7370385">)</span><span class="op" id="7370386">;</span>&nbsp;<span class="ident" id="7370388">err</span>&nbsp;<span class="op" id="7370392">!=</span>&nbsp;<span class="builtintype" id="7370395">nil</span>&nbsp;<span class="op" id="7370399">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370404">t</span><span class="op" id="7370405">.</span><span class="ident" id="7370406">Errorf</span><span class="op" id="7370412">(</span><span class="string" id="7370413">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="7370431">,</span>&nbsp;<span class="ident" id="7370433">err</span><span class="op" id="7370436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7370441">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7370452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7370455">}</span><br>
<span class="lineno"></span><span class="op" id="7370457">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="7370460">func</span>&nbsp;<span class="ident" id="7370465">TestWriterFlush</span><span class="op" id="7370480">(</span><span class="ident" id="7370481">t</span>&nbsp;<span class="op" id="7370483">*</span><span class="ident" id="7370484">testing</span><span class="op" id="7370491">.</span><span class="ident" id="7370492">T</span><span class="op" id="7370493">)</span>&nbsp;<span class="op" id="7370495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370498">buf</span>&nbsp;<span class="op" id="7370502">:=</span>&nbsp;<span class="builtinfunc" id="7370505">new</span><span class="op" id="7370508">(</span><span class="ident" id="7370509">bytes</span><span class="op" id="7370514">.</span><span class="ident" id="7370515">Buffer</span><span class="op" id="7370521">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370525">w</span>&nbsp;<span class="op" id="7370527">:=</span>&nbsp;<span class="ident" id="7370530">NewWriter</span><span class="op" id="7370539">(</span><span class="ident" id="7370540">buf</span><span class="op" id="7370543">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370546">w</span><span class="op" id="7370547">.</span><span class="ident" id="7370548">Comment</span>&nbsp;<span class="op" id="7370556">=</span>&nbsp;<span class="string" id="7370558">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370569">w</span><span class="op" id="7370570">.</span><span class="ident" id="7370571">Extra</span>&nbsp;<span class="op" id="7370577">=</span>&nbsp;<span class="op" id="7370579">[</span><span class="op" id="7370580">]</span><span class="builtintype" id="7370581">byte</span><span class="op" id="7370585">(</span><span class="string" id="7370586">&#34;extra&#34;</span><span class="op" id="7370593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370596">w</span><span class="op" id="7370597">.</span><span class="ident" id="7370598">ModTime</span>&nbsp;<span class="op" id="7370606">=</span>&nbsp;<span class="ident" id="7370608">time</span><span class="op" id="7370612">.</span><span class="ident" id="7370613">Unix</span><span class="op" id="7370617">(</span><span class="num" id="7370618">1e8</span><span class="op" id="7370621">,</span>&nbsp;<span class="num" id="7370623">0</span><span class="op" id="7370624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370627">w</span><span class="op" id="7370628">.</span><span class="ident" id="7370629">Name</span>&nbsp;<span class="op" id="7370634">=</span>&nbsp;<span class="string" id="7370636">&#34;name&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370645">n0</span>&nbsp;<span class="op" id="7370648">:=</span>&nbsp;<span class="ident" id="7370651">buf</span><span class="op" id="7370654">.</span><span class="ident" id="7370655">Len</span><span class="op" id="7370658">(</span><span class="op" id="7370659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7370662">if</span>&nbsp;<span class="ident" id="7370665">n0</span>&nbsp;<span class="op" id="7370668">!=</span>&nbsp;<span class="num" id="7370671">0</span>&nbsp;<span class="op" id="7370673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370677">t</span><span class="op" id="7370678">.</span><span class="ident" id="7370679">Fatalf</span><span class="op" id="7370685">(</span><span class="string" id="7370686">&#34;buffer&nbsp;size&nbsp;=&nbsp;%d&nbsp;before&nbsp;writes;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7370726">,</span>&nbsp;<span class="ident" id="7370728">n0</span><span class="op" id="7370730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7370733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7370737">if</span>&nbsp;<span class="ident" id="7370740">err</span>&nbsp;<span class="op" id="7370744">:=</span>&nbsp;<span class="ident" id="7370747">w</span><span class="op" id="7370748">.</span><span class="ident" id="7370749">Flush</span><span class="op" id="7370754">(</span><span class="op" id="7370755">)</span><span class="op" id="7370756">;</span>&nbsp;<span class="ident" id="7370758">err</span>&nbsp;<span class="op" id="7370762">!=</span>&nbsp;<span class="builtintype" id="7370765">nil</span>&nbsp;<span class="op" id="7370769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370773">t</span><span class="op" id="7370774">.</span><span class="ident" id="7370775">Fatal</span><span class="op" id="7370780">(</span><span class="ident" id="7370781">err</span><span class="op" id="7370784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7370787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370791">n1</span>&nbsp;<span class="op" id="7370794">:=</span>&nbsp;<span class="ident" id="7370797">buf</span><span class="op" id="7370800">.</span><span class="ident" id="7370801">Len</span><span class="op" id="7370804">(</span><span class="op" id="7370805">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7370808">if</span>&nbsp;<span class="ident" id="7370811">n1</span>&nbsp;<span class="op" id="7370814">==</span>&nbsp;<span class="num" id="7370817">0</span>&nbsp;<span class="op" id="7370819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370823">t</span><span class="op" id="7370824">.</span><span class="ident" id="7370825">Fatal</span><span class="op" id="7370830">(</span><span class="string" id="7370831">&#34;no&nbsp;data&nbsp;after&nbsp;first&nbsp;flush&#34;</span><span class="op" id="7370858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7370861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370865">w</span><span class="op" id="7370866">.</span><span class="ident" id="7370867">Write</span><span class="op" id="7370872">(</span><span class="op" id="7370873">[</span><span class="op" id="7370874">]</span><span class="builtintype" id="7370875">byte</span><span class="op" id="7370879">(</span><span class="string" id="7370880">&#34;x&#34;</span><span class="op" id="7370883">)</span><span class="op" id="7370884">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370888">n2</span>&nbsp;<span class="op" id="7370891">:=</span>&nbsp;<span class="ident" id="7370894">buf</span><span class="op" id="7370897">.</span><span class="ident" id="7370898">Len</span><span class="op" id="7370901">(</span><span class="op" id="7370902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7370905">if</span>&nbsp;<span class="ident" id="7370908">n1</span>&nbsp;<span class="op" id="7370911">!=</span>&nbsp;<span class="ident" id="7370914">n2</span>&nbsp;<span class="op" id="7370917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7370921">t</span><span class="op" id="7370922">.</span><span class="ident" id="7370923">Fatalf</span><span class="op" id="7370929">(</span><span class="string" id="7370930">&#34;after&nbsp;writing&nbsp;a&nbsp;single&nbsp;byte,&nbsp;size&nbsp;changed&nbsp;from&nbsp;%d&nbsp;to&nbsp;%d;&nbsp;want&nbsp;no&nbsp;change&#34;</span><span class="op" id="7371003">,</span>&nbsp;<span class="ident" id="7371005">n1</span><span class="op" id="7371007">,</span>&nbsp;<span class="ident" id="7371009">n2</span><span class="op" id="7371011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7371014">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7371018">if</span>&nbsp;<span class="ident" id="7371021">err</span>&nbsp;<span class="op" id="7371025">:=</span>&nbsp;<span class="ident" id="7371028">w</span><span class="op" id="7371029">.</span><span class="ident" id="7371030">Flush</span><span class="op" id="7371035">(</span><span class="op" id="7371036">)</span><span class="op" id="7371037">;</span>&nbsp;<span class="ident" id="7371039">err</span>&nbsp;<span class="op" id="7371043">!=</span>&nbsp;<span class="builtintype" id="7371046">nil</span>&nbsp;<span class="op" id="7371050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371054">t</span><span class="op" id="7371055">.</span><span class="ident" id="7371056">Fatal</span><span class="op" id="7371061">(</span><span class="ident" id="7371062">err</span><span class="op" id="7371065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7371068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371072">n3</span>&nbsp;<span class="op" id="7371075">:=</span>&nbsp;<span class="ident" id="7371078">buf</span><span class="op" id="7371081">.</span><span class="ident" id="7371082">Len</span><span class="op" id="7371085">(</span><span class="op" id="7371086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7371089">if</span>&nbsp;<span class="ident" id="7371092">n2</span>&nbsp;<span class="op" id="7371095">==</span>&nbsp;<span class="ident" id="7371098">n3</span>&nbsp;<span class="op" id="7371101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371105">t</span><span class="op" id="7371106">.</span><span class="ident" id="7371107">Fatal</span><span class="op" id="7371112">(</span><span class="string" id="7371113">&#34;Flush&nbsp;didn&#39;t&nbsp;flush&nbsp;any&nbsp;data&#34;</span><span class="op" id="7371142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7371145">}</span><br>
<span class="lineno"></span><span class="op" id="7371147">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="7371150">//&nbsp;Multiple&nbsp;gzip&nbsp;files&nbsp;concatenated&nbsp;form&nbsp;a&nbsp;valid&nbsp;gzip&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="7371210">func</span>&nbsp;<span class="ident" id="7371215">TestConcat</span><span class="op" id="7371225">(</span><span class="ident" id="7371226">t</span>&nbsp;<span class="op" id="7371228">*</span><span class="ident" id="7371229">testing</span><span class="op" id="7371236">.</span><span class="ident" id="7371237">T</span><span class="op" id="7371238">)</span>&nbsp;<span class="op" id="7371240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7371243">var</span>&nbsp;<span class="ident" id="7371247">buf</span>&nbsp;<span class="ident" id="7371251">bytes</span><span class="op" id="7371256">.</span><span class="ident" id="7371257">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371265">w</span>&nbsp;<span class="op" id="7371267">:=</span>&nbsp;<span class="ident" id="7371270">NewWriter</span><span class="op" id="7371279">(</span><span class="op" id="7371280">&amp;</span><span class="ident" id="7371281">buf</span><span class="op" id="7371284">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371287">w</span><span class="op" id="7371288">.</span><span class="ident" id="7371289">Write</span><span class="op" id="7371294">(</span><span class="op" id="7371295">[</span><span class="op" id="7371296">]</span><span class="builtintype" id="7371297">byte</span><span class="op" id="7371301">(</span><span class="string" id="7371302">&#34;hello&nbsp;&#34;</span><span class="op" id="7371310">)</span><span class="op" id="7371311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371314">w</span><span class="op" id="7371315">.</span><span class="ident" id="7371316">Close</span><span class="op" id="7371321">(</span><span class="op" id="7371322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371325">w</span>&nbsp;<span class="op" id="7371327">=</span>&nbsp;<span class="ident" id="7371329">NewWriter</span><span class="op" id="7371338">(</span><span class="op" id="7371339">&amp;</span><span class="ident" id="7371340">buf</span><span class="op" id="7371343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371346">w</span><span class="op" id="7371347">.</span><span class="ident" id="7371348">Write</span><span class="op" id="7371353">(</span><span class="op" id="7371354">[</span><span class="op" id="7371355">]</span><span class="builtintype" id="7371356">byte</span><span class="op" id="7371360">(</span><span class="string" id="7371361">&#34;world\n&#34;</span><span class="op" id="7371370">)</span><span class="op" id="7371371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371374">w</span><span class="op" id="7371375">.</span><span class="ident" id="7371376">Close</span><span class="op" id="7371381">(</span><span class="op" id="7371382">)</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371386">r</span><span class="op" id="7371387">,</span>&nbsp;<span class="ident" id="7371389">err</span>&nbsp;<span class="op" id="7371393">:=</span>&nbsp;<span class="ident" id="7371396">NewReader</span><span class="op" id="7371405">(</span><span class="op" id="7371406">&amp;</span><span class="ident" id="7371407">buf</span><span class="op" id="7371410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371413">data</span><span class="op" id="7371417">,</span>&nbsp;<span class="ident" id="7371419">err</span>&nbsp;<span class="op" id="7371423">:=</span>&nbsp;<span class="ident" id="7371426">ioutil</span><span class="op" id="7371432">.</span><span class="ident" id="7371433">ReadAll</span><span class="op" id="7371440">(</span><span class="ident" id="7371441">r</span><span class="op" id="7371442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7371445">if</span>&nbsp;<span class="builtintype" id="7371448">string</span><span class="op" id="7371454">(</span><span class="ident" id="7371455">data</span><span class="op" id="7371459">)</span>&nbsp;<span class="op" id="7371461">!=</span>&nbsp;<span class="string" id="7371464">&#34;hello&nbsp;world\n&#34;</span>&nbsp;<span class="op" id="7371480">||</span>&nbsp;<span class="ident" id="7371483">err</span>&nbsp;<span class="op" id="7371487">!=</span>&nbsp;<span class="builtintype" id="7371490">nil</span>&nbsp;<span class="op" id="7371494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371498">t</span><span class="op" id="7371499">.</span><span class="ident" id="7371500">Fatalf</span><span class="op" id="7371506">(</span><span class="string" id="7371507">&#34;ReadAll&nbsp;=&nbsp;%q,&nbsp;%v,&nbsp;want&nbsp;%q,&nbsp;nil&#34;</span><span class="op" id="7371539">,</span>&nbsp;<span class="ident" id="7371541">data</span><span class="op" id="7371545">,</span>&nbsp;<span class="ident" id="7371547">err</span><span class="op" id="7371550">,</span>&nbsp;<span class="string" id="7371552">&#34;hello&nbsp;world&#34;</span><span class="op" id="7371565">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7371568">}</span><br>
<span class="lineno"></span><span class="op" id="7371570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7371573">func</span>&nbsp;<span class="ident" id="7371578">TestWriterReset</span><span class="op" id="7371593">(</span><span class="ident" id="7371594">t</span>&nbsp;<span class="op" id="7371596">*</span><span class="ident" id="7371597">testing</span><span class="op" id="7371604">.</span><span class="ident" id="7371605">T</span><span class="op" id="7371606">)</span>&nbsp;<span class="op" id="7371608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371611">buf</span>&nbsp;<span class="op" id="7371615">:=</span>&nbsp;<span class="builtinfunc" id="7371618">new</span><span class="op" id="7371621">(</span><span class="ident" id="7371622">bytes</span><span class="op" id="7371627">.</span><span class="ident" id="7371628">Buffer</span><span class="op" id="7371634">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371637">buf2</span>&nbsp;<span class="op" id="7371642">:=</span>&nbsp;<span class="builtinfunc" id="7371645">new</span><span class="op" id="7371648">(</span><span class="ident" id="7371649">bytes</span><span class="op" id="7371654">.</span><span class="ident" id="7371655">Buffer</span><span class="op" id="7371661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371664">z</span>&nbsp;<span class="op" id="7371666">:=</span>&nbsp;<span class="ident" id="7371669">NewWriter</span><span class="op" id="7371678">(</span><span class="ident" id="7371679">buf</span><span class="op" id="7371682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371685">msg</span>&nbsp;<span class="op" id="7371689">:=</span>&nbsp;<span class="op" id="7371692">[</span><span class="op" id="7371693">]</span><span class="builtintype" id="7371694">byte</span><span class="op" id="7371698">(</span><span class="string" id="7371699">&#34;hello&nbsp;world&#34;</span><span class="op" id="7371712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371715">z</span><span class="op" id="7371716">.</span><span class="ident" id="7371717">Write</span><span class="op" id="7371722">(</span><span class="ident" id="7371723">msg</span><span class="op" id="7371726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371729">z</span><span class="op" id="7371730">.</span><span class="ident" id="7371731">Close</span><span class="op" id="7371736">(</span><span class="op" id="7371737">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371740">z</span><span class="op" id="7371741">.</span><span class="ident" id="7371742">Reset</span><span class="op" id="7371747">(</span><span class="ident" id="7371748">buf2</span><span class="op" id="7371752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371755">z</span><span class="op" id="7371756">.</span><span class="ident" id="7371757">Write</span><span class="op" id="7371762">(</span><span class="ident" id="7371763">msg</span><span class="op" id="7371766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371769">z</span><span class="op" id="7371770">.</span><span class="ident" id="7371771">Close</span><span class="op" id="7371776">(</span><span class="op" id="7371777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7371780">if</span>&nbsp;<span class="ident" id="7371783">buf</span><span class="op" id="7371786">.</span><span class="ident" id="7371787">String</span><span class="op" id="7371793">(</span><span class="op" id="7371794">)</span>&nbsp;<span class="op" id="7371796">!=</span>&nbsp;<span class="ident" id="7371799">buf2</span><span class="op" id="7371803">.</span><span class="ident" id="7371804">String</span><span class="op" id="7371810">(</span><span class="op" id="7371811">)</span>&nbsp;<span class="op" id="7371813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7371817">t</span><span class="op" id="7371818">.</span><span class="ident" id="7371819">Errorf</span><span class="op" id="7371825">(</span><span class="string" id="7371826">&#34;buf2&nbsp;%q&nbsp;!=&nbsp;original&nbsp;buf&nbsp;of&nbsp;%q&#34;</span><span class="op" id="7371857">,</span>&nbsp;<span class="ident" id="7371859">buf2</span><span class="op" id="7371863">.</span><span class="ident" id="7371864">String</span><span class="op" id="7371870">(</span><span class="op" id="7371871">)</span><span class="op" id="7371872">,</span>&nbsp;<span class="ident" id="7371874">buf</span><span class="op" id="7371877">.</span><span class="ident" id="7371878">String</span><span class="op" id="7371884">(</span><span class="op" id="7371885">)</span><span class="op" id="7371886">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7371889">}</span><br>
<span class="lineno"></span><span class="op" id="7371891">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
