<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6247825">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6247880">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6247934">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6247985">package</span>&nbsp;<span class="ident" id="6247993">httputil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6248003">import</span>&nbsp;<span class="op" id="6248010">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6248013">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6248022">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6248031">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6248041">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6248048">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6248054">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6248067">&#34;net&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6248074">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6248086">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6248097">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6248108">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6248115">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6248118">//&nbsp;One&nbsp;of&nbsp;the&nbsp;copies,&nbsp;say&nbsp;from&nbsp;b&nbsp;to&nbsp;r2,&nbsp;could&nbsp;be&nbsp;avoided&nbsp;by&nbsp;using&nbsp;a&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="6248191">//&nbsp;elaborate&nbsp;trick&nbsp;where&nbsp;the&nbsp;other&nbsp;copy&nbsp;is&nbsp;made&nbsp;during&nbsp;Request/Response.Write.</span><br>
<span class="lineno"></span><span class="comment" id="6248270">//&nbsp;This&nbsp;would&nbsp;complicate&nbsp;things&nbsp;too&nbsp;much,&nbsp;given&nbsp;that&nbsp;these&nbsp;functions&nbsp;are&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6248347">//&nbsp;debugging&nbsp;only.</span><br>
<span class="lineno">25</span><span class="keyword" id="6248366">func</span>&nbsp;<span class="ident" id="6248371">drainBody</span><span class="op" id="6248380">(</span><span class="ident" id="6248381">b</span>&nbsp;<span class="ident" id="6248383"><a href="/net/http/httputil/dump.go.html#6248048">io</a></span><span class="op" id="6248385">.</span><span class="ident" id="6248386">ReadCloser</span><span class="op" id="6248396">)</span>&nbsp;<span class="op" id="6248398">(</span><span class="ident" id="6248399">r1</span><span class="op" id="6248401">,</span>&nbsp;<span class="ident" id="6248403">r2</span>&nbsp;<span class="ident" id="6248406"><a href="/net/http/httputil/dump.go.html#6248048">io</a></span><span class="op" id="6248408">.</span><span class="ident" id="6248409">ReadCloser</span><span class="op" id="6248419">,</span>&nbsp;<span class="ident" id="6248421">err</span>&nbsp;<span class="builtintype" id="6248425">error</span><span class="op" id="6248430">)</span>&nbsp;<span class="op" id="6248432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248435">var</span>&nbsp;<span class="ident" id="6248439">buf</span>&nbsp;<span class="ident" id="6248443"><a href="/net/http/httputil/dump.go.html#6248022">bytes</a></span><span class="op" id="6248448">.</span><span class="ident" id="6248449">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248457">if</span>&nbsp;<span class="ident" id="6248460">_</span><span class="op" id="6248461">,</span>&nbsp;<span class="ident" id="6248463"><a href="/net/http/httputil/dump.go.html#6248421">err</a></span>&nbsp;<span class="op" id="6248467">=</span>&nbsp;<span class="ident" id="6248469"><a href="/net/http/httputil/dump.go.html#6248439">buf</a></span><span class="op" id="6248472">.</span><span class="ident" id="6248473">ReadFrom</span><span class="op" id="6248481">(</span><span class="ident" id="6248482"><a href="/net/http/httputil/dump.go.html#6248381">b</a></span><span class="op" id="6248483">)</span><span class="op" id="6248484">;</span>&nbsp;<span class="ident" id="6248486"><a href="/net/http/httputil/dump.go.html#6248421">err</a></span>&nbsp;<span class="op" id="6248490">!=</span>&nbsp;<span class="ident" id="6248493">nil</span>&nbsp;<span class="op" id="6248497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248501">return</span>&nbsp;<span class="ident" id="6248508">nil</span><span class="op" id="6248511">,</span>&nbsp;<span class="ident" id="6248513">nil</span><span class="op" id="6248516">,</span>&nbsp;<span class="ident" id="6248518"><a href="/net/http/httputil/dump.go.html#6248421">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6248523">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248526">if</span>&nbsp;<span class="ident" id="6248529"><a href="/net/http/httputil/dump.go.html#6248421">err</a></span>&nbsp;<span class="op" id="6248533">=</span>&nbsp;<span class="ident" id="6248535"><a href="/net/http/httputil/dump.go.html#6248381">b</a></span><span class="op" id="6248536">.</span><span class="ident" id="6248537">Close</span><span class="op" id="6248542">(</span><span class="op" id="6248543">)</span><span class="op" id="6248544">;</span>&nbsp;<span class="ident" id="6248546"><a href="/net/http/httputil/dump.go.html#6248421">err</a></span>&nbsp;<span class="op" id="6248550">!=</span>&nbsp;<span class="ident" id="6248553">nil</span>&nbsp;<span class="op" id="6248557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248561">return</span>&nbsp;<span class="ident" id="6248568">nil</span><span class="op" id="6248571">,</span>&nbsp;<span class="ident" id="6248573">nil</span><span class="op" id="6248576">,</span>&nbsp;<span class="ident" id="6248578"><a href="/net/http/httputil/dump.go.html#6248421">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6248583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248586">return</span>&nbsp;<span class="ident" id="6248593"><a href="/net/http/httputil/dump.go.html#6248054">ioutil</a></span><span class="op" id="6248599">.</span><span class="ident" id="6248600">NopCloser</span><span class="op" id="6248609">(</span><span class="op" id="6248610">&amp;</span><span class="ident" id="6248611"><a href="/net/http/httputil/dump.go.html#6248439">buf</a></span><span class="op" id="6248614">)</span><span class="op" id="6248615">,</span>&nbsp;<span class="ident" id="6248617"><a href="/net/http/httputil/dump.go.html#6248054">ioutil</a></span><span class="op" id="6248623">.</span><span class="ident" id="6248624">NopCloser</span><span class="op" id="6248633">(</span><span class="ident" id="6248634"><a href="/net/http/httputil/dump.go.html#6248022">bytes</a></span><span class="op" id="6248639">.</span><span class="ident" id="6248640">NewReader</span><span class="op" id="6248649">(</span><span class="ident" id="6248650"><a href="/net/http/httputil/dump.go.html#6248439">buf</a></span><span class="op" id="6248653">.</span><span class="ident" id="6248654">Bytes</span><span class="op" id="6248659">(</span><span class="op" id="6248660">)</span><span class="op" id="6248661">)</span><span class="op" id="6248662">)</span><span class="op" id="6248663">,</span>&nbsp;<span class="ident" id="6248665">nil</span><br>
<span class="lineno"></span><span class="op" id="6248669">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="6248672">//&nbsp;dumpConn&nbsp;is&nbsp;a&nbsp;net.Conn&nbsp;which&nbsp;writes&nbsp;to&nbsp;Writer&nbsp;and&nbsp;reads&nbsp;from&nbsp;Reader</span><br>
<span class="lineno"></span><span class="keyword" id="6248743">type</span>&nbsp;<span class="ident" id="6248748">dumpConn</span>&nbsp;<span class="keyword" id="6248757">struct</span>&nbsp;<span class="op" id="6248764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6248767"><a href="/net/http/httputil/dump.go.html#6248048">io</a></span><span class="op" id="6248769">.</span><span class="ident" id="6248770">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6248778"><a href="/net/http/httputil/dump.go.html#6248048">io</a></span><span class="op" id="6248780">.</span><span class="ident" id="6248781">Reader</span><br>
<span class="lineno">40</span><span class="op" id="6248788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6248791">func</span>&nbsp;<span class="op" id="6248796">(</span><span class="ident" id="6248797">c</span>&nbsp;<span class="op" id="6248799">*</span><span class="ident" id="6248800"><a href="/net/http/httputil/dump.go.html#6248748">dumpConn</a></span><span class="op" id="6248808">)</span>&nbsp;<span class="ident" id="6248810">Close</span><span class="op" id="6248815">(</span><span class="op" id="6248816">)</span>&nbsp;<span class="builtintype" id="6248818">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6248846">{</span>&nbsp;<span class="keyword" id="6248848">return</span>&nbsp;<span class="ident" id="6248855">nil</span>&nbsp;<span class="op" id="6248859">}</span><br>
<span class="lineno"></span><span class="keyword" id="6248861">func</span>&nbsp;<span class="op" id="6248866">(</span><span class="ident" id="6248867">c</span>&nbsp;<span class="op" id="6248869">*</span><span class="ident" id="6248870"><a href="/net/http/httputil/dump.go.html#6248748">dumpConn</a></span><span class="op" id="6248878">)</span>&nbsp;<span class="ident" id="6248880">LocalAddr</span><span class="op" id="6248889">(</span><span class="op" id="6248890">)</span>&nbsp;<span class="ident" id="6248892"><a href="/net/http/httputil/dump.go.html#6248067">net</a></span><span class="op" id="6248895">.</span><span class="ident" id="6248896">Addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6248916">{</span>&nbsp;<span class="keyword" id="6248918">return</span>&nbsp;<span class="ident" id="6248925">nil</span>&nbsp;<span class="op" id="6248929">}</span><br>
<span class="lineno"></span><span class="keyword" id="6248931">func</span>&nbsp;<span class="op" id="6248936">(</span><span class="ident" id="6248937">c</span>&nbsp;<span class="op" id="6248939">*</span><span class="ident" id="6248940"><a href="/net/http/httputil/dump.go.html#6248748">dumpConn</a></span><span class="op" id="6248948">)</span>&nbsp;<span class="ident" id="6248950">RemoteAddr</span><span class="op" id="6248960">(</span><span class="op" id="6248961">)</span>&nbsp;<span class="ident" id="6248963"><a href="/net/http/httputil/dump.go.html#6248067">net</a></span><span class="op" id="6248966">.</span><span class="ident" id="6248967">Addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6248986">{</span>&nbsp;<span class="keyword" id="6248988">return</span>&nbsp;<span class="ident" id="6248995">nil</span>&nbsp;<span class="op" id="6248999">}</span><br>
<span class="lineno">45</span><span class="keyword" id="6249001">func</span>&nbsp;<span class="op" id="6249006">(</span><span class="ident" id="6249007">c</span>&nbsp;<span class="op" id="6249009">*</span><span class="ident" id="6249010"><a href="/net/http/httputil/dump.go.html#6248748">dumpConn</a></span><span class="op" id="6249018">)</span>&nbsp;<span class="ident" id="6249020">SetDeadline</span><span class="op" id="6249031">(</span><span class="ident" id="6249032">t</span>&nbsp;<span class="ident" id="6249034"><a href="/net/http/httputil/dump.go.html#6248108">time</a></span><span class="op" id="6249038">.</span><span class="ident" id="6249039">Time</span><span class="op" id="6249043">)</span>&nbsp;<span class="builtintype" id="6249045">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6249056">{</span>&nbsp;<span class="keyword" id="6249058">return</span>&nbsp;<span class="ident" id="6249065">nil</span>&nbsp;<span class="op" id="6249069">}</span><br>
<span class="lineno"></span><span class="keyword" id="6249071">func</span>&nbsp;<span class="op" id="6249076">(</span><span class="ident" id="6249077">c</span>&nbsp;<span class="op" id="6249079">*</span><span class="ident" id="6249080"><a href="/net/http/httputil/dump.go.html#6248748">dumpConn</a></span><span class="op" id="6249088">)</span>&nbsp;<span class="ident" id="6249090">SetReadDeadline</span><span class="op" id="6249105">(</span><span class="ident" id="6249106">t</span>&nbsp;<span class="ident" id="6249108"><a href="/net/http/httputil/dump.go.html#6248108">time</a></span><span class="op" id="6249112">.</span><span class="ident" id="6249113">Time</span><span class="op" id="6249117">)</span>&nbsp;<span class="builtintype" id="6249119">error</span>&nbsp;&nbsp;<span class="op" id="6249126">{</span>&nbsp;<span class="keyword" id="6249128">return</span>&nbsp;<span class="ident" id="6249135">nil</span>&nbsp;<span class="op" id="6249139">}</span><br>
<span class="lineno"></span><span class="keyword" id="6249141">func</span>&nbsp;<span class="op" id="6249146">(</span><span class="ident" id="6249147">c</span>&nbsp;<span class="op" id="6249149">*</span><span class="ident" id="6249150"><a href="/net/http/httputil/dump.go.html#6248748">dumpConn</a></span><span class="op" id="6249158">)</span>&nbsp;<span class="ident" id="6249160">SetWriteDeadline</span><span class="op" id="6249176">(</span><span class="ident" id="6249177">t</span>&nbsp;<span class="ident" id="6249179"><a href="/net/http/httputil/dump.go.html#6248108">time</a></span><span class="op" id="6249183">.</span><span class="ident" id="6249184">Time</span><span class="op" id="6249188">)</span>&nbsp;<span class="builtintype" id="6249190">error</span>&nbsp;<span class="op" id="6249196">{</span>&nbsp;<span class="keyword" id="6249198">return</span>&nbsp;<span class="ident" id="6249205">nil</span>&nbsp;<span class="op" id="6249209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6249212">type</span>&nbsp;<span class="ident" id="6249217">neverEnding</span>&nbsp;<span class="builtintype" id="6249229">byte</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6249235">func</span>&nbsp;<span class="op" id="6249240">(</span><span class="ident" id="6249241">b</span>&nbsp;<span class="ident" id="6249243"><a href="/net/http/httputil/dump.go.html#6249217">neverEnding</a></span><span class="op" id="6249254">)</span>&nbsp;<span class="ident" id="6249256">Read</span><span class="op" id="6249260">(</span><span class="ident" id="6249261">p</span>&nbsp;<span class="op" id="6249263">[</span><span class="op" id="6249264">]</span><span class="builtintype" id="6249265">byte</span><span class="op" id="6249269">)</span>&nbsp;<span class="op" id="6249271">(</span><span class="ident" id="6249272">n</span>&nbsp;<span class="builtintype" id="6249274">int</span><span class="op" id="6249277">,</span>&nbsp;<span class="ident" id="6249279">err</span>&nbsp;<span class="builtintype" id="6249283">error</span><span class="op" id="6249288">)</span>&nbsp;<span class="op" id="6249290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249293">for</span>&nbsp;<span class="ident" id="6249297">i</span>&nbsp;<span class="op" id="6249299">:=</span>&nbsp;<span class="keyword" id="6249302">range</span>&nbsp;<span class="ident" id="6249308"><a href="/net/http/httputil/dump.go.html#6249261">p</a></span>&nbsp;<span class="op" id="6249310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249314"><a href="/net/http/httputil/dump.go.html#6249261">p</a></span><span class="op" id="6249315">[</span><span class="ident" id="6249316"><a href="/net/http/httputil/dump.go.html#6249297">i</a></span><span class="op" id="6249317">]</span>&nbsp;<span class="op" id="6249319">=</span>&nbsp;<span class="builtintype" id="6249321">byte</span><span class="op" id="6249325">(</span><span class="ident" id="6249326"><a href="/net/http/httputil/dump.go.html#6249241">b</a></span><span class="op" id="6249327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6249330">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249333">return</span>&nbsp;<span class="builtinfunc" id="6249340">len</span><span class="op" id="6249343">(</span><span class="ident" id="6249344"><a href="/net/http/httputil/dump.go.html#6249261">p</a></span><span class="op" id="6249345">)</span><span class="op" id="6249346">,</span>&nbsp;<span class="ident" id="6249348">nil</span><br>
<span class="lineno"></span><span class="op" id="6249352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6249355">//&nbsp;DumpRequestOut&nbsp;is&nbsp;like&nbsp;DumpRequest&nbsp;but&nbsp;includes</span><br>
<span class="lineno"></span><span class="comment" id="6249406">//&nbsp;headers&nbsp;that&nbsp;the&nbsp;standard&nbsp;http.Transport&nbsp;adds,</span><br>
<span class="lineno">60</span><span class="comment" id="6249456">//&nbsp;such&nbsp;as&nbsp;User-Agent.</span><br>
<span class="lineno"></span><span class="keyword" id="6249479">func</span>&nbsp;<span class="ident" id="6249484">DumpRequestOut</span><span class="op" id="6249498">(</span><span class="ident" id="6249499">req</span>&nbsp;<span class="op" id="6249503">*</span><span class="ident" id="6249504"><a href="/net/http/httputil/dump.go.html#6248074">http</a></span><span class="op" id="6249508">.</span><span class="ident" id="6249509">Request</span><span class="op" id="6249516">,</span>&nbsp;<span class="ident" id="6249518">body</span>&nbsp;<span class="builtintype" id="6249523">bool</span><span class="op" id="6249527">)</span>&nbsp;<span class="op" id="6249529">(</span><span class="op" id="6249530">[</span><span class="op" id="6249531">]</span><span class="builtintype" id="6249532">byte</span><span class="op" id="6249536">,</span>&nbsp;<span class="builtintype" id="6249538">error</span><span class="op" id="6249543">)</span>&nbsp;<span class="op" id="6249545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249548">save</span>&nbsp;<span class="op" id="6249553">:=</span>&nbsp;<span class="ident" id="6249556"><a href="/net/http/httputil/dump.go.html#6249499">req</a></span><span class="op" id="6249559">.</span><span class="ident" id="6249560">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249566">dummyBody</span>&nbsp;<span class="op" id="6249576">:=</span>&nbsp;<span class="ident" id="6249579">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249586">if</span>&nbsp;<span class="op" id="6249589">!</span><span class="ident" id="6249590"><a href="/net/http/httputil/dump.go.html#6249518">body</a></span>&nbsp;<span class="op" id="6249595">||</span>&nbsp;<span class="ident" id="6249598"><a href="/net/http/httputil/dump.go.html#6249499">req</a></span><span class="op" id="6249601">.</span><span class="ident" id="6249602">Body</span>&nbsp;<span class="op" id="6249607">==</span>&nbsp;<span class="ident" id="6249610">nil</span>&nbsp;<span class="op" id="6249614">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249618"><a href="/net/http/httputil/dump.go.html#6249499">req</a></span><span class="op" id="6249621">.</span><span class="ident" id="6249622">Body</span>&nbsp;<span class="op" id="6249627">=</span>&nbsp;<span class="ident" id="6249629">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249635">if</span>&nbsp;<span class="ident" id="6249638"><a href="/net/http/httputil/dump.go.html#6249499">req</a></span><span class="op" id="6249641">.</span><span class="ident" id="6249642">ContentLength</span>&nbsp;<span class="op" id="6249656">!=</span>&nbsp;<span class="num" id="6249659">0</span>&nbsp;<span class="op" id="6249661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249666"><a href="/net/http/httputil/dump.go.html#6249499">req</a></span><span class="op" id="6249669">.</span><span class="ident" id="6249670">Body</span>&nbsp;<span class="op" id="6249675">=</span>&nbsp;<span class="ident" id="6249677"><a href="/net/http/httputil/dump.go.html#6248054">ioutil</a></span><span class="op" id="6249683">.</span><span class="ident" id="6249684">NopCloser</span><span class="op" id="6249693">(</span><span class="ident" id="6249694"><a href="/net/http/httputil/dump.go.html#6248048">io</a></span><span class="op" id="6249696">.</span><span class="ident" id="6249697">LimitReader</span><span class="op" id="6249708">(</span><span class="ident" id="6249709"><a href="/net/http/httputil/dump.go.html#6249217">neverEnding</a></span><span class="op" id="6249720">(</span><span class="string" id="6249721">&#39;x&#39;</span><span class="op" id="6249724">)</span><span class="op" id="6249725">,</span>&nbsp;<span class="ident" id="6249727"><a href="/net/http/httputil/dump.go.html#6249499">req</a></span><span class="op" id="6249730">.</span><span class="ident" id="6249731">ContentLength</span><span class="op" id="6249744">)</span><span class="op" id="6249745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249750"><a href="/net/http/httputil/dump.go.html#6249566">dummyBody</a></span>&nbsp;<span class="op" id="6249760">=</span>&nbsp;<span class="ident" id="6249762">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6249769">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6249772">}</span>&nbsp;<span class="keyword" id="6249774">else</span>&nbsp;<span class="op" id="6249779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249783">var</span>&nbsp;<span class="ident" id="6249787">err</span>&nbsp;<span class="builtintype" id="6249791">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249799"><a href="/net/http/httputil/dump.go.html#6249548">save</a></span><span class="op" id="6249803">,</span>&nbsp;<span class="ident" id="6249805"><a href="/net/http/httputil/dump.go.html#6249499">req</a></span><span class="op" id="6249808">.</span><span class="ident" id="6249809">Body</span><span class="op" id="6249813">,</span>&nbsp;<span class="ident" id="6249815"><a href="/net/http/httputil/dump.go.html#6249787">err</a></span>&nbsp;<span class="op" id="6249819">=</span>&nbsp;<span class="ident" id="6249821"><a href="/net/http/httputil/dump.go.html#6248371">drainBody</a></span><span class="op" id="6249830">(</span><span class="ident" id="6249831"><a href="/net/http/httputil/dump.go.html#6249499">req</a></span><span class="op" id="6249834">.</span><span class="ident" id="6249835">Body</span><span class="op" id="6249839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249843">if</span>&nbsp;<span class="ident" id="6249846"><a href="/net/http/httputil/dump.go.html#6249787">err</a></span>&nbsp;<span class="op" id="6249850">!=</span>&nbsp;<span class="ident" id="6249853">nil</span>&nbsp;<span class="op" id="6249857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249862">return</span>&nbsp;<span class="ident" id="6249869">nil</span><span class="op" id="6249872">,</span>&nbsp;<span class="ident" id="6249874"><a href="/net/http/httputil/dump.go.html#6249787">err</a></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6249880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6249883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6249887">//&nbsp;Since&nbsp;we&#39;re&nbsp;using&nbsp;the&nbsp;actual&nbsp;Transport&nbsp;code&nbsp;to&nbsp;write&nbsp;the&nbsp;request,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6249957">//&nbsp;switch&nbsp;to&nbsp;http&nbsp;so&nbsp;the&nbsp;Transport&nbsp;doesn&#39;t&nbsp;try&nbsp;to&nbsp;do&nbsp;an&nbsp;SSL</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250018">//&nbsp;negotiation&nbsp;with&nbsp;our&nbsp;dumpConn&nbsp;and&nbsp;its&nbsp;bytes.Buffer&nbsp;&amp;&nbsp;pipe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250081">//&nbsp;The&nbsp;wire&nbsp;format&nbsp;for&nbsp;https&nbsp;and&nbsp;http&nbsp;are&nbsp;the&nbsp;same,&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250142">reqSend</span>&nbsp;<span class="op" id="6250150">:=</span>&nbsp;<span class="ident" id="6250153"><a href="/net/http/httputil/dump.go.html#6249499">req</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250158">if</span>&nbsp;<span class="ident" id="6250161"><a href="/net/http/httputil/dump.go.html#6249499">req</a></span><span class="op" id="6250164">.</span><span class="ident" id="6250165">URL</span><span class="op" id="6250168">.</span><span class="ident" id="6250169">Scheme</span>&nbsp;<span class="op" id="6250176">==</span>&nbsp;<span class="string" id="6250179">&#34;https&#34;</span>&nbsp;<span class="op" id="6250187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250191"><a href="/net/http/httputil/dump.go.html#6250142">reqSend</a></span>&nbsp;<span class="op" id="6250199">=</span>&nbsp;<span class="builtinfunc" id="6250201">new</span><span class="op" id="6250204">(</span><span class="ident" id="6250205"><a href="/net/http/httputil/dump.go.html#6248074">http</a></span><span class="op" id="6250209">.</span><span class="ident" id="6250210">Request</span><span class="op" id="6250217">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6250221">*</span><span class="ident" id="6250222"><a href="/net/http/httputil/dump.go.html#6250142">reqSend</a></span>&nbsp;<span class="op" id="6250230">=</span>&nbsp;<span class="op" id="6250232">*</span><span class="ident" id="6250233"><a href="/net/http/httputil/dump.go.html#6249499">req</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250239"><a href="/net/http/httputil/dump.go.html#6250142">reqSend</a></span><span class="op" id="6250246">.</span><span class="ident" id="6250247">URL</span>&nbsp;<span class="op" id="6250251">=</span>&nbsp;<span class="builtinfunc" id="6250253">new</span><span class="op" id="6250256">(</span><span class="ident" id="6250257"><a href="/net/http/httputil/dump.go.html#6248086">url</a></span><span class="op" id="6250260">.</span><span class="ident" id="6250261">URL</span><span class="op" id="6250264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6250268">*</span><span class="ident" id="6250269"><a href="/net/http/httputil/dump.go.html#6250142">reqSend</a></span><span class="op" id="6250276">.</span><span class="ident" id="6250277">URL</span>&nbsp;<span class="op" id="6250281">=</span>&nbsp;<span class="op" id="6250283">*</span><span class="ident" id="6250284"><a href="/net/http/httputil/dump.go.html#6249499">req</a></span><span class="op" id="6250287">.</span><span class="ident" id="6250288">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250294"><a href="/net/http/httputil/dump.go.html#6250142">reqSend</a></span><span class="op" id="6250301">.</span><span class="ident" id="6250302">URL</span><span class="op" id="6250305">.</span><span class="ident" id="6250306">Scheme</span>&nbsp;<span class="op" id="6250313">=</span>&nbsp;<span class="string" id="6250315">&#34;http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6250323">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250327">//&nbsp;Use&nbsp;the&nbsp;actual&nbsp;Transport&nbsp;code&nbsp;to&nbsp;record&nbsp;what&nbsp;we&nbsp;would&nbsp;send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250390">//&nbsp;on&nbsp;the&nbsp;wire,&nbsp;but&nbsp;not&nbsp;using&nbsp;TCP.&nbsp;&nbsp;Use&nbsp;a&nbsp;Transport&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250450">//&nbsp;custom&nbsp;dialer&nbsp;that&nbsp;returns&nbsp;a&nbsp;fake&nbsp;net.Conn&nbsp;that&nbsp;waits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250508">//&nbsp;for&nbsp;the&nbsp;full&nbsp;input&nbsp;(and&nbsp;recording&nbsp;it),&nbsp;and&nbsp;then&nbsp;responds</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250569">//&nbsp;with&nbsp;a&nbsp;dummy&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250596">var</span>&nbsp;<span class="ident" id="6250600">buf</span>&nbsp;<span class="ident" id="6250604"><a href="/net/http/httputil/dump.go.html#6248022">bytes</a></span><span class="op" id="6250609">.</span><span class="ident" id="6250610">Buffer</span>&nbsp;<span class="comment" id="6250617">//&nbsp;records&nbsp;the&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250640">pr</span><span class="op" id="6250642">,</span>&nbsp;<span class="ident" id="6250644">pw</span>&nbsp;<span class="op" id="6250647">:=</span>&nbsp;<span class="ident" id="6250650"><a href="/net/http/httputil/dump.go.html#6248048">io</a></span><span class="op" id="6250652">.</span><span class="ident" id="6250653">Pipe</span><span class="op" id="6250657">(</span><span class="op" id="6250658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250661">defer</span>&nbsp;<span class="ident" id="6250667"><a href="/net/http/httputil/dump.go.html#6250640">pr</a></span><span class="op" id="6250669">.</span><span class="ident" id="6250670">Close</span><span class="op" id="6250675">(</span><span class="op" id="6250676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250679">defer</span>&nbsp;<span class="ident" id="6250685"><a href="/net/http/httputil/dump.go.html#6250644">pw</a></span><span class="op" id="6250687">.</span><span class="ident" id="6250688">Close</span><span class="op" id="6250693">(</span><span class="op" id="6250694">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250697">dr</span>&nbsp;<span class="op" id="6250700">:=</span>&nbsp;<span class="op" id="6250703">&amp;</span><span class="ident" id="6250704"><a href="/net/http/httputil/dump.go.html#6251883">delegateReader</a></span><span class="op" id="6250718">{</span><span class="ident" id="6250719">c</span><span class="op" id="6250720">:</span>&nbsp;<span class="builtinfunc" id="6250722">make</span><span class="op" id="6250726">(</span><span class="keyword" id="6250727">chan</span>&nbsp;<span class="ident" id="6250732"><a href="/net/http/httputil/dump.go.html#6248048">io</a></span><span class="op" id="6250734">.</span><span class="ident" id="6250735">Reader</span><span class="op" id="6250741">)</span><span class="op" id="6250742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250745">//&nbsp;Wait&nbsp;for&nbsp;the&nbsp;request&nbsp;before&nbsp;replying&nbsp;with&nbsp;a&nbsp;dummy&nbsp;response:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250809">go</span>&nbsp;<span class="keyword" id="6250812">func</span><span class="op" id="6250816">(</span><span class="op" id="6250817">)</span>&nbsp;<span class="op" id="6250819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250823">req</span><span class="op" id="6250826">,</span>&nbsp;<span class="ident" id="6250828">err</span>&nbsp;<span class="op" id="6250832">:=</span>&nbsp;<span class="ident" id="6250835"><a href="/net/http/httputil/dump.go.html#6248074">http</a></span><span class="op" id="6250839">.</span><span class="ident" id="6250840">ReadRequest</span><span class="op" id="6250851">(</span><span class="ident" id="6250852"><a href="/net/http/httputil/dump.go.html#6248013">bufio</a></span><span class="op" id="6250857">.</span><span class="ident" id="6250858">NewReader</span><span class="op" id="6250867">(</span><span class="ident" id="6250868"><a href="/net/http/httputil/dump.go.html#6250640">pr</a></span><span class="op" id="6250870">)</span><span class="op" id="6250871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250875">if</span>&nbsp;<span class="ident" id="6250878"><a href="/net/http/httputil/dump.go.html#6250828">err</a></span>&nbsp;<span class="op" id="6250882">==</span>&nbsp;<span class="ident" id="6250885">nil</span>&nbsp;<span class="op" id="6250889">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250894">//&nbsp;Ensure&nbsp;all&nbsp;the&nbsp;body&nbsp;is&nbsp;read;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250939">//&nbsp;we&#39;ll&nbsp;get&nbsp;a&nbsp;partial&nbsp;dump.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6250971"><a href="/net/http/httputil/dump.go.html#6248048">io</a></span><span class="op" id="6250973">.</span><span class="ident" id="6250974">Copy</span><span class="op" id="6250978">(</span><span class="ident" id="6250979"><a href="/net/http/httputil/dump.go.html#6248054">ioutil</a></span><span class="op" id="6250985">.</span><span class="ident" id="6250986">Discard</span><span class="op" id="6250993">,</span>&nbsp;<span class="ident" id="6250995"><a href="/net/http/httputil/dump.go.html#6250823">req</a></span><span class="op" id="6250998">.</span><span class="ident" id="6250999">Body</span><span class="op" id="6251003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251008"><a href="/net/http/httputil/dump.go.html#6250823">req</a></span><span class="op" id="6251011">.</span><span class="ident" id="6251012">Body</span><span class="op" id="6251016">.</span><span class="ident" id="6251017">Close</span><span class="op" id="6251022">(</span><span class="op" id="6251023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6251027">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251031"><a href="/net/http/httputil/dump.go.html#6250697">dr</a></span><span class="op" id="6251033">.</span><span class="ident" id="6251034">c</span>&nbsp;<span class="op" id="6251036">&lt;-</span>&nbsp;<span class="ident" id="6251039"><a href="/net/http/httputil/dump.go.html#6248097">strings</a></span><span class="op" id="6251046">.</span><span class="ident" id="6251047">NewReader</span><span class="op" id="6251056">(</span><span class="string" id="6251057">&#34;HTTP/1.1&nbsp;204&nbsp;No&nbsp;Content\r\n\r\n&#34;</span><span class="op" id="6251090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6251093">}</span><span class="op" id="6251094">(</span><span class="op" id="6251095">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251099">t</span>&nbsp;<span class="op" id="6251101">:=</span>&nbsp;<span class="op" id="6251104">&amp;</span><span class="ident" id="6251105"><a href="/net/http/httputil/dump.go.html#6248074">http</a></span><span class="op" id="6251109">.</span><span class="ident" id="6251110">Transport</span><span class="op" id="6251119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251123">DisableKeepAlives</span><span class="op" id="6251140">:</span>&nbsp;<span class="ident" id="6251142">true</span><span class="op" id="6251146">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251150">Dial</span><span class="op" id="6251154">:</span>&nbsp;<span class="keyword" id="6251156">func</span><span class="op" id="6251160">(</span><span class="ident" id="6251161">net</span><span class="op" id="6251164">,</span>&nbsp;<span class="ident" id="6251166">addr</span>&nbsp;<span class="builtintype" id="6251171">string</span><span class="op" id="6251177">)</span>&nbsp;<span class="op" id="6251179">(</span><span class="ident" id="6251180"><a href="/net/http/httputil/dump.go.html#6248067">net</a></span><span class="op" id="6251183">.</span><span class="ident" id="6251184">Conn</span><span class="op" id="6251188">,</span>&nbsp;<span class="builtintype" id="6251190">error</span><span class="op" id="6251195">)</span>&nbsp;<span class="op" id="6251197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251202">return</span>&nbsp;<span class="op" id="6251209">&amp;</span><span class="ident" id="6251210"><a href="/net/http/httputil/dump.go.html#6248748">dumpConn</a></span><span class="op" id="6251218">{</span><span class="ident" id="6251219"><a href="/net/http/httputil/dump.go.html#6248048">io</a></span><span class="op" id="6251221">.</span><span class="ident" id="6251222">MultiWriter</span><span class="op" id="6251233">(</span><span class="op" id="6251234">&amp;</span><span class="ident" id="6251235"><a href="/net/http/httputil/dump.go.html#6250600">buf</a></span><span class="op" id="6251238">,</span>&nbsp;<span class="ident" id="6251240"><a href="/net/http/httputil/dump.go.html#6250644">pw</a></span><span class="op" id="6251242">)</span><span class="op" id="6251243">,</span>&nbsp;<span class="ident" id="6251245"><a href="/net/http/httputil/dump.go.html#6250697">dr</a></span><span class="op" id="6251247">}</span><span class="op" id="6251248">,</span>&nbsp;<span class="ident" id="6251250">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6251256">}</span><span class="op" id="6251257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6251260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251264">_</span><span class="op" id="6251265">,</span>&nbsp;<span class="ident" id="6251267">err</span>&nbsp;<span class="op" id="6251271">:=</span>&nbsp;<span class="ident" id="6251274"><a href="/net/http/httputil/dump.go.html#6251099">t</a></span><span class="op" id="6251275">.</span><span class="ident" id="6251276">RoundTrip</span><span class="op" id="6251285">(</span><span class="ident" id="6251286"><a href="/net/http/httputil/dump.go.html#6250142">reqSend</a></span><span class="op" id="6251293">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251297"><a href="/net/http/httputil/dump.go.html#6249499">req</a></span><span class="op" id="6251300">.</span><span class="ident" id="6251301">Body</span>&nbsp;<span class="op" id="6251306">=</span>&nbsp;<span class="ident" id="6251308"><a href="/net/http/httputil/dump.go.html#6249548">save</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251314">if</span>&nbsp;<span class="ident" id="6251317"><a href="/net/http/httputil/dump.go.html#6251267">err</a></span>&nbsp;<span class="op" id="6251321">!=</span>&nbsp;<span class="ident" id="6251324">nil</span>&nbsp;<span class="op" id="6251328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251332">return</span>&nbsp;<span class="ident" id="6251339">nil</span><span class="op" id="6251342">,</span>&nbsp;<span class="ident" id="6251344"><a href="/net/http/httputil/dump.go.html#6251267">err</a></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6251349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251352">dump</span>&nbsp;<span class="op" id="6251357">:=</span>&nbsp;<span class="ident" id="6251360"><a href="/net/http/httputil/dump.go.html#6250600">buf</a></span><span class="op" id="6251363">.</span><span class="ident" id="6251364">Bytes</span><span class="op" id="6251369">(</span><span class="op" id="6251370">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251374">//&nbsp;If&nbsp;we&nbsp;used&nbsp;a&nbsp;dummy&nbsp;body&nbsp;above,&nbsp;remove&nbsp;it&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251424">//&nbsp;TODO:&nbsp;if&nbsp;the&nbsp;req.ContentLength&nbsp;is&nbsp;large,&nbsp;we&nbsp;allocate&nbsp;memory</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251488">//&nbsp;unnecessarily&nbsp;just&nbsp;to&nbsp;slice&nbsp;it&nbsp;off&nbsp;here.&nbsp;&nbsp;But&nbsp;this&nbsp;is&nbsp;just</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251551">//&nbsp;a&nbsp;debug&nbsp;function,&nbsp;so&nbsp;this&nbsp;is&nbsp;acceptable&nbsp;for&nbsp;now.&nbsp;We&nbsp;could</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251613">//&nbsp;discard&nbsp;the&nbsp;body&nbsp;earlier&nbsp;if&nbsp;this&nbsp;matters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251659">if</span>&nbsp;<span class="ident" id="6251662"><a href="/net/http/httputil/dump.go.html#6249566">dummyBody</a></span>&nbsp;<span class="op" id="6251672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251676">if</span>&nbsp;<span class="ident" id="6251679">i</span>&nbsp;<span class="op" id="6251681">:=</span>&nbsp;<span class="ident" id="6251684"><a href="/net/http/httputil/dump.go.html#6248022">bytes</a></span><span class="op" id="6251689">.</span><span class="ident" id="6251690">Index</span><span class="op" id="6251695">(</span><span class="ident" id="6251696"><a href="/net/http/httputil/dump.go.html#6251352">dump</a></span><span class="op" id="6251700">,</span>&nbsp;<span class="op" id="6251702">[</span><span class="op" id="6251703">]</span><span class="builtintype" id="6251704">byte</span><span class="op" id="6251708">(</span><span class="string" id="6251709">&#34;\r\n\r\n&#34;</span><span class="op" id="6251719">)</span><span class="op" id="6251720">)</span><span class="op" id="6251721">;</span>&nbsp;<span class="ident" id="6251723"><a href="/net/http/httputil/dump.go.html#6251679">i</a></span>&nbsp;<span class="op" id="6251725">&gt;=</span>&nbsp;<span class="num" id="6251728">0</span>&nbsp;<span class="op" id="6251730">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251735"><a href="/net/http/httputil/dump.go.html#6251352">dump</a></span>&nbsp;<span class="op" id="6251740">=</span>&nbsp;<span class="ident" id="6251742"><a href="/net/http/httputil/dump.go.html#6251352">dump</a></span><span class="op" id="6251746">[</span><span class="op" id="6251747">:</span><span class="ident" id="6251748"><a href="/net/http/httputil/dump.go.html#6251679">i</a></span><span class="op" id="6251749">+</span><span class="num" id="6251750">4</span><span class="op" id="6251751">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6251755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6251758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251761">return</span>&nbsp;<span class="ident" id="6251768"><a href="/net/http/httputil/dump.go.html#6251352">dump</a></span><span class="op" id="6251772">,</span>&nbsp;<span class="ident" id="6251774">nil</span><br>
<span class="lineno"></span><span class="op" id="6251778">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="6251781">//&nbsp;delegateReader&nbsp;is&nbsp;a&nbsp;reader&nbsp;that&nbsp;delegates&nbsp;to&nbsp;another&nbsp;reader,</span><br>
<span class="lineno"></span><span class="comment" id="6251845">//&nbsp;once&nbsp;it&nbsp;arrives&nbsp;on&nbsp;a&nbsp;channel.</span><br>
<span class="lineno"></span><span class="keyword" id="6251878">type</span>&nbsp;<span class="ident" id="6251883">delegateReader</span>&nbsp;<span class="keyword" id="6251898">struct</span>&nbsp;<span class="op" id="6251905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251908">c</span>&nbsp;<span class="keyword" id="6251910">chan</span>&nbsp;<span class="ident" id="6251915"><a href="/net/http/httputil/dump.go.html#6248048">io</a></span><span class="op" id="6251917">.</span><span class="ident" id="6251918">Reader</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251926">r</span>&nbsp;<span class="ident" id="6251928"><a href="/net/http/httputil/dump.go.html#6248048">io</a></span><span class="op" id="6251930">.</span><span class="ident" id="6251931">Reader</span>&nbsp;<span class="comment" id="6251938">//&nbsp;nil&nbsp;until&nbsp;received&nbsp;from&nbsp;c</span><br>
<span class="lineno"></span><span class="op" id="6251967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6251970">func</span>&nbsp;<span class="op" id="6251975">(</span><span class="ident" id="6251976">r</span>&nbsp;<span class="op" id="6251978">*</span><span class="ident" id="6251979"><a href="/net/http/httputil/dump.go.html#6251883">delegateReader</a></span><span class="op" id="6251993">)</span>&nbsp;<span class="ident" id="6251995">Read</span><span class="op" id="6251999">(</span><span class="ident" id="6252000">p</span>&nbsp;<span class="op" id="6252002">[</span><span class="op" id="6252003">]</span><span class="builtintype" id="6252004">byte</span><span class="op" id="6252008">)</span>&nbsp;<span class="op" id="6252010">(</span><span class="builtintype" id="6252011">int</span><span class="op" id="6252014">,</span>&nbsp;<span class="builtintype" id="6252016">error</span><span class="op" id="6252021">)</span>&nbsp;<span class="op" id="6252023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252026">if</span>&nbsp;<span class="ident" id="6252029"><a href="/net/http/httputil/dump.go.html#6251976">r</a></span><span class="op" id="6252030">.</span><span class="ident" id="6252031">r</span>&nbsp;<span class="op" id="6252033">==</span>&nbsp;<span class="ident" id="6252036">nil</span>&nbsp;<span class="op" id="6252040">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6252044"><a href="/net/http/httputil/dump.go.html#6251976">r</a></span><span class="op" id="6252045">.</span><span class="ident" id="6252046">r</span>&nbsp;<span class="op" id="6252048">=</span>&nbsp;<span class="op" id="6252050">&lt;-</span><span class="ident" id="6252052"><a href="/net/http/httputil/dump.go.html#6251976">r</a></span><span class="op" id="6252053">.</span><span class="ident" id="6252054">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6252057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252060">return</span>&nbsp;<span class="ident" id="6252067"><a href="/net/http/httputil/dump.go.html#6251976">r</a></span><span class="op" id="6252068">.</span><span class="ident" id="6252069">r</span><span class="op" id="6252070">.</span><span class="ident" id="6252071">Read</span><span class="op" id="6252075">(</span><span class="ident" id="6252076"><a href="/net/http/httputil/dump.go.html#6252000">p</a></span><span class="op" id="6252077">)</span><br>
<span class="lineno"></span><span class="op" id="6252079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="6252082">//&nbsp;Return&nbsp;value&nbsp;if&nbsp;nonempty,&nbsp;def&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="6252126">func</span>&nbsp;<span class="ident" id="6252131">valueOrDefault</span><span class="op" id="6252145">(</span><span class="ident" id="6252146">value</span><span class="op" id="6252151">,</span>&nbsp;<span class="ident" id="6252153">def</span>&nbsp;<span class="builtintype" id="6252157">string</span><span class="op" id="6252163">)</span>&nbsp;<span class="builtintype" id="6252165">string</span>&nbsp;<span class="op" id="6252172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252175">if</span>&nbsp;<span class="ident" id="6252178"><a href="/net/http/httputil/dump.go.html#6252146">value</a></span>&nbsp;<span class="op" id="6252184">!=</span>&nbsp;<span class="string" id="6252187">&#34;&#34;</span>&nbsp;<span class="op" id="6252190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252194">return</span>&nbsp;<span class="ident" id="6252201"><a href="/net/http/httputil/dump.go.html#6252146">value</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6252208">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252211">return</span>&nbsp;<span class="ident" id="6252218"><a href="/net/http/httputil/dump.go.html#6252153">def</a></span><br>
<span class="lineno"></span><span class="op" id="6252222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6252225">var</span>&nbsp;<span class="ident" id="6252229">reqWriteExcludeHeaderDump</span>&nbsp;<span class="op" id="6252255">=</span>&nbsp;<span class="keyword" id="6252257">map</span><span class="op" id="6252260">[</span><span class="builtintype" id="6252261">string</span><span class="op" id="6252267">]</span><span class="builtintype" id="6252268">bool</span><span class="op" id="6252272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6252275">&#34;Host&#34;</span><span class="op" id="6252281">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6252296">true</span><span class="op" id="6252300">,</span>&nbsp;<span class="comment" id="6252302">//&nbsp;not&nbsp;in&nbsp;Header&nbsp;map&nbsp;anyway</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6252331">&#34;Content-Length&#34;</span><span class="op" id="6252347">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6252352">true</span><span class="op" id="6252356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6252359">&#34;Transfer-Encoding&#34;</span><span class="op" id="6252378">:</span>&nbsp;<span class="ident" id="6252380">true</span><span class="op" id="6252384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6252387">&#34;Trailer&#34;</span><span class="op" id="6252396">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6252408">true</span><span class="op" id="6252412">,</span><br>
<span class="lineno"></span><span class="op" id="6252414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="6252417">//&nbsp;dumpAsReceived&nbsp;writes&nbsp;req&nbsp;to&nbsp;w&nbsp;in&nbsp;the&nbsp;form&nbsp;as&nbsp;it&nbsp;was&nbsp;received,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6252486">//&nbsp;at&nbsp;least&nbsp;as&nbsp;accurately&nbsp;as&nbsp;possible&nbsp;from&nbsp;the&nbsp;information&nbsp;retained&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6252557">//&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="6252573">func</span>&nbsp;<span class="ident" id="6252578">dumpAsReceived</span><span class="op" id="6252592">(</span><span class="ident" id="6252593">req</span>&nbsp;<span class="op" id="6252597">*</span><span class="ident" id="6252598"><a href="/net/http/httputil/dump.go.html#6248074">http</a></span><span class="op" id="6252602">.</span><span class="ident" id="6252603">Request</span><span class="op" id="6252610">,</span>&nbsp;<span class="ident" id="6252612">w</span>&nbsp;<span class="ident" id="6252614"><a href="/net/http/httputil/dump.go.html#6248048">io</a></span><span class="op" id="6252616">.</span><span class="ident" id="6252617">Writer</span><span class="op" id="6252623">)</span>&nbsp;<span class="builtintype" id="6252625">error</span>&nbsp;<span class="op" id="6252631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6252634">return</span>&nbsp;<span class="ident" id="6252641">nil</span><br>
<span class="lineno">175</span><span class="op" id="6252645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6252648">//&nbsp;DumpRequest&nbsp;returns&nbsp;the&nbsp;as-received&nbsp;wire&nbsp;representation&nbsp;of&nbsp;req,</span><br>
<span class="lineno"></span><span class="comment" id="6252715">//&nbsp;optionally&nbsp;including&nbsp;the&nbsp;request&nbsp;body,&nbsp;for&nbsp;debugging.</span><br>
<span class="lineno"></span><span class="comment" id="6252772">//&nbsp;DumpRequest&nbsp;is&nbsp;semantically&nbsp;a&nbsp;no-op,&nbsp;but&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">180</span><span class="comment" id="6252828">//&nbsp;dump&nbsp;the&nbsp;body,&nbsp;it&nbsp;reads&nbsp;the&nbsp;body&nbsp;data&nbsp;into&nbsp;memory&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6252885">//&nbsp;changes&nbsp;req.Body&nbsp;to&nbsp;refer&nbsp;to&nbsp;the&nbsp;in-memory&nbsp;copy.</span><br>
<span class="lineno"></span><span class="comment" id="6252937">//&nbsp;The&nbsp;documentation&nbsp;for&nbsp;http.Request.Write&nbsp;details&nbsp;which&nbsp;fields</span><br>
<span class="lineno"></span><span class="comment" id="6253002">//&nbsp;of&nbsp;req&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="6253022">func</span>&nbsp;<span class="ident" id="6253027">DumpRequest</span><span class="op" id="6253038">(</span><span class="ident" id="6253039">req</span>&nbsp;<span class="op" id="6253043">*</span><span class="ident" id="6253044"><a href="/net/http/httputil/dump.go.html#6248074">http</a></span><span class="op" id="6253048">.</span><span class="ident" id="6253049">Request</span><span class="op" id="6253056">,</span>&nbsp;<span class="ident" id="6253058">body</span>&nbsp;<span class="builtintype" id="6253063">bool</span><span class="op" id="6253067">)</span>&nbsp;<span class="op" id="6253069">(</span><span class="ident" id="6253070">dump</span>&nbsp;<span class="op" id="6253075">[</span><span class="op" id="6253076">]</span><span class="builtintype" id="6253077">byte</span><span class="op" id="6253081">,</span>&nbsp;<span class="ident" id="6253083">err</span>&nbsp;<span class="builtintype" id="6253087">error</span><span class="op" id="6253092">)</span>&nbsp;<span class="op" id="6253094">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253097">save</span>&nbsp;<span class="op" id="6253102">:=</span>&nbsp;<span class="ident" id="6253105"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253108">.</span><span class="ident" id="6253109">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253115">if</span>&nbsp;<span class="op" id="6253118">!</span><span class="ident" id="6253119"><a href="/net/http/httputil/dump.go.html#6253058">body</a></span>&nbsp;<span class="op" id="6253124">||</span>&nbsp;<span class="ident" id="6253127"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253130">.</span><span class="ident" id="6253131">Body</span>&nbsp;<span class="op" id="6253136">==</span>&nbsp;<span class="ident" id="6253139">nil</span>&nbsp;<span class="op" id="6253143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253147"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253150">.</span><span class="ident" id="6253151">Body</span>&nbsp;<span class="op" id="6253156">=</span>&nbsp;<span class="ident" id="6253158">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6253163">}</span>&nbsp;<span class="keyword" id="6253165">else</span>&nbsp;<span class="op" id="6253170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253174"><a href="/net/http/httputil/dump.go.html#6253097">save</a></span><span class="op" id="6253178">,</span>&nbsp;<span class="ident" id="6253180"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253183">.</span><span class="ident" id="6253184">Body</span><span class="op" id="6253188">,</span>&nbsp;<span class="ident" id="6253190"><a href="/net/http/httputil/dump.go.html#6253083">err</a></span>&nbsp;<span class="op" id="6253194">=</span>&nbsp;<span class="ident" id="6253196"><a href="/net/http/httputil/dump.go.html#6248371">drainBody</a></span><span class="op" id="6253205">(</span><span class="ident" id="6253206"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253209">.</span><span class="ident" id="6253210">Body</span><span class="op" id="6253214">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253218">if</span>&nbsp;<span class="ident" id="6253221"><a href="/net/http/httputil/dump.go.html#6253083">err</a></span>&nbsp;<span class="op" id="6253225">!=</span>&nbsp;<span class="ident" id="6253228">nil</span>&nbsp;<span class="op" id="6253232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253237">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6253246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6253249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253253">var</span>&nbsp;<span class="ident" id="6253257">b</span>&nbsp;<span class="ident" id="6253259"><a href="/net/http/httputil/dump.go.html#6248022">bytes</a></span><span class="op" id="6253264">.</span><span class="ident" id="6253265">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253274"><a href="/net/http/httputil/dump.go.html#6248041">fmt</a></span><span class="op" id="6253277">.</span><span class="ident" id="6253278">Fprintf</span><span class="op" id="6253285">(</span><span class="op" id="6253286">&amp;</span><span class="ident" id="6253287"><a href="/net/http/httputil/dump.go.html#6253257">b</a></span><span class="op" id="6253288">,</span>&nbsp;<span class="string" id="6253290">&#34;%s&nbsp;%s&nbsp;HTTP/%d.%d\r\n&#34;</span><span class="op" id="6253312">,</span>&nbsp;<span class="ident" id="6253314"><a href="/net/http/httputil/dump.go.html#6252131">valueOrDefault</a></span><span class="op" id="6253328">(</span><span class="ident" id="6253329"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253332">.</span><span class="ident" id="6253333">Method</span><span class="op" id="6253339">,</span>&nbsp;<span class="string" id="6253341">&#34;GET&#34;</span><span class="op" id="6253346">)</span><span class="op" id="6253347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253351"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253354">.</span><span class="ident" id="6253355">URL</span><span class="op" id="6253358">.</span><span class="ident" id="6253359">RequestURI</span><span class="op" id="6253369">(</span><span class="op" id="6253370">)</span><span class="op" id="6253371">,</span>&nbsp;<span class="ident" id="6253373"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253376">.</span><span class="ident" id="6253377">ProtoMajor</span><span class="op" id="6253387">,</span>&nbsp;<span class="ident" id="6253389"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253392">.</span><span class="ident" id="6253393">ProtoMinor</span><span class="op" id="6253403">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253407">host</span>&nbsp;<span class="op" id="6253412">:=</span>&nbsp;<span class="ident" id="6253415"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253418">.</span><span class="ident" id="6253419">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253425">if</span>&nbsp;<span class="ident" id="6253428"><a href="/net/http/httputil/dump.go.html#6253407">host</a></span>&nbsp;<span class="op" id="6253433">==</span>&nbsp;<span class="string" id="6253436">&#34;&#34;</span>&nbsp;<span class="op" id="6253439">&amp;&amp;</span>&nbsp;<span class="ident" id="6253442"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253445">.</span><span class="ident" id="6253446">URL</span>&nbsp;<span class="op" id="6253450">!=</span>&nbsp;<span class="ident" id="6253453">nil</span>&nbsp;<span class="op" id="6253457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253461"><a href="/net/http/httputil/dump.go.html#6253407">host</a></span>&nbsp;<span class="op" id="6253466">=</span>&nbsp;<span class="ident" id="6253468"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253471">.</span><span class="ident" id="6253472">URL</span><span class="op" id="6253475">.</span><span class="ident" id="6253476">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6253482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253485">if</span>&nbsp;<span class="ident" id="6253488"><a href="/net/http/httputil/dump.go.html#6253407">host</a></span>&nbsp;<span class="op" id="6253493">!=</span>&nbsp;<span class="string" id="6253496">&#34;&#34;</span>&nbsp;<span class="op" id="6253499">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253503"><a href="/net/http/httputil/dump.go.html#6248041">fmt</a></span><span class="op" id="6253506">.</span><span class="ident" id="6253507">Fprintf</span><span class="op" id="6253514">(</span><span class="op" id="6253515">&amp;</span><span class="ident" id="6253516"><a href="/net/http/httputil/dump.go.html#6253257">b</a></span><span class="op" id="6253517">,</span>&nbsp;<span class="string" id="6253519">&#34;Host:&nbsp;%s\r\n&#34;</span><span class="op" id="6253533">,</span>&nbsp;<span class="ident" id="6253535"><a href="/net/http/httputil/dump.go.html#6253407">host</a></span><span class="op" id="6253539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6253542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253546">chunked</span>&nbsp;<span class="op" id="6253554">:=</span>&nbsp;<span class="builtinfunc" id="6253557">len</span><span class="op" id="6253560">(</span><span class="ident" id="6253561"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253564">.</span><span class="ident" id="6253565">TransferEncoding</span><span class="op" id="6253581">)</span>&nbsp;<span class="op" id="6253583">&gt;</span>&nbsp;<span class="num" id="6253585">0</span>&nbsp;<span class="op" id="6253587">&amp;&amp;</span>&nbsp;<span class="ident" id="6253590"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253593">.</span><span class="ident" id="6253594">TransferEncoding</span><span class="op" id="6253610">[</span><span class="num" id="6253611">0</span><span class="op" id="6253612">]</span>&nbsp;<span class="op" id="6253614">==</span>&nbsp;<span class="string" id="6253617">&#34;chunked&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253628">if</span>&nbsp;<span class="builtinfunc" id="6253631">len</span><span class="op" id="6253634">(</span><span class="ident" id="6253635"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253638">.</span><span class="ident" id="6253639">TransferEncoding</span><span class="op" id="6253655">)</span>&nbsp;<span class="op" id="6253657">&gt;</span>&nbsp;<span class="num" id="6253659">0</span>&nbsp;<span class="op" id="6253661">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253665"><a href="/net/http/httputil/dump.go.html#6248041">fmt</a></span><span class="op" id="6253668">.</span><span class="ident" id="6253669">Fprintf</span><span class="op" id="6253676">(</span><span class="op" id="6253677">&amp;</span><span class="ident" id="6253678"><a href="/net/http/httputil/dump.go.html#6253257">b</a></span><span class="op" id="6253679">,</span>&nbsp;<span class="string" id="6253681">&#34;Transfer-Encoding:&nbsp;%s\r\n&#34;</span><span class="op" id="6253708">,</span>&nbsp;<span class="ident" id="6253710"><a href="/net/http/httputil/dump.go.html#6248097">strings</a></span><span class="op" id="6253717">.</span><span class="ident" id="6253718">Join</span><span class="op" id="6253722">(</span><span class="ident" id="6253723"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253726">.</span><span class="ident" id="6253727">TransferEncoding</span><span class="op" id="6253743">,</span>&nbsp;<span class="string" id="6253745">&#34;,&#34;</span><span class="op" id="6253748">)</span><span class="op" id="6253749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6253752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253755">if</span>&nbsp;<span class="ident" id="6253758"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253761">.</span><span class="ident" id="6253762">Close</span>&nbsp;<span class="op" id="6253768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253772"><a href="/net/http/httputil/dump.go.html#6248041">fmt</a></span><span class="op" id="6253775">.</span><span class="ident" id="6253776">Fprintf</span><span class="op" id="6253783">(</span><span class="op" id="6253784">&amp;</span><span class="ident" id="6253785"><a href="/net/http/httputil/dump.go.html#6253257">b</a></span><span class="op" id="6253786">,</span>&nbsp;<span class="string" id="6253788">&#34;Connection:&nbsp;close\r\n&#34;</span><span class="op" id="6253811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6253814">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253818"><a href="/net/http/httputil/dump.go.html#6253083">err</a></span>&nbsp;<span class="op" id="6253822">=</span>&nbsp;<span class="ident" id="6253824"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253827">.</span><span class="ident" id="6253828">Header</span><span class="op" id="6253834">.</span><span class="ident" id="6253835">WriteSubset</span><span class="op" id="6253846">(</span><span class="op" id="6253847">&amp;</span><span class="ident" id="6253848"><a href="/net/http/httputil/dump.go.html#6253257">b</a></span><span class="op" id="6253849">,</span>&nbsp;<span class="ident" id="6253851"><a href="/net/http/httputil/dump.go.html#6252229">reqWriteExcludeHeaderDump</a></span><span class="op" id="6253876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253879">if</span>&nbsp;<span class="ident" id="6253882"><a href="/net/http/httputil/dump.go.html#6253083">err</a></span>&nbsp;<span class="op" id="6253886">!=</span>&nbsp;<span class="ident" id="6253889">nil</span>&nbsp;<span class="op" id="6253893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253897">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6253905">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6253909"><a href="/net/http/httputil/dump.go.html#6248048">io</a></span><span class="op" id="6253911">.</span><span class="ident" id="6253912">WriteString</span><span class="op" id="6253923">(</span><span class="op" id="6253924">&amp;</span><span class="ident" id="6253925"><a href="/net/http/httputil/dump.go.html#6253257">b</a></span><span class="op" id="6253926">,</span>&nbsp;<span class="string" id="6253928">&#34;\r\n&#34;</span><span class="op" id="6253934">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253938">if</span>&nbsp;<span class="ident" id="6253941"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6253944">.</span><span class="ident" id="6253945">Body</span>&nbsp;<span class="op" id="6253950">!=</span>&nbsp;<span class="ident" id="6253953">nil</span>&nbsp;<span class="op" id="6253957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253961">var</span>&nbsp;<span class="ident" id="6253965">dest</span>&nbsp;<span class="ident" id="6253970"><a href="/net/http/httputil/dump.go.html#6248048">io</a></span><span class="op" id="6253972">.</span><span class="ident" id="6253973">Writer</span>&nbsp;<span class="op" id="6253980">=</span>&nbsp;<span class="op" id="6253982">&amp;</span><span class="ident" id="6253983"><a href="/net/http/httputil/dump.go.html#6253257">b</a></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6253987">if</span>&nbsp;<span class="ident" id="6253990"><a href="/net/http/httputil/dump.go.html#6253546">chunked</a></span>&nbsp;<span class="op" id="6253998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254003"><a href="/net/http/httputil/dump.go.html#6253965">dest</a></span>&nbsp;<span class="op" id="6254008">=</span>&nbsp;<span class="ident" id="6254010"><a href="/net/http/httputil/httputil.go.html#6256756">NewChunkedWriter</a></span><span class="op" id="6254026">(</span><span class="ident" id="6254027"><a href="/net/http/httputil/dump.go.html#6253965">dest</a></span><span class="op" id="6254031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6254035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254039">_</span><span class="op" id="6254040">,</span>&nbsp;<span class="ident" id="6254042"><a href="/net/http/httputil/dump.go.html#6253083">err</a></span>&nbsp;<span class="op" id="6254046">=</span>&nbsp;<span class="ident" id="6254048"><a href="/net/http/httputil/dump.go.html#6248048">io</a></span><span class="op" id="6254050">.</span><span class="ident" id="6254051">Copy</span><span class="op" id="6254055">(</span><span class="ident" id="6254056"><a href="/net/http/httputil/dump.go.html#6253965">dest</a></span><span class="op" id="6254060">,</span>&nbsp;<span class="ident" id="6254062"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6254065">.</span><span class="ident" id="6254066">Body</span><span class="op" id="6254070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6254074">if</span>&nbsp;<span class="ident" id="6254077"><a href="/net/http/httputil/dump.go.html#6253546">chunked</a></span>&nbsp;<span class="op" id="6254085">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254090"><a href="/net/http/httputil/dump.go.html#6253965">dest</a></span><span class="op" id="6254094">.</span><span class="op" id="6254095">(</span><span class="ident" id="6254096"><a href="/net/http/httputil/dump.go.html#6248048">io</a></span><span class="op" id="6254098">.</span><span class="ident" id="6254099">Closer</span><span class="op" id="6254105">)</span><span class="op" id="6254106">.</span><span class="ident" id="6254107">Close</span><span class="op" id="6254112">(</span><span class="op" id="6254113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254118"><a href="/net/http/httputil/dump.go.html#6248048">io</a></span><span class="op" id="6254120">.</span><span class="ident" id="6254121">WriteString</span><span class="op" id="6254132">(</span><span class="op" id="6254133">&amp;</span><span class="ident" id="6254134"><a href="/net/http/httputil/dump.go.html#6253257">b</a></span><span class="op" id="6254135">,</span>&nbsp;<span class="string" id="6254137">&#34;\r\n&#34;</span><span class="op" id="6254143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6254147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6254150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254154"><a href="/net/http/httputil/dump.go.html#6253039">req</a></span><span class="op" id="6254157">.</span><span class="ident" id="6254158">Body</span>&nbsp;<span class="op" id="6254163">=</span>&nbsp;<span class="ident" id="6254165"><a href="/net/http/httputil/dump.go.html#6253097">save</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6254171">if</span>&nbsp;<span class="ident" id="6254174"><a href="/net/http/httputil/dump.go.html#6253083">err</a></span>&nbsp;<span class="op" id="6254178">!=</span>&nbsp;<span class="ident" id="6254181">nil</span>&nbsp;<span class="op" id="6254185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6254189">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6254197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254200"><a href="/net/http/httputil/dump.go.html#6253070">dump</a></span>&nbsp;<span class="op" id="6254205">=</span>&nbsp;<span class="ident" id="6254207"><a href="/net/http/httputil/dump.go.html#6253257">b</a></span><span class="op" id="6254208">.</span><span class="ident" id="6254209">Bytes</span><span class="op" id="6254214">(</span><span class="op" id="6254215">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6254218">return</span><br>
<span class="lineno"></span><span class="op" id="6254225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6254228">//&nbsp;errNoBody&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;error&nbsp;value&nbsp;used&nbsp;by&nbsp;failureToReadBody&nbsp;so&nbsp;we&nbsp;can&nbsp;detect</span><br>
<span class="lineno"></span><span class="comment" id="6254310">//&nbsp;that&nbsp;the&nbsp;lack&nbsp;of&nbsp;body&nbsp;was&nbsp;intentional.</span><br>
<span class="lineno">245</span><span class="keyword" id="6254352">var</span>&nbsp;<span class="ident" id="6254356">errNoBody</span>&nbsp;<span class="op" id="6254366">=</span>&nbsp;<span class="ident" id="6254368"><a href="/net/http/httputil/dump.go.html#6248031">errors</a></span><span class="op" id="6254374">.</span><span class="ident" id="6254375">New</span><span class="op" id="6254378">(</span><span class="string" id="6254379">&#34;sentinel&nbsp;error&nbsp;value&#34;</span><span class="op" id="6254401">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6254404">//&nbsp;failureToReadBody&nbsp;is&nbsp;a&nbsp;io.ReadCloser&nbsp;that&nbsp;just&nbsp;returns&nbsp;errNoBody&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="6254475">//&nbsp;Read.&nbsp;&nbsp;It&#39;s&nbsp;swapped&nbsp;in&nbsp;when&nbsp;we&nbsp;don&#39;t&nbsp;actually&nbsp;want&nbsp;to&nbsp;consume&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6254544">//&nbsp;body,&nbsp;but&nbsp;need&nbsp;a&nbsp;non-nil&nbsp;one,&nbsp;and&nbsp;want&nbsp;to&nbsp;distinguish&nbsp;the&nbsp;error</span><br>
<span class="lineno">250</span><span class="comment" id="6254611">//&nbsp;from&nbsp;reading&nbsp;the&nbsp;dummy&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="6254643">type</span>&nbsp;<span class="ident" id="6254648">failureToReadBody</span>&nbsp;<span class="keyword" id="6254666">struct</span><span class="op" id="6254672">{</span><span class="op" id="6254673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6254676">func</span>&nbsp;<span class="op" id="6254681">(</span><span class="ident" id="6254682"><a href="/net/http/httputil/dump.go.html#6254648">failureToReadBody</a></span><span class="op" id="6254699">)</span>&nbsp;<span class="ident" id="6254701">Read</span><span class="op" id="6254705">(</span><span class="op" id="6254706">[</span><span class="op" id="6254707">]</span><span class="builtintype" id="6254708">byte</span><span class="op" id="6254712">)</span>&nbsp;<span class="op" id="6254714">(</span><span class="builtintype" id="6254715">int</span><span class="op" id="6254718">,</span>&nbsp;<span class="builtintype" id="6254720">error</span><span class="op" id="6254725">)</span>&nbsp;<span class="op" id="6254727">{</span>&nbsp;<span class="keyword" id="6254729">return</span>&nbsp;<span class="num" id="6254736">0</span><span class="op" id="6254737">,</span>&nbsp;<span class="ident" id="6254739"><a href="/net/http/httputil/dump.go.html#6254356">errNoBody</a></span>&nbsp;<span class="op" id="6254749">}</span><br>
<span class="lineno"></span><span class="keyword" id="6254751">func</span>&nbsp;<span class="op" id="6254756">(</span><span class="ident" id="6254757"><a href="/net/http/httputil/dump.go.html#6254648">failureToReadBody</a></span><span class="op" id="6254774">)</span>&nbsp;<span class="ident" id="6254776">Close</span><span class="op" id="6254781">(</span><span class="op" id="6254782">)</span>&nbsp;<span class="builtintype" id="6254784">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6254802">{</span>&nbsp;<span class="keyword" id="6254804">return</span>&nbsp;<span class="ident" id="6254811">nil</span>&nbsp;<span class="op" id="6254815">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="6254818">var</span>&nbsp;<span class="ident" id="6254822">emptyBody</span>&nbsp;<span class="op" id="6254832">=</span>&nbsp;<span class="ident" id="6254834"><a href="/net/http/httputil/dump.go.html#6248054">ioutil</a></span><span class="op" id="6254840">.</span><span class="ident" id="6254841">NopCloser</span><span class="op" id="6254850">(</span><span class="ident" id="6254851"><a href="/net/http/httputil/dump.go.html#6248097">strings</a></span><span class="op" id="6254858">.</span><span class="ident" id="6254859">NewReader</span><span class="op" id="6254868">(</span><span class="string" id="6254869">&#34;&#34;</span><span class="op" id="6254871">)</span><span class="op" id="6254872">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6254875">//&nbsp;DumpResponse&nbsp;is&nbsp;like&nbsp;DumpRequest&nbsp;but&nbsp;dumps&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span><span class="keyword" id="6254933">func</span>&nbsp;<span class="ident" id="6254938">DumpResponse</span><span class="op" id="6254950">(</span><span class="ident" id="6254951">resp</span>&nbsp;<span class="op" id="6254956">*</span><span class="ident" id="6254957"><a href="/net/http/httputil/dump.go.html#6248074">http</a></span><span class="op" id="6254961">.</span><span class="ident" id="6254962">Response</span><span class="op" id="6254970">,</span>&nbsp;<span class="ident" id="6254972">body</span>&nbsp;<span class="builtintype" id="6254977">bool</span><span class="op" id="6254981">)</span>&nbsp;<span class="op" id="6254983">(</span><span class="ident" id="6254984">dump</span>&nbsp;<span class="op" id="6254989">[</span><span class="op" id="6254990">]</span><span class="builtintype" id="6254991">byte</span><span class="op" id="6254995">,</span>&nbsp;<span class="ident" id="6254997">err</span>&nbsp;<span class="builtintype" id="6255001">error</span><span class="op" id="6255006">)</span>&nbsp;<span class="op" id="6255008">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255011">var</span>&nbsp;<span class="ident" id="6255015">b</span>&nbsp;<span class="ident" id="6255017"><a href="/net/http/httputil/dump.go.html#6248022">bytes</a></span><span class="op" id="6255022">.</span><span class="ident" id="6255023">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255031">save</span>&nbsp;<span class="op" id="6255036">:=</span>&nbsp;<span class="ident" id="6255039"><a href="/net/http/httputil/dump.go.html#6254951">resp</a></span><span class="op" id="6255043">.</span><span class="ident" id="6255044">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255050">savecl</span>&nbsp;<span class="op" id="6255057">:=</span>&nbsp;<span class="ident" id="6255060"><a href="/net/http/httputil/dump.go.html#6254951">resp</a></span><span class="op" id="6255064">.</span><span class="ident" id="6255065">ContentLength</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255081">if</span>&nbsp;<span class="op" id="6255084">!</span><span class="ident" id="6255085"><a href="/net/http/httputil/dump.go.html#6254972">body</a></span>&nbsp;<span class="op" id="6255090">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255094"><a href="/net/http/httputil/dump.go.html#6254951">resp</a></span><span class="op" id="6255098">.</span><span class="ident" id="6255099">Body</span>&nbsp;<span class="op" id="6255104">=</span>&nbsp;<span class="ident" id="6255106"><a href="/net/http/httputil/dump.go.html#6254648">failureToReadBody</a></span><span class="op" id="6255123">{</span><span class="op" id="6255124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6255127">}</span>&nbsp;<span class="keyword" id="6255129">else</span>&nbsp;<span class="keyword" id="6255134">if</span>&nbsp;<span class="ident" id="6255137"><a href="/net/http/httputil/dump.go.html#6254951">resp</a></span><span class="op" id="6255141">.</span><span class="ident" id="6255142">Body</span>&nbsp;<span class="op" id="6255147">==</span>&nbsp;<span class="ident" id="6255150">nil</span>&nbsp;<span class="op" id="6255154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255158"><a href="/net/http/httputil/dump.go.html#6254951">resp</a></span><span class="op" id="6255162">.</span><span class="ident" id="6255163">Body</span>&nbsp;<span class="op" id="6255168">=</span>&nbsp;<span class="ident" id="6255170"><a href="/net/http/httputil/dump.go.html#6254822">emptyBody</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6255181">}</span>&nbsp;<span class="keyword" id="6255183">else</span>&nbsp;<span class="op" id="6255188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255192"><a href="/net/http/httputil/dump.go.html#6255031">save</a></span><span class="op" id="6255196">,</span>&nbsp;<span class="ident" id="6255198"><a href="/net/http/httputil/dump.go.html#6254951">resp</a></span><span class="op" id="6255202">.</span><span class="ident" id="6255203">Body</span><span class="op" id="6255207">,</span>&nbsp;<span class="ident" id="6255209"><a href="/net/http/httputil/dump.go.html#6254997">err</a></span>&nbsp;<span class="op" id="6255213">=</span>&nbsp;<span class="ident" id="6255215"><a href="/net/http/httputil/dump.go.html#6248371">drainBody</a></span><span class="op" id="6255224">(</span><span class="ident" id="6255225"><a href="/net/http/httputil/dump.go.html#6254951">resp</a></span><span class="op" id="6255229">.</span><span class="ident" id="6255230">Body</span><span class="op" id="6255234">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255238">if</span>&nbsp;<span class="ident" id="6255241"><a href="/net/http/httputil/dump.go.html#6254997">err</a></span>&nbsp;<span class="op" id="6255245">!=</span>&nbsp;<span class="ident" id="6255248">nil</span>&nbsp;<span class="op" id="6255252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255257">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6255266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6255269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255272"><a href="/net/http/httputil/dump.go.html#6254997">err</a></span>&nbsp;<span class="op" id="6255276">=</span>&nbsp;<span class="ident" id="6255278"><a href="/net/http/httputil/dump.go.html#6254951">resp</a></span><span class="op" id="6255282">.</span><span class="ident" id="6255283">Write</span><span class="op" id="6255288">(</span><span class="op" id="6255289">&amp;</span><span class="ident" id="6255290"><a href="/net/http/httputil/dump.go.html#6255015">b</a></span><span class="op" id="6255291">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255294">if</span>&nbsp;<span class="ident" id="6255297"><a href="/net/http/httputil/dump.go.html#6254997">err</a></span>&nbsp;<span class="op" id="6255301">==</span>&nbsp;<span class="ident" id="6255304"><a href="/net/http/httputil/dump.go.html#6254356">errNoBody</a></span>&nbsp;<span class="op" id="6255314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255318"><a href="/net/http/httputil/dump.go.html#6254997">err</a></span>&nbsp;<span class="op" id="6255322">=</span>&nbsp;<span class="ident" id="6255324">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6255329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255332"><a href="/net/http/httputil/dump.go.html#6254951">resp</a></span><span class="op" id="6255336">.</span><span class="ident" id="6255337">Body</span>&nbsp;<span class="op" id="6255342">=</span>&nbsp;<span class="ident" id="6255344"><a href="/net/http/httputil/dump.go.html#6255031">save</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255350"><a href="/net/http/httputil/dump.go.html#6254951">resp</a></span><span class="op" id="6255354">.</span><span class="ident" id="6255355">ContentLength</span>&nbsp;<span class="op" id="6255369">=</span>&nbsp;<span class="ident" id="6255371"><a href="/net/http/httputil/dump.go.html#6255050">savecl</a></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255379">if</span>&nbsp;<span class="ident" id="6255382"><a href="/net/http/httputil/dump.go.html#6254997">err</a></span>&nbsp;<span class="op" id="6255386">!=</span>&nbsp;<span class="ident" id="6255389">nil</span>&nbsp;<span class="op" id="6255393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255397">return</span>&nbsp;<span class="ident" id="6255404">nil</span><span class="op" id="6255407">,</span>&nbsp;<span class="ident" id="6255409"><a href="/net/http/httputil/dump.go.html#6254997">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6255414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255417">return</span>&nbsp;<span class="ident" id="6255424"><a href="/net/http/httputil/dump.go.html#6255015">b</a></span><span class="op" id="6255425">.</span><span class="ident" id="6255426">Bytes</span><span class="op" id="6255431">(</span><span class="op" id="6255432">)</span><span class="op" id="6255433">,</span>&nbsp;<span class="ident" id="6255435">nil</span><br>
<span class="lineno"></span><span class="op" id="6255439">}</span>
</div>
</body>
</html>
