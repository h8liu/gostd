<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2646749">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2646804">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2646858">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2646909">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2646974">package</span>&nbsp;<span class="ident" id="2646982">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2646991">import</span>&nbsp;<span class="op" id="2646998">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2647001">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2647012">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2647020">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2647029">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="2647032">var</span>&nbsp;<span class="op" id="2647036">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2647039">Stdin</span>&nbsp;&nbsp;<span class="op" id="2647046">=</span>&nbsp;<span class="num" id="2647048">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2647051">Stdout</span>&nbsp;<span class="op" id="2647058">=</span>&nbsp;<span class="num" id="2647060">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2647063">Stderr</span>&nbsp;<span class="op" id="2647070">=</span>&nbsp;<span class="num" id="2647072">2</span><br>
<span class="lineno"></span><span class="op" id="2647074">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2647077">const</span>&nbsp;<span class="op" id="2647083">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2647086">darwin64Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2647101">=</span>&nbsp;<span class="ident" id="2647103">runtime</span><span class="op" id="2647110">.</span><span class="ident" id="2647111">GOOS</span>&nbsp;<span class="op" id="2647116">==</span>&nbsp;<span class="string" id="2647119">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2647128">&amp;&amp;</span>&nbsp;<span class="ident" id="2647131">sizeofPtr</span>&nbsp;<span class="op" id="2647141">==</span>&nbsp;<span class="num" id="2647144">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2647147">dragonfly64Bit</span>&nbsp;<span class="op" id="2647162">=</span>&nbsp;<span class="ident" id="2647164">runtime</span><span class="op" id="2647171">.</span><span class="ident" id="2647172">GOOS</span>&nbsp;<span class="op" id="2647177">==</span>&nbsp;<span class="string" id="2647180">&#34;dragonfly&#34;</span>&nbsp;<span class="op" id="2647192">&amp;&amp;</span>&nbsp;<span class="ident" id="2647195">sizeofPtr</span>&nbsp;<span class="op" id="2647205">==</span>&nbsp;<span class="num" id="2647208">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2647211">netbsd32Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2647226">=</span>&nbsp;<span class="ident" id="2647228">runtime</span><span class="op" id="2647235">.</span><span class="ident" id="2647236">GOOS</span>&nbsp;<span class="op" id="2647241">==</span>&nbsp;<span class="string" id="2647244">&#34;netbsd&#34;</span>&nbsp;<span class="op" id="2647253">&amp;&amp;</span>&nbsp;<span class="ident" id="2647256">sizeofPtr</span>&nbsp;<span class="op" id="2647266">==</span>&nbsp;<span class="num" id="2647269">4</span><br>
<span class="lineno">25</span><span class="op" id="2647271">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2647274">func</span>&nbsp;<span class="ident" id="2647279">Syscall</span><span class="op" id="2647286">(</span><span class="ident" id="2647287">trap</span><span class="op" id="2647291">,</span>&nbsp;<span class="ident" id="2647293">a1</span><span class="op" id="2647295">,</span>&nbsp;<span class="ident" id="2647297">a2</span><span class="op" id="2647299">,</span>&nbsp;<span class="ident" id="2647301">a3</span>&nbsp;<span class="builtintype" id="2647304">uintptr</span><span class="op" id="2647311">)</span>&nbsp;<span class="op" id="2647313">(</span><span class="ident" id="2647314">r1</span><span class="op" id="2647316">,</span>&nbsp;<span class="ident" id="2647318">r2</span>&nbsp;<span class="builtintype" id="2647321">uintptr</span><span class="op" id="2647328">,</span>&nbsp;<span class="ident" id="2647330">err</span>&nbsp;<span class="ident" id="2647334">Errno</span><span class="op" id="2647339">)</span><br>
<span class="lineno"></span><span class="keyword" id="2647341">func</span>&nbsp;<span class="ident" id="2647346">Syscall6</span><span class="op" id="2647354">(</span><span class="ident" id="2647355">trap</span><span class="op" id="2647359">,</span>&nbsp;<span class="ident" id="2647361">a1</span><span class="op" id="2647363">,</span>&nbsp;<span class="ident" id="2647365">a2</span><span class="op" id="2647367">,</span>&nbsp;<span class="ident" id="2647369">a3</span><span class="op" id="2647371">,</span>&nbsp;<span class="ident" id="2647373">a4</span><span class="op" id="2647375">,</span>&nbsp;<span class="ident" id="2647377">a5</span><span class="op" id="2647379">,</span>&nbsp;<span class="ident" id="2647381">a6</span>&nbsp;<span class="builtintype" id="2647384">uintptr</span><span class="op" id="2647391">)</span>&nbsp;<span class="op" id="2647393">(</span><span class="ident" id="2647394">r1</span><span class="op" id="2647396">,</span>&nbsp;<span class="ident" id="2647398">r2</span>&nbsp;<span class="builtintype" id="2647401">uintptr</span><span class="op" id="2647408">,</span>&nbsp;<span class="ident" id="2647410">err</span>&nbsp;<span class="ident" id="2647414">Errno</span><span class="op" id="2647419">)</span><br>
<span class="lineno"></span><span class="keyword" id="2647421">func</span>&nbsp;<span class="ident" id="2647426">RawSyscall</span><span class="op" id="2647436">(</span><span class="ident" id="2647437">trap</span><span class="op" id="2647441">,</span>&nbsp;<span class="ident" id="2647443">a1</span><span class="op" id="2647445">,</span>&nbsp;<span class="ident" id="2647447">a2</span><span class="op" id="2647449">,</span>&nbsp;<span class="ident" id="2647451">a3</span>&nbsp;<span class="builtintype" id="2647454">uintptr</span><span class="op" id="2647461">)</span>&nbsp;<span class="op" id="2647463">(</span><span class="ident" id="2647464">r1</span><span class="op" id="2647466">,</span>&nbsp;<span class="ident" id="2647468">r2</span>&nbsp;<span class="builtintype" id="2647471">uintptr</span><span class="op" id="2647478">,</span>&nbsp;<span class="ident" id="2647480">err</span>&nbsp;<span class="ident" id="2647484">Errno</span><span class="op" id="2647489">)</span><br>
<span class="lineno">30</span><span class="keyword" id="2647491">func</span>&nbsp;<span class="ident" id="2647496">RawSyscall6</span><span class="op" id="2647507">(</span><span class="ident" id="2647508">trap</span><span class="op" id="2647512">,</span>&nbsp;<span class="ident" id="2647514">a1</span><span class="op" id="2647516">,</span>&nbsp;<span class="ident" id="2647518">a2</span><span class="op" id="2647520">,</span>&nbsp;<span class="ident" id="2647522">a3</span><span class="op" id="2647524">,</span>&nbsp;<span class="ident" id="2647526">a4</span><span class="op" id="2647528">,</span>&nbsp;<span class="ident" id="2647530">a5</span><span class="op" id="2647532">,</span>&nbsp;<span class="ident" id="2647534">a6</span>&nbsp;<span class="builtintype" id="2647537">uintptr</span><span class="op" id="2647544">)</span>&nbsp;<span class="op" id="2647546">(</span><span class="ident" id="2647547">r1</span><span class="op" id="2647549">,</span>&nbsp;<span class="ident" id="2647551">r2</span>&nbsp;<span class="builtintype" id="2647554">uintptr</span><span class="op" id="2647561">,</span>&nbsp;<span class="ident" id="2647563">err</span>&nbsp;<span class="ident" id="2647567">Errno</span><span class="op" id="2647572">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2647575">//&nbsp;Mmap&nbsp;manager,&nbsp;for&nbsp;use&nbsp;by&nbsp;operating&nbsp;system-specific&nbsp;implementations.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2647647">type</span>&nbsp;<span class="ident" id="2647652">mmapper</span>&nbsp;<span class="keyword" id="2647660">struct</span>&nbsp;<span class="op" id="2647667">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2647670">sync</span><span class="op" id="2647674">.</span><span class="ident" id="2647675">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2647682">active</span>&nbsp;<span class="keyword" id="2647689">map</span><span class="op" id="2647692">[</span><span class="op" id="2647693">*</span><span class="builtintype" id="2647694">byte</span><span class="op" id="2647698">]</span><span class="op" id="2647699">[</span><span class="op" id="2647700">]</span><span class="builtintype" id="2647701">byte</span>&nbsp;<span class="comment" id="2647706">//&nbsp;active&nbsp;mappings;&nbsp;key&nbsp;is&nbsp;last&nbsp;byte&nbsp;in&nbsp;mapping</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2647755">mmap</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="2647762">func</span><span class="op" id="2647766">(</span><span class="ident" id="2647767">addr</span><span class="op" id="2647771">,</span>&nbsp;<span class="ident" id="2647773">length</span>&nbsp;<span class="builtintype" id="2647780">uintptr</span><span class="op" id="2647787">,</span>&nbsp;<span class="ident" id="2647789">prot</span><span class="op" id="2647793">,</span>&nbsp;<span class="ident" id="2647795">flags</span><span class="op" id="2647800">,</span>&nbsp;<span class="ident" id="2647802">fd</span>&nbsp;<span class="builtintype" id="2647805">int</span><span class="op" id="2647808">,</span>&nbsp;<span class="ident" id="2647810">offset</span>&nbsp;<span class="ident" id="2647817">int64</span><span class="op" id="2647822">)</span>&nbsp;<span class="op" id="2647824">(</span><span class="builtintype" id="2647825">uintptr</span><span class="op" id="2647832">,</span>&nbsp;<span class="builtintype" id="2647834">error</span><span class="op" id="2647839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2647842">munmap</span>&nbsp;<span class="keyword" id="2647849">func</span><span class="op" id="2647853">(</span><span class="ident" id="2647854">addr</span>&nbsp;<span class="builtintype" id="2647859">uintptr</span><span class="op" id="2647866">,</span>&nbsp;<span class="ident" id="2647868">length</span>&nbsp;<span class="builtintype" id="2647875">uintptr</span><span class="op" id="2647882">)</span>&nbsp;<span class="builtintype" id="2647884">error</span><br>
<span class="lineno"></span><span class="op" id="2647890">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2647893">func</span>&nbsp;<span class="op" id="2647898">(</span><span class="ident" id="2647899">m</span>&nbsp;<span class="op" id="2647901">*</span><span class="ident" id="2647902">mmapper</span><span class="op" id="2647909">)</span>&nbsp;<span class="ident" id="2647911">Mmap</span><span class="op" id="2647915">(</span><span class="ident" id="2647916">fd</span>&nbsp;<span class="builtintype" id="2647919">int</span><span class="op" id="2647922">,</span>&nbsp;<span class="ident" id="2647924">offset</span>&nbsp;<span class="ident" id="2647931">int64</span><span class="op" id="2647936">,</span>&nbsp;<span class="ident" id="2647938">length</span>&nbsp;<span class="builtintype" id="2647945">int</span><span class="op" id="2647948">,</span>&nbsp;<span class="ident" id="2647950">prot</span>&nbsp;<span class="builtintype" id="2647955">int</span><span class="op" id="2647958">,</span>&nbsp;<span class="ident" id="2647960">flags</span>&nbsp;<span class="builtintype" id="2647966">int</span><span class="op" id="2647969">)</span>&nbsp;<span class="op" id="2647971">(</span><span class="ident" id="2647972">data</span>&nbsp;<span class="op" id="2647977">[</span><span class="op" id="2647978">]</span><span class="builtintype" id="2647979">byte</span><span class="op" id="2647983">,</span>&nbsp;<span class="ident" id="2647985">err</span>&nbsp;<span class="builtintype" id="2647989">error</span><span class="op" id="2647994">)</span>&nbsp;<span class="op" id="2647996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2647999">if</span>&nbsp;<span class="ident" id="2648002">length</span>&nbsp;<span class="op" id="2648009">&lt;=</span>&nbsp;<span class="num" id="2648012">0</span>&nbsp;<span class="op" id="2648014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2648018">return</span>&nbsp;<span class="ident" id="2648025">nil</span><span class="op" id="2648028">,</span>&nbsp;<span class="ident" id="2648030">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2648038">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2648042">//&nbsp;Map&nbsp;the&nbsp;requested&nbsp;memory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2648072">addr</span><span class="op" id="2648076">,</span>&nbsp;<span class="ident" id="2648078">errno</span>&nbsp;<span class="op" id="2648084">:=</span>&nbsp;<span class="ident" id="2648087">m</span><span class="op" id="2648088">.</span><span class="ident" id="2648089">mmap</span><span class="op" id="2648093">(</span><span class="num" id="2648094">0</span><span class="op" id="2648095">,</span>&nbsp;<span class="builtintype" id="2648097">uintptr</span><span class="op" id="2648104">(</span><span class="ident" id="2648105">length</span><span class="op" id="2648111">)</span><span class="op" id="2648112">,</span>&nbsp;<span class="ident" id="2648114">prot</span><span class="op" id="2648118">,</span>&nbsp;<span class="ident" id="2648120">flags</span><span class="op" id="2648125">,</span>&nbsp;<span class="ident" id="2648127">fd</span><span class="op" id="2648129">,</span>&nbsp;<span class="ident" id="2648131">offset</span><span class="op" id="2648137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2648140">if</span>&nbsp;<span class="ident" id="2648143">errno</span>&nbsp;<span class="op" id="2648149">!=</span>&nbsp;<span class="ident" id="2648152">nil</span>&nbsp;<span class="op" id="2648156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2648160">return</span>&nbsp;<span class="ident" id="2648167">nil</span><span class="op" id="2648170">,</span>&nbsp;<span class="ident" id="2648172">errno</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2648179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2648183">//&nbsp;Slice&nbsp;memory&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2648207">var</span>&nbsp;<span class="ident" id="2648211">sl</span>&nbsp;<span class="op" id="2648214">=</span>&nbsp;<span class="keyword" id="2648216">struct</span>&nbsp;<span class="op" id="2648223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2648227">addr</span>&nbsp;<span class="builtintype" id="2648232">uintptr</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2648242">len</span>&nbsp;&nbsp;<span class="builtintype" id="2648247">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2648253">cap</span>&nbsp;&nbsp;<span class="builtintype" id="2648258">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2648263">}</span><span class="op" id="2648264">{</span><span class="ident" id="2648265">addr</span><span class="op" id="2648269">,</span>&nbsp;<span class="ident" id="2648271">length</span><span class="op" id="2648277">,</span>&nbsp;<span class="ident" id="2648279">length</span><span class="op" id="2648285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2648289">//&nbsp;Use&nbsp;unsafe&nbsp;to&nbsp;turn&nbsp;sl&nbsp;into&nbsp;a&nbsp;[]byte.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2648330">b</span>&nbsp;<span class="op" id="2648332">:=</span>&nbsp;<span class="op" id="2648335">*</span><span class="op" id="2648336">(</span><span class="op" id="2648337">*</span><span class="op" id="2648338">[</span><span class="op" id="2648339">]</span><span class="builtintype" id="2648340">byte</span><span class="op" id="2648344">)</span><span class="op" id="2648345">(</span><span class="ident" id="2648346">unsafe</span><span class="op" id="2648352">.</span><span class="ident" id="2648353">Pointer</span><span class="op" id="2648360">(</span><span class="op" id="2648361">&amp;</span><span class="ident" id="2648362">sl</span><span class="op" id="2648364">)</span><span class="op" id="2648365">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2648369">//&nbsp;Register&nbsp;mapping&nbsp;in&nbsp;m&nbsp;and&nbsp;return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2648410">p</span>&nbsp;<span class="op" id="2648412">:=</span>&nbsp;<span class="op" id="2648415">&amp;</span><span class="ident" id="2648416">b</span><span class="op" id="2648417">[</span><span class="builtinfunc" id="2648418">cap</span><span class="op" id="2648421">(</span><span class="ident" id="2648422">b</span><span class="op" id="2648423">)</span><span class="op" id="2648424">-</span><span class="num" id="2648425">1</span><span class="op" id="2648426">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2648429">m</span><span class="op" id="2648430">.</span><span class="ident" id="2648431">Lock</span><span class="op" id="2648435">(</span><span class="op" id="2648436">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2648439">defer</span>&nbsp;<span class="ident" id="2648445">m</span><span class="op" id="2648446">.</span><span class="ident" id="2648447">Unlock</span><span class="op" id="2648453">(</span><span class="op" id="2648454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2648457">m</span><span class="op" id="2648458">.</span><span class="ident" id="2648459">active</span><span class="op" id="2648465">[</span><span class="ident" id="2648466">p</span><span class="op" id="2648467">]</span>&nbsp;<span class="op" id="2648469">=</span>&nbsp;<span class="ident" id="2648471">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2648474">return</span>&nbsp;<span class="ident" id="2648481">b</span><span class="op" id="2648482">,</span>&nbsp;<span class="ident" id="2648484">nil</span><br>
<span class="lineno"></span><span class="op" id="2648488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="2648491">func</span>&nbsp;<span class="op" id="2648496">(</span><span class="ident" id="2648497">m</span>&nbsp;<span class="op" id="2648499">*</span><span class="ident" id="2648500">mmapper</span><span class="op" id="2648507">)</span>&nbsp;<span class="ident" id="2648509">Munmap</span><span class="op" id="2648515">(</span><span class="ident" id="2648516">data</span>&nbsp;<span class="op" id="2648521">[</span><span class="op" id="2648522">]</span><span class="builtintype" id="2648523">byte</span><span class="op" id="2648527">)</span>&nbsp;<span class="op" id="2648529">(</span><span class="ident" id="2648530">err</span>&nbsp;<span class="builtintype" id="2648534">error</span><span class="op" id="2648539">)</span>&nbsp;<span class="op" id="2648541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2648544">if</span>&nbsp;<span class="builtinfunc" id="2648547">len</span><span class="op" id="2648550">(</span><span class="ident" id="2648551">data</span><span class="op" id="2648555">)</span>&nbsp;<span class="op" id="2648557">==</span>&nbsp;<span class="num" id="2648560">0</span>&nbsp;<span class="op" id="2648562">||</span>&nbsp;<span class="builtinfunc" id="2648565">len</span><span class="op" id="2648568">(</span><span class="ident" id="2648569">data</span><span class="op" id="2648573">)</span>&nbsp;<span class="op" id="2648575">!=</span>&nbsp;<span class="builtinfunc" id="2648578">cap</span><span class="op" id="2648581">(</span><span class="ident" id="2648582">data</span><span class="op" id="2648586">)</span>&nbsp;<span class="op" id="2648588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2648592">return</span>&nbsp;<span class="ident" id="2648599">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2648607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2648611">//&nbsp;Find&nbsp;the&nbsp;base&nbsp;of&nbsp;the&nbsp;mapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2648645">p</span>&nbsp;<span class="op" id="2648647">:=</span>&nbsp;<span class="op" id="2648650">&amp;</span><span class="ident" id="2648651">data</span><span class="op" id="2648655">[</span><span class="builtinfunc" id="2648656">cap</span><span class="op" id="2648659">(</span><span class="ident" id="2648660">data</span><span class="op" id="2648664">)</span><span class="op" id="2648665">-</span><span class="num" id="2648666">1</span><span class="op" id="2648667">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2648670">m</span><span class="op" id="2648671">.</span><span class="ident" id="2648672">Lock</span><span class="op" id="2648676">(</span><span class="op" id="2648677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2648680">defer</span>&nbsp;<span class="ident" id="2648686">m</span><span class="op" id="2648687">.</span><span class="ident" id="2648688">Unlock</span><span class="op" id="2648694">(</span><span class="op" id="2648695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2648698">b</span>&nbsp;<span class="op" id="2648700">:=</span>&nbsp;<span class="ident" id="2648703">m</span><span class="op" id="2648704">.</span><span class="ident" id="2648705">active</span><span class="op" id="2648711">[</span><span class="ident" id="2648712">p</span><span class="op" id="2648713">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2648716">if</span>&nbsp;<span class="ident" id="2648719">b</span>&nbsp;<span class="op" id="2648721">==</span>&nbsp;<span class="ident" id="2648724">nil</span>&nbsp;<span class="op" id="2648728">||</span>&nbsp;<span class="op" id="2648731">&amp;</span><span class="ident" id="2648732">b</span><span class="op" id="2648733">[</span><span class="num" id="2648734">0</span><span class="op" id="2648735">]</span>&nbsp;<span class="op" id="2648737">!=</span>&nbsp;<span class="op" id="2648740">&amp;</span><span class="ident" id="2648741">data</span><span class="op" id="2648745">[</span><span class="num" id="2648746">0</span><span class="op" id="2648747">]</span>&nbsp;<span class="op" id="2648749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2648753">return</span>&nbsp;<span class="ident" id="2648760">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2648768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2648772">//&nbsp;Unmap&nbsp;the&nbsp;memory&nbsp;and&nbsp;update&nbsp;m.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2648807">if</span>&nbsp;<span class="ident" id="2648810">errno</span>&nbsp;<span class="op" id="2648816">:=</span>&nbsp;<span class="ident" id="2648819">m</span><span class="op" id="2648820">.</span><span class="ident" id="2648821">munmap</span><span class="op" id="2648827">(</span><span class="builtintype" id="2648828">uintptr</span><span class="op" id="2648835">(</span><span class="ident" id="2648836">unsafe</span><span class="op" id="2648842">.</span><span class="ident" id="2648843">Pointer</span><span class="op" id="2648850">(</span><span class="op" id="2648851">&amp;</span><span class="ident" id="2648852">b</span><span class="op" id="2648853">[</span><span class="num" id="2648854">0</span><span class="op" id="2648855">]</span><span class="op" id="2648856">)</span><span class="op" id="2648857">)</span><span class="op" id="2648858">,</span>&nbsp;<span class="builtintype" id="2648860">uintptr</span><span class="op" id="2648867">(</span><span class="builtinfunc" id="2648868">len</span><span class="op" id="2648871">(</span><span class="ident" id="2648872">b</span><span class="op" id="2648873">)</span><span class="op" id="2648874">)</span><span class="op" id="2648875">)</span><span class="op" id="2648876">;</span>&nbsp;<span class="ident" id="2648878">errno</span>&nbsp;<span class="op" id="2648884">!=</span>&nbsp;<span class="ident" id="2648887">nil</span>&nbsp;<span class="op" id="2648891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2648895">return</span>&nbsp;<span class="ident" id="2648902">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2648909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2648912">delete</span><span class="op" id="2648918">(</span><span class="ident" id="2648919">m</span><span class="op" id="2648920">.</span><span class="ident" id="2648921">active</span><span class="op" id="2648927">,</span>&nbsp;<span class="ident" id="2648929">p</span><span class="op" id="2648930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2648933">return</span>&nbsp;<span class="ident" id="2648940">nil</span><br>
<span class="lineno">90</span><span class="op" id="2648944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2648947">//&nbsp;An&nbsp;Errno&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;number&nbsp;describing&nbsp;an&nbsp;error&nbsp;condition.</span><br>
<span class="lineno"></span><span class="comment" id="2649012">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;error&nbsp;interface.&nbsp;&nbsp;The&nbsp;zero&nbsp;Errno&nbsp;is&nbsp;by&nbsp;convention</span><br>
<span class="lineno"></span><span class="comment" id="2649083">//&nbsp;a&nbsp;non-error,&nbsp;so&nbsp;code&nbsp;to&nbsp;convert&nbsp;from&nbsp;Errno&nbsp;to&nbsp;error&nbsp;should&nbsp;use:</span><br>
<span class="lineno">95</span><span class="comment" id="2649150">//&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span><span class="comment" id="2649163">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;errno&nbsp;!=&nbsp;0&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="2649182">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;errno</span><br>
<span class="lineno"></span><span class="comment" id="2649198">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="keyword" id="2649203">type</span>&nbsp;<span class="ident" id="2649208">Errno</span>&nbsp;<span class="builtintype" id="2649214">uintptr</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2649223">func</span>&nbsp;<span class="op" id="2649228">(</span><span class="ident" id="2649229">e</span>&nbsp;<span class="ident" id="2649231">Errno</span><span class="op" id="2649236">)</span>&nbsp;<span class="ident" id="2649238">Error</span><span class="op" id="2649243">(</span><span class="op" id="2649244">)</span>&nbsp;<span class="builtintype" id="2649246">string</span>&nbsp;<span class="op" id="2649253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2649256">if</span>&nbsp;<span class="num" id="2649259">0</span>&nbsp;<span class="op" id="2649261">&lt;=</span>&nbsp;<span class="builtintype" id="2649264">int</span><span class="op" id="2649267">(</span><span class="ident" id="2649268">e</span><span class="op" id="2649269">)</span>&nbsp;<span class="op" id="2649271">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2649274">int</span><span class="op" id="2649277">(</span><span class="ident" id="2649278">e</span><span class="op" id="2649279">)</span>&nbsp;<span class="op" id="2649281">&lt;</span>&nbsp;<span class="builtinfunc" id="2649283">len</span><span class="op" id="2649286">(</span><span class="ident" id="2649287">errors</span><span class="op" id="2649293">)</span>&nbsp;<span class="op" id="2649295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2649299">s</span>&nbsp;<span class="op" id="2649301">:=</span>&nbsp;<span class="ident" id="2649304">errors</span><span class="op" id="2649310">[</span><span class="ident" id="2649311">e</span><span class="op" id="2649312">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2649316">if</span>&nbsp;<span class="ident" id="2649319">s</span>&nbsp;<span class="op" id="2649321">!=</span>&nbsp;<span class="string" id="2649324">&#34;&#34;</span>&nbsp;<span class="op" id="2649327">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2649332">return</span>&nbsp;<span class="ident" id="2649339">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2649343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2649346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2649349">return</span>&nbsp;<span class="string" id="2649356">&#34;errno&nbsp;&#34;</span>&nbsp;<span class="op" id="2649365">+</span>&nbsp;<span class="ident" id="2649367">itoa</span><span class="op" id="2649371">(</span><span class="builtintype" id="2649372">int</span><span class="op" id="2649375">(</span><span class="ident" id="2649376">e</span><span class="op" id="2649377">)</span><span class="op" id="2649378">)</span><br>
<span class="lineno"></span><span class="op" id="2649380">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="2649383">func</span>&nbsp;<span class="op" id="2649388">(</span><span class="ident" id="2649389">e</span>&nbsp;<span class="ident" id="2649391">Errno</span><span class="op" id="2649396">)</span>&nbsp;<span class="ident" id="2649398">Temporary</span><span class="op" id="2649407">(</span><span class="op" id="2649408">)</span>&nbsp;<span class="builtintype" id="2649410">bool</span>&nbsp;<span class="op" id="2649415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2649418">return</span>&nbsp;<span class="ident" id="2649425">e</span>&nbsp;<span class="op" id="2649427">==</span>&nbsp;<span class="ident" id="2649430">EINTR</span>&nbsp;<span class="op" id="2649436">||</span>&nbsp;<span class="ident" id="2649439">e</span>&nbsp;<span class="op" id="2649441">==</span>&nbsp;<span class="ident" id="2649444">EMFILE</span>&nbsp;<span class="op" id="2649451">||</span>&nbsp;<span class="ident" id="2649454">e</span>&nbsp;<span class="op" id="2649456">==</span>&nbsp;<span class="ident" id="2649459">ECONNRESET</span>&nbsp;<span class="op" id="2649470">||</span>&nbsp;<span class="ident" id="2649473">e</span>&nbsp;<span class="op" id="2649475">==</span>&nbsp;<span class="ident" id="2649478">ECONNABORTED</span>&nbsp;<span class="op" id="2649491">||</span>&nbsp;<span class="ident" id="2649494">e</span><span class="op" id="2649495">.</span><span class="ident" id="2649496">Timeout</span><span class="op" id="2649503">(</span><span class="op" id="2649504">)</span><br>
<span class="lineno"></span><span class="op" id="2649506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="2649509">func</span>&nbsp;<span class="op" id="2649514">(</span><span class="ident" id="2649515">e</span>&nbsp;<span class="ident" id="2649517">Errno</span><span class="op" id="2649522">)</span>&nbsp;<span class="ident" id="2649524">Timeout</span><span class="op" id="2649531">(</span><span class="op" id="2649532">)</span>&nbsp;<span class="builtintype" id="2649534">bool</span>&nbsp;<span class="op" id="2649539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2649542">return</span>&nbsp;<span class="ident" id="2649549">e</span>&nbsp;<span class="op" id="2649551">==</span>&nbsp;<span class="ident" id="2649554">EAGAIN</span>&nbsp;<span class="op" id="2649561">||</span>&nbsp;<span class="ident" id="2649564">e</span>&nbsp;<span class="op" id="2649566">==</span>&nbsp;<span class="ident" id="2649569">EWOULDBLOCK</span>&nbsp;<span class="op" id="2649581">||</span>&nbsp;<span class="ident" id="2649584">e</span>&nbsp;<span class="op" id="2649586">==</span>&nbsp;<span class="ident" id="2649589">ETIMEDOUT</span><br>
<span class="lineno"></span><span class="op" id="2649599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2649602">//&nbsp;A&nbsp;Signal&nbsp;is&nbsp;a&nbsp;number&nbsp;describing&nbsp;a&nbsp;process&nbsp;signal.</span><br>
<span class="lineno">120</span><span class="comment" id="2649655">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;os.Signal&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="2649697">type</span>&nbsp;<span class="ident" id="2649702">Signal</span>&nbsp;<span class="builtintype" id="2649709">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2649714">func</span>&nbsp;<span class="op" id="2649719">(</span><span class="ident" id="2649720">s</span>&nbsp;<span class="ident" id="2649722">Signal</span><span class="op" id="2649728">)</span>&nbsp;<span class="ident" id="2649730">Signal</span><span class="op" id="2649736">(</span><span class="op" id="2649737">)</span>&nbsp;<span class="op" id="2649739">{</span><span class="op" id="2649740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2649743">func</span>&nbsp;<span class="op" id="2649748">(</span><span class="ident" id="2649749">s</span>&nbsp;<span class="ident" id="2649751">Signal</span><span class="op" id="2649757">)</span>&nbsp;<span class="ident" id="2649759">String</span><span class="op" id="2649765">(</span><span class="op" id="2649766">)</span>&nbsp;<span class="builtintype" id="2649768">string</span>&nbsp;<span class="op" id="2649775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2649778">if</span>&nbsp;<span class="num" id="2649781">0</span>&nbsp;<span class="op" id="2649783">&lt;=</span>&nbsp;<span class="ident" id="2649786">s</span>&nbsp;<span class="op" id="2649788">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2649791">int</span><span class="op" id="2649794">(</span><span class="ident" id="2649795">s</span><span class="op" id="2649796">)</span>&nbsp;<span class="op" id="2649798">&lt;</span>&nbsp;<span class="builtinfunc" id="2649800">len</span><span class="op" id="2649803">(</span><span class="ident" id="2649804">signals</span><span class="op" id="2649811">)</span>&nbsp;<span class="op" id="2649813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2649817">str</span>&nbsp;<span class="op" id="2649821">:=</span>&nbsp;<span class="ident" id="2649824">signals</span><span class="op" id="2649831">[</span><span class="ident" id="2649832">s</span><span class="op" id="2649833">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2649837">if</span>&nbsp;<span class="ident" id="2649840">str</span>&nbsp;<span class="op" id="2649844">!=</span>&nbsp;<span class="string" id="2649847">&#34;&#34;</span>&nbsp;<span class="op" id="2649850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2649855">return</span>&nbsp;<span class="ident" id="2649862">str</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2649868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2649871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2649874">return</span>&nbsp;<span class="string" id="2649881">&#34;signal&nbsp;&#34;</span>&nbsp;<span class="op" id="2649891">+</span>&nbsp;<span class="ident" id="2649893">itoa</span><span class="op" id="2649897">(</span><span class="builtintype" id="2649898">int</span><span class="op" id="2649901">(</span><span class="ident" id="2649902">s</span><span class="op" id="2649903">)</span><span class="op" id="2649904">)</span><br>
<span class="lineno"></span><span class="op" id="2649906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="2649909">func</span>&nbsp;<span class="ident" id="2649914">Read</span><span class="op" id="2649918">(</span><span class="ident" id="2649919">fd</span>&nbsp;<span class="builtintype" id="2649922">int</span><span class="op" id="2649925">,</span>&nbsp;<span class="ident" id="2649927">p</span>&nbsp;<span class="op" id="2649929">[</span><span class="op" id="2649930">]</span><span class="builtintype" id="2649931">byte</span><span class="op" id="2649935">)</span>&nbsp;<span class="op" id="2649937">(</span><span class="ident" id="2649938">n</span>&nbsp;<span class="builtintype" id="2649940">int</span><span class="op" id="2649943">,</span>&nbsp;<span class="ident" id="2649945">err</span>&nbsp;<span class="builtintype" id="2649949">error</span><span class="op" id="2649954">)</span>&nbsp;<span class="op" id="2649956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2649959">n</span><span class="op" id="2649960">,</span>&nbsp;<span class="ident" id="2649962">err</span>&nbsp;<span class="op" id="2649966">=</span>&nbsp;<span class="ident" id="2649968">read</span><span class="op" id="2649972">(</span><span class="ident" id="2649973">fd</span><span class="op" id="2649975">,</span>&nbsp;<span class="ident" id="2649977">p</span><span class="op" id="2649978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2649981">if</span>&nbsp;<span class="ident" id="2649984">raceenabled</span>&nbsp;<span class="op" id="2649996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2650000">if</span>&nbsp;<span class="ident" id="2650003">n</span>&nbsp;<span class="op" id="2650005">&gt;</span>&nbsp;<span class="num" id="2650007">0</span>&nbsp;<span class="op" id="2650009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2650014">raceWriteRange</span><span class="op" id="2650028">(</span><span class="ident" id="2650029">unsafe</span><span class="op" id="2650035">.</span><span class="ident" id="2650036">Pointer</span><span class="op" id="2650043">(</span><span class="op" id="2650044">&amp;</span><span class="ident" id="2650045">p</span><span class="op" id="2650046">[</span><span class="num" id="2650047">0</span><span class="op" id="2650048">]</span><span class="op" id="2650049">)</span><span class="op" id="2650050">,</span>&nbsp;<span class="ident" id="2650052">n</span><span class="op" id="2650053">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2650057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2650061">if</span>&nbsp;<span class="ident" id="2650064">err</span>&nbsp;<span class="op" id="2650068">==</span>&nbsp;<span class="ident" id="2650071">nil</span>&nbsp;<span class="op" id="2650075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2650080">raceAcquire</span><span class="op" id="2650091">(</span><span class="ident" id="2650092">unsafe</span><span class="op" id="2650098">.</span><span class="ident" id="2650099">Pointer</span><span class="op" id="2650106">(</span><span class="op" id="2650107">&amp;</span><span class="ident" id="2650108">ioSync</span><span class="op" id="2650114">)</span><span class="op" id="2650115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2650119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2650122">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2650125">return</span><br>
<span class="lineno"></span><span class="op" id="2650132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2650135">func</span>&nbsp;<span class="ident" id="2650140">Write</span><span class="op" id="2650145">(</span><span class="ident" id="2650146">fd</span>&nbsp;<span class="builtintype" id="2650149">int</span><span class="op" id="2650152">,</span>&nbsp;<span class="ident" id="2650154">p</span>&nbsp;<span class="op" id="2650156">[</span><span class="op" id="2650157">]</span><span class="builtintype" id="2650158">byte</span><span class="op" id="2650162">)</span>&nbsp;<span class="op" id="2650164">(</span><span class="ident" id="2650165">n</span>&nbsp;<span class="builtintype" id="2650167">int</span><span class="op" id="2650170">,</span>&nbsp;<span class="ident" id="2650172">err</span>&nbsp;<span class="builtintype" id="2650176">error</span><span class="op" id="2650181">)</span>&nbsp;<span class="op" id="2650183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2650186">if</span>&nbsp;<span class="ident" id="2650189">raceenabled</span>&nbsp;<span class="op" id="2650201">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2650205">raceReleaseMerge</span><span class="op" id="2650221">(</span><span class="ident" id="2650222">unsafe</span><span class="op" id="2650228">.</span><span class="ident" id="2650229">Pointer</span><span class="op" id="2650236">(</span><span class="op" id="2650237">&amp;</span><span class="ident" id="2650238">ioSync</span><span class="op" id="2650244">)</span><span class="op" id="2650245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2650248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2650251">n</span><span class="op" id="2650252">,</span>&nbsp;<span class="ident" id="2650254">err</span>&nbsp;<span class="op" id="2650258">=</span>&nbsp;<span class="ident" id="2650260">write</span><span class="op" id="2650265">(</span><span class="ident" id="2650266">fd</span><span class="op" id="2650268">,</span>&nbsp;<span class="ident" id="2650270">p</span><span class="op" id="2650271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2650274">if</span>&nbsp;<span class="ident" id="2650277">raceenabled</span>&nbsp;<span class="op" id="2650289">&amp;&amp;</span>&nbsp;<span class="ident" id="2650292">n</span>&nbsp;<span class="op" id="2650294">&gt;</span>&nbsp;<span class="num" id="2650296">0</span>&nbsp;<span class="op" id="2650298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2650302">raceReadRange</span><span class="op" id="2650315">(</span><span class="ident" id="2650316">unsafe</span><span class="op" id="2650322">.</span><span class="ident" id="2650323">Pointer</span><span class="op" id="2650330">(</span><span class="op" id="2650331">&amp;</span><span class="ident" id="2650332">p</span><span class="op" id="2650333">[</span><span class="num" id="2650334">0</span><span class="op" id="2650335">]</span><span class="op" id="2650336">)</span><span class="op" id="2650337">,</span>&nbsp;<span class="ident" id="2650339">n</span><span class="op" id="2650340">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2650343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2650346">return</span><br>
<span class="lineno"></span><span class="op" id="2650353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2650356">//&nbsp;For&nbsp;testing:&nbsp;clients&nbsp;can&nbsp;set&nbsp;this&nbsp;flag&nbsp;to&nbsp;force</span><br>
<span class="lineno">160</span><span class="comment" id="2650407">//&nbsp;creation&nbsp;of&nbsp;IPv6&nbsp;sockets&nbsp;to&nbsp;return&nbsp;EAFNOSUPPORT.</span><br>
<span class="lineno"></span><span class="keyword" id="2650459">var</span>&nbsp;<span class="ident" id="2650463">SocketDisableIPv6</span>&nbsp;<span class="builtintype" id="2650481">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2650487">type</span>&nbsp;<span class="ident" id="2650492">Sockaddr</span>&nbsp;<span class="keyword" id="2650501">interface</span>&nbsp;<span class="op" id="2650511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2650514">sockaddr</span><span class="op" id="2650522">(</span><span class="op" id="2650523">)</span>&nbsp;<span class="op" id="2650525">(</span><span class="ident" id="2650526">ptr</span>&nbsp;<span class="ident" id="2650530">unsafe</span><span class="op" id="2650536">.</span><span class="ident" id="2650537">Pointer</span><span class="op" id="2650544">,</span>&nbsp;<span class="builtinfunc" id="2650546">len</span>&nbsp;<span class="ident" id="2650550">_Socklen</span><span class="op" id="2650558">,</span>&nbsp;<span class="ident" id="2650560">err</span>&nbsp;<span class="builtintype" id="2650564">error</span><span class="op" id="2650569">)</span>&nbsp;<span class="comment" id="2650571">//&nbsp;lowercase;&nbsp;only&nbsp;we&nbsp;can&nbsp;define&nbsp;Sockaddrs</span><br>
<span class="lineno">165</span><span class="op" id="2650614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2650617">type</span>&nbsp;<span class="ident" id="2650622">SockaddrInet4</span>&nbsp;<span class="keyword" id="2650636">struct</span>&nbsp;<span class="op" id="2650643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2650646">Port</span>&nbsp;<span class="builtintype" id="2650651">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2650656">Addr</span>&nbsp;<span class="op" id="2650661">[</span><span class="num" id="2650662">4</span><span class="op" id="2650663">]</span><span class="builtintype" id="2650664">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2650670">raw</span>&nbsp;&nbsp;<span class="ident" id="2650675">RawSockaddrInet4</span><br>
<span class="lineno"></span><span class="op" id="2650692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2650695">type</span>&nbsp;<span class="ident" id="2650700">SockaddrInet6</span>&nbsp;<span class="keyword" id="2650714">struct</span>&nbsp;<span class="op" id="2650721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2650724">Port</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2650731">int</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2650736">ZoneId</span>&nbsp;<span class="builtintype" id="2650743">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2650751">Addr</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2650758">[</span><span class="num" id="2650759">16</span><span class="op" id="2650761">]</span><span class="builtintype" id="2650762">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2650768">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2650775">RawSockaddrInet6</span><br>
<span class="lineno"></span><span class="op" id="2650792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="2650795">type</span>&nbsp;<span class="ident" id="2650800">SockaddrUnix</span>&nbsp;<span class="keyword" id="2650813">struct</span>&nbsp;<span class="op" id="2650820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2650823">Name</span>&nbsp;<span class="builtintype" id="2650828">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2650836">raw</span>&nbsp;&nbsp;<span class="ident" id="2650841">RawSockaddrUnix</span><br>
<span class="lineno"></span><span class="op" id="2650857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="2650860">func</span>&nbsp;<span class="ident" id="2650865">Bind</span><span class="op" id="2650869">(</span><span class="ident" id="2650870">fd</span>&nbsp;<span class="builtintype" id="2650873">int</span><span class="op" id="2650876">,</span>&nbsp;<span class="ident" id="2650878">sa</span>&nbsp;<span class="ident" id="2650881">Sockaddr</span><span class="op" id="2650889">)</span>&nbsp;<span class="op" id="2650891">(</span><span class="ident" id="2650892">err</span>&nbsp;<span class="builtintype" id="2650896">error</span><span class="op" id="2650901">)</span>&nbsp;<span class="op" id="2650903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2650906">ptr</span><span class="op" id="2650909">,</span>&nbsp;<span class="ident" id="2650911">n</span><span class="op" id="2650912">,</span>&nbsp;<span class="ident" id="2650914">err</span>&nbsp;<span class="op" id="2650918">:=</span>&nbsp;<span class="ident" id="2650921">sa</span><span class="op" id="2650923">.</span><span class="ident" id="2650924">sockaddr</span><span class="op" id="2650932">(</span><span class="op" id="2650933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2650936">if</span>&nbsp;<span class="ident" id="2650939">err</span>&nbsp;<span class="op" id="2650943">!=</span>&nbsp;<span class="ident" id="2650946">nil</span>&nbsp;<span class="op" id="2650950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2650954">return</span>&nbsp;<span class="ident" id="2650961">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2650966">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2650969">return</span>&nbsp;<span class="ident" id="2650976">bind</span><span class="op" id="2650980">(</span><span class="ident" id="2650981">fd</span><span class="op" id="2650983">,</span>&nbsp;<span class="ident" id="2650985">ptr</span><span class="op" id="2650988">,</span>&nbsp;<span class="ident" id="2650990">n</span><span class="op" id="2650991">)</span><br>
<span class="lineno"></span><span class="op" id="2650993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2650996">func</span>&nbsp;<span class="ident" id="2651001">Connect</span><span class="op" id="2651008">(</span><span class="ident" id="2651009">fd</span>&nbsp;<span class="builtintype" id="2651012">int</span><span class="op" id="2651015">,</span>&nbsp;<span class="ident" id="2651017">sa</span>&nbsp;<span class="ident" id="2651020">Sockaddr</span><span class="op" id="2651028">)</span>&nbsp;<span class="op" id="2651030">(</span><span class="ident" id="2651031">err</span>&nbsp;<span class="builtintype" id="2651035">error</span><span class="op" id="2651040">)</span>&nbsp;<span class="op" id="2651042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2651045">ptr</span><span class="op" id="2651048">,</span>&nbsp;<span class="ident" id="2651050">n</span><span class="op" id="2651051">,</span>&nbsp;<span class="ident" id="2651053">err</span>&nbsp;<span class="op" id="2651057">:=</span>&nbsp;<span class="ident" id="2651060">sa</span><span class="op" id="2651062">.</span><span class="ident" id="2651063">sockaddr</span><span class="op" id="2651071">(</span><span class="op" id="2651072">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651075">if</span>&nbsp;<span class="ident" id="2651078">err</span>&nbsp;<span class="op" id="2651082">!=</span>&nbsp;<span class="ident" id="2651085">nil</span>&nbsp;<span class="op" id="2651089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651093">return</span>&nbsp;<span class="ident" id="2651100">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2651105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651108">return</span>&nbsp;<span class="ident" id="2651115">connect</span><span class="op" id="2651122">(</span><span class="ident" id="2651123">fd</span><span class="op" id="2651125">,</span>&nbsp;<span class="ident" id="2651127">ptr</span><span class="op" id="2651130">,</span>&nbsp;<span class="ident" id="2651132">n</span><span class="op" id="2651133">)</span><br>
<span class="lineno"></span><span class="op" id="2651135">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="2651138">func</span>&nbsp;<span class="ident" id="2651143">Getpeername</span><span class="op" id="2651154">(</span><span class="ident" id="2651155">fd</span>&nbsp;<span class="builtintype" id="2651158">int</span><span class="op" id="2651161">)</span>&nbsp;<span class="op" id="2651163">(</span><span class="ident" id="2651164">sa</span>&nbsp;<span class="ident" id="2651167">Sockaddr</span><span class="op" id="2651175">,</span>&nbsp;<span class="ident" id="2651177">err</span>&nbsp;<span class="builtintype" id="2651181">error</span><span class="op" id="2651186">)</span>&nbsp;<span class="op" id="2651188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651191">var</span>&nbsp;<span class="ident" id="2651195">rsa</span>&nbsp;<span class="ident" id="2651199">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651215">var</span>&nbsp;<span class="builtinfunc" id="2651219">len</span>&nbsp;<span class="ident" id="2651223">_Socklen</span>&nbsp;<span class="op" id="2651232">=</span>&nbsp;<span class="ident" id="2651234">SizeofSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651253">if</span>&nbsp;<span class="ident" id="2651256">err</span>&nbsp;<span class="op" id="2651260">=</span>&nbsp;<span class="ident" id="2651262">getpeername</span><span class="op" id="2651273">(</span><span class="ident" id="2651274">fd</span><span class="op" id="2651276">,</span>&nbsp;<span class="op" id="2651278">&amp;</span><span class="ident" id="2651279">rsa</span><span class="op" id="2651282">,</span>&nbsp;<span class="op" id="2651284">&amp;</span><span class="builtinfunc" id="2651285">len</span><span class="op" id="2651288">)</span><span class="op" id="2651289">;</span>&nbsp;<span class="ident" id="2651291">err</span>&nbsp;<span class="op" id="2651295">!=</span>&nbsp;<span class="ident" id="2651298">nil</span>&nbsp;<span class="op" id="2651302">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651306">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2651314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651317">return</span>&nbsp;<span class="ident" id="2651324">anyToSockaddr</span><span class="op" id="2651337">(</span><span class="op" id="2651338">&amp;</span><span class="ident" id="2651339">rsa</span><span class="op" id="2651342">)</span><br>
<span class="lineno"></span><span class="op" id="2651344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="2651347">func</span>&nbsp;<span class="ident" id="2651352">GetsockoptInt</span><span class="op" id="2651365">(</span><span class="ident" id="2651366">fd</span><span class="op" id="2651368">,</span>&nbsp;<span class="ident" id="2651370">level</span><span class="op" id="2651375">,</span>&nbsp;<span class="ident" id="2651377">opt</span>&nbsp;<span class="builtintype" id="2651381">int</span><span class="op" id="2651384">)</span>&nbsp;<span class="op" id="2651386">(</span><span class="ident" id="2651387">value</span>&nbsp;<span class="builtintype" id="2651393">int</span><span class="op" id="2651396">,</span>&nbsp;<span class="ident" id="2651398">err</span>&nbsp;<span class="builtintype" id="2651402">error</span><span class="op" id="2651407">)</span>&nbsp;<span class="op" id="2651409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651412">var</span>&nbsp;<span class="ident" id="2651416">n</span>&nbsp;<span class="builtintype" id="2651418">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2651425">vallen</span>&nbsp;<span class="op" id="2651432">:=</span>&nbsp;<span class="ident" id="2651435">_Socklen</span><span class="op" id="2651443">(</span><span class="num" id="2651444">4</span><span class="op" id="2651445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2651448">err</span>&nbsp;<span class="op" id="2651452">=</span>&nbsp;<span class="ident" id="2651454">getsockopt</span><span class="op" id="2651464">(</span><span class="ident" id="2651465">fd</span><span class="op" id="2651467">,</span>&nbsp;<span class="ident" id="2651469">level</span><span class="op" id="2651474">,</span>&nbsp;<span class="ident" id="2651476">opt</span><span class="op" id="2651479">,</span>&nbsp;<span class="ident" id="2651481">unsafe</span><span class="op" id="2651487">.</span><span class="ident" id="2651488">Pointer</span><span class="op" id="2651495">(</span><span class="op" id="2651496">&amp;</span><span class="ident" id="2651497">n</span><span class="op" id="2651498">)</span><span class="op" id="2651499">,</span>&nbsp;<span class="op" id="2651501">&amp;</span><span class="ident" id="2651502">vallen</span><span class="op" id="2651508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651511">return</span>&nbsp;<span class="builtintype" id="2651518">int</span><span class="op" id="2651521">(</span><span class="ident" id="2651522">n</span><span class="op" id="2651523">)</span><span class="op" id="2651524">,</span>&nbsp;<span class="ident" id="2651526">err</span><br>
<span class="lineno">215</span><span class="op" id="2651530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2651533">func</span>&nbsp;<span class="ident" id="2651538">Recvfrom</span><span class="op" id="2651546">(</span><span class="ident" id="2651547">fd</span>&nbsp;<span class="builtintype" id="2651550">int</span><span class="op" id="2651553">,</span>&nbsp;<span class="ident" id="2651555">p</span>&nbsp;<span class="op" id="2651557">[</span><span class="op" id="2651558">]</span><span class="builtintype" id="2651559">byte</span><span class="op" id="2651563">,</span>&nbsp;<span class="ident" id="2651565">flags</span>&nbsp;<span class="builtintype" id="2651571">int</span><span class="op" id="2651574">)</span>&nbsp;<span class="op" id="2651576">(</span><span class="ident" id="2651577">n</span>&nbsp;<span class="builtintype" id="2651579">int</span><span class="op" id="2651582">,</span>&nbsp;<span class="ident" id="2651584">from</span>&nbsp;<span class="ident" id="2651589">Sockaddr</span><span class="op" id="2651597">,</span>&nbsp;<span class="ident" id="2651599">err</span>&nbsp;<span class="builtintype" id="2651603">error</span><span class="op" id="2651608">)</span>&nbsp;<span class="op" id="2651610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651613">var</span>&nbsp;<span class="ident" id="2651617">rsa</span>&nbsp;<span class="ident" id="2651621">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651637">var</span>&nbsp;<span class="builtinfunc" id="2651641">len</span>&nbsp;<span class="ident" id="2651645">_Socklen</span>&nbsp;<span class="op" id="2651654">=</span>&nbsp;<span class="ident" id="2651656">SizeofSockaddrAny</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651675">if</span>&nbsp;<span class="ident" id="2651678">n</span><span class="op" id="2651679">,</span>&nbsp;<span class="ident" id="2651681">err</span>&nbsp;<span class="op" id="2651685">=</span>&nbsp;<span class="ident" id="2651687">recvfrom</span><span class="op" id="2651695">(</span><span class="ident" id="2651696">fd</span><span class="op" id="2651698">,</span>&nbsp;<span class="ident" id="2651700">p</span><span class="op" id="2651701">,</span>&nbsp;<span class="ident" id="2651703">flags</span><span class="op" id="2651708">,</span>&nbsp;<span class="op" id="2651710">&amp;</span><span class="ident" id="2651711">rsa</span><span class="op" id="2651714">,</span>&nbsp;<span class="op" id="2651716">&amp;</span><span class="builtinfunc" id="2651717">len</span><span class="op" id="2651720">)</span><span class="op" id="2651721">;</span>&nbsp;<span class="ident" id="2651723">err</span>&nbsp;<span class="op" id="2651727">!=</span>&nbsp;<span class="ident" id="2651730">nil</span>&nbsp;<span class="op" id="2651734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651738">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2651746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651749">if</span>&nbsp;<span class="ident" id="2651752">rsa</span><span class="op" id="2651755">.</span><span class="ident" id="2651756">Addr</span><span class="op" id="2651760">.</span><span class="ident" id="2651761">Family</span>&nbsp;<span class="op" id="2651768">!=</span>&nbsp;<span class="ident" id="2651771">AF_UNSPEC</span>&nbsp;<span class="op" id="2651781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2651785">from</span><span class="op" id="2651789">,</span>&nbsp;<span class="ident" id="2651791">err</span>&nbsp;<span class="op" id="2651795">=</span>&nbsp;<span class="ident" id="2651797">anyToSockaddr</span><span class="op" id="2651810">(</span><span class="op" id="2651811">&amp;</span><span class="ident" id="2651812">rsa</span><span class="op" id="2651815">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2651818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651821">return</span><br>
<span class="lineno"></span><span class="op" id="2651828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2651831">func</span>&nbsp;<span class="ident" id="2651836">Sendto</span><span class="op" id="2651842">(</span><span class="ident" id="2651843">fd</span>&nbsp;<span class="builtintype" id="2651846">int</span><span class="op" id="2651849">,</span>&nbsp;<span class="ident" id="2651851">p</span>&nbsp;<span class="op" id="2651853">[</span><span class="op" id="2651854">]</span><span class="builtintype" id="2651855">byte</span><span class="op" id="2651859">,</span>&nbsp;<span class="ident" id="2651861">flags</span>&nbsp;<span class="builtintype" id="2651867">int</span><span class="op" id="2651870">,</span>&nbsp;<span class="ident" id="2651872">to</span>&nbsp;<span class="ident" id="2651875">Sockaddr</span><span class="op" id="2651883">)</span>&nbsp;<span class="op" id="2651885">(</span><span class="ident" id="2651886">err</span>&nbsp;<span class="builtintype" id="2651890">error</span><span class="op" id="2651895">)</span>&nbsp;<span class="op" id="2651897">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2651900">ptr</span><span class="op" id="2651903">,</span>&nbsp;<span class="ident" id="2651905">n</span><span class="op" id="2651906">,</span>&nbsp;<span class="ident" id="2651908">err</span>&nbsp;<span class="op" id="2651912">:=</span>&nbsp;<span class="ident" id="2651915">to</span><span class="op" id="2651917">.</span><span class="ident" id="2651918">sockaddr</span><span class="op" id="2651926">(</span><span class="op" id="2651927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651930">if</span>&nbsp;<span class="ident" id="2651933">err</span>&nbsp;<span class="op" id="2651937">!=</span>&nbsp;<span class="ident" id="2651940">nil</span>&nbsp;<span class="op" id="2651944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651948">return</span>&nbsp;<span class="ident" id="2651955">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2651960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2651963">return</span>&nbsp;<span class="ident" id="2651970">sendto</span><span class="op" id="2651976">(</span><span class="ident" id="2651977">fd</span><span class="op" id="2651979">,</span>&nbsp;<span class="ident" id="2651981">p</span><span class="op" id="2651982">,</span>&nbsp;<span class="ident" id="2651984">flags</span><span class="op" id="2651989">,</span>&nbsp;<span class="ident" id="2651991">ptr</span><span class="op" id="2651994">,</span>&nbsp;<span class="ident" id="2651996">n</span><span class="op" id="2651997">)</span><br>
<span class="lineno">235</span><span class="op" id="2651999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2652002">func</span>&nbsp;<span class="ident" id="2652007">SetsockoptByte</span><span class="op" id="2652021">(</span><span class="ident" id="2652022">fd</span><span class="op" id="2652024">,</span>&nbsp;<span class="ident" id="2652026">level</span><span class="op" id="2652031">,</span>&nbsp;<span class="ident" id="2652033">opt</span>&nbsp;<span class="builtintype" id="2652037">int</span><span class="op" id="2652040">,</span>&nbsp;<span class="ident" id="2652042">value</span>&nbsp;<span class="builtintype" id="2652048">byte</span><span class="op" id="2652052">)</span>&nbsp;<span class="op" id="2652054">(</span><span class="ident" id="2652055">err</span>&nbsp;<span class="builtintype" id="2652059">error</span><span class="op" id="2652064">)</span>&nbsp;<span class="op" id="2652066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2652069">return</span>&nbsp;<span class="ident" id="2652076">setsockopt</span><span class="op" id="2652086">(</span><span class="ident" id="2652087">fd</span><span class="op" id="2652089">,</span>&nbsp;<span class="ident" id="2652091">level</span><span class="op" id="2652096">,</span>&nbsp;<span class="ident" id="2652098">opt</span><span class="op" id="2652101">,</span>&nbsp;<span class="ident" id="2652103">unsafe</span><span class="op" id="2652109">.</span><span class="ident" id="2652110">Pointer</span><span class="op" id="2652117">(</span><span class="op" id="2652118">&amp;</span><span class="ident" id="2652119">value</span><span class="op" id="2652124">)</span><span class="op" id="2652125">,</span>&nbsp;<span class="num" id="2652127">1</span><span class="op" id="2652128">)</span><br>
<span class="lineno"></span><span class="op" id="2652130">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="2652133">func</span>&nbsp;<span class="ident" id="2652138">SetsockoptInt</span><span class="op" id="2652151">(</span><span class="ident" id="2652152">fd</span><span class="op" id="2652154">,</span>&nbsp;<span class="ident" id="2652156">level</span><span class="op" id="2652161">,</span>&nbsp;<span class="ident" id="2652163">opt</span>&nbsp;<span class="builtintype" id="2652167">int</span><span class="op" id="2652170">,</span>&nbsp;<span class="ident" id="2652172">value</span>&nbsp;<span class="builtintype" id="2652178">int</span><span class="op" id="2652181">)</span>&nbsp;<span class="op" id="2652183">(</span><span class="ident" id="2652184">err</span>&nbsp;<span class="builtintype" id="2652188">error</span><span class="op" id="2652193">)</span>&nbsp;<span class="op" id="2652195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2652198">var</span>&nbsp;<span class="ident" id="2652202">n</span>&nbsp;<span class="op" id="2652204">=</span>&nbsp;<span class="builtintype" id="2652206">int32</span><span class="op" id="2652211">(</span><span class="ident" id="2652212">value</span><span class="op" id="2652217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2652220">return</span>&nbsp;<span class="ident" id="2652227">setsockopt</span><span class="op" id="2652237">(</span><span class="ident" id="2652238">fd</span><span class="op" id="2652240">,</span>&nbsp;<span class="ident" id="2652242">level</span><span class="op" id="2652247">,</span>&nbsp;<span class="ident" id="2652249">opt</span><span class="op" id="2652252">,</span>&nbsp;<span class="ident" id="2652254">unsafe</span><span class="op" id="2652260">.</span><span class="ident" id="2652261">Pointer</span><span class="op" id="2652268">(</span><span class="op" id="2652269">&amp;</span><span class="ident" id="2652270">n</span><span class="op" id="2652271">)</span><span class="op" id="2652272">,</span>&nbsp;<span class="num" id="2652274">4</span><span class="op" id="2652275">)</span><br>
<span class="lineno"></span><span class="op" id="2652277">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="2652280">func</span>&nbsp;<span class="ident" id="2652285">SetsockoptInet4Addr</span><span class="op" id="2652304">(</span><span class="ident" id="2652305">fd</span><span class="op" id="2652307">,</span>&nbsp;<span class="ident" id="2652309">level</span><span class="op" id="2652314">,</span>&nbsp;<span class="ident" id="2652316">opt</span>&nbsp;<span class="builtintype" id="2652320">int</span><span class="op" id="2652323">,</span>&nbsp;<span class="ident" id="2652325">value</span>&nbsp;<span class="op" id="2652331">[</span><span class="num" id="2652332">4</span><span class="op" id="2652333">]</span><span class="builtintype" id="2652334">byte</span><span class="op" id="2652338">)</span>&nbsp;<span class="op" id="2652340">(</span><span class="ident" id="2652341">err</span>&nbsp;<span class="builtintype" id="2652345">error</span><span class="op" id="2652350">)</span>&nbsp;<span class="op" id="2652352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2652355">return</span>&nbsp;<span class="ident" id="2652362">setsockopt</span><span class="op" id="2652372">(</span><span class="ident" id="2652373">fd</span><span class="op" id="2652375">,</span>&nbsp;<span class="ident" id="2652377">level</span><span class="op" id="2652382">,</span>&nbsp;<span class="ident" id="2652384">opt</span><span class="op" id="2652387">,</span>&nbsp;<span class="ident" id="2652389">unsafe</span><span class="op" id="2652395">.</span><span class="ident" id="2652396">Pointer</span><span class="op" id="2652403">(</span><span class="op" id="2652404">&amp;</span><span class="ident" id="2652405">value</span><span class="op" id="2652410">[</span><span class="num" id="2652411">0</span><span class="op" id="2652412">]</span><span class="op" id="2652413">)</span><span class="op" id="2652414">,</span>&nbsp;<span class="num" id="2652416">4</span><span class="op" id="2652417">)</span><br>
<span class="lineno"></span><span class="op" id="2652419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="2652422">func</span>&nbsp;<span class="ident" id="2652427">SetsockoptIPMreq</span><span class="op" id="2652443">(</span><span class="ident" id="2652444">fd</span><span class="op" id="2652446">,</span>&nbsp;<span class="ident" id="2652448">level</span><span class="op" id="2652453">,</span>&nbsp;<span class="ident" id="2652455">opt</span>&nbsp;<span class="builtintype" id="2652459">int</span><span class="op" id="2652462">,</span>&nbsp;<span class="ident" id="2652464">mreq</span>&nbsp;<span class="op" id="2652469">*</span><span class="ident" id="2652470">IPMreq</span><span class="op" id="2652476">)</span>&nbsp;<span class="op" id="2652478">(</span><span class="ident" id="2652479">err</span>&nbsp;<span class="builtintype" id="2652483">error</span><span class="op" id="2652488">)</span>&nbsp;<span class="op" id="2652490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2652493">return</span>&nbsp;<span class="ident" id="2652500">setsockopt</span><span class="op" id="2652510">(</span><span class="ident" id="2652511">fd</span><span class="op" id="2652513">,</span>&nbsp;<span class="ident" id="2652515">level</span><span class="op" id="2652520">,</span>&nbsp;<span class="ident" id="2652522">opt</span><span class="op" id="2652525">,</span>&nbsp;<span class="ident" id="2652527">unsafe</span><span class="op" id="2652533">.</span><span class="ident" id="2652534">Pointer</span><span class="op" id="2652541">(</span><span class="ident" id="2652542">mreq</span><span class="op" id="2652546">)</span><span class="op" id="2652547">,</span>&nbsp;<span class="ident" id="2652549">SizeofIPMreq</span><span class="op" id="2652561">)</span><br>
<span class="lineno"></span><span class="op" id="2652563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2652566">func</span>&nbsp;<span class="ident" id="2652571">SetsockoptIPv6Mreq</span><span class="op" id="2652589">(</span><span class="ident" id="2652590">fd</span><span class="op" id="2652592">,</span>&nbsp;<span class="ident" id="2652594">level</span><span class="op" id="2652599">,</span>&nbsp;<span class="ident" id="2652601">opt</span>&nbsp;<span class="builtintype" id="2652605">int</span><span class="op" id="2652608">,</span>&nbsp;<span class="ident" id="2652610">mreq</span>&nbsp;<span class="op" id="2652615">*</span><span class="ident" id="2652616">IPv6Mreq</span><span class="op" id="2652624">)</span>&nbsp;<span class="op" id="2652626">(</span><span class="ident" id="2652627">err</span>&nbsp;<span class="builtintype" id="2652631">error</span><span class="op" id="2652636">)</span>&nbsp;<span class="op" id="2652638">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2652641">return</span>&nbsp;<span class="ident" id="2652648">setsockopt</span><span class="op" id="2652658">(</span><span class="ident" id="2652659">fd</span><span class="op" id="2652661">,</span>&nbsp;<span class="ident" id="2652663">level</span><span class="op" id="2652668">,</span>&nbsp;<span class="ident" id="2652670">opt</span><span class="op" id="2652673">,</span>&nbsp;<span class="ident" id="2652675">unsafe</span><span class="op" id="2652681">.</span><span class="ident" id="2652682">Pointer</span><span class="op" id="2652689">(</span><span class="ident" id="2652690">mreq</span><span class="op" id="2652694">)</span><span class="op" id="2652695">,</span>&nbsp;<span class="ident" id="2652697">SizeofIPv6Mreq</span><span class="op" id="2652711">)</span><br>
<span class="lineno"></span><span class="op" id="2652713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2652716">func</span>&nbsp;<span class="ident" id="2652721">SetsockoptICMPv6Filter</span><span class="op" id="2652743">(</span><span class="ident" id="2652744">fd</span><span class="op" id="2652746">,</span>&nbsp;<span class="ident" id="2652748">level</span><span class="op" id="2652753">,</span>&nbsp;<span class="ident" id="2652755">opt</span>&nbsp;<span class="builtintype" id="2652759">int</span><span class="op" id="2652762">,</span>&nbsp;<span class="ident" id="2652764">filter</span>&nbsp;<span class="op" id="2652771">*</span><span class="ident" id="2652772">ICMPv6Filter</span><span class="op" id="2652784">)</span>&nbsp;<span class="builtintype" id="2652786">error</span>&nbsp;<span class="op" id="2652792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2652795">return</span>&nbsp;<span class="ident" id="2652802">setsockopt</span><span class="op" id="2652812">(</span><span class="ident" id="2652813">fd</span><span class="op" id="2652815">,</span>&nbsp;<span class="ident" id="2652817">level</span><span class="op" id="2652822">,</span>&nbsp;<span class="ident" id="2652824">opt</span><span class="op" id="2652827">,</span>&nbsp;<span class="ident" id="2652829">unsafe</span><span class="op" id="2652835">.</span><span class="ident" id="2652836">Pointer</span><span class="op" id="2652843">(</span><span class="ident" id="2652844">filter</span><span class="op" id="2652850">)</span><span class="op" id="2652851">,</span>&nbsp;<span class="ident" id="2652853">SizeofICMPv6Filter</span><span class="op" id="2652871">)</span><br>
<span class="lineno">260</span><span class="op" id="2652873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2652876">func</span>&nbsp;<span class="ident" id="2652881">SetsockoptLinger</span><span class="op" id="2652897">(</span><span class="ident" id="2652898">fd</span><span class="op" id="2652900">,</span>&nbsp;<span class="ident" id="2652902">level</span><span class="op" id="2652907">,</span>&nbsp;<span class="ident" id="2652909">opt</span>&nbsp;<span class="builtintype" id="2652913">int</span><span class="op" id="2652916">,</span>&nbsp;<span class="ident" id="2652918">l</span>&nbsp;<span class="op" id="2652920">*</span><span class="ident" id="2652921">Linger</span><span class="op" id="2652927">)</span>&nbsp;<span class="op" id="2652929">(</span><span class="ident" id="2652930">err</span>&nbsp;<span class="builtintype" id="2652934">error</span><span class="op" id="2652939">)</span>&nbsp;<span class="op" id="2652941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2652944">return</span>&nbsp;<span class="ident" id="2652951">setsockopt</span><span class="op" id="2652961">(</span><span class="ident" id="2652962">fd</span><span class="op" id="2652964">,</span>&nbsp;<span class="ident" id="2652966">level</span><span class="op" id="2652971">,</span>&nbsp;<span class="ident" id="2652973">opt</span><span class="op" id="2652976">,</span>&nbsp;<span class="ident" id="2652978">unsafe</span><span class="op" id="2652984">.</span><span class="ident" id="2652985">Pointer</span><span class="op" id="2652992">(</span><span class="ident" id="2652993">l</span><span class="op" id="2652994">)</span><span class="op" id="2652995">,</span>&nbsp;<span class="ident" id="2652997">SizeofLinger</span><span class="op" id="2653009">)</span><br>
<span class="lineno"></span><span class="op" id="2653011">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="2653014">func</span>&nbsp;<span class="ident" id="2653019">SetsockoptString</span><span class="op" id="2653035">(</span><span class="ident" id="2653036">fd</span><span class="op" id="2653038">,</span>&nbsp;<span class="ident" id="2653040">level</span><span class="op" id="2653045">,</span>&nbsp;<span class="ident" id="2653047">opt</span>&nbsp;<span class="builtintype" id="2653051">int</span><span class="op" id="2653054">,</span>&nbsp;<span class="ident" id="2653056">s</span>&nbsp;<span class="builtintype" id="2653058">string</span><span class="op" id="2653064">)</span>&nbsp;<span class="op" id="2653066">(</span><span class="ident" id="2653067">err</span>&nbsp;<span class="builtintype" id="2653071">error</span><span class="op" id="2653076">)</span>&nbsp;<span class="op" id="2653078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2653081">return</span>&nbsp;<span class="ident" id="2653088">setsockopt</span><span class="op" id="2653098">(</span><span class="ident" id="2653099">fd</span><span class="op" id="2653101">,</span>&nbsp;<span class="ident" id="2653103">level</span><span class="op" id="2653108">,</span>&nbsp;<span class="ident" id="2653110">opt</span><span class="op" id="2653113">,</span>&nbsp;<span class="ident" id="2653115">unsafe</span><span class="op" id="2653121">.</span><span class="ident" id="2653122">Pointer</span><span class="op" id="2653129">(</span><span class="op" id="2653130">&amp;</span><span class="op" id="2653131">[</span><span class="op" id="2653132">]</span><span class="builtintype" id="2653133">byte</span><span class="op" id="2653137">(</span><span class="ident" id="2653138">s</span><span class="op" id="2653139">)</span><span class="op" id="2653140">[</span><span class="num" id="2653141">0</span><span class="op" id="2653142">]</span><span class="op" id="2653143">)</span><span class="op" id="2653144">,</span>&nbsp;<span class="builtintype" id="2653146">uintptr</span><span class="op" id="2653153">(</span><span class="builtinfunc" id="2653154">len</span><span class="op" id="2653157">(</span><span class="ident" id="2653158">s</span><span class="op" id="2653159">)</span><span class="op" id="2653160">)</span><span class="op" id="2653161">)</span><br>
<span class="lineno"></span><span class="op" id="2653163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="2653166">func</span>&nbsp;<span class="ident" id="2653171">SetsockoptTimeval</span><span class="op" id="2653188">(</span><span class="ident" id="2653189">fd</span><span class="op" id="2653191">,</span>&nbsp;<span class="ident" id="2653193">level</span><span class="op" id="2653198">,</span>&nbsp;<span class="ident" id="2653200">opt</span>&nbsp;<span class="builtintype" id="2653204">int</span><span class="op" id="2653207">,</span>&nbsp;<span class="ident" id="2653209">tv</span>&nbsp;<span class="op" id="2653212">*</span><span class="ident" id="2653213">Timeval</span><span class="op" id="2653220">)</span>&nbsp;<span class="op" id="2653222">(</span><span class="ident" id="2653223">err</span>&nbsp;<span class="builtintype" id="2653227">error</span><span class="op" id="2653232">)</span>&nbsp;<span class="op" id="2653234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2653237">return</span>&nbsp;<span class="ident" id="2653244">setsockopt</span><span class="op" id="2653254">(</span><span class="ident" id="2653255">fd</span><span class="op" id="2653257">,</span>&nbsp;<span class="ident" id="2653259">level</span><span class="op" id="2653264">,</span>&nbsp;<span class="ident" id="2653266">opt</span><span class="op" id="2653269">,</span>&nbsp;<span class="ident" id="2653271">unsafe</span><span class="op" id="2653277">.</span><span class="ident" id="2653278">Pointer</span><span class="op" id="2653285">(</span><span class="ident" id="2653286">tv</span><span class="op" id="2653288">)</span><span class="op" id="2653289">,</span>&nbsp;<span class="ident" id="2653291">unsafe</span><span class="op" id="2653297">.</span><span class="ident" id="2653298">Sizeof</span><span class="op" id="2653304">(</span><span class="op" id="2653305">*</span><span class="ident" id="2653306">tv</span><span class="op" id="2653308">)</span><span class="op" id="2653309">)</span><br>
<span class="lineno"></span><span class="op" id="2653311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2653314">func</span>&nbsp;<span class="ident" id="2653319">Socket</span><span class="op" id="2653325">(</span><span class="ident" id="2653326">domain</span><span class="op" id="2653332">,</span>&nbsp;<span class="ident" id="2653334">typ</span><span class="op" id="2653337">,</span>&nbsp;<span class="ident" id="2653339">proto</span>&nbsp;<span class="builtintype" id="2653345">int</span><span class="op" id="2653348">)</span>&nbsp;<span class="op" id="2653350">(</span><span class="ident" id="2653351">fd</span>&nbsp;<span class="builtintype" id="2653354">int</span><span class="op" id="2653357">,</span>&nbsp;<span class="ident" id="2653359">err</span>&nbsp;<span class="builtintype" id="2653363">error</span><span class="op" id="2653368">)</span>&nbsp;<span class="op" id="2653370">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2653373">if</span>&nbsp;<span class="ident" id="2653376">domain</span>&nbsp;<span class="op" id="2653383">==</span>&nbsp;<span class="ident" id="2653386">AF_INET6</span>&nbsp;<span class="op" id="2653395">&amp;&amp;</span>&nbsp;<span class="ident" id="2653398">SocketDisableIPv6</span>&nbsp;<span class="op" id="2653416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2653420">return</span>&nbsp;<span class="op" id="2653427">-</span><span class="num" id="2653428">1</span><span class="op" id="2653429">,</span>&nbsp;<span class="ident" id="2653431">EAFNOSUPPORT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2653445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2653448">fd</span><span class="op" id="2653450">,</span>&nbsp;<span class="ident" id="2653452">err</span>&nbsp;<span class="op" id="2653456">=</span>&nbsp;<span class="ident" id="2653458">socket</span><span class="op" id="2653464">(</span><span class="ident" id="2653465">domain</span><span class="op" id="2653471">,</span>&nbsp;<span class="ident" id="2653473">typ</span><span class="op" id="2653476">,</span>&nbsp;<span class="ident" id="2653478">proto</span><span class="op" id="2653483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2653486">return</span><br>
<span class="lineno">280</span><span class="op" id="2653493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2653496">func</span>&nbsp;<span class="ident" id="2653501">Socketpair</span><span class="op" id="2653511">(</span><span class="ident" id="2653512">domain</span><span class="op" id="2653518">,</span>&nbsp;<span class="ident" id="2653520">typ</span><span class="op" id="2653523">,</span>&nbsp;<span class="ident" id="2653525">proto</span>&nbsp;<span class="builtintype" id="2653531">int</span><span class="op" id="2653534">)</span>&nbsp;<span class="op" id="2653536">(</span><span class="ident" id="2653537">fd</span>&nbsp;<span class="op" id="2653540">[</span><span class="num" id="2653541">2</span><span class="op" id="2653542">]</span><span class="builtintype" id="2653543">int</span><span class="op" id="2653546">,</span>&nbsp;<span class="ident" id="2653548">err</span>&nbsp;<span class="builtintype" id="2653552">error</span><span class="op" id="2653557">)</span>&nbsp;<span class="op" id="2653559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2653562">var</span>&nbsp;<span class="ident" id="2653566">fdx</span>&nbsp;<span class="op" id="2653570">[</span><span class="num" id="2653571">2</span><span class="op" id="2653572">]</span><span class="builtintype" id="2653573">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2653580">err</span>&nbsp;<span class="op" id="2653584">=</span>&nbsp;<span class="ident" id="2653586">socketpair</span><span class="op" id="2653596">(</span><span class="ident" id="2653597">domain</span><span class="op" id="2653603">,</span>&nbsp;<span class="ident" id="2653605">typ</span><span class="op" id="2653608">,</span>&nbsp;<span class="ident" id="2653610">proto</span><span class="op" id="2653615">,</span>&nbsp;<span class="op" id="2653617">&amp;</span><span class="ident" id="2653618">fdx</span><span class="op" id="2653621">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2653624">if</span>&nbsp;<span class="ident" id="2653627">err</span>&nbsp;<span class="op" id="2653631">==</span>&nbsp;<span class="ident" id="2653634">nil</span>&nbsp;<span class="op" id="2653638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2653642">fd</span><span class="op" id="2653644">[</span><span class="num" id="2653645">0</span><span class="op" id="2653646">]</span>&nbsp;<span class="op" id="2653648">=</span>&nbsp;<span class="builtintype" id="2653650">int</span><span class="op" id="2653653">(</span><span class="ident" id="2653654">fdx</span><span class="op" id="2653657">[</span><span class="num" id="2653658">0</span><span class="op" id="2653659">]</span><span class="op" id="2653660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2653664">fd</span><span class="op" id="2653666">[</span><span class="num" id="2653667">1</span><span class="op" id="2653668">]</span>&nbsp;<span class="op" id="2653670">=</span>&nbsp;<span class="builtintype" id="2653672">int</span><span class="op" id="2653675">(</span><span class="ident" id="2653676">fdx</span><span class="op" id="2653679">[</span><span class="num" id="2653680">1</span><span class="op" id="2653681">]</span><span class="op" id="2653682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2653685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2653688">return</span><br>
<span class="lineno">290</span><span class="op" id="2653695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2653698">func</span>&nbsp;<span class="ident" id="2653703">Sendfile</span><span class="op" id="2653711">(</span><span class="ident" id="2653712">outfd</span>&nbsp;<span class="builtintype" id="2653718">int</span><span class="op" id="2653721">,</span>&nbsp;<span class="ident" id="2653723">infd</span>&nbsp;<span class="builtintype" id="2653728">int</span><span class="op" id="2653731">,</span>&nbsp;<span class="ident" id="2653733">offset</span>&nbsp;<span class="op" id="2653740">*</span><span class="ident" id="2653741">int64</span><span class="op" id="2653746">,</span>&nbsp;<span class="ident" id="2653748">count</span>&nbsp;<span class="builtintype" id="2653754">int</span><span class="op" id="2653757">)</span>&nbsp;<span class="op" id="2653759">(</span><span class="ident" id="2653760">written</span>&nbsp;<span class="builtintype" id="2653768">int</span><span class="op" id="2653771">,</span>&nbsp;<span class="ident" id="2653773">err</span>&nbsp;<span class="builtintype" id="2653777">error</span><span class="op" id="2653782">)</span>&nbsp;<span class="op" id="2653784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2653787">if</span>&nbsp;<span class="ident" id="2653790">raceenabled</span>&nbsp;<span class="op" id="2653802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2653806">raceReleaseMerge</span><span class="op" id="2653822">(</span><span class="ident" id="2653823">unsafe</span><span class="op" id="2653829">.</span><span class="ident" id="2653830">Pointer</span><span class="op" id="2653837">(</span><span class="op" id="2653838">&amp;</span><span class="ident" id="2653839">ioSync</span><span class="op" id="2653845">)</span><span class="op" id="2653846">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2653849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2653852">return</span>&nbsp;<span class="ident" id="2653859">sendfile</span><span class="op" id="2653867">(</span><span class="ident" id="2653868">outfd</span><span class="op" id="2653873">,</span>&nbsp;<span class="ident" id="2653875">infd</span><span class="op" id="2653879">,</span>&nbsp;<span class="ident" id="2653881">offset</span><span class="op" id="2653887">,</span>&nbsp;<span class="ident" id="2653889">count</span><span class="op" id="2653894">)</span><br>
<span class="lineno"></span><span class="op" id="2653896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2653899">var</span>&nbsp;<span class="ident" id="2653903">ioSync</span>&nbsp;<span class="ident" id="2653910">int64</span>
</div>
</body>
</html>
