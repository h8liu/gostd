<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html" class="current">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1410059">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1410115">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1410169">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1410220">//&nbsp;Package&nbsp;atomic&nbsp;provides&nbsp;low-level&nbsp;atomic&nbsp;memory&nbsp;primitives</span><br>
<span class="lineno"></span><span class="comment" id="1410282">//&nbsp;useful&nbsp;for&nbsp;implementing&nbsp;synchronization&nbsp;algorithms.</span><br>
<span class="lineno"></span><span class="comment" id="1410337">//</span><br>
<span class="lineno"></span><span class="comment" id="1410340">//&nbsp;These&nbsp;functions&nbsp;require&nbsp;great&nbsp;care&nbsp;to&nbsp;be&nbsp;used&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="comment" id="1410400">//&nbsp;Except&nbsp;for&nbsp;special,&nbsp;low-level&nbsp;applications,&nbsp;synchronization&nbsp;is&nbsp;better</span><br>
<span class="lineno">10</span><span class="comment" id="1410473">//&nbsp;done&nbsp;with&nbsp;channels&nbsp;or&nbsp;the&nbsp;facilities&nbsp;of&nbsp;the&nbsp;sync&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="1410534">//&nbsp;Share&nbsp;memory&nbsp;by&nbsp;communicating;</span><br>
<span class="lineno"></span><span class="comment" id="1410568">//&nbsp;don&#39;t&nbsp;communicate&nbsp;by&nbsp;sharing&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1410608">//</span><br>
<span class="lineno"></span><span class="comment" id="1410611">//&nbsp;The&nbsp;swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;SwapT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno">15</span><span class="comment" id="1410684">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1410702">//</span><br>
<span class="lineno"></span><span class="comment" id="1410705">//&nbsp;&nbsp;&nbsp;&nbsp;old&nbsp;=&nbsp;*addr</span><br>
<span class="lineno"></span><span class="comment" id="1410720">//&nbsp;&nbsp;&nbsp;&nbsp;*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1410735">//&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;old</span><br>
<span class="lineno">20</span><span class="comment" id="1410749">//</span><br>
<span class="lineno"></span><span class="comment" id="1410752">//&nbsp;The&nbsp;compare-and-swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;CompareAndSwapT</span><br>
<span class="lineno"></span><span class="comment" id="1410822">//&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1410865">//</span><br>
<span class="lineno"></span><span class="comment" id="1410868">//&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;*addr&nbsp;==&nbsp;old&nbsp;{</span><br>
<span class="lineno">25</span><span class="comment" id="1410889">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1410905">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="1410921">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="1410926">//&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false</span><br>
<span class="lineno"></span><span class="comment" id="1410942">//</span><br>
<span class="lineno">30</span><span class="comment" id="1410945">//&nbsp;The&nbsp;add&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;AddT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno"></span><span class="comment" id="1411016">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1411034">//</span><br>
<span class="lineno"></span><span class="comment" id="1411037">//&nbsp;&nbsp;&nbsp;&nbsp;*addr&nbsp;+=&nbsp;delta</span><br>
<span class="lineno"></span><span class="comment" id="1411055">//&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;*addr</span><br>
<span class="lineno">35</span><span class="comment" id="1411071">//</span><br>
<span class="lineno"></span><span class="comment" id="1411074">//&nbsp;The&nbsp;load&nbsp;and&nbsp;store&nbsp;operations,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;LoadT&nbsp;and&nbsp;StoreT</span><br>
<span class="lineno"></span><span class="comment" id="1411144">//&nbsp;functions,&nbsp;are&nbsp;the&nbsp;atomic&nbsp;equivalents&nbsp;of&nbsp;&#34;return&nbsp;*addr&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1411207">//&nbsp;&#34;*addr&nbsp;=&nbsp;val&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1411225">//</span><br>
<span class="lineno">40</span><span class="keyword" id="1411228">package</span>&nbsp;<span class="ident" id="1411236">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1411244">import</span>&nbsp;<span class="op" id="1411251">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1411254">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1411263">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1411266">//&nbsp;BUG(rsc):&nbsp;On&nbsp;x86-32,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;Pentium&nbsp;MMX.</span><br>
<span class="lineno"></span><span class="comment" id="1411364">//</span><br>
<span class="lineno"></span><span class="comment" id="1411367">//&nbsp;On&nbsp;non-Linux&nbsp;ARM,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;ARMv6k&nbsp;core.</span><br>
<span class="lineno"></span><span class="comment" id="1411462">//</span><br>
<span class="lineno">50</span><span class="comment" id="1411465">//&nbsp;On&nbsp;both&nbsp;ARM&nbsp;and&nbsp;x86-32,&nbsp;it&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;arrange&nbsp;for&nbsp;64-bit</span><br>
<span class="lineno"></span><span class="comment" id="1411548">//&nbsp;alignment&nbsp;of&nbsp;64-bit&nbsp;words&nbsp;accessed&nbsp;atomically.&nbsp;The&nbsp;first&nbsp;word&nbsp;in&nbsp;a&nbsp;global</span><br>
<span class="lineno"></span><span class="comment" id="1411625">//&nbsp;variable&nbsp;or&nbsp;in&nbsp;an&nbsp;allocated&nbsp;struct&nbsp;or&nbsp;slice&nbsp;can&nbsp;be&nbsp;relied&nbsp;upon&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1411697">//&nbsp;64-bit&nbsp;aligned.</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1411717">//&nbsp;SwapInt32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1411801">func</span>&nbsp;<span class="ident" id="1411806">SwapInt32</span><span class="op" id="1411815">(</span><span class="ident" id="1411816">addr</span>&nbsp;<span class="op" id="1411821">*</span><span class="builtintype" id="1411822">int32</span><span class="op" id="1411827">,</span>&nbsp;<span class="builtinfunc" id="1411829">new</span>&nbsp;<span class="builtintype" id="1411833">int32</span><span class="op" id="1411838">)</span>&nbsp;<span class="op" id="1411840">(</span><span class="ident" id="1411841">old</span>&nbsp;<span class="builtintype" id="1411845">int32</span><span class="op" id="1411850">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1411853">//&nbsp;SwapInt64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1411937">func</span>&nbsp;<span class="ident" id="1411942">SwapInt64</span><span class="op" id="1411951">(</span><span class="ident" id="1411952">addr</span>&nbsp;<span class="op" id="1411957">*</span><span class="ident" id="1411958">int64</span><span class="op" id="1411963">,</span>&nbsp;<span class="builtinfunc" id="1411965">new</span>&nbsp;<span class="ident" id="1411969">int64</span><span class="op" id="1411974">)</span>&nbsp;<span class="op" id="1411976">(</span><span class="ident" id="1411977">old</span>&nbsp;<span class="ident" id="1411981">int64</span><span class="op" id="1411986">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="1411989">//&nbsp;SwapUint32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1412074">func</span>&nbsp;<span class="ident" id="1412079">SwapUint32</span><span class="op" id="1412089">(</span><span class="ident" id="1412090">addr</span>&nbsp;<span class="op" id="1412095">*</span><span class="builtintype" id="1412096">uint32</span><span class="op" id="1412102">,</span>&nbsp;<span class="builtinfunc" id="1412104">new</span>&nbsp;<span class="builtintype" id="1412108">uint32</span><span class="op" id="1412114">)</span>&nbsp;<span class="op" id="1412116">(</span><span class="ident" id="1412117">old</span>&nbsp;<span class="builtintype" id="1412121">uint32</span><span class="op" id="1412127">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1412130">//&nbsp;SwapUint64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno">65</span><span class="keyword" id="1412215">func</span>&nbsp;<span class="ident" id="1412220">SwapUint64</span><span class="op" id="1412230">(</span><span class="ident" id="1412231">addr</span>&nbsp;<span class="op" id="1412236">*</span><span class="ident" id="1412237">uint64</span><span class="op" id="1412243">,</span>&nbsp;<span class="builtinfunc" id="1412245">new</span>&nbsp;<span class="ident" id="1412249">uint64</span><span class="op" id="1412255">)</span>&nbsp;<span class="op" id="1412257">(</span><span class="ident" id="1412258">old</span>&nbsp;<span class="ident" id="1412262">uint64</span><span class="op" id="1412268">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1412271">//&nbsp;SwapUintptr&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1412357">func</span>&nbsp;<span class="ident" id="1412362">SwapUintptr</span><span class="op" id="1412373">(</span><span class="ident" id="1412374">addr</span>&nbsp;<span class="op" id="1412379">*</span><span class="builtintype" id="1412380">uintptr</span><span class="op" id="1412387">,</span>&nbsp;<span class="builtinfunc" id="1412389">new</span>&nbsp;<span class="builtintype" id="1412393">uintptr</span><span class="op" id="1412400">)</span>&nbsp;<span class="op" id="1412402">(</span><span class="ident" id="1412403">old</span>&nbsp;<span class="builtintype" id="1412407">uintptr</span><span class="op" id="1412414">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="1412417">//&nbsp;SwapPointer&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1412503">func</span>&nbsp;<span class="ident" id="1412508">SwapPointer</span><span class="op" id="1412519">(</span><span class="ident" id="1412520">addr</span>&nbsp;<span class="op" id="1412525">*</span><span class="ident" id="1412526">unsafe</span><span class="op" id="1412532">.</span><span class="ident" id="1412533">Pointer</span><span class="op" id="1412540">,</span>&nbsp;<span class="builtinfunc" id="1412542">new</span>&nbsp;<span class="ident" id="1412546">unsafe</span><span class="op" id="1412552">.</span><span class="ident" id="1412553">Pointer</span><span class="op" id="1412560">)</span>&nbsp;<span class="op" id="1412562">(</span><span class="ident" id="1412563">old</span>&nbsp;<span class="ident" id="1412567">unsafe</span><span class="op" id="1412573">.</span><span class="ident" id="1412574">Pointer</span><span class="op" id="1412581">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1412584">//&nbsp;CompareAndSwapInt32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int32&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1412667">func</span>&nbsp;<span class="ident" id="1412672">CompareAndSwapInt32</span><span class="op" id="1412691">(</span><span class="ident" id="1412692">addr</span>&nbsp;<span class="op" id="1412697">*</span><span class="builtintype" id="1412698">int32</span><span class="op" id="1412703">,</span>&nbsp;<span class="ident" id="1412705">old</span><span class="op" id="1412708">,</span>&nbsp;<span class="builtinfunc" id="1412710">new</span>&nbsp;<span class="builtintype" id="1412714">int32</span><span class="op" id="1412719">)</span>&nbsp;<span class="op" id="1412721">(</span><span class="ident" id="1412722">swapped</span>&nbsp;<span class="builtintype" id="1412730">bool</span><span class="op" id="1412734">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="1412737">//&nbsp;CompareAndSwapInt64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1412820">func</span>&nbsp;<span class="ident" id="1412825">CompareAndSwapInt64</span><span class="op" id="1412844">(</span><span class="ident" id="1412845">addr</span>&nbsp;<span class="op" id="1412850">*</span><span class="ident" id="1412851">int64</span><span class="op" id="1412856">,</span>&nbsp;<span class="ident" id="1412858">old</span><span class="op" id="1412861">,</span>&nbsp;<span class="builtinfunc" id="1412863">new</span>&nbsp;<span class="ident" id="1412867">int64</span><span class="op" id="1412872">)</span>&nbsp;<span class="op" id="1412874">(</span><span class="ident" id="1412875">swapped</span>&nbsp;<span class="builtintype" id="1412883">bool</span><span class="op" id="1412887">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1412890">//&nbsp;CompareAndSwapUint32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint32&nbsp;value.</span><br>
<span class="lineno">80</span><span class="keyword" id="1412974">func</span>&nbsp;<span class="ident" id="1412979">CompareAndSwapUint32</span><span class="op" id="1412999">(</span><span class="ident" id="1413000">addr</span>&nbsp;<span class="op" id="1413005">*</span><span class="builtintype" id="1413006">uint32</span><span class="op" id="1413012">,</span>&nbsp;<span class="ident" id="1413014">old</span><span class="op" id="1413017">,</span>&nbsp;<span class="builtinfunc" id="1413019">new</span>&nbsp;<span class="builtintype" id="1413023">uint32</span><span class="op" id="1413029">)</span>&nbsp;<span class="op" id="1413031">(</span><span class="ident" id="1413032">swapped</span>&nbsp;<span class="builtintype" id="1413040">bool</span><span class="op" id="1413044">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1413047">//&nbsp;CompareAndSwapUint64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1413131">func</span>&nbsp;<span class="ident" id="1413136">CompareAndSwapUint64</span><span class="op" id="1413156">(</span><span class="ident" id="1413157">addr</span>&nbsp;<span class="op" id="1413162">*</span><span class="ident" id="1413163">uint64</span><span class="op" id="1413169">,</span>&nbsp;<span class="ident" id="1413171">old</span><span class="op" id="1413174">,</span>&nbsp;<span class="builtinfunc" id="1413176">new</span>&nbsp;<span class="ident" id="1413180">uint64</span><span class="op" id="1413186">)</span>&nbsp;<span class="op" id="1413188">(</span><span class="ident" id="1413189">swapped</span>&nbsp;<span class="builtintype" id="1413197">bool</span><span class="op" id="1413201">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1413204">//&nbsp;CompareAndSwapUintptr&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uintptr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1413290">func</span>&nbsp;<span class="ident" id="1413295">CompareAndSwapUintptr</span><span class="op" id="1413316">(</span><span class="ident" id="1413317">addr</span>&nbsp;<span class="op" id="1413322">*</span><span class="builtintype" id="1413323">uintptr</span><span class="op" id="1413330">,</span>&nbsp;<span class="ident" id="1413332">old</span><span class="op" id="1413335">,</span>&nbsp;<span class="builtinfunc" id="1413337">new</span>&nbsp;<span class="builtintype" id="1413341">uintptr</span><span class="op" id="1413348">)</span>&nbsp;<span class="op" id="1413350">(</span><span class="ident" id="1413351">swapped</span>&nbsp;<span class="builtintype" id="1413359">bool</span><span class="op" id="1413363">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1413366">//&nbsp;CompareAndSwapPointer&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;unsafe.Pointer&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1413459">func</span>&nbsp;<span class="ident" id="1413464">CompareAndSwapPointer</span><span class="op" id="1413485">(</span><span class="ident" id="1413486">addr</span>&nbsp;<span class="op" id="1413491">*</span><span class="ident" id="1413492">unsafe</span><span class="op" id="1413498">.</span><span class="ident" id="1413499">Pointer</span><span class="op" id="1413506">,</span>&nbsp;<span class="ident" id="1413508">old</span><span class="op" id="1413511">,</span>&nbsp;<span class="builtinfunc" id="1413513">new</span>&nbsp;<span class="ident" id="1413517">unsafe</span><span class="op" id="1413523">.</span><span class="ident" id="1413524">Pointer</span><span class="op" id="1413531">)</span>&nbsp;<span class="op" id="1413533">(</span><span class="ident" id="1413534">swapped</span>&nbsp;<span class="builtintype" id="1413542">bool</span><span class="op" id="1413546">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="1413549">//&nbsp;AddInt32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1413619">func</span>&nbsp;<span class="ident" id="1413624">AddInt32</span><span class="op" id="1413632">(</span><span class="ident" id="1413633">addr</span>&nbsp;<span class="op" id="1413638">*</span><span class="builtintype" id="1413639">int32</span><span class="op" id="1413644">,</span>&nbsp;<span class="ident" id="1413646">delta</span>&nbsp;<span class="builtintype" id="1413652">int32</span><span class="op" id="1413657">)</span>&nbsp;<span class="op" id="1413659">(</span><span class="builtinfunc" id="1413660">new</span>&nbsp;<span class="builtintype" id="1413664">int32</span><span class="op" id="1413669">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1413672">//&nbsp;AddUint32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">95</span><span class="comment" id="1413743">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1413833">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(0)).</span><br>
<span class="lineno"></span><span class="keyword" id="1413897">func</span>&nbsp;<span class="ident" id="1413902">AddUint32</span><span class="op" id="1413911">(</span><span class="ident" id="1413912">addr</span>&nbsp;<span class="op" id="1413917">*</span><span class="builtintype" id="1413918">uint32</span><span class="op" id="1413924">,</span>&nbsp;<span class="ident" id="1413926">delta</span>&nbsp;<span class="builtintype" id="1413932">uint32</span><span class="op" id="1413938">)</span>&nbsp;<span class="op" id="1413940">(</span><span class="builtinfunc" id="1413941">new</span>&nbsp;<span class="builtintype" id="1413945">uint32</span><span class="op" id="1413951">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1413954">//&nbsp;AddInt64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">100</span><span class="keyword" id="1414024">func</span>&nbsp;<span class="ident" id="1414029">AddInt64</span><span class="op" id="1414037">(</span><span class="ident" id="1414038">addr</span>&nbsp;<span class="op" id="1414043">*</span><span class="ident" id="1414044">int64</span><span class="op" id="1414049">,</span>&nbsp;<span class="ident" id="1414051">delta</span>&nbsp;<span class="ident" id="1414057">int64</span><span class="op" id="1414062">)</span>&nbsp;<span class="op" id="1414064">(</span><span class="builtinfunc" id="1414065">new</span>&nbsp;<span class="ident" id="1414069">int64</span><span class="op" id="1414074">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1414077">//&nbsp;AddUint64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1414148">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1414238">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(0)).</span><br>
<span class="lineno">105</span><span class="keyword" id="1414302">func</span>&nbsp;<span class="ident" id="1414307">AddUint64</span><span class="op" id="1414316">(</span><span class="ident" id="1414317">addr</span>&nbsp;<span class="op" id="1414322">*</span><span class="ident" id="1414323">uint64</span><span class="op" id="1414329">,</span>&nbsp;<span class="ident" id="1414331">delta</span>&nbsp;<span class="ident" id="1414337">uint64</span><span class="op" id="1414343">)</span>&nbsp;<span class="op" id="1414345">(</span><span class="builtinfunc" id="1414346">new</span>&nbsp;<span class="ident" id="1414350">uint64</span><span class="op" id="1414356">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1414359">//&nbsp;AddUintptr&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1414431">func</span>&nbsp;<span class="ident" id="1414436">AddUintptr</span><span class="op" id="1414446">(</span><span class="ident" id="1414447">addr</span>&nbsp;<span class="op" id="1414452">*</span><span class="builtintype" id="1414453">uintptr</span><span class="op" id="1414460">,</span>&nbsp;<span class="ident" id="1414462">delta</span>&nbsp;<span class="builtintype" id="1414468">uintptr</span><span class="op" id="1414475">)</span>&nbsp;<span class="op" id="1414477">(</span><span class="builtinfunc" id="1414478">new</span>&nbsp;<span class="builtintype" id="1414482">uintptr</span><span class="op" id="1414489">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1414492">//&nbsp;LoadInt32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1414529">func</span>&nbsp;<span class="ident" id="1414534">LoadInt32</span><span class="op" id="1414543">(</span><span class="ident" id="1414544">addr</span>&nbsp;<span class="op" id="1414549">*</span><span class="builtintype" id="1414550">int32</span><span class="op" id="1414555">)</span>&nbsp;<span class="op" id="1414557">(</span><span class="ident" id="1414558">val</span>&nbsp;<span class="builtintype" id="1414562">int32</span><span class="op" id="1414567">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1414570">//&nbsp;LoadInt64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1414607">func</span>&nbsp;<span class="ident" id="1414612">LoadInt64</span><span class="op" id="1414621">(</span><span class="ident" id="1414622">addr</span>&nbsp;<span class="op" id="1414627">*</span><span class="ident" id="1414628">int64</span><span class="op" id="1414633">)</span>&nbsp;<span class="op" id="1414635">(</span><span class="ident" id="1414636">val</span>&nbsp;<span class="ident" id="1414640">int64</span><span class="op" id="1414645">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1414648">//&nbsp;LoadUint32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1414686">func</span>&nbsp;<span class="ident" id="1414691">LoadUint32</span><span class="op" id="1414701">(</span><span class="ident" id="1414702">addr</span>&nbsp;<span class="op" id="1414707">*</span><span class="builtintype" id="1414708">uint32</span><span class="op" id="1414714">)</span>&nbsp;<span class="op" id="1414716">(</span><span class="ident" id="1414717">val</span>&nbsp;<span class="builtintype" id="1414721">uint32</span><span class="op" id="1414727">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1414730">//&nbsp;LoadUint64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno">120</span><span class="keyword" id="1414768">func</span>&nbsp;<span class="ident" id="1414773">LoadUint64</span><span class="op" id="1414783">(</span><span class="ident" id="1414784">addr</span>&nbsp;<span class="op" id="1414789">*</span><span class="ident" id="1414790">uint64</span><span class="op" id="1414796">)</span>&nbsp;<span class="op" id="1414798">(</span><span class="ident" id="1414799">val</span>&nbsp;<span class="ident" id="1414803">uint64</span><span class="op" id="1414809">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1414812">//&nbsp;LoadUintptr&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1414851">func</span>&nbsp;<span class="ident" id="1414856">LoadUintptr</span><span class="op" id="1414867">(</span><span class="ident" id="1414868">addr</span>&nbsp;<span class="op" id="1414873">*</span><span class="builtintype" id="1414874">uintptr</span><span class="op" id="1414881">)</span>&nbsp;<span class="op" id="1414883">(</span><span class="ident" id="1414884">val</span>&nbsp;<span class="builtintype" id="1414888">uintptr</span><span class="op" id="1414895">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="1414898">//&nbsp;LoadPointer&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1414937">func</span>&nbsp;<span class="ident" id="1414942">LoadPointer</span><span class="op" id="1414953">(</span><span class="ident" id="1414954">addr</span>&nbsp;<span class="op" id="1414959">*</span><span class="ident" id="1414960">unsafe</span><span class="op" id="1414966">.</span><span class="ident" id="1414967">Pointer</span><span class="op" id="1414974">)</span>&nbsp;<span class="op" id="1414976">(</span><span class="ident" id="1414977">val</span>&nbsp;<span class="ident" id="1414981">unsafe</span><span class="op" id="1414987">.</span><span class="ident" id="1414988">Pointer</span><span class="op" id="1414995">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1414998">//&nbsp;StoreInt32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1415046">func</span>&nbsp;<span class="ident" id="1415051">StoreInt32</span><span class="op" id="1415061">(</span><span class="ident" id="1415062">addr</span>&nbsp;<span class="op" id="1415067">*</span><span class="builtintype" id="1415068">int32</span><span class="op" id="1415073">,</span>&nbsp;<span class="ident" id="1415075">val</span>&nbsp;<span class="builtintype" id="1415079">int32</span><span class="op" id="1415084">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1415087">//&nbsp;StoreInt64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1415135">func</span>&nbsp;<span class="ident" id="1415140">StoreInt64</span><span class="op" id="1415150">(</span><span class="ident" id="1415151">addr</span>&nbsp;<span class="op" id="1415156">*</span><span class="ident" id="1415157">int64</span><span class="op" id="1415162">,</span>&nbsp;<span class="ident" id="1415164">val</span>&nbsp;<span class="ident" id="1415168">int64</span><span class="op" id="1415173">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1415176">//&nbsp;StoreUint32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno">135</span><span class="keyword" id="1415225">func</span>&nbsp;<span class="ident" id="1415230">StoreUint32</span><span class="op" id="1415241">(</span><span class="ident" id="1415242">addr</span>&nbsp;<span class="op" id="1415247">*</span><span class="builtintype" id="1415248">uint32</span><span class="op" id="1415254">,</span>&nbsp;<span class="ident" id="1415256">val</span>&nbsp;<span class="builtintype" id="1415260">uint32</span><span class="op" id="1415266">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1415269">//&nbsp;StoreUint64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1415318">func</span>&nbsp;<span class="ident" id="1415323">StoreUint64</span><span class="op" id="1415334">(</span><span class="ident" id="1415335">addr</span>&nbsp;<span class="op" id="1415340">*</span><span class="ident" id="1415341">uint64</span><span class="op" id="1415347">,</span>&nbsp;<span class="ident" id="1415349">val</span>&nbsp;<span class="ident" id="1415353">uint64</span><span class="op" id="1415359">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1415362">//&nbsp;StoreUintptr&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1415412">func</span>&nbsp;<span class="ident" id="1415417">StoreUintptr</span><span class="op" id="1415429">(</span><span class="ident" id="1415430">addr</span>&nbsp;<span class="op" id="1415435">*</span><span class="builtintype" id="1415436">uintptr</span><span class="op" id="1415443">,</span>&nbsp;<span class="ident" id="1415445">val</span>&nbsp;<span class="builtintype" id="1415449">uintptr</span><span class="op" id="1415456">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1415459">//&nbsp;StorePointer&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1415509">func</span>&nbsp;<span class="ident" id="1415514">StorePointer</span><span class="op" id="1415526">(</span><span class="ident" id="1415527">addr</span>&nbsp;<span class="op" id="1415532">*</span><span class="ident" id="1415533">unsafe</span><span class="op" id="1415539">.</span><span class="ident" id="1415540">Pointer</span><span class="op" id="1415547">,</span>&nbsp;<span class="ident" id="1415549">val</span>&nbsp;<span class="ident" id="1415553">unsafe</span><span class="op" id="1415559">.</span><span class="ident" id="1415560">Pointer</span><span class="op" id="1415567">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1415570">//&nbsp;Helper&nbsp;for&nbsp;ARM.&nbsp;&nbsp;Linker&nbsp;will&nbsp;discard&nbsp;on&nbsp;other&nbsp;systems</span><br>
<span class="lineno"></span><span class="keyword" id="1415627">func</span>&nbsp;<span class="ident" id="1415632">panic64</span><span class="op" id="1415639">(</span><span class="op" id="1415640">)</span>&nbsp;<span class="op" id="1415642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1415645">panic</span><span class="op" id="1415650">(</span><span class="string" id="1415651">&#34;sync/atomic:&nbsp;broken&nbsp;64-bit&nbsp;atomic&nbsp;operations&nbsp;(buggy&nbsp;QEMU)&#34;</span><span class="op" id="1415710">)</span><br>
<span class="lineno"></span><span class="op" id="1415712">}</span>
</div>
</body>
</html>
