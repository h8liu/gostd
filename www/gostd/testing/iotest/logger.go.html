<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing/iotest</h2>
<ul>
<li><a href="/gostd/testing/iotest/logger.go.html">logger.go</a></li>
<li><a href="/gostd/testing/iotest/reader.go.html">reader.go</a></li>
<li><a href="/gostd/testing/iotest/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6221355">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6221410">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6221464">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6221515">package</span>&nbsp;<span class="ident" id="6221523">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6221531">import</span>&nbsp;<span class="op" id="6221538">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6221541">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6221547">&#34;log&#34;</span><br>
<span class="lineno">10</span><span class="op" id="6221553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6221556">type</span>&nbsp;<span class="ident" id="6221561">writeLogger</span>&nbsp;<span class="keyword" id="6221573">struct</span>&nbsp;<span class="op" id="6221580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6221583">prefix</span>&nbsp;<span class="builtintype" id="6221590">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6221598">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6221605">io</span><span class="op" id="6221607">.</span><span class="ident" id="6221608">Writer</span><br>
<span class="lineno">15</span><span class="op" id="6221615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6221618">func</span>&nbsp;<span class="op" id="6221623">(</span><span class="ident" id="6221624">l</span>&nbsp;<span class="op" id="6221626">*</span><span class="ident" id="6221627">writeLogger</span><span class="op" id="6221638">)</span>&nbsp;<span class="ident" id="6221640">Write</span><span class="op" id="6221645">(</span><span class="ident" id="6221646">p</span>&nbsp;<span class="op" id="6221648">[</span><span class="op" id="6221649">]</span><span class="builtintype" id="6221650">byte</span><span class="op" id="6221654">)</span>&nbsp;<span class="op" id="6221656">(</span><span class="ident" id="6221657">n</span>&nbsp;<span class="builtintype" id="6221659">int</span><span class="op" id="6221662">,</span>&nbsp;<span class="ident" id="6221664">err</span>&nbsp;<span class="builtintype" id="6221668">error</span><span class="op" id="6221673">)</span>&nbsp;<span class="op" id="6221675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6221678">n</span><span class="op" id="6221679">,</span>&nbsp;<span class="ident" id="6221681">err</span>&nbsp;<span class="op" id="6221685">=</span>&nbsp;<span class="ident" id="6221687">l</span><span class="op" id="6221688">.</span><span class="ident" id="6221689">w</span><span class="op" id="6221690">.</span><span class="ident" id="6221691">Write</span><span class="op" id="6221696">(</span><span class="ident" id="6221697">p</span><span class="op" id="6221698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6221701">if</span>&nbsp;<span class="ident" id="6221704">err</span>&nbsp;<span class="op" id="6221708">!=</span>&nbsp;<span class="ident" id="6221711">nil</span>&nbsp;<span class="op" id="6221715">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6221719">log</span><span class="op" id="6221722">.</span><span class="ident" id="6221723">Printf</span><span class="op" id="6221729">(</span><span class="string" id="6221730">&#34;%s&nbsp;%x:&nbsp;%v&#34;</span><span class="op" id="6221741">,</span>&nbsp;<span class="ident" id="6221743">l</span><span class="op" id="6221744">.</span><span class="ident" id="6221745">prefix</span><span class="op" id="6221751">,</span>&nbsp;<span class="ident" id="6221753">p</span><span class="op" id="6221754">[</span><span class="num" id="6221755">0</span><span class="op" id="6221756">:</span><span class="ident" id="6221757">n</span><span class="op" id="6221758">]</span><span class="op" id="6221759">,</span>&nbsp;<span class="ident" id="6221761">err</span><span class="op" id="6221764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6221767">}</span>&nbsp;<span class="keyword" id="6221769">else</span>&nbsp;<span class="op" id="6221774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6221778">log</span><span class="op" id="6221781">.</span><span class="ident" id="6221782">Printf</span><span class="op" id="6221788">(</span><span class="string" id="6221789">&#34;%s&nbsp;%x&#34;</span><span class="op" id="6221796">,</span>&nbsp;<span class="ident" id="6221798">l</span><span class="op" id="6221799">.</span><span class="ident" id="6221800">prefix</span><span class="op" id="6221806">,</span>&nbsp;<span class="ident" id="6221808">p</span><span class="op" id="6221809">[</span><span class="num" id="6221810">0</span><span class="op" id="6221811">:</span><span class="ident" id="6221812">n</span><span class="op" id="6221813">]</span><span class="op" id="6221814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6221817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6221820">return</span><br>
<span class="lineno">25</span><span class="op" id="6221827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6221830">//&nbsp;NewWriteLogger&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that&nbsp;behaves&nbsp;like&nbsp;w&nbsp;except</span><br>
<span class="lineno"></span><span class="comment" id="6221892">//&nbsp;that&nbsp;it&nbsp;logs&nbsp;(using&nbsp;log.Printf)&nbsp;each&nbsp;write&nbsp;to&nbsp;standard&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="6221957">//&nbsp;printing&nbsp;the&nbsp;prefix&nbsp;and&nbsp;the&nbsp;hexadecimal&nbsp;data&nbsp;written.</span><br>
<span class="lineno">30</span><span class="keyword" id="6222014">func</span>&nbsp;<span class="ident" id="6222019">NewWriteLogger</span><span class="op" id="6222033">(</span><span class="ident" id="6222034">prefix</span>&nbsp;<span class="builtintype" id="6222041">string</span><span class="op" id="6222047">,</span>&nbsp;<span class="ident" id="6222049">w</span>&nbsp;<span class="ident" id="6222051">io</span><span class="op" id="6222053">.</span><span class="ident" id="6222054">Writer</span><span class="op" id="6222060">)</span>&nbsp;<span class="ident" id="6222062">io</span><span class="op" id="6222064">.</span><span class="ident" id="6222065">Writer</span>&nbsp;<span class="op" id="6222072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6222075">return</span>&nbsp;<span class="op" id="6222082">&amp;</span><span class="ident" id="6222083">writeLogger</span><span class="op" id="6222094">{</span><span class="ident" id="6222095">prefix</span><span class="op" id="6222101">,</span>&nbsp;<span class="ident" id="6222103">w</span><span class="op" id="6222104">}</span><br>
<span class="lineno"></span><span class="op" id="6222106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6222109">type</span>&nbsp;<span class="ident" id="6222114">readLogger</span>&nbsp;<span class="keyword" id="6222125">struct</span>&nbsp;<span class="op" id="6222132">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6222135">prefix</span>&nbsp;<span class="builtintype" id="6222142">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6222150">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6222157">io</span><span class="op" id="6222159">.</span><span class="ident" id="6222160">Reader</span><br>
<span class="lineno"></span><span class="op" id="6222167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6222170">func</span>&nbsp;<span class="op" id="6222175">(</span><span class="ident" id="6222176">l</span>&nbsp;<span class="op" id="6222178">*</span><span class="ident" id="6222179">readLogger</span><span class="op" id="6222189">)</span>&nbsp;<span class="ident" id="6222191">Read</span><span class="op" id="6222195">(</span><span class="ident" id="6222196">p</span>&nbsp;<span class="op" id="6222198">[</span><span class="op" id="6222199">]</span><span class="builtintype" id="6222200">byte</span><span class="op" id="6222204">)</span>&nbsp;<span class="op" id="6222206">(</span><span class="ident" id="6222207">n</span>&nbsp;<span class="builtintype" id="6222209">int</span><span class="op" id="6222212">,</span>&nbsp;<span class="ident" id="6222214">err</span>&nbsp;<span class="builtintype" id="6222218">error</span><span class="op" id="6222223">)</span>&nbsp;<span class="op" id="6222225">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6222228">n</span><span class="op" id="6222229">,</span>&nbsp;<span class="ident" id="6222231">err</span>&nbsp;<span class="op" id="6222235">=</span>&nbsp;<span class="ident" id="6222237">l</span><span class="op" id="6222238">.</span><span class="ident" id="6222239">r</span><span class="op" id="6222240">.</span><span class="ident" id="6222241">Read</span><span class="op" id="6222245">(</span><span class="ident" id="6222246">p</span><span class="op" id="6222247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6222250">if</span>&nbsp;<span class="ident" id="6222253">err</span>&nbsp;<span class="op" id="6222257">!=</span>&nbsp;<span class="ident" id="6222260">nil</span>&nbsp;<span class="op" id="6222264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6222268">log</span><span class="op" id="6222271">.</span><span class="ident" id="6222272">Printf</span><span class="op" id="6222278">(</span><span class="string" id="6222279">&#34;%s&nbsp;%x:&nbsp;%v&#34;</span><span class="op" id="6222290">,</span>&nbsp;<span class="ident" id="6222292">l</span><span class="op" id="6222293">.</span><span class="ident" id="6222294">prefix</span><span class="op" id="6222300">,</span>&nbsp;<span class="ident" id="6222302">p</span><span class="op" id="6222303">[</span><span class="num" id="6222304">0</span><span class="op" id="6222305">:</span><span class="ident" id="6222306">n</span><span class="op" id="6222307">]</span><span class="op" id="6222308">,</span>&nbsp;<span class="ident" id="6222310">err</span><span class="op" id="6222313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6222316">}</span>&nbsp;<span class="keyword" id="6222318">else</span>&nbsp;<span class="op" id="6222323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6222327">log</span><span class="op" id="6222330">.</span><span class="ident" id="6222331">Printf</span><span class="op" id="6222337">(</span><span class="string" id="6222338">&#34;%s&nbsp;%x&#34;</span><span class="op" id="6222345">,</span>&nbsp;<span class="ident" id="6222347">l</span><span class="op" id="6222348">.</span><span class="ident" id="6222349">prefix</span><span class="op" id="6222355">,</span>&nbsp;<span class="ident" id="6222357">p</span><span class="op" id="6222358">[</span><span class="num" id="6222359">0</span><span class="op" id="6222360">:</span><span class="ident" id="6222361">n</span><span class="op" id="6222362">]</span><span class="op" id="6222363">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6222366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6222369">return</span><br>
<span class="lineno"></span><span class="op" id="6222376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6222379">//&nbsp;NewReadLogger&nbsp;returns&nbsp;a&nbsp;reader&nbsp;that&nbsp;behaves&nbsp;like&nbsp;r&nbsp;except</span><br>
<span class="lineno">50</span><span class="comment" id="6222440">//&nbsp;that&nbsp;it&nbsp;logs&nbsp;(using&nbsp;log.Print)&nbsp;each&nbsp;read&nbsp;to&nbsp;standard&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="6222503">//&nbsp;printing&nbsp;the&nbsp;prefix&nbsp;and&nbsp;the&nbsp;hexadecimal&nbsp;data&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="6222560">func</span>&nbsp;<span class="ident" id="6222565">NewReadLogger</span><span class="op" id="6222578">(</span><span class="ident" id="6222579">prefix</span>&nbsp;<span class="builtintype" id="6222586">string</span><span class="op" id="6222592">,</span>&nbsp;<span class="ident" id="6222594">r</span>&nbsp;<span class="ident" id="6222596">io</span><span class="op" id="6222598">.</span><span class="ident" id="6222599">Reader</span><span class="op" id="6222605">)</span>&nbsp;<span class="ident" id="6222607">io</span><span class="op" id="6222609">.</span><span class="ident" id="6222610">Reader</span>&nbsp;<span class="op" id="6222617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6222620">return</span>&nbsp;<span class="op" id="6222627">&amp;</span><span class="ident" id="6222628">readLogger</span><span class="op" id="6222638">{</span><span class="ident" id="6222639">prefix</span><span class="op" id="6222645">,</span>&nbsp;<span class="ident" id="6222647">r</span><span class="op" id="6222648">}</span><br>
<span class="lineno"></span><span class="op" id="6222650">}</span>
</div>
</body>
</html>
