<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html" class="current">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4957785">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4957840">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4957894">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4957945">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;NewPackage.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4957982">package</span>&nbsp;<span class="ident" id="4957990">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4957995">import</span>&nbsp;<span class="op" id="4958002">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4958005">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4958012">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4958026">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4958038">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="4958048">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="4958051">type</span>&nbsp;<span class="ident" id="4958056">pkgBuilder</span>&nbsp;<span class="keyword" id="4958067">struct</span>&nbsp;<span class="op" id="4958074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958077">fset</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4958084">*</span><span class="ident" id="4958085">token</span><span class="op" id="4958090">.</span><span class="ident" id="4958091">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958100">errors</span>&nbsp;<span class="ident" id="4958107">scanner</span><span class="op" id="4958114">.</span><span class="ident" id="4958115">ErrorList</span><br>
<span class="lineno"></span><span class="op" id="4958125">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="4958128">func</span>&nbsp;<span class="op" id="4958133">(</span><span class="ident" id="4958134">p</span>&nbsp;<span class="op" id="4958136">*</span><span class="ident" id="4958137">pkgBuilder</span><span class="op" id="4958147">)</span>&nbsp;<span class="builtintype" id="4958149">error</span><span class="op" id="4958154">(</span><span class="ident" id="4958155">pos</span>&nbsp;<span class="ident" id="4958159">token</span><span class="op" id="4958164">.</span><span class="ident" id="4958165">Pos</span><span class="op" id="4958168">,</span>&nbsp;<span class="ident" id="4958170">msg</span>&nbsp;<span class="builtintype" id="4958174">string</span><span class="op" id="4958180">)</span>&nbsp;<span class="op" id="4958182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958185">p</span><span class="op" id="4958186">.</span><span class="ident" id="4958187">errors</span><span class="op" id="4958193">.</span><span class="ident" id="4958194">Add</span><span class="op" id="4958197">(</span><span class="ident" id="4958198">p</span><span class="op" id="4958199">.</span><span class="ident" id="4958200">fset</span><span class="op" id="4958204">.</span><span class="ident" id="4958205">Position</span><span class="op" id="4958213">(</span><span class="ident" id="4958214">pos</span><span class="op" id="4958217">)</span><span class="op" id="4958218">,</span>&nbsp;<span class="ident" id="4958220">msg</span><span class="op" id="4958223">)</span><br>
<span class="lineno"></span><span class="op" id="4958225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="4958228">func</span>&nbsp;<span class="op" id="4958233">(</span><span class="ident" id="4958234">p</span>&nbsp;<span class="op" id="4958236">*</span><span class="ident" id="4958237">pkgBuilder</span><span class="op" id="4958247">)</span>&nbsp;<span class="ident" id="4958249">errorf</span><span class="op" id="4958255">(</span><span class="ident" id="4958256">pos</span>&nbsp;<span class="ident" id="4958260">token</span><span class="op" id="4958265">.</span><span class="ident" id="4958266">Pos</span><span class="op" id="4958269">,</span>&nbsp;<span class="ident" id="4958271">format</span>&nbsp;<span class="builtintype" id="4958278">string</span><span class="op" id="4958284">,</span>&nbsp;<span class="ident" id="4958286">args</span>&nbsp;<span class="op" id="4958291">...</span><span class="keyword" id="4958294">interface</span><span class="op" id="4958303">{</span><span class="op" id="4958304">}</span><span class="op" id="4958305">)</span>&nbsp;<span class="op" id="4958307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958310">p</span><span class="op" id="4958311">.</span><span class="builtintype" id="4958312">error</span><span class="op" id="4958317">(</span><span class="ident" id="4958318">pos</span><span class="op" id="4958321">,</span>&nbsp;<span class="ident" id="4958323">fmt</span><span class="op" id="4958326">.</span><span class="ident" id="4958327">Sprintf</span><span class="op" id="4958334">(</span><span class="ident" id="4958335">format</span><span class="op" id="4958341">,</span>&nbsp;<span class="ident" id="4958343">args</span><span class="op" id="4958347">...</span><span class="op" id="4958350">)</span><span class="op" id="4958351">)</span><br>
<span class="lineno"></span><span class="op" id="4958353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4958356">func</span>&nbsp;<span class="op" id="4958361">(</span><span class="ident" id="4958362">p</span>&nbsp;<span class="op" id="4958364">*</span><span class="ident" id="4958365">pkgBuilder</span><span class="op" id="4958375">)</span>&nbsp;<span class="ident" id="4958377">declare</span><span class="op" id="4958384">(</span><span class="ident" id="4958385">scope</span><span class="op" id="4958390">,</span>&nbsp;<span class="ident" id="4958392">altScope</span>&nbsp;<span class="op" id="4958401">*</span><span class="ident" id="4958402">Scope</span><span class="op" id="4958407">,</span>&nbsp;<span class="ident" id="4958409">obj</span>&nbsp;<span class="op" id="4958413">*</span><span class="ident" id="4958414">Object</span><span class="op" id="4958420">)</span>&nbsp;<span class="op" id="4958422">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958425">alt</span>&nbsp;<span class="op" id="4958429">:=</span>&nbsp;<span class="ident" id="4958432">scope</span><span class="op" id="4958437">.</span><span class="ident" id="4958438">Insert</span><span class="op" id="4958444">(</span><span class="ident" id="4958445">obj</span><span class="op" id="4958448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4958451">if</span>&nbsp;<span class="ident" id="4958454">alt</span>&nbsp;<span class="op" id="4958458">==</span>&nbsp;<span class="builtintype" id="4958461">nil</span>&nbsp;<span class="op" id="4958465">&amp;&amp;</span>&nbsp;<span class="ident" id="4958468">altScope</span>&nbsp;<span class="op" id="4958477">!=</span>&nbsp;<span class="builtintype" id="4958480">nil</span>&nbsp;<span class="op" id="4958484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4958488">//&nbsp;see&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;conflicting&nbsp;declaration&nbsp;in&nbsp;altScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958547">alt</span>&nbsp;<span class="op" id="4958551">=</span>&nbsp;<span class="ident" id="4958553">altScope</span><span class="op" id="4958561">.</span><span class="ident" id="4958562">Lookup</span><span class="op" id="4958568">(</span><span class="ident" id="4958569">obj</span><span class="op" id="4958572">.</span><span class="ident" id="4958573">Name</span><span class="op" id="4958577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4958580">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4958583">if</span>&nbsp;<span class="ident" id="4958586">alt</span>&nbsp;<span class="op" id="4958590">!=</span>&nbsp;<span class="builtintype" id="4958593">nil</span>&nbsp;<span class="op" id="4958597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958601">prevDecl</span>&nbsp;<span class="op" id="4958610">:=</span>&nbsp;<span class="string" id="4958613">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4958618">if</span>&nbsp;<span class="ident" id="4958621">pos</span>&nbsp;<span class="op" id="4958625">:=</span>&nbsp;<span class="ident" id="4958628">alt</span><span class="op" id="4958631">.</span><span class="ident" id="4958632">Pos</span><span class="op" id="4958635">(</span><span class="op" id="4958636">)</span><span class="op" id="4958637">;</span>&nbsp;<span class="ident" id="4958639">pos</span><span class="op" id="4958642">.</span><span class="ident" id="4958643">IsValid</span><span class="op" id="4958650">(</span><span class="op" id="4958651">)</span>&nbsp;<span class="op" id="4958653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958658">prevDecl</span>&nbsp;<span class="op" id="4958667">=</span>&nbsp;<span class="ident" id="4958669">fmt</span><span class="op" id="4958672">.</span><span class="ident" id="4958673">Sprintf</span><span class="op" id="4958680">(</span><span class="string" id="4958681">&#34;\n\tprevious&nbsp;declaration&nbsp;at&nbsp;%s&#34;</span><span class="op" id="4958713">,</span>&nbsp;<span class="ident" id="4958715">p</span><span class="op" id="4958716">.</span><span class="ident" id="4958717">fset</span><span class="op" id="4958721">.</span><span class="ident" id="4958722">Position</span><span class="op" id="4958730">(</span><span class="ident" id="4958731">pos</span><span class="op" id="4958734">)</span><span class="op" id="4958735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4958739">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958743">p</span><span class="op" id="4958744">.</span><span class="builtintype" id="4958745">error</span><span class="op" id="4958750">(</span><span class="ident" id="4958751">obj</span><span class="op" id="4958754">.</span><span class="ident" id="4958755">Pos</span><span class="op" id="4958758">(</span><span class="op" id="4958759">)</span><span class="op" id="4958760">,</span>&nbsp;<span class="ident" id="4958762">fmt</span><span class="op" id="4958765">.</span><span class="ident" id="4958766">Sprintf</span><span class="op" id="4958773">(</span><span class="string" id="4958774">&#34;%s&nbsp;redeclared&nbsp;in&nbsp;this&nbsp;block%s&#34;</span><span class="op" id="4958805">,</span>&nbsp;<span class="ident" id="4958807">obj</span><span class="op" id="4958810">.</span><span class="ident" id="4958811">Name</span><span class="op" id="4958815">,</span>&nbsp;<span class="ident" id="4958817">prevDecl</span><span class="op" id="4958825">)</span><span class="op" id="4958826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4958829">}</span><br>
<span class="lineno"></span><span class="op" id="4958831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4958834">func</span>&nbsp;<span class="ident" id="4958839">resolve</span><span class="op" id="4958846">(</span><span class="ident" id="4958847">scope</span>&nbsp;<span class="op" id="4958853">*</span><span class="ident" id="4958854">Scope</span><span class="op" id="4958859">,</span>&nbsp;<span class="ident" id="4958861">ident</span>&nbsp;<span class="op" id="4958867">*</span><span class="ident" id="4958868">Ident</span><span class="op" id="4958873">)</span>&nbsp;<span class="builtintype" id="4958875">bool</span>&nbsp;<span class="op" id="4958880">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4958883">for</span>&nbsp;<span class="op" id="4958887">;</span>&nbsp;<span class="ident" id="4958889">scope</span>&nbsp;<span class="op" id="4958895">!=</span>&nbsp;<span class="builtintype" id="4958898">nil</span><span class="op" id="4958901">;</span>&nbsp;<span class="ident" id="4958903">scope</span>&nbsp;<span class="op" id="4958909">=</span>&nbsp;<span class="ident" id="4958911">scope</span><span class="op" id="4958916">.</span><span class="ident" id="4958917">Outer</span>&nbsp;<span class="op" id="4958923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4958927">if</span>&nbsp;<span class="ident" id="4958930">obj</span>&nbsp;<span class="op" id="4958934">:=</span>&nbsp;<span class="ident" id="4958937">scope</span><span class="op" id="4958942">.</span><span class="ident" id="4958943">Lookup</span><span class="op" id="4958949">(</span><span class="ident" id="4958950">ident</span><span class="op" id="4958955">.</span><span class="ident" id="4958956">Name</span><span class="op" id="4958960">)</span><span class="op" id="4958961">;</span>&nbsp;<span class="ident" id="4958963">obj</span>&nbsp;<span class="op" id="4958967">!=</span>&nbsp;<span class="builtintype" id="4958970">nil</span>&nbsp;<span class="op" id="4958974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4958979">ident</span><span class="op" id="4958984">.</span><span class="ident" id="4958985">Obj</span>&nbsp;<span class="op" id="4958989">=</span>&nbsp;<span class="ident" id="4958991">obj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4958998">return</span>&nbsp;<span class="builtintype" id="4959005">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4959012">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4959015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4959018">return</span>&nbsp;<span class="builtintype" id="4959025">false</span><br>
<span class="lineno"></span><span class="op" id="4959031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4959034">//&nbsp;An&nbsp;Importer&nbsp;resolves&nbsp;import&nbsp;paths&nbsp;to&nbsp;package&nbsp;Objects.</span><br>
<span class="lineno">55</span><span class="comment" id="4959091">//&nbsp;The&nbsp;imports&nbsp;map&nbsp;records&nbsp;the&nbsp;packages&nbsp;already&nbsp;imported,</span><br>
<span class="lineno"></span><span class="comment" id="4959149">//&nbsp;indexed&nbsp;by&nbsp;package&nbsp;id&nbsp;(canonical&nbsp;import&nbsp;path).</span><br>
<span class="lineno"></span><span class="comment" id="4959199">//&nbsp;An&nbsp;Importer&nbsp;must&nbsp;determine&nbsp;the&nbsp;canonical&nbsp;import&nbsp;path&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4959259">//&nbsp;check&nbsp;the&nbsp;map&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;is&nbsp;already&nbsp;present&nbsp;in&nbsp;the&nbsp;imports&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="4959328">//&nbsp;If&nbsp;so,&nbsp;the&nbsp;Importer&nbsp;can&nbsp;return&nbsp;the&nbsp;map&nbsp;entry.&nbsp;&nbsp;Otherwise,&nbsp;the</span><br>
<span class="lineno">60</span><span class="comment" id="4959393">//&nbsp;Importer&nbsp;should&nbsp;load&nbsp;the&nbsp;package&nbsp;data&nbsp;for&nbsp;the&nbsp;given&nbsp;path&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="4959458">//&nbsp;a&nbsp;new&nbsp;*Object&nbsp;(pkg),&nbsp;record&nbsp;pkg&nbsp;in&nbsp;the&nbsp;imports&nbsp;map,&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="4959522">//&nbsp;return&nbsp;pkg.</span><br>
<span class="lineno"></span><span class="keyword" id="4959537">type</span>&nbsp;<span class="ident" id="4959542">Importer</span>&nbsp;<span class="keyword" id="4959551">func</span><span class="op" id="4959555">(</span><span class="ident" id="4959556">imports</span>&nbsp;<span class="keyword" id="4959564">map</span><span class="op" id="4959567">[</span><span class="builtintype" id="4959568">string</span><span class="op" id="4959574">]</span><span class="op" id="4959575">*</span><span class="ident" id="4959576">Object</span><span class="op" id="4959582">,</span>&nbsp;<span class="ident" id="4959584">path</span>&nbsp;<span class="builtintype" id="4959589">string</span><span class="op" id="4959595">)</span>&nbsp;<span class="op" id="4959597">(</span><span class="ident" id="4959598">pkg</span>&nbsp;<span class="op" id="4959602">*</span><span class="ident" id="4959603">Object</span><span class="op" id="4959609">,</span>&nbsp;<span class="ident" id="4959611">err</span>&nbsp;<span class="builtintype" id="4959615">error</span><span class="op" id="4959620">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4959623">//&nbsp;NewPackage&nbsp;creates&nbsp;a&nbsp;new&nbsp;Package&nbsp;node&nbsp;from&nbsp;a&nbsp;set&nbsp;of&nbsp;File&nbsp;nodes.&nbsp;It&nbsp;resolves</span><br>
<span class="lineno"></span><span class="comment" id="4959702">//&nbsp;unresolved&nbsp;identifiers&nbsp;across&nbsp;files&nbsp;and&nbsp;updates&nbsp;each&nbsp;file&#39;s&nbsp;Unresolved&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="4959781">//&nbsp;accordingly.&nbsp;If&nbsp;a&nbsp;non-nil&nbsp;importer&nbsp;and&nbsp;universe&nbsp;scope&nbsp;are&nbsp;provided,&nbsp;they&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4959861">//&nbsp;used&nbsp;to&nbsp;resolve&nbsp;identifiers&nbsp;not&nbsp;declared&nbsp;in&nbsp;any&nbsp;of&nbsp;the&nbsp;package&nbsp;files.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="4959938">//&nbsp;remaining&nbsp;unresolved&nbsp;identifiers&nbsp;are&nbsp;reported&nbsp;as&nbsp;undeclared.&nbsp;If&nbsp;the&nbsp;files</span><br>
<span class="lineno">70</span><span class="comment" id="4960015">//&nbsp;belong&nbsp;to&nbsp;different&nbsp;packages,&nbsp;one&nbsp;package&nbsp;name&nbsp;is&nbsp;selected&nbsp;and&nbsp;files&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="4960092">//&nbsp;different&nbsp;package&nbsp;names&nbsp;are&nbsp;reported&nbsp;and&nbsp;then&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4960150">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;package&nbsp;node&nbsp;and&nbsp;a&nbsp;scanner.ErrorList&nbsp;if&nbsp;there&nbsp;were&nbsp;errors.</span><br>
<span class="lineno"></span><span class="comment" id="4960228">//</span><br>
<span class="lineno"></span><span class="keyword" id="4960231">func</span>&nbsp;<span class="ident" id="4960236">NewPackage</span><span class="op" id="4960246">(</span><span class="ident" id="4960247">fset</span>&nbsp;<span class="op" id="4960252">*</span><span class="ident" id="4960253">token</span><span class="op" id="4960258">.</span><span class="ident" id="4960259">FileSet</span><span class="op" id="4960266">,</span>&nbsp;<span class="ident" id="4960268">files</span>&nbsp;<span class="keyword" id="4960274">map</span><span class="op" id="4960277">[</span><span class="builtintype" id="4960278">string</span><span class="op" id="4960284">]</span><span class="op" id="4960285">*</span><span class="ident" id="4960286">File</span><span class="op" id="4960290">,</span>&nbsp;<span class="ident" id="4960292">importer</span>&nbsp;<span class="ident" id="4960301">Importer</span><span class="op" id="4960309">,</span>&nbsp;<span class="ident" id="4960311">universe</span>&nbsp;<span class="op" id="4960320">*</span><span class="ident" id="4960321">Scope</span><span class="op" id="4960326">)</span>&nbsp;<span class="op" id="4960328">(</span><span class="op" id="4960329">*</span><span class="ident" id="4960330">Package</span><span class="op" id="4960337">,</span>&nbsp;<span class="builtintype" id="4960339">error</span><span class="op" id="4960344">)</span>&nbsp;<span class="op" id="4960346">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4960349">var</span>&nbsp;<span class="ident" id="4960353">p</span>&nbsp;<span class="ident" id="4960355">pkgBuilder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4960367">p</span><span class="op" id="4960368">.</span><span class="ident" id="4960369">fset</span>&nbsp;<span class="op" id="4960374">=</span>&nbsp;<span class="ident" id="4960376">fset</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4960383">//&nbsp;complete&nbsp;package&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4960410">pkgName</span>&nbsp;<span class="op" id="4960418">:=</span>&nbsp;<span class="string" id="4960421">&#34;&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4960425">pkgScope</span>&nbsp;<span class="op" id="4960434">:=</span>&nbsp;<span class="ident" id="4960437">NewScope</span><span class="op" id="4960445">(</span><span class="ident" id="4960446">universe</span><span class="op" id="4960454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4960457">for</span>&nbsp;<span class="ident" id="4960461">_</span><span class="op" id="4960462">,</span>&nbsp;<span class="ident" id="4960464">file</span>&nbsp;<span class="op" id="4960469">:=</span>&nbsp;<span class="keyword" id="4960472">range</span>&nbsp;<span class="ident" id="4960478">files</span>&nbsp;<span class="op" id="4960484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4960488">//&nbsp;package&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4960518">switch</span>&nbsp;<span class="ident" id="4960525">name</span>&nbsp;<span class="op" id="4960530">:=</span>&nbsp;<span class="ident" id="4960533">file</span><span class="op" id="4960537">.</span><span class="ident" id="4960538">Name</span><span class="op" id="4960542">.</span><span class="ident" id="4960543">Name</span><span class="op" id="4960547">;</span>&nbsp;<span class="op" id="4960549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4960553">case</span>&nbsp;<span class="ident" id="4960558">pkgName</span>&nbsp;<span class="op" id="4960566">==</span>&nbsp;<span class="string" id="4960569">&#34;&#34;</span><span class="op" id="4960571">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4960576">pkgName</span>&nbsp;<span class="op" id="4960584">=</span>&nbsp;<span class="ident" id="4960586">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4960593">case</span>&nbsp;<span class="ident" id="4960598">name</span>&nbsp;<span class="op" id="4960603">!=</span>&nbsp;<span class="ident" id="4960606">pkgName</span><span class="op" id="4960613">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4960618">p</span><span class="op" id="4960619">.</span><span class="ident" id="4960620">errorf</span><span class="op" id="4960626">(</span><span class="ident" id="4960627">file</span><span class="op" id="4960631">.</span><span class="ident" id="4960632">Package</span><span class="op" id="4960639">,</span>&nbsp;<span class="string" id="4960641">&#34;package&nbsp;%s;&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="4960666">,</span>&nbsp;<span class="ident" id="4960668">name</span><span class="op" id="4960672">,</span>&nbsp;<span class="ident" id="4960674">pkgName</span><span class="op" id="4960681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4960686">continue</span>&nbsp;<span class="comment" id="4960695">//&nbsp;ignore&nbsp;this&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4960717">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4960722">//&nbsp;collect&nbsp;top-level&nbsp;file&nbsp;objects&nbsp;in&nbsp;package&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4960775">for</span>&nbsp;<span class="ident" id="4960779">_</span><span class="op" id="4960780">,</span>&nbsp;<span class="ident" id="4960782">obj</span>&nbsp;<span class="op" id="4960786">:=</span>&nbsp;<span class="keyword" id="4960789">range</span>&nbsp;<span class="ident" id="4960795">file</span><span class="op" id="4960799">.</span><span class="ident" id="4960800">Scope</span><span class="op" id="4960805">.</span><span class="ident" id="4960806">Objects</span>&nbsp;<span class="op" id="4960814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4960819">p</span><span class="op" id="4960820">.</span><span class="ident" id="4960821">declare</span><span class="op" id="4960828">(</span><span class="ident" id="4960829">pkgScope</span><span class="op" id="4960837">,</span>&nbsp;<span class="builtintype" id="4960839">nil</span><span class="op" id="4960842">,</span>&nbsp;<span class="ident" id="4960844">obj</span><span class="op" id="4960847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4960851">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4960854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4960858">//&nbsp;package&nbsp;global&nbsp;mapping&nbsp;of&nbsp;imported&nbsp;package&nbsp;ids&nbsp;to&nbsp;package&nbsp;objects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4960928">imports</span>&nbsp;<span class="op" id="4960936">:=</span>&nbsp;<span class="builtinfunc" id="4960939">make</span><span class="op" id="4960943">(</span><span class="keyword" id="4960944">map</span><span class="op" id="4960947">[</span><span class="builtintype" id="4960948">string</span><span class="op" id="4960954">]</span><span class="op" id="4960955">*</span><span class="ident" id="4960956">Object</span><span class="op" id="4960962">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4960966">//&nbsp;complete&nbsp;file&nbsp;scopes&nbsp;with&nbsp;imports&nbsp;and&nbsp;resolve&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4961028">for</span>&nbsp;<span class="ident" id="4961032">_</span><span class="op" id="4961033">,</span>&nbsp;<span class="ident" id="4961035">file</span>&nbsp;<span class="op" id="4961040">:=</span>&nbsp;<span class="keyword" id="4961043">range</span>&nbsp;<span class="ident" id="4961049">files</span>&nbsp;<span class="op" id="4961055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4961059">//&nbsp;ignore&nbsp;file&nbsp;if&nbsp;it&nbsp;belongs&nbsp;to&nbsp;a&nbsp;different&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4961113">//&nbsp;(error&nbsp;has&nbsp;already&nbsp;been&nbsp;reported)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4961152">if</span>&nbsp;<span class="ident" id="4961155">file</span><span class="op" id="4961159">.</span><span class="ident" id="4961160">Name</span><span class="op" id="4961164">.</span><span class="ident" id="4961165">Name</span>&nbsp;<span class="op" id="4961170">!=</span>&nbsp;<span class="ident" id="4961173">pkgName</span>&nbsp;<span class="op" id="4961181">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4961186">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4961197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4961202">//&nbsp;build&nbsp;file&nbsp;scope&nbsp;by&nbsp;processing&nbsp;all&nbsp;imports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961250">importErrors</span>&nbsp;<span class="op" id="4961263">:=</span>&nbsp;<span class="builtintype" id="4961266">false</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961274">fileScope</span>&nbsp;<span class="op" id="4961284">:=</span>&nbsp;<span class="ident" id="4961287">NewScope</span><span class="op" id="4961295">(</span><span class="ident" id="4961296">pkgScope</span><span class="op" id="4961304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4961308">for</span>&nbsp;<span class="ident" id="4961312">_</span><span class="op" id="4961313">,</span>&nbsp;<span class="ident" id="4961315">spec</span>&nbsp;<span class="op" id="4961320">:=</span>&nbsp;<span class="keyword" id="4961323">range</span>&nbsp;<span class="ident" id="4961329">file</span><span class="op" id="4961333">.</span><span class="ident" id="4961334">Imports</span>&nbsp;<span class="op" id="4961342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4961347">if</span>&nbsp;<span class="ident" id="4961350">importer</span>&nbsp;<span class="op" id="4961359">==</span>&nbsp;<span class="builtintype" id="4961362">nil</span>&nbsp;<span class="op" id="4961366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961372">importErrors</span>&nbsp;<span class="op" id="4961385">=</span>&nbsp;<span class="builtintype" id="4961387">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4961396">continue</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4961408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961413">path</span><span class="op" id="4961417">,</span>&nbsp;<span class="ident" id="4961419">_</span>&nbsp;<span class="op" id="4961421">:=</span>&nbsp;<span class="ident" id="4961424">strconv</span><span class="op" id="4961431">.</span><span class="ident" id="4961432">Unquote</span><span class="op" id="4961439">(</span><span class="ident" id="4961440">spec</span><span class="op" id="4961444">.</span><span class="ident" id="4961445">Path</span><span class="op" id="4961449">.</span><span class="ident" id="4961450">Value</span><span class="op" id="4961455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961460">pkg</span><span class="op" id="4961463">,</span>&nbsp;<span class="ident" id="4961465">err</span>&nbsp;<span class="op" id="4961469">:=</span>&nbsp;<span class="ident" id="4961472">importer</span><span class="op" id="4961480">(</span><span class="ident" id="4961481">imports</span><span class="op" id="4961488">,</span>&nbsp;<span class="ident" id="4961490">path</span><span class="op" id="4961494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4961499">if</span>&nbsp;<span class="ident" id="4961502">err</span>&nbsp;<span class="op" id="4961506">!=</span>&nbsp;<span class="builtintype" id="4961509">nil</span>&nbsp;<span class="op" id="4961513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961519">p</span><span class="op" id="4961520">.</span><span class="ident" id="4961521">errorf</span><span class="op" id="4961527">(</span><span class="ident" id="4961528">spec</span><span class="op" id="4961532">.</span><span class="ident" id="4961533">Path</span><span class="op" id="4961537">.</span><span class="ident" id="4961538">Pos</span><span class="op" id="4961541">(</span><span class="op" id="4961542">)</span><span class="op" id="4961543">,</span>&nbsp;<span class="string" id="4961545">&#34;could&nbsp;not&nbsp;import&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="4961571">,</span>&nbsp;<span class="ident" id="4961573">path</span><span class="op" id="4961577">,</span>&nbsp;<span class="ident" id="4961579">err</span><span class="op" id="4961582">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961588">importErrors</span>&nbsp;<span class="op" id="4961601">=</span>&nbsp;<span class="builtintype" id="4961603">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4961612">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4961624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4961629">//&nbsp;TODO(gri)&nbsp;If&nbsp;a&nbsp;local&nbsp;package&nbsp;name&nbsp;!=&nbsp;&#34;.&#34;&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4961689">//&nbsp;global&nbsp;identifier&nbsp;resolution&nbsp;could&nbsp;proceed&nbsp;even&nbsp;if&nbsp;the</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4961750">//&nbsp;import&nbsp;failed.&nbsp;Consider&nbsp;adjusting&nbsp;the&nbsp;logic&nbsp;here&nbsp;a&nbsp;bit.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4961813">//&nbsp;local&nbsp;name&nbsp;overrides&nbsp;imported&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961862">name</span>&nbsp;<span class="op" id="4961867">:=</span>&nbsp;<span class="ident" id="4961870">pkg</span><span class="op" id="4961873">.</span><span class="ident" id="4961874">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4961882">if</span>&nbsp;<span class="ident" id="4961885">spec</span><span class="op" id="4961889">.</span><span class="ident" id="4961890">Name</span>&nbsp;<span class="op" id="4961895">!=</span>&nbsp;<span class="builtintype" id="4961898">nil</span>&nbsp;<span class="op" id="4961902">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961908">name</span>&nbsp;<span class="op" id="4961913">=</span>&nbsp;<span class="ident" id="4961915">spec</span><span class="op" id="4961919">.</span><span class="ident" id="4961920">Name</span><span class="op" id="4961924">.</span><span class="ident" id="4961925">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4961933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4961939">//&nbsp;add&nbsp;import&nbsp;to&nbsp;file&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4961970">if</span>&nbsp;<span class="ident" id="4961973">name</span>&nbsp;<span class="op" id="4961978">==</span>&nbsp;<span class="string" id="4961981">&#34;.&#34;</span>&nbsp;<span class="op" id="4961985">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4961991">//&nbsp;merge&nbsp;imported&nbsp;scope&nbsp;with&nbsp;file&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4962035">for</span>&nbsp;<span class="ident" id="4962039">_</span><span class="op" id="4962040">,</span>&nbsp;<span class="ident" id="4962042">obj</span>&nbsp;<span class="op" id="4962046">:=</span>&nbsp;<span class="keyword" id="4962049">range</span>&nbsp;<span class="ident" id="4962055">pkg</span><span class="op" id="4962058">.</span><span class="ident" id="4962059">Data</span><span class="op" id="4962063">.</span><span class="op" id="4962064">(</span><span class="op" id="4962065">*</span><span class="ident" id="4962066">Scope</span><span class="op" id="4962071">)</span><span class="op" id="4962072">.</span><span class="ident" id="4962073">Objects</span>&nbsp;<span class="op" id="4962081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962088">p</span><span class="op" id="4962089">.</span><span class="ident" id="4962090">declare</span><span class="op" id="4962097">(</span><span class="ident" id="4962098">fileScope</span><span class="op" id="4962107">,</span>&nbsp;<span class="ident" id="4962109">pkgScope</span><span class="op" id="4962117">,</span>&nbsp;<span class="ident" id="4962119">obj</span><span class="op" id="4962122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4962128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4962133">}</span>&nbsp;<span class="keyword" id="4962135">else</span>&nbsp;<span class="keyword" id="4962140">if</span>&nbsp;<span class="ident" id="4962143">name</span>&nbsp;<span class="op" id="4962148">!=</span>&nbsp;<span class="string" id="4962151">&#34;_&#34;</span>&nbsp;<span class="op" id="4962155">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4962161">//&nbsp;declare&nbsp;imported&nbsp;package&nbsp;object&nbsp;in&nbsp;file&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4962214">//&nbsp;(do&nbsp;not&nbsp;re-use&nbsp;pkg&nbsp;in&nbsp;the&nbsp;file&nbsp;scope&nbsp;but&nbsp;create</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4962269">//&nbsp;a&nbsp;new&nbsp;object&nbsp;instead;&nbsp;the&nbsp;Decl&nbsp;field&nbsp;is&nbsp;different</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4962326">//&nbsp;for&nbsp;different&nbsp;files)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962354">obj</span>&nbsp;<span class="op" id="4962358">:=</span>&nbsp;<span class="ident" id="4962361">NewObj</span><span class="op" id="4962367">(</span><span class="ident" id="4962368">Pkg</span><span class="op" id="4962371">,</span>&nbsp;<span class="ident" id="4962373">name</span><span class="op" id="4962377">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962383">obj</span><span class="op" id="4962386">.</span><span class="ident" id="4962387">Decl</span>&nbsp;<span class="op" id="4962392">=</span>&nbsp;<span class="ident" id="4962394">spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962403">obj</span><span class="op" id="4962406">.</span><span class="ident" id="4962407">Data</span>&nbsp;<span class="op" id="4962412">=</span>&nbsp;<span class="ident" id="4962414">pkg</span><span class="op" id="4962417">.</span><span class="ident" id="4962418">Data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962427">p</span><span class="op" id="4962428">.</span><span class="ident" id="4962429">declare</span><span class="op" id="4962436">(</span><span class="ident" id="4962437">fileScope</span><span class="op" id="4962446">,</span>&nbsp;<span class="ident" id="4962448">pkgScope</span><span class="op" id="4962456">,</span>&nbsp;<span class="ident" id="4962458">obj</span><span class="op" id="4962461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4962466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4962470">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4962475">//&nbsp;resolve&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4962500">if</span>&nbsp;<span class="ident" id="4962503">importErrors</span>&nbsp;<span class="op" id="4962516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4962521">//&nbsp;don&#39;t&nbsp;use&nbsp;the&nbsp;universe&nbsp;scope&nbsp;without&nbsp;correct&nbsp;imports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4962580">//&nbsp;(objects&nbsp;in&nbsp;the&nbsp;universe&nbsp;may&nbsp;be&nbsp;shadowed&nbsp;by&nbsp;imports;</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4962639">//&nbsp;with&nbsp;missing&nbsp;imports,&nbsp;identifiers&nbsp;might&nbsp;get&nbsp;resolved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4962698">//&nbsp;incorrectly&nbsp;to&nbsp;universe&nbsp;objects)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962737">pkgScope</span><span class="op" id="4962745">.</span><span class="ident" id="4962746">Outer</span>&nbsp;<span class="op" id="4962752">=</span>&nbsp;<span class="builtintype" id="4962754">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4962760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962764">i</span>&nbsp;<span class="op" id="4962766">:=</span>&nbsp;<span class="num" id="4962769">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4962773">for</span>&nbsp;<span class="ident" id="4962777">_</span><span class="op" id="4962778">,</span>&nbsp;<span class="ident" id="4962780">ident</span>&nbsp;<span class="op" id="4962786">:=</span>&nbsp;<span class="keyword" id="4962789">range</span>&nbsp;<span class="ident" id="4962795">file</span><span class="op" id="4962799">.</span><span class="ident" id="4962800">Unresolved</span>&nbsp;<span class="op" id="4962811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4962816">if</span>&nbsp;<span class="op" id="4962819">!</span><span class="ident" id="4962820">resolve</span><span class="op" id="4962827">(</span><span class="ident" id="4962828">fileScope</span><span class="op" id="4962837">,</span>&nbsp;<span class="ident" id="4962839">ident</span><span class="op" id="4962844">)</span>&nbsp;<span class="op" id="4962846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962852">p</span><span class="op" id="4962853">.</span><span class="ident" id="4962854">errorf</span><span class="op" id="4962860">(</span><span class="ident" id="4962861">ident</span><span class="op" id="4962866">.</span><span class="ident" id="4962867">Pos</span><span class="op" id="4962870">(</span><span class="op" id="4962871">)</span><span class="op" id="4962872">,</span>&nbsp;<span class="string" id="4962874">&#34;undeclared&nbsp;name:&nbsp;%s&#34;</span><span class="op" id="4962895">,</span>&nbsp;<span class="ident" id="4962897">ident</span><span class="op" id="4962902">.</span><span class="ident" id="4962903">Name</span><span class="op" id="4962907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962913">file</span><span class="op" id="4962917">.</span><span class="ident" id="4962918">Unresolved</span><span class="op" id="4962928">[</span><span class="ident" id="4962929">i</span><span class="op" id="4962930">]</span>&nbsp;<span class="op" id="4962932">=</span>&nbsp;<span class="ident" id="4962934">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962944">i</span><span class="op" id="4962945">++</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4962951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4962956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4962960">file</span><span class="op" id="4962964">.</span><span class="ident" id="4962965">Unresolved</span>&nbsp;<span class="op" id="4962976">=</span>&nbsp;<span class="ident" id="4962978">file</span><span class="op" id="4962982">.</span><span class="ident" id="4962983">Unresolved</span><span class="op" id="4962993">[</span><span class="num" id="4962994">0</span><span class="op" id="4962995">:</span><span class="ident" id="4962996">i</span><span class="op" id="4962997">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4963001">pkgScope</span><span class="op" id="4963009">.</span><span class="ident" id="4963010">Outer</span>&nbsp;<span class="op" id="4963016">=</span>&nbsp;<span class="ident" id="4963018">universe</span>&nbsp;<span class="comment" id="4963027">//&nbsp;reset&nbsp;universe&nbsp;scope</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4963052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4963056">p</span><span class="op" id="4963057">.</span><span class="ident" id="4963058">errors</span><span class="op" id="4963064">.</span><span class="ident" id="4963065">Sort</span><span class="op" id="4963069">(</span><span class="op" id="4963070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4963073">return</span>&nbsp;<span class="op" id="4963080">&amp;</span><span class="ident" id="4963081">Package</span><span class="op" id="4963088">{</span><span class="ident" id="4963089">pkgName</span><span class="op" id="4963096">,</span>&nbsp;<span class="ident" id="4963098">pkgScope</span><span class="op" id="4963106">,</span>&nbsp;<span class="ident" id="4963108">imports</span><span class="op" id="4963115">,</span>&nbsp;<span class="ident" id="4963117">files</span><span class="op" id="4963122">}</span><span class="op" id="4963123">,</span>&nbsp;<span class="ident" id="4963125">p</span><span class="op" id="4963126">.</span><span class="ident" id="4963127">errors</span><span class="op" id="4963133">.</span><span class="ident" id="4963134">Err</span><span class="op" id="4963137">(</span><span class="op" id="4963138">)</span><br>
<span class="lineno"></span><span class="op" id="4963140">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
