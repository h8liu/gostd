<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>time</h2>
<ul>
<li><a href="/gostd/time/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/time/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/time/format.go.html">format.go</a></li>
<li><a href="/gostd/time/format_test.go.html">format_test.go</a></li>
<li><a href="/gostd/time/internal_test.go.html">internal_test.go</a></li>
<li><a href="/gostd/time/sleep.go.html">sleep.go</a></li>
<li><a href="/gostd/time/sleep_test.go.html">sleep_test.go</a></li>
<li><a href="/gostd/time/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/time/tick.go.html">tick.go</a></li>
<li><a href="/gostd/time/tick_test.go.html">tick_test.go</a></li>
<li><a href="/gostd/time/time.go.html">time.go</a></li>
<li><a href="/gostd/time/time_test.go.html">time_test.go</a></li>
<li><a href="/gostd/time/zoneinfo.go.html">zoneinfo.go</a></li>
<li><a href="/gostd/time/zoneinfo_read.go.html">zoneinfo_read.go</a></li>
<li><a href="/gostd/time/zoneinfo_test.go.html">zoneinfo_test.go</a></li>
<li><a href="/gostd/time/zoneinfo_unix.go.html">zoneinfo_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2735418">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2735473">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2735527">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2735578">package</span>&nbsp;<span class="ident" id="2735586">time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2735592">//&nbsp;Sleep&nbsp;pauses&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;duration&nbsp;d.</span><br>
<span class="lineno"></span><span class="comment" id="2735659">//&nbsp;A&nbsp;negative&nbsp;or&nbsp;zero&nbsp;duration&nbsp;causes&nbsp;Sleep&nbsp;to&nbsp;return&nbsp;immediately.</span><br>
<span class="lineno"></span><span class="keyword" id="2735726">func</span>&nbsp;<span class="ident" id="2735731">Sleep</span><span class="op" id="2735736">(</span><span class="ident" id="2735737">d</span>&nbsp;<span class="ident" id="2735739">Duration</span><span class="op" id="2735747">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2735750">//&nbsp;runtimeNano&nbsp;returns&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;runtime&nbsp;clock&nbsp;in&nbsp;nanoseconds.</span><br>
<span class="lineno"></span><span class="keyword" id="2735828">func</span>&nbsp;<span class="ident" id="2735833">runtimeNano</span><span class="op" id="2735844">(</span><span class="op" id="2735845">)</span>&nbsp;<span class="ident" id="2735847">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2735854">//&nbsp;Interface&nbsp;to&nbsp;timers&nbsp;implemented&nbsp;in&nbsp;package&nbsp;runtime.</span><br>
<span class="lineno">15</span><span class="comment" id="2735909">//&nbsp;Must&nbsp;be&nbsp;in&nbsp;sync&nbsp;with&nbsp;../runtime/runtime.h:/^struct.Timer$</span><br>
<span class="lineno"></span><span class="keyword" id="2735970">type</span>&nbsp;<span class="ident" id="2735975">runtimeTimer</span>&nbsp;<span class="keyword" id="2735988">struct</span>&nbsp;<span class="op" id="2735995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2735998">i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2736005">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2736010">when</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2736017">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2736024">period</span>&nbsp;<span class="ident" id="2736031">int64</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2736038">f</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2736045">func</span><span class="op" id="2736049">(</span><span class="keyword" id="2736050">interface</span><span class="op" id="2736059">{</span><span class="op" id="2736060">}</span><span class="op" id="2736061">,</span>&nbsp;<span class="builtintype" id="2736063">uintptr</span><span class="op" id="2736070">)</span>&nbsp;<span class="comment" id="2736072">//&nbsp;NOTE:&nbsp;must&nbsp;not&nbsp;be&nbsp;closure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2736102">arg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2736109">interface</span><span class="op" id="2736118">{</span><span class="op" id="2736119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2736122">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2736129">uintptr</span><br>
<span class="lineno"></span><span class="op" id="2736137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2736140">//&nbsp;when&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;setting&nbsp;the&nbsp;&#39;when&#39;&nbsp;field&nbsp;of&nbsp;a&nbsp;runtimeTimer.</span><br>
<span class="lineno"></span><span class="comment" id="2736217">//&nbsp;It&nbsp;returns&nbsp;what&nbsp;the&nbsp;time&nbsp;will&nbsp;be,&nbsp;in&nbsp;nanoseconds,&nbsp;Duration&nbsp;d&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="comment" id="2736296">//&nbsp;If&nbsp;d&nbsp;is&nbsp;negative,&nbsp;it&nbsp;is&nbsp;ignored.&nbsp;&nbsp;If&nbsp;the&nbsp;returned&nbsp;value&nbsp;would&nbsp;be&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="2736374">//&nbsp;zero&nbsp;because&nbsp;of&nbsp;an&nbsp;overflow,&nbsp;MaxInt64&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="2736428">func</span>&nbsp;<span class="ident" id="2736433">when</span><span class="op" id="2736437">(</span><span class="ident" id="2736438">d</span>&nbsp;<span class="ident" id="2736440">Duration</span><span class="op" id="2736448">)</span>&nbsp;<span class="ident" id="2736450">int64</span>&nbsp;<span class="op" id="2736456">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2736459">if</span>&nbsp;<span class="ident" id="2736462">d</span>&nbsp;<span class="op" id="2736464">&lt;=</span>&nbsp;<span class="num" id="2736467">0</span>&nbsp;<span class="op" id="2736469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2736473">return</span>&nbsp;<span class="ident" id="2736480">runtimeNano</span><span class="op" id="2736491">(</span><span class="op" id="2736492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2736495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2736498">t</span>&nbsp;<span class="op" id="2736500">:=</span>&nbsp;<span class="ident" id="2736503">runtimeNano</span><span class="op" id="2736514">(</span><span class="op" id="2736515">)</span>&nbsp;<span class="op" id="2736517">+</span>&nbsp;<span class="ident" id="2736519">int64</span><span class="op" id="2736524">(</span><span class="ident" id="2736525">d</span><span class="op" id="2736526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2736529">if</span>&nbsp;<span class="ident" id="2736532">t</span>&nbsp;<span class="op" id="2736534">&lt;</span>&nbsp;<span class="num" id="2736536">0</span>&nbsp;<span class="op" id="2736538">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2736542">t</span>&nbsp;<span class="op" id="2736544">=</span>&nbsp;<span class="num" id="2736546">1</span><span class="op" id="2736547">&lt;&lt;</span><span class="num" id="2736549">63</span>&nbsp;<span class="op" id="2736552">-</span>&nbsp;<span class="num" id="2736554">1</span>&nbsp;<span class="comment" id="2736556">//&nbsp;math.MaxInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2736574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2736577">return</span>&nbsp;<span class="ident" id="2736584">t</span><br>
<span class="lineno"></span><span class="op" id="2736586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2736589">func</span>&nbsp;<span class="ident" id="2736594">startTimer</span><span class="op" id="2736604">(</span><span class="op" id="2736605">*</span><span class="ident" id="2736606">runtimeTimer</span><span class="op" id="2736618">)</span><br>
<span class="lineno"></span><span class="keyword" id="2736620">func</span>&nbsp;<span class="ident" id="2736625">stopTimer</span><span class="op" id="2736634">(</span><span class="op" id="2736635">*</span><span class="ident" id="2736636">runtimeTimer</span><span class="op" id="2736648">)</span>&nbsp;<span class="builtintype" id="2736650">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2736656">//&nbsp;The&nbsp;Timer&nbsp;type&nbsp;represents&nbsp;a&nbsp;single&nbsp;event.</span><br>
<span class="lineno"></span><span class="comment" id="2736701">//&nbsp;When&nbsp;the&nbsp;Timer&nbsp;expires,&nbsp;the&nbsp;current&nbsp;time&nbsp;will&nbsp;be&nbsp;sent&nbsp;on&nbsp;C,</span><br>
<span class="lineno">45</span><span class="comment" id="2736764">//&nbsp;unless&nbsp;the&nbsp;Timer&nbsp;was&nbsp;created&nbsp;by&nbsp;AfterFunc.</span><br>
<span class="lineno"></span><span class="comment" id="2736810">//&nbsp;A&nbsp;Timer&nbsp;must&nbsp;be&nbsp;created&nbsp;with&nbsp;NewTimer&nbsp;or&nbsp;AfterFunc.</span><br>
<span class="lineno"></span><span class="keyword" id="2736865">type</span>&nbsp;<span class="ident" id="2736870">Timer</span>&nbsp;<span class="keyword" id="2736876">struct</span>&nbsp;<span class="op" id="2736883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2736886">C</span>&nbsp;<span class="op" id="2736888">&lt;-</span><span class="keyword" id="2736890">chan</span>&nbsp;<span class="ident" id="2736895">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2736901">r</span>&nbsp;<span class="ident" id="2736903">runtimeTimer</span><br>
<span class="lineno">50</span><span class="op" id="2736916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2736919">//&nbsp;Stop&nbsp;prevents&nbsp;the&nbsp;Timer&nbsp;from&nbsp;firing.</span><br>
<span class="lineno"></span><span class="comment" id="2736959">//&nbsp;It&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;call&nbsp;stops&nbsp;the&nbsp;timer,&nbsp;false&nbsp;if&nbsp;the&nbsp;timer&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="2737038">//&nbsp;expired&nbsp;or&nbsp;been&nbsp;stopped.</span><br>
<span class="lineno">55</span><span class="comment" id="2737066">//&nbsp;Stop&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;channel,&nbsp;to&nbsp;prevent&nbsp;a&nbsp;read&nbsp;from&nbsp;the&nbsp;channel&nbsp;succeeding</span><br>
<span class="lineno"></span><span class="comment" id="2737148">//&nbsp;incorrectly.</span><br>
<span class="lineno"></span><span class="keyword" id="2737164">func</span>&nbsp;<span class="op" id="2737169">(</span><span class="ident" id="2737170">t</span>&nbsp;<span class="op" id="2737172">*</span><span class="ident" id="2737173">Timer</span><span class="op" id="2737178">)</span>&nbsp;<span class="ident" id="2737180">Stop</span><span class="op" id="2737184">(</span><span class="op" id="2737185">)</span>&nbsp;<span class="builtintype" id="2737187">bool</span>&nbsp;<span class="op" id="2737192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737195">if</span>&nbsp;<span class="ident" id="2737198">t</span><span class="op" id="2737199">.</span><span class="ident" id="2737200">r</span><span class="op" id="2737201">.</span><span class="ident" id="2737202">f</span>&nbsp;<span class="op" id="2737204">==</span>&nbsp;<span class="ident" id="2737207">nil</span>&nbsp;<span class="op" id="2737211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2737215">panic</span><span class="op" id="2737220">(</span><span class="string" id="2737221">&#34;time:&nbsp;Stop&nbsp;called&nbsp;on&nbsp;uninitialized&nbsp;Timer&#34;</span><span class="op" id="2737263">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2737266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737269">return</span>&nbsp;<span class="ident" id="2737276">stopTimer</span><span class="op" id="2737285">(</span><span class="op" id="2737286">&amp;</span><span class="ident" id="2737287">t</span><span class="op" id="2737288">.</span><span class="ident" id="2737289">r</span><span class="op" id="2737290">)</span><br>
<span class="lineno"></span><span class="op" id="2737292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2737295">//&nbsp;NewTimer&nbsp;creates&nbsp;a&nbsp;new&nbsp;Timer&nbsp;that&nbsp;will&nbsp;send</span><br>
<span class="lineno">65</span><span class="comment" id="2737342">//&nbsp;the&nbsp;current&nbsp;time&nbsp;on&nbsp;its&nbsp;channel&nbsp;after&nbsp;at&nbsp;least&nbsp;duration&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="2737404">func</span>&nbsp;<span class="ident" id="2737409">NewTimer</span><span class="op" id="2737417">(</span><span class="ident" id="2737418">d</span>&nbsp;<span class="ident" id="2737420">Duration</span><span class="op" id="2737428">)</span>&nbsp;<span class="op" id="2737430">*</span><span class="ident" id="2737431">Timer</span>&nbsp;<span class="op" id="2737437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737440">c</span>&nbsp;<span class="op" id="2737442">:=</span>&nbsp;<span class="builtinfunc" id="2737445">make</span><span class="op" id="2737449">(</span><span class="keyword" id="2737450">chan</span>&nbsp;<span class="ident" id="2737455">Time</span><span class="op" id="2737459">,</span>&nbsp;<span class="num" id="2737461">1</span><span class="op" id="2737462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737465">t</span>&nbsp;<span class="op" id="2737467">:=</span>&nbsp;<span class="op" id="2737470">&amp;</span><span class="ident" id="2737471">Timer</span><span class="op" id="2737476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737480">C</span><span class="op" id="2737481">:</span>&nbsp;<span class="ident" id="2737483">c</span><span class="op" id="2737484">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737488">r</span><span class="op" id="2737489">:</span>&nbsp;<span class="ident" id="2737491">runtimeTimer</span><span class="op" id="2737503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737508">when</span><span class="op" id="2737512">:</span>&nbsp;<span class="ident" id="2737514">when</span><span class="op" id="2737518">(</span><span class="ident" id="2737519">d</span><span class="op" id="2737520">)</span><span class="op" id="2737521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737526">f</span><span class="op" id="2737527">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2737532">sendTime</span><span class="op" id="2737540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737545">arg</span><span class="op" id="2737548">:</span>&nbsp;&nbsp;<span class="ident" id="2737551">c</span><span class="op" id="2737552">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2737556">}</span><span class="op" id="2737557">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2737560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737563">startTimer</span><span class="op" id="2737573">(</span><span class="op" id="2737574">&amp;</span><span class="ident" id="2737575">t</span><span class="op" id="2737576">.</span><span class="ident" id="2737577">r</span><span class="op" id="2737578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737581">return</span>&nbsp;<span class="ident" id="2737588">t</span><br>
<span class="lineno"></span><span class="op" id="2737590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2737593">//&nbsp;Reset&nbsp;changes&nbsp;the&nbsp;timer&nbsp;to&nbsp;expire&nbsp;after&nbsp;duration&nbsp;d.</span><br>
<span class="lineno"></span><span class="comment" id="2737648">//&nbsp;It&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;timer&nbsp;had&nbsp;been&nbsp;active,&nbsp;false&nbsp;if&nbsp;the&nbsp;timer&nbsp;had</span><br>
<span class="lineno"></span><span class="comment" id="2737720">//&nbsp;expired&nbsp;or&nbsp;been&nbsp;stopped.</span><br>
<span class="lineno"></span><span class="keyword" id="2737748">func</span>&nbsp;<span class="op" id="2737753">(</span><span class="ident" id="2737754">t</span>&nbsp;<span class="op" id="2737756">*</span><span class="ident" id="2737757">Timer</span><span class="op" id="2737762">)</span>&nbsp;<span class="ident" id="2737764">Reset</span><span class="op" id="2737769">(</span><span class="ident" id="2737770">d</span>&nbsp;<span class="ident" id="2737772">Duration</span><span class="op" id="2737780">)</span>&nbsp;<span class="builtintype" id="2737782">bool</span>&nbsp;<span class="op" id="2737787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737790">if</span>&nbsp;<span class="ident" id="2737793">t</span><span class="op" id="2737794">.</span><span class="ident" id="2737795">r</span><span class="op" id="2737796">.</span><span class="ident" id="2737797">f</span>&nbsp;<span class="op" id="2737799">==</span>&nbsp;<span class="ident" id="2737802">nil</span>&nbsp;<span class="op" id="2737806">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2737810">panic</span><span class="op" id="2737815">(</span><span class="string" id="2737816">&#34;time:&nbsp;Reset&nbsp;called&nbsp;on&nbsp;uninitialized&nbsp;Timer&#34;</span><span class="op" id="2737859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2737862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737865">w</span>&nbsp;<span class="op" id="2737867">:=</span>&nbsp;<span class="ident" id="2737870">when</span><span class="op" id="2737874">(</span><span class="ident" id="2737875">d</span><span class="op" id="2737876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737879">active</span>&nbsp;<span class="op" id="2737886">:=</span>&nbsp;<span class="ident" id="2737889">stopTimer</span><span class="op" id="2737898">(</span><span class="op" id="2737899">&amp;</span><span class="ident" id="2737900">t</span><span class="op" id="2737901">.</span><span class="ident" id="2737902">r</span><span class="op" id="2737903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737906">t</span><span class="op" id="2737907">.</span><span class="ident" id="2737908">r</span><span class="op" id="2737909">.</span><span class="ident" id="2737910">when</span>&nbsp;<span class="op" id="2737915">=</span>&nbsp;<span class="ident" id="2737917">w</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2737920">startTimer</span><span class="op" id="2737930">(</span><span class="op" id="2737931">&amp;</span><span class="ident" id="2737932">t</span><span class="op" id="2737933">.</span><span class="ident" id="2737934">r</span><span class="op" id="2737935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2737938">return</span>&nbsp;<span class="ident" id="2737945">active</span><br>
<span class="lineno"></span><span class="op" id="2737952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2737955">func</span>&nbsp;<span class="ident" id="2737960">sendTime</span><span class="op" id="2737968">(</span><span class="ident" id="2737969">c</span>&nbsp;<span class="keyword" id="2737971">interface</span><span class="op" id="2737980">{</span><span class="op" id="2737981">}</span><span class="op" id="2737982">,</span>&nbsp;<span class="ident" id="2737984">seq</span>&nbsp;<span class="builtintype" id="2737988">uintptr</span><span class="op" id="2737995">)</span>&nbsp;<span class="op" id="2737997">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2738000">//&nbsp;Non-blocking&nbsp;send&nbsp;of&nbsp;time&nbsp;on&nbsp;c.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2738036">//&nbsp;Used&nbsp;in&nbsp;NewTimer,&nbsp;it&nbsp;cannot&nbsp;block&nbsp;anyway&nbsp;(buffer).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2738091">//&nbsp;Used&nbsp;in&nbsp;NewTicker,&nbsp;dropping&nbsp;sends&nbsp;on&nbsp;the&nbsp;floor&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2738145">//&nbsp;the&nbsp;desired&nbsp;behavior&nbsp;when&nbsp;the&nbsp;reader&nbsp;gets&nbsp;behind,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2738199">//&nbsp;because&nbsp;the&nbsp;sends&nbsp;are&nbsp;periodic.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2738235">select</span>&nbsp;<span class="op" id="2738242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2738245">case</span>&nbsp;<span class="ident" id="2738250">c</span><span class="op" id="2738251">.</span><span class="op" id="2738252">(</span><span class="keyword" id="2738253">chan</span>&nbsp;<span class="ident" id="2738258">Time</span><span class="op" id="2738262">)</span>&nbsp;<span class="op" id="2738264">&lt;-</span>&nbsp;<span class="ident" id="2738267">Now</span><span class="op" id="2738270">(</span><span class="op" id="2738271">)</span><span class="op" id="2738272">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2738275">default</span><span class="op" id="2738282">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2738285">}</span><br>
<span class="lineno"></span><span class="op" id="2738287">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="2738290">//&nbsp;After&nbsp;waits&nbsp;for&nbsp;the&nbsp;duration&nbsp;to&nbsp;elapse&nbsp;and&nbsp;then&nbsp;sends&nbsp;the&nbsp;current&nbsp;time</span><br>
<span class="lineno"></span><span class="comment" id="2738364">//&nbsp;on&nbsp;the&nbsp;returned&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="2738392">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;NewTimer(d).C.</span><br>
<span class="lineno"></span><span class="keyword" id="2738430">func</span>&nbsp;<span class="ident" id="2738435">After</span><span class="op" id="2738440">(</span><span class="ident" id="2738441">d</span>&nbsp;<span class="ident" id="2738443">Duration</span><span class="op" id="2738451">)</span>&nbsp;<span class="op" id="2738453">&lt;-</span><span class="keyword" id="2738455">chan</span>&nbsp;<span class="ident" id="2738460">Time</span>&nbsp;<span class="op" id="2738465">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2738468">return</span>&nbsp;<span class="ident" id="2738475">NewTimer</span><span class="op" id="2738483">(</span><span class="ident" id="2738484">d</span><span class="op" id="2738485">)</span><span class="op" id="2738486">.</span><span class="ident" id="2738487">C</span><br>
<span class="lineno"></span><span class="op" id="2738489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2738492">//&nbsp;AfterFunc&nbsp;waits&nbsp;for&nbsp;the&nbsp;duration&nbsp;to&nbsp;elapse&nbsp;and&nbsp;then&nbsp;calls&nbsp;f</span><br>
<span class="lineno"></span><span class="comment" id="2738555">//&nbsp;in&nbsp;its&nbsp;own&nbsp;goroutine.&nbsp;It&nbsp;returns&nbsp;a&nbsp;Timer&nbsp;that&nbsp;can</span><br>
<span class="lineno">115</span><span class="comment" id="2738608">//&nbsp;be&nbsp;used&nbsp;to&nbsp;cancel&nbsp;the&nbsp;call&nbsp;using&nbsp;its&nbsp;Stop&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="2738661">func</span>&nbsp;<span class="ident" id="2738666">AfterFunc</span><span class="op" id="2738675">(</span><span class="ident" id="2738676">d</span>&nbsp;<span class="ident" id="2738678">Duration</span><span class="op" id="2738686">,</span>&nbsp;<span class="ident" id="2738688">f</span>&nbsp;<span class="keyword" id="2738690">func</span><span class="op" id="2738694">(</span><span class="op" id="2738695">)</span><span class="op" id="2738696">)</span>&nbsp;<span class="op" id="2738698">*</span><span class="ident" id="2738699">Timer</span>&nbsp;<span class="op" id="2738705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2738708">t</span>&nbsp;<span class="op" id="2738710">:=</span>&nbsp;<span class="op" id="2738713">&amp;</span><span class="ident" id="2738714">Timer</span><span class="op" id="2738719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2738723">r</span><span class="op" id="2738724">:</span>&nbsp;<span class="ident" id="2738726">runtimeTimer</span><span class="op" id="2738738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2738743">when</span><span class="op" id="2738747">:</span>&nbsp;<span class="ident" id="2738749">when</span><span class="op" id="2738753">(</span><span class="ident" id="2738754">d</span><span class="op" id="2738755">)</span><span class="op" id="2738756">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2738761">f</span><span class="op" id="2738762">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2738767">goFunc</span><span class="op" id="2738773">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2738778">arg</span><span class="op" id="2738781">:</span>&nbsp;&nbsp;<span class="ident" id="2738784">f</span><span class="op" id="2738785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2738789">}</span><span class="op" id="2738790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2738793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2738796">startTimer</span><span class="op" id="2738806">(</span><span class="op" id="2738807">&amp;</span><span class="ident" id="2738808">t</span><span class="op" id="2738809">.</span><span class="ident" id="2738810">r</span><span class="op" id="2738811">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2738814">return</span>&nbsp;<span class="ident" id="2738821">t</span><br>
<span class="lineno"></span><span class="op" id="2738823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2738826">func</span>&nbsp;<span class="ident" id="2738831">goFunc</span><span class="op" id="2738837">(</span><span class="ident" id="2738838">arg</span>&nbsp;<span class="keyword" id="2738842">interface</span><span class="op" id="2738851">{</span><span class="op" id="2738852">}</span><span class="op" id="2738853">,</span>&nbsp;<span class="ident" id="2738855">seq</span>&nbsp;<span class="builtintype" id="2738859">uintptr</span><span class="op" id="2738866">)</span>&nbsp;<span class="op" id="2738868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2738871">go</span>&nbsp;<span class="ident" id="2738874">arg</span><span class="op" id="2738877">.</span><span class="op" id="2738878">(</span><span class="keyword" id="2738879">func</span><span class="op" id="2738883">(</span><span class="op" id="2738884">)</span><span class="op" id="2738885">)</span><span class="op" id="2738886">(</span><span class="op" id="2738887">)</span><br>
<span class="lineno">130</span><span class="op" id="2738889">}</span>
</div>
</body>
</html>
