<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5402938">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5402994">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5403048">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5403099">package</span>&nbsp;<span class="ident" id="5403107">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5403113">import</span>&nbsp;<span class="op" id="5403120">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5403123">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5403132">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5403142">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5403147">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5403150">//&nbsp;A&nbsp;Decoder&nbsp;reads&nbsp;and&nbsp;decodes&nbsp;JSON&nbsp;objects&nbsp;from&nbsp;an&nbsp;input&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5403216">type</span>&nbsp;<span class="ident" id="5403221">Decoder</span>&nbsp;<span class="keyword" id="5403229">struct</span>&nbsp;<span class="op" id="5403236">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403239">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5403244">io</span><span class="op" id="5403246">.</span><span class="ident" id="5403247">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403255">buf</span>&nbsp;&nbsp;<span class="op" id="5403260">[</span><span class="op" id="5403261">]</span><span class="builtintype" id="5403262">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403268">d</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5403273">decodeState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403286">scan</span>&nbsp;<span class="ident" id="5403291">scanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403300">err</span>&nbsp;&nbsp;<span class="builtintype" id="5403305">error</span><br>
<span class="lineno">20</span><span class="op" id="5403311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5403314">//&nbsp;NewDecoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;decoder&nbsp;that&nbsp;reads&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5403369">//</span><br>
<span class="lineno"></span><span class="comment" id="5403372">//&nbsp;The&nbsp;decoder&nbsp;introduces&nbsp;its&nbsp;own&nbsp;buffering&nbsp;and&nbsp;may</span><br>
<span class="lineno">25</span><span class="comment" id="5403424">//&nbsp;read&nbsp;data&nbsp;from&nbsp;r&nbsp;beyond&nbsp;the&nbsp;JSON&nbsp;values&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="5403478">func</span>&nbsp;<span class="ident" id="5403483">NewDecoder</span><span class="op" id="5403493">(</span><span class="ident" id="5403494">r</span>&nbsp;<span class="ident" id="5403496">io</span><span class="op" id="5403498">.</span><span class="ident" id="5403499">Reader</span><span class="op" id="5403505">)</span>&nbsp;<span class="op" id="5403507">*</span><span class="ident" id="5403508">Decoder</span>&nbsp;<span class="op" id="5403516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403519">return</span>&nbsp;<span class="op" id="5403526">&amp;</span><span class="ident" id="5403527">Decoder</span><span class="op" id="5403534">{</span><span class="ident" id="5403535">r</span><span class="op" id="5403536">:</span>&nbsp;<span class="ident" id="5403538">r</span><span class="op" id="5403539">}</span><br>
<span class="lineno"></span><span class="op" id="5403541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5403544">//&nbsp;UseNumber&nbsp;causes&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;unmarshal&nbsp;a&nbsp;number&nbsp;into&nbsp;an&nbsp;interface{}&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5403623">//&nbsp;Number&nbsp;instead&nbsp;of&nbsp;as&nbsp;a&nbsp;float64.</span><br>
<span class="lineno"></span><span class="keyword" id="5403658">func</span>&nbsp;<span class="op" id="5403663">(</span><span class="ident" id="5403664">dec</span>&nbsp;<span class="op" id="5403668">*</span><span class="ident" id="5403669">Decoder</span><span class="op" id="5403676">)</span>&nbsp;<span class="ident" id="5403678">UseNumber</span><span class="op" id="5403687">(</span><span class="op" id="5403688">)</span>&nbsp;<span class="op" id="5403690">{</span>&nbsp;<span class="ident" id="5403692">dec</span><span class="op" id="5403695">.</span><span class="ident" id="5403696">d</span><span class="op" id="5403697">.</span><span class="ident" id="5403698">useNumber</span>&nbsp;<span class="op" id="5403708">=</span>&nbsp;<span class="builtintype" id="5403710">true</span>&nbsp;<span class="op" id="5403715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5403718">//&nbsp;Decode&nbsp;reads&nbsp;the&nbsp;next&nbsp;JSON-encoded&nbsp;value&nbsp;from&nbsp;its</span><br>
<span class="lineno">35</span><span class="comment" id="5403771">//&nbsp;input&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to&nbsp;by&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="5403824">//</span><br>
<span class="lineno"></span><span class="comment" id="5403827">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Unmarshal&nbsp;for&nbsp;details&nbsp;about</span><br>
<span class="lineno"></span><span class="comment" id="5403884">//&nbsp;the&nbsp;conversion&nbsp;of&nbsp;JSON&nbsp;into&nbsp;a&nbsp;Go&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5403927">func</span>&nbsp;<span class="op" id="5403932">(</span><span class="ident" id="5403933">dec</span>&nbsp;<span class="op" id="5403937">*</span><span class="ident" id="5403938">Decoder</span><span class="op" id="5403945">)</span>&nbsp;<span class="ident" id="5403947">Decode</span><span class="op" id="5403953">(</span><span class="ident" id="5403954">v</span>&nbsp;<span class="keyword" id="5403956">interface</span><span class="op" id="5403965">{</span><span class="op" id="5403966">}</span><span class="op" id="5403967">)</span>&nbsp;<span class="builtintype" id="5403969">error</span>&nbsp;<span class="op" id="5403975">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403978">if</span>&nbsp;<span class="ident" id="5403981">dec</span><span class="op" id="5403984">.</span><span class="ident" id="5403985">err</span>&nbsp;<span class="op" id="5403989">!=</span>&nbsp;<span class="ident" id="5403992">nil</span>&nbsp;<span class="op" id="5403996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404000">return</span>&nbsp;<span class="ident" id="5404007">dec</span><span class="op" id="5404010">.</span><span class="ident" id="5404011">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5404016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404020">n</span><span class="op" id="5404021">,</span>&nbsp;<span class="ident" id="5404023">err</span>&nbsp;<span class="op" id="5404027">:=</span>&nbsp;<span class="ident" id="5404030">dec</span><span class="op" id="5404033">.</span><span class="ident" id="5404034">readValue</span><span class="op" id="5404043">(</span><span class="op" id="5404044">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404047">if</span>&nbsp;<span class="ident" id="5404050">err</span>&nbsp;<span class="op" id="5404054">!=</span>&nbsp;<span class="ident" id="5404057">nil</span>&nbsp;<span class="op" id="5404061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404065">return</span>&nbsp;<span class="ident" id="5404072">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5404077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404081">//&nbsp;Don&#39;t&nbsp;save&nbsp;err&nbsp;from&nbsp;unmarshal&nbsp;into&nbsp;dec.err:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404129">//&nbsp;the&nbsp;connection&nbsp;is&nbsp;still&nbsp;usable&nbsp;since&nbsp;we&nbsp;read&nbsp;a&nbsp;complete&nbsp;JSON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404194">//&nbsp;object&nbsp;from&nbsp;it&nbsp;before&nbsp;the&nbsp;error&nbsp;happened.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404240">dec</span><span class="op" id="5404243">.</span><span class="ident" id="5404244">d</span><span class="op" id="5404245">.</span><span class="ident" id="5404246">init</span><span class="op" id="5404250">(</span><span class="ident" id="5404251">dec</span><span class="op" id="5404254">.</span><span class="ident" id="5404255">buf</span><span class="op" id="5404258">[</span><span class="num" id="5404259">0</span><span class="op" id="5404260">:</span><span class="ident" id="5404261">n</span><span class="op" id="5404262">]</span><span class="op" id="5404263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404266">err</span>&nbsp;<span class="op" id="5404270">=</span>&nbsp;<span class="ident" id="5404272">dec</span><span class="op" id="5404275">.</span><span class="ident" id="5404276">d</span><span class="op" id="5404277">.</span><span class="ident" id="5404278">unmarshal</span><span class="op" id="5404287">(</span><span class="ident" id="5404288">v</span><span class="op" id="5404289">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404293">//&nbsp;Slide&nbsp;rest&nbsp;of&nbsp;data&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404322">rest</span>&nbsp;<span class="op" id="5404327">:=</span>&nbsp;<span class="builtinfunc" id="5404330">copy</span><span class="op" id="5404334">(</span><span class="ident" id="5404335">dec</span><span class="op" id="5404338">.</span><span class="ident" id="5404339">buf</span><span class="op" id="5404342">,</span>&nbsp;<span class="ident" id="5404344">dec</span><span class="op" id="5404347">.</span><span class="ident" id="5404348">buf</span><span class="op" id="5404351">[</span><span class="ident" id="5404352">n</span><span class="op" id="5404353">:</span><span class="op" id="5404354">]</span><span class="op" id="5404355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404358">dec</span><span class="op" id="5404361">.</span><span class="ident" id="5404362">buf</span>&nbsp;<span class="op" id="5404366">=</span>&nbsp;<span class="ident" id="5404368">dec</span><span class="op" id="5404371">.</span><span class="ident" id="5404372">buf</span><span class="op" id="5404375">[</span><span class="num" id="5404376">0</span><span class="op" id="5404377">:</span><span class="ident" id="5404378">rest</span><span class="op" id="5404382">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404386">return</span>&nbsp;<span class="ident" id="5404393">err</span><br>
<span class="lineno">60</span><span class="op" id="5404397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5404400">//&nbsp;Buffered&nbsp;returns&nbsp;a&nbsp;reader&nbsp;of&nbsp;the&nbsp;data&nbsp;remaining&nbsp;in&nbsp;the&nbsp;Decoder&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5404468">//&nbsp;buffer.&nbsp;The&nbsp;reader&nbsp;is&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="keyword" id="5404530">func</span>&nbsp;<span class="op" id="5404535">(</span><span class="ident" id="5404536">dec</span>&nbsp;<span class="op" id="5404540">*</span><span class="ident" id="5404541">Decoder</span><span class="op" id="5404548">)</span>&nbsp;<span class="ident" id="5404550">Buffered</span><span class="op" id="5404558">(</span><span class="op" id="5404559">)</span>&nbsp;<span class="ident" id="5404561">io</span><span class="op" id="5404563">.</span><span class="ident" id="5404564">Reader</span>&nbsp;<span class="op" id="5404571">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404574">return</span>&nbsp;<span class="ident" id="5404581">bytes</span><span class="op" id="5404586">.</span><span class="ident" id="5404587">NewReader</span><span class="op" id="5404596">(</span><span class="ident" id="5404597">dec</span><span class="op" id="5404600">.</span><span class="ident" id="5404601">buf</span><span class="op" id="5404604">)</span><br>
<span class="lineno"></span><span class="op" id="5404606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5404609">//&nbsp;readValue&nbsp;reads&nbsp;a&nbsp;JSON&nbsp;value&nbsp;into&nbsp;dec.buf.</span><br>
<span class="lineno"></span><span class="comment" id="5404655">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno">70</span><span class="keyword" id="5404697">func</span>&nbsp;<span class="op" id="5404702">(</span><span class="ident" id="5404703">dec</span>&nbsp;<span class="op" id="5404707">*</span><span class="ident" id="5404708">Decoder</span><span class="op" id="5404715">)</span>&nbsp;<span class="ident" id="5404717">readValue</span><span class="op" id="5404726">(</span><span class="op" id="5404727">)</span>&nbsp;<span class="op" id="5404729">(</span><span class="builtintype" id="5404730">int</span><span class="op" id="5404733">,</span>&nbsp;<span class="builtintype" id="5404735">error</span><span class="op" id="5404740">)</span>&nbsp;<span class="op" id="5404742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404745">dec</span><span class="op" id="5404748">.</span><span class="ident" id="5404749">scan</span><span class="op" id="5404753">.</span><span class="ident" id="5404754">reset</span><span class="op" id="5404759">(</span><span class="op" id="5404760">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404764">scanp</span>&nbsp;<span class="op" id="5404770">:=</span>&nbsp;<span class="num" id="5404773">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404776">var</span>&nbsp;<span class="ident" id="5404780">err</span>&nbsp;<span class="builtintype" id="5404784">error</span><br>
<span class="lineno">75</span><span class="ident" id="5404790">Input</span><span class="op" id="5404795">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404798">for</span>&nbsp;<span class="op" id="5404802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404806">//&nbsp;Look&nbsp;in&nbsp;the&nbsp;buffer&nbsp;for&nbsp;a&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404847">for</span>&nbsp;<span class="ident" id="5404851">i</span><span class="op" id="5404852">,</span>&nbsp;<span class="ident" id="5404854">c</span>&nbsp;<span class="op" id="5404856">:=</span>&nbsp;<span class="keyword" id="5404859">range</span>&nbsp;<span class="ident" id="5404865">dec</span><span class="op" id="5404868">.</span><span class="ident" id="5404869">buf</span><span class="op" id="5404872">[</span><span class="ident" id="5404873">scanp</span><span class="op" id="5404878">:</span><span class="op" id="5404879">]</span>&nbsp;<span class="op" id="5404881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404886">dec</span><span class="op" id="5404889">.</span><span class="ident" id="5404890">scan</span><span class="op" id="5404894">.</span><span class="ident" id="5404895">bytes</span><span class="op" id="5404900">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404906">v</span>&nbsp;<span class="op" id="5404908">:=</span>&nbsp;<span class="ident" id="5404911">dec</span><span class="op" id="5404914">.</span><span class="ident" id="5404915">scan</span><span class="op" id="5404919">.</span><span class="ident" id="5404920">step</span><span class="op" id="5404924">(</span><span class="op" id="5404925">&amp;</span><span class="ident" id="5404926">dec</span><span class="op" id="5404929">.</span><span class="ident" id="5404930">scan</span><span class="op" id="5404934">,</span>&nbsp;<span class="builtintype" id="5404936">int</span><span class="op" id="5404939">(</span><span class="ident" id="5404940">c</span><span class="op" id="5404941">)</span><span class="op" id="5404942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404947">if</span>&nbsp;<span class="ident" id="5404950">v</span>&nbsp;<span class="op" id="5404952">==</span>&nbsp;<span class="ident" id="5404955">scanEnd</span>&nbsp;<span class="op" id="5404963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404969">scanp</span>&nbsp;<span class="op" id="5404975">+=</span>&nbsp;<span class="ident" id="5404978">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404984">break</span>&nbsp;<span class="ident" id="5404990">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5404999">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405004">//&nbsp;scanEnd&nbsp;is&nbsp;delayed&nbsp;one&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405039">//&nbsp;We&nbsp;might&nbsp;block&nbsp;trying&nbsp;to&nbsp;get&nbsp;that&nbsp;byte&nbsp;from&nbsp;src,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405094">//&nbsp;so&nbsp;instead&nbsp;invent&nbsp;a&nbsp;space&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405132">if</span>&nbsp;<span class="op" id="5405135">(</span><span class="ident" id="5405136">v</span>&nbsp;<span class="op" id="5405138">==</span>&nbsp;<span class="ident" id="5405141">scanEndObject</span>&nbsp;<span class="op" id="5405155">||</span>&nbsp;<span class="ident" id="5405158">v</span>&nbsp;<span class="op" id="5405160">==</span>&nbsp;<span class="ident" id="5405163">scanEndArray</span><span class="op" id="5405175">)</span>&nbsp;<span class="op" id="5405177">&amp;&amp;</span>&nbsp;<span class="ident" id="5405180">dec</span><span class="op" id="5405183">.</span><span class="ident" id="5405184">scan</span><span class="op" id="5405188">.</span><span class="ident" id="5405189">step</span><span class="op" id="5405193">(</span><span class="op" id="5405194">&amp;</span><span class="ident" id="5405195">dec</span><span class="op" id="5405198">.</span><span class="ident" id="5405199">scan</span><span class="op" id="5405203">,</span>&nbsp;<span class="string" id="5405205">&#39;&nbsp;&#39;</span><span class="op" id="5405208">)</span>&nbsp;<span class="op" id="5405210">==</span>&nbsp;<span class="ident" id="5405213">scanEnd</span>&nbsp;<span class="op" id="5405221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405227">scanp</span>&nbsp;<span class="op" id="5405233">+=</span>&nbsp;<span class="ident" id="5405236">i</span>&nbsp;<span class="op" id="5405238">+</span>&nbsp;<span class="num" id="5405240">1</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405246">break</span>&nbsp;<span class="ident" id="5405252">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405266">if</span>&nbsp;<span class="ident" id="5405269">v</span>&nbsp;<span class="op" id="5405271">==</span>&nbsp;<span class="ident" id="5405274">scanError</span>&nbsp;<span class="op" id="5405284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405290">dec</span><span class="op" id="5405293">.</span><span class="ident" id="5405294">err</span>&nbsp;<span class="op" id="5405298">=</span>&nbsp;<span class="ident" id="5405300">dec</span><span class="op" id="5405303">.</span><span class="ident" id="5405304">scan</span><span class="op" id="5405308">.</span><span class="ident" id="5405309">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405317">return</span>&nbsp;<span class="num" id="5405324">0</span><span class="op" id="5405325">,</span>&nbsp;<span class="ident" id="5405327">dec</span><span class="op" id="5405330">.</span><span class="ident" id="5405331">scan</span><span class="op" id="5405335">.</span><span class="ident" id="5405336">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405351">scanp</span>&nbsp;<span class="op" id="5405357">=</span>&nbsp;<span class="builtinfunc" id="5405359">len</span><span class="op" id="5405362">(</span><span class="ident" id="5405363">dec</span><span class="op" id="5405366">.</span><span class="ident" id="5405367">buf</span><span class="op" id="5405370">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405375">//&nbsp;Did&nbsp;the&nbsp;last&nbsp;read&nbsp;have&nbsp;an&nbsp;error?</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405413">//&nbsp;Delayed&nbsp;until&nbsp;now&nbsp;to&nbsp;allow&nbsp;buffer&nbsp;scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405458">if</span>&nbsp;<span class="ident" id="5405461">err</span>&nbsp;<span class="op" id="5405465">!=</span>&nbsp;<span class="ident" id="5405468">nil</span>&nbsp;<span class="op" id="5405472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405477">if</span>&nbsp;<span class="ident" id="5405480">err</span>&nbsp;<span class="op" id="5405484">==</span>&nbsp;<span class="ident" id="5405487">io</span><span class="op" id="5405489">.</span><span class="ident" id="5405490">EOF</span>&nbsp;<span class="op" id="5405494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405500">if</span>&nbsp;<span class="ident" id="5405503">dec</span><span class="op" id="5405506">.</span><span class="ident" id="5405507">scan</span><span class="op" id="5405511">.</span><span class="ident" id="5405512">step</span><span class="op" id="5405516">(</span><span class="op" id="5405517">&amp;</span><span class="ident" id="5405518">dec</span><span class="op" id="5405521">.</span><span class="ident" id="5405522">scan</span><span class="op" id="5405526">,</span>&nbsp;<span class="string" id="5405528">&#39;&nbsp;&#39;</span><span class="op" id="5405531">)</span>&nbsp;<span class="op" id="5405533">==</span>&nbsp;<span class="ident" id="5405536">scanEnd</span>&nbsp;<span class="op" id="5405544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405551">break</span>&nbsp;<span class="ident" id="5405557">Input</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405573">if</span>&nbsp;<span class="ident" id="5405576">nonSpace</span><span class="op" id="5405584">(</span><span class="ident" id="5405585">dec</span><span class="op" id="5405588">.</span><span class="ident" id="5405589">buf</span><span class="op" id="5405592">)</span>&nbsp;<span class="op" id="5405594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405601">err</span>&nbsp;<span class="op" id="5405605">=</span>&nbsp;<span class="ident" id="5405607">io</span><span class="op" id="5405609">.</span><span class="ident" id="5405610">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405636">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405641">dec</span><span class="op" id="5405644">.</span><span class="ident" id="5405645">err</span>&nbsp;<span class="op" id="5405649">=</span>&nbsp;<span class="ident" id="5405651">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405658">return</span>&nbsp;<span class="num" id="5405665">0</span><span class="op" id="5405666">,</span>&nbsp;<span class="ident" id="5405668">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405679">//&nbsp;Make&nbsp;room&nbsp;to&nbsp;read&nbsp;more&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405724">const</span>&nbsp;<span class="ident" id="5405730">minRead</span>&nbsp;<span class="op" id="5405738">=</span>&nbsp;<span class="num" id="5405740">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405746">if</span>&nbsp;<span class="builtinfunc" id="5405749">cap</span><span class="op" id="5405752">(</span><span class="ident" id="5405753">dec</span><span class="op" id="5405756">.</span><span class="ident" id="5405757">buf</span><span class="op" id="5405760">)</span><span class="op" id="5405761">-</span><span class="builtinfunc" id="5405762">len</span><span class="op" id="5405765">(</span><span class="ident" id="5405766">dec</span><span class="op" id="5405769">.</span><span class="ident" id="5405770">buf</span><span class="op" id="5405773">)</span>&nbsp;<span class="op" id="5405775">&lt;</span>&nbsp;<span class="ident" id="5405777">minRead</span>&nbsp;<span class="op" id="5405785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405790">newBuf</span>&nbsp;<span class="op" id="5405797">:=</span>&nbsp;<span class="builtinfunc" id="5405800">make</span><span class="op" id="5405804">(</span><span class="op" id="5405805">[</span><span class="op" id="5405806">]</span><span class="builtintype" id="5405807">byte</span><span class="op" id="5405811">,</span>&nbsp;<span class="builtinfunc" id="5405813">len</span><span class="op" id="5405816">(</span><span class="ident" id="5405817">dec</span><span class="op" id="5405820">.</span><span class="ident" id="5405821">buf</span><span class="op" id="5405824">)</span><span class="op" id="5405825">,</span>&nbsp;<span class="num" id="5405827">2</span><span class="op" id="5405828">*</span><span class="builtinfunc" id="5405829">cap</span><span class="op" id="5405832">(</span><span class="ident" id="5405833">dec</span><span class="op" id="5405836">.</span><span class="ident" id="5405837">buf</span><span class="op" id="5405840">)</span><span class="op" id="5405841">+</span><span class="ident" id="5405842">minRead</span><span class="op" id="5405849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5405854">copy</span><span class="op" id="5405858">(</span><span class="ident" id="5405859">newBuf</span><span class="op" id="5405865">,</span>&nbsp;<span class="ident" id="5405867">dec</span><span class="op" id="5405870">.</span><span class="ident" id="5405871">buf</span><span class="op" id="5405874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405879">dec</span><span class="op" id="5405882">.</span><span class="ident" id="5405883">buf</span>&nbsp;<span class="op" id="5405887">=</span>&nbsp;<span class="ident" id="5405889">newBuf</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405903">//&nbsp;Read.&nbsp;&nbsp;Delay&nbsp;error&nbsp;for&nbsp;next&nbsp;iteration&nbsp;(after&nbsp;scan).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405960">var</span>&nbsp;<span class="ident" id="5405964">n</span>&nbsp;<span class="builtintype" id="5405966">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405972">n</span><span class="op" id="5405973">,</span>&nbsp;<span class="ident" id="5405975">err</span>&nbsp;<span class="op" id="5405979">=</span>&nbsp;<span class="ident" id="5405981">dec</span><span class="op" id="5405984">.</span><span class="ident" id="5405985">r</span><span class="op" id="5405986">.</span><span class="ident" id="5405987">Read</span><span class="op" id="5405991">(</span><span class="ident" id="5405992">dec</span><span class="op" id="5405995">.</span><span class="ident" id="5405996">buf</span><span class="op" id="5405999">[</span><span class="builtinfunc" id="5406000">len</span><span class="op" id="5406003">(</span><span class="ident" id="5406004">dec</span><span class="op" id="5406007">.</span><span class="ident" id="5406008">buf</span><span class="op" id="5406011">)</span><span class="op" id="5406012">:</span><span class="builtinfunc" id="5406013">cap</span><span class="op" id="5406016">(</span><span class="ident" id="5406017">dec</span><span class="op" id="5406020">.</span><span class="ident" id="5406021">buf</span><span class="op" id="5406024">)</span><span class="op" id="5406025">]</span><span class="op" id="5406026">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406030">dec</span><span class="op" id="5406033">.</span><span class="ident" id="5406034">buf</span>&nbsp;<span class="op" id="5406038">=</span>&nbsp;<span class="ident" id="5406040">dec</span><span class="op" id="5406043">.</span><span class="ident" id="5406044">buf</span><span class="op" id="5406047">[</span><span class="num" id="5406048">0</span>&nbsp;<span class="op" id="5406050">:</span>&nbsp;<span class="builtinfunc" id="5406052">len</span><span class="op" id="5406055">(</span><span class="ident" id="5406056">dec</span><span class="op" id="5406059">.</span><span class="ident" id="5406060">buf</span><span class="op" id="5406063">)</span><span class="op" id="5406064">+</span><span class="ident" id="5406065">n</span><span class="op" id="5406066">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406072">return</span>&nbsp;<span class="ident" id="5406079">scanp</span><span class="op" id="5406084">,</span>&nbsp;<span class="ident" id="5406086">nil</span><br>
<span class="lineno"></span><span class="op" id="5406090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5406093">func</span>&nbsp;<span class="ident" id="5406098">nonSpace</span><span class="op" id="5406106">(</span><span class="ident" id="5406107">b</span>&nbsp;<span class="op" id="5406109">[</span><span class="op" id="5406110">]</span><span class="builtintype" id="5406111">byte</span><span class="op" id="5406115">)</span>&nbsp;<span class="builtintype" id="5406117">bool</span>&nbsp;<span class="op" id="5406122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406125">for</span>&nbsp;<span class="ident" id="5406129">_</span><span class="op" id="5406130">,</span>&nbsp;<span class="ident" id="5406132">c</span>&nbsp;<span class="op" id="5406134">:=</span>&nbsp;<span class="keyword" id="5406137">range</span>&nbsp;<span class="ident" id="5406143">b</span>&nbsp;<span class="op" id="5406145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406149">if</span>&nbsp;<span class="op" id="5406152">!</span><span class="ident" id="5406153">isSpace</span><span class="op" id="5406160">(</span><span class="builtintype" id="5406161">rune</span><span class="op" id="5406165">(</span><span class="ident" id="5406166">c</span><span class="op" id="5406167">)</span><span class="op" id="5406168">)</span>&nbsp;<span class="op" id="5406170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406175">return</span>&nbsp;<span class="builtintype" id="5406182">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406189">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406195">return</span>&nbsp;<span class="builtintype" id="5406202">false</span><br>
<span class="lineno"></span><span class="op" id="5406208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5406211">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;JSON&nbsp;objects&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">140</span><span class="keyword" id="5406266">type</span>&nbsp;<span class="ident" id="5406271">Encoder</span>&nbsp;<span class="keyword" id="5406279">struct</span>&nbsp;<span class="op" id="5406286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406289">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5406293">io</span><span class="op" id="5406295">.</span><span class="ident" id="5406296">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406304">err</span>&nbsp;<span class="builtintype" id="5406308">error</span><br>
<span class="lineno"></span><span class="op" id="5406314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="5406317">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5406371">func</span>&nbsp;<span class="ident" id="5406376">NewEncoder</span><span class="op" id="5406386">(</span><span class="ident" id="5406387">w</span>&nbsp;<span class="ident" id="5406389">io</span><span class="op" id="5406391">.</span><span class="ident" id="5406392">Writer</span><span class="op" id="5406398">)</span>&nbsp;<span class="op" id="5406400">*</span><span class="ident" id="5406401">Encoder</span>&nbsp;<span class="op" id="5406409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406412">return</span>&nbsp;<span class="op" id="5406419">&amp;</span><span class="ident" id="5406420">Encoder</span><span class="op" id="5406427">{</span><span class="ident" id="5406428">w</span><span class="op" id="5406429">:</span>&nbsp;<span class="ident" id="5406431">w</span><span class="op" id="5406432">}</span><br>
<span class="lineno"></span><span class="op" id="5406434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="5406437">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="5406492">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="5406528">//</span><br>
<span class="lineno"></span><span class="comment" id="5406531">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5406590">//&nbsp;conversion&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;JSON.</span><br>
<span class="lineno">155</span><span class="keyword" id="5406626">func</span>&nbsp;<span class="op" id="5406631">(</span><span class="ident" id="5406632">enc</span>&nbsp;<span class="op" id="5406636">*</span><span class="ident" id="5406637">Encoder</span><span class="op" id="5406644">)</span>&nbsp;<span class="ident" id="5406646">Encode</span><span class="op" id="5406652">(</span><span class="ident" id="5406653">v</span>&nbsp;<span class="keyword" id="5406655">interface</span><span class="op" id="5406664">{</span><span class="op" id="5406665">}</span><span class="op" id="5406666">)</span>&nbsp;<span class="builtintype" id="5406668">error</span>&nbsp;<span class="op" id="5406674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406677">if</span>&nbsp;<span class="ident" id="5406680">enc</span><span class="op" id="5406683">.</span><span class="ident" id="5406684">err</span>&nbsp;<span class="op" id="5406688">!=</span>&nbsp;<span class="ident" id="5406691">nil</span>&nbsp;<span class="op" id="5406695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406699">return</span>&nbsp;<span class="ident" id="5406706">enc</span><span class="op" id="5406709">.</span><span class="ident" id="5406710">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406718">e</span>&nbsp;<span class="op" id="5406720">:=</span>&nbsp;<span class="ident" id="5406723">newEncodeState</span><span class="op" id="5406737">(</span><span class="op" id="5406738">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406741">err</span>&nbsp;<span class="op" id="5406745">:=</span>&nbsp;<span class="ident" id="5406748">e</span><span class="op" id="5406749">.</span><span class="ident" id="5406750">marshal</span><span class="op" id="5406757">(</span><span class="ident" id="5406758">v</span><span class="op" id="5406759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406762">if</span>&nbsp;<span class="ident" id="5406765">err</span>&nbsp;<span class="op" id="5406769">!=</span>&nbsp;<span class="ident" id="5406772">nil</span>&nbsp;<span class="op" id="5406776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406780">return</span>&nbsp;<span class="ident" id="5406787">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5406796">//&nbsp;Terminate&nbsp;each&nbsp;value&nbsp;with&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5406837">//&nbsp;This&nbsp;makes&nbsp;the&nbsp;output&nbsp;look&nbsp;a&nbsp;little&nbsp;nicer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5406883">//&nbsp;when&nbsp;debugging,&nbsp;and&nbsp;some&nbsp;kind&nbsp;of&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5406926">//&nbsp;is&nbsp;required&nbsp;if&nbsp;the&nbsp;encoded&nbsp;value&nbsp;was&nbsp;a&nbsp;number,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5406977">//&nbsp;so&nbsp;that&nbsp;the&nbsp;reader&nbsp;knows&nbsp;there&nbsp;aren&#39;t&nbsp;more</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5407024">//&nbsp;digits&nbsp;coming.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407043">e</span><span class="op" id="5407044">.</span><span class="ident" id="5407045">WriteByte</span><span class="op" id="5407054">(</span><span class="string" id="5407055">&#39;\n&#39;</span><span class="op" id="5407059">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407063">if</span>&nbsp;<span class="ident" id="5407066">_</span><span class="op" id="5407067">,</span>&nbsp;<span class="ident" id="5407069">err</span>&nbsp;<span class="op" id="5407073">=</span>&nbsp;<span class="ident" id="5407075">enc</span><span class="op" id="5407078">.</span><span class="ident" id="5407079">w</span><span class="op" id="5407080">.</span><span class="ident" id="5407081">Write</span><span class="op" id="5407086">(</span><span class="ident" id="5407087">e</span><span class="op" id="5407088">.</span><span class="ident" id="5407089">Bytes</span><span class="op" id="5407094">(</span><span class="op" id="5407095">)</span><span class="op" id="5407096">)</span><span class="op" id="5407097">;</span>&nbsp;<span class="ident" id="5407099">err</span>&nbsp;<span class="op" id="5407103">!=</span>&nbsp;<span class="ident" id="5407106">nil</span>&nbsp;<span class="op" id="5407110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407114">enc</span><span class="op" id="5407117">.</span><span class="ident" id="5407118">err</span>&nbsp;<span class="op" id="5407122">=</span>&nbsp;<span class="ident" id="5407124">err</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5407129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407132">encodeStatePool</span><span class="op" id="5407147">.</span><span class="ident" id="5407148">Put</span><span class="op" id="5407151">(</span><span class="ident" id="5407152">e</span><span class="op" id="5407153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407156">return</span>&nbsp;<span class="ident" id="5407163">err</span><br>
<span class="lineno"></span><span class="op" id="5407167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="5407170">//&nbsp;RawMessage&nbsp;is&nbsp;a&nbsp;raw&nbsp;encoded&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="5407214">//&nbsp;It&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;and&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="5407265">//&nbsp;be&nbsp;used&nbsp;to&nbsp;delay&nbsp;JSON&nbsp;decoding&nbsp;or&nbsp;precompute&nbsp;a&nbsp;JSON&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5407330">type</span>&nbsp;<span class="ident" id="5407335">RawMessage</span>&nbsp;<span class="op" id="5407346">[</span><span class="op" id="5407347">]</span><span class="builtintype" id="5407348">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="5407354">//&nbsp;MarshalJSON&nbsp;returns&nbsp;*m&nbsp;as&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;m.</span><br>
<span class="lineno"></span><span class="keyword" id="5407407">func</span>&nbsp;<span class="op" id="5407412">(</span><span class="ident" id="5407413">m</span>&nbsp;<span class="op" id="5407415">*</span><span class="ident" id="5407416">RawMessage</span><span class="op" id="5407426">)</span>&nbsp;<span class="ident" id="5407428">MarshalJSON</span><span class="op" id="5407439">(</span><span class="op" id="5407440">)</span>&nbsp;<span class="op" id="5407442">(</span><span class="op" id="5407443">[</span><span class="op" id="5407444">]</span><span class="builtintype" id="5407445">byte</span><span class="op" id="5407449">,</span>&nbsp;<span class="builtintype" id="5407451">error</span><span class="op" id="5407456">)</span>&nbsp;<span class="op" id="5407458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407461">return</span>&nbsp;<span class="op" id="5407468">*</span><span class="ident" id="5407469">m</span><span class="op" id="5407470">,</span>&nbsp;<span class="ident" id="5407472">nil</span><br>
<span class="lineno"></span><span class="op" id="5407476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="5407479">//&nbsp;UnmarshalJSON&nbsp;sets&nbsp;*m&nbsp;to&nbsp;a&nbsp;copy&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5407523">func</span>&nbsp;<span class="op" id="5407528">(</span><span class="ident" id="5407529">m</span>&nbsp;<span class="op" id="5407531">*</span><span class="ident" id="5407532">RawMessage</span><span class="op" id="5407542">)</span>&nbsp;<span class="ident" id="5407544">UnmarshalJSON</span><span class="op" id="5407557">(</span><span class="ident" id="5407558">data</span>&nbsp;<span class="op" id="5407563">[</span><span class="op" id="5407564">]</span><span class="builtintype" id="5407565">byte</span><span class="op" id="5407569">)</span>&nbsp;<span class="builtintype" id="5407571">error</span>&nbsp;<span class="op" id="5407577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407580">if</span>&nbsp;<span class="ident" id="5407583">m</span>&nbsp;<span class="op" id="5407585">==</span>&nbsp;<span class="ident" id="5407588">nil</span>&nbsp;<span class="op" id="5407592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407596">return</span>&nbsp;<span class="ident" id="5407603">errors</span><span class="op" id="5407609">.</span><span class="ident" id="5407610">New</span><span class="op" id="5407613">(</span><span class="string" id="5407614">&#34;json.RawMessage:&nbsp;UnmarshalJSON&nbsp;on&nbsp;nil&nbsp;pointer&#34;</span><span class="op" id="5407661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5407664">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5407667">*</span><span class="ident" id="5407668">m</span>&nbsp;<span class="op" id="5407670">=</span>&nbsp;<span class="builtinfunc" id="5407672">append</span><span class="op" id="5407678">(</span><span class="op" id="5407679">(</span><span class="op" id="5407680">*</span><span class="ident" id="5407681">m</span><span class="op" id="5407682">)</span><span class="op" id="5407683">[</span><span class="num" id="5407684">0</span><span class="op" id="5407685">:</span><span class="num" id="5407686">0</span><span class="op" id="5407687">]</span><span class="op" id="5407688">,</span>&nbsp;<span class="ident" id="5407690">data</span><span class="op" id="5407694">...</span><span class="op" id="5407697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407700">return</span>&nbsp;<span class="ident" id="5407707">nil</span><br>
<span class="lineno"></span><span class="op" id="5407711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5407714">var</span>&nbsp;<span class="ident" id="5407718">_</span>&nbsp;<span class="ident" id="5407720">Marshaler</span>&nbsp;<span class="op" id="5407730">=</span>&nbsp;<span class="op" id="5407732">(</span><span class="op" id="5407733">*</span><span class="ident" id="5407734">RawMessage</span><span class="op" id="5407744">)</span><span class="op" id="5407745">(</span><span class="ident" id="5407746">nil</span><span class="op" id="5407749">)</span><br>
<span class="lineno">200</span><span class="keyword" id="5407751">var</span>&nbsp;<span class="ident" id="5407755">_</span>&nbsp;<span class="ident" id="5407757">Unmarshaler</span>&nbsp;<span class="op" id="5407769">=</span>&nbsp;<span class="op" id="5407771">(</span><span class="op" id="5407772">*</span><span class="ident" id="5407773">RawMessage</span><span class="op" id="5407783">)</span><span class="op" id="5407784">(</span><span class="ident" id="5407785">nil</span><span class="op" id="5407788">)</span>
</div>
</body>
</html>
