<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4294017">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4294072">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4294126">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4294177">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-output&nbsp;fixedhuff.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4294227">//&nbsp;Package&nbsp;flate&nbsp;implements&nbsp;the&nbsp;DEFLATE&nbsp;compressed&nbsp;data&nbsp;format,&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4294304">//&nbsp;RFC&nbsp;1951.&nbsp;&nbsp;The&nbsp;gzip&nbsp;and&nbsp;zlib&nbsp;packages&nbsp;implement&nbsp;access&nbsp;to&nbsp;DEFLATE-based&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="4294384">//&nbsp;formats.</span><br>
<span class="lineno">10</span><span class="keyword" id="4294396">package</span>&nbsp;<span class="ident" id="4294404">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4294411">import</span>&nbsp;<span class="op" id="4294418">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4294421">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4294430">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4294436">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="4294446">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4294449">const</span>&nbsp;<span class="op" id="4294455">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294458">maxCodeLen</span>&nbsp;<span class="op" id="4294469">=</span>&nbsp;<span class="num" id="4294471">16</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4294477">//&nbsp;max&nbsp;length&nbsp;of&nbsp;Huffman&nbsp;code</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294508">maxHist</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4294519">=</span>&nbsp;<span class="num" id="4294521">32768</span>&nbsp;<span class="comment" id="4294527">//&nbsp;max&nbsp;history&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4294552">//&nbsp;The&nbsp;next&nbsp;three&nbsp;numbers&nbsp;come&nbsp;from&nbsp;the&nbsp;RFC,&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294613">maxLit</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4294622">=</span>&nbsp;<span class="num" id="4294624">286</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294629">maxDist</span>&nbsp;&nbsp;<span class="op" id="4294638">=</span>&nbsp;<span class="num" id="4294640">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4294644">numCodes</span>&nbsp;<span class="op" id="4294653">=</span>&nbsp;<span class="num" id="4294655">19</span>&nbsp;<span class="comment" id="4294658">//&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;Huffman&nbsp;meta-code</span><br>
<span class="lineno">25</span><span class="op" id="4294698">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4294701">//&nbsp;A&nbsp;CorruptInputError&nbsp;reports&nbsp;the&nbsp;presence&nbsp;of&nbsp;corrupt&nbsp;input&nbsp;at&nbsp;a&nbsp;given&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="4294781">type</span>&nbsp;<span class="ident" id="4294786">CorruptInputError</span>&nbsp;<span class="ident" id="4294804">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4294811">func</span>&nbsp;<span class="op" id="4294816">(</span><span class="ident" id="4294817">e</span>&nbsp;<span class="ident" id="4294819">CorruptInputError</span><span class="op" id="4294836">)</span>&nbsp;<span class="ident" id="4294838">Error</span><span class="op" id="4294843">(</span><span class="op" id="4294844">)</span>&nbsp;<span class="builtintype" id="4294846">string</span>&nbsp;<span class="op" id="4294853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4294856">return</span>&nbsp;<span class="string" id="4294863">&#34;flate:&nbsp;corrupt&nbsp;input&nbsp;before&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4294901">+</span>&nbsp;<span class="ident" id="4294903">strconv</span><span class="op" id="4294910">.</span><span class="ident" id="4294911">FormatInt</span><span class="op" id="4294920">(</span><span class="ident" id="4294921">int64</span><span class="op" id="4294926">(</span><span class="ident" id="4294927">e</span><span class="op" id="4294928">)</span><span class="op" id="4294929">,</span>&nbsp;<span class="num" id="4294931">10</span><span class="op" id="4294933">)</span><br>
<span class="lineno"></span><span class="op" id="4294935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4294938">//&nbsp;An&nbsp;InternalError&nbsp;reports&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;flate&nbsp;code&nbsp;itself.</span><br>
<span class="lineno">35</span><span class="keyword" id="4295001">type</span>&nbsp;<span class="ident" id="4295006">InternalError</span>&nbsp;<span class="builtintype" id="4295020">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4295028">func</span>&nbsp;<span class="op" id="4295033">(</span><span class="ident" id="4295034">e</span>&nbsp;<span class="ident" id="4295036">InternalError</span><span class="op" id="4295049">)</span>&nbsp;<span class="ident" id="4295051">Error</span><span class="op" id="4295056">(</span><span class="op" id="4295057">)</span>&nbsp;<span class="builtintype" id="4295059">string</span>&nbsp;<span class="op" id="4295066">{</span>&nbsp;<span class="keyword" id="4295068">return</span>&nbsp;<span class="string" id="4295075">&#34;flate:&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="4295101">+</span>&nbsp;<span class="builtintype" id="4295103">string</span><span class="op" id="4295109">(</span><span class="ident" id="4295110">e</span><span class="op" id="4295111">)</span>&nbsp;<span class="op" id="4295113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4295116">//&nbsp;A&nbsp;ReadError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;reading&nbsp;input.</span><br>
<span class="lineno">40</span><span class="keyword" id="4295181">type</span>&nbsp;<span class="ident" id="4295186">ReadError</span>&nbsp;<span class="keyword" id="4295196">struct</span>&nbsp;<span class="op" id="4295203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295206">Offset</span>&nbsp;<span class="ident" id="4295213">int64</span>&nbsp;<span class="comment" id="4295219">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295256">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4295263">error</span>&nbsp;<span class="comment" id="4295269">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="4295306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4295309">func</span>&nbsp;<span class="op" id="4295314">(</span><span class="ident" id="4295315">e</span>&nbsp;<span class="op" id="4295317">*</span><span class="ident" id="4295318">ReadError</span><span class="op" id="4295327">)</span>&nbsp;<span class="ident" id="4295329">Error</span><span class="op" id="4295334">(</span><span class="op" id="4295335">)</span>&nbsp;<span class="builtintype" id="4295337">string</span>&nbsp;<span class="op" id="4295344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295347">return</span>&nbsp;<span class="string" id="4295354">&#34;flate:&nbsp;read&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4295385">+</span>&nbsp;<span class="ident" id="4295387">strconv</span><span class="op" id="4295394">.</span><span class="ident" id="4295395">FormatInt</span><span class="op" id="4295404">(</span><span class="ident" id="4295405">e</span><span class="op" id="4295406">.</span><span class="ident" id="4295407">Offset</span><span class="op" id="4295413">,</span>&nbsp;<span class="num" id="4295415">10</span><span class="op" id="4295417">)</span>&nbsp;<span class="op" id="4295419">+</span>&nbsp;<span class="string" id="4295421">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4295426">+</span>&nbsp;<span class="ident" id="4295428">e</span><span class="op" id="4295429">.</span><span class="ident" id="4295430">Err</span><span class="op" id="4295433">.</span><span class="ident" id="4295434">Error</span><span class="op" id="4295439">(</span><span class="op" id="4295440">)</span><br>
<span class="lineno"></span><span class="op" id="4295442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4295445">//&nbsp;A&nbsp;WriteError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;writing&nbsp;output.</span><br>
<span class="lineno">50</span><span class="keyword" id="4295512">type</span>&nbsp;<span class="ident" id="4295517">WriteError</span>&nbsp;<span class="keyword" id="4295528">struct</span>&nbsp;<span class="op" id="4295535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295538">Offset</span>&nbsp;<span class="ident" id="4295545">int64</span>&nbsp;<span class="comment" id="4295551">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4295588">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4295595">error</span>&nbsp;<span class="comment" id="4295601">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="4295639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4295642">func</span>&nbsp;<span class="op" id="4295647">(</span><span class="ident" id="4295648">e</span>&nbsp;<span class="op" id="4295650">*</span><span class="ident" id="4295651">WriteError</span><span class="op" id="4295661">)</span>&nbsp;<span class="ident" id="4295663">Error</span><span class="op" id="4295668">(</span><span class="op" id="4295669">)</span>&nbsp;<span class="builtintype" id="4295671">string</span>&nbsp;<span class="op" id="4295678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4295681">return</span>&nbsp;<span class="string" id="4295688">&#34;flate:&nbsp;write&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4295720">+</span>&nbsp;<span class="ident" id="4295722">strconv</span><span class="op" id="4295729">.</span><span class="ident" id="4295730">FormatInt</span><span class="op" id="4295739">(</span><span class="ident" id="4295740">e</span><span class="op" id="4295741">.</span><span class="ident" id="4295742">Offset</span><span class="op" id="4295748">,</span>&nbsp;<span class="num" id="4295750">10</span><span class="op" id="4295752">)</span>&nbsp;<span class="op" id="4295754">+</span>&nbsp;<span class="string" id="4295756">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4295761">+</span>&nbsp;<span class="ident" id="4295763">e</span><span class="op" id="4295764">.</span><span class="ident" id="4295765">Err</span><span class="op" id="4295768">.</span><span class="ident" id="4295769">Error</span><span class="op" id="4295774">(</span><span class="op" id="4295775">)</span><br>
<span class="lineno"></span><span class="op" id="4295777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4295780">//&nbsp;Resetter&nbsp;resets&nbsp;a&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;or&nbsp;NewReaderDict&nbsp;to</span><br>
<span class="lineno">60</span><span class="comment" id="4295854">//&nbsp;to&nbsp;switch&nbsp;to&nbsp;a&nbsp;new&nbsp;underlying&nbsp;Reader.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;ReadCloser</span><br>
<span class="lineno"></span><span class="comment" id="4295929">//&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4295965">type</span>&nbsp;<span class="ident" id="4295970">Resetter</span>&nbsp;<span class="keyword" id="4295979">interface</span>&nbsp;<span class="op" id="4295989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4295992">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data&nbsp;and&nbsp;resets&nbsp;the&nbsp;Resetter&nbsp;as&nbsp;if&nbsp;it&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4296066">//&nbsp;newly&nbsp;initialized&nbsp;with&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4296111">Reset</span><span class="op" id="4296116">(</span><span class="ident" id="4296117">r</span>&nbsp;<span class="ident" id="4296119">io</span><span class="op" id="4296121">.</span><span class="ident" id="4296122">Reader</span><span class="op" id="4296128">,</span>&nbsp;<span class="ident" id="4296130">dict</span>&nbsp;<span class="op" id="4296135">[</span><span class="op" id="4296136">]</span><span class="builtintype" id="4296137">byte</span><span class="op" id="4296141">)</span>&nbsp;<span class="builtintype" id="4296143">error</span><br>
<span class="lineno"></span><span class="op" id="4296149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4296152">//&nbsp;Note&nbsp;that&nbsp;much&nbsp;of&nbsp;the&nbsp;implementation&nbsp;of&nbsp;huffmanDecoder&nbsp;is&nbsp;also&nbsp;copied</span><br>
<span class="lineno"></span><span class="comment" id="4296225">//&nbsp;into&nbsp;gen.go&nbsp;(in&nbsp;package&nbsp;main)&nbsp;for&nbsp;the&nbsp;purpose&nbsp;of&nbsp;precomputing&nbsp;the</span><br>
<span class="lineno">70</span><span class="comment" id="4296294">//&nbsp;fixed&nbsp;huffman&nbsp;tables&nbsp;so&nbsp;they&nbsp;can&nbsp;be&nbsp;included&nbsp;statically.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4296355">//&nbsp;The&nbsp;data&nbsp;structure&nbsp;for&nbsp;decoding&nbsp;Huffman&nbsp;tables&nbsp;is&nbsp;based&nbsp;on&nbsp;that&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4296425">//&nbsp;zlib.&nbsp;There&nbsp;is&nbsp;a&nbsp;lookup&nbsp;table&nbsp;of&nbsp;a&nbsp;fixed&nbsp;bit&nbsp;width&nbsp;(huffmanChunkBits),</span><br>
<span class="lineno"></span><span class="comment" id="4296499">//&nbsp;For&nbsp;codes&nbsp;smaller&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;there&nbsp;are&nbsp;multiple&nbsp;entries</span><br>
<span class="lineno">75</span><span class="comment" id="4296569">//&nbsp;(each&nbsp;combination&nbsp;of&nbsp;trailing&nbsp;bits&nbsp;has&nbsp;the&nbsp;same&nbsp;value).&nbsp;For&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4296638">//&nbsp;larger&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;the&nbsp;table&nbsp;contains&nbsp;a&nbsp;link&nbsp;to&nbsp;an&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="4296711">//&nbsp;table.&nbsp;The&nbsp;width&nbsp;of&nbsp;each&nbsp;entry&nbsp;in&nbsp;the&nbsp;link&nbsp;table&nbsp;is&nbsp;the&nbsp;maximum&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="4296783">//&nbsp;size&nbsp;minus&nbsp;the&nbsp;chunk&nbsp;width.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4296815">//&nbsp;Note&nbsp;that&nbsp;you&nbsp;can&nbsp;do&nbsp;a&nbsp;lookup&nbsp;in&nbsp;the&nbsp;table&nbsp;even&nbsp;without&nbsp;all&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4296883">//&nbsp;filled.&nbsp;Since&nbsp;the&nbsp;extra&nbsp;bits&nbsp;are&nbsp;zero,&nbsp;and&nbsp;the&nbsp;DEFLATE&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4296955">//&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;shorter&nbsp;codes&nbsp;come&nbsp;before&nbsp;longer&nbsp;ones,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4297024">//&nbsp;bit&nbsp;length&nbsp;estimate&nbsp;in&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;lower&nbsp;bound&nbsp;on&nbsp;the&nbsp;actual</span><br>
<span class="lineno"></span><span class="comment" id="4297092">//&nbsp;number&nbsp;of&nbsp;bits.</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4297112">//&nbsp;chunk&nbsp;&amp;&nbsp;15&nbsp;is&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4297144">//&nbsp;chunk&nbsp;&gt;&gt;&nbsp;4&nbsp;is&nbsp;value,&nbsp;including&nbsp;table&nbsp;link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4297190">const</span>&nbsp;<span class="op" id="4297196">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297199">huffmanChunkBits</span>&nbsp;&nbsp;<span class="op" id="4297217">=</span>&nbsp;<span class="num" id="4297219">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297222">huffmanNumChunks</span>&nbsp;&nbsp;<span class="op" id="4297240">=</span>&nbsp;<span class="num" id="4297242">1</span>&nbsp;<span class="op" id="4297244">&lt;&lt;</span>&nbsp;<span class="ident" id="4297247">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297265">huffmanCountMask</span>&nbsp;&nbsp;<span class="op" id="4297283">=</span>&nbsp;<span class="num" id="4297285">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297289">huffmanValueShift</span>&nbsp;<span class="op" id="4297307">=</span>&nbsp;<span class="num" id="4297309">4</span><br>
<span class="lineno"></span><span class="op" id="4297311">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="4297314">type</span>&nbsp;<span class="ident" id="4297319">huffmanDecoder</span>&nbsp;<span class="keyword" id="4297334">struct</span>&nbsp;<span class="op" id="4297341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297344">min</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4297353">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4297378">//&nbsp;the&nbsp;minimum&nbsp;code&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297406">chunks</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4297415">[</span><span class="ident" id="4297416">huffmanNumChunks</span><span class="op" id="4297432">]</span><span class="builtintype" id="4297433">uint32</span>&nbsp;<span class="comment" id="4297440">//&nbsp;chunks&nbsp;as&nbsp;described&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297470">links</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4297479">[</span><span class="op" id="4297480">]</span><span class="op" id="4297481">[</span><span class="op" id="4297482">]</span><span class="builtintype" id="4297483">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4297504">//&nbsp;overflow&nbsp;links</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297523">linkMask</span>&nbsp;<span class="builtintype" id="4297532">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4297557">//&nbsp;mask&nbsp;the&nbsp;width&nbsp;of&nbsp;the&nbsp;link&nbsp;table</span><br>
<span class="lineno"></span><span class="op" id="4297593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4297596">//&nbsp;Initialize&nbsp;Huffman&nbsp;decoding&nbsp;tables&nbsp;from&nbsp;array&nbsp;of&nbsp;code&nbsp;lengths.</span><br>
<span class="lineno"></span><span class="keyword" id="4297662">func</span>&nbsp;<span class="op" id="4297667">(</span><span class="ident" id="4297668">h</span>&nbsp;<span class="op" id="4297670">*</span><span class="ident" id="4297671">huffmanDecoder</span><span class="op" id="4297685">)</span>&nbsp;<span class="ident" id="4297687">init</span><span class="op" id="4297691">(</span><span class="ident" id="4297692">bits</span>&nbsp;<span class="op" id="4297697">[</span><span class="op" id="4297698">]</span><span class="builtintype" id="4297699">int</span><span class="op" id="4297702">)</span>&nbsp;<span class="builtintype" id="4297704">bool</span>&nbsp;<span class="op" id="4297709">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297712">if</span>&nbsp;<span class="ident" id="4297715">h</span><span class="op" id="4297716">.</span><span class="ident" id="4297717">min</span>&nbsp;<span class="op" id="4297721">!=</span>&nbsp;<span class="num" id="4297724">0</span>&nbsp;<span class="op" id="4297726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297730">*</span><span class="ident" id="4297731">h</span>&nbsp;<span class="op" id="4297733">=</span>&nbsp;<span class="ident" id="4297735">huffmanDecoder</span><span class="op" id="4297749">{</span><span class="op" id="4297750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4297757">//&nbsp;Count&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;each&nbsp;length,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4297799">//&nbsp;compute&nbsp;min&nbsp;and&nbsp;max&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297831">var</span>&nbsp;<span class="ident" id="4297835">count</span>&nbsp;<span class="op" id="4297841">[</span><span class="ident" id="4297842">maxCodeLen</span><span class="op" id="4297852">]</span><span class="builtintype" id="4297853">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297858">var</span>&nbsp;<span class="ident" id="4297862">min</span><span class="op" id="4297865">,</span>&nbsp;<span class="ident" id="4297867">max</span>&nbsp;<span class="builtintype" id="4297871">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297876">for</span>&nbsp;<span class="ident" id="4297880">_</span><span class="op" id="4297881">,</span>&nbsp;<span class="ident" id="4297883">n</span>&nbsp;<span class="op" id="4297885">:=</span>&nbsp;<span class="keyword" id="4297888">range</span>&nbsp;<span class="ident" id="4297894">bits</span>&nbsp;<span class="op" id="4297899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297903">if</span>&nbsp;<span class="ident" id="4297906">n</span>&nbsp;<span class="op" id="4297908">==</span>&nbsp;<span class="num" id="4297911">0</span>&nbsp;<span class="op" id="4297913">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297918">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297933">if</span>&nbsp;<span class="ident" id="4297936">min</span>&nbsp;<span class="op" id="4297940">==</span>&nbsp;<span class="num" id="4297943">0</span>&nbsp;<span class="op" id="4297945">||</span>&nbsp;<span class="ident" id="4297948">n</span>&nbsp;<span class="op" id="4297950">&lt;</span>&nbsp;<span class="ident" id="4297952">min</span>&nbsp;<span class="op" id="4297956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297961">min</span>&nbsp;<span class="op" id="4297965">=</span>&nbsp;<span class="ident" id="4297967">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4297971">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4297975">if</span>&nbsp;<span class="ident" id="4297978">n</span>&nbsp;<span class="op" id="4297980">&gt;</span>&nbsp;<span class="ident" id="4297982">max</span>&nbsp;<span class="op" id="4297986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4297991">max</span>&nbsp;<span class="op" id="4297995">=</span>&nbsp;<span class="ident" id="4297997">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298005">count</span><span class="op" id="4298010">[</span><span class="ident" id="4298011">n</span><span class="op" id="4298012">]</span><span class="op" id="4298013">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298017">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298020">if</span>&nbsp;<span class="ident" id="4298023">max</span>&nbsp;<span class="op" id="4298027">==</span>&nbsp;<span class="num" id="4298030">0</span>&nbsp;<span class="op" id="4298032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298036">return</span>&nbsp;<span class="builtintype" id="4298043">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298054">h</span><span class="op" id="4298055">.</span><span class="ident" id="4298056">min</span>&nbsp;<span class="op" id="4298060">=</span>&nbsp;<span class="ident" id="4298062">min</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298067">var</span>&nbsp;<span class="ident" id="4298071">linkBits</span>&nbsp;<span class="builtintype" id="4298080">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298086">var</span>&nbsp;<span class="ident" id="4298090">numLinks</span>&nbsp;<span class="builtintype" id="4298099">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298104">if</span>&nbsp;<span class="ident" id="4298107">max</span>&nbsp;<span class="op" id="4298111">&gt;</span>&nbsp;<span class="ident" id="4298113">huffmanChunkBits</span>&nbsp;<span class="op" id="4298130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298134">linkBits</span>&nbsp;<span class="op" id="4298143">=</span>&nbsp;<span class="builtintype" id="4298145">uint</span><span class="op" id="4298149">(</span><span class="ident" id="4298150">max</span><span class="op" id="4298153">)</span>&nbsp;<span class="op" id="4298155">-</span>&nbsp;<span class="ident" id="4298157">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298176">numLinks</span>&nbsp;<span class="op" id="4298185">=</span>&nbsp;<span class="num" id="4298187">1</span>&nbsp;<span class="op" id="4298189">&lt;&lt;</span>&nbsp;<span class="ident" id="4298192">linkBits</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298203">h</span><span class="op" id="4298204">.</span><span class="ident" id="4298205">linkMask</span>&nbsp;<span class="op" id="4298214">=</span>&nbsp;<span class="builtintype" id="4298216">uint32</span><span class="op" id="4298222">(</span><span class="ident" id="4298223">numLinks</span>&nbsp;<span class="op" id="4298232">-</span>&nbsp;<span class="num" id="4298234">1</span><span class="op" id="4298235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298241">code</span>&nbsp;<span class="op" id="4298246">:=</span>&nbsp;<span class="num" id="4298249">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298252">var</span>&nbsp;<span class="ident" id="4298256">nextcode</span>&nbsp;<span class="op" id="4298265">[</span><span class="ident" id="4298266">maxCodeLen</span><span class="op" id="4298276">]</span><span class="builtintype" id="4298277">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298282">for</span>&nbsp;<span class="ident" id="4298286">i</span>&nbsp;<span class="op" id="4298288">:=</span>&nbsp;<span class="ident" id="4298291">min</span><span class="op" id="4298294">;</span>&nbsp;<span class="ident" id="4298296">i</span>&nbsp;<span class="op" id="4298298">&lt;=</span>&nbsp;<span class="ident" id="4298301">max</span><span class="op" id="4298304">;</span>&nbsp;<span class="ident" id="4298306">i</span><span class="op" id="4298307">++</span>&nbsp;<span class="op" id="4298310">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298314">if</span>&nbsp;<span class="ident" id="4298317">i</span>&nbsp;<span class="op" id="4298319">==</span>&nbsp;<span class="ident" id="4298322">huffmanChunkBits</span><span class="op" id="4298338">+</span><span class="num" id="4298339">1</span>&nbsp;<span class="op" id="4298341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4298346">//&nbsp;create&nbsp;link&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298371">link</span>&nbsp;<span class="op" id="4298376">:=</span>&nbsp;<span class="ident" id="4298379">code</span>&nbsp;<span class="op" id="4298384">&gt;&gt;</span>&nbsp;<span class="num" id="4298387">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298392">if</span>&nbsp;<span class="ident" id="4298395">huffmanNumChunks</span>&nbsp;<span class="op" id="4298412">&lt;</span>&nbsp;<span class="ident" id="4298414">link</span>&nbsp;<span class="op" id="4298419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298425">return</span>&nbsp;<span class="builtintype" id="4298432">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298446">h</span><span class="op" id="4298447">.</span><span class="ident" id="4298448">links</span>&nbsp;<span class="op" id="4298454">=</span>&nbsp;<span class="builtinfunc" id="4298456">make</span><span class="op" id="4298460">(</span><span class="op" id="4298461">[</span><span class="op" id="4298462">]</span><span class="op" id="4298463">[</span><span class="op" id="4298464">]</span><span class="builtintype" id="4298465">uint32</span><span class="op" id="4298471">,</span>&nbsp;<span class="ident" id="4298473">huffmanNumChunks</span><span class="op" id="4298489">-</span><span class="ident" id="4298490">link</span><span class="op" id="4298494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298499">for</span>&nbsp;<span class="ident" id="4298503">j</span>&nbsp;<span class="op" id="4298505">:=</span>&nbsp;<span class="builtintype" id="4298508">uint</span><span class="op" id="4298512">(</span><span class="ident" id="4298513">link</span><span class="op" id="4298517">)</span><span class="op" id="4298518">;</span>&nbsp;<span class="ident" id="4298520">j</span>&nbsp;<span class="op" id="4298522">&lt;</span>&nbsp;<span class="ident" id="4298524">huffmanNumChunks</span><span class="op" id="4298540">;</span>&nbsp;<span class="ident" id="4298542">j</span><span class="op" id="4298543">++</span>&nbsp;<span class="op" id="4298546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298552">reverse</span>&nbsp;<span class="op" id="4298560">:=</span>&nbsp;<span class="builtintype" id="4298563">int</span><span class="op" id="4298566">(</span><span class="ident" id="4298567">reverseByte</span><span class="op" id="4298578">[</span><span class="ident" id="4298579">j</span><span class="op" id="4298580">&gt;&gt;</span><span class="num" id="4298582">8</span><span class="op" id="4298583">]</span><span class="op" id="4298584">)</span>&nbsp;<span class="op" id="4298586">|</span>&nbsp;<span class="builtintype" id="4298588">int</span><span class="op" id="4298591">(</span><span class="ident" id="4298592">reverseByte</span><span class="op" id="4298603">[</span><span class="ident" id="4298604">j</span><span class="op" id="4298605">&amp;</span><span class="num" id="4298606">0xff</span><span class="op" id="4298610">]</span><span class="op" id="4298611">)</span><span class="op" id="4298612">&lt;&lt;</span><span class="num" id="4298614">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298620">reverse</span>&nbsp;<span class="op" id="4298628">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4298632">uint</span><span class="op" id="4298636">(</span><span class="num" id="4298637">16</span>&nbsp;<span class="op" id="4298640">-</span>&nbsp;<span class="ident" id="4298642">huffmanChunkBits</span><span class="op" id="4298658">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298664">off</span>&nbsp;<span class="op" id="4298668">:=</span>&nbsp;<span class="ident" id="4298671">j</span>&nbsp;<span class="op" id="4298673">-</span>&nbsp;<span class="builtintype" id="4298675">uint</span><span class="op" id="4298679">(</span><span class="ident" id="4298680">link</span><span class="op" id="4298684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298690">h</span><span class="op" id="4298691">.</span><span class="ident" id="4298692">chunks</span><span class="op" id="4298698">[</span><span class="ident" id="4298699">reverse</span><span class="op" id="4298706">]</span>&nbsp;<span class="op" id="4298708">=</span>&nbsp;<span class="builtintype" id="4298710">uint32</span><span class="op" id="4298716">(</span><span class="ident" id="4298717">off</span><span class="op" id="4298720">&lt;&lt;</span><span class="ident" id="4298722">huffmanValueShift</span>&nbsp;<span class="op" id="4298740">+</span>&nbsp;<span class="builtintype" id="4298742">uint</span><span class="op" id="4298746">(</span><span class="ident" id="4298747">i</span><span class="op" id="4298748">)</span><span class="op" id="4298749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298755">h</span><span class="op" id="4298756">.</span><span class="ident" id="4298757">links</span><span class="op" id="4298762">[</span><span class="ident" id="4298763">off</span><span class="op" id="4298766">]</span>&nbsp;<span class="op" id="4298768">=</span>&nbsp;<span class="builtinfunc" id="4298770">make</span><span class="op" id="4298774">(</span><span class="op" id="4298775">[</span><span class="op" id="4298776">]</span><span class="builtintype" id="4298777">uint32</span><span class="op" id="4298783">,</span>&nbsp;<span class="num" id="4298785">1</span><span class="op" id="4298786">&lt;&lt;</span><span class="ident" id="4298788">linkBits</span><span class="op" id="4298796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298805">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298809">n</span>&nbsp;<span class="op" id="4298811">:=</span>&nbsp;<span class="ident" id="4298814">count</span><span class="op" id="4298819">[</span><span class="ident" id="4298820">i</span><span class="op" id="4298821">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298825">nextcode</span><span class="op" id="4298833">[</span><span class="ident" id="4298834">i</span><span class="op" id="4298835">]</span>&nbsp;<span class="op" id="4298837">=</span>&nbsp;<span class="ident" id="4298839">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298846">code</span>&nbsp;<span class="op" id="4298851">+=</span>&nbsp;<span class="ident" id="4298854">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298858">code</span>&nbsp;<span class="op" id="4298863">&lt;&lt;=</span>&nbsp;<span class="num" id="4298867">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298870">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298874">for</span>&nbsp;<span class="ident" id="4298878">i</span><span class="op" id="4298879">,</span>&nbsp;<span class="ident" id="4298881">n</span>&nbsp;<span class="op" id="4298883">:=</span>&nbsp;<span class="keyword" id="4298886">range</span>&nbsp;<span class="ident" id="4298892">bits</span>&nbsp;<span class="op" id="4298897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298901">if</span>&nbsp;<span class="ident" id="4298904">n</span>&nbsp;<span class="op" id="4298906">==</span>&nbsp;<span class="num" id="4298909">0</span>&nbsp;<span class="op" id="4298911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4298916">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4298927">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298931">code</span>&nbsp;<span class="op" id="4298936">:=</span>&nbsp;<span class="ident" id="4298939">nextcode</span><span class="op" id="4298947">[</span><span class="ident" id="4298948">n</span><span class="op" id="4298949">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298953">nextcode</span><span class="op" id="4298961">[</span><span class="ident" id="4298962">n</span><span class="op" id="4298963">]</span><span class="op" id="4298964">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4298969">chunk</span>&nbsp;<span class="op" id="4298975">:=</span>&nbsp;<span class="builtintype" id="4298978">uint32</span><span class="op" id="4298984">(</span><span class="ident" id="4298985">i</span><span class="op" id="4298986">&lt;&lt;</span><span class="ident" id="4298988">huffmanValueShift</span>&nbsp;<span class="op" id="4299006">|</span>&nbsp;<span class="ident" id="4299008">n</span><span class="op" id="4299009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299013">reverse</span>&nbsp;<span class="op" id="4299021">:=</span>&nbsp;<span class="builtintype" id="4299024">int</span><span class="op" id="4299027">(</span><span class="ident" id="4299028">reverseByte</span><span class="op" id="4299039">[</span><span class="ident" id="4299040">code</span><span class="op" id="4299044">&gt;&gt;</span><span class="num" id="4299046">8</span><span class="op" id="4299047">]</span><span class="op" id="4299048">)</span>&nbsp;<span class="op" id="4299050">|</span>&nbsp;<span class="builtintype" id="4299052">int</span><span class="op" id="4299055">(</span><span class="ident" id="4299056">reverseByte</span><span class="op" id="4299067">[</span><span class="ident" id="4299068">code</span><span class="op" id="4299072">&amp;</span><span class="num" id="4299073">0xff</span><span class="op" id="4299077">]</span><span class="op" id="4299078">)</span><span class="op" id="4299079">&lt;&lt;</span><span class="num" id="4299081">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299085">reverse</span>&nbsp;<span class="op" id="4299093">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4299097">uint</span><span class="op" id="4299101">(</span><span class="num" id="4299102">16</span>&nbsp;<span class="op" id="4299105">-</span>&nbsp;<span class="ident" id="4299107">n</span><span class="op" id="4299108">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299112">if</span>&nbsp;<span class="ident" id="4299115">n</span>&nbsp;<span class="op" id="4299117">&lt;=</span>&nbsp;<span class="ident" id="4299120">huffmanChunkBits</span>&nbsp;<span class="op" id="4299137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299142">for</span>&nbsp;<span class="ident" id="4299146">off</span>&nbsp;<span class="op" id="4299150">:=</span>&nbsp;<span class="ident" id="4299153">reverse</span><span class="op" id="4299160">;</span>&nbsp;<span class="ident" id="4299162">off</span>&nbsp;<span class="op" id="4299166">&lt;</span>&nbsp;<span class="ident" id="4299168">huffmanNumChunks</span><span class="op" id="4299184">;</span>&nbsp;<span class="ident" id="4299186">off</span>&nbsp;<span class="op" id="4299190">+=</span>&nbsp;<span class="num" id="4299193">1</span>&nbsp;<span class="op" id="4299195">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4299198">uint</span><span class="op" id="4299202">(</span><span class="ident" id="4299203">n</span><span class="op" id="4299204">)</span>&nbsp;<span class="op" id="4299206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299212">h</span><span class="op" id="4299213">.</span><span class="ident" id="4299214">chunks</span><span class="op" id="4299220">[</span><span class="ident" id="4299221">off</span><span class="op" id="4299224">]</span>&nbsp;<span class="op" id="4299226">=</span>&nbsp;<span class="ident" id="4299228">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299241">}</span>&nbsp;<span class="keyword" id="4299243">else</span>&nbsp;<span class="op" id="4299248">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299253">value</span>&nbsp;<span class="op" id="4299259">:=</span>&nbsp;<span class="ident" id="4299262">h</span><span class="op" id="4299263">.</span><span class="ident" id="4299264">chunks</span><span class="op" id="4299270">[</span><span class="ident" id="4299271">reverse</span><span class="op" id="4299278">&amp;</span><span class="op" id="4299279">(</span><span class="ident" id="4299280">huffmanNumChunks</span><span class="op" id="4299296">-</span><span class="num" id="4299297">1</span><span class="op" id="4299298">)</span><span class="op" id="4299299">]</span>&nbsp;<span class="op" id="4299301">&gt;&gt;</span>&nbsp;<span class="ident" id="4299304">huffmanValueShift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299325">if</span>&nbsp;<span class="ident" id="4299328">value</span>&nbsp;<span class="op" id="4299334">&gt;=</span>&nbsp;<span class="builtintype" id="4299337">uint32</span><span class="op" id="4299343">(</span><span class="builtinfunc" id="4299344">len</span><span class="op" id="4299347">(</span><span class="ident" id="4299348">h</span><span class="op" id="4299349">.</span><span class="ident" id="4299350">links</span><span class="op" id="4299355">)</span><span class="op" id="4299356">)</span>&nbsp;<span class="op" id="4299358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299364">return</span>&nbsp;<span class="builtintype" id="4299371">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299385">linktab</span>&nbsp;<span class="op" id="4299393">:=</span>&nbsp;<span class="ident" id="4299396">h</span><span class="op" id="4299397">.</span><span class="ident" id="4299398">links</span><span class="op" id="4299403">[</span><span class="ident" id="4299404">value</span><span class="op" id="4299409">]</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299414">reverse</span>&nbsp;<span class="op" id="4299422">&gt;&gt;=</span>&nbsp;<span class="ident" id="4299426">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299446">for</span>&nbsp;<span class="ident" id="4299450">off</span>&nbsp;<span class="op" id="4299454">:=</span>&nbsp;<span class="ident" id="4299457">reverse</span><span class="op" id="4299464">;</span>&nbsp;<span class="ident" id="4299466">off</span>&nbsp;<span class="op" id="4299470">&lt;</span>&nbsp;<span class="ident" id="4299472">numLinks</span><span class="op" id="4299480">;</span>&nbsp;<span class="ident" id="4299482">off</span>&nbsp;<span class="op" id="4299486">+=</span>&nbsp;<span class="num" id="4299489">1</span>&nbsp;<span class="op" id="4299491">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4299494">uint</span><span class="op" id="4299498">(</span><span class="ident" id="4299499">n</span><span class="op" id="4299500">-</span><span class="ident" id="4299501">huffmanChunkBits</span><span class="op" id="4299517">)</span>&nbsp;<span class="op" id="4299519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299525">linktab</span><span class="op" id="4299532">[</span><span class="ident" id="4299533">off</span><span class="op" id="4299536">]</span>&nbsp;<span class="op" id="4299538">=</span>&nbsp;<span class="ident" id="4299540">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299553">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4299556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4299559">return</span>&nbsp;<span class="builtintype" id="4299566">true</span><br>
<span class="lineno"></span><span class="op" id="4299571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4299574">//&nbsp;The&nbsp;actual&nbsp;read&nbsp;interface&nbsp;needed&nbsp;by&nbsp;NewReader.</span><br>
<span class="lineno">190</span><span class="comment" id="4299624">//&nbsp;If&nbsp;the&nbsp;passed&nbsp;in&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,</span><br>
<span class="lineno"></span><span class="comment" id="4299683">//&nbsp;the&nbsp;NewReader&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="4299734">type</span>&nbsp;<span class="ident" id="4299739">Reader</span>&nbsp;<span class="keyword" id="4299746">interface</span>&nbsp;<span class="op" id="4299756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299759">io</span><span class="op" id="4299761">.</span><span class="ident" id="4299762">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299770">io</span><span class="op" id="4299772">.</span><span class="ident" id="4299773">ByteReader</span><br>
<span class="lineno">195</span><span class="op" id="4299784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4299787">//&nbsp;Decompress&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4299808">type</span>&nbsp;<span class="ident" id="4299813">decompressor</span>&nbsp;<span class="keyword" id="4299826">struct</span>&nbsp;<span class="op" id="4299833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4299836">//&nbsp;Input&nbsp;source.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299854">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4299862">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299870">roffset</span>&nbsp;<span class="ident" id="4299878">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299885">woffset</span>&nbsp;<span class="ident" id="4299893">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4299901">//&nbsp;Input&nbsp;bits,&nbsp;in&nbsp;top&nbsp;of&nbsp;b.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299930">b</span>&nbsp;&nbsp;<span class="builtintype" id="4299933">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4299941">nb</span>&nbsp;<span class="builtintype" id="4299944">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4299951">//&nbsp;Huffman&nbsp;decoders&nbsp;for&nbsp;literal/length,&nbsp;distance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300002">h1</span><span class="op" id="4300004">,</span>&nbsp;<span class="ident" id="4300006">h2</span>&nbsp;<span class="ident" id="4300009">huffmanDecoder</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4300026">//&nbsp;Length&nbsp;arrays&nbsp;used&nbsp;to&nbsp;define&nbsp;Huffman&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300074">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4300083">*</span><span class="op" id="4300084">[</span><span class="ident" id="4300085">maxLit</span>&nbsp;<span class="op" id="4300092">+</span>&nbsp;<span class="ident" id="4300094">maxDist</span><span class="op" id="4300101">]</span><span class="builtintype" id="4300102">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300107">codebits</span>&nbsp;<span class="op" id="4300116">*</span><span class="op" id="4300117">[</span><span class="ident" id="4300118">numCodes</span><span class="op" id="4300126">]</span><span class="builtintype" id="4300127">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4300133">//&nbsp;Output&nbsp;history,&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300161">hist</span>&nbsp;&nbsp;<span class="op" id="4300167">*</span><span class="op" id="4300168">[</span><span class="ident" id="4300169">maxHist</span><span class="op" id="4300176">]</span><span class="builtintype" id="4300177">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300183">hp</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4300189">int</span>&nbsp;&nbsp;<span class="comment" id="4300194">//&nbsp;current&nbsp;output&nbsp;position&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300232">hw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4300238">int</span>&nbsp;&nbsp;<span class="comment" id="4300243">//&nbsp;have&nbsp;written&nbsp;hist[0:hw]&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300279">hfull</span>&nbsp;<span class="builtintype" id="4300285">bool</span>&nbsp;<span class="comment" id="4300290">//&nbsp;buffer&nbsp;has&nbsp;filled&nbsp;at&nbsp;least&nbsp;once</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4300327">//&nbsp;Temporary&nbsp;buffer&nbsp;(avoids&nbsp;repeated&nbsp;allocation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300378">buf</span>&nbsp;<span class="op" id="4300382">[</span><span class="num" id="4300383">4</span><span class="op" id="4300384">]</span><span class="builtintype" id="4300385">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4300392">//&nbsp;Next&nbsp;step&nbsp;in&nbsp;the&nbsp;decompression,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4300428">//&nbsp;and&nbsp;decompression&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300457">step</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4300466">func</span><span class="op" id="4300470">(</span><span class="op" id="4300471">*</span><span class="ident" id="4300472">decompressor</span><span class="op" id="4300484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300487">final</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4300496">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300502">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4300511">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300518">toRead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4300527">[</span><span class="op" id="4300528">]</span><span class="builtintype" id="4300529">byte</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300535">hl</span><span class="op" id="4300537">,</span>&nbsp;<span class="ident" id="4300539">hd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4300544">*</span><span class="ident" id="4300545">huffmanDecoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300561">copyLen</span>&nbsp;&nbsp;<span class="builtintype" id="4300570">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300575">copyDist</span>&nbsp;<span class="builtintype" id="4300584">int</span><br>
<span class="lineno"></span><span class="op" id="4300588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4300591">func</span>&nbsp;<span class="op" id="4300596">(</span><span class="ident" id="4300597">f</span>&nbsp;<span class="op" id="4300599">*</span><span class="ident" id="4300600">decompressor</span><span class="op" id="4300612">)</span>&nbsp;<span class="ident" id="4300614">nextBlock</span><span class="op" id="4300623">(</span><span class="op" id="4300624">)</span>&nbsp;<span class="op" id="4300626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300629">if</span>&nbsp;<span class="ident" id="4300632">f</span><span class="op" id="4300633">.</span><span class="ident" id="4300634">final</span>&nbsp;<span class="op" id="4300640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300644">if</span>&nbsp;<span class="ident" id="4300647">f</span><span class="op" id="4300648">.</span><span class="ident" id="4300649">hw</span>&nbsp;<span class="op" id="4300652">!=</span>&nbsp;<span class="ident" id="4300655">f</span><span class="op" id="4300656">.</span><span class="ident" id="4300657">hp</span>&nbsp;<span class="op" id="4300660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300665">f</span><span class="op" id="4300666">.</span><span class="ident" id="4300667">flush</span><span class="op" id="4300672">(</span><span class="op" id="4300673">(</span><span class="op" id="4300674">*</span><span class="ident" id="4300675">decompressor</span><span class="op" id="4300687">)</span><span class="op" id="4300688">.</span><span class="ident" id="4300689">nextBlock</span><span class="op" id="4300698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300703">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300716">f</span><span class="op" id="4300717">.</span><span class="ident" id="4300718">err</span>&nbsp;<span class="op" id="4300722">=</span>&nbsp;<span class="ident" id="4300724">io</span><span class="op" id="4300726">.</span><span class="ident" id="4300727">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300733">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300744">for</span>&nbsp;<span class="ident" id="4300748">f</span><span class="op" id="4300749">.</span><span class="ident" id="4300750">nb</span>&nbsp;<span class="op" id="4300753">&lt;</span>&nbsp;<span class="num" id="4300755">1</span><span class="op" id="4300756">+</span><span class="num" id="4300757">2</span>&nbsp;<span class="op" id="4300759">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300763">if</span>&nbsp;<span class="ident" id="4300766">f</span><span class="op" id="4300767">.</span><span class="ident" id="4300768">err</span>&nbsp;<span class="op" id="4300772">=</span>&nbsp;<span class="ident" id="4300774">f</span><span class="op" id="4300775">.</span><span class="ident" id="4300776">moreBits</span><span class="op" id="4300784">(</span><span class="op" id="4300785">)</span><span class="op" id="4300786">;</span>&nbsp;<span class="ident" id="4300788">f</span><span class="op" id="4300789">.</span><span class="ident" id="4300790">err</span>&nbsp;<span class="op" id="4300794">!=</span>&nbsp;<span class="ident" id="4300797">nil</span>&nbsp;<span class="op" id="4300801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300806">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4300818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300821">f</span><span class="op" id="4300822">.</span><span class="ident" id="4300823">final</span>&nbsp;<span class="op" id="4300829">=</span>&nbsp;<span class="ident" id="4300831">f</span><span class="op" id="4300832">.</span><span class="ident" id="4300833">b</span><span class="op" id="4300834">&amp;</span><span class="num" id="4300835">1</span>&nbsp;<span class="op" id="4300837">==</span>&nbsp;<span class="num" id="4300840">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300843">f</span><span class="op" id="4300844">.</span><span class="ident" id="4300845">b</span>&nbsp;<span class="op" id="4300847">&gt;&gt;=</span>&nbsp;<span class="num" id="4300851">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300854">typ</span>&nbsp;<span class="op" id="4300858">:=</span>&nbsp;<span class="ident" id="4300861">f</span><span class="op" id="4300862">.</span><span class="ident" id="4300863">b</span>&nbsp;<span class="op" id="4300865">&amp;</span>&nbsp;<span class="num" id="4300867">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300870">f</span><span class="op" id="4300871">.</span><span class="ident" id="4300872">b</span>&nbsp;<span class="op" id="4300874">&gt;&gt;=</span>&nbsp;<span class="num" id="4300878">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300881">f</span><span class="op" id="4300882">.</span><span class="ident" id="4300883">nb</span>&nbsp;<span class="op" id="4300886">-=</span>&nbsp;<span class="num" id="4300889">1</span>&nbsp;<span class="op" id="4300891">+</span>&nbsp;<span class="num" id="4300893">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300896">switch</span>&nbsp;<span class="ident" id="4300903">typ</span>&nbsp;<span class="op" id="4300907">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300910">case</span>&nbsp;<span class="num" id="4300915">0</span><span class="op" id="4300916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300920">f</span><span class="op" id="4300921">.</span><span class="ident" id="4300922">dataBlock</span><span class="op" id="4300931">(</span><span class="op" id="4300932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4300935">case</span>&nbsp;<span class="num" id="4300940">1</span><span class="op" id="4300941">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4300945">//&nbsp;compressed,&nbsp;fixed&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4300983">f</span><span class="op" id="4300984">.</span><span class="ident" id="4300985">hl</span>&nbsp;<span class="op" id="4300988">=</span>&nbsp;<span class="op" id="4300990">&amp;</span><span class="ident" id="4300991">fixedHuffmanDecoder</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301013">f</span><span class="op" id="4301014">.</span><span class="ident" id="4301015">hd</span>&nbsp;<span class="op" id="4301018">=</span>&nbsp;<span class="ident" id="4301020">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301026">f</span><span class="op" id="4301027">.</span><span class="ident" id="4301028">huffmanBlock</span><span class="op" id="4301040">(</span><span class="op" id="4301041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301044">case</span>&nbsp;<span class="num" id="4301049">2</span><span class="op" id="4301050">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4301054">//&nbsp;compressed,&nbsp;dynamic&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301094">if</span>&nbsp;<span class="ident" id="4301097">f</span><span class="op" id="4301098">.</span><span class="ident" id="4301099">err</span>&nbsp;<span class="op" id="4301103">=</span>&nbsp;<span class="ident" id="4301105">f</span><span class="op" id="4301106">.</span><span class="ident" id="4301107">readHuffman</span><span class="op" id="4301118">(</span><span class="op" id="4301119">)</span><span class="op" id="4301120">;</span>&nbsp;<span class="ident" id="4301122">f</span><span class="op" id="4301123">.</span><span class="ident" id="4301124">err</span>&nbsp;<span class="op" id="4301128">!=</span>&nbsp;<span class="ident" id="4301131">nil</span>&nbsp;<span class="op" id="4301135">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301140">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301152">f</span><span class="op" id="4301153">.</span><span class="ident" id="4301154">hl</span>&nbsp;<span class="op" id="4301157">=</span>&nbsp;<span class="op" id="4301159">&amp;</span><span class="ident" id="4301160">f</span><span class="op" id="4301161">.</span><span class="ident" id="4301162">h1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301167">f</span><span class="op" id="4301168">.</span><span class="ident" id="4301169">hd</span>&nbsp;<span class="op" id="4301172">=</span>&nbsp;<span class="op" id="4301174">&amp;</span><span class="ident" id="4301175">f</span><span class="op" id="4301176">.</span><span class="ident" id="4301177">h2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301182">f</span><span class="op" id="4301183">.</span><span class="ident" id="4301184">huffmanBlock</span><span class="op" id="4301196">(</span><span class="op" id="4301197">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301200">default</span><span class="op" id="4301207">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4301211">//&nbsp;3&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301231">f</span><span class="op" id="4301232">.</span><span class="ident" id="4301233">err</span>&nbsp;<span class="op" id="4301237">=</span>&nbsp;<span class="ident" id="4301239">CorruptInputError</span><span class="op" id="4301256">(</span><span class="ident" id="4301257">f</span><span class="op" id="4301258">.</span><span class="ident" id="4301259">roffset</span><span class="op" id="4301266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301269">}</span><br>
<span class="lineno"></span><span class="op" id="4301271">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="4301274">func</span>&nbsp;<span class="op" id="4301279">(</span><span class="ident" id="4301280">f</span>&nbsp;<span class="op" id="4301282">*</span><span class="ident" id="4301283">decompressor</span><span class="op" id="4301295">)</span>&nbsp;<span class="ident" id="4301297">Read</span><span class="op" id="4301301">(</span><span class="ident" id="4301302">b</span>&nbsp;<span class="op" id="4301304">[</span><span class="op" id="4301305">]</span><span class="builtintype" id="4301306">byte</span><span class="op" id="4301310">)</span>&nbsp;<span class="op" id="4301312">(</span><span class="builtintype" id="4301313">int</span><span class="op" id="4301316">,</span>&nbsp;<span class="builtintype" id="4301318">error</span><span class="op" id="4301323">)</span>&nbsp;<span class="op" id="4301325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301328">for</span>&nbsp;<span class="op" id="4301332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301336">if</span>&nbsp;<span class="builtinfunc" id="4301339">len</span><span class="op" id="4301342">(</span><span class="ident" id="4301343">f</span><span class="op" id="4301344">.</span><span class="ident" id="4301345">toRead</span><span class="op" id="4301351">)</span>&nbsp;<span class="op" id="4301353">&gt;</span>&nbsp;<span class="num" id="4301355">0</span>&nbsp;<span class="op" id="4301357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301362">n</span>&nbsp;<span class="op" id="4301364">:=</span>&nbsp;<span class="builtinfunc" id="4301367">copy</span><span class="op" id="4301371">(</span><span class="ident" id="4301372">b</span><span class="op" id="4301373">,</span>&nbsp;<span class="ident" id="4301375">f</span><span class="op" id="4301376">.</span><span class="ident" id="4301377">toRead</span><span class="op" id="4301383">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301388">f</span><span class="op" id="4301389">.</span><span class="ident" id="4301390">toRead</span>&nbsp;<span class="op" id="4301397">=</span>&nbsp;<span class="ident" id="4301399">f</span><span class="op" id="4301400">.</span><span class="ident" id="4301401">toRead</span><span class="op" id="4301407">[</span><span class="ident" id="4301408">n</span><span class="op" id="4301409">:</span><span class="op" id="4301410">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301415">return</span>&nbsp;<span class="ident" id="4301422">n</span><span class="op" id="4301423">,</span>&nbsp;<span class="ident" id="4301425">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301435">if</span>&nbsp;<span class="ident" id="4301438">f</span><span class="op" id="4301439">.</span><span class="ident" id="4301440">err</span>&nbsp;<span class="op" id="4301444">!=</span>&nbsp;<span class="ident" id="4301447">nil</span>&nbsp;<span class="op" id="4301451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301456">return</span>&nbsp;<span class="num" id="4301463">0</span><span class="op" id="4301464">,</span>&nbsp;<span class="ident" id="4301466">f</span><span class="op" id="4301467">.</span><span class="ident" id="4301468">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301478">f</span><span class="op" id="4301479">.</span><span class="ident" id="4301480">step</span><span class="op" id="4301484">(</span><span class="ident" id="4301485">f</span><span class="op" id="4301486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301489">}</span><br>
<span class="lineno"></span><span class="op" id="4301491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="4301494">func</span>&nbsp;<span class="op" id="4301499">(</span><span class="ident" id="4301500">f</span>&nbsp;<span class="op" id="4301502">*</span><span class="ident" id="4301503">decompressor</span><span class="op" id="4301515">)</span>&nbsp;<span class="ident" id="4301517">Close</span><span class="op" id="4301522">(</span><span class="op" id="4301523">)</span>&nbsp;<span class="builtintype" id="4301525">error</span>&nbsp;<span class="op" id="4301531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301534">if</span>&nbsp;<span class="ident" id="4301537">f</span><span class="op" id="4301538">.</span><span class="ident" id="4301539">err</span>&nbsp;<span class="op" id="4301543">==</span>&nbsp;<span class="ident" id="4301546">io</span><span class="op" id="4301548">.</span><span class="ident" id="4301549">EOF</span>&nbsp;<span class="op" id="4301553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301557">return</span>&nbsp;<span class="ident" id="4301564">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301572">return</span>&nbsp;<span class="ident" id="4301579">f</span><span class="op" id="4301580">.</span><span class="ident" id="4301581">err</span><br>
<span class="lineno">295</span><span class="op" id="4301585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4301588">//&nbsp;RFC&nbsp;1951&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span><span class="comment" id="4301615">//&nbsp;Compression&nbsp;with&nbsp;dynamic&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="4301658">var</span>&nbsp;<span class="ident" id="4301662">codeOrder</span>&nbsp;<span class="op" id="4301672">=</span>&nbsp;<span class="op" id="4301674">[</span><span class="op" id="4301675">...</span><span class="op" id="4301678">]</span><span class="builtintype" id="4301679">int</span><span class="op" id="4301682">{</span><span class="num" id="4301683">16</span><span class="op" id="4301685">,</span>&nbsp;<span class="num" id="4301687">17</span><span class="op" id="4301689">,</span>&nbsp;<span class="num" id="4301691">18</span><span class="op" id="4301693">,</span>&nbsp;<span class="num" id="4301695">0</span><span class="op" id="4301696">,</span>&nbsp;<span class="num" id="4301698">8</span><span class="op" id="4301699">,</span>&nbsp;<span class="num" id="4301701">7</span><span class="op" id="4301702">,</span>&nbsp;<span class="num" id="4301704">9</span><span class="op" id="4301705">,</span>&nbsp;<span class="num" id="4301707">6</span><span class="op" id="4301708">,</span>&nbsp;<span class="num" id="4301710">10</span><span class="op" id="4301712">,</span>&nbsp;<span class="num" id="4301714">5</span><span class="op" id="4301715">,</span>&nbsp;<span class="num" id="4301717">11</span><span class="op" id="4301719">,</span>&nbsp;<span class="num" id="4301721">4</span><span class="op" id="4301722">,</span>&nbsp;<span class="num" id="4301724">12</span><span class="op" id="4301726">,</span>&nbsp;<span class="num" id="4301728">3</span><span class="op" id="4301729">,</span>&nbsp;<span class="num" id="4301731">13</span><span class="op" id="4301733">,</span>&nbsp;<span class="num" id="4301735">2</span><span class="op" id="4301736">,</span>&nbsp;<span class="num" id="4301738">14</span><span class="op" id="4301740">,</span>&nbsp;<span class="num" id="4301742">1</span><span class="op" id="4301743">,</span>&nbsp;<span class="num" id="4301745">15</span><span class="op" id="4301747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4301750">func</span>&nbsp;<span class="op" id="4301755">(</span><span class="ident" id="4301756">f</span>&nbsp;<span class="op" id="4301758">*</span><span class="ident" id="4301759">decompressor</span><span class="op" id="4301771">)</span>&nbsp;<span class="ident" id="4301773">readHuffman</span><span class="op" id="4301784">(</span><span class="op" id="4301785">)</span>&nbsp;<span class="builtintype" id="4301787">error</span>&nbsp;<span class="op" id="4301793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4301796">//&nbsp;HLIT[5],&nbsp;HDIST[5],&nbsp;HCLEN[4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301829">for</span>&nbsp;<span class="ident" id="4301833">f</span><span class="op" id="4301834">.</span><span class="ident" id="4301835">nb</span>&nbsp;<span class="op" id="4301838">&lt;</span>&nbsp;<span class="num" id="4301840">5</span><span class="op" id="4301841">+</span><span class="num" id="4301842">5</span><span class="op" id="4301843">+</span><span class="num" id="4301844">4</span>&nbsp;<span class="op" id="4301846">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301850">if</span>&nbsp;<span class="ident" id="4301853">err</span>&nbsp;<span class="op" id="4301857">:=</span>&nbsp;<span class="ident" id="4301860">f</span><span class="op" id="4301861">.</span><span class="ident" id="4301862">moreBits</span><span class="op" id="4301870">(</span><span class="op" id="4301871">)</span><span class="op" id="4301872">;</span>&nbsp;<span class="ident" id="4301874">err</span>&nbsp;<span class="op" id="4301878">!=</span>&nbsp;<span class="ident" id="4301881">nil</span>&nbsp;<span class="op" id="4301885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301890">return</span>&nbsp;<span class="ident" id="4301897">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301909">nlit</span>&nbsp;<span class="op" id="4301914">:=</span>&nbsp;<span class="builtintype" id="4301917">int</span><span class="op" id="4301920">(</span><span class="ident" id="4301921">f</span><span class="op" id="4301922">.</span><span class="ident" id="4301923">b</span><span class="op" id="4301924">&amp;</span><span class="num" id="4301925">0x1F</span><span class="op" id="4301929">)</span>&nbsp;<span class="op" id="4301931">+</span>&nbsp;<span class="num" id="4301933">257</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301938">if</span>&nbsp;<span class="ident" id="4301941">nlit</span>&nbsp;<span class="op" id="4301946">&gt;</span>&nbsp;<span class="ident" id="4301948">maxLit</span>&nbsp;<span class="op" id="4301955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301959">return</span>&nbsp;<span class="ident" id="4301966">CorruptInputError</span><span class="op" id="4301983">(</span><span class="ident" id="4301984">f</span><span class="op" id="4301985">.</span><span class="ident" id="4301986">roffset</span><span class="op" id="4301993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301999">f</span><span class="op" id="4302000">.</span><span class="ident" id="4302001">b</span>&nbsp;<span class="op" id="4302003">&gt;&gt;=</span>&nbsp;<span class="num" id="4302007">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302010">ndist</span>&nbsp;<span class="op" id="4302016">:=</span>&nbsp;<span class="builtintype" id="4302019">int</span><span class="op" id="4302022">(</span><span class="ident" id="4302023">f</span><span class="op" id="4302024">.</span><span class="ident" id="4302025">b</span><span class="op" id="4302026">&amp;</span><span class="num" id="4302027">0x1F</span><span class="op" id="4302031">)</span>&nbsp;<span class="op" id="4302033">+</span>&nbsp;<span class="num" id="4302035">1</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4302038">//&nbsp;maxDist&nbsp;is&nbsp;32,&nbsp;so&nbsp;ndist&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302083">f</span><span class="op" id="4302084">.</span><span class="ident" id="4302085">b</span>&nbsp;<span class="op" id="4302087">&gt;&gt;=</span>&nbsp;<span class="num" id="4302091">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302094">nclen</span>&nbsp;<span class="op" id="4302100">:=</span>&nbsp;<span class="builtintype" id="4302103">int</span><span class="op" id="4302106">(</span><span class="ident" id="4302107">f</span><span class="op" id="4302108">.</span><span class="ident" id="4302109">b</span><span class="op" id="4302110">&amp;</span><span class="num" id="4302111">0xF</span><span class="op" id="4302114">)</span>&nbsp;<span class="op" id="4302116">+</span>&nbsp;<span class="num" id="4302118">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4302121">//&nbsp;numCodes&nbsp;is&nbsp;19,&nbsp;so&nbsp;nclen&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302167">f</span><span class="op" id="4302168">.</span><span class="ident" id="4302169">b</span>&nbsp;<span class="op" id="4302171">&gt;&gt;=</span>&nbsp;<span class="num" id="4302175">4</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302178">f</span><span class="op" id="4302179">.</span><span class="ident" id="4302180">nb</span>&nbsp;<span class="op" id="4302183">-=</span>&nbsp;<span class="num" id="4302186">5</span>&nbsp;<span class="op" id="4302188">+</span>&nbsp;<span class="num" id="4302190">5</span>&nbsp;<span class="op" id="4302192">+</span>&nbsp;<span class="num" id="4302194">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4302198">//&nbsp;(HCLEN+4)*3&nbsp;bits:&nbsp;code&nbsp;lengths&nbsp;in&nbsp;the&nbsp;magic&nbsp;codeOrder&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302263">for</span>&nbsp;<span class="ident" id="4302267">i</span>&nbsp;<span class="op" id="4302269">:=</span>&nbsp;<span class="num" id="4302272">0</span><span class="op" id="4302273">;</span>&nbsp;<span class="ident" id="4302275">i</span>&nbsp;<span class="op" id="4302277">&lt;</span>&nbsp;<span class="ident" id="4302279">nclen</span><span class="op" id="4302284">;</span>&nbsp;<span class="ident" id="4302286">i</span><span class="op" id="4302287">++</span>&nbsp;<span class="op" id="4302290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302294">for</span>&nbsp;<span class="ident" id="4302298">f</span><span class="op" id="4302299">.</span><span class="ident" id="4302300">nb</span>&nbsp;<span class="op" id="4302303">&lt;</span>&nbsp;<span class="num" id="4302305">3</span>&nbsp;<span class="op" id="4302307">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302312">if</span>&nbsp;<span class="ident" id="4302315">err</span>&nbsp;<span class="op" id="4302319">:=</span>&nbsp;<span class="ident" id="4302322">f</span><span class="op" id="4302323">.</span><span class="ident" id="4302324">moreBits</span><span class="op" id="4302332">(</span><span class="op" id="4302333">)</span><span class="op" id="4302334">;</span>&nbsp;<span class="ident" id="4302336">err</span>&nbsp;<span class="op" id="4302340">!=</span>&nbsp;<span class="ident" id="4302343">nil</span>&nbsp;<span class="op" id="4302347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302353">return</span>&nbsp;<span class="ident" id="4302360">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302375">f</span><span class="op" id="4302376">.</span><span class="ident" id="4302377">codebits</span><span class="op" id="4302385">[</span><span class="ident" id="4302386">codeOrder</span><span class="op" id="4302395">[</span><span class="ident" id="4302396">i</span><span class="op" id="4302397">]</span><span class="op" id="4302398">]</span>&nbsp;<span class="op" id="4302400">=</span>&nbsp;<span class="builtintype" id="4302402">int</span><span class="op" id="4302405">(</span><span class="ident" id="4302406">f</span><span class="op" id="4302407">.</span><span class="ident" id="4302408">b</span>&nbsp;<span class="op" id="4302410">&amp;</span>&nbsp;<span class="num" id="4302412">0x7</span><span class="op" id="4302415">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302419">f</span><span class="op" id="4302420">.</span><span class="ident" id="4302421">b</span>&nbsp;<span class="op" id="4302423">&gt;&gt;=</span>&nbsp;<span class="num" id="4302427">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302431">f</span><span class="op" id="4302432">.</span><span class="ident" id="4302433">nb</span>&nbsp;<span class="op" id="4302436">-=</span>&nbsp;<span class="num" id="4302439">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302445">for</span>&nbsp;<span class="ident" id="4302449">i</span>&nbsp;<span class="op" id="4302451">:=</span>&nbsp;<span class="ident" id="4302454">nclen</span><span class="op" id="4302459">;</span>&nbsp;<span class="ident" id="4302461">i</span>&nbsp;<span class="op" id="4302463">&lt;</span>&nbsp;<span class="builtinfunc" id="4302465">len</span><span class="op" id="4302468">(</span><span class="ident" id="4302469">codeOrder</span><span class="op" id="4302478">)</span><span class="op" id="4302479">;</span>&nbsp;<span class="ident" id="4302481">i</span><span class="op" id="4302482">++</span>&nbsp;<span class="op" id="4302485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302489">f</span><span class="op" id="4302490">.</span><span class="ident" id="4302491">codebits</span><span class="op" id="4302499">[</span><span class="ident" id="4302500">codeOrder</span><span class="op" id="4302509">[</span><span class="ident" id="4302510">i</span><span class="op" id="4302511">]</span><span class="op" id="4302512">]</span>&nbsp;<span class="op" id="4302514">=</span>&nbsp;<span class="num" id="4302516">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302522">if</span>&nbsp;<span class="op" id="4302525">!</span><span class="ident" id="4302526">f</span><span class="op" id="4302527">.</span><span class="ident" id="4302528">h1</span><span class="op" id="4302530">.</span><span class="ident" id="4302531">init</span><span class="op" id="4302535">(</span><span class="ident" id="4302536">f</span><span class="op" id="4302537">.</span><span class="ident" id="4302538">codebits</span><span class="op" id="4302546">[</span><span class="num" id="4302547">0</span><span class="op" id="4302548">:</span><span class="op" id="4302549">]</span><span class="op" id="4302550">)</span>&nbsp;<span class="op" id="4302552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302556">return</span>&nbsp;<span class="ident" id="4302563">CorruptInputError</span><span class="op" id="4302580">(</span><span class="ident" id="4302581">f</span><span class="op" id="4302582">.</span><span class="ident" id="4302583">roffset</span><span class="op" id="4302590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4302597">//&nbsp;HLIT&nbsp;+&nbsp;257&nbsp;code&nbsp;lengths,&nbsp;HDIST&nbsp;+&nbsp;1&nbsp;code&nbsp;lengths,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4302650">//&nbsp;using&nbsp;the&nbsp;code&nbsp;length&nbsp;Huffman&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302690">for</span>&nbsp;<span class="ident" id="4302694">i</span><span class="op" id="4302695">,</span>&nbsp;<span class="ident" id="4302697">n</span>&nbsp;<span class="op" id="4302699">:=</span>&nbsp;<span class="num" id="4302702">0</span><span class="op" id="4302703">,</span>&nbsp;<span class="ident" id="4302705">nlit</span><span class="op" id="4302709">+</span><span class="ident" id="4302710">ndist</span><span class="op" id="4302715">;</span>&nbsp;<span class="ident" id="4302717">i</span>&nbsp;<span class="op" id="4302719">&lt;</span>&nbsp;<span class="ident" id="4302721">n</span><span class="op" id="4302722">;</span>&nbsp;<span class="op" id="4302724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302728">x</span><span class="op" id="4302729">,</span>&nbsp;<span class="ident" id="4302731">err</span>&nbsp;<span class="op" id="4302735">:=</span>&nbsp;<span class="ident" id="4302738">f</span><span class="op" id="4302739">.</span><span class="ident" id="4302740">huffSym</span><span class="op" id="4302747">(</span><span class="op" id="4302748">&amp;</span><span class="ident" id="4302749">f</span><span class="op" id="4302750">.</span><span class="ident" id="4302751">h1</span><span class="op" id="4302753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302757">if</span>&nbsp;<span class="ident" id="4302760">err</span>&nbsp;<span class="op" id="4302764">!=</span>&nbsp;<span class="ident" id="4302767">nil</span>&nbsp;<span class="op" id="4302771">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302776">return</span>&nbsp;<span class="ident" id="4302783">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302793">if</span>&nbsp;<span class="ident" id="4302796">x</span>&nbsp;<span class="op" id="4302798">&lt;</span>&nbsp;<span class="num" id="4302800">16</span>&nbsp;<span class="op" id="4302803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4302808">//&nbsp;Actual&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302829">f</span><span class="op" id="4302830">.</span><span class="ident" id="4302831">bits</span><span class="op" id="4302835">[</span><span class="ident" id="4302836">i</span><span class="op" id="4302837">]</span>&nbsp;<span class="op" id="4302839">=</span>&nbsp;<span class="ident" id="4302841">x</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302846">i</span><span class="op" id="4302847">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302853">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4302868">//&nbsp;Repeat&nbsp;previous&nbsp;length&nbsp;or&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302905">var</span>&nbsp;<span class="ident" id="4302909">rep</span>&nbsp;<span class="builtintype" id="4302913">int</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302919">var</span>&nbsp;<span class="ident" id="4302923">nb</span>&nbsp;<span class="builtintype" id="4302926">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302933">var</span>&nbsp;<span class="ident" id="4302937">b</span>&nbsp;<span class="builtintype" id="4302939">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302945">switch</span>&nbsp;<span class="ident" id="4302952">x</span>&nbsp;<span class="op" id="4302954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302958">default</span><span class="op" id="4302965">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302970">return</span>&nbsp;<span class="ident" id="4302977">InternalError</span><span class="op" id="4302990">(</span><span class="string" id="4302991">&#34;unexpected&nbsp;length&nbsp;code&#34;</span><span class="op" id="4303015">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303019">case</span>&nbsp;<span class="num" id="4303024">16</span><span class="op" id="4303026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303031">rep</span>&nbsp;<span class="op" id="4303035">=</span>&nbsp;<span class="num" id="4303037">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303042">nb</span>&nbsp;<span class="op" id="4303045">=</span>&nbsp;<span class="num" id="4303047">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303052">if</span>&nbsp;<span class="ident" id="4303055">i</span>&nbsp;<span class="op" id="4303057">==</span>&nbsp;<span class="num" id="4303060">0</span>&nbsp;<span class="op" id="4303062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303068">return</span>&nbsp;<span class="ident" id="4303075">CorruptInputError</span><span class="op" id="4303092">(</span><span class="ident" id="4303093">f</span><span class="op" id="4303094">.</span><span class="ident" id="4303095">roffset</span><span class="op" id="4303102">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303112">b</span>&nbsp;<span class="op" id="4303114">=</span>&nbsp;<span class="ident" id="4303116">f</span><span class="op" id="4303117">.</span><span class="ident" id="4303118">bits</span><span class="op" id="4303122">[</span><span class="ident" id="4303123">i</span><span class="op" id="4303124">-</span><span class="num" id="4303125">1</span><span class="op" id="4303126">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303130">case</span>&nbsp;<span class="num" id="4303135">17</span><span class="op" id="4303137">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303142">rep</span>&nbsp;<span class="op" id="4303146">=</span>&nbsp;<span class="num" id="4303148">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303153">nb</span>&nbsp;<span class="op" id="4303156">=</span>&nbsp;<span class="num" id="4303158">3</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303163">b</span>&nbsp;<span class="op" id="4303165">=</span>&nbsp;<span class="num" id="4303167">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303171">case</span>&nbsp;<span class="num" id="4303176">18</span><span class="op" id="4303178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303183">rep</span>&nbsp;<span class="op" id="4303187">=</span>&nbsp;<span class="num" id="4303189">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303195">nb</span>&nbsp;<span class="op" id="4303198">=</span>&nbsp;<span class="num" id="4303200">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303205">b</span>&nbsp;<span class="op" id="4303207">=</span>&nbsp;<span class="num" id="4303209">0</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303217">for</span>&nbsp;<span class="ident" id="4303221">f</span><span class="op" id="4303222">.</span><span class="ident" id="4303223">nb</span>&nbsp;<span class="op" id="4303226">&lt;</span>&nbsp;<span class="ident" id="4303228">nb</span>&nbsp;<span class="op" id="4303231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303236">if</span>&nbsp;<span class="ident" id="4303239">err</span>&nbsp;<span class="op" id="4303243">:=</span>&nbsp;<span class="ident" id="4303246">f</span><span class="op" id="4303247">.</span><span class="ident" id="4303248">moreBits</span><span class="op" id="4303256">(</span><span class="op" id="4303257">)</span><span class="op" id="4303258">;</span>&nbsp;<span class="ident" id="4303260">err</span>&nbsp;<span class="op" id="4303264">!=</span>&nbsp;<span class="ident" id="4303267">nil</span>&nbsp;<span class="op" id="4303271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303277">return</span>&nbsp;<span class="ident" id="4303284">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303291">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303299">rep</span>&nbsp;<span class="op" id="4303303">+=</span>&nbsp;<span class="builtintype" id="4303306">int</span><span class="op" id="4303309">(</span><span class="ident" id="4303310">f</span><span class="op" id="4303311">.</span><span class="ident" id="4303312">b</span>&nbsp;<span class="op" id="4303314">&amp;</span>&nbsp;<span class="builtintype" id="4303316">uint32</span><span class="op" id="4303322">(</span><span class="num" id="4303323">1</span><span class="op" id="4303324">&lt;&lt;</span><span class="ident" id="4303326">nb</span><span class="op" id="4303328">-</span><span class="num" id="4303329">1</span><span class="op" id="4303330">)</span><span class="op" id="4303331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303335">f</span><span class="op" id="4303336">.</span><span class="ident" id="4303337">b</span>&nbsp;<span class="op" id="4303339">&gt;&gt;=</span>&nbsp;<span class="ident" id="4303343">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303348">f</span><span class="op" id="4303349">.</span><span class="ident" id="4303350">nb</span>&nbsp;<span class="op" id="4303353">-=</span>&nbsp;<span class="ident" id="4303356">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303361">if</span>&nbsp;<span class="ident" id="4303364">i</span><span class="op" id="4303365">+</span><span class="ident" id="4303366">rep</span>&nbsp;<span class="op" id="4303370">&gt;</span>&nbsp;<span class="ident" id="4303372">n</span>&nbsp;<span class="op" id="4303374">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303379">return</span>&nbsp;<span class="ident" id="4303386">CorruptInputError</span><span class="op" id="4303403">(</span><span class="ident" id="4303404">f</span><span class="op" id="4303405">.</span><span class="ident" id="4303406">roffset</span><span class="op" id="4303413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303421">for</span>&nbsp;<span class="ident" id="4303425">j</span>&nbsp;<span class="op" id="4303427">:=</span>&nbsp;<span class="num" id="4303430">0</span><span class="op" id="4303431">;</span>&nbsp;<span class="ident" id="4303433">j</span>&nbsp;<span class="op" id="4303435">&lt;</span>&nbsp;<span class="ident" id="4303437">rep</span><span class="op" id="4303440">;</span>&nbsp;<span class="ident" id="4303442">j</span><span class="op" id="4303443">++</span>&nbsp;<span class="op" id="4303446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303451">f</span><span class="op" id="4303452">.</span><span class="ident" id="4303453">bits</span><span class="op" id="4303457">[</span><span class="ident" id="4303458">i</span><span class="op" id="4303459">]</span>&nbsp;<span class="op" id="4303461">=</span>&nbsp;<span class="ident" id="4303463">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303468">i</span><span class="op" id="4303469">++</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303481">if</span>&nbsp;<span class="op" id="4303484">!</span><span class="ident" id="4303485">f</span><span class="op" id="4303486">.</span><span class="ident" id="4303487">h1</span><span class="op" id="4303489">.</span><span class="ident" id="4303490">init</span><span class="op" id="4303494">(</span><span class="ident" id="4303495">f</span><span class="op" id="4303496">.</span><span class="ident" id="4303497">bits</span><span class="op" id="4303501">[</span><span class="num" id="4303502">0</span><span class="op" id="4303503">:</span><span class="ident" id="4303504">nlit</span><span class="op" id="4303508">]</span><span class="op" id="4303509">)</span>&nbsp;<span class="op" id="4303511">||</span>&nbsp;<span class="op" id="4303514">!</span><span class="ident" id="4303515">f</span><span class="op" id="4303516">.</span><span class="ident" id="4303517">h2</span><span class="op" id="4303519">.</span><span class="ident" id="4303520">init</span><span class="op" id="4303524">(</span><span class="ident" id="4303525">f</span><span class="op" id="4303526">.</span><span class="ident" id="4303527">bits</span><span class="op" id="4303531">[</span><span class="ident" id="4303532">nlit</span><span class="op" id="4303536">:</span><span class="ident" id="4303537">nlit</span><span class="op" id="4303541">+</span><span class="ident" id="4303542">ndist</span><span class="op" id="4303547">]</span><span class="op" id="4303548">)</span>&nbsp;<span class="op" id="4303550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303554">return</span>&nbsp;<span class="ident" id="4303561">CorruptInputError</span><span class="op" id="4303578">(</span><span class="ident" id="4303579">f</span><span class="op" id="4303580">.</span><span class="ident" id="4303581">roffset</span><span class="op" id="4303588">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303595">return</span>&nbsp;<span class="ident" id="4303602">nil</span><br>
<span class="lineno"></span><span class="op" id="4303606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="4303609">//&nbsp;Decode&nbsp;a&nbsp;single&nbsp;Huffman&nbsp;block&nbsp;from&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="4303650">//&nbsp;hl&nbsp;and&nbsp;hd&nbsp;are&nbsp;the&nbsp;Huffman&nbsp;states&nbsp;for&nbsp;the&nbsp;lit/length&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4303712">//&nbsp;and&nbsp;the&nbsp;distance&nbsp;values,&nbsp;respectively.&nbsp;&nbsp;If&nbsp;hd&nbsp;==&nbsp;nil,&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4303779">//&nbsp;fixed&nbsp;distance&nbsp;encoding&nbsp;associated&nbsp;with&nbsp;fixed&nbsp;Huffman&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="4303844">func</span>&nbsp;<span class="op" id="4303849">(</span><span class="ident" id="4303850">f</span>&nbsp;<span class="op" id="4303852">*</span><span class="ident" id="4303853">decompressor</span><span class="op" id="4303865">)</span>&nbsp;<span class="ident" id="4303867">huffmanBlock</span><span class="op" id="4303879">(</span><span class="op" id="4303880">)</span>&nbsp;<span class="op" id="4303882">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303885">for</span>&nbsp;<span class="op" id="4303889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303893">v</span><span class="op" id="4303894">,</span>&nbsp;<span class="ident" id="4303896">err</span>&nbsp;<span class="op" id="4303900">:=</span>&nbsp;<span class="ident" id="4303903">f</span><span class="op" id="4303904">.</span><span class="ident" id="4303905">huffSym</span><span class="op" id="4303912">(</span><span class="ident" id="4303913">f</span><span class="op" id="4303914">.</span><span class="ident" id="4303915">hl</span><span class="op" id="4303917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303921">if</span>&nbsp;<span class="ident" id="4303924">err</span>&nbsp;<span class="op" id="4303928">!=</span>&nbsp;<span class="ident" id="4303931">nil</span>&nbsp;<span class="op" id="4303935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303940">f</span><span class="op" id="4303941">.</span><span class="ident" id="4303942">err</span>&nbsp;<span class="op" id="4303946">=</span>&nbsp;<span class="ident" id="4303948">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303955">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303968">var</span>&nbsp;<span class="ident" id="4303972">n</span>&nbsp;<span class="builtintype" id="4303974">uint</span>&nbsp;<span class="comment" id="4303979">//&nbsp;number&nbsp;of&nbsp;bits&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304005">var</span>&nbsp;<span class="ident" id="4304009">length</span>&nbsp;<span class="builtintype" id="4304016">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304022">switch</span>&nbsp;<span class="op" id="4304029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304033">case</span>&nbsp;<span class="ident" id="4304038">v</span>&nbsp;<span class="op" id="4304040">&lt;</span>&nbsp;<span class="num" id="4304042">256</span><span class="op" id="4304045">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304050">f</span><span class="op" id="4304051">.</span><span class="ident" id="4304052">hist</span><span class="op" id="4304056">[</span><span class="ident" id="4304057">f</span><span class="op" id="4304058">.</span><span class="ident" id="4304059">hp</span><span class="op" id="4304061">]</span>&nbsp;<span class="op" id="4304063">=</span>&nbsp;<span class="builtintype" id="4304065">byte</span><span class="op" id="4304069">(</span><span class="ident" id="4304070">v</span><span class="op" id="4304071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304076">f</span><span class="op" id="4304077">.</span><span class="ident" id="4304078">hp</span><span class="op" id="4304080">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304086">if</span>&nbsp;<span class="ident" id="4304089">f</span><span class="op" id="4304090">.</span><span class="ident" id="4304091">hp</span>&nbsp;<span class="op" id="4304094">==</span>&nbsp;<span class="builtinfunc" id="4304097">len</span><span class="op" id="4304100">(</span><span class="ident" id="4304101">f</span><span class="op" id="4304102">.</span><span class="ident" id="4304103">hist</span><span class="op" id="4304107">)</span>&nbsp;<span class="op" id="4304109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4304115">//&nbsp;After&nbsp;the&nbsp;flush,&nbsp;continue&nbsp;this&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304159">f</span><span class="op" id="4304160">.</span><span class="ident" id="4304161">flush</span><span class="op" id="4304166">(</span><span class="op" id="4304167">(</span><span class="op" id="4304168">*</span><span class="ident" id="4304169">decompressor</span><span class="op" id="4304181">)</span><span class="op" id="4304182">.</span><span class="ident" id="4304183">huffmanBlock</span><span class="op" id="4304195">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304201">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4304211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304216">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304227">case</span>&nbsp;<span class="ident" id="4304232">v</span>&nbsp;<span class="op" id="4304234">==</span>&nbsp;<span class="num" id="4304237">256</span><span class="op" id="4304240">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4304245">//&nbsp;Done&nbsp;with&nbsp;huffman&nbsp;block;&nbsp;read&nbsp;next&nbsp;block.</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304293">f</span><span class="op" id="4304294">.</span><span class="ident" id="4304295">step</span>&nbsp;<span class="op" id="4304300">=</span>&nbsp;<span class="op" id="4304302">(</span><span class="op" id="4304303">*</span><span class="ident" id="4304304">decompressor</span><span class="op" id="4304316">)</span><span class="op" id="4304317">.</span><span class="ident" id="4304318">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304331">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4304340">//&nbsp;otherwise,&nbsp;reference&nbsp;to&nbsp;older&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304380">case</span>&nbsp;<span class="ident" id="4304385">v</span>&nbsp;<span class="op" id="4304387">&lt;</span>&nbsp;<span class="num" id="4304389">265</span><span class="op" id="4304392">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304397">length</span>&nbsp;<span class="op" id="4304404">=</span>&nbsp;<span class="ident" id="4304406">v</span>&nbsp;<span class="op" id="4304408">-</span>&nbsp;<span class="op" id="4304410">(</span><span class="num" id="4304411">257</span>&nbsp;<span class="op" id="4304415">-</span>&nbsp;<span class="num" id="4304417">3</span><span class="op" id="4304418">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304423">n</span>&nbsp;<span class="op" id="4304425">=</span>&nbsp;<span class="num" id="4304427">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304431">case</span>&nbsp;<span class="ident" id="4304436">v</span>&nbsp;<span class="op" id="4304438">&lt;</span>&nbsp;<span class="num" id="4304440">269</span><span class="op" id="4304443">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304448">length</span>&nbsp;<span class="op" id="4304455">=</span>&nbsp;<span class="ident" id="4304457">v</span><span class="op" id="4304458">*</span><span class="num" id="4304459">2</span>&nbsp;<span class="op" id="4304461">-</span>&nbsp;<span class="op" id="4304463">(</span><span class="num" id="4304464">265</span><span class="op" id="4304467">*</span><span class="num" id="4304468">2</span>&nbsp;<span class="op" id="4304470">-</span>&nbsp;<span class="num" id="4304472">11</span><span class="op" id="4304474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304479">n</span>&nbsp;<span class="op" id="4304481">=</span>&nbsp;<span class="num" id="4304483">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304487">case</span>&nbsp;<span class="ident" id="4304492">v</span>&nbsp;<span class="op" id="4304494">&lt;</span>&nbsp;<span class="num" id="4304496">273</span><span class="op" id="4304499">:</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304504">length</span>&nbsp;<span class="op" id="4304511">=</span>&nbsp;<span class="ident" id="4304513">v</span><span class="op" id="4304514">*</span><span class="num" id="4304515">4</span>&nbsp;<span class="op" id="4304517">-</span>&nbsp;<span class="op" id="4304519">(</span><span class="num" id="4304520">269</span><span class="op" id="4304523">*</span><span class="num" id="4304524">4</span>&nbsp;<span class="op" id="4304526">-</span>&nbsp;<span class="num" id="4304528">19</span><span class="op" id="4304530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304535">n</span>&nbsp;<span class="op" id="4304537">=</span>&nbsp;<span class="num" id="4304539">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304543">case</span>&nbsp;<span class="ident" id="4304548">v</span>&nbsp;<span class="op" id="4304550">&lt;</span>&nbsp;<span class="num" id="4304552">277</span><span class="op" id="4304555">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304560">length</span>&nbsp;<span class="op" id="4304567">=</span>&nbsp;<span class="ident" id="4304569">v</span><span class="op" id="4304570">*</span><span class="num" id="4304571">8</span>&nbsp;<span class="op" id="4304573">-</span>&nbsp;<span class="op" id="4304575">(</span><span class="num" id="4304576">273</span><span class="op" id="4304579">*</span><span class="num" id="4304580">8</span>&nbsp;<span class="op" id="4304582">-</span>&nbsp;<span class="num" id="4304584">35</span><span class="op" id="4304586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304591">n</span>&nbsp;<span class="op" id="4304593">=</span>&nbsp;<span class="num" id="4304595">3</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304599">case</span>&nbsp;<span class="ident" id="4304604">v</span>&nbsp;<span class="op" id="4304606">&lt;</span>&nbsp;<span class="num" id="4304608">281</span><span class="op" id="4304611">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304616">length</span>&nbsp;<span class="op" id="4304623">=</span>&nbsp;<span class="ident" id="4304625">v</span><span class="op" id="4304626">*</span><span class="num" id="4304627">16</span>&nbsp;<span class="op" id="4304630">-</span>&nbsp;<span class="op" id="4304632">(</span><span class="num" id="4304633">277</span><span class="op" id="4304636">*</span><span class="num" id="4304637">16</span>&nbsp;<span class="op" id="4304640">-</span>&nbsp;<span class="num" id="4304642">67</span><span class="op" id="4304644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304649">n</span>&nbsp;<span class="op" id="4304651">=</span>&nbsp;<span class="num" id="4304653">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304657">case</span>&nbsp;<span class="ident" id="4304662">v</span>&nbsp;<span class="op" id="4304664">&lt;</span>&nbsp;<span class="num" id="4304666">285</span><span class="op" id="4304669">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304674">length</span>&nbsp;<span class="op" id="4304681">=</span>&nbsp;<span class="ident" id="4304683">v</span><span class="op" id="4304684">*</span><span class="num" id="4304685">32</span>&nbsp;<span class="op" id="4304688">-</span>&nbsp;<span class="op" id="4304690">(</span><span class="num" id="4304691">281</span><span class="op" id="4304694">*</span><span class="num" id="4304695">32</span>&nbsp;<span class="op" id="4304698">-</span>&nbsp;<span class="num" id="4304700">131</span><span class="op" id="4304703">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304708">n</span>&nbsp;<span class="op" id="4304710">=</span>&nbsp;<span class="num" id="4304712">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304716">default</span><span class="op" id="4304723">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304728">length</span>&nbsp;<span class="op" id="4304735">=</span>&nbsp;<span class="num" id="4304737">258</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304744">n</span>&nbsp;<span class="op" id="4304746">=</span>&nbsp;<span class="num" id="4304748">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4304752">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304756">if</span>&nbsp;<span class="ident" id="4304759">n</span>&nbsp;<span class="op" id="4304761">&gt;</span>&nbsp;<span class="num" id="4304763">0</span>&nbsp;<span class="op" id="4304765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304770">for</span>&nbsp;<span class="ident" id="4304774">f</span><span class="op" id="4304775">.</span><span class="ident" id="4304776">nb</span>&nbsp;<span class="op" id="4304779">&lt;</span>&nbsp;<span class="ident" id="4304781">n</span>&nbsp;<span class="op" id="4304783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304789">if</span>&nbsp;<span class="ident" id="4304792">err</span>&nbsp;<span class="op" id="4304796">=</span>&nbsp;<span class="ident" id="4304798">f</span><span class="op" id="4304799">.</span><span class="ident" id="4304800">moreBits</span><span class="op" id="4304808">(</span><span class="op" id="4304809">)</span><span class="op" id="4304810">;</span>&nbsp;<span class="ident" id="4304812">err</span>&nbsp;<span class="op" id="4304816">!=</span>&nbsp;<span class="ident" id="4304819">nil</span>&nbsp;<span class="op" id="4304823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304830">f</span><span class="op" id="4304831">.</span><span class="ident" id="4304832">err</span>&nbsp;<span class="op" id="4304836">=</span>&nbsp;<span class="ident" id="4304838">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304847">return</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4304858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4304863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304868">length</span>&nbsp;<span class="op" id="4304875">+=</span>&nbsp;<span class="builtintype" id="4304878">int</span><span class="op" id="4304881">(</span><span class="ident" id="4304882">f</span><span class="op" id="4304883">.</span><span class="ident" id="4304884">b</span>&nbsp;<span class="op" id="4304886">&amp;</span>&nbsp;<span class="builtintype" id="4304888">uint32</span><span class="op" id="4304894">(</span><span class="num" id="4304895">1</span><span class="op" id="4304896">&lt;&lt;</span><span class="ident" id="4304898">n</span><span class="op" id="4304899">-</span><span class="num" id="4304900">1</span><span class="op" id="4304901">)</span><span class="op" id="4304902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304907">f</span><span class="op" id="4304908">.</span><span class="ident" id="4304909">b</span>&nbsp;<span class="op" id="4304911">&gt;&gt;=</span>&nbsp;<span class="ident" id="4304915">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304920">f</span><span class="op" id="4304921">.</span><span class="ident" id="4304922">nb</span>&nbsp;<span class="op" id="4304925">-=</span>&nbsp;<span class="ident" id="4304928">n</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4304932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304937">var</span>&nbsp;<span class="ident" id="4304941">dist</span>&nbsp;<span class="builtintype" id="4304946">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304952">if</span>&nbsp;<span class="ident" id="4304955">f</span><span class="op" id="4304956">.</span><span class="ident" id="4304957">hd</span>&nbsp;<span class="op" id="4304960">==</span>&nbsp;<span class="ident" id="4304963">nil</span>&nbsp;<span class="op" id="4304967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304972">for</span>&nbsp;<span class="ident" id="4304976">f</span><span class="op" id="4304977">.</span><span class="ident" id="4304978">nb</span>&nbsp;<span class="op" id="4304981">&lt;</span>&nbsp;<span class="num" id="4304983">5</span>&nbsp;<span class="op" id="4304985">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304991">if</span>&nbsp;<span class="ident" id="4304994">err</span>&nbsp;<span class="op" id="4304998">=</span>&nbsp;<span class="ident" id="4305000">f</span><span class="op" id="4305001">.</span><span class="ident" id="4305002">moreBits</span><span class="op" id="4305010">(</span><span class="op" id="4305011">)</span><span class="op" id="4305012">;</span>&nbsp;<span class="ident" id="4305014">err</span>&nbsp;<span class="op" id="4305018">!=</span>&nbsp;<span class="ident" id="4305021">nil</span>&nbsp;<span class="op" id="4305025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305032">f</span><span class="op" id="4305033">.</span><span class="ident" id="4305034">err</span>&nbsp;<span class="op" id="4305038">=</span>&nbsp;<span class="ident" id="4305040">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305049">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4305060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4305065">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305070">dist</span>&nbsp;<span class="op" id="4305075">=</span>&nbsp;<span class="builtintype" id="4305077">int</span><span class="op" id="4305080">(</span><span class="ident" id="4305081">reverseByte</span><span class="op" id="4305092">[</span><span class="op" id="4305093">(</span><span class="ident" id="4305094">f</span><span class="op" id="4305095">.</span><span class="ident" id="4305096">b</span><span class="op" id="4305097">&amp;</span><span class="num" id="4305098">0x1F</span><span class="op" id="4305102">)</span><span class="op" id="4305103">&lt;&lt;</span><span class="num" id="4305105">3</span><span class="op" id="4305106">]</span><span class="op" id="4305107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305112">f</span><span class="op" id="4305113">.</span><span class="ident" id="4305114">b</span>&nbsp;<span class="op" id="4305116">&gt;&gt;=</span>&nbsp;<span class="num" id="4305120">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305125">f</span><span class="op" id="4305126">.</span><span class="ident" id="4305127">nb</span>&nbsp;<span class="op" id="4305130">-=</span>&nbsp;<span class="num" id="4305133">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4305137">}</span>&nbsp;<span class="keyword" id="4305139">else</span>&nbsp;<span class="op" id="4305144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305149">if</span>&nbsp;<span class="ident" id="4305152">dist</span><span class="op" id="4305156">,</span>&nbsp;<span class="ident" id="4305158">err</span>&nbsp;<span class="op" id="4305162">=</span>&nbsp;<span class="ident" id="4305164">f</span><span class="op" id="4305165">.</span><span class="ident" id="4305166">huffSym</span><span class="op" id="4305173">(</span><span class="ident" id="4305174">f</span><span class="op" id="4305175">.</span><span class="ident" id="4305176">hd</span><span class="op" id="4305178">)</span><span class="op" id="4305179">;</span>&nbsp;<span class="ident" id="4305181">err</span>&nbsp;<span class="op" id="4305185">!=</span>&nbsp;<span class="ident" id="4305188">nil</span>&nbsp;<span class="op" id="4305192">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305198">f</span><span class="op" id="4305199">.</span><span class="ident" id="4305200">err</span>&nbsp;<span class="op" id="4305204">=</span>&nbsp;<span class="ident" id="4305206">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305214">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4305224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4305228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305233">switch</span>&nbsp;<span class="op" id="4305240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305244">case</span>&nbsp;<span class="ident" id="4305249">dist</span>&nbsp;<span class="op" id="4305254">&lt;</span>&nbsp;<span class="num" id="4305256">4</span><span class="op" id="4305257">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305262">dist</span><span class="op" id="4305266">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305271">case</span>&nbsp;<span class="ident" id="4305276">dist</span>&nbsp;<span class="op" id="4305281">&gt;=</span>&nbsp;<span class="num" id="4305284">30</span><span class="op" id="4305286">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305291">f</span><span class="op" id="4305292">.</span><span class="ident" id="4305293">err</span>&nbsp;<span class="op" id="4305297">=</span>&nbsp;<span class="ident" id="4305299">CorruptInputError</span><span class="op" id="4305316">(</span><span class="ident" id="4305317">f</span><span class="op" id="4305318">.</span><span class="ident" id="4305319">roffset</span><span class="op" id="4305326">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305331">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305340">default</span><span class="op" id="4305347">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305352">nb</span>&nbsp;<span class="op" id="4305355">:=</span>&nbsp;<span class="builtintype" id="4305358">uint</span><span class="op" id="4305362">(</span><span class="ident" id="4305363">dist</span><span class="op" id="4305367">-</span><span class="num" id="4305368">2</span><span class="op" id="4305369">)</span>&nbsp;<span class="op" id="4305371">&gt;&gt;</span>&nbsp;<span class="num" id="4305374">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4305379">//&nbsp;have&nbsp;1&nbsp;bit&nbsp;in&nbsp;bottom&nbsp;of&nbsp;dist,&nbsp;need&nbsp;nb&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305429">extra</span>&nbsp;<span class="op" id="4305435">:=</span>&nbsp;<span class="op" id="4305438">(</span><span class="ident" id="4305439">dist</span>&nbsp;<span class="op" id="4305444">&amp;</span>&nbsp;<span class="num" id="4305446">1</span><span class="op" id="4305447">)</span>&nbsp;<span class="op" id="4305449">&lt;&lt;</span>&nbsp;<span class="ident" id="4305452">nb</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305458">for</span>&nbsp;<span class="ident" id="4305462">f</span><span class="op" id="4305463">.</span><span class="ident" id="4305464">nb</span>&nbsp;<span class="op" id="4305467">&lt;</span>&nbsp;<span class="ident" id="4305469">nb</span>&nbsp;<span class="op" id="4305472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305478">if</span>&nbsp;<span class="ident" id="4305481">err</span>&nbsp;<span class="op" id="4305485">=</span>&nbsp;<span class="ident" id="4305487">f</span><span class="op" id="4305488">.</span><span class="ident" id="4305489">moreBits</span><span class="op" id="4305497">(</span><span class="op" id="4305498">)</span><span class="op" id="4305499">;</span>&nbsp;<span class="ident" id="4305501">err</span>&nbsp;<span class="op" id="4305505">!=</span>&nbsp;<span class="ident" id="4305508">nil</span>&nbsp;<span class="op" id="4305512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305519">f</span><span class="op" id="4305520">.</span><span class="ident" id="4305521">err</span>&nbsp;<span class="op" id="4305525">=</span>&nbsp;<span class="ident" id="4305527">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305536">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4305547">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4305552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305557">extra</span>&nbsp;<span class="op" id="4305563">|=</span>&nbsp;<span class="builtintype" id="4305566">int</span><span class="op" id="4305569">(</span><span class="ident" id="4305570">f</span><span class="op" id="4305571">.</span><span class="ident" id="4305572">b</span>&nbsp;<span class="op" id="4305574">&amp;</span>&nbsp;<span class="builtintype" id="4305576">uint32</span><span class="op" id="4305582">(</span><span class="num" id="4305583">1</span><span class="op" id="4305584">&lt;&lt;</span><span class="ident" id="4305586">nb</span><span class="op" id="4305588">-</span><span class="num" id="4305589">1</span><span class="op" id="4305590">)</span><span class="op" id="4305591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305596">f</span><span class="op" id="4305597">.</span><span class="ident" id="4305598">b</span>&nbsp;<span class="op" id="4305600">&gt;&gt;=</span>&nbsp;<span class="ident" id="4305604">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305610">f</span><span class="op" id="4305611">.</span><span class="ident" id="4305612">nb</span>&nbsp;<span class="op" id="4305615">-=</span>&nbsp;<span class="ident" id="4305618">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305624">dist</span>&nbsp;<span class="op" id="4305629">=</span>&nbsp;<span class="num" id="4305631">1</span><span class="op" id="4305632">&lt;&lt;</span><span class="op" id="4305634">(</span><span class="ident" id="4305635">nb</span><span class="op" id="4305637">+</span><span class="num" id="4305638">1</span><span class="op" id="4305639">)</span>&nbsp;<span class="op" id="4305641">+</span>&nbsp;<span class="num" id="4305643">1</span>&nbsp;<span class="op" id="4305645">+</span>&nbsp;<span class="ident" id="4305647">extra</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4305655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4305660">//&nbsp;Copy&nbsp;history[-dist:-dist+length]&nbsp;into&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305711">if</span>&nbsp;<span class="ident" id="4305714">dist</span>&nbsp;<span class="op" id="4305719">&gt;</span>&nbsp;<span class="builtinfunc" id="4305721">len</span><span class="op" id="4305724">(</span><span class="ident" id="4305725">f</span><span class="op" id="4305726">.</span><span class="ident" id="4305727">hist</span><span class="op" id="4305731">)</span>&nbsp;<span class="op" id="4305733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305738">f</span><span class="op" id="4305739">.</span><span class="ident" id="4305740">err</span>&nbsp;<span class="op" id="4305744">=</span>&nbsp;<span class="ident" id="4305746">InternalError</span><span class="op" id="4305759">(</span><span class="string" id="4305760">&#34;bad&nbsp;history&nbsp;distance&#34;</span><span class="op" id="4305782">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305787">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4305796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4305801">//&nbsp;No&nbsp;check&nbsp;on&nbsp;length;&nbsp;encoding&nbsp;can&nbsp;be&nbsp;prescient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305853">if</span>&nbsp;<span class="op" id="4305856">!</span><span class="ident" id="4305857">f</span><span class="op" id="4305858">.</span><span class="ident" id="4305859">hfull</span>&nbsp;<span class="op" id="4305865">&amp;&amp;</span>&nbsp;<span class="ident" id="4305868">dist</span>&nbsp;<span class="op" id="4305873">&gt;</span>&nbsp;<span class="ident" id="4305875">f</span><span class="op" id="4305876">.</span><span class="ident" id="4305877">hp</span>&nbsp;<span class="op" id="4305880">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305885">f</span><span class="op" id="4305886">.</span><span class="ident" id="4305887">err</span>&nbsp;<span class="op" id="4305891">=</span>&nbsp;<span class="ident" id="4305893">CorruptInputError</span><span class="op" id="4305910">(</span><span class="ident" id="4305911">f</span><span class="op" id="4305912">.</span><span class="ident" id="4305913">roffset</span><span class="op" id="4305920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305925">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4305934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4305939">f</span><span class="op" id="4305940">.</span><span class="ident" id="4305941">copyLen</span><span class="op" id="4305948">,</span>&nbsp;<span class="ident" id="4305950">f</span><span class="op" id="4305951">.</span><span class="ident" id="4305952">copyDist</span>&nbsp;<span class="op" id="4305961">=</span>&nbsp;<span class="ident" id="4305963">length</span><span class="op" id="4305969">,</span>&nbsp;<span class="ident" id="4305971">dist</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305978">if</span>&nbsp;<span class="ident" id="4305981">f</span><span class="op" id="4305982">.</span><span class="ident" id="4305983">copyHist</span><span class="op" id="4305991">(</span><span class="op" id="4305992">)</span>&nbsp;<span class="op" id="4305994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4305999">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4306008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4306011">}</span><br>
<span class="lineno"></span><span class="op" id="4306013">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span><span class="comment" id="4306016">//&nbsp;copyHist&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;f.hist&nbsp;(f.copyDist&nbsp;bytes&nbsp;ago)&nbsp;to&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="4306097">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;the&nbsp;f.hist&nbsp;buffer&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4306146">func</span>&nbsp;<span class="op" id="4306151">(</span><span class="ident" id="4306152">f</span>&nbsp;<span class="op" id="4306154">*</span><span class="ident" id="4306155">decompressor</span><span class="op" id="4306167">)</span>&nbsp;<span class="ident" id="4306169">copyHist</span><span class="op" id="4306177">(</span><span class="op" id="4306178">)</span>&nbsp;<span class="builtintype" id="4306180">bool</span>&nbsp;<span class="op" id="4306185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306188">p</span>&nbsp;<span class="op" id="4306190">:=</span>&nbsp;<span class="ident" id="4306193">f</span><span class="op" id="4306194">.</span><span class="ident" id="4306195">hp</span>&nbsp;<span class="op" id="4306198">-</span>&nbsp;<span class="ident" id="4306200">f</span><span class="op" id="4306201">.</span><span class="ident" id="4306202">copyDist</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4306212">if</span>&nbsp;<span class="ident" id="4306215">p</span>&nbsp;<span class="op" id="4306217">&lt;</span>&nbsp;<span class="num" id="4306219">0</span>&nbsp;<span class="op" id="4306221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306225">p</span>&nbsp;<span class="op" id="4306227">+=</span>&nbsp;<span class="builtinfunc" id="4306230">len</span><span class="op" id="4306233">(</span><span class="ident" id="4306234">f</span><span class="op" id="4306235">.</span><span class="ident" id="4306236">hist</span><span class="op" id="4306240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4306243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4306246">for</span>&nbsp;<span class="ident" id="4306250">f</span><span class="op" id="4306251">.</span><span class="ident" id="4306252">copyLen</span>&nbsp;<span class="op" id="4306260">&gt;</span>&nbsp;<span class="num" id="4306262">0</span>&nbsp;<span class="op" id="4306264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306268">n</span>&nbsp;<span class="op" id="4306270">:=</span>&nbsp;<span class="ident" id="4306273">f</span><span class="op" id="4306274">.</span><span class="ident" id="4306275">copyLen</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4306285">if</span>&nbsp;<span class="ident" id="4306288">x</span>&nbsp;<span class="op" id="4306290">:=</span>&nbsp;<span class="builtinfunc" id="4306293">len</span><span class="op" id="4306296">(</span><span class="ident" id="4306297">f</span><span class="op" id="4306298">.</span><span class="ident" id="4306299">hist</span><span class="op" id="4306303">)</span>&nbsp;<span class="op" id="4306305">-</span>&nbsp;<span class="ident" id="4306307">f</span><span class="op" id="4306308">.</span><span class="ident" id="4306309">hp</span><span class="op" id="4306311">;</span>&nbsp;<span class="ident" id="4306313">n</span>&nbsp;<span class="op" id="4306315">&gt;</span>&nbsp;<span class="ident" id="4306317">x</span>&nbsp;<span class="op" id="4306319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306324">n</span>&nbsp;<span class="op" id="4306326">=</span>&nbsp;<span class="ident" id="4306328">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4306332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4306336">if</span>&nbsp;<span class="ident" id="4306339">x</span>&nbsp;<span class="op" id="4306341">:=</span>&nbsp;<span class="builtinfunc" id="4306344">len</span><span class="op" id="4306347">(</span><span class="ident" id="4306348">f</span><span class="op" id="4306349">.</span><span class="ident" id="4306350">hist</span><span class="op" id="4306354">)</span>&nbsp;<span class="op" id="4306356">-</span>&nbsp;<span class="ident" id="4306358">p</span><span class="op" id="4306359">;</span>&nbsp;<span class="ident" id="4306361">n</span>&nbsp;<span class="op" id="4306363">&gt;</span>&nbsp;<span class="ident" id="4306365">x</span>&nbsp;<span class="op" id="4306367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306372">n</span>&nbsp;<span class="op" id="4306374">=</span>&nbsp;<span class="ident" id="4306376">x</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4306380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306384">forwardCopy</span><span class="op" id="4306395">(</span><span class="ident" id="4306396">f</span><span class="op" id="4306397">.</span><span class="ident" id="4306398">hist</span><span class="op" id="4306402">[</span><span class="op" id="4306403">:</span><span class="op" id="4306404">]</span><span class="op" id="4306405">,</span>&nbsp;<span class="ident" id="4306407">f</span><span class="op" id="4306408">.</span><span class="ident" id="4306409">hp</span><span class="op" id="4306411">,</span>&nbsp;<span class="ident" id="4306413">p</span><span class="op" id="4306414">,</span>&nbsp;<span class="ident" id="4306416">n</span><span class="op" id="4306417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306421">p</span>&nbsp;<span class="op" id="4306423">+=</span>&nbsp;<span class="ident" id="4306426">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306430">f</span><span class="op" id="4306431">.</span><span class="ident" id="4306432">hp</span>&nbsp;<span class="op" id="4306435">+=</span>&nbsp;<span class="ident" id="4306438">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306442">f</span><span class="op" id="4306443">.</span><span class="ident" id="4306444">copyLen</span>&nbsp;<span class="op" id="4306452">-=</span>&nbsp;<span class="ident" id="4306455">n</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4306459">if</span>&nbsp;<span class="ident" id="4306462">f</span><span class="op" id="4306463">.</span><span class="ident" id="4306464">hp</span>&nbsp;<span class="op" id="4306467">==</span>&nbsp;<span class="builtinfunc" id="4306470">len</span><span class="op" id="4306473">(</span><span class="ident" id="4306474">f</span><span class="op" id="4306475">.</span><span class="ident" id="4306476">hist</span><span class="op" id="4306480">)</span>&nbsp;<span class="op" id="4306482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4306487">//&nbsp;After&nbsp;flush&nbsp;continue&nbsp;copying&nbsp;out&nbsp;of&nbsp;history.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306538">f</span><span class="op" id="4306539">.</span><span class="ident" id="4306540">flush</span><span class="op" id="4306545">(</span><span class="op" id="4306546">(</span><span class="op" id="4306547">*</span><span class="ident" id="4306548">decompressor</span><span class="op" id="4306560">)</span><span class="op" id="4306561">.</span><span class="ident" id="4306562">copyHuff</span><span class="op" id="4306570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4306575">return</span>&nbsp;<span class="builtintype" id="4306582">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4306589">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4306593">if</span>&nbsp;<span class="ident" id="4306596">p</span>&nbsp;<span class="op" id="4306598">==</span>&nbsp;<span class="builtinfunc" id="4306601">len</span><span class="op" id="4306604">(</span><span class="ident" id="4306605">f</span><span class="op" id="4306606">.</span><span class="ident" id="4306607">hist</span><span class="op" id="4306611">)</span>&nbsp;<span class="op" id="4306613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306618">p</span>&nbsp;<span class="op" id="4306620">=</span>&nbsp;<span class="num" id="4306622">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4306626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4306629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4306632">return</span>&nbsp;<span class="builtintype" id="4306639">false</span><br>
<span class="lineno">550</span><span class="op" id="4306645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4306648">func</span>&nbsp;<span class="op" id="4306653">(</span><span class="ident" id="4306654">f</span>&nbsp;<span class="op" id="4306656">*</span><span class="ident" id="4306657">decompressor</span><span class="op" id="4306669">)</span>&nbsp;<span class="ident" id="4306671">copyHuff</span><span class="op" id="4306679">(</span><span class="op" id="4306680">)</span>&nbsp;<span class="op" id="4306682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4306685">if</span>&nbsp;<span class="ident" id="4306688">f</span><span class="op" id="4306689">.</span><span class="ident" id="4306690">copyHist</span><span class="op" id="4306698">(</span><span class="op" id="4306699">)</span>&nbsp;<span class="op" id="4306701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4306705">return</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4306713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306716">f</span><span class="op" id="4306717">.</span><span class="ident" id="4306718">huffmanBlock</span><span class="op" id="4306730">(</span><span class="op" id="4306731">)</span><br>
<span class="lineno"></span><span class="op" id="4306733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4306736">//&nbsp;Copy&nbsp;a&nbsp;single&nbsp;uncompressed&nbsp;data&nbsp;block&nbsp;from&nbsp;input&nbsp;to&nbsp;output.</span><br>
<span class="lineno">560</span><span class="keyword" id="4306799">func</span>&nbsp;<span class="op" id="4306804">(</span><span class="ident" id="4306805">f</span>&nbsp;<span class="op" id="4306807">*</span><span class="ident" id="4306808">decompressor</span><span class="op" id="4306820">)</span>&nbsp;<span class="ident" id="4306822">dataBlock</span><span class="op" id="4306831">(</span><span class="op" id="4306832">)</span>&nbsp;<span class="op" id="4306834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4306837">//&nbsp;Uncompressed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4306855">//&nbsp;Discard&nbsp;current&nbsp;half-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306886">f</span><span class="op" id="4306887">.</span><span class="ident" id="4306888">nb</span>&nbsp;<span class="op" id="4306891">=</span>&nbsp;<span class="num" id="4306893">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306896">f</span><span class="op" id="4306897">.</span><span class="ident" id="4306898">b</span>&nbsp;<span class="op" id="4306900">=</span>&nbsp;<span class="num" id="4306902">0</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4306906">//&nbsp;Length&nbsp;then&nbsp;ones-complement&nbsp;of&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306949">nr</span><span class="op" id="4306951">,</span>&nbsp;<span class="ident" id="4306953">err</span>&nbsp;<span class="op" id="4306957">:=</span>&nbsp;<span class="ident" id="4306960">io</span><span class="op" id="4306962">.</span><span class="ident" id="4306963">ReadFull</span><span class="op" id="4306971">(</span><span class="ident" id="4306972">f</span><span class="op" id="4306973">.</span><span class="ident" id="4306974">r</span><span class="op" id="4306975">,</span>&nbsp;<span class="ident" id="4306977">f</span><span class="op" id="4306978">.</span><span class="ident" id="4306979">buf</span><span class="op" id="4306982">[</span><span class="num" id="4306983">0</span><span class="op" id="4306984">:</span><span class="num" id="4306985">4</span><span class="op" id="4306986">]</span><span class="op" id="4306987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4306990">f</span><span class="op" id="4306991">.</span><span class="ident" id="4306992">roffset</span>&nbsp;<span class="op" id="4307000">+=</span>&nbsp;<span class="ident" id="4307003">int64</span><span class="op" id="4307008">(</span><span class="ident" id="4307009">nr</span><span class="op" id="4307011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307014">if</span>&nbsp;<span class="ident" id="4307017">err</span>&nbsp;<span class="op" id="4307021">!=</span>&nbsp;<span class="ident" id="4307024">nil</span>&nbsp;<span class="op" id="4307028">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307032">f</span><span class="op" id="4307033">.</span><span class="ident" id="4307034">err</span>&nbsp;<span class="op" id="4307038">=</span>&nbsp;<span class="op" id="4307040">&amp;</span><span class="ident" id="4307041">ReadError</span><span class="op" id="4307050">{</span><span class="ident" id="4307051">f</span><span class="op" id="4307052">.</span><span class="ident" id="4307053">roffset</span><span class="op" id="4307060">,</span>&nbsp;<span class="ident" id="4307062">err</span><span class="op" id="4307065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307069">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4307077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307080">n</span>&nbsp;<span class="op" id="4307082">:=</span>&nbsp;<span class="builtintype" id="4307085">int</span><span class="op" id="4307088">(</span><span class="ident" id="4307089">f</span><span class="op" id="4307090">.</span><span class="ident" id="4307091">buf</span><span class="op" id="4307094">[</span><span class="num" id="4307095">0</span><span class="op" id="4307096">]</span><span class="op" id="4307097">)</span>&nbsp;<span class="op" id="4307099">|</span>&nbsp;<span class="builtintype" id="4307101">int</span><span class="op" id="4307104">(</span><span class="ident" id="4307105">f</span><span class="op" id="4307106">.</span><span class="ident" id="4307107">buf</span><span class="op" id="4307110">[</span><span class="num" id="4307111">1</span><span class="op" id="4307112">]</span><span class="op" id="4307113">)</span><span class="op" id="4307114">&lt;&lt;</span><span class="num" id="4307116">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307119">nn</span>&nbsp;<span class="op" id="4307122">:=</span>&nbsp;<span class="builtintype" id="4307125">int</span><span class="op" id="4307128">(</span><span class="ident" id="4307129">f</span><span class="op" id="4307130">.</span><span class="ident" id="4307131">buf</span><span class="op" id="4307134">[</span><span class="num" id="4307135">2</span><span class="op" id="4307136">]</span><span class="op" id="4307137">)</span>&nbsp;<span class="op" id="4307139">|</span>&nbsp;<span class="builtintype" id="4307141">int</span><span class="op" id="4307144">(</span><span class="ident" id="4307145">f</span><span class="op" id="4307146">.</span><span class="ident" id="4307147">buf</span><span class="op" id="4307150">[</span><span class="num" id="4307151">3</span><span class="op" id="4307152">]</span><span class="op" id="4307153">)</span><span class="op" id="4307154">&lt;&lt;</span><span class="num" id="4307156">8</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307159">if</span>&nbsp;<span class="builtintype" id="4307162">uint16</span><span class="op" id="4307168">(</span><span class="ident" id="4307169">nn</span><span class="op" id="4307171">)</span>&nbsp;<span class="op" id="4307173">!=</span>&nbsp;<span class="builtintype" id="4307176">uint16</span><span class="op" id="4307182">(</span><span class="op" id="4307183">^</span><span class="ident" id="4307184">n</span><span class="op" id="4307185">)</span>&nbsp;<span class="op" id="4307187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307191">f</span><span class="op" id="4307192">.</span><span class="ident" id="4307193">err</span>&nbsp;<span class="op" id="4307197">=</span>&nbsp;<span class="ident" id="4307199">CorruptInputError</span><span class="op" id="4307216">(</span><span class="ident" id="4307217">f</span><span class="op" id="4307218">.</span><span class="ident" id="4307219">roffset</span><span class="op" id="4307226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307230">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4307238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307242">if</span>&nbsp;<span class="ident" id="4307245">n</span>&nbsp;<span class="op" id="4307247">==</span>&nbsp;<span class="num" id="4307250">0</span>&nbsp;<span class="op" id="4307252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4307256">//&nbsp;0-length&nbsp;block&nbsp;means&nbsp;sync</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307287">f</span><span class="op" id="4307288">.</span><span class="ident" id="4307289">flush</span><span class="op" id="4307294">(</span><span class="op" id="4307295">(</span><span class="op" id="4307296">*</span><span class="ident" id="4307297">decompressor</span><span class="op" id="4307309">)</span><span class="op" id="4307310">.</span><span class="ident" id="4307311">nextBlock</span><span class="op" id="4307320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307324">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4307332">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307336">f</span><span class="op" id="4307337">.</span><span class="ident" id="4307338">copyLen</span>&nbsp;<span class="op" id="4307346">=</span>&nbsp;<span class="ident" id="4307348">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307351">f</span><span class="op" id="4307352">.</span><span class="ident" id="4307353">copyData</span><span class="op" id="4307361">(</span><span class="op" id="4307362">)</span><br>
<span class="lineno"></span><span class="op" id="4307364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="4307367">//&nbsp;copyData&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;into&nbsp;f.hist.</span><br>
<span class="lineno"></span><span class="comment" id="4307442">//&nbsp;It&nbsp;pauses&nbsp;for&nbsp;reads&nbsp;when&nbsp;f.hist&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4307486">func</span>&nbsp;<span class="op" id="4307491">(</span><span class="ident" id="4307492">f</span>&nbsp;<span class="op" id="4307494">*</span><span class="ident" id="4307495">decompressor</span><span class="op" id="4307507">)</span>&nbsp;<span class="ident" id="4307509">copyData</span><span class="op" id="4307517">(</span><span class="op" id="4307518">)</span>&nbsp;<span class="op" id="4307520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307523">n</span>&nbsp;<span class="op" id="4307525">:=</span>&nbsp;<span class="ident" id="4307528">f</span><span class="op" id="4307529">.</span><span class="ident" id="4307530">copyLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307539">for</span>&nbsp;<span class="ident" id="4307543">n</span>&nbsp;<span class="op" id="4307545">&gt;</span>&nbsp;<span class="num" id="4307547">0</span>&nbsp;<span class="op" id="4307549">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307553">m</span>&nbsp;<span class="op" id="4307555">:=</span>&nbsp;<span class="builtinfunc" id="4307558">len</span><span class="op" id="4307561">(</span><span class="ident" id="4307562">f</span><span class="op" id="4307563">.</span><span class="ident" id="4307564">hist</span><span class="op" id="4307568">)</span>&nbsp;<span class="op" id="4307570">-</span>&nbsp;<span class="ident" id="4307572">f</span><span class="op" id="4307573">.</span><span class="ident" id="4307574">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307579">if</span>&nbsp;<span class="ident" id="4307582">m</span>&nbsp;<span class="op" id="4307584">&gt;</span>&nbsp;<span class="ident" id="4307586">n</span>&nbsp;<span class="op" id="4307588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307593">m</span>&nbsp;<span class="op" id="4307595">=</span>&nbsp;<span class="ident" id="4307597">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4307601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307605">m</span><span class="op" id="4307606">,</span>&nbsp;<span class="ident" id="4307608">err</span>&nbsp;<span class="op" id="4307612">:=</span>&nbsp;<span class="ident" id="4307615">io</span><span class="op" id="4307617">.</span><span class="ident" id="4307618">ReadFull</span><span class="op" id="4307626">(</span><span class="ident" id="4307627">f</span><span class="op" id="4307628">.</span><span class="ident" id="4307629">r</span><span class="op" id="4307630">,</span>&nbsp;<span class="ident" id="4307632">f</span><span class="op" id="4307633">.</span><span class="ident" id="4307634">hist</span><span class="op" id="4307638">[</span><span class="ident" id="4307639">f</span><span class="op" id="4307640">.</span><span class="ident" id="4307641">hp</span><span class="op" id="4307643">:</span><span class="ident" id="4307644">f</span><span class="op" id="4307645">.</span><span class="ident" id="4307646">hp</span><span class="op" id="4307648">+</span><span class="ident" id="4307649">m</span><span class="op" id="4307650">]</span><span class="op" id="4307651">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307655">f</span><span class="op" id="4307656">.</span><span class="ident" id="4307657">roffset</span>&nbsp;<span class="op" id="4307665">+=</span>&nbsp;<span class="ident" id="4307668">int64</span><span class="op" id="4307673">(</span><span class="ident" id="4307674">m</span><span class="op" id="4307675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307679">if</span>&nbsp;<span class="ident" id="4307682">err</span>&nbsp;<span class="op" id="4307686">!=</span>&nbsp;<span class="ident" id="4307689">nil</span>&nbsp;<span class="op" id="4307693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307698">f</span><span class="op" id="4307699">.</span><span class="ident" id="4307700">err</span>&nbsp;<span class="op" id="4307704">=</span>&nbsp;<span class="op" id="4307706">&amp;</span><span class="ident" id="4307707">ReadError</span><span class="op" id="4307716">{</span><span class="ident" id="4307717">f</span><span class="op" id="4307718">.</span><span class="ident" id="4307719">roffset</span><span class="op" id="4307726">,</span>&nbsp;<span class="ident" id="4307728">err</span><span class="op" id="4307731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307736">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4307745">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307749">n</span>&nbsp;<span class="op" id="4307751">-=</span>&nbsp;<span class="ident" id="4307754">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307758">f</span><span class="op" id="4307759">.</span><span class="ident" id="4307760">hp</span>&nbsp;<span class="op" id="4307763">+=</span>&nbsp;<span class="ident" id="4307766">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307770">if</span>&nbsp;<span class="ident" id="4307773">f</span><span class="op" id="4307774">.</span><span class="ident" id="4307775">hp</span>&nbsp;<span class="op" id="4307778">==</span>&nbsp;<span class="builtinfunc" id="4307781">len</span><span class="op" id="4307784">(</span><span class="ident" id="4307785">f</span><span class="op" id="4307786">.</span><span class="ident" id="4307787">hist</span><span class="op" id="4307791">)</span>&nbsp;<span class="op" id="4307793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307798">f</span><span class="op" id="4307799">.</span><span class="ident" id="4307800">copyLen</span>&nbsp;<span class="op" id="4307808">=</span>&nbsp;<span class="ident" id="4307810">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307815">f</span><span class="op" id="4307816">.</span><span class="ident" id="4307817">flush</span><span class="op" id="4307822">(</span><span class="op" id="4307823">(</span><span class="op" id="4307824">*</span><span class="ident" id="4307825">decompressor</span><span class="op" id="4307837">)</span><span class="op" id="4307838">.</span><span class="ident" id="4307839">copyData</span><span class="op" id="4307847">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307852">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4307861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4307864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4307867">f</span><span class="op" id="4307868">.</span><span class="ident" id="4307869">step</span>&nbsp;<span class="op" id="4307874">=</span>&nbsp;<span class="op" id="4307876">(</span><span class="op" id="4307877">*</span><span class="ident" id="4307878">decompressor</span><span class="op" id="4307890">)</span><span class="op" id="4307891">.</span><span class="ident" id="4307892">nextBlock</span><br>
<span class="lineno"></span><span class="op" id="4307902">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="4307905">func</span>&nbsp;<span class="op" id="4307910">(</span><span class="ident" id="4307911">f</span>&nbsp;<span class="op" id="4307913">*</span><span class="ident" id="4307914">decompressor</span><span class="op" id="4307926">)</span>&nbsp;<span class="ident" id="4307928">setDict</span><span class="op" id="4307935">(</span><span class="ident" id="4307936">dict</span>&nbsp;<span class="op" id="4307941">[</span><span class="op" id="4307942">]</span><span class="builtintype" id="4307943">byte</span><span class="op" id="4307947">)</span>&nbsp;<span class="op" id="4307949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4307952">if</span>&nbsp;<span class="builtinfunc" id="4307955">len</span><span class="op" id="4307958">(</span><span class="ident" id="4307959">dict</span><span class="op" id="4307963">)</span>&nbsp;<span class="op" id="4307965">&gt;</span>&nbsp;<span class="builtinfunc" id="4307967">len</span><span class="op" id="4307970">(</span><span class="ident" id="4307971">f</span><span class="op" id="4307972">.</span><span class="ident" id="4307973">hist</span><span class="op" id="4307977">)</span>&nbsp;<span class="op" id="4307979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4307983">//&nbsp;Will&nbsp;only&nbsp;remember&nbsp;the&nbsp;tail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308017">dict</span>&nbsp;<span class="op" id="4308022">=</span>&nbsp;<span class="ident" id="4308024">dict</span><span class="op" id="4308028">[</span><span class="builtinfunc" id="4308029">len</span><span class="op" id="4308032">(</span><span class="ident" id="4308033">dict</span><span class="op" id="4308037">)</span><span class="op" id="4308038">-</span><span class="builtinfunc" id="4308039">len</span><span class="op" id="4308042">(</span><span class="ident" id="4308043">f</span><span class="op" id="4308044">.</span><span class="ident" id="4308045">hist</span><span class="op" id="4308049">)</span><span class="op" id="4308050">:</span><span class="op" id="4308051">]</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4308054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308058">f</span><span class="op" id="4308059">.</span><span class="ident" id="4308060">hp</span>&nbsp;<span class="op" id="4308063">=</span>&nbsp;<span class="builtinfunc" id="4308065">copy</span><span class="op" id="4308069">(</span><span class="ident" id="4308070">f</span><span class="op" id="4308071">.</span><span class="ident" id="4308072">hist</span><span class="op" id="4308076">[</span><span class="op" id="4308077">:</span><span class="op" id="4308078">]</span><span class="op" id="4308079">,</span>&nbsp;<span class="ident" id="4308081">dict</span><span class="op" id="4308085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308088">if</span>&nbsp;<span class="ident" id="4308091">f</span><span class="op" id="4308092">.</span><span class="ident" id="4308093">hp</span>&nbsp;<span class="op" id="4308096">==</span>&nbsp;<span class="builtinfunc" id="4308099">len</span><span class="op" id="4308102">(</span><span class="ident" id="4308103">f</span><span class="op" id="4308104">.</span><span class="ident" id="4308105">hist</span><span class="op" id="4308109">)</span>&nbsp;<span class="op" id="4308111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308115">f</span><span class="op" id="4308116">.</span><span class="ident" id="4308117">hp</span>&nbsp;<span class="op" id="4308120">=</span>&nbsp;<span class="num" id="4308122">0</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308126">f</span><span class="op" id="4308127">.</span><span class="ident" id="4308128">hfull</span>&nbsp;<span class="op" id="4308134">=</span>&nbsp;<span class="builtintype" id="4308136">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4308142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308145">f</span><span class="op" id="4308146">.</span><span class="ident" id="4308147">hw</span>&nbsp;<span class="op" id="4308150">=</span>&nbsp;<span class="ident" id="4308152">f</span><span class="op" id="4308153">.</span><span class="ident" id="4308154">hp</span><br>
<span class="lineno"></span><span class="op" id="4308157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="keyword" id="4308160">func</span>&nbsp;<span class="op" id="4308165">(</span><span class="ident" id="4308166">f</span>&nbsp;<span class="op" id="4308168">*</span><span class="ident" id="4308169">decompressor</span><span class="op" id="4308181">)</span>&nbsp;<span class="ident" id="4308183">moreBits</span><span class="op" id="4308191">(</span><span class="op" id="4308192">)</span>&nbsp;<span class="builtintype" id="4308194">error</span>&nbsp;<span class="op" id="4308200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308203">c</span><span class="op" id="4308204">,</span>&nbsp;<span class="ident" id="4308206">err</span>&nbsp;<span class="op" id="4308210">:=</span>&nbsp;<span class="ident" id="4308213">f</span><span class="op" id="4308214">.</span><span class="ident" id="4308215">r</span><span class="op" id="4308216">.</span><span class="ident" id="4308217">ReadByte</span><span class="op" id="4308225">(</span><span class="op" id="4308226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308229">if</span>&nbsp;<span class="ident" id="4308232">err</span>&nbsp;<span class="op" id="4308236">!=</span>&nbsp;<span class="ident" id="4308239">nil</span>&nbsp;<span class="op" id="4308243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308247">if</span>&nbsp;<span class="ident" id="4308250">err</span>&nbsp;<span class="op" id="4308254">==</span>&nbsp;<span class="ident" id="4308257">io</span><span class="op" id="4308259">.</span><span class="ident" id="4308260">EOF</span>&nbsp;<span class="op" id="4308264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308269">err</span>&nbsp;<span class="op" id="4308273">=</span>&nbsp;<span class="ident" id="4308275">io</span><span class="op" id="4308277">.</span><span class="ident" id="4308278">ErrUnexpectedEOF</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4308297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308301">return</span>&nbsp;<span class="ident" id="4308308">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4308313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308316">f</span><span class="op" id="4308317">.</span><span class="ident" id="4308318">roffset</span><span class="op" id="4308325">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308329">f</span><span class="op" id="4308330">.</span><span class="ident" id="4308331">b</span>&nbsp;<span class="op" id="4308333">|=</span>&nbsp;<span class="builtintype" id="4308336">uint32</span><span class="op" id="4308342">(</span><span class="ident" id="4308343">c</span><span class="op" id="4308344">)</span>&nbsp;<span class="op" id="4308346">&lt;&lt;</span>&nbsp;<span class="ident" id="4308349">f</span><span class="op" id="4308350">.</span><span class="ident" id="4308351">nb</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308355">f</span><span class="op" id="4308356">.</span><span class="ident" id="4308357">nb</span>&nbsp;<span class="op" id="4308360">+=</span>&nbsp;<span class="num" id="4308363">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308366">return</span>&nbsp;<span class="ident" id="4308373">nil</span><br>
<span class="lineno"></span><span class="op" id="4308377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4308380">//&nbsp;Read&nbsp;the&nbsp;next&nbsp;Huffman-encoded&nbsp;symbol&nbsp;from&nbsp;f&nbsp;according&nbsp;to&nbsp;h.</span><br>
<span class="lineno">645</span><span class="keyword" id="4308443">func</span>&nbsp;<span class="op" id="4308448">(</span><span class="ident" id="4308449">f</span>&nbsp;<span class="op" id="4308451">*</span><span class="ident" id="4308452">decompressor</span><span class="op" id="4308464">)</span>&nbsp;<span class="ident" id="4308466">huffSym</span><span class="op" id="4308473">(</span><span class="ident" id="4308474">h</span>&nbsp;<span class="op" id="4308476">*</span><span class="ident" id="4308477">huffmanDecoder</span><span class="op" id="4308491">)</span>&nbsp;<span class="op" id="4308493">(</span><span class="builtintype" id="4308494">int</span><span class="op" id="4308497">,</span>&nbsp;<span class="builtintype" id="4308499">error</span><span class="op" id="4308504">)</span>&nbsp;<span class="op" id="4308506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308509">n</span>&nbsp;<span class="op" id="4308511">:=</span>&nbsp;<span class="builtintype" id="4308514">uint</span><span class="op" id="4308518">(</span><span class="ident" id="4308519">h</span><span class="op" id="4308520">.</span><span class="ident" id="4308521">min</span><span class="op" id="4308524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308527">for</span>&nbsp;<span class="op" id="4308531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308535">for</span>&nbsp;<span class="ident" id="4308539">f</span><span class="op" id="4308540">.</span><span class="ident" id="4308541">nb</span>&nbsp;<span class="op" id="4308544">&lt;</span>&nbsp;<span class="ident" id="4308546">n</span>&nbsp;<span class="op" id="4308548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308553">if</span>&nbsp;<span class="ident" id="4308556">err</span>&nbsp;<span class="op" id="4308560">:=</span>&nbsp;<span class="ident" id="4308563">f</span><span class="op" id="4308564">.</span><span class="ident" id="4308565">moreBits</span><span class="op" id="4308573">(</span><span class="op" id="4308574">)</span><span class="op" id="4308575">;</span>&nbsp;<span class="ident" id="4308577">err</span>&nbsp;<span class="op" id="4308581">!=</span>&nbsp;<span class="ident" id="4308584">nil</span>&nbsp;<span class="op" id="4308588">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308594">return</span>&nbsp;<span class="num" id="4308601">0</span><span class="op" id="4308602">,</span>&nbsp;<span class="ident" id="4308604">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4308611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4308615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308619">chunk</span>&nbsp;<span class="op" id="4308625">:=</span>&nbsp;<span class="ident" id="4308628">h</span><span class="op" id="4308629">.</span><span class="ident" id="4308630">chunks</span><span class="op" id="4308636">[</span><span class="ident" id="4308637">f</span><span class="op" id="4308638">.</span><span class="ident" id="4308639">b</span><span class="op" id="4308640">&amp;</span><span class="op" id="4308641">(</span><span class="ident" id="4308642">huffmanNumChunks</span><span class="op" id="4308658">-</span><span class="num" id="4308659">1</span><span class="op" id="4308660">)</span><span class="op" id="4308661">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308665">n</span>&nbsp;<span class="op" id="4308667">=</span>&nbsp;<span class="builtintype" id="4308669">uint</span><span class="op" id="4308673">(</span><span class="ident" id="4308674">chunk</span>&nbsp;<span class="op" id="4308680">&amp;</span>&nbsp;<span class="ident" id="4308682">huffmanCountMask</span><span class="op" id="4308698">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308702">if</span>&nbsp;<span class="ident" id="4308705">n</span>&nbsp;<span class="op" id="4308707">&gt;</span>&nbsp;<span class="ident" id="4308709">huffmanChunkBits</span>&nbsp;<span class="op" id="4308726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308731">chunk</span>&nbsp;<span class="op" id="4308737">=</span>&nbsp;<span class="ident" id="4308739">h</span><span class="op" id="4308740">.</span><span class="ident" id="4308741">links</span><span class="op" id="4308746">[</span><span class="ident" id="4308747">chunk</span><span class="op" id="4308752">&gt;&gt;</span><span class="ident" id="4308754">huffmanValueShift</span><span class="op" id="4308771">]</span><span class="op" id="4308772">[</span><span class="op" id="4308773">(</span><span class="ident" id="4308774">f</span><span class="op" id="4308775">.</span><span class="ident" id="4308776">b</span><span class="op" id="4308777">&gt;&gt;</span><span class="ident" id="4308779">huffmanChunkBits</span><span class="op" id="4308795">)</span><span class="op" id="4308796">&amp;</span><span class="ident" id="4308797">h</span><span class="op" id="4308798">.</span><span class="ident" id="4308799">linkMask</span><span class="op" id="4308807">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308812">n</span>&nbsp;<span class="op" id="4308814">=</span>&nbsp;<span class="builtintype" id="4308816">uint</span><span class="op" id="4308820">(</span><span class="ident" id="4308821">chunk</span>&nbsp;<span class="op" id="4308827">&amp;</span>&nbsp;<span class="ident" id="4308829">huffmanCountMask</span><span class="op" id="4308845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308850">if</span>&nbsp;<span class="ident" id="4308853">n</span>&nbsp;<span class="op" id="4308855">==</span>&nbsp;<span class="num" id="4308858">0</span>&nbsp;<span class="op" id="4308860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308866">f</span><span class="op" id="4308867">.</span><span class="ident" id="4308868">err</span>&nbsp;<span class="op" id="4308872">=</span>&nbsp;<span class="ident" id="4308874">CorruptInputError</span><span class="op" id="4308891">(</span><span class="ident" id="4308892">f</span><span class="op" id="4308893">.</span><span class="ident" id="4308894">roffset</span><span class="op" id="4308901">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308907">return</span>&nbsp;<span class="num" id="4308914">0</span><span class="op" id="4308915">,</span>&nbsp;<span class="ident" id="4308917">f</span><span class="op" id="4308918">.</span><span class="ident" id="4308919">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4308926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4308930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308934">if</span>&nbsp;<span class="ident" id="4308937">n</span>&nbsp;<span class="op" id="4308939">&lt;=</span>&nbsp;<span class="ident" id="4308942">f</span><span class="op" id="4308943">.</span><span class="ident" id="4308944">nb</span>&nbsp;<span class="op" id="4308947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308952">f</span><span class="op" id="4308953">.</span><span class="ident" id="4308954">b</span>&nbsp;<span class="op" id="4308956">&gt;&gt;=</span>&nbsp;<span class="ident" id="4308960">n</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4308965">f</span><span class="op" id="4308966">.</span><span class="ident" id="4308967">nb</span>&nbsp;<span class="op" id="4308970">-=</span>&nbsp;<span class="ident" id="4308973">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4308978">return</span>&nbsp;<span class="builtintype" id="4308985">int</span><span class="op" id="4308988">(</span><span class="ident" id="4308989">chunk</span>&nbsp;<span class="op" id="4308995">&gt;&gt;</span>&nbsp;<span class="ident" id="4308998">huffmanValueShift</span><span class="op" id="4309015">)</span><span class="op" id="4309016">,</span>&nbsp;<span class="ident" id="4309018">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4309024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4309027">}</span><br>
<span class="lineno"></span><span class="op" id="4309029">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="4309032">//&nbsp;Flush&nbsp;any&nbsp;buffered&nbsp;output&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4309087">func</span>&nbsp;<span class="op" id="4309092">(</span><span class="ident" id="4309093">f</span>&nbsp;<span class="op" id="4309095">*</span><span class="ident" id="4309096">decompressor</span><span class="op" id="4309108">)</span>&nbsp;<span class="ident" id="4309110">flush</span><span class="op" id="4309115">(</span><span class="ident" id="4309116">step</span>&nbsp;<span class="keyword" id="4309121">func</span><span class="op" id="4309125">(</span><span class="op" id="4309126">*</span><span class="ident" id="4309127">decompressor</span><span class="op" id="4309139">)</span><span class="op" id="4309140">)</span>&nbsp;<span class="op" id="4309142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309145">f</span><span class="op" id="4309146">.</span><span class="ident" id="4309147">toRead</span>&nbsp;<span class="op" id="4309154">=</span>&nbsp;<span class="ident" id="4309156">f</span><span class="op" id="4309157">.</span><span class="ident" id="4309158">hist</span><span class="op" id="4309162">[</span><span class="ident" id="4309163">f</span><span class="op" id="4309164">.</span><span class="ident" id="4309165">hw</span><span class="op" id="4309167">:</span><span class="ident" id="4309168">f</span><span class="op" id="4309169">.</span><span class="ident" id="4309170">hp</span><span class="op" id="4309172">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309175">f</span><span class="op" id="4309176">.</span><span class="ident" id="4309177">woffset</span>&nbsp;<span class="op" id="4309185">+=</span>&nbsp;<span class="ident" id="4309188">int64</span><span class="op" id="4309193">(</span><span class="ident" id="4309194">f</span><span class="op" id="4309195">.</span><span class="ident" id="4309196">hp</span>&nbsp;<span class="op" id="4309199">-</span>&nbsp;<span class="ident" id="4309201">f</span><span class="op" id="4309202">.</span><span class="ident" id="4309203">hw</span><span class="op" id="4309205">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309208">f</span><span class="op" id="4309209">.</span><span class="ident" id="4309210">hw</span>&nbsp;<span class="op" id="4309213">=</span>&nbsp;<span class="ident" id="4309215">f</span><span class="op" id="4309216">.</span><span class="ident" id="4309217">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309221">if</span>&nbsp;<span class="ident" id="4309224">f</span><span class="op" id="4309225">.</span><span class="ident" id="4309226">hp</span>&nbsp;<span class="op" id="4309229">==</span>&nbsp;<span class="builtinfunc" id="4309232">len</span><span class="op" id="4309235">(</span><span class="ident" id="4309236">f</span><span class="op" id="4309237">.</span><span class="ident" id="4309238">hist</span><span class="op" id="4309242">)</span>&nbsp;<span class="op" id="4309244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309248">f</span><span class="op" id="4309249">.</span><span class="ident" id="4309250">hp</span>&nbsp;<span class="op" id="4309253">=</span>&nbsp;<span class="num" id="4309255">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309259">f</span><span class="op" id="4309260">.</span><span class="ident" id="4309261">hw</span>&nbsp;<span class="op" id="4309264">=</span>&nbsp;<span class="num" id="4309266">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309270">f</span><span class="op" id="4309271">.</span><span class="ident" id="4309272">hfull</span>&nbsp;<span class="op" id="4309278">=</span>&nbsp;<span class="builtintype" id="4309280">true</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4309286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309289">f</span><span class="op" id="4309290">.</span><span class="ident" id="4309291">step</span>&nbsp;<span class="op" id="4309296">=</span>&nbsp;<span class="ident" id="4309298">step</span><br>
<span class="lineno"></span><span class="op" id="4309303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4309306">func</span>&nbsp;<span class="ident" id="4309311">makeReader</span><span class="op" id="4309321">(</span><span class="ident" id="4309322">r</span>&nbsp;<span class="ident" id="4309324">io</span><span class="op" id="4309326">.</span><span class="ident" id="4309327">Reader</span><span class="op" id="4309333">)</span>&nbsp;<span class="ident" id="4309335">Reader</span>&nbsp;<span class="op" id="4309342">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309345">if</span>&nbsp;<span class="ident" id="4309348">rr</span><span class="op" id="4309350">,</span>&nbsp;<span class="ident" id="4309352">ok</span>&nbsp;<span class="op" id="4309355">:=</span>&nbsp;<span class="ident" id="4309358">r</span><span class="op" id="4309359">.</span><span class="op" id="4309360">(</span><span class="ident" id="4309361">Reader</span><span class="op" id="4309367">)</span><span class="op" id="4309368">;</span>&nbsp;<span class="ident" id="4309370">ok</span>&nbsp;<span class="op" id="4309373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309377">return</span>&nbsp;<span class="ident" id="4309384">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4309388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309391">return</span>&nbsp;<span class="ident" id="4309398">bufio</span><span class="op" id="4309403">.</span><span class="ident" id="4309404">NewReader</span><span class="op" id="4309413">(</span><span class="ident" id="4309414">r</span><span class="op" id="4309415">)</span><br>
<span class="lineno"></span><span class="op" id="4309417">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="4309420">func</span>&nbsp;<span class="op" id="4309425">(</span><span class="ident" id="4309426">f</span>&nbsp;<span class="op" id="4309428">*</span><span class="ident" id="4309429">decompressor</span><span class="op" id="4309441">)</span>&nbsp;<span class="ident" id="4309443">Reset</span><span class="op" id="4309448">(</span><span class="ident" id="4309449">r</span>&nbsp;<span class="ident" id="4309451">io</span><span class="op" id="4309453">.</span><span class="ident" id="4309454">Reader</span><span class="op" id="4309460">,</span>&nbsp;<span class="ident" id="4309462">dict</span>&nbsp;<span class="op" id="4309467">[</span><span class="op" id="4309468">]</span><span class="builtintype" id="4309469">byte</span><span class="op" id="4309473">)</span>&nbsp;<span class="builtintype" id="4309475">error</span>&nbsp;<span class="op" id="4309481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4309484">*</span><span class="ident" id="4309485">f</span>&nbsp;<span class="op" id="4309487">=</span>&nbsp;<span class="ident" id="4309489">decompressor</span><span class="op" id="4309501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309505">r</span><span class="op" id="4309506">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4309515">makeReader</span><span class="op" id="4309525">(</span><span class="ident" id="4309526">r</span><span class="op" id="4309527">)</span><span class="op" id="4309528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309532">bits</span><span class="op" id="4309536">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4309542">f</span><span class="op" id="4309543">.</span><span class="ident" id="4309544">bits</span><span class="op" id="4309548">,</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309552">codebits</span><span class="op" id="4309560">:</span>&nbsp;<span class="ident" id="4309562">f</span><span class="op" id="4309563">.</span><span class="ident" id="4309564">codebits</span><span class="op" id="4309572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309576">hist</span><span class="op" id="4309580">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4309586">f</span><span class="op" id="4309587">.</span><span class="ident" id="4309588">hist</span><span class="op" id="4309592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309596">step</span><span class="op" id="4309600">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4309606">(</span><span class="op" id="4309607">*</span><span class="ident" id="4309608">decompressor</span><span class="op" id="4309620">)</span><span class="op" id="4309621">.</span><span class="ident" id="4309622">nextBlock</span><span class="op" id="4309631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4309634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309637">if</span>&nbsp;<span class="ident" id="4309640">dict</span>&nbsp;<span class="op" id="4309645">!=</span>&nbsp;<span class="ident" id="4309648">nil</span>&nbsp;<span class="op" id="4309652">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4309656">f</span><span class="op" id="4309657">.</span><span class="ident" id="4309658">setDict</span><span class="op" id="4309665">(</span><span class="ident" id="4309666">dict</span><span class="op" id="4309670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4309673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4309676">return</span>&nbsp;<span class="ident" id="4309683">nil</span><br>
<span class="lineno"></span><span class="op" id="4309687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="4309690">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;ReadCloser&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4309745">//&nbsp;to&nbsp;read&nbsp;the&nbsp;uncompressed&nbsp;version&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4309787">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4309834">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4309896">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser</span><br>
<span class="lineno">710</span><span class="comment" id="4309965">//&nbsp;when&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="4309991">//</span><br>
<span class="lineno"></span><span class="comment" id="4309994">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno"></span><span class="keyword" id="4310060">func</span>&nbsp;<span class="ident" id="4310065">NewReader</span><span class="op" id="4310074">(</span><span class="ident" id="4310075">r</span>&nbsp;<span class="ident" id="4310077">io</span><span class="op" id="4310079">.</span><span class="ident" id="4310080">Reader</span><span class="op" id="4310086">)</span>&nbsp;<span class="ident" id="4310088">io</span><span class="op" id="4310090">.</span><span class="ident" id="4310091">ReadCloser</span>&nbsp;<span class="op" id="4310102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310105">var</span>&nbsp;<span class="ident" id="4310109">f</span>&nbsp;<span class="ident" id="4310111">decompressor</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310125">f</span><span class="op" id="4310126">.</span><span class="ident" id="4310127">bits</span>&nbsp;<span class="op" id="4310132">=</span>&nbsp;<span class="builtinfunc" id="4310134">new</span><span class="op" id="4310137">(</span><span class="op" id="4310138">[</span><span class="ident" id="4310139">maxLit</span>&nbsp;<span class="op" id="4310146">+</span>&nbsp;<span class="ident" id="4310148">maxDist</span><span class="op" id="4310155">]</span><span class="builtintype" id="4310156">int</span><span class="op" id="4310159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310162">f</span><span class="op" id="4310163">.</span><span class="ident" id="4310164">codebits</span>&nbsp;<span class="op" id="4310173">=</span>&nbsp;<span class="builtinfunc" id="4310175">new</span><span class="op" id="4310178">(</span><span class="op" id="4310179">[</span><span class="ident" id="4310180">numCodes</span><span class="op" id="4310188">]</span><span class="builtintype" id="4310189">int</span><span class="op" id="4310192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310195">f</span><span class="op" id="4310196">.</span><span class="ident" id="4310197">r</span>&nbsp;<span class="op" id="4310199">=</span>&nbsp;<span class="ident" id="4310201">makeReader</span><span class="op" id="4310211">(</span><span class="ident" id="4310212">r</span><span class="op" id="4310213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310216">f</span><span class="op" id="4310217">.</span><span class="ident" id="4310218">hist</span>&nbsp;<span class="op" id="4310223">=</span>&nbsp;<span class="builtinfunc" id="4310225">new</span><span class="op" id="4310228">(</span><span class="op" id="4310229">[</span><span class="ident" id="4310230">maxHist</span><span class="op" id="4310237">]</span><span class="builtintype" id="4310238">byte</span><span class="op" id="4310242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310245">f</span><span class="op" id="4310246">.</span><span class="ident" id="4310247">step</span>&nbsp;<span class="op" id="4310252">=</span>&nbsp;<span class="op" id="4310254">(</span><span class="op" id="4310255">*</span><span class="ident" id="4310256">decompressor</span><span class="op" id="4310268">)</span><span class="op" id="4310269">.</span><span class="ident" id="4310270">nextBlock</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310281">return</span>&nbsp;<span class="op" id="4310288">&amp;</span><span class="ident" id="4310289">f</span><br>
<span class="lineno"></span><span class="op" id="4310291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4310294">//&nbsp;NewReaderDict&nbsp;is&nbsp;like&nbsp;NewReader&nbsp;but&nbsp;initializes&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="4310356">//&nbsp;with&nbsp;a&nbsp;preset&nbsp;dictionary.&nbsp;&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;behaves&nbsp;as&nbsp;if</span><br>
<span class="lineno">725</span><span class="comment" id="4310420">//&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;stream&nbsp;started&nbsp;with&nbsp;the&nbsp;given&nbsp;dictionary,</span><br>
<span class="lineno"></span><span class="comment" id="4310487">//&nbsp;which&nbsp;has&nbsp;already&nbsp;been&nbsp;read.&nbsp;&nbsp;NewReaderDict&nbsp;is&nbsp;typically&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4310552">//&nbsp;to&nbsp;read&nbsp;data&nbsp;compressed&nbsp;by&nbsp;NewWriterDict.</span><br>
<span class="lineno"></span><span class="comment" id="4310597">//</span><br>
<span class="lineno"></span><span class="comment" id="4310600">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno">730</span><span class="keyword" id="4310666">func</span>&nbsp;<span class="ident" id="4310671">NewReaderDict</span><span class="op" id="4310684">(</span><span class="ident" id="4310685">r</span>&nbsp;<span class="ident" id="4310687">io</span><span class="op" id="4310689">.</span><span class="ident" id="4310690">Reader</span><span class="op" id="4310696">,</span>&nbsp;<span class="ident" id="4310698">dict</span>&nbsp;<span class="op" id="4310703">[</span><span class="op" id="4310704">]</span><span class="builtintype" id="4310705">byte</span><span class="op" id="4310709">)</span>&nbsp;<span class="ident" id="4310711">io</span><span class="op" id="4310713">.</span><span class="ident" id="4310714">ReadCloser</span>&nbsp;<span class="op" id="4310725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310728">var</span>&nbsp;<span class="ident" id="4310732">f</span>&nbsp;<span class="ident" id="4310734">decompressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310748">f</span><span class="op" id="4310749">.</span><span class="ident" id="4310750">r</span>&nbsp;<span class="op" id="4310752">=</span>&nbsp;<span class="ident" id="4310754">makeReader</span><span class="op" id="4310764">(</span><span class="ident" id="4310765">r</span><span class="op" id="4310766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310769">f</span><span class="op" id="4310770">.</span><span class="ident" id="4310771">hist</span>&nbsp;<span class="op" id="4310776">=</span>&nbsp;<span class="builtinfunc" id="4310778">new</span><span class="op" id="4310781">(</span><span class="op" id="4310782">[</span><span class="ident" id="4310783">maxHist</span><span class="op" id="4310790">]</span><span class="builtintype" id="4310791">byte</span><span class="op" id="4310795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310798">f</span><span class="op" id="4310799">.</span><span class="ident" id="4310800">bits</span>&nbsp;<span class="op" id="4310805">=</span>&nbsp;<span class="builtinfunc" id="4310807">new</span><span class="op" id="4310810">(</span><span class="op" id="4310811">[</span><span class="ident" id="4310812">maxLit</span>&nbsp;<span class="op" id="4310819">+</span>&nbsp;<span class="ident" id="4310821">maxDist</span><span class="op" id="4310828">]</span><span class="builtintype" id="4310829">int</span><span class="op" id="4310832">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310835">f</span><span class="op" id="4310836">.</span><span class="ident" id="4310837">codebits</span>&nbsp;<span class="op" id="4310846">=</span>&nbsp;<span class="builtinfunc" id="4310848">new</span><span class="op" id="4310851">(</span><span class="op" id="4310852">[</span><span class="ident" id="4310853">numCodes</span><span class="op" id="4310861">]</span><span class="builtintype" id="4310862">int</span><span class="op" id="4310865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310868">f</span><span class="op" id="4310869">.</span><span class="ident" id="4310870">step</span>&nbsp;<span class="op" id="4310875">=</span>&nbsp;<span class="op" id="4310877">(</span><span class="op" id="4310878">*</span><span class="ident" id="4310879">decompressor</span><span class="op" id="4310891">)</span><span class="op" id="4310892">.</span><span class="ident" id="4310893">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310904">f</span><span class="op" id="4310905">.</span><span class="ident" id="4310906">setDict</span><span class="op" id="4310913">(</span><span class="ident" id="4310914">dict</span><span class="op" id="4310918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4310921">return</span>&nbsp;<span class="op" id="4310928">&amp;</span><span class="ident" id="4310929">f</span><br>
<span class="lineno"></span><span class="op" id="4310931">}</span>
</div>
</body>
</html>
