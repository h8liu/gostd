<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3189362">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3189417">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3189471">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3189522">//&nbsp;Read&nbsp;static&nbsp;host/IP&nbsp;entries&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3189571">package</span>&nbsp;<span class="ident" id="3189579">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3189584">import</span>&nbsp;<span class="op" id="3189591">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3189594">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3189602">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3189609">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3189612">const</span>&nbsp;<span class="ident" id="3189618">cacheMaxAge</span>&nbsp;<span class="op" id="3189630">=</span>&nbsp;<span class="num" id="3189632">5</span>&nbsp;<span class="op" id="3189634">*</span>&nbsp;<span class="ident" id="3189636">time</span><span class="op" id="3189640">.</span><span class="ident" id="3189641">Minute</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3189649">//&nbsp;hostsPath&nbsp;points&nbsp;to&nbsp;the&nbsp;file&nbsp;with&nbsp;static&nbsp;IP/address&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="3189713">var</span>&nbsp;<span class="ident" id="3189717">hostsPath</span>&nbsp;<span class="op" id="3189727">=</span>&nbsp;<span class="string" id="3189729">&#34;/etc/hosts&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3189743">//&nbsp;Simple&nbsp;cache.</span><br>
<span class="lineno">20</span><span class="keyword" id="3189760">var</span>&nbsp;<span class="ident" id="3189764">hosts</span>&nbsp;<span class="keyword" id="3189770">struct</span>&nbsp;<span class="op" id="3189777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3189780">sync</span><span class="op" id="3189784">.</span><span class="ident" id="3189785">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3189792">byName</span>&nbsp;<span class="keyword" id="3189799">map</span><span class="op" id="3189802">[</span><span class="builtintype" id="3189803">string</span><span class="op" id="3189809">]</span><span class="op" id="3189810">[</span><span class="op" id="3189811">]</span><span class="builtintype" id="3189812">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3189820">byAddr</span>&nbsp;<span class="keyword" id="3189827">map</span><span class="op" id="3189830">[</span><span class="builtintype" id="3189831">string</span><span class="op" id="3189837">]</span><span class="op" id="3189838">[</span><span class="op" id="3189839">]</span><span class="builtintype" id="3189840">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3189848">expire</span>&nbsp;<span class="ident" id="3189855">time</span><span class="op" id="3189859">.</span><span class="ident" id="3189860">Time</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3189866">path</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3189873">string</span><br>
<span class="lineno"></span><span class="op" id="3189880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3189883">func</span>&nbsp;<span class="ident" id="3189888">readHosts</span><span class="op" id="3189897">(</span><span class="op" id="3189898">)</span>&nbsp;<span class="op" id="3189900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3189903">now</span>&nbsp;<span class="op" id="3189907">:=</span>&nbsp;<span class="ident" id="3189910">time</span><span class="op" id="3189914">.</span><span class="ident" id="3189915">Now</span><span class="op" id="3189918">(</span><span class="op" id="3189919">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3189922">hp</span>&nbsp;<span class="op" id="3189925">:=</span>&nbsp;<span class="ident" id="3189928">hostsPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3189939">if</span>&nbsp;<span class="builtinfunc" id="3189942">len</span><span class="op" id="3189945">(</span><span class="ident" id="3189946">hosts</span><span class="op" id="3189951">.</span><span class="ident" id="3189952">byName</span><span class="op" id="3189958">)</span>&nbsp;<span class="op" id="3189960">==</span>&nbsp;<span class="num" id="3189963">0</span>&nbsp;<span class="op" id="3189965">||</span>&nbsp;<span class="ident" id="3189968">now</span><span class="op" id="3189971">.</span><span class="ident" id="3189972">After</span><span class="op" id="3189977">(</span><span class="ident" id="3189978">hosts</span><span class="op" id="3189983">.</span><span class="ident" id="3189984">expire</span><span class="op" id="3189990">)</span>&nbsp;<span class="op" id="3189992">||</span>&nbsp;<span class="ident" id="3189995">hosts</span><span class="op" id="3190000">.</span><span class="ident" id="3190001">path</span>&nbsp;<span class="op" id="3190006">!=</span>&nbsp;<span class="ident" id="3190009">hp</span>&nbsp;<span class="op" id="3190012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190016">hs</span>&nbsp;<span class="op" id="3190019">:=</span>&nbsp;<span class="builtinfunc" id="3190022">make</span><span class="op" id="3190026">(</span><span class="keyword" id="3190027">map</span><span class="op" id="3190030">[</span><span class="builtintype" id="3190031">string</span><span class="op" id="3190037">]</span><span class="op" id="3190038">[</span><span class="op" id="3190039">]</span><span class="builtintype" id="3190040">string</span><span class="op" id="3190046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190050">is</span>&nbsp;<span class="op" id="3190053">:=</span>&nbsp;<span class="builtinfunc" id="3190056">make</span><span class="op" id="3190060">(</span><span class="keyword" id="3190061">map</span><span class="op" id="3190064">[</span><span class="builtintype" id="3190065">string</span><span class="op" id="3190071">]</span><span class="op" id="3190072">[</span><span class="op" id="3190073">]</span><span class="builtintype" id="3190074">string</span><span class="op" id="3190080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190084">var</span>&nbsp;<span class="ident" id="3190088">file</span>&nbsp;<span class="op" id="3190093">*</span><span class="ident" id="3190094">file</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190101">if</span>&nbsp;<span class="ident" id="3190104">file</span><span class="op" id="3190108">,</span>&nbsp;<span class="ident" id="3190110">_</span>&nbsp;<span class="op" id="3190112">=</span>&nbsp;<span class="ident" id="3190114">open</span><span class="op" id="3190118">(</span><span class="ident" id="3190119">hp</span><span class="op" id="3190121">)</span><span class="op" id="3190122">;</span>&nbsp;<span class="ident" id="3190124">file</span>&nbsp;<span class="op" id="3190129">==</span>&nbsp;<span class="ident" id="3190132">nil</span>&nbsp;<span class="op" id="3190136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190141">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190154">for</span>&nbsp;<span class="ident" id="3190158">line</span><span class="op" id="3190162">,</span>&nbsp;<span class="ident" id="3190164">ok</span>&nbsp;<span class="op" id="3190167">:=</span>&nbsp;<span class="ident" id="3190170">file</span><span class="op" id="3190174">.</span><span class="ident" id="3190175">readLine</span><span class="op" id="3190183">(</span><span class="op" id="3190184">)</span><span class="op" id="3190185">;</span>&nbsp;<span class="ident" id="3190187">ok</span><span class="op" id="3190189">;</span>&nbsp;<span class="ident" id="3190191">line</span><span class="op" id="3190195">,</span>&nbsp;<span class="ident" id="3190197">ok</span>&nbsp;<span class="op" id="3190200">=</span>&nbsp;<span class="ident" id="3190202">file</span><span class="op" id="3190206">.</span><span class="ident" id="3190207">readLine</span><span class="op" id="3190215">(</span><span class="op" id="3190216">)</span>&nbsp;<span class="op" id="3190218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190223">if</span>&nbsp;<span class="ident" id="3190226">i</span>&nbsp;<span class="op" id="3190228">:=</span>&nbsp;<span class="ident" id="3190231">byteIndex</span><span class="op" id="3190240">(</span><span class="ident" id="3190241">line</span><span class="op" id="3190245">,</span>&nbsp;<span class="string" id="3190247">&#39;#&#39;</span><span class="op" id="3190250">)</span><span class="op" id="3190251">;</span>&nbsp;<span class="ident" id="3190253">i</span>&nbsp;<span class="op" id="3190255">&gt;=</span>&nbsp;<span class="num" id="3190258">0</span>&nbsp;<span class="op" id="3190260">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3190266">//&nbsp;Discard&nbsp;comments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190291">line</span>&nbsp;<span class="op" id="3190296">=</span>&nbsp;<span class="ident" id="3190298">line</span><span class="op" id="3190302">[</span><span class="num" id="3190303">0</span><span class="op" id="3190304">:</span><span class="ident" id="3190305">i</span><span class="op" id="3190306">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190316">f</span>&nbsp;<span class="op" id="3190318">:=</span>&nbsp;<span class="ident" id="3190321">getFields</span><span class="op" id="3190330">(</span><span class="ident" id="3190331">line</span><span class="op" id="3190335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190340">if</span>&nbsp;<span class="builtinfunc" id="3190343">len</span><span class="op" id="3190346">(</span><span class="ident" id="3190347">f</span><span class="op" id="3190348">)</span>&nbsp;<span class="op" id="3190350">&lt;</span>&nbsp;<span class="num" id="3190352">2</span>&nbsp;<span class="op" id="3190354">||</span>&nbsp;<span class="ident" id="3190357">ParseIP</span><span class="op" id="3190364">(</span><span class="ident" id="3190365">f</span><span class="op" id="3190366">[</span><span class="num" id="3190367">0</span><span class="op" id="3190368">]</span><span class="op" id="3190369">)</span>&nbsp;<span class="op" id="3190371">==</span>&nbsp;<span class="ident" id="3190374">nil</span>&nbsp;<span class="op" id="3190378">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190384">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190401">for</span>&nbsp;<span class="ident" id="3190405">i</span>&nbsp;<span class="op" id="3190407">:=</span>&nbsp;<span class="num" id="3190410">1</span><span class="op" id="3190411">;</span>&nbsp;<span class="ident" id="3190413">i</span>&nbsp;<span class="op" id="3190415">&lt;</span>&nbsp;<span class="builtinfunc" id="3190417">len</span><span class="op" id="3190420">(</span><span class="ident" id="3190421">f</span><span class="op" id="3190422">)</span><span class="op" id="3190423">;</span>&nbsp;<span class="ident" id="3190425">i</span><span class="op" id="3190426">++</span>&nbsp;<span class="op" id="3190429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190435">h</span>&nbsp;<span class="op" id="3190437">:=</span>&nbsp;<span class="ident" id="3190440">f</span><span class="op" id="3190441">[</span><span class="ident" id="3190442">i</span><span class="op" id="3190443">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190449">hs</span><span class="op" id="3190451">[</span><span class="ident" id="3190452">h</span><span class="op" id="3190453">]</span>&nbsp;<span class="op" id="3190455">=</span>&nbsp;<span class="builtinfunc" id="3190457">append</span><span class="op" id="3190463">(</span><span class="ident" id="3190464">hs</span><span class="op" id="3190466">[</span><span class="ident" id="3190467">h</span><span class="op" id="3190468">]</span><span class="op" id="3190469">,</span>&nbsp;<span class="ident" id="3190471">f</span><span class="op" id="3190472">[</span><span class="num" id="3190473">0</span><span class="op" id="3190474">]</span><span class="op" id="3190475">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190481">is</span><span class="op" id="3190483">[</span><span class="ident" id="3190484">f</span><span class="op" id="3190485">[</span><span class="num" id="3190486">0</span><span class="op" id="3190487">]</span><span class="op" id="3190488">]</span>&nbsp;<span class="op" id="3190490">=</span>&nbsp;<span class="builtinfunc" id="3190492">append</span><span class="op" id="3190498">(</span><span class="ident" id="3190499">is</span><span class="op" id="3190501">[</span><span class="ident" id="3190502">f</span><span class="op" id="3190503">[</span><span class="num" id="3190504">0</span><span class="op" id="3190505">]</span><span class="op" id="3190506">]</span><span class="op" id="3190507">,</span>&nbsp;<span class="ident" id="3190509">h</span><span class="op" id="3190510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3190523">//&nbsp;Update&nbsp;the&nbsp;data&nbsp;cache.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190551">hosts</span><span class="op" id="3190556">.</span><span class="ident" id="3190557">expire</span>&nbsp;<span class="op" id="3190564">=</span>&nbsp;<span class="ident" id="3190566">now</span><span class="op" id="3190569">.</span><span class="ident" id="3190570">Add</span><span class="op" id="3190573">(</span><span class="ident" id="3190574">cacheMaxAge</span><span class="op" id="3190585">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190589">hosts</span><span class="op" id="3190594">.</span><span class="ident" id="3190595">path</span>&nbsp;<span class="op" id="3190600">=</span>&nbsp;<span class="ident" id="3190602">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190607">hosts</span><span class="op" id="3190612">.</span><span class="ident" id="3190613">byName</span>&nbsp;<span class="op" id="3190620">=</span>&nbsp;<span class="ident" id="3190622">hs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190627">hosts</span><span class="op" id="3190632">.</span><span class="ident" id="3190633">byAddr</span>&nbsp;<span class="op" id="3190640">=</span>&nbsp;<span class="ident" id="3190642">is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190647">file</span><span class="op" id="3190651">.</span><span class="builtinfunc" id="3190652">close</span><span class="op" id="3190657">(</span><span class="op" id="3190658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190661">}</span><br>
<span class="lineno">60</span><span class="op" id="3190663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3190666">//&nbsp;lookupStaticHost&nbsp;looks&nbsp;up&nbsp;the&nbsp;addresses&nbsp;for&nbsp;the&nbsp;given&nbsp;host&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3190745">func</span>&nbsp;<span class="ident" id="3190750">lookupStaticHost</span><span class="op" id="3190766">(</span><span class="ident" id="3190767">host</span>&nbsp;<span class="builtintype" id="3190772">string</span><span class="op" id="3190778">)</span>&nbsp;<span class="op" id="3190780">[</span><span class="op" id="3190781">]</span><span class="builtintype" id="3190782">string</span>&nbsp;<span class="op" id="3190789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190792">hosts</span><span class="op" id="3190797">.</span><span class="ident" id="3190798">Lock</span><span class="op" id="3190802">(</span><span class="op" id="3190803">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190806">defer</span>&nbsp;<span class="ident" id="3190812">hosts</span><span class="op" id="3190817">.</span><span class="ident" id="3190818">Unlock</span><span class="op" id="3190824">(</span><span class="op" id="3190825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3190828">readHosts</span><span class="op" id="3190837">(</span><span class="op" id="3190838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190841">if</span>&nbsp;<span class="builtinfunc" id="3190844">len</span><span class="op" id="3190847">(</span><span class="ident" id="3190848">hosts</span><span class="op" id="3190853">.</span><span class="ident" id="3190854">byName</span><span class="op" id="3190860">)</span>&nbsp;<span class="op" id="3190862">!=</span>&nbsp;<span class="num" id="3190865">0</span>&nbsp;<span class="op" id="3190867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190871">if</span>&nbsp;<span class="ident" id="3190874">ips</span><span class="op" id="3190877">,</span>&nbsp;<span class="ident" id="3190879">ok</span>&nbsp;<span class="op" id="3190882">:=</span>&nbsp;<span class="ident" id="3190885">hosts</span><span class="op" id="3190890">.</span><span class="ident" id="3190891">byName</span><span class="op" id="3190897">[</span><span class="ident" id="3190898">host</span><span class="op" id="3190902">]</span><span class="op" id="3190903">;</span>&nbsp;<span class="ident" id="3190905">ok</span>&nbsp;<span class="op" id="3190908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190913">return</span>&nbsp;<span class="ident" id="3190920">ips</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3190929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3190932">return</span>&nbsp;<span class="ident" id="3190939">nil</span><br>
<span class="lineno"></span><span class="op" id="3190943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="3190946">//&nbsp;lookupStaticAddr&nbsp;looks&nbsp;up&nbsp;the&nbsp;hosts&nbsp;for&nbsp;the&nbsp;given&nbsp;address&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3191024">func</span>&nbsp;<span class="ident" id="3191029">lookupStaticAddr</span><span class="op" id="3191045">(</span><span class="ident" id="3191046">addr</span>&nbsp;<span class="builtintype" id="3191051">string</span><span class="op" id="3191057">)</span>&nbsp;<span class="op" id="3191059">[</span><span class="op" id="3191060">]</span><span class="builtintype" id="3191061">string</span>&nbsp;<span class="op" id="3191068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191071">hosts</span><span class="op" id="3191076">.</span><span class="ident" id="3191077">Lock</span><span class="op" id="3191081">(</span><span class="op" id="3191082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191085">defer</span>&nbsp;<span class="ident" id="3191091">hosts</span><span class="op" id="3191096">.</span><span class="ident" id="3191097">Unlock</span><span class="op" id="3191103">(</span><span class="op" id="3191104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3191107">readHosts</span><span class="op" id="3191116">(</span><span class="op" id="3191117">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191120">if</span>&nbsp;<span class="builtinfunc" id="3191123">len</span><span class="op" id="3191126">(</span><span class="ident" id="3191127">hosts</span><span class="op" id="3191132">.</span><span class="ident" id="3191133">byAddr</span><span class="op" id="3191139">)</span>&nbsp;<span class="op" id="3191141">!=</span>&nbsp;<span class="num" id="3191144">0</span>&nbsp;<span class="op" id="3191146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191150">if</span>&nbsp;<span class="ident" id="3191153">hosts</span><span class="op" id="3191158">,</span>&nbsp;<span class="ident" id="3191160">ok</span>&nbsp;<span class="op" id="3191163">:=</span>&nbsp;<span class="ident" id="3191166">hosts</span><span class="op" id="3191171">.</span><span class="ident" id="3191172">byAddr</span><span class="op" id="3191178">[</span><span class="ident" id="3191179">addr</span><span class="op" id="3191183">]</span><span class="op" id="3191184">;</span>&nbsp;<span class="ident" id="3191186">ok</span>&nbsp;<span class="op" id="3191189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191194">return</span>&nbsp;<span class="ident" id="3191201">hosts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3191209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3191212">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3191215">return</span>&nbsp;<span class="ident" id="3191222">nil</span><br>
<span class="lineno"></span><span class="op" id="3191226">}</span>
</div>
</body>
</html>
