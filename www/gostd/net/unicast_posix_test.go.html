<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8368437">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8368493">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8368547">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8368598">//&nbsp;+build&nbsp;!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8368616">package</span>&nbsp;<span class="ident" id="8368624">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8368629">import</span>&nbsp;<span class="op" id="8368636">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8368639">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8368650">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8368661">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8368671">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="8368674">var</span>&nbsp;<span class="ident" id="8368678">listenerTests</span>&nbsp;<span class="op" id="8368692">=</span>&nbsp;<span class="op" id="8368694">[</span><span class="op" id="8368695">]</span><span class="keyword" id="8368696">struct</span>&nbsp;<span class="op" id="8368703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368706">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8368715">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368723">laddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8368732">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368740">ipv6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8368749">bool</span>&nbsp;<span class="comment" id="8368754">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8368795">wildcard</span>&nbsp;<span class="builtintype" id="8368804">bool</span>&nbsp;<span class="comment" id="8368809">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">20</span><span class="op" id="8368839">}</span><span class="op" id="8368840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368843">{</span><span class="ident" id="8368844">net</span><span class="op" id="8368847">:</span>&nbsp;<span class="string" id="8368849">&#34;tcp&#34;</span><span class="op" id="8368854">,</span>&nbsp;<span class="ident" id="8368856">laddr</span><span class="op" id="8368861">:</span>&nbsp;<span class="string" id="8368863">&#34;&#34;</span><span class="op" id="8368865">,</span>&nbsp;<span class="ident" id="8368867">wildcard</span><span class="op" id="8368875">:</span>&nbsp;<span class="builtintype" id="8368877">true</span><span class="op" id="8368881">}</span><span class="op" id="8368882">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368885">{</span><span class="ident" id="8368886">net</span><span class="op" id="8368889">:</span>&nbsp;<span class="string" id="8368891">&#34;tcp&#34;</span><span class="op" id="8368896">,</span>&nbsp;<span class="ident" id="8368898">laddr</span><span class="op" id="8368903">:</span>&nbsp;<span class="string" id="8368905">&#34;0.0.0.0&#34;</span><span class="op" id="8368914">,</span>&nbsp;<span class="ident" id="8368916">wildcard</span><span class="op" id="8368924">:</span>&nbsp;<span class="builtintype" id="8368926">true</span><span class="op" id="8368930">}</span><span class="op" id="8368931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368934">{</span><span class="ident" id="8368935">net</span><span class="op" id="8368938">:</span>&nbsp;<span class="string" id="8368940">&#34;tcp&#34;</span><span class="op" id="8368945">,</span>&nbsp;<span class="ident" id="8368947">laddr</span><span class="op" id="8368952">:</span>&nbsp;<span class="string" id="8368954">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8368972">,</span>&nbsp;<span class="ident" id="8368974">wildcard</span><span class="op" id="8368982">:</span>&nbsp;<span class="builtintype" id="8368984">true</span><span class="op" id="8368988">}</span><span class="op" id="8368989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8368992">{</span><span class="ident" id="8368993">net</span><span class="op" id="8368996">:</span>&nbsp;<span class="string" id="8368998">&#34;tcp&#34;</span><span class="op" id="8369003">,</span>&nbsp;<span class="ident" id="8369005">laddr</span><span class="op" id="8369010">:</span>&nbsp;<span class="string" id="8369012">&#34;[::]&#34;</span><span class="op" id="8369018">,</span>&nbsp;<span class="ident" id="8369020">ipv6</span><span class="op" id="8369024">:</span>&nbsp;<span class="builtintype" id="8369026">true</span><span class="op" id="8369030">,</span>&nbsp;<span class="ident" id="8369032">wildcard</span><span class="op" id="8369040">:</span>&nbsp;<span class="builtintype" id="8369042">true</span><span class="op" id="8369046">}</span><span class="op" id="8369047">,</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369051">{</span><span class="ident" id="8369052">net</span><span class="op" id="8369055">:</span>&nbsp;<span class="string" id="8369057">&#34;tcp&#34;</span><span class="op" id="8369062">,</span>&nbsp;<span class="ident" id="8369064">laddr</span><span class="op" id="8369069">:</span>&nbsp;<span class="string" id="8369071">&#34;127.0.0.1&#34;</span><span class="op" id="8369082">}</span><span class="op" id="8369083">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369086">{</span><span class="ident" id="8369087">net</span><span class="op" id="8369090">:</span>&nbsp;<span class="string" id="8369092">&#34;tcp&#34;</span><span class="op" id="8369097">,</span>&nbsp;<span class="ident" id="8369099">laddr</span><span class="op" id="8369104">:</span>&nbsp;<span class="string" id="8369106">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8369126">}</span><span class="op" id="8369127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369130">{</span><span class="ident" id="8369131">net</span><span class="op" id="8369134">:</span>&nbsp;<span class="string" id="8369136">&#34;tcp&#34;</span><span class="op" id="8369141">,</span>&nbsp;<span class="ident" id="8369143">laddr</span><span class="op" id="8369148">:</span>&nbsp;<span class="string" id="8369150">&#34;[::1]&#34;</span><span class="op" id="8369157">,</span>&nbsp;<span class="ident" id="8369159">ipv6</span><span class="op" id="8369163">:</span>&nbsp;<span class="builtintype" id="8369165">true</span><span class="op" id="8369169">}</span><span class="op" id="8369170">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369174">{</span><span class="ident" id="8369175">net</span><span class="op" id="8369178">:</span>&nbsp;<span class="string" id="8369180">&#34;tcp4&#34;</span><span class="op" id="8369186">,</span>&nbsp;<span class="ident" id="8369188">laddr</span><span class="op" id="8369193">:</span>&nbsp;<span class="string" id="8369195">&#34;&#34;</span><span class="op" id="8369197">,</span>&nbsp;<span class="ident" id="8369199">wildcard</span><span class="op" id="8369207">:</span>&nbsp;<span class="builtintype" id="8369209">true</span><span class="op" id="8369213">}</span><span class="op" id="8369214">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369217">{</span><span class="ident" id="8369218">net</span><span class="op" id="8369221">:</span>&nbsp;<span class="string" id="8369223">&#34;tcp4&#34;</span><span class="op" id="8369229">,</span>&nbsp;<span class="ident" id="8369231">laddr</span><span class="op" id="8369236">:</span>&nbsp;<span class="string" id="8369238">&#34;0.0.0.0&#34;</span><span class="op" id="8369247">,</span>&nbsp;<span class="ident" id="8369249">wildcard</span><span class="op" id="8369257">:</span>&nbsp;<span class="builtintype" id="8369259">true</span><span class="op" id="8369263">}</span><span class="op" id="8369264">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369267">{</span><span class="ident" id="8369268">net</span><span class="op" id="8369271">:</span>&nbsp;<span class="string" id="8369273">&#34;tcp4&#34;</span><span class="op" id="8369279">,</span>&nbsp;<span class="ident" id="8369281">laddr</span><span class="op" id="8369286">:</span>&nbsp;<span class="string" id="8369288">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8369306">,</span>&nbsp;<span class="ident" id="8369308">wildcard</span><span class="op" id="8369316">:</span>&nbsp;<span class="builtintype" id="8369318">true</span><span class="op" id="8369322">}</span><span class="op" id="8369323">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369327">{</span><span class="ident" id="8369328">net</span><span class="op" id="8369331">:</span>&nbsp;<span class="string" id="8369333">&#34;tcp4&#34;</span><span class="op" id="8369339">,</span>&nbsp;<span class="ident" id="8369341">laddr</span><span class="op" id="8369346">:</span>&nbsp;<span class="string" id="8369348">&#34;127.0.0.1&#34;</span><span class="op" id="8369359">}</span><span class="op" id="8369360">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369363">{</span><span class="ident" id="8369364">net</span><span class="op" id="8369367">:</span>&nbsp;<span class="string" id="8369369">&#34;tcp4&#34;</span><span class="op" id="8369375">,</span>&nbsp;<span class="ident" id="8369377">laddr</span><span class="op" id="8369382">:</span>&nbsp;<span class="string" id="8369384">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8369404">}</span><span class="op" id="8369405">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369409">{</span><span class="ident" id="8369410">net</span><span class="op" id="8369413">:</span>&nbsp;<span class="string" id="8369415">&#34;tcp6&#34;</span><span class="op" id="8369421">,</span>&nbsp;<span class="ident" id="8369423">laddr</span><span class="op" id="8369428">:</span>&nbsp;<span class="string" id="8369430">&#34;&#34;</span><span class="op" id="8369432">,</span>&nbsp;<span class="ident" id="8369434">ipv6</span><span class="op" id="8369438">:</span>&nbsp;<span class="builtintype" id="8369440">true</span><span class="op" id="8369444">,</span>&nbsp;<span class="ident" id="8369446">wildcard</span><span class="op" id="8369454">:</span>&nbsp;<span class="builtintype" id="8369456">true</span><span class="op" id="8369460">}</span><span class="op" id="8369461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369464">{</span><span class="ident" id="8369465">net</span><span class="op" id="8369468">:</span>&nbsp;<span class="string" id="8369470">&#34;tcp6&#34;</span><span class="op" id="8369476">,</span>&nbsp;<span class="ident" id="8369478">laddr</span><span class="op" id="8369483">:</span>&nbsp;<span class="string" id="8369485">&#34;[::]&#34;</span><span class="op" id="8369491">,</span>&nbsp;<span class="ident" id="8369493">ipv6</span><span class="op" id="8369497">:</span>&nbsp;<span class="builtintype" id="8369499">true</span><span class="op" id="8369503">,</span>&nbsp;<span class="ident" id="8369505">wildcard</span><span class="op" id="8369513">:</span>&nbsp;<span class="builtintype" id="8369515">true</span><span class="op" id="8369519">}</span><span class="op" id="8369520">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369524">{</span><span class="ident" id="8369525">net</span><span class="op" id="8369528">:</span>&nbsp;<span class="string" id="8369530">&#34;tcp6&#34;</span><span class="op" id="8369536">,</span>&nbsp;<span class="ident" id="8369538">laddr</span><span class="op" id="8369543">:</span>&nbsp;<span class="string" id="8369545">&#34;[::1]&#34;</span><span class="op" id="8369552">,</span>&nbsp;<span class="ident" id="8369554">ipv6</span><span class="op" id="8369558">:</span>&nbsp;<span class="builtintype" id="8369560">true</span><span class="op" id="8369564">}</span><span class="op" id="8369565">,</span><br>
<span class="lineno"></span><span class="op" id="8369567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8369570">//&nbsp;TestTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="8369635">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno">45</span><span class="comment" id="8369700">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="8369714">func</span>&nbsp;<span class="ident" id="8369719">TestTCPListener</span><span class="op" id="8369734">(</span><span class="ident" id="8369735">t</span>&nbsp;<span class="op" id="8369737">*</span><span class="ident" id="8369738">testing</span><span class="op" id="8369745">.</span><span class="ident" id="8369746">T</span><span class="op" id="8369747">)</span>&nbsp;<span class="op" id="8369749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369752">switch</span>&nbsp;<span class="ident" id="8369759">runtime</span><span class="op" id="8369766">.</span><span class="ident" id="8369767">GOOS</span>&nbsp;<span class="op" id="8369772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369775">case</span>&nbsp;<span class="string" id="8369780">&#34;plan9&#34;</span><span class="op" id="8369787">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8369791">t</span><span class="op" id="8369792">.</span><span class="ident" id="8369793">Skipf</span><span class="op" id="8369798">(</span><span class="string" id="8369799">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8369820">,</span>&nbsp;<span class="ident" id="8369822">runtime</span><span class="op" id="8369829">.</span><span class="ident" id="8369830">GOOS</span><span class="op" id="8369834">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369841">for</span>&nbsp;<span class="ident" id="8369845">_</span><span class="op" id="8369846">,</span>&nbsp;<span class="ident" id="8369848">tt</span>&nbsp;<span class="op" id="8369851">:=</span>&nbsp;<span class="keyword" id="8369854">range</span>&nbsp;<span class="ident" id="8369860">listenerTests</span>&nbsp;<span class="op" id="8369874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369878">if</span>&nbsp;<span class="ident" id="8369881">tt</span><span class="op" id="8369883">.</span><span class="ident" id="8369884">wildcard</span>&nbsp;<span class="op" id="8369893">&amp;&amp;</span>&nbsp;<span class="op" id="8369896">(</span><span class="ident" id="8369897">testing</span><span class="op" id="8369904">.</span><span class="ident" id="8369905">Short</span><span class="op" id="8369910">(</span><span class="op" id="8369911">)</span>&nbsp;<span class="op" id="8369913">||</span>&nbsp;<span class="op" id="8369916">!</span><span class="op" id="8369917">*</span><span class="ident" id="8369918">testExternal</span><span class="op" id="8369930">)</span>&nbsp;<span class="op" id="8369932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369937">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369952">if</span>&nbsp;<span class="ident" id="8369955">tt</span><span class="op" id="8369957">.</span><span class="ident" id="8369958">ipv6</span>&nbsp;<span class="op" id="8369963">&amp;&amp;</span>&nbsp;<span class="op" id="8369966">!</span><span class="ident" id="8369967">supportsIPv6</span>&nbsp;<span class="op" id="8369980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8369985">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8369996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370000">l1</span><span class="op" id="8370002">,</span>&nbsp;<span class="ident" id="8370004">port</span>&nbsp;<span class="op" id="8370009">:=</span>&nbsp;<span class="ident" id="8370012">usableListenPort</span><span class="op" id="8370028">(</span><span class="ident" id="8370029">t</span><span class="op" id="8370030">,</span>&nbsp;<span class="ident" id="8370032">tt</span><span class="op" id="8370034">.</span><span class="ident" id="8370035">net</span><span class="op" id="8370038">,</span>&nbsp;<span class="ident" id="8370040">tt</span><span class="op" id="8370042">.</span><span class="ident" id="8370043">laddr</span><span class="op" id="8370048">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370052">checkFirstListener</span><span class="op" id="8370070">(</span><span class="ident" id="8370071">t</span><span class="op" id="8370072">,</span>&nbsp;<span class="ident" id="8370074">tt</span><span class="op" id="8370076">.</span><span class="ident" id="8370077">net</span><span class="op" id="8370080">,</span>&nbsp;<span class="ident" id="8370082">tt</span><span class="op" id="8370084">.</span><span class="ident" id="8370085">laddr</span><span class="op" id="8370090">+</span><span class="string" id="8370091">&#34;:&#34;</span><span class="op" id="8370094">+</span><span class="ident" id="8370095">port</span><span class="op" id="8370099">,</span>&nbsp;<span class="ident" id="8370101">l1</span><span class="op" id="8370103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370107">l2</span><span class="op" id="8370109">,</span>&nbsp;<span class="ident" id="8370111">err</span>&nbsp;<span class="op" id="8370115">:=</span>&nbsp;<span class="ident" id="8370118">Listen</span><span class="op" id="8370124">(</span><span class="ident" id="8370125">tt</span><span class="op" id="8370127">.</span><span class="ident" id="8370128">net</span><span class="op" id="8370131">,</span>&nbsp;<span class="ident" id="8370133">tt</span><span class="op" id="8370135">.</span><span class="ident" id="8370136">laddr</span><span class="op" id="8370141">+</span><span class="string" id="8370142">&#34;:&#34;</span><span class="op" id="8370145">+</span><span class="ident" id="8370146">port</span><span class="op" id="8370150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370154">checkSecondListener</span><span class="op" id="8370173">(</span><span class="ident" id="8370174">t</span><span class="op" id="8370175">,</span>&nbsp;<span class="ident" id="8370177">tt</span><span class="op" id="8370179">.</span><span class="ident" id="8370180">net</span><span class="op" id="8370183">,</span>&nbsp;<span class="ident" id="8370185">tt</span><span class="op" id="8370187">.</span><span class="ident" id="8370188">laddr</span><span class="op" id="8370193">+</span><span class="string" id="8370194">&#34;:&#34;</span><span class="op" id="8370197">+</span><span class="ident" id="8370198">port</span><span class="op" id="8370202">,</span>&nbsp;<span class="ident" id="8370204">err</span><span class="op" id="8370207">,</span>&nbsp;<span class="ident" id="8370209">l2</span><span class="op" id="8370211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370215">l1</span><span class="op" id="8370217">.</span><span class="ident" id="8370218">Close</span><span class="op" id="8370223">(</span><span class="op" id="8370224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8370227">}</span><br>
<span class="lineno">65</span><span class="op" id="8370229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8370232">//&nbsp;TestUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="8370297">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="8370362">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno">70</span><span class="keyword" id="8370376">func</span>&nbsp;<span class="ident" id="8370381">TestUDPListener</span><span class="op" id="8370396">(</span><span class="ident" id="8370397">t</span>&nbsp;<span class="op" id="8370399">*</span><span class="ident" id="8370400">testing</span><span class="op" id="8370407">.</span><span class="ident" id="8370408">T</span><span class="op" id="8370409">)</span>&nbsp;<span class="op" id="8370411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370414">switch</span>&nbsp;<span class="ident" id="8370421">runtime</span><span class="op" id="8370428">.</span><span class="ident" id="8370429">GOOS</span>&nbsp;<span class="op" id="8370434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370437">case</span>&nbsp;<span class="string" id="8370442">&#34;plan9&#34;</span><span class="op" id="8370449">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370453">t</span><span class="op" id="8370454">.</span><span class="ident" id="8370455">Skipf</span><span class="op" id="8370460">(</span><span class="string" id="8370461">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8370482">,</span>&nbsp;<span class="ident" id="8370484">runtime</span><span class="op" id="8370491">.</span><span class="ident" id="8370492">GOOS</span><span class="op" id="8370496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8370499">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370503">toudpnet</span>&nbsp;<span class="op" id="8370512">:=</span>&nbsp;<span class="keyword" id="8370515">func</span><span class="op" id="8370519">(</span><span class="ident" id="8370520">net</span>&nbsp;<span class="builtintype" id="8370524">string</span><span class="op" id="8370530">)</span>&nbsp;<span class="builtintype" id="8370532">string</span>&nbsp;<span class="op" id="8370539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370543">switch</span>&nbsp;<span class="ident" id="8370550">net</span>&nbsp;<span class="op" id="8370554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370558">case</span>&nbsp;<span class="string" id="8370563">&#34;tcp&#34;</span><span class="op" id="8370568">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370573">return</span>&nbsp;<span class="string" id="8370580">&#34;udp&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370588">case</span>&nbsp;<span class="string" id="8370593">&#34;tcp4&#34;</span><span class="op" id="8370599">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370604">return</span>&nbsp;<span class="string" id="8370611">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370620">case</span>&nbsp;<span class="string" id="8370625">&#34;tcp6&#34;</span><span class="op" id="8370631">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370636">return</span>&nbsp;<span class="string" id="8370643">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8370652">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370656">return</span>&nbsp;<span class="string" id="8370663">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8370672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370676">for</span>&nbsp;<span class="ident" id="8370680">_</span><span class="op" id="8370681">,</span>&nbsp;<span class="ident" id="8370683">tt</span>&nbsp;<span class="op" id="8370686">:=</span>&nbsp;<span class="keyword" id="8370689">range</span>&nbsp;<span class="ident" id="8370695">listenerTests</span>&nbsp;<span class="op" id="8370709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370713">if</span>&nbsp;<span class="ident" id="8370716">tt</span><span class="op" id="8370718">.</span><span class="ident" id="8370719">wildcard</span>&nbsp;<span class="op" id="8370728">&amp;&amp;</span>&nbsp;<span class="op" id="8370731">(</span><span class="ident" id="8370732">testing</span><span class="op" id="8370739">.</span><span class="ident" id="8370740">Short</span><span class="op" id="8370745">(</span><span class="op" id="8370746">)</span>&nbsp;<span class="op" id="8370748">||</span>&nbsp;<span class="op" id="8370751">!</span><span class="op" id="8370752">*</span><span class="ident" id="8370753">testExternal</span><span class="op" id="8370765">)</span>&nbsp;<span class="op" id="8370767">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370772">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8370783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370787">if</span>&nbsp;<span class="ident" id="8370790">tt</span><span class="op" id="8370792">.</span><span class="ident" id="8370793">ipv6</span>&nbsp;<span class="op" id="8370798">&amp;&amp;</span>&nbsp;<span class="op" id="8370801">!</span><span class="ident" id="8370802">supportsIPv6</span>&nbsp;<span class="op" id="8370815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8370820">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8370831">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370835">tt</span><span class="op" id="8370837">.</span><span class="ident" id="8370838">net</span>&nbsp;<span class="op" id="8370842">=</span>&nbsp;<span class="ident" id="8370844">toudpnet</span><span class="op" id="8370852">(</span><span class="ident" id="8370853">tt</span><span class="op" id="8370855">.</span><span class="ident" id="8370856">net</span><span class="op" id="8370859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370863">l1</span><span class="op" id="8370865">,</span>&nbsp;<span class="ident" id="8370867">port</span>&nbsp;<span class="op" id="8370872">:=</span>&nbsp;<span class="ident" id="8370875">usableListenPacketPort</span><span class="op" id="8370897">(</span><span class="ident" id="8370898">t</span><span class="op" id="8370899">,</span>&nbsp;<span class="ident" id="8370901">tt</span><span class="op" id="8370903">.</span><span class="ident" id="8370904">net</span><span class="op" id="8370907">,</span>&nbsp;<span class="ident" id="8370909">tt</span><span class="op" id="8370911">.</span><span class="ident" id="8370912">laddr</span><span class="op" id="8370917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370921">checkFirstListener</span><span class="op" id="8370939">(</span><span class="ident" id="8370940">t</span><span class="op" id="8370941">,</span>&nbsp;<span class="ident" id="8370943">tt</span><span class="op" id="8370945">.</span><span class="ident" id="8370946">net</span><span class="op" id="8370949">,</span>&nbsp;<span class="ident" id="8370951">tt</span><span class="op" id="8370953">.</span><span class="ident" id="8370954">laddr</span><span class="op" id="8370959">+</span><span class="string" id="8370960">&#34;:&#34;</span><span class="op" id="8370963">+</span><span class="ident" id="8370964">port</span><span class="op" id="8370968">,</span>&nbsp;<span class="ident" id="8370970">l1</span><span class="op" id="8370972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8370976">l2</span><span class="op" id="8370978">,</span>&nbsp;<span class="ident" id="8370980">err</span>&nbsp;<span class="op" id="8370984">:=</span>&nbsp;<span class="ident" id="8370987">ListenPacket</span><span class="op" id="8370999">(</span><span class="ident" id="8371000">tt</span><span class="op" id="8371002">.</span><span class="ident" id="8371003">net</span><span class="op" id="8371006">,</span>&nbsp;<span class="ident" id="8371008">tt</span><span class="op" id="8371010">.</span><span class="ident" id="8371011">laddr</span><span class="op" id="8371016">+</span><span class="string" id="8371017">&#34;:&#34;</span><span class="op" id="8371020">+</span><span class="ident" id="8371021">port</span><span class="op" id="8371025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371029">checkSecondListener</span><span class="op" id="8371048">(</span><span class="ident" id="8371049">t</span><span class="op" id="8371050">,</span>&nbsp;<span class="ident" id="8371052">tt</span><span class="op" id="8371054">.</span><span class="ident" id="8371055">net</span><span class="op" id="8371058">,</span>&nbsp;<span class="ident" id="8371060">tt</span><span class="op" id="8371062">.</span><span class="ident" id="8371063">laddr</span><span class="op" id="8371068">+</span><span class="string" id="8371069">&#34;:&#34;</span><span class="op" id="8371072">+</span><span class="ident" id="8371073">port</span><span class="op" id="8371077">,</span>&nbsp;<span class="ident" id="8371079">err</span><span class="op" id="8371082">,</span>&nbsp;<span class="ident" id="8371084">l2</span><span class="op" id="8371086">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371090">l1</span><span class="op" id="8371092">.</span><span class="ident" id="8371093">Close</span><span class="op" id="8371098">(</span><span class="op" id="8371099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8371102">}</span><br>
<span class="lineno"></span><span class="op" id="8371104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8371107">var</span>&nbsp;<span class="ident" id="8371111">dualStackListenerTests</span>&nbsp;<span class="op" id="8371134">=</span>&nbsp;<span class="op" id="8371136">[</span><span class="op" id="8371137">]</span><span class="keyword" id="8371138">struct</span>&nbsp;<span class="op" id="8371145">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371148">net1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8371157">string</span>&nbsp;<span class="comment" id="8371164">//&nbsp;first&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371183">laddr1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8371192">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371200">net2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8371209">string</span>&nbsp;<span class="comment" id="8371216">//&nbsp;second&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371236">laddr2</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8371245">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371253">wildcard</span>&nbsp;<span class="builtintype" id="8371262">bool</span>&nbsp;&nbsp;<span class="comment" id="8371268">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8371299">xerr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8371308">error</span>&nbsp;<span class="comment" id="8371314">//&nbsp;expected&nbsp;error&nbsp;value,&nbsp;nil&nbsp;or&nbsp;other</span><br>
<span class="lineno"></span><span class="op" id="8371352">}</span><span class="op" id="8371353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8371356">//&nbsp;Test&nbsp;cases&nbsp;and&nbsp;expected&nbsp;results&nbsp;for&nbsp;the&nbsp;attemping&nbsp;2nd&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8371438">//&nbsp;1st&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2nd&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;darwin&nbsp;&nbsp;freebsd&nbsp;&nbsp;linux&nbsp;&nbsp;openbsd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8371527">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8371616">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8371702">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8371788">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8371874">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8371963">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8372050">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8372137">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8372224">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8372311">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8372398">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8372485">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8372574">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8372661">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8372748">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8372835">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8372922">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8373011">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8373098">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8373185">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8373272">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8373359">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8373363">//&nbsp;Platform&nbsp;default&nbsp;configurations:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8373400">//&nbsp;darwin,&nbsp;kernel&nbsp;version&nbsp;11.3.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8373434">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8373507">//&nbsp;freebsd,&nbsp;kernel&nbsp;version&nbsp;8.2</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8373539">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8373612">//&nbsp;linux,&nbsp;kernel&nbsp;version&nbsp;3.0.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8373644">//&nbsp;&nbsp;&nbsp;&nbspnet.ipv6.bindv6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8373716">//&nbsp;openbsd,&nbsp;kernel&nbsp;version&nbsp;5.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8373748">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overriding&nbsp;is&nbsp;prohibited)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373803">{</span><span class="ident" id="8373804">net1</span><span class="op" id="8373808">:</span>&nbsp;<span class="string" id="8373810">&#34;tcp&#34;</span><span class="op" id="8373815">,</span>&nbsp;<span class="ident" id="8373817">laddr1</span><span class="op" id="8373823">:</span>&nbsp;<span class="string" id="8373825">&#34;&#34;</span><span class="op" id="8373827">,</span>&nbsp;<span class="ident" id="8373829">net2</span><span class="op" id="8373833">:</span>&nbsp;<span class="string" id="8373835">&#34;tcp&#34;</span><span class="op" id="8373840">,</span>&nbsp;<span class="ident" id="8373842">laddr2</span><span class="op" id="8373848">:</span>&nbsp;<span class="string" id="8373850">&#34;&#34;</span><span class="op" id="8373852">,</span>&nbsp;<span class="ident" id="8373854">wildcard</span><span class="op" id="8373862">:</span>&nbsp;<span class="builtintype" id="8373864">true</span><span class="op" id="8373868">,</span>&nbsp;<span class="ident" id="8373870">xerr</span><span class="op" id="8373874">:</span>&nbsp;<span class="ident" id="8373876">syscall</span><span class="op" id="8373883">.</span><span class="ident" id="8373884">EADDRINUSE</span><span class="op" id="8373894">}</span><span class="op" id="8373895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8373898">{</span><span class="ident" id="8373899">net1</span><span class="op" id="8373903">:</span>&nbsp;<span class="string" id="8373905">&#34;tcp&#34;</span><span class="op" id="8373910">,</span>&nbsp;<span class="ident" id="8373912">laddr1</span><span class="op" id="8373918">:</span>&nbsp;<span class="string" id="8373920">&#34;&#34;</span><span class="op" id="8373922">,</span>&nbsp;<span class="ident" id="8373924">net2</span><span class="op" id="8373928">:</span>&nbsp;<span class="string" id="8373930">&#34;tcp&#34;</span><span class="op" id="8373935">,</span>&nbsp;<span class="ident" id="8373937">laddr2</span><span class="op" id="8373943">:</span>&nbsp;<span class="string" id="8373945">&#34;0.0.0.0&#34;</span><span class="op" id="8373954">,</span>&nbsp;<span class="ident" id="8373956">wildcard</span><span class="op" id="8373964">:</span>&nbsp;<span class="builtintype" id="8373966">true</span><span class="op" id="8373970">,</span>&nbsp;<span class="ident" id="8373972">xerr</span><span class="op" id="8373976">:</span>&nbsp;<span class="ident" id="8373978">syscall</span><span class="op" id="8373985">.</span><span class="ident" id="8373986">EADDRINUSE</span><span class="op" id="8373996">}</span><span class="op" id="8373997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8374000">{</span><span class="ident" id="8374001">net1</span><span class="op" id="8374005">:</span>&nbsp;<span class="string" id="8374007">&#34;tcp&#34;</span><span class="op" id="8374012">,</span>&nbsp;<span class="ident" id="8374014">laddr1</span><span class="op" id="8374020">:</span>&nbsp;<span class="string" id="8374022">&#34;0.0.0.0&#34;</span><span class="op" id="8374031">,</span>&nbsp;<span class="ident" id="8374033">net2</span><span class="op" id="8374037">:</span>&nbsp;<span class="string" id="8374039">&#34;tcp&#34;</span><span class="op" id="8374044">,</span>&nbsp;<span class="ident" id="8374046">laddr2</span><span class="op" id="8374052">:</span>&nbsp;<span class="string" id="8374054">&#34;&#34;</span><span class="op" id="8374056">,</span>&nbsp;<span class="ident" id="8374058">wildcard</span><span class="op" id="8374066">:</span>&nbsp;<span class="builtintype" id="8374068">true</span><span class="op" id="8374072">,</span>&nbsp;<span class="ident" id="8374074">xerr</span><span class="op" id="8374078">:</span>&nbsp;<span class="ident" id="8374080">syscall</span><span class="op" id="8374087">.</span><span class="ident" id="8374088">EADDRINUSE</span><span class="op" id="8374098">}</span><span class="op" id="8374099">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8374103">{</span><span class="ident" id="8374104">net1</span><span class="op" id="8374108">:</span>&nbsp;<span class="string" id="8374110">&#34;tcp&#34;</span><span class="op" id="8374115">,</span>&nbsp;<span class="ident" id="8374117">laddr1</span><span class="op" id="8374123">:</span>&nbsp;<span class="string" id="8374125">&#34;&#34;</span><span class="op" id="8374127">,</span>&nbsp;<span class="ident" id="8374129">net2</span><span class="op" id="8374133">:</span>&nbsp;<span class="string" id="8374135">&#34;tcp&#34;</span><span class="op" id="8374140">,</span>&nbsp;<span class="ident" id="8374142">laddr2</span><span class="op" id="8374148">:</span>&nbsp;<span class="string" id="8374150">&#34;[::]&#34;</span><span class="op" id="8374156">,</span>&nbsp;<span class="ident" id="8374158">wildcard</span><span class="op" id="8374166">:</span>&nbsp;<span class="builtintype" id="8374168">true</span><span class="op" id="8374172">,</span>&nbsp;<span class="ident" id="8374174">xerr</span><span class="op" id="8374178">:</span>&nbsp;<span class="ident" id="8374180">syscall</span><span class="op" id="8374187">.</span><span class="ident" id="8374188">EADDRINUSE</span><span class="op" id="8374198">}</span><span class="op" id="8374199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8374202">{</span><span class="ident" id="8374203">net1</span><span class="op" id="8374207">:</span>&nbsp;<span class="string" id="8374209">&#34;tcp&#34;</span><span class="op" id="8374214">,</span>&nbsp;<span class="ident" id="8374216">laddr1</span><span class="op" id="8374222">:</span>&nbsp;<span class="string" id="8374224">&#34;[::]&#34;</span><span class="op" id="8374230">,</span>&nbsp;<span class="ident" id="8374232">net2</span><span class="op" id="8374236">:</span>&nbsp;<span class="string" id="8374238">&#34;tcp&#34;</span><span class="op" id="8374243">,</span>&nbsp;<span class="ident" id="8374245">laddr2</span><span class="op" id="8374251">:</span>&nbsp;<span class="string" id="8374253">&#34;&#34;</span><span class="op" id="8374255">,</span>&nbsp;<span class="ident" id="8374257">wildcard</span><span class="op" id="8374265">:</span>&nbsp;<span class="builtintype" id="8374267">true</span><span class="op" id="8374271">,</span>&nbsp;<span class="ident" id="8374273">xerr</span><span class="op" id="8374277">:</span>&nbsp;<span class="ident" id="8374279">syscall</span><span class="op" id="8374286">.</span><span class="ident" id="8374287">EADDRINUSE</span><span class="op" id="8374297">}</span><span class="op" id="8374298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8374301">{</span><span class="ident" id="8374302">net1</span><span class="op" id="8374306">:</span>&nbsp;<span class="string" id="8374308">&#34;tcp&#34;</span><span class="op" id="8374313">,</span>&nbsp;<span class="ident" id="8374315">laddr1</span><span class="op" id="8374321">:</span>&nbsp;<span class="string" id="8374323">&#34;0.0.0.0&#34;</span><span class="op" id="8374332">,</span>&nbsp;<span class="ident" id="8374334">net2</span><span class="op" id="8374338">:</span>&nbsp;<span class="string" id="8374340">&#34;tcp&#34;</span><span class="op" id="8374345">,</span>&nbsp;<span class="ident" id="8374347">laddr2</span><span class="op" id="8374353">:</span>&nbsp;<span class="string" id="8374355">&#34;[::]&#34;</span><span class="op" id="8374361">,</span>&nbsp;<span class="ident" id="8374363">wildcard</span><span class="op" id="8374371">:</span>&nbsp;<span class="builtintype" id="8374373">true</span><span class="op" id="8374377">,</span>&nbsp;<span class="ident" id="8374379">xerr</span><span class="op" id="8374383">:</span>&nbsp;<span class="ident" id="8374385">syscall</span><span class="op" id="8374392">.</span><span class="ident" id="8374393">EADDRINUSE</span><span class="op" id="8374403">}</span><span class="op" id="8374404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8374407">{</span><span class="ident" id="8374408">net1</span><span class="op" id="8374412">:</span>&nbsp;<span class="string" id="8374414">&#34;tcp&#34;</span><span class="op" id="8374419">,</span>&nbsp;<span class="ident" id="8374421">laddr1</span><span class="op" id="8374427">:</span>&nbsp;<span class="string" id="8374429">&#34;[::]&#34;</span><span class="op" id="8374435">,</span>&nbsp;<span class="ident" id="8374437">net2</span><span class="op" id="8374441">:</span>&nbsp;<span class="string" id="8374443">&#34;tcp&#34;</span><span class="op" id="8374448">,</span>&nbsp;<span class="ident" id="8374450">laddr2</span><span class="op" id="8374456">:</span>&nbsp;<span class="string" id="8374458">&#34;0.0.0.0&#34;</span><span class="op" id="8374467">,</span>&nbsp;<span class="ident" id="8374469">wildcard</span><span class="op" id="8374477">:</span>&nbsp;<span class="builtintype" id="8374479">true</span><span class="op" id="8374483">,</span>&nbsp;<span class="ident" id="8374485">xerr</span><span class="op" id="8374489">:</span>&nbsp;<span class="ident" id="8374491">syscall</span><span class="op" id="8374498">.</span><span class="ident" id="8374499">EADDRINUSE</span><span class="op" id="8374509">}</span><span class="op" id="8374510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8374513">{</span><span class="ident" id="8374514">net1</span><span class="op" id="8374518">:</span>&nbsp;<span class="string" id="8374520">&#34;tcp&#34;</span><span class="op" id="8374525">,</span>&nbsp;<span class="ident" id="8374527">laddr1</span><span class="op" id="8374533">:</span>&nbsp;<span class="string" id="8374535">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8374553">,</span>&nbsp;<span class="ident" id="8374555">net2</span><span class="op" id="8374559">:</span>&nbsp;<span class="string" id="8374561">&#34;tcp&#34;</span><span class="op" id="8374566">,</span>&nbsp;<span class="ident" id="8374568">laddr2</span><span class="op" id="8374574">:</span>&nbsp;<span class="string" id="8374576">&#34;[::]&#34;</span><span class="op" id="8374582">,</span>&nbsp;<span class="ident" id="8374584">wildcard</span><span class="op" id="8374592">:</span>&nbsp;<span class="builtintype" id="8374594">true</span><span class="op" id="8374598">,</span>&nbsp;<span class="ident" id="8374600">xerr</span><span class="op" id="8374604">:</span>&nbsp;<span class="ident" id="8374606">syscall</span><span class="op" id="8374613">.</span><span class="ident" id="8374614">EADDRINUSE</span><span class="op" id="8374624">}</span><span class="op" id="8374625">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8374628">{</span><span class="ident" id="8374629">net1</span><span class="op" id="8374633">:</span>&nbsp;<span class="string" id="8374635">&#34;tcp&#34;</span><span class="op" id="8374640">,</span>&nbsp;<span class="ident" id="8374642">laddr1</span><span class="op" id="8374648">:</span>&nbsp;<span class="string" id="8374650">&#34;[::]&#34;</span><span class="op" id="8374656">,</span>&nbsp;<span class="ident" id="8374658">net2</span><span class="op" id="8374662">:</span>&nbsp;<span class="string" id="8374664">&#34;tcp&#34;</span><span class="op" id="8374669">,</span>&nbsp;<span class="ident" id="8374671">laddr2</span><span class="op" id="8374677">:</span>&nbsp;<span class="string" id="8374679">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8374697">,</span>&nbsp;<span class="ident" id="8374699">wildcard</span><span class="op" id="8374707">:</span>&nbsp;<span class="builtintype" id="8374709">true</span><span class="op" id="8374713">,</span>&nbsp;<span class="ident" id="8374715">xerr</span><span class="op" id="8374719">:</span>&nbsp;<span class="ident" id="8374721">syscall</span><span class="op" id="8374728">.</span><span class="ident" id="8374729">EADDRINUSE</span><span class="op" id="8374739">}</span><span class="op" id="8374740">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8374744">{</span><span class="ident" id="8374745">net1</span><span class="op" id="8374749">:</span>&nbsp;<span class="string" id="8374751">&#34;tcp4&#34;</span><span class="op" id="8374757">,</span>&nbsp;<span class="ident" id="8374759">laddr1</span><span class="op" id="8374765">:</span>&nbsp;<span class="string" id="8374767">&#34;&#34;</span><span class="op" id="8374769">,</span>&nbsp;<span class="ident" id="8374771">net2</span><span class="op" id="8374775">:</span>&nbsp;<span class="string" id="8374777">&#34;tcp6&#34;</span><span class="op" id="8374783">,</span>&nbsp;<span class="ident" id="8374785">laddr2</span><span class="op" id="8374791">:</span>&nbsp;<span class="string" id="8374793">&#34;&#34;</span><span class="op" id="8374795">,</span>&nbsp;<span class="ident" id="8374797">wildcard</span><span class="op" id="8374805">:</span>&nbsp;<span class="builtintype" id="8374807">true</span><span class="op" id="8374811">}</span><span class="op" id="8374812">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8374815">{</span><span class="ident" id="8374816">net1</span><span class="op" id="8374820">:</span>&nbsp;<span class="string" id="8374822">&#34;tcp6&#34;</span><span class="op" id="8374828">,</span>&nbsp;<span class="ident" id="8374830">laddr1</span><span class="op" id="8374836">:</span>&nbsp;<span class="string" id="8374838">&#34;&#34;</span><span class="op" id="8374840">,</span>&nbsp;<span class="ident" id="8374842">net2</span><span class="op" id="8374846">:</span>&nbsp;<span class="string" id="8374848">&#34;tcp4&#34;</span><span class="op" id="8374854">,</span>&nbsp;<span class="ident" id="8374856">laddr2</span><span class="op" id="8374862">:</span>&nbsp;<span class="string" id="8374864">&#34;&#34;</span><span class="op" id="8374866">,</span>&nbsp;<span class="ident" id="8374868">wildcard</span><span class="op" id="8374876">:</span>&nbsp;<span class="builtintype" id="8374878">true</span><span class="op" id="8374882">}</span><span class="op" id="8374883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8374886">{</span><span class="ident" id="8374887">net1</span><span class="op" id="8374891">:</span>&nbsp;<span class="string" id="8374893">&#34;tcp4&#34;</span><span class="op" id="8374899">,</span>&nbsp;<span class="ident" id="8374901">laddr1</span><span class="op" id="8374907">:</span>&nbsp;<span class="string" id="8374909">&#34;0.0.0.0&#34;</span><span class="op" id="8374918">,</span>&nbsp;<span class="ident" id="8374920">net2</span><span class="op" id="8374924">:</span>&nbsp;<span class="string" id="8374926">&#34;tcp6&#34;</span><span class="op" id="8374932">,</span>&nbsp;<span class="ident" id="8374934">laddr2</span><span class="op" id="8374940">:</span>&nbsp;<span class="string" id="8374942">&#34;[::]&#34;</span><span class="op" id="8374948">,</span>&nbsp;<span class="ident" id="8374950">wildcard</span><span class="op" id="8374958">:</span>&nbsp;<span class="builtintype" id="8374960">true</span><span class="op" id="8374964">}</span><span class="op" id="8374965">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8374968">{</span><span class="ident" id="8374969">net1</span><span class="op" id="8374973">:</span>&nbsp;<span class="string" id="8374975">&#34;tcp6&#34;</span><span class="op" id="8374981">,</span>&nbsp;<span class="ident" id="8374983">laddr1</span><span class="op" id="8374989">:</span>&nbsp;<span class="string" id="8374991">&#34;[::]&#34;</span><span class="op" id="8374997">,</span>&nbsp;<span class="ident" id="8374999">net2</span><span class="op" id="8375003">:</span>&nbsp;<span class="string" id="8375005">&#34;tcp4&#34;</span><span class="op" id="8375011">,</span>&nbsp;<span class="ident" id="8375013">laddr2</span><span class="op" id="8375019">:</span>&nbsp;<span class="string" id="8375021">&#34;0.0.0.0&#34;</span><span class="op" id="8375030">,</span>&nbsp;<span class="ident" id="8375032">wildcard</span><span class="op" id="8375040">:</span>&nbsp;<span class="builtintype" id="8375042">true</span><span class="op" id="8375046">}</span><span class="op" id="8375047">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375051">{</span><span class="ident" id="8375052">net1</span><span class="op" id="8375056">:</span>&nbsp;<span class="string" id="8375058">&#34;tcp&#34;</span><span class="op" id="8375063">,</span>&nbsp;<span class="ident" id="8375065">laddr1</span><span class="op" id="8375071">:</span>&nbsp;<span class="string" id="8375073">&#34;127.0.0.1&#34;</span><span class="op" id="8375084">,</span>&nbsp;<span class="ident" id="8375086">net2</span><span class="op" id="8375090">:</span>&nbsp;<span class="string" id="8375092">&#34;tcp&#34;</span><span class="op" id="8375097">,</span>&nbsp;<span class="ident" id="8375099">laddr2</span><span class="op" id="8375105">:</span>&nbsp;<span class="string" id="8375107">&#34;[::1]&#34;</span><span class="op" id="8375114">}</span><span class="op" id="8375115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375118">{</span><span class="ident" id="8375119">net1</span><span class="op" id="8375123">:</span>&nbsp;<span class="string" id="8375125">&#34;tcp&#34;</span><span class="op" id="8375130">,</span>&nbsp;<span class="ident" id="8375132">laddr1</span><span class="op" id="8375138">:</span>&nbsp;<span class="string" id="8375140">&#34;[::1]&#34;</span><span class="op" id="8375147">,</span>&nbsp;<span class="ident" id="8375149">net2</span><span class="op" id="8375153">:</span>&nbsp;<span class="string" id="8375155">&#34;tcp&#34;</span><span class="op" id="8375160">,</span>&nbsp;<span class="ident" id="8375162">laddr2</span><span class="op" id="8375168">:</span>&nbsp;<span class="string" id="8375170">&#34;127.0.0.1&#34;</span><span class="op" id="8375181">}</span><span class="op" id="8375182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375185">{</span><span class="ident" id="8375186">net1</span><span class="op" id="8375190">:</span>&nbsp;<span class="string" id="8375192">&#34;tcp4&#34;</span><span class="op" id="8375198">,</span>&nbsp;<span class="ident" id="8375200">laddr1</span><span class="op" id="8375206">:</span>&nbsp;<span class="string" id="8375208">&#34;127.0.0.1&#34;</span><span class="op" id="8375219">,</span>&nbsp;<span class="ident" id="8375221">net2</span><span class="op" id="8375225">:</span>&nbsp;<span class="string" id="8375227">&#34;tcp6&#34;</span><span class="op" id="8375233">,</span>&nbsp;<span class="ident" id="8375235">laddr2</span><span class="op" id="8375241">:</span>&nbsp;<span class="string" id="8375243">&#34;[::1]&#34;</span><span class="op" id="8375250">}</span><span class="op" id="8375251">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375254">{</span><span class="ident" id="8375255">net1</span><span class="op" id="8375259">:</span>&nbsp;<span class="string" id="8375261">&#34;tcp6&#34;</span><span class="op" id="8375267">,</span>&nbsp;<span class="ident" id="8375269">laddr1</span><span class="op" id="8375275">:</span>&nbsp;<span class="string" id="8375277">&#34;[::1]&#34;</span><span class="op" id="8375284">,</span>&nbsp;<span class="ident" id="8375286">net2</span><span class="op" id="8375290">:</span>&nbsp;<span class="string" id="8375292">&#34;tcp4&#34;</span><span class="op" id="8375298">,</span>&nbsp;<span class="ident" id="8375300">laddr2</span><span class="op" id="8375306">:</span>&nbsp;<span class="string" id="8375308">&#34;127.0.0.1&#34;</span><span class="op" id="8375319">}</span><span class="op" id="8375320">,</span><br>
<span class="lineno"></span><span class="op" id="8375322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8375325">//&nbsp;TestDualStackTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="8375389">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;different</span><br>
<span class="lineno">170</span><span class="comment" id="8375452">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="8375488">func</span>&nbsp;<span class="ident" id="8375493">TestDualStackTCPListener</span><span class="op" id="8375517">(</span><span class="ident" id="8375518">t</span>&nbsp;<span class="op" id="8375520">*</span><span class="ident" id="8375521">testing</span><span class="op" id="8375528">.</span><span class="ident" id="8375529">T</span><span class="op" id="8375530">)</span>&nbsp;<span class="op" id="8375532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375535">if</span>&nbsp;<span class="ident" id="8375538">testing</span><span class="op" id="8375545">.</span><span class="ident" id="8375546">Short</span><span class="op" id="8375551">(</span><span class="op" id="8375552">)</span>&nbsp;<span class="op" id="8375554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8375558">t</span><span class="op" id="8375559">.</span><span class="ident" id="8375560">Skip</span><span class="op" id="8375564">(</span><span class="string" id="8375565">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="8375606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375609">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375612">switch</span>&nbsp;<span class="ident" id="8375619">runtime</span><span class="op" id="8375626">.</span><span class="ident" id="8375627">GOOS</span>&nbsp;<span class="op" id="8375632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375635">case</span>&nbsp;<span class="string" id="8375640">&#34;plan9&#34;</span><span class="op" id="8375647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8375651">t</span><span class="op" id="8375652">.</span><span class="ident" id="8375653">Skipf</span><span class="op" id="8375658">(</span><span class="string" id="8375659">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8375680">,</span>&nbsp;<span class="ident" id="8375682">runtime</span><span class="op" id="8375689">.</span><span class="ident" id="8375690">GOOS</span><span class="op" id="8375694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375700">if</span>&nbsp;<span class="op" id="8375703">!</span><span class="ident" id="8375704">supportsIPv6</span>&nbsp;<span class="op" id="8375717">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8375721">t</span><span class="op" id="8375722">.</span><span class="ident" id="8375723">Skip</span><span class="op" id="8375727">(</span><span class="string" id="8375728">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8375751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375758">for</span>&nbsp;<span class="ident" id="8375762">_</span><span class="op" id="8375763">,</span>&nbsp;<span class="ident" id="8375765">tt</span>&nbsp;<span class="op" id="8375768">:=</span>&nbsp;<span class="keyword" id="8375771">range</span>&nbsp;<span class="ident" id="8375777">dualStackListenerTests</span>&nbsp;<span class="op" id="8375800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375804">if</span>&nbsp;<span class="ident" id="8375807">tt</span><span class="op" id="8375809">.</span><span class="ident" id="8375810">wildcard</span>&nbsp;<span class="op" id="8375819">&amp;&amp;</span>&nbsp;<span class="op" id="8375822">!</span><span class="op" id="8375823">*</span><span class="ident" id="8375824">testExternal</span>&nbsp;<span class="op" id="8375837">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375842">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375857">switch</span>&nbsp;<span class="ident" id="8375864">runtime</span><span class="op" id="8375871">.</span><span class="ident" id="8375872">GOOS</span>&nbsp;<span class="op" id="8375877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375881">case</span>&nbsp;<span class="string" id="8375886">&#34;openbsd&#34;</span><span class="op" id="8375895">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8375900">if</span>&nbsp;<span class="ident" id="8375903">tt</span><span class="op" id="8375905">.</span><span class="ident" id="8375906">wildcard</span>&nbsp;<span class="op" id="8375915">&amp;&amp;</span>&nbsp;<span class="ident" id="8375918">differentWildcardAddr</span><span class="op" id="8375939">(</span><span class="ident" id="8375940">tt</span><span class="op" id="8375942">.</span><span class="ident" id="8375943">laddr1</span><span class="op" id="8375949">,</span>&nbsp;<span class="ident" id="8375951">tt</span><span class="op" id="8375953">.</span><span class="ident" id="8375954">laddr2</span><span class="op" id="8375960">)</span>&nbsp;<span class="op" id="8375962">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8375968">tt</span><span class="op" id="8375970">.</span><span class="ident" id="8375971">xerr</span>&nbsp;<span class="op" id="8375976">=</span>&nbsp;<span class="ident" id="8375978">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8375989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8375993">l1</span><span class="op" id="8375995">,</span>&nbsp;<span class="ident" id="8375997">port</span>&nbsp;<span class="op" id="8376002">:=</span>&nbsp;<span class="ident" id="8376005">usableListenPort</span><span class="op" id="8376021">(</span><span class="ident" id="8376022">t</span><span class="op" id="8376023">,</span>&nbsp;<span class="ident" id="8376025">tt</span><span class="op" id="8376027">.</span><span class="ident" id="8376028">net1</span><span class="op" id="8376032">,</span>&nbsp;<span class="ident" id="8376034">tt</span><span class="op" id="8376036">.</span><span class="ident" id="8376037">laddr1</span><span class="op" id="8376043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376047">laddr</span>&nbsp;<span class="op" id="8376053">:=</span>&nbsp;<span class="ident" id="8376056">tt</span><span class="op" id="8376058">.</span><span class="ident" id="8376059">laddr1</span>&nbsp;<span class="op" id="8376066">+</span>&nbsp;<span class="string" id="8376068">&#34;:&#34;</span>&nbsp;<span class="op" id="8376072">+</span>&nbsp;<span class="ident" id="8376074">port</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376081">checkFirstListener</span><span class="op" id="8376099">(</span><span class="ident" id="8376100">t</span><span class="op" id="8376101">,</span>&nbsp;<span class="ident" id="8376103">tt</span><span class="op" id="8376105">.</span><span class="ident" id="8376106">net1</span><span class="op" id="8376110">,</span>&nbsp;<span class="ident" id="8376112">laddr</span><span class="op" id="8376117">,</span>&nbsp;<span class="ident" id="8376119">l1</span><span class="op" id="8376121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376125">laddr</span>&nbsp;<span class="op" id="8376131">=</span>&nbsp;<span class="ident" id="8376133">tt</span><span class="op" id="8376135">.</span><span class="ident" id="8376136">laddr2</span>&nbsp;<span class="op" id="8376143">+</span>&nbsp;<span class="string" id="8376145">&#34;:&#34;</span>&nbsp;<span class="op" id="8376149">+</span>&nbsp;<span class="ident" id="8376151">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376158">l2</span><span class="op" id="8376160">,</span>&nbsp;<span class="ident" id="8376162">err</span>&nbsp;<span class="op" id="8376166">:=</span>&nbsp;<span class="ident" id="8376169">Listen</span><span class="op" id="8376175">(</span><span class="ident" id="8376176">tt</span><span class="op" id="8376178">.</span><span class="ident" id="8376179">net2</span><span class="op" id="8376183">,</span>&nbsp;<span class="ident" id="8376185">laddr</span><span class="op" id="8376190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376194">checkDualStackSecondListener</span><span class="op" id="8376222">(</span><span class="ident" id="8376223">t</span><span class="op" id="8376224">,</span>&nbsp;<span class="ident" id="8376226">tt</span><span class="op" id="8376228">.</span><span class="ident" id="8376229">net2</span><span class="op" id="8376233">,</span>&nbsp;<span class="ident" id="8376235">laddr</span><span class="op" id="8376240">,</span>&nbsp;<span class="ident" id="8376242">tt</span><span class="op" id="8376244">.</span><span class="ident" id="8376245">xerr</span><span class="op" id="8376249">,</span>&nbsp;<span class="ident" id="8376251">err</span><span class="op" id="8376254">,</span>&nbsp;<span class="ident" id="8376256">l2</span><span class="op" id="8376258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376262">l1</span><span class="op" id="8376264">.</span><span class="ident" id="8376265">Close</span><span class="op" id="8376270">(</span><span class="op" id="8376271">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8376274">}</span><br>
<span class="lineno"></span><span class="op" id="8376276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8376279">//&nbsp;TestDualStackUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="8376343">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;differnet</span><br>
<span class="lineno">205</span><span class="comment" id="8376406">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="8376442">func</span>&nbsp;<span class="ident" id="8376447">TestDualStackUDPListener</span><span class="op" id="8376471">(</span><span class="ident" id="8376472">t</span>&nbsp;<span class="op" id="8376474">*</span><span class="ident" id="8376475">testing</span><span class="op" id="8376482">.</span><span class="ident" id="8376483">T</span><span class="op" id="8376484">)</span>&nbsp;<span class="op" id="8376486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376489">if</span>&nbsp;<span class="ident" id="8376492">testing</span><span class="op" id="8376499">.</span><span class="ident" id="8376500">Short</span><span class="op" id="8376505">(</span><span class="op" id="8376506">)</span>&nbsp;<span class="op" id="8376508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376512">t</span><span class="op" id="8376513">.</span><span class="ident" id="8376514">Skip</span><span class="op" id="8376518">(</span><span class="string" id="8376519">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="8376560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8376563">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376566">switch</span>&nbsp;<span class="ident" id="8376573">runtime</span><span class="op" id="8376580">.</span><span class="ident" id="8376581">GOOS</span>&nbsp;<span class="op" id="8376586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376589">case</span>&nbsp;<span class="string" id="8376594">&#34;plan9&#34;</span><span class="op" id="8376601">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376605">t</span><span class="op" id="8376606">.</span><span class="ident" id="8376607">Skipf</span><span class="op" id="8376612">(</span><span class="string" id="8376613">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8376634">,</span>&nbsp;<span class="ident" id="8376636">runtime</span><span class="op" id="8376643">.</span><span class="ident" id="8376644">GOOS</span><span class="op" id="8376648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8376651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376654">if</span>&nbsp;<span class="op" id="8376657">!</span><span class="ident" id="8376658">supportsIPv6</span>&nbsp;<span class="op" id="8376671">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376675">t</span><span class="op" id="8376676">.</span><span class="ident" id="8376677">Skip</span><span class="op" id="8376681">(</span><span class="string" id="8376682">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8376705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8376708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8376712">toudpnet</span>&nbsp;<span class="op" id="8376721">:=</span>&nbsp;<span class="keyword" id="8376724">func</span><span class="op" id="8376728">(</span><span class="ident" id="8376729">net</span>&nbsp;<span class="builtintype" id="8376733">string</span><span class="op" id="8376739">)</span>&nbsp;<span class="builtintype" id="8376741">string</span>&nbsp;<span class="op" id="8376748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376752">switch</span>&nbsp;<span class="ident" id="8376759">net</span>&nbsp;<span class="op" id="8376763">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376767">case</span>&nbsp;<span class="string" id="8376772">&#34;tcp&#34;</span><span class="op" id="8376777">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376782">return</span>&nbsp;<span class="string" id="8376789">&#34;udp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376797">case</span>&nbsp;<span class="string" id="8376802">&#34;tcp4&#34;</span><span class="op" id="8376808">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376813">return</span>&nbsp;<span class="string" id="8376820">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376829">case</span>&nbsp;<span class="string" id="8376834">&#34;tcp6&#34;</span><span class="op" id="8376840">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376845">return</span>&nbsp;<span class="string" id="8376852">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8376861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376865">return</span>&nbsp;<span class="string" id="8376872">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8376881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376885">for</span>&nbsp;<span class="ident" id="8376889">_</span><span class="op" id="8376890">,</span>&nbsp;<span class="ident" id="8376892">tt</span>&nbsp;<span class="op" id="8376895">:=</span>&nbsp;<span class="keyword" id="8376898">range</span>&nbsp;<span class="ident" id="8376904">dualStackListenerTests</span>&nbsp;<span class="op" id="8376927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376931">if</span>&nbsp;<span class="ident" id="8376934">tt</span><span class="op" id="8376936">.</span><span class="ident" id="8376937">wildcard</span>&nbsp;<span class="op" id="8376946">&amp;&amp;</span>&nbsp;<span class="op" id="8376949">(</span><span class="ident" id="8376950">testing</span><span class="op" id="8376957">.</span><span class="ident" id="8376958">Short</span><span class="op" id="8376963">(</span><span class="op" id="8376964">)</span>&nbsp;<span class="op" id="8376966">||</span>&nbsp;<span class="op" id="8376969">!</span><span class="op" id="8376970">*</span><span class="ident" id="8376971">testExternal</span><span class="op" id="8376983">)</span>&nbsp;<span class="op" id="8376985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8376990">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8377001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377005">tt</span><span class="op" id="8377007">.</span><span class="ident" id="8377008">net1</span>&nbsp;<span class="op" id="8377013">=</span>&nbsp;<span class="ident" id="8377015">toudpnet</span><span class="op" id="8377023">(</span><span class="ident" id="8377024">tt</span><span class="op" id="8377026">.</span><span class="ident" id="8377027">net1</span><span class="op" id="8377031">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377035">tt</span><span class="op" id="8377037">.</span><span class="ident" id="8377038">net2</span>&nbsp;<span class="op" id="8377043">=</span>&nbsp;<span class="ident" id="8377045">toudpnet</span><span class="op" id="8377053">(</span><span class="ident" id="8377054">tt</span><span class="op" id="8377056">.</span><span class="ident" id="8377057">net2</span><span class="op" id="8377061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377065">switch</span>&nbsp;<span class="ident" id="8377072">runtime</span><span class="op" id="8377079">.</span><span class="ident" id="8377080">GOOS</span>&nbsp;<span class="op" id="8377085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377089">case</span>&nbsp;<span class="string" id="8377094">&#34;openbsd&#34;</span><span class="op" id="8377103">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377108">if</span>&nbsp;<span class="ident" id="8377111">tt</span><span class="op" id="8377113">.</span><span class="ident" id="8377114">wildcard</span>&nbsp;<span class="op" id="8377123">&amp;&amp;</span>&nbsp;<span class="ident" id="8377126">differentWildcardAddr</span><span class="op" id="8377147">(</span><span class="ident" id="8377148">tt</span><span class="op" id="8377150">.</span><span class="ident" id="8377151">laddr1</span><span class="op" id="8377157">,</span>&nbsp;<span class="ident" id="8377159">tt</span><span class="op" id="8377161">.</span><span class="ident" id="8377162">laddr2</span><span class="op" id="8377168">)</span>&nbsp;<span class="op" id="8377170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377176">tt</span><span class="op" id="8377178">.</span><span class="ident" id="8377179">xerr</span>&nbsp;<span class="op" id="8377184">=</span>&nbsp;<span class="ident" id="8377186">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8377193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8377197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377201">l1</span><span class="op" id="8377203">,</span>&nbsp;<span class="ident" id="8377205">port</span>&nbsp;<span class="op" id="8377210">:=</span>&nbsp;<span class="ident" id="8377213">usableListenPacketPort</span><span class="op" id="8377235">(</span><span class="ident" id="8377236">t</span><span class="op" id="8377237">,</span>&nbsp;<span class="ident" id="8377239">tt</span><span class="op" id="8377241">.</span><span class="ident" id="8377242">net1</span><span class="op" id="8377246">,</span>&nbsp;<span class="ident" id="8377248">tt</span><span class="op" id="8377250">.</span><span class="ident" id="8377251">laddr1</span><span class="op" id="8377257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377261">laddr</span>&nbsp;<span class="op" id="8377267">:=</span>&nbsp;<span class="ident" id="8377270">tt</span><span class="op" id="8377272">.</span><span class="ident" id="8377273">laddr1</span>&nbsp;<span class="op" id="8377280">+</span>&nbsp;<span class="string" id="8377282">&#34;:&#34;</span>&nbsp;<span class="op" id="8377286">+</span>&nbsp;<span class="ident" id="8377288">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377295">checkFirstListener</span><span class="op" id="8377313">(</span><span class="ident" id="8377314">t</span><span class="op" id="8377315">,</span>&nbsp;<span class="ident" id="8377317">tt</span><span class="op" id="8377319">.</span><span class="ident" id="8377320">net1</span><span class="op" id="8377324">,</span>&nbsp;<span class="ident" id="8377326">laddr</span><span class="op" id="8377331">,</span>&nbsp;<span class="ident" id="8377333">l1</span><span class="op" id="8377335">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377339">laddr</span>&nbsp;<span class="op" id="8377345">=</span>&nbsp;<span class="ident" id="8377347">tt</span><span class="op" id="8377349">.</span><span class="ident" id="8377350">laddr2</span>&nbsp;<span class="op" id="8377357">+</span>&nbsp;<span class="string" id="8377359">&#34;:&#34;</span>&nbsp;<span class="op" id="8377363">+</span>&nbsp;<span class="ident" id="8377365">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377372">l2</span><span class="op" id="8377374">,</span>&nbsp;<span class="ident" id="8377376">err</span>&nbsp;<span class="op" id="8377380">:=</span>&nbsp;<span class="ident" id="8377383">ListenPacket</span><span class="op" id="8377395">(</span><span class="ident" id="8377396">tt</span><span class="op" id="8377398">.</span><span class="ident" id="8377399">net2</span><span class="op" id="8377403">,</span>&nbsp;<span class="ident" id="8377405">laddr</span><span class="op" id="8377410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377414">checkDualStackSecondListener</span><span class="op" id="8377442">(</span><span class="ident" id="8377443">t</span><span class="op" id="8377444">,</span>&nbsp;<span class="ident" id="8377446">tt</span><span class="op" id="8377448">.</span><span class="ident" id="8377449">net2</span><span class="op" id="8377453">,</span>&nbsp;<span class="ident" id="8377455">laddr</span><span class="op" id="8377460">,</span>&nbsp;<span class="ident" id="8377462">tt</span><span class="op" id="8377464">.</span><span class="ident" id="8377465">xerr</span><span class="op" id="8377469">,</span>&nbsp;<span class="ident" id="8377471">err</span><span class="op" id="8377474">,</span>&nbsp;<span class="ident" id="8377476">l2</span><span class="op" id="8377478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377482">l1</span><span class="op" id="8377484">.</span><span class="ident" id="8377485">Close</span><span class="op" id="8377490">(</span><span class="op" id="8377491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8377494">}</span><br>
<span class="lineno">250</span><span class="op" id="8377496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8377499">func</span>&nbsp;<span class="ident" id="8377504">usableListenPort</span><span class="op" id="8377520">(</span><span class="ident" id="8377521">t</span>&nbsp;<span class="op" id="8377523">*</span><span class="ident" id="8377524">testing</span><span class="op" id="8377531">.</span><span class="ident" id="8377532">T</span><span class="op" id="8377533">,</span>&nbsp;<span class="ident" id="8377535">net</span><span class="op" id="8377538">,</span>&nbsp;<span class="ident" id="8377540">laddr</span>&nbsp;<span class="builtintype" id="8377546">string</span><span class="op" id="8377552">)</span>&nbsp;<span class="op" id="8377554">(</span><span class="ident" id="8377555">l</span>&nbsp;<span class="ident" id="8377557">Listener</span><span class="op" id="8377565">,</span>&nbsp;<span class="ident" id="8377567">port</span>&nbsp;<span class="builtintype" id="8377572">string</span><span class="op" id="8377578">)</span>&nbsp;<span class="op" id="8377580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377583">var</span>&nbsp;<span class="ident" id="8377587">nladdr</span>&nbsp;<span class="builtintype" id="8377594">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377602">var</span>&nbsp;<span class="ident" id="8377606">err</span>&nbsp;<span class="builtintype" id="8377610">error</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377617">switch</span>&nbsp;<span class="ident" id="8377624">net</span>&nbsp;<span class="op" id="8377628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377631">default</span><span class="op" id="8377638">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8377642">panic</span><span class="op" id="8377647">(</span><span class="string" id="8377648">&#34;usableListenPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="8377672">+</span>&nbsp;<span class="ident" id="8377674">net</span><span class="op" id="8377677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377680">case</span>&nbsp;<span class="string" id="8377685">&#34;tcp&#34;</span><span class="op" id="8377690">,</span>&nbsp;<span class="string" id="8377692">&#34;tcp4&#34;</span><span class="op" id="8377698">,</span>&nbsp;<span class="string" id="8377700">&#34;tcp6&#34;</span><span class="op" id="8377706">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377710">l</span><span class="op" id="8377711">,</span>&nbsp;<span class="ident" id="8377713">err</span>&nbsp;<span class="op" id="8377717">=</span>&nbsp;<span class="ident" id="8377719">Listen</span><span class="op" id="8377725">(</span><span class="ident" id="8377726">net</span><span class="op" id="8377729">,</span>&nbsp;<span class="ident" id="8377731">laddr</span><span class="op" id="8377736">+</span><span class="string" id="8377737">&#34;:0&#34;</span><span class="op" id="8377741">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377745">if</span>&nbsp;<span class="ident" id="8377748">err</span>&nbsp;<span class="op" id="8377752">!=</span>&nbsp;<span class="ident" id="8377755">nil</span>&nbsp;<span class="op" id="8377759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377764">t</span><span class="op" id="8377765">.</span><span class="ident" id="8377766">Fatalf</span><span class="op" id="8377772">(</span><span class="string" id="8377773">&#34;Probe&nbsp;Listen(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8377806">,</span>&nbsp;<span class="ident" id="8377808">net</span><span class="op" id="8377811">,</span>&nbsp;<span class="ident" id="8377813">laddr</span><span class="op" id="8377818">,</span>&nbsp;<span class="ident" id="8377820">err</span><span class="op" id="8377823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8377827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377831">nladdr</span>&nbsp;<span class="op" id="8377838">=</span>&nbsp;<span class="ident" id="8377840">l</span><span class="op" id="8377841">.</span><span class="op" id="8377842">(</span><span class="op" id="8377843">*</span><span class="ident" id="8377844">TCPListener</span><span class="op" id="8377855">)</span><span class="op" id="8377856">.</span><span class="ident" id="8377857">Addr</span><span class="op" id="8377861">(</span><span class="op" id="8377862">)</span><span class="op" id="8377863">.</span><span class="ident" id="8377864">String</span><span class="op" id="8377870">(</span><span class="op" id="8377871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8377874">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377877">_</span><span class="op" id="8377878">,</span>&nbsp;<span class="ident" id="8377880">port</span><span class="op" id="8377884">,</span>&nbsp;<span class="ident" id="8377886">err</span>&nbsp;<span class="op" id="8377890">=</span>&nbsp;<span class="ident" id="8377892">SplitHostPort</span><span class="op" id="8377905">(</span><span class="ident" id="8377906">nladdr</span><span class="op" id="8377912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377915">if</span>&nbsp;<span class="ident" id="8377918">err</span>&nbsp;<span class="op" id="8377922">!=</span>&nbsp;<span class="ident" id="8377925">nil</span>&nbsp;<span class="op" id="8377929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8377933">t</span><span class="op" id="8377934">.</span><span class="ident" id="8377935">Fatalf</span><span class="op" id="8377941">(</span><span class="string" id="8377942">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8377968">,</span>&nbsp;<span class="ident" id="8377970">err</span><span class="op" id="8377973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8377976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8377979">return</span>&nbsp;<span class="ident" id="8377986">l</span><span class="op" id="8377987">,</span>&nbsp;<span class="ident" id="8377989">port</span><br>
<span class="lineno">270</span><span class="op" id="8377994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8377997">func</span>&nbsp;<span class="ident" id="8378002">usableListenPacketPort</span><span class="op" id="8378024">(</span><span class="ident" id="8378025">t</span>&nbsp;<span class="op" id="8378027">*</span><span class="ident" id="8378028">testing</span><span class="op" id="8378035">.</span><span class="ident" id="8378036">T</span><span class="op" id="8378037">,</span>&nbsp;<span class="ident" id="8378039">net</span><span class="op" id="8378042">,</span>&nbsp;<span class="ident" id="8378044">laddr</span>&nbsp;<span class="builtintype" id="8378050">string</span><span class="op" id="8378056">)</span>&nbsp;<span class="op" id="8378058">(</span><span class="ident" id="8378059">l</span>&nbsp;<span class="ident" id="8378061">PacketConn</span><span class="op" id="8378071">,</span>&nbsp;<span class="ident" id="8378073">port</span>&nbsp;<span class="builtintype" id="8378078">string</span><span class="op" id="8378084">)</span>&nbsp;<span class="op" id="8378086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378089">var</span>&nbsp;<span class="ident" id="8378093">nladdr</span>&nbsp;<span class="builtintype" id="8378100">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378108">var</span>&nbsp;<span class="ident" id="8378112">err</span>&nbsp;<span class="builtintype" id="8378116">error</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378123">switch</span>&nbsp;<span class="ident" id="8378130">net</span>&nbsp;<span class="op" id="8378134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378137">default</span><span class="op" id="8378144">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8378148">panic</span><span class="op" id="8378153">(</span><span class="string" id="8378154">&#34;usableListenPacketPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="8378184">+</span>&nbsp;<span class="ident" id="8378186">net</span><span class="op" id="8378189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378192">case</span>&nbsp;<span class="string" id="8378197">&#34;udp&#34;</span><span class="op" id="8378202">,</span>&nbsp;<span class="string" id="8378204">&#34;udp4&#34;</span><span class="op" id="8378210">,</span>&nbsp;<span class="string" id="8378212">&#34;udp6&#34;</span><span class="op" id="8378218">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378222">l</span><span class="op" id="8378223">,</span>&nbsp;<span class="ident" id="8378225">err</span>&nbsp;<span class="op" id="8378229">=</span>&nbsp;<span class="ident" id="8378231">ListenPacket</span><span class="op" id="8378243">(</span><span class="ident" id="8378244">net</span><span class="op" id="8378247">,</span>&nbsp;<span class="ident" id="8378249">laddr</span><span class="op" id="8378254">+</span><span class="string" id="8378255">&#34;:0&#34;</span><span class="op" id="8378259">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378263">if</span>&nbsp;<span class="ident" id="8378266">err</span>&nbsp;<span class="op" id="8378270">!=</span>&nbsp;<span class="ident" id="8378273">nil</span>&nbsp;<span class="op" id="8378277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378282">t</span><span class="op" id="8378283">.</span><span class="ident" id="8378284">Fatalf</span><span class="op" id="8378290">(</span><span class="string" id="8378291">&#34;Probe&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8378330">,</span>&nbsp;<span class="ident" id="8378332">net</span><span class="op" id="8378335">,</span>&nbsp;<span class="ident" id="8378337">laddr</span><span class="op" id="8378342">,</span>&nbsp;<span class="ident" id="8378344">err</span><span class="op" id="8378347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8378351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378355">nladdr</span>&nbsp;<span class="op" id="8378362">=</span>&nbsp;<span class="ident" id="8378364">l</span><span class="op" id="8378365">.</span><span class="op" id="8378366">(</span><span class="op" id="8378367">*</span><span class="ident" id="8378368">UDPConn</span><span class="op" id="8378375">)</span><span class="op" id="8378376">.</span><span class="ident" id="8378377">LocalAddr</span><span class="op" id="8378386">(</span><span class="op" id="8378387">)</span><span class="op" id="8378388">.</span><span class="ident" id="8378389">String</span><span class="op" id="8378395">(</span><span class="op" id="8378396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8378399">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378402">_</span><span class="op" id="8378403">,</span>&nbsp;<span class="ident" id="8378405">port</span><span class="op" id="8378409">,</span>&nbsp;<span class="ident" id="8378411">err</span>&nbsp;<span class="op" id="8378415">=</span>&nbsp;<span class="ident" id="8378417">SplitHostPort</span><span class="op" id="8378430">(</span><span class="ident" id="8378431">nladdr</span><span class="op" id="8378437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378440">if</span>&nbsp;<span class="ident" id="8378443">err</span>&nbsp;<span class="op" id="8378447">!=</span>&nbsp;<span class="ident" id="8378450">nil</span>&nbsp;<span class="op" id="8378454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378458">t</span><span class="op" id="8378459">.</span><span class="ident" id="8378460">Fatalf</span><span class="op" id="8378466">(</span><span class="string" id="8378467">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8378493">,</span>&nbsp;<span class="ident" id="8378495">err</span><span class="op" id="8378498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8378501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378504">return</span>&nbsp;<span class="ident" id="8378511">l</span><span class="op" id="8378512">,</span>&nbsp;<span class="ident" id="8378514">port</span><br>
<span class="lineno">290</span><span class="op" id="8378519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8378522">func</span>&nbsp;<span class="ident" id="8378527">differentWildcardAddr</span><span class="op" id="8378548">(</span><span class="ident" id="8378549">i</span><span class="op" id="8378550">,</span>&nbsp;<span class="ident" id="8378552">j</span>&nbsp;<span class="builtintype" id="8378554">string</span><span class="op" id="8378560">)</span>&nbsp;<span class="builtintype" id="8378562">bool</span>&nbsp;<span class="op" id="8378567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378570">if</span>&nbsp;<span class="op" id="8378573">(</span><span class="ident" id="8378574">i</span>&nbsp;<span class="op" id="8378576">==</span>&nbsp;<span class="string" id="8378579">&#34;&#34;</span>&nbsp;<span class="op" id="8378582">||</span>&nbsp;<span class="ident" id="8378585">i</span>&nbsp;<span class="op" id="8378587">==</span>&nbsp;<span class="string" id="8378590">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="8378600">||</span>&nbsp;<span class="ident" id="8378603">i</span>&nbsp;<span class="op" id="8378605">==</span>&nbsp;<span class="string" id="8378608">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="8378624">)</span>&nbsp;<span class="op" id="8378626">&amp;&amp;</span>&nbsp;<span class="op" id="8378629">(</span><span class="ident" id="8378630">j</span>&nbsp;<span class="op" id="8378632">==</span>&nbsp;<span class="string" id="8378635">&#34;&#34;</span>&nbsp;<span class="op" id="8378638">||</span>&nbsp;<span class="ident" id="8378641">j</span>&nbsp;<span class="op" id="8378643">==</span>&nbsp;<span class="string" id="8378646">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="8378656">||</span>&nbsp;<span class="ident" id="8378659">j</span>&nbsp;<span class="op" id="8378661">==</span>&nbsp;<span class="string" id="8378664">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="8378680">)</span>&nbsp;<span class="op" id="8378682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378686">return</span>&nbsp;<span class="builtintype" id="8378693">false</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8378700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378703">if</span>&nbsp;<span class="ident" id="8378706">i</span>&nbsp;<span class="op" id="8378708">==</span>&nbsp;<span class="string" id="8378711">&#34;[::]&#34;</span>&nbsp;<span class="op" id="8378718">&amp;&amp;</span>&nbsp;<span class="ident" id="8378721">j</span>&nbsp;<span class="op" id="8378723">==</span>&nbsp;<span class="string" id="8378726">&#34;[::]&#34;</span>&nbsp;<span class="op" id="8378733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378737">return</span>&nbsp;<span class="builtintype" id="8378744">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8378751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378754">return</span>&nbsp;<span class="builtintype" id="8378761">true</span><br>
<span class="lineno">300</span><span class="op" id="8378766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8378769">func</span>&nbsp;<span class="ident" id="8378774">checkFirstListener</span><span class="op" id="8378792">(</span><span class="ident" id="8378793">t</span>&nbsp;<span class="op" id="8378795">*</span><span class="ident" id="8378796">testing</span><span class="op" id="8378803">.</span><span class="ident" id="8378804">T</span><span class="op" id="8378805">,</span>&nbsp;<span class="ident" id="8378807">net</span><span class="op" id="8378810">,</span>&nbsp;<span class="ident" id="8378812">laddr</span>&nbsp;<span class="builtintype" id="8378818">string</span><span class="op" id="8378824">,</span>&nbsp;<span class="ident" id="8378826">l</span>&nbsp;<span class="keyword" id="8378828">interface</span><span class="op" id="8378837">{</span><span class="op" id="8378838">}</span><span class="op" id="8378839">)</span>&nbsp;<span class="op" id="8378841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378844">switch</span>&nbsp;<span class="ident" id="8378851">net</span>&nbsp;<span class="op" id="8378855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378858">case</span>&nbsp;<span class="string" id="8378863">&#34;tcp&#34;</span><span class="op" id="8378868">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378872">fd</span>&nbsp;<span class="op" id="8378875">:=</span>&nbsp;<span class="ident" id="8378878">l</span><span class="op" id="8378879">.</span><span class="op" id="8378880">(</span><span class="op" id="8378881">*</span><span class="ident" id="8378882">TCPListener</span><span class="op" id="8378893">)</span><span class="op" id="8378894">.</span><span class="ident" id="8378895">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378900">checkDualStackAddrFamily</span><span class="op" id="8378924">(</span><span class="ident" id="8378925">t</span><span class="op" id="8378926">,</span>&nbsp;<span class="ident" id="8378928">net</span><span class="op" id="8378931">,</span>&nbsp;<span class="ident" id="8378933">laddr</span><span class="op" id="8378938">,</span>&nbsp;<span class="ident" id="8378940">fd</span><span class="op" id="8378942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378945">case</span>&nbsp;<span class="string" id="8378950">&#34;tcp4&#34;</span><span class="op" id="8378956">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8378960">fd</span>&nbsp;<span class="op" id="8378963">:=</span>&nbsp;<span class="ident" id="8378966">l</span><span class="op" id="8378967">.</span><span class="op" id="8378968">(</span><span class="op" id="8378969">*</span><span class="ident" id="8378970">TCPListener</span><span class="op" id="8378981">)</span><span class="op" id="8378982">.</span><span class="ident" id="8378983">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8378988">if</span>&nbsp;<span class="ident" id="8378991">fd</span><span class="op" id="8378993">.</span><span class="ident" id="8378994">family</span>&nbsp;<span class="op" id="8379001">!=</span>&nbsp;<span class="ident" id="8379004">syscall</span><span class="op" id="8379011">.</span><span class="ident" id="8379012">AF_INET</span>&nbsp;<span class="op" id="8379020">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379025">t</span><span class="op" id="8379026">.</span><span class="ident" id="8379027">Fatalf</span><span class="op" id="8379033">(</span><span class="string" id="8379034">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8379095">,</span>&nbsp;<span class="ident" id="8379097">net</span><span class="op" id="8379100">,</span>&nbsp;<span class="ident" id="8379102">laddr</span><span class="op" id="8379107">,</span>&nbsp;<span class="ident" id="8379109">fd</span><span class="op" id="8379111">.</span><span class="ident" id="8379112">family</span><span class="op" id="8379118">,</span>&nbsp;<span class="ident" id="8379120">syscall</span><span class="op" id="8379127">.</span><span class="ident" id="8379128">AF_INET</span><span class="op" id="8379135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8379139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379142">case</span>&nbsp;<span class="string" id="8379147">&#34;tcp6&#34;</span><span class="op" id="8379153">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379157">fd</span>&nbsp;<span class="op" id="8379160">:=</span>&nbsp;<span class="ident" id="8379163">l</span><span class="op" id="8379164">.</span><span class="op" id="8379165">(</span><span class="op" id="8379166">*</span><span class="ident" id="8379167">TCPListener</span><span class="op" id="8379178">)</span><span class="op" id="8379179">.</span><span class="ident" id="8379180">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379185">if</span>&nbsp;<span class="ident" id="8379188">fd</span><span class="op" id="8379190">.</span><span class="ident" id="8379191">family</span>&nbsp;<span class="op" id="8379198">!=</span>&nbsp;<span class="ident" id="8379201">syscall</span><span class="op" id="8379208">.</span><span class="ident" id="8379209">AF_INET6</span>&nbsp;<span class="op" id="8379218">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379223">t</span><span class="op" id="8379224">.</span><span class="ident" id="8379225">Fatalf</span><span class="op" id="8379231">(</span><span class="string" id="8379232">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8379293">,</span>&nbsp;<span class="ident" id="8379295">net</span><span class="op" id="8379298">,</span>&nbsp;<span class="ident" id="8379300">laddr</span><span class="op" id="8379305">,</span>&nbsp;<span class="ident" id="8379307">fd</span><span class="op" id="8379309">.</span><span class="ident" id="8379310">family</span><span class="op" id="8379316">,</span>&nbsp;<span class="ident" id="8379318">syscall</span><span class="op" id="8379325">.</span><span class="ident" id="8379326">AF_INET6</span><span class="op" id="8379334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8379338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379341">case</span>&nbsp;<span class="string" id="8379346">&#34;udp&#34;</span><span class="op" id="8379351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379355">fd</span>&nbsp;<span class="op" id="8379358">:=</span>&nbsp;<span class="ident" id="8379361">l</span><span class="op" id="8379362">.</span><span class="op" id="8379363">(</span><span class="op" id="8379364">*</span><span class="ident" id="8379365">UDPConn</span><span class="op" id="8379372">)</span><span class="op" id="8379373">.</span><span class="ident" id="8379374">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379379">checkDualStackAddrFamily</span><span class="op" id="8379403">(</span><span class="ident" id="8379404">t</span><span class="op" id="8379405">,</span>&nbsp;<span class="ident" id="8379407">net</span><span class="op" id="8379410">,</span>&nbsp;<span class="ident" id="8379412">laddr</span><span class="op" id="8379417">,</span>&nbsp;<span class="ident" id="8379419">fd</span><span class="op" id="8379421">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379424">case</span>&nbsp;<span class="string" id="8379429">&#34;udp4&#34;</span><span class="op" id="8379435">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379439">fd</span>&nbsp;<span class="op" id="8379442">:=</span>&nbsp;<span class="ident" id="8379445">l</span><span class="op" id="8379446">.</span><span class="op" id="8379447">(</span><span class="op" id="8379448">*</span><span class="ident" id="8379449">UDPConn</span><span class="op" id="8379456">)</span><span class="op" id="8379457">.</span><span class="ident" id="8379458">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379463">if</span>&nbsp;<span class="ident" id="8379466">fd</span><span class="op" id="8379468">.</span><span class="ident" id="8379469">family</span>&nbsp;<span class="op" id="8379476">!=</span>&nbsp;<span class="ident" id="8379479">syscall</span><span class="op" id="8379486">.</span><span class="ident" id="8379487">AF_INET</span>&nbsp;<span class="op" id="8379495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379500">t</span><span class="op" id="8379501">.</span><span class="ident" id="8379502">Fatalf</span><span class="op" id="8379508">(</span><span class="string" id="8379509">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8379576">,</span>&nbsp;<span class="ident" id="8379578">net</span><span class="op" id="8379581">,</span>&nbsp;<span class="ident" id="8379583">laddr</span><span class="op" id="8379588">,</span>&nbsp;<span class="ident" id="8379590">fd</span><span class="op" id="8379592">.</span><span class="ident" id="8379593">family</span><span class="op" id="8379599">,</span>&nbsp;<span class="ident" id="8379601">syscall</span><span class="op" id="8379608">.</span><span class="ident" id="8379609">AF_INET</span><span class="op" id="8379616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8379620">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379623">case</span>&nbsp;<span class="string" id="8379628">&#34;udp6&#34;</span><span class="op" id="8379634">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379638">fd</span>&nbsp;<span class="op" id="8379641">:=</span>&nbsp;<span class="ident" id="8379644">l</span><span class="op" id="8379645">.</span><span class="op" id="8379646">(</span><span class="op" id="8379647">*</span><span class="ident" id="8379648">UDPConn</span><span class="op" id="8379655">)</span><span class="op" id="8379656">.</span><span class="ident" id="8379657">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379662">if</span>&nbsp;<span class="ident" id="8379665">fd</span><span class="op" id="8379667">.</span><span class="ident" id="8379668">family</span>&nbsp;<span class="op" id="8379675">!=</span>&nbsp;<span class="ident" id="8379678">syscall</span><span class="op" id="8379685">.</span><span class="ident" id="8379686">AF_INET6</span>&nbsp;<span class="op" id="8379695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379700">t</span><span class="op" id="8379701">.</span><span class="ident" id="8379702">Fatalf</span><span class="op" id="8379708">(</span><span class="string" id="8379709">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8379776">,</span>&nbsp;<span class="ident" id="8379778">net</span><span class="op" id="8379781">,</span>&nbsp;<span class="ident" id="8379783">laddr</span><span class="op" id="8379788">,</span>&nbsp;<span class="ident" id="8379790">fd</span><span class="op" id="8379792">.</span><span class="ident" id="8379793">family</span><span class="op" id="8379799">,</span>&nbsp;<span class="ident" id="8379801">syscall</span><span class="op" id="8379808">.</span><span class="ident" id="8379809">AF_INET6</span><span class="op" id="8379817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8379821">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379824">default</span><span class="op" id="8379831">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8379835">t</span><span class="op" id="8379836">.</span><span class="ident" id="8379837">Fatalf</span><span class="op" id="8379843">(</span><span class="string" id="8379844">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="8379868">,</span>&nbsp;<span class="ident" id="8379870">net</span><span class="op" id="8379873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8379876">}</span><br>
<span class="lineno"></span><span class="op" id="8379878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="8379881">func</span>&nbsp;<span class="ident" id="8379886">checkSecondListener</span><span class="op" id="8379905">(</span><span class="ident" id="8379906">t</span>&nbsp;<span class="op" id="8379908">*</span><span class="ident" id="8379909">testing</span><span class="op" id="8379916">.</span><span class="ident" id="8379917">T</span><span class="op" id="8379918">,</span>&nbsp;<span class="ident" id="8379920">net</span><span class="op" id="8379923">,</span>&nbsp;<span class="ident" id="8379925">laddr</span>&nbsp;<span class="builtintype" id="8379931">string</span><span class="op" id="8379937">,</span>&nbsp;<span class="ident" id="8379939">err</span>&nbsp;<span class="builtintype" id="8379943">error</span><span class="op" id="8379948">,</span>&nbsp;<span class="ident" id="8379950">l</span>&nbsp;<span class="keyword" id="8379952">interface</span><span class="op" id="8379961">{</span><span class="op" id="8379962">}</span><span class="op" id="8379963">)</span>&nbsp;<span class="op" id="8379965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379968">switch</span>&nbsp;<span class="ident" id="8379975">net</span>&nbsp;<span class="op" id="8379979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8379982">case</span>&nbsp;<span class="string" id="8379987">&#34;tcp&#34;</span><span class="op" id="8379992">,</span>&nbsp;<span class="string" id="8379994">&#34;tcp4&#34;</span><span class="op" id="8380000">,</span>&nbsp;<span class="string" id="8380002">&#34;tcp6&#34;</span><span class="op" id="8380008">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8380012">if</span>&nbsp;<span class="ident" id="8380015">err</span>&nbsp;<span class="op" id="8380019">==</span>&nbsp;<span class="ident" id="8380022">nil</span>&nbsp;<span class="op" id="8380026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380031">l</span><span class="op" id="8380032">.</span><span class="op" id="8380033">(</span><span class="op" id="8380034">*</span><span class="ident" id="8380035">TCPListener</span><span class="op" id="8380046">)</span><span class="op" id="8380047">.</span><span class="ident" id="8380048">Close</span><span class="op" id="8380053">(</span><span class="op" id="8380054">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380059">t</span><span class="op" id="8380060">.</span><span class="ident" id="8380061">Fatalf</span><span class="op" id="8380067">(</span><span class="string" id="8380068">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8380103">,</span>&nbsp;<span class="ident" id="8380105">net</span><span class="op" id="8380108">,</span>&nbsp;<span class="ident" id="8380110">laddr</span><span class="op" id="8380115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8380119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8380122">case</span>&nbsp;<span class="string" id="8380127">&#34;udp&#34;</span><span class="op" id="8380132">,</span>&nbsp;<span class="string" id="8380134">&#34;udp4&#34;</span><span class="op" id="8380140">,</span>&nbsp;<span class="string" id="8380142">&#34;udp6&#34;</span><span class="op" id="8380148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8380152">if</span>&nbsp;<span class="ident" id="8380155">err</span>&nbsp;<span class="op" id="8380159">==</span>&nbsp;<span class="ident" id="8380162">nil</span>&nbsp;<span class="op" id="8380166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380171">l</span><span class="op" id="8380172">.</span><span class="op" id="8380173">(</span><span class="op" id="8380174">*</span><span class="ident" id="8380175">UDPConn</span><span class="op" id="8380182">)</span><span class="op" id="8380183">.</span><span class="ident" id="8380184">Close</span><span class="op" id="8380189">(</span><span class="op" id="8380190">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380195">t</span><span class="op" id="8380196">.</span><span class="ident" id="8380197">Fatalf</span><span class="op" id="8380203">(</span><span class="string" id="8380204">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8380245">,</span>&nbsp;<span class="ident" id="8380247">net</span><span class="op" id="8380250">,</span>&nbsp;<span class="ident" id="8380252">laddr</span><span class="op" id="8380257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8380261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8380264">default</span><span class="op" id="8380271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380275">t</span><span class="op" id="8380276">.</span><span class="ident" id="8380277">Fatalf</span><span class="op" id="8380283">(</span><span class="string" id="8380284">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="8380308">,</span>&nbsp;<span class="ident" id="8380310">net</span><span class="op" id="8380313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8380316">}</span><br>
<span class="lineno">350</span><span class="op" id="8380318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8380321">func</span>&nbsp;<span class="ident" id="8380326">checkDualStackSecondListener</span><span class="op" id="8380354">(</span><span class="ident" id="8380355">t</span>&nbsp;<span class="op" id="8380357">*</span><span class="ident" id="8380358">testing</span><span class="op" id="8380365">.</span><span class="ident" id="8380366">T</span><span class="op" id="8380367">,</span>&nbsp;<span class="ident" id="8380369">net</span><span class="op" id="8380372">,</span>&nbsp;<span class="ident" id="8380374">laddr</span>&nbsp;<span class="builtintype" id="8380380">string</span><span class="op" id="8380386">,</span>&nbsp;<span class="ident" id="8380388">xerr</span><span class="op" id="8380392">,</span>&nbsp;<span class="ident" id="8380394">err</span>&nbsp;<span class="builtintype" id="8380398">error</span><span class="op" id="8380403">,</span>&nbsp;<span class="ident" id="8380405">l</span>&nbsp;<span class="keyword" id="8380407">interface</span><span class="op" id="8380416">{</span><span class="op" id="8380417">}</span><span class="op" id="8380418">)</span>&nbsp;<span class="op" id="8380420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8380423">switch</span>&nbsp;<span class="ident" id="8380430">net</span>&nbsp;<span class="op" id="8380434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8380437">case</span>&nbsp;<span class="string" id="8380442">&#34;tcp&#34;</span><span class="op" id="8380447">,</span>&nbsp;<span class="string" id="8380449">&#34;tcp4&#34;</span><span class="op" id="8380455">,</span>&nbsp;<span class="string" id="8380457">&#34;tcp6&#34;</span><span class="op" id="8380463">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8380467">if</span>&nbsp;<span class="ident" id="8380470">xerr</span>&nbsp;<span class="op" id="8380475">==</span>&nbsp;<span class="ident" id="8380478">nil</span>&nbsp;<span class="op" id="8380482">&amp;&amp;</span>&nbsp;<span class="ident" id="8380485">err</span>&nbsp;<span class="op" id="8380489">!=</span>&nbsp;<span class="ident" id="8380492">nil</span>&nbsp;<span class="op" id="8380496">||</span>&nbsp;<span class="ident" id="8380499">xerr</span>&nbsp;<span class="op" id="8380504">!=</span>&nbsp;<span class="ident" id="8380507">nil</span>&nbsp;<span class="op" id="8380511">&amp;&amp;</span>&nbsp;<span class="ident" id="8380514">err</span>&nbsp;<span class="op" id="8380518">==</span>&nbsp;<span class="ident" id="8380521">nil</span>&nbsp;<span class="op" id="8380525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380530">t</span><span class="op" id="8380531">.</span><span class="ident" id="8380532">Fatalf</span><span class="op" id="8380538">(</span><span class="string" id="8380539">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8380586">,</span>&nbsp;<span class="ident" id="8380588">net</span><span class="op" id="8380591">,</span>&nbsp;<span class="ident" id="8380593">laddr</span><span class="op" id="8380598">,</span>&nbsp;<span class="ident" id="8380600">err</span><span class="op" id="8380603">,</span>&nbsp;<span class="ident" id="8380605">xerr</span><span class="op" id="8380609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8380613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8380617">if</span>&nbsp;<span class="ident" id="8380620">err</span>&nbsp;<span class="op" id="8380624">==</span>&nbsp;<span class="ident" id="8380627">nil</span>&nbsp;<span class="op" id="8380631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380636">l</span><span class="op" id="8380637">.</span><span class="op" id="8380638">(</span><span class="op" id="8380639">*</span><span class="ident" id="8380640">TCPListener</span><span class="op" id="8380651">)</span><span class="op" id="8380652">.</span><span class="ident" id="8380653">Close</span><span class="op" id="8380658">(</span><span class="op" id="8380659">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8380663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8380666">case</span>&nbsp;<span class="string" id="8380671">&#34;udp&#34;</span><span class="op" id="8380676">,</span>&nbsp;<span class="string" id="8380678">&#34;udp4&#34;</span><span class="op" id="8380684">,</span>&nbsp;<span class="string" id="8380686">&#34;udp6&#34;</span><span class="op" id="8380692">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8380696">if</span>&nbsp;<span class="ident" id="8380699">xerr</span>&nbsp;<span class="op" id="8380704">==</span>&nbsp;<span class="ident" id="8380707">nil</span>&nbsp;<span class="op" id="8380711">&amp;&amp;</span>&nbsp;<span class="ident" id="8380714">err</span>&nbsp;<span class="op" id="8380718">!=</span>&nbsp;<span class="ident" id="8380721">nil</span>&nbsp;<span class="op" id="8380725">||</span>&nbsp;<span class="ident" id="8380728">xerr</span>&nbsp;<span class="op" id="8380733">!=</span>&nbsp;<span class="ident" id="8380736">nil</span>&nbsp;<span class="op" id="8380740">&amp;&amp;</span>&nbsp;<span class="ident" id="8380743">err</span>&nbsp;<span class="op" id="8380747">==</span>&nbsp;<span class="ident" id="8380750">nil</span>&nbsp;<span class="op" id="8380754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380759">t</span><span class="op" id="8380760">.</span><span class="ident" id="8380761">Fatalf</span><span class="op" id="8380767">(</span><span class="string" id="8380768">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8380821">,</span>&nbsp;<span class="ident" id="8380823">net</span><span class="op" id="8380826">,</span>&nbsp;<span class="ident" id="8380828">laddr</span><span class="op" id="8380833">,</span>&nbsp;<span class="ident" id="8380835">err</span><span class="op" id="8380838">,</span>&nbsp;<span class="ident" id="8380840">xerr</span><span class="op" id="8380844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8380848">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8380852">if</span>&nbsp;<span class="ident" id="8380855">err</span>&nbsp;<span class="op" id="8380859">==</span>&nbsp;<span class="ident" id="8380862">nil</span>&nbsp;<span class="op" id="8380866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380871">l</span><span class="op" id="8380872">.</span><span class="op" id="8380873">(</span><span class="op" id="8380874">*</span><span class="ident" id="8380875">UDPConn</span><span class="op" id="8380882">)</span><span class="op" id="8380883">.</span><span class="ident" id="8380884">Close</span><span class="op" id="8380889">(</span><span class="op" id="8380890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8380894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8380897">default</span><span class="op" id="8380904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8380908">t</span><span class="op" id="8380909">.</span><span class="ident" id="8380910">Fatalf</span><span class="op" id="8380916">(</span><span class="string" id="8380917">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="8380941">,</span>&nbsp;<span class="ident" id="8380943">net</span><span class="op" id="8380946">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8380949">}</span><br>
<span class="lineno"></span><span class="op" id="8380951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8380954">func</span>&nbsp;<span class="ident" id="8380959">checkDualStackAddrFamily</span><span class="op" id="8380983">(</span><span class="ident" id="8380984">t</span>&nbsp;<span class="op" id="8380986">*</span><span class="ident" id="8380987">testing</span><span class="op" id="8380994">.</span><span class="ident" id="8380995">T</span><span class="op" id="8380996">,</span>&nbsp;<span class="ident" id="8380998">net</span><span class="op" id="8381001">,</span>&nbsp;<span class="ident" id="8381003">laddr</span>&nbsp;<span class="builtintype" id="8381009">string</span><span class="op" id="8381015">,</span>&nbsp;<span class="ident" id="8381017">fd</span>&nbsp;<span class="op" id="8381020">*</span><span class="ident" id="8381021">netFD</span><span class="op" id="8381026">)</span>&nbsp;<span class="op" id="8381028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381031">switch</span>&nbsp;<span class="ident" id="8381038">a</span>&nbsp;<span class="op" id="8381040">:=</span>&nbsp;<span class="ident" id="8381043">fd</span><span class="op" id="8381045">.</span><span class="ident" id="8381046">laddr</span><span class="op" id="8381051">.</span><span class="op" id="8381052">(</span><span class="keyword" id="8381053">type</span><span class="op" id="8381057">)</span>&nbsp;<span class="op" id="8381059">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381062">case</span>&nbsp;<span class="op" id="8381067">*</span><span class="ident" id="8381068">TCPAddr</span><span class="op" id="8381075">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8381079">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8381135">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8381188">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8381245">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381267">if</span>&nbsp;<span class="ident" id="8381270">supportsIPv4map</span>&nbsp;<span class="op" id="8381286">&amp;&amp;</span>&nbsp;<span class="ident" id="8381289">fd</span><span class="op" id="8381291">.</span><span class="ident" id="8381292">laddr</span><span class="op" id="8381297">.</span><span class="op" id="8381298">(</span><span class="op" id="8381299">*</span><span class="ident" id="8381300">TCPAddr</span><span class="op" id="8381307">)</span><span class="op" id="8381308">.</span><span class="ident" id="8381309">isWildcard</span><span class="op" id="8381319">(</span><span class="op" id="8381320">)</span>&nbsp;<span class="op" id="8381322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381327">if</span>&nbsp;<span class="ident" id="8381330">fd</span><span class="op" id="8381332">.</span><span class="ident" id="8381333">family</span>&nbsp;<span class="op" id="8381340">!=</span>&nbsp;<span class="ident" id="8381343">syscall</span><span class="op" id="8381350">.</span><span class="ident" id="8381351">AF_INET6</span>&nbsp;<span class="op" id="8381360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381366">t</span><span class="op" id="8381367">.</span><span class="ident" id="8381368">Fatalf</span><span class="op" id="8381374">(</span><span class="string" id="8381375">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8381430">,</span>&nbsp;<span class="ident" id="8381432">net</span><span class="op" id="8381435">,</span>&nbsp;<span class="ident" id="8381437">laddr</span><span class="op" id="8381442">,</span>&nbsp;<span class="ident" id="8381444">fd</span><span class="op" id="8381446">.</span><span class="ident" id="8381447">family</span><span class="op" id="8381453">,</span>&nbsp;<span class="ident" id="8381455">syscall</span><span class="op" id="8381462">.</span><span class="ident" id="8381463">AF_INET6</span><span class="op" id="8381471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8381476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8381480">}</span>&nbsp;<span class="keyword" id="8381482">else</span>&nbsp;<span class="op" id="8381487">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381492">if</span>&nbsp;<span class="ident" id="8381495">fd</span><span class="op" id="8381497">.</span><span class="ident" id="8381498">family</span>&nbsp;<span class="op" id="8381505">!=</span>&nbsp;<span class="ident" id="8381508">a</span><span class="op" id="8381509">.</span><span class="ident" id="8381510">family</span><span class="op" id="8381516">(</span><span class="op" id="8381517">)</span>&nbsp;<span class="op" id="8381519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381525">t</span><span class="op" id="8381526">.</span><span class="ident" id="8381527">Fatalf</span><span class="op" id="8381533">(</span><span class="string" id="8381534">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8381589">,</span>&nbsp;<span class="ident" id="8381591">net</span><span class="op" id="8381594">,</span>&nbsp;<span class="ident" id="8381596">laddr</span><span class="op" id="8381601">,</span>&nbsp;<span class="ident" id="8381603">fd</span><span class="op" id="8381605">.</span><span class="ident" id="8381606">family</span><span class="op" id="8381612">,</span>&nbsp;<span class="ident" id="8381614">a</span><span class="op" id="8381615">.</span><span class="ident" id="8381616">family</span><span class="op" id="8381622">(</span><span class="op" id="8381623">)</span><span class="op" id="8381624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8381629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8381633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381636">case</span>&nbsp;<span class="op" id="8381641">*</span><span class="ident" id="8381642">UDPAddr</span><span class="op" id="8381649">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8381653">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8381709">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8381762">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8381819">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381841">if</span>&nbsp;<span class="ident" id="8381844">supportsIPv4map</span>&nbsp;<span class="op" id="8381860">&amp;&amp;</span>&nbsp;<span class="ident" id="8381863">fd</span><span class="op" id="8381865">.</span><span class="ident" id="8381866">laddr</span><span class="op" id="8381871">.</span><span class="op" id="8381872">(</span><span class="op" id="8381873">*</span><span class="ident" id="8381874">UDPAddr</span><span class="op" id="8381881">)</span><span class="op" id="8381882">.</span><span class="ident" id="8381883">isWildcard</span><span class="op" id="8381893">(</span><span class="op" id="8381894">)</span>&nbsp;<span class="op" id="8381896">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8381901">if</span>&nbsp;<span class="ident" id="8381904">fd</span><span class="op" id="8381906">.</span><span class="ident" id="8381907">family</span>&nbsp;<span class="op" id="8381914">!=</span>&nbsp;<span class="ident" id="8381917">syscall</span><span class="op" id="8381924">.</span><span class="ident" id="8381925">AF_INET6</span>&nbsp;<span class="op" id="8381934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8381940">t</span><span class="op" id="8381941">.</span><span class="ident" id="8381942">Fatalf</span><span class="op" id="8381948">(</span><span class="string" id="8381949">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8382010">,</span>&nbsp;<span class="ident" id="8382012">net</span><span class="op" id="8382015">,</span>&nbsp;<span class="ident" id="8382017">laddr</span><span class="op" id="8382022">,</span>&nbsp;<span class="ident" id="8382024">fd</span><span class="op" id="8382026">.</span><span class="ident" id="8382027">family</span><span class="op" id="8382033">,</span>&nbsp;<span class="ident" id="8382035">syscall</span><span class="op" id="8382042">.</span><span class="ident" id="8382043">AF_INET6</span><span class="op" id="8382051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382060">}</span>&nbsp;<span class="keyword" id="8382062">else</span>&nbsp;<span class="op" id="8382067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382072">if</span>&nbsp;<span class="ident" id="8382075">fd</span><span class="op" id="8382077">.</span><span class="ident" id="8382078">family</span>&nbsp;<span class="op" id="8382085">!=</span>&nbsp;<span class="ident" id="8382088">a</span><span class="op" id="8382089">.</span><span class="ident" id="8382090">family</span><span class="op" id="8382096">(</span><span class="op" id="8382097">)</span>&nbsp;<span class="op" id="8382099">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382105">t</span><span class="op" id="8382106">.</span><span class="ident" id="8382107">Fatalf</span><span class="op" id="8382113">(</span><span class="string" id="8382114">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="8382175">,</span>&nbsp;<span class="ident" id="8382177">net</span><span class="op" id="8382180">,</span>&nbsp;<span class="ident" id="8382182">laddr</span><span class="op" id="8382187">,</span>&nbsp;<span class="ident" id="8382189">fd</span><span class="op" id="8382191">.</span><span class="ident" id="8382192">family</span><span class="op" id="8382198">,</span>&nbsp;<span class="ident" id="8382200">a</span><span class="op" id="8382201">.</span><span class="ident" id="8382202">family</span><span class="op" id="8382208">(</span><span class="op" id="8382209">)</span><span class="op" id="8382210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382222">default</span><span class="op" id="8382229">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382233">t</span><span class="op" id="8382234">.</span><span class="ident" id="8382235">Fatalf</span><span class="op" id="8382241">(</span><span class="string" id="8382242">&#34;Unexpected&nbsp;protocol&nbsp;address&nbsp;type:&nbsp;%T&#34;</span><span class="op" id="8382280">,</span>&nbsp;<span class="ident" id="8382282">a</span><span class="op" id="8382283">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382286">}</span><br>
<span class="lineno"></span><span class="op" id="8382288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8382291">var</span>&nbsp;<span class="ident" id="8382295">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="8382322">=</span>&nbsp;<span class="op" id="8382324">[</span><span class="op" id="8382325">]</span><span class="keyword" id="8382326">struct</span>&nbsp;<span class="op" id="8382333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382336">net</span>&nbsp;&nbsp;<span class="builtintype" id="8382341">string</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382349">addr</span>&nbsp;<span class="builtintype" id="8382354">string</span><br>
<span class="lineno"></span><span class="op" id="8382361">}</span><span class="op" id="8382362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382365">{</span><span class="string" id="8382366">&#34;tcp6&#34;</span><span class="op" id="8382372">,</span>&nbsp;<span class="string" id="8382374">&#34;127.0.0.1&#34;</span><span class="op" id="8382385">}</span><span class="op" id="8382386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382389">{</span><span class="string" id="8382390">&#34;tcp6&#34;</span><span class="op" id="8382396">,</span>&nbsp;<span class="string" id="8382398">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8382418">}</span><span class="op" id="8382419">,</span><br>
<span class="lineno"></span><span class="op" id="8382421">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="8382424">func</span>&nbsp;<span class="ident" id="8382429">TestProhibitionaryDialArgs</span><span class="op" id="8382455">(</span><span class="ident" id="8382456">t</span>&nbsp;<span class="op" id="8382458">*</span><span class="ident" id="8382459">testing</span><span class="op" id="8382466">.</span><span class="ident" id="8382467">T</span><span class="op" id="8382468">)</span>&nbsp;<span class="op" id="8382470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382473">switch</span>&nbsp;<span class="ident" id="8382480">runtime</span><span class="op" id="8382487">.</span><span class="ident" id="8382488">GOOS</span>&nbsp;<span class="op" id="8382493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382496">case</span>&nbsp;<span class="string" id="8382501">&#34;plan9&#34;</span><span class="op" id="8382508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382512">t</span><span class="op" id="8382513">.</span><span class="ident" id="8382514">Skipf</span><span class="op" id="8382519">(</span><span class="string" id="8382520">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8382541">,</span>&nbsp;<span class="ident" id="8382543">runtime</span><span class="op" id="8382550">.</span><span class="ident" id="8382551">GOOS</span><span class="op" id="8382555">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8382561">//&nbsp;This&nbsp;test&nbsp;requires&nbsp;both&nbsp;IPv6&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382631">if</span>&nbsp;<span class="op" id="8382634">!</span><span class="ident" id="8382635">supportsIPv4map</span>&nbsp;<span class="op" id="8382651">||</span>&nbsp;<span class="ident" id="8382654">testing</span><span class="op" id="8382661">.</span><span class="ident" id="8382662">Short</span><span class="op" id="8382667">(</span><span class="op" id="8382668">)</span>&nbsp;<span class="op" id="8382670">||</span>&nbsp;<span class="op" id="8382673">!</span><span class="op" id="8382674">*</span><span class="ident" id="8382675">testExternal</span>&nbsp;<span class="op" id="8382688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382692">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382700">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382704">l</span><span class="op" id="8382705">,</span>&nbsp;<span class="ident" id="8382707">port</span>&nbsp;<span class="op" id="8382712">:=</span>&nbsp;<span class="ident" id="8382715">usableListenPort</span><span class="op" id="8382731">(</span><span class="ident" id="8382732">t</span><span class="op" id="8382733">,</span>&nbsp;<span class="string" id="8382735">&#34;tcp&#34;</span><span class="op" id="8382740">,</span>&nbsp;<span class="string" id="8382742">&#34;[::]&#34;</span><span class="op" id="8382748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382751">defer</span>&nbsp;<span class="ident" id="8382757">l</span><span class="op" id="8382758">.</span><span class="ident" id="8382759">Close</span><span class="op" id="8382764">(</span><span class="op" id="8382765">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382769">for</span>&nbsp;<span class="ident" id="8382773">_</span><span class="op" id="8382774">,</span>&nbsp;<span class="ident" id="8382776">tt</span>&nbsp;<span class="op" id="8382779">:=</span>&nbsp;<span class="keyword" id="8382782">range</span>&nbsp;<span class="ident" id="8382788">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="8382815">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382819">c</span><span class="op" id="8382820">,</span>&nbsp;<span class="ident" id="8382822">err</span>&nbsp;<span class="op" id="8382826">:=</span>&nbsp;<span class="ident" id="8382829">Dial</span><span class="op" id="8382833">(</span><span class="ident" id="8382834">tt</span><span class="op" id="8382836">.</span><span class="ident" id="8382837">net</span><span class="op" id="8382840">,</span>&nbsp;<span class="ident" id="8382842">tt</span><span class="op" id="8382844">.</span><span class="ident" id="8382845">addr</span><span class="op" id="8382849">+</span><span class="string" id="8382850">&#34;:&#34;</span><span class="op" id="8382853">+</span><span class="ident" id="8382854">port</span><span class="op" id="8382858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8382862">if</span>&nbsp;<span class="ident" id="8382865">err</span>&nbsp;<span class="op" id="8382869">==</span>&nbsp;<span class="ident" id="8382872">nil</span>&nbsp;<span class="op" id="8382876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382881">c</span><span class="op" id="8382882">.</span><span class="ident" id="8382883">Close</span><span class="op" id="8382888">(</span><span class="op" id="8382889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8382894">t</span><span class="op" id="8382895">.</span><span class="ident" id="8382896">Fatalf</span><span class="op" id="8382902">(</span><span class="string" id="8382903">&#34;Dial(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8382929">,</span>&nbsp;<span class="ident" id="8382931">tt</span><span class="op" id="8382933">.</span><span class="ident" id="8382934">net</span><span class="op" id="8382937">,</span>&nbsp;<span class="ident" id="8382939">tt</span><span class="op" id="8382941">.</span><span class="ident" id="8382942">addr</span><span class="op" id="8382946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382950">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8382953">}</span><br>
<span class="lineno"></span><span class="op" id="8382955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8382958">func</span>&nbsp;<span class="ident" id="8382963">TestWildWildcardListener</span><span class="op" id="8382987">(</span><span class="ident" id="8382988">t</span>&nbsp;<span class="op" id="8382990">*</span><span class="ident" id="8382991">testing</span><span class="op" id="8382998">.</span><span class="ident" id="8382999">T</span><span class="op" id="8383000">)</span>&nbsp;<span class="op" id="8383002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383005">switch</span>&nbsp;<span class="ident" id="8383012">runtime</span><span class="op" id="8383019">.</span><span class="ident" id="8383020">GOOS</span>&nbsp;<span class="op" id="8383025">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383028">case</span>&nbsp;<span class="string" id="8383033">&#34;plan9&#34;</span><span class="op" id="8383040">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383044">t</span><span class="op" id="8383045">.</span><span class="ident" id="8383046">Skipf</span><span class="op" id="8383051">(</span><span class="string" id="8383052">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8383073">,</span>&nbsp;<span class="ident" id="8383075">runtime</span><span class="op" id="8383082">.</span><span class="ident" id="8383083">GOOS</span><span class="op" id="8383087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383094">if</span>&nbsp;<span class="ident" id="8383097">testing</span><span class="op" id="8383104">.</span><span class="ident" id="8383105">Short</span><span class="op" id="8383110">(</span><span class="op" id="8383111">)</span>&nbsp;<span class="op" id="8383113">||</span>&nbsp;<span class="op" id="8383116">!</span><span class="op" id="8383117">*</span><span class="ident" id="8383118">testExternal</span>&nbsp;<span class="op" id="8383131">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383135">t</span><span class="op" id="8383136">.</span><span class="ident" id="8383137">Skip</span><span class="op" id="8383141">(</span><span class="string" id="8383142">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="8383183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383190">defer</span>&nbsp;<span class="keyword" id="8383196">func</span><span class="op" id="8383200">(</span><span class="op" id="8383201">)</span>&nbsp;<span class="op" id="8383203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383207">if</span>&nbsp;<span class="ident" id="8383210">p</span>&nbsp;<span class="op" id="8383212">:=</span>&nbsp;<span class="builtinfunc" id="8383215">recover</span><span class="op" id="8383222">(</span><span class="op" id="8383223">)</span><span class="op" id="8383224">;</span>&nbsp;<span class="ident" id="8383226">p</span>&nbsp;<span class="op" id="8383228">!=</span>&nbsp;<span class="ident" id="8383231">nil</span>&nbsp;<span class="op" id="8383235">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383240">t</span><span class="op" id="8383241">.</span><span class="ident" id="8383242">Fatalf</span><span class="op" id="8383248">(</span><span class="string" id="8383249">&#34;Listen,&nbsp;ListenPacket&nbsp;or&nbsp;protocol-specific&nbsp;Listen&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="8383312">,</span>&nbsp;<span class="ident" id="8383314">p</span><span class="op" id="8383315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383322">}</span><span class="op" id="8383323">(</span><span class="op" id="8383324">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383328">if</span>&nbsp;<span class="ident" id="8383331">ln</span><span class="op" id="8383333">,</span>&nbsp;<span class="ident" id="8383335">err</span>&nbsp;<span class="op" id="8383339">:=</span>&nbsp;<span class="ident" id="8383342">Listen</span><span class="op" id="8383348">(</span><span class="string" id="8383349">&#34;tcp&#34;</span><span class="op" id="8383354">,</span>&nbsp;<span class="string" id="8383356">&#34;&#34;</span><span class="op" id="8383358">)</span><span class="op" id="8383359">;</span>&nbsp;<span class="ident" id="8383361">err</span>&nbsp;<span class="op" id="8383365">==</span>&nbsp;<span class="ident" id="8383368">nil</span>&nbsp;<span class="op" id="8383372">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383376">ln</span><span class="op" id="8383378">.</span><span class="ident" id="8383379">Close</span><span class="op" id="8383384">(</span><span class="op" id="8383385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383391">if</span>&nbsp;<span class="ident" id="8383394">ln</span><span class="op" id="8383396">,</span>&nbsp;<span class="ident" id="8383398">err</span>&nbsp;<span class="op" id="8383402">:=</span>&nbsp;<span class="ident" id="8383405">ListenPacket</span><span class="op" id="8383417">(</span><span class="string" id="8383418">&#34;udp&#34;</span><span class="op" id="8383423">,</span>&nbsp;<span class="string" id="8383425">&#34;&#34;</span><span class="op" id="8383427">)</span><span class="op" id="8383428">;</span>&nbsp;<span class="ident" id="8383430">err</span>&nbsp;<span class="op" id="8383434">==</span>&nbsp;<span class="ident" id="8383437">nil</span>&nbsp;<span class="op" id="8383441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383445">ln</span><span class="op" id="8383447">.</span><span class="ident" id="8383448">Close</span><span class="op" id="8383453">(</span><span class="op" id="8383454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383457">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383460">if</span>&nbsp;<span class="ident" id="8383463">ln</span><span class="op" id="8383465">,</span>&nbsp;<span class="ident" id="8383467">err</span>&nbsp;<span class="op" id="8383471">:=</span>&nbsp;<span class="ident" id="8383474">ListenTCP</span><span class="op" id="8383483">(</span><span class="string" id="8383484">&#34;tcp&#34;</span><span class="op" id="8383489">,</span>&nbsp;<span class="ident" id="8383491">nil</span><span class="op" id="8383494">)</span><span class="op" id="8383495">;</span>&nbsp;<span class="ident" id="8383497">err</span>&nbsp;<span class="op" id="8383501">==</span>&nbsp;<span class="ident" id="8383504">nil</span>&nbsp;<span class="op" id="8383508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383512">ln</span><span class="op" id="8383514">.</span><span class="ident" id="8383515">Close</span><span class="op" id="8383520">(</span><span class="op" id="8383521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383527">if</span>&nbsp;<span class="ident" id="8383530">ln</span><span class="op" id="8383532">,</span>&nbsp;<span class="ident" id="8383534">err</span>&nbsp;<span class="op" id="8383538">:=</span>&nbsp;<span class="ident" id="8383541">ListenUDP</span><span class="op" id="8383550">(</span><span class="string" id="8383551">&#34;udp&#34;</span><span class="op" id="8383556">,</span>&nbsp;<span class="ident" id="8383558">nil</span><span class="op" id="8383561">)</span><span class="op" id="8383562">;</span>&nbsp;<span class="ident" id="8383564">err</span>&nbsp;<span class="op" id="8383568">==</span>&nbsp;<span class="ident" id="8383571">nil</span>&nbsp;<span class="op" id="8383575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383579">ln</span><span class="op" id="8383581">.</span><span class="ident" id="8383582">Close</span><span class="op" id="8383587">(</span><span class="op" id="8383588">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8383594">if</span>&nbsp;<span class="ident" id="8383597">ln</span><span class="op" id="8383599">,</span>&nbsp;<span class="ident" id="8383601">err</span>&nbsp;<span class="op" id="8383605">:=</span>&nbsp;<span class="ident" id="8383608">ListenIP</span><span class="op" id="8383616">(</span><span class="string" id="8383617">&#34;ip:icmp&#34;</span><span class="op" id="8383626">,</span>&nbsp;<span class="ident" id="8383628">nil</span><span class="op" id="8383631">)</span><span class="op" id="8383632">;</span>&nbsp;<span class="ident" id="8383634">err</span>&nbsp;<span class="op" id="8383638">==</span>&nbsp;<span class="ident" id="8383641">nil</span>&nbsp;<span class="op" id="8383645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8383649">ln</span><span class="op" id="8383651">.</span><span class="ident" id="8383652">Close</span><span class="op" id="8383657">(</span><span class="op" id="8383658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8383661">}</span><br>
<span class="lineno"></span><span class="op" id="8383663">}</span>
</div>
</body>
</html>
