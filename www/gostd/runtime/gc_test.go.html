<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html" class="current">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="876969">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="877024">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="877078">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="877129">package</span>&nbsp;<span class="ident" id="877137">runtime_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="877151">import</span>&nbsp;<span class="op" id="877158">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="877161">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="877167">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="877178">&#34;runtime/debug&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="877195">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="877206">&#34;time&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="877214">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="877223">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="877226">func</span>&nbsp;<span class="ident" id="877231">TestGcSys</span><span class="op" id="877240">(</span><span class="ident" id="877241">t</span>&nbsp;<span class="op" id="877243">*</span><span class="ident" id="877244">testing</span><span class="op" id="877251">.</span><span class="ident" id="877252">T</span><span class="op" id="877253">)</span>&nbsp;<span class="op" id="877255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="877258">if</span>&nbsp;<span class="ident" id="877261">os</span><span class="op" id="877263">.</span><span class="ident" id="877264">Getenv</span><span class="op" id="877270">(</span><span class="string" id="877271">&#34;GOGC&#34;</span><span class="op" id="877277">)</span>&nbsp;<span class="op" id="877279">==</span>&nbsp;<span class="string" id="877282">&#34;off&#34;</span>&nbsp;<span class="op" id="877288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="877292">t</span><span class="op" id="877293">.</span><span class="ident" id="877294">Skip</span><span class="op" id="877298">(</span><span class="string" id="877299">&#34;skipping&nbsp;test;&nbsp;GOGC=off&nbsp;in&nbsp;environment&#34;</span><span class="op" id="877339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="877342">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="877345">data</span>&nbsp;<span class="op" id="877350">:=</span>&nbsp;<span class="keyword" id="877353">struct</span><span class="op" id="877359">{</span>&nbsp;<span class="ident" id="877361">Short</span>&nbsp;<span class="builtintype" id="877367">bool</span>&nbsp;<span class="op" id="877372">}</span><span class="op" id="877373">{</span><span class="ident" id="877374">testing</span><span class="op" id="877381">.</span><span class="ident" id="877382">Short</span><span class="op" id="877387">(</span><span class="op" id="877388">)</span><span class="op" id="877389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="877392">got</span>&nbsp;<span class="op" id="877396">:=</span>&nbsp;<span class="ident" id="877399">executeTest</span><span class="op" id="877410">(</span><span class="ident" id="877411">t</span><span class="op" id="877412">,</span>&nbsp;<span class="ident" id="877414">testGCSysSource</span><span class="op" id="877429">,</span>&nbsp;<span class="op" id="877431">&amp;</span><span class="ident" id="877432">data</span><span class="op" id="877436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="877439">want</span>&nbsp;<span class="op" id="877444">:=</span>&nbsp;<span class="string" id="877447">&#34;OK\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="877455">if</span>&nbsp;<span class="ident" id="877458">got</span>&nbsp;<span class="op" id="877462">!=</span>&nbsp;<span class="ident" id="877465">want</span>&nbsp;<span class="op" id="877470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="877474">t</span><span class="op" id="877475">.</span><span class="ident" id="877476">Fatalf</span><span class="op" id="877482">(</span><span class="string" id="877483">&#34;expected&nbsp;%q,&nbsp;but&nbsp;got&nbsp;%q&#34;</span><span class="op" id="877508">,</span>&nbsp;<span class="ident" id="877510">want</span><span class="op" id="877514">,</span>&nbsp;<span class="ident" id="877516">got</span><span class="op" id="877519">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="877522">}</span><br>
<span class="lineno"></span><span class="op" id="877524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="877527">const</span>&nbsp;<span class="ident" id="877533">testGCSysSource</span>&nbsp;<span class="op" id="877549">=</span>&nbsp;<span class="string" id="877551">`<br>
<span class="lineno"></span>package&nbsp;main<br>
<span class="lineno">30</span><br>
<span class="lineno"></span>import&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&#34;fmt&#34;<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&#34;runtime&#34;<br>
<span class="lineno"></span>)<br>
<span class="lineno">35</span><br>
<span class="lineno"></span>func&nbsp;main()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;runtime.GOMAXPROCS(1)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;memstats&nbsp;:=&nbsp;new(runtime.MemStats)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;runtime.GC()<br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;runtime.ReadMemStats(memstats)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;sys&nbsp;:=&nbsp;memstats.Sys<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;runtime.MemProfileRate&nbsp;=&nbsp;0&nbsp;//&nbsp;disable&nbsp;profiler<br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;itercount&nbsp;:=&nbsp;1000000<br>
<span class="lineno"></span>{{if&nbsp;.Short}}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;itercount&nbsp;=&nbsp;100000<br>
<span class="lineno"></span>{{end}}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;itercount;&nbsp;i++&nbsp;{<br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;workthegc()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Should&nbsp;only&nbsp;be&nbsp;using&nbsp;a&nbsp;few&nbsp;MB.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;We&nbsp;allocated&nbsp;100&nbsp;MB&nbsp;or&nbsp;(if&nbsp;not&nbsp;short)&nbsp;1&nbsp;GB.<br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;runtime.ReadMemStats(memstats)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;sys&nbsp;&gt;&nbsp;memstats.Sys&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys&nbsp;=&nbsp;0<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys&nbsp;=&nbsp;memstats.Sys&nbsp;-&nbsp;sys<br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;sys&nbsp;&gt;&nbsp;16&lt;&lt;20&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(&#34;using&nbsp;too&nbsp;much&nbsp;memory:&nbsp;%d&nbsp;bytes\n&#34;,&nbsp;sys)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;fmt.Printf(&#34;OK\n&#34;)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;workthegc()&nbsp;[]byte&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;make([]byte,&nbsp;1029)<br>
<span class="lineno">70</span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="878259">func</span>&nbsp;<span class="ident" id="878264">TestGcDeepNesting</span><span class="op" id="878281">(</span><span class="ident" id="878282">t</span>&nbsp;<span class="op" id="878284">*</span><span class="ident" id="878285">testing</span><span class="op" id="878292">.</span><span class="ident" id="878293">T</span><span class="op" id="878294">)</span>&nbsp;<span class="op" id="878296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="878299">type</span>&nbsp;<span class="ident" id="878304">T</span>&nbsp;<span class="op" id="878306">[</span><span class="num" id="878307">2</span><span class="op" id="878308">]</span><span class="op" id="878309">[</span><span class="num" id="878310">2</span><span class="op" id="878311">]</span><span class="op" id="878312">[</span><span class="num" id="878313">2</span><span class="op" id="878314">]</span><span class="op" id="878315">[</span><span class="num" id="878316">2</span><span class="op" id="878317">]</span><span class="op" id="878318">[</span><span class="num" id="878319">2</span><span class="op" id="878320">]</span><span class="op" id="878321">[</span><span class="num" id="878322">2</span><span class="op" id="878323">]</span><span class="op" id="878324">[</span><span class="num" id="878325">2</span><span class="op" id="878326">]</span><span class="op" id="878327">[</span><span class="num" id="878328">2</span><span class="op" id="878329">]</span><span class="op" id="878330">[</span><span class="num" id="878331">2</span><span class="op" id="878332">]</span><span class="op" id="878333">[</span><span class="num" id="878334">2</span><span class="op" id="878335">]</span><span class="op" id="878336">*</span><span class="builtintype" id="878337">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="878342">a</span>&nbsp;<span class="op" id="878344">:=</span>&nbsp;<span class="builtinfunc" id="878347">new</span><span class="op" id="878350">(</span><span class="ident" id="878351">T</span><span class="op" id="878352">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="878356">//&nbsp;Prevent&nbsp;the&nbsp;compiler&nbsp;from&nbsp;applying&nbsp;escape&nbsp;analysis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="878412">//&nbsp;This&nbsp;makes&nbsp;sure&nbsp;new(T)&nbsp;is&nbsp;allocated&nbsp;on&nbsp;heap,&nbsp;not&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="878479">t</span><span class="op" id="878480">.</span><span class="ident" id="878481">Logf</span><span class="op" id="878485">(</span><span class="string" id="878486">&#34;%p&#34;</span><span class="op" id="878490">,</span>&nbsp;<span class="ident" id="878492">a</span><span class="op" id="878493">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="878497">a</span><span class="op" id="878498">[</span><span class="num" id="878499">0</span><span class="op" id="878500">]</span><span class="op" id="878501">[</span><span class="num" id="878502">0</span><span class="op" id="878503">]</span><span class="op" id="878504">[</span><span class="num" id="878505">0</span><span class="op" id="878506">]</span><span class="op" id="878507">[</span><span class="num" id="878508">0</span><span class="op" id="878509">]</span><span class="op" id="878510">[</span><span class="num" id="878511">0</span><span class="op" id="878512">]</span><span class="op" id="878513">[</span><span class="num" id="878514">0</span><span class="op" id="878515">]</span><span class="op" id="878516">[</span><span class="num" id="878517">0</span><span class="op" id="878518">]</span><span class="op" id="878519">[</span><span class="num" id="878520">0</span><span class="op" id="878521">]</span><span class="op" id="878522">[</span><span class="num" id="878523">0</span><span class="op" id="878524">]</span><span class="op" id="878525">[</span><span class="num" id="878526">0</span><span class="op" id="878527">]</span>&nbsp;<span class="op" id="878529">=</span>&nbsp;<span class="builtinfunc" id="878531">new</span><span class="op" id="878534">(</span><span class="builtintype" id="878535">int</span><span class="op" id="878538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="878541">*</span><span class="ident" id="878542">a</span><span class="op" id="878543">[</span><span class="num" id="878544">0</span><span class="op" id="878545">]</span><span class="op" id="878546">[</span><span class="num" id="878547">0</span><span class="op" id="878548">]</span><span class="op" id="878549">[</span><span class="num" id="878550">0</span><span class="op" id="878551">]</span><span class="op" id="878552">[</span><span class="num" id="878553">0</span><span class="op" id="878554">]</span><span class="op" id="878555">[</span><span class="num" id="878556">0</span><span class="op" id="878557">]</span><span class="op" id="878558">[</span><span class="num" id="878559">0</span><span class="op" id="878560">]</span><span class="op" id="878561">[</span><span class="num" id="878562">0</span><span class="op" id="878563">]</span><span class="op" id="878564">[</span><span class="num" id="878565">0</span><span class="op" id="878566">]</span><span class="op" id="878567">[</span><span class="num" id="878568">0</span><span class="op" id="878569">]</span><span class="op" id="878570">[</span><span class="num" id="878571">0</span><span class="op" id="878572">]</span>&nbsp;<span class="op" id="878574">=</span>&nbsp;<span class="num" id="878576">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="878580">runtime</span><span class="op" id="878587">.</span><span class="ident" id="878588">GC</span><span class="op" id="878590">(</span><span class="op" id="878591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="878594">if</span>&nbsp;<span class="op" id="878597">*</span><span class="ident" id="878598">a</span><span class="op" id="878599">[</span><span class="num" id="878600">0</span><span class="op" id="878601">]</span><span class="op" id="878602">[</span><span class="num" id="878603">0</span><span class="op" id="878604">]</span><span class="op" id="878605">[</span><span class="num" id="878606">0</span><span class="op" id="878607">]</span><span class="op" id="878608">[</span><span class="num" id="878609">0</span><span class="op" id="878610">]</span><span class="op" id="878611">[</span><span class="num" id="878612">0</span><span class="op" id="878613">]</span><span class="op" id="878614">[</span><span class="num" id="878615">0</span><span class="op" id="878616">]</span><span class="op" id="878617">[</span><span class="num" id="878618">0</span><span class="op" id="878619">]</span><span class="op" id="878620">[</span><span class="num" id="878621">0</span><span class="op" id="878622">]</span><span class="op" id="878623">[</span><span class="num" id="878624">0</span><span class="op" id="878625">]</span><span class="op" id="878626">[</span><span class="num" id="878627">0</span><span class="op" id="878628">]</span>&nbsp;<span class="op" id="878630">!=</span>&nbsp;<span class="num" id="878633">13</span>&nbsp;<span class="op" id="878636">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="878640">t</span><span class="op" id="878641">.</span><span class="ident" id="878642">Fail</span><span class="op" id="878646">(</span><span class="op" id="878647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="878650">}</span><br>
<span class="lineno"></span><span class="op" id="878652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="878655">func</span>&nbsp;<span class="ident" id="878660">TestGcHashmapIndirection</span><span class="op" id="878684">(</span><span class="ident" id="878685">t</span>&nbsp;<span class="op" id="878687">*</span><span class="ident" id="878688">testing</span><span class="op" id="878695">.</span><span class="ident" id="878696">T</span><span class="op" id="878697">)</span>&nbsp;<span class="op" id="878699">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="878702">defer</span>&nbsp;<span class="ident" id="878708">debug</span><span class="op" id="878713">.</span><span class="ident" id="878714">SetGCPercent</span><span class="op" id="878726">(</span><span class="ident" id="878727">debug</span><span class="op" id="878732">.</span><span class="ident" id="878733">SetGCPercent</span><span class="op" id="878745">(</span><span class="num" id="878746">1</span><span class="op" id="878747">)</span><span class="op" id="878748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="878751">runtime</span><span class="op" id="878758">.</span><span class="ident" id="878759">GC</span><span class="op" id="878761">(</span><span class="op" id="878762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="878765">type</span>&nbsp;<span class="ident" id="878770">T</span>&nbsp;<span class="keyword" id="878772">struct</span>&nbsp;<span class="op" id="878779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="878783">a</span>&nbsp;<span class="op" id="878785">[</span><span class="num" id="878786">256</span><span class="op" id="878789">]</span><span class="builtintype" id="878790">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="878795">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="878798">m</span>&nbsp;<span class="op" id="878800">:=</span>&nbsp;<span class="builtinfunc" id="878803">make</span><span class="op" id="878807">(</span><span class="keyword" id="878808">map</span><span class="op" id="878811">[</span><span class="ident" id="878812">T</span><span class="op" id="878813">]</span><span class="ident" id="878814">T</span><span class="op" id="878815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="878818">for</span>&nbsp;<span class="ident" id="878822">i</span>&nbsp;<span class="op" id="878824">:=</span>&nbsp;<span class="num" id="878827">0</span><span class="op" id="878828">;</span>&nbsp;<span class="ident" id="878830">i</span>&nbsp;<span class="op" id="878832">&lt;</span>&nbsp;<span class="num" id="878834">2000</span><span class="op" id="878838">;</span>&nbsp;<span class="ident" id="878840">i</span><span class="op" id="878841">++</span>&nbsp;<span class="op" id="878844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="878848">var</span>&nbsp;<span class="ident" id="878852">a</span>&nbsp;<span class="ident" id="878854">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="878858">a</span><span class="op" id="878859">.</span><span class="ident" id="878860">a</span><span class="op" id="878861">[</span><span class="num" id="878862">0</span><span class="op" id="878863">]</span>&nbsp;<span class="op" id="878865">=</span>&nbsp;<span class="ident" id="878867">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="878871">m</span><span class="op" id="878872">[</span><span class="ident" id="878873">a</span><span class="op" id="878874">]</span>&nbsp;<span class="op" id="878876">=</span>&nbsp;<span class="ident" id="878878">T</span><span class="op" id="878879">{</span><span class="op" id="878880">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="878883">}</span><br>
<span class="lineno"></span><span class="op" id="878885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="878888">func</span>&nbsp;<span class="ident" id="878893">TestGcArraySlice</span><span class="op" id="878909">(</span><span class="ident" id="878910">t</span>&nbsp;<span class="op" id="878912">*</span><span class="ident" id="878913">testing</span><span class="op" id="878920">.</span><span class="ident" id="878921">T</span><span class="op" id="878922">)</span>&nbsp;<span class="op" id="878924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="878927">type</span>&nbsp;<span class="ident" id="878932">X</span>&nbsp;<span class="keyword" id="878934">struct</span>&nbsp;<span class="op" id="878941">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="878945">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="878953">[</span><span class="num" id="878954">1</span><span class="op" id="878955">]</span><span class="builtintype" id="878956">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="878963">nextbuf</span>&nbsp;<span class="op" id="878971">[</span><span class="op" id="878972">]</span><span class="builtintype" id="878973">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="878980">next</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="878988">*</span><span class="ident" id="878989">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="878992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="878995">var</span>&nbsp;<span class="ident" id="878999">head</span>&nbsp;<span class="op" id="879004">*</span><span class="ident" id="879005">X</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="879008">for</span>&nbsp;<span class="ident" id="879012">i</span>&nbsp;<span class="op" id="879014">:=</span>&nbsp;<span class="num" id="879017">0</span><span class="op" id="879018">;</span>&nbsp;<span class="ident" id="879020">i</span>&nbsp;<span class="op" id="879022">&lt;</span>&nbsp;<span class="num" id="879024">10</span><span class="op" id="879026">;</span>&nbsp;<span class="ident" id="879028">i</span><span class="op" id="879029">++</span>&nbsp;<span class="op" id="879032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879036">p</span>&nbsp;<span class="op" id="879038">:=</span>&nbsp;<span class="op" id="879041">&amp;</span><span class="ident" id="879042">X</span><span class="op" id="879043">{</span><span class="op" id="879044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879048">p</span><span class="op" id="879049">.</span><span class="ident" id="879050">buf</span><span class="op" id="879053">[</span><span class="num" id="879054">0</span><span class="op" id="879055">]</span>&nbsp;<span class="op" id="879057">=</span>&nbsp;<span class="num" id="879059">42</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879064">p</span><span class="op" id="879065">.</span><span class="ident" id="879066">next</span>&nbsp;<span class="op" id="879071">=</span>&nbsp;<span class="ident" id="879073">head</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="879080">if</span>&nbsp;<span class="ident" id="879083">head</span>&nbsp;<span class="op" id="879088">!=</span>&nbsp;<span class="builtintype" id="879091">nil</span>&nbsp;<span class="op" id="879095">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879100">p</span><span class="op" id="879101">.</span><span class="ident" id="879102">nextbuf</span>&nbsp;<span class="op" id="879110">=</span>&nbsp;<span class="ident" id="879112">head</span><span class="op" id="879116">.</span><span class="ident" id="879117">buf</span><span class="op" id="879120">[</span><span class="op" id="879121">:</span><span class="op" id="879122">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="879126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879130">head</span>&nbsp;<span class="op" id="879135">=</span>&nbsp;<span class="ident" id="879137">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879141">runtime</span><span class="op" id="879148">.</span><span class="ident" id="879149">GC</span><span class="op" id="879151">(</span><span class="op" id="879152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="879155">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="879158">for</span>&nbsp;<span class="ident" id="879162">p</span>&nbsp;<span class="op" id="879164">:=</span>&nbsp;<span class="ident" id="879167">head</span><span class="op" id="879171">;</span>&nbsp;<span class="ident" id="879173">p</span>&nbsp;<span class="op" id="879175">!=</span>&nbsp;<span class="builtintype" id="879178">nil</span><span class="op" id="879181">;</span>&nbsp;<span class="ident" id="879183">p</span>&nbsp;<span class="op" id="879185">=</span>&nbsp;<span class="ident" id="879187">p</span><span class="op" id="879188">.</span><span class="ident" id="879189">next</span>&nbsp;<span class="op" id="879194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="879198">if</span>&nbsp;<span class="ident" id="879201">p</span><span class="op" id="879202">.</span><span class="ident" id="879203">buf</span><span class="op" id="879206">[</span><span class="num" id="879207">0</span><span class="op" id="879208">]</span>&nbsp;<span class="op" id="879210">!=</span>&nbsp;<span class="num" id="879213">42</span>&nbsp;<span class="op" id="879216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879221">t</span><span class="op" id="879222">.</span><span class="ident" id="879223">Fatal</span><span class="op" id="879228">(</span><span class="string" id="879229">&#34;corrupted&nbsp;heap&#34;</span><span class="op" id="879245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="879249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="879252">}</span><br>
<span class="lineno">125</span><span class="op" id="879254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="879257">func</span>&nbsp;<span class="ident" id="879262">TestGcRescan</span><span class="op" id="879274">(</span><span class="ident" id="879275">t</span>&nbsp;<span class="op" id="879277">*</span><span class="ident" id="879278">testing</span><span class="op" id="879285">.</span><span class="ident" id="879286">T</span><span class="op" id="879287">)</span>&nbsp;<span class="op" id="879289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="879292">type</span>&nbsp;<span class="ident" id="879297">X</span>&nbsp;<span class="keyword" id="879299">struct</span>&nbsp;<span class="op" id="879306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879310">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="879316">chan</span>&nbsp;<span class="builtintype" id="879321">error</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879329">nextx</span>&nbsp;<span class="op" id="879335">*</span><span class="ident" id="879336">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="879339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="879342">type</span>&nbsp;<span class="ident" id="879347">Y</span>&nbsp;<span class="keyword" id="879349">struct</span>&nbsp;<span class="op" id="879356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879360">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879364">nexty</span>&nbsp;<span class="op" id="879370">*</span><span class="ident" id="879371">Y</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879375">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="879381">*</span><span class="builtintype" id="879382">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="879387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="879390">var</span>&nbsp;<span class="ident" id="879394">head</span>&nbsp;<span class="op" id="879399">*</span><span class="ident" id="879400">Y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="879403">for</span>&nbsp;<span class="ident" id="879407">i</span>&nbsp;<span class="op" id="879409">:=</span>&nbsp;<span class="num" id="879412">0</span><span class="op" id="879413">;</span>&nbsp;<span class="ident" id="879415">i</span>&nbsp;<span class="op" id="879417">&lt;</span>&nbsp;<span class="num" id="879419">10</span><span class="op" id="879421">;</span>&nbsp;<span class="ident" id="879423">i</span><span class="op" id="879424">++</span>&nbsp;<span class="op" id="879427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879431">p</span>&nbsp;<span class="op" id="879433">:=</span>&nbsp;<span class="op" id="879436">&amp;</span><span class="ident" id="879437">Y</span><span class="op" id="879438">{</span><span class="op" id="879439">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879443">p</span><span class="op" id="879444">.</span><span class="ident" id="879445">c</span>&nbsp;<span class="op" id="879447">=</span>&nbsp;<span class="builtinfunc" id="879449">make</span><span class="op" id="879453">(</span><span class="keyword" id="879454">chan</span>&nbsp;<span class="builtintype" id="879459">error</span><span class="op" id="879464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="879468">if</span>&nbsp;<span class="ident" id="879471">head</span>&nbsp;<span class="op" id="879476">!=</span>&nbsp;<span class="builtintype" id="879479">nil</span>&nbsp;<span class="op" id="879483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879488">p</span><span class="op" id="879489">.</span><span class="ident" id="879490">nextx</span>&nbsp;<span class="op" id="879496">=</span>&nbsp;<span class="op" id="879498">&amp;</span><span class="ident" id="879499">head</span><span class="op" id="879503">.</span><span class="ident" id="879504">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="879508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879512">p</span><span class="op" id="879513">.</span><span class="ident" id="879514">nexty</span>&nbsp;<span class="op" id="879520">=</span>&nbsp;<span class="ident" id="879522">head</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879529">p</span><span class="op" id="879530">.</span><span class="ident" id="879531">p</span>&nbsp;<span class="op" id="879533">=</span>&nbsp;<span class="builtinfunc" id="879535">new</span><span class="op" id="879538">(</span><span class="builtintype" id="879539">int</span><span class="op" id="879542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="879546">*</span><span class="ident" id="879547">p</span><span class="op" id="879548">.</span><span class="ident" id="879549">p</span>&nbsp;<span class="op" id="879551">=</span>&nbsp;<span class="num" id="879553">42</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879558">head</span>&nbsp;<span class="op" id="879563">=</span>&nbsp;<span class="ident" id="879565">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879569">runtime</span><span class="op" id="879576">.</span><span class="ident" id="879577">GC</span><span class="op" id="879579">(</span><span class="op" id="879580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="879583">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="879586">for</span>&nbsp;<span class="ident" id="879590">p</span>&nbsp;<span class="op" id="879592">:=</span>&nbsp;<span class="ident" id="879595">head</span><span class="op" id="879599">;</span>&nbsp;<span class="ident" id="879601">p</span>&nbsp;<span class="op" id="879603">!=</span>&nbsp;<span class="builtintype" id="879606">nil</span><span class="op" id="879609">;</span>&nbsp;<span class="ident" id="879611">p</span>&nbsp;<span class="op" id="879613">=</span>&nbsp;<span class="ident" id="879615">p</span><span class="op" id="879616">.</span><span class="ident" id="879617">nexty</span>&nbsp;<span class="op" id="879623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="879627">if</span>&nbsp;<span class="op" id="879630">*</span><span class="ident" id="879631">p</span><span class="op" id="879632">.</span><span class="ident" id="879633">p</span>&nbsp;<span class="op" id="879635">!=</span>&nbsp;<span class="num" id="879638">42</span>&nbsp;<span class="op" id="879641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879646">t</span><span class="op" id="879647">.</span><span class="ident" id="879648">Fatal</span><span class="op" id="879653">(</span><span class="string" id="879654">&#34;corrupted&nbsp;heap&#34;</span><span class="op" id="879670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="879674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="879677">}</span><br>
<span class="lineno">155</span><span class="op" id="879679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="879682">func</span>&nbsp;<span class="ident" id="879687">TestGcLastTime</span><span class="op" id="879701">(</span><span class="ident" id="879702">t</span>&nbsp;<span class="op" id="879704">*</span><span class="ident" id="879705">testing</span><span class="op" id="879712">.</span><span class="ident" id="879713">T</span><span class="op" id="879714">)</span>&nbsp;<span class="op" id="879716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879719">ms</span>&nbsp;<span class="op" id="879722">:=</span>&nbsp;<span class="builtinfunc" id="879725">new</span><span class="op" id="879728">(</span><span class="ident" id="879729">runtime</span><span class="op" id="879736">.</span><span class="ident" id="879737">MemStats</span><span class="op" id="879745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879748">t0</span>&nbsp;<span class="op" id="879751">:=</span>&nbsp;<span class="ident" id="879754">time</span><span class="op" id="879758">.</span><span class="ident" id="879759">Now</span><span class="op" id="879762">(</span><span class="op" id="879763">)</span><span class="op" id="879764">.</span><span class="ident" id="879765">UnixNano</span><span class="op" id="879773">(</span><span class="op" id="879774">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879777">runtime</span><span class="op" id="879784">.</span><span class="ident" id="879785">GC</span><span class="op" id="879787">(</span><span class="op" id="879788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879791">t1</span>&nbsp;<span class="op" id="879794">:=</span>&nbsp;<span class="ident" id="879797">time</span><span class="op" id="879801">.</span><span class="ident" id="879802">Now</span><span class="op" id="879805">(</span><span class="op" id="879806">)</span><span class="op" id="879807">.</span><span class="ident" id="879808">UnixNano</span><span class="op" id="879816">(</span><span class="op" id="879817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879820">runtime</span><span class="op" id="879827">.</span><span class="ident" id="879828">ReadMemStats</span><span class="op" id="879840">(</span><span class="ident" id="879841">ms</span><span class="op" id="879843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879846">last</span>&nbsp;<span class="op" id="879851">:=</span>&nbsp;<span class="builtintype" id="879854">int64</span><span class="op" id="879859">(</span><span class="ident" id="879860">ms</span><span class="op" id="879862">.</span><span class="ident" id="879863">LastGC</span><span class="op" id="879869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="879872">if</span>&nbsp;<span class="ident" id="879875">t0</span>&nbsp;<span class="op" id="879878">&gt;</span>&nbsp;<span class="ident" id="879880">last</span>&nbsp;<span class="op" id="879885">||</span>&nbsp;<span class="ident" id="879888">last</span>&nbsp;<span class="op" id="879893">&gt;</span>&nbsp;<span class="ident" id="879895">t1</span>&nbsp;<span class="op" id="879898">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879902">t</span><span class="op" id="879903">.</span><span class="ident" id="879904">Fatalf</span><span class="op" id="879910">(</span><span class="string" id="879911">&#34;bad&nbsp;last&nbsp;GC&nbsp;time:&nbsp;got&nbsp;%v,&nbsp;want&nbsp;[%v,&nbsp;%v]&#34;</span><span class="op" id="879952">,</span>&nbsp;<span class="ident" id="879954">last</span><span class="op" id="879958">,</span>&nbsp;<span class="ident" id="879960">t0</span><span class="op" id="879962">,</span>&nbsp;<span class="ident" id="879964">t1</span><span class="op" id="879966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="879969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="879972">pause</span>&nbsp;<span class="op" id="879978">:=</span>&nbsp;<span class="ident" id="879981">ms</span><span class="op" id="879983">.</span><span class="ident" id="879984">PauseNs</span><span class="op" id="879991">[</span><span class="op" id="879992">(</span><span class="ident" id="879993">ms</span><span class="op" id="879995">.</span><span class="ident" id="879996">NumGC</span><span class="op" id="880001">+</span><span class="num" id="880002">255</span><span class="op" id="880005">)</span><span class="op" id="880006">%</span><span class="num" id="880007">256</span><span class="op" id="880010">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="880013">//&nbsp;Due&nbsp;to&nbsp;timer&nbsp;granularity,&nbsp;pause&nbsp;can&nbsp;actually&nbsp;be&nbsp;0&nbsp;on&nbsp;windows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="880078">//&nbsp;or&nbsp;on&nbsp;virtualized&nbsp;environments.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="880114">if</span>&nbsp;<span class="ident" id="880117">pause</span>&nbsp;<span class="op" id="880123">==</span>&nbsp;<span class="num" id="880126">0</span>&nbsp;<span class="op" id="880128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="880132">t</span><span class="op" id="880133">.</span><span class="ident" id="880134">Logf</span><span class="op" id="880138">(</span><span class="string" id="880139">&#34;last&nbsp;GC&nbsp;pause&nbsp;was&nbsp;0&#34;</span><span class="op" id="880160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="880163">}</span>&nbsp;<span class="keyword" id="880165">else</span>&nbsp;<span class="keyword" id="880170">if</span>&nbsp;<span class="ident" id="880173">pause</span>&nbsp;<span class="op" id="880179">&gt;</span>&nbsp;<span class="num" id="880181">10e9</span>&nbsp;<span class="op" id="880186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="880190">t</span><span class="op" id="880191">.</span><span class="ident" id="880192">Logf</span><span class="op" id="880196">(</span><span class="string" id="880197">&#34;bad&nbsp;last&nbsp;GC&nbsp;pause:&nbsp;got&nbsp;%v,&nbsp;want&nbsp;[0,&nbsp;10e9]&#34;</span><span class="op" id="880240">,</span>&nbsp;<span class="ident" id="880242">pause</span><span class="op" id="880247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="880250">}</span><br>
<span class="lineno">175</span><span class="op" id="880252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="880255">var</span>&nbsp;<span class="ident" id="880259">hugeSink</span>&nbsp;<span class="keyword" id="880268">interface</span><span class="op" id="880277">{</span><span class="op" id="880278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="880281">func</span>&nbsp;<span class="ident" id="880286">TestHugeGCInfo</span><span class="op" id="880300">(</span><span class="ident" id="880301">t</span>&nbsp;<span class="op" id="880303">*</span><span class="ident" id="880304">testing</span><span class="op" id="880311">.</span><span class="ident" id="880312">T</span><span class="op" id="880313">)</span>&nbsp;<span class="op" id="880315">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="880318">//&nbsp;The&nbsp;test&nbsp;ensures&nbsp;that&nbsp;compiler&nbsp;can&nbsp;chew&nbsp;these&nbsp;huge&nbsp;types&nbsp;even&nbsp;on&nbsp;weakest&nbsp;machines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="880405">//&nbsp;The&nbsp;types&nbsp;are&nbsp;not&nbsp;allocated&nbsp;at&nbsp;runtime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="880449">if</span>&nbsp;<span class="ident" id="880452">hugeSink</span>&nbsp;<span class="op" id="880461">!=</span>&nbsp;<span class="builtintype" id="880464">nil</span>&nbsp;<span class="op" id="880468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="880472">//&nbsp;400MB&nbsp;on&nbsp;32&nbsp;bots,&nbsp;4TB&nbsp;on&nbsp;64-bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="880511">const</span>&nbsp;<span class="ident" id="880517">n</span>&nbsp;<span class="op" id="880519">=</span>&nbsp;<span class="op" id="880521">(</span><span class="num" id="880522">400</span>&nbsp;<span class="op" id="880526">&lt;&lt;</span>&nbsp;<span class="num" id="880529">20</span><span class="op" id="880531">)</span>&nbsp;<span class="op" id="880533">+</span>&nbsp;<span class="op" id="880535">(</span><span class="ident" id="880536">unsafe</span><span class="op" id="880542">.</span><span class="ident" id="880543">Sizeof</span><span class="op" id="880549">(</span><span class="builtintype" id="880550">uintptr</span><span class="op" id="880557">(</span><span class="num" id="880558">0</span><span class="op" id="880559">)</span><span class="op" id="880560">)</span><span class="op" id="880561">-</span><span class="num" id="880562">4</span><span class="op" id="880563">)</span><span class="op" id="880564">&lt;&lt;</span><span class="num" id="880566">40</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="880571">hugeSink</span>&nbsp;<span class="op" id="880580">=</span>&nbsp;<span class="builtinfunc" id="880582">new</span><span class="op" id="880585">(</span><span class="op" id="880586">[</span><span class="ident" id="880587">n</span><span class="op" id="880588">]</span><span class="op" id="880589">*</span><span class="builtintype" id="880590">byte</span><span class="op" id="880594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="880598">hugeSink</span>&nbsp;<span class="op" id="880607">=</span>&nbsp;<span class="builtinfunc" id="880609">new</span><span class="op" id="880612">(</span><span class="op" id="880613">[</span><span class="ident" id="880614">n</span><span class="op" id="880615">]</span><span class="builtintype" id="880616">uintptr</span><span class="op" id="880623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="880627">hugeSink</span>&nbsp;<span class="op" id="880636">=</span>&nbsp;<span class="builtinfunc" id="880638">new</span><span class="op" id="880641">(</span><span class="keyword" id="880642">struct</span>&nbsp;<span class="op" id="880649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="880654">x</span>&nbsp;<span class="builtintype" id="880656">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="880667">y</span>&nbsp;<span class="op" id="880669">[</span><span class="ident" id="880670">n</span><span class="op" id="880671">]</span><span class="op" id="880672">*</span><span class="builtintype" id="880673">byte</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="880681">z</span>&nbsp;<span class="op" id="880683">[</span><span class="op" id="880684">]</span><span class="builtintype" id="880685">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="880694">}</span><span class="op" id="880695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="880699">hugeSink</span>&nbsp;<span class="op" id="880708">=</span>&nbsp;<span class="builtinfunc" id="880710">new</span><span class="op" id="880713">(</span><span class="keyword" id="880714">struct</span>&nbsp;<span class="op" id="880721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="880726">x</span>&nbsp;<span class="builtintype" id="880728">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="880739">y</span>&nbsp;<span class="op" id="880741">[</span><span class="ident" id="880742">n</span><span class="op" id="880743">]</span><span class="builtintype" id="880744">uintptr</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="880755">z</span>&nbsp;<span class="op" id="880757">[</span><span class="op" id="880758">]</span><span class="builtintype" id="880759">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="880768">}</span><span class="op" id="880769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="880772">}</span><br>
<span class="lineno"></span><span class="op" id="880774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="keyword" id="880777">func</span>&nbsp;<span class="ident" id="880782">BenchmarkSetTypeNoPtr1</span><span class="op" id="880804">(</span><span class="ident" id="880805">b</span>&nbsp;<span class="op" id="880807">*</span><span class="ident" id="880808">testing</span><span class="op" id="880815">.</span><span class="ident" id="880816">B</span><span class="op" id="880817">)</span>&nbsp;<span class="op" id="880819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="880822">type</span>&nbsp;<span class="ident" id="880827">NoPtr1</span>&nbsp;<span class="keyword" id="880834">struct</span>&nbsp;<span class="op" id="880841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="880845">p</span>&nbsp;<span class="builtintype" id="880847">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="880856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="880859">var</span>&nbsp;<span class="ident" id="880863">p</span>&nbsp;<span class="op" id="880865">*</span><span class="ident" id="880866">NoPtr1</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="880874">for</span>&nbsp;<span class="ident" id="880878">i</span>&nbsp;<span class="op" id="880880">:=</span>&nbsp;<span class="num" id="880883">0</span><span class="op" id="880884">;</span>&nbsp;<span class="ident" id="880886">i</span>&nbsp;<span class="op" id="880888">&lt;</span>&nbsp;<span class="ident" id="880890">b</span><span class="op" id="880891">.</span><span class="ident" id="880892">N</span><span class="op" id="880893">;</span>&nbsp;<span class="ident" id="880895">i</span><span class="op" id="880896">++</span>&nbsp;<span class="op" id="880899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="880903">p</span>&nbsp;<span class="op" id="880905">=</span>&nbsp;<span class="op" id="880907">&amp;</span><span class="ident" id="880908">NoPtr1</span><span class="op" id="880914">{</span><span class="op" id="880915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="880918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="880921">_</span>&nbsp;<span class="op" id="880923">=</span>&nbsp;<span class="ident" id="880925">p</span><br>
<span class="lineno"></span><span class="op" id="880927">}</span><br>
<span class="lineno">210</span><span class="keyword" id="880929">func</span>&nbsp;<span class="ident" id="880934">BenchmarkSetTypeNoPtr2</span><span class="op" id="880956">(</span><span class="ident" id="880957">b</span>&nbsp;<span class="op" id="880959">*</span><span class="ident" id="880960">testing</span><span class="op" id="880967">.</span><span class="ident" id="880968">B</span><span class="op" id="880969">)</span>&nbsp;<span class="op" id="880971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="880974">type</span>&nbsp;<span class="ident" id="880979">NoPtr2</span>&nbsp;<span class="keyword" id="880986">struct</span>&nbsp;<span class="op" id="880993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="880997">p</span><span class="op" id="880998">,</span>&nbsp;<span class="ident" id="881000">q</span>&nbsp;<span class="builtintype" id="881002">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="881011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881014">var</span>&nbsp;<span class="ident" id="881018">p</span>&nbsp;<span class="op" id="881020">*</span><span class="ident" id="881021">NoPtr2</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881029">for</span>&nbsp;<span class="ident" id="881033">i</span>&nbsp;<span class="op" id="881035">:=</span>&nbsp;<span class="num" id="881038">0</span><span class="op" id="881039">;</span>&nbsp;<span class="ident" id="881041">i</span>&nbsp;<span class="op" id="881043">&lt;</span>&nbsp;<span class="ident" id="881045">b</span><span class="op" id="881046">.</span><span class="ident" id="881047">N</span><span class="op" id="881048">;</span>&nbsp;<span class="ident" id="881050">i</span><span class="op" id="881051">++</span>&nbsp;<span class="op" id="881054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881058">p</span>&nbsp;<span class="op" id="881060">=</span>&nbsp;<span class="op" id="881062">&amp;</span><span class="ident" id="881063">NoPtr2</span><span class="op" id="881069">{</span><span class="op" id="881070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="881073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881076">_</span>&nbsp;<span class="op" id="881078">=</span>&nbsp;<span class="ident" id="881080">p</span><br>
<span class="lineno"></span><span class="op" id="881082">}</span><br>
<span class="lineno">220</span><span class="keyword" id="881084">func</span>&nbsp;<span class="ident" id="881089">BenchmarkSetTypePtr1</span><span class="op" id="881109">(</span><span class="ident" id="881110">b</span>&nbsp;<span class="op" id="881112">*</span><span class="ident" id="881113">testing</span><span class="op" id="881120">.</span><span class="ident" id="881121">B</span><span class="op" id="881122">)</span>&nbsp;<span class="op" id="881124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881127">type</span>&nbsp;<span class="ident" id="881132">Ptr1</span>&nbsp;<span class="keyword" id="881137">struct</span>&nbsp;<span class="op" id="881144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881148">p</span>&nbsp;<span class="op" id="881150">*</span><span class="builtintype" id="881151">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="881157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881160">var</span>&nbsp;<span class="ident" id="881164">p</span>&nbsp;<span class="op" id="881166">*</span><span class="ident" id="881167">Ptr1</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881173">for</span>&nbsp;<span class="ident" id="881177">i</span>&nbsp;<span class="op" id="881179">:=</span>&nbsp;<span class="num" id="881182">0</span><span class="op" id="881183">;</span>&nbsp;<span class="ident" id="881185">i</span>&nbsp;<span class="op" id="881187">&lt;</span>&nbsp;<span class="ident" id="881189">b</span><span class="op" id="881190">.</span><span class="ident" id="881191">N</span><span class="op" id="881192">;</span>&nbsp;<span class="ident" id="881194">i</span><span class="op" id="881195">++</span>&nbsp;<span class="op" id="881198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881202">p</span>&nbsp;<span class="op" id="881204">=</span>&nbsp;<span class="op" id="881206">&amp;</span><span class="ident" id="881207">Ptr1</span><span class="op" id="881211">{</span><span class="op" id="881212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="881215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881218">_</span>&nbsp;<span class="op" id="881220">=</span>&nbsp;<span class="ident" id="881222">p</span><br>
<span class="lineno"></span><span class="op" id="881224">}</span><br>
<span class="lineno">230</span><span class="keyword" id="881226">func</span>&nbsp;<span class="ident" id="881231">BenchmarkSetTypePtr2</span><span class="op" id="881251">(</span><span class="ident" id="881252">b</span>&nbsp;<span class="op" id="881254">*</span><span class="ident" id="881255">testing</span><span class="op" id="881262">.</span><span class="ident" id="881263">B</span><span class="op" id="881264">)</span>&nbsp;<span class="op" id="881266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881269">type</span>&nbsp;<span class="ident" id="881274">Ptr2</span>&nbsp;<span class="keyword" id="881279">struct</span>&nbsp;<span class="op" id="881286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881290">p</span><span class="op" id="881291">,</span>&nbsp;<span class="ident" id="881293">q</span>&nbsp;<span class="op" id="881295">*</span><span class="builtintype" id="881296">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="881302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881305">var</span>&nbsp;<span class="ident" id="881309">p</span>&nbsp;<span class="op" id="881311">*</span><span class="ident" id="881312">Ptr2</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881318">for</span>&nbsp;<span class="ident" id="881322">i</span>&nbsp;<span class="op" id="881324">:=</span>&nbsp;<span class="num" id="881327">0</span><span class="op" id="881328">;</span>&nbsp;<span class="ident" id="881330">i</span>&nbsp;<span class="op" id="881332">&lt;</span>&nbsp;<span class="ident" id="881334">b</span><span class="op" id="881335">.</span><span class="ident" id="881336">N</span><span class="op" id="881337">;</span>&nbsp;<span class="ident" id="881339">i</span><span class="op" id="881340">++</span>&nbsp;<span class="op" id="881343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881347">p</span>&nbsp;<span class="op" id="881349">=</span>&nbsp;<span class="op" id="881351">&amp;</span><span class="ident" id="881352">Ptr2</span><span class="op" id="881356">{</span><span class="op" id="881357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="881360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881363">_</span>&nbsp;<span class="op" id="881365">=</span>&nbsp;<span class="ident" id="881367">p</span><br>
<span class="lineno"></span><span class="op" id="881369">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="881372">func</span>&nbsp;<span class="ident" id="881377">BenchmarkAllocation</span><span class="op" id="881396">(</span><span class="ident" id="881397">b</span>&nbsp;<span class="op" id="881399">*</span><span class="ident" id="881400">testing</span><span class="op" id="881407">.</span><span class="ident" id="881408">B</span><span class="op" id="881409">)</span>&nbsp;<span class="op" id="881411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881414">type</span>&nbsp;<span class="ident" id="881419">T</span>&nbsp;<span class="keyword" id="881421">struct</span>&nbsp;<span class="op" id="881428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881432">x</span><span class="op" id="881433">,</span>&nbsp;<span class="ident" id="881435">y</span>&nbsp;<span class="op" id="881437">*</span><span class="builtintype" id="881438">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="881444">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881447">ngo</span>&nbsp;<span class="op" id="881451">:=</span>&nbsp;<span class="ident" id="881454">runtime</span><span class="op" id="881461">.</span><span class="ident" id="881462">GOMAXPROCS</span><span class="op" id="881472">(</span><span class="num" id="881473">0</span><span class="op" id="881474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881477">work</span>&nbsp;<span class="op" id="881482">:=</span>&nbsp;<span class="builtinfunc" id="881485">make</span><span class="op" id="881489">(</span><span class="keyword" id="881490">chan</span>&nbsp;<span class="builtintype" id="881495">bool</span><span class="op" id="881499">,</span>&nbsp;<span class="ident" id="881501">b</span><span class="op" id="881502">.</span><span class="ident" id="881503">N</span><span class="op" id="881504">+</span><span class="ident" id="881505">ngo</span><span class="op" id="881508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881511">result</span>&nbsp;<span class="op" id="881518">:=</span>&nbsp;<span class="builtinfunc" id="881521">make</span><span class="op" id="881525">(</span><span class="keyword" id="881526">chan</span>&nbsp;<span class="op" id="881531">*</span><span class="ident" id="881532">T</span><span class="op" id="881533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881536">for</span>&nbsp;<span class="ident" id="881540">i</span>&nbsp;<span class="op" id="881542">:=</span>&nbsp;<span class="num" id="881545">0</span><span class="op" id="881546">;</span>&nbsp;<span class="ident" id="881548">i</span>&nbsp;<span class="op" id="881550">&lt;</span>&nbsp;<span class="ident" id="881552">b</span><span class="op" id="881553">.</span><span class="ident" id="881554">N</span><span class="op" id="881555">;</span>&nbsp;<span class="ident" id="881557">i</span><span class="op" id="881558">++</span>&nbsp;<span class="op" id="881561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881565">work</span>&nbsp;<span class="op" id="881570">&lt;-</span>&nbsp;<span class="builtintype" id="881573">true</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="881579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881582">for</span>&nbsp;<span class="ident" id="881586">i</span>&nbsp;<span class="op" id="881588">:=</span>&nbsp;<span class="num" id="881591">0</span><span class="op" id="881592">;</span>&nbsp;<span class="ident" id="881594">i</span>&nbsp;<span class="op" id="881596">&lt;</span>&nbsp;<span class="ident" id="881598">ngo</span><span class="op" id="881601">;</span>&nbsp;<span class="ident" id="881603">i</span><span class="op" id="881604">++</span>&nbsp;<span class="op" id="881607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881611">work</span>&nbsp;<span class="op" id="881616">&lt;-</span>&nbsp;<span class="builtintype" id="881619">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="881626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881629">for</span>&nbsp;<span class="ident" id="881633">i</span>&nbsp;<span class="op" id="881635">:=</span>&nbsp;<span class="num" id="881638">0</span><span class="op" id="881639">;</span>&nbsp;<span class="ident" id="881641">i</span>&nbsp;<span class="op" id="881643">&lt;</span>&nbsp;<span class="ident" id="881645">ngo</span><span class="op" id="881648">;</span>&nbsp;<span class="ident" id="881650">i</span><span class="op" id="881651">++</span>&nbsp;<span class="op" id="881654">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881658">go</span>&nbsp;<span class="keyword" id="881661">func</span><span class="op" id="881665">(</span><span class="op" id="881666">)</span>&nbsp;<span class="op" id="881668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881673">var</span>&nbsp;<span class="ident" id="881677">x</span>&nbsp;<span class="op" id="881679">*</span><span class="ident" id="881680">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881685">for</span>&nbsp;<span class="op" id="881689">&lt;-</span><span class="ident" id="881691">work</span>&nbsp;<span class="op" id="881696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881702">for</span>&nbsp;<span class="ident" id="881706">i</span>&nbsp;<span class="op" id="881708">:=</span>&nbsp;<span class="num" id="881711">0</span><span class="op" id="881712">;</span>&nbsp;<span class="ident" id="881714">i</span>&nbsp;<span class="op" id="881716">&lt;</span>&nbsp;<span class="num" id="881718">1000</span><span class="op" id="881722">;</span>&nbsp;<span class="ident" id="881724">i</span><span class="op" id="881725">++</span>&nbsp;<span class="op" id="881728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881735">x</span>&nbsp;<span class="op" id="881737">=</span>&nbsp;<span class="op" id="881739">&amp;</span><span class="ident" id="881740">T</span><span class="op" id="881741">{</span><span class="op" id="881742">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="881748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="881753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881758">result</span>&nbsp;<span class="op" id="881765">&lt;-</span>&nbsp;<span class="ident" id="881768">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="881772">}</span><span class="op" id="881773">(</span><span class="op" id="881774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="881777">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881780">for</span>&nbsp;<span class="ident" id="881784">i</span>&nbsp;<span class="op" id="881786">:=</span>&nbsp;<span class="num" id="881789">0</span><span class="op" id="881790">;</span>&nbsp;<span class="ident" id="881792">i</span>&nbsp;<span class="op" id="881794">&lt;</span>&nbsp;<span class="ident" id="881796">ngo</span><span class="op" id="881799">;</span>&nbsp;<span class="ident" id="881801">i</span><span class="op" id="881802">++</span>&nbsp;<span class="op" id="881805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="881809">&lt;-</span><span class="ident" id="881811">result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="881819">}</span><br>
<span class="lineno"></span><span class="op" id="881821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="881824">func</span>&nbsp;<span class="ident" id="881829">TestPrintGC</span><span class="op" id="881840">(</span><span class="ident" id="881841">t</span>&nbsp;<span class="op" id="881843">*</span><span class="ident" id="881844">testing</span><span class="op" id="881851">.</span><span class="ident" id="881852">T</span><span class="op" id="881853">)</span>&nbsp;<span class="op" id="881855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881858">if</span>&nbsp;<span class="ident" id="881861">testing</span><span class="op" id="881868">.</span><span class="ident" id="881869">Short</span><span class="op" id="881874">(</span><span class="op" id="881875">)</span>&nbsp;<span class="op" id="881877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881881">t</span><span class="op" id="881882">.</span><span class="ident" id="881883">Skip</span><span class="op" id="881887">(</span><span class="string" id="881888">&#34;Skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="881912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="881915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881918">defer</span>&nbsp;<span class="ident" id="881924">runtime</span><span class="op" id="881931">.</span><span class="ident" id="881932">GOMAXPROCS</span><span class="op" id="881942">(</span><span class="ident" id="881943">runtime</span><span class="op" id="881950">.</span><span class="ident" id="881951">GOMAXPROCS</span><span class="op" id="881961">(</span><span class="num" id="881962">2</span><span class="op" id="881963">)</span><span class="op" id="881964">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="881967">done</span>&nbsp;<span class="op" id="881972">:=</span>&nbsp;<span class="builtinfunc" id="881975">make</span><span class="op" id="881979">(</span><span class="keyword" id="881980">chan</span>&nbsp;<span class="builtintype" id="881985">bool</span><span class="op" id="881989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="881992">go</span>&nbsp;<span class="keyword" id="881995">func</span><span class="op" id="881999">(</span><span class="op" id="882000">)</span>&nbsp;<span class="op" id="882002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="882006">for</span>&nbsp;<span class="op" id="882010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="882015">select</span>&nbsp;<span class="op" id="882022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="882027">case</span>&nbsp;<span class="op" id="882032">&lt;-</span><span class="ident" id="882034">done</span><span class="op" id="882038">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="882044">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="882054">default</span><span class="op" id="882061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="882067">runtime</span><span class="op" id="882074">.</span><span class="ident" id="882075">GC</span><span class="op" id="882077">(</span><span class="op" id="882078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="882083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="882087">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="882090">}</span><span class="op" id="882091">(</span><span class="op" id="882092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="882095">for</span>&nbsp;<span class="ident" id="882099">i</span>&nbsp;<span class="op" id="882101">:=</span>&nbsp;<span class="num" id="882104">0</span><span class="op" id="882105">;</span>&nbsp;<span class="ident" id="882107">i</span>&nbsp;<span class="op" id="882109">&lt;</span>&nbsp;<span class="num" id="882111">1e4</span><span class="op" id="882114">;</span>&nbsp;<span class="ident" id="882116">i</span><span class="op" id="882117">++</span>&nbsp;<span class="op" id="882120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="882124">func</span><span class="op" id="882128">(</span><span class="op" id="882129">)</span>&nbsp;<span class="op" id="882131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="882136">defer</span>&nbsp;<span class="builtinfunc" id="882142">print</span><span class="op" id="882147">(</span><span class="string" id="882148">&#34;&#34;</span><span class="op" id="882150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="882154">}</span><span class="op" id="882155">(</span><span class="op" id="882156">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="882159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="882162">close</span><span class="op" id="882167">(</span><span class="ident" id="882168">done</span><span class="op" id="882172">)</span><br>
<span class="lineno"></span><span class="op" id="882174">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
