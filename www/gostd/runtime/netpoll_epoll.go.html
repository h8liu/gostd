<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html" class="current">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1607941">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1607996">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1608050">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1608101">//&nbsp;+build&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1608118">package</span>&nbsp;<span class="ident" id="1608126">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1608135">import</span>&nbsp;<span class="string" id="1608142">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1608152">func</span>&nbsp;<span class="ident" id="1608157">epollcreate</span><span class="op" id="1608168">(</span><span class="ident" id="1608169">size</span>&nbsp;<span class="builtintype" id="1608174">int32</span><span class="op" id="1608179">)</span>&nbsp;<span class="builtintype" id="1608181">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1608187">func</span>&nbsp;<span class="ident" id="1608192">epollcreate1</span><span class="op" id="1608204">(</span><span class="ident" id="1608205">flags</span>&nbsp;<span class="builtintype" id="1608211">int32</span><span class="op" id="1608216">)</span>&nbsp;<span class="builtintype" id="1608218">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1608225">//go:noescape</span><br>
<span class="lineno">15</span><span class="keyword" id="1608239">func</span>&nbsp;<span class="ident" id="1608244">epollctl</span><span class="op" id="1608252">(</span><span class="ident" id="1608253">epfd</span><span class="op" id="1608257">,</span>&nbsp;<span class="ident" id="1608259">op</span><span class="op" id="1608261">,</span>&nbsp;<span class="ident" id="1608263">fd</span>&nbsp;<span class="builtintype" id="1608266">int32</span><span class="op" id="1608271">,</span>&nbsp;<span class="ident" id="1608273">ev</span>&nbsp;<span class="op" id="1608276">*</span><span class="ident" id="1608277">epollevent</span><span class="op" id="1608287">)</span>&nbsp;<span class="builtintype" id="1608289">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1608296">//go:noescape</span><br>
<span class="lineno"></span><span class="keyword" id="1608310">func</span>&nbsp;<span class="ident" id="1608315">epollwait</span><span class="op" id="1608324">(</span><span class="ident" id="1608325">epfd</span>&nbsp;<span class="builtintype" id="1608330">int32</span><span class="op" id="1608335">,</span>&nbsp;<span class="ident" id="1608337">ev</span>&nbsp;<span class="op" id="1608340">*</span><span class="ident" id="1608341">epollevent</span><span class="op" id="1608351">,</span>&nbsp;<span class="ident" id="1608353">nev</span><span class="op" id="1608356">,</span>&nbsp;<span class="ident" id="1608358">timeout</span>&nbsp;<span class="builtintype" id="1608366">int32</span><span class="op" id="1608371">)</span>&nbsp;<span class="builtintype" id="1608373">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1608379">func</span>&nbsp;<span class="ident" id="1608384">closeonexec</span><span class="op" id="1608395">(</span><span class="ident" id="1608396">fd</span>&nbsp;<span class="builtintype" id="1608399">int32</span><span class="op" id="1608404">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1608407">var</span>&nbsp;<span class="op" id="1608411">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608414">epfd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1608429">int32</span>&nbsp;<span class="op" id="1608435">=</span>&nbsp;<span class="op" id="1608437">-</span><span class="num" id="1608438">1</span>&nbsp;<span class="comment" id="1608440">//&nbsp;epoll&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608461">netpolllasterr</span>&nbsp;<span class="builtintype" id="1608476">int32</span><br>
<span class="lineno"></span><span class="op" id="1608482">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="1608485">func</span>&nbsp;<span class="ident" id="1608490">netpollinit</span><span class="op" id="1608501">(</span><span class="op" id="1608502">)</span>&nbsp;<span class="op" id="1608504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608507">epfd</span>&nbsp;<span class="op" id="1608512">=</span>&nbsp;<span class="ident" id="1608514">epollcreate1</span><span class="op" id="1608526">(</span><span class="ident" id="1608527">_EPOLL_CLOEXEC</span><span class="op" id="1608541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1608544">if</span>&nbsp;<span class="ident" id="1608547">epfd</span>&nbsp;<span class="op" id="1608552">&gt;=</span>&nbsp;<span class="num" id="1608555">0</span>&nbsp;<span class="op" id="1608557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1608561">return</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1608569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608572">epfd</span>&nbsp;<span class="op" id="1608577">=</span>&nbsp;<span class="ident" id="1608579">epollcreate</span><span class="op" id="1608590">(</span><span class="num" id="1608591">1024</span><span class="op" id="1608595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1608598">if</span>&nbsp;<span class="ident" id="1608601">epfd</span>&nbsp;<span class="op" id="1608606">&gt;=</span>&nbsp;<span class="num" id="1608609">0</span>&nbsp;<span class="op" id="1608611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608615">closeonexec</span><span class="op" id="1608626">(</span><span class="ident" id="1608627">epfd</span><span class="op" id="1608631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1608635">return</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1608643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1608646">println</span><span class="op" id="1608653">(</span><span class="string" id="1608654">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;epoll&nbsp;descriptor&#34;</span><span class="op" id="1608702">,</span>&nbsp;<span class="op" id="1608704">-</span><span class="ident" id="1608705">epfd</span><span class="op" id="1608709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608712">gothrow</span><span class="op" id="1608719">(</span><span class="string" id="1608720">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;descriptor&#34;</span><span class="op" id="1608762">)</span><br>
<span class="lineno"></span><span class="op" id="1608764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="1608767">func</span>&nbsp;<span class="ident" id="1608772">netpollopen</span><span class="op" id="1608783">(</span><span class="ident" id="1608784">fd</span>&nbsp;<span class="builtintype" id="1608787">uintptr</span><span class="op" id="1608794">,</span>&nbsp;<span class="ident" id="1608796">pd</span>&nbsp;<span class="op" id="1608799">*</span><span class="ident" id="1608800">pollDesc</span><span class="op" id="1608808">)</span>&nbsp;<span class="builtintype" id="1608810">int32</span>&nbsp;<span class="op" id="1608816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1608819">var</span>&nbsp;<span class="ident" id="1608823">ev</span>&nbsp;<span class="ident" id="1608826">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608838">ev</span><span class="op" id="1608840">.</span><span class="ident" id="1608841">events</span>&nbsp;<span class="op" id="1608848">=</span>&nbsp;<span class="ident" id="1608850">_EPOLLIN</span>&nbsp;<span class="op" id="1608859">|</span>&nbsp;<span class="ident" id="1608861">_EPOLLOUT</span>&nbsp;<span class="op" id="1608871">|</span>&nbsp;<span class="ident" id="1608873">_EPOLLRDHUP</span>&nbsp;<span class="op" id="1608885">|</span>&nbsp;<span class="ident" id="1608887">_EPOLLET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1608897">*</span><span class="op" id="1608898">(</span><span class="op" id="1608899">*</span><span class="op" id="1608900">*</span><span class="ident" id="1608901">pollDesc</span><span class="op" id="1608909">)</span><span class="op" id="1608910">(</span><span class="ident" id="1608911">unsafe</span><span class="op" id="1608917">.</span><span class="ident" id="1608918">Pointer</span><span class="op" id="1608925">(</span><span class="op" id="1608926">&amp;</span><span class="ident" id="1608927">ev</span><span class="op" id="1608929">.</span><span class="ident" id="1608930">data</span><span class="op" id="1608934">)</span><span class="op" id="1608935">)</span>&nbsp;<span class="op" id="1608937">=</span>&nbsp;<span class="ident" id="1608939">pd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1608943">return</span>&nbsp;<span class="op" id="1608950">-</span><span class="ident" id="1608951">epollctl</span><span class="op" id="1608959">(</span><span class="ident" id="1608960">epfd</span><span class="op" id="1608964">,</span>&nbsp;<span class="ident" id="1608966">_EPOLL_CTL_ADD</span><span class="op" id="1608980">,</span>&nbsp;<span class="builtintype" id="1608982">int32</span><span class="op" id="1608987">(</span><span class="ident" id="1608988">fd</span><span class="op" id="1608990">)</span><span class="op" id="1608991">,</span>&nbsp;<span class="op" id="1608993">&amp;</span><span class="ident" id="1608994">ev</span><span class="op" id="1608996">)</span><br>
<span class="lineno">45</span><span class="op" id="1608998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1609001">func</span>&nbsp;<span class="ident" id="1609006">netpollclose</span><span class="op" id="1609018">(</span><span class="ident" id="1609019">fd</span>&nbsp;<span class="builtintype" id="1609022">uintptr</span><span class="op" id="1609029">)</span>&nbsp;<span class="builtintype" id="1609031">int32</span>&nbsp;<span class="op" id="1609037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609040">var</span>&nbsp;<span class="ident" id="1609044">ev</span>&nbsp;<span class="ident" id="1609047">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609059">return</span>&nbsp;<span class="op" id="1609066">-</span><span class="ident" id="1609067">epollctl</span><span class="op" id="1609075">(</span><span class="ident" id="1609076">epfd</span><span class="op" id="1609080">,</span>&nbsp;<span class="ident" id="1609082">_EPOLL_CTL_DEL</span><span class="op" id="1609096">,</span>&nbsp;<span class="builtintype" id="1609098">int32</span><span class="op" id="1609103">(</span><span class="ident" id="1609104">fd</span><span class="op" id="1609106">)</span><span class="op" id="1609107">,</span>&nbsp;<span class="op" id="1609109">&amp;</span><span class="ident" id="1609110">ev</span><span class="op" id="1609112">)</span><br>
<span class="lineno">50</span><span class="op" id="1609114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1609117">func</span>&nbsp;<span class="ident" id="1609122">netpollarm</span><span class="op" id="1609132">(</span><span class="ident" id="1609133">pd</span>&nbsp;<span class="op" id="1609136">*</span><span class="ident" id="1609137">pollDesc</span><span class="op" id="1609145">,</span>&nbsp;<span class="ident" id="1609147">mode</span>&nbsp;<span class="builtintype" id="1609152">int</span><span class="op" id="1609155">)</span>&nbsp;<span class="op" id="1609157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609160">gothrow</span><span class="op" id="1609167">(</span><span class="string" id="1609168">&#34;unused&#34;</span><span class="op" id="1609176">)</span><br>
<span class="lineno"></span><span class="op" id="1609178">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="1609181">//&nbsp;polls&nbsp;for&nbsp;ready&nbsp;network&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="1609220">//&nbsp;returns&nbsp;list&nbsp;of&nbsp;goroutines&nbsp;that&nbsp;become&nbsp;runnable</span><br>
<span class="lineno"></span><span class="keyword" id="1609271">func</span>&nbsp;<span class="ident" id="1609276">netpoll</span><span class="op" id="1609283">(</span><span class="ident" id="1609284">block</span>&nbsp;<span class="builtintype" id="1609290">bool</span><span class="op" id="1609294">)</span>&nbsp;<span class="op" id="1609296">(</span><span class="ident" id="1609297">gp</span>&nbsp;<span class="op" id="1609300">*</span><span class="ident" id="1609301">g</span><span class="op" id="1609302">)</span>&nbsp;<span class="op" id="1609304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609307">if</span>&nbsp;<span class="ident" id="1609310">epfd</span>&nbsp;<span class="op" id="1609315">==</span>&nbsp;<span class="op" id="1609318">-</span><span class="num" id="1609319">1</span>&nbsp;<span class="op" id="1609321">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609325">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1609333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609336">waitms</span>&nbsp;<span class="op" id="1609343">:=</span>&nbsp;<span class="builtintype" id="1609346">int32</span><span class="op" id="1609351">(</span><span class="op" id="1609352">-</span><span class="num" id="1609353">1</span><span class="op" id="1609354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609357">if</span>&nbsp;<span class="op" id="1609360">!</span><span class="ident" id="1609361">block</span>&nbsp;<span class="op" id="1609367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609371">waitms</span>&nbsp;<span class="op" id="1609378">=</span>&nbsp;<span class="num" id="1609380">0</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1609383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609386">var</span>&nbsp;<span class="ident" id="1609390">events</span>&nbsp;<span class="op" id="1609397">[</span><span class="num" id="1609398">128</span><span class="op" id="1609401">]</span><span class="ident" id="1609402">epollevent</span><br>
<span class="lineno"></span><span class="ident" id="1609413">retry</span><span class="op" id="1609418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609421">n</span>&nbsp;<span class="op" id="1609423">:=</span>&nbsp;<span class="ident" id="1609426">epollwait</span><span class="op" id="1609435">(</span><span class="ident" id="1609436">epfd</span><span class="op" id="1609440">,</span>&nbsp;<span class="op" id="1609442">&amp;</span><span class="ident" id="1609443">events</span><span class="op" id="1609449">[</span><span class="num" id="1609450">0</span><span class="op" id="1609451">]</span><span class="op" id="1609452">,</span>&nbsp;<span class="builtintype" id="1609454">int32</span><span class="op" id="1609459">(</span><span class="builtinfunc" id="1609460">len</span><span class="op" id="1609463">(</span><span class="ident" id="1609464">events</span><span class="op" id="1609470">)</span><span class="op" id="1609471">)</span><span class="op" id="1609472">,</span>&nbsp;<span class="ident" id="1609474">waitms</span><span class="op" id="1609480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609483">if</span>&nbsp;<span class="ident" id="1609486">n</span>&nbsp;<span class="op" id="1609488">&lt;</span>&nbsp;<span class="num" id="1609490">0</span>&nbsp;<span class="op" id="1609492">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609496">if</span>&nbsp;<span class="ident" id="1609499">n</span>&nbsp;<span class="op" id="1609501">!=</span>&nbsp;<span class="op" id="1609504">-</span><span class="ident" id="1609505">_EINTR</span>&nbsp;<span class="op" id="1609512">&amp;&amp;</span>&nbsp;<span class="ident" id="1609515">n</span>&nbsp;<span class="op" id="1609517">!=</span>&nbsp;<span class="ident" id="1609520">netpolllasterr</span>&nbsp;<span class="op" id="1609535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609540">netpolllasterr</span>&nbsp;<span class="op" id="1609555">=</span>&nbsp;<span class="ident" id="1609557">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1609562">println</span><span class="op" id="1609569">(</span><span class="string" id="1609570">&#34;runtime:&nbsp;epollwait&nbsp;on&nbsp;fd&#34;</span><span class="op" id="1609596">,</span>&nbsp;<span class="ident" id="1609598">epfd</span><span class="op" id="1609602">,</span>&nbsp;<span class="string" id="1609604">&#34;failed&nbsp;with&#34;</span><span class="op" id="1609617">,</span>&nbsp;<span class="op" id="1609619">-</span><span class="ident" id="1609620">n</span><span class="op" id="1609621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1609625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609629">goto</span>&nbsp;<span class="ident" id="1609634">retry</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1609641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609644">for</span>&nbsp;<span class="ident" id="1609648">i</span>&nbsp;<span class="op" id="1609650">:=</span>&nbsp;<span class="builtintype" id="1609653">int32</span><span class="op" id="1609658">(</span><span class="num" id="1609659">0</span><span class="op" id="1609660">)</span><span class="op" id="1609661">;</span>&nbsp;<span class="ident" id="1609663">i</span>&nbsp;<span class="op" id="1609665">&lt;</span>&nbsp;<span class="ident" id="1609667">n</span><span class="op" id="1609668">;</span>&nbsp;<span class="ident" id="1609670">i</span><span class="op" id="1609671">++</span>&nbsp;<span class="op" id="1609674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609678">ev</span>&nbsp;<span class="op" id="1609681">:=</span>&nbsp;<span class="op" id="1609684">&amp;</span><span class="ident" id="1609685">events</span><span class="op" id="1609691">[</span><span class="ident" id="1609692">i</span><span class="op" id="1609693">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609697">if</span>&nbsp;<span class="ident" id="1609700">ev</span><span class="op" id="1609702">.</span><span class="ident" id="1609703">events</span>&nbsp;<span class="op" id="1609710">==</span>&nbsp;<span class="num" id="1609713">0</span>&nbsp;<span class="op" id="1609715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609720">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1609731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609735">var</span>&nbsp;<span class="ident" id="1609739">mode</span>&nbsp;<span class="builtintype" id="1609744">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609752">if</span>&nbsp;<span class="ident" id="1609755">ev</span><span class="op" id="1609757">.</span><span class="ident" id="1609758">events</span><span class="op" id="1609764">&amp;</span><span class="op" id="1609765">(</span><span class="ident" id="1609766">_EPOLLIN</span><span class="op" id="1609774">|</span><span class="ident" id="1609775">_EPOLLRDHUP</span><span class="op" id="1609786">|</span><span class="ident" id="1609787">_EPOLLHUP</span><span class="op" id="1609796">|</span><span class="ident" id="1609797">_EPOLLERR</span><span class="op" id="1609806">)</span>&nbsp;<span class="op" id="1609808">!=</span>&nbsp;<span class="num" id="1609811">0</span>&nbsp;<span class="op" id="1609813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609818">mode</span>&nbsp;<span class="op" id="1609823">+=</span>&nbsp;<span class="string" id="1609826">&#39;r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1609832">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609836">if</span>&nbsp;<span class="ident" id="1609839">ev</span><span class="op" id="1609841">.</span><span class="ident" id="1609842">events</span><span class="op" id="1609848">&amp;</span><span class="op" id="1609849">(</span><span class="ident" id="1609850">_EPOLLOUT</span><span class="op" id="1609859">|</span><span class="ident" id="1609860">_EPOLLHUP</span><span class="op" id="1609869">|</span><span class="ident" id="1609870">_EPOLLERR</span><span class="op" id="1609879">)</span>&nbsp;<span class="op" id="1609881">!=</span>&nbsp;<span class="num" id="1609884">0</span>&nbsp;<span class="op" id="1609886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609891">mode</span>&nbsp;<span class="op" id="1609896">+=</span>&nbsp;<span class="string" id="1609899">&#39;w&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1609905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609909">if</span>&nbsp;<span class="ident" id="1609912">mode</span>&nbsp;<span class="op" id="1609917">!=</span>&nbsp;<span class="num" id="1609920">0</span>&nbsp;<span class="op" id="1609922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609927">pd</span>&nbsp;<span class="op" id="1609930">:=</span>&nbsp;<span class="op" id="1609933">*</span><span class="op" id="1609934">(</span><span class="op" id="1609935">*</span><span class="op" id="1609936">*</span><span class="ident" id="1609937">pollDesc</span><span class="op" id="1609945">)</span><span class="op" id="1609946">(</span><span class="ident" id="1609947">unsafe</span><span class="op" id="1609953">.</span><span class="ident" id="1609954">Pointer</span><span class="op" id="1609961">(</span><span class="op" id="1609962">&amp;</span><span class="ident" id="1609963">ev</span><span class="op" id="1609965">.</span><span class="ident" id="1609966">data</span><span class="op" id="1609970">)</span><span class="op" id="1609971">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609976">netpollready</span><span class="op" id="1609988">(</span><span class="op" id="1609989">(</span><span class="op" id="1609990">*</span><span class="op" id="1609991">*</span><span class="ident" id="1609992">g</span><span class="op" id="1609993">)</span><span class="op" id="1609994">(</span><span class="ident" id="1609995">noescape</span><span class="op" id="1610003">(</span><span class="ident" id="1610004">unsafe</span><span class="op" id="1610010">.</span><span class="ident" id="1610011">Pointer</span><span class="op" id="1610018">(</span><span class="op" id="1610019">&amp;</span><span class="ident" id="1610020">gp</span><span class="op" id="1610022">)</span><span class="op" id="1610023">)</span><span class="op" id="1610024">)</span><span class="op" id="1610025">,</span>&nbsp;<span class="ident" id="1610027">pd</span><span class="op" id="1610029">,</span>&nbsp;<span class="ident" id="1610031">mode</span><span class="op" id="1610035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1610039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1610042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1610045">if</span>&nbsp;<span class="ident" id="1610048">block</span>&nbsp;<span class="op" id="1610054">&amp;&amp;</span>&nbsp;<span class="ident" id="1610057">gp</span>&nbsp;<span class="op" id="1610060">==</span>&nbsp;<span class="builtintype" id="1610063">nil</span>&nbsp;<span class="op" id="1610067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1610071">goto</span>&nbsp;<span class="ident" id="1610076">retry</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1610083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1610086">return</span>&nbsp;<span class="ident" id="1610093">gp</span><br>
<span class="lineno"></span><span class="op" id="1610096">}</span>
</div>
</body>
</html>
