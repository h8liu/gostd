<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6069303">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6069358">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6069412">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6069463">//&nbsp;Package&nbsp;smtp&nbsp;implements&nbsp;the&nbsp;Simple&nbsp;Mail&nbsp;Transfer&nbsp;Protocol&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5321.</span><br>
<span class="lineno"></span><span class="comment" id="6069548">//&nbsp;It&nbsp;also&nbsp;implements&nbsp;the&nbsp;following&nbsp;extensions:</span><br>
<span class="lineno"></span><span class="comment" id="6069596">//&nbsp;&nbsp;&nbsp;&nbsp8BITMIME&nbsp;&nbsp;RFC&nbsp;1652</span><br>
<span class="lineno"></span><span class="comment" id="6069618">//&nbsp;&nbsp;&nbsp;&nbspAUTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RFC&nbsp;2554</span><br>
<span class="lineno"></span><span class="comment" id="6069640">//&nbsp;&nbsp;&nbsp;&nbspSTARTTLS&nbsp;&nbsp;RFC&nbsp;3207</span><br>
<span class="lineno">10</span><span class="comment" id="6069662">//&nbsp;Additional&nbsp;extensions&nbsp;may&nbsp;be&nbsp;handled&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="6069714">package</span>&nbsp;<span class="ident" id="6069722">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6069728">import</span>&nbsp;<span class="op" id="6069735">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069738">&#34;crypto/tls&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069752">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069771">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069781">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069787">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069794">&#34;net/textproto&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6069811">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="6069821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6069824">//&nbsp;A&nbsp;Client&nbsp;represents&nbsp;a&nbsp;client&nbsp;connection&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6069886">type</span>&nbsp;<span class="ident" id="6069891">Client</span>&nbsp;<span class="keyword" id="6069898">struct</span>&nbsp;<span class="op" id="6069905">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6069908">//&nbsp;Text&nbsp;is&nbsp;the&nbsp;textproto.Conn&nbsp;used&nbsp;by&nbsp;the&nbsp;Client.&nbsp;It&nbsp;is&nbsp;exported&nbsp;to&nbsp;allow&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6069987">//&nbsp;clients&nbsp;to&nbsp;add&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070018">Text</span>&nbsp;<span class="op" id="6070023">*</span><span class="ident" id="6070024">textproto</span><span class="op" id="6070033">.</span><span class="ident" id="6070034">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070040">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;connection&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;a&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070113">//&nbsp;connection&nbsp;later</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070134">conn</span>&nbsp;<span class="ident" id="6070139">net</span><span class="op" id="6070142">.</span><span class="ident" id="6070143">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070149">//&nbsp;whether&nbsp;the&nbsp;Client&nbsp;is&nbsp;using&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070185">tls</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6070196">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070202">serverName</span>&nbsp;<span class="builtintype" id="6070213">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070221">//&nbsp;map&nbsp;of&nbsp;supported&nbsp;extensions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070253">ext</span>&nbsp;<span class="keyword" id="6070257">map</span><span class="op" id="6070260">[</span><span class="builtintype" id="6070261">string</span><span class="op" id="6070267">]</span><span class="builtintype" id="6070268">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070276">//&nbsp;supported&nbsp;auth&nbsp;mechanisms</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070306">auth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6070317">[</span><span class="op" id="6070318">]</span><span class="builtintype" id="6070319">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070327">localName</span>&nbsp;&nbsp;<span class="builtintype" id="6070338">string</span>&nbsp;<span class="comment" id="6070345">//&nbsp;the&nbsp;name&nbsp;to&nbsp;use&nbsp;in&nbsp;HELO/EHLO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070378">didHello</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6070389">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6070396">//&nbsp;whether&nbsp;we&#39;ve&nbsp;said&nbsp;HELO/EHLO</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070429">helloError</span>&nbsp;<span class="builtintype" id="6070440">error</span>&nbsp;&nbsp;<span class="comment" id="6070447">//&nbsp;the&nbsp;error&nbsp;from&nbsp;the&nbsp;hello</span><br>
<span class="lineno"></span><span class="op" id="6070475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6070478">//&nbsp;Dial&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;connected&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server&nbsp;at&nbsp;addr.</span><br>
<span class="lineno"></span><span class="comment" id="6070544">//&nbsp;The&nbsp;addr&nbsp;must&nbsp;include&nbsp;a&nbsp;port&nbsp;number.</span><br>
<span class="lineno">45</span><span class="keyword" id="6070584">func</span>&nbsp;<span class="ident" id="6070589">Dial</span><span class="op" id="6070593">(</span><span class="ident" id="6070594">addr</span>&nbsp;<span class="builtintype" id="6070599">string</span><span class="op" id="6070605">)</span>&nbsp;<span class="op" id="6070607">(</span><span class="op" id="6070608">*</span><span class="ident" id="6070609">Client</span><span class="op" id="6070615">,</span>&nbsp;<span class="builtintype" id="6070617">error</span><span class="op" id="6070622">)</span>&nbsp;<span class="op" id="6070624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070627">conn</span><span class="op" id="6070631">,</span>&nbsp;<span class="ident" id="6070633">err</span>&nbsp;<span class="op" id="6070637">:=</span>&nbsp;<span class="ident" id="6070640">net</span><span class="op" id="6070643">.</span><span class="ident" id="6070644">Dial</span><span class="op" id="6070648">(</span><span class="string" id="6070649">&#34;tcp&#34;</span><span class="op" id="6070654">,</span>&nbsp;<span class="ident" id="6070656">addr</span><span class="op" id="6070660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070663">if</span>&nbsp;<span class="ident" id="6070666">err</span>&nbsp;<span class="op" id="6070670">!=</span>&nbsp;<span class="ident" id="6070673">nil</span>&nbsp;<span class="op" id="6070677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070681">return</span>&nbsp;<span class="ident" id="6070688">nil</span><span class="op" id="6070691">,</span>&nbsp;<span class="ident" id="6070693">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070698">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070701">host</span><span class="op" id="6070705">,</span>&nbsp;<span class="ident" id="6070707">_</span><span class="op" id="6070708">,</span>&nbsp;<span class="ident" id="6070710">_</span>&nbsp;<span class="op" id="6070712">:=</span>&nbsp;<span class="ident" id="6070715">net</span><span class="op" id="6070718">.</span><span class="ident" id="6070719">SplitHostPort</span><span class="op" id="6070732">(</span><span class="ident" id="6070733">addr</span><span class="op" id="6070737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070740">return</span>&nbsp;<span class="ident" id="6070747">NewClient</span><span class="op" id="6070756">(</span><span class="ident" id="6070757">conn</span><span class="op" id="6070761">,</span>&nbsp;<span class="ident" id="6070763">host</span><span class="op" id="6070767">)</span><br>
<span class="lineno"></span><span class="op" id="6070769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6070772">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;using&nbsp;an&nbsp;existing&nbsp;connection&nbsp;and&nbsp;host&nbsp;as&nbsp;a</span><br>
<span class="lineno">55</span><span class="comment" id="6070849">//&nbsp;server&nbsp;name&nbsp;to&nbsp;be&nbsp;used&nbsp;when&nbsp;authenticating.</span><br>
<span class="lineno"></span><span class="keyword" id="6070896">func</span>&nbsp;<span class="ident" id="6070901">NewClient</span><span class="op" id="6070910">(</span><span class="ident" id="6070911">conn</span>&nbsp;<span class="ident" id="6070916">net</span><span class="op" id="6070919">.</span><span class="ident" id="6070920">Conn</span><span class="op" id="6070924">,</span>&nbsp;<span class="ident" id="6070926">host</span>&nbsp;<span class="builtintype" id="6070931">string</span><span class="op" id="6070937">)</span>&nbsp;<span class="op" id="6070939">(</span><span class="op" id="6070940">*</span><span class="ident" id="6070941">Client</span><span class="op" id="6070947">,</span>&nbsp;<span class="builtintype" id="6070949">error</span><span class="op" id="6070954">)</span>&nbsp;<span class="op" id="6070956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070959">text</span>&nbsp;<span class="op" id="6070964">:=</span>&nbsp;<span class="ident" id="6070967">textproto</span><span class="op" id="6070976">.</span><span class="ident" id="6070977">NewConn</span><span class="op" id="6070984">(</span><span class="ident" id="6070985">conn</span><span class="op" id="6070989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070992">_</span><span class="op" id="6070993">,</span>&nbsp;<span class="ident" id="6070995">_</span><span class="op" id="6070996">,</span>&nbsp;<span class="ident" id="6070998">err</span>&nbsp;<span class="op" id="6071002">:=</span>&nbsp;<span class="ident" id="6071005">text</span><span class="op" id="6071009">.</span><span class="ident" id="6071010">ReadResponse</span><span class="op" id="6071022">(</span><span class="num" id="6071023">220</span><span class="op" id="6071026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071029">if</span>&nbsp;<span class="ident" id="6071032">err</span>&nbsp;<span class="op" id="6071036">!=</span>&nbsp;<span class="ident" id="6071039">nil</span>&nbsp;<span class="op" id="6071043">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071047">text</span><span class="op" id="6071051">.</span><span class="ident" id="6071052">Close</span><span class="op" id="6071057">(</span><span class="op" id="6071058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071062">return</span>&nbsp;<span class="ident" id="6071069">nil</span><span class="op" id="6071072">,</span>&nbsp;<span class="ident" id="6071074">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071082">c</span>&nbsp;<span class="op" id="6071084">:=</span>&nbsp;<span class="op" id="6071087">&amp;</span><span class="ident" id="6071088">Client</span><span class="op" id="6071094">{</span><span class="ident" id="6071095">Text</span><span class="op" id="6071099">:</span>&nbsp;<span class="ident" id="6071101">text</span><span class="op" id="6071105">,</span>&nbsp;<span class="ident" id="6071107">conn</span><span class="op" id="6071111">:</span>&nbsp;<span class="ident" id="6071113">conn</span><span class="op" id="6071117">,</span>&nbsp;<span class="ident" id="6071119">serverName</span><span class="op" id="6071129">:</span>&nbsp;<span class="ident" id="6071131">host</span><span class="op" id="6071135">,</span>&nbsp;<span class="ident" id="6071137">localName</span><span class="op" id="6071146">:</span>&nbsp;<span class="string" id="6071148">&#34;localhost&#34;</span><span class="op" id="6071159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071162">return</span>&nbsp;<span class="ident" id="6071169">c</span><span class="op" id="6071170">,</span>&nbsp;<span class="ident" id="6071172">nil</span><br>
<span class="lineno">65</span><span class="op" id="6071176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6071179">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6071211">func</span>&nbsp;<span class="op" id="6071216">(</span><span class="ident" id="6071217">c</span>&nbsp;<span class="op" id="6071219">*</span><span class="ident" id="6071220">Client</span><span class="op" id="6071226">)</span>&nbsp;<span class="ident" id="6071228">Close</span><span class="op" id="6071233">(</span><span class="op" id="6071234">)</span>&nbsp;<span class="builtintype" id="6071236">error</span>&nbsp;<span class="op" id="6071242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071245">return</span>&nbsp;<span class="ident" id="6071252">c</span><span class="op" id="6071253">.</span><span class="ident" id="6071254">Text</span><span class="op" id="6071258">.</span><span class="ident" id="6071259">Close</span><span class="op" id="6071264">(</span><span class="op" id="6071265">)</span><br>
<span class="lineno">70</span><span class="op" id="6071267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6071270">//&nbsp;hello&nbsp;runs&nbsp;a&nbsp;hello&nbsp;exchange&nbsp;if&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="6071312">func</span>&nbsp;<span class="op" id="6071317">(</span><span class="ident" id="6071318">c</span>&nbsp;<span class="op" id="6071320">*</span><span class="ident" id="6071321">Client</span><span class="op" id="6071327">)</span>&nbsp;<span class="ident" id="6071329">hello</span><span class="op" id="6071334">(</span><span class="op" id="6071335">)</span>&nbsp;<span class="builtintype" id="6071337">error</span>&nbsp;<span class="op" id="6071343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071346">if</span>&nbsp;<span class="op" id="6071349">!</span><span class="ident" id="6071350">c</span><span class="op" id="6071351">.</span><span class="ident" id="6071352">didHello</span>&nbsp;<span class="op" id="6071361">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071365">c</span><span class="op" id="6071366">.</span><span class="ident" id="6071367">didHello</span>&nbsp;<span class="op" id="6071376">=</span>&nbsp;<span class="builtintype" id="6071378">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071385">err</span>&nbsp;<span class="op" id="6071389">:=</span>&nbsp;<span class="ident" id="6071392">c</span><span class="op" id="6071393">.</span><span class="ident" id="6071394">ehlo</span><span class="op" id="6071398">(</span><span class="op" id="6071399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071403">if</span>&nbsp;<span class="ident" id="6071406">err</span>&nbsp;<span class="op" id="6071410">!=</span>&nbsp;<span class="ident" id="6071413">nil</span>&nbsp;<span class="op" id="6071417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071422">c</span><span class="op" id="6071423">.</span><span class="ident" id="6071424">helloError</span>&nbsp;<span class="op" id="6071435">=</span>&nbsp;<span class="ident" id="6071437">c</span><span class="op" id="6071438">.</span><span class="ident" id="6071439">helo</span><span class="op" id="6071443">(</span><span class="op" id="6071444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071448">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071454">return</span>&nbsp;<span class="ident" id="6071461">c</span><span class="op" id="6071462">.</span><span class="ident" id="6071463">helloError</span><br>
<span class="lineno"></span><span class="op" id="6071474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6071477">//&nbsp;Hello&nbsp;sends&nbsp;a&nbsp;HELO&nbsp;or&nbsp;EHLO&nbsp;to&nbsp;the&nbsp;server&nbsp;as&nbsp;the&nbsp;given&nbsp;host&nbsp;name.</span><br>
<span class="lineno">85</span><span class="comment" id="6071545">//&nbsp;Calling&nbsp;this&nbsp;method&nbsp;is&nbsp;only&nbsp;necessary&nbsp;if&nbsp;the&nbsp;client&nbsp;needs&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="6071614">//&nbsp;over&nbsp;the&nbsp;host&nbsp;name&nbsp;used.&nbsp;&nbsp;The&nbsp;client&nbsp;will&nbsp;introduce&nbsp;itself&nbsp;as&nbsp;&#34;localhost&#34;</span><br>
<span class="lineno"></span><span class="comment" id="6071691">//&nbsp;automatically&nbsp;otherwise.&nbsp;&nbsp;If&nbsp;Hello&nbsp;is&nbsp;called,&nbsp;it&nbsp;must&nbsp;be&nbsp;called&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="6071765">//&nbsp;any&nbsp;of&nbsp;the&nbsp;other&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="6071794">func</span>&nbsp;<span class="op" id="6071799">(</span><span class="ident" id="6071800">c</span>&nbsp;<span class="op" id="6071802">*</span><span class="ident" id="6071803">Client</span><span class="op" id="6071809">)</span>&nbsp;<span class="ident" id="6071811">Hello</span><span class="op" id="6071816">(</span><span class="ident" id="6071817">localName</span>&nbsp;<span class="builtintype" id="6071827">string</span><span class="op" id="6071833">)</span>&nbsp;<span class="builtintype" id="6071835">error</span>&nbsp;<span class="op" id="6071841">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071844">if</span>&nbsp;<span class="ident" id="6071847">c</span><span class="op" id="6071848">.</span><span class="ident" id="6071849">didHello</span>&nbsp;<span class="op" id="6071858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071862">return</span>&nbsp;<span class="ident" id="6071869">errors</span><span class="op" id="6071875">.</span><span class="ident" id="6071876">New</span><span class="op" id="6071879">(</span><span class="string" id="6071880">&#34;smtp:&nbsp;Hello&nbsp;called&nbsp;after&nbsp;other&nbsp;methods&#34;</span><span class="op" id="6071920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071926">c</span><span class="op" id="6071927">.</span><span class="ident" id="6071928">localName</span>&nbsp;<span class="op" id="6071938">=</span>&nbsp;<span class="ident" id="6071940">localName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071951">return</span>&nbsp;<span class="ident" id="6071958">c</span><span class="op" id="6071959">.</span><span class="ident" id="6071960">hello</span><span class="op" id="6071965">(</span><span class="op" id="6071966">)</span><br>
<span class="lineno">95</span><span class="op" id="6071968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6071971">//&nbsp;cmd&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;that&nbsp;sends&nbsp;a&nbsp;command&nbsp;and&nbsp;returns&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span><span class="keyword" id="6072050">func</span>&nbsp;<span class="op" id="6072055">(</span><span class="ident" id="6072056">c</span>&nbsp;<span class="op" id="6072058">*</span><span class="ident" id="6072059">Client</span><span class="op" id="6072065">)</span>&nbsp;<span class="ident" id="6072067">cmd</span><span class="op" id="6072070">(</span><span class="ident" id="6072071">expectCode</span>&nbsp;<span class="builtintype" id="6072082">int</span><span class="op" id="6072085">,</span>&nbsp;<span class="ident" id="6072087">format</span>&nbsp;<span class="builtintype" id="6072094">string</span><span class="op" id="6072100">,</span>&nbsp;<span class="ident" id="6072102">args</span>&nbsp;<span class="op" id="6072107">...</span><span class="keyword" id="6072110">interface</span><span class="op" id="6072119">{</span><span class="op" id="6072120">}</span><span class="op" id="6072121">)</span>&nbsp;<span class="op" id="6072123">(</span><span class="builtintype" id="6072124">int</span><span class="op" id="6072127">,</span>&nbsp;<span class="builtintype" id="6072129">string</span><span class="op" id="6072135">,</span>&nbsp;<span class="builtintype" id="6072137">error</span><span class="op" id="6072142">)</span>&nbsp;<span class="op" id="6072144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072147">id</span><span class="op" id="6072149">,</span>&nbsp;<span class="ident" id="6072151">err</span>&nbsp;<span class="op" id="6072155">:=</span>&nbsp;<span class="ident" id="6072158">c</span><span class="op" id="6072159">.</span><span class="ident" id="6072160">Text</span><span class="op" id="6072164">.</span><span class="ident" id="6072165">Cmd</span><span class="op" id="6072168">(</span><span class="ident" id="6072169">format</span><span class="op" id="6072175">,</span>&nbsp;<span class="ident" id="6072177">args</span><span class="op" id="6072181">...</span><span class="op" id="6072184">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072187">if</span>&nbsp;<span class="ident" id="6072190">err</span>&nbsp;<span class="op" id="6072194">!=</span>&nbsp;<span class="ident" id="6072197">nil</span>&nbsp;<span class="op" id="6072201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072205">return</span>&nbsp;<span class="num" id="6072212">0</span><span class="op" id="6072213">,</span>&nbsp;<span class="string" id="6072215">&#34;&#34;</span><span class="op" id="6072217">,</span>&nbsp;<span class="ident" id="6072219">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072227">c</span><span class="op" id="6072228">.</span><span class="ident" id="6072229">Text</span><span class="op" id="6072233">.</span><span class="ident" id="6072234">StartResponse</span><span class="op" id="6072247">(</span><span class="ident" id="6072248">id</span><span class="op" id="6072250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072253">defer</span>&nbsp;<span class="ident" id="6072259">c</span><span class="op" id="6072260">.</span><span class="ident" id="6072261">Text</span><span class="op" id="6072265">.</span><span class="ident" id="6072266">EndResponse</span><span class="op" id="6072277">(</span><span class="ident" id="6072278">id</span><span class="op" id="6072280">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072283">code</span><span class="op" id="6072287">,</span>&nbsp;<span class="ident" id="6072289">msg</span><span class="op" id="6072292">,</span>&nbsp;<span class="ident" id="6072294">err</span>&nbsp;<span class="op" id="6072298">:=</span>&nbsp;<span class="ident" id="6072301">c</span><span class="op" id="6072302">.</span><span class="ident" id="6072303">Text</span><span class="op" id="6072307">.</span><span class="ident" id="6072308">ReadResponse</span><span class="op" id="6072320">(</span><span class="ident" id="6072321">expectCode</span><span class="op" id="6072331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072334">return</span>&nbsp;<span class="ident" id="6072341">code</span><span class="op" id="6072345">,</span>&nbsp;<span class="ident" id="6072347">msg</span><span class="op" id="6072350">,</span>&nbsp;<span class="ident" id="6072352">err</span><br>
<span class="lineno"></span><span class="op" id="6072356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6072359">//&nbsp;helo&nbsp;sends&nbsp;the&nbsp;HELO&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;when&nbsp;the</span><br>
<span class="lineno">110</span><span class="comment" id="6072438">//&nbsp;server&nbsp;does&nbsp;not&nbsp;support&nbsp;ehlo.</span><br>
<span class="lineno"></span><span class="keyword" id="6072471">func</span>&nbsp;<span class="op" id="6072476">(</span><span class="ident" id="6072477">c</span>&nbsp;<span class="op" id="6072479">*</span><span class="ident" id="6072480">Client</span><span class="op" id="6072486">)</span>&nbsp;<span class="ident" id="6072488">helo</span><span class="op" id="6072492">(</span><span class="op" id="6072493">)</span>&nbsp;<span class="builtintype" id="6072495">error</span>&nbsp;<span class="op" id="6072501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072504">c</span><span class="op" id="6072505">.</span><span class="ident" id="6072506">ext</span>&nbsp;<span class="op" id="6072510">=</span>&nbsp;<span class="ident" id="6072512">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072517">_</span><span class="op" id="6072518">,</span>&nbsp;<span class="ident" id="6072520">_</span><span class="op" id="6072521">,</span>&nbsp;<span class="ident" id="6072523">err</span>&nbsp;<span class="op" id="6072527">:=</span>&nbsp;<span class="ident" id="6072530">c</span><span class="op" id="6072531">.</span><span class="ident" id="6072532">cmd</span><span class="op" id="6072535">(</span><span class="num" id="6072536">250</span><span class="op" id="6072539">,</span>&nbsp;<span class="string" id="6072541">&#34;HELO&nbsp;%s&#34;</span><span class="op" id="6072550">,</span>&nbsp;<span class="ident" id="6072552">c</span><span class="op" id="6072553">.</span><span class="ident" id="6072554">localName</span><span class="op" id="6072563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072566">return</span>&nbsp;<span class="ident" id="6072573">err</span><br>
<span class="lineno">115</span><span class="op" id="6072577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6072580">//&nbsp;ehlo&nbsp;sends&nbsp;the&nbsp;EHLO&nbsp;(extended&nbsp;hello)&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="6072647">//&nbsp;should&nbsp;be&nbsp;the&nbsp;preferred&nbsp;greeting&nbsp;for&nbsp;servers&nbsp;that&nbsp;support&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="6072712">func</span>&nbsp;<span class="op" id="6072717">(</span><span class="ident" id="6072718">c</span>&nbsp;<span class="op" id="6072720">*</span><span class="ident" id="6072721">Client</span><span class="op" id="6072727">)</span>&nbsp;<span class="ident" id="6072729">ehlo</span><span class="op" id="6072733">(</span><span class="op" id="6072734">)</span>&nbsp;<span class="builtintype" id="6072736">error</span>&nbsp;<span class="op" id="6072742">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072745">_</span><span class="op" id="6072746">,</span>&nbsp;<span class="ident" id="6072748">msg</span><span class="op" id="6072751">,</span>&nbsp;<span class="ident" id="6072753">err</span>&nbsp;<span class="op" id="6072757">:=</span>&nbsp;<span class="ident" id="6072760">c</span><span class="op" id="6072761">.</span><span class="ident" id="6072762">cmd</span><span class="op" id="6072765">(</span><span class="num" id="6072766">250</span><span class="op" id="6072769">,</span>&nbsp;<span class="string" id="6072771">&#34;EHLO&nbsp;%s&#34;</span><span class="op" id="6072780">,</span>&nbsp;<span class="ident" id="6072782">c</span><span class="op" id="6072783">.</span><span class="ident" id="6072784">localName</span><span class="op" id="6072793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072796">if</span>&nbsp;<span class="ident" id="6072799">err</span>&nbsp;<span class="op" id="6072803">!=</span>&nbsp;<span class="ident" id="6072806">nil</span>&nbsp;<span class="op" id="6072810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072814">return</span>&nbsp;<span class="ident" id="6072821">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072829">ext</span>&nbsp;<span class="op" id="6072833">:=</span>&nbsp;<span class="builtinfunc" id="6072836">make</span><span class="op" id="6072840">(</span><span class="keyword" id="6072841">map</span><span class="op" id="6072844">[</span><span class="builtintype" id="6072845">string</span><span class="op" id="6072851">]</span><span class="builtintype" id="6072852">string</span><span class="op" id="6072858">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072861">extList</span>&nbsp;<span class="op" id="6072869">:=</span>&nbsp;<span class="ident" id="6072872">strings</span><span class="op" id="6072879">.</span><span class="ident" id="6072880">Split</span><span class="op" id="6072885">(</span><span class="ident" id="6072886">msg</span><span class="op" id="6072889">,</span>&nbsp;<span class="string" id="6072891">&#34;\n&#34;</span><span class="op" id="6072895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072898">if</span>&nbsp;<span class="builtinfunc" id="6072901">len</span><span class="op" id="6072904">(</span><span class="ident" id="6072905">extList</span><span class="op" id="6072912">)</span>&nbsp;<span class="op" id="6072914">&gt;</span>&nbsp;<span class="num" id="6072916">1</span>&nbsp;<span class="op" id="6072918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072922">extList</span>&nbsp;<span class="op" id="6072930">=</span>&nbsp;<span class="ident" id="6072932">extList</span><span class="op" id="6072939">[</span><span class="num" id="6072940">1</span><span class="op" id="6072941">:</span><span class="op" id="6072942">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072946">for</span>&nbsp;<span class="ident" id="6072950">_</span><span class="op" id="6072951">,</span>&nbsp;<span class="ident" id="6072953">line</span>&nbsp;<span class="op" id="6072958">:=</span>&nbsp;<span class="keyword" id="6072961">range</span>&nbsp;<span class="ident" id="6072967">extList</span>&nbsp;<span class="op" id="6072975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072980">args</span>&nbsp;<span class="op" id="6072985">:=</span>&nbsp;<span class="ident" id="6072988">strings</span><span class="op" id="6072995">.</span><span class="ident" id="6072996">SplitN</span><span class="op" id="6073002">(</span><span class="ident" id="6073003">line</span><span class="op" id="6073007">,</span>&nbsp;<span class="string" id="6073009">&#34;&nbsp;&#34;</span><span class="op" id="6073012">,</span>&nbsp;<span class="num" id="6073014">2</span><span class="op" id="6073015">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073020">if</span>&nbsp;<span class="builtinfunc" id="6073023">len</span><span class="op" id="6073026">(</span><span class="ident" id="6073027">args</span><span class="op" id="6073031">)</span>&nbsp;<span class="op" id="6073033">&gt;</span>&nbsp;<span class="num" id="6073035">1</span>&nbsp;<span class="op" id="6073037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073043">ext</span><span class="op" id="6073046">[</span><span class="ident" id="6073047">args</span><span class="op" id="6073051">[</span><span class="num" id="6073052">0</span><span class="op" id="6073053">]</span><span class="op" id="6073054">]</span>&nbsp;<span class="op" id="6073056">=</span>&nbsp;<span class="ident" id="6073058">args</span><span class="op" id="6073062">[</span><span class="num" id="6073063">1</span><span class="op" id="6073064">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073069">}</span>&nbsp;<span class="keyword" id="6073071">else</span>&nbsp;<span class="op" id="6073076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073082">ext</span><span class="op" id="6073085">[</span><span class="ident" id="6073086">args</span><span class="op" id="6073090">[</span><span class="num" id="6073091">0</span><span class="op" id="6073092">]</span><span class="op" id="6073093">]</span>&nbsp;<span class="op" id="6073095">=</span>&nbsp;<span class="string" id="6073097">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073103">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073113">if</span>&nbsp;<span class="ident" id="6073116">mechs</span><span class="op" id="6073121">,</span>&nbsp;<span class="ident" id="6073123">ok</span>&nbsp;<span class="op" id="6073126">:=</span>&nbsp;<span class="ident" id="6073129">ext</span><span class="op" id="6073132">[</span><span class="string" id="6073133">&#34;AUTH&#34;</span><span class="op" id="6073139">]</span><span class="op" id="6073140">;</span>&nbsp;<span class="ident" id="6073142">ok</span>&nbsp;<span class="op" id="6073145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073149">c</span><span class="op" id="6073150">.</span><span class="ident" id="6073151">auth</span>&nbsp;<span class="op" id="6073156">=</span>&nbsp;<span class="ident" id="6073158">strings</span><span class="op" id="6073165">.</span><span class="ident" id="6073166">Split</span><span class="op" id="6073171">(</span><span class="ident" id="6073172">mechs</span><span class="op" id="6073177">,</span>&nbsp;<span class="string" id="6073179">&#34;&nbsp;&#34;</span><span class="op" id="6073182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073185">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073188">c</span><span class="op" id="6073189">.</span><span class="ident" id="6073190">ext</span>&nbsp;<span class="op" id="6073194">=</span>&nbsp;<span class="ident" id="6073196">ext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073201">return</span>&nbsp;<span class="ident" id="6073208">err</span><br>
<span class="lineno"></span><span class="op" id="6073212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6073215">//&nbsp;StartTLS&nbsp;sends&nbsp;the&nbsp;STARTTLS&nbsp;command&nbsp;and&nbsp;encrypts&nbsp;all&nbsp;further&nbsp;communication.</span><br>
<span class="lineno">145</span><span class="comment" id="6073294">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;STARTTLS&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="6073371">func</span>&nbsp;<span class="op" id="6073376">(</span><span class="ident" id="6073377">c</span>&nbsp;<span class="op" id="6073379">*</span><span class="ident" id="6073380">Client</span><span class="op" id="6073386">)</span>&nbsp;<span class="ident" id="6073388">StartTLS</span><span class="op" id="6073396">(</span><span class="ident" id="6073397">config</span>&nbsp;<span class="op" id="6073404">*</span><span class="ident" id="6073405">tls</span><span class="op" id="6073408">.</span><span class="ident" id="6073409">Config</span><span class="op" id="6073415">)</span>&nbsp;<span class="builtintype" id="6073417">error</span>&nbsp;<span class="op" id="6073423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073426">if</span>&nbsp;<span class="ident" id="6073429">err</span>&nbsp;<span class="op" id="6073433">:=</span>&nbsp;<span class="ident" id="6073436">c</span><span class="op" id="6073437">.</span><span class="ident" id="6073438">hello</span><span class="op" id="6073443">(</span><span class="op" id="6073444">)</span><span class="op" id="6073445">;</span>&nbsp;<span class="ident" id="6073447">err</span>&nbsp;<span class="op" id="6073451">!=</span>&nbsp;<span class="ident" id="6073454">nil</span>&nbsp;<span class="op" id="6073458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073462">return</span>&nbsp;<span class="ident" id="6073469">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073474">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073477">_</span><span class="op" id="6073478">,</span>&nbsp;<span class="ident" id="6073480">_</span><span class="op" id="6073481">,</span>&nbsp;<span class="ident" id="6073483">err</span>&nbsp;<span class="op" id="6073487">:=</span>&nbsp;<span class="ident" id="6073490">c</span><span class="op" id="6073491">.</span><span class="ident" id="6073492">cmd</span><span class="op" id="6073495">(</span><span class="num" id="6073496">220</span><span class="op" id="6073499">,</span>&nbsp;<span class="string" id="6073501">&#34;STARTTLS&#34;</span><span class="op" id="6073511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073514">if</span>&nbsp;<span class="ident" id="6073517">err</span>&nbsp;<span class="op" id="6073521">!=</span>&nbsp;<span class="ident" id="6073524">nil</span>&nbsp;<span class="op" id="6073528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073532">return</span>&nbsp;<span class="ident" id="6073539">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073547">c</span><span class="op" id="6073548">.</span><span class="ident" id="6073549">conn</span>&nbsp;<span class="op" id="6073554">=</span>&nbsp;<span class="ident" id="6073556">tls</span><span class="op" id="6073559">.</span><span class="ident" id="6073560">Client</span><span class="op" id="6073566">(</span><span class="ident" id="6073567">c</span><span class="op" id="6073568">.</span><span class="ident" id="6073569">conn</span><span class="op" id="6073573">,</span>&nbsp;<span class="ident" id="6073575">config</span><span class="op" id="6073581">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073584">c</span><span class="op" id="6073585">.</span><span class="ident" id="6073586">Text</span>&nbsp;<span class="op" id="6073591">=</span>&nbsp;<span class="ident" id="6073593">textproto</span><span class="op" id="6073602">.</span><span class="ident" id="6073603">NewConn</span><span class="op" id="6073610">(</span><span class="ident" id="6073611">c</span><span class="op" id="6073612">.</span><span class="ident" id="6073613">conn</span><span class="op" id="6073617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073620">c</span><span class="op" id="6073621">.</span><span class="ident" id="6073622">tls</span>&nbsp;<span class="op" id="6073626">=</span>&nbsp;<span class="builtintype" id="6073628">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073634">return</span>&nbsp;<span class="ident" id="6073641">c</span><span class="op" id="6073642">.</span><span class="ident" id="6073643">ehlo</span><span class="op" id="6073647">(</span><span class="op" id="6073648">)</span><br>
<span class="lineno"></span><span class="op" id="6073650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6073653">//&nbsp;Verify&nbsp;checks&nbsp;the&nbsp;validity&nbsp;of&nbsp;an&nbsp;email&nbsp;address&nbsp;on&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6073718">//&nbsp;If&nbsp;Verify&nbsp;returns&nbsp;nil,&nbsp;the&nbsp;address&nbsp;is&nbsp;valid.&nbsp;A&nbsp;non-nil&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="6073783">//&nbsp;does&nbsp;not&nbsp;necessarily&nbsp;indicate&nbsp;an&nbsp;invalid&nbsp;address.&nbsp;Many&nbsp;servers</span><br>
<span class="lineno"></span><span class="comment" id="6073849">//&nbsp;will&nbsp;not&nbsp;verify&nbsp;addresses&nbsp;for&nbsp;security&nbsp;reasons.</span><br>
<span class="lineno"></span><span class="keyword" id="6073900">func</span>&nbsp;<span class="op" id="6073905">(</span><span class="ident" id="6073906">c</span>&nbsp;<span class="op" id="6073908">*</span><span class="ident" id="6073909">Client</span><span class="op" id="6073915">)</span>&nbsp;<span class="ident" id="6073917">Verify</span><span class="op" id="6073923">(</span><span class="ident" id="6073924">addr</span>&nbsp;<span class="builtintype" id="6073929">string</span><span class="op" id="6073935">)</span>&nbsp;<span class="builtintype" id="6073937">error</span>&nbsp;<span class="op" id="6073943">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073946">if</span>&nbsp;<span class="ident" id="6073949">err</span>&nbsp;<span class="op" id="6073953">:=</span>&nbsp;<span class="ident" id="6073956">c</span><span class="op" id="6073957">.</span><span class="ident" id="6073958">hello</span><span class="op" id="6073963">(</span><span class="op" id="6073964">)</span><span class="op" id="6073965">;</span>&nbsp;<span class="ident" id="6073967">err</span>&nbsp;<span class="op" id="6073971">!=</span>&nbsp;<span class="ident" id="6073974">nil</span>&nbsp;<span class="op" id="6073978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073982">return</span>&nbsp;<span class="ident" id="6073989">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073997">_</span><span class="op" id="6073998">,</span>&nbsp;<span class="ident" id="6074000">_</span><span class="op" id="6074001">,</span>&nbsp;<span class="ident" id="6074003">err</span>&nbsp;<span class="op" id="6074007">:=</span>&nbsp;<span class="ident" id="6074010">c</span><span class="op" id="6074011">.</span><span class="ident" id="6074012">cmd</span><span class="op" id="6074015">(</span><span class="num" id="6074016">250</span><span class="op" id="6074019">,</span>&nbsp;<span class="string" id="6074021">&#34;VRFY&nbsp;%s&#34;</span><span class="op" id="6074030">,</span>&nbsp;<span class="ident" id="6074032">addr</span><span class="op" id="6074036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074039">return</span>&nbsp;<span class="ident" id="6074046">err</span><br>
<span class="lineno">170</span><span class="op" id="6074050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6074053">//&nbsp;Auth&nbsp;authenticates&nbsp;a&nbsp;client&nbsp;using&nbsp;the&nbsp;provided&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="comment" id="6074129">//&nbsp;A&nbsp;failed&nbsp;authentication&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="6074179">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;AUTH&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno">175</span><span class="keyword" id="6074252">func</span>&nbsp;<span class="op" id="6074257">(</span><span class="ident" id="6074258">c</span>&nbsp;<span class="op" id="6074260">*</span><span class="ident" id="6074261">Client</span><span class="op" id="6074267">)</span>&nbsp;<span class="ident" id="6074269">Auth</span><span class="op" id="6074273">(</span><span class="ident" id="6074274">a</span>&nbsp;<span class="ident" id="6074276">Auth</span><span class="op" id="6074280">)</span>&nbsp;<span class="builtintype" id="6074282">error</span>&nbsp;<span class="op" id="6074288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074291">if</span>&nbsp;<span class="ident" id="6074294">err</span>&nbsp;<span class="op" id="6074298">:=</span>&nbsp;<span class="ident" id="6074301">c</span><span class="op" id="6074302">.</span><span class="ident" id="6074303">hello</span><span class="op" id="6074308">(</span><span class="op" id="6074309">)</span><span class="op" id="6074310">;</span>&nbsp;<span class="ident" id="6074312">err</span>&nbsp;<span class="op" id="6074316">!=</span>&nbsp;<span class="ident" id="6074319">nil</span>&nbsp;<span class="op" id="6074323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074327">return</span>&nbsp;<span class="ident" id="6074334">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074342">encoding</span>&nbsp;<span class="op" id="6074351">:=</span>&nbsp;<span class="ident" id="6074354">base64</span><span class="op" id="6074360">.</span><span class="ident" id="6074361">StdEncoding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074374">mech</span><span class="op" id="6074378">,</span>&nbsp;<span class="ident" id="6074380">resp</span><span class="op" id="6074384">,</span>&nbsp;<span class="ident" id="6074386">err</span>&nbsp;<span class="op" id="6074390">:=</span>&nbsp;<span class="ident" id="6074393">a</span><span class="op" id="6074394">.</span><span class="ident" id="6074395">Start</span><span class="op" id="6074400">(</span><span class="op" id="6074401">&amp;</span><span class="ident" id="6074402">ServerInfo</span><span class="op" id="6074412">{</span><span class="ident" id="6074413">c</span><span class="op" id="6074414">.</span><span class="ident" id="6074415">serverName</span><span class="op" id="6074425">,</span>&nbsp;<span class="ident" id="6074427">c</span><span class="op" id="6074428">.</span><span class="ident" id="6074429">tls</span><span class="op" id="6074432">,</span>&nbsp;<span class="ident" id="6074434">c</span><span class="op" id="6074435">.</span><span class="ident" id="6074436">auth</span><span class="op" id="6074440">}</span><span class="op" id="6074441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074444">if</span>&nbsp;<span class="ident" id="6074447">err</span>&nbsp;<span class="op" id="6074451">!=</span>&nbsp;<span class="ident" id="6074454">nil</span>&nbsp;<span class="op" id="6074458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074462">c</span><span class="op" id="6074463">.</span><span class="ident" id="6074464">Quit</span><span class="op" id="6074468">(</span><span class="op" id="6074469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074473">return</span>&nbsp;<span class="ident" id="6074480">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074485">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074488">resp64</span>&nbsp;<span class="op" id="6074495">:=</span>&nbsp;<span class="builtinfunc" id="6074498">make</span><span class="op" id="6074502">(</span><span class="op" id="6074503">[</span><span class="op" id="6074504">]</span><span class="builtintype" id="6074505">byte</span><span class="op" id="6074509">,</span>&nbsp;<span class="ident" id="6074511">encoding</span><span class="op" id="6074519">.</span><span class="ident" id="6074520">EncodedLen</span><span class="op" id="6074530">(</span><span class="builtinfunc" id="6074531">len</span><span class="op" id="6074534">(</span><span class="ident" id="6074535">resp</span><span class="op" id="6074539">)</span><span class="op" id="6074540">)</span><span class="op" id="6074541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074544">encoding</span><span class="op" id="6074552">.</span><span class="ident" id="6074553">Encode</span><span class="op" id="6074559">(</span><span class="ident" id="6074560">resp64</span><span class="op" id="6074566">,</span>&nbsp;<span class="ident" id="6074568">resp</span><span class="op" id="6074572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074575">code</span><span class="op" id="6074579">,</span>&nbsp;<span class="ident" id="6074581">msg64</span><span class="op" id="6074586">,</span>&nbsp;<span class="ident" id="6074588">err</span>&nbsp;<span class="op" id="6074592">:=</span>&nbsp;<span class="ident" id="6074595">c</span><span class="op" id="6074596">.</span><span class="ident" id="6074597">cmd</span><span class="op" id="6074600">(</span><span class="num" id="6074601">0</span><span class="op" id="6074602">,</span>&nbsp;<span class="string" id="6074604">&#34;AUTH&nbsp;%s&nbsp;%s&#34;</span><span class="op" id="6074616">,</span>&nbsp;<span class="ident" id="6074618">mech</span><span class="op" id="6074622">,</span>&nbsp;<span class="ident" id="6074624">resp64</span><span class="op" id="6074630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074633">for</span>&nbsp;<span class="ident" id="6074637">err</span>&nbsp;<span class="op" id="6074641">==</span>&nbsp;<span class="ident" id="6074644">nil</span>&nbsp;<span class="op" id="6074648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074652">var</span>&nbsp;<span class="ident" id="6074656">msg</span>&nbsp;<span class="op" id="6074660">[</span><span class="op" id="6074661">]</span><span class="builtintype" id="6074662">byte</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074669">switch</span>&nbsp;<span class="ident" id="6074676">code</span>&nbsp;<span class="op" id="6074681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074685">case</span>&nbsp;<span class="num" id="6074690">334</span><span class="op" id="6074693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074698">msg</span><span class="op" id="6074701">,</span>&nbsp;<span class="ident" id="6074703">err</span>&nbsp;<span class="op" id="6074707">=</span>&nbsp;<span class="ident" id="6074709">encoding</span><span class="op" id="6074717">.</span><span class="ident" id="6074718">DecodeString</span><span class="op" id="6074730">(</span><span class="ident" id="6074731">msg64</span><span class="op" id="6074736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074740">case</span>&nbsp;<span class="num" id="6074745">235</span><span class="op" id="6074748">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6074753">//&nbsp;the&nbsp;last&nbsp;message&nbsp;isn&#39;t&nbsp;base64&nbsp;because&nbsp;it&nbsp;isn&#39;t&nbsp;a&nbsp;challenge</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074818">msg</span>&nbsp;<span class="op" id="6074822">=</span>&nbsp;<span class="op" id="6074824">[</span><span class="op" id="6074825">]</span><span class="builtintype" id="6074826">byte</span><span class="op" id="6074830">(</span><span class="ident" id="6074831">msg64</span><span class="op" id="6074836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074840">default</span><span class="op" id="6074847">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074852">err</span>&nbsp;<span class="op" id="6074856">=</span>&nbsp;<span class="op" id="6074858">&amp;</span><span class="ident" id="6074859">textproto</span><span class="op" id="6074868">.</span><span class="ident" id="6074869">Error</span><span class="op" id="6074874">{</span><span class="ident" id="6074875">Code</span><span class="op" id="6074879">:</span>&nbsp;<span class="ident" id="6074881">code</span><span class="op" id="6074885">,</span>&nbsp;<span class="ident" id="6074887">Msg</span><span class="op" id="6074890">:</span>&nbsp;<span class="ident" id="6074892">msg64</span><span class="op" id="6074897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074905">if</span>&nbsp;<span class="ident" id="6074908">err</span>&nbsp;<span class="op" id="6074912">==</span>&nbsp;<span class="ident" id="6074915">nil</span>&nbsp;<span class="op" id="6074919">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074924">resp</span><span class="op" id="6074928">,</span>&nbsp;<span class="ident" id="6074930">err</span>&nbsp;<span class="op" id="6074934">=</span>&nbsp;<span class="ident" id="6074936">a</span><span class="op" id="6074937">.</span><span class="ident" id="6074938">Next</span><span class="op" id="6074942">(</span><span class="ident" id="6074943">msg</span><span class="op" id="6074946">,</span>&nbsp;<span class="ident" id="6074948">code</span>&nbsp;<span class="op" id="6074953">==</span>&nbsp;<span class="num" id="6074956">334</span><span class="op" id="6074959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074967">if</span>&nbsp;<span class="ident" id="6074970">err</span>&nbsp;<span class="op" id="6074974">!=</span>&nbsp;<span class="ident" id="6074977">nil</span>&nbsp;<span class="op" id="6074981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6074986">//&nbsp;abort&nbsp;the&nbsp;AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075007">c</span><span class="op" id="6075008">.</span><span class="ident" id="6075009">cmd</span><span class="op" id="6075012">(</span><span class="num" id="6075013">501</span><span class="op" id="6075016">,</span>&nbsp;<span class="string" id="6075018">&#34;*&#34;</span><span class="op" id="6075021">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075026">c</span><span class="op" id="6075027">.</span><span class="ident" id="6075028">Quit</span><span class="op" id="6075032">(</span><span class="op" id="6075033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075038">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075050">if</span>&nbsp;<span class="ident" id="6075053">resp</span>&nbsp;<span class="op" id="6075058">==</span>&nbsp;<span class="ident" id="6075061">nil</span>&nbsp;<span class="op" id="6075065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075070">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075082">resp64</span>&nbsp;<span class="op" id="6075089">=</span>&nbsp;<span class="builtinfunc" id="6075091">make</span><span class="op" id="6075095">(</span><span class="op" id="6075096">[</span><span class="op" id="6075097">]</span><span class="builtintype" id="6075098">byte</span><span class="op" id="6075102">,</span>&nbsp;<span class="ident" id="6075104">encoding</span><span class="op" id="6075112">.</span><span class="ident" id="6075113">EncodedLen</span><span class="op" id="6075123">(</span><span class="builtinfunc" id="6075124">len</span><span class="op" id="6075127">(</span><span class="ident" id="6075128">resp</span><span class="op" id="6075132">)</span><span class="op" id="6075133">)</span><span class="op" id="6075134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075138">encoding</span><span class="op" id="6075146">.</span><span class="ident" id="6075147">Encode</span><span class="op" id="6075153">(</span><span class="ident" id="6075154">resp64</span><span class="op" id="6075160">,</span>&nbsp;<span class="ident" id="6075162">resp</span><span class="op" id="6075166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075170">code</span><span class="op" id="6075174">,</span>&nbsp;<span class="ident" id="6075176">msg64</span><span class="op" id="6075181">,</span>&nbsp;<span class="ident" id="6075183">err</span>&nbsp;<span class="op" id="6075187">=</span>&nbsp;<span class="ident" id="6075189">c</span><span class="op" id="6075190">.</span><span class="ident" id="6075191">cmd</span><span class="op" id="6075194">(</span><span class="num" id="6075195">0</span><span class="op" id="6075196">,</span>&nbsp;<span class="builtintype" id="6075198">string</span><span class="op" id="6075204">(</span><span class="ident" id="6075205">resp64</span><span class="op" id="6075211">)</span><span class="op" id="6075212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075215">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075218">return</span>&nbsp;<span class="ident" id="6075225">err</span><br>
<span class="lineno"></span><span class="op" id="6075229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6075232">//&nbsp;Mail&nbsp;issues&nbsp;a&nbsp;MAIL&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="6075310">//&nbsp;If&nbsp;the&nbsp;server&nbsp;supports&nbsp;the&nbsp;8BITMIME&nbsp;extension,&nbsp;Mail&nbsp;adds&nbsp;the&nbsp;BODY=8BITMIME</span><br>
<span class="lineno">220</span><span class="comment" id="6075388">//&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="6075402">//&nbsp;This&nbsp;initiates&nbsp;a&nbsp;mail&nbsp;transaction&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;Rcpt&nbsp;calls.</span><br>
<span class="lineno"></span><span class="keyword" id="6075482">func</span>&nbsp;<span class="op" id="6075487">(</span><span class="ident" id="6075488">c</span>&nbsp;<span class="op" id="6075490">*</span><span class="ident" id="6075491">Client</span><span class="op" id="6075497">)</span>&nbsp;<span class="ident" id="6075499">Mail</span><span class="op" id="6075503">(</span><span class="ident" id="6075504">from</span>&nbsp;<span class="builtintype" id="6075509">string</span><span class="op" id="6075515">)</span>&nbsp;<span class="builtintype" id="6075517">error</span>&nbsp;<span class="op" id="6075523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075526">if</span>&nbsp;<span class="ident" id="6075529">err</span>&nbsp;<span class="op" id="6075533">:=</span>&nbsp;<span class="ident" id="6075536">c</span><span class="op" id="6075537">.</span><span class="ident" id="6075538">hello</span><span class="op" id="6075543">(</span><span class="op" id="6075544">)</span><span class="op" id="6075545">;</span>&nbsp;<span class="ident" id="6075547">err</span>&nbsp;<span class="op" id="6075551">!=</span>&nbsp;<span class="ident" id="6075554">nil</span>&nbsp;<span class="op" id="6075558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075562">return</span>&nbsp;<span class="ident" id="6075569">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075577">cmdStr</span>&nbsp;<span class="op" id="6075584">:=</span>&nbsp;<span class="string" id="6075587">&#34;MAIL&nbsp;FROM:&lt;%s&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075605">if</span>&nbsp;<span class="ident" id="6075608">c</span><span class="op" id="6075609">.</span><span class="ident" id="6075610">ext</span>&nbsp;<span class="op" id="6075614">!=</span>&nbsp;<span class="ident" id="6075617">nil</span>&nbsp;<span class="op" id="6075621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075625">if</span>&nbsp;<span class="ident" id="6075628">_</span><span class="op" id="6075629">,</span>&nbsp;<span class="ident" id="6075631">ok</span>&nbsp;<span class="op" id="6075634">:=</span>&nbsp;<span class="ident" id="6075637">c</span><span class="op" id="6075638">.</span><span class="ident" id="6075639">ext</span><span class="op" id="6075642">[</span><span class="string" id="6075643">&#34;8BITMIME&#34;</span><span class="op" id="6075653">]</span><span class="op" id="6075654">;</span>&nbsp;<span class="ident" id="6075656">ok</span>&nbsp;<span class="op" id="6075659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075664">cmdStr</span>&nbsp;<span class="op" id="6075671">+=</span>&nbsp;<span class="string" id="6075674">&#34;&nbsp;BODY=8BITMIME&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075699">_</span><span class="op" id="6075700">,</span>&nbsp;<span class="ident" id="6075702">_</span><span class="op" id="6075703">,</span>&nbsp;<span class="ident" id="6075705">err</span>&nbsp;<span class="op" id="6075709">:=</span>&nbsp;<span class="ident" id="6075712">c</span><span class="op" id="6075713">.</span><span class="ident" id="6075714">cmd</span><span class="op" id="6075717">(</span><span class="num" id="6075718">250</span><span class="op" id="6075721">,</span>&nbsp;<span class="ident" id="6075723">cmdStr</span><span class="op" id="6075729">,</span>&nbsp;<span class="ident" id="6075731">from</span><span class="op" id="6075735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075738">return</span>&nbsp;<span class="ident" id="6075745">err</span><br>
<span class="lineno"></span><span class="op" id="6075749">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="6075752">//&nbsp;Rcpt&nbsp;issues&nbsp;a&nbsp;RCPT&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="6075830">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Rcpt&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Mail&nbsp;and&nbsp;may&nbsp;be&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6075906">//&nbsp;a&nbsp;Data&nbsp;call&nbsp;or&nbsp;another&nbsp;Rcpt&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="6075943">func</span>&nbsp;<span class="op" id="6075948">(</span><span class="ident" id="6075949">c</span>&nbsp;<span class="op" id="6075951">*</span><span class="ident" id="6075952">Client</span><span class="op" id="6075958">)</span>&nbsp;<span class="ident" id="6075960">Rcpt</span><span class="op" id="6075964">(</span><span class="ident" id="6075965">to</span>&nbsp;<span class="builtintype" id="6075968">string</span><span class="op" id="6075974">)</span>&nbsp;<span class="builtintype" id="6075976">error</span>&nbsp;<span class="op" id="6075982">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075985">_</span><span class="op" id="6075986">,</span>&nbsp;<span class="ident" id="6075988">_</span><span class="op" id="6075989">,</span>&nbsp;<span class="ident" id="6075991">err</span>&nbsp;<span class="op" id="6075995">:=</span>&nbsp;<span class="ident" id="6075998">c</span><span class="op" id="6075999">.</span><span class="ident" id="6076000">cmd</span><span class="op" id="6076003">(</span><span class="num" id="6076004">25</span><span class="op" id="6076006">,</span>&nbsp;<span class="string" id="6076008">&#34;RCPT&nbsp;TO:&lt;%s&gt;&#34;</span><span class="op" id="6076022">,</span>&nbsp;<span class="ident" id="6076024">to</span><span class="op" id="6076026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076029">return</span>&nbsp;<span class="ident" id="6076036">err</span><br>
<span class="lineno"></span><span class="op" id="6076040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6076043">type</span>&nbsp;<span class="ident" id="6076048">dataCloser</span>&nbsp;<span class="keyword" id="6076059">struct</span>&nbsp;<span class="op" id="6076066">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076069">c</span>&nbsp;<span class="op" id="6076071">*</span><span class="ident" id="6076072">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076080">io</span><span class="op" id="6076082">.</span><span class="ident" id="6076083">WriteCloser</span><br>
<span class="lineno"></span><span class="op" id="6076095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6076098">func</span>&nbsp;<span class="op" id="6076103">(</span><span class="ident" id="6076104">d</span>&nbsp;<span class="op" id="6076106">*</span><span class="ident" id="6076107">dataCloser</span><span class="op" id="6076117">)</span>&nbsp;<span class="ident" id="6076119">Close</span><span class="op" id="6076124">(</span><span class="op" id="6076125">)</span>&nbsp;<span class="builtintype" id="6076127">error</span>&nbsp;<span class="op" id="6076133">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076136">d</span><span class="op" id="6076137">.</span><span class="ident" id="6076138">WriteCloser</span><span class="op" id="6076149">.</span><span class="ident" id="6076150">Close</span><span class="op" id="6076155">(</span><span class="op" id="6076156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076159">_</span><span class="op" id="6076160">,</span>&nbsp;<span class="ident" id="6076162">_</span><span class="op" id="6076163">,</span>&nbsp;<span class="ident" id="6076165">err</span>&nbsp;<span class="op" id="6076169">:=</span>&nbsp;<span class="ident" id="6076172">d</span><span class="op" id="6076173">.</span><span class="ident" id="6076174">c</span><span class="op" id="6076175">.</span><span class="ident" id="6076176">Text</span><span class="op" id="6076180">.</span><span class="ident" id="6076181">ReadResponse</span><span class="op" id="6076193">(</span><span class="num" id="6076194">250</span><span class="op" id="6076197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076200">return</span>&nbsp;<span class="ident" id="6076207">err</span><br>
<span class="lineno"></span><span class="op" id="6076211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="6076214">//&nbsp;Data&nbsp;issues&nbsp;a&nbsp;DATA&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;and&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="6076284">//&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;the&nbsp;data.&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the&nbsp;writer</span><br>
<span class="lineno"></span><span class="comment" id="6076353">//&nbsp;before&nbsp;calling&nbsp;any&nbsp;more&nbsp;methods&nbsp;on&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6076394">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Data&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;calls&nbsp;to&nbsp;Rcpt.</span><br>
<span class="lineno"></span><span class="keyword" id="6076459">func</span>&nbsp;<span class="op" id="6076464">(</span><span class="ident" id="6076465">c</span>&nbsp;<span class="op" id="6076467">*</span><span class="ident" id="6076468">Client</span><span class="op" id="6076474">)</span>&nbsp;<span class="ident" id="6076476">Data</span><span class="op" id="6076480">(</span><span class="op" id="6076481">)</span>&nbsp;<span class="op" id="6076483">(</span><span class="ident" id="6076484">io</span><span class="op" id="6076486">.</span><span class="ident" id="6076487">WriteCloser</span><span class="op" id="6076498">,</span>&nbsp;<span class="builtintype" id="6076500">error</span><span class="op" id="6076505">)</span>&nbsp;<span class="op" id="6076507">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076510">_</span><span class="op" id="6076511">,</span>&nbsp;<span class="ident" id="6076513">_</span><span class="op" id="6076514">,</span>&nbsp;<span class="ident" id="6076516">err</span>&nbsp;<span class="op" id="6076520">:=</span>&nbsp;<span class="ident" id="6076523">c</span><span class="op" id="6076524">.</span><span class="ident" id="6076525">cmd</span><span class="op" id="6076528">(</span><span class="num" id="6076529">354</span><span class="op" id="6076532">,</span>&nbsp;<span class="string" id="6076534">&#34;DATA&#34;</span><span class="op" id="6076540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076543">if</span>&nbsp;<span class="ident" id="6076546">err</span>&nbsp;<span class="op" id="6076550">!=</span>&nbsp;<span class="ident" id="6076553">nil</span>&nbsp;<span class="op" id="6076557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076561">return</span>&nbsp;<span class="ident" id="6076568">nil</span><span class="op" id="6076571">,</span>&nbsp;<span class="ident" id="6076573">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6076578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076581">return</span>&nbsp;<span class="op" id="6076588">&amp;</span><span class="ident" id="6076589">dataCloser</span><span class="op" id="6076599">{</span><span class="ident" id="6076600">c</span><span class="op" id="6076601">,</span>&nbsp;<span class="ident" id="6076603">c</span><span class="op" id="6076604">.</span><span class="ident" id="6076605">Text</span><span class="op" id="6076609">.</span><span class="ident" id="6076610">DotWriter</span><span class="op" id="6076619">(</span><span class="op" id="6076620">)</span><span class="op" id="6076621">}</span><span class="op" id="6076622">,</span>&nbsp;<span class="ident" id="6076624">nil</span><br>
<span class="lineno">265</span><span class="op" id="6076628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6076631">var</span>&nbsp;<span class="ident" id="6076635">testHookStartTLS</span>&nbsp;<span class="keyword" id="6076652">func</span><span class="op" id="6076656">(</span><span class="op" id="6076657">*</span><span class="ident" id="6076658">tls</span><span class="op" id="6076661">.</span><span class="ident" id="6076662">Config</span><span class="op" id="6076668">)</span>&nbsp;<span class="comment" id="6076670">//&nbsp;nil,&nbsp;except&nbsp;for&nbsp;tests</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6076696">//&nbsp;SendMail&nbsp;connects&nbsp;to&nbsp;the&nbsp;server&nbsp;at&nbsp;addr,&nbsp;switches&nbsp;to&nbsp;TLS&nbsp;if</span><br>
<span class="lineno">270</span><span class="comment" id="6076759">//&nbsp;possible,&nbsp;authenticates&nbsp;with&nbsp;the&nbsp;optional&nbsp;mechanism&nbsp;a&nbsp;if&nbsp;possible,</span><br>
<span class="lineno"></span><span class="comment" id="6076829">//&nbsp;and&nbsp;then&nbsp;sends&nbsp;an&nbsp;email&nbsp;from&nbsp;address&nbsp;from,&nbsp;to&nbsp;addresses&nbsp;to,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6076897">//&nbsp;message&nbsp;msg.</span><br>
<span class="lineno"></span><span class="keyword" id="6076913">func</span>&nbsp;<span class="ident" id="6076918">SendMail</span><span class="op" id="6076926">(</span><span class="ident" id="6076927">addr</span>&nbsp;<span class="builtintype" id="6076932">string</span><span class="op" id="6076938">,</span>&nbsp;<span class="ident" id="6076940">a</span>&nbsp;<span class="ident" id="6076942">Auth</span><span class="op" id="6076946">,</span>&nbsp;<span class="ident" id="6076948">from</span>&nbsp;<span class="builtintype" id="6076953">string</span><span class="op" id="6076959">,</span>&nbsp;<span class="ident" id="6076961">to</span>&nbsp;<span class="op" id="6076964">[</span><span class="op" id="6076965">]</span><span class="builtintype" id="6076966">string</span><span class="op" id="6076972">,</span>&nbsp;<span class="ident" id="6076974">msg</span>&nbsp;<span class="op" id="6076978">[</span><span class="op" id="6076979">]</span><span class="builtintype" id="6076980">byte</span><span class="op" id="6076984">)</span>&nbsp;<span class="builtintype" id="6076986">error</span>&nbsp;<span class="op" id="6076992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076995">c</span><span class="op" id="6076996">,</span>&nbsp;<span class="ident" id="6076998">err</span>&nbsp;<span class="op" id="6077002">:=</span>&nbsp;<span class="ident" id="6077005">Dial</span><span class="op" id="6077009">(</span><span class="ident" id="6077010">addr</span><span class="op" id="6077014">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077017">if</span>&nbsp;<span class="ident" id="6077020">err</span>&nbsp;<span class="op" id="6077024">!=</span>&nbsp;<span class="ident" id="6077027">nil</span>&nbsp;<span class="op" id="6077031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077035">return</span>&nbsp;<span class="ident" id="6077042">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077050">defer</span>&nbsp;<span class="ident" id="6077056">c</span><span class="op" id="6077057">.</span><span class="ident" id="6077058">Close</span><span class="op" id="6077063">(</span><span class="op" id="6077064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077067">if</span>&nbsp;<span class="ident" id="6077070">err</span>&nbsp;<span class="op" id="6077074">=</span>&nbsp;<span class="ident" id="6077076">c</span><span class="op" id="6077077">.</span><span class="ident" id="6077078">hello</span><span class="op" id="6077083">(</span><span class="op" id="6077084">)</span><span class="op" id="6077085">;</span>&nbsp;<span class="ident" id="6077087">err</span>&nbsp;<span class="op" id="6077091">!=</span>&nbsp;<span class="ident" id="6077094">nil</span>&nbsp;<span class="op" id="6077098">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077102">return</span>&nbsp;<span class="ident" id="6077109">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077117">if</span>&nbsp;<span class="ident" id="6077120">ok</span><span class="op" id="6077122">,</span>&nbsp;<span class="ident" id="6077124">_</span>&nbsp;<span class="op" id="6077126">:=</span>&nbsp;<span class="ident" id="6077129">c</span><span class="op" id="6077130">.</span><span class="ident" id="6077131">Extension</span><span class="op" id="6077140">(</span><span class="string" id="6077141">&#34;STARTTLS&#34;</span><span class="op" id="6077151">)</span><span class="op" id="6077152">;</span>&nbsp;<span class="ident" id="6077154">ok</span>&nbsp;<span class="op" id="6077157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077161">config</span>&nbsp;<span class="op" id="6077168">:=</span>&nbsp;<span class="op" id="6077171">&amp;</span><span class="ident" id="6077172">tls</span><span class="op" id="6077175">.</span><span class="ident" id="6077176">Config</span><span class="op" id="6077182">{</span><span class="ident" id="6077183">ServerName</span><span class="op" id="6077193">:</span>&nbsp;<span class="ident" id="6077195">c</span><span class="op" id="6077196">.</span><span class="ident" id="6077197">serverName</span><span class="op" id="6077207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077211">if</span>&nbsp;<span class="ident" id="6077214">testHookStartTLS</span>&nbsp;<span class="op" id="6077231">!=</span>&nbsp;<span class="ident" id="6077234">nil</span>&nbsp;<span class="op" id="6077238">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077243">testHookStartTLS</span><span class="op" id="6077259">(</span><span class="ident" id="6077260">config</span><span class="op" id="6077266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077274">if</span>&nbsp;<span class="ident" id="6077277">err</span>&nbsp;<span class="op" id="6077281">=</span>&nbsp;<span class="ident" id="6077283">c</span><span class="op" id="6077284">.</span><span class="ident" id="6077285">StartTLS</span><span class="op" id="6077293">(</span><span class="ident" id="6077294">config</span><span class="op" id="6077300">)</span><span class="op" id="6077301">;</span>&nbsp;<span class="ident" id="6077303">err</span>&nbsp;<span class="op" id="6077307">!=</span>&nbsp;<span class="ident" id="6077310">nil</span>&nbsp;<span class="op" id="6077314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077319">return</span>&nbsp;<span class="ident" id="6077326">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077332">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077338">if</span>&nbsp;<span class="ident" id="6077341">a</span>&nbsp;<span class="op" id="6077343">!=</span>&nbsp;<span class="ident" id="6077346">nil</span>&nbsp;<span class="op" id="6077350">&amp;&amp;</span>&nbsp;<span class="ident" id="6077353">c</span><span class="op" id="6077354">.</span><span class="ident" id="6077355">ext</span>&nbsp;<span class="op" id="6077359">!=</span>&nbsp;<span class="ident" id="6077362">nil</span>&nbsp;<span class="op" id="6077366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077370">if</span>&nbsp;<span class="ident" id="6077373">_</span><span class="op" id="6077374">,</span>&nbsp;<span class="ident" id="6077376">ok</span>&nbsp;<span class="op" id="6077379">:=</span>&nbsp;<span class="ident" id="6077382">c</span><span class="op" id="6077383">.</span><span class="ident" id="6077384">ext</span><span class="op" id="6077387">[</span><span class="string" id="6077388">&#34;AUTH&#34;</span><span class="op" id="6077394">]</span><span class="op" id="6077395">;</span>&nbsp;<span class="ident" id="6077397">ok</span>&nbsp;<span class="op" id="6077400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077405">if</span>&nbsp;<span class="ident" id="6077408">err</span>&nbsp;<span class="op" id="6077412">=</span>&nbsp;<span class="ident" id="6077414">c</span><span class="op" id="6077415">.</span><span class="ident" id="6077416">Auth</span><span class="op" id="6077420">(</span><span class="ident" id="6077421">a</span><span class="op" id="6077422">)</span><span class="op" id="6077423">;</span>&nbsp;<span class="ident" id="6077425">err</span>&nbsp;<span class="op" id="6077429">!=</span>&nbsp;<span class="ident" id="6077432">nil</span>&nbsp;<span class="op" id="6077436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077442">return</span>&nbsp;<span class="ident" id="6077449">err</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077466">if</span>&nbsp;<span class="ident" id="6077469">err</span>&nbsp;<span class="op" id="6077473">=</span>&nbsp;<span class="ident" id="6077475">c</span><span class="op" id="6077476">.</span><span class="ident" id="6077477">Mail</span><span class="op" id="6077481">(</span><span class="ident" id="6077482">from</span><span class="op" id="6077486">)</span><span class="op" id="6077487">;</span>&nbsp;<span class="ident" id="6077489">err</span>&nbsp;<span class="op" id="6077493">!=</span>&nbsp;<span class="ident" id="6077496">nil</span>&nbsp;<span class="op" id="6077500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077504">return</span>&nbsp;<span class="ident" id="6077511">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077519">for</span>&nbsp;<span class="ident" id="6077523">_</span><span class="op" id="6077524">,</span>&nbsp;<span class="ident" id="6077526">addr</span>&nbsp;<span class="op" id="6077531">:=</span>&nbsp;<span class="keyword" id="6077534">range</span>&nbsp;<span class="ident" id="6077540">to</span>&nbsp;<span class="op" id="6077543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077547">if</span>&nbsp;<span class="ident" id="6077550">err</span>&nbsp;<span class="op" id="6077554">=</span>&nbsp;<span class="ident" id="6077556">c</span><span class="op" id="6077557">.</span><span class="ident" id="6077558">Rcpt</span><span class="op" id="6077562">(</span><span class="ident" id="6077563">addr</span><span class="op" id="6077567">)</span><span class="op" id="6077568">;</span>&nbsp;<span class="ident" id="6077570">err</span>&nbsp;<span class="op" id="6077574">!=</span>&nbsp;<span class="ident" id="6077577">nil</span>&nbsp;<span class="op" id="6077581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077586">return</span>&nbsp;<span class="ident" id="6077593">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077599">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077605">w</span><span class="op" id="6077606">,</span>&nbsp;<span class="ident" id="6077608">err</span>&nbsp;<span class="op" id="6077612">:=</span>&nbsp;<span class="ident" id="6077615">c</span><span class="op" id="6077616">.</span><span class="ident" id="6077617">Data</span><span class="op" id="6077621">(</span><span class="op" id="6077622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077625">if</span>&nbsp;<span class="ident" id="6077628">err</span>&nbsp;<span class="op" id="6077632">!=</span>&nbsp;<span class="ident" id="6077635">nil</span>&nbsp;<span class="op" id="6077639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077643">return</span>&nbsp;<span class="ident" id="6077650">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077655">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077658">_</span><span class="op" id="6077659">,</span>&nbsp;<span class="ident" id="6077661">err</span>&nbsp;<span class="op" id="6077665">=</span>&nbsp;<span class="ident" id="6077667">w</span><span class="op" id="6077668">.</span><span class="ident" id="6077669">Write</span><span class="op" id="6077674">(</span><span class="ident" id="6077675">msg</span><span class="op" id="6077678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077681">if</span>&nbsp;<span class="ident" id="6077684">err</span>&nbsp;<span class="op" id="6077688">!=</span>&nbsp;<span class="ident" id="6077691">nil</span>&nbsp;<span class="op" id="6077695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077699">return</span>&nbsp;<span class="ident" id="6077706">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077714">err</span>&nbsp;<span class="op" id="6077718">=</span>&nbsp;<span class="ident" id="6077720">w</span><span class="op" id="6077721">.</span><span class="ident" id="6077722">Close</span><span class="op" id="6077727">(</span><span class="op" id="6077728">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077731">if</span>&nbsp;<span class="ident" id="6077734">err</span>&nbsp;<span class="op" id="6077738">!=</span>&nbsp;<span class="ident" id="6077741">nil</span>&nbsp;<span class="op" id="6077745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077749">return</span>&nbsp;<span class="ident" id="6077756">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077764">return</span>&nbsp;<span class="ident" id="6077771">c</span><span class="op" id="6077772">.</span><span class="ident" id="6077773">Quit</span><span class="op" id="6077777">(</span><span class="op" id="6077778">)</span><br>
<span class="lineno"></span><span class="op" id="6077780">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="6077783">//&nbsp;Extension&nbsp;reports&nbsp;whether&nbsp;an&nbsp;extension&nbsp;is&nbsp;support&nbsp;by&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6077851">//&nbsp;The&nbsp;extension&nbsp;name&nbsp;is&nbsp;case-insensitive.&nbsp;If&nbsp;the&nbsp;extension&nbsp;is&nbsp;supported,</span><br>
<span class="lineno"></span><span class="comment" id="6077925">//&nbsp;Extension&nbsp;also&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;contains&nbsp;any&nbsp;parameters&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6077993">//&nbsp;server&nbsp;specifies&nbsp;for&nbsp;the&nbsp;extension.</span><br>
<span class="lineno">325</span><span class="keyword" id="6078032">func</span>&nbsp;<span class="op" id="6078037">(</span><span class="ident" id="6078038">c</span>&nbsp;<span class="op" id="6078040">*</span><span class="ident" id="6078041">Client</span><span class="op" id="6078047">)</span>&nbsp;<span class="ident" id="6078049">Extension</span><span class="op" id="6078058">(</span><span class="ident" id="6078059">ext</span>&nbsp;<span class="builtintype" id="6078063">string</span><span class="op" id="6078069">)</span>&nbsp;<span class="op" id="6078071">(</span><span class="builtintype" id="6078072">bool</span><span class="op" id="6078076">,</span>&nbsp;<span class="builtintype" id="6078078">string</span><span class="op" id="6078084">)</span>&nbsp;<span class="op" id="6078086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078089">if</span>&nbsp;<span class="ident" id="6078092">err</span>&nbsp;<span class="op" id="6078096">:=</span>&nbsp;<span class="ident" id="6078099">c</span><span class="op" id="6078100">.</span><span class="ident" id="6078101">hello</span><span class="op" id="6078106">(</span><span class="op" id="6078107">)</span><span class="op" id="6078108">;</span>&nbsp;<span class="ident" id="6078110">err</span>&nbsp;<span class="op" id="6078114">!=</span>&nbsp;<span class="ident" id="6078117">nil</span>&nbsp;<span class="op" id="6078121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078125">return</span>&nbsp;<span class="builtintype" id="6078132">false</span><span class="op" id="6078137">,</span>&nbsp;<span class="string" id="6078139">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078146">if</span>&nbsp;<span class="ident" id="6078149">c</span><span class="op" id="6078150">.</span><span class="ident" id="6078151">ext</span>&nbsp;<span class="op" id="6078155">==</span>&nbsp;<span class="ident" id="6078158">nil</span>&nbsp;<span class="op" id="6078162">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078166">return</span>&nbsp;<span class="builtintype" id="6078173">false</span><span class="op" id="6078178">,</span>&nbsp;<span class="string" id="6078180">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078187">ext</span>&nbsp;<span class="op" id="6078191">=</span>&nbsp;<span class="ident" id="6078193">strings</span><span class="op" id="6078200">.</span><span class="ident" id="6078201">ToUpper</span><span class="op" id="6078208">(</span><span class="ident" id="6078209">ext</span><span class="op" id="6078212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078215">param</span><span class="op" id="6078220">,</span>&nbsp;<span class="ident" id="6078222">ok</span>&nbsp;<span class="op" id="6078225">:=</span>&nbsp;<span class="ident" id="6078228">c</span><span class="op" id="6078229">.</span><span class="ident" id="6078230">ext</span><span class="op" id="6078233">[</span><span class="ident" id="6078234">ext</span><span class="op" id="6078237">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078240">return</span>&nbsp;<span class="ident" id="6078247">ok</span><span class="op" id="6078249">,</span>&nbsp;<span class="ident" id="6078251">param</span><br>
<span class="lineno">335</span><span class="op" id="6078257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6078260">//&nbsp;Reset&nbsp;sends&nbsp;the&nbsp;RSET&nbsp;command&nbsp;to&nbsp;the&nbsp;server,&nbsp;aborting&nbsp;the&nbsp;current&nbsp;mail</span><br>
<span class="lineno"></span><span class="comment" id="6078333">//&nbsp;transaction.</span><br>
<span class="lineno"></span><span class="keyword" id="6078349">func</span>&nbsp;<span class="op" id="6078354">(</span><span class="ident" id="6078355">c</span>&nbsp;<span class="op" id="6078357">*</span><span class="ident" id="6078358">Client</span><span class="op" id="6078364">)</span>&nbsp;<span class="ident" id="6078366">Reset</span><span class="op" id="6078371">(</span><span class="op" id="6078372">)</span>&nbsp;<span class="builtintype" id="6078374">error</span>&nbsp;<span class="op" id="6078380">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078383">if</span>&nbsp;<span class="ident" id="6078386">err</span>&nbsp;<span class="op" id="6078390">:=</span>&nbsp;<span class="ident" id="6078393">c</span><span class="op" id="6078394">.</span><span class="ident" id="6078395">hello</span><span class="op" id="6078400">(</span><span class="op" id="6078401">)</span><span class="op" id="6078402">;</span>&nbsp;<span class="ident" id="6078404">err</span>&nbsp;<span class="op" id="6078408">!=</span>&nbsp;<span class="ident" id="6078411">nil</span>&nbsp;<span class="op" id="6078415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078419">return</span>&nbsp;<span class="ident" id="6078426">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078434">_</span><span class="op" id="6078435">,</span>&nbsp;<span class="ident" id="6078437">_</span><span class="op" id="6078438">,</span>&nbsp;<span class="ident" id="6078440">err</span>&nbsp;<span class="op" id="6078444">:=</span>&nbsp;<span class="ident" id="6078447">c</span><span class="op" id="6078448">.</span><span class="ident" id="6078449">cmd</span><span class="op" id="6078452">(</span><span class="num" id="6078453">250</span><span class="op" id="6078456">,</span>&nbsp;<span class="string" id="6078458">&#34;RSET&#34;</span><span class="op" id="6078464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078467">return</span>&nbsp;<span class="ident" id="6078474">err</span><br>
<span class="lineno">345</span><span class="op" id="6078478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6078481">//&nbsp;Quit&nbsp;sends&nbsp;the&nbsp;QUIT&nbsp;command&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6078553">func</span>&nbsp;<span class="op" id="6078558">(</span><span class="ident" id="6078559">c</span>&nbsp;<span class="op" id="6078561">*</span><span class="ident" id="6078562">Client</span><span class="op" id="6078568">)</span>&nbsp;<span class="ident" id="6078570">Quit</span><span class="op" id="6078574">(</span><span class="op" id="6078575">)</span>&nbsp;<span class="builtintype" id="6078577">error</span>&nbsp;<span class="op" id="6078583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078586">if</span>&nbsp;<span class="ident" id="6078589">err</span>&nbsp;<span class="op" id="6078593">:=</span>&nbsp;<span class="ident" id="6078596">c</span><span class="op" id="6078597">.</span><span class="ident" id="6078598">hello</span><span class="op" id="6078603">(</span><span class="op" id="6078604">)</span><span class="op" id="6078605">;</span>&nbsp;<span class="ident" id="6078607">err</span>&nbsp;<span class="op" id="6078611">!=</span>&nbsp;<span class="ident" id="6078614">nil</span>&nbsp;<span class="op" id="6078618">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078622">return</span>&nbsp;<span class="ident" id="6078629">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078637">_</span><span class="op" id="6078638">,</span>&nbsp;<span class="ident" id="6078640">_</span><span class="op" id="6078641">,</span>&nbsp;<span class="ident" id="6078643">err</span>&nbsp;<span class="op" id="6078647">:=</span>&nbsp;<span class="ident" id="6078650">c</span><span class="op" id="6078651">.</span><span class="ident" id="6078652">cmd</span><span class="op" id="6078655">(</span><span class="num" id="6078656">221</span><span class="op" id="6078659">,</span>&nbsp;<span class="string" id="6078661">&#34;QUIT&#34;</span><span class="op" id="6078667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078670">if</span>&nbsp;<span class="ident" id="6078673">err</span>&nbsp;<span class="op" id="6078677">!=</span>&nbsp;<span class="ident" id="6078680">nil</span>&nbsp;<span class="op" id="6078684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078688">return</span>&nbsp;<span class="ident" id="6078695">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078703">return</span>&nbsp;<span class="ident" id="6078710">c</span><span class="op" id="6078711">.</span><span class="ident" id="6078712">Text</span><span class="op" id="6078716">.</span><span class="ident" id="6078717">Close</span><span class="op" id="6078722">(</span><span class="op" id="6078723">)</span><br>
<span class="lineno"></span><span class="op" id="6078725">}</span>
</div>
</body>
</html>
