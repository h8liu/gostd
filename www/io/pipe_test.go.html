<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="301355">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="301410">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="301464">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="301515">package</span>&nbsp;<span class="ident" id="301523">io_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="301532">import</span>&nbsp;<span class="op" id="301539">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="301542">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="301549">.</span>&nbsp;<span class="string" id="301551">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="301557">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="301568">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="301575">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="301578">func</span>&nbsp;<span class="ident" id="301583">checkWrite</span><span class="op" id="301593">(</span><span class="ident" id="301594">t</span>&nbsp;<span class="op" id="301596">*</span><span class="ident" id="301597">testing</span><span class="op" id="301604">.</span><span class="ident" id="301605">T</span><span class="op" id="301606">,</span>&nbsp;<span class="ident" id="301608">w</span>&nbsp;<span class="ident" id="301610">Writer</span><span class="op" id="301616">,</span>&nbsp;<span class="ident" id="301618">data</span>&nbsp;<span class="op" id="301623">[</span><span class="op" id="301624">]</span><span class="builtintype" id="301625">byte</span><span class="op" id="301629">,</span>&nbsp;<span class="ident" id="301631">c</span>&nbsp;<span class="keyword" id="301633">chan</span>&nbsp;<span class="builtintype" id="301638">int</span><span class="op" id="301641">)</span>&nbsp;<span class="op" id="301643">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="301646">n</span><span class="op" id="301647">,</span>&nbsp;<span class="ident" id="301649">err</span>&nbsp;<span class="op" id="301653">:=</span>&nbsp;<span class="ident" id="301656">w</span><span class="op" id="301657">.</span><span class="ident" id="301658">Write</span><span class="op" id="301663">(</span><span class="ident" id="301664">data</span><span class="op" id="301668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="301671">if</span>&nbsp;<span class="ident" id="301674">err</span>&nbsp;<span class="op" id="301678">!=</span>&nbsp;<span class="ident" id="301681">nil</span>&nbsp;<span class="op" id="301685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="301689">t</span><span class="op" id="301690">.</span><span class="ident" id="301691">Errorf</span><span class="op" id="301697">(</span><span class="string" id="301698">&#34;write:&nbsp;%v&#34;</span><span class="op" id="301709">,</span>&nbsp;<span class="ident" id="301711">err</span><span class="op" id="301714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="301717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="301720">if</span>&nbsp;<span class="ident" id="301723">n</span>&nbsp;<span class="op" id="301725">!=</span>&nbsp;<span class="builtinfunc" id="301728">len</span><span class="op" id="301731">(</span><span class="ident" id="301732">data</span><span class="op" id="301736">)</span>&nbsp;<span class="op" id="301738">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="301742">t</span><span class="op" id="301743">.</span><span class="ident" id="301744">Errorf</span><span class="op" id="301750">(</span><span class="string" id="301751">&#34;short&nbsp;write:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="301774">,</span>&nbsp;<span class="ident" id="301776">n</span><span class="op" id="301777">,</span>&nbsp;<span class="builtinfunc" id="301779">len</span><span class="op" id="301782">(</span><span class="ident" id="301783">data</span><span class="op" id="301787">)</span><span class="op" id="301788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="301791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="301794">c</span>&nbsp;<span class="op" id="301796">&lt;-</span>&nbsp;<span class="num" id="301799">0</span><br>
<span class="lineno"></span><span class="op" id="301801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="301804">//&nbsp;Test&nbsp;a&nbsp;single&nbsp;read/write&nbsp;pair.</span><br>
<span class="lineno"></span><span class="keyword" id="301838">func</span>&nbsp;<span class="ident" id="301843">TestPipe1</span><span class="op" id="301852">(</span><span class="ident" id="301853">t</span>&nbsp;<span class="op" id="301855">*</span><span class="ident" id="301856">testing</span><span class="op" id="301863">.</span><span class="ident" id="301864">T</span><span class="op" id="301865">)</span>&nbsp;<span class="op" id="301867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="301870">c</span>&nbsp;<span class="op" id="301872">:=</span>&nbsp;<span class="builtinfunc" id="301875">make</span><span class="op" id="301879">(</span><span class="keyword" id="301880">chan</span>&nbsp;<span class="builtintype" id="301885">int</span><span class="op" id="301888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="301891">r</span><span class="op" id="301892">,</span>&nbsp;<span class="ident" id="301894">w</span>&nbsp;<span class="op" id="301896">:=</span>&nbsp;<span class="ident" id="301899">Pipe</span><span class="op" id="301903">(</span><span class="op" id="301904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="301907">var</span>&nbsp;<span class="ident" id="301911">buf</span>&nbsp;<span class="op" id="301915">=</span>&nbsp;<span class="builtinfunc" id="301917">make</span><span class="op" id="301921">(</span><span class="op" id="301922">[</span><span class="op" id="301923">]</span><span class="builtintype" id="301924">byte</span><span class="op" id="301928">,</span>&nbsp;<span class="num" id="301930">64</span><span class="op" id="301932">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="301935">go</span>&nbsp;<span class="ident" id="301938">checkWrite</span><span class="op" id="301948">(</span><span class="ident" id="301949">t</span><span class="op" id="301950">,</span>&nbsp;<span class="ident" id="301952">w</span><span class="op" id="301953">,</span>&nbsp;<span class="op" id="301955">[</span><span class="op" id="301956">]</span><span class="builtintype" id="301957">byte</span><span class="op" id="301961">(</span><span class="string" id="301962">&#34;hello,&nbsp;world&#34;</span><span class="op" id="301976">)</span><span class="op" id="301977">,</span>&nbsp;<span class="ident" id="301979">c</span><span class="op" id="301980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="301983">n</span><span class="op" id="301984">,</span>&nbsp;<span class="ident" id="301986">err</span>&nbsp;<span class="op" id="301990">:=</span>&nbsp;<span class="ident" id="301993">r</span><span class="op" id="301994">.</span><span class="ident" id="301995">Read</span><span class="op" id="301999">(</span><span class="ident" id="302000">buf</span><span class="op" id="302003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="302006">if</span>&nbsp;<span class="ident" id="302009">err</span>&nbsp;<span class="op" id="302013">!=</span>&nbsp;<span class="ident" id="302016">nil</span>&nbsp;<span class="op" id="302020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302024">t</span><span class="op" id="302025">.</span><span class="ident" id="302026">Errorf</span><span class="op" id="302032">(</span><span class="string" id="302033">&#34;read:&nbsp;%v&#34;</span><span class="op" id="302043">,</span>&nbsp;<span class="ident" id="302045">err</span><span class="op" id="302048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="302051">}</span>&nbsp;<span class="keyword" id="302053">else</span>&nbsp;<span class="keyword" id="302058">if</span>&nbsp;<span class="ident" id="302061">n</span>&nbsp;<span class="op" id="302063">!=</span>&nbsp;<span class="num" id="302066">12</span>&nbsp;<span class="op" id="302069">||</span>&nbsp;<span class="builtintype" id="302072">string</span><span class="op" id="302078">(</span><span class="ident" id="302079">buf</span><span class="op" id="302082">[</span><span class="num" id="302083">0</span><span class="op" id="302084">:</span><span class="num" id="302085">12</span><span class="op" id="302087">]</span><span class="op" id="302088">)</span>&nbsp;<span class="op" id="302090">!=</span>&nbsp;<span class="string" id="302093">&#34;hello,&nbsp;world&#34;</span>&nbsp;<span class="op" id="302108">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302112">t</span><span class="op" id="302113">.</span><span class="ident" id="302114">Errorf</span><span class="op" id="302120">(</span><span class="string" id="302121">&#34;bad&nbsp;read:&nbsp;got&nbsp;%q&#34;</span><span class="op" id="302139">,</span>&nbsp;<span class="ident" id="302141">buf</span><span class="op" id="302144">[</span><span class="num" id="302145">0</span><span class="op" id="302146">:</span><span class="ident" id="302147">n</span><span class="op" id="302148">]</span><span class="op" id="302149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="302152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="302155">&lt;-</span><span class="ident" id="302157">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302160">r</span><span class="op" id="302161">.</span><span class="ident" id="302162">Close</span><span class="op" id="302167">(</span><span class="op" id="302168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302171">w</span><span class="op" id="302172">.</span><span class="ident" id="302173">Close</span><span class="op" id="302178">(</span><span class="op" id="302179">)</span><br>
<span class="lineno">40</span><span class="op" id="302181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="302184">func</span>&nbsp;<span class="ident" id="302189">reader</span><span class="op" id="302195">(</span><span class="ident" id="302196">t</span>&nbsp;<span class="op" id="302198">*</span><span class="ident" id="302199">testing</span><span class="op" id="302206">.</span><span class="ident" id="302207">T</span><span class="op" id="302208">,</span>&nbsp;<span class="ident" id="302210">r</span>&nbsp;<span class="ident" id="302212">Reader</span><span class="op" id="302218">,</span>&nbsp;<span class="ident" id="302220">c</span>&nbsp;<span class="keyword" id="302222">chan</span>&nbsp;<span class="builtintype" id="302227">int</span><span class="op" id="302230">)</span>&nbsp;<span class="op" id="302232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="302235">var</span>&nbsp;<span class="ident" id="302239">buf</span>&nbsp;<span class="op" id="302243">=</span>&nbsp;<span class="builtinfunc" id="302245">make</span><span class="op" id="302249">(</span><span class="op" id="302250">[</span><span class="op" id="302251">]</span><span class="builtintype" id="302252">byte</span><span class="op" id="302256">,</span>&nbsp;<span class="num" id="302258">64</span><span class="op" id="302260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="302263">for</span>&nbsp;<span class="op" id="302267">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302271">n</span><span class="op" id="302272">,</span>&nbsp;<span class="ident" id="302274">err</span>&nbsp;<span class="op" id="302278">:=</span>&nbsp;<span class="ident" id="302281">r</span><span class="op" id="302282">.</span><span class="ident" id="302283">Read</span><span class="op" id="302287">(</span><span class="ident" id="302288">buf</span><span class="op" id="302291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="302295">if</span>&nbsp;<span class="ident" id="302298">err</span>&nbsp;<span class="op" id="302302">==</span>&nbsp;<span class="ident" id="302305">EOF</span>&nbsp;<span class="op" id="302309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302314">c</span>&nbsp;<span class="op" id="302316">&lt;-</span>&nbsp;<span class="num" id="302319">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="302324">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="302332">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="302336">if</span>&nbsp;<span class="ident" id="302339">err</span>&nbsp;<span class="op" id="302343">!=</span>&nbsp;<span class="ident" id="302346">nil</span>&nbsp;<span class="op" id="302350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302355">t</span><span class="op" id="302356">.</span><span class="ident" id="302357">Errorf</span><span class="op" id="302363">(</span><span class="string" id="302364">&#34;read:&nbsp;%v&#34;</span><span class="op" id="302374">,</span>&nbsp;<span class="ident" id="302376">err</span><span class="op" id="302379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="302383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302387">c</span>&nbsp;<span class="op" id="302389">&lt;-</span>&nbsp;<span class="ident" id="302392">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="302395">}</span><br>
<span class="lineno">55</span><span class="op" id="302397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="302400">//&nbsp;Test&nbsp;a&nbsp;sequence&nbsp;of&nbsp;read/write&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="keyword" id="302440">func</span>&nbsp;<span class="ident" id="302445">TestPipe2</span><span class="op" id="302454">(</span><span class="ident" id="302455">t</span>&nbsp;<span class="op" id="302457">*</span><span class="ident" id="302458">testing</span><span class="op" id="302465">.</span><span class="ident" id="302466">T</span><span class="op" id="302467">)</span>&nbsp;<span class="op" id="302469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302472">c</span>&nbsp;<span class="op" id="302474">:=</span>&nbsp;<span class="builtinfunc" id="302477">make</span><span class="op" id="302481">(</span><span class="keyword" id="302482">chan</span>&nbsp;<span class="builtintype" id="302487">int</span><span class="op" id="302490">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302493">r</span><span class="op" id="302494">,</span>&nbsp;<span class="ident" id="302496">w</span>&nbsp;<span class="op" id="302498">:=</span>&nbsp;<span class="ident" id="302501">Pipe</span><span class="op" id="302505">(</span><span class="op" id="302506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="302509">go</span>&nbsp;<span class="ident" id="302512">reader</span><span class="op" id="302518">(</span><span class="ident" id="302519">t</span><span class="op" id="302520">,</span>&nbsp;<span class="ident" id="302522">r</span><span class="op" id="302523">,</span>&nbsp;<span class="ident" id="302525">c</span><span class="op" id="302526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="302529">var</span>&nbsp;<span class="ident" id="302533">buf</span>&nbsp;<span class="op" id="302537">=</span>&nbsp;<span class="builtinfunc" id="302539">make</span><span class="op" id="302543">(</span><span class="op" id="302544">[</span><span class="op" id="302545">]</span><span class="builtintype" id="302546">byte</span><span class="op" id="302550">,</span>&nbsp;<span class="num" id="302552">64</span><span class="op" id="302554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="302557">for</span>&nbsp;<span class="ident" id="302561">i</span>&nbsp;<span class="op" id="302563">:=</span>&nbsp;<span class="num" id="302566">0</span><span class="op" id="302567">;</span>&nbsp;<span class="ident" id="302569">i</span>&nbsp;<span class="op" id="302571">&lt;</span>&nbsp;<span class="num" id="302573">5</span><span class="op" id="302574">;</span>&nbsp;<span class="ident" id="302576">i</span><span class="op" id="302577">++</span>&nbsp;<span class="op" id="302580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302584">p</span>&nbsp;<span class="op" id="302586">:=</span>&nbsp;<span class="ident" id="302589">buf</span><span class="op" id="302592">[</span><span class="num" id="302593">0</span>&nbsp;<span class="op" id="302595">:</span>&nbsp;<span class="num" id="302597">5</span><span class="op" id="302598">+</span><span class="ident" id="302599">i</span><span class="op" id="302600">*</span><span class="num" id="302601">10</span><span class="op" id="302603">]</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302607">n</span><span class="op" id="302608">,</span>&nbsp;<span class="ident" id="302610">err</span>&nbsp;<span class="op" id="302614">:=</span>&nbsp;<span class="ident" id="302617">w</span><span class="op" id="302618">.</span><span class="ident" id="302619">Write</span><span class="op" id="302624">(</span><span class="ident" id="302625">p</span><span class="op" id="302626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="302630">if</span>&nbsp;<span class="ident" id="302633">n</span>&nbsp;<span class="op" id="302635">!=</span>&nbsp;<span class="builtinfunc" id="302638">len</span><span class="op" id="302641">(</span><span class="ident" id="302642">p</span><span class="op" id="302643">)</span>&nbsp;<span class="op" id="302645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302650">t</span><span class="op" id="302651">.</span><span class="ident" id="302652">Errorf</span><span class="op" id="302658">(</span><span class="string" id="302659">&#34;wrote&nbsp;%d,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="302677">,</span>&nbsp;<span class="builtinfunc" id="302679">len</span><span class="op" id="302682">(</span><span class="ident" id="302683">p</span><span class="op" id="302684">)</span><span class="op" id="302685">,</span>&nbsp;<span class="ident" id="302687">n</span><span class="op" id="302688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="302692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="302696">if</span>&nbsp;<span class="ident" id="302699">err</span>&nbsp;<span class="op" id="302703">!=</span>&nbsp;<span class="ident" id="302706">nil</span>&nbsp;<span class="op" id="302710">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302715">t</span><span class="op" id="302716">.</span><span class="ident" id="302717">Errorf</span><span class="op" id="302723">(</span><span class="string" id="302724">&#34;write:&nbsp;%v&#34;</span><span class="op" id="302735">,</span>&nbsp;<span class="ident" id="302737">err</span><span class="op" id="302740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="302744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302748">nn</span>&nbsp;<span class="op" id="302751">:=</span>&nbsp;<span class="op" id="302754">&lt;-</span><span class="ident" id="302756">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="302760">if</span>&nbsp;<span class="ident" id="302763">nn</span>&nbsp;<span class="op" id="302766">!=</span>&nbsp;<span class="ident" id="302769">n</span>&nbsp;<span class="op" id="302771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302776">t</span><span class="op" id="302777">.</span><span class="ident" id="302778">Errorf</span><span class="op" id="302784">(</span><span class="string" id="302785">&#34;wrote&nbsp;%d,&nbsp;read&nbsp;got&nbsp;%d&#34;</span><span class="op" id="302808">,</span>&nbsp;<span class="ident" id="302810">n</span><span class="op" id="302811">,</span>&nbsp;<span class="ident" id="302813">nn</span><span class="op" id="302815">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="302819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="302822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302825">w</span><span class="op" id="302826">.</span><span class="ident" id="302827">Close</span><span class="op" id="302832">(</span><span class="op" id="302833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302836">nn</span>&nbsp;<span class="op" id="302839">:=</span>&nbsp;<span class="op" id="302842">&lt;-</span><span class="ident" id="302844">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="302847">if</span>&nbsp;<span class="ident" id="302850">nn</span>&nbsp;<span class="op" id="302853">!=</span>&nbsp;<span class="num" id="302856">0</span>&nbsp;<span class="op" id="302858">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302862">t</span><span class="op" id="302863">.</span><span class="ident" id="302864">Errorf</span><span class="op" id="302870">(</span><span class="string" id="302871">&#34;final&nbsp;read&nbsp;got&nbsp;%d&#34;</span><span class="op" id="302890">,</span>&nbsp;<span class="ident" id="302892">nn</span><span class="op" id="302894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="302897">}</span><br>
<span class="lineno"></span><span class="op" id="302899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="302902">type</span>&nbsp;<span class="ident" id="302907">pipeReturn</span>&nbsp;<span class="keyword" id="302918">struct</span>&nbsp;<span class="op" id="302925">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302928">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="302932">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="302937">err</span>&nbsp;<span class="builtintype" id="302941">error</span><br>
<span class="lineno"></span><span class="op" id="302947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="302950">//&nbsp;Test&nbsp;a&nbsp;large&nbsp;write&nbsp;that&nbsp;requires&nbsp;multiple&nbsp;reads&nbsp;to&nbsp;satisfy.</span><br>
<span class="lineno">90</span><span class="keyword" id="303013">func</span>&nbsp;<span class="ident" id="303018">writer</span><span class="op" id="303024">(</span><span class="ident" id="303025">w</span>&nbsp;<span class="ident" id="303027">WriteCloser</span><span class="op" id="303038">,</span>&nbsp;<span class="ident" id="303040">buf</span>&nbsp;<span class="op" id="303044">[</span><span class="op" id="303045">]</span><span class="builtintype" id="303046">byte</span><span class="op" id="303050">,</span>&nbsp;<span class="ident" id="303052">c</span>&nbsp;<span class="keyword" id="303054">chan</span>&nbsp;<span class="ident" id="303059">pipeReturn</span><span class="op" id="303069">)</span>&nbsp;<span class="op" id="303071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303074">n</span><span class="op" id="303075">,</span>&nbsp;<span class="ident" id="303077">err</span>&nbsp;<span class="op" id="303081">:=</span>&nbsp;<span class="ident" id="303084">w</span><span class="op" id="303085">.</span><span class="ident" id="303086">Write</span><span class="op" id="303091">(</span><span class="ident" id="303092">buf</span><span class="op" id="303095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303098">w</span><span class="op" id="303099">.</span><span class="ident" id="303100">Close</span><span class="op" id="303105">(</span><span class="op" id="303106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303109">c</span>&nbsp;<span class="op" id="303111">&lt;-</span>&nbsp;<span class="ident" id="303114">pipeReturn</span><span class="op" id="303124">{</span><span class="ident" id="303125">n</span><span class="op" id="303126">,</span>&nbsp;<span class="ident" id="303128">err</span><span class="op" id="303131">}</span><br>
<span class="lineno"></span><span class="op" id="303133">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="303136">func</span>&nbsp;<span class="ident" id="303141">TestPipe3</span><span class="op" id="303150">(</span><span class="ident" id="303151">t</span>&nbsp;<span class="op" id="303153">*</span><span class="ident" id="303154">testing</span><span class="op" id="303161">.</span><span class="ident" id="303162">T</span><span class="op" id="303163">)</span>&nbsp;<span class="op" id="303165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303168">c</span>&nbsp;<span class="op" id="303170">:=</span>&nbsp;<span class="builtinfunc" id="303173">make</span><span class="op" id="303177">(</span><span class="keyword" id="303178">chan</span>&nbsp;<span class="ident" id="303183">pipeReturn</span><span class="op" id="303193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303196">r</span><span class="op" id="303197">,</span>&nbsp;<span class="ident" id="303199">w</span>&nbsp;<span class="op" id="303201">:=</span>&nbsp;<span class="ident" id="303204">Pipe</span><span class="op" id="303208">(</span><span class="op" id="303209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="303212">var</span>&nbsp;<span class="ident" id="303216">wdat</span>&nbsp;<span class="op" id="303221">=</span>&nbsp;<span class="builtinfunc" id="303223">make</span><span class="op" id="303227">(</span><span class="op" id="303228">[</span><span class="op" id="303229">]</span><span class="builtintype" id="303230">byte</span><span class="op" id="303234">,</span>&nbsp;<span class="num" id="303236">128</span><span class="op" id="303239">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="303242">for</span>&nbsp;<span class="ident" id="303246">i</span>&nbsp;<span class="op" id="303248">:=</span>&nbsp;<span class="num" id="303251">0</span><span class="op" id="303252">;</span>&nbsp;<span class="ident" id="303254">i</span>&nbsp;<span class="op" id="303256">&lt;</span>&nbsp;<span class="builtinfunc" id="303258">len</span><span class="op" id="303261">(</span><span class="ident" id="303262">wdat</span><span class="op" id="303266">)</span><span class="op" id="303267">;</span>&nbsp;<span class="ident" id="303269">i</span><span class="op" id="303270">++</span>&nbsp;<span class="op" id="303273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303277">wdat</span><span class="op" id="303281">[</span><span class="ident" id="303282">i</span><span class="op" id="303283">]</span>&nbsp;<span class="op" id="303285">=</span>&nbsp;<span class="builtintype" id="303287">byte</span><span class="op" id="303291">(</span><span class="ident" id="303292">i</span><span class="op" id="303293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="303296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="303299">go</span>&nbsp;<span class="ident" id="303302">writer</span><span class="op" id="303308">(</span><span class="ident" id="303309">w</span><span class="op" id="303310">,</span>&nbsp;<span class="ident" id="303312">wdat</span><span class="op" id="303316">,</span>&nbsp;<span class="ident" id="303318">c</span><span class="op" id="303319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="303322">var</span>&nbsp;<span class="ident" id="303326">rdat</span>&nbsp;<span class="op" id="303331">=</span>&nbsp;<span class="builtinfunc" id="303333">make</span><span class="op" id="303337">(</span><span class="op" id="303338">[</span><span class="op" id="303339">]</span><span class="builtintype" id="303340">byte</span><span class="op" id="303344">,</span>&nbsp;<span class="num" id="303346">1024</span><span class="op" id="303350">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303353">tot</span>&nbsp;<span class="op" id="303357">:=</span>&nbsp;<span class="num" id="303360">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="303363">for</span>&nbsp;<span class="ident" id="303367">n</span>&nbsp;<span class="op" id="303369">:=</span>&nbsp;<span class="num" id="303372">1</span><span class="op" id="303373">;</span>&nbsp;<span class="ident" id="303375">n</span>&nbsp;<span class="op" id="303377">&lt;=</span>&nbsp;<span class="num" id="303380">256</span><span class="op" id="303383">;</span>&nbsp;<span class="ident" id="303385">n</span>&nbsp;<span class="op" id="303387">*=</span>&nbsp;<span class="num" id="303390">2</span>&nbsp;<span class="op" id="303392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303396">nn</span><span class="op" id="303398">,</span>&nbsp;<span class="ident" id="303400">err</span>&nbsp;<span class="op" id="303404">:=</span>&nbsp;<span class="ident" id="303407">r</span><span class="op" id="303408">.</span><span class="ident" id="303409">Read</span><span class="op" id="303413">(</span><span class="ident" id="303414">rdat</span><span class="op" id="303418">[</span><span class="ident" id="303419">tot</span>&nbsp;<span class="op" id="303423">:</span>&nbsp;<span class="ident" id="303425">tot</span><span class="op" id="303428">+</span><span class="ident" id="303429">n</span><span class="op" id="303430">]</span><span class="op" id="303431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="303435">if</span>&nbsp;<span class="ident" id="303438">err</span>&nbsp;<span class="op" id="303442">!=</span>&nbsp;<span class="ident" id="303445">nil</span>&nbsp;<span class="op" id="303449">&amp;&amp;</span>&nbsp;<span class="ident" id="303452">err</span>&nbsp;<span class="op" id="303456">!=</span>&nbsp;<span class="ident" id="303459">EOF</span>&nbsp;<span class="op" id="303463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303468">t</span><span class="op" id="303469">.</span><span class="ident" id="303470">Fatalf</span><span class="op" id="303476">(</span><span class="string" id="303477">&#34;read:&nbsp;%v&#34;</span><span class="op" id="303487">,</span>&nbsp;<span class="ident" id="303489">err</span><span class="op" id="303492">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="303496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="303501">//&nbsp;only&nbsp;final&nbsp;two&nbsp;reads&nbsp;should&nbsp;be&nbsp;short&nbsp;-&nbsp;1&nbsp;byte,&nbsp;then&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303560">expect</span>&nbsp;<span class="op" id="303567">:=</span>&nbsp;<span class="ident" id="303570">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="303574">if</span>&nbsp;<span class="ident" id="303577">n</span>&nbsp;<span class="op" id="303579">==</span>&nbsp;<span class="num" id="303582">128</span>&nbsp;<span class="op" id="303586">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303591">expect</span>&nbsp;<span class="op" id="303598">=</span>&nbsp;<span class="num" id="303600">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="303604">}</span>&nbsp;<span class="keyword" id="303606">else</span>&nbsp;<span class="keyword" id="303611">if</span>&nbsp;<span class="ident" id="303614">n</span>&nbsp;<span class="op" id="303616">==</span>&nbsp;<span class="num" id="303619">256</span>&nbsp;<span class="op" id="303623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303628">expect</span>&nbsp;<span class="op" id="303635">=</span>&nbsp;<span class="num" id="303637">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="303642">if</span>&nbsp;<span class="ident" id="303645">err</span>&nbsp;<span class="op" id="303649">!=</span>&nbsp;<span class="ident" id="303652">EOF</span>&nbsp;<span class="op" id="303656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303662">t</span><span class="op" id="303663">.</span><span class="ident" id="303664">Fatalf</span><span class="op" id="303670">(</span><span class="string" id="303671">&#34;read&nbsp;at&nbsp;end:&nbsp;%v&#34;</span><span class="op" id="303688">,</span>&nbsp;<span class="ident" id="303690">err</span><span class="op" id="303693">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="303698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="303702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="303706">if</span>&nbsp;<span class="ident" id="303709">nn</span>&nbsp;<span class="op" id="303712">!=</span>&nbsp;<span class="ident" id="303715">expect</span>&nbsp;<span class="op" id="303722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303727">t</span><span class="op" id="303728">.</span><span class="ident" id="303729">Fatalf</span><span class="op" id="303735">(</span><span class="string" id="303736">&#34;read&nbsp;%d,&nbsp;expected&nbsp;%d,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="303766">,</span>&nbsp;<span class="ident" id="303768">n</span><span class="op" id="303769">,</span>&nbsp;<span class="ident" id="303771">expect</span><span class="op" id="303777">,</span>&nbsp;<span class="ident" id="303779">nn</span><span class="op" id="303781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="303785">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303789">tot</span>&nbsp;<span class="op" id="303793">+=</span>&nbsp;<span class="ident" id="303796">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="303800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303803">pr</span>&nbsp;<span class="op" id="303806">:=</span>&nbsp;<span class="op" id="303809">&lt;-</span><span class="ident" id="303811">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="303814">if</span>&nbsp;<span class="ident" id="303817">pr</span><span class="op" id="303819">.</span><span class="ident" id="303820">n</span>&nbsp;<span class="op" id="303822">!=</span>&nbsp;<span class="num" id="303825">128</span>&nbsp;<span class="op" id="303829">||</span>&nbsp;<span class="ident" id="303832">pr</span><span class="op" id="303834">.</span><span class="ident" id="303835">err</span>&nbsp;<span class="op" id="303839">!=</span>&nbsp;<span class="ident" id="303842">nil</span>&nbsp;<span class="op" id="303846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303850">t</span><span class="op" id="303851">.</span><span class="ident" id="303852">Fatalf</span><span class="op" id="303858">(</span><span class="string" id="303859">&#34;write&nbsp;128:&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="303878">,</span>&nbsp;<span class="ident" id="303880">pr</span><span class="op" id="303882">.</span><span class="ident" id="303883">n</span><span class="op" id="303884">,</span>&nbsp;<span class="ident" id="303886">pr</span><span class="op" id="303888">.</span><span class="ident" id="303889">err</span><span class="op" id="303892">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="303895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="303898">if</span>&nbsp;<span class="ident" id="303901">tot</span>&nbsp;<span class="op" id="303905">!=</span>&nbsp;<span class="num" id="303908">128</span>&nbsp;<span class="op" id="303912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="303916">t</span><span class="op" id="303917">.</span><span class="ident" id="303918">Fatalf</span><span class="op" id="303924">(</span><span class="string" id="303925">&#34;total&nbsp;read&nbsp;%d&nbsp;!=&nbsp;128&#34;</span><span class="op" id="303947">,</span>&nbsp;<span class="ident" id="303949">tot</span><span class="op" id="303952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="303955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="303958">for</span>&nbsp;<span class="ident" id="303962">i</span>&nbsp;<span class="op" id="303964">:=</span>&nbsp;<span class="num" id="303967">0</span><span class="op" id="303968">;</span>&nbsp;<span class="ident" id="303970">i</span>&nbsp;<span class="op" id="303972">&lt;</span>&nbsp;<span class="num" id="303974">128</span><span class="op" id="303977">;</span>&nbsp;<span class="ident" id="303979">i</span><span class="op" id="303980">++</span>&nbsp;<span class="op" id="303983">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="303987">if</span>&nbsp;<span class="ident" id="303990">rdat</span><span class="op" id="303994">[</span><span class="ident" id="303995">i</span><span class="op" id="303996">]</span>&nbsp;<span class="op" id="303998">!=</span>&nbsp;<span class="builtintype" id="304001">byte</span><span class="op" id="304005">(</span><span class="ident" id="304006">i</span><span class="op" id="304007">)</span>&nbsp;<span class="op" id="304009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="304014">t</span><span class="op" id="304015">.</span><span class="ident" id="304016">Fatalf</span><span class="op" id="304022">(</span><span class="string" id="304023">&#34;rdat[%d]&nbsp;=&nbsp;%d&#34;</span><span class="op" id="304038">,</span>&nbsp;<span class="ident" id="304040">i</span><span class="op" id="304041">,</span>&nbsp;<span class="ident" id="304043">rdat</span><span class="op" id="304047">[</span><span class="ident" id="304048">i</span><span class="op" id="304049">]</span><span class="op" id="304050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="304054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="304057">}</span><br>
<span class="lineno"></span><span class="op" id="304059">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="304062">//&nbsp;Test&nbsp;read&nbsp;after/before&nbsp;writer&nbsp;close.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="304103">type</span>&nbsp;<span class="ident" id="304108">closer</span>&nbsp;<span class="keyword" id="304115">interface</span>&nbsp;<span class="op" id="304125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="304128">CloseWithError</span><span class="op" id="304142">(</span><span class="builtintype" id="304143">error</span><span class="op" id="304148">)</span>&nbsp;<span class="builtintype" id="304150">error</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="304157">Close</span><span class="op" id="304162">(</span><span class="op" id="304163">)</span>&nbsp;<span class="builtintype" id="304165">error</span><br>
<span class="lineno"></span><span class="op" id="304171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="304174">type</span>&nbsp;<span class="ident" id="304179">pipeTest</span>&nbsp;<span class="keyword" id="304188">struct</span>&nbsp;<span class="op" id="304195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="304198">async</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="304213">bool</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="304219">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="304234">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="304241">closeWithError</span>&nbsp;<span class="builtintype" id="304256">bool</span><br>
<span class="lineno"></span><span class="op" id="304261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="304264">func</span>&nbsp;<span class="op" id="304269">(</span><span class="ident" id="304270">p</span>&nbsp;<span class="ident" id="304272">pipeTest</span><span class="op" id="304280">)</span>&nbsp;<span class="ident" id="304282">String</span><span class="op" id="304288">(</span><span class="op" id="304289">)</span>&nbsp;<span class="builtintype" id="304291">string</span>&nbsp;<span class="op" id="304298">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="304301">return</span>&nbsp;<span class="ident" id="304308">fmt</span><span class="op" id="304311">.</span><span class="ident" id="304312">Sprintf</span><span class="op" id="304319">(</span><span class="string" id="304320">&#34;async=%v&nbsp;err=%v&nbsp;closeWithError=%v&#34;</span><span class="op" id="304355">,</span>&nbsp;<span class="ident" id="304357">p</span><span class="op" id="304358">.</span><span class="ident" id="304359">async</span><span class="op" id="304364">,</span>&nbsp;<span class="ident" id="304366">p</span><span class="op" id="304367">.</span><span class="ident" id="304368">err</span><span class="op" id="304371">,</span>&nbsp;<span class="ident" id="304373">p</span><span class="op" id="304374">.</span><span class="ident" id="304375">closeWithError</span><span class="op" id="304389">)</span><br>
<span class="lineno"></span><span class="op" id="304391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="304394">var</span>&nbsp;<span class="ident" id="304398">pipeTests</span>&nbsp;<span class="op" id="304408">=</span>&nbsp;<span class="op" id="304410">[</span><span class="op" id="304411">]</span><span class="ident" id="304412">pipeTest</span><span class="op" id="304420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="304423">{</span><span class="ident" id="304424">true</span><span class="op" id="304428">,</span>&nbsp;<span class="ident" id="304430">nil</span><span class="op" id="304433">,</span>&nbsp;<span class="ident" id="304435">false</span><span class="op" id="304440">}</span><span class="op" id="304441">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="304444">{</span><span class="ident" id="304445">true</span><span class="op" id="304449">,</span>&nbsp;<span class="ident" id="304451">nil</span><span class="op" id="304454">,</span>&nbsp;<span class="ident" id="304456">true</span><span class="op" id="304460">}</span><span class="op" id="304461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="304464">{</span><span class="ident" id="304465">true</span><span class="op" id="304469">,</span>&nbsp;<span class="ident" id="304471">ErrShortWrite</span><span class="op" id="304484">,</span>&nbsp;<span class="ident" id="304486">true</span><span class="op" id="304490">}</span><span class="op" id="304491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="304494">{</span><span class="ident" id="304495">false</span><span class="op" id="304500">,</span>&nbsp;<span class="ident" id="304502">nil</span><span class="op" id="304505">,</span>&nbsp;<span class="ident" id="304507">false</span><span class="op" id="304512">}</span><span class="op" id="304513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="304516">{</span><span class="ident" id="304517">false</span><span class="op" id="304522">,</span>&nbsp;<span class="ident" id="304524">nil</span><span class="op" id="304527">,</span>&nbsp;<span class="ident" id="304529">true</span><span class="op" id="304533">}</span><span class="op" id="304534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="304537">{</span><span class="ident" id="304538">false</span><span class="op" id="304543">,</span>&nbsp;<span class="ident" id="304545">ErrShortWrite</span><span class="op" id="304558">,</span>&nbsp;<span class="ident" id="304560">true</span><span class="op" id="304564">}</span><span class="op" id="304565">,</span><br>
<span class="lineno">165</span><span class="op" id="304567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="304570">func</span>&nbsp;<span class="ident" id="304575">delayClose</span><span class="op" id="304585">(</span><span class="ident" id="304586">t</span>&nbsp;<span class="op" id="304588">*</span><span class="ident" id="304589">testing</span><span class="op" id="304596">.</span><span class="ident" id="304597">T</span><span class="op" id="304598">,</span>&nbsp;<span class="ident" id="304600">cl</span>&nbsp;<span class="ident" id="304603">closer</span><span class="op" id="304609">,</span>&nbsp;<span class="ident" id="304611">ch</span>&nbsp;<span class="keyword" id="304614">chan</span>&nbsp;<span class="builtintype" id="304619">int</span><span class="op" id="304622">,</span>&nbsp;<span class="ident" id="304624">tt</span>&nbsp;<span class="ident" id="304627">pipeTest</span><span class="op" id="304635">)</span>&nbsp;<span class="op" id="304637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="304640">time</span><span class="op" id="304644">.</span><span class="ident" id="304645">Sleep</span><span class="op" id="304650">(</span><span class="num" id="304651">1</span>&nbsp;<span class="op" id="304653">*</span>&nbsp;<span class="ident" id="304655">time</span><span class="op" id="304659">.</span><span class="ident" id="304660">Millisecond</span><span class="op" id="304671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="304674">var</span>&nbsp;<span class="ident" id="304678">err</span>&nbsp;<span class="builtintype" id="304682">error</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="304689">if</span>&nbsp;<span class="ident" id="304692">tt</span><span class="op" id="304694">.</span><span class="ident" id="304695">closeWithError</span>&nbsp;<span class="op" id="304710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="304714">err</span>&nbsp;<span class="op" id="304718">=</span>&nbsp;<span class="ident" id="304720">cl</span><span class="op" id="304722">.</span><span class="ident" id="304723">CloseWithError</span><span class="op" id="304737">(</span><span class="ident" id="304738">tt</span><span class="op" id="304740">.</span><span class="ident" id="304741">err</span><span class="op" id="304744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="304747">}</span>&nbsp;<span class="keyword" id="304749">else</span>&nbsp;<span class="op" id="304754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="304758">err</span>&nbsp;<span class="op" id="304762">=</span>&nbsp;<span class="ident" id="304764">cl</span><span class="op" id="304766">.</span><span class="ident" id="304767">Close</span><span class="op" id="304772">(</span><span class="op" id="304773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="304776">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="304779">if</span>&nbsp;<span class="ident" id="304782">err</span>&nbsp;<span class="op" id="304786">!=</span>&nbsp;<span class="ident" id="304789">nil</span>&nbsp;<span class="op" id="304793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="304797">t</span><span class="op" id="304798">.</span><span class="ident" id="304799">Errorf</span><span class="op" id="304805">(</span><span class="string" id="304806">&#34;delayClose:&nbsp;%v&#34;</span><span class="op" id="304822">,</span>&nbsp;<span class="ident" id="304824">err</span><span class="op" id="304827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="304830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="304833">ch</span>&nbsp;<span class="op" id="304836">&lt;-</span>&nbsp;<span class="num" id="304839">0</span><br>
<span class="lineno"></span><span class="op" id="304841">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="304844">func</span>&nbsp;<span class="ident" id="304849">TestPipeReadClose</span><span class="op" id="304866">(</span><span class="ident" id="304867">t</span>&nbsp;<span class="op" id="304869">*</span><span class="ident" id="304870">testing</span><span class="op" id="304877">.</span><span class="ident" id="304878">T</span><span class="op" id="304879">)</span>&nbsp;<span class="op" id="304881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="304884">for</span>&nbsp;<span class="ident" id="304888">_</span><span class="op" id="304889">,</span>&nbsp;<span class="ident" id="304891">tt</span>&nbsp;<span class="op" id="304894">:=</span>&nbsp;<span class="keyword" id="304897">range</span>&nbsp;<span class="ident" id="304903">pipeTests</span>&nbsp;<span class="op" id="304913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="304917">c</span>&nbsp;<span class="op" id="304919">:=</span>&nbsp;<span class="builtinfunc" id="304922">make</span><span class="op" id="304926">(</span><span class="keyword" id="304927">chan</span>&nbsp;<span class="builtintype" id="304932">int</span><span class="op" id="304935">,</span>&nbsp;<span class="num" id="304937">1</span><span class="op" id="304938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="304942">r</span><span class="op" id="304943">,</span>&nbsp;<span class="ident" id="304945">w</span>&nbsp;<span class="op" id="304947">:=</span>&nbsp;<span class="ident" id="304950">Pipe</span><span class="op" id="304954">(</span><span class="op" id="304955">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="304959">if</span>&nbsp;<span class="ident" id="304962">tt</span><span class="op" id="304964">.</span><span class="ident" id="304965">async</span>&nbsp;<span class="op" id="304971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="304976">go</span>&nbsp;<span class="ident" id="304979">delayClose</span><span class="op" id="304989">(</span><span class="ident" id="304990">t</span><span class="op" id="304991">,</span>&nbsp;<span class="ident" id="304993">w</span><span class="op" id="304994">,</span>&nbsp;<span class="ident" id="304996">c</span><span class="op" id="304997">,</span>&nbsp;<span class="ident" id="304999">tt</span><span class="op" id="305001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="305005">}</span>&nbsp;<span class="keyword" id="305007">else</span>&nbsp;<span class="op" id="305012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="305017">delayClose</span><span class="op" id="305027">(</span><span class="ident" id="305028">t</span><span class="op" id="305029">,</span>&nbsp;<span class="ident" id="305031">w</span><span class="op" id="305032">,</span>&nbsp;<span class="ident" id="305034">c</span><span class="op" id="305035">,</span>&nbsp;<span class="ident" id="305037">tt</span><span class="op" id="305039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="305043">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="305047">var</span>&nbsp;<span class="ident" id="305051">buf</span>&nbsp;<span class="op" id="305055">=</span>&nbsp;<span class="builtinfunc" id="305057">make</span><span class="op" id="305061">(</span><span class="op" id="305062">[</span><span class="op" id="305063">]</span><span class="builtintype" id="305064">byte</span><span class="op" id="305068">,</span>&nbsp;<span class="num" id="305070">64</span><span class="op" id="305072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="305076">n</span><span class="op" id="305077">,</span>&nbsp;<span class="ident" id="305079">err</span>&nbsp;<span class="op" id="305083">:=</span>&nbsp;<span class="ident" id="305086">r</span><span class="op" id="305087">.</span><span class="ident" id="305088">Read</span><span class="op" id="305092">(</span><span class="ident" id="305093">buf</span><span class="op" id="305096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="305100">&lt;-</span><span class="ident" id="305102">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="305106">want</span>&nbsp;<span class="op" id="305111">:=</span>&nbsp;<span class="ident" id="305114">tt</span><span class="op" id="305116">.</span><span class="ident" id="305117">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="305123">if</span>&nbsp;<span class="ident" id="305126">want</span>&nbsp;<span class="op" id="305131">==</span>&nbsp;<span class="ident" id="305134">nil</span>&nbsp;<span class="op" id="305138">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="305143">want</span>&nbsp;<span class="op" id="305148">=</span>&nbsp;<span class="ident" id="305150">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="305156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="305160">if</span>&nbsp;<span class="ident" id="305163">err</span>&nbsp;<span class="op" id="305167">!=</span>&nbsp;<span class="ident" id="305170">want</span>&nbsp;<span class="op" id="305175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="305180">t</span><span class="op" id="305181">.</span><span class="ident" id="305182">Errorf</span><span class="op" id="305188">(</span><span class="string" id="305189">&#34;read&nbsp;from&nbsp;closed&nbsp;pipe:&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="305224">,</span>&nbsp;<span class="ident" id="305226">err</span><span class="op" id="305229">,</span>&nbsp;<span class="ident" id="305231">want</span><span class="op" id="305235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="305239">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="305243">if</span>&nbsp;<span class="ident" id="305246">n</span>&nbsp;<span class="op" id="305248">!=</span>&nbsp;<span class="num" id="305251">0</span>&nbsp;<span class="op" id="305253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="305258">t</span><span class="op" id="305259">.</span><span class="ident" id="305260">Errorf</span><span class="op" id="305266">(</span><span class="string" id="305267">&#34;read&nbsp;on&nbsp;closed&nbsp;pipe&nbsp;returned&nbsp;%d&#34;</span><span class="op" id="305300">,</span>&nbsp;<span class="ident" id="305302">n</span><span class="op" id="305303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="305307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="305311">if</span>&nbsp;<span class="ident" id="305314">err</span>&nbsp;<span class="op" id="305318">=</span>&nbsp;<span class="ident" id="305320">r</span><span class="op" id="305321">.</span><span class="ident" id="305322">Close</span><span class="op" id="305327">(</span><span class="op" id="305328">)</span><span class="op" id="305329">;</span>&nbsp;<span class="ident" id="305331">err</span>&nbsp;<span class="op" id="305335">!=</span>&nbsp;<span class="ident" id="305338">nil</span>&nbsp;<span class="op" id="305342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="305347">t</span><span class="op" id="305348">.</span><span class="ident" id="305349">Errorf</span><span class="op" id="305355">(</span><span class="string" id="305356">&#34;r.Close:&nbsp;%v&#34;</span><span class="op" id="305369">,</span>&nbsp;<span class="ident" id="305371">err</span><span class="op" id="305374">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="305378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="305381">}</span><br>
<span class="lineno"></span><span class="op" id="305383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="305386">//&nbsp;Test&nbsp;close&nbsp;on&nbsp;Read&nbsp;side&nbsp;during&nbsp;Read.</span><br>
<span class="lineno">210</span><span class="keyword" id="305426">func</span>&nbsp;<span class="ident" id="305431">TestPipeReadClose2</span><span class="op" id="305449">(</span><span class="ident" id="305450">t</span>&nbsp;<span class="op" id="305452">*</span><span class="ident" id="305453">testing</span><span class="op" id="305460">.</span><span class="ident" id="305461">T</span><span class="op" id="305462">)</span>&nbsp;<span class="op" id="305464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="305467">c</span>&nbsp;<span class="op" id="305469">:=</span>&nbsp;<span class="builtinfunc" id="305472">make</span><span class="op" id="305476">(</span><span class="keyword" id="305477">chan</span>&nbsp;<span class="builtintype" id="305482">int</span><span class="op" id="305485">,</span>&nbsp;<span class="num" id="305487">1</span><span class="op" id="305488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="305491">r</span><span class="op" id="305492">,</span>&nbsp;<span class="ident" id="305494">_</span>&nbsp;<span class="op" id="305496">:=</span>&nbsp;<span class="ident" id="305499">Pipe</span><span class="op" id="305503">(</span><span class="op" id="305504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="305507">go</span>&nbsp;<span class="ident" id="305510">delayClose</span><span class="op" id="305520">(</span><span class="ident" id="305521">t</span><span class="op" id="305522">,</span>&nbsp;<span class="ident" id="305524">r</span><span class="op" id="305525">,</span>&nbsp;<span class="ident" id="305527">c</span><span class="op" id="305528">,</span>&nbsp;<span class="ident" id="305530">pipeTest</span><span class="op" id="305538">{</span><span class="op" id="305539">}</span><span class="op" id="305540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="305543">n</span><span class="op" id="305544">,</span>&nbsp;<span class="ident" id="305546">err</span>&nbsp;<span class="op" id="305550">:=</span>&nbsp;<span class="ident" id="305553">r</span><span class="op" id="305554">.</span><span class="ident" id="305555">Read</span><span class="op" id="305559">(</span><span class="builtinfunc" id="305560">make</span><span class="op" id="305564">(</span><span class="op" id="305565">[</span><span class="op" id="305566">]</span><span class="builtintype" id="305567">byte</span><span class="op" id="305571">,</span>&nbsp;<span class="num" id="305573">64</span><span class="op" id="305575">)</span><span class="op" id="305576">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="305579">&lt;-</span><span class="ident" id="305581">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="305584">if</span>&nbsp;<span class="ident" id="305587">n</span>&nbsp;<span class="op" id="305589">!=</span>&nbsp;<span class="num" id="305592">0</span>&nbsp;<span class="op" id="305594">||</span>&nbsp;<span class="ident" id="305597">err</span>&nbsp;<span class="op" id="305601">!=</span>&nbsp;<span class="ident" id="305604">ErrClosedPipe</span>&nbsp;<span class="op" id="305618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="305622">t</span><span class="op" id="305623">.</span><span class="ident" id="305624">Errorf</span><span class="op" id="305630">(</span><span class="string" id="305631">&#34;read&nbsp;from&nbsp;closed&nbsp;pipe:&nbsp;%v,&nbsp;%v&nbsp;want&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="305674">,</span>&nbsp;<span class="ident" id="305676">n</span><span class="op" id="305677">,</span>&nbsp;<span class="ident" id="305679">err</span><span class="op" id="305682">,</span>&nbsp;<span class="num" id="305684">0</span><span class="op" id="305685">,</span>&nbsp;<span class="ident" id="305687">ErrClosedPipe</span><span class="op" id="305700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="305703">}</span><br>
<span class="lineno"></span><span class="op" id="305705">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="305708">//&nbsp;Test&nbsp;write&nbsp;after/before&nbsp;reader&nbsp;close.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="305750">func</span>&nbsp;<span class="ident" id="305755">TestPipeWriteClose</span><span class="op" id="305773">(</span><span class="ident" id="305774">t</span>&nbsp;<span class="op" id="305776">*</span><span class="ident" id="305777">testing</span><span class="op" id="305784">.</span><span class="ident" id="305785">T</span><span class="op" id="305786">)</span>&nbsp;<span class="op" id="305788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="305791">for</span>&nbsp;<span class="ident" id="305795">_</span><span class="op" id="305796">,</span>&nbsp;<span class="ident" id="305798">tt</span>&nbsp;<span class="op" id="305801">:=</span>&nbsp;<span class="keyword" id="305804">range</span>&nbsp;<span class="ident" id="305810">pipeTests</span>&nbsp;<span class="op" id="305820">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="305824">c</span>&nbsp;<span class="op" id="305826">:=</span>&nbsp;<span class="builtinfunc" id="305829">make</span><span class="op" id="305833">(</span><span class="keyword" id="305834">chan</span>&nbsp;<span class="builtintype" id="305839">int</span><span class="op" id="305842">,</span>&nbsp;<span class="num" id="305844">1</span><span class="op" id="305845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="305849">r</span><span class="op" id="305850">,</span>&nbsp;<span class="ident" id="305852">w</span>&nbsp;<span class="op" id="305854">:=</span>&nbsp;<span class="ident" id="305857">Pipe</span><span class="op" id="305861">(</span><span class="op" id="305862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="305866">if</span>&nbsp;<span class="ident" id="305869">tt</span><span class="op" id="305871">.</span><span class="ident" id="305872">async</span>&nbsp;<span class="op" id="305878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="305883">go</span>&nbsp;<span class="ident" id="305886">delayClose</span><span class="op" id="305896">(</span><span class="ident" id="305897">t</span><span class="op" id="305898">,</span>&nbsp;<span class="ident" id="305900">r</span><span class="op" id="305901">,</span>&nbsp;<span class="ident" id="305903">c</span><span class="op" id="305904">,</span>&nbsp;<span class="ident" id="305906">tt</span><span class="op" id="305908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="305912">}</span>&nbsp;<span class="keyword" id="305914">else</span>&nbsp;<span class="op" id="305919">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="305924">delayClose</span><span class="op" id="305934">(</span><span class="ident" id="305935">t</span><span class="op" id="305936">,</span>&nbsp;<span class="ident" id="305938">r</span><span class="op" id="305939">,</span>&nbsp;<span class="ident" id="305941">c</span><span class="op" id="305942">,</span>&nbsp;<span class="ident" id="305944">tt</span><span class="op" id="305946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="305950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="305954">n</span><span class="op" id="305955">,</span>&nbsp;<span class="ident" id="305957">err</span>&nbsp;<span class="op" id="305961">:=</span>&nbsp;<span class="ident" id="305964">WriteString</span><span class="op" id="305975">(</span><span class="ident" id="305976">w</span><span class="op" id="305977">,</span>&nbsp;<span class="string" id="305979">&#34;hello,&nbsp;world&#34;</span><span class="op" id="305993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="305997">&lt;-</span><span class="ident" id="305999">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306003">expect</span>&nbsp;<span class="op" id="306010">:=</span>&nbsp;<span class="ident" id="306013">tt</span><span class="op" id="306015">.</span><span class="ident" id="306016">err</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="306022">if</span>&nbsp;<span class="ident" id="306025">expect</span>&nbsp;<span class="op" id="306032">==</span>&nbsp;<span class="ident" id="306035">nil</span>&nbsp;<span class="op" id="306039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306044">expect</span>&nbsp;<span class="op" id="306051">=</span>&nbsp;<span class="ident" id="306053">ErrClosedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="306069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="306073">if</span>&nbsp;<span class="ident" id="306076">err</span>&nbsp;<span class="op" id="306080">!=</span>&nbsp;<span class="ident" id="306083">expect</span>&nbsp;<span class="op" id="306090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306095">t</span><span class="op" id="306096">.</span><span class="ident" id="306097">Errorf</span><span class="op" id="306103">(</span><span class="string" id="306104">&#34;write&nbsp;on&nbsp;closed&nbsp;pipe:&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="306138">,</span>&nbsp;<span class="ident" id="306140">err</span><span class="op" id="306143">,</span>&nbsp;<span class="ident" id="306145">expect</span><span class="op" id="306151">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="306155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="306159">if</span>&nbsp;<span class="ident" id="306162">n</span>&nbsp;<span class="op" id="306164">!=</span>&nbsp;<span class="num" id="306167">0</span>&nbsp;<span class="op" id="306169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306174">t</span><span class="op" id="306175">.</span><span class="ident" id="306176">Errorf</span><span class="op" id="306182">(</span><span class="string" id="306183">&#34;write&nbsp;on&nbsp;closed&nbsp;pipe&nbsp;returned&nbsp;%d&#34;</span><span class="op" id="306217">,</span>&nbsp;<span class="ident" id="306219">n</span><span class="op" id="306220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="306224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="306228">if</span>&nbsp;<span class="ident" id="306231">err</span>&nbsp;<span class="op" id="306235">=</span>&nbsp;<span class="ident" id="306237">w</span><span class="op" id="306238">.</span><span class="ident" id="306239">Close</span><span class="op" id="306244">(</span><span class="op" id="306245">)</span><span class="op" id="306246">;</span>&nbsp;<span class="ident" id="306248">err</span>&nbsp;<span class="op" id="306252">!=</span>&nbsp;<span class="ident" id="306255">nil</span>&nbsp;<span class="op" id="306259">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306264">t</span><span class="op" id="306265">.</span><span class="ident" id="306266">Errorf</span><span class="op" id="306272">(</span><span class="string" id="306273">&#34;w.Close:&nbsp;%v&#34;</span><span class="op" id="306286">,</span>&nbsp;<span class="ident" id="306288">err</span><span class="op" id="306291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="306295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="306298">}</span><br>
<span class="lineno"></span><span class="op" id="306300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="306303">func</span>&nbsp;<span class="ident" id="306308">TestWriteEmpty</span><span class="op" id="306322">(</span><span class="ident" id="306323">t</span>&nbsp;<span class="op" id="306325">*</span><span class="ident" id="306326">testing</span><span class="op" id="306333">.</span><span class="ident" id="306334">T</span><span class="op" id="306335">)</span>&nbsp;<span class="op" id="306337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306340">r</span><span class="op" id="306341">,</span>&nbsp;<span class="ident" id="306343">w</span>&nbsp;<span class="op" id="306345">:=</span>&nbsp;<span class="ident" id="306348">Pipe</span><span class="op" id="306352">(</span><span class="op" id="306353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="306356">go</span>&nbsp;<span class="keyword" id="306359">func</span><span class="op" id="306363">(</span><span class="op" id="306364">)</span>&nbsp;<span class="op" id="306366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306370">w</span><span class="op" id="306371">.</span><span class="ident" id="306372">Write</span><span class="op" id="306377">(</span><span class="op" id="306378">[</span><span class="op" id="306379">]</span><span class="builtintype" id="306380">byte</span><span class="op" id="306384">{</span><span class="op" id="306385">}</span><span class="op" id="306386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306390">w</span><span class="op" id="306391">.</span><span class="ident" id="306392">Close</span><span class="op" id="306397">(</span><span class="op" id="306398">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="306401">}</span><span class="op" id="306402">(</span><span class="op" id="306403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="306406">var</span>&nbsp;<span class="ident" id="306410">b</span>&nbsp;<span class="op" id="306412">[</span><span class="num" id="306413">2</span><span class="op" id="306414">]</span><span class="builtintype" id="306415">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306421">ReadFull</span><span class="op" id="306429">(</span><span class="ident" id="306430">r</span><span class="op" id="306431">,</span>&nbsp;<span class="ident" id="306433">b</span><span class="op" id="306434">[</span><span class="num" id="306435">0</span><span class="op" id="306436">:</span><span class="num" id="306437">2</span><span class="op" id="306438">]</span><span class="op" id="306439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306442">r</span><span class="op" id="306443">.</span><span class="ident" id="306444">Close</span><span class="op" id="306449">(</span><span class="op" id="306450">)</span><br>
<span class="lineno"></span><span class="op" id="306452">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="306455">func</span>&nbsp;<span class="ident" id="306460">TestWriteNil</span><span class="op" id="306472">(</span><span class="ident" id="306473">t</span>&nbsp;<span class="op" id="306475">*</span><span class="ident" id="306476">testing</span><span class="op" id="306483">.</span><span class="ident" id="306484">T</span><span class="op" id="306485">)</span>&nbsp;<span class="op" id="306487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306490">r</span><span class="op" id="306491">,</span>&nbsp;<span class="ident" id="306493">w</span>&nbsp;<span class="op" id="306495">:=</span>&nbsp;<span class="ident" id="306498">Pipe</span><span class="op" id="306502">(</span><span class="op" id="306503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="306506">go</span>&nbsp;<span class="keyword" id="306509">func</span><span class="op" id="306513">(</span><span class="op" id="306514">)</span>&nbsp;<span class="op" id="306516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306520">w</span><span class="op" id="306521">.</span><span class="ident" id="306522">Write</span><span class="op" id="306527">(</span><span class="ident" id="306528">nil</span><span class="op" id="306531">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306535">w</span><span class="op" id="306536">.</span><span class="ident" id="306537">Close</span><span class="op" id="306542">(</span><span class="op" id="306543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="306546">}</span><span class="op" id="306547">(</span><span class="op" id="306548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="306551">var</span>&nbsp;<span class="ident" id="306555">b</span>&nbsp;<span class="op" id="306557">[</span><span class="num" id="306558">2</span><span class="op" id="306559">]</span><span class="builtintype" id="306560">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306566">ReadFull</span><span class="op" id="306574">(</span><span class="ident" id="306575">r</span><span class="op" id="306576">,</span>&nbsp;<span class="ident" id="306578">b</span><span class="op" id="306579">[</span><span class="num" id="306580">0</span><span class="op" id="306581">:</span><span class="num" id="306582">2</span><span class="op" id="306583">]</span><span class="op" id="306584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306587">r</span><span class="op" id="306588">.</span><span class="ident" id="306589">Close</span><span class="op" id="306594">(</span><span class="op" id="306595">)</span><br>
<span class="lineno">270</span><span class="op" id="306597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="306600">func</span>&nbsp;<span class="ident" id="306605">TestWriteAfterWriterClose</span><span class="op" id="306630">(</span><span class="ident" id="306631">t</span>&nbsp;<span class="op" id="306633">*</span><span class="ident" id="306634">testing</span><span class="op" id="306641">.</span><span class="ident" id="306642">T</span><span class="op" id="306643">)</span>&nbsp;<span class="op" id="306645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306648">r</span><span class="op" id="306649">,</span>&nbsp;<span class="ident" id="306651">w</span>&nbsp;<span class="op" id="306653">:=</span>&nbsp;<span class="ident" id="306656">Pipe</span><span class="op" id="306660">(</span><span class="op" id="306661">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306665">done</span>&nbsp;<span class="op" id="306670">:=</span>&nbsp;<span class="builtinfunc" id="306673">make</span><span class="op" id="306677">(</span><span class="keyword" id="306678">chan</span>&nbsp;<span class="builtintype" id="306683">bool</span><span class="op" id="306687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="306690">var</span>&nbsp;<span class="ident" id="306694">writeErr</span>&nbsp;<span class="builtintype" id="306703">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="306710">go</span>&nbsp;<span class="keyword" id="306713">func</span><span class="op" id="306717">(</span><span class="op" id="306718">)</span>&nbsp;<span class="op" id="306720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306724">_</span><span class="op" id="306725">,</span>&nbsp;<span class="ident" id="306727">err</span>&nbsp;<span class="op" id="306731">:=</span>&nbsp;<span class="ident" id="306734">w</span><span class="op" id="306735">.</span><span class="ident" id="306736">Write</span><span class="op" id="306741">(</span><span class="op" id="306742">[</span><span class="op" id="306743">]</span><span class="builtintype" id="306744">byte</span><span class="op" id="306748">(</span><span class="string" id="306749">&#34;hello&#34;</span><span class="op" id="306756">)</span><span class="op" id="306757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="306761">if</span>&nbsp;<span class="ident" id="306764">err</span>&nbsp;<span class="op" id="306768">!=</span>&nbsp;<span class="ident" id="306771">nil</span>&nbsp;<span class="op" id="306775">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306780">t</span><span class="op" id="306781">.</span><span class="ident" id="306782">Errorf</span><span class="op" id="306788">(</span><span class="string" id="306789">&#34;got&nbsp;error:&nbsp;%q;&nbsp;expected&nbsp;none&#34;</span><span class="op" id="306819">,</span>&nbsp;<span class="ident" id="306821">err</span><span class="op" id="306824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="306828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306832">w</span><span class="op" id="306833">.</span><span class="ident" id="306834">Close</span><span class="op" id="306839">(</span><span class="op" id="306840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306844">_</span><span class="op" id="306845">,</span>&nbsp;<span class="ident" id="306847">writeErr</span>&nbsp;<span class="op" id="306856">=</span>&nbsp;<span class="ident" id="306858">w</span><span class="op" id="306859">.</span><span class="ident" id="306860">Write</span><span class="op" id="306865">(</span><span class="op" id="306866">[</span><span class="op" id="306867">]</span><span class="builtintype" id="306868">byte</span><span class="op" id="306872">(</span><span class="string" id="306873">&#34;world&#34;</span><span class="op" id="306880">)</span><span class="op" id="306881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306885">done</span>&nbsp;<span class="op" id="306890">&lt;-</span>&nbsp;<span class="ident" id="306893">true</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="306899">}</span><span class="op" id="306900">(</span><span class="op" id="306901">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306905">buf</span>&nbsp;<span class="op" id="306909">:=</span>&nbsp;<span class="builtinfunc" id="306912">make</span><span class="op" id="306916">(</span><span class="op" id="306917">[</span><span class="op" id="306918">]</span><span class="builtintype" id="306919">byte</span><span class="op" id="306923">,</span>&nbsp;<span class="num" id="306925">100</span><span class="op" id="306928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="306931">var</span>&nbsp;<span class="ident" id="306935">result</span>&nbsp;<span class="builtintype" id="306942">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="306950">n</span><span class="op" id="306951">,</span>&nbsp;<span class="ident" id="306953">err</span>&nbsp;<span class="op" id="306957">:=</span>&nbsp;<span class="ident" id="306960">ReadFull</span><span class="op" id="306968">(</span><span class="ident" id="306969">r</span><span class="op" id="306970">,</span>&nbsp;<span class="ident" id="306972">buf</span><span class="op" id="306975">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="306978">if</span>&nbsp;<span class="ident" id="306981">err</span>&nbsp;<span class="op" id="306985">!=</span>&nbsp;<span class="ident" id="306988">nil</span>&nbsp;<span class="op" id="306992">&amp;&amp;</span>&nbsp;<span class="ident" id="306995">err</span>&nbsp;<span class="op" id="306999">!=</span>&nbsp;<span class="ident" id="307002">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="307019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="307023">t</span><span class="op" id="307024">.</span><span class="ident" id="307025">Fatalf</span><span class="op" id="307031">(</span><span class="string" id="307032">&#34;got:&nbsp;%q;&nbsp;want:&nbsp;%q&#34;</span><span class="op" id="307051">,</span>&nbsp;<span class="ident" id="307053">err</span><span class="op" id="307056">,</span>&nbsp;<span class="ident" id="307058">ErrUnexpectedEOF</span><span class="op" id="307074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="307077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="307080">result</span>&nbsp;<span class="op" id="307087">=</span>&nbsp;<span class="builtintype" id="307089">string</span><span class="op" id="307095">(</span><span class="ident" id="307096">buf</span><span class="op" id="307099">[</span><span class="num" id="307100">0</span><span class="op" id="307101">:</span><span class="ident" id="307102">n</span><span class="op" id="307103">]</span><span class="op" id="307104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="307107">&lt;-</span><span class="ident" id="307109">done</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="307116">if</span>&nbsp;<span class="ident" id="307119">result</span>&nbsp;<span class="op" id="307126">!=</span>&nbsp;<span class="string" id="307129">&#34;hello&#34;</span>&nbsp;<span class="op" id="307137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="307141">t</span><span class="op" id="307142">.</span><span class="ident" id="307143">Errorf</span><span class="op" id="307149">(</span><span class="string" id="307150">&#34;got:&nbsp;%q;&nbsp;want:&nbsp;%q&#34;</span><span class="op" id="307169">,</span>&nbsp;<span class="ident" id="307171">result</span><span class="op" id="307177">,</span>&nbsp;<span class="string" id="307179">&#34;hello&#34;</span><span class="op" id="307186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="307189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="307192">if</span>&nbsp;<span class="ident" id="307195">writeErr</span>&nbsp;<span class="op" id="307204">!=</span>&nbsp;<span class="ident" id="307207">ErrClosedPipe</span>&nbsp;<span class="op" id="307221">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="307225">t</span><span class="op" id="307226">.</span><span class="ident" id="307227">Errorf</span><span class="op" id="307233">(</span><span class="string" id="307234">&#34;got:&nbsp;%q;&nbsp;want:&nbsp;%q&#34;</span><span class="op" id="307253">,</span>&nbsp;<span class="ident" id="307255">writeErr</span><span class="op" id="307263">,</span>&nbsp;<span class="ident" id="307265">ErrClosedPipe</span><span class="op" id="307278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="307281">}</span><br>
<span class="lineno"></span><span class="op" id="307283">}</span>
</div>
</body>
</html>
