<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4341331">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4341386">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4341440">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4341491">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-output&nbsp;fixedhuff.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4341541">//&nbsp;Package&nbsp;flate&nbsp;implements&nbsp;the&nbsp;DEFLATE&nbsp;compressed&nbsp;data&nbsp;format,&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4341618">//&nbsp;RFC&nbsp;1951.&nbsp;&nbsp;The&nbsp;gzip&nbsp;and&nbsp;zlib&nbsp;packages&nbsp;implement&nbsp;access&nbsp;to&nbsp;DEFLATE-based&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="4341698">//&nbsp;formats.</span><br>
<span class="lineno">10</span><span class="keyword" id="4341710">package</span>&nbsp;<span class="ident" id="4341718">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4341725">import</span>&nbsp;<span class="op" id="4341732">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4341735">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4341744">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4341750">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="4341760">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4341763">const</span>&nbsp;<span class="op" id="4341769">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341772">maxCodeLen</span>&nbsp;<span class="op" id="4341783">=</span>&nbsp;<span class="num" id="4341785">16</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4341791">//&nbsp;max&nbsp;length&nbsp;of&nbsp;Huffman&nbsp;code</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341822">maxHist</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4341833">=</span>&nbsp;<span class="num" id="4341835">32768</span>&nbsp;<span class="comment" id="4341841">//&nbsp;max&nbsp;history&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4341866">//&nbsp;The&nbsp;next&nbsp;three&nbsp;numbers&nbsp;come&nbsp;from&nbsp;the&nbsp;RFC,&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341927">maxLit</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4341936">=</span>&nbsp;<span class="num" id="4341938">286</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341943">maxDist</span>&nbsp;&nbsp;<span class="op" id="4341952">=</span>&nbsp;<span class="num" id="4341954">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4341958">numCodes</span>&nbsp;<span class="op" id="4341967">=</span>&nbsp;<span class="num" id="4341969">19</span>&nbsp;<span class="comment" id="4341972">//&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;Huffman&nbsp;meta-code</span><br>
<span class="lineno">25</span><span class="op" id="4342012">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4342015">//&nbsp;A&nbsp;CorruptInputError&nbsp;reports&nbsp;the&nbsp;presence&nbsp;of&nbsp;corrupt&nbsp;input&nbsp;at&nbsp;a&nbsp;given&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="4342095">type</span>&nbsp;<span class="ident" id="4342100">CorruptInputError</span>&nbsp;<span class="ident" id="4342118">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4342125">func</span>&nbsp;<span class="op" id="4342130">(</span><span class="ident" id="4342131">e</span>&nbsp;<span class="ident" id="4342133">CorruptInputError</span><span class="op" id="4342150">)</span>&nbsp;<span class="ident" id="4342152">Error</span><span class="op" id="4342157">(</span><span class="op" id="4342158">)</span>&nbsp;<span class="builtintype" id="4342160">string</span>&nbsp;<span class="op" id="4342167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4342170">return</span>&nbsp;<span class="string" id="4342177">&#34;flate:&nbsp;corrupt&nbsp;input&nbsp;before&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4342215">+</span>&nbsp;<span class="ident" id="4342217">strconv</span><span class="op" id="4342224">.</span><span class="ident" id="4342225">FormatInt</span><span class="op" id="4342234">(</span><span class="ident" id="4342235">int64</span><span class="op" id="4342240">(</span><span class="ident" id="4342241">e</span><span class="op" id="4342242">)</span><span class="op" id="4342243">,</span>&nbsp;<span class="num" id="4342245">10</span><span class="op" id="4342247">)</span><br>
<span class="lineno"></span><span class="op" id="4342249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4342252">//&nbsp;An&nbsp;InternalError&nbsp;reports&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;flate&nbsp;code&nbsp;itself.</span><br>
<span class="lineno">35</span><span class="keyword" id="4342315">type</span>&nbsp;<span class="ident" id="4342320">InternalError</span>&nbsp;<span class="builtintype" id="4342334">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4342342">func</span>&nbsp;<span class="op" id="4342347">(</span><span class="ident" id="4342348">e</span>&nbsp;<span class="ident" id="4342350">InternalError</span><span class="op" id="4342363">)</span>&nbsp;<span class="ident" id="4342365">Error</span><span class="op" id="4342370">(</span><span class="op" id="4342371">)</span>&nbsp;<span class="builtintype" id="4342373">string</span>&nbsp;<span class="op" id="4342380">{</span>&nbsp;<span class="keyword" id="4342382">return</span>&nbsp;<span class="string" id="4342389">&#34;flate:&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="4342415">+</span>&nbsp;<span class="builtintype" id="4342417">string</span><span class="op" id="4342423">(</span><span class="ident" id="4342424">e</span><span class="op" id="4342425">)</span>&nbsp;<span class="op" id="4342427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4342430">//&nbsp;A&nbsp;ReadError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;reading&nbsp;input.</span><br>
<span class="lineno">40</span><span class="keyword" id="4342495">type</span>&nbsp;<span class="ident" id="4342500">ReadError</span>&nbsp;<span class="keyword" id="4342510">struct</span>&nbsp;<span class="op" id="4342517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4342520">Offset</span>&nbsp;<span class="ident" id="4342527">int64</span>&nbsp;<span class="comment" id="4342533">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4342570">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4342577">error</span>&nbsp;<span class="comment" id="4342583">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="4342620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4342623">func</span>&nbsp;<span class="op" id="4342628">(</span><span class="ident" id="4342629">e</span>&nbsp;<span class="op" id="4342631">*</span><span class="ident" id="4342632">ReadError</span><span class="op" id="4342641">)</span>&nbsp;<span class="ident" id="4342643">Error</span><span class="op" id="4342648">(</span><span class="op" id="4342649">)</span>&nbsp;<span class="builtintype" id="4342651">string</span>&nbsp;<span class="op" id="4342658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4342661">return</span>&nbsp;<span class="string" id="4342668">&#34;flate:&nbsp;read&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4342699">+</span>&nbsp;<span class="ident" id="4342701">strconv</span><span class="op" id="4342708">.</span><span class="ident" id="4342709">FormatInt</span><span class="op" id="4342718">(</span><span class="ident" id="4342719">e</span><span class="op" id="4342720">.</span><span class="ident" id="4342721">Offset</span><span class="op" id="4342727">,</span>&nbsp;<span class="num" id="4342729">10</span><span class="op" id="4342731">)</span>&nbsp;<span class="op" id="4342733">+</span>&nbsp;<span class="string" id="4342735">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4342740">+</span>&nbsp;<span class="ident" id="4342742">e</span><span class="op" id="4342743">.</span><span class="ident" id="4342744">Err</span><span class="op" id="4342747">.</span><span class="ident" id="4342748">Error</span><span class="op" id="4342753">(</span><span class="op" id="4342754">)</span><br>
<span class="lineno"></span><span class="op" id="4342756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4342759">//&nbsp;A&nbsp;WriteError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;writing&nbsp;output.</span><br>
<span class="lineno">50</span><span class="keyword" id="4342826">type</span>&nbsp;<span class="ident" id="4342831">WriteError</span>&nbsp;<span class="keyword" id="4342842">struct</span>&nbsp;<span class="op" id="4342849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4342852">Offset</span>&nbsp;<span class="ident" id="4342859">int64</span>&nbsp;<span class="comment" id="4342865">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4342902">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4342909">error</span>&nbsp;<span class="comment" id="4342915">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="4342953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4342956">func</span>&nbsp;<span class="op" id="4342961">(</span><span class="ident" id="4342962">e</span>&nbsp;<span class="op" id="4342964">*</span><span class="ident" id="4342965">WriteError</span><span class="op" id="4342975">)</span>&nbsp;<span class="ident" id="4342977">Error</span><span class="op" id="4342982">(</span><span class="op" id="4342983">)</span>&nbsp;<span class="builtintype" id="4342985">string</span>&nbsp;<span class="op" id="4342992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4342995">return</span>&nbsp;<span class="string" id="4343002">&#34;flate:&nbsp;write&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4343034">+</span>&nbsp;<span class="ident" id="4343036">strconv</span><span class="op" id="4343043">.</span><span class="ident" id="4343044">FormatInt</span><span class="op" id="4343053">(</span><span class="ident" id="4343054">e</span><span class="op" id="4343055">.</span><span class="ident" id="4343056">Offset</span><span class="op" id="4343062">,</span>&nbsp;<span class="num" id="4343064">10</span><span class="op" id="4343066">)</span>&nbsp;<span class="op" id="4343068">+</span>&nbsp;<span class="string" id="4343070">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4343075">+</span>&nbsp;<span class="ident" id="4343077">e</span><span class="op" id="4343078">.</span><span class="ident" id="4343079">Err</span><span class="op" id="4343082">.</span><span class="ident" id="4343083">Error</span><span class="op" id="4343088">(</span><span class="op" id="4343089">)</span><br>
<span class="lineno"></span><span class="op" id="4343091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4343094">//&nbsp;Resetter&nbsp;resets&nbsp;a&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;or&nbsp;NewReaderDict&nbsp;to</span><br>
<span class="lineno">60</span><span class="comment" id="4343168">//&nbsp;to&nbsp;switch&nbsp;to&nbsp;a&nbsp;new&nbsp;underlying&nbsp;Reader.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;ReadCloser</span><br>
<span class="lineno"></span><span class="comment" id="4343243">//&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4343279">type</span>&nbsp;<span class="ident" id="4343284">Resetter</span>&nbsp;<span class="keyword" id="4343293">interface</span>&nbsp;<span class="op" id="4343303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4343306">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data&nbsp;and&nbsp;resets&nbsp;the&nbsp;Resetter&nbsp;as&nbsp;if&nbsp;it&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4343380">//&nbsp;newly&nbsp;initialized&nbsp;with&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4343425">Reset</span><span class="op" id="4343430">(</span><span class="ident" id="4343431">r</span>&nbsp;<span class="ident" id="4343433">io</span><span class="op" id="4343435">.</span><span class="ident" id="4343436">Reader</span><span class="op" id="4343442">,</span>&nbsp;<span class="ident" id="4343444">dict</span>&nbsp;<span class="op" id="4343449">[</span><span class="op" id="4343450">]</span><span class="builtintype" id="4343451">byte</span><span class="op" id="4343455">)</span>&nbsp;<span class="builtintype" id="4343457">error</span><br>
<span class="lineno"></span><span class="op" id="4343463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4343466">//&nbsp;Note&nbsp;that&nbsp;much&nbsp;of&nbsp;the&nbsp;implementation&nbsp;of&nbsp;huffmanDecoder&nbsp;is&nbsp;also&nbsp;copied</span><br>
<span class="lineno"></span><span class="comment" id="4343539">//&nbsp;into&nbsp;gen.go&nbsp;(in&nbsp;package&nbsp;main)&nbsp;for&nbsp;the&nbsp;purpose&nbsp;of&nbsp;precomputing&nbsp;the</span><br>
<span class="lineno">70</span><span class="comment" id="4343608">//&nbsp;fixed&nbsp;huffman&nbsp;tables&nbsp;so&nbsp;they&nbsp;can&nbsp;be&nbsp;included&nbsp;statically.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4343669">//&nbsp;The&nbsp;data&nbsp;structure&nbsp;for&nbsp;decoding&nbsp;Huffman&nbsp;tables&nbsp;is&nbsp;based&nbsp;on&nbsp;that&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4343739">//&nbsp;zlib.&nbsp;There&nbsp;is&nbsp;a&nbsp;lookup&nbsp;table&nbsp;of&nbsp;a&nbsp;fixed&nbsp;bit&nbsp;width&nbsp;(huffmanChunkBits),</span><br>
<span class="lineno"></span><span class="comment" id="4343813">//&nbsp;For&nbsp;codes&nbsp;smaller&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;there&nbsp;are&nbsp;multiple&nbsp;entries</span><br>
<span class="lineno">75</span><span class="comment" id="4343883">//&nbsp;(each&nbsp;combination&nbsp;of&nbsp;trailing&nbsp;bits&nbsp;has&nbsp;the&nbsp;same&nbsp;value).&nbsp;For&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4343952">//&nbsp;larger&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;the&nbsp;table&nbsp;contains&nbsp;a&nbsp;link&nbsp;to&nbsp;an&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="4344025">//&nbsp;table.&nbsp;The&nbsp;width&nbsp;of&nbsp;each&nbsp;entry&nbsp;in&nbsp;the&nbsp;link&nbsp;table&nbsp;is&nbsp;the&nbsp;maximum&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="4344097">//&nbsp;size&nbsp;minus&nbsp;the&nbsp;chunk&nbsp;width.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4344129">//&nbsp;Note&nbsp;that&nbsp;you&nbsp;can&nbsp;do&nbsp;a&nbsp;lookup&nbsp;in&nbsp;the&nbsp;table&nbsp;even&nbsp;without&nbsp;all&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4344197">//&nbsp;filled.&nbsp;Since&nbsp;the&nbsp;extra&nbsp;bits&nbsp;are&nbsp;zero,&nbsp;and&nbsp;the&nbsp;DEFLATE&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4344269">//&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;shorter&nbsp;codes&nbsp;come&nbsp;before&nbsp;longer&nbsp;ones,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4344338">//&nbsp;bit&nbsp;length&nbsp;estimate&nbsp;in&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;lower&nbsp;bound&nbsp;on&nbsp;the&nbsp;actual</span><br>
<span class="lineno"></span><span class="comment" id="4344406">//&nbsp;number&nbsp;of&nbsp;bits.</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4344426">//&nbsp;chunk&nbsp;&amp;&nbsp;15&nbsp;is&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4344458">//&nbsp;chunk&nbsp;&gt;&gt;&nbsp;4&nbsp;is&nbsp;value,&nbsp;including&nbsp;table&nbsp;link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4344504">const</span>&nbsp;<span class="op" id="4344510">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344513">huffmanChunkBits</span>&nbsp;&nbsp;<span class="op" id="4344531">=</span>&nbsp;<span class="num" id="4344533">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344536">huffmanNumChunks</span>&nbsp;&nbsp;<span class="op" id="4344554">=</span>&nbsp;<span class="num" id="4344556">1</span>&nbsp;<span class="op" id="4344558">&lt;&lt;</span>&nbsp;<span class="ident" id="4344561">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344579">huffmanCountMask</span>&nbsp;&nbsp;<span class="op" id="4344597">=</span>&nbsp;<span class="num" id="4344599">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344603">huffmanValueShift</span>&nbsp;<span class="op" id="4344621">=</span>&nbsp;<span class="num" id="4344623">4</span><br>
<span class="lineno"></span><span class="op" id="4344625">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="4344628">type</span>&nbsp;<span class="ident" id="4344633">huffmanDecoder</span>&nbsp;<span class="keyword" id="4344648">struct</span>&nbsp;<span class="op" id="4344655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344658">min</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4344667">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4344692">//&nbsp;the&nbsp;minimum&nbsp;code&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344720">chunks</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4344729">[</span><span class="ident" id="4344730">huffmanNumChunks</span><span class="op" id="4344746">]</span><span class="builtintype" id="4344747">uint32</span>&nbsp;<span class="comment" id="4344754">//&nbsp;chunks&nbsp;as&nbsp;described&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344784">links</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4344793">[</span><span class="op" id="4344794">]</span><span class="op" id="4344795">[</span><span class="op" id="4344796">]</span><span class="builtintype" id="4344797">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4344818">//&nbsp;overflow&nbsp;links</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4344837">linkMask</span>&nbsp;<span class="builtintype" id="4344846">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4344871">//&nbsp;mask&nbsp;the&nbsp;width&nbsp;of&nbsp;the&nbsp;link&nbsp;table</span><br>
<span class="lineno"></span><span class="op" id="4344907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4344910">//&nbsp;Initialize&nbsp;Huffman&nbsp;decoding&nbsp;tables&nbsp;from&nbsp;array&nbsp;of&nbsp;code&nbsp;lengths.</span><br>
<span class="lineno"></span><span class="keyword" id="4344976">func</span>&nbsp;<span class="op" id="4344981">(</span><span class="ident" id="4344982">h</span>&nbsp;<span class="op" id="4344984">*</span><span class="ident" id="4344985">huffmanDecoder</span><span class="op" id="4344999">)</span>&nbsp;<span class="ident" id="4345001">init</span><span class="op" id="4345005">(</span><span class="ident" id="4345006">bits</span>&nbsp;<span class="op" id="4345011">[</span><span class="op" id="4345012">]</span><span class="builtintype" id="4345013">int</span><span class="op" id="4345016">)</span>&nbsp;<span class="builtintype" id="4345018">bool</span>&nbsp;<span class="op" id="4345023">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345026">if</span>&nbsp;<span class="ident" id="4345029">h</span><span class="op" id="4345030">.</span><span class="ident" id="4345031">min</span>&nbsp;<span class="op" id="4345035">!=</span>&nbsp;<span class="num" id="4345038">0</span>&nbsp;<span class="op" id="4345040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4345044">*</span><span class="ident" id="4345045">h</span>&nbsp;<span class="op" id="4345047">=</span>&nbsp;<span class="ident" id="4345049">huffmanDecoder</span><span class="op" id="4345063">{</span><span class="op" id="4345064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4345067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4345071">//&nbsp;Count&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;each&nbsp;length,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4345113">//&nbsp;compute&nbsp;min&nbsp;and&nbsp;max&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345145">var</span>&nbsp;<span class="ident" id="4345149">count</span>&nbsp;<span class="op" id="4345155">[</span><span class="ident" id="4345156">maxCodeLen</span><span class="op" id="4345166">]</span><span class="builtintype" id="4345167">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345172">var</span>&nbsp;<span class="ident" id="4345176">min</span><span class="op" id="4345179">,</span>&nbsp;<span class="ident" id="4345181">max</span>&nbsp;<span class="builtintype" id="4345185">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345190">for</span>&nbsp;<span class="ident" id="4345194">_</span><span class="op" id="4345195">,</span>&nbsp;<span class="ident" id="4345197">n</span>&nbsp;<span class="op" id="4345199">:=</span>&nbsp;<span class="keyword" id="4345202">range</span>&nbsp;<span class="ident" id="4345208">bits</span>&nbsp;<span class="op" id="4345213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345217">if</span>&nbsp;<span class="ident" id="4345220">n</span>&nbsp;<span class="op" id="4345222">==</span>&nbsp;<span class="num" id="4345225">0</span>&nbsp;<span class="op" id="4345227">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345232">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4345243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345247">if</span>&nbsp;<span class="ident" id="4345250">min</span>&nbsp;<span class="op" id="4345254">==</span>&nbsp;<span class="num" id="4345257">0</span>&nbsp;<span class="op" id="4345259">||</span>&nbsp;<span class="ident" id="4345262">n</span>&nbsp;<span class="op" id="4345264">&lt;</span>&nbsp;<span class="ident" id="4345266">min</span>&nbsp;<span class="op" id="4345270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345275">min</span>&nbsp;<span class="op" id="4345279">=</span>&nbsp;<span class="ident" id="4345281">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4345285">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345289">if</span>&nbsp;<span class="ident" id="4345292">n</span>&nbsp;<span class="op" id="4345294">&gt;</span>&nbsp;<span class="ident" id="4345296">max</span>&nbsp;<span class="op" id="4345300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345305">max</span>&nbsp;<span class="op" id="4345309">=</span>&nbsp;<span class="ident" id="4345311">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4345315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345319">count</span><span class="op" id="4345324">[</span><span class="ident" id="4345325">n</span><span class="op" id="4345326">]</span><span class="op" id="4345327">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4345331">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345334">if</span>&nbsp;<span class="ident" id="4345337">max</span>&nbsp;<span class="op" id="4345341">==</span>&nbsp;<span class="num" id="4345344">0</span>&nbsp;<span class="op" id="4345346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345350">return</span>&nbsp;<span class="ident" id="4345357">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4345364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345368">h</span><span class="op" id="4345369">.</span><span class="ident" id="4345370">min</span>&nbsp;<span class="op" id="4345374">=</span>&nbsp;<span class="ident" id="4345376">min</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345381">var</span>&nbsp;<span class="ident" id="4345385">linkBits</span>&nbsp;<span class="builtintype" id="4345394">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345400">var</span>&nbsp;<span class="ident" id="4345404">numLinks</span>&nbsp;<span class="builtintype" id="4345413">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345418">if</span>&nbsp;<span class="ident" id="4345421">max</span>&nbsp;<span class="op" id="4345425">&gt;</span>&nbsp;<span class="ident" id="4345427">huffmanChunkBits</span>&nbsp;<span class="op" id="4345444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345448">linkBits</span>&nbsp;<span class="op" id="4345457">=</span>&nbsp;<span class="builtintype" id="4345459">uint</span><span class="op" id="4345463">(</span><span class="ident" id="4345464">max</span><span class="op" id="4345467">)</span>&nbsp;<span class="op" id="4345469">-</span>&nbsp;<span class="ident" id="4345471">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345490">numLinks</span>&nbsp;<span class="op" id="4345499">=</span>&nbsp;<span class="num" id="4345501">1</span>&nbsp;<span class="op" id="4345503">&lt;&lt;</span>&nbsp;<span class="ident" id="4345506">linkBits</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345517">h</span><span class="op" id="4345518">.</span><span class="ident" id="4345519">linkMask</span>&nbsp;<span class="op" id="4345528">=</span>&nbsp;<span class="builtintype" id="4345530">uint32</span><span class="op" id="4345536">(</span><span class="ident" id="4345537">numLinks</span>&nbsp;<span class="op" id="4345546">-</span>&nbsp;<span class="num" id="4345548">1</span><span class="op" id="4345549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4345552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345555">code</span>&nbsp;<span class="op" id="4345560">:=</span>&nbsp;<span class="num" id="4345563">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345566">var</span>&nbsp;<span class="ident" id="4345570">nextcode</span>&nbsp;<span class="op" id="4345579">[</span><span class="ident" id="4345580">maxCodeLen</span><span class="op" id="4345590">]</span><span class="builtintype" id="4345591">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345596">for</span>&nbsp;<span class="ident" id="4345600">i</span>&nbsp;<span class="op" id="4345602">:=</span>&nbsp;<span class="ident" id="4345605">min</span><span class="op" id="4345608">;</span>&nbsp;<span class="ident" id="4345610">i</span>&nbsp;<span class="op" id="4345612">&lt;=</span>&nbsp;<span class="ident" id="4345615">max</span><span class="op" id="4345618">;</span>&nbsp;<span class="ident" id="4345620">i</span><span class="op" id="4345621">++</span>&nbsp;<span class="op" id="4345624">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345628">if</span>&nbsp;<span class="ident" id="4345631">i</span>&nbsp;<span class="op" id="4345633">==</span>&nbsp;<span class="ident" id="4345636">huffmanChunkBits</span><span class="op" id="4345652">+</span><span class="num" id="4345653">1</span>&nbsp;<span class="op" id="4345655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4345660">//&nbsp;create&nbsp;link&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345685">link</span>&nbsp;<span class="op" id="4345690">:=</span>&nbsp;<span class="ident" id="4345693">code</span>&nbsp;<span class="op" id="4345698">&gt;&gt;</span>&nbsp;<span class="num" id="4345701">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345706">if</span>&nbsp;<span class="ident" id="4345709">huffmanNumChunks</span>&nbsp;<span class="op" id="4345726">&lt;</span>&nbsp;<span class="ident" id="4345728">link</span>&nbsp;<span class="op" id="4345733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345739">return</span>&nbsp;<span class="ident" id="4345746">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4345755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345760">h</span><span class="op" id="4345761">.</span><span class="ident" id="4345762">links</span>&nbsp;<span class="op" id="4345768">=</span>&nbsp;<span class="builtinfunc" id="4345770">make</span><span class="op" id="4345774">(</span><span class="op" id="4345775">[</span><span class="op" id="4345776">]</span><span class="op" id="4345777">[</span><span class="op" id="4345778">]</span><span class="builtintype" id="4345779">uint32</span><span class="op" id="4345785">,</span>&nbsp;<span class="ident" id="4345787">huffmanNumChunks</span><span class="op" id="4345803">-</span><span class="ident" id="4345804">link</span><span class="op" id="4345808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4345813">for</span>&nbsp;<span class="ident" id="4345817">j</span>&nbsp;<span class="op" id="4345819">:=</span>&nbsp;<span class="builtintype" id="4345822">uint</span><span class="op" id="4345826">(</span><span class="ident" id="4345827">link</span><span class="op" id="4345831">)</span><span class="op" id="4345832">;</span>&nbsp;<span class="ident" id="4345834">j</span>&nbsp;<span class="op" id="4345836">&lt;</span>&nbsp;<span class="ident" id="4345838">huffmanNumChunks</span><span class="op" id="4345854">;</span>&nbsp;<span class="ident" id="4345856">j</span><span class="op" id="4345857">++</span>&nbsp;<span class="op" id="4345860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345866">reverse</span>&nbsp;<span class="op" id="4345874">:=</span>&nbsp;<span class="builtintype" id="4345877">int</span><span class="op" id="4345880">(</span><span class="ident" id="4345881">reverseByte</span><span class="op" id="4345892">[</span><span class="ident" id="4345893">j</span><span class="op" id="4345894">&gt;&gt;</span><span class="num" id="4345896">8</span><span class="op" id="4345897">]</span><span class="op" id="4345898">)</span>&nbsp;<span class="op" id="4345900">|</span>&nbsp;<span class="builtintype" id="4345902">int</span><span class="op" id="4345905">(</span><span class="ident" id="4345906">reverseByte</span><span class="op" id="4345917">[</span><span class="ident" id="4345918">j</span><span class="op" id="4345919">&amp;</span><span class="num" id="4345920">0xff</span><span class="op" id="4345924">]</span><span class="op" id="4345925">)</span><span class="op" id="4345926">&lt;&lt;</span><span class="num" id="4345928">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345934">reverse</span>&nbsp;<span class="op" id="4345942">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4345946">uint</span><span class="op" id="4345950">(</span><span class="num" id="4345951">16</span>&nbsp;<span class="op" id="4345954">-</span>&nbsp;<span class="ident" id="4345956">huffmanChunkBits</span><span class="op" id="4345972">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4345978">off</span>&nbsp;<span class="op" id="4345982">:=</span>&nbsp;<span class="ident" id="4345985">j</span>&nbsp;<span class="op" id="4345987">-</span>&nbsp;<span class="builtintype" id="4345989">uint</span><span class="op" id="4345993">(</span><span class="ident" id="4345994">link</span><span class="op" id="4345998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346004">h</span><span class="op" id="4346005">.</span><span class="ident" id="4346006">chunks</span><span class="op" id="4346012">[</span><span class="ident" id="4346013">reverse</span><span class="op" id="4346020">]</span>&nbsp;<span class="op" id="4346022">=</span>&nbsp;<span class="builtintype" id="4346024">uint32</span><span class="op" id="4346030">(</span><span class="ident" id="4346031">off</span><span class="op" id="4346034">&lt;&lt;</span><span class="ident" id="4346036">huffmanValueShift</span>&nbsp;<span class="op" id="4346054">+</span>&nbsp;<span class="builtintype" id="4346056">uint</span><span class="op" id="4346060">(</span><span class="ident" id="4346061">i</span><span class="op" id="4346062">)</span><span class="op" id="4346063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346069">h</span><span class="op" id="4346070">.</span><span class="ident" id="4346071">links</span><span class="op" id="4346076">[</span><span class="ident" id="4346077">off</span><span class="op" id="4346080">]</span>&nbsp;<span class="op" id="4346082">=</span>&nbsp;<span class="builtinfunc" id="4346084">make</span><span class="op" id="4346088">(</span><span class="op" id="4346089">[</span><span class="op" id="4346090">]</span><span class="builtintype" id="4346091">uint32</span><span class="op" id="4346097">,</span>&nbsp;<span class="num" id="4346099">1</span><span class="op" id="4346100">&lt;&lt;</span><span class="ident" id="4346102">linkBits</span><span class="op" id="4346110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346119">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346123">n</span>&nbsp;<span class="op" id="4346125">:=</span>&nbsp;<span class="ident" id="4346128">count</span><span class="op" id="4346133">[</span><span class="ident" id="4346134">i</span><span class="op" id="4346135">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346139">nextcode</span><span class="op" id="4346147">[</span><span class="ident" id="4346148">i</span><span class="op" id="4346149">]</span>&nbsp;<span class="op" id="4346151">=</span>&nbsp;<span class="ident" id="4346153">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346160">code</span>&nbsp;<span class="op" id="4346165">+=</span>&nbsp;<span class="ident" id="4346168">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346172">code</span>&nbsp;<span class="op" id="4346177">&lt;&lt;=</span>&nbsp;<span class="num" id="4346181">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346184">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346188">for</span>&nbsp;<span class="ident" id="4346192">i</span><span class="op" id="4346193">,</span>&nbsp;<span class="ident" id="4346195">n</span>&nbsp;<span class="op" id="4346197">:=</span>&nbsp;<span class="keyword" id="4346200">range</span>&nbsp;<span class="ident" id="4346206">bits</span>&nbsp;<span class="op" id="4346211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346215">if</span>&nbsp;<span class="ident" id="4346218">n</span>&nbsp;<span class="op" id="4346220">==</span>&nbsp;<span class="num" id="4346223">0</span>&nbsp;<span class="op" id="4346225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346230">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346241">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346245">code</span>&nbsp;<span class="op" id="4346250">:=</span>&nbsp;<span class="ident" id="4346253">nextcode</span><span class="op" id="4346261">[</span><span class="ident" id="4346262">n</span><span class="op" id="4346263">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346267">nextcode</span><span class="op" id="4346275">[</span><span class="ident" id="4346276">n</span><span class="op" id="4346277">]</span><span class="op" id="4346278">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346283">chunk</span>&nbsp;<span class="op" id="4346289">:=</span>&nbsp;<span class="builtintype" id="4346292">uint32</span><span class="op" id="4346298">(</span><span class="ident" id="4346299">i</span><span class="op" id="4346300">&lt;&lt;</span><span class="ident" id="4346302">huffmanValueShift</span>&nbsp;<span class="op" id="4346320">|</span>&nbsp;<span class="ident" id="4346322">n</span><span class="op" id="4346323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346327">reverse</span>&nbsp;<span class="op" id="4346335">:=</span>&nbsp;<span class="builtintype" id="4346338">int</span><span class="op" id="4346341">(</span><span class="ident" id="4346342">reverseByte</span><span class="op" id="4346353">[</span><span class="ident" id="4346354">code</span><span class="op" id="4346358">&gt;&gt;</span><span class="num" id="4346360">8</span><span class="op" id="4346361">]</span><span class="op" id="4346362">)</span>&nbsp;<span class="op" id="4346364">|</span>&nbsp;<span class="builtintype" id="4346366">int</span><span class="op" id="4346369">(</span><span class="ident" id="4346370">reverseByte</span><span class="op" id="4346381">[</span><span class="ident" id="4346382">code</span><span class="op" id="4346386">&amp;</span><span class="num" id="4346387">0xff</span><span class="op" id="4346391">]</span><span class="op" id="4346392">)</span><span class="op" id="4346393">&lt;&lt;</span><span class="num" id="4346395">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346399">reverse</span>&nbsp;<span class="op" id="4346407">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4346411">uint</span><span class="op" id="4346415">(</span><span class="num" id="4346416">16</span>&nbsp;<span class="op" id="4346419">-</span>&nbsp;<span class="ident" id="4346421">n</span><span class="op" id="4346422">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346426">if</span>&nbsp;<span class="ident" id="4346429">n</span>&nbsp;<span class="op" id="4346431">&lt;=</span>&nbsp;<span class="ident" id="4346434">huffmanChunkBits</span>&nbsp;<span class="op" id="4346451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346456">for</span>&nbsp;<span class="ident" id="4346460">off</span>&nbsp;<span class="op" id="4346464">:=</span>&nbsp;<span class="ident" id="4346467">reverse</span><span class="op" id="4346474">;</span>&nbsp;<span class="ident" id="4346476">off</span>&nbsp;<span class="op" id="4346480">&lt;</span>&nbsp;<span class="ident" id="4346482">huffmanNumChunks</span><span class="op" id="4346498">;</span>&nbsp;<span class="ident" id="4346500">off</span>&nbsp;<span class="op" id="4346504">+=</span>&nbsp;<span class="num" id="4346507">1</span>&nbsp;<span class="op" id="4346509">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4346512">uint</span><span class="op" id="4346516">(</span><span class="ident" id="4346517">n</span><span class="op" id="4346518">)</span>&nbsp;<span class="op" id="4346520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346526">h</span><span class="op" id="4346527">.</span><span class="ident" id="4346528">chunks</span><span class="op" id="4346534">[</span><span class="ident" id="4346535">off</span><span class="op" id="4346538">]</span>&nbsp;<span class="op" id="4346540">=</span>&nbsp;<span class="ident" id="4346542">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346555">}</span>&nbsp;<span class="keyword" id="4346557">else</span>&nbsp;<span class="op" id="4346562">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346567">value</span>&nbsp;<span class="op" id="4346573">:=</span>&nbsp;<span class="ident" id="4346576">h</span><span class="op" id="4346577">.</span><span class="ident" id="4346578">chunks</span><span class="op" id="4346584">[</span><span class="ident" id="4346585">reverse</span><span class="op" id="4346592">&amp;</span><span class="op" id="4346593">(</span><span class="ident" id="4346594">huffmanNumChunks</span><span class="op" id="4346610">-</span><span class="num" id="4346611">1</span><span class="op" id="4346612">)</span><span class="op" id="4346613">]</span>&nbsp;<span class="op" id="4346615">&gt;&gt;</span>&nbsp;<span class="ident" id="4346618">huffmanValueShift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346639">if</span>&nbsp;<span class="ident" id="4346642">value</span>&nbsp;<span class="op" id="4346648">&gt;=</span>&nbsp;<span class="builtintype" id="4346651">uint32</span><span class="op" id="4346657">(</span><span class="builtinfunc" id="4346658">len</span><span class="op" id="4346661">(</span><span class="ident" id="4346662">h</span><span class="op" id="4346663">.</span><span class="ident" id="4346664">links</span><span class="op" id="4346669">)</span><span class="op" id="4346670">)</span>&nbsp;<span class="op" id="4346672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346678">return</span>&nbsp;<span class="ident" id="4346685">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346699">linktab</span>&nbsp;<span class="op" id="4346707">:=</span>&nbsp;<span class="ident" id="4346710">h</span><span class="op" id="4346711">.</span><span class="ident" id="4346712">links</span><span class="op" id="4346717">[</span><span class="ident" id="4346718">value</span><span class="op" id="4346723">]</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346728">reverse</span>&nbsp;<span class="op" id="4346736">&gt;&gt;=</span>&nbsp;<span class="ident" id="4346740">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346760">for</span>&nbsp;<span class="ident" id="4346764">off</span>&nbsp;<span class="op" id="4346768">:=</span>&nbsp;<span class="ident" id="4346771">reverse</span><span class="op" id="4346778">;</span>&nbsp;<span class="ident" id="4346780">off</span>&nbsp;<span class="op" id="4346784">&lt;</span>&nbsp;<span class="ident" id="4346786">numLinks</span><span class="op" id="4346794">;</span>&nbsp;<span class="ident" id="4346796">off</span>&nbsp;<span class="op" id="4346800">+=</span>&nbsp;<span class="num" id="4346803">1</span>&nbsp;<span class="op" id="4346805">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4346808">uint</span><span class="op" id="4346812">(</span><span class="ident" id="4346813">n</span><span class="op" id="4346814">-</span><span class="ident" id="4346815">huffmanChunkBits</span><span class="op" id="4346831">)</span>&nbsp;<span class="op" id="4346833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4346839">linktab</span><span class="op" id="4346846">[</span><span class="ident" id="4346847">off</span><span class="op" id="4346850">]</span>&nbsp;<span class="op" id="4346852">=</span>&nbsp;<span class="ident" id="4346854">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346867">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4346870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4346873">return</span>&nbsp;<span class="ident" id="4346880">true</span><br>
<span class="lineno"></span><span class="op" id="4346885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4346888">//&nbsp;The&nbsp;actual&nbsp;read&nbsp;interface&nbsp;needed&nbsp;by&nbsp;NewReader.</span><br>
<span class="lineno">190</span><span class="comment" id="4346938">//&nbsp;If&nbsp;the&nbsp;passed&nbsp;in&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,</span><br>
<span class="lineno"></span><span class="comment" id="4346997">//&nbsp;the&nbsp;NewReader&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="4347048">type</span>&nbsp;<span class="ident" id="4347053">Reader</span>&nbsp;<span class="keyword" id="4347060">interface</span>&nbsp;<span class="op" id="4347070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347073">io</span><span class="op" id="4347075">.</span><span class="ident" id="4347076">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347084">io</span><span class="op" id="4347086">.</span><span class="ident" id="4347087">ByteReader</span><br>
<span class="lineno">195</span><span class="op" id="4347098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4347101">//&nbsp;Decompress&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4347122">type</span>&nbsp;<span class="ident" id="4347127">decompressor</span>&nbsp;<span class="keyword" id="4347140">struct</span>&nbsp;<span class="op" id="4347147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4347150">//&nbsp;Input&nbsp;source.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347168">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4347176">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347184">roffset</span>&nbsp;<span class="ident" id="4347192">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347199">woffset</span>&nbsp;<span class="ident" id="4347207">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4347215">//&nbsp;Input&nbsp;bits,&nbsp;in&nbsp;top&nbsp;of&nbsp;b.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347244">b</span>&nbsp;&nbsp;<span class="builtintype" id="4347247">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347255">nb</span>&nbsp;<span class="builtintype" id="4347258">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4347265">//&nbsp;Huffman&nbsp;decoders&nbsp;for&nbsp;literal/length,&nbsp;distance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347316">h1</span><span class="op" id="4347318">,</span>&nbsp;<span class="ident" id="4347320">h2</span>&nbsp;<span class="ident" id="4347323">huffmanDecoder</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4347340">//&nbsp;Length&nbsp;arrays&nbsp;used&nbsp;to&nbsp;define&nbsp;Huffman&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347388">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4347397">*</span><span class="op" id="4347398">[</span><span class="ident" id="4347399">maxLit</span>&nbsp;<span class="op" id="4347406">+</span>&nbsp;<span class="ident" id="4347408">maxDist</span><span class="op" id="4347415">]</span><span class="builtintype" id="4347416">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347421">codebits</span>&nbsp;<span class="op" id="4347430">*</span><span class="op" id="4347431">[</span><span class="ident" id="4347432">numCodes</span><span class="op" id="4347440">]</span><span class="builtintype" id="4347441">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4347447">//&nbsp;Output&nbsp;history,&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347475">hist</span>&nbsp;&nbsp;<span class="op" id="4347481">*</span><span class="op" id="4347482">[</span><span class="ident" id="4347483">maxHist</span><span class="op" id="4347490">]</span><span class="builtintype" id="4347491">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347497">hp</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4347503">int</span>&nbsp;&nbsp;<span class="comment" id="4347508">//&nbsp;current&nbsp;output&nbsp;position&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347546">hw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4347552">int</span>&nbsp;&nbsp;<span class="comment" id="4347557">//&nbsp;have&nbsp;written&nbsp;hist[0:hw]&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347593">hfull</span>&nbsp;<span class="builtintype" id="4347599">bool</span>&nbsp;<span class="comment" id="4347604">//&nbsp;buffer&nbsp;has&nbsp;filled&nbsp;at&nbsp;least&nbsp;once</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4347641">//&nbsp;Temporary&nbsp;buffer&nbsp;(avoids&nbsp;repeated&nbsp;allocation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347692">buf</span>&nbsp;<span class="op" id="4347696">[</span><span class="num" id="4347697">4</span><span class="op" id="4347698">]</span><span class="builtintype" id="4347699">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4347706">//&nbsp;Next&nbsp;step&nbsp;in&nbsp;the&nbsp;decompression,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4347742">//&nbsp;and&nbsp;decompression&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347771">step</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4347780">func</span><span class="op" id="4347784">(</span><span class="op" id="4347785">*</span><span class="ident" id="4347786">decompressor</span><span class="op" id="4347798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347801">final</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4347810">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347816">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4347825">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347832">toRead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4347841">[</span><span class="op" id="4347842">]</span><span class="builtintype" id="4347843">byte</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347849">hl</span><span class="op" id="4347851">,</span>&nbsp;<span class="ident" id="4347853">hd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4347858">*</span><span class="ident" id="4347859">huffmanDecoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347875">copyLen</span>&nbsp;&nbsp;<span class="builtintype" id="4347884">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347889">copyDist</span>&nbsp;<span class="builtintype" id="4347898">int</span><br>
<span class="lineno"></span><span class="op" id="4347902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4347905">func</span>&nbsp;<span class="op" id="4347910">(</span><span class="ident" id="4347911">f</span>&nbsp;<span class="op" id="4347913">*</span><span class="ident" id="4347914">decompressor</span><span class="op" id="4347926">)</span>&nbsp;<span class="ident" id="4347928">nextBlock</span><span class="op" id="4347937">(</span><span class="op" id="4347938">)</span>&nbsp;<span class="op" id="4347940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4347943">if</span>&nbsp;<span class="ident" id="4347946">f</span><span class="op" id="4347947">.</span><span class="ident" id="4347948">final</span>&nbsp;<span class="op" id="4347954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4347958">if</span>&nbsp;<span class="ident" id="4347961">f</span><span class="op" id="4347962">.</span><span class="ident" id="4347963">hw</span>&nbsp;<span class="op" id="4347966">!=</span>&nbsp;<span class="ident" id="4347969">f</span><span class="op" id="4347970">.</span><span class="ident" id="4347971">hp</span>&nbsp;<span class="op" id="4347974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4347979">f</span><span class="op" id="4347980">.</span><span class="ident" id="4347981">flush</span><span class="op" id="4347986">(</span><span class="op" id="4347987">(</span><span class="op" id="4347988">*</span><span class="ident" id="4347989">decompressor</span><span class="op" id="4348001">)</span><span class="op" id="4348002">.</span><span class="ident" id="4348003">nextBlock</span><span class="op" id="4348012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348017">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4348026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4348030">f</span><span class="op" id="4348031">.</span><span class="ident" id="4348032">err</span>&nbsp;<span class="op" id="4348036">=</span>&nbsp;<span class="ident" id="4348038">io</span><span class="op" id="4348040">.</span><span class="ident" id="4348041">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348047">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4348055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348058">for</span>&nbsp;<span class="ident" id="4348062">f</span><span class="op" id="4348063">.</span><span class="ident" id="4348064">nb</span>&nbsp;<span class="op" id="4348067">&lt;</span>&nbsp;<span class="num" id="4348069">1</span><span class="op" id="4348070">+</span><span class="num" id="4348071">2</span>&nbsp;<span class="op" id="4348073">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348077">if</span>&nbsp;<span class="ident" id="4348080">f</span><span class="op" id="4348081">.</span><span class="ident" id="4348082">err</span>&nbsp;<span class="op" id="4348086">=</span>&nbsp;<span class="ident" id="4348088">f</span><span class="op" id="4348089">.</span><span class="ident" id="4348090">moreBits</span><span class="op" id="4348098">(</span><span class="op" id="4348099">)</span><span class="op" id="4348100">;</span>&nbsp;<span class="ident" id="4348102">f</span><span class="op" id="4348103">.</span><span class="ident" id="4348104">err</span>&nbsp;<span class="op" id="4348108">!=</span>&nbsp;<span class="ident" id="4348111">nil</span>&nbsp;<span class="op" id="4348115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348120">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4348129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4348132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4348135">f</span><span class="op" id="4348136">.</span><span class="ident" id="4348137">final</span>&nbsp;<span class="op" id="4348143">=</span>&nbsp;<span class="ident" id="4348145">f</span><span class="op" id="4348146">.</span><span class="ident" id="4348147">b</span><span class="op" id="4348148">&amp;</span><span class="num" id="4348149">1</span>&nbsp;<span class="op" id="4348151">==</span>&nbsp;<span class="num" id="4348154">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4348157">f</span><span class="op" id="4348158">.</span><span class="ident" id="4348159">b</span>&nbsp;<span class="op" id="4348161">&gt;&gt;=</span>&nbsp;<span class="num" id="4348165">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4348168">typ</span>&nbsp;<span class="op" id="4348172">:=</span>&nbsp;<span class="ident" id="4348175">f</span><span class="op" id="4348176">.</span><span class="ident" id="4348177">b</span>&nbsp;<span class="op" id="4348179">&amp;</span>&nbsp;<span class="num" id="4348181">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4348184">f</span><span class="op" id="4348185">.</span><span class="ident" id="4348186">b</span>&nbsp;<span class="op" id="4348188">&gt;&gt;=</span>&nbsp;<span class="num" id="4348192">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4348195">f</span><span class="op" id="4348196">.</span><span class="ident" id="4348197">nb</span>&nbsp;<span class="op" id="4348200">-=</span>&nbsp;<span class="num" id="4348203">1</span>&nbsp;<span class="op" id="4348205">+</span>&nbsp;<span class="num" id="4348207">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348210">switch</span>&nbsp;<span class="ident" id="4348217">typ</span>&nbsp;<span class="op" id="4348221">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348224">case</span>&nbsp;<span class="num" id="4348229">0</span><span class="op" id="4348230">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4348234">f</span><span class="op" id="4348235">.</span><span class="ident" id="4348236">dataBlock</span><span class="op" id="4348245">(</span><span class="op" id="4348246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348249">case</span>&nbsp;<span class="num" id="4348254">1</span><span class="op" id="4348255">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4348259">//&nbsp;compressed,&nbsp;fixed&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4348297">f</span><span class="op" id="4348298">.</span><span class="ident" id="4348299">hl</span>&nbsp;<span class="op" id="4348302">=</span>&nbsp;<span class="op" id="4348304">&amp;</span><span class="ident" id="4348305">fixedHuffmanDecoder</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4348327">f</span><span class="op" id="4348328">.</span><span class="ident" id="4348329">hd</span>&nbsp;<span class="op" id="4348332">=</span>&nbsp;<span class="ident" id="4348334">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4348340">f</span><span class="op" id="4348341">.</span><span class="ident" id="4348342">huffmanBlock</span><span class="op" id="4348354">(</span><span class="op" id="4348355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348358">case</span>&nbsp;<span class="num" id="4348363">2</span><span class="op" id="4348364">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4348368">//&nbsp;compressed,&nbsp;dynamic&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348408">if</span>&nbsp;<span class="ident" id="4348411">f</span><span class="op" id="4348412">.</span><span class="ident" id="4348413">err</span>&nbsp;<span class="op" id="4348417">=</span>&nbsp;<span class="ident" id="4348419">f</span><span class="op" id="4348420">.</span><span class="ident" id="4348421">readHuffman</span><span class="op" id="4348432">(</span><span class="op" id="4348433">)</span><span class="op" id="4348434">;</span>&nbsp;<span class="ident" id="4348436">f</span><span class="op" id="4348437">.</span><span class="ident" id="4348438">err</span>&nbsp;<span class="op" id="4348442">!=</span>&nbsp;<span class="ident" id="4348445">nil</span>&nbsp;<span class="op" id="4348449">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348454">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4348462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4348466">f</span><span class="op" id="4348467">.</span><span class="ident" id="4348468">hl</span>&nbsp;<span class="op" id="4348471">=</span>&nbsp;<span class="op" id="4348473">&amp;</span><span class="ident" id="4348474">f</span><span class="op" id="4348475">.</span><span class="ident" id="4348476">h1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4348481">f</span><span class="op" id="4348482">.</span><span class="ident" id="4348483">hd</span>&nbsp;<span class="op" id="4348486">=</span>&nbsp;<span class="op" id="4348488">&amp;</span><span class="ident" id="4348489">f</span><span class="op" id="4348490">.</span><span class="ident" id="4348491">h2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4348496">f</span><span class="op" id="4348497">.</span><span class="ident" id="4348498">huffmanBlock</span><span class="op" id="4348510">(</span><span class="op" id="4348511">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348514">default</span><span class="op" id="4348521">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4348525">//&nbsp;3&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4348545">f</span><span class="op" id="4348546">.</span><span class="ident" id="4348547">err</span>&nbsp;<span class="op" id="4348551">=</span>&nbsp;<span class="ident" id="4348553">CorruptInputError</span><span class="op" id="4348570">(</span><span class="ident" id="4348571">f</span><span class="op" id="4348572">.</span><span class="ident" id="4348573">roffset</span><span class="op" id="4348580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4348583">}</span><br>
<span class="lineno"></span><span class="op" id="4348585">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="4348588">func</span>&nbsp;<span class="op" id="4348593">(</span><span class="ident" id="4348594">f</span>&nbsp;<span class="op" id="4348596">*</span><span class="ident" id="4348597">decompressor</span><span class="op" id="4348609">)</span>&nbsp;<span class="ident" id="4348611">Read</span><span class="op" id="4348615">(</span><span class="ident" id="4348616">b</span>&nbsp;<span class="op" id="4348618">[</span><span class="op" id="4348619">]</span><span class="builtintype" id="4348620">byte</span><span class="op" id="4348624">)</span>&nbsp;<span class="op" id="4348626">(</span><span class="builtintype" id="4348627">int</span><span class="op" id="4348630">,</span>&nbsp;<span class="builtintype" id="4348632">error</span><span class="op" id="4348637">)</span>&nbsp;<span class="op" id="4348639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348642">for</span>&nbsp;<span class="op" id="4348646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348650">if</span>&nbsp;<span class="builtinfunc" id="4348653">len</span><span class="op" id="4348656">(</span><span class="ident" id="4348657">f</span><span class="op" id="4348658">.</span><span class="ident" id="4348659">toRead</span><span class="op" id="4348665">)</span>&nbsp;<span class="op" id="4348667">&gt;</span>&nbsp;<span class="num" id="4348669">0</span>&nbsp;<span class="op" id="4348671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4348676">n</span>&nbsp;<span class="op" id="4348678">:=</span>&nbsp;<span class="builtinfunc" id="4348681">copy</span><span class="op" id="4348685">(</span><span class="ident" id="4348686">b</span><span class="op" id="4348687">,</span>&nbsp;<span class="ident" id="4348689">f</span><span class="op" id="4348690">.</span><span class="ident" id="4348691">toRead</span><span class="op" id="4348697">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4348702">f</span><span class="op" id="4348703">.</span><span class="ident" id="4348704">toRead</span>&nbsp;<span class="op" id="4348711">=</span>&nbsp;<span class="ident" id="4348713">f</span><span class="op" id="4348714">.</span><span class="ident" id="4348715">toRead</span><span class="op" id="4348721">[</span><span class="ident" id="4348722">n</span><span class="op" id="4348723">:</span><span class="op" id="4348724">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348729">return</span>&nbsp;<span class="ident" id="4348736">n</span><span class="op" id="4348737">,</span>&nbsp;<span class="ident" id="4348739">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4348745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348749">if</span>&nbsp;<span class="ident" id="4348752">f</span><span class="op" id="4348753">.</span><span class="ident" id="4348754">err</span>&nbsp;<span class="op" id="4348758">!=</span>&nbsp;<span class="ident" id="4348761">nil</span>&nbsp;<span class="op" id="4348765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348770">return</span>&nbsp;<span class="num" id="4348777">0</span><span class="op" id="4348778">,</span>&nbsp;<span class="ident" id="4348780">f</span><span class="op" id="4348781">.</span><span class="ident" id="4348782">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4348788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4348792">f</span><span class="op" id="4348793">.</span><span class="ident" id="4348794">step</span><span class="op" id="4348798">(</span><span class="ident" id="4348799">f</span><span class="op" id="4348800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4348803">}</span><br>
<span class="lineno"></span><span class="op" id="4348805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="4348808">func</span>&nbsp;<span class="op" id="4348813">(</span><span class="ident" id="4348814">f</span>&nbsp;<span class="op" id="4348816">*</span><span class="ident" id="4348817">decompressor</span><span class="op" id="4348829">)</span>&nbsp;<span class="ident" id="4348831">Close</span><span class="op" id="4348836">(</span><span class="op" id="4348837">)</span>&nbsp;<span class="builtintype" id="4348839">error</span>&nbsp;<span class="op" id="4348845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348848">if</span>&nbsp;<span class="ident" id="4348851">f</span><span class="op" id="4348852">.</span><span class="ident" id="4348853">err</span>&nbsp;<span class="op" id="4348857">==</span>&nbsp;<span class="ident" id="4348860">io</span><span class="op" id="4348862">.</span><span class="ident" id="4348863">EOF</span>&nbsp;<span class="op" id="4348867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348871">return</span>&nbsp;<span class="ident" id="4348878">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4348883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4348886">return</span>&nbsp;<span class="ident" id="4348893">f</span><span class="op" id="4348894">.</span><span class="ident" id="4348895">err</span><br>
<span class="lineno">295</span><span class="op" id="4348899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4348902">//&nbsp;RFC&nbsp;1951&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span><span class="comment" id="4348929">//&nbsp;Compression&nbsp;with&nbsp;dynamic&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="4348972">var</span>&nbsp;<span class="ident" id="4348976">codeOrder</span>&nbsp;<span class="op" id="4348986">=</span>&nbsp;<span class="op" id="4348988">[</span><span class="op" id="4348989">...</span><span class="op" id="4348992">]</span><span class="builtintype" id="4348993">int</span><span class="op" id="4348996">{</span><span class="num" id="4348997">16</span><span class="op" id="4348999">,</span>&nbsp;<span class="num" id="4349001">17</span><span class="op" id="4349003">,</span>&nbsp;<span class="num" id="4349005">18</span><span class="op" id="4349007">,</span>&nbsp;<span class="num" id="4349009">0</span><span class="op" id="4349010">,</span>&nbsp;<span class="num" id="4349012">8</span><span class="op" id="4349013">,</span>&nbsp;<span class="num" id="4349015">7</span><span class="op" id="4349016">,</span>&nbsp;<span class="num" id="4349018">9</span><span class="op" id="4349019">,</span>&nbsp;<span class="num" id="4349021">6</span><span class="op" id="4349022">,</span>&nbsp;<span class="num" id="4349024">10</span><span class="op" id="4349026">,</span>&nbsp;<span class="num" id="4349028">5</span><span class="op" id="4349029">,</span>&nbsp;<span class="num" id="4349031">11</span><span class="op" id="4349033">,</span>&nbsp;<span class="num" id="4349035">4</span><span class="op" id="4349036">,</span>&nbsp;<span class="num" id="4349038">12</span><span class="op" id="4349040">,</span>&nbsp;<span class="num" id="4349042">3</span><span class="op" id="4349043">,</span>&nbsp;<span class="num" id="4349045">13</span><span class="op" id="4349047">,</span>&nbsp;<span class="num" id="4349049">2</span><span class="op" id="4349050">,</span>&nbsp;<span class="num" id="4349052">14</span><span class="op" id="4349054">,</span>&nbsp;<span class="num" id="4349056">1</span><span class="op" id="4349057">,</span>&nbsp;<span class="num" id="4349059">15</span><span class="op" id="4349061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4349064">func</span>&nbsp;<span class="op" id="4349069">(</span><span class="ident" id="4349070">f</span>&nbsp;<span class="op" id="4349072">*</span><span class="ident" id="4349073">decompressor</span><span class="op" id="4349085">)</span>&nbsp;<span class="ident" id="4349087">readHuffman</span><span class="op" id="4349098">(</span><span class="op" id="4349099">)</span>&nbsp;<span class="builtintype" id="4349101">error</span>&nbsp;<span class="op" id="4349107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4349110">//&nbsp;HLIT[5],&nbsp;HDIST[5],&nbsp;HCLEN[4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349143">for</span>&nbsp;<span class="ident" id="4349147">f</span><span class="op" id="4349148">.</span><span class="ident" id="4349149">nb</span>&nbsp;<span class="op" id="4349152">&lt;</span>&nbsp;<span class="num" id="4349154">5</span><span class="op" id="4349155">+</span><span class="num" id="4349156">5</span><span class="op" id="4349157">+</span><span class="num" id="4349158">4</span>&nbsp;<span class="op" id="4349160">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349164">if</span>&nbsp;<span class="ident" id="4349167">err</span>&nbsp;<span class="op" id="4349171">:=</span>&nbsp;<span class="ident" id="4349174">f</span><span class="op" id="4349175">.</span><span class="ident" id="4349176">moreBits</span><span class="op" id="4349184">(</span><span class="op" id="4349185">)</span><span class="op" id="4349186">;</span>&nbsp;<span class="ident" id="4349188">err</span>&nbsp;<span class="op" id="4349192">!=</span>&nbsp;<span class="ident" id="4349195">nil</span>&nbsp;<span class="op" id="4349199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349204">return</span>&nbsp;<span class="ident" id="4349211">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4349217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4349220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349223">nlit</span>&nbsp;<span class="op" id="4349228">:=</span>&nbsp;<span class="builtintype" id="4349231">int</span><span class="op" id="4349234">(</span><span class="ident" id="4349235">f</span><span class="op" id="4349236">.</span><span class="ident" id="4349237">b</span><span class="op" id="4349238">&amp;</span><span class="num" id="4349239">0x1F</span><span class="op" id="4349243">)</span>&nbsp;<span class="op" id="4349245">+</span>&nbsp;<span class="num" id="4349247">257</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349252">if</span>&nbsp;<span class="ident" id="4349255">nlit</span>&nbsp;<span class="op" id="4349260">&gt;</span>&nbsp;<span class="ident" id="4349262">maxLit</span>&nbsp;<span class="op" id="4349269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349273">return</span>&nbsp;<span class="ident" id="4349280">CorruptInputError</span><span class="op" id="4349297">(</span><span class="ident" id="4349298">f</span><span class="op" id="4349299">.</span><span class="ident" id="4349300">roffset</span><span class="op" id="4349307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4349310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349313">f</span><span class="op" id="4349314">.</span><span class="ident" id="4349315">b</span>&nbsp;<span class="op" id="4349317">&gt;&gt;=</span>&nbsp;<span class="num" id="4349321">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349324">ndist</span>&nbsp;<span class="op" id="4349330">:=</span>&nbsp;<span class="builtintype" id="4349333">int</span><span class="op" id="4349336">(</span><span class="ident" id="4349337">f</span><span class="op" id="4349338">.</span><span class="ident" id="4349339">b</span><span class="op" id="4349340">&amp;</span><span class="num" id="4349341">0x1F</span><span class="op" id="4349345">)</span>&nbsp;<span class="op" id="4349347">+</span>&nbsp;<span class="num" id="4349349">1</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4349352">//&nbsp;maxDist&nbsp;is&nbsp;32,&nbsp;so&nbsp;ndist&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349397">f</span><span class="op" id="4349398">.</span><span class="ident" id="4349399">b</span>&nbsp;<span class="op" id="4349401">&gt;&gt;=</span>&nbsp;<span class="num" id="4349405">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349408">nclen</span>&nbsp;<span class="op" id="4349414">:=</span>&nbsp;<span class="builtintype" id="4349417">int</span><span class="op" id="4349420">(</span><span class="ident" id="4349421">f</span><span class="op" id="4349422">.</span><span class="ident" id="4349423">b</span><span class="op" id="4349424">&amp;</span><span class="num" id="4349425">0xF</span><span class="op" id="4349428">)</span>&nbsp;<span class="op" id="4349430">+</span>&nbsp;<span class="num" id="4349432">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4349435">//&nbsp;numCodes&nbsp;is&nbsp;19,&nbsp;so&nbsp;nclen&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349481">f</span><span class="op" id="4349482">.</span><span class="ident" id="4349483">b</span>&nbsp;<span class="op" id="4349485">&gt;&gt;=</span>&nbsp;<span class="num" id="4349489">4</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349492">f</span><span class="op" id="4349493">.</span><span class="ident" id="4349494">nb</span>&nbsp;<span class="op" id="4349497">-=</span>&nbsp;<span class="num" id="4349500">5</span>&nbsp;<span class="op" id="4349502">+</span>&nbsp;<span class="num" id="4349504">5</span>&nbsp;<span class="op" id="4349506">+</span>&nbsp;<span class="num" id="4349508">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4349512">//&nbsp;(HCLEN+4)*3&nbsp;bits:&nbsp;code&nbsp;lengths&nbsp;in&nbsp;the&nbsp;magic&nbsp;codeOrder&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349577">for</span>&nbsp;<span class="ident" id="4349581">i</span>&nbsp;<span class="op" id="4349583">:=</span>&nbsp;<span class="num" id="4349586">0</span><span class="op" id="4349587">;</span>&nbsp;<span class="ident" id="4349589">i</span>&nbsp;<span class="op" id="4349591">&lt;</span>&nbsp;<span class="ident" id="4349593">nclen</span><span class="op" id="4349598">;</span>&nbsp;<span class="ident" id="4349600">i</span><span class="op" id="4349601">++</span>&nbsp;<span class="op" id="4349604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349608">for</span>&nbsp;<span class="ident" id="4349612">f</span><span class="op" id="4349613">.</span><span class="ident" id="4349614">nb</span>&nbsp;<span class="op" id="4349617">&lt;</span>&nbsp;<span class="num" id="4349619">3</span>&nbsp;<span class="op" id="4349621">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349626">if</span>&nbsp;<span class="ident" id="4349629">err</span>&nbsp;<span class="op" id="4349633">:=</span>&nbsp;<span class="ident" id="4349636">f</span><span class="op" id="4349637">.</span><span class="ident" id="4349638">moreBits</span><span class="op" id="4349646">(</span><span class="op" id="4349647">)</span><span class="op" id="4349648">;</span>&nbsp;<span class="ident" id="4349650">err</span>&nbsp;<span class="op" id="4349654">!=</span>&nbsp;<span class="ident" id="4349657">nil</span>&nbsp;<span class="op" id="4349661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349667">return</span>&nbsp;<span class="ident" id="4349674">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4349681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4349685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349689">f</span><span class="op" id="4349690">.</span><span class="ident" id="4349691">codebits</span><span class="op" id="4349699">[</span><span class="ident" id="4349700">codeOrder</span><span class="op" id="4349709">[</span><span class="ident" id="4349710">i</span><span class="op" id="4349711">]</span><span class="op" id="4349712">]</span>&nbsp;<span class="op" id="4349714">=</span>&nbsp;<span class="builtintype" id="4349716">int</span><span class="op" id="4349719">(</span><span class="ident" id="4349720">f</span><span class="op" id="4349721">.</span><span class="ident" id="4349722">b</span>&nbsp;<span class="op" id="4349724">&amp;</span>&nbsp;<span class="num" id="4349726">0x7</span><span class="op" id="4349729">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349733">f</span><span class="op" id="4349734">.</span><span class="ident" id="4349735">b</span>&nbsp;<span class="op" id="4349737">&gt;&gt;=</span>&nbsp;<span class="num" id="4349741">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349745">f</span><span class="op" id="4349746">.</span><span class="ident" id="4349747">nb</span>&nbsp;<span class="op" id="4349750">-=</span>&nbsp;<span class="num" id="4349753">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4349756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349759">for</span>&nbsp;<span class="ident" id="4349763">i</span>&nbsp;<span class="op" id="4349765">:=</span>&nbsp;<span class="ident" id="4349768">nclen</span><span class="op" id="4349773">;</span>&nbsp;<span class="ident" id="4349775">i</span>&nbsp;<span class="op" id="4349777">&lt;</span>&nbsp;<span class="builtinfunc" id="4349779">len</span><span class="op" id="4349782">(</span><span class="ident" id="4349783">codeOrder</span><span class="op" id="4349792">)</span><span class="op" id="4349793">;</span>&nbsp;<span class="ident" id="4349795">i</span><span class="op" id="4349796">++</span>&nbsp;<span class="op" id="4349799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349803">f</span><span class="op" id="4349804">.</span><span class="ident" id="4349805">codebits</span><span class="op" id="4349813">[</span><span class="ident" id="4349814">codeOrder</span><span class="op" id="4349823">[</span><span class="ident" id="4349824">i</span><span class="op" id="4349825">]</span><span class="op" id="4349826">]</span>&nbsp;<span class="op" id="4349828">=</span>&nbsp;<span class="num" id="4349830">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4349833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349836">if</span>&nbsp;<span class="op" id="4349839">!</span><span class="ident" id="4349840">f</span><span class="op" id="4349841">.</span><span class="ident" id="4349842">h1</span><span class="op" id="4349844">.</span><span class="ident" id="4349845">init</span><span class="op" id="4349849">(</span><span class="ident" id="4349850">f</span><span class="op" id="4349851">.</span><span class="ident" id="4349852">codebits</span><span class="op" id="4349860">[</span><span class="num" id="4349861">0</span><span class="op" id="4349862">:</span><span class="op" id="4349863">]</span><span class="op" id="4349864">)</span>&nbsp;<span class="op" id="4349866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349870">return</span>&nbsp;<span class="ident" id="4349877">CorruptInputError</span><span class="op" id="4349894">(</span><span class="ident" id="4349895">f</span><span class="op" id="4349896">.</span><span class="ident" id="4349897">roffset</span><span class="op" id="4349904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4349907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4349911">//&nbsp;HLIT&nbsp;+&nbsp;257&nbsp;code&nbsp;lengths,&nbsp;HDIST&nbsp;+&nbsp;1&nbsp;code&nbsp;lengths,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4349964">//&nbsp;using&nbsp;the&nbsp;code&nbsp;length&nbsp;Huffman&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350004">for</span>&nbsp;<span class="ident" id="4350008">i</span><span class="op" id="4350009">,</span>&nbsp;<span class="ident" id="4350011">n</span>&nbsp;<span class="op" id="4350013">:=</span>&nbsp;<span class="num" id="4350016">0</span><span class="op" id="4350017">,</span>&nbsp;<span class="ident" id="4350019">nlit</span><span class="op" id="4350023">+</span><span class="ident" id="4350024">ndist</span><span class="op" id="4350029">;</span>&nbsp;<span class="ident" id="4350031">i</span>&nbsp;<span class="op" id="4350033">&lt;</span>&nbsp;<span class="ident" id="4350035">n</span><span class="op" id="4350036">;</span>&nbsp;<span class="op" id="4350038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4350042">x</span><span class="op" id="4350043">,</span>&nbsp;<span class="ident" id="4350045">err</span>&nbsp;<span class="op" id="4350049">:=</span>&nbsp;<span class="ident" id="4350052">f</span><span class="op" id="4350053">.</span><span class="ident" id="4350054">huffSym</span><span class="op" id="4350061">(</span><span class="op" id="4350062">&amp;</span><span class="ident" id="4350063">f</span><span class="op" id="4350064">.</span><span class="ident" id="4350065">h1</span><span class="op" id="4350067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350071">if</span>&nbsp;<span class="ident" id="4350074">err</span>&nbsp;<span class="op" id="4350078">!=</span>&nbsp;<span class="ident" id="4350081">nil</span>&nbsp;<span class="op" id="4350085">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350090">return</span>&nbsp;<span class="ident" id="4350097">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4350103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350107">if</span>&nbsp;<span class="ident" id="4350110">x</span>&nbsp;<span class="op" id="4350112">&lt;</span>&nbsp;<span class="num" id="4350114">16</span>&nbsp;<span class="op" id="4350117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4350122">//&nbsp;Actual&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4350143">f</span><span class="op" id="4350144">.</span><span class="ident" id="4350145">bits</span><span class="op" id="4350149">[</span><span class="ident" id="4350150">i</span><span class="op" id="4350151">]</span>&nbsp;<span class="op" id="4350153">=</span>&nbsp;<span class="ident" id="4350155">x</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4350160">i</span><span class="op" id="4350161">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350167">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4350178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4350182">//&nbsp;Repeat&nbsp;previous&nbsp;length&nbsp;or&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350219">var</span>&nbsp;<span class="ident" id="4350223">rep</span>&nbsp;<span class="builtintype" id="4350227">int</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350233">var</span>&nbsp;<span class="ident" id="4350237">nb</span>&nbsp;<span class="builtintype" id="4350240">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350247">var</span>&nbsp;<span class="ident" id="4350251">b</span>&nbsp;<span class="builtintype" id="4350253">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350259">switch</span>&nbsp;<span class="ident" id="4350266">x</span>&nbsp;<span class="op" id="4350268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350272">default</span><span class="op" id="4350279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350284">return</span>&nbsp;<span class="ident" id="4350291">InternalError</span><span class="op" id="4350304">(</span><span class="string" id="4350305">&#34;unexpected&nbsp;length&nbsp;code&#34;</span><span class="op" id="4350329">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350333">case</span>&nbsp;<span class="num" id="4350338">16</span><span class="op" id="4350340">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4350345">rep</span>&nbsp;<span class="op" id="4350349">=</span>&nbsp;<span class="num" id="4350351">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4350356">nb</span>&nbsp;<span class="op" id="4350359">=</span>&nbsp;<span class="num" id="4350361">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350366">if</span>&nbsp;<span class="ident" id="4350369">i</span>&nbsp;<span class="op" id="4350371">==</span>&nbsp;<span class="num" id="4350374">0</span>&nbsp;<span class="op" id="4350376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350382">return</span>&nbsp;<span class="ident" id="4350389">CorruptInputError</span><span class="op" id="4350406">(</span><span class="ident" id="4350407">f</span><span class="op" id="4350408">.</span><span class="ident" id="4350409">roffset</span><span class="op" id="4350416">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4350421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4350426">b</span>&nbsp;<span class="op" id="4350428">=</span>&nbsp;<span class="ident" id="4350430">f</span><span class="op" id="4350431">.</span><span class="ident" id="4350432">bits</span><span class="op" id="4350436">[</span><span class="ident" id="4350437">i</span><span class="op" id="4350438">-</span><span class="num" id="4350439">1</span><span class="op" id="4350440">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350444">case</span>&nbsp;<span class="num" id="4350449">17</span><span class="op" id="4350451">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4350456">rep</span>&nbsp;<span class="op" id="4350460">=</span>&nbsp;<span class="num" id="4350462">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4350467">nb</span>&nbsp;<span class="op" id="4350470">=</span>&nbsp;<span class="num" id="4350472">3</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4350477">b</span>&nbsp;<span class="op" id="4350479">=</span>&nbsp;<span class="num" id="4350481">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350485">case</span>&nbsp;<span class="num" id="4350490">18</span><span class="op" id="4350492">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4350497">rep</span>&nbsp;<span class="op" id="4350501">=</span>&nbsp;<span class="num" id="4350503">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4350509">nb</span>&nbsp;<span class="op" id="4350512">=</span>&nbsp;<span class="num" id="4350514">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4350519">b</span>&nbsp;<span class="op" id="4350521">=</span>&nbsp;<span class="num" id="4350523">0</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4350527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350531">for</span>&nbsp;<span class="ident" id="4350535">f</span><span class="op" id="4350536">.</span><span class="ident" id="4350537">nb</span>&nbsp;<span class="op" id="4350540">&lt;</span>&nbsp;<span class="ident" id="4350542">nb</span>&nbsp;<span class="op" id="4350545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350550">if</span>&nbsp;<span class="ident" id="4350553">err</span>&nbsp;<span class="op" id="4350557">:=</span>&nbsp;<span class="ident" id="4350560">f</span><span class="op" id="4350561">.</span><span class="ident" id="4350562">moreBits</span><span class="op" id="4350570">(</span><span class="op" id="4350571">)</span><span class="op" id="4350572">;</span>&nbsp;<span class="ident" id="4350574">err</span>&nbsp;<span class="op" id="4350578">!=</span>&nbsp;<span class="ident" id="4350581">nil</span>&nbsp;<span class="op" id="4350585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350591">return</span>&nbsp;<span class="ident" id="4350598">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4350605">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4350609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4350613">rep</span>&nbsp;<span class="op" id="4350617">+=</span>&nbsp;<span class="builtintype" id="4350620">int</span><span class="op" id="4350623">(</span><span class="ident" id="4350624">f</span><span class="op" id="4350625">.</span><span class="ident" id="4350626">b</span>&nbsp;<span class="op" id="4350628">&amp;</span>&nbsp;<span class="builtintype" id="4350630">uint32</span><span class="op" id="4350636">(</span><span class="num" id="4350637">1</span><span class="op" id="4350638">&lt;&lt;</span><span class="ident" id="4350640">nb</span><span class="op" id="4350642">-</span><span class="num" id="4350643">1</span><span class="op" id="4350644">)</span><span class="op" id="4350645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4350649">f</span><span class="op" id="4350650">.</span><span class="ident" id="4350651">b</span>&nbsp;<span class="op" id="4350653">&gt;&gt;=</span>&nbsp;<span class="ident" id="4350657">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4350662">f</span><span class="op" id="4350663">.</span><span class="ident" id="4350664">nb</span>&nbsp;<span class="op" id="4350667">-=</span>&nbsp;<span class="ident" id="4350670">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350675">if</span>&nbsp;<span class="ident" id="4350678">i</span><span class="op" id="4350679">+</span><span class="ident" id="4350680">rep</span>&nbsp;<span class="op" id="4350684">&gt;</span>&nbsp;<span class="ident" id="4350686">n</span>&nbsp;<span class="op" id="4350688">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350693">return</span>&nbsp;<span class="ident" id="4350700">CorruptInputError</span><span class="op" id="4350717">(</span><span class="ident" id="4350718">f</span><span class="op" id="4350719">.</span><span class="ident" id="4350720">roffset</span><span class="op" id="4350727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4350731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350735">for</span>&nbsp;<span class="ident" id="4350739">j</span>&nbsp;<span class="op" id="4350741">:=</span>&nbsp;<span class="num" id="4350744">0</span><span class="op" id="4350745">;</span>&nbsp;<span class="ident" id="4350747">j</span>&nbsp;<span class="op" id="4350749">&lt;</span>&nbsp;<span class="ident" id="4350751">rep</span><span class="op" id="4350754">;</span>&nbsp;<span class="ident" id="4350756">j</span><span class="op" id="4350757">++</span>&nbsp;<span class="op" id="4350760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4350765">f</span><span class="op" id="4350766">.</span><span class="ident" id="4350767">bits</span><span class="op" id="4350771">[</span><span class="ident" id="4350772">i</span><span class="op" id="4350773">]</span>&nbsp;<span class="op" id="4350775">=</span>&nbsp;<span class="ident" id="4350777">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4350782">i</span><span class="op" id="4350783">++</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4350788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4350791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350795">if</span>&nbsp;<span class="op" id="4350798">!</span><span class="ident" id="4350799">f</span><span class="op" id="4350800">.</span><span class="ident" id="4350801">h1</span><span class="op" id="4350803">.</span><span class="ident" id="4350804">init</span><span class="op" id="4350808">(</span><span class="ident" id="4350809">f</span><span class="op" id="4350810">.</span><span class="ident" id="4350811">bits</span><span class="op" id="4350815">[</span><span class="num" id="4350816">0</span><span class="op" id="4350817">:</span><span class="ident" id="4350818">nlit</span><span class="op" id="4350822">]</span><span class="op" id="4350823">)</span>&nbsp;<span class="op" id="4350825">||</span>&nbsp;<span class="op" id="4350828">!</span><span class="ident" id="4350829">f</span><span class="op" id="4350830">.</span><span class="ident" id="4350831">h2</span><span class="op" id="4350833">.</span><span class="ident" id="4350834">init</span><span class="op" id="4350838">(</span><span class="ident" id="4350839">f</span><span class="op" id="4350840">.</span><span class="ident" id="4350841">bits</span><span class="op" id="4350845">[</span><span class="ident" id="4350846">nlit</span><span class="op" id="4350850">:</span><span class="ident" id="4350851">nlit</span><span class="op" id="4350855">+</span><span class="ident" id="4350856">ndist</span><span class="op" id="4350861">]</span><span class="op" id="4350862">)</span>&nbsp;<span class="op" id="4350864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350868">return</span>&nbsp;<span class="ident" id="4350875">CorruptInputError</span><span class="op" id="4350892">(</span><span class="ident" id="4350893">f</span><span class="op" id="4350894">.</span><span class="ident" id="4350895">roffset</span><span class="op" id="4350902">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4350905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4350909">return</span>&nbsp;<span class="ident" id="4350916">nil</span><br>
<span class="lineno"></span><span class="op" id="4350920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="4350923">//&nbsp;Decode&nbsp;a&nbsp;single&nbsp;Huffman&nbsp;block&nbsp;from&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="4350964">//&nbsp;hl&nbsp;and&nbsp;hd&nbsp;are&nbsp;the&nbsp;Huffman&nbsp;states&nbsp;for&nbsp;the&nbsp;lit/length&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4351026">//&nbsp;and&nbsp;the&nbsp;distance&nbsp;values,&nbsp;respectively.&nbsp;&nbsp;If&nbsp;hd&nbsp;==&nbsp;nil,&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4351093">//&nbsp;fixed&nbsp;distance&nbsp;encoding&nbsp;associated&nbsp;with&nbsp;fixed&nbsp;Huffman&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="4351158">func</span>&nbsp;<span class="op" id="4351163">(</span><span class="ident" id="4351164">f</span>&nbsp;<span class="op" id="4351166">*</span><span class="ident" id="4351167">decompressor</span><span class="op" id="4351179">)</span>&nbsp;<span class="ident" id="4351181">huffmanBlock</span><span class="op" id="4351193">(</span><span class="op" id="4351194">)</span>&nbsp;<span class="op" id="4351196">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351199">for</span>&nbsp;<span class="op" id="4351203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4351207">v</span><span class="op" id="4351208">,</span>&nbsp;<span class="ident" id="4351210">err</span>&nbsp;<span class="op" id="4351214">:=</span>&nbsp;<span class="ident" id="4351217">f</span><span class="op" id="4351218">.</span><span class="ident" id="4351219">huffSym</span><span class="op" id="4351226">(</span><span class="ident" id="4351227">f</span><span class="op" id="4351228">.</span><span class="ident" id="4351229">hl</span><span class="op" id="4351231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351235">if</span>&nbsp;<span class="ident" id="4351238">err</span>&nbsp;<span class="op" id="4351242">!=</span>&nbsp;<span class="ident" id="4351245">nil</span>&nbsp;<span class="op" id="4351249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4351254">f</span><span class="op" id="4351255">.</span><span class="ident" id="4351256">err</span>&nbsp;<span class="op" id="4351260">=</span>&nbsp;<span class="ident" id="4351262">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351269">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4351278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351282">var</span>&nbsp;<span class="ident" id="4351286">n</span>&nbsp;<span class="builtintype" id="4351288">uint</span>&nbsp;<span class="comment" id="4351293">//&nbsp;number&nbsp;of&nbsp;bits&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351319">var</span>&nbsp;<span class="ident" id="4351323">length</span>&nbsp;<span class="builtintype" id="4351330">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351336">switch</span>&nbsp;<span class="op" id="4351343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351347">case</span>&nbsp;<span class="ident" id="4351352">v</span>&nbsp;<span class="op" id="4351354">&lt;</span>&nbsp;<span class="num" id="4351356">256</span><span class="op" id="4351359">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4351364">f</span><span class="op" id="4351365">.</span><span class="ident" id="4351366">hist</span><span class="op" id="4351370">[</span><span class="ident" id="4351371">f</span><span class="op" id="4351372">.</span><span class="ident" id="4351373">hp</span><span class="op" id="4351375">]</span>&nbsp;<span class="op" id="4351377">=</span>&nbsp;<span class="builtintype" id="4351379">byte</span><span class="op" id="4351383">(</span><span class="ident" id="4351384">v</span><span class="op" id="4351385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4351390">f</span><span class="op" id="4351391">.</span><span class="ident" id="4351392">hp</span><span class="op" id="4351394">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351400">if</span>&nbsp;<span class="ident" id="4351403">f</span><span class="op" id="4351404">.</span><span class="ident" id="4351405">hp</span>&nbsp;<span class="op" id="4351408">==</span>&nbsp;<span class="builtinfunc" id="4351411">len</span><span class="op" id="4351414">(</span><span class="ident" id="4351415">f</span><span class="op" id="4351416">.</span><span class="ident" id="4351417">hist</span><span class="op" id="4351421">)</span>&nbsp;<span class="op" id="4351423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4351429">//&nbsp;After&nbsp;the&nbsp;flush,&nbsp;continue&nbsp;this&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4351473">f</span><span class="op" id="4351474">.</span><span class="ident" id="4351475">flush</span><span class="op" id="4351480">(</span><span class="op" id="4351481">(</span><span class="op" id="4351482">*</span><span class="ident" id="4351483">decompressor</span><span class="op" id="4351495">)</span><span class="op" id="4351496">.</span><span class="ident" id="4351497">huffmanBlock</span><span class="op" id="4351509">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351515">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4351525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351530">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351541">case</span>&nbsp;<span class="ident" id="4351546">v</span>&nbsp;<span class="op" id="4351548">==</span>&nbsp;<span class="num" id="4351551">256</span><span class="op" id="4351554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4351559">//&nbsp;Done&nbsp;with&nbsp;huffman&nbsp;block;&nbsp;read&nbsp;next&nbsp;block.</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4351607">f</span><span class="op" id="4351608">.</span><span class="ident" id="4351609">step</span>&nbsp;<span class="op" id="4351614">=</span>&nbsp;<span class="op" id="4351616">(</span><span class="op" id="4351617">*</span><span class="ident" id="4351618">decompressor</span><span class="op" id="4351630">)</span><span class="op" id="4351631">.</span><span class="ident" id="4351632">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351645">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4351654">//&nbsp;otherwise,&nbsp;reference&nbsp;to&nbsp;older&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351694">case</span>&nbsp;<span class="ident" id="4351699">v</span>&nbsp;<span class="op" id="4351701">&lt;</span>&nbsp;<span class="num" id="4351703">265</span><span class="op" id="4351706">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4351711">length</span>&nbsp;<span class="op" id="4351718">=</span>&nbsp;<span class="ident" id="4351720">v</span>&nbsp;<span class="op" id="4351722">-</span>&nbsp;<span class="op" id="4351724">(</span><span class="num" id="4351725">257</span>&nbsp;<span class="op" id="4351729">-</span>&nbsp;<span class="num" id="4351731">3</span><span class="op" id="4351732">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4351737">n</span>&nbsp;<span class="op" id="4351739">=</span>&nbsp;<span class="num" id="4351741">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351745">case</span>&nbsp;<span class="ident" id="4351750">v</span>&nbsp;<span class="op" id="4351752">&lt;</span>&nbsp;<span class="num" id="4351754">269</span><span class="op" id="4351757">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4351762">length</span>&nbsp;<span class="op" id="4351769">=</span>&nbsp;<span class="ident" id="4351771">v</span><span class="op" id="4351772">*</span><span class="num" id="4351773">2</span>&nbsp;<span class="op" id="4351775">-</span>&nbsp;<span class="op" id="4351777">(</span><span class="num" id="4351778">265</span><span class="op" id="4351781">*</span><span class="num" id="4351782">2</span>&nbsp;<span class="op" id="4351784">-</span>&nbsp;<span class="num" id="4351786">11</span><span class="op" id="4351788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4351793">n</span>&nbsp;<span class="op" id="4351795">=</span>&nbsp;<span class="num" id="4351797">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351801">case</span>&nbsp;<span class="ident" id="4351806">v</span>&nbsp;<span class="op" id="4351808">&lt;</span>&nbsp;<span class="num" id="4351810">273</span><span class="op" id="4351813">:</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4351818">length</span>&nbsp;<span class="op" id="4351825">=</span>&nbsp;<span class="ident" id="4351827">v</span><span class="op" id="4351828">*</span><span class="num" id="4351829">4</span>&nbsp;<span class="op" id="4351831">-</span>&nbsp;<span class="op" id="4351833">(</span><span class="num" id="4351834">269</span><span class="op" id="4351837">*</span><span class="num" id="4351838">4</span>&nbsp;<span class="op" id="4351840">-</span>&nbsp;<span class="num" id="4351842">19</span><span class="op" id="4351844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4351849">n</span>&nbsp;<span class="op" id="4351851">=</span>&nbsp;<span class="num" id="4351853">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351857">case</span>&nbsp;<span class="ident" id="4351862">v</span>&nbsp;<span class="op" id="4351864">&lt;</span>&nbsp;<span class="num" id="4351866">277</span><span class="op" id="4351869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4351874">length</span>&nbsp;<span class="op" id="4351881">=</span>&nbsp;<span class="ident" id="4351883">v</span><span class="op" id="4351884">*</span><span class="num" id="4351885">8</span>&nbsp;<span class="op" id="4351887">-</span>&nbsp;<span class="op" id="4351889">(</span><span class="num" id="4351890">273</span><span class="op" id="4351893">*</span><span class="num" id="4351894">8</span>&nbsp;<span class="op" id="4351896">-</span>&nbsp;<span class="num" id="4351898">35</span><span class="op" id="4351900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4351905">n</span>&nbsp;<span class="op" id="4351907">=</span>&nbsp;<span class="num" id="4351909">3</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351913">case</span>&nbsp;<span class="ident" id="4351918">v</span>&nbsp;<span class="op" id="4351920">&lt;</span>&nbsp;<span class="num" id="4351922">281</span><span class="op" id="4351925">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4351930">length</span>&nbsp;<span class="op" id="4351937">=</span>&nbsp;<span class="ident" id="4351939">v</span><span class="op" id="4351940">*</span><span class="num" id="4351941">16</span>&nbsp;<span class="op" id="4351944">-</span>&nbsp;<span class="op" id="4351946">(</span><span class="num" id="4351947">277</span><span class="op" id="4351950">*</span><span class="num" id="4351951">16</span>&nbsp;<span class="op" id="4351954">-</span>&nbsp;<span class="num" id="4351956">67</span><span class="op" id="4351958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4351963">n</span>&nbsp;<span class="op" id="4351965">=</span>&nbsp;<span class="num" id="4351967">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4351971">case</span>&nbsp;<span class="ident" id="4351976">v</span>&nbsp;<span class="op" id="4351978">&lt;</span>&nbsp;<span class="num" id="4351980">285</span><span class="op" id="4351983">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4351988">length</span>&nbsp;<span class="op" id="4351995">=</span>&nbsp;<span class="ident" id="4351997">v</span><span class="op" id="4351998">*</span><span class="num" id="4351999">32</span>&nbsp;<span class="op" id="4352002">-</span>&nbsp;<span class="op" id="4352004">(</span><span class="num" id="4352005">281</span><span class="op" id="4352008">*</span><span class="num" id="4352009">32</span>&nbsp;<span class="op" id="4352012">-</span>&nbsp;<span class="num" id="4352014">131</span><span class="op" id="4352017">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352022">n</span>&nbsp;<span class="op" id="4352024">=</span>&nbsp;<span class="num" id="4352026">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352030">default</span><span class="op" id="4352037">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352042">length</span>&nbsp;<span class="op" id="4352049">=</span>&nbsp;<span class="num" id="4352051">258</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352058">n</span>&nbsp;<span class="op" id="4352060">=</span>&nbsp;<span class="num" id="4352062">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4352066">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352070">if</span>&nbsp;<span class="ident" id="4352073">n</span>&nbsp;<span class="op" id="4352075">&gt;</span>&nbsp;<span class="num" id="4352077">0</span>&nbsp;<span class="op" id="4352079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352084">for</span>&nbsp;<span class="ident" id="4352088">f</span><span class="op" id="4352089">.</span><span class="ident" id="4352090">nb</span>&nbsp;<span class="op" id="4352093">&lt;</span>&nbsp;<span class="ident" id="4352095">n</span>&nbsp;<span class="op" id="4352097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352103">if</span>&nbsp;<span class="ident" id="4352106">err</span>&nbsp;<span class="op" id="4352110">=</span>&nbsp;<span class="ident" id="4352112">f</span><span class="op" id="4352113">.</span><span class="ident" id="4352114">moreBits</span><span class="op" id="4352122">(</span><span class="op" id="4352123">)</span><span class="op" id="4352124">;</span>&nbsp;<span class="ident" id="4352126">err</span>&nbsp;<span class="op" id="4352130">!=</span>&nbsp;<span class="ident" id="4352133">nil</span>&nbsp;<span class="op" id="4352137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352144">f</span><span class="op" id="4352145">.</span><span class="ident" id="4352146">err</span>&nbsp;<span class="op" id="4352150">=</span>&nbsp;<span class="ident" id="4352152">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352161">return</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4352172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4352177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352182">length</span>&nbsp;<span class="op" id="4352189">+=</span>&nbsp;<span class="builtintype" id="4352192">int</span><span class="op" id="4352195">(</span><span class="ident" id="4352196">f</span><span class="op" id="4352197">.</span><span class="ident" id="4352198">b</span>&nbsp;<span class="op" id="4352200">&amp;</span>&nbsp;<span class="builtintype" id="4352202">uint32</span><span class="op" id="4352208">(</span><span class="num" id="4352209">1</span><span class="op" id="4352210">&lt;&lt;</span><span class="ident" id="4352212">n</span><span class="op" id="4352213">-</span><span class="num" id="4352214">1</span><span class="op" id="4352215">)</span><span class="op" id="4352216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352221">f</span><span class="op" id="4352222">.</span><span class="ident" id="4352223">b</span>&nbsp;<span class="op" id="4352225">&gt;&gt;=</span>&nbsp;<span class="ident" id="4352229">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352234">f</span><span class="op" id="4352235">.</span><span class="ident" id="4352236">nb</span>&nbsp;<span class="op" id="4352239">-=</span>&nbsp;<span class="ident" id="4352242">n</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4352246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352251">var</span>&nbsp;<span class="ident" id="4352255">dist</span>&nbsp;<span class="builtintype" id="4352260">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352266">if</span>&nbsp;<span class="ident" id="4352269">f</span><span class="op" id="4352270">.</span><span class="ident" id="4352271">hd</span>&nbsp;<span class="op" id="4352274">==</span>&nbsp;<span class="ident" id="4352277">nil</span>&nbsp;<span class="op" id="4352281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352286">for</span>&nbsp;<span class="ident" id="4352290">f</span><span class="op" id="4352291">.</span><span class="ident" id="4352292">nb</span>&nbsp;<span class="op" id="4352295">&lt;</span>&nbsp;<span class="num" id="4352297">5</span>&nbsp;<span class="op" id="4352299">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352305">if</span>&nbsp;<span class="ident" id="4352308">err</span>&nbsp;<span class="op" id="4352312">=</span>&nbsp;<span class="ident" id="4352314">f</span><span class="op" id="4352315">.</span><span class="ident" id="4352316">moreBits</span><span class="op" id="4352324">(</span><span class="op" id="4352325">)</span><span class="op" id="4352326">;</span>&nbsp;<span class="ident" id="4352328">err</span>&nbsp;<span class="op" id="4352332">!=</span>&nbsp;<span class="ident" id="4352335">nil</span>&nbsp;<span class="op" id="4352339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352346">f</span><span class="op" id="4352347">.</span><span class="ident" id="4352348">err</span>&nbsp;<span class="op" id="4352352">=</span>&nbsp;<span class="ident" id="4352354">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352363">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4352374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4352379">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352384">dist</span>&nbsp;<span class="op" id="4352389">=</span>&nbsp;<span class="builtintype" id="4352391">int</span><span class="op" id="4352394">(</span><span class="ident" id="4352395">reverseByte</span><span class="op" id="4352406">[</span><span class="op" id="4352407">(</span><span class="ident" id="4352408">f</span><span class="op" id="4352409">.</span><span class="ident" id="4352410">b</span><span class="op" id="4352411">&amp;</span><span class="num" id="4352412">0x1F</span><span class="op" id="4352416">)</span><span class="op" id="4352417">&lt;&lt;</span><span class="num" id="4352419">3</span><span class="op" id="4352420">]</span><span class="op" id="4352421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352426">f</span><span class="op" id="4352427">.</span><span class="ident" id="4352428">b</span>&nbsp;<span class="op" id="4352430">&gt;&gt;=</span>&nbsp;<span class="num" id="4352434">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352439">f</span><span class="op" id="4352440">.</span><span class="ident" id="4352441">nb</span>&nbsp;<span class="op" id="4352444">-=</span>&nbsp;<span class="num" id="4352447">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4352451">}</span>&nbsp;<span class="keyword" id="4352453">else</span>&nbsp;<span class="op" id="4352458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352463">if</span>&nbsp;<span class="ident" id="4352466">dist</span><span class="op" id="4352470">,</span>&nbsp;<span class="ident" id="4352472">err</span>&nbsp;<span class="op" id="4352476">=</span>&nbsp;<span class="ident" id="4352478">f</span><span class="op" id="4352479">.</span><span class="ident" id="4352480">huffSym</span><span class="op" id="4352487">(</span><span class="ident" id="4352488">f</span><span class="op" id="4352489">.</span><span class="ident" id="4352490">hd</span><span class="op" id="4352492">)</span><span class="op" id="4352493">;</span>&nbsp;<span class="ident" id="4352495">err</span>&nbsp;<span class="op" id="4352499">!=</span>&nbsp;<span class="ident" id="4352502">nil</span>&nbsp;<span class="op" id="4352506">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352512">f</span><span class="op" id="4352513">.</span><span class="ident" id="4352514">err</span>&nbsp;<span class="op" id="4352518">=</span>&nbsp;<span class="ident" id="4352520">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352528">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4352538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4352542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352547">switch</span>&nbsp;<span class="op" id="4352554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352558">case</span>&nbsp;<span class="ident" id="4352563">dist</span>&nbsp;<span class="op" id="4352568">&lt;</span>&nbsp;<span class="num" id="4352570">4</span><span class="op" id="4352571">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352576">dist</span><span class="op" id="4352580">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352585">case</span>&nbsp;<span class="ident" id="4352590">dist</span>&nbsp;<span class="op" id="4352595">&gt;=</span>&nbsp;<span class="num" id="4352598">30</span><span class="op" id="4352600">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352605">f</span><span class="op" id="4352606">.</span><span class="ident" id="4352607">err</span>&nbsp;<span class="op" id="4352611">=</span>&nbsp;<span class="ident" id="4352613">CorruptInputError</span><span class="op" id="4352630">(</span><span class="ident" id="4352631">f</span><span class="op" id="4352632">.</span><span class="ident" id="4352633">roffset</span><span class="op" id="4352640">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352645">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352654">default</span><span class="op" id="4352661">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352666">nb</span>&nbsp;<span class="op" id="4352669">:=</span>&nbsp;<span class="builtintype" id="4352672">uint</span><span class="op" id="4352676">(</span><span class="ident" id="4352677">dist</span><span class="op" id="4352681">-</span><span class="num" id="4352682">2</span><span class="op" id="4352683">)</span>&nbsp;<span class="op" id="4352685">&gt;&gt;</span>&nbsp;<span class="num" id="4352688">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4352693">//&nbsp;have&nbsp;1&nbsp;bit&nbsp;in&nbsp;bottom&nbsp;of&nbsp;dist,&nbsp;need&nbsp;nb&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352743">extra</span>&nbsp;<span class="op" id="4352749">:=</span>&nbsp;<span class="op" id="4352752">(</span><span class="ident" id="4352753">dist</span>&nbsp;<span class="op" id="4352758">&amp;</span>&nbsp;<span class="num" id="4352760">1</span><span class="op" id="4352761">)</span>&nbsp;<span class="op" id="4352763">&lt;&lt;</span>&nbsp;<span class="ident" id="4352766">nb</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352772">for</span>&nbsp;<span class="ident" id="4352776">f</span><span class="op" id="4352777">.</span><span class="ident" id="4352778">nb</span>&nbsp;<span class="op" id="4352781">&lt;</span>&nbsp;<span class="ident" id="4352783">nb</span>&nbsp;<span class="op" id="4352786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352792">if</span>&nbsp;<span class="ident" id="4352795">err</span>&nbsp;<span class="op" id="4352799">=</span>&nbsp;<span class="ident" id="4352801">f</span><span class="op" id="4352802">.</span><span class="ident" id="4352803">moreBits</span><span class="op" id="4352811">(</span><span class="op" id="4352812">)</span><span class="op" id="4352813">;</span>&nbsp;<span class="ident" id="4352815">err</span>&nbsp;<span class="op" id="4352819">!=</span>&nbsp;<span class="ident" id="4352822">nil</span>&nbsp;<span class="op" id="4352826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352833">f</span><span class="op" id="4352834">.</span><span class="ident" id="4352835">err</span>&nbsp;<span class="op" id="4352839">=</span>&nbsp;<span class="ident" id="4352841">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4352850">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4352861">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4352866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352871">extra</span>&nbsp;<span class="op" id="4352877">|=</span>&nbsp;<span class="builtintype" id="4352880">int</span><span class="op" id="4352883">(</span><span class="ident" id="4352884">f</span><span class="op" id="4352885">.</span><span class="ident" id="4352886">b</span>&nbsp;<span class="op" id="4352888">&amp;</span>&nbsp;<span class="builtintype" id="4352890">uint32</span><span class="op" id="4352896">(</span><span class="num" id="4352897">1</span><span class="op" id="4352898">&lt;&lt;</span><span class="ident" id="4352900">nb</span><span class="op" id="4352902">-</span><span class="num" id="4352903">1</span><span class="op" id="4352904">)</span><span class="op" id="4352905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352910">f</span><span class="op" id="4352911">.</span><span class="ident" id="4352912">b</span>&nbsp;<span class="op" id="4352914">&gt;&gt;=</span>&nbsp;<span class="ident" id="4352918">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352924">f</span><span class="op" id="4352925">.</span><span class="ident" id="4352926">nb</span>&nbsp;<span class="op" id="4352929">-=</span>&nbsp;<span class="ident" id="4352932">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4352938">dist</span>&nbsp;<span class="op" id="4352943">=</span>&nbsp;<span class="num" id="4352945">1</span><span class="op" id="4352946">&lt;&lt;</span><span class="op" id="4352948">(</span><span class="ident" id="4352949">nb</span><span class="op" id="4352951">+</span><span class="num" id="4352952">1</span><span class="op" id="4352953">)</span>&nbsp;<span class="op" id="4352955">+</span>&nbsp;<span class="num" id="4352957">1</span>&nbsp;<span class="op" id="4352959">+</span>&nbsp;<span class="ident" id="4352961">extra</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4352969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4352974">//&nbsp;Copy&nbsp;history[-dist:-dist+length]&nbsp;into&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4353025">if</span>&nbsp;<span class="ident" id="4353028">dist</span>&nbsp;<span class="op" id="4353033">&gt;</span>&nbsp;<span class="builtinfunc" id="4353035">len</span><span class="op" id="4353038">(</span><span class="ident" id="4353039">f</span><span class="op" id="4353040">.</span><span class="ident" id="4353041">hist</span><span class="op" id="4353045">)</span>&nbsp;<span class="op" id="4353047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4353052">f</span><span class="op" id="4353053">.</span><span class="ident" id="4353054">err</span>&nbsp;<span class="op" id="4353058">=</span>&nbsp;<span class="ident" id="4353060">InternalError</span><span class="op" id="4353073">(</span><span class="string" id="4353074">&#34;bad&nbsp;history&nbsp;distance&#34;</span><span class="op" id="4353096">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4353101">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4353110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4353115">//&nbsp;No&nbsp;check&nbsp;on&nbsp;length;&nbsp;encoding&nbsp;can&nbsp;be&nbsp;prescient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4353167">if</span>&nbsp;<span class="op" id="4353170">!</span><span class="ident" id="4353171">f</span><span class="op" id="4353172">.</span><span class="ident" id="4353173">hfull</span>&nbsp;<span class="op" id="4353179">&amp;&amp;</span>&nbsp;<span class="ident" id="4353182">dist</span>&nbsp;<span class="op" id="4353187">&gt;</span>&nbsp;<span class="ident" id="4353189">f</span><span class="op" id="4353190">.</span><span class="ident" id="4353191">hp</span>&nbsp;<span class="op" id="4353194">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4353199">f</span><span class="op" id="4353200">.</span><span class="ident" id="4353201">err</span>&nbsp;<span class="op" id="4353205">=</span>&nbsp;<span class="ident" id="4353207">CorruptInputError</span><span class="op" id="4353224">(</span><span class="ident" id="4353225">f</span><span class="op" id="4353226">.</span><span class="ident" id="4353227">roffset</span><span class="op" id="4353234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4353239">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4353248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4353253">f</span><span class="op" id="4353254">.</span><span class="ident" id="4353255">copyLen</span><span class="op" id="4353262">,</span>&nbsp;<span class="ident" id="4353264">f</span><span class="op" id="4353265">.</span><span class="ident" id="4353266">copyDist</span>&nbsp;<span class="op" id="4353275">=</span>&nbsp;<span class="ident" id="4353277">length</span><span class="op" id="4353283">,</span>&nbsp;<span class="ident" id="4353285">dist</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4353292">if</span>&nbsp;<span class="ident" id="4353295">f</span><span class="op" id="4353296">.</span><span class="ident" id="4353297">copyHist</span><span class="op" id="4353305">(</span><span class="op" id="4353306">)</span>&nbsp;<span class="op" id="4353308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4353313">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4353322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4353325">}</span><br>
<span class="lineno"></span><span class="op" id="4353327">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span><span class="comment" id="4353330">//&nbsp;copyHist&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;f.hist&nbsp;(f.copyDist&nbsp;bytes&nbsp;ago)&nbsp;to&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="4353411">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;the&nbsp;f.hist&nbsp;buffer&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4353460">func</span>&nbsp;<span class="op" id="4353465">(</span><span class="ident" id="4353466">f</span>&nbsp;<span class="op" id="4353468">*</span><span class="ident" id="4353469">decompressor</span><span class="op" id="4353481">)</span>&nbsp;<span class="ident" id="4353483">copyHist</span><span class="op" id="4353491">(</span><span class="op" id="4353492">)</span>&nbsp;<span class="builtintype" id="4353494">bool</span>&nbsp;<span class="op" id="4353499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4353502">p</span>&nbsp;<span class="op" id="4353504">:=</span>&nbsp;<span class="ident" id="4353507">f</span><span class="op" id="4353508">.</span><span class="ident" id="4353509">hp</span>&nbsp;<span class="op" id="4353512">-</span>&nbsp;<span class="ident" id="4353514">f</span><span class="op" id="4353515">.</span><span class="ident" id="4353516">copyDist</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4353526">if</span>&nbsp;<span class="ident" id="4353529">p</span>&nbsp;<span class="op" id="4353531">&lt;</span>&nbsp;<span class="num" id="4353533">0</span>&nbsp;<span class="op" id="4353535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4353539">p</span>&nbsp;<span class="op" id="4353541">+=</span>&nbsp;<span class="builtinfunc" id="4353544">len</span><span class="op" id="4353547">(</span><span class="ident" id="4353548">f</span><span class="op" id="4353549">.</span><span class="ident" id="4353550">hist</span><span class="op" id="4353554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4353557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4353560">for</span>&nbsp;<span class="ident" id="4353564">f</span><span class="op" id="4353565">.</span><span class="ident" id="4353566">copyLen</span>&nbsp;<span class="op" id="4353574">&gt;</span>&nbsp;<span class="num" id="4353576">0</span>&nbsp;<span class="op" id="4353578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4353582">n</span>&nbsp;<span class="op" id="4353584">:=</span>&nbsp;<span class="ident" id="4353587">f</span><span class="op" id="4353588">.</span><span class="ident" id="4353589">copyLen</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4353599">if</span>&nbsp;<span class="ident" id="4353602">x</span>&nbsp;<span class="op" id="4353604">:=</span>&nbsp;<span class="builtinfunc" id="4353607">len</span><span class="op" id="4353610">(</span><span class="ident" id="4353611">f</span><span class="op" id="4353612">.</span><span class="ident" id="4353613">hist</span><span class="op" id="4353617">)</span>&nbsp;<span class="op" id="4353619">-</span>&nbsp;<span class="ident" id="4353621">f</span><span class="op" id="4353622">.</span><span class="ident" id="4353623">hp</span><span class="op" id="4353625">;</span>&nbsp;<span class="ident" id="4353627">n</span>&nbsp;<span class="op" id="4353629">&gt;</span>&nbsp;<span class="ident" id="4353631">x</span>&nbsp;<span class="op" id="4353633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4353638">n</span>&nbsp;<span class="op" id="4353640">=</span>&nbsp;<span class="ident" id="4353642">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4353646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4353650">if</span>&nbsp;<span class="ident" id="4353653">x</span>&nbsp;<span class="op" id="4353655">:=</span>&nbsp;<span class="builtinfunc" id="4353658">len</span><span class="op" id="4353661">(</span><span class="ident" id="4353662">f</span><span class="op" id="4353663">.</span><span class="ident" id="4353664">hist</span><span class="op" id="4353668">)</span>&nbsp;<span class="op" id="4353670">-</span>&nbsp;<span class="ident" id="4353672">p</span><span class="op" id="4353673">;</span>&nbsp;<span class="ident" id="4353675">n</span>&nbsp;<span class="op" id="4353677">&gt;</span>&nbsp;<span class="ident" id="4353679">x</span>&nbsp;<span class="op" id="4353681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4353686">n</span>&nbsp;<span class="op" id="4353688">=</span>&nbsp;<span class="ident" id="4353690">x</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4353694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4353698">forwardCopy</span><span class="op" id="4353709">(</span><span class="ident" id="4353710">f</span><span class="op" id="4353711">.</span><span class="ident" id="4353712">hist</span><span class="op" id="4353716">[</span><span class="op" id="4353717">:</span><span class="op" id="4353718">]</span><span class="op" id="4353719">,</span>&nbsp;<span class="ident" id="4353721">f</span><span class="op" id="4353722">.</span><span class="ident" id="4353723">hp</span><span class="op" id="4353725">,</span>&nbsp;<span class="ident" id="4353727">p</span><span class="op" id="4353728">,</span>&nbsp;<span class="ident" id="4353730">n</span><span class="op" id="4353731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4353735">p</span>&nbsp;<span class="op" id="4353737">+=</span>&nbsp;<span class="ident" id="4353740">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4353744">f</span><span class="op" id="4353745">.</span><span class="ident" id="4353746">hp</span>&nbsp;<span class="op" id="4353749">+=</span>&nbsp;<span class="ident" id="4353752">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4353756">f</span><span class="op" id="4353757">.</span><span class="ident" id="4353758">copyLen</span>&nbsp;<span class="op" id="4353766">-=</span>&nbsp;<span class="ident" id="4353769">n</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4353773">if</span>&nbsp;<span class="ident" id="4353776">f</span><span class="op" id="4353777">.</span><span class="ident" id="4353778">hp</span>&nbsp;<span class="op" id="4353781">==</span>&nbsp;<span class="builtinfunc" id="4353784">len</span><span class="op" id="4353787">(</span><span class="ident" id="4353788">f</span><span class="op" id="4353789">.</span><span class="ident" id="4353790">hist</span><span class="op" id="4353794">)</span>&nbsp;<span class="op" id="4353796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4353801">//&nbsp;After&nbsp;flush&nbsp;continue&nbsp;copying&nbsp;out&nbsp;of&nbsp;history.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4353852">f</span><span class="op" id="4353853">.</span><span class="ident" id="4353854">flush</span><span class="op" id="4353859">(</span><span class="op" id="4353860">(</span><span class="op" id="4353861">*</span><span class="ident" id="4353862">decompressor</span><span class="op" id="4353874">)</span><span class="op" id="4353875">.</span><span class="ident" id="4353876">copyHuff</span><span class="op" id="4353884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4353889">return</span>&nbsp;<span class="ident" id="4353896">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4353903">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4353907">if</span>&nbsp;<span class="ident" id="4353910">p</span>&nbsp;<span class="op" id="4353912">==</span>&nbsp;<span class="builtinfunc" id="4353915">len</span><span class="op" id="4353918">(</span><span class="ident" id="4353919">f</span><span class="op" id="4353920">.</span><span class="ident" id="4353921">hist</span><span class="op" id="4353925">)</span>&nbsp;<span class="op" id="4353927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4353932">p</span>&nbsp;<span class="op" id="4353934">=</span>&nbsp;<span class="num" id="4353936">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4353940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4353943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4353946">return</span>&nbsp;<span class="ident" id="4353953">false</span><br>
<span class="lineno">550</span><span class="op" id="4353959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4353962">func</span>&nbsp;<span class="op" id="4353967">(</span><span class="ident" id="4353968">f</span>&nbsp;<span class="op" id="4353970">*</span><span class="ident" id="4353971">decompressor</span><span class="op" id="4353983">)</span>&nbsp;<span class="ident" id="4353985">copyHuff</span><span class="op" id="4353993">(</span><span class="op" id="4353994">)</span>&nbsp;<span class="op" id="4353996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4353999">if</span>&nbsp;<span class="ident" id="4354002">f</span><span class="op" id="4354003">.</span><span class="ident" id="4354004">copyHist</span><span class="op" id="4354012">(</span><span class="op" id="4354013">)</span>&nbsp;<span class="op" id="4354015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4354019">return</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4354027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354030">f</span><span class="op" id="4354031">.</span><span class="ident" id="4354032">huffmanBlock</span><span class="op" id="4354044">(</span><span class="op" id="4354045">)</span><br>
<span class="lineno"></span><span class="op" id="4354047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4354050">//&nbsp;Copy&nbsp;a&nbsp;single&nbsp;uncompressed&nbsp;data&nbsp;block&nbsp;from&nbsp;input&nbsp;to&nbsp;output.</span><br>
<span class="lineno">560</span><span class="keyword" id="4354113">func</span>&nbsp;<span class="op" id="4354118">(</span><span class="ident" id="4354119">f</span>&nbsp;<span class="op" id="4354121">*</span><span class="ident" id="4354122">decompressor</span><span class="op" id="4354134">)</span>&nbsp;<span class="ident" id="4354136">dataBlock</span><span class="op" id="4354145">(</span><span class="op" id="4354146">)</span>&nbsp;<span class="op" id="4354148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4354151">//&nbsp;Uncompressed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4354169">//&nbsp;Discard&nbsp;current&nbsp;half-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354200">f</span><span class="op" id="4354201">.</span><span class="ident" id="4354202">nb</span>&nbsp;<span class="op" id="4354205">=</span>&nbsp;<span class="num" id="4354207">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354210">f</span><span class="op" id="4354211">.</span><span class="ident" id="4354212">b</span>&nbsp;<span class="op" id="4354214">=</span>&nbsp;<span class="num" id="4354216">0</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4354220">//&nbsp;Length&nbsp;then&nbsp;ones-complement&nbsp;of&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354263">nr</span><span class="op" id="4354265">,</span>&nbsp;<span class="ident" id="4354267">err</span>&nbsp;<span class="op" id="4354271">:=</span>&nbsp;<span class="ident" id="4354274">io</span><span class="op" id="4354276">.</span><span class="ident" id="4354277">ReadFull</span><span class="op" id="4354285">(</span><span class="ident" id="4354286">f</span><span class="op" id="4354287">.</span><span class="ident" id="4354288">r</span><span class="op" id="4354289">,</span>&nbsp;<span class="ident" id="4354291">f</span><span class="op" id="4354292">.</span><span class="ident" id="4354293">buf</span><span class="op" id="4354296">[</span><span class="num" id="4354297">0</span><span class="op" id="4354298">:</span><span class="num" id="4354299">4</span><span class="op" id="4354300">]</span><span class="op" id="4354301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354304">f</span><span class="op" id="4354305">.</span><span class="ident" id="4354306">roffset</span>&nbsp;<span class="op" id="4354314">+=</span>&nbsp;<span class="ident" id="4354317">int64</span><span class="op" id="4354322">(</span><span class="ident" id="4354323">nr</span><span class="op" id="4354325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4354328">if</span>&nbsp;<span class="ident" id="4354331">err</span>&nbsp;<span class="op" id="4354335">!=</span>&nbsp;<span class="ident" id="4354338">nil</span>&nbsp;<span class="op" id="4354342">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354346">f</span><span class="op" id="4354347">.</span><span class="ident" id="4354348">err</span>&nbsp;<span class="op" id="4354352">=</span>&nbsp;<span class="op" id="4354354">&amp;</span><span class="ident" id="4354355">ReadError</span><span class="op" id="4354364">{</span><span class="ident" id="4354365">f</span><span class="op" id="4354366">.</span><span class="ident" id="4354367">roffset</span><span class="op" id="4354374">,</span>&nbsp;<span class="ident" id="4354376">err</span><span class="op" id="4354379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4354383">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4354391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354394">n</span>&nbsp;<span class="op" id="4354396">:=</span>&nbsp;<span class="builtintype" id="4354399">int</span><span class="op" id="4354402">(</span><span class="ident" id="4354403">f</span><span class="op" id="4354404">.</span><span class="ident" id="4354405">buf</span><span class="op" id="4354408">[</span><span class="num" id="4354409">0</span><span class="op" id="4354410">]</span><span class="op" id="4354411">)</span>&nbsp;<span class="op" id="4354413">|</span>&nbsp;<span class="builtintype" id="4354415">int</span><span class="op" id="4354418">(</span><span class="ident" id="4354419">f</span><span class="op" id="4354420">.</span><span class="ident" id="4354421">buf</span><span class="op" id="4354424">[</span><span class="num" id="4354425">1</span><span class="op" id="4354426">]</span><span class="op" id="4354427">)</span><span class="op" id="4354428">&lt;&lt;</span><span class="num" id="4354430">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354433">nn</span>&nbsp;<span class="op" id="4354436">:=</span>&nbsp;<span class="builtintype" id="4354439">int</span><span class="op" id="4354442">(</span><span class="ident" id="4354443">f</span><span class="op" id="4354444">.</span><span class="ident" id="4354445">buf</span><span class="op" id="4354448">[</span><span class="num" id="4354449">2</span><span class="op" id="4354450">]</span><span class="op" id="4354451">)</span>&nbsp;<span class="op" id="4354453">|</span>&nbsp;<span class="builtintype" id="4354455">int</span><span class="op" id="4354458">(</span><span class="ident" id="4354459">f</span><span class="op" id="4354460">.</span><span class="ident" id="4354461">buf</span><span class="op" id="4354464">[</span><span class="num" id="4354465">3</span><span class="op" id="4354466">]</span><span class="op" id="4354467">)</span><span class="op" id="4354468">&lt;&lt;</span><span class="num" id="4354470">8</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4354473">if</span>&nbsp;<span class="builtintype" id="4354476">uint16</span><span class="op" id="4354482">(</span><span class="ident" id="4354483">nn</span><span class="op" id="4354485">)</span>&nbsp;<span class="op" id="4354487">!=</span>&nbsp;<span class="builtintype" id="4354490">uint16</span><span class="op" id="4354496">(</span><span class="op" id="4354497">^</span><span class="ident" id="4354498">n</span><span class="op" id="4354499">)</span>&nbsp;<span class="op" id="4354501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354505">f</span><span class="op" id="4354506">.</span><span class="ident" id="4354507">err</span>&nbsp;<span class="op" id="4354511">=</span>&nbsp;<span class="ident" id="4354513">CorruptInputError</span><span class="op" id="4354530">(</span><span class="ident" id="4354531">f</span><span class="op" id="4354532">.</span><span class="ident" id="4354533">roffset</span><span class="op" id="4354540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4354544">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4354552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4354556">if</span>&nbsp;<span class="ident" id="4354559">n</span>&nbsp;<span class="op" id="4354561">==</span>&nbsp;<span class="num" id="4354564">0</span>&nbsp;<span class="op" id="4354566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4354570">//&nbsp;0-length&nbsp;block&nbsp;means&nbsp;sync</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354601">f</span><span class="op" id="4354602">.</span><span class="ident" id="4354603">flush</span><span class="op" id="4354608">(</span><span class="op" id="4354609">(</span><span class="op" id="4354610">*</span><span class="ident" id="4354611">decompressor</span><span class="op" id="4354623">)</span><span class="op" id="4354624">.</span><span class="ident" id="4354625">nextBlock</span><span class="op" id="4354634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4354638">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4354646">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354650">f</span><span class="op" id="4354651">.</span><span class="ident" id="4354652">copyLen</span>&nbsp;<span class="op" id="4354660">=</span>&nbsp;<span class="ident" id="4354662">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354665">f</span><span class="op" id="4354666">.</span><span class="ident" id="4354667">copyData</span><span class="op" id="4354675">(</span><span class="op" id="4354676">)</span><br>
<span class="lineno"></span><span class="op" id="4354678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="4354681">//&nbsp;copyData&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;into&nbsp;f.hist.</span><br>
<span class="lineno"></span><span class="comment" id="4354756">//&nbsp;It&nbsp;pauses&nbsp;for&nbsp;reads&nbsp;when&nbsp;f.hist&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4354800">func</span>&nbsp;<span class="op" id="4354805">(</span><span class="ident" id="4354806">f</span>&nbsp;<span class="op" id="4354808">*</span><span class="ident" id="4354809">decompressor</span><span class="op" id="4354821">)</span>&nbsp;<span class="ident" id="4354823">copyData</span><span class="op" id="4354831">(</span><span class="op" id="4354832">)</span>&nbsp;<span class="op" id="4354834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354837">n</span>&nbsp;<span class="op" id="4354839">:=</span>&nbsp;<span class="ident" id="4354842">f</span><span class="op" id="4354843">.</span><span class="ident" id="4354844">copyLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4354853">for</span>&nbsp;<span class="ident" id="4354857">n</span>&nbsp;<span class="op" id="4354859">&gt;</span>&nbsp;<span class="num" id="4354861">0</span>&nbsp;<span class="op" id="4354863">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354867">m</span>&nbsp;<span class="op" id="4354869">:=</span>&nbsp;<span class="builtinfunc" id="4354872">len</span><span class="op" id="4354875">(</span><span class="ident" id="4354876">f</span><span class="op" id="4354877">.</span><span class="ident" id="4354878">hist</span><span class="op" id="4354882">)</span>&nbsp;<span class="op" id="4354884">-</span>&nbsp;<span class="ident" id="4354886">f</span><span class="op" id="4354887">.</span><span class="ident" id="4354888">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4354893">if</span>&nbsp;<span class="ident" id="4354896">m</span>&nbsp;<span class="op" id="4354898">&gt;</span>&nbsp;<span class="ident" id="4354900">n</span>&nbsp;<span class="op" id="4354902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354907">m</span>&nbsp;<span class="op" id="4354909">=</span>&nbsp;<span class="ident" id="4354911">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4354915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354919">m</span><span class="op" id="4354920">,</span>&nbsp;<span class="ident" id="4354922">err</span>&nbsp;<span class="op" id="4354926">:=</span>&nbsp;<span class="ident" id="4354929">io</span><span class="op" id="4354931">.</span><span class="ident" id="4354932">ReadFull</span><span class="op" id="4354940">(</span><span class="ident" id="4354941">f</span><span class="op" id="4354942">.</span><span class="ident" id="4354943">r</span><span class="op" id="4354944">,</span>&nbsp;<span class="ident" id="4354946">f</span><span class="op" id="4354947">.</span><span class="ident" id="4354948">hist</span><span class="op" id="4354952">[</span><span class="ident" id="4354953">f</span><span class="op" id="4354954">.</span><span class="ident" id="4354955">hp</span><span class="op" id="4354957">:</span><span class="ident" id="4354958">f</span><span class="op" id="4354959">.</span><span class="ident" id="4354960">hp</span><span class="op" id="4354962">+</span><span class="ident" id="4354963">m</span><span class="op" id="4354964">]</span><span class="op" id="4354965">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4354969">f</span><span class="op" id="4354970">.</span><span class="ident" id="4354971">roffset</span>&nbsp;<span class="op" id="4354979">+=</span>&nbsp;<span class="ident" id="4354982">int64</span><span class="op" id="4354987">(</span><span class="ident" id="4354988">m</span><span class="op" id="4354989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4354993">if</span>&nbsp;<span class="ident" id="4354996">err</span>&nbsp;<span class="op" id="4355000">!=</span>&nbsp;<span class="ident" id="4355003">nil</span>&nbsp;<span class="op" id="4355007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355012">f</span><span class="op" id="4355013">.</span><span class="ident" id="4355014">err</span>&nbsp;<span class="op" id="4355018">=</span>&nbsp;<span class="op" id="4355020">&amp;</span><span class="ident" id="4355021">ReadError</span><span class="op" id="4355030">{</span><span class="ident" id="4355031">f</span><span class="op" id="4355032">.</span><span class="ident" id="4355033">roffset</span><span class="op" id="4355040">,</span>&nbsp;<span class="ident" id="4355042">err</span><span class="op" id="4355045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4355050">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4355059">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355063">n</span>&nbsp;<span class="op" id="4355065">-=</span>&nbsp;<span class="ident" id="4355068">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355072">f</span><span class="op" id="4355073">.</span><span class="ident" id="4355074">hp</span>&nbsp;<span class="op" id="4355077">+=</span>&nbsp;<span class="ident" id="4355080">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4355084">if</span>&nbsp;<span class="ident" id="4355087">f</span><span class="op" id="4355088">.</span><span class="ident" id="4355089">hp</span>&nbsp;<span class="op" id="4355092">==</span>&nbsp;<span class="builtinfunc" id="4355095">len</span><span class="op" id="4355098">(</span><span class="ident" id="4355099">f</span><span class="op" id="4355100">.</span><span class="ident" id="4355101">hist</span><span class="op" id="4355105">)</span>&nbsp;<span class="op" id="4355107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355112">f</span><span class="op" id="4355113">.</span><span class="ident" id="4355114">copyLen</span>&nbsp;<span class="op" id="4355122">=</span>&nbsp;<span class="ident" id="4355124">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355129">f</span><span class="op" id="4355130">.</span><span class="ident" id="4355131">flush</span><span class="op" id="4355136">(</span><span class="op" id="4355137">(</span><span class="op" id="4355138">*</span><span class="ident" id="4355139">decompressor</span><span class="op" id="4355151">)</span><span class="op" id="4355152">.</span><span class="ident" id="4355153">copyData</span><span class="op" id="4355161">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4355166">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4355175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4355178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355181">f</span><span class="op" id="4355182">.</span><span class="ident" id="4355183">step</span>&nbsp;<span class="op" id="4355188">=</span>&nbsp;<span class="op" id="4355190">(</span><span class="op" id="4355191">*</span><span class="ident" id="4355192">decompressor</span><span class="op" id="4355204">)</span><span class="op" id="4355205">.</span><span class="ident" id="4355206">nextBlock</span><br>
<span class="lineno"></span><span class="op" id="4355216">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="4355219">func</span>&nbsp;<span class="op" id="4355224">(</span><span class="ident" id="4355225">f</span>&nbsp;<span class="op" id="4355227">*</span><span class="ident" id="4355228">decompressor</span><span class="op" id="4355240">)</span>&nbsp;<span class="ident" id="4355242">setDict</span><span class="op" id="4355249">(</span><span class="ident" id="4355250">dict</span>&nbsp;<span class="op" id="4355255">[</span><span class="op" id="4355256">]</span><span class="builtintype" id="4355257">byte</span><span class="op" id="4355261">)</span>&nbsp;<span class="op" id="4355263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4355266">if</span>&nbsp;<span class="builtinfunc" id="4355269">len</span><span class="op" id="4355272">(</span><span class="ident" id="4355273">dict</span><span class="op" id="4355277">)</span>&nbsp;<span class="op" id="4355279">&gt;</span>&nbsp;<span class="builtinfunc" id="4355281">len</span><span class="op" id="4355284">(</span><span class="ident" id="4355285">f</span><span class="op" id="4355286">.</span><span class="ident" id="4355287">hist</span><span class="op" id="4355291">)</span>&nbsp;<span class="op" id="4355293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4355297">//&nbsp;Will&nbsp;only&nbsp;remember&nbsp;the&nbsp;tail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355331">dict</span>&nbsp;<span class="op" id="4355336">=</span>&nbsp;<span class="ident" id="4355338">dict</span><span class="op" id="4355342">[</span><span class="builtinfunc" id="4355343">len</span><span class="op" id="4355346">(</span><span class="ident" id="4355347">dict</span><span class="op" id="4355351">)</span><span class="op" id="4355352">-</span><span class="builtinfunc" id="4355353">len</span><span class="op" id="4355356">(</span><span class="ident" id="4355357">f</span><span class="op" id="4355358">.</span><span class="ident" id="4355359">hist</span><span class="op" id="4355363">)</span><span class="op" id="4355364">:</span><span class="op" id="4355365">]</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4355368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355372">f</span><span class="op" id="4355373">.</span><span class="ident" id="4355374">hp</span>&nbsp;<span class="op" id="4355377">=</span>&nbsp;<span class="builtinfunc" id="4355379">copy</span><span class="op" id="4355383">(</span><span class="ident" id="4355384">f</span><span class="op" id="4355385">.</span><span class="ident" id="4355386">hist</span><span class="op" id="4355390">[</span><span class="op" id="4355391">:</span><span class="op" id="4355392">]</span><span class="op" id="4355393">,</span>&nbsp;<span class="ident" id="4355395">dict</span><span class="op" id="4355399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4355402">if</span>&nbsp;<span class="ident" id="4355405">f</span><span class="op" id="4355406">.</span><span class="ident" id="4355407">hp</span>&nbsp;<span class="op" id="4355410">==</span>&nbsp;<span class="builtinfunc" id="4355413">len</span><span class="op" id="4355416">(</span><span class="ident" id="4355417">f</span><span class="op" id="4355418">.</span><span class="ident" id="4355419">hist</span><span class="op" id="4355423">)</span>&nbsp;<span class="op" id="4355425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355429">f</span><span class="op" id="4355430">.</span><span class="ident" id="4355431">hp</span>&nbsp;<span class="op" id="4355434">=</span>&nbsp;<span class="num" id="4355436">0</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355440">f</span><span class="op" id="4355441">.</span><span class="ident" id="4355442">hfull</span>&nbsp;<span class="op" id="4355448">=</span>&nbsp;<span class="ident" id="4355450">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4355456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355459">f</span><span class="op" id="4355460">.</span><span class="ident" id="4355461">hw</span>&nbsp;<span class="op" id="4355464">=</span>&nbsp;<span class="ident" id="4355466">f</span><span class="op" id="4355467">.</span><span class="ident" id="4355468">hp</span><br>
<span class="lineno"></span><span class="op" id="4355471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="keyword" id="4355474">func</span>&nbsp;<span class="op" id="4355479">(</span><span class="ident" id="4355480">f</span>&nbsp;<span class="op" id="4355482">*</span><span class="ident" id="4355483">decompressor</span><span class="op" id="4355495">)</span>&nbsp;<span class="ident" id="4355497">moreBits</span><span class="op" id="4355505">(</span><span class="op" id="4355506">)</span>&nbsp;<span class="builtintype" id="4355508">error</span>&nbsp;<span class="op" id="4355514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355517">c</span><span class="op" id="4355518">,</span>&nbsp;<span class="ident" id="4355520">err</span>&nbsp;<span class="op" id="4355524">:=</span>&nbsp;<span class="ident" id="4355527">f</span><span class="op" id="4355528">.</span><span class="ident" id="4355529">r</span><span class="op" id="4355530">.</span><span class="ident" id="4355531">ReadByte</span><span class="op" id="4355539">(</span><span class="op" id="4355540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4355543">if</span>&nbsp;<span class="ident" id="4355546">err</span>&nbsp;<span class="op" id="4355550">!=</span>&nbsp;<span class="ident" id="4355553">nil</span>&nbsp;<span class="op" id="4355557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4355561">if</span>&nbsp;<span class="ident" id="4355564">err</span>&nbsp;<span class="op" id="4355568">==</span>&nbsp;<span class="ident" id="4355571">io</span><span class="op" id="4355573">.</span><span class="ident" id="4355574">EOF</span>&nbsp;<span class="op" id="4355578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355583">err</span>&nbsp;<span class="op" id="4355587">=</span>&nbsp;<span class="ident" id="4355589">io</span><span class="op" id="4355591">.</span><span class="ident" id="4355592">ErrUnexpectedEOF</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4355611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4355615">return</span>&nbsp;<span class="ident" id="4355622">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4355627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355630">f</span><span class="op" id="4355631">.</span><span class="ident" id="4355632">roffset</span><span class="op" id="4355639">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355643">f</span><span class="op" id="4355644">.</span><span class="ident" id="4355645">b</span>&nbsp;<span class="op" id="4355647">|=</span>&nbsp;<span class="builtintype" id="4355650">uint32</span><span class="op" id="4355656">(</span><span class="ident" id="4355657">c</span><span class="op" id="4355658">)</span>&nbsp;<span class="op" id="4355660">&lt;&lt;</span>&nbsp;<span class="ident" id="4355663">f</span><span class="op" id="4355664">.</span><span class="ident" id="4355665">nb</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355669">f</span><span class="op" id="4355670">.</span><span class="ident" id="4355671">nb</span>&nbsp;<span class="op" id="4355674">+=</span>&nbsp;<span class="num" id="4355677">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4355680">return</span>&nbsp;<span class="ident" id="4355687">nil</span><br>
<span class="lineno"></span><span class="op" id="4355691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4355694">//&nbsp;Read&nbsp;the&nbsp;next&nbsp;Huffman-encoded&nbsp;symbol&nbsp;from&nbsp;f&nbsp;according&nbsp;to&nbsp;h.</span><br>
<span class="lineno">645</span><span class="keyword" id="4355757">func</span>&nbsp;<span class="op" id="4355762">(</span><span class="ident" id="4355763">f</span>&nbsp;<span class="op" id="4355765">*</span><span class="ident" id="4355766">decompressor</span><span class="op" id="4355778">)</span>&nbsp;<span class="ident" id="4355780">huffSym</span><span class="op" id="4355787">(</span><span class="ident" id="4355788">h</span>&nbsp;<span class="op" id="4355790">*</span><span class="ident" id="4355791">huffmanDecoder</span><span class="op" id="4355805">)</span>&nbsp;<span class="op" id="4355807">(</span><span class="builtintype" id="4355808">int</span><span class="op" id="4355811">,</span>&nbsp;<span class="builtintype" id="4355813">error</span><span class="op" id="4355818">)</span>&nbsp;<span class="op" id="4355820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355823">n</span>&nbsp;<span class="op" id="4355825">:=</span>&nbsp;<span class="builtintype" id="4355828">uint</span><span class="op" id="4355832">(</span><span class="ident" id="4355833">h</span><span class="op" id="4355834">.</span><span class="ident" id="4355835">min</span><span class="op" id="4355838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4355841">for</span>&nbsp;<span class="op" id="4355845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4355849">for</span>&nbsp;<span class="ident" id="4355853">f</span><span class="op" id="4355854">.</span><span class="ident" id="4355855">nb</span>&nbsp;<span class="op" id="4355858">&lt;</span>&nbsp;<span class="ident" id="4355860">n</span>&nbsp;<span class="op" id="4355862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4355867">if</span>&nbsp;<span class="ident" id="4355870">err</span>&nbsp;<span class="op" id="4355874">:=</span>&nbsp;<span class="ident" id="4355877">f</span><span class="op" id="4355878">.</span><span class="ident" id="4355879">moreBits</span><span class="op" id="4355887">(</span><span class="op" id="4355888">)</span><span class="op" id="4355889">;</span>&nbsp;<span class="ident" id="4355891">err</span>&nbsp;<span class="op" id="4355895">!=</span>&nbsp;<span class="ident" id="4355898">nil</span>&nbsp;<span class="op" id="4355902">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4355908">return</span>&nbsp;<span class="num" id="4355915">0</span><span class="op" id="4355916">,</span>&nbsp;<span class="ident" id="4355918">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4355925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4355929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355933">chunk</span>&nbsp;<span class="op" id="4355939">:=</span>&nbsp;<span class="ident" id="4355942">h</span><span class="op" id="4355943">.</span><span class="ident" id="4355944">chunks</span><span class="op" id="4355950">[</span><span class="ident" id="4355951">f</span><span class="op" id="4355952">.</span><span class="ident" id="4355953">b</span><span class="op" id="4355954">&amp;</span><span class="op" id="4355955">(</span><span class="ident" id="4355956">huffmanNumChunks</span><span class="op" id="4355972">-</span><span class="num" id="4355973">1</span><span class="op" id="4355974">)</span><span class="op" id="4355975">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355979">n</span>&nbsp;<span class="op" id="4355981">=</span>&nbsp;<span class="builtintype" id="4355983">uint</span><span class="op" id="4355987">(</span><span class="ident" id="4355988">chunk</span>&nbsp;<span class="op" id="4355994">&amp;</span>&nbsp;<span class="ident" id="4355996">huffmanCountMask</span><span class="op" id="4356012">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4356016">if</span>&nbsp;<span class="ident" id="4356019">n</span>&nbsp;<span class="op" id="4356021">&gt;</span>&nbsp;<span class="ident" id="4356023">huffmanChunkBits</span>&nbsp;<span class="op" id="4356040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356045">chunk</span>&nbsp;<span class="op" id="4356051">=</span>&nbsp;<span class="ident" id="4356053">h</span><span class="op" id="4356054">.</span><span class="ident" id="4356055">links</span><span class="op" id="4356060">[</span><span class="ident" id="4356061">chunk</span><span class="op" id="4356066">&gt;&gt;</span><span class="ident" id="4356068">huffmanValueShift</span><span class="op" id="4356085">]</span><span class="op" id="4356086">[</span><span class="op" id="4356087">(</span><span class="ident" id="4356088">f</span><span class="op" id="4356089">.</span><span class="ident" id="4356090">b</span><span class="op" id="4356091">&gt;&gt;</span><span class="ident" id="4356093">huffmanChunkBits</span><span class="op" id="4356109">)</span><span class="op" id="4356110">&amp;</span><span class="ident" id="4356111">h</span><span class="op" id="4356112">.</span><span class="ident" id="4356113">linkMask</span><span class="op" id="4356121">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356126">n</span>&nbsp;<span class="op" id="4356128">=</span>&nbsp;<span class="builtintype" id="4356130">uint</span><span class="op" id="4356134">(</span><span class="ident" id="4356135">chunk</span>&nbsp;<span class="op" id="4356141">&amp;</span>&nbsp;<span class="ident" id="4356143">huffmanCountMask</span><span class="op" id="4356159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4356164">if</span>&nbsp;<span class="ident" id="4356167">n</span>&nbsp;<span class="op" id="4356169">==</span>&nbsp;<span class="num" id="4356172">0</span>&nbsp;<span class="op" id="4356174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356180">f</span><span class="op" id="4356181">.</span><span class="ident" id="4356182">err</span>&nbsp;<span class="op" id="4356186">=</span>&nbsp;<span class="ident" id="4356188">CorruptInputError</span><span class="op" id="4356205">(</span><span class="ident" id="4356206">f</span><span class="op" id="4356207">.</span><span class="ident" id="4356208">roffset</span><span class="op" id="4356215">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4356221">return</span>&nbsp;<span class="num" id="4356228">0</span><span class="op" id="4356229">,</span>&nbsp;<span class="ident" id="4356231">f</span><span class="op" id="4356232">.</span><span class="ident" id="4356233">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4356240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4356244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4356248">if</span>&nbsp;<span class="ident" id="4356251">n</span>&nbsp;<span class="op" id="4356253">&lt;=</span>&nbsp;<span class="ident" id="4356256">f</span><span class="op" id="4356257">.</span><span class="ident" id="4356258">nb</span>&nbsp;<span class="op" id="4356261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356266">f</span><span class="op" id="4356267">.</span><span class="ident" id="4356268">b</span>&nbsp;<span class="op" id="4356270">&gt;&gt;=</span>&nbsp;<span class="ident" id="4356274">n</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356279">f</span><span class="op" id="4356280">.</span><span class="ident" id="4356281">nb</span>&nbsp;<span class="op" id="4356284">-=</span>&nbsp;<span class="ident" id="4356287">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4356292">return</span>&nbsp;<span class="builtintype" id="4356299">int</span><span class="op" id="4356302">(</span><span class="ident" id="4356303">chunk</span>&nbsp;<span class="op" id="4356309">&gt;&gt;</span>&nbsp;<span class="ident" id="4356312">huffmanValueShift</span><span class="op" id="4356329">)</span><span class="op" id="4356330">,</span>&nbsp;<span class="ident" id="4356332">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4356338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4356341">}</span><br>
<span class="lineno"></span><span class="op" id="4356343">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="4356346">//&nbsp;Flush&nbsp;any&nbsp;buffered&nbsp;output&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4356401">func</span>&nbsp;<span class="op" id="4356406">(</span><span class="ident" id="4356407">f</span>&nbsp;<span class="op" id="4356409">*</span><span class="ident" id="4356410">decompressor</span><span class="op" id="4356422">)</span>&nbsp;<span class="ident" id="4356424">flush</span><span class="op" id="4356429">(</span><span class="ident" id="4356430">step</span>&nbsp;<span class="keyword" id="4356435">func</span><span class="op" id="4356439">(</span><span class="op" id="4356440">*</span><span class="ident" id="4356441">decompressor</span><span class="op" id="4356453">)</span><span class="op" id="4356454">)</span>&nbsp;<span class="op" id="4356456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356459">f</span><span class="op" id="4356460">.</span><span class="ident" id="4356461">toRead</span>&nbsp;<span class="op" id="4356468">=</span>&nbsp;<span class="ident" id="4356470">f</span><span class="op" id="4356471">.</span><span class="ident" id="4356472">hist</span><span class="op" id="4356476">[</span><span class="ident" id="4356477">f</span><span class="op" id="4356478">.</span><span class="ident" id="4356479">hw</span><span class="op" id="4356481">:</span><span class="ident" id="4356482">f</span><span class="op" id="4356483">.</span><span class="ident" id="4356484">hp</span><span class="op" id="4356486">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356489">f</span><span class="op" id="4356490">.</span><span class="ident" id="4356491">woffset</span>&nbsp;<span class="op" id="4356499">+=</span>&nbsp;<span class="ident" id="4356502">int64</span><span class="op" id="4356507">(</span><span class="ident" id="4356508">f</span><span class="op" id="4356509">.</span><span class="ident" id="4356510">hp</span>&nbsp;<span class="op" id="4356513">-</span>&nbsp;<span class="ident" id="4356515">f</span><span class="op" id="4356516">.</span><span class="ident" id="4356517">hw</span><span class="op" id="4356519">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356522">f</span><span class="op" id="4356523">.</span><span class="ident" id="4356524">hw</span>&nbsp;<span class="op" id="4356527">=</span>&nbsp;<span class="ident" id="4356529">f</span><span class="op" id="4356530">.</span><span class="ident" id="4356531">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4356535">if</span>&nbsp;<span class="ident" id="4356538">f</span><span class="op" id="4356539">.</span><span class="ident" id="4356540">hp</span>&nbsp;<span class="op" id="4356543">==</span>&nbsp;<span class="builtinfunc" id="4356546">len</span><span class="op" id="4356549">(</span><span class="ident" id="4356550">f</span><span class="op" id="4356551">.</span><span class="ident" id="4356552">hist</span><span class="op" id="4356556">)</span>&nbsp;<span class="op" id="4356558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356562">f</span><span class="op" id="4356563">.</span><span class="ident" id="4356564">hp</span>&nbsp;<span class="op" id="4356567">=</span>&nbsp;<span class="num" id="4356569">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356573">f</span><span class="op" id="4356574">.</span><span class="ident" id="4356575">hw</span>&nbsp;<span class="op" id="4356578">=</span>&nbsp;<span class="num" id="4356580">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356584">f</span><span class="op" id="4356585">.</span><span class="ident" id="4356586">hfull</span>&nbsp;<span class="op" id="4356592">=</span>&nbsp;<span class="ident" id="4356594">true</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4356600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356603">f</span><span class="op" id="4356604">.</span><span class="ident" id="4356605">step</span>&nbsp;<span class="op" id="4356610">=</span>&nbsp;<span class="ident" id="4356612">step</span><br>
<span class="lineno"></span><span class="op" id="4356617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4356620">func</span>&nbsp;<span class="ident" id="4356625">makeReader</span><span class="op" id="4356635">(</span><span class="ident" id="4356636">r</span>&nbsp;<span class="ident" id="4356638">io</span><span class="op" id="4356640">.</span><span class="ident" id="4356641">Reader</span><span class="op" id="4356647">)</span>&nbsp;<span class="ident" id="4356649">Reader</span>&nbsp;<span class="op" id="4356656">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4356659">if</span>&nbsp;<span class="ident" id="4356662">rr</span><span class="op" id="4356664">,</span>&nbsp;<span class="ident" id="4356666">ok</span>&nbsp;<span class="op" id="4356669">:=</span>&nbsp;<span class="ident" id="4356672">r</span><span class="op" id="4356673">.</span><span class="op" id="4356674">(</span><span class="ident" id="4356675">Reader</span><span class="op" id="4356681">)</span><span class="op" id="4356682">;</span>&nbsp;<span class="ident" id="4356684">ok</span>&nbsp;<span class="op" id="4356687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4356691">return</span>&nbsp;<span class="ident" id="4356698">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4356702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4356705">return</span>&nbsp;<span class="ident" id="4356712">bufio</span><span class="op" id="4356717">.</span><span class="ident" id="4356718">NewReader</span><span class="op" id="4356727">(</span><span class="ident" id="4356728">r</span><span class="op" id="4356729">)</span><br>
<span class="lineno"></span><span class="op" id="4356731">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="4356734">func</span>&nbsp;<span class="op" id="4356739">(</span><span class="ident" id="4356740">f</span>&nbsp;<span class="op" id="4356742">*</span><span class="ident" id="4356743">decompressor</span><span class="op" id="4356755">)</span>&nbsp;<span class="ident" id="4356757">Reset</span><span class="op" id="4356762">(</span><span class="ident" id="4356763">r</span>&nbsp;<span class="ident" id="4356765">io</span><span class="op" id="4356767">.</span><span class="ident" id="4356768">Reader</span><span class="op" id="4356774">,</span>&nbsp;<span class="ident" id="4356776">dict</span>&nbsp;<span class="op" id="4356781">[</span><span class="op" id="4356782">]</span><span class="builtintype" id="4356783">byte</span><span class="op" id="4356787">)</span>&nbsp;<span class="builtintype" id="4356789">error</span>&nbsp;<span class="op" id="4356795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4356798">*</span><span class="ident" id="4356799">f</span>&nbsp;<span class="op" id="4356801">=</span>&nbsp;<span class="ident" id="4356803">decompressor</span><span class="op" id="4356815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356819">r</span><span class="op" id="4356820">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356829">makeReader</span><span class="op" id="4356839">(</span><span class="ident" id="4356840">r</span><span class="op" id="4356841">)</span><span class="op" id="4356842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356846">bits</span><span class="op" id="4356850">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356856">f</span><span class="op" id="4356857">.</span><span class="ident" id="4356858">bits</span><span class="op" id="4356862">,</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356866">codebits</span><span class="op" id="4356874">:</span>&nbsp;<span class="ident" id="4356876">f</span><span class="op" id="4356877">.</span><span class="ident" id="4356878">codebits</span><span class="op" id="4356886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356890">hist</span><span class="op" id="4356894">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356900">f</span><span class="op" id="4356901">.</span><span class="ident" id="4356902">hist</span><span class="op" id="4356906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356910">step</span><span class="op" id="4356914">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356920">(</span><span class="op" id="4356921">*</span><span class="ident" id="4356922">decompressor</span><span class="op" id="4356934">)</span><span class="op" id="4356935">.</span><span class="ident" id="4356936">nextBlock</span><span class="op" id="4356945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4356948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4356951">if</span>&nbsp;<span class="ident" id="4356954">dict</span>&nbsp;<span class="op" id="4356959">!=</span>&nbsp;<span class="ident" id="4356962">nil</span>&nbsp;<span class="op" id="4356966">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356970">f</span><span class="op" id="4356971">.</span><span class="ident" id="4356972">setDict</span><span class="op" id="4356979">(</span><span class="ident" id="4356980">dict</span><span class="op" id="4356984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4356987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4356990">return</span>&nbsp;<span class="ident" id="4356997">nil</span><br>
<span class="lineno"></span><span class="op" id="4357001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="4357004">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;ReadCloser&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4357059">//&nbsp;to&nbsp;read&nbsp;the&nbsp;uncompressed&nbsp;version&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4357101">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4357148">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4357210">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser</span><br>
<span class="lineno">710</span><span class="comment" id="4357279">//&nbsp;when&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="4357305">//</span><br>
<span class="lineno"></span><span class="comment" id="4357308">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno"></span><span class="keyword" id="4357374">func</span>&nbsp;<span class="ident" id="4357379">NewReader</span><span class="op" id="4357388">(</span><span class="ident" id="4357389">r</span>&nbsp;<span class="ident" id="4357391">io</span><span class="op" id="4357393">.</span><span class="ident" id="4357394">Reader</span><span class="op" id="4357400">)</span>&nbsp;<span class="ident" id="4357402">io</span><span class="op" id="4357404">.</span><span class="ident" id="4357405">ReadCloser</span>&nbsp;<span class="op" id="4357416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4357419">var</span>&nbsp;<span class="ident" id="4357423">f</span>&nbsp;<span class="ident" id="4357425">decompressor</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357439">f</span><span class="op" id="4357440">.</span><span class="ident" id="4357441">bits</span>&nbsp;<span class="op" id="4357446">=</span>&nbsp;<span class="builtinfunc" id="4357448">new</span><span class="op" id="4357451">(</span><span class="op" id="4357452">[</span><span class="ident" id="4357453">maxLit</span>&nbsp;<span class="op" id="4357460">+</span>&nbsp;<span class="ident" id="4357462">maxDist</span><span class="op" id="4357469">]</span><span class="builtintype" id="4357470">int</span><span class="op" id="4357473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357476">f</span><span class="op" id="4357477">.</span><span class="ident" id="4357478">codebits</span>&nbsp;<span class="op" id="4357487">=</span>&nbsp;<span class="builtinfunc" id="4357489">new</span><span class="op" id="4357492">(</span><span class="op" id="4357493">[</span><span class="ident" id="4357494">numCodes</span><span class="op" id="4357502">]</span><span class="builtintype" id="4357503">int</span><span class="op" id="4357506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357509">f</span><span class="op" id="4357510">.</span><span class="ident" id="4357511">r</span>&nbsp;<span class="op" id="4357513">=</span>&nbsp;<span class="ident" id="4357515">makeReader</span><span class="op" id="4357525">(</span><span class="ident" id="4357526">r</span><span class="op" id="4357527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357530">f</span><span class="op" id="4357531">.</span><span class="ident" id="4357532">hist</span>&nbsp;<span class="op" id="4357537">=</span>&nbsp;<span class="builtinfunc" id="4357539">new</span><span class="op" id="4357542">(</span><span class="op" id="4357543">[</span><span class="ident" id="4357544">maxHist</span><span class="op" id="4357551">]</span><span class="builtintype" id="4357552">byte</span><span class="op" id="4357556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357559">f</span><span class="op" id="4357560">.</span><span class="ident" id="4357561">step</span>&nbsp;<span class="op" id="4357566">=</span>&nbsp;<span class="op" id="4357568">(</span><span class="op" id="4357569">*</span><span class="ident" id="4357570">decompressor</span><span class="op" id="4357582">)</span><span class="op" id="4357583">.</span><span class="ident" id="4357584">nextBlock</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4357595">return</span>&nbsp;<span class="op" id="4357602">&amp;</span><span class="ident" id="4357603">f</span><br>
<span class="lineno"></span><span class="op" id="4357605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4357608">//&nbsp;NewReaderDict&nbsp;is&nbsp;like&nbsp;NewReader&nbsp;but&nbsp;initializes&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="4357670">//&nbsp;with&nbsp;a&nbsp;preset&nbsp;dictionary.&nbsp;&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;behaves&nbsp;as&nbsp;if</span><br>
<span class="lineno">725</span><span class="comment" id="4357734">//&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;stream&nbsp;started&nbsp;with&nbsp;the&nbsp;given&nbsp;dictionary,</span><br>
<span class="lineno"></span><span class="comment" id="4357801">//&nbsp;which&nbsp;has&nbsp;already&nbsp;been&nbsp;read.&nbsp;&nbsp;NewReaderDict&nbsp;is&nbsp;typically&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4357866">//&nbsp;to&nbsp;read&nbsp;data&nbsp;compressed&nbsp;by&nbsp;NewWriterDict.</span><br>
<span class="lineno"></span><span class="comment" id="4357911">//</span><br>
<span class="lineno"></span><span class="comment" id="4357914">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno">730</span><span class="keyword" id="4357980">func</span>&nbsp;<span class="ident" id="4357985">NewReaderDict</span><span class="op" id="4357998">(</span><span class="ident" id="4357999">r</span>&nbsp;<span class="ident" id="4358001">io</span><span class="op" id="4358003">.</span><span class="ident" id="4358004">Reader</span><span class="op" id="4358010">,</span>&nbsp;<span class="ident" id="4358012">dict</span>&nbsp;<span class="op" id="4358017">[</span><span class="op" id="4358018">]</span><span class="builtintype" id="4358019">byte</span><span class="op" id="4358023">)</span>&nbsp;<span class="ident" id="4358025">io</span><span class="op" id="4358027">.</span><span class="ident" id="4358028">ReadCloser</span>&nbsp;<span class="op" id="4358039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4358042">var</span>&nbsp;<span class="ident" id="4358046">f</span>&nbsp;<span class="ident" id="4358048">decompressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358062">f</span><span class="op" id="4358063">.</span><span class="ident" id="4358064">r</span>&nbsp;<span class="op" id="4358066">=</span>&nbsp;<span class="ident" id="4358068">makeReader</span><span class="op" id="4358078">(</span><span class="ident" id="4358079">r</span><span class="op" id="4358080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358083">f</span><span class="op" id="4358084">.</span><span class="ident" id="4358085">hist</span>&nbsp;<span class="op" id="4358090">=</span>&nbsp;<span class="builtinfunc" id="4358092">new</span><span class="op" id="4358095">(</span><span class="op" id="4358096">[</span><span class="ident" id="4358097">maxHist</span><span class="op" id="4358104">]</span><span class="builtintype" id="4358105">byte</span><span class="op" id="4358109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358112">f</span><span class="op" id="4358113">.</span><span class="ident" id="4358114">bits</span>&nbsp;<span class="op" id="4358119">=</span>&nbsp;<span class="builtinfunc" id="4358121">new</span><span class="op" id="4358124">(</span><span class="op" id="4358125">[</span><span class="ident" id="4358126">maxLit</span>&nbsp;<span class="op" id="4358133">+</span>&nbsp;<span class="ident" id="4358135">maxDist</span><span class="op" id="4358142">]</span><span class="builtintype" id="4358143">int</span><span class="op" id="4358146">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358149">f</span><span class="op" id="4358150">.</span><span class="ident" id="4358151">codebits</span>&nbsp;<span class="op" id="4358160">=</span>&nbsp;<span class="builtinfunc" id="4358162">new</span><span class="op" id="4358165">(</span><span class="op" id="4358166">[</span><span class="ident" id="4358167">numCodes</span><span class="op" id="4358175">]</span><span class="builtintype" id="4358176">int</span><span class="op" id="4358179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358182">f</span><span class="op" id="4358183">.</span><span class="ident" id="4358184">step</span>&nbsp;<span class="op" id="4358189">=</span>&nbsp;<span class="op" id="4358191">(</span><span class="op" id="4358192">*</span><span class="ident" id="4358193">decompressor</span><span class="op" id="4358205">)</span><span class="op" id="4358206">.</span><span class="ident" id="4358207">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358218">f</span><span class="op" id="4358219">.</span><span class="ident" id="4358220">setDict</span><span class="op" id="4358227">(</span><span class="ident" id="4358228">dict</span><span class="op" id="4358232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4358235">return</span>&nbsp;<span class="op" id="4358242">&amp;</span><span class="ident" id="4358243">f</span><br>
<span class="lineno"></span><span class="op" id="4358245">}</span>
</div>
</body>
</html>
