<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html" class="current">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3816225">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3816280">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3816334">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3816385">package</span>&nbsp;<span class="ident" id="3816393">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3816399">import</span>&nbsp;<span class="op" id="3816406">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816409">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816416">&#34;net&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816423">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816434">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816445">&#34;time&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816453">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3816468">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3816471">type</span>&nbsp;<span class="ident" id="3816476">InvalidReason</span>&nbsp;<span class="builtintype" id="3816490">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3816495">const</span>&nbsp;<span class="op" id="3816501">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3816504">//&nbsp;NotAuthorizedToSign&nbsp;results&nbsp;when&nbsp;a&nbsp;certificate&nbsp;is&nbsp;signed&nbsp;by&nbsp;another</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3816576">//&nbsp;which&nbsp;isn&#39;t&nbsp;marked&nbsp;as&nbsp;a&nbsp;CA&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3816620">NotAuthorizedToSign</span>&nbsp;<span class="ident" id="3816640">InvalidReason</span>&nbsp;<span class="op" id="3816654">=</span>&nbsp;<span class="ident" id="3816656">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3816662">//&nbsp;Expired&nbsp;results&nbsp;when&nbsp;a&nbsp;certificate&nbsp;has&nbsp;expired,&nbsp;based&nbsp;on&nbsp;the&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3816732">//&nbsp;given&nbsp;in&nbsp;the&nbsp;VerifyOptions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3816764">Expired</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3816773">//&nbsp;CANotAuthorizedForThisName&nbsp;results&nbsp;when&nbsp;an&nbsp;intermediate&nbsp;or&nbsp;root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3816841">//&nbsp;certificate&nbsp;has&nbsp;a&nbsp;name&nbsp;constraint&nbsp;which&nbsp;doesn&#39;t&nbsp;include&nbsp;the&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3816910">//&nbsp;being&nbsp;checked.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3816929">CANotAuthorizedForThisName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3816957">//&nbsp;TooManyIntermediates&nbsp;results&nbsp;when&nbsp;a&nbsp;path&nbsp;length&nbsp;constraint&nbsp;is</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817023">//&nbsp;violated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817037">TooManyIntermediates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817059">//&nbsp;IncompatibleUsage&nbsp;results&nbsp;when&nbsp;the&nbsp;certificate&#39;s&nbsp;key&nbsp;usage&nbsp;indicates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817132">//&nbsp;that&nbsp;it&nbsp;may&nbsp;only&nbsp;be&nbsp;used&nbsp;for&nbsp;a&nbsp;different&nbsp;purpose.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817186">IncompatibleUsage</span><br>
<span class="lineno">35</span><span class="op" id="3817204">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3817207">//&nbsp;CertificateInvalidError&nbsp;results&nbsp;when&nbsp;an&nbsp;odd&nbsp;error&nbsp;occurs.&nbsp;Users&nbsp;of&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="3817282">//&nbsp;library&nbsp;probably&nbsp;want&nbsp;to&nbsp;handle&nbsp;all&nbsp;these&nbsp;errors&nbsp;uniformly.</span><br>
<span class="lineno"></span><span class="keyword" id="3817345">type</span>&nbsp;<span class="ident" id="3817350">CertificateInvalidError</span>&nbsp;<span class="keyword" id="3817374">struct</span>&nbsp;<span class="op" id="3817381">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817384">Cert</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3817391">*</span><span class="ident" id="3817392">Certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817405">Reason</span>&nbsp;<span class="ident" id="3817412">InvalidReason</span><br>
<span class="lineno"></span><span class="op" id="3817426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3817429">func</span>&nbsp;<span class="op" id="3817434">(</span><span class="ident" id="3817435">e</span>&nbsp;<span class="ident" id="3817437">CertificateInvalidError</span><span class="op" id="3817460">)</span>&nbsp;<span class="ident" id="3817462">Error</span><span class="op" id="3817467">(</span><span class="op" id="3817468">)</span>&nbsp;<span class="builtintype" id="3817470">string</span>&nbsp;<span class="op" id="3817477">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817480">switch</span>&nbsp;<span class="ident" id="3817487">e</span><span class="op" id="3817488">.</span><span class="ident" id="3817489">Reason</span>&nbsp;<span class="op" id="3817496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817499">case</span>&nbsp;<span class="ident" id="3817504">NotAuthorizedToSign</span><span class="op" id="3817523">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817527">return</span>&nbsp;<span class="string" id="3817534">&#34;x509:&nbsp;certificate&nbsp;is&nbsp;not&nbsp;authorized&nbsp;to&nbsp;sign&nbsp;other&nbsp;certificates&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817600">case</span>&nbsp;<span class="ident" id="3817605">Expired</span><span class="op" id="3817612">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817616">return</span>&nbsp;<span class="string" id="3817623">&#34;x509:&nbsp;certificate&nbsp;has&nbsp;expired&nbsp;or&nbsp;is&nbsp;not&nbsp;yet&nbsp;valid&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817676">case</span>&nbsp;<span class="ident" id="3817681">CANotAuthorizedForThisName</span><span class="op" id="3817707">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817711">return</span>&nbsp;<span class="string" id="3817718">&#34;x509:&nbsp;a&nbsp;root&nbsp;or&nbsp;intermediate&nbsp;certificate&nbsp;is&nbsp;not&nbsp;authorized&nbsp;to&nbsp;sign&nbsp;in&nbsp;this&nbsp;domain&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817803">case</span>&nbsp;<span class="ident" id="3817808">TooManyIntermediates</span><span class="op" id="3817828">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817832">return</span>&nbsp;<span class="string" id="3817839">&#34;x509:&nbsp;too&nbsp;many&nbsp;intermediates&nbsp;for&nbsp;path&nbsp;length&nbsp;constraint&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817898">case</span>&nbsp;<span class="ident" id="3817903">IncompatibleUsage</span><span class="op" id="3817920">:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817924">return</span>&nbsp;<span class="string" id="3817931">&#34;x509:&nbsp;certificate&nbsp;specifies&nbsp;an&nbsp;incompatible&nbsp;key&nbsp;usage&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3817988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3817991">return</span>&nbsp;<span class="string" id="3817998">&#34;x509:&nbsp;unknown&nbsp;error&#34;</span><br>
<span class="lineno"></span><span class="op" id="3818020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3818023">//&nbsp;HostnameError&nbsp;results&nbsp;when&nbsp;the&nbsp;set&nbsp;of&nbsp;authorized&nbsp;names&nbsp;doesn&#39;t&nbsp;match&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3818099">//&nbsp;requested&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3818118">type</span>&nbsp;<span class="ident" id="3818123">HostnameError</span>&nbsp;<span class="keyword" id="3818137">struct</span>&nbsp;<span class="op" id="3818144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818147">Certificate</span>&nbsp;<span class="op" id="3818159">*</span><span class="ident" id="3818160">Certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818173">Host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3818185">string</span><br>
<span class="lineno">65</span><span class="op" id="3818192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3818195">func</span>&nbsp;<span class="op" id="3818200">(</span><span class="ident" id="3818201">h</span>&nbsp;<span class="ident" id="3818203">HostnameError</span><span class="op" id="3818216">)</span>&nbsp;<span class="ident" id="3818218">Error</span><span class="op" id="3818223">(</span><span class="op" id="3818224">)</span>&nbsp;<span class="builtintype" id="3818226">string</span>&nbsp;<span class="op" id="3818233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818236">c</span>&nbsp;<span class="op" id="3818238">:=</span>&nbsp;<span class="ident" id="3818241">h</span><span class="op" id="3818242">.</span><span class="ident" id="3818243">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3818257">var</span>&nbsp;<span class="ident" id="3818261">valid</span>&nbsp;<span class="builtintype" id="3818267">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3818275">if</span>&nbsp;<span class="ident" id="3818278">ip</span>&nbsp;<span class="op" id="3818281">:=</span>&nbsp;<span class="ident" id="3818284">net</span><span class="op" id="3818287">.</span><span class="ident" id="3818288">ParseIP</span><span class="op" id="3818295">(</span><span class="ident" id="3818296">h</span><span class="op" id="3818297">.</span><span class="ident" id="3818298">Host</span><span class="op" id="3818302">)</span><span class="op" id="3818303">;</span>&nbsp;<span class="ident" id="3818305">ip</span>&nbsp;<span class="op" id="3818308">!=</span>&nbsp;<span class="ident" id="3818311">nil</span>&nbsp;<span class="op" id="3818315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818319">//&nbsp;Trying&nbsp;to&nbsp;validate&nbsp;an&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3818349">if</span>&nbsp;<span class="builtinfunc" id="3818352">len</span><span class="op" id="3818355">(</span><span class="ident" id="3818356">c</span><span class="op" id="3818357">.</span><span class="ident" id="3818358">IPAddresses</span><span class="op" id="3818369">)</span>&nbsp;<span class="op" id="3818371">==</span>&nbsp;<span class="num" id="3818374">0</span>&nbsp;<span class="op" id="3818376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3818381">return</span>&nbsp;<span class="string" id="3818388">&#34;x509:&nbsp;cannot&nbsp;validate&nbsp;certificate&nbsp;for&nbsp;&#34;</span>&nbsp;<span class="op" id="3818429">+</span>&nbsp;<span class="ident" id="3818431">h</span><span class="op" id="3818432">.</span><span class="ident" id="3818433">Host</span>&nbsp;<span class="op" id="3818438">+</span>&nbsp;<span class="string" id="3818440">&#34;&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;contain&nbsp;any&nbsp;IP&nbsp;SANs&#34;</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3818484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3818488">for</span>&nbsp;<span class="ident" id="3818492">_</span><span class="op" id="3818493">,</span>&nbsp;<span class="ident" id="3818495">san</span>&nbsp;<span class="op" id="3818499">:=</span>&nbsp;<span class="keyword" id="3818502">range</span>&nbsp;<span class="ident" id="3818508">c</span><span class="op" id="3818509">.</span><span class="ident" id="3818510">IPAddresses</span>&nbsp;<span class="op" id="3818522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3818527">if</span>&nbsp;<span class="builtinfunc" id="3818530">len</span><span class="op" id="3818533">(</span><span class="ident" id="3818534">valid</span><span class="op" id="3818539">)</span>&nbsp;<span class="op" id="3818541">&gt;</span>&nbsp;<span class="num" id="3818543">0</span>&nbsp;<span class="op" id="3818545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818551">valid</span>&nbsp;<span class="op" id="3818557">+=</span>&nbsp;<span class="string" id="3818560">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3818568">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818573">valid</span>&nbsp;<span class="op" id="3818579">+=</span>&nbsp;<span class="ident" id="3818582">san</span><span class="op" id="3818585">.</span><span class="ident" id="3818586">String</span><span class="op" id="3818592">(</span><span class="op" id="3818593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3818597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3818600">}</span>&nbsp;<span class="keyword" id="3818602">else</span>&nbsp;<span class="op" id="3818607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3818611">if</span>&nbsp;<span class="builtinfunc" id="3818614">len</span><span class="op" id="3818617">(</span><span class="ident" id="3818618">c</span><span class="op" id="3818619">.</span><span class="ident" id="3818620">DNSNames</span><span class="op" id="3818628">)</span>&nbsp;<span class="op" id="3818630">&gt;</span>&nbsp;<span class="num" id="3818632">0</span>&nbsp;<span class="op" id="3818634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818639">valid</span>&nbsp;<span class="op" id="3818645">=</span>&nbsp;<span class="ident" id="3818647">strings</span><span class="op" id="3818654">.</span><span class="ident" id="3818655">Join</span><span class="op" id="3818659">(</span><span class="ident" id="3818660">c</span><span class="op" id="3818661">.</span><span class="ident" id="3818662">DNSNames</span><span class="op" id="3818670">,</span>&nbsp;<span class="string" id="3818672">&#34;,&nbsp;&#34;</span><span class="op" id="3818676">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3818680">}</span>&nbsp;<span class="keyword" id="3818682">else</span>&nbsp;<span class="op" id="3818687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818692">valid</span>&nbsp;<span class="op" id="3818698">=</span>&nbsp;<span class="ident" id="3818700">c</span><span class="op" id="3818701">.</span><span class="ident" id="3818702">Subject</span><span class="op" id="3818709">.</span><span class="ident" id="3818710">CommonName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3818723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3818726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3818729">return</span>&nbsp;<span class="string" id="3818736">&#34;x509:&nbsp;certificate&nbsp;is&nbsp;valid&nbsp;for&nbsp;&#34;</span>&nbsp;<span class="op" id="3818770">+</span>&nbsp;<span class="ident" id="3818772">valid</span>&nbsp;<span class="op" id="3818778">+</span>&nbsp;<span class="string" id="3818780">&#34;,&nbsp;not&nbsp;&#34;</span>&nbsp;<span class="op" id="3818789">+</span>&nbsp;<span class="ident" id="3818791">h</span><span class="op" id="3818792">.</span><span class="ident" id="3818793">Host</span><br>
<span class="lineno">90</span><span class="op" id="3818798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3818801">//&nbsp;UnknownAuthorityError&nbsp;results&nbsp;when&nbsp;the&nbsp;certificate&nbsp;issuer&nbsp;is&nbsp;unknown</span><br>
<span class="lineno"></span><span class="keyword" id="3818873">type</span>&nbsp;<span class="ident" id="3818878">UnknownAuthorityError</span>&nbsp;<span class="keyword" id="3818900">struct</span>&nbsp;<span class="op" id="3818907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818910">cert</span>&nbsp;<span class="op" id="3818915">*</span><span class="ident" id="3818916">Certificate</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818929">//&nbsp;hintErr&nbsp;contains&nbsp;an&nbsp;error&nbsp;that&nbsp;may&nbsp;be&nbsp;helpful&nbsp;in&nbsp;determining&nbsp;why&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3819001">//&nbsp;authority&nbsp;wasn&#39;t&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3819029">hintErr</span>&nbsp;<span class="builtintype" id="3819037">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3819044">//&nbsp;hintCert&nbsp;contains&nbsp;a&nbsp;possible&nbsp;authority&nbsp;certificate&nbsp;that&nbsp;was&nbsp;rejected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3819117">//&nbsp;because&nbsp;of&nbsp;the&nbsp;error&nbsp;in&nbsp;hintErr.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3819154">hintCert</span>&nbsp;<span class="op" id="3819163">*</span><span class="ident" id="3819164">Certificate</span><br>
<span class="lineno"></span><span class="op" id="3819176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3819179">func</span>&nbsp;<span class="op" id="3819184">(</span><span class="ident" id="3819185">e</span>&nbsp;<span class="ident" id="3819187">UnknownAuthorityError</span><span class="op" id="3819208">)</span>&nbsp;<span class="ident" id="3819210">Error</span><span class="op" id="3819215">(</span><span class="op" id="3819216">)</span>&nbsp;<span class="builtintype" id="3819218">string</span>&nbsp;<span class="op" id="3819225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3819228">s</span>&nbsp;<span class="op" id="3819230">:=</span>&nbsp;<span class="string" id="3819233">&#34;x509:&nbsp;certificate&nbsp;signed&nbsp;by&nbsp;unknown&nbsp;authority&#34;</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3819282">if</span>&nbsp;<span class="ident" id="3819285">e</span><span class="op" id="3819286">.</span><span class="ident" id="3819287">hintErr</span>&nbsp;<span class="op" id="3819295">!=</span>&nbsp;<span class="ident" id="3819298">nil</span>&nbsp;<span class="op" id="3819302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3819306">certName</span>&nbsp;<span class="op" id="3819315">:=</span>&nbsp;<span class="ident" id="3819318">e</span><span class="op" id="3819319">.</span><span class="ident" id="3819320">hintCert</span><span class="op" id="3819328">.</span><span class="ident" id="3819329">Subject</span><span class="op" id="3819336">.</span><span class="ident" id="3819337">CommonName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3819350">if</span>&nbsp;<span class="builtinfunc" id="3819353">len</span><span class="op" id="3819356">(</span><span class="ident" id="3819357">certName</span><span class="op" id="3819365">)</span>&nbsp;<span class="op" id="3819367">==</span>&nbsp;<span class="num" id="3819370">0</span>&nbsp;<span class="op" id="3819372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3819377">if</span>&nbsp;<span class="builtinfunc" id="3819380">len</span><span class="op" id="3819383">(</span><span class="ident" id="3819384">e</span><span class="op" id="3819385">.</span><span class="ident" id="3819386">hintCert</span><span class="op" id="3819394">.</span><span class="ident" id="3819395">Subject</span><span class="op" id="3819402">.</span><span class="ident" id="3819403">Organization</span><span class="op" id="3819415">)</span>&nbsp;<span class="op" id="3819417">&gt;</span>&nbsp;<span class="num" id="3819419">0</span>&nbsp;<span class="op" id="3819421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3819427">certName</span>&nbsp;<span class="op" id="3819436">=</span>&nbsp;<span class="ident" id="3819438">e</span><span class="op" id="3819439">.</span><span class="ident" id="3819440">hintCert</span><span class="op" id="3819448">.</span><span class="ident" id="3819449">Subject</span><span class="op" id="3819456">.</span><span class="ident" id="3819457">Organization</span><span class="op" id="3819469">[</span><span class="num" id="3819470">0</span><span class="op" id="3819471">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3819476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3819481">certName</span>&nbsp;<span class="op" id="3819490">=</span>&nbsp;<span class="string" id="3819492">&#34;serial:&#34;</span>&nbsp;<span class="op" id="3819502">+</span>&nbsp;<span class="ident" id="3819504">e</span><span class="op" id="3819505">.</span><span class="ident" id="3819506">hintCert</span><span class="op" id="3819514">.</span><span class="ident" id="3819515">SerialNumber</span><span class="op" id="3819527">.</span><span class="ident" id="3819528">String</span><span class="op" id="3819534">(</span><span class="op" id="3819535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3819539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3819543">s</span>&nbsp;<span class="op" id="3819545">+=</span>&nbsp;<span class="ident" id="3819548">fmt</span><span class="op" id="3819551">.</span><span class="ident" id="3819552">Sprintf</span><span class="op" id="3819559">(</span><span class="string" id="3819560">&#34;&nbsp;(possibly&nbsp;because&nbsp;of&nbsp;%q&nbsp;while&nbsp;trying&nbsp;to&nbsp;verify&nbsp;candidate&nbsp;authority&nbsp;certificate&nbsp;%q)&#34;</span><span class="op" id="3819645">,</span>&nbsp;<span class="ident" id="3819647">e</span><span class="op" id="3819648">.</span><span class="ident" id="3819649">hintErr</span><span class="op" id="3819656">,</span>&nbsp;<span class="ident" id="3819658">certName</span><span class="op" id="3819666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3819669">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3819672">return</span>&nbsp;<span class="ident" id="3819679">s</span><br>
<span class="lineno"></span><span class="op" id="3819681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3819684">//&nbsp;SystemRootsError&nbsp;results&nbsp;when&nbsp;we&nbsp;fail&nbsp;to&nbsp;load&nbsp;the&nbsp;system&nbsp;root&nbsp;certificates.</span><br>
<span class="lineno"></span><span class="keyword" id="3819763">type</span>&nbsp;<span class="ident" id="3819768">SystemRootsError</span>&nbsp;<span class="keyword" id="3819785">struct</span><span class="op" id="3819791">{</span><span class="op" id="3819792">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="3819795">func</span>&nbsp;<span class="op" id="3819800">(</span><span class="ident" id="3819801">SystemRootsError</span><span class="op" id="3819817">)</span>&nbsp;<span class="ident" id="3819819">Error</span><span class="op" id="3819824">(</span><span class="op" id="3819825">)</span>&nbsp;<span class="builtintype" id="3819827">string</span>&nbsp;<span class="op" id="3819834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3819837">return</span>&nbsp;<span class="string" id="3819844">&#34;x509:&nbsp;failed&nbsp;to&nbsp;load&nbsp;system&nbsp;roots&nbsp;and&nbsp;no&nbsp;roots&nbsp;provided&#34;</span><br>
<span class="lineno"></span><span class="op" id="3819902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3819905">//&nbsp;VerifyOptions&nbsp;contains&nbsp;parameters&nbsp;for&nbsp;Certificate.Verify.&nbsp;It&#39;s&nbsp;a&nbsp;structure</span><br>
<span class="lineno"></span><span class="comment" id="3819983">//&nbsp;because&nbsp;other&nbsp;PKIX&nbsp;verification&nbsp;APIs&nbsp;have&nbsp;ended&nbsp;up&nbsp;needing&nbsp;many&nbsp;options.</span><br>
<span class="lineno"></span><span class="keyword" id="3820059">type</span>&nbsp;<span class="ident" id="3820064">VerifyOptions</span>&nbsp;<span class="keyword" id="3820078">struct</span>&nbsp;<span class="op" id="3820085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820088">DNSName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3820102">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820110">Intermediates</span>&nbsp;<span class="op" id="3820124">*</span><span class="ident" id="3820125">CertPool</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820135">Roots</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3820149">*</span><span class="ident" id="3820150">CertPool</span>&nbsp;<span class="comment" id="3820159">//&nbsp;if&nbsp;nil,&nbsp;the&nbsp;system&nbsp;roots&nbsp;are&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820197">CurrentTime</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3820211">time</span><span class="op" id="3820215">.</span><span class="ident" id="3820216">Time</span>&nbsp;<span class="comment" id="3820221">//&nbsp;if&nbsp;zero,&nbsp;the&nbsp;current&nbsp;time&nbsp;is&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3820259">//&nbsp;KeyUsage&nbsp;specifies&nbsp;which&nbsp;Extended&nbsp;Key&nbsp;Usage&nbsp;values&nbsp;are&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3820330">//&nbsp;An&nbsp;empty&nbsp;list&nbsp;means&nbsp;ExtKeyUsageServerAuth.&nbsp;Key&nbsp;usage&nbsp;is&nbsp;considered&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3820403">//&nbsp;constraint&nbsp;down&nbsp;the&nbsp;chain&nbsp;which&nbsp;mirrors&nbsp;Windows&nbsp;CryptoAPI&nbsp;behaviour,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3820476">//&nbsp;but&nbsp;not&nbsp;the&nbsp;spec.&nbsp;To&nbsp;accept&nbsp;any&nbsp;key&nbsp;usage,&nbsp;include&nbsp;ExtKeyUsageAny.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820547">KeyUsages</span>&nbsp;<span class="op" id="3820557">[</span><span class="op" id="3820558">]</span><span class="ident" id="3820559">ExtKeyUsage</span><br>
<span class="lineno"></span><span class="op" id="3820571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3820574">const</span>&nbsp;<span class="op" id="3820580">(</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820583">leafCertificate</span>&nbsp;<span class="op" id="3820599">=</span>&nbsp;<span class="ident" id="3820601">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820607">intermediateCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820632">rootCertificate</span><br>
<span class="lineno"></span><span class="op" id="3820648">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="3820651">//&nbsp;isValid&nbsp;performs&nbsp;validity&nbsp;checks&nbsp;on&nbsp;the&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="3820697">func</span>&nbsp;<span class="op" id="3820702">(</span><span class="ident" id="3820703">c</span>&nbsp;<span class="op" id="3820705">*</span><span class="ident" id="3820706">Certificate</span><span class="op" id="3820717">)</span>&nbsp;<span class="ident" id="3820719">isValid</span><span class="op" id="3820726">(</span><span class="ident" id="3820727">certType</span>&nbsp;<span class="builtintype" id="3820736">int</span><span class="op" id="3820739">,</span>&nbsp;<span class="ident" id="3820741">currentChain</span>&nbsp;<span class="op" id="3820754">[</span><span class="op" id="3820755">]</span><span class="op" id="3820756">*</span><span class="ident" id="3820757">Certificate</span><span class="op" id="3820768">,</span>&nbsp;<span class="ident" id="3820770">opts</span>&nbsp;<span class="op" id="3820775">*</span><span class="ident" id="3820776">VerifyOptions</span><span class="op" id="3820789">)</span>&nbsp;<span class="builtintype" id="3820791">error</span>&nbsp;<span class="op" id="3820797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820800">now</span>&nbsp;<span class="op" id="3820804">:=</span>&nbsp;<span class="ident" id="3820807">opts</span><span class="op" id="3820811">.</span><span class="ident" id="3820812">CurrentTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820825">if</span>&nbsp;<span class="ident" id="3820828">now</span><span class="op" id="3820831">.</span><span class="ident" id="3820832">IsZero</span><span class="op" id="3820838">(</span><span class="op" id="3820839">)</span>&nbsp;<span class="op" id="3820841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820845">now</span>&nbsp;<span class="op" id="3820849">=</span>&nbsp;<span class="ident" id="3820851">time</span><span class="op" id="3820855">.</span><span class="ident" id="3820856">Now</span><span class="op" id="3820859">(</span><span class="op" id="3820860">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3820863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820866">if</span>&nbsp;<span class="ident" id="3820869">now</span><span class="op" id="3820872">.</span><span class="ident" id="3820873">Before</span><span class="op" id="3820879">(</span><span class="ident" id="3820880">c</span><span class="op" id="3820881">.</span><span class="ident" id="3820882">NotBefore</span><span class="op" id="3820891">)</span>&nbsp;<span class="op" id="3820893">||</span>&nbsp;<span class="ident" id="3820896">now</span><span class="op" id="3820899">.</span><span class="ident" id="3820900">After</span><span class="op" id="3820905">(</span><span class="ident" id="3820906">c</span><span class="op" id="3820907">.</span><span class="ident" id="3820908">NotAfter</span><span class="op" id="3820916">)</span>&nbsp;<span class="op" id="3820918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820922">return</span>&nbsp;<span class="ident" id="3820929">CertificateInvalidError</span><span class="op" id="3820952">{</span><span class="ident" id="3820953">c</span><span class="op" id="3820954">,</span>&nbsp;<span class="ident" id="3820956">Expired</span><span class="op" id="3820963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3820966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820970">if</span>&nbsp;<span class="builtinfunc" id="3820973">len</span><span class="op" id="3820976">(</span><span class="ident" id="3820977">c</span><span class="op" id="3820978">.</span><span class="ident" id="3820979">PermittedDNSDomains</span><span class="op" id="3820998">)</span>&nbsp;<span class="op" id="3821000">&gt;</span>&nbsp;<span class="num" id="3821002">0</span>&nbsp;<span class="op" id="3821004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821008">ok</span>&nbsp;<span class="op" id="3821011">:=</span>&nbsp;<span class="builtintype" id="3821014">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821022">for</span>&nbsp;<span class="ident" id="3821026">_</span><span class="op" id="3821027">,</span>&nbsp;<span class="ident" id="3821029">domain</span>&nbsp;<span class="op" id="3821036">:=</span>&nbsp;<span class="keyword" id="3821039">range</span>&nbsp;<span class="ident" id="3821045">c</span><span class="op" id="3821046">.</span><span class="ident" id="3821047">PermittedDNSDomains</span>&nbsp;<span class="op" id="3821067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821072">if</span>&nbsp;<span class="ident" id="3821075">opts</span><span class="op" id="3821079">.</span><span class="ident" id="3821080">DNSName</span>&nbsp;<span class="op" id="3821088">==</span>&nbsp;<span class="ident" id="3821091">domain</span>&nbsp;<span class="op" id="3821098">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3821105">(</span><span class="ident" id="3821106">strings</span><span class="op" id="3821113">.</span><span class="ident" id="3821114">HasSuffix</span><span class="op" id="3821123">(</span><span class="ident" id="3821124">opts</span><span class="op" id="3821128">.</span><span class="ident" id="3821129">DNSName</span><span class="op" id="3821136">,</span>&nbsp;<span class="ident" id="3821138">domain</span><span class="op" id="3821144">)</span>&nbsp;<span class="op" id="3821146">&amp;&amp;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3821154">len</span><span class="op" id="3821157">(</span><span class="ident" id="3821158">opts</span><span class="op" id="3821162">.</span><span class="ident" id="3821163">DNSName</span><span class="op" id="3821170">)</span>&nbsp;<span class="op" id="3821172">&gt;=</span>&nbsp;<span class="num" id="3821175">1</span><span class="op" id="3821176">+</span><span class="builtinfunc" id="3821177">len</span><span class="op" id="3821180">(</span><span class="ident" id="3821181">domain</span><span class="op" id="3821187">)</span>&nbsp;<span class="op" id="3821189">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821197">opts</span><span class="op" id="3821201">.</span><span class="ident" id="3821202">DNSName</span><span class="op" id="3821209">[</span><span class="builtinfunc" id="3821210">len</span><span class="op" id="3821213">(</span><span class="ident" id="3821214">opts</span><span class="op" id="3821218">.</span><span class="ident" id="3821219">DNSName</span><span class="op" id="3821226">)</span><span class="op" id="3821227">-</span><span class="builtinfunc" id="3821228">len</span><span class="op" id="3821231">(</span><span class="ident" id="3821232">domain</span><span class="op" id="3821238">)</span><span class="op" id="3821239">-</span><span class="num" id="3821240">1</span><span class="op" id="3821241">]</span>&nbsp;<span class="op" id="3821243">==</span>&nbsp;<span class="string" id="3821246">&#39;.&#39;</span><span class="op" id="3821249">)</span>&nbsp;<span class="op" id="3821251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821257">ok</span>&nbsp;<span class="op" id="3821260">=</span>&nbsp;<span class="builtintype" id="3821262">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821271">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3821280">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3821284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821289">if</span>&nbsp;<span class="op" id="3821292">!</span><span class="ident" id="3821293">ok</span>&nbsp;<span class="op" id="3821296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821301">return</span>&nbsp;<span class="ident" id="3821308">CertificateInvalidError</span><span class="op" id="3821331">{</span><span class="ident" id="3821332">c</span><span class="op" id="3821333">,</span>&nbsp;<span class="ident" id="3821335">CANotAuthorizedForThisName</span><span class="op" id="3821361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3821365">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3821368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3821372">//&nbsp;KeyUsage&nbsp;status&nbsp;flags&nbsp;are&nbsp;ignored.&nbsp;From&nbsp;Engineering&nbsp;Security,&nbsp;Peter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3821444">//&nbsp;Gutmann:&nbsp;A&nbsp;European&nbsp;government&nbsp;CA&nbsp;marked&nbsp;its&nbsp;signing&nbsp;certificates&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3821517">//&nbsp;being&nbsp;valid&nbsp;for&nbsp;encryption&nbsp;only,&nbsp;but&nbsp;no-one&nbsp;noticed.&nbsp;Another</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3821582">//&nbsp;European&nbsp;CA&nbsp;marked&nbsp;its&nbsp;signature&nbsp;keys&nbsp;as&nbsp;not&nbsp;being&nbsp;valid&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3821647">//&nbsp;signatures.&nbsp;A&nbsp;different&nbsp;CA&nbsp;marked&nbsp;its&nbsp;own&nbsp;trusted&nbsp;root&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3821718">//&nbsp;as&nbsp;being&nbsp;invalid&nbsp;for&nbsp;certificate&nbsp;signing.&nbsp;&nbsp;Another&nbsp;national&nbsp;CA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3821785">//&nbsp;distributed&nbsp;a&nbsp;certificate&nbsp;to&nbsp;be&nbsp;used&nbsp;to&nbsp;encrypt&nbsp;data&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3821850">//&nbsp;country’s&nbsp;tax&nbsp;authority&nbsp;that&nbsp;was&nbsp;marked&nbsp;as&nbsp;only&nbsp;being&nbsp;usable&nbsp;for</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3821921">//&nbsp;digital&nbsp;signatures&nbsp;but&nbsp;not&nbsp;for&nbsp;encryption.&nbsp;Yet&nbsp;another&nbsp;CA&nbsp;reversed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3821992">//&nbsp;the&nbsp;order&nbsp;of&nbsp;the&nbsp;bit&nbsp;flags&nbsp;in&nbsp;the&nbsp;keyUsage&nbsp;due&nbsp;to&nbsp;confusion&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3822061">//&nbsp;encoding&nbsp;endianness,&nbsp;essentially&nbsp;setting&nbsp;a&nbsp;random&nbsp;keyUsage&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3822127">//&nbsp;certificates&nbsp;that&nbsp;it&nbsp;issued.&nbsp;Another&nbsp;CA&nbsp;created&nbsp;a&nbsp;self-invalidating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3822199">//&nbsp;certificate&nbsp;by&nbsp;adding&nbsp;a&nbsp;certificate&nbsp;policy&nbsp;statement&nbsp;stipulating</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3822268">//&nbsp;that&nbsp;the&nbsp;certificate&nbsp;had&nbsp;to&nbsp;be&nbsp;used&nbsp;strictly&nbsp;as&nbsp;specified&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3822337">//&nbsp;keyUsage,&nbsp;and&nbsp;a&nbsp;keyUsage&nbsp;containing&nbsp;a&nbsp;flag&nbsp;indicating&nbsp;that&nbsp;the&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3822408">//&nbsp;encryption&nbsp;key&nbsp;could&nbsp;only&nbsp;be&nbsp;used&nbsp;for&nbsp;Diffie-Hellman&nbsp;key&nbsp;agreement.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822481">if</span>&nbsp;<span class="ident" id="3822484">certType</span>&nbsp;<span class="op" id="3822493">==</span>&nbsp;<span class="ident" id="3822496">intermediateCertificate</span>&nbsp;<span class="op" id="3822520">&amp;&amp;</span>&nbsp;<span class="op" id="3822523">(</span><span class="op" id="3822524">!</span><span class="ident" id="3822525">c</span><span class="op" id="3822526">.</span><span class="ident" id="3822527">BasicConstraintsValid</span>&nbsp;<span class="op" id="3822549">||</span>&nbsp;<span class="op" id="3822552">!</span><span class="ident" id="3822553">c</span><span class="op" id="3822554">.</span><span class="ident" id="3822555">IsCA</span><span class="op" id="3822559">)</span>&nbsp;<span class="op" id="3822561">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822565">return</span>&nbsp;<span class="ident" id="3822572">CertificateInvalidError</span><span class="op" id="3822595">{</span><span class="ident" id="3822596">c</span><span class="op" id="3822597">,</span>&nbsp;<span class="ident" id="3822599">NotAuthorizedToSign</span><span class="op" id="3822618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3822621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822625">if</span>&nbsp;<span class="ident" id="3822628">c</span><span class="op" id="3822629">.</span><span class="ident" id="3822630">BasicConstraintsValid</span>&nbsp;<span class="op" id="3822652">&amp;&amp;</span>&nbsp;<span class="ident" id="3822655">c</span><span class="op" id="3822656">.</span><span class="ident" id="3822657">MaxPathLen</span>&nbsp;<span class="op" id="3822668">&gt;=</span>&nbsp;<span class="num" id="3822671">0</span>&nbsp;<span class="op" id="3822673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822677">numIntermediates</span>&nbsp;<span class="op" id="3822694">:=</span>&nbsp;<span class="builtinfunc" id="3822697">len</span><span class="op" id="3822700">(</span><span class="ident" id="3822701">currentChain</span><span class="op" id="3822713">)</span>&nbsp;<span class="op" id="3822715">-</span>&nbsp;<span class="num" id="3822717">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822721">if</span>&nbsp;<span class="ident" id="3822724">numIntermediates</span>&nbsp;<span class="op" id="3822741">&gt;</span>&nbsp;<span class="ident" id="3822743">c</span><span class="op" id="3822744">.</span><span class="ident" id="3822745">MaxPathLen</span>&nbsp;<span class="op" id="3822756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822761">return</span>&nbsp;<span class="ident" id="3822768">CertificateInvalidError</span><span class="op" id="3822791">{</span><span class="ident" id="3822792">c</span><span class="op" id="3822793">,</span>&nbsp;<span class="ident" id="3822795">TooManyIntermediates</span><span class="op" id="3822815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3822819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3822822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822826">return</span>&nbsp;<span class="ident" id="3822833">nil</span><br>
<span class="lineno"></span><span class="op" id="3822837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3822840">//&nbsp;Verify&nbsp;attempts&nbsp;to&nbsp;verify&nbsp;c&nbsp;by&nbsp;building&nbsp;one&nbsp;or&nbsp;more&nbsp;chains&nbsp;from&nbsp;c&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3822914">//&nbsp;certificate&nbsp;in&nbsp;opts.Roots,&nbsp;using&nbsp;certificates&nbsp;in&nbsp;opts.Intermediates&nbsp;if</span><br>
<span class="lineno">205</span><span class="comment" id="3822988">//&nbsp;needed.&nbsp;If&nbsp;successful,&nbsp;it&nbsp;returns&nbsp;one&nbsp;or&nbsp;more&nbsp;chains&nbsp;where&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="3823060">//&nbsp;element&nbsp;of&nbsp;the&nbsp;chain&nbsp;is&nbsp;c&nbsp;and&nbsp;the&nbsp;last&nbsp;element&nbsp;is&nbsp;from&nbsp;opts.Roots.</span><br>
<span class="lineno"></span><span class="comment" id="3823130">//</span><br>
<span class="lineno"></span><span class="comment" id="3823133">//&nbsp;If&nbsp;opts.Roots&nbsp;is&nbsp;nil&nbsp;and&nbsp;system&nbsp;roots&nbsp;are&nbsp;unavailable&nbsp;the&nbsp;returned&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="3823209">//&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;SystemRootsError.</span><br>
<span class="lineno">210</span><span class="comment" id="3823246">//</span><br>
<span class="lineno"></span><span class="comment" id="3823249">//&nbsp;WARNING:&nbsp;this&nbsp;doesn&#39;t&nbsp;do&nbsp;any&nbsp;revocation&nbsp;checking.</span><br>
<span class="lineno"></span><span class="keyword" id="3823302">func</span>&nbsp;<span class="op" id="3823307">(</span><span class="ident" id="3823308">c</span>&nbsp;<span class="op" id="3823310">*</span><span class="ident" id="3823311">Certificate</span><span class="op" id="3823322">)</span>&nbsp;<span class="ident" id="3823324">Verify</span><span class="op" id="3823330">(</span><span class="ident" id="3823331">opts</span>&nbsp;<span class="ident" id="3823336">VerifyOptions</span><span class="op" id="3823349">)</span>&nbsp;<span class="op" id="3823351">(</span><span class="ident" id="3823352">chains</span>&nbsp;<span class="op" id="3823359">[</span><span class="op" id="3823360">]</span><span class="op" id="3823361">[</span><span class="op" id="3823362">]</span><span class="op" id="3823363">*</span><span class="ident" id="3823364">Certificate</span><span class="op" id="3823375">,</span>&nbsp;<span class="ident" id="3823377">err</span>&nbsp;<span class="builtintype" id="3823381">error</span><span class="op" id="3823386">)</span>&nbsp;<span class="op" id="3823388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823391">//&nbsp;Use&nbsp;Windows&#39;s&nbsp;own&nbsp;verification&nbsp;and&nbsp;chain&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823446">if</span>&nbsp;<span class="ident" id="3823449">opts</span><span class="op" id="3823453">.</span><span class="ident" id="3823454">Roots</span>&nbsp;<span class="op" id="3823460">==</span>&nbsp;<span class="ident" id="3823463">nil</span>&nbsp;<span class="op" id="3823467">&amp;&amp;</span>&nbsp;<span class="ident" id="3823470">runtime</span><span class="op" id="3823477">.</span><span class="ident" id="3823478">GOOS</span>&nbsp;<span class="op" id="3823483">==</span>&nbsp;<span class="string" id="3823486">&#34;windows&#34;</span>&nbsp;<span class="op" id="3823496">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823500">return</span>&nbsp;<span class="ident" id="3823507">c</span><span class="op" id="3823508">.</span><span class="ident" id="3823509">systemVerify</span><span class="op" id="3823521">(</span><span class="op" id="3823522">&amp;</span><span class="ident" id="3823523">opts</span><span class="op" id="3823527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823534">if</span>&nbsp;<span class="ident" id="3823537">opts</span><span class="op" id="3823541">.</span><span class="ident" id="3823542">Roots</span>&nbsp;<span class="op" id="3823548">==</span>&nbsp;<span class="ident" id="3823551">nil</span>&nbsp;<span class="op" id="3823555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823559">opts</span><span class="op" id="3823563">.</span><span class="ident" id="3823564">Roots</span>&nbsp;<span class="op" id="3823570">=</span>&nbsp;<span class="ident" id="3823572">systemRootsPool</span><span class="op" id="3823587">(</span><span class="op" id="3823588">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823592">if</span>&nbsp;<span class="ident" id="3823595">opts</span><span class="op" id="3823599">.</span><span class="ident" id="3823600">Roots</span>&nbsp;<span class="op" id="3823606">==</span>&nbsp;<span class="ident" id="3823609">nil</span>&nbsp;<span class="op" id="3823613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823618">return</span>&nbsp;<span class="ident" id="3823625">nil</span><span class="op" id="3823628">,</span>&nbsp;<span class="ident" id="3823630">SystemRootsError</span><span class="op" id="3823646">{</span><span class="op" id="3823647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823658">err</span>&nbsp;<span class="op" id="3823662">=</span>&nbsp;<span class="ident" id="3823664">c</span><span class="op" id="3823665">.</span><span class="ident" id="3823666">isValid</span><span class="op" id="3823673">(</span><span class="ident" id="3823674">leafCertificate</span><span class="op" id="3823689">,</span>&nbsp;<span class="ident" id="3823691">nil</span><span class="op" id="3823694">,</span>&nbsp;<span class="op" id="3823696">&amp;</span><span class="ident" id="3823697">opts</span><span class="op" id="3823701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823704">if</span>&nbsp;<span class="ident" id="3823707">err</span>&nbsp;<span class="op" id="3823711">!=</span>&nbsp;<span class="ident" id="3823714">nil</span>&nbsp;<span class="op" id="3823718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823722">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823734">if</span>&nbsp;<span class="builtinfunc" id="3823737">len</span><span class="op" id="3823740">(</span><span class="ident" id="3823741">opts</span><span class="op" id="3823745">.</span><span class="ident" id="3823746">DNSName</span><span class="op" id="3823753">)</span>&nbsp;<span class="op" id="3823755">&gt;</span>&nbsp;<span class="num" id="3823757">0</span>&nbsp;<span class="op" id="3823759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823763">err</span>&nbsp;<span class="op" id="3823767">=</span>&nbsp;<span class="ident" id="3823769">c</span><span class="op" id="3823770">.</span><span class="ident" id="3823771">VerifyHostname</span><span class="op" id="3823785">(</span><span class="ident" id="3823786">opts</span><span class="op" id="3823790">.</span><span class="ident" id="3823791">DNSName</span><span class="op" id="3823798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823802">if</span>&nbsp;<span class="ident" id="3823805">err</span>&nbsp;<span class="op" id="3823809">!=</span>&nbsp;<span class="ident" id="3823812">nil</span>&nbsp;<span class="op" id="3823816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823821">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823830">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823837">candidateChains</span><span class="op" id="3823852">,</span>&nbsp;<span class="ident" id="3823854">err</span>&nbsp;<span class="op" id="3823858">:=</span>&nbsp;<span class="ident" id="3823861">c</span><span class="op" id="3823862">.</span><span class="ident" id="3823863">buildChains</span><span class="op" id="3823874">(</span><span class="builtinfunc" id="3823875">make</span><span class="op" id="3823879">(</span><span class="keyword" id="3823880">map</span><span class="op" id="3823883">[</span><span class="builtintype" id="3823884">int</span><span class="op" id="3823887">]</span><span class="op" id="3823888">[</span><span class="op" id="3823889">]</span><span class="op" id="3823890">[</span><span class="op" id="3823891">]</span><span class="op" id="3823892">*</span><span class="ident" id="3823893">Certificate</span><span class="op" id="3823904">)</span><span class="op" id="3823905">,</span>&nbsp;<span class="op" id="3823907">[</span><span class="op" id="3823908">]</span><span class="op" id="3823909">*</span><span class="ident" id="3823910">Certificate</span><span class="op" id="3823921">{</span><span class="ident" id="3823922">c</span><span class="op" id="3823923">}</span><span class="op" id="3823924">,</span>&nbsp;<span class="op" id="3823926">&amp;</span><span class="ident" id="3823927">opts</span><span class="op" id="3823931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823934">if</span>&nbsp;<span class="ident" id="3823937">err</span>&nbsp;<span class="op" id="3823941">!=</span>&nbsp;<span class="ident" id="3823944">nil</span>&nbsp;<span class="op" id="3823948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823952">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823964">keyUsages</span>&nbsp;<span class="op" id="3823974">:=</span>&nbsp;<span class="ident" id="3823977">opts</span><span class="op" id="3823981">.</span><span class="ident" id="3823982">KeyUsages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823993">if</span>&nbsp;<span class="builtinfunc" id="3823996">len</span><span class="op" id="3823999">(</span><span class="ident" id="3824000">keyUsages</span><span class="op" id="3824009">)</span>&nbsp;<span class="op" id="3824011">==</span>&nbsp;<span class="num" id="3824014">0</span>&nbsp;<span class="op" id="3824016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824020">keyUsages</span>&nbsp;<span class="op" id="3824030">=</span>&nbsp;<span class="op" id="3824032">[</span><span class="op" id="3824033">]</span><span class="ident" id="3824034">ExtKeyUsage</span><span class="op" id="3824045">{</span><span class="ident" id="3824046">ExtKeyUsageServerAuth</span><span class="op" id="3824067">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3824070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3824074">//&nbsp;If&nbsp;any&nbsp;key&nbsp;usage&nbsp;is&nbsp;acceptable&nbsp;then&nbsp;we&#39;re&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824126">for</span>&nbsp;<span class="ident" id="3824130">_</span><span class="op" id="3824131">,</span>&nbsp;<span class="ident" id="3824133">usage</span>&nbsp;<span class="op" id="3824139">:=</span>&nbsp;<span class="keyword" id="3824142">range</span>&nbsp;<span class="ident" id="3824148">keyUsages</span>&nbsp;<span class="op" id="3824158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824162">if</span>&nbsp;<span class="ident" id="3824165">usage</span>&nbsp;<span class="op" id="3824171">==</span>&nbsp;<span class="ident" id="3824174">ExtKeyUsageAny</span>&nbsp;<span class="op" id="3824189">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824194">chains</span>&nbsp;<span class="op" id="3824201">=</span>&nbsp;<span class="ident" id="3824203">candidateChains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824222">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3824231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3824234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824238">for</span>&nbsp;<span class="ident" id="3824242">_</span><span class="op" id="3824243">,</span>&nbsp;<span class="ident" id="3824245">candidate</span>&nbsp;<span class="op" id="3824255">:=</span>&nbsp;<span class="keyword" id="3824258">range</span>&nbsp;<span class="ident" id="3824264">candidateChains</span>&nbsp;<span class="op" id="3824280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824284">if</span>&nbsp;<span class="ident" id="3824287">checkChainForKeyUsage</span><span class="op" id="3824308">(</span><span class="ident" id="3824309">candidate</span><span class="op" id="3824318">,</span>&nbsp;<span class="ident" id="3824320">keyUsages</span><span class="op" id="3824329">)</span>&nbsp;<span class="op" id="3824331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824336">chains</span>&nbsp;<span class="op" id="3824343">=</span>&nbsp;<span class="builtinfunc" id="3824345">append</span><span class="op" id="3824351">(</span><span class="ident" id="3824352">chains</span><span class="op" id="3824358">,</span>&nbsp;<span class="ident" id="3824360">candidate</span><span class="op" id="3824369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3824373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3824376">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824380">if</span>&nbsp;<span class="builtinfunc" id="3824383">len</span><span class="op" id="3824386">(</span><span class="ident" id="3824387">chains</span><span class="op" id="3824393">)</span>&nbsp;<span class="op" id="3824395">==</span>&nbsp;<span class="num" id="3824398">0</span>&nbsp;<span class="op" id="3824400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824404">err</span>&nbsp;<span class="op" id="3824408">=</span>&nbsp;<span class="ident" id="3824410">CertificateInvalidError</span><span class="op" id="3824433">{</span><span class="ident" id="3824434">c</span><span class="op" id="3824435">,</span>&nbsp;<span class="ident" id="3824437">IncompatibleUsage</span><span class="op" id="3824454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3824457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824461">return</span><br>
<span class="lineno"></span><span class="op" id="3824468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3824471">func</span>&nbsp;<span class="ident" id="3824476">appendToFreshChain</span><span class="op" id="3824494">(</span><span class="ident" id="3824495">chain</span>&nbsp;<span class="op" id="3824501">[</span><span class="op" id="3824502">]</span><span class="op" id="3824503">*</span><span class="ident" id="3824504">Certificate</span><span class="op" id="3824515">,</span>&nbsp;<span class="ident" id="3824517">cert</span>&nbsp;<span class="op" id="3824522">*</span><span class="ident" id="3824523">Certificate</span><span class="op" id="3824534">)</span>&nbsp;<span class="op" id="3824536">[</span><span class="op" id="3824537">]</span><span class="op" id="3824538">*</span><span class="ident" id="3824539">Certificate</span>&nbsp;<span class="op" id="3824551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824554">n</span>&nbsp;<span class="op" id="3824556">:=</span>&nbsp;<span class="builtinfunc" id="3824559">make</span><span class="op" id="3824563">(</span><span class="op" id="3824564">[</span><span class="op" id="3824565">]</span><span class="op" id="3824566">*</span><span class="ident" id="3824567">Certificate</span><span class="op" id="3824578">,</span>&nbsp;<span class="builtinfunc" id="3824580">len</span><span class="op" id="3824583">(</span><span class="ident" id="3824584">chain</span><span class="op" id="3824589">)</span><span class="op" id="3824590">+</span><span class="num" id="3824591">1</span><span class="op" id="3824592">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3824595">copy</span><span class="op" id="3824599">(</span><span class="ident" id="3824600">n</span><span class="op" id="3824601">,</span>&nbsp;<span class="ident" id="3824603">chain</span><span class="op" id="3824608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824611">n</span><span class="op" id="3824612">[</span><span class="builtinfunc" id="3824613">len</span><span class="op" id="3824616">(</span><span class="ident" id="3824617">chain</span><span class="op" id="3824622">)</span><span class="op" id="3824623">]</span>&nbsp;<span class="op" id="3824625">=</span>&nbsp;<span class="ident" id="3824627">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824633">return</span>&nbsp;<span class="ident" id="3824640">n</span><br>
<span class="lineno"></span><span class="op" id="3824642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="3824645">func</span>&nbsp;<span class="op" id="3824650">(</span><span class="ident" id="3824651">c</span>&nbsp;<span class="op" id="3824653">*</span><span class="ident" id="3824654">Certificate</span><span class="op" id="3824665">)</span>&nbsp;<span class="ident" id="3824667">buildChains</span><span class="op" id="3824678">(</span><span class="ident" id="3824679">cache</span>&nbsp;<span class="keyword" id="3824685">map</span><span class="op" id="3824688">[</span><span class="builtintype" id="3824689">int</span><span class="op" id="3824692">]</span><span class="op" id="3824693">[</span><span class="op" id="3824694">]</span><span class="op" id="3824695">[</span><span class="op" id="3824696">]</span><span class="op" id="3824697">*</span><span class="ident" id="3824698">Certificate</span><span class="op" id="3824709">,</span>&nbsp;<span class="ident" id="3824711">currentChain</span>&nbsp;<span class="op" id="3824724">[</span><span class="op" id="3824725">]</span><span class="op" id="3824726">*</span><span class="ident" id="3824727">Certificate</span><span class="op" id="3824738">,</span>&nbsp;<span class="ident" id="3824740">opts</span>&nbsp;<span class="op" id="3824745">*</span><span class="ident" id="3824746">VerifyOptions</span><span class="op" id="3824759">)</span>&nbsp;<span class="op" id="3824761">(</span><span class="ident" id="3824762">chains</span>&nbsp;<span class="op" id="3824769">[</span><span class="op" id="3824770">]</span><span class="op" id="3824771">[</span><span class="op" id="3824772">]</span><span class="op" id="3824773">*</span><span class="ident" id="3824774">Certificate</span><span class="op" id="3824785">,</span>&nbsp;<span class="ident" id="3824787">err</span>&nbsp;<span class="builtintype" id="3824791">error</span><span class="op" id="3824796">)</span>&nbsp;<span class="op" id="3824798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824801">possibleRoots</span><span class="op" id="3824814">,</span>&nbsp;<span class="ident" id="3824816">failedRoot</span><span class="op" id="3824826">,</span>&nbsp;<span class="ident" id="3824828">rootErr</span>&nbsp;<span class="op" id="3824836">:=</span>&nbsp;<span class="ident" id="3824839">opts</span><span class="op" id="3824843">.</span><span class="ident" id="3824844">Roots</span><span class="op" id="3824849">.</span><span class="ident" id="3824850">findVerifiedParents</span><span class="op" id="3824869">(</span><span class="ident" id="3824870">c</span><span class="op" id="3824871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824874">for</span>&nbsp;<span class="ident" id="3824878">_</span><span class="op" id="3824879">,</span>&nbsp;<span class="ident" id="3824881">rootNum</span>&nbsp;<span class="op" id="3824889">:=</span>&nbsp;<span class="keyword" id="3824892">range</span>&nbsp;<span class="ident" id="3824898">possibleRoots</span>&nbsp;<span class="op" id="3824912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824916">root</span>&nbsp;<span class="op" id="3824921">:=</span>&nbsp;<span class="ident" id="3824924">opts</span><span class="op" id="3824928">.</span><span class="ident" id="3824929">Roots</span><span class="op" id="3824934">.</span><span class="ident" id="3824935">certs</span><span class="op" id="3824940">[</span><span class="ident" id="3824941">rootNum</span><span class="op" id="3824948">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824952">err</span>&nbsp;<span class="op" id="3824956">=</span>&nbsp;<span class="ident" id="3824958">root</span><span class="op" id="3824962">.</span><span class="ident" id="3824963">isValid</span><span class="op" id="3824970">(</span><span class="ident" id="3824971">rootCertificate</span><span class="op" id="3824986">,</span>&nbsp;<span class="ident" id="3824988">currentChain</span><span class="op" id="3825000">,</span>&nbsp;<span class="ident" id="3825002">opts</span><span class="op" id="3825006">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825010">if</span>&nbsp;<span class="ident" id="3825013">err</span>&nbsp;<span class="op" id="3825017">!=</span>&nbsp;<span class="ident" id="3825020">nil</span>&nbsp;<span class="op" id="3825024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825029">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3825040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825044">chains</span>&nbsp;<span class="op" id="3825051">=</span>&nbsp;<span class="builtinfunc" id="3825053">append</span><span class="op" id="3825059">(</span><span class="ident" id="3825060">chains</span><span class="op" id="3825066">,</span>&nbsp;<span class="ident" id="3825068">appendToFreshChain</span><span class="op" id="3825086">(</span><span class="ident" id="3825087">currentChain</span><span class="op" id="3825099">,</span>&nbsp;<span class="ident" id="3825101">root</span><span class="op" id="3825105">)</span><span class="op" id="3825106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3825109">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825113">possibleIntermediates</span><span class="op" id="3825134">,</span>&nbsp;<span class="ident" id="3825136">failedIntermediate</span><span class="op" id="3825154">,</span>&nbsp;<span class="ident" id="3825156">intermediateErr</span>&nbsp;<span class="op" id="3825172">:=</span>&nbsp;<span class="ident" id="3825175">opts</span><span class="op" id="3825179">.</span><span class="ident" id="3825180">Intermediates</span><span class="op" id="3825193">.</span><span class="ident" id="3825194">findVerifiedParents</span><span class="op" id="3825213">(</span><span class="ident" id="3825214">c</span><span class="op" id="3825215">)</span><br>
<span class="lineno"></span><span class="ident" id="3825217">nextIntermediate</span><span class="op" id="3825233">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825236">for</span>&nbsp;<span class="ident" id="3825240">_</span><span class="op" id="3825241">,</span>&nbsp;<span class="ident" id="3825243">intermediateNum</span>&nbsp;<span class="op" id="3825259">:=</span>&nbsp;<span class="keyword" id="3825262">range</span>&nbsp;<span class="ident" id="3825268">possibleIntermediates</span>&nbsp;<span class="op" id="3825290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825294">intermediate</span>&nbsp;<span class="op" id="3825307">:=</span>&nbsp;<span class="ident" id="3825310">opts</span><span class="op" id="3825314">.</span><span class="ident" id="3825315">Intermediates</span><span class="op" id="3825328">.</span><span class="ident" id="3825329">certs</span><span class="op" id="3825334">[</span><span class="ident" id="3825335">intermediateNum</span><span class="op" id="3825350">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825354">for</span>&nbsp;<span class="ident" id="3825358">_</span><span class="op" id="3825359">,</span>&nbsp;<span class="ident" id="3825361">cert</span>&nbsp;<span class="op" id="3825366">:=</span>&nbsp;<span class="keyword" id="3825369">range</span>&nbsp;<span class="ident" id="3825375">currentChain</span>&nbsp;<span class="op" id="3825388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825393">if</span>&nbsp;<span class="ident" id="3825396">cert</span>&nbsp;<span class="op" id="3825401">==</span>&nbsp;<span class="ident" id="3825404">intermediate</span>&nbsp;<span class="op" id="3825417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825423">continue</span>&nbsp;<span class="ident" id="3825432">nextIntermediate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3825452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3825456">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825460">err</span>&nbsp;<span class="op" id="3825464">=</span>&nbsp;<span class="ident" id="3825466">intermediate</span><span class="op" id="3825478">.</span><span class="ident" id="3825479">isValid</span><span class="op" id="3825486">(</span><span class="ident" id="3825487">intermediateCertificate</span><span class="op" id="3825510">,</span>&nbsp;<span class="ident" id="3825512">currentChain</span><span class="op" id="3825524">,</span>&nbsp;<span class="ident" id="3825526">opts</span><span class="op" id="3825530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825534">if</span>&nbsp;<span class="ident" id="3825537">err</span>&nbsp;<span class="op" id="3825541">!=</span>&nbsp;<span class="ident" id="3825544">nil</span>&nbsp;<span class="op" id="3825548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825553">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3825564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825568">var</span>&nbsp;<span class="ident" id="3825572">childChains</span>&nbsp;<span class="op" id="3825584">[</span><span class="op" id="3825585">]</span><span class="op" id="3825586">[</span><span class="op" id="3825587">]</span><span class="op" id="3825588">*</span><span class="ident" id="3825589">Certificate</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825603">childChains</span><span class="op" id="3825614">,</span>&nbsp;<span class="ident" id="3825616">ok</span>&nbsp;<span class="op" id="3825619">:=</span>&nbsp;<span class="ident" id="3825622">cache</span><span class="op" id="3825627">[</span><span class="ident" id="3825628">intermediateNum</span><span class="op" id="3825643">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825647">if</span>&nbsp;<span class="op" id="3825650">!</span><span class="ident" id="3825651">ok</span>&nbsp;<span class="op" id="3825654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825659">childChains</span><span class="op" id="3825670">,</span>&nbsp;<span class="ident" id="3825672">err</span>&nbsp;<span class="op" id="3825676">=</span>&nbsp;<span class="ident" id="3825678">intermediate</span><span class="op" id="3825690">.</span><span class="ident" id="3825691">buildChains</span><span class="op" id="3825702">(</span><span class="ident" id="3825703">cache</span><span class="op" id="3825708">,</span>&nbsp;<span class="ident" id="3825710">appendToFreshChain</span><span class="op" id="3825728">(</span><span class="ident" id="3825729">currentChain</span><span class="op" id="3825741">,</span>&nbsp;<span class="ident" id="3825743">intermediate</span><span class="op" id="3825755">)</span><span class="op" id="3825756">,</span>&nbsp;<span class="ident" id="3825758">opts</span><span class="op" id="3825762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825767">cache</span><span class="op" id="3825772">[</span><span class="ident" id="3825773">intermediateNum</span><span class="op" id="3825788">]</span>&nbsp;<span class="op" id="3825790">=</span>&nbsp;<span class="ident" id="3825792">childChains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3825806">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825810">chains</span>&nbsp;<span class="op" id="3825817">=</span>&nbsp;<span class="builtinfunc" id="3825819">append</span><span class="op" id="3825825">(</span><span class="ident" id="3825826">chains</span><span class="op" id="3825832">,</span>&nbsp;<span class="ident" id="3825834">childChains</span><span class="op" id="3825845">...</span><span class="op" id="3825848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3825851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825855">if</span>&nbsp;<span class="builtinfunc" id="3825858">len</span><span class="op" id="3825861">(</span><span class="ident" id="3825862">chains</span><span class="op" id="3825868">)</span>&nbsp;<span class="op" id="3825870">&gt;</span>&nbsp;<span class="num" id="3825872">0</span>&nbsp;<span class="op" id="3825874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825878">err</span>&nbsp;<span class="op" id="3825882">=</span>&nbsp;<span class="ident" id="3825884">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3825889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825893">if</span>&nbsp;<span class="builtinfunc" id="3825896">len</span><span class="op" id="3825899">(</span><span class="ident" id="3825900">chains</span><span class="op" id="3825906">)</span>&nbsp;<span class="op" id="3825908">==</span>&nbsp;<span class="num" id="3825911">0</span>&nbsp;<span class="op" id="3825913">&amp;&amp;</span>&nbsp;<span class="ident" id="3825916">err</span>&nbsp;<span class="op" id="3825920">==</span>&nbsp;<span class="ident" id="3825923">nil</span>&nbsp;<span class="op" id="3825927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825931">hintErr</span>&nbsp;<span class="op" id="3825939">:=</span>&nbsp;<span class="ident" id="3825942">rootErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3825952">hintCert</span>&nbsp;<span class="op" id="3825961">:=</span>&nbsp;<span class="ident" id="3825964">failedRoot</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3825977">if</span>&nbsp;<span class="ident" id="3825980">hintErr</span>&nbsp;<span class="op" id="3825988">==</span>&nbsp;<span class="ident" id="3825991">nil</span>&nbsp;<span class="op" id="3825995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826000">hintErr</span>&nbsp;<span class="op" id="3826008">=</span>&nbsp;<span class="ident" id="3826010">intermediateErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826029">hintCert</span>&nbsp;<span class="op" id="3826038">=</span>&nbsp;<span class="ident" id="3826040">failedIntermediate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3826061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826065">err</span>&nbsp;<span class="op" id="3826069">=</span>&nbsp;<span class="ident" id="3826071">UnknownAuthorityError</span><span class="op" id="3826092">{</span><span class="ident" id="3826093">c</span><span class="op" id="3826094">,</span>&nbsp;<span class="ident" id="3826096">hintErr</span><span class="op" id="3826103">,</span>&nbsp;<span class="ident" id="3826105">hintCert</span><span class="op" id="3826113">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3826116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826120">return</span><br>
<span class="lineno"></span><span class="op" id="3826127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="3826130">func</span>&nbsp;<span class="ident" id="3826135">matchHostnames</span><span class="op" id="3826149">(</span><span class="ident" id="3826150">pattern</span><span class="op" id="3826157">,</span>&nbsp;<span class="ident" id="3826159">host</span>&nbsp;<span class="builtintype" id="3826164">string</span><span class="op" id="3826170">)</span>&nbsp;<span class="builtintype" id="3826172">bool</span>&nbsp;<span class="op" id="3826177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826180">if</span>&nbsp;<span class="builtinfunc" id="3826183">len</span><span class="op" id="3826186">(</span><span class="ident" id="3826187">pattern</span><span class="op" id="3826194">)</span>&nbsp;<span class="op" id="3826196">==</span>&nbsp;<span class="num" id="3826199">0</span>&nbsp;<span class="op" id="3826201">||</span>&nbsp;<span class="builtinfunc" id="3826204">len</span><span class="op" id="3826207">(</span><span class="ident" id="3826208">host</span><span class="op" id="3826212">)</span>&nbsp;<span class="op" id="3826214">==</span>&nbsp;<span class="num" id="3826217">0</span>&nbsp;<span class="op" id="3826219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826223">return</span>&nbsp;<span class="builtintype" id="3826230">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3826237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826241">patternParts</span>&nbsp;<span class="op" id="3826254">:=</span>&nbsp;<span class="ident" id="3826257">strings</span><span class="op" id="3826264">.</span><span class="ident" id="3826265">Split</span><span class="op" id="3826270">(</span><span class="ident" id="3826271">pattern</span><span class="op" id="3826278">,</span>&nbsp;<span class="string" id="3826280">&#34;.&#34;</span><span class="op" id="3826283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826286">hostParts</span>&nbsp;<span class="op" id="3826296">:=</span>&nbsp;<span class="ident" id="3826299">strings</span><span class="op" id="3826306">.</span><span class="ident" id="3826307">Split</span><span class="op" id="3826312">(</span><span class="ident" id="3826313">host</span><span class="op" id="3826317">,</span>&nbsp;<span class="string" id="3826319">&#34;.&#34;</span><span class="op" id="3826322">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826326">if</span>&nbsp;<span class="builtinfunc" id="3826329">len</span><span class="op" id="3826332">(</span><span class="ident" id="3826333">patternParts</span><span class="op" id="3826345">)</span>&nbsp;<span class="op" id="3826347">!=</span>&nbsp;<span class="builtinfunc" id="3826350">len</span><span class="op" id="3826353">(</span><span class="ident" id="3826354">hostParts</span><span class="op" id="3826363">)</span>&nbsp;<span class="op" id="3826365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826369">return</span>&nbsp;<span class="builtintype" id="3826376">false</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3826383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826387">for</span>&nbsp;<span class="ident" id="3826391">i</span><span class="op" id="3826392">,</span>&nbsp;<span class="ident" id="3826394">patternPart</span>&nbsp;<span class="op" id="3826406">:=</span>&nbsp;<span class="keyword" id="3826409">range</span>&nbsp;<span class="ident" id="3826415">patternParts</span>&nbsp;<span class="op" id="3826428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826432">if</span>&nbsp;<span class="ident" id="3826435">patternPart</span>&nbsp;<span class="op" id="3826447">==</span>&nbsp;<span class="string" id="3826450">&#34;*&#34;</span>&nbsp;<span class="op" id="3826454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826459">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3826470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826474">if</span>&nbsp;<span class="ident" id="3826477">patternPart</span>&nbsp;<span class="op" id="3826489">!=</span>&nbsp;<span class="ident" id="3826492">hostParts</span><span class="op" id="3826501">[</span><span class="ident" id="3826502">i</span><span class="op" id="3826503">]</span>&nbsp;<span class="op" id="3826505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826510">return</span>&nbsp;<span class="builtintype" id="3826517">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3826525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3826528">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826532">return</span>&nbsp;<span class="builtintype" id="3826539">true</span><br>
<span class="lineno"></span><span class="op" id="3826544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3826547">//&nbsp;toLowerCaseASCII&nbsp;returns&nbsp;a&nbsp;lower-case&nbsp;version&nbsp;of&nbsp;in.&nbsp;See&nbsp;RFC&nbsp;6125&nbsp;6.4.1.&nbsp;We&nbsp;use</span><br>
<span class="lineno">350</span><span class="comment" id="3826630">//&nbsp;an&nbsp;explicitly&nbsp;ASCII&nbsp;function&nbsp;to&nbsp;avoid&nbsp;any&nbsp;sharp&nbsp;corners&nbsp;resulting&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3826704">//&nbsp;performing&nbsp;Unicode&nbsp;operations&nbsp;on&nbsp;DNS&nbsp;labels.</span><br>
<span class="lineno"></span><span class="keyword" id="3826752">func</span>&nbsp;<span class="ident" id="3826757">toLowerCaseASCII</span><span class="op" id="3826773">(</span><span class="ident" id="3826774">in</span>&nbsp;<span class="builtintype" id="3826777">string</span><span class="op" id="3826783">)</span>&nbsp;<span class="builtintype" id="3826785">string</span>&nbsp;<span class="op" id="3826792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3826795">//&nbsp;If&nbsp;the&nbsp;string&nbsp;is&nbsp;already&nbsp;lower-case&nbsp;then&nbsp;there&#39;s&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3826863">isAlreadyLowerCase</span>&nbsp;<span class="op" id="3826882">:=</span>&nbsp;<span class="builtintype" id="3826885">true</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826891">for</span>&nbsp;<span class="ident" id="3826895">_</span><span class="op" id="3826896">,</span>&nbsp;<span class="ident" id="3826898">c</span>&nbsp;<span class="op" id="3826900">:=</span>&nbsp;<span class="keyword" id="3826903">range</span>&nbsp;<span class="ident" id="3826909">in</span>&nbsp;<span class="op" id="3826912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3826916">if</span>&nbsp;<span class="ident" id="3826919">c</span>&nbsp;<span class="op" id="3826921">==</span>&nbsp;<span class="ident" id="3826924">utf8</span><span class="op" id="3826928">.</span><span class="ident" id="3826929">RuneError</span>&nbsp;<span class="op" id="3826939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3826944">//&nbsp;If&nbsp;we&nbsp;get&nbsp;a&nbsp;UTF-8&nbsp;error&nbsp;then&nbsp;there&nbsp;might&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3826994">//&nbsp;upper-case&nbsp;ASCII&nbsp;bytes&nbsp;in&nbsp;the&nbsp;invalid&nbsp;sequence.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827048">isAlreadyLowerCase</span>&nbsp;<span class="op" id="3827067">=</span>&nbsp;<span class="builtintype" id="3827069">false</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827078">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3827086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827090">if</span>&nbsp;<span class="string" id="3827093">&#39;A&#39;</span>&nbsp;<span class="op" id="3827097">&lt;=</span>&nbsp;<span class="ident" id="3827100">c</span>&nbsp;<span class="op" id="3827102">&amp;&amp;</span>&nbsp;<span class="ident" id="3827105">c</span>&nbsp;<span class="op" id="3827107">&lt;=</span>&nbsp;<span class="string" id="3827110">&#39;Z&#39;</span>&nbsp;<span class="op" id="3827114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827119">isAlreadyLowerCase</span>&nbsp;<span class="op" id="3827138">=</span>&nbsp;<span class="builtintype" id="3827140">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827149">break</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3827157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3827160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827164">if</span>&nbsp;<span class="ident" id="3827167">isAlreadyLowerCase</span>&nbsp;<span class="op" id="3827186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827190">return</span>&nbsp;<span class="ident" id="3827197">in</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3827201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827205">out</span>&nbsp;<span class="op" id="3827209">:=</span>&nbsp;<span class="op" id="3827212">[</span><span class="op" id="3827213">]</span><span class="builtintype" id="3827214">byte</span><span class="op" id="3827218">(</span><span class="ident" id="3827219">in</span><span class="op" id="3827221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827224">for</span>&nbsp;<span class="ident" id="3827228">i</span><span class="op" id="3827229">,</span>&nbsp;<span class="ident" id="3827231">c</span>&nbsp;<span class="op" id="3827233">:=</span>&nbsp;<span class="keyword" id="3827236">range</span>&nbsp;<span class="ident" id="3827242">out</span>&nbsp;<span class="op" id="3827246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827250">if</span>&nbsp;<span class="string" id="3827253">&#39;A&#39;</span>&nbsp;<span class="op" id="3827257">&lt;=</span>&nbsp;<span class="ident" id="3827260">c</span>&nbsp;<span class="op" id="3827262">&amp;&amp;</span>&nbsp;<span class="ident" id="3827265">c</span>&nbsp;<span class="op" id="3827267">&lt;=</span>&nbsp;<span class="string" id="3827270">&#39;Z&#39;</span>&nbsp;<span class="op" id="3827274">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827279">out</span><span class="op" id="3827282">[</span><span class="ident" id="3827283">i</span><span class="op" id="3827284">]</span>&nbsp;<span class="op" id="3827286">+=</span>&nbsp;<span class="string" id="3827289">&#39;a&#39;</span>&nbsp;<span class="op" id="3827293">-</span>&nbsp;<span class="string" id="3827295">&#39;A&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3827301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3827304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827307">return</span>&nbsp;<span class="builtintype" id="3827314">string</span><span class="op" id="3827320">(</span><span class="ident" id="3827321">out</span><span class="op" id="3827324">)</span><br>
<span class="lineno"></span><span class="op" id="3827326">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="comment" id="3827329">//&nbsp;VerifyHostname&nbsp;returns&nbsp;nil&nbsp;if&nbsp;c&nbsp;is&nbsp;a&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;the&nbsp;named&nbsp;host.</span><br>
<span class="lineno"></span><span class="comment" id="3827407">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;mismatch.</span><br>
<span class="lineno"></span><span class="keyword" id="3827465">func</span>&nbsp;<span class="op" id="3827470">(</span><span class="ident" id="3827471">c</span>&nbsp;<span class="op" id="3827473">*</span><span class="ident" id="3827474">Certificate</span><span class="op" id="3827485">)</span>&nbsp;<span class="ident" id="3827487">VerifyHostname</span><span class="op" id="3827501">(</span><span class="ident" id="3827502">h</span>&nbsp;<span class="builtintype" id="3827504">string</span><span class="op" id="3827510">)</span>&nbsp;<span class="builtintype" id="3827512">error</span>&nbsp;<span class="op" id="3827518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3827521">//&nbsp;IP&nbsp;addresses&nbsp;may&nbsp;be&nbsp;written&nbsp;in&nbsp;[&nbsp;].</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827561">candidateIP</span>&nbsp;<span class="op" id="3827573">:=</span>&nbsp;<span class="ident" id="3827576">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827579">if</span>&nbsp;<span class="builtinfunc" id="3827582">len</span><span class="op" id="3827585">(</span><span class="ident" id="3827586">h</span><span class="op" id="3827587">)</span>&nbsp;<span class="op" id="3827589">&gt;=</span>&nbsp;<span class="num" id="3827592">3</span>&nbsp;<span class="op" id="3827594">&amp;&amp;</span>&nbsp;<span class="ident" id="3827597">h</span><span class="op" id="3827598">[</span><span class="num" id="3827599">0</span><span class="op" id="3827600">]</span>&nbsp;<span class="op" id="3827602">==</span>&nbsp;<span class="string" id="3827605">&#39;[&#39;</span>&nbsp;<span class="op" id="3827609">&amp;&amp;</span>&nbsp;<span class="ident" id="3827612">h</span><span class="op" id="3827613">[</span><span class="builtinfunc" id="3827614">len</span><span class="op" id="3827617">(</span><span class="ident" id="3827618">h</span><span class="op" id="3827619">)</span><span class="op" id="3827620">-</span><span class="num" id="3827621">1</span><span class="op" id="3827622">]</span>&nbsp;<span class="op" id="3827624">==</span>&nbsp;<span class="string" id="3827627">&#39;]&#39;</span>&nbsp;<span class="op" id="3827631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827635">candidateIP</span>&nbsp;<span class="op" id="3827647">=</span>&nbsp;<span class="ident" id="3827649">h</span><span class="op" id="3827650">[</span><span class="num" id="3827651">1</span>&nbsp;<span class="op" id="3827653">:</span>&nbsp;<span class="builtinfunc" id="3827655">len</span><span class="op" id="3827658">(</span><span class="ident" id="3827659">h</span><span class="op" id="3827660">)</span><span class="op" id="3827661">-</span><span class="num" id="3827662">1</span><span class="op" id="3827663">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3827666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827669">if</span>&nbsp;<span class="ident" id="3827672">ip</span>&nbsp;<span class="op" id="3827675">:=</span>&nbsp;<span class="ident" id="3827678">net</span><span class="op" id="3827681">.</span><span class="ident" id="3827682">ParseIP</span><span class="op" id="3827689">(</span><span class="ident" id="3827690">candidateIP</span><span class="op" id="3827701">)</span><span class="op" id="3827702">;</span>&nbsp;<span class="ident" id="3827704">ip</span>&nbsp;<span class="op" id="3827707">!=</span>&nbsp;<span class="ident" id="3827710">nil</span>&nbsp;<span class="op" id="3827714">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3827718">//&nbsp;We&nbsp;only&nbsp;match&nbsp;IP&nbsp;addresses&nbsp;against&nbsp;IP&nbsp;SANs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3827767">//&nbsp;https://tools.ietf.org/html/rfc6125#appendix-B.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827821">for</span>&nbsp;<span class="ident" id="3827825">_</span><span class="op" id="3827826">,</span>&nbsp;<span class="ident" id="3827828">candidate</span>&nbsp;<span class="op" id="3827838">:=</span>&nbsp;<span class="keyword" id="3827841">range</span>&nbsp;<span class="ident" id="3827847">c</span><span class="op" id="3827848">.</span><span class="ident" id="3827849">IPAddresses</span>&nbsp;<span class="op" id="3827861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827866">if</span>&nbsp;<span class="ident" id="3827869">ip</span><span class="op" id="3827871">.</span><span class="ident" id="3827872">Equal</span><span class="op" id="3827877">(</span><span class="ident" id="3827878">candidate</span><span class="op" id="3827887">)</span>&nbsp;<span class="op" id="3827889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827895">return</span>&nbsp;<span class="ident" id="3827902">nil</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3827909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3827913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827917">return</span>&nbsp;<span class="ident" id="3827924">HostnameError</span><span class="op" id="3827937">{</span><span class="ident" id="3827938">c</span><span class="op" id="3827939">,</span>&nbsp;<span class="ident" id="3827941">candidateIP</span><span class="op" id="3827952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3827955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3827959">lowered</span>&nbsp;<span class="op" id="3827967">:=</span>&nbsp;<span class="ident" id="3827970">toLowerCaseASCII</span><span class="op" id="3827986">(</span><span class="ident" id="3827987">h</span><span class="op" id="3827988">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3827992">if</span>&nbsp;<span class="builtinfunc" id="3827995">len</span><span class="op" id="3827998">(</span><span class="ident" id="3827999">c</span><span class="op" id="3828000">.</span><span class="ident" id="3828001">DNSNames</span><span class="op" id="3828009">)</span>&nbsp;<span class="op" id="3828011">&gt;</span>&nbsp;<span class="num" id="3828013">0</span>&nbsp;<span class="op" id="3828015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3828019">for</span>&nbsp;<span class="ident" id="3828023">_</span><span class="op" id="3828024">,</span>&nbsp;<span class="ident" id="3828026">match</span>&nbsp;<span class="op" id="3828032">:=</span>&nbsp;<span class="keyword" id="3828035">range</span>&nbsp;<span class="ident" id="3828041">c</span><span class="op" id="3828042">.</span><span class="ident" id="3828043">DNSNames</span>&nbsp;<span class="op" id="3828052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3828057">if</span>&nbsp;<span class="ident" id="3828060">matchHostnames</span><span class="op" id="3828074">(</span><span class="ident" id="3828075">toLowerCaseASCII</span><span class="op" id="3828091">(</span><span class="ident" id="3828092">match</span><span class="op" id="3828097">)</span><span class="op" id="3828098">,</span>&nbsp;<span class="ident" id="3828100">lowered</span><span class="op" id="3828107">)</span>&nbsp;<span class="op" id="3828109">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3828115">return</span>&nbsp;<span class="ident" id="3828122">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3828129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3828133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3828137">//&nbsp;If&nbsp;Subject&nbsp;Alt&nbsp;Name&nbsp;is&nbsp;given,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;common&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3828198">}</span>&nbsp;<span class="keyword" id="3828200">else</span>&nbsp;<span class="keyword" id="3828205">if</span>&nbsp;<span class="ident" id="3828208">matchHostnames</span><span class="op" id="3828222">(</span><span class="ident" id="3828223">toLowerCaseASCII</span><span class="op" id="3828239">(</span><span class="ident" id="3828240">c</span><span class="op" id="3828241">.</span><span class="ident" id="3828242">Subject</span><span class="op" id="3828249">.</span><span class="ident" id="3828250">CommonName</span><span class="op" id="3828260">)</span><span class="op" id="3828261">,</span>&nbsp;<span class="ident" id="3828263">lowered</span><span class="op" id="3828270">)</span>&nbsp;<span class="op" id="3828272">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3828276">return</span>&nbsp;<span class="ident" id="3828283">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3828288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3828292">return</span>&nbsp;<span class="ident" id="3828299">HostnameError</span><span class="op" id="3828312">{</span><span class="ident" id="3828313">c</span><span class="op" id="3828314">,</span>&nbsp;<span class="ident" id="3828316">h</span><span class="op" id="3828317">}</span><br>
<span class="lineno"></span><span class="op" id="3828319">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="3828322">func</span>&nbsp;<span class="ident" id="3828327">checkChainForKeyUsage</span><span class="op" id="3828348">(</span><span class="ident" id="3828349">chain</span>&nbsp;<span class="op" id="3828355">[</span><span class="op" id="3828356">]</span><span class="op" id="3828357">*</span><span class="ident" id="3828358">Certificate</span><span class="op" id="3828369">,</span>&nbsp;<span class="ident" id="3828371">keyUsages</span>&nbsp;<span class="op" id="3828381">[</span><span class="op" id="3828382">]</span><span class="ident" id="3828383">ExtKeyUsage</span><span class="op" id="3828394">)</span>&nbsp;<span class="builtintype" id="3828396">bool</span>&nbsp;<span class="op" id="3828401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828404">usages</span>&nbsp;<span class="op" id="3828411">:=</span>&nbsp;<span class="builtinfunc" id="3828414">make</span><span class="op" id="3828418">(</span><span class="op" id="3828419">[</span><span class="op" id="3828420">]</span><span class="ident" id="3828421">ExtKeyUsage</span><span class="op" id="3828432">,</span>&nbsp;<span class="builtinfunc" id="3828434">len</span><span class="op" id="3828437">(</span><span class="ident" id="3828438">keyUsages</span><span class="op" id="3828447">)</span><span class="op" id="3828448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3828451">copy</span><span class="op" id="3828455">(</span><span class="ident" id="3828456">usages</span><span class="op" id="3828462">,</span>&nbsp;<span class="ident" id="3828464">keyUsages</span><span class="op" id="3828473">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3828477">if</span>&nbsp;<span class="builtinfunc" id="3828480">len</span><span class="op" id="3828483">(</span><span class="ident" id="3828484">chain</span><span class="op" id="3828489">)</span>&nbsp;<span class="op" id="3828491">==</span>&nbsp;<span class="num" id="3828494">0</span>&nbsp;<span class="op" id="3828496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3828500">return</span>&nbsp;<span class="builtintype" id="3828507">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3828514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828518">usagesRemaining</span>&nbsp;<span class="op" id="3828534">:=</span>&nbsp;<span class="builtinfunc" id="3828537">len</span><span class="op" id="3828540">(</span><span class="ident" id="3828541">usages</span><span class="op" id="3828547">)</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3828551">//&nbsp;We&nbsp;walk&nbsp;down&nbsp;the&nbsp;list&nbsp;and&nbsp;cross&nbsp;out&nbsp;any&nbsp;usages&nbsp;that&nbsp;aren&#39;t&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3828624">//&nbsp;by&nbsp;each&nbsp;certificate.&nbsp;If&nbsp;we&nbsp;cross&nbsp;out&nbsp;all&nbsp;the&nbsp;usages,&nbsp;then&nbsp;the&nbsp;chain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3828696">//&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="ident" id="3828717">NextCert</span><span class="op" id="3828725">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3828728">for</span>&nbsp;<span class="ident" id="3828732">i</span>&nbsp;<span class="op" id="3828734">:=</span>&nbsp;<span class="builtinfunc" id="3828737">len</span><span class="op" id="3828740">(</span><span class="ident" id="3828741">chain</span><span class="op" id="3828746">)</span>&nbsp;<span class="op" id="3828748">-</span>&nbsp;<span class="num" id="3828750">1</span><span class="op" id="3828751">;</span>&nbsp;<span class="ident" id="3828753">i</span>&nbsp;<span class="op" id="3828755">&gt;=</span>&nbsp;<span class="num" id="3828758">0</span><span class="op" id="3828759">;</span>&nbsp;<span class="ident" id="3828761">i</span><span class="op" id="3828762">--</span>&nbsp;<span class="op" id="3828765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3828769">cert</span>&nbsp;<span class="op" id="3828774">:=</span>&nbsp;<span class="ident" id="3828777">chain</span><span class="op" id="3828782">[</span><span class="ident" id="3828783">i</span><span class="op" id="3828784">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3828788">if</span>&nbsp;<span class="builtinfunc" id="3828791">len</span><span class="op" id="3828794">(</span><span class="ident" id="3828795">cert</span><span class="op" id="3828799">.</span><span class="ident" id="3828800">ExtKeyUsage</span><span class="op" id="3828811">)</span>&nbsp;<span class="op" id="3828813">==</span>&nbsp;<span class="num" id="3828816">0</span>&nbsp;<span class="op" id="3828818">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3828821">len</span><span class="op" id="3828824">(</span><span class="ident" id="3828825">cert</span><span class="op" id="3828829">.</span><span class="ident" id="3828830">UnknownExtKeyUsage</span><span class="op" id="3828848">)</span>&nbsp;<span class="op" id="3828850">==</span>&nbsp;<span class="num" id="3828853">0</span>&nbsp;<span class="op" id="3828855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3828860">//&nbsp;The&nbsp;certificate&nbsp;doesn&#39;t&nbsp;have&nbsp;any&nbsp;extended&nbsp;key&nbsp;usage&nbsp;specified.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3828929">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3828940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3828945">for</span>&nbsp;<span class="ident" id="3828949">_</span><span class="op" id="3828950">,</span>&nbsp;<span class="ident" id="3828952">usage</span>&nbsp;<span class="op" id="3828958">:=</span>&nbsp;<span class="keyword" id="3828961">range</span>&nbsp;<span class="ident" id="3828967">cert</span><span class="op" id="3828971">.</span><span class="ident" id="3828972">ExtKeyUsage</span>&nbsp;<span class="op" id="3828984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3828989">if</span>&nbsp;<span class="ident" id="3828992">usage</span>&nbsp;<span class="op" id="3828998">==</span>&nbsp;<span class="ident" id="3829001">ExtKeyUsageAny</span>&nbsp;<span class="op" id="3829016">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3829022">//&nbsp;The&nbsp;certificate&nbsp;is&nbsp;explicitly&nbsp;good&nbsp;for&nbsp;any&nbsp;usage.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829079">continue</span>&nbsp;<span class="ident" id="3829088">NextCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3829100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3829104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829109">const</span>&nbsp;<span class="ident" id="3829115">invalidUsage</span>&nbsp;<span class="ident" id="3829128">ExtKeyUsage</span>&nbsp;<span class="op" id="3829140">=</span>&nbsp;<span class="op" id="3829142">-</span><span class="num" id="3829143">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829147">NextRequestedUsage</span><span class="op" id="3829165">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829169">for</span>&nbsp;<span class="ident" id="3829173">i</span><span class="op" id="3829174">,</span>&nbsp;<span class="ident" id="3829176">requestedUsage</span>&nbsp;<span class="op" id="3829191">:=</span>&nbsp;<span class="keyword" id="3829194">range</span>&nbsp;<span class="ident" id="3829200">usages</span>&nbsp;<span class="op" id="3829207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829212">if</span>&nbsp;<span class="ident" id="3829215">requestedUsage</span>&nbsp;<span class="op" id="3829230">==</span>&nbsp;<span class="ident" id="3829233">invalidUsage</span>&nbsp;<span class="op" id="3829246">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829252">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3829264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829270">for</span>&nbsp;<span class="ident" id="3829274">_</span><span class="op" id="3829275">,</span>&nbsp;<span class="ident" id="3829277">usage</span>&nbsp;<span class="op" id="3829283">:=</span>&nbsp;<span class="keyword" id="3829286">range</span>&nbsp;<span class="ident" id="3829292">cert</span><span class="op" id="3829296">.</span><span class="ident" id="3829297">ExtKeyUsage</span>&nbsp;<span class="op" id="3829309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829315">if</span>&nbsp;<span class="ident" id="3829318">requestedUsage</span>&nbsp;<span class="op" id="3829333">==</span>&nbsp;<span class="ident" id="3829336">usage</span>&nbsp;<span class="op" id="3829342">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829349">continue</span>&nbsp;<span class="ident" id="3829358">NextRequestedUsage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3829381">}</span>&nbsp;<span class="keyword" id="3829383">else</span>&nbsp;<span class="keyword" id="3829388">if</span>&nbsp;<span class="ident" id="3829391">requestedUsage</span>&nbsp;<span class="op" id="3829406">==</span>&nbsp;<span class="ident" id="3829409">ExtKeyUsageServerAuth</span>&nbsp;<span class="op" id="3829431">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3829439">(</span><span class="ident" id="3829440">usage</span>&nbsp;<span class="op" id="3829446">==</span>&nbsp;<span class="ident" id="3829449">ExtKeyUsageNetscapeServerGatedCrypto</span>&nbsp;<span class="op" id="3829486">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829495">usage</span>&nbsp;<span class="op" id="3829501">==</span>&nbsp;<span class="ident" id="3829504">ExtKeyUsageMicrosoftServerGatedCrypto</span><span class="op" id="3829541">)</span>&nbsp;<span class="op" id="3829543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3829550">//&nbsp;In&nbsp;order&nbsp;to&nbsp;support&nbsp;COMODO</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3829585">//&nbsp;certificate&nbsp;chains,&nbsp;we&nbsp;have&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3829624">//&nbsp;accept&nbsp;Netscape&nbsp;or&nbsp;Microsoft&nbsp;SGC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3829665">//&nbsp;usages&nbsp;as&nbsp;equal&nbsp;to&nbsp;ServerAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829704">continue</span>&nbsp;<span class="ident" id="3829713">NextRequestedUsage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3829736">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3829741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829747">usages</span><span class="op" id="3829753">[</span><span class="ident" id="3829754">i</span><span class="op" id="3829755">]</span>&nbsp;<span class="op" id="3829757">=</span>&nbsp;<span class="ident" id="3829759">invalidUsage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3829775">usagesRemaining</span><span class="op" id="3829790">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829796">if</span>&nbsp;<span class="ident" id="3829799">usagesRemaining</span>&nbsp;<span class="op" id="3829815">==</span>&nbsp;<span class="num" id="3829818">0</span>&nbsp;<span class="op" id="3829820">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829826">return</span>&nbsp;<span class="builtintype" id="3829833">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3829842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3829846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3829849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3829853">return</span>&nbsp;<span class="builtintype" id="3829860">true</span><br>
<span class="lineno"></span><span class="op" id="3829865">}</span>
</div>
</body>
</html>
