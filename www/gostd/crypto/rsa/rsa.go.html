<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html" class="current">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2941350">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2941405">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2941459">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2941510">//&nbsp;Package&nbsp;rsa&nbsp;implements&nbsp;RSA&nbsp;encryption&nbsp;as&nbsp;specified&nbsp;in&nbsp;PKCS#1.</span><br>
<span class="lineno"></span><span class="keyword" id="2941575">package</span>&nbsp;<span class="ident" id="2941583">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2941588">import</span>&nbsp;<span class="op" id="2941595">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2941598">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2941608">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2941623">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2941640">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2941650">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2941658">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2941664">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="2941675">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2941678">var</span>&nbsp;<span class="ident" id="2941682">bigZero</span>&nbsp;<span class="op" id="2941690">=</span>&nbsp;<span class="ident" id="2941692">big</span><span class="op" id="2941695">.</span><span class="ident" id="2941696">NewInt</span><span class="op" id="2941702">(</span><span class="num" id="2941703">0</span><span class="op" id="2941704">)</span><br>
<span class="lineno"></span><span class="keyword" id="2941706">var</span>&nbsp;<span class="ident" id="2941710">bigOne</span>&nbsp;<span class="op" id="2941717">=</span>&nbsp;<span class="ident" id="2941719">big</span><span class="op" id="2941722">.</span><span class="ident" id="2941723">NewInt</span><span class="op" id="2941729">(</span><span class="num" id="2941730">1</span><span class="op" id="2941731">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="2941734">//&nbsp;A&nbsp;PublicKey&nbsp;represents&nbsp;the&nbsp;public&nbsp;part&nbsp;of&nbsp;an&nbsp;RSA&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="2941791">type</span>&nbsp;<span class="ident" id="2941796">PublicKey</span>&nbsp;<span class="keyword" id="2941806">struct</span>&nbsp;<span class="op" id="2941813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2941816">N</span>&nbsp;<span class="op" id="2941818">*</span><span class="ident" id="2941819">big</span><span class="op" id="2941822">.</span><span class="ident" id="2941823">Int</span>&nbsp;<span class="comment" id="2941827">//&nbsp;modulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2941839">E</span>&nbsp;<span class="builtintype" id="2941841">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2941850">//&nbsp;public&nbsp;exponent</span><br>
<span class="lineno">25</span><span class="op" id="2941869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2941872">var</span>&nbsp;<span class="op" id="2941876">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2941879">errPublicModulus</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2941902">=</span>&nbsp;<span class="ident" id="2941904">errors</span><span class="op" id="2941910">.</span><span class="ident" id="2941911">New</span><span class="op" id="2941914">(</span><span class="string" id="2941915">&#34;crypto/rsa:&nbsp;missing&nbsp;public&nbsp;modulus&#34;</span><span class="op" id="2941951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2941954">errPublicExponentSmall</span>&nbsp;<span class="op" id="2941977">=</span>&nbsp;<span class="ident" id="2941979">errors</span><span class="op" id="2941985">.</span><span class="ident" id="2941986">New</span><span class="op" id="2941989">(</span><span class="string" id="2941990">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;small&#34;</span><span class="op" id="2942029">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2942032">errPublicExponentLarge</span>&nbsp;<span class="op" id="2942055">=</span>&nbsp;<span class="ident" id="2942057">errors</span><span class="op" id="2942063">.</span><span class="ident" id="2942064">New</span><span class="op" id="2942067">(</span><span class="string" id="2942068">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;large&#34;</span><span class="op" id="2942107">)</span><br>
<span class="lineno"></span><span class="op" id="2942109">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2942112">//&nbsp;checkPub&nbsp;sanity&nbsp;checks&nbsp;the&nbsp;public&nbsp;key&nbsp;before&nbsp;we&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="2942171">//&nbsp;We&nbsp;require&nbsp;pub.E&nbsp;to&nbsp;fit&nbsp;into&nbsp;a&nbsp;32-bit&nbsp;integer&nbsp;so&nbsp;that&nbsp;we</span><br>
<span class="lineno">35</span><span class="comment" id="2942231">//&nbsp;do&nbsp;not&nbsp;have&nbsp;different&nbsp;behavior&nbsp;depending&nbsp;on&nbsp;whether</span><br>
<span class="lineno"></span><span class="comment" id="2942286">//&nbsp;int&nbsp;is&nbsp;32&nbsp;or&nbsp;64&nbsp;bits.&nbsp;See&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="2942320">//&nbsp;http://www.imperialviolet.org/2012/03/16/rsae.html.</span><br>
<span class="lineno"></span><span class="keyword" id="2942375">func</span>&nbsp;<span class="ident" id="2942380">checkPub</span><span class="op" id="2942388">(</span><span class="ident" id="2942389">pub</span>&nbsp;<span class="op" id="2942393">*</span><span class="ident" id="2942394">PublicKey</span><span class="op" id="2942403">)</span>&nbsp;<span class="builtintype" id="2942405">error</span>&nbsp;<span class="op" id="2942411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2942414">if</span>&nbsp;<span class="ident" id="2942417">pub</span><span class="op" id="2942420">.</span><span class="ident" id="2942421">N</span>&nbsp;<span class="op" id="2942423">==</span>&nbsp;<span class="builtintype" id="2942426">nil</span>&nbsp;<span class="op" id="2942430">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2942434">return</span>&nbsp;<span class="ident" id="2942441">errPublicModulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2942459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2942462">if</span>&nbsp;<span class="ident" id="2942465">pub</span><span class="op" id="2942468">.</span><span class="ident" id="2942469">E</span>&nbsp;<span class="op" id="2942471">&lt;</span>&nbsp;<span class="num" id="2942473">2</span>&nbsp;<span class="op" id="2942475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2942479">return</span>&nbsp;<span class="ident" id="2942486">errPublicExponentSmall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2942510">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2942513">if</span>&nbsp;<span class="ident" id="2942516">pub</span><span class="op" id="2942519">.</span><span class="ident" id="2942520">E</span>&nbsp;<span class="op" id="2942522">&gt;</span>&nbsp;<span class="num" id="2942524">1</span><span class="op" id="2942525">&lt;&lt;</span><span class="num" id="2942527">31</span><span class="op" id="2942529">-</span><span class="num" id="2942530">1</span>&nbsp;<span class="op" id="2942532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2942536">return</span>&nbsp;<span class="ident" id="2942543">errPublicExponentLarge</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2942567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2942570">return</span>&nbsp;<span class="builtintype" id="2942577">nil</span><br>
<span class="lineno"></span><span class="op" id="2942581">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2942584">//&nbsp;A&nbsp;PrivateKey&nbsp;represents&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword" id="2942622">type</span>&nbsp;<span class="ident" id="2942627">PrivateKey</span>&nbsp;<span class="keyword" id="2942638">struct</span>&nbsp;<span class="op" id="2942645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2942648">PublicKey</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2942669">//&nbsp;public&nbsp;part.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2942686">D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2942696">*</span><span class="ident" id="2942697">big</span><span class="op" id="2942700">.</span><span class="ident" id="2942701">Int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="2942707">//&nbsp;private&nbsp;exponent</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2942728">Primes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2942738">[</span><span class="op" id="2942739">]</span><span class="op" id="2942740">*</span><span class="ident" id="2942741">big</span><span class="op" id="2942744">.</span><span class="ident" id="2942745">Int</span>&nbsp;<span class="comment" id="2942749">//&nbsp;prime&nbsp;factors&nbsp;of&nbsp;N,&nbsp;has&nbsp;&gt;=&nbsp;2&nbsp;elements.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2942793">//&nbsp;Precomputed&nbsp;contains&nbsp;precomputed&nbsp;values&nbsp;that&nbsp;speed&nbsp;up&nbsp;private</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2942859">//&nbsp;operations,&nbsp;if&nbsp;available.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2942889">Precomputed</span>&nbsp;<span class="ident" id="2942901">PrecomputedValues</span><br>
<span class="lineno">60</span><span class="op" id="2942919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2942922">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno"></span><span class="keyword" id="2942978">func</span>&nbsp;<span class="op" id="2942983">(</span><span class="ident" id="2942984">priv</span>&nbsp;<span class="op" id="2942989">*</span><span class="ident" id="2942990">PrivateKey</span><span class="op" id="2943000">)</span>&nbsp;<span class="ident" id="2943002">Public</span><span class="op" id="2943008">(</span><span class="op" id="2943009">)</span>&nbsp;<span class="ident" id="2943011">crypto</span><span class="op" id="2943017">.</span><span class="ident" id="2943018">PublicKey</span>&nbsp;<span class="op" id="2943028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2943031">return</span>&nbsp;<span class="op" id="2943038">&amp;</span><span class="ident" id="2943039">priv</span><span class="op" id="2943043">.</span><span class="ident" id="2943044">PublicKey</span><br>
<span class="lineno">65</span><span class="op" id="2943054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2943057">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;If&nbsp;opts&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2943129">//&nbsp;*PSSOptions&nbsp;then&nbsp;the&nbsp;PSS&nbsp;algorithm&nbsp;will&nbsp;be&nbsp;used,&nbsp;otherwise&nbsp;PKCS#1&nbsp;v1.5&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="2943208">//&nbsp;be&nbsp;used.&nbsp;This&nbsp;method&nbsp;is&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="2943286">//&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign*</span><br>
<span class="lineno"></span><span class="comment" id="2943363">//&nbsp;functions&nbsp;in&nbsp;this&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="2943393">func</span>&nbsp;<span class="op" id="2943398">(</span><span class="ident" id="2943399">priv</span>&nbsp;<span class="op" id="2943404">*</span><span class="ident" id="2943405">PrivateKey</span><span class="op" id="2943415">)</span>&nbsp;<span class="ident" id="2943417">Sign</span><span class="op" id="2943421">(</span><span class="ident" id="2943422">rand</span>&nbsp;<span class="ident" id="2943427">io</span><span class="op" id="2943429">.</span><span class="ident" id="2943430">Reader</span><span class="op" id="2943436">,</span>&nbsp;<span class="ident" id="2943438">msg</span>&nbsp;<span class="op" id="2943442">[</span><span class="op" id="2943443">]</span><span class="builtintype" id="2943444">byte</span><span class="op" id="2943448">,</span>&nbsp;<span class="ident" id="2943450">opts</span>&nbsp;<span class="ident" id="2943455">crypto</span><span class="op" id="2943461">.</span><span class="ident" id="2943462">SignerOpts</span><span class="op" id="2943472">)</span>&nbsp;<span class="op" id="2943474">(</span><span class="op" id="2943475">[</span><span class="op" id="2943476">]</span><span class="builtintype" id="2943477">byte</span><span class="op" id="2943481">,</span>&nbsp;<span class="builtintype" id="2943483">error</span><span class="op" id="2943488">)</span>&nbsp;<span class="op" id="2943490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2943493">if</span>&nbsp;<span class="ident" id="2943496">pssOpts</span><span class="op" id="2943503">,</span>&nbsp;<span class="ident" id="2943505">ok</span>&nbsp;<span class="op" id="2943508">:=</span>&nbsp;<span class="ident" id="2943511">opts</span><span class="op" id="2943515">.</span><span class="op" id="2943516">(</span><span class="op" id="2943517">*</span><span class="ident" id="2943518">PSSOptions</span><span class="op" id="2943528">)</span><span class="op" id="2943529">;</span>&nbsp;<span class="ident" id="2943531">ok</span>&nbsp;<span class="op" id="2943534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2943538">return</span>&nbsp;<span class="ident" id="2943545">SignPSS</span><span class="op" id="2943552">(</span><span class="ident" id="2943553">rand</span><span class="op" id="2943557">,</span>&nbsp;<span class="ident" id="2943559">priv</span><span class="op" id="2943563">,</span>&nbsp;<span class="ident" id="2943565">pssOpts</span><span class="op" id="2943572">.</span><span class="ident" id="2943573">Hash</span><span class="op" id="2943577">,</span>&nbsp;<span class="ident" id="2943579">msg</span><span class="op" id="2943582">,</span>&nbsp;<span class="ident" id="2943584">pssOpts</span><span class="op" id="2943591">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2943594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2943598">return</span>&nbsp;<span class="ident" id="2943605">SignPKCS1v15</span><span class="op" id="2943617">(</span><span class="ident" id="2943618">rand</span><span class="op" id="2943622">,</span>&nbsp;<span class="ident" id="2943624">priv</span><span class="op" id="2943628">,</span>&nbsp;<span class="ident" id="2943630">opts</span><span class="op" id="2943634">.</span><span class="ident" id="2943635">HashFunc</span><span class="op" id="2943643">(</span><span class="op" id="2943644">)</span><span class="op" id="2943645">,</span>&nbsp;<span class="ident" id="2943647">msg</span><span class="op" id="2943650">)</span><br>
<span class="lineno"></span><span class="op" id="2943652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="2943655">type</span>&nbsp;<span class="ident" id="2943660">PrecomputedValues</span>&nbsp;<span class="keyword" id="2943678">struct</span>&nbsp;<span class="op" id="2943685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2943688">Dp</span><span class="op" id="2943690">,</span>&nbsp;<span class="ident" id="2943692">Dq</span>&nbsp;<span class="op" id="2943695">*</span><span class="ident" id="2943696">big</span><span class="op" id="2943699">.</span><span class="ident" id="2943700">Int</span>&nbsp;<span class="comment" id="2943704">//&nbsp;D&nbsp;mod&nbsp;(P-1)&nbsp;(or&nbsp;mod&nbsp;Q-1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2943733">Qinv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2943740">*</span><span class="ident" id="2943741">big</span><span class="op" id="2943744">.</span><span class="ident" id="2943745">Int</span>&nbsp;<span class="comment" id="2943749">//&nbsp;Q^-1&nbsp;mod&nbsp;P</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2943765">//&nbsp;CRTValues&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;3rd&nbsp;and&nbsp;subsequent&nbsp;primes.&nbsp;Due&nbsp;to&nbsp;a</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2943831">//&nbsp;historical&nbsp;accident,&nbsp;the&nbsp;CRT&nbsp;for&nbsp;the&nbsp;first&nbsp;two&nbsp;primes&nbsp;is&nbsp;handled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2943900">//&nbsp;differently&nbsp;in&nbsp;PKCS#1&nbsp;and&nbsp;interoperability&nbsp;is&nbsp;sufficiently</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2943963">//&nbsp;important&nbsp;that&nbsp;we&nbsp;mirror&nbsp;this.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2943998">CRTValues</span>&nbsp;<span class="op" id="2944008">[</span><span class="op" id="2944009">]</span><span class="ident" id="2944010">CRTValue</span><br>
<span class="lineno"></span><span class="op" id="2944019">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="2944022">//&nbsp;CRTValue&nbsp;contains&nbsp;the&nbsp;precomputed&nbsp;chinese&nbsp;remainder&nbsp;theorem&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="2944093">type</span>&nbsp;<span class="ident" id="2944098">CRTValue</span>&nbsp;<span class="keyword" id="2944107">struct</span>&nbsp;<span class="op" id="2944114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2944117">Exp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2944123">*</span><span class="ident" id="2944124">big</span><span class="op" id="2944127">.</span><span class="ident" id="2944128">Int</span>&nbsp;<span class="comment" id="2944132">//&nbsp;D&nbsp;mod&nbsp;(prime-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2944153">Coeff</span>&nbsp;<span class="op" id="2944159">*</span><span class="ident" id="2944160">big</span><span class="op" id="2944163">.</span><span class="ident" id="2944164">Int</span>&nbsp;<span class="comment" id="2944168">//&nbsp;R·Coeff&nbsp;≡&nbsp;1&nbsp;mod&nbsp;Prime.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2944198">R</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2944204">*</span><span class="ident" id="2944205">big</span><span class="op" id="2944208">.</span><span class="ident" id="2944209">Int</span>&nbsp;<span class="comment" id="2944213">//&nbsp;product&nbsp;of&nbsp;primes&nbsp;prior&nbsp;to&nbsp;this&nbsp;(inc&nbsp;p&nbsp;and&nbsp;q).</span><br>
<span class="lineno"></span><span class="op" id="2944263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2944266">//&nbsp;Validate&nbsp;performs&nbsp;basic&nbsp;sanity&nbsp;checks&nbsp;on&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="2944319">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;the&nbsp;key&nbsp;is&nbsp;valid,&nbsp;or&nbsp;else&nbsp;an&nbsp;error&nbsp;describing&nbsp;a&nbsp;problem.</span><br>
<span class="lineno">100</span><span class="keyword" id="2944397">func</span>&nbsp;<span class="op" id="2944402">(</span><span class="ident" id="2944403">priv</span>&nbsp;<span class="op" id="2944408">*</span><span class="ident" id="2944409">PrivateKey</span><span class="op" id="2944419">)</span>&nbsp;<span class="ident" id="2944421">Validate</span><span class="op" id="2944429">(</span><span class="op" id="2944430">)</span>&nbsp;<span class="builtintype" id="2944432">error</span>&nbsp;<span class="op" id="2944438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2944441">if</span>&nbsp;<span class="ident" id="2944444">err</span>&nbsp;<span class="op" id="2944448">:=</span>&nbsp;<span class="ident" id="2944451">checkPub</span><span class="op" id="2944459">(</span><span class="op" id="2944460">&amp;</span><span class="ident" id="2944461">priv</span><span class="op" id="2944465">.</span><span class="ident" id="2944466">PublicKey</span><span class="op" id="2944475">)</span><span class="op" id="2944476">;</span>&nbsp;<span class="ident" id="2944478">err</span>&nbsp;<span class="op" id="2944482">!=</span>&nbsp;<span class="builtintype" id="2944485">nil</span>&nbsp;<span class="op" id="2944489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2944493">return</span>&nbsp;<span class="ident" id="2944500">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2944505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2944509">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;prime&nbsp;factors&nbsp;are&nbsp;actually&nbsp;prime.&nbsp;Note&nbsp;that&nbsp;this&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2944580">//&nbsp;just&nbsp;a&nbsp;sanity&nbsp;check.&nbsp;Since&nbsp;the&nbsp;random&nbsp;witnesses&nbsp;chosen&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2944642">//&nbsp;ProbablyPrime&nbsp;are&nbsp;deterministic,&nbsp;given&nbsp;the&nbsp;candidate&nbsp;number,&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2944712">//&nbsp;easy&nbsp;for&nbsp;an&nbsp;attack&nbsp;to&nbsp;generate&nbsp;composites&nbsp;that&nbsp;pass&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2944779">for</span>&nbsp;<span class="ident" id="2944783">_</span><span class="op" id="2944784">,</span>&nbsp;<span class="ident" id="2944786">prime</span>&nbsp;<span class="op" id="2944792">:=</span>&nbsp;<span class="keyword" id="2944795">range</span>&nbsp;<span class="ident" id="2944801">priv</span><span class="op" id="2944805">.</span><span class="ident" id="2944806">Primes</span>&nbsp;<span class="op" id="2944813">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2944817">if</span>&nbsp;<span class="op" id="2944820">!</span><span class="ident" id="2944821">prime</span><span class="op" id="2944826">.</span><span class="ident" id="2944827">ProbablyPrime</span><span class="op" id="2944840">(</span><span class="num" id="2944841">20</span><span class="op" id="2944843">)</span>&nbsp;<span class="op" id="2944845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2944850">return</span>&nbsp;<span class="ident" id="2944857">errors</span><span class="op" id="2944863">.</span><span class="ident" id="2944864">New</span><span class="op" id="2944867">(</span><span class="string" id="2944868">&#34;crypto/rsa:&nbsp;prime&nbsp;factor&nbsp;is&nbsp;composite&#34;</span><span class="op" id="2944907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2944911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2944914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2944918">//&nbsp;Check&nbsp;that&nbsp;Πprimes&nbsp;==&nbsp;n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2944948">modulus</span>&nbsp;<span class="op" id="2944956">:=</span>&nbsp;<span class="builtinfunc" id="2944959">new</span><span class="op" id="2944962">(</span><span class="ident" id="2944963">big</span><span class="op" id="2944966">.</span><span class="ident" id="2944967">Int</span><span class="op" id="2944970">)</span><span class="op" id="2944971">.</span><span class="ident" id="2944972">Set</span><span class="op" id="2944975">(</span><span class="ident" id="2944976">bigOne</span><span class="op" id="2944982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2944985">for</span>&nbsp;<span class="ident" id="2944989">_</span><span class="op" id="2944990">,</span>&nbsp;<span class="ident" id="2944992">prime</span>&nbsp;<span class="op" id="2944998">:=</span>&nbsp;<span class="keyword" id="2945001">range</span>&nbsp;<span class="ident" id="2945007">priv</span><span class="op" id="2945011">.</span><span class="ident" id="2945012">Primes</span>&nbsp;<span class="op" id="2945019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2945023">modulus</span><span class="op" id="2945030">.</span><span class="ident" id="2945031">Mul</span><span class="op" id="2945034">(</span><span class="ident" id="2945035">modulus</span><span class="op" id="2945042">,</span>&nbsp;<span class="ident" id="2945044">prime</span><span class="op" id="2945049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2945052">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2945055">if</span>&nbsp;<span class="ident" id="2945058">modulus</span><span class="op" id="2945065">.</span><span class="ident" id="2945066">Cmp</span><span class="op" id="2945069">(</span><span class="ident" id="2945070">priv</span><span class="op" id="2945074">.</span><span class="ident" id="2945075">N</span><span class="op" id="2945076">)</span>&nbsp;<span class="op" id="2945078">!=</span>&nbsp;<span class="num" id="2945081">0</span>&nbsp;<span class="op" id="2945083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2945087">return</span>&nbsp;<span class="ident" id="2945094">errors</span><span class="op" id="2945100">.</span><span class="ident" id="2945101">New</span><span class="op" id="2945104">(</span><span class="string" id="2945105">&#34;crypto/rsa:&nbsp;invalid&nbsp;modulus&#34;</span><span class="op" id="2945134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2945137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2945141">//&nbsp;Check&nbsp;that&nbsp;de&nbsp;≡&nbsp;1&nbsp;mod&nbsp;p-1,&nbsp;for&nbsp;each&nbsp;prime.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2945190">//&nbsp;This&nbsp;implies&nbsp;that&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;each&nbsp;p-1&nbsp;as&nbsp;e&nbsp;has&nbsp;a&nbsp;multiplicative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2945263">//&nbsp;inverse.&nbsp;Therefore&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;lcm(p-1,q-1,r-1,...)&nbsp;=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2945325">//&nbsp;exponent(ℤ/nℤ).&nbsp;It&nbsp;also&nbsp;implies&nbsp;that&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;p&nbsp;as&nbsp;a^(p-1)&nbsp;≡&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2945404">//&nbsp;mod&nbsp;p.&nbsp;Thus&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;n&nbsp;for&nbsp;all&nbsp;a&nbsp;coprime&nbsp;to&nbsp;n,&nbsp;as&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2945474">congruence</span>&nbsp;<span class="op" id="2945485">:=</span>&nbsp;<span class="builtinfunc" id="2945488">new</span><span class="op" id="2945491">(</span><span class="ident" id="2945492">big</span><span class="op" id="2945495">.</span><span class="ident" id="2945496">Int</span><span class="op" id="2945499">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2945502">de</span>&nbsp;<span class="op" id="2945505">:=</span>&nbsp;<span class="builtinfunc" id="2945508">new</span><span class="op" id="2945511">(</span><span class="ident" id="2945512">big</span><span class="op" id="2945515">.</span><span class="ident" id="2945516">Int</span><span class="op" id="2945519">)</span><span class="op" id="2945520">.</span><span class="ident" id="2945521">SetInt64</span><span class="op" id="2945529">(</span><span class="ident" id="2945530">int64</span><span class="op" id="2945535">(</span><span class="ident" id="2945536">priv</span><span class="op" id="2945540">.</span><span class="ident" id="2945541">E</span><span class="op" id="2945542">)</span><span class="op" id="2945543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2945546">de</span><span class="op" id="2945548">.</span><span class="ident" id="2945549">Mul</span><span class="op" id="2945552">(</span><span class="ident" id="2945553">de</span><span class="op" id="2945555">,</span>&nbsp;<span class="ident" id="2945557">priv</span><span class="op" id="2945561">.</span><span class="ident" id="2945562">D</span><span class="op" id="2945563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2945566">for</span>&nbsp;<span class="ident" id="2945570">_</span><span class="op" id="2945571">,</span>&nbsp;<span class="ident" id="2945573">prime</span>&nbsp;<span class="op" id="2945579">:=</span>&nbsp;<span class="keyword" id="2945582">range</span>&nbsp;<span class="ident" id="2945588">priv</span><span class="op" id="2945592">.</span><span class="ident" id="2945593">Primes</span>&nbsp;<span class="op" id="2945600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2945604">pminus1</span>&nbsp;<span class="op" id="2945612">:=</span>&nbsp;<span class="builtinfunc" id="2945615">new</span><span class="op" id="2945618">(</span><span class="ident" id="2945619">big</span><span class="op" id="2945622">.</span><span class="ident" id="2945623">Int</span><span class="op" id="2945626">)</span><span class="op" id="2945627">.</span><span class="ident" id="2945628">Sub</span><span class="op" id="2945631">(</span><span class="ident" id="2945632">prime</span><span class="op" id="2945637">,</span>&nbsp;<span class="ident" id="2945639">bigOne</span><span class="op" id="2945645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2945649">congruence</span><span class="op" id="2945659">.</span><span class="ident" id="2945660">Mod</span><span class="op" id="2945663">(</span><span class="ident" id="2945664">de</span><span class="op" id="2945666">,</span>&nbsp;<span class="ident" id="2945668">pminus1</span><span class="op" id="2945675">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2945679">if</span>&nbsp;<span class="ident" id="2945682">congruence</span><span class="op" id="2945692">.</span><span class="ident" id="2945693">Cmp</span><span class="op" id="2945696">(</span><span class="ident" id="2945697">bigOne</span><span class="op" id="2945703">)</span>&nbsp;<span class="op" id="2945705">!=</span>&nbsp;<span class="num" id="2945708">0</span>&nbsp;<span class="op" id="2945710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2945715">return</span>&nbsp;<span class="ident" id="2945722">errors</span><span class="op" id="2945728">.</span><span class="ident" id="2945729">New</span><span class="op" id="2945732">(</span><span class="string" id="2945733">&#34;crypto/rsa:&nbsp;invalid&nbsp;exponents&#34;</span><span class="op" id="2945764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2945768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2945771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2945774">return</span>&nbsp;<span class="builtintype" id="2945781">nil</span><br>
<span class="lineno">140</span><span class="op" id="2945785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2945788">//&nbsp;GenerateKey&nbsp;generates&nbsp;an&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit&nbsp;size&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2945860">//&nbsp;random&nbsp;source&nbsp;random&nbsp;(for&nbsp;example,&nbsp;crypto/rand.Reader).</span><br>
<span class="lineno"></span><span class="keyword" id="2945919">func</span>&nbsp;<span class="ident" id="2945924">GenerateKey</span><span class="op" id="2945935">(</span><span class="ident" id="2945936">random</span>&nbsp;<span class="ident" id="2945943">io</span><span class="op" id="2945945">.</span><span class="ident" id="2945946">Reader</span><span class="op" id="2945952">,</span>&nbsp;<span class="ident" id="2945954">bits</span>&nbsp;<span class="builtintype" id="2945959">int</span><span class="op" id="2945962">)</span>&nbsp;<span class="op" id="2945964">(</span><span class="ident" id="2945965">priv</span>&nbsp;<span class="op" id="2945970">*</span><span class="ident" id="2945971">PrivateKey</span><span class="op" id="2945981">,</span>&nbsp;<span class="ident" id="2945983">err</span>&nbsp;<span class="builtintype" id="2945987">error</span><span class="op" id="2945992">)</span>&nbsp;<span class="op" id="2945994">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2945997">return</span>&nbsp;<span class="ident" id="2946004">GenerateMultiPrimeKey</span><span class="op" id="2946025">(</span><span class="ident" id="2946026">random</span><span class="op" id="2946032">,</span>&nbsp;<span class="num" id="2946034">2</span><span class="op" id="2946035">,</span>&nbsp;<span class="ident" id="2946037">bits</span><span class="op" id="2946041">)</span><br>
<span class="lineno"></span><span class="op" id="2946043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2946046">//&nbsp;GenerateMultiPrimeKey&nbsp;generates&nbsp;a&nbsp;multi-prime&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="2946124">//&nbsp;size&nbsp;and&nbsp;the&nbsp;given&nbsp;random&nbsp;source,&nbsp;as&nbsp;suggested&nbsp;in&nbsp;[1].&nbsp;Although&nbsp;the&nbsp;public</span><br>
<span class="lineno">150</span><span class="comment" id="2946202">//&nbsp;keys&nbsp;are&nbsp;compatible&nbsp;(actually,&nbsp;indistinguishable)&nbsp;from&nbsp;the&nbsp;2-prime&nbsp;case,</span><br>
<span class="lineno"></span><span class="comment" id="2946278">//&nbsp;the&nbsp;private&nbsp;keys&nbsp;are&nbsp;not.&nbsp;Thus&nbsp;it&nbsp;may&nbsp;not&nbsp;be&nbsp;possible&nbsp;to&nbsp;export&nbsp;multi-prime</span><br>
<span class="lineno"></span><span class="comment" id="2946357">//&nbsp;private&nbsp;keys&nbsp;in&nbsp;certain&nbsp;formats&nbsp;or&nbsp;to&nbsp;subsequently&nbsp;import&nbsp;them&nbsp;into&nbsp;other</span><br>
<span class="lineno"></span><span class="comment" id="2946434">//&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="2946443">//</span><br>
<span class="lineno">155</span><span class="comment" id="2946446">//&nbsp;Table&nbsp;1&nbsp;in&nbsp;[2]&nbsp;suggests&nbsp;maximum&nbsp;numbers&nbsp;of&nbsp;primes&nbsp;for&nbsp;a&nbsp;given&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="2946517">//</span><br>
<span class="lineno"></span><span class="comment" id="2946520">//&nbsp;[1]&nbsp;US&nbsp;patent&nbsp;4405829&nbsp;(1972,&nbsp;expired)</span><br>
<span class="lineno"></span><span class="comment" id="2946561">//&nbsp;[2]&nbsp;http://www.cacr.math.uwaterloo.ca/techreports/2006/cacr2006-16.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="2946635">func</span>&nbsp;<span class="ident" id="2946640">GenerateMultiPrimeKey</span><span class="op" id="2946661">(</span><span class="ident" id="2946662">random</span>&nbsp;<span class="ident" id="2946669">io</span><span class="op" id="2946671">.</span><span class="ident" id="2946672">Reader</span><span class="op" id="2946678">,</span>&nbsp;<span class="ident" id="2946680">nprimes</span>&nbsp;<span class="builtintype" id="2946688">int</span><span class="op" id="2946691">,</span>&nbsp;<span class="ident" id="2946693">bits</span>&nbsp;<span class="builtintype" id="2946698">int</span><span class="op" id="2946701">)</span>&nbsp;<span class="op" id="2946703">(</span><span class="ident" id="2946704">priv</span>&nbsp;<span class="op" id="2946709">*</span><span class="ident" id="2946710">PrivateKey</span><span class="op" id="2946720">,</span>&nbsp;<span class="ident" id="2946722">err</span>&nbsp;<span class="builtintype" id="2946726">error</span><span class="op" id="2946731">)</span>&nbsp;<span class="op" id="2946733">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2946736">priv</span>&nbsp;<span class="op" id="2946741">=</span>&nbsp;<span class="builtinfunc" id="2946743">new</span><span class="op" id="2946746">(</span><span class="ident" id="2946747">PrivateKey</span><span class="op" id="2946757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2946760">priv</span><span class="op" id="2946764">.</span><span class="ident" id="2946765">E</span>&nbsp;<span class="op" id="2946767">=</span>&nbsp;<span class="num" id="2946769">65537</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2946777">if</span>&nbsp;<span class="ident" id="2946780">nprimes</span>&nbsp;<span class="op" id="2946788">&lt;</span>&nbsp;<span class="num" id="2946790">2</span>&nbsp;<span class="op" id="2946792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2946796">return</span>&nbsp;<span class="builtintype" id="2946803">nil</span><span class="op" id="2946806">,</span>&nbsp;<span class="ident" id="2946808">errors</span><span class="op" id="2946814">.</span><span class="ident" id="2946815">New</span><span class="op" id="2946818">(</span><span class="string" id="2946819">&#34;crypto/rsa:&nbsp;GenerateMultiPrimeKey:&nbsp;nprimes&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&#34;</span><span class="op" id="2946876">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2946879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2946883">primes</span>&nbsp;<span class="op" id="2946890">:=</span>&nbsp;<span class="builtinfunc" id="2946893">make</span><span class="op" id="2946897">(</span><span class="op" id="2946898">[</span><span class="op" id="2946899">]</span><span class="op" id="2946900">*</span><span class="ident" id="2946901">big</span><span class="op" id="2946904">.</span><span class="ident" id="2946905">Int</span><span class="op" id="2946908">,</span>&nbsp;<span class="ident" id="2946910">nprimes</span><span class="op" id="2946917">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="2946920">NextSetOfPrimes</span><span class="op" id="2946935">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2946938">for</span>&nbsp;<span class="op" id="2946942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2946946">todo</span>&nbsp;<span class="op" id="2946951">:=</span>&nbsp;<span class="ident" id="2946954">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2946961">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2947021">//&nbsp;Thus&nbsp;each&nbsp;prime&nbsp;has&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2947055">//&nbsp;&nbsp;&nbsp;p_i&nbsp;=&nbsp;2^bitlen(p_i)&nbsp;×&nbsp;0.11...&nbsp;(in&nbsp;base&nbsp;2).</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2947106">//&nbsp;And&nbsp;the&nbsp;product&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2947131">//&nbsp;&nbsp;&nbsp;P&nbsp;=&nbsp;2^todo&nbsp;×&nbsp;α</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2947155">//&nbsp;where&nbsp;α&nbsp;is&nbsp;the&nbsp;product&nbsp;of&nbsp;nprimes&nbsp;numbers&nbsp;of&nbsp;the&nbsp;form&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2947223">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2947228">//&nbsp;If&nbsp;α&nbsp;&lt;&nbsp;1/2&nbsp;(which&nbsp;can&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;&gt;&nbsp;2),&nbsp;we&nbsp;need&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2947292">//&nbsp;shift&nbsp;todo&nbsp;to&nbsp;compensate&nbsp;for&nbsp;lost&nbsp;bits:&nbsp;the&nbsp;mean&nbsp;value&nbsp;of&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2947363">//&nbsp;is&nbsp;7/8,&nbsp;so&nbsp;todo&nbsp;+&nbsp;shift&nbsp;-&nbsp;nprimes&nbsp;*&nbsp;log2(7/8)&nbsp;~=&nbsp;bits&nbsp;-&nbsp;1/2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2947428">//&nbsp;will&nbsp;give&nbsp;good&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2947457">if</span>&nbsp;<span class="ident" id="2947460">nprimes</span>&nbsp;<span class="op" id="2947468">&gt;=</span>&nbsp;<span class="num" id="2947471">7</span>&nbsp;<span class="op" id="2947473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2947478">todo</span>&nbsp;<span class="op" id="2947483">+=</span>&nbsp;<span class="op" id="2947486">(</span><span class="ident" id="2947487">nprimes</span>&nbsp;<span class="op" id="2947495">-</span>&nbsp;<span class="num" id="2947497">2</span><span class="op" id="2947498">)</span>&nbsp;<span class="op" id="2947500">/</span>&nbsp;<span class="num" id="2947502">5</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2947506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2947510">for</span>&nbsp;<span class="ident" id="2947514">i</span>&nbsp;<span class="op" id="2947516">:=</span>&nbsp;<span class="num" id="2947519">0</span><span class="op" id="2947520">;</span>&nbsp;<span class="ident" id="2947522">i</span>&nbsp;<span class="op" id="2947524">&lt;</span>&nbsp;<span class="ident" id="2947526">nprimes</span><span class="op" id="2947533">;</span>&nbsp;<span class="ident" id="2947535">i</span><span class="op" id="2947536">++</span>&nbsp;<span class="op" id="2947539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2947544">primes</span><span class="op" id="2947550">[</span><span class="ident" id="2947551">i</span><span class="op" id="2947552">]</span><span class="op" id="2947553">,</span>&nbsp;<span class="ident" id="2947555">err</span>&nbsp;<span class="op" id="2947559">=</span>&nbsp;<span class="ident" id="2947561">rand</span><span class="op" id="2947565">.</span><span class="ident" id="2947566">Prime</span><span class="op" id="2947571">(</span><span class="ident" id="2947572">random</span><span class="op" id="2947578">,</span>&nbsp;<span class="ident" id="2947580">todo</span><span class="op" id="2947584">/</span><span class="op" id="2947585">(</span><span class="ident" id="2947586">nprimes</span><span class="op" id="2947593">-</span><span class="ident" id="2947594">i</span><span class="op" id="2947595">)</span><span class="op" id="2947596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2947601">if</span>&nbsp;<span class="ident" id="2947604">err</span>&nbsp;<span class="op" id="2947608">!=</span>&nbsp;<span class="builtintype" id="2947611">nil</span>&nbsp;<span class="op" id="2947615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2947621">return</span>&nbsp;<span class="builtintype" id="2947628">nil</span><span class="op" id="2947631">,</span>&nbsp;<span class="ident" id="2947633">err</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2947640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2947645">todo</span>&nbsp;<span class="op" id="2947650">-=</span>&nbsp;<span class="ident" id="2947653">primes</span><span class="op" id="2947659">[</span><span class="ident" id="2947660">i</span><span class="op" id="2947661">]</span><span class="op" id="2947662">.</span><span class="ident" id="2947663">BitLen</span><span class="op" id="2947669">(</span><span class="op" id="2947670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2947674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2947679">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;primes&nbsp;is&nbsp;pairwise&nbsp;unequal.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2947727">for</span>&nbsp;<span class="ident" id="2947731">i</span><span class="op" id="2947732">,</span>&nbsp;<span class="ident" id="2947734">prime</span>&nbsp;<span class="op" id="2947740">:=</span>&nbsp;<span class="keyword" id="2947743">range</span>&nbsp;<span class="ident" id="2947749">primes</span>&nbsp;<span class="op" id="2947756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2947761">for</span>&nbsp;<span class="ident" id="2947765">j</span>&nbsp;<span class="op" id="2947767">:=</span>&nbsp;<span class="num" id="2947770">0</span><span class="op" id="2947771">;</span>&nbsp;<span class="ident" id="2947773">j</span>&nbsp;<span class="op" id="2947775">&lt;</span>&nbsp;<span class="ident" id="2947777">i</span><span class="op" id="2947778">;</span>&nbsp;<span class="ident" id="2947780">j</span><span class="op" id="2947781">++</span>&nbsp;<span class="op" id="2947784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2947790">if</span>&nbsp;<span class="ident" id="2947793">prime</span><span class="op" id="2947798">.</span><span class="ident" id="2947799">Cmp</span><span class="op" id="2947802">(</span><span class="ident" id="2947803">primes</span><span class="op" id="2947809">[</span><span class="ident" id="2947810">j</span><span class="op" id="2947811">]</span><span class="op" id="2947812">)</span>&nbsp;<span class="op" id="2947814">==</span>&nbsp;<span class="num" id="2947817">0</span>&nbsp;<span class="op" id="2947819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2947826">continue</span>&nbsp;<span class="ident" id="2947835">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2947855">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2947860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2947864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2947869">n</span>&nbsp;<span class="op" id="2947871">:=</span>&nbsp;<span class="builtinfunc" id="2947874">new</span><span class="op" id="2947877">(</span><span class="ident" id="2947878">big</span><span class="op" id="2947881">.</span><span class="ident" id="2947882">Int</span><span class="op" id="2947885">)</span><span class="op" id="2947886">.</span><span class="ident" id="2947887">Set</span><span class="op" id="2947890">(</span><span class="ident" id="2947891">bigOne</span><span class="op" id="2947897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2947901">totient</span>&nbsp;<span class="op" id="2947909">:=</span>&nbsp;<span class="builtinfunc" id="2947912">new</span><span class="op" id="2947915">(</span><span class="ident" id="2947916">big</span><span class="op" id="2947919">.</span><span class="ident" id="2947920">Int</span><span class="op" id="2947923">)</span><span class="op" id="2947924">.</span><span class="ident" id="2947925">Set</span><span class="op" id="2947928">(</span><span class="ident" id="2947929">bigOne</span><span class="op" id="2947935">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2947939">pminus1</span>&nbsp;<span class="op" id="2947947">:=</span>&nbsp;<span class="builtinfunc" id="2947950">new</span><span class="op" id="2947953">(</span><span class="ident" id="2947954">big</span><span class="op" id="2947957">.</span><span class="ident" id="2947958">Int</span><span class="op" id="2947961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2947965">for</span>&nbsp;<span class="ident" id="2947969">_</span><span class="op" id="2947970">,</span>&nbsp;<span class="ident" id="2947972">prime</span>&nbsp;<span class="op" id="2947978">:=</span>&nbsp;<span class="keyword" id="2947981">range</span>&nbsp;<span class="ident" id="2947987">primes</span>&nbsp;<span class="op" id="2947994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2947999">n</span><span class="op" id="2948000">.</span><span class="ident" id="2948001">Mul</span><span class="op" id="2948004">(</span><span class="ident" id="2948005">n</span><span class="op" id="2948006">,</span>&nbsp;<span class="ident" id="2948008">prime</span><span class="op" id="2948013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2948018">pminus1</span><span class="op" id="2948025">.</span><span class="ident" id="2948026">Sub</span><span class="op" id="2948029">(</span><span class="ident" id="2948030">prime</span><span class="op" id="2948035">,</span>&nbsp;<span class="ident" id="2948037">bigOne</span><span class="op" id="2948043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2948048">totient</span><span class="op" id="2948055">.</span><span class="ident" id="2948056">Mul</span><span class="op" id="2948059">(</span><span class="ident" id="2948060">totient</span><span class="op" id="2948067">,</span>&nbsp;<span class="ident" id="2948069">pminus1</span><span class="op" id="2948076">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2948080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2948084">if</span>&nbsp;<span class="ident" id="2948087">n</span><span class="op" id="2948088">.</span><span class="ident" id="2948089">BitLen</span><span class="op" id="2948095">(</span><span class="op" id="2948096">)</span>&nbsp;<span class="op" id="2948098">!=</span>&nbsp;<span class="ident" id="2948101">bits</span>&nbsp;<span class="op" id="2948106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2948111">//&nbsp;This&nbsp;should&nbsp;never&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;==&nbsp;2&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2948167">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2948228">//&nbsp;For&nbsp;nprimes&nbsp;&gt;&nbsp;2&nbsp;we&nbsp;hope&nbsp;it&nbsp;does&nbsp;not&nbsp;happen&nbsp;often.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2948284">continue</span>&nbsp;<span class="ident" id="2948293">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2948311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2948316">g</span>&nbsp;<span class="op" id="2948318">:=</span>&nbsp;<span class="builtinfunc" id="2948321">new</span><span class="op" id="2948324">(</span><span class="ident" id="2948325">big</span><span class="op" id="2948328">.</span><span class="ident" id="2948329">Int</span><span class="op" id="2948332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2948336">priv</span><span class="op" id="2948340">.</span><span class="ident" id="2948341">D</span>&nbsp;<span class="op" id="2948343">=</span>&nbsp;<span class="builtinfunc" id="2948345">new</span><span class="op" id="2948348">(</span><span class="ident" id="2948349">big</span><span class="op" id="2948352">.</span><span class="ident" id="2948353">Int</span><span class="op" id="2948356">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2948360">y</span>&nbsp;<span class="op" id="2948362">:=</span>&nbsp;<span class="builtinfunc" id="2948365">new</span><span class="op" id="2948368">(</span><span class="ident" id="2948369">big</span><span class="op" id="2948372">.</span><span class="ident" id="2948373">Int</span><span class="op" id="2948376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2948380">e</span>&nbsp;<span class="op" id="2948382">:=</span>&nbsp;<span class="ident" id="2948385">big</span><span class="op" id="2948388">.</span><span class="ident" id="2948389">NewInt</span><span class="op" id="2948395">(</span><span class="ident" id="2948396">int64</span><span class="op" id="2948401">(</span><span class="ident" id="2948402">priv</span><span class="op" id="2948406">.</span><span class="ident" id="2948407">E</span><span class="op" id="2948408">)</span><span class="op" id="2948409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2948413">g</span><span class="op" id="2948414">.</span><span class="ident" id="2948415">GCD</span><span class="op" id="2948418">(</span><span class="ident" id="2948419">priv</span><span class="op" id="2948423">.</span><span class="ident" id="2948424">D</span><span class="op" id="2948425">,</span>&nbsp;<span class="ident" id="2948427">y</span><span class="op" id="2948428">,</span>&nbsp;<span class="ident" id="2948430">e</span><span class="op" id="2948431">,</span>&nbsp;<span class="ident" id="2948433">totient</span><span class="op" id="2948440">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2948445">if</span>&nbsp;<span class="ident" id="2948448">g</span><span class="op" id="2948449">.</span><span class="ident" id="2948450">Cmp</span><span class="op" id="2948453">(</span><span class="ident" id="2948454">bigOne</span><span class="op" id="2948460">)</span>&nbsp;<span class="op" id="2948462">==</span>&nbsp;<span class="num" id="2948465">0</span>&nbsp;<span class="op" id="2948467">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2948472">if</span>&nbsp;<span class="ident" id="2948475">priv</span><span class="op" id="2948479">.</span><span class="ident" id="2948480">D</span><span class="op" id="2948481">.</span><span class="ident" id="2948482">Sign</span><span class="op" id="2948486">(</span><span class="op" id="2948487">)</span>&nbsp;<span class="op" id="2948489">&lt;</span>&nbsp;<span class="num" id="2948491">0</span>&nbsp;<span class="op" id="2948493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2948499">priv</span><span class="op" id="2948503">.</span><span class="ident" id="2948504">D</span><span class="op" id="2948505">.</span><span class="ident" id="2948506">Add</span><span class="op" id="2948509">(</span><span class="ident" id="2948510">priv</span><span class="op" id="2948514">.</span><span class="ident" id="2948515">D</span><span class="op" id="2948516">,</span>&nbsp;<span class="ident" id="2948518">totient</span><span class="op" id="2948525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2948530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2948535">priv</span><span class="op" id="2948539">.</span><span class="ident" id="2948540">Primes</span>&nbsp;<span class="op" id="2948547">=</span>&nbsp;<span class="ident" id="2948549">primes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2948559">priv</span><span class="op" id="2948563">.</span><span class="ident" id="2948564">N</span>&nbsp;<span class="op" id="2948566">=</span>&nbsp;<span class="ident" id="2948568">n</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2948574">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2948582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2948585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2948589">priv</span><span class="op" id="2948593">.</span><span class="ident" id="2948594">Precompute</span><span class="op" id="2948604">(</span><span class="op" id="2948605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2948608">return</span><br>
<span class="lineno"></span><span class="op" id="2948615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2948618">//&nbsp;incCounter&nbsp;increments&nbsp;a&nbsp;four&nbsp;byte,&nbsp;big-endian&nbsp;counter.</span><br>
<span class="lineno">240</span><span class="keyword" id="2948676">func</span>&nbsp;<span class="ident" id="2948681">incCounter</span><span class="op" id="2948691">(</span><span class="ident" id="2948692">c</span>&nbsp;<span class="op" id="2948694">*</span><span class="op" id="2948695">[</span><span class="num" id="2948696">4</span><span class="op" id="2948697">]</span><span class="builtintype" id="2948698">byte</span><span class="op" id="2948702">)</span>&nbsp;<span class="op" id="2948704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2948707">if</span>&nbsp;<span class="ident" id="2948710">c</span><span class="op" id="2948711">[</span><span class="num" id="2948712">3</span><span class="op" id="2948713">]</span><span class="op" id="2948714">++</span><span class="op" id="2948716">;</span>&nbsp;<span class="ident" id="2948718">c</span><span class="op" id="2948719">[</span><span class="num" id="2948720">3</span><span class="op" id="2948721">]</span>&nbsp;<span class="op" id="2948723">!=</span>&nbsp;<span class="num" id="2948726">0</span>&nbsp;<span class="op" id="2948728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2948732">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2948740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2948743">if</span>&nbsp;<span class="ident" id="2948746">c</span><span class="op" id="2948747">[</span><span class="num" id="2948748">2</span><span class="op" id="2948749">]</span><span class="op" id="2948750">++</span><span class="op" id="2948752">;</span>&nbsp;<span class="ident" id="2948754">c</span><span class="op" id="2948755">[</span><span class="num" id="2948756">2</span><span class="op" id="2948757">]</span>&nbsp;<span class="op" id="2948759">!=</span>&nbsp;<span class="num" id="2948762">0</span>&nbsp;<span class="op" id="2948764">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2948768">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2948776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2948779">if</span>&nbsp;<span class="ident" id="2948782">c</span><span class="op" id="2948783">[</span><span class="num" id="2948784">1</span><span class="op" id="2948785">]</span><span class="op" id="2948786">++</span><span class="op" id="2948788">;</span>&nbsp;<span class="ident" id="2948790">c</span><span class="op" id="2948791">[</span><span class="num" id="2948792">1</span><span class="op" id="2948793">]</span>&nbsp;<span class="op" id="2948795">!=</span>&nbsp;<span class="num" id="2948798">0</span>&nbsp;<span class="op" id="2948800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2948804">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2948812">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2948815">c</span><span class="op" id="2948816">[</span><span class="num" id="2948817">0</span><span class="op" id="2948818">]</span><span class="op" id="2948819">++</span><br>
<span class="lineno"></span><span class="op" id="2948822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2948825">//&nbsp;mgf1XOR&nbsp;XORs&nbsp;the&nbsp;bytes&nbsp;in&nbsp;out&nbsp;with&nbsp;a&nbsp;mask&nbsp;generated&nbsp;using&nbsp;the&nbsp;MGF1&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2948904">//&nbsp;specified&nbsp;in&nbsp;PKCS#1&nbsp;v2.1.</span><br>
<span class="lineno">255</span><span class="keyword" id="2948933">func</span>&nbsp;<span class="ident" id="2948938">mgf1XOR</span><span class="op" id="2948945">(</span><span class="ident" id="2948946">out</span>&nbsp;<span class="op" id="2948950">[</span><span class="op" id="2948951">]</span><span class="builtintype" id="2948952">byte</span><span class="op" id="2948956">,</span>&nbsp;<span class="ident" id="2948958">hash</span>&nbsp;<span class="ident" id="2948963">hash</span><span class="op" id="2948967">.</span><span class="ident" id="2948968">Hash</span><span class="op" id="2948972">,</span>&nbsp;<span class="ident" id="2948974">seed</span>&nbsp;<span class="op" id="2948979">[</span><span class="op" id="2948980">]</span><span class="builtintype" id="2948981">byte</span><span class="op" id="2948985">)</span>&nbsp;<span class="op" id="2948987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2948990">var</span>&nbsp;<span class="ident" id="2948994">counter</span>&nbsp;<span class="op" id="2949002">[</span><span class="num" id="2949003">4</span><span class="op" id="2949004">]</span><span class="builtintype" id="2949005">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949011">var</span>&nbsp;<span class="ident" id="2949015">digest</span>&nbsp;<span class="op" id="2949022">[</span><span class="op" id="2949023">]</span><span class="builtintype" id="2949024">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949031">done</span>&nbsp;<span class="op" id="2949036">:=</span>&nbsp;<span class="num" id="2949039">0</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949042">for</span>&nbsp;<span class="ident" id="2949046">done</span>&nbsp;<span class="op" id="2949051">&lt;</span>&nbsp;<span class="builtinfunc" id="2949053">len</span><span class="op" id="2949056">(</span><span class="ident" id="2949057">out</span><span class="op" id="2949060">)</span>&nbsp;<span class="op" id="2949062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949066">hash</span><span class="op" id="2949070">.</span><span class="ident" id="2949071">Write</span><span class="op" id="2949076">(</span><span class="ident" id="2949077">seed</span><span class="op" id="2949081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949085">hash</span><span class="op" id="2949089">.</span><span class="ident" id="2949090">Write</span><span class="op" id="2949095">(</span><span class="ident" id="2949096">counter</span><span class="op" id="2949103">[</span><span class="num" id="2949104">0</span><span class="op" id="2949105">:</span><span class="num" id="2949106">4</span><span class="op" id="2949107">]</span><span class="op" id="2949108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949112">digest</span>&nbsp;<span class="op" id="2949119">=</span>&nbsp;<span class="ident" id="2949121">hash</span><span class="op" id="2949125">.</span><span class="ident" id="2949126">Sum</span><span class="op" id="2949129">(</span><span class="ident" id="2949130">digest</span><span class="op" id="2949136">[</span><span class="op" id="2949137">:</span><span class="num" id="2949138">0</span><span class="op" id="2949139">]</span><span class="op" id="2949140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949144">hash</span><span class="op" id="2949148">.</span><span class="ident" id="2949149">Reset</span><span class="op" id="2949154">(</span><span class="op" id="2949155">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949160">for</span>&nbsp;<span class="ident" id="2949164">i</span>&nbsp;<span class="op" id="2949166">:=</span>&nbsp;<span class="num" id="2949169">0</span><span class="op" id="2949170">;</span>&nbsp;<span class="ident" id="2949172">i</span>&nbsp;<span class="op" id="2949174">&lt;</span>&nbsp;<span class="builtinfunc" id="2949176">len</span><span class="op" id="2949179">(</span><span class="ident" id="2949180">digest</span><span class="op" id="2949186">)</span>&nbsp;<span class="op" id="2949188">&amp;&amp;</span>&nbsp;<span class="ident" id="2949191">done</span>&nbsp;<span class="op" id="2949196">&lt;</span>&nbsp;<span class="builtinfunc" id="2949198">len</span><span class="op" id="2949201">(</span><span class="ident" id="2949202">out</span><span class="op" id="2949205">)</span><span class="op" id="2949206">;</span>&nbsp;<span class="ident" id="2949208">i</span><span class="op" id="2949209">++</span>&nbsp;<span class="op" id="2949212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949217">out</span><span class="op" id="2949220">[</span><span class="ident" id="2949221">done</span><span class="op" id="2949225">]</span>&nbsp;<span class="op" id="2949227">^=</span>&nbsp;<span class="ident" id="2949230">digest</span><span class="op" id="2949236">[</span><span class="ident" id="2949237">i</span><span class="op" id="2949238">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949243">done</span><span class="op" id="2949247">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2949252">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949256">incCounter</span><span class="op" id="2949266">(</span><span class="op" id="2949267">&amp;</span><span class="ident" id="2949268">counter</span><span class="op" id="2949275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2949278">}</span><br>
<span class="lineno"></span><span class="op" id="2949280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2949283">//&nbsp;ErrMessageTooLong&nbsp;is&nbsp;returned&nbsp;when&nbsp;attempting&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;message&nbsp;which&nbsp;is</span><br>
<span class="lineno">275</span><span class="comment" id="2949362">//&nbsp;too&nbsp;large&nbsp;for&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="2949407">var</span>&nbsp;<span class="ident" id="2949411">ErrMessageTooLong</span>&nbsp;<span class="op" id="2949429">=</span>&nbsp;<span class="ident" id="2949431">errors</span><span class="op" id="2949437">.</span><span class="ident" id="2949438">New</span><span class="op" id="2949441">(</span><span class="string" id="2949442">&#34;crypto/rsa:&nbsp;message&nbsp;too&nbsp;long&nbsp;for&nbsp;RSA&nbsp;public&nbsp;key&nbsp;size&#34;</span><span class="op" id="2949496">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2949499">func</span>&nbsp;<span class="ident" id="2949504">encrypt</span><span class="op" id="2949511">(</span><span class="ident" id="2949512">c</span>&nbsp;<span class="op" id="2949514">*</span><span class="ident" id="2949515">big</span><span class="op" id="2949518">.</span><span class="ident" id="2949519">Int</span><span class="op" id="2949522">,</span>&nbsp;<span class="ident" id="2949524">pub</span>&nbsp;<span class="op" id="2949528">*</span><span class="ident" id="2949529">PublicKey</span><span class="op" id="2949538">,</span>&nbsp;<span class="ident" id="2949540">m</span>&nbsp;<span class="op" id="2949542">*</span><span class="ident" id="2949543">big</span><span class="op" id="2949546">.</span><span class="ident" id="2949547">Int</span><span class="op" id="2949550">)</span>&nbsp;<span class="op" id="2949552">*</span><span class="ident" id="2949553">big</span><span class="op" id="2949556">.</span><span class="ident" id="2949557">Int</span>&nbsp;<span class="op" id="2949561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949564">e</span>&nbsp;<span class="op" id="2949566">:=</span>&nbsp;<span class="ident" id="2949569">big</span><span class="op" id="2949572">.</span><span class="ident" id="2949573">NewInt</span><span class="op" id="2949579">(</span><span class="ident" id="2949580">int64</span><span class="op" id="2949585">(</span><span class="ident" id="2949586">pub</span><span class="op" id="2949589">.</span><span class="ident" id="2949590">E</span><span class="op" id="2949591">)</span><span class="op" id="2949592">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949595">c</span><span class="op" id="2949596">.</span><span class="ident" id="2949597">Exp</span><span class="op" id="2949600">(</span><span class="ident" id="2949601">m</span><span class="op" id="2949602">,</span>&nbsp;<span class="ident" id="2949604">e</span><span class="op" id="2949605">,</span>&nbsp;<span class="ident" id="2949607">pub</span><span class="op" id="2949610">.</span><span class="ident" id="2949611">N</span><span class="op" id="2949612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949615">return</span>&nbsp;<span class="ident" id="2949622">c</span><br>
<span class="lineno"></span><span class="op" id="2949624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2949627">//&nbsp;EncryptOAEP&nbsp;encrypts&nbsp;the&nbsp;given&nbsp;message&nbsp;with&nbsp;RSA-OAEP.</span><br>
<span class="lineno">285</span><span class="comment" id="2949684">//&nbsp;The&nbsp;message&nbsp;must&nbsp;be&nbsp;no&nbsp;longer&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;public&nbsp;modulus&nbsp;less</span><br>
<span class="lineno"></span><span class="comment" id="2949760">//&nbsp;twice&nbsp;the&nbsp;hash&nbsp;length&nbsp;plus&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="2949793">func</span>&nbsp;<span class="ident" id="2949798">EncryptOAEP</span><span class="op" id="2949809">(</span><span class="ident" id="2949810">hash</span>&nbsp;<span class="ident" id="2949815">hash</span><span class="op" id="2949819">.</span><span class="ident" id="2949820">Hash</span><span class="op" id="2949824">,</span>&nbsp;<span class="ident" id="2949826">random</span>&nbsp;<span class="ident" id="2949833">io</span><span class="op" id="2949835">.</span><span class="ident" id="2949836">Reader</span><span class="op" id="2949842">,</span>&nbsp;<span class="ident" id="2949844">pub</span>&nbsp;<span class="op" id="2949848">*</span><span class="ident" id="2949849">PublicKey</span><span class="op" id="2949858">,</span>&nbsp;<span class="ident" id="2949860">msg</span>&nbsp;<span class="op" id="2949864">[</span><span class="op" id="2949865">]</span><span class="builtintype" id="2949866">byte</span><span class="op" id="2949870">,</span>&nbsp;<span class="ident" id="2949872">label</span>&nbsp;<span class="op" id="2949878">[</span><span class="op" id="2949879">]</span><span class="builtintype" id="2949880">byte</span><span class="op" id="2949884">)</span>&nbsp;<span class="op" id="2949886">(</span><span class="ident" id="2949887">out</span>&nbsp;<span class="op" id="2949891">[</span><span class="op" id="2949892">]</span><span class="builtintype" id="2949893">byte</span><span class="op" id="2949897">,</span>&nbsp;<span class="ident" id="2949899">err</span>&nbsp;<span class="builtintype" id="2949903">error</span><span class="op" id="2949908">)</span>&nbsp;<span class="op" id="2949910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949913">if</span>&nbsp;<span class="ident" id="2949916">err</span>&nbsp;<span class="op" id="2949920">:=</span>&nbsp;<span class="ident" id="2949923">checkPub</span><span class="op" id="2949931">(</span><span class="ident" id="2949932">pub</span><span class="op" id="2949935">)</span><span class="op" id="2949936">;</span>&nbsp;<span class="ident" id="2949938">err</span>&nbsp;<span class="op" id="2949942">!=</span>&nbsp;<span class="builtintype" id="2949945">nil</span>&nbsp;<span class="op" id="2949949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2949953">return</span>&nbsp;<span class="builtintype" id="2949960">nil</span><span class="op" id="2949963">,</span>&nbsp;<span class="ident" id="2949965">err</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2949970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949973">hash</span><span class="op" id="2949977">.</span><span class="ident" id="2949978">Reset</span><span class="op" id="2949983">(</span><span class="op" id="2949984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2949987">k</span>&nbsp;<span class="op" id="2949989">:=</span>&nbsp;<span class="op" id="2949992">(</span><span class="ident" id="2949993">pub</span><span class="op" id="2949996">.</span><span class="ident" id="2949997">N</span><span class="op" id="2949998">.</span><span class="ident" id="2949999">BitLen</span><span class="op" id="2950005">(</span><span class="op" id="2950006">)</span>&nbsp;<span class="op" id="2950008">+</span>&nbsp;<span class="num" id="2950010">7</span><span class="op" id="2950011">)</span>&nbsp;<span class="op" id="2950013">/</span>&nbsp;<span class="num" id="2950015">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2950018">if</span>&nbsp;<span class="builtinfunc" id="2950021">len</span><span class="op" id="2950024">(</span><span class="ident" id="2950025">msg</span><span class="op" id="2950028">)</span>&nbsp;<span class="op" id="2950030">&gt;</span>&nbsp;<span class="ident" id="2950032">k</span><span class="op" id="2950033">-</span><span class="num" id="2950034">2</span><span class="op" id="2950035">*</span><span class="ident" id="2950036">hash</span><span class="op" id="2950040">.</span><span class="ident" id="2950041">Size</span><span class="op" id="2950045">(</span><span class="op" id="2950046">)</span><span class="op" id="2950047">-</span><span class="num" id="2950048">2</span>&nbsp;<span class="op" id="2950050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950054">err</span>&nbsp;<span class="op" id="2950058">=</span>&nbsp;<span class="ident" id="2950060">ErrMessageTooLong</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2950080">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2950088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950092">hash</span><span class="op" id="2950096">.</span><span class="ident" id="2950097">Write</span><span class="op" id="2950102">(</span><span class="ident" id="2950103">label</span><span class="op" id="2950108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950111">lHash</span>&nbsp;<span class="op" id="2950117">:=</span>&nbsp;<span class="ident" id="2950120">hash</span><span class="op" id="2950124">.</span><span class="ident" id="2950125">Sum</span><span class="op" id="2950128">(</span><span class="builtintype" id="2950129">nil</span><span class="op" id="2950132">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950135">hash</span><span class="op" id="2950139">.</span><span class="ident" id="2950140">Reset</span><span class="op" id="2950145">(</span><span class="op" id="2950146">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950150">em</span>&nbsp;<span class="op" id="2950153">:=</span>&nbsp;<span class="builtinfunc" id="2950156">make</span><span class="op" id="2950160">(</span><span class="op" id="2950161">[</span><span class="op" id="2950162">]</span><span class="builtintype" id="2950163">byte</span><span class="op" id="2950167">,</span>&nbsp;<span class="ident" id="2950169">k</span><span class="op" id="2950170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950173">seed</span>&nbsp;<span class="op" id="2950178">:=</span>&nbsp;<span class="ident" id="2950181">em</span><span class="op" id="2950183">[</span><span class="num" id="2950184">1</span>&nbsp;<span class="op" id="2950186">:</span>&nbsp;<span class="num" id="2950188">1</span><span class="op" id="2950189">+</span><span class="ident" id="2950190">hash</span><span class="op" id="2950194">.</span><span class="ident" id="2950195">Size</span><span class="op" id="2950199">(</span><span class="op" id="2950200">)</span><span class="op" id="2950201">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950204">db</span>&nbsp;<span class="op" id="2950207">:=</span>&nbsp;<span class="ident" id="2950210">em</span><span class="op" id="2950212">[</span><span class="num" id="2950213">1</span><span class="op" id="2950214">+</span><span class="ident" id="2950215">hash</span><span class="op" id="2950219">.</span><span class="ident" id="2950220">Size</span><span class="op" id="2950224">(</span><span class="op" id="2950225">)</span><span class="op" id="2950226">:</span><span class="op" id="2950227">]</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2950231">copy</span><span class="op" id="2950235">(</span><span class="ident" id="2950236">db</span><span class="op" id="2950238">[</span><span class="num" id="2950239">0</span><span class="op" id="2950240">:</span><span class="ident" id="2950241">hash</span><span class="op" id="2950245">.</span><span class="ident" id="2950246">Size</span><span class="op" id="2950250">(</span><span class="op" id="2950251">)</span><span class="op" id="2950252">]</span><span class="op" id="2950253">,</span>&nbsp;<span class="ident" id="2950255">lHash</span><span class="op" id="2950260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950263">db</span><span class="op" id="2950265">[</span><span class="builtinfunc" id="2950266">len</span><span class="op" id="2950269">(</span><span class="ident" id="2950270">db</span><span class="op" id="2950272">)</span><span class="op" id="2950273">-</span><span class="builtinfunc" id="2950274">len</span><span class="op" id="2950277">(</span><span class="ident" id="2950278">msg</span><span class="op" id="2950281">)</span><span class="op" id="2950282">-</span><span class="num" id="2950283">1</span><span class="op" id="2950284">]</span>&nbsp;<span class="op" id="2950286">=</span>&nbsp;<span class="num" id="2950288">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2950291">copy</span><span class="op" id="2950295">(</span><span class="ident" id="2950296">db</span><span class="op" id="2950298">[</span><span class="builtinfunc" id="2950299">len</span><span class="op" id="2950302">(</span><span class="ident" id="2950303">db</span><span class="op" id="2950305">)</span><span class="op" id="2950306">-</span><span class="builtinfunc" id="2950307">len</span><span class="op" id="2950310">(</span><span class="ident" id="2950311">msg</span><span class="op" id="2950314">)</span><span class="op" id="2950315">:</span><span class="op" id="2950316">]</span><span class="op" id="2950317">,</span>&nbsp;<span class="ident" id="2950319">msg</span><span class="op" id="2950322">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950326">_</span><span class="op" id="2950327">,</span>&nbsp;<span class="ident" id="2950329">err</span>&nbsp;<span class="op" id="2950333">=</span>&nbsp;<span class="ident" id="2950335">io</span><span class="op" id="2950337">.</span><span class="ident" id="2950338">ReadFull</span><span class="op" id="2950346">(</span><span class="ident" id="2950347">random</span><span class="op" id="2950353">,</span>&nbsp;<span class="ident" id="2950355">seed</span><span class="op" id="2950359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2950362">if</span>&nbsp;<span class="ident" id="2950365">err</span>&nbsp;<span class="op" id="2950369">!=</span>&nbsp;<span class="builtintype" id="2950372">nil</span>&nbsp;<span class="op" id="2950376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2950380">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2950388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950392">mgf1XOR</span><span class="op" id="2950399">(</span><span class="ident" id="2950400">db</span><span class="op" id="2950402">,</span>&nbsp;<span class="ident" id="2950404">hash</span><span class="op" id="2950408">,</span>&nbsp;<span class="ident" id="2950410">seed</span><span class="op" id="2950414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950417">mgf1XOR</span><span class="op" id="2950424">(</span><span class="ident" id="2950425">seed</span><span class="op" id="2950429">,</span>&nbsp;<span class="ident" id="2950431">hash</span><span class="op" id="2950435">,</span>&nbsp;<span class="ident" id="2950437">db</span><span class="op" id="2950439">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950443">m</span>&nbsp;<span class="op" id="2950445">:=</span>&nbsp;<span class="builtinfunc" id="2950448">new</span><span class="op" id="2950451">(</span><span class="ident" id="2950452">big</span><span class="op" id="2950455">.</span><span class="ident" id="2950456">Int</span><span class="op" id="2950459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950462">m</span><span class="op" id="2950463">.</span><span class="ident" id="2950464">SetBytes</span><span class="op" id="2950472">(</span><span class="ident" id="2950473">em</span><span class="op" id="2950475">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950478">c</span>&nbsp;<span class="op" id="2950480">:=</span>&nbsp;<span class="ident" id="2950483">encrypt</span><span class="op" id="2950490">(</span><span class="builtinfunc" id="2950491">new</span><span class="op" id="2950494">(</span><span class="ident" id="2950495">big</span><span class="op" id="2950498">.</span><span class="ident" id="2950499">Int</span><span class="op" id="2950502">)</span><span class="op" id="2950503">,</span>&nbsp;<span class="ident" id="2950505">pub</span><span class="op" id="2950508">,</span>&nbsp;<span class="ident" id="2950510">m</span><span class="op" id="2950511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950514">out</span>&nbsp;<span class="op" id="2950518">=</span>&nbsp;<span class="ident" id="2950520">c</span><span class="op" id="2950521">.</span><span class="ident" id="2950522">Bytes</span><span class="op" id="2950527">(</span><span class="op" id="2950528">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2950532">if</span>&nbsp;<span class="builtinfunc" id="2950535">len</span><span class="op" id="2950538">(</span><span class="ident" id="2950539">out</span><span class="op" id="2950542">)</span>&nbsp;<span class="op" id="2950544">&lt;</span>&nbsp;<span class="ident" id="2950546">k</span>&nbsp;<span class="op" id="2950548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2950552">//&nbsp;If&nbsp;the&nbsp;output&nbsp;is&nbsp;too&nbsp;small,&nbsp;we&nbsp;need&nbsp;to&nbsp;left-pad&nbsp;with&nbsp;zeros.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950617">t</span>&nbsp;<span class="op" id="2950619">:=</span>&nbsp;<span class="builtinfunc" id="2950622">make</span><span class="op" id="2950626">(</span><span class="op" id="2950627">[</span><span class="op" id="2950628">]</span><span class="builtintype" id="2950629">byte</span><span class="op" id="2950633">,</span>&nbsp;<span class="ident" id="2950635">k</span><span class="op" id="2950636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2950640">copy</span><span class="op" id="2950644">(</span><span class="ident" id="2950645">t</span><span class="op" id="2950646">[</span><span class="ident" id="2950647">k</span><span class="op" id="2950648">-</span><span class="builtinfunc" id="2950649">len</span><span class="op" id="2950652">(</span><span class="ident" id="2950653">out</span><span class="op" id="2950656">)</span><span class="op" id="2950657">:</span><span class="op" id="2950658">]</span><span class="op" id="2950659">,</span>&nbsp;<span class="ident" id="2950661">out</span><span class="op" id="2950664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2950668">out</span>&nbsp;<span class="op" id="2950672">=</span>&nbsp;<span class="ident" id="2950674">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2950677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2950681">return</span><br>
<span class="lineno"></span><span class="op" id="2950688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2950691">//&nbsp;ErrDecryption&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;decrypt&nbsp;a&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="2950751">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno">335</span><span class="keyword" id="2950806">var</span>&nbsp;<span class="ident" id="2950810">ErrDecryption</span>&nbsp;<span class="op" id="2950824">=</span>&nbsp;<span class="ident" id="2950826">errors</span><span class="op" id="2950832">.</span><span class="ident" id="2950833">New</span><span class="op" id="2950836">(</span><span class="string" id="2950837">&#34;crypto/rsa:&nbsp;decryption&nbsp;error&#34;</span><span class="op" id="2950867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2950870">//&nbsp;ErrVerification&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;verify&nbsp;a&nbsp;signature.</span><br>
<span class="lineno"></span><span class="comment" id="2950933">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="2950988">var</span>&nbsp;<span class="ident" id="2950992">ErrVerification</span>&nbsp;<span class="op" id="2951008">=</span>&nbsp;<span class="ident" id="2951010">errors</span><span class="op" id="2951016">.</span><span class="ident" id="2951017">New</span><span class="op" id="2951020">(</span><span class="string" id="2951021">&#34;crypto/rsa:&nbsp;verification&nbsp;error&#34;</span><span class="op" id="2951053">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="comment" id="2951056">//&nbsp;modInverse&nbsp;returns&nbsp;ia,&nbsp;the&nbsp;inverse&nbsp;of&nbsp;a&nbsp;in&nbsp;the&nbsp;multiplicative&nbsp;group&nbsp;of&nbsp;prime</span><br>
<span class="lineno"></span><span class="comment" id="2951136">//&nbsp;order&nbsp;n.&nbsp;It&nbsp;requires&nbsp;that&nbsp;a&nbsp;be&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;group&nbsp;(i.e.&nbsp;less&nbsp;than&nbsp;n).</span><br>
<span class="lineno"></span><span class="keyword" id="2951212">func</span>&nbsp;<span class="ident" id="2951217">modInverse</span><span class="op" id="2951227">(</span><span class="ident" id="2951228">a</span><span class="op" id="2951229">,</span>&nbsp;<span class="ident" id="2951231">n</span>&nbsp;<span class="op" id="2951233">*</span><span class="ident" id="2951234">big</span><span class="op" id="2951237">.</span><span class="ident" id="2951238">Int</span><span class="op" id="2951241">)</span>&nbsp;<span class="op" id="2951243">(</span><span class="ident" id="2951244">ia</span>&nbsp;<span class="op" id="2951247">*</span><span class="ident" id="2951248">big</span><span class="op" id="2951251">.</span><span class="ident" id="2951252">Int</span><span class="op" id="2951255">,</span>&nbsp;<span class="ident" id="2951257">ok</span>&nbsp;<span class="builtintype" id="2951260">bool</span><span class="op" id="2951264">)</span>&nbsp;<span class="op" id="2951266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2951269">g</span>&nbsp;<span class="op" id="2951271">:=</span>&nbsp;<span class="builtinfunc" id="2951274">new</span><span class="op" id="2951277">(</span><span class="ident" id="2951278">big</span><span class="op" id="2951281">.</span><span class="ident" id="2951282">Int</span><span class="op" id="2951285">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2951288">x</span>&nbsp;<span class="op" id="2951290">:=</span>&nbsp;<span class="builtinfunc" id="2951293">new</span><span class="op" id="2951296">(</span><span class="ident" id="2951297">big</span><span class="op" id="2951300">.</span><span class="ident" id="2951301">Int</span><span class="op" id="2951304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2951307">y</span>&nbsp;<span class="op" id="2951309">:=</span>&nbsp;<span class="builtinfunc" id="2951312">new</span><span class="op" id="2951315">(</span><span class="ident" id="2951316">big</span><span class="op" id="2951319">.</span><span class="ident" id="2951320">Int</span><span class="op" id="2951323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2951326">g</span><span class="op" id="2951327">.</span><span class="ident" id="2951328">GCD</span><span class="op" id="2951331">(</span><span class="ident" id="2951332">x</span><span class="op" id="2951333">,</span>&nbsp;<span class="ident" id="2951335">y</span><span class="op" id="2951336">,</span>&nbsp;<span class="ident" id="2951338">a</span><span class="op" id="2951339">,</span>&nbsp;<span class="ident" id="2951341">n</span><span class="op" id="2951342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2951345">if</span>&nbsp;<span class="ident" id="2951348">g</span><span class="op" id="2951349">.</span><span class="ident" id="2951350">Cmp</span><span class="op" id="2951353">(</span><span class="ident" id="2951354">bigOne</span><span class="op" id="2951360">)</span>&nbsp;<span class="op" id="2951362">!=</span>&nbsp;<span class="num" id="2951365">0</span>&nbsp;<span class="op" id="2951367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951371">//&nbsp;In&nbsp;this&nbsp;case,&nbsp;a&nbsp;and&nbsp;n&nbsp;aren&#39;t&nbsp;coprime&nbsp;and&nbsp;we&nbsp;cannot&nbsp;calculate</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951437">//&nbsp;the&nbsp;inverse.&nbsp;This&nbsp;happens&nbsp;because&nbsp;the&nbsp;values&nbsp;of&nbsp;n&nbsp;are&nbsp;nearly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951503">//&nbsp;prime&nbsp;(being&nbsp;the&nbsp;product&nbsp;of&nbsp;two&nbsp;primes)&nbsp;rather&nbsp;than&nbsp;truly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951566">//&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2951578">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2951586">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2951590">if</span>&nbsp;<span class="ident" id="2951593">x</span><span class="op" id="2951594">.</span><span class="ident" id="2951595">Cmp</span><span class="op" id="2951598">(</span><span class="ident" id="2951599">bigOne</span><span class="op" id="2951605">)</span>&nbsp;<span class="op" id="2951607">&lt;</span>&nbsp;<span class="num" id="2951609">0</span>&nbsp;<span class="op" id="2951611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951615">//&nbsp;0&nbsp;is&nbsp;not&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;any&nbsp;element&nbsp;so,&nbsp;if&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2951680">//&nbsp;&lt;&nbsp;1,&nbsp;then&nbsp;x&nbsp;is&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2951710">x</span><span class="op" id="2951711">.</span><span class="ident" id="2951712">Add</span><span class="op" id="2951715">(</span><span class="ident" id="2951716">x</span><span class="op" id="2951717">,</span>&nbsp;<span class="ident" id="2951719">n</span><span class="op" id="2951720">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2951723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2951727">return</span>&nbsp;<span class="ident" id="2951734">x</span><span class="op" id="2951735">,</span>&nbsp;<span class="builtintype" id="2951737">true</span><br>
<span class="lineno"></span><span class="op" id="2951742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="2951745">//&nbsp;Precompute&nbsp;performs&nbsp;some&nbsp;calculations&nbsp;that&nbsp;speed&nbsp;up&nbsp;private&nbsp;key&nbsp;operations</span><br>
<span class="lineno"></span><span class="comment" id="2951823">//&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="2951841">func</span>&nbsp;<span class="op" id="2951846">(</span><span class="ident" id="2951847">priv</span>&nbsp;<span class="op" id="2951852">*</span><span class="ident" id="2951853">PrivateKey</span><span class="op" id="2951863">)</span>&nbsp;<span class="ident" id="2951865">Precompute</span><span class="op" id="2951875">(</span><span class="op" id="2951876">)</span>&nbsp;<span class="op" id="2951878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2951881">if</span>&nbsp;<span class="ident" id="2951884">priv</span><span class="op" id="2951888">.</span><span class="ident" id="2951889">Precomputed</span><span class="op" id="2951900">.</span><span class="ident" id="2951901">Dp</span>&nbsp;<span class="op" id="2951904">!=</span>&nbsp;<span class="builtintype" id="2951907">nil</span>&nbsp;<span class="op" id="2951911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2951915">return</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2951923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2951927">priv</span><span class="op" id="2951931">.</span><span class="ident" id="2951932">Precomputed</span><span class="op" id="2951943">.</span><span class="ident" id="2951944">Dp</span>&nbsp;<span class="op" id="2951947">=</span>&nbsp;<span class="builtinfunc" id="2951949">new</span><span class="op" id="2951952">(</span><span class="ident" id="2951953">big</span><span class="op" id="2951956">.</span><span class="ident" id="2951957">Int</span><span class="op" id="2951960">)</span><span class="op" id="2951961">.</span><span class="ident" id="2951962">Sub</span><span class="op" id="2951965">(</span><span class="ident" id="2951966">priv</span><span class="op" id="2951970">.</span><span class="ident" id="2951971">Primes</span><span class="op" id="2951977">[</span><span class="num" id="2951978">0</span><span class="op" id="2951979">]</span><span class="op" id="2951980">,</span>&nbsp;<span class="ident" id="2951982">bigOne</span><span class="op" id="2951988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2951991">priv</span><span class="op" id="2951995">.</span><span class="ident" id="2951996">Precomputed</span><span class="op" id="2952007">.</span><span class="ident" id="2952008">Dp</span><span class="op" id="2952010">.</span><span class="ident" id="2952011">Mod</span><span class="op" id="2952014">(</span><span class="ident" id="2952015">priv</span><span class="op" id="2952019">.</span><span class="ident" id="2952020">D</span><span class="op" id="2952021">,</span>&nbsp;<span class="ident" id="2952023">priv</span><span class="op" id="2952027">.</span><span class="ident" id="2952028">Precomputed</span><span class="op" id="2952039">.</span><span class="ident" id="2952040">Dp</span><span class="op" id="2952042">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952046">priv</span><span class="op" id="2952050">.</span><span class="ident" id="2952051">Precomputed</span><span class="op" id="2952062">.</span><span class="ident" id="2952063">Dq</span>&nbsp;<span class="op" id="2952066">=</span>&nbsp;<span class="builtinfunc" id="2952068">new</span><span class="op" id="2952071">(</span><span class="ident" id="2952072">big</span><span class="op" id="2952075">.</span><span class="ident" id="2952076">Int</span><span class="op" id="2952079">)</span><span class="op" id="2952080">.</span><span class="ident" id="2952081">Sub</span><span class="op" id="2952084">(</span><span class="ident" id="2952085">priv</span><span class="op" id="2952089">.</span><span class="ident" id="2952090">Primes</span><span class="op" id="2952096">[</span><span class="num" id="2952097">1</span><span class="op" id="2952098">]</span><span class="op" id="2952099">,</span>&nbsp;<span class="ident" id="2952101">bigOne</span><span class="op" id="2952107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952110">priv</span><span class="op" id="2952114">.</span><span class="ident" id="2952115">Precomputed</span><span class="op" id="2952126">.</span><span class="ident" id="2952127">Dq</span><span class="op" id="2952129">.</span><span class="ident" id="2952130">Mod</span><span class="op" id="2952133">(</span><span class="ident" id="2952134">priv</span><span class="op" id="2952138">.</span><span class="ident" id="2952139">D</span><span class="op" id="2952140">,</span>&nbsp;<span class="ident" id="2952142">priv</span><span class="op" id="2952146">.</span><span class="ident" id="2952147">Precomputed</span><span class="op" id="2952158">.</span><span class="ident" id="2952159">Dq</span><span class="op" id="2952161">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952165">priv</span><span class="op" id="2952169">.</span><span class="ident" id="2952170">Precomputed</span><span class="op" id="2952181">.</span><span class="ident" id="2952182">Qinv</span>&nbsp;<span class="op" id="2952187">=</span>&nbsp;<span class="builtinfunc" id="2952189">new</span><span class="op" id="2952192">(</span><span class="ident" id="2952193">big</span><span class="op" id="2952196">.</span><span class="ident" id="2952197">Int</span><span class="op" id="2952200">)</span><span class="op" id="2952201">.</span><span class="ident" id="2952202">ModInverse</span><span class="op" id="2952212">(</span><span class="ident" id="2952213">priv</span><span class="op" id="2952217">.</span><span class="ident" id="2952218">Primes</span><span class="op" id="2952224">[</span><span class="num" id="2952225">1</span><span class="op" id="2952226">]</span><span class="op" id="2952227">,</span>&nbsp;<span class="ident" id="2952229">priv</span><span class="op" id="2952233">.</span><span class="ident" id="2952234">Primes</span><span class="op" id="2952240">[</span><span class="num" id="2952241">0</span><span class="op" id="2952242">]</span><span class="op" id="2952243">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952247">r</span>&nbsp;<span class="op" id="2952249">:=</span>&nbsp;<span class="builtinfunc" id="2952252">new</span><span class="op" id="2952255">(</span><span class="ident" id="2952256">big</span><span class="op" id="2952259">.</span><span class="ident" id="2952260">Int</span><span class="op" id="2952263">)</span><span class="op" id="2952264">.</span><span class="ident" id="2952265">Mul</span><span class="op" id="2952268">(</span><span class="ident" id="2952269">priv</span><span class="op" id="2952273">.</span><span class="ident" id="2952274">Primes</span><span class="op" id="2952280">[</span><span class="num" id="2952281">0</span><span class="op" id="2952282">]</span><span class="op" id="2952283">,</span>&nbsp;<span class="ident" id="2952285">priv</span><span class="op" id="2952289">.</span><span class="ident" id="2952290">Primes</span><span class="op" id="2952296">[</span><span class="num" id="2952297">1</span><span class="op" id="2952298">]</span><span class="op" id="2952299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952302">priv</span><span class="op" id="2952306">.</span><span class="ident" id="2952307">Precomputed</span><span class="op" id="2952318">.</span><span class="ident" id="2952319">CRTValues</span>&nbsp;<span class="op" id="2952329">=</span>&nbsp;<span class="builtinfunc" id="2952331">make</span><span class="op" id="2952335">(</span><span class="op" id="2952336">[</span><span class="op" id="2952337">]</span><span class="ident" id="2952338">CRTValue</span><span class="op" id="2952346">,</span>&nbsp;<span class="builtinfunc" id="2952348">len</span><span class="op" id="2952351">(</span><span class="ident" id="2952352">priv</span><span class="op" id="2952356">.</span><span class="ident" id="2952357">Primes</span><span class="op" id="2952363">)</span><span class="op" id="2952364">-</span><span class="num" id="2952365">2</span><span class="op" id="2952366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2952369">for</span>&nbsp;<span class="ident" id="2952373">i</span>&nbsp;<span class="op" id="2952375">:=</span>&nbsp;<span class="num" id="2952378">2</span><span class="op" id="2952379">;</span>&nbsp;<span class="ident" id="2952381">i</span>&nbsp;<span class="op" id="2952383">&lt;</span>&nbsp;<span class="builtinfunc" id="2952385">len</span><span class="op" id="2952388">(</span><span class="ident" id="2952389">priv</span><span class="op" id="2952393">.</span><span class="ident" id="2952394">Primes</span><span class="op" id="2952400">)</span><span class="op" id="2952401">;</span>&nbsp;<span class="ident" id="2952403">i</span><span class="op" id="2952404">++</span>&nbsp;<span class="op" id="2952407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952411">prime</span>&nbsp;<span class="op" id="2952417">:=</span>&nbsp;<span class="ident" id="2952420">priv</span><span class="op" id="2952424">.</span><span class="ident" id="2952425">Primes</span><span class="op" id="2952431">[</span><span class="ident" id="2952432">i</span><span class="op" id="2952433">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952437">values</span>&nbsp;<span class="op" id="2952444">:=</span>&nbsp;<span class="op" id="2952447">&amp;</span><span class="ident" id="2952448">priv</span><span class="op" id="2952452">.</span><span class="ident" id="2952453">Precomputed</span><span class="op" id="2952464">.</span><span class="ident" id="2952465">CRTValues</span><span class="op" id="2952474">[</span><span class="ident" id="2952475">i</span><span class="op" id="2952476">-</span><span class="num" id="2952477">2</span><span class="op" id="2952478">]</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952483">values</span><span class="op" id="2952489">.</span><span class="ident" id="2952490">Exp</span>&nbsp;<span class="op" id="2952494">=</span>&nbsp;<span class="builtinfunc" id="2952496">new</span><span class="op" id="2952499">(</span><span class="ident" id="2952500">big</span><span class="op" id="2952503">.</span><span class="ident" id="2952504">Int</span><span class="op" id="2952507">)</span><span class="op" id="2952508">.</span><span class="ident" id="2952509">Sub</span><span class="op" id="2952512">(</span><span class="ident" id="2952513">prime</span><span class="op" id="2952518">,</span>&nbsp;<span class="ident" id="2952520">bigOne</span><span class="op" id="2952526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952530">values</span><span class="op" id="2952536">.</span><span class="ident" id="2952537">Exp</span><span class="op" id="2952540">.</span><span class="ident" id="2952541">Mod</span><span class="op" id="2952544">(</span><span class="ident" id="2952545">priv</span><span class="op" id="2952549">.</span><span class="ident" id="2952550">D</span><span class="op" id="2952551">,</span>&nbsp;<span class="ident" id="2952553">values</span><span class="op" id="2952559">.</span><span class="ident" id="2952560">Exp</span><span class="op" id="2952563">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952568">values</span><span class="op" id="2952574">.</span><span class="ident" id="2952575">R</span>&nbsp;<span class="op" id="2952577">=</span>&nbsp;<span class="builtinfunc" id="2952579">new</span><span class="op" id="2952582">(</span><span class="ident" id="2952583">big</span><span class="op" id="2952586">.</span><span class="ident" id="2952587">Int</span><span class="op" id="2952590">)</span><span class="op" id="2952591">.</span><span class="ident" id="2952592">Set</span><span class="op" id="2952595">(</span><span class="ident" id="2952596">r</span><span class="op" id="2952597">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952601">values</span><span class="op" id="2952607">.</span><span class="ident" id="2952608">Coeff</span>&nbsp;<span class="op" id="2952614">=</span>&nbsp;<span class="builtinfunc" id="2952616">new</span><span class="op" id="2952619">(</span><span class="ident" id="2952620">big</span><span class="op" id="2952623">.</span><span class="ident" id="2952624">Int</span><span class="op" id="2952627">)</span><span class="op" id="2952628">.</span><span class="ident" id="2952629">ModInverse</span><span class="op" id="2952639">(</span><span class="ident" id="2952640">r</span><span class="op" id="2952641">,</span>&nbsp;<span class="ident" id="2952643">prime</span><span class="op" id="2952648">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952653">r</span><span class="op" id="2952654">.</span><span class="ident" id="2952655">Mul</span><span class="op" id="2952658">(</span><span class="ident" id="2952659">r</span><span class="op" id="2952660">,</span>&nbsp;<span class="ident" id="2952662">prime</span><span class="op" id="2952667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2952670">}</span><br>
<span class="lineno"></span><span class="op" id="2952672">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="2952675">//&nbsp;decrypt&nbsp;performs&nbsp;an&nbsp;RSA&nbsp;decryption,&nbsp;resulting&nbsp;in&nbsp;a&nbsp;plaintext&nbsp;integer.&nbsp;If&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2952753">//&nbsp;random&nbsp;source&nbsp;is&nbsp;given,&nbsp;RSA&nbsp;blinding&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="2952802">func</span>&nbsp;<span class="ident" id="2952807">decrypt</span><span class="op" id="2952814">(</span><span class="ident" id="2952815">random</span>&nbsp;<span class="ident" id="2952822">io</span><span class="op" id="2952824">.</span><span class="ident" id="2952825">Reader</span><span class="op" id="2952831">,</span>&nbsp;<span class="ident" id="2952833">priv</span>&nbsp;<span class="op" id="2952838">*</span><span class="ident" id="2952839">PrivateKey</span><span class="op" id="2952849">,</span>&nbsp;<span class="ident" id="2952851">c</span>&nbsp;<span class="op" id="2952853">*</span><span class="ident" id="2952854">big</span><span class="op" id="2952857">.</span><span class="ident" id="2952858">Int</span><span class="op" id="2952861">)</span>&nbsp;<span class="op" id="2952863">(</span><span class="ident" id="2952864">m</span>&nbsp;<span class="op" id="2952866">*</span><span class="ident" id="2952867">big</span><span class="op" id="2952870">.</span><span class="ident" id="2952871">Int</span><span class="op" id="2952874">,</span>&nbsp;<span class="ident" id="2952876">err</span>&nbsp;<span class="builtintype" id="2952880">error</span><span class="op" id="2952885">)</span>&nbsp;<span class="op" id="2952887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2952890">//&nbsp;TODO(agl):&nbsp;can&nbsp;we&nbsp;get&nbsp;away&nbsp;with&nbsp;reusing&nbsp;blinds?</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2952942">if</span>&nbsp;<span class="ident" id="2952945">c</span><span class="op" id="2952946">.</span><span class="ident" id="2952947">Cmp</span><span class="op" id="2952950">(</span><span class="ident" id="2952951">priv</span><span class="op" id="2952955">.</span><span class="ident" id="2952956">N</span><span class="op" id="2952957">)</span>&nbsp;<span class="op" id="2952959">&gt;</span>&nbsp;<span class="num" id="2952961">0</span>&nbsp;<span class="op" id="2952963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2952967">err</span>&nbsp;<span class="op" id="2952971">=</span>&nbsp;<span class="ident" id="2952973">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2952989">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2952997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2953001">var</span>&nbsp;<span class="ident" id="2953005">ir</span>&nbsp;<span class="op" id="2953008">*</span><span class="ident" id="2953009">big</span><span class="op" id="2953012">.</span><span class="ident" id="2953013">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2953018">if</span>&nbsp;<span class="ident" id="2953021">random</span>&nbsp;<span class="op" id="2953028">!=</span>&nbsp;<span class="builtintype" id="2953031">nil</span>&nbsp;<span class="op" id="2953035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2953039">//&nbsp;Blinding&nbsp;enabled.&nbsp;Blinding&nbsp;involves&nbsp;multiplying&nbsp;c&nbsp;by&nbsp;r^e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2953102">//&nbsp;Then&nbsp;the&nbsp;decryption&nbsp;operation&nbsp;performs&nbsp;(m^e&nbsp;*&nbsp;r^e)^d&nbsp;mod&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2953166">//&nbsp;which&nbsp;equals&nbsp;mr&nbsp;mod&nbsp;n.&nbsp;The&nbsp;factor&nbsp;of&nbsp;r&nbsp;can&nbsp;then&nbsp;be&nbsp;removed</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2953230">//&nbsp;by&nbsp;multiplying&nbsp;by&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2953287">var</span>&nbsp;<span class="ident" id="2953291">r</span>&nbsp;<span class="op" id="2953293">*</span><span class="ident" id="2953294">big</span><span class="op" id="2953297">.</span><span class="ident" id="2953298">Int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2953305">for</span>&nbsp;<span class="op" id="2953309">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953314">r</span><span class="op" id="2953315">,</span>&nbsp;<span class="ident" id="2953317">err</span>&nbsp;<span class="op" id="2953321">=</span>&nbsp;<span class="ident" id="2953323">rand</span><span class="op" id="2953327">.</span><span class="ident" id="2953328">Int</span><span class="op" id="2953331">(</span><span class="ident" id="2953332">random</span><span class="op" id="2953338">,</span>&nbsp;<span class="ident" id="2953340">priv</span><span class="op" id="2953344">.</span><span class="ident" id="2953345">N</span><span class="op" id="2953346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2953351">if</span>&nbsp;<span class="ident" id="2953354">err</span>&nbsp;<span class="op" id="2953358">!=</span>&nbsp;<span class="builtintype" id="2953361">nil</span>&nbsp;<span class="op" id="2953365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2953371">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2953381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2953386">if</span>&nbsp;<span class="ident" id="2953389">r</span><span class="op" id="2953390">.</span><span class="ident" id="2953391">Cmp</span><span class="op" id="2953394">(</span><span class="ident" id="2953395">bigZero</span><span class="op" id="2953402">)</span>&nbsp;<span class="op" id="2953404">==</span>&nbsp;<span class="num" id="2953407">0</span>&nbsp;<span class="op" id="2953409">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953415">r</span>&nbsp;<span class="op" id="2953417">=</span>&nbsp;<span class="ident" id="2953419">bigOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2953429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2953434">var</span>&nbsp;<span class="ident" id="2953438">ok</span>&nbsp;<span class="builtintype" id="2953441">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953449">ir</span><span class="op" id="2953451">,</span>&nbsp;<span class="ident" id="2953453">ok</span>&nbsp;<span class="op" id="2953456">=</span>&nbsp;<span class="ident" id="2953458">modInverse</span><span class="op" id="2953468">(</span><span class="ident" id="2953469">r</span><span class="op" id="2953470">,</span>&nbsp;<span class="ident" id="2953472">priv</span><span class="op" id="2953476">.</span><span class="ident" id="2953477">N</span><span class="op" id="2953478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2953483">if</span>&nbsp;<span class="ident" id="2953486">ok</span>&nbsp;<span class="op" id="2953489">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2953495">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2953504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2953508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953512">bigE</span>&nbsp;<span class="op" id="2953517">:=</span>&nbsp;<span class="ident" id="2953520">big</span><span class="op" id="2953523">.</span><span class="ident" id="2953524">NewInt</span><span class="op" id="2953530">(</span><span class="ident" id="2953531">int64</span><span class="op" id="2953536">(</span><span class="ident" id="2953537">priv</span><span class="op" id="2953541">.</span><span class="ident" id="2953542">E</span><span class="op" id="2953543">)</span><span class="op" id="2953544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953548">rpowe</span>&nbsp;<span class="op" id="2953554">:=</span>&nbsp;<span class="builtinfunc" id="2953557">new</span><span class="op" id="2953560">(</span><span class="ident" id="2953561">big</span><span class="op" id="2953564">.</span><span class="ident" id="2953565">Int</span><span class="op" id="2953568">)</span><span class="op" id="2953569">.</span><span class="ident" id="2953570">Exp</span><span class="op" id="2953573">(</span><span class="ident" id="2953574">r</span><span class="op" id="2953575">,</span>&nbsp;<span class="ident" id="2953577">bigE</span><span class="op" id="2953581">,</span>&nbsp;<span class="ident" id="2953583">priv</span><span class="op" id="2953587">.</span><span class="ident" id="2953588">N</span><span class="op" id="2953589">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953593">cCopy</span>&nbsp;<span class="op" id="2953599">:=</span>&nbsp;<span class="builtinfunc" id="2953602">new</span><span class="op" id="2953605">(</span><span class="ident" id="2953606">big</span><span class="op" id="2953609">.</span><span class="ident" id="2953610">Int</span><span class="op" id="2953613">)</span><span class="op" id="2953614">.</span><span class="ident" id="2953615">Set</span><span class="op" id="2953618">(</span><span class="ident" id="2953619">c</span><span class="op" id="2953620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953624">cCopy</span><span class="op" id="2953629">.</span><span class="ident" id="2953630">Mul</span><span class="op" id="2953633">(</span><span class="ident" id="2953634">cCopy</span><span class="op" id="2953639">,</span>&nbsp;<span class="ident" id="2953641">rpowe</span><span class="op" id="2953646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953650">cCopy</span><span class="op" id="2953655">.</span><span class="ident" id="2953656">Mod</span><span class="op" id="2953659">(</span><span class="ident" id="2953660">cCopy</span><span class="op" id="2953665">,</span>&nbsp;<span class="ident" id="2953667">priv</span><span class="op" id="2953671">.</span><span class="ident" id="2953672">N</span><span class="op" id="2953673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953677">c</span>&nbsp;<span class="op" id="2953679">=</span>&nbsp;<span class="ident" id="2953681">cCopy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2953688">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2953692">if</span>&nbsp;<span class="ident" id="2953695">priv</span><span class="op" id="2953699">.</span><span class="ident" id="2953700">Precomputed</span><span class="op" id="2953711">.</span><span class="ident" id="2953712">Dp</span>&nbsp;<span class="op" id="2953715">==</span>&nbsp;<span class="builtintype" id="2953718">nil</span>&nbsp;<span class="op" id="2953722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953726">m</span>&nbsp;<span class="op" id="2953728">=</span>&nbsp;<span class="builtinfunc" id="2953730">new</span><span class="op" id="2953733">(</span><span class="ident" id="2953734">big</span><span class="op" id="2953737">.</span><span class="ident" id="2953738">Int</span><span class="op" id="2953741">)</span><span class="op" id="2953742">.</span><span class="ident" id="2953743">Exp</span><span class="op" id="2953746">(</span><span class="ident" id="2953747">c</span><span class="op" id="2953748">,</span>&nbsp;<span class="ident" id="2953750">priv</span><span class="op" id="2953754">.</span><span class="ident" id="2953755">D</span><span class="op" id="2953756">,</span>&nbsp;<span class="ident" id="2953758">priv</span><span class="op" id="2953762">.</span><span class="ident" id="2953763">N</span><span class="op" id="2953764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2953767">}</span>&nbsp;<span class="keyword" id="2953769">else</span>&nbsp;<span class="op" id="2953774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2953778">//&nbsp;We&nbsp;have&nbsp;the&nbsp;precalculated&nbsp;values&nbsp;needed&nbsp;for&nbsp;the&nbsp;CRT.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953836">m</span>&nbsp;<span class="op" id="2953838">=</span>&nbsp;<span class="builtinfunc" id="2953840">new</span><span class="op" id="2953843">(</span><span class="ident" id="2953844">big</span><span class="op" id="2953847">.</span><span class="ident" id="2953848">Int</span><span class="op" id="2953851">)</span><span class="op" id="2953852">.</span><span class="ident" id="2953853">Exp</span><span class="op" id="2953856">(</span><span class="ident" id="2953857">c</span><span class="op" id="2953858">,</span>&nbsp;<span class="ident" id="2953860">priv</span><span class="op" id="2953864">.</span><span class="ident" id="2953865">Precomputed</span><span class="op" id="2953876">.</span><span class="ident" id="2953877">Dp</span><span class="op" id="2953879">,</span>&nbsp;<span class="ident" id="2953881">priv</span><span class="op" id="2953885">.</span><span class="ident" id="2953886">Primes</span><span class="op" id="2953892">[</span><span class="num" id="2953893">0</span><span class="op" id="2953894">]</span><span class="op" id="2953895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953899">m2</span>&nbsp;<span class="op" id="2953902">:=</span>&nbsp;<span class="builtinfunc" id="2953905">new</span><span class="op" id="2953908">(</span><span class="ident" id="2953909">big</span><span class="op" id="2953912">.</span><span class="ident" id="2953913">Int</span><span class="op" id="2953916">)</span><span class="op" id="2953917">.</span><span class="ident" id="2953918">Exp</span><span class="op" id="2953921">(</span><span class="ident" id="2953922">c</span><span class="op" id="2953923">,</span>&nbsp;<span class="ident" id="2953925">priv</span><span class="op" id="2953929">.</span><span class="ident" id="2953930">Precomputed</span><span class="op" id="2953941">.</span><span class="ident" id="2953942">Dq</span><span class="op" id="2953944">,</span>&nbsp;<span class="ident" id="2953946">priv</span><span class="op" id="2953950">.</span><span class="ident" id="2953951">Primes</span><span class="op" id="2953957">[</span><span class="num" id="2953958">1</span><span class="op" id="2953959">]</span><span class="op" id="2953960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2953964">m</span><span class="op" id="2953965">.</span><span class="ident" id="2953966">Sub</span><span class="op" id="2953969">(</span><span class="ident" id="2953970">m</span><span class="op" id="2953971">,</span>&nbsp;<span class="ident" id="2953973">m2</span><span class="op" id="2953975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2953979">if</span>&nbsp;<span class="ident" id="2953982">m</span><span class="op" id="2953983">.</span><span class="ident" id="2953984">Sign</span><span class="op" id="2953988">(</span><span class="op" id="2953989">)</span>&nbsp;<span class="op" id="2953991">&lt;</span>&nbsp;<span class="num" id="2953993">0</span>&nbsp;<span class="op" id="2953995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954000">m</span><span class="op" id="2954001">.</span><span class="ident" id="2954002">Add</span><span class="op" id="2954005">(</span><span class="ident" id="2954006">m</span><span class="op" id="2954007">,</span>&nbsp;<span class="ident" id="2954009">priv</span><span class="op" id="2954013">.</span><span class="ident" id="2954014">Primes</span><span class="op" id="2954020">[</span><span class="num" id="2954021">0</span><span class="op" id="2954022">]</span><span class="op" id="2954023">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2954027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954031">m</span><span class="op" id="2954032">.</span><span class="ident" id="2954033">Mul</span><span class="op" id="2954036">(</span><span class="ident" id="2954037">m</span><span class="op" id="2954038">,</span>&nbsp;<span class="ident" id="2954040">priv</span><span class="op" id="2954044">.</span><span class="ident" id="2954045">Precomputed</span><span class="op" id="2954056">.</span><span class="ident" id="2954057">Qinv</span><span class="op" id="2954061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954065">m</span><span class="op" id="2954066">.</span><span class="ident" id="2954067">Mod</span><span class="op" id="2954070">(</span><span class="ident" id="2954071">m</span><span class="op" id="2954072">,</span>&nbsp;<span class="ident" id="2954074">priv</span><span class="op" id="2954078">.</span><span class="ident" id="2954079">Primes</span><span class="op" id="2954085">[</span><span class="num" id="2954086">0</span><span class="op" id="2954087">]</span><span class="op" id="2954088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954092">m</span><span class="op" id="2954093">.</span><span class="ident" id="2954094">Mul</span><span class="op" id="2954097">(</span><span class="ident" id="2954098">m</span><span class="op" id="2954099">,</span>&nbsp;<span class="ident" id="2954101">priv</span><span class="op" id="2954105">.</span><span class="ident" id="2954106">Primes</span><span class="op" id="2954112">[</span><span class="num" id="2954113">1</span><span class="op" id="2954114">]</span><span class="op" id="2954115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954119">m</span><span class="op" id="2954120">.</span><span class="ident" id="2954121">Add</span><span class="op" id="2954124">(</span><span class="ident" id="2954125">m</span><span class="op" id="2954126">,</span>&nbsp;<span class="ident" id="2954128">m2</span><span class="op" id="2954130">)</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2954135">for</span>&nbsp;<span class="ident" id="2954139">i</span><span class="op" id="2954140">,</span>&nbsp;<span class="ident" id="2954142">values</span>&nbsp;<span class="op" id="2954149">:=</span>&nbsp;<span class="keyword" id="2954152">range</span>&nbsp;<span class="ident" id="2954158">priv</span><span class="op" id="2954162">.</span><span class="ident" id="2954163">Precomputed</span><span class="op" id="2954174">.</span><span class="ident" id="2954175">CRTValues</span>&nbsp;<span class="op" id="2954185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954190">prime</span>&nbsp;<span class="op" id="2954196">:=</span>&nbsp;<span class="ident" id="2954199">priv</span><span class="op" id="2954203">.</span><span class="ident" id="2954204">Primes</span><span class="op" id="2954210">[</span><span class="num" id="2954211">2</span><span class="op" id="2954212">+</span><span class="ident" id="2954213">i</span><span class="op" id="2954214">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954219">m2</span><span class="op" id="2954221">.</span><span class="ident" id="2954222">Exp</span><span class="op" id="2954225">(</span><span class="ident" id="2954226">c</span><span class="op" id="2954227">,</span>&nbsp;<span class="ident" id="2954229">values</span><span class="op" id="2954235">.</span><span class="ident" id="2954236">Exp</span><span class="op" id="2954239">,</span>&nbsp;<span class="ident" id="2954241">prime</span><span class="op" id="2954246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954251">m2</span><span class="op" id="2954253">.</span><span class="ident" id="2954254">Sub</span><span class="op" id="2954257">(</span><span class="ident" id="2954258">m2</span><span class="op" id="2954260">,</span>&nbsp;<span class="ident" id="2954262">m</span><span class="op" id="2954263">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954268">m2</span><span class="op" id="2954270">.</span><span class="ident" id="2954271">Mul</span><span class="op" id="2954274">(</span><span class="ident" id="2954275">m2</span><span class="op" id="2954277">,</span>&nbsp;<span class="ident" id="2954279">values</span><span class="op" id="2954285">.</span><span class="ident" id="2954286">Coeff</span><span class="op" id="2954291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954296">m2</span><span class="op" id="2954298">.</span><span class="ident" id="2954299">Mod</span><span class="op" id="2954302">(</span><span class="ident" id="2954303">m2</span><span class="op" id="2954305">,</span>&nbsp;<span class="ident" id="2954307">prime</span><span class="op" id="2954312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2954317">if</span>&nbsp;<span class="ident" id="2954320">m2</span><span class="op" id="2954322">.</span><span class="ident" id="2954323">Sign</span><span class="op" id="2954327">(</span><span class="op" id="2954328">)</span>&nbsp;<span class="op" id="2954330">&lt;</span>&nbsp;<span class="num" id="2954332">0</span>&nbsp;<span class="op" id="2954334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954340">m2</span><span class="op" id="2954342">.</span><span class="ident" id="2954343">Add</span><span class="op" id="2954346">(</span><span class="ident" id="2954347">m2</span><span class="op" id="2954349">,</span>&nbsp;<span class="ident" id="2954351">prime</span><span class="op" id="2954356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2954361">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954366">m2</span><span class="op" id="2954368">.</span><span class="ident" id="2954369">Mul</span><span class="op" id="2954372">(</span><span class="ident" id="2954373">m2</span><span class="op" id="2954375">,</span>&nbsp;<span class="ident" id="2954377">values</span><span class="op" id="2954383">.</span><span class="ident" id="2954384">R</span><span class="op" id="2954385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954390">m</span><span class="op" id="2954391">.</span><span class="ident" id="2954392">Add</span><span class="op" id="2954395">(</span><span class="ident" id="2954396">m</span><span class="op" id="2954397">,</span>&nbsp;<span class="ident" id="2954399">m2</span><span class="op" id="2954401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2954405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2954408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2954412">if</span>&nbsp;<span class="ident" id="2954415">ir</span>&nbsp;<span class="op" id="2954418">!=</span>&nbsp;<span class="builtintype" id="2954421">nil</span>&nbsp;<span class="op" id="2954425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2954429">//&nbsp;Unblind.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954443">m</span><span class="op" id="2954444">.</span><span class="ident" id="2954445">Mul</span><span class="op" id="2954448">(</span><span class="ident" id="2954449">m</span><span class="op" id="2954450">,</span>&nbsp;<span class="ident" id="2954452">ir</span><span class="op" id="2954454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954458">m</span><span class="op" id="2954459">.</span><span class="ident" id="2954460">Mod</span><span class="op" id="2954463">(</span><span class="ident" id="2954464">m</span><span class="op" id="2954465">,</span>&nbsp;<span class="ident" id="2954467">priv</span><span class="op" id="2954471">.</span><span class="ident" id="2954472">N</span><span class="op" id="2954473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2954476">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2954480">return</span><br>
<span class="lineno"></span><span class="op" id="2954487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2954490">//&nbsp;DecryptOAEP&nbsp;decrypts&nbsp;ciphertext&nbsp;using&nbsp;RSA-OAEP.</span><br>
<span class="lineno">475</span><span class="comment" id="2954541">//&nbsp;If&nbsp;random&nbsp;!=&nbsp;nil,&nbsp;DecryptOAEP&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="2954630">func</span>&nbsp;<span class="ident" id="2954635">DecryptOAEP</span><span class="op" id="2954646">(</span><span class="ident" id="2954647">hash</span>&nbsp;<span class="ident" id="2954652">hash</span><span class="op" id="2954656">.</span><span class="ident" id="2954657">Hash</span><span class="op" id="2954661">,</span>&nbsp;<span class="ident" id="2954663">random</span>&nbsp;<span class="ident" id="2954670">io</span><span class="op" id="2954672">.</span><span class="ident" id="2954673">Reader</span><span class="op" id="2954679">,</span>&nbsp;<span class="ident" id="2954681">priv</span>&nbsp;<span class="op" id="2954686">*</span><span class="ident" id="2954687">PrivateKey</span><span class="op" id="2954697">,</span>&nbsp;<span class="ident" id="2954699">ciphertext</span>&nbsp;<span class="op" id="2954710">[</span><span class="op" id="2954711">]</span><span class="builtintype" id="2954712">byte</span><span class="op" id="2954716">,</span>&nbsp;<span class="ident" id="2954718">label</span>&nbsp;<span class="op" id="2954724">[</span><span class="op" id="2954725">]</span><span class="builtintype" id="2954726">byte</span><span class="op" id="2954730">)</span>&nbsp;<span class="op" id="2954732">(</span><span class="ident" id="2954733">msg</span>&nbsp;<span class="op" id="2954737">[</span><span class="op" id="2954738">]</span><span class="builtintype" id="2954739">byte</span><span class="op" id="2954743">,</span>&nbsp;<span class="ident" id="2954745">err</span>&nbsp;<span class="builtintype" id="2954749">error</span><span class="op" id="2954754">)</span>&nbsp;<span class="op" id="2954756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2954759">if</span>&nbsp;<span class="ident" id="2954762">err</span>&nbsp;<span class="op" id="2954766">:=</span>&nbsp;<span class="ident" id="2954769">checkPub</span><span class="op" id="2954777">(</span><span class="op" id="2954778">&amp;</span><span class="ident" id="2954779">priv</span><span class="op" id="2954783">.</span><span class="ident" id="2954784">PublicKey</span><span class="op" id="2954793">)</span><span class="op" id="2954794">;</span>&nbsp;<span class="ident" id="2954796">err</span>&nbsp;<span class="op" id="2954800">!=</span>&nbsp;<span class="builtintype" id="2954803">nil</span>&nbsp;<span class="op" id="2954807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2954811">return</span>&nbsp;<span class="builtintype" id="2954818">nil</span><span class="op" id="2954821">,</span>&nbsp;<span class="ident" id="2954823">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2954828">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954831">k</span>&nbsp;<span class="op" id="2954833">:=</span>&nbsp;<span class="op" id="2954836">(</span><span class="ident" id="2954837">priv</span><span class="op" id="2954841">.</span><span class="ident" id="2954842">N</span><span class="op" id="2954843">.</span><span class="ident" id="2954844">BitLen</span><span class="op" id="2954850">(</span><span class="op" id="2954851">)</span>&nbsp;<span class="op" id="2954853">+</span>&nbsp;<span class="num" id="2954855">7</span><span class="op" id="2954856">)</span>&nbsp;<span class="op" id="2954858">/</span>&nbsp;<span class="num" id="2954860">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2954863">if</span>&nbsp;<span class="builtinfunc" id="2954866">len</span><span class="op" id="2954869">(</span><span class="ident" id="2954870">ciphertext</span><span class="op" id="2954880">)</span>&nbsp;<span class="op" id="2954882">&gt;</span>&nbsp;<span class="ident" id="2954884">k</span>&nbsp;<span class="op" id="2954886">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954891">k</span>&nbsp;<span class="op" id="2954893">&lt;</span>&nbsp;<span class="ident" id="2954895">hash</span><span class="op" id="2954899">.</span><span class="ident" id="2954900">Size</span><span class="op" id="2954904">(</span><span class="op" id="2954905">)</span><span class="op" id="2954906">*</span><span class="num" id="2954907">2</span><span class="op" id="2954908">+</span><span class="num" id="2954909">2</span>&nbsp;<span class="op" id="2954911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954915">err</span>&nbsp;<span class="op" id="2954919">=</span>&nbsp;<span class="ident" id="2954921">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2954937">return</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2954945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954949">c</span>&nbsp;<span class="op" id="2954951">:=</span>&nbsp;<span class="builtinfunc" id="2954954">new</span><span class="op" id="2954957">(</span><span class="ident" id="2954958">big</span><span class="op" id="2954961">.</span><span class="ident" id="2954962">Int</span><span class="op" id="2954965">)</span><span class="op" id="2954966">.</span><span class="ident" id="2954967">SetBytes</span><span class="op" id="2954975">(</span><span class="ident" id="2954976">ciphertext</span><span class="op" id="2954986">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2954990">m</span><span class="op" id="2954991">,</span>&nbsp;<span class="ident" id="2954993">err</span>&nbsp;<span class="op" id="2954997">:=</span>&nbsp;<span class="ident" id="2955000">decrypt</span><span class="op" id="2955007">(</span><span class="ident" id="2955008">random</span><span class="op" id="2955014">,</span>&nbsp;<span class="ident" id="2955016">priv</span><span class="op" id="2955020">,</span>&nbsp;<span class="ident" id="2955022">c</span><span class="op" id="2955023">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2955026">if</span>&nbsp;<span class="ident" id="2955029">err</span>&nbsp;<span class="op" id="2955033">!=</span>&nbsp;<span class="builtintype" id="2955036">nil</span>&nbsp;<span class="op" id="2955040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2955044">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2955052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955056">hash</span><span class="op" id="2955060">.</span><span class="ident" id="2955061">Write</span><span class="op" id="2955066">(</span><span class="ident" id="2955067">label</span><span class="op" id="2955072">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955075">lHash</span>&nbsp;<span class="op" id="2955081">:=</span>&nbsp;<span class="ident" id="2955084">hash</span><span class="op" id="2955088">.</span><span class="ident" id="2955089">Sum</span><span class="op" id="2955092">(</span><span class="builtintype" id="2955093">nil</span><span class="op" id="2955096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955099">hash</span><span class="op" id="2955103">.</span><span class="ident" id="2955104">Reset</span><span class="op" id="2955109">(</span><span class="op" id="2955110">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2955114">//&nbsp;Converting&nbsp;the&nbsp;plaintext&nbsp;number&nbsp;to&nbsp;bytes&nbsp;will&nbsp;strip&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2955174">//&nbsp;leading&nbsp;zeros&nbsp;so&nbsp;we&nbsp;may&nbsp;have&nbsp;to&nbsp;left&nbsp;pad.&nbsp;We&nbsp;do&nbsp;this&nbsp;unconditionally</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2955247">//&nbsp;to&nbsp;avoid&nbsp;leaking&nbsp;timing&nbsp;information.&nbsp;(Although&nbsp;we&nbsp;still&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2955316">//&nbsp;leak&nbsp;the&nbsp;number&nbsp;of&nbsp;leading&nbsp;zeros.&nbsp;It&#39;s&nbsp;not&nbsp;clear&nbsp;that&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2955384">//&nbsp;anything&nbsp;about&nbsp;this.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955410">em</span>&nbsp;<span class="op" id="2955413">:=</span>&nbsp;<span class="ident" id="2955416">leftPad</span><span class="op" id="2955423">(</span><span class="ident" id="2955424">m</span><span class="op" id="2955425">.</span><span class="ident" id="2955426">Bytes</span><span class="op" id="2955431">(</span><span class="op" id="2955432">)</span><span class="op" id="2955433">,</span>&nbsp;<span class="ident" id="2955435">k</span><span class="op" id="2955436">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955440">firstByteIsZero</span>&nbsp;<span class="op" id="2955456">:=</span>&nbsp;<span class="ident" id="2955459">subtle</span><span class="op" id="2955465">.</span><span class="ident" id="2955466">ConstantTimeByteEq</span><span class="op" id="2955484">(</span><span class="ident" id="2955485">em</span><span class="op" id="2955487">[</span><span class="num" id="2955488">0</span><span class="op" id="2955489">]</span><span class="op" id="2955490">,</span>&nbsp;<span class="num" id="2955492">0</span><span class="op" id="2955493">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955497">seed</span>&nbsp;<span class="op" id="2955502">:=</span>&nbsp;<span class="ident" id="2955505">em</span><span class="op" id="2955507">[</span><span class="num" id="2955508">1</span>&nbsp;<span class="op" id="2955510">:</span>&nbsp;<span class="ident" id="2955512">hash</span><span class="op" id="2955516">.</span><span class="ident" id="2955517">Size</span><span class="op" id="2955521">(</span><span class="op" id="2955522">)</span><span class="op" id="2955523">+</span><span class="num" id="2955524">1</span><span class="op" id="2955525">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955528">db</span>&nbsp;<span class="op" id="2955531">:=</span>&nbsp;<span class="ident" id="2955534">em</span><span class="op" id="2955536">[</span><span class="ident" id="2955537">hash</span><span class="op" id="2955541">.</span><span class="ident" id="2955542">Size</span><span class="op" id="2955546">(</span><span class="op" id="2955547">)</span><span class="op" id="2955548">+</span><span class="num" id="2955549">1</span><span class="op" id="2955550">:</span><span class="op" id="2955551">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955555">mgf1XOR</span><span class="op" id="2955562">(</span><span class="ident" id="2955563">seed</span><span class="op" id="2955567">,</span>&nbsp;<span class="ident" id="2955569">hash</span><span class="op" id="2955573">,</span>&nbsp;<span class="ident" id="2955575">db</span><span class="op" id="2955577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955580">mgf1XOR</span><span class="op" id="2955587">(</span><span class="ident" id="2955588">db</span><span class="op" id="2955590">,</span>&nbsp;<span class="ident" id="2955592">hash</span><span class="op" id="2955596">,</span>&nbsp;<span class="ident" id="2955598">seed</span><span class="op" id="2955602">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955606">lHash2</span>&nbsp;<span class="op" id="2955613">:=</span>&nbsp;<span class="ident" id="2955616">db</span><span class="op" id="2955618">[</span><span class="num" id="2955619">0</span><span class="op" id="2955620">:</span><span class="ident" id="2955621">hash</span><span class="op" id="2955625">.</span><span class="ident" id="2955626">Size</span><span class="op" id="2955630">(</span><span class="op" id="2955631">)</span><span class="op" id="2955632">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2955636">//&nbsp;We&nbsp;have&nbsp;to&nbsp;validate&nbsp;the&nbsp;plaintext&nbsp;in&nbsp;constant&nbsp;time&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2955709">//&nbsp;attacks&nbsp;like:&nbsp;J.&nbsp;Manger.&nbsp;A&nbsp;Chosen&nbsp;Ciphertext&nbsp;Attack&nbsp;on&nbsp;RSA&nbsp;Optimal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2955780">//&nbsp;Asymmetric&nbsp;Encryption&nbsp;Padding&nbsp;(OAEP)&nbsp;as&nbsp;Standardized&nbsp;in&nbsp;PKCS&nbsp;#1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2955848">//&nbsp;v2.0.&nbsp;In&nbsp;J.&nbsp;Kilian,&nbsp;editor,&nbsp;Advances&nbsp;in&nbsp;Cryptology.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2955904">lHash2Good</span>&nbsp;<span class="op" id="2955915">:=</span>&nbsp;<span class="ident" id="2955918">subtle</span><span class="op" id="2955924">.</span><span class="ident" id="2955925">ConstantTimeCompare</span><span class="op" id="2955944">(</span><span class="ident" id="2955945">lHash</span><span class="op" id="2955950">,</span>&nbsp;<span class="ident" id="2955952">lHash2</span><span class="op" id="2955958">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2955962">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;plaintext&nbsp;must&nbsp;be&nbsp;zero&nbsp;or&nbsp;more&nbsp;0x00,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2956033">//&nbsp;by&nbsp;0x01,&nbsp;followed&nbsp;by&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2956071">//&nbsp;&nbsp;&nbsp;lookingForIndex:&nbsp;1&nbsp;iff&nbsp;we&nbsp;are&nbsp;still&nbsp;looking&nbsp;for&nbsp;the&nbsp;0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2956134">//&nbsp;&nbsp;&nbsp;index:&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;0x01&nbsp;byte</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2956181">//&nbsp;&nbsp;&nbsp;invalid:&nbsp;1&nbsp;iff&nbsp;we&nbsp;saw&nbsp;a&nbsp;non-zero&nbsp;byte&nbsp;before&nbsp;the&nbsp;0x01.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2956242">var</span>&nbsp;<span class="ident" id="2956246">lookingForIndex</span><span class="op" id="2956261">,</span>&nbsp;<span class="ident" id="2956263">index</span><span class="op" id="2956268">,</span>&nbsp;<span class="ident" id="2956270">invalid</span>&nbsp;<span class="builtintype" id="2956278">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2956283">lookingForIndex</span>&nbsp;<span class="op" id="2956299">=</span>&nbsp;<span class="num" id="2956301">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2956304">rest</span>&nbsp;<span class="op" id="2956309">:=</span>&nbsp;<span class="ident" id="2956312">db</span><span class="op" id="2956314">[</span><span class="ident" id="2956315">hash</span><span class="op" id="2956319">.</span><span class="ident" id="2956320">Size</span><span class="op" id="2956324">(</span><span class="op" id="2956325">)</span><span class="op" id="2956326">:</span><span class="op" id="2956327">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2956331">for</span>&nbsp;<span class="ident" id="2956335">i</span>&nbsp;<span class="op" id="2956337">:=</span>&nbsp;<span class="num" id="2956340">0</span><span class="op" id="2956341">;</span>&nbsp;<span class="ident" id="2956343">i</span>&nbsp;<span class="op" id="2956345">&lt;</span>&nbsp;<span class="builtinfunc" id="2956347">len</span><span class="op" id="2956350">(</span><span class="ident" id="2956351">rest</span><span class="op" id="2956355">)</span><span class="op" id="2956356">;</span>&nbsp;<span class="ident" id="2956358">i</span><span class="op" id="2956359">++</span>&nbsp;<span class="op" id="2956362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2956366">equals0</span>&nbsp;<span class="op" id="2956374">:=</span>&nbsp;<span class="ident" id="2956377">subtle</span><span class="op" id="2956383">.</span><span class="ident" id="2956384">ConstantTimeByteEq</span><span class="op" id="2956402">(</span><span class="ident" id="2956403">rest</span><span class="op" id="2956407">[</span><span class="ident" id="2956408">i</span><span class="op" id="2956409">]</span><span class="op" id="2956410">,</span>&nbsp;<span class="num" id="2956412">0</span><span class="op" id="2956413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2956417">equals1</span>&nbsp;<span class="op" id="2956425">:=</span>&nbsp;<span class="ident" id="2956428">subtle</span><span class="op" id="2956434">.</span><span class="ident" id="2956435">ConstantTimeByteEq</span><span class="op" id="2956453">(</span><span class="ident" id="2956454">rest</span><span class="op" id="2956458">[</span><span class="ident" id="2956459">i</span><span class="op" id="2956460">]</span><span class="op" id="2956461">,</span>&nbsp;<span class="num" id="2956463">1</span><span class="op" id="2956464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2956468">index</span>&nbsp;<span class="op" id="2956474">=</span>&nbsp;<span class="ident" id="2956476">subtle</span><span class="op" id="2956482">.</span><span class="ident" id="2956483">ConstantTimeSelect</span><span class="op" id="2956501">(</span><span class="ident" id="2956502">lookingForIndex</span><span class="op" id="2956517">&amp;</span><span class="ident" id="2956518">equals1</span><span class="op" id="2956525">,</span>&nbsp;<span class="ident" id="2956527">i</span><span class="op" id="2956528">,</span>&nbsp;<span class="ident" id="2956530">index</span><span class="op" id="2956535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2956539">lookingForIndex</span>&nbsp;<span class="op" id="2956555">=</span>&nbsp;<span class="ident" id="2956557">subtle</span><span class="op" id="2956563">.</span><span class="ident" id="2956564">ConstantTimeSelect</span><span class="op" id="2956582">(</span><span class="ident" id="2956583">equals1</span><span class="op" id="2956590">,</span>&nbsp;<span class="num" id="2956592">0</span><span class="op" id="2956593">,</span>&nbsp;<span class="ident" id="2956595">lookingForIndex</span><span class="op" id="2956610">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2956614">invalid</span>&nbsp;<span class="op" id="2956622">=</span>&nbsp;<span class="ident" id="2956624">subtle</span><span class="op" id="2956630">.</span><span class="ident" id="2956631">ConstantTimeSelect</span><span class="op" id="2956649">(</span><span class="ident" id="2956650">lookingForIndex</span><span class="op" id="2956665">&amp;^</span><span class="ident" id="2956667">equals0</span><span class="op" id="2956674">,</span>&nbsp;<span class="num" id="2956676">1</span><span class="op" id="2956677">,</span>&nbsp;<span class="ident" id="2956679">invalid</span><span class="op" id="2956686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2956689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2956693">if</span>&nbsp;<span class="ident" id="2956696">firstByteIsZero</span><span class="op" id="2956711">&amp;</span><span class="ident" id="2956712">lHash2Good</span><span class="op" id="2956722">&amp;^</span><span class="ident" id="2956724">invalid</span><span class="op" id="2956731">&amp;^</span><span class="ident" id="2956733">lookingForIndex</span>&nbsp;<span class="op" id="2956749">!=</span>&nbsp;<span class="num" id="2956752">1</span>&nbsp;<span class="op" id="2956754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2956758">err</span>&nbsp;<span class="op" id="2956762">=</span>&nbsp;<span class="ident" id="2956764">ErrDecryption</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2956780">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2956788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2956792">msg</span>&nbsp;<span class="op" id="2956796">=</span>&nbsp;<span class="ident" id="2956798">rest</span><span class="op" id="2956802">[</span><span class="ident" id="2956803">index</span><span class="op" id="2956808">+</span><span class="num" id="2956809">1</span><span class="op" id="2956810">:</span><span class="op" id="2956811">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2956814">return</span><br>
<span class="lineno">545</span><span class="op" id="2956821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2956824">//&nbsp;leftPad&nbsp;returns&nbsp;a&nbsp;new&nbsp;slice&nbsp;of&nbsp;length&nbsp;size.&nbsp;The&nbsp;contents&nbsp;of&nbsp;input&nbsp;are&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="2956903">//&nbsp;aligned&nbsp;in&nbsp;the&nbsp;new&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="2956932">func</span>&nbsp;<span class="ident" id="2956937">leftPad</span><span class="op" id="2956944">(</span><span class="ident" id="2956945">input</span>&nbsp;<span class="op" id="2956951">[</span><span class="op" id="2956952">]</span><span class="builtintype" id="2956953">byte</span><span class="op" id="2956957">,</span>&nbsp;<span class="ident" id="2956959">size</span>&nbsp;<span class="builtintype" id="2956964">int</span><span class="op" id="2956967">)</span>&nbsp;<span class="op" id="2956969">(</span><span class="ident" id="2956970">out</span>&nbsp;<span class="op" id="2956974">[</span><span class="op" id="2956975">]</span><span class="builtintype" id="2956976">byte</span><span class="op" id="2956980">)</span>&nbsp;<span class="op" id="2956982">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2956985">n</span>&nbsp;<span class="op" id="2956987">:=</span>&nbsp;<span class="builtinfunc" id="2956990">len</span><span class="op" id="2956993">(</span><span class="ident" id="2956994">input</span><span class="op" id="2956999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2957002">if</span>&nbsp;<span class="ident" id="2957005">n</span>&nbsp;<span class="op" id="2957007">&gt;</span>&nbsp;<span class="ident" id="2957009">size</span>&nbsp;<span class="op" id="2957014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957018">n</span>&nbsp;<span class="op" id="2957020">=</span>&nbsp;<span class="ident" id="2957022">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2957028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2957031">out</span>&nbsp;<span class="op" id="2957035">=</span>&nbsp;<span class="builtinfunc" id="2957037">make</span><span class="op" id="2957041">(</span><span class="op" id="2957042">[</span><span class="op" id="2957043">]</span><span class="builtintype" id="2957044">byte</span><span class="op" id="2957048">,</span>&nbsp;<span class="ident" id="2957050">size</span><span class="op" id="2957054">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2957057">copy</span><span class="op" id="2957061">(</span><span class="ident" id="2957062">out</span><span class="op" id="2957065">[</span><span class="builtinfunc" id="2957066">len</span><span class="op" id="2957069">(</span><span class="ident" id="2957070">out</span><span class="op" id="2957073">)</span><span class="op" id="2957074">-</span><span class="ident" id="2957075">n</span><span class="op" id="2957076">:</span><span class="op" id="2957077">]</span><span class="op" id="2957078">,</span>&nbsp;<span class="ident" id="2957080">input</span><span class="op" id="2957085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2957088">return</span><br>
<span class="lineno"></span><span class="op" id="2957095">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
