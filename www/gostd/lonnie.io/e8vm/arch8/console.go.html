<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5045378">package</span>&nbsp;<span class="ident" id="5045386">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5045393">import</span>&nbsp;<span class="op" id="5045400">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5045403">&#34;io&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5045409">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5045416">&#34;os&#34;</span><br>
<span class="lineno"></span><span class="op" id="5045421">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5045424">//&nbsp;Console&nbsp;is&nbsp;a&nbsp;simple&nbsp;console&nbsp;that&nbsp;can&nbsp;output/input&nbsp;a&nbsp;single</span><br>
<span class="lineno">10</span><span class="comment" id="5045486">//&nbsp;byte&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span><span class="keyword" id="5045504">type</span>&nbsp;<span class="ident" id="5045509">console</span>&nbsp;<span class="keyword" id="5045517">struct</span>&nbsp;<span class="op" id="5045524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045527">intBus</span>&nbsp;<span class="ident" id="5045534">intBus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045542">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5045549">*</span><span class="ident" id="5045550">page</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045557">Core</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5045564">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045570">IntIn</span>&nbsp;&nbsp;<span class="builtintype" id="5045577">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045583">IntOut</span>&nbsp;<span class="builtintype" id="5045590">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045597">Output</span>&nbsp;<span class="ident" id="5045604">io</span><span class="op" id="5045606">.</span><span class="ident" id="5045607">Writer</span><br>
<span class="lineno">20</span><span class="op" id="5045614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5045617">//&nbsp;NewConsole&nbsp;creates&nbsp;a&nbsp;new&nbsp;simple&nbsp;console.</span><br>
<span class="lineno"></span><span class="keyword" id="5045661">func</span>&nbsp;<span class="ident" id="5045666">newConsole</span><span class="op" id="5045676">(</span><span class="ident" id="5045677">p</span>&nbsp;<span class="op" id="5045679">*</span><span class="ident" id="5045680">page</span><span class="op" id="5045684">,</span>&nbsp;<span class="ident" id="5045686">i</span>&nbsp;<span class="ident" id="5045688">intBus</span><span class="op" id="5045694">)</span>&nbsp;<span class="op" id="5045696">*</span><span class="ident" id="5045697">console</span>&nbsp;<span class="op" id="5045705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045708">ret</span>&nbsp;<span class="op" id="5045712">:=</span>&nbsp;<span class="builtinfunc" id="5045715">new</span><span class="op" id="5045718">(</span><span class="ident" id="5045719">console</span><span class="op" id="5045726">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045729">ret</span><span class="op" id="5045732">.</span><span class="ident" id="5045733">intBus</span>&nbsp;<span class="op" id="5045740">=</span>&nbsp;<span class="ident" id="5045742">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045745">ret</span><span class="op" id="5045748">.</span><span class="ident" id="5045749">p</span>&nbsp;<span class="op" id="5045751">=</span>&nbsp;<span class="ident" id="5045753">p</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045757">ret</span><span class="op" id="5045760">.</span><span class="ident" id="5045761">Core</span>&nbsp;<span class="op" id="5045766">=</span>&nbsp;<span class="num" id="5045768">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045771">ret</span><span class="op" id="5045774">.</span><span class="ident" id="5045775">IntIn</span>&nbsp;<span class="op" id="5045781">=</span>&nbsp;<span class="num" id="5045783">8</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045786">ret</span><span class="op" id="5045789">.</span><span class="ident" id="5045790">IntOut</span>&nbsp;<span class="op" id="5045797">=</span>&nbsp;<span class="num" id="5045799">9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045803">ret</span><span class="op" id="5045806">.</span><span class="ident" id="5045807">Output</span>&nbsp;<span class="op" id="5045814">=</span>&nbsp;<span class="ident" id="5045816">os</span><span class="op" id="5045818">.</span><span class="ident" id="5045819">Stdout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045827">return</span>&nbsp;<span class="ident" id="5045834">ret</span><br>
<span class="lineno"></span><span class="op" id="5045838">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="5045841">var</span>&nbsp;<span class="ident" id="5045845">_</span>&nbsp;<span class="ident" id="5045847">device</span>&nbsp;<span class="op" id="5045854">=</span>&nbsp;<span class="builtinfunc" id="5045856">new</span><span class="op" id="5045859">(</span><span class="ident" id="5045860">console</span><span class="op" id="5045867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5045870">const</span>&nbsp;<span class="op" id="5045876">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045879">consoleBase</span>&nbsp;<span class="op" id="5045891">=</span>&nbsp;<span class="num" id="5045893">0</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045897">consoleOut</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5045913">=</span>&nbsp;<span class="ident" id="5045915">consoleBase</span>&nbsp;<span class="op" id="5045927">+</span>&nbsp;<span class="num" id="5045929">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045932">consoleOutValid</span>&nbsp;<span class="op" id="5045948">=</span>&nbsp;<span class="ident" id="5045950">consoleBase</span>&nbsp;<span class="op" id="5045962">+</span>&nbsp;<span class="num" id="5045964">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045967">consoleIn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5045983">=</span>&nbsp;<span class="ident" id="5045985">consoleBase</span>&nbsp;<span class="op" id="5045997">+</span>&nbsp;<span class="num" id="5045999">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046002">consoleInValid</span>&nbsp;&nbsp;<span class="op" id="5046018">=</span>&nbsp;<span class="ident" id="5046020">consoleBase</span>&nbsp;<span class="op" id="5046032">+</span>&nbsp;<span class="num" id="5046034">3</span><br>
<span class="lineno">45</span><span class="op" id="5046036">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5046039">func</span>&nbsp;<span class="op" id="5046044">(</span><span class="ident" id="5046045">c</span>&nbsp;<span class="op" id="5046047">*</span><span class="ident" id="5046048">console</span><span class="op" id="5046055">)</span>&nbsp;<span class="ident" id="5046057">interrupt</span><span class="op" id="5046066">(</span><span class="ident" id="5046067">code</span>&nbsp;<span class="builtintype" id="5046072">byte</span><span class="op" id="5046076">)</span>&nbsp;<span class="op" id="5046078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046081">c</span><span class="op" id="5046082">.</span><span class="ident" id="5046083">intBus</span><span class="op" id="5046089">.</span><span class="ident" id="5046090">Interrupt</span><span class="op" id="5046099">(</span><span class="ident" id="5046100">code</span><span class="op" id="5046104">,</span>&nbsp;<span class="ident" id="5046106">c</span><span class="op" id="5046107">.</span><span class="ident" id="5046108">Core</span><span class="op" id="5046112">)</span><br>
<span class="lineno"></span><span class="op" id="5046114">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="5046117">//&nbsp;Tick&nbsp;flushes&nbsp;the&nbsp;buffered&nbsp;byte&nbsp;to&nbsp;the&nbsp;console.</span><br>
<span class="lineno"></span><span class="keyword" id="5046167">func</span>&nbsp;<span class="op" id="5046172">(</span><span class="ident" id="5046173">c</span>&nbsp;<span class="op" id="5046175">*</span><span class="ident" id="5046176">console</span><span class="op" id="5046183">)</span>&nbsp;<span class="ident" id="5046185">Tick</span><span class="op" id="5046189">(</span><span class="op" id="5046190">)</span>&nbsp;<span class="op" id="5046192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046195">outValid</span>&nbsp;<span class="op" id="5046204">:=</span>&nbsp;<span class="ident" id="5046207">c</span><span class="op" id="5046208">.</span><span class="ident" id="5046209">p</span><span class="op" id="5046210">.</span><span class="ident" id="5046211">ReadByte</span><span class="op" id="5046219">(</span><span class="ident" id="5046220">consoleOutValid</span><span class="op" id="5046235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5046238">if</span>&nbsp;<span class="ident" id="5046241">outValid</span>&nbsp;<span class="op" id="5046250">!=</span>&nbsp;<span class="num" id="5046253">0</span>&nbsp;<span class="op" id="5046255">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046259">out</span>&nbsp;<span class="op" id="5046263">:=</span>&nbsp;<span class="ident" id="5046266">c</span><span class="op" id="5046267">.</span><span class="ident" id="5046268">p</span><span class="op" id="5046269">.</span><span class="ident" id="5046270">ReadByte</span><span class="op" id="5046278">(</span><span class="ident" id="5046279">consoleOut</span><span class="op" id="5046289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046293">_</span><span class="op" id="5046294">,</span>&nbsp;<span class="ident" id="5046296">e</span>&nbsp;<span class="op" id="5046298">:=</span>&nbsp;<span class="ident" id="5046301">c</span><span class="op" id="5046302">.</span><span class="ident" id="5046303">Output</span><span class="op" id="5046309">.</span><span class="ident" id="5046310">Write</span><span class="op" id="5046315">(</span><span class="op" id="5046316">[</span><span class="op" id="5046317">]</span><span class="builtintype" id="5046318">byte</span><span class="op" id="5046322">{</span><span class="ident" id="5046323">out</span><span class="op" id="5046326">}</span><span class="op" id="5046327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5046331">if</span>&nbsp;<span class="ident" id="5046334">e</span>&nbsp;<span class="op" id="5046336">!=</span>&nbsp;<span class="ident" id="5046339">nil</span>&nbsp;<span class="op" id="5046343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046348">log</span><span class="op" id="5046351">.</span><span class="ident" id="5046352">Print</span><span class="op" id="5046357">(</span><span class="ident" id="5046358">e</span><span class="op" id="5046359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5046363">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046367">c</span><span class="op" id="5046368">.</span><span class="ident" id="5046369">p</span><span class="op" id="5046370">.</span><span class="ident" id="5046371">WriteByte</span><span class="op" id="5046380">(</span><span class="ident" id="5046381">consoleOutValid</span><span class="op" id="5046396">,</span>&nbsp;<span class="num" id="5046398">0</span><span class="op" id="5046399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046403">c</span><span class="op" id="5046404">.</span><span class="ident" id="5046405">interrupt</span><span class="op" id="5046414">(</span><span class="ident" id="5046415">c</span><span class="op" id="5046416">.</span><span class="ident" id="5046417">IntOut</span><span class="op" id="5046423">)</span>&nbsp;<span class="comment" id="5046425">//&nbsp;out&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5046443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5046447">//&nbsp;TODO:&nbsp;input&nbsp;part</span><br>
<span class="lineno">65</span><span class="op" id="5046467">}</span>
</div>
</body>
</html>
