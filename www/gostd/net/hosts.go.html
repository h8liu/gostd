<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3156129">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3156184">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3156238">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3156289">//&nbsp;Read&nbsp;static&nbsp;host/IP&nbsp;entries&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3156338">package</span>&nbsp;<span class="ident" id="3156346">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3156351">import</span>&nbsp;<span class="op" id="3156358">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3156361">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3156369">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3156376">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3156379">const</span>&nbsp;<span class="ident" id="3156385">cacheMaxAge</span>&nbsp;<span class="op" id="3156397">=</span>&nbsp;<span class="num" id="3156399">5</span>&nbsp;<span class="op" id="3156401">*</span>&nbsp;<span class="ident" id="3156403">time</span><span class="op" id="3156407">.</span><span class="ident" id="3156408">Minute</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3156416">//&nbsp;hostsPath&nbsp;points&nbsp;to&nbsp;the&nbsp;file&nbsp;with&nbsp;static&nbsp;IP/address&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="3156480">var</span>&nbsp;<span class="ident" id="3156484">hostsPath</span>&nbsp;<span class="op" id="3156494">=</span>&nbsp;<span class="string" id="3156496">&#34;/etc/hosts&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3156510">//&nbsp;Simple&nbsp;cache.</span><br>
<span class="lineno">20</span><span class="keyword" id="3156527">var</span>&nbsp;<span class="ident" id="3156531">hosts</span>&nbsp;<span class="keyword" id="3156537">struct</span>&nbsp;<span class="op" id="3156544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156547">sync</span><span class="op" id="3156551">.</span><span class="ident" id="3156552">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156559">byName</span>&nbsp;<span class="keyword" id="3156566">map</span><span class="op" id="3156569">[</span><span class="builtintype" id="3156570">string</span><span class="op" id="3156576">]</span><span class="op" id="3156577">[</span><span class="op" id="3156578">]</span><span class="builtintype" id="3156579">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156587">byAddr</span>&nbsp;<span class="keyword" id="3156594">map</span><span class="op" id="3156597">[</span><span class="builtintype" id="3156598">string</span><span class="op" id="3156604">]</span><span class="op" id="3156605">[</span><span class="op" id="3156606">]</span><span class="builtintype" id="3156607">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156615">expire</span>&nbsp;<span class="ident" id="3156622">time</span><span class="op" id="3156626">.</span><span class="ident" id="3156627">Time</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156633">path</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3156640">string</span><br>
<span class="lineno"></span><span class="op" id="3156647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3156650">func</span>&nbsp;<span class="ident" id="3156655">readHosts</span><span class="op" id="3156664">(</span><span class="op" id="3156665">)</span>&nbsp;<span class="op" id="3156667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156670">now</span>&nbsp;<span class="op" id="3156674">:=</span>&nbsp;<span class="ident" id="3156677">time</span><span class="op" id="3156681">.</span><span class="ident" id="3156682">Now</span><span class="op" id="3156685">(</span><span class="op" id="3156686">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156689">hp</span>&nbsp;<span class="op" id="3156692">:=</span>&nbsp;<span class="ident" id="3156695">hostsPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156706">if</span>&nbsp;<span class="builtinfunc" id="3156709">len</span><span class="op" id="3156712">(</span><span class="ident" id="3156713">hosts</span><span class="op" id="3156718">.</span><span class="ident" id="3156719">byName</span><span class="op" id="3156725">)</span>&nbsp;<span class="op" id="3156727">==</span>&nbsp;<span class="num" id="3156730">0</span>&nbsp;<span class="op" id="3156732">||</span>&nbsp;<span class="ident" id="3156735">now</span><span class="op" id="3156738">.</span><span class="ident" id="3156739">After</span><span class="op" id="3156744">(</span><span class="ident" id="3156745">hosts</span><span class="op" id="3156750">.</span><span class="ident" id="3156751">expire</span><span class="op" id="3156757">)</span>&nbsp;<span class="op" id="3156759">||</span>&nbsp;<span class="ident" id="3156762">hosts</span><span class="op" id="3156767">.</span><span class="ident" id="3156768">path</span>&nbsp;<span class="op" id="3156773">!=</span>&nbsp;<span class="ident" id="3156776">hp</span>&nbsp;<span class="op" id="3156779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156783">hs</span>&nbsp;<span class="op" id="3156786">:=</span>&nbsp;<span class="builtinfunc" id="3156789">make</span><span class="op" id="3156793">(</span><span class="keyword" id="3156794">map</span><span class="op" id="3156797">[</span><span class="builtintype" id="3156798">string</span><span class="op" id="3156804">]</span><span class="op" id="3156805">[</span><span class="op" id="3156806">]</span><span class="builtintype" id="3156807">string</span><span class="op" id="3156813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156817">is</span>&nbsp;<span class="op" id="3156820">:=</span>&nbsp;<span class="builtinfunc" id="3156823">make</span><span class="op" id="3156827">(</span><span class="keyword" id="3156828">map</span><span class="op" id="3156831">[</span><span class="builtintype" id="3156832">string</span><span class="op" id="3156838">]</span><span class="op" id="3156839">[</span><span class="op" id="3156840">]</span><span class="builtintype" id="3156841">string</span><span class="op" id="3156847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156851">var</span>&nbsp;<span class="ident" id="3156855">file</span>&nbsp;<span class="op" id="3156860">*</span><span class="ident" id="3156861">file</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156868">if</span>&nbsp;<span class="ident" id="3156871">file</span><span class="op" id="3156875">,</span>&nbsp;<span class="ident" id="3156877">_</span>&nbsp;<span class="op" id="3156879">=</span>&nbsp;<span class="ident" id="3156881">open</span><span class="op" id="3156885">(</span><span class="ident" id="3156886">hp</span><span class="op" id="3156888">)</span><span class="op" id="3156889">;</span>&nbsp;<span class="ident" id="3156891">file</span>&nbsp;<span class="op" id="3156896">==</span>&nbsp;<span class="ident" id="3156899">nil</span>&nbsp;<span class="op" id="3156903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156908">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156921">for</span>&nbsp;<span class="ident" id="3156925">line</span><span class="op" id="3156929">,</span>&nbsp;<span class="ident" id="3156931">ok</span>&nbsp;<span class="op" id="3156934">:=</span>&nbsp;<span class="ident" id="3156937">file</span><span class="op" id="3156941">.</span><span class="ident" id="3156942">readLine</span><span class="op" id="3156950">(</span><span class="op" id="3156951">)</span><span class="op" id="3156952">;</span>&nbsp;<span class="ident" id="3156954">ok</span><span class="op" id="3156956">;</span>&nbsp;<span class="ident" id="3156958">line</span><span class="op" id="3156962">,</span>&nbsp;<span class="ident" id="3156964">ok</span>&nbsp;<span class="op" id="3156967">=</span>&nbsp;<span class="ident" id="3156969">file</span><span class="op" id="3156973">.</span><span class="ident" id="3156974">readLine</span><span class="op" id="3156982">(</span><span class="op" id="3156983">)</span>&nbsp;<span class="op" id="3156985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156990">if</span>&nbsp;<span class="ident" id="3156993">i</span>&nbsp;<span class="op" id="3156995">:=</span>&nbsp;<span class="ident" id="3156998">byteIndex</span><span class="op" id="3157007">(</span><span class="ident" id="3157008">line</span><span class="op" id="3157012">,</span>&nbsp;<span class="string" id="3157014">&#39;#&#39;</span><span class="op" id="3157017">)</span><span class="op" id="3157018">;</span>&nbsp;<span class="ident" id="3157020">i</span>&nbsp;<span class="op" id="3157022">&gt;=</span>&nbsp;<span class="num" id="3157025">0</span>&nbsp;<span class="op" id="3157027">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157033">//&nbsp;Discard&nbsp;comments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157058">line</span>&nbsp;<span class="op" id="3157063">=</span>&nbsp;<span class="ident" id="3157065">line</span><span class="op" id="3157069">[</span><span class="num" id="3157070">0</span><span class="op" id="3157071">:</span><span class="ident" id="3157072">i</span><span class="op" id="3157073">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157083">f</span>&nbsp;<span class="op" id="3157085">:=</span>&nbsp;<span class="ident" id="3157088">getFields</span><span class="op" id="3157097">(</span><span class="ident" id="3157098">line</span><span class="op" id="3157102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157107">if</span>&nbsp;<span class="builtinfunc" id="3157110">len</span><span class="op" id="3157113">(</span><span class="ident" id="3157114">f</span><span class="op" id="3157115">)</span>&nbsp;<span class="op" id="3157117">&lt;</span>&nbsp;<span class="num" id="3157119">2</span>&nbsp;<span class="op" id="3157121">||</span>&nbsp;<span class="ident" id="3157124">ParseIP</span><span class="op" id="3157131">(</span><span class="ident" id="3157132">f</span><span class="op" id="3157133">[</span><span class="num" id="3157134">0</span><span class="op" id="3157135">]</span><span class="op" id="3157136">)</span>&nbsp;<span class="op" id="3157138">==</span>&nbsp;<span class="ident" id="3157141">nil</span>&nbsp;<span class="op" id="3157145">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157151">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157168">for</span>&nbsp;<span class="ident" id="3157172">i</span>&nbsp;<span class="op" id="3157174">:=</span>&nbsp;<span class="num" id="3157177">1</span><span class="op" id="3157178">;</span>&nbsp;<span class="ident" id="3157180">i</span>&nbsp;<span class="op" id="3157182">&lt;</span>&nbsp;<span class="builtinfunc" id="3157184">len</span><span class="op" id="3157187">(</span><span class="ident" id="3157188">f</span><span class="op" id="3157189">)</span><span class="op" id="3157190">;</span>&nbsp;<span class="ident" id="3157192">i</span><span class="op" id="3157193">++</span>&nbsp;<span class="op" id="3157196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157202">h</span>&nbsp;<span class="op" id="3157204">:=</span>&nbsp;<span class="ident" id="3157207">f</span><span class="op" id="3157208">[</span><span class="ident" id="3157209">i</span><span class="op" id="3157210">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157216">hs</span><span class="op" id="3157218">[</span><span class="ident" id="3157219">h</span><span class="op" id="3157220">]</span>&nbsp;<span class="op" id="3157222">=</span>&nbsp;<span class="builtinfunc" id="3157224">append</span><span class="op" id="3157230">(</span><span class="ident" id="3157231">hs</span><span class="op" id="3157233">[</span><span class="ident" id="3157234">h</span><span class="op" id="3157235">]</span><span class="op" id="3157236">,</span>&nbsp;<span class="ident" id="3157238">f</span><span class="op" id="3157239">[</span><span class="num" id="3157240">0</span><span class="op" id="3157241">]</span><span class="op" id="3157242">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157248">is</span><span class="op" id="3157250">[</span><span class="ident" id="3157251">f</span><span class="op" id="3157252">[</span><span class="num" id="3157253">0</span><span class="op" id="3157254">]</span><span class="op" id="3157255">]</span>&nbsp;<span class="op" id="3157257">=</span>&nbsp;<span class="builtinfunc" id="3157259">append</span><span class="op" id="3157265">(</span><span class="ident" id="3157266">is</span><span class="op" id="3157268">[</span><span class="ident" id="3157269">f</span><span class="op" id="3157270">[</span><span class="num" id="3157271">0</span><span class="op" id="3157272">]</span><span class="op" id="3157273">]</span><span class="op" id="3157274">,</span>&nbsp;<span class="ident" id="3157276">h</span><span class="op" id="3157277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157290">//&nbsp;Update&nbsp;the&nbsp;data&nbsp;cache.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157318">hosts</span><span class="op" id="3157323">.</span><span class="ident" id="3157324">expire</span>&nbsp;<span class="op" id="3157331">=</span>&nbsp;<span class="ident" id="3157333">now</span><span class="op" id="3157336">.</span><span class="ident" id="3157337">Add</span><span class="op" id="3157340">(</span><span class="ident" id="3157341">cacheMaxAge</span><span class="op" id="3157352">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157356">hosts</span><span class="op" id="3157361">.</span><span class="ident" id="3157362">path</span>&nbsp;<span class="op" id="3157367">=</span>&nbsp;<span class="ident" id="3157369">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157374">hosts</span><span class="op" id="3157379">.</span><span class="ident" id="3157380">byName</span>&nbsp;<span class="op" id="3157387">=</span>&nbsp;<span class="ident" id="3157389">hs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157394">hosts</span><span class="op" id="3157399">.</span><span class="ident" id="3157400">byAddr</span>&nbsp;<span class="op" id="3157407">=</span>&nbsp;<span class="ident" id="3157409">is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157414">file</span><span class="op" id="3157418">.</span><span class="builtinfunc" id="3157419">close</span><span class="op" id="3157424">(</span><span class="op" id="3157425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157428">}</span><br>
<span class="lineno">60</span><span class="op" id="3157430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3157433">//&nbsp;lookupStaticHost&nbsp;looks&nbsp;up&nbsp;the&nbsp;addresses&nbsp;for&nbsp;the&nbsp;given&nbsp;host&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3157512">func</span>&nbsp;<span class="ident" id="3157517">lookupStaticHost</span><span class="op" id="3157533">(</span><span class="ident" id="3157534">host</span>&nbsp;<span class="builtintype" id="3157539">string</span><span class="op" id="3157545">)</span>&nbsp;<span class="op" id="3157547">[</span><span class="op" id="3157548">]</span><span class="builtintype" id="3157549">string</span>&nbsp;<span class="op" id="3157556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157559">hosts</span><span class="op" id="3157564">.</span><span class="ident" id="3157565">Lock</span><span class="op" id="3157569">(</span><span class="op" id="3157570">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157573">defer</span>&nbsp;<span class="ident" id="3157579">hosts</span><span class="op" id="3157584">.</span><span class="ident" id="3157585">Unlock</span><span class="op" id="3157591">(</span><span class="op" id="3157592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157595">readHosts</span><span class="op" id="3157604">(</span><span class="op" id="3157605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157608">if</span>&nbsp;<span class="builtinfunc" id="3157611">len</span><span class="op" id="3157614">(</span><span class="ident" id="3157615">hosts</span><span class="op" id="3157620">.</span><span class="ident" id="3157621">byName</span><span class="op" id="3157627">)</span>&nbsp;<span class="op" id="3157629">!=</span>&nbsp;<span class="num" id="3157632">0</span>&nbsp;<span class="op" id="3157634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157638">if</span>&nbsp;<span class="ident" id="3157641">ips</span><span class="op" id="3157644">,</span>&nbsp;<span class="ident" id="3157646">ok</span>&nbsp;<span class="op" id="3157649">:=</span>&nbsp;<span class="ident" id="3157652">hosts</span><span class="op" id="3157657">.</span><span class="ident" id="3157658">byName</span><span class="op" id="3157664">[</span><span class="ident" id="3157665">host</span><span class="op" id="3157669">]</span><span class="op" id="3157670">;</span>&nbsp;<span class="ident" id="3157672">ok</span>&nbsp;<span class="op" id="3157675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157680">return</span>&nbsp;<span class="ident" id="3157687">ips</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157699">return</span>&nbsp;<span class="ident" id="3157706">nil</span><br>
<span class="lineno"></span><span class="op" id="3157710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="3157713">//&nbsp;lookupStaticAddr&nbsp;looks&nbsp;up&nbsp;the&nbsp;hosts&nbsp;for&nbsp;the&nbsp;given&nbsp;address&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3157791">func</span>&nbsp;<span class="ident" id="3157796">lookupStaticAddr</span><span class="op" id="3157812">(</span><span class="ident" id="3157813">addr</span>&nbsp;<span class="builtintype" id="3157818">string</span><span class="op" id="3157824">)</span>&nbsp;<span class="op" id="3157826">[</span><span class="op" id="3157827">]</span><span class="builtintype" id="3157828">string</span>&nbsp;<span class="op" id="3157835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157838">hosts</span><span class="op" id="3157843">.</span><span class="ident" id="3157844">Lock</span><span class="op" id="3157848">(</span><span class="op" id="3157849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157852">defer</span>&nbsp;<span class="ident" id="3157858">hosts</span><span class="op" id="3157863">.</span><span class="ident" id="3157864">Unlock</span><span class="op" id="3157870">(</span><span class="op" id="3157871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157874">readHosts</span><span class="op" id="3157883">(</span><span class="op" id="3157884">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157887">if</span>&nbsp;<span class="builtinfunc" id="3157890">len</span><span class="op" id="3157893">(</span><span class="ident" id="3157894">hosts</span><span class="op" id="3157899">.</span><span class="ident" id="3157900">byAddr</span><span class="op" id="3157906">)</span>&nbsp;<span class="op" id="3157908">!=</span>&nbsp;<span class="num" id="3157911">0</span>&nbsp;<span class="op" id="3157913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157917">if</span>&nbsp;<span class="ident" id="3157920">hosts</span><span class="op" id="3157925">,</span>&nbsp;<span class="ident" id="3157927">ok</span>&nbsp;<span class="op" id="3157930">:=</span>&nbsp;<span class="ident" id="3157933">hosts</span><span class="op" id="3157938">.</span><span class="ident" id="3157939">byAddr</span><span class="op" id="3157945">[</span><span class="ident" id="3157946">addr</span><span class="op" id="3157950">]</span><span class="op" id="3157951">;</span>&nbsp;<span class="ident" id="3157953">ok</span>&nbsp;<span class="op" id="3157956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157961">return</span>&nbsp;<span class="ident" id="3157968">hosts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157979">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157982">return</span>&nbsp;<span class="ident" id="3157989">nil</span><br>
<span class="lineno"></span><span class="op" id="3157993">}</span>
</div>
</body>
</html>
