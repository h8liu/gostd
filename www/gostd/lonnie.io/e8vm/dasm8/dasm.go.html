<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="4349097">package</span>&nbsp;<span class="ident" id="4349105">dasm8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4349112">import</span>&nbsp;<span class="op" id="4349119">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4349122">&#34;fmt&#34;</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4349130">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span><span class="op" id="4349148">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4349151">//&nbsp;Dasm&nbsp;disassembles&nbsp;a&nbsp;byte&nbsp;block.</span><br>
<span class="lineno">10</span><span class="keyword" id="4349186">func</span>&nbsp;<span class="ident" id="4349191">Dasm</span><span class="op" id="4349195">(</span><span class="ident" id="4349196">bs</span>&nbsp;<span class="op" id="4349199">[</span><span class="op" id="4349200">]</span><span class="builtintype" id="4349201">byte</span><span class="op" id="4349205">,</span>&nbsp;<span class="ident" id="4349207">addr</span>&nbsp;<span class="builtintype" id="4349212">uint32</span><span class="op" id="4349218">)</span>&nbsp;<span class="op" id="4349220">[</span><span class="op" id="4349221">]</span><span class="op" id="4349222">*</span><span class="ident" id="4349223">Line</span>&nbsp;<span class="op" id="4349228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349231">var</span>&nbsp;<span class="ident" id="4349235">ret</span>&nbsp;<span class="op" id="4349239">[</span><span class="op" id="4349240">]</span><span class="op" id="4349241">*</span><span class="ident" id="4349242">Line</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349249">base</span>&nbsp;<span class="op" id="4349254">:=</span>&nbsp;<span class="ident" id="4349257">addr</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349264">add</span>&nbsp;<span class="op" id="4349268">:=</span>&nbsp;<span class="keyword" id="4349271">func</span><span class="op" id="4349275">(</span><span class="ident" id="4349276">b</span>&nbsp;<span class="op" id="4349278">[</span><span class="op" id="4349279">]</span><span class="builtintype" id="4349280">byte</span><span class="op" id="4349284">)</span>&nbsp;<span class="op" id="4349286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349290">inst</span>&nbsp;<span class="op" id="4349295">:=</span>&nbsp;<span class="ident" id="4349298">binary</span><span class="op" id="4349304">.</span><span class="ident" id="4349305">LittleEndian</span><span class="op" id="4349317">.</span><span class="ident" id="4349318">Uint32</span><span class="op" id="4349324">(</span><span class="ident" id="4349325">b</span><span class="op" id="4349326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349330">ret</span>&nbsp;<span class="op" id="4349334">=</span>&nbsp;<span class="builtinfunc" id="4349336">append</span><span class="op" id="4349342">(</span><span class="ident" id="4349343">ret</span><span class="op" id="4349346">,</span>&nbsp;<span class="ident" id="4349348">NewLine</span><span class="op" id="4349355">(</span><span class="ident" id="4349356">addr</span><span class="op" id="4349360">,</span>&nbsp;<span class="ident" id="4349362">inst</span><span class="op" id="4349366">)</span><span class="op" id="4349367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349371">addr</span>&nbsp;<span class="op" id="4349376">+=</span>&nbsp;<span class="num" id="4349379">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4349382">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349386">nline</span>&nbsp;<span class="op" id="4349392">:=</span>&nbsp;<span class="builtinfunc" id="4349395">len</span><span class="op" id="4349398">(</span><span class="ident" id="4349399">bs</span><span class="op" id="4349401">)</span>&nbsp;<span class="op" id="4349403">/</span>&nbsp;<span class="num" id="4349405">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349408">for</span>&nbsp;<span class="ident" id="4349412">i</span>&nbsp;<span class="op" id="4349414">:=</span>&nbsp;<span class="num" id="4349417">0</span><span class="op" id="4349418">;</span>&nbsp;<span class="ident" id="4349420">i</span>&nbsp;<span class="op" id="4349422">&lt;</span>&nbsp;<span class="ident" id="4349424">nline</span><span class="op" id="4349429">;</span>&nbsp;<span class="ident" id="4349431">i</span><span class="op" id="4349432">++</span>&nbsp;<span class="op" id="4349435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349439">off</span>&nbsp;<span class="op" id="4349443">:=</span>&nbsp;<span class="ident" id="4349446">i</span>&nbsp;<span class="op" id="4349448">*</span>&nbsp;<span class="num" id="4349450">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349454">add</span><span class="op" id="4349457">(</span><span class="ident" id="4349458">bs</span><span class="op" id="4349460">[</span><span class="ident" id="4349461">off</span>&nbsp;<span class="op" id="4349465">:</span>&nbsp;<span class="ident" id="4349467">off</span><span class="op" id="4349470">+</span><span class="num" id="4349471">4</span><span class="op" id="4349472">]</span><span class="op" id="4349473">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4349476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4349480">//&nbsp;residue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349492">if</span>&nbsp;<span class="builtinfunc" id="4349495">len</span><span class="op" id="4349498">(</span><span class="ident" id="4349499">bs</span><span class="op" id="4349501">)</span><span class="op" id="4349502">%</span><span class="num" id="4349503">4</span>&nbsp;<span class="op" id="4349505">!=</span>&nbsp;<span class="num" id="4349508">0</span>&nbsp;<span class="op" id="4349510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349514">var</span>&nbsp;<span class="ident" id="4349518">buf</span>&nbsp;<span class="op" id="4349522">[</span><span class="num" id="4349523">4</span><span class="op" id="4349524">]</span><span class="builtintype" id="4349525">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4349532">copy</span><span class="op" id="4349536">(</span><span class="ident" id="4349537">buf</span><span class="op" id="4349540">[</span><span class="op" id="4349541">:</span><span class="op" id="4349542">]</span><span class="op" id="4349543">,</span>&nbsp;<span class="ident" id="4349545">bs</span><span class="op" id="4349547">[</span><span class="ident" id="4349548">nline</span><span class="op" id="4349553">*</span><span class="num" id="4349554">4</span><span class="op" id="4349555">:</span><span class="op" id="4349556">]</span><span class="op" id="4349557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349561">add</span><span class="op" id="4349564">(</span><span class="ident" id="4349565">buf</span><span class="op" id="4349568">[</span><span class="op" id="4349569">:</span><span class="op" id="4349570">]</span><span class="op" id="4349571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4349574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4349578">//&nbsp;link&nbsp;the&nbsp;jumps</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349597">for</span>&nbsp;<span class="ident" id="4349601">_</span><span class="op" id="4349602">,</span>&nbsp;<span class="ident" id="4349604">line</span>&nbsp;<span class="op" id="4349609">:=</span>&nbsp;<span class="keyword" id="4349612">range</span>&nbsp;<span class="ident" id="4349618">ret</span>&nbsp;<span class="op" id="4349622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349626">if</span>&nbsp;<span class="op" id="4349629">!</span><span class="ident" id="4349630">line</span><span class="op" id="4349634">.</span><span class="ident" id="4349635">IsJump</span>&nbsp;<span class="op" id="4349642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349647">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4349658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349663">index</span>&nbsp;<span class="op" id="4349669">:=</span>&nbsp;<span class="builtintype" id="4349672">int</span><span class="op" id="4349675">(</span><span class="ident" id="4349676">line</span><span class="op" id="4349680">.</span><span class="ident" id="4349681">To</span><span class="op" id="4349683">-</span><span class="ident" id="4349684">base</span><span class="op" id="4349688">)</span>&nbsp;<span class="op" id="4349690">/</span>&nbsp;<span class="num" id="4349692">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349696">if</span>&nbsp;<span class="ident" id="4349699">index</span>&nbsp;<span class="op" id="4349705">&gt;=</span>&nbsp;<span class="num" id="4349708">0</span>&nbsp;<span class="op" id="4349710">&amp;&amp;</span>&nbsp;<span class="ident" id="4349713">index</span>&nbsp;<span class="op" id="4349719">&lt;</span>&nbsp;<span class="ident" id="4349721">nline</span>&nbsp;<span class="op" id="4349727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349732">line</span><span class="op" id="4349736">.</span><span class="ident" id="4349737">ToLine</span>&nbsp;<span class="op" id="4349744">=</span>&nbsp;<span class="ident" id="4349746">ret</span><span class="op" id="4349749">[</span><span class="ident" id="4349750">index</span><span class="op" id="4349755">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4349759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4349762">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349766">return</span>&nbsp;<span class="ident" id="4349773">ret</span><br>
<span class="lineno"></span><span class="op" id="4349777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4349780">//&nbsp;Print&nbsp;prints&nbsp;a&nbsp;byte&nbsp;block&nbsp;as&nbsp;assembly&nbsp;lines.</span><br>
<span class="lineno">50</span><span class="keyword" id="4349828">func</span>&nbsp;<span class="ident" id="4349833">Print</span><span class="op" id="4349838">(</span><span class="ident" id="4349839">bs</span>&nbsp;<span class="op" id="4349842">[</span><span class="op" id="4349843">]</span><span class="builtintype" id="4349844">byte</span><span class="op" id="4349848">,</span>&nbsp;<span class="ident" id="4349850">addr</span>&nbsp;<span class="builtintype" id="4349855">uint32</span><span class="op" id="4349861">)</span>&nbsp;<span class="op" id="4349863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349866">lines</span>&nbsp;<span class="op" id="4349872">:=</span>&nbsp;<span class="ident" id="4349875">Dasm</span><span class="op" id="4349879">(</span><span class="ident" id="4349880">bs</span><span class="op" id="4349882">,</span>&nbsp;<span class="ident" id="4349884">addr</span><span class="op" id="4349888">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4349892">for</span>&nbsp;<span class="ident" id="4349896">_</span><span class="op" id="4349897">,</span>&nbsp;<span class="ident" id="4349899">line</span>&nbsp;<span class="op" id="4349904">:=</span>&nbsp;<span class="keyword" id="4349907">range</span>&nbsp;<span class="ident" id="4349913">lines</span>&nbsp;<span class="op" id="4349919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4349923">fmt</span><span class="op" id="4349926">.</span><span class="ident" id="4349927">Println</span><span class="op" id="4349934">(</span><span class="ident" id="4349935">line</span><span class="op" id="4349939">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4349942">}</span><br>
<span class="lineno"></span><span class="op" id="4349944">}</span>
</div>
</body>
</html>
