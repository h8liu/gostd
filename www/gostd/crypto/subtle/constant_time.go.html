<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3494930">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3494985">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3495039">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3495090">//&nbsp;Package&nbsp;subtle&nbsp;implements&nbsp;functions&nbsp;that&nbsp;are&nbsp;often&nbsp;useful&nbsp;in&nbsp;cryptographic</span><br>
<span class="lineno"></span><span class="comment" id="3495168">//&nbsp;code&nbsp;but&nbsp;require&nbsp;careful&nbsp;thought&nbsp;to&nbsp;use&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="keyword" id="3495222">package</span>&nbsp;<span class="ident" id="3495230">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3495238">//&nbsp;ConstantTimeCompare&nbsp;returns&nbsp;1&nbsp;iff&nbsp;the&nbsp;two&nbsp;slices,&nbsp;x</span><br>
<span class="lineno">10</span><span class="comment" id="3495293">//&nbsp;and&nbsp;y,&nbsp;have&nbsp;equal&nbsp;contents.&nbsp;The&nbsp;time&nbsp;taken&nbsp;is&nbsp;a&nbsp;function&nbsp;of&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3495370">//&nbsp;the&nbsp;slices&nbsp;and&nbsp;is&nbsp;independent&nbsp;of&nbsp;the&nbsp;contents.</span><br>
<span class="lineno"></span><span class="keyword" id="3495420">func</span>&nbsp;<span class="ident" id="3495425">ConstantTimeCompare</span><span class="op" id="3495444">(</span><span class="ident" id="3495445">x</span><span class="op" id="3495446">,</span>&nbsp;<span class="ident" id="3495448">y</span>&nbsp;<span class="op" id="3495450">[</span><span class="op" id="3495451">]</span><span class="builtintype" id="3495452">byte</span><span class="op" id="3495456">)</span>&nbsp;<span class="builtintype" id="3495458">int</span>&nbsp;<span class="op" id="3495462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495465">if</span>&nbsp;<span class="builtinfunc" id="3495468">len</span><span class="op" id="3495471">(</span><span class="ident" id="3495472">x</span><span class="op" id="3495473">)</span>&nbsp;<span class="op" id="3495475">!=</span>&nbsp;<span class="builtinfunc" id="3495478">len</span><span class="op" id="3495481">(</span><span class="ident" id="3495482">y</span><span class="op" id="3495483">)</span>&nbsp;<span class="op" id="3495485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495489">return</span>&nbsp;<span class="num" id="3495496">0</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3495499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495503">var</span>&nbsp;<span class="ident" id="3495507">v</span>&nbsp;<span class="builtintype" id="3495509">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495516">for</span>&nbsp;<span class="ident" id="3495520">i</span>&nbsp;<span class="op" id="3495522">:=</span>&nbsp;<span class="num" id="3495525">0</span><span class="op" id="3495526">;</span>&nbsp;<span class="ident" id="3495528">i</span>&nbsp;<span class="op" id="3495530">&lt;</span>&nbsp;<span class="builtinfunc" id="3495532">len</span><span class="op" id="3495535">(</span><span class="ident" id="3495536">x</span><span class="op" id="3495537">)</span><span class="op" id="3495538">;</span>&nbsp;<span class="ident" id="3495540">i</span><span class="op" id="3495541">++</span>&nbsp;<span class="op" id="3495544">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3495548">v</span>&nbsp;<span class="op" id="3495550">|=</span>&nbsp;<span class="ident" id="3495553">x</span><span class="op" id="3495554">[</span><span class="ident" id="3495555">i</span><span class="op" id="3495556">]</span>&nbsp;<span class="op" id="3495558">^</span>&nbsp;<span class="ident" id="3495560">y</span><span class="op" id="3495561">[</span><span class="ident" id="3495562">i</span><span class="op" id="3495563">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3495566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495570">return</span>&nbsp;<span class="ident" id="3495577">ConstantTimeByteEq</span><span class="op" id="3495595">(</span><span class="ident" id="3495596">v</span><span class="op" id="3495597">,</span>&nbsp;<span class="num" id="3495599">0</span><span class="op" id="3495600">)</span><br>
<span class="lineno"></span><span class="op" id="3495602">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3495605">//&nbsp;ConstantTimeSelect&nbsp;returns&nbsp;x&nbsp;if&nbsp;v&nbsp;is&nbsp;1&nbsp;and&nbsp;y&nbsp;if&nbsp;v&nbsp;is&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3495664">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3495721">func</span>&nbsp;<span class="ident" id="3495726">ConstantTimeSelect</span><span class="op" id="3495744">(</span><span class="ident" id="3495745">v</span><span class="op" id="3495746">,</span>&nbsp;<span class="ident" id="3495748">x</span><span class="op" id="3495749">,</span>&nbsp;<span class="ident" id="3495751">y</span>&nbsp;<span class="builtintype" id="3495753">int</span><span class="op" id="3495756">)</span>&nbsp;<span class="builtintype" id="3495758">int</span>&nbsp;<span class="op" id="3495762">{</span>&nbsp;<span class="keyword" id="3495764">return</span>&nbsp;<span class="op" id="3495771">^</span><span class="op" id="3495772">(</span><span class="ident" id="3495773">v</span><span class="op" id="3495774">-</span><span class="num" id="3495775">1</span><span class="op" id="3495776">)</span><span class="op" id="3495777">&amp;</span><span class="ident" id="3495778">x</span>&nbsp;<span class="op" id="3495780">|</span>&nbsp;<span class="op" id="3495782">(</span><span class="ident" id="3495783">v</span><span class="op" id="3495784">-</span><span class="num" id="3495785">1</span><span class="op" id="3495786">)</span><span class="op" id="3495787">&amp;</span><span class="ident" id="3495788">y</span>&nbsp;<span class="op" id="3495790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3495793">//&nbsp;ConstantTimeByteEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3495852">func</span>&nbsp;<span class="ident" id="3495857">ConstantTimeByteEq</span><span class="op" id="3495875">(</span><span class="ident" id="3495876">x</span><span class="op" id="3495877">,</span>&nbsp;<span class="ident" id="3495879">y</span>&nbsp;<span class="builtintype" id="3495881">uint8</span><span class="op" id="3495886">)</span>&nbsp;<span class="builtintype" id="3495888">int</span>&nbsp;<span class="op" id="3495892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3495895">z</span>&nbsp;<span class="op" id="3495897">:=</span>&nbsp;<span class="op" id="3495900">^</span><span class="op" id="3495901">(</span><span class="ident" id="3495902">x</span>&nbsp;<span class="op" id="3495904">^</span>&nbsp;<span class="ident" id="3495906">y</span><span class="op" id="3495907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3495910">z</span>&nbsp;<span class="op" id="3495912">&amp;=</span>&nbsp;<span class="ident" id="3495915">z</span>&nbsp;<span class="op" id="3495917">&gt;&gt;</span>&nbsp;<span class="num" id="3495920">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3495923">z</span>&nbsp;<span class="op" id="3495925">&amp;=</span>&nbsp;<span class="ident" id="3495928">z</span>&nbsp;<span class="op" id="3495930">&gt;&gt;</span>&nbsp;<span class="num" id="3495933">2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3495936">z</span>&nbsp;<span class="op" id="3495938">&amp;=</span>&nbsp;<span class="ident" id="3495941">z</span>&nbsp;<span class="op" id="3495943">&gt;&gt;</span>&nbsp;<span class="num" id="3495946">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3495950">return</span>&nbsp;<span class="builtintype" id="3495957">int</span><span class="op" id="3495960">(</span><span class="ident" id="3495961">z</span><span class="op" id="3495962">)</span><br>
<span class="lineno"></span><span class="op" id="3495964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="3495967">//&nbsp;ConstantTimeEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3496022">func</span>&nbsp;<span class="ident" id="3496027">ConstantTimeEq</span><span class="op" id="3496041">(</span><span class="ident" id="3496042">x</span><span class="op" id="3496043">,</span>&nbsp;<span class="ident" id="3496045">y</span>&nbsp;<span class="builtintype" id="3496047">int32</span><span class="op" id="3496052">)</span>&nbsp;<span class="builtintype" id="3496054">int</span>&nbsp;<span class="op" id="3496058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496061">z</span>&nbsp;<span class="op" id="3496063">:=</span>&nbsp;<span class="op" id="3496066">^</span><span class="op" id="3496067">(</span><span class="ident" id="3496068">x</span>&nbsp;<span class="op" id="3496070">^</span>&nbsp;<span class="ident" id="3496072">y</span><span class="op" id="3496073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496076">z</span>&nbsp;<span class="op" id="3496078">&amp;=</span>&nbsp;<span class="ident" id="3496081">z</span>&nbsp;<span class="op" id="3496083">&gt;&gt;</span>&nbsp;<span class="num" id="3496086">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496090">z</span>&nbsp;<span class="op" id="3496092">&amp;=</span>&nbsp;<span class="ident" id="3496095">z</span>&nbsp;<span class="op" id="3496097">&gt;&gt;</span>&nbsp;<span class="num" id="3496100">8</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496103">z</span>&nbsp;<span class="op" id="3496105">&amp;=</span>&nbsp;<span class="ident" id="3496108">z</span>&nbsp;<span class="op" id="3496110">&gt;&gt;</span>&nbsp;<span class="num" id="3496113">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496116">z</span>&nbsp;<span class="op" id="3496118">&amp;=</span>&nbsp;<span class="ident" id="3496121">z</span>&nbsp;<span class="op" id="3496123">&gt;&gt;</span>&nbsp;<span class="num" id="3496126">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496129">z</span>&nbsp;<span class="op" id="3496131">&amp;=</span>&nbsp;<span class="ident" id="3496134">z</span>&nbsp;<span class="op" id="3496136">&gt;&gt;</span>&nbsp;<span class="num" id="3496139">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496143">return</span>&nbsp;<span class="builtintype" id="3496150">int</span><span class="op" id="3496153">(</span><span class="ident" id="3496154">z</span>&nbsp;<span class="op" id="3496156">&amp;</span>&nbsp;<span class="num" id="3496158">1</span><span class="op" id="3496159">)</span><br>
<span class="lineno">50</span><span class="op" id="3496161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3496164">//&nbsp;ConstantTimeCopy&nbsp;copies&nbsp;the&nbsp;contents&nbsp;of&nbsp;y&nbsp;into&nbsp;x&nbsp;(a&nbsp;slice&nbsp;of&nbsp;equal&nbsp;length)</span><br>
<span class="lineno"></span><span class="comment" id="3496242">//&nbsp;if&nbsp;v&nbsp;==&nbsp;1.&nbsp;If&nbsp;v&nbsp;==&nbsp;0,&nbsp;x&nbsp;is&nbsp;left&nbsp;unchanged.&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v</span><br>
<span class="lineno"></span><span class="comment" id="3496319">//&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno">55</span><span class="keyword" id="3496345">func</span>&nbsp;<span class="ident" id="3496350">ConstantTimeCopy</span><span class="op" id="3496366">(</span><span class="ident" id="3496367">v</span>&nbsp;<span class="builtintype" id="3496369">int</span><span class="op" id="3496372">,</span>&nbsp;<span class="ident" id="3496374">x</span><span class="op" id="3496375">,</span>&nbsp;<span class="ident" id="3496377">y</span>&nbsp;<span class="op" id="3496379">[</span><span class="op" id="3496380">]</span><span class="builtintype" id="3496381">byte</span><span class="op" id="3496385">)</span>&nbsp;<span class="op" id="3496387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496390">if</span>&nbsp;<span class="builtinfunc" id="3496393">len</span><span class="op" id="3496396">(</span><span class="ident" id="3496397">x</span><span class="op" id="3496398">)</span>&nbsp;<span class="op" id="3496400">!=</span>&nbsp;<span class="builtinfunc" id="3496403">len</span><span class="op" id="3496406">(</span><span class="ident" id="3496407">y</span><span class="op" id="3496408">)</span>&nbsp;<span class="op" id="3496410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3496414">panic</span><span class="op" id="3496419">(</span><span class="string" id="3496420">&#34;subtle:&nbsp;slices&nbsp;have&nbsp;different&nbsp;lengths&#34;</span><span class="op" id="3496459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3496462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496466">xmask</span>&nbsp;<span class="op" id="3496472">:=</span>&nbsp;<span class="builtintype" id="3496475">byte</span><span class="op" id="3496479">(</span><span class="ident" id="3496480">v</span>&nbsp;<span class="op" id="3496482">-</span>&nbsp;<span class="num" id="3496484">1</span><span class="op" id="3496485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496488">ymask</span>&nbsp;<span class="op" id="3496494">:=</span>&nbsp;<span class="builtintype" id="3496497">byte</span><span class="op" id="3496501">(</span><span class="op" id="3496502">^</span><span class="op" id="3496503">(</span><span class="ident" id="3496504">v</span>&nbsp;<span class="op" id="3496506">-</span>&nbsp;<span class="num" id="3496508">1</span><span class="op" id="3496509">)</span><span class="op" id="3496510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496513">for</span>&nbsp;<span class="ident" id="3496517">i</span>&nbsp;<span class="op" id="3496519">:=</span>&nbsp;<span class="num" id="3496522">0</span><span class="op" id="3496523">;</span>&nbsp;<span class="ident" id="3496525">i</span>&nbsp;<span class="op" id="3496527">&lt;</span>&nbsp;<span class="builtinfunc" id="3496529">len</span><span class="op" id="3496532">(</span><span class="ident" id="3496533">x</span><span class="op" id="3496534">)</span><span class="op" id="3496535">;</span>&nbsp;<span class="ident" id="3496537">i</span><span class="op" id="3496538">++</span>&nbsp;<span class="op" id="3496541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496545">x</span><span class="op" id="3496546">[</span><span class="ident" id="3496547">i</span><span class="op" id="3496548">]</span>&nbsp;<span class="op" id="3496550">=</span>&nbsp;<span class="ident" id="3496552">x</span><span class="op" id="3496553">[</span><span class="ident" id="3496554">i</span><span class="op" id="3496555">]</span><span class="op" id="3496556">&amp;</span><span class="ident" id="3496557">xmask</span>&nbsp;<span class="op" id="3496563">|</span>&nbsp;<span class="ident" id="3496565">y</span><span class="op" id="3496566">[</span><span class="ident" id="3496567">i</span><span class="op" id="3496568">]</span><span class="op" id="3496569">&amp;</span><span class="ident" id="3496570">ymask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3496577">}</span><br>
<span class="lineno">65</span><span class="op" id="3496579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3496582">//&nbsp;ConstantTimeLessOrEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;&lt;=&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3496643">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;x&nbsp;or&nbsp;y&nbsp;are&nbsp;negative&nbsp;or&nbsp;&gt;&nbsp;2**31&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3496711">func</span>&nbsp;<span class="ident" id="3496716">ConstantTimeLessOrEq</span><span class="op" id="3496736">(</span><span class="ident" id="3496737">x</span><span class="op" id="3496738">,</span>&nbsp;<span class="ident" id="3496740">y</span>&nbsp;<span class="builtintype" id="3496742">int</span><span class="op" id="3496745">)</span>&nbsp;<span class="builtintype" id="3496747">int</span>&nbsp;<span class="op" id="3496751">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496754">x32</span>&nbsp;<span class="op" id="3496758">:=</span>&nbsp;<span class="builtintype" id="3496761">int32</span><span class="op" id="3496766">(</span><span class="ident" id="3496767">x</span><span class="op" id="3496768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3496771">y32</span>&nbsp;<span class="op" id="3496775">:=</span>&nbsp;<span class="builtintype" id="3496778">int32</span><span class="op" id="3496783">(</span><span class="ident" id="3496784">y</span><span class="op" id="3496785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3496788">return</span>&nbsp;<span class="builtintype" id="3496795">int</span><span class="op" id="3496798">(</span><span class="op" id="3496799">(</span><span class="op" id="3496800">(</span><span class="ident" id="3496801">x32</span>&nbsp;<span class="op" id="3496805">-</span>&nbsp;<span class="ident" id="3496807">y32</span>&nbsp;<span class="op" id="3496811">-</span>&nbsp;<span class="num" id="3496813">1</span><span class="op" id="3496814">)</span>&nbsp;<span class="op" id="3496816">&gt;&gt;</span>&nbsp;<span class="num" id="3496819">31</span><span class="op" id="3496821">)</span>&nbsp;<span class="op" id="3496823">&amp;</span>&nbsp;<span class="num" id="3496825">1</span><span class="op" id="3496826">)</span><br>
<span class="lineno"></span><span class="op" id="3496828">}</span>
</div>
</body>
</html>
