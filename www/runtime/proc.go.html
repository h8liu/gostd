<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2063759">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2063814">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2063868">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2063919">package</span>&nbsp;<span class="ident" id="2063927">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2063936">import</span>&nbsp;<span class="string" id="2063943">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2063953">func</span>&nbsp;<span class="ident" id="2063958">newsysmon</span><span class="op" id="2063967">(</span><span class="op" id="2063968">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2063971">func</span>&nbsp;<span class="ident" id="2063976">runtime_init</span><span class="op" id="2063988">(</span><span class="op" id="2063989">)</span><br>
<span class="lineno"></span><span class="keyword" id="2063991">func</span>&nbsp;<span class="ident" id="2063996">main_init</span><span class="op" id="2064005">(</span><span class="op" id="2064006">)</span><br>
<span class="lineno"></span><span class="keyword" id="2064008">func</span>&nbsp;<span class="ident" id="2064013">main_main</span><span class="op" id="2064022">(</span><span class="op" id="2064023">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2064026">//&nbsp;The&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="2064049">func</span>&nbsp;<span class="ident" id="2064054">main</span><span class="op" id="2064058">(</span><span class="op" id="2064059">)</span>&nbsp;<span class="op" id="2064061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2064064">g</span>&nbsp;<span class="op" id="2064066">:=</span>&nbsp;<span class="ident" id="2064069"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="2064073">(</span><span class="op" id="2064074">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064078">//&nbsp;Racectx&nbsp;of&nbsp;m0-&gt;g0&nbsp;is&nbsp;used&nbsp;only&nbsp;as&nbsp;the&nbsp;parent&nbsp;of&nbsp;the&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064150">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;used&nbsp;for&nbsp;anything&nbsp;else.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2064193"><a href="/runtime/proc.go.html#2064064">g</a></span><span class="op" id="2064194">.</span><span class="ident" id="2064195">m</span><span class="op" id="2064196">.</span><span class="ident" id="2064197">g0</span><span class="op" id="2064199">.</span><span class="ident" id="2064200">racectx</span>&nbsp;<span class="op" id="2064208">=</span>&nbsp;<span class="num" id="2064210">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064214">//&nbsp;Max&nbsp;stack&nbsp;size&nbsp;is&nbsp;1&nbsp;GB&nbsp;on&nbsp;64-bit,&nbsp;250&nbsp;MB&nbsp;on&nbsp;32-bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064270">//&nbsp;Using&nbsp;decimal&nbsp;instead&nbsp;of&nbsp;binary&nbsp;GB&nbsp;and&nbsp;MB&nbsp;because</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064324">//&nbsp;they&nbsp;look&nbsp;nicer&nbsp;in&nbsp;the&nbsp;stack&nbsp;overflow&nbsp;failure&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064383">if</span>&nbsp;<span class="ident" id="2064386"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span>&nbsp;<span class="op" id="2064394">==</span>&nbsp;<span class="num" id="2064397">8</span>&nbsp;<span class="op" id="2064399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2064403"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184593">maxstacksize</a></span>&nbsp;<span class="op" id="2064416">=</span>&nbsp;<span class="num" id="2064418">1000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2064430">}</span>&nbsp;<span class="keyword" id="2064432">else</span>&nbsp;<span class="op" id="2064437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2064441"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184593">maxstacksize</a></span>&nbsp;<span class="op" id="2064454">=</span>&nbsp;<span class="num" id="2064456">250000000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2064467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2064471"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2064474">(</span><span class="ident" id="2064475"><a href="/runtime/proc.go.html#2063958">newsysmon</a></span><span class="op" id="2064484">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064488">//&nbsp;Lock&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;onto&nbsp;this,&nbsp;the&nbsp;main&nbsp;OS&nbsp;thread,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064547">//&nbsp;during&nbsp;initialization.&nbsp;&nbsp;Most&nbsp;programs&nbsp;won&#39;t&nbsp;care,&nbsp;but&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064611">//&nbsp;do&nbsp;require&nbsp;certain&nbsp;calls&nbsp;to&nbsp;be&nbsp;made&nbsp;by&nbsp;the&nbsp;main&nbsp;thread.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064671">//&nbsp;Those&nbsp;can&nbsp;arrange&nbsp;for&nbsp;main.main&nbsp;to&nbsp;run&nbsp;in&nbsp;the&nbsp;main&nbsp;thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064733">//&nbsp;by&nbsp;calling&nbsp;runtime.LockOSThread&nbsp;during&nbsp;initialization</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064791">//&nbsp;to&nbsp;preserve&nbsp;the&nbsp;lock.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2064817"><a href="/runtime/stubs.go.html#2135933">lockOSThread</a></span><span class="op" id="2064829">(</span><span class="op" id="2064830">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2064834">if</span>&nbsp;<span class="ident" id="2064837"><a href="/runtime/proc.go.html#2064064">g</a></span><span class="op" id="2064838">.</span><span class="ident" id="2064839">m</span>&nbsp;<span class="op" id="2064841">!=</span>&nbsp;<span class="op" id="2064844">&amp;</span><span class="ident" id="2064845"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2196699">m0</a></span>&nbsp;<span class="op" id="2064848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2064852"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2064859">(</span><span class="string" id="2064860">&#34;runtime.main&nbsp;not&nbsp;on&nbsp;m0&#34;</span><span class="op" id="2064884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2064887">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2064891"><a href="/runtime/proc.go.html#2063976">runtime_init</a></span><span class="op" id="2064903">(</span><span class="op" id="2064904">)</span>&nbsp;<span class="comment" id="2064906">//&nbsp;must&nbsp;be&nbsp;before&nbsp;defer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2064932">//&nbsp;Defer&nbsp;unlock&nbsp;so&nbsp;that&nbsp;runtime.Goexit&nbsp;during&nbsp;init&nbsp;does&nbsp;the&nbsp;unlock&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065005">needUnlock</span>&nbsp;<span class="op" id="2065016">:=</span>&nbsp;<span class="builtintype" id="2065019">true</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2065025">defer</span>&nbsp;<span class="keyword" id="2065031">func</span><span class="op" id="2065035">(</span><span class="op" id="2065036">)</span>&nbsp;<span class="op" id="2065038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2065042">if</span>&nbsp;<span class="ident" id="2065045"><a href="/runtime/proc.go.html#2065005">needUnlock</a></span>&nbsp;<span class="op" id="2065056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065061"><a href="/runtime/stubs.go.html#2135953">unlockOSThread</a></span><span class="op" id="2065075">(</span><span class="op" id="2065076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2065080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2065083">}</span><span class="op" id="2065084">(</span><span class="op" id="2065085">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065089"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186172">memstats</a></span><span class="op" id="2065097">.</span><span class="ident" id="2065098">enablegc</span>&nbsp;<span class="op" id="2065107">=</span>&nbsp;<span class="builtintype" id="2065109">true</span>&nbsp;<span class="comment" id="2065114">//&nbsp;now&nbsp;that&nbsp;runtime&nbsp;is&nbsp;initialized,&nbsp;GC&nbsp;is&nbsp;okay</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065163"><a href="/runtime/proc.go.html#2063996">main_init</a></span><span class="op" id="2065172">(</span><span class="op" id="2065173">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065177"><a href="/runtime/proc.go.html#2065005">needUnlock</a></span>&nbsp;<span class="op" id="2065188">=</span>&nbsp;<span class="builtintype" id="2065190">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065197"><a href="/runtime/stubs.go.html#2135953">unlockOSThread</a></span><span class="op" id="2065211">(</span><span class="op" id="2065212">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065216"><a href="/runtime/proc.go.html#2064013">main_main</a></span><span class="op" id="2065225">(</span><span class="op" id="2065226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2065229">if</span>&nbsp;<span class="ident" id="2065232"><a href="/runtime/race0.go.html#2069616">raceenabled</a></span>&nbsp;<span class="op" id="2065244">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065248"><a href="/runtime/race0.go.html#2070006">racefini</a></span><span class="op" id="2065256">(</span><span class="op" id="2065257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2065260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2065264">//&nbsp;Make&nbsp;racy&nbsp;client&nbsp;program&nbsp;work:&nbsp;if&nbsp;panicking&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2065315">//&nbsp;another&nbsp;goroutine&nbsp;at&nbsp;the&nbsp;same&nbsp;time&nbsp;as&nbsp;main&nbsp;returns,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2065371">//&nbsp;let&nbsp;the&nbsp;other&nbsp;goroutine&nbsp;finish&nbsp;printing&nbsp;the&nbsp;panic&nbsp;trace.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2065432">//&nbsp;Once&nbsp;it&nbsp;does,&nbsp;it&nbsp;will&nbsp;exit.&nbsp;See&nbsp;issue&nbsp;3934.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2065480">if</span>&nbsp;<span class="ident" id="2065483"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184416">panicking</a></span>&nbsp;<span class="op" id="2065493">!=</span>&nbsp;<span class="num" id="2065496">0</span>&nbsp;<span class="op" id="2065498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065502"><a href="/runtime/proc.go.html#2066373">gopark</a></span><span class="op" id="2065508">(</span><span class="ident" id="2065509">nil</span><span class="op" id="2065512">,</span>&nbsp;<span class="ident" id="2065514">nil</span><span class="op" id="2065517">,</span>&nbsp;<span class="string" id="2065519">&#34;panicwait&#34;</span><span class="op" id="2065530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2065533">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065537"><a href="/runtime/stubs.go.html#2136998">exit</a></span><span class="op" id="2065541">(</span><span class="num" id="2065542">0</span><span class="op" id="2065543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2065546">for</span>&nbsp;<span class="op" id="2065550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2065554">var</span>&nbsp;<span class="ident" id="2065558">x</span>&nbsp;<span class="op" id="2065560">*</span><span class="builtintype" id="2065561">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2065569">*</span><span class="ident" id="2065570"><a href="/runtime/proc.go.html#2065558">x</a></span>&nbsp;<span class="op" id="2065572">=</span>&nbsp;<span class="num" id="2065574">0</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2065577">}</span><br>
<span class="lineno"></span><span class="op" id="2065579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2065582">var</span>&nbsp;<span class="ident" id="2065586">parkunlock_c</span>&nbsp;<span class="builtintype" id="2065599">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="2065605">//&nbsp;start&nbsp;forcegc&nbsp;helper&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="keyword" id="2065639">func</span>&nbsp;<span class="ident" id="2065644">init</span><span class="op" id="2065648">(</span><span class="op" id="2065649">)</span>&nbsp;<span class="op" id="2065651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2065654">go</span>&nbsp;<span class="ident" id="2065657"><a href="/runtime/proc.go.html#2065681">forcegchelper</a></span><span class="op" id="2065670">(</span><span class="op" id="2065671">)</span><br>
<span class="lineno"></span><span class="op" id="2065673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="2065676">func</span>&nbsp;<span class="ident" id="2065681">forcegchelper</span><span class="op" id="2065694">(</span><span class="op" id="2065695">)</span>&nbsp;<span class="op" id="2065697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065700"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184635">forcegc</a></span><span class="op" id="2065707">.</span><span class="ident" id="2065708">g</span>&nbsp;<span class="op" id="2065710">=</span>&nbsp;<span class="ident" id="2065712"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="2065716">(</span><span class="op" id="2065717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065720"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184635">forcegc</a></span><span class="op" id="2065727">.</span><span class="ident" id="2065728">g</span><span class="op" id="2065729">.</span><span class="ident" id="2065730">issystem</span>&nbsp;<span class="op" id="2065739">=</span>&nbsp;<span class="builtintype" id="2065741">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2065747">for</span>&nbsp;<span class="op" id="2065751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065755"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2065759">(</span><span class="op" id="2065760">&amp;</span><span class="ident" id="2065761"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184635">forcegc</a></span><span class="op" id="2065768">.</span><span class="ident" id="2065769">lock</span><span class="op" id="2065773">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2065777">if</span>&nbsp;<span class="ident" id="2065780"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184635">forcegc</a></span><span class="op" id="2065787">.</span><span class="ident" id="2065788">idle</span>&nbsp;<span class="op" id="2065793">!=</span>&nbsp;<span class="num" id="2065796">0</span>&nbsp;<span class="op" id="2065798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065803"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2065810">(</span><span class="string" id="2065811">&#34;forcegc:&nbsp;phase&nbsp;error&#34;</span><span class="op" id="2065833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2065837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065841"><a href="/runtime/atomic.go.html#1874717">atomicstore</a></span><span class="op" id="2065852">(</span><span class="op" id="2065853">&amp;</span><span class="ident" id="2065854"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184635">forcegc</a></span><span class="op" id="2065861">.</span><span class="ident" id="2065862">idle</span><span class="op" id="2065866">,</span>&nbsp;<span class="num" id="2065868">1</span><span class="op" id="2065869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2065873"><a href="/runtime/proc.go.html#2066901">goparkunlock</a></span><span class="op" id="2065885">(</span><span class="op" id="2065886">&amp;</span><span class="ident" id="2065887"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184635">forcegc</a></span><span class="op" id="2065894">.</span><span class="ident" id="2065895">lock</span><span class="op" id="2065899">,</span>&nbsp;<span class="string" id="2065901">&#34;force&nbsp;gc&nbsp;(idle)&#34;</span><span class="op" id="2065918">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2065922">//&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;explicitly&nbsp;resumed&nbsp;by&nbsp;sysmon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2065974">if</span>&nbsp;<span class="ident" id="2065977"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184573">debug</a></span><span class="op" id="2065982">.</span><span class="ident" id="2065983">gctrace</span>&nbsp;<span class="op" id="2065991">&gt;</span>&nbsp;<span class="num" id="2065993">0</span>&nbsp;<span class="op" id="2065995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2066000">println</span><span class="op" id="2066007">(</span><span class="string" id="2066008">&#34;GC&nbsp;forced&#34;</span><span class="op" id="2066019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2066023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066027"><a href="/runtime/malloc.go.html#1993442">gogc</a></span><span class="op" id="2066031">(</span><span class="num" id="2066032">1</span><span class="op" id="2066033">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2066036">}</span><br>
<span class="lineno"></span><span class="op" id="2066038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2066041">//go:nosplit</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="2066055">//&nbsp;Gosched&nbsp;yields&nbsp;the&nbsp;processor,&nbsp;allowing&nbsp;other&nbsp;goroutines&nbsp;to&nbsp;run.&nbsp;&nbsp;It&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="2066135">//&nbsp;suspend&nbsp;the&nbsp;current&nbsp;goroutine,&nbsp;so&nbsp;execution&nbsp;resumes&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="keyword" id="2066205">func</span>&nbsp;<span class="ident" id="2066210">Gosched</span><span class="op" id="2066217">(</span><span class="op" id="2066218">)</span>&nbsp;<span class="op" id="2066220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066223"><a href="/runtime/stubs.go.html#2132746">mcall</a></span><span class="op" id="2066228">(</span><span class="ident" id="2066229"><a href="/runtime/stubs.go.html#2135123">gosched_m</a></span><span class="op" id="2066238">)</span><br>
<span class="lineno"></span><span class="op" id="2066240">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2066243">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;calls&nbsp;unlockf.</span><br>
<span class="lineno"></span><span class="comment" id="2066313">//&nbsp;If&nbsp;unlockf&nbsp;returns&nbsp;false,&nbsp;the&nbsp;goroutine&nbsp;is&nbsp;resumed.</span><br>
<span class="lineno"></span><span class="keyword" id="2066368">func</span>&nbsp;<span class="ident" id="2066373">gopark</span><span class="op" id="2066379">(</span><span class="ident" id="2066380">unlockf</span>&nbsp;<span class="ident" id="2066388"><a href="/runtime/proc.go.html#2063943">unsafe</a></span><span class="op" id="2066394">.</span><span class="ident" id="2066395">Pointer</span><span class="op" id="2066402">,</span>&nbsp;<span class="ident" id="2066404">lock</span>&nbsp;<span class="ident" id="2066409"><a href="/runtime/proc.go.html#2063943">unsafe</a></span><span class="op" id="2066415">.</span><span class="ident" id="2066416">Pointer</span><span class="op" id="2066423">,</span>&nbsp;<span class="ident" id="2066425">reason</span>&nbsp;<span class="builtintype" id="2066432">string</span><span class="op" id="2066438">)</span>&nbsp;<span class="op" id="2066440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066443">mp</span>&nbsp;<span class="op" id="2066446">:=</span>&nbsp;<span class="ident" id="2066449"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="2066457">(</span><span class="op" id="2066458">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066461">gp</span>&nbsp;<span class="op" id="2066464">:=</span>&nbsp;<span class="ident" id="2066467"><a href="/runtime/proc.go.html#2066443">mp</a></span><span class="op" id="2066469">.</span><span class="ident" id="2066470">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066476">status</span>&nbsp;<span class="op" id="2066483">:=</span>&nbsp;<span class="ident" id="2066486"><a href="/runtime/stubs.go.html#2132100">readgstatus</a></span><span class="op" id="2066497">(</span><span class="ident" id="2066498"><a href="/runtime/proc.go.html#2066461">gp</a></span><span class="op" id="2066500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2066503">if</span>&nbsp;<span class="ident" id="2066506"><a href="/runtime/proc.go.html#2066476">status</a></span>&nbsp;<span class="op" id="2066513">!=</span>&nbsp;<span class="ident" id="2066516"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2178896">_Grunning</a></span>&nbsp;<span class="op" id="2066526">&amp;&amp;</span>&nbsp;<span class="ident" id="2066529"><a href="/runtime/proc.go.html#2066476">status</a></span>&nbsp;<span class="op" id="2066536">!=</span>&nbsp;<span class="ident" id="2066539"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179091">_Gscanrunning</a></span>&nbsp;<span class="op" id="2066553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066557"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2066564">(</span><span class="string" id="2066565">&#34;gopark:&nbsp;bad&nbsp;g&nbsp;status&#34;</span><span class="op" id="2066587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2066590">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066593"><a href="/runtime/proc.go.html#2066443">mp</a></span><span class="op" id="2066595">.</span><span class="ident" id="2066596">waitlock</span>&nbsp;<span class="op" id="2066605">=</span>&nbsp;<span class="ident" id="2066607"><a href="/runtime/proc.go.html#2066404">lock</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066613"><a href="/runtime/proc.go.html#2066443">mp</a></span><span class="op" id="2066615">.</span><span class="ident" id="2066616">waitunlockf</span>&nbsp;<span class="op" id="2066628">=</span>&nbsp;<span class="ident" id="2066630"><a href="/runtime/proc.go.html#2066380">unlockf</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066639"><a href="/runtime/proc.go.html#2066461">gp</a></span><span class="op" id="2066641">.</span><span class="ident" id="2066642">waitreason</span>&nbsp;<span class="op" id="2066653">=</span>&nbsp;<span class="ident" id="2066655"><a href="/runtime/proc.go.html#2066425">reason</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066663"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="2066671">(</span><span class="ident" id="2066672"><a href="/runtime/proc.go.html#2066443">mp</a></span><span class="op" id="2066674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2066677">//&nbsp;can&#39;t&nbsp;do&nbsp;anything&nbsp;that&nbsp;might&nbsp;move&nbsp;the&nbsp;G&nbsp;between&nbsp;Ms&nbsp;here.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066738"><a href="/runtime/stubs.go.html#2132746">mcall</a></span><span class="op" id="2066743">(</span><span class="ident" id="2066744"><a href="/runtime/stubs.go.html#2135142">park_m</a></span><span class="op" id="2066750">)</span><br>
<span class="lineno"></span><span class="op" id="2066752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2066755">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;unlocks&nbsp;the&nbsp;lock.</span><br>
<span class="lineno"></span><span class="comment" id="2066828">//&nbsp;The&nbsp;goroutine&nbsp;can&nbsp;be&nbsp;made&nbsp;runnable&nbsp;again&nbsp;by&nbsp;calling&nbsp;goready(gp).</span><br>
<span class="lineno">135</span><span class="keyword" id="2066896">func</span>&nbsp;<span class="ident" id="2066901">goparkunlock</span><span class="op" id="2066913">(</span><span class="ident" id="2066914">lock</span>&nbsp;<span class="op" id="2066919">*</span><span class="ident" id="2066920"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179310">mutex</a></span><span class="op" id="2066925">,</span>&nbsp;<span class="ident" id="2066927">reason</span>&nbsp;<span class="builtintype" id="2066934">string</span><span class="op" id="2066940">)</span>&nbsp;<span class="op" id="2066942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2066945"><a href="/runtime/proc.go.html#2066373">gopark</a></span><span class="op" id="2066951">(</span><span class="ident" id="2066952"><a href="/runtime/proc.go.html#2063943">unsafe</a></span><span class="op" id="2066958">.</span><span class="ident" id="2066959">Pointer</span><span class="op" id="2066966">(</span><span class="op" id="2066967">&amp;</span><span class="ident" id="2066968"><a href="/runtime/proc.go.html#2065586">parkunlock_c</a></span><span class="op" id="2066980">)</span><span class="op" id="2066981">,</span>&nbsp;<span class="ident" id="2066983"><a href="/runtime/proc.go.html#2063943">unsafe</a></span><span class="op" id="2066989">.</span><span class="ident" id="2066990">Pointer</span><span class="op" id="2066997">(</span><span class="ident" id="2066998"><a href="/runtime/proc.go.html#2066914">lock</a></span><span class="op" id="2067002">)</span><span class="op" id="2067003">,</span>&nbsp;<span class="ident" id="2067005"><a href="/runtime/proc.go.html#2066927">reason</a></span><span class="op" id="2067011">)</span><br>
<span class="lineno"></span><span class="op" id="2067013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2067016">func</span>&nbsp;<span class="ident" id="2067021">goready</span><span class="op" id="2067028">(</span><span class="ident" id="2067029">gp</span>&nbsp;<span class="op" id="2067032">*</span><span class="ident" id="2067033"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span><span class="op" id="2067034">)</span>&nbsp;<span class="op" id="2067036">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067039">mp</span>&nbsp;<span class="op" id="2067042">:=</span>&nbsp;<span class="ident" id="2067045"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="2067053">(</span><span class="op" id="2067054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067057"><a href="/runtime/proc.go.html#2067039">mp</a></span><span class="op" id="2067059">.</span><span class="ident" id="2067060">ptrarg</span><span class="op" id="2067066">[</span><span class="num" id="2067067">0</span><span class="op" id="2067068">]</span>&nbsp;<span class="op" id="2067070">=</span>&nbsp;<span class="ident" id="2067072"><a href="/runtime/proc.go.html#2063943">unsafe</a></span><span class="op" id="2067078">.</span><span class="ident" id="2067079">Pointer</span><span class="op" id="2067086">(</span><span class="ident" id="2067087"><a href="/runtime/proc.go.html#2067029">gp</a></span><span class="op" id="2067089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067092"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2067095">(</span><span class="ident" id="2067096"><a href="/runtime/stubs.go.html#2135481">ready_m</a></span><span class="op" id="2067103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067106"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="2067114">(</span><span class="ident" id="2067115"><a href="/runtime/proc.go.html#2067039">mp</a></span><span class="op" id="2067117">)</span><br>
<span class="lineno"></span><span class="op" id="2067119">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="2067122">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="2067135">func</span>&nbsp;<span class="ident" id="2067140">acquireSudog</span><span class="op" id="2067152">(</span><span class="op" id="2067153">)</span>&nbsp;<span class="op" id="2067155">*</span><span class="ident" id="2067156"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179851">sudog</a></span>&nbsp;<span class="op" id="2067162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067165">c</span>&nbsp;<span class="op" id="2067167">:=</span>&nbsp;<span class="ident" id="2067170"><a href="/runtime/stubs.go.html#2132076">gomcache</a></span><span class="op" id="2067178">(</span><span class="op" id="2067179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067182">s</span>&nbsp;<span class="op" id="2067184">:=</span>&nbsp;<span class="ident" id="2067187"><a href="/runtime/proc.go.html#2067165">c</a></span><span class="op" id="2067188">.</span><span class="ident" id="2067189">sudogcache</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067201">if</span>&nbsp;<span class="ident" id="2067204"><a href="/runtime/proc.go.html#2067182">s</a></span>&nbsp;<span class="op" id="2067206">!=</span>&nbsp;<span class="ident" id="2067209">nil</span>&nbsp;<span class="op" id="2067213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067217">if</span>&nbsp;<span class="ident" id="2067220"><a href="/runtime/proc.go.html#2067182">s</a></span><span class="op" id="2067221">.</span><span class="ident" id="2067222">elem</span>&nbsp;<span class="op" id="2067227">!=</span>&nbsp;<span class="ident" id="2067230">nil</span>&nbsp;<span class="op" id="2067234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067239"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2067246">(</span><span class="string" id="2067247">&#34;acquireSudog:&nbsp;found&nbsp;s.elem&nbsp;!=&nbsp;nil&nbsp;in&nbsp;cache&#34;</span><span class="op" id="2067291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2067295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067299"><a href="/runtime/proc.go.html#2067165">c</a></span><span class="op" id="2067300">.</span><span class="ident" id="2067301">sudogcache</span>&nbsp;<span class="op" id="2067312">=</span>&nbsp;<span class="ident" id="2067314"><a href="/runtime/proc.go.html#2067182">s</a></span><span class="op" id="2067315">.</span><span class="ident" id="2067316">next</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067323"><a href="/runtime/proc.go.html#2067182">s</a></span><span class="op" id="2067324">.</span><span class="ident" id="2067325">next</span>&nbsp;<span class="op" id="2067330">=</span>&nbsp;<span class="ident" id="2067332">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067338">return</span>&nbsp;<span class="ident" id="2067345"><a href="/runtime/proc.go.html#2067182">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2067348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2067352">//&nbsp;Delicate&nbsp;dance:&nbsp;the&nbsp;semaphore&nbsp;implementation&nbsp;calls</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2067407">//&nbsp;acquireSudog,&nbsp;acquireSudog&nbsp;calls&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2067456">//&nbsp;new&nbsp;calls&nbsp;malloc,&nbsp;malloc&nbsp;can&nbsp;call&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2067517">//&nbsp;and&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;calls&nbsp;the&nbsp;semaphore&nbsp;implementation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2067582">//&nbsp;in&nbsp;stoptheworld.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2067603">//&nbsp;Break&nbsp;the&nbsp;cycle&nbsp;by&nbsp;doing&nbsp;acquirem/releasem&nbsp;around&nbsp;new(sudog).</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2067669">//&nbsp;The&nbsp;acquirem/releasem&nbsp;increments&nbsp;m.locks&nbsp;during&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2067733">//&nbsp;which&nbsp;keeps&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;from&nbsp;being&nbsp;invoked.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067791">mp</span>&nbsp;<span class="op" id="2067794">:=</span>&nbsp;<span class="ident" id="2067797"><a href="/runtime/stubs.go.html#2132036">acquirem</a></span><span class="op" id="2067805">(</span><span class="op" id="2067806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067809">p</span>&nbsp;<span class="op" id="2067811">:=</span>&nbsp;<span class="builtinfunc" id="2067814">new</span><span class="op" id="2067817">(</span><span class="ident" id="2067818"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179851">sudog</a></span><span class="op" id="2067823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067826"><a href="/runtime/stubs.go.html#2132055">releasem</a></span><span class="op" id="2067834">(</span><span class="ident" id="2067835"><a href="/runtime/proc.go.html#2067791">mp</a></span><span class="op" id="2067837">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067840">return</span>&nbsp;<span class="ident" id="2067847"><a href="/runtime/proc.go.html#2067809">p</a></span><br>
<span class="lineno"></span><span class="op" id="2067849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2067852">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="2067865">func</span>&nbsp;<span class="ident" id="2067870">releaseSudog</span><span class="op" id="2067882">(</span><span class="ident" id="2067883">s</span>&nbsp;<span class="op" id="2067885">*</span><span class="ident" id="2067886"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179851">sudog</a></span><span class="op" id="2067891">)</span>&nbsp;<span class="op" id="2067893">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067896">if</span>&nbsp;<span class="ident" id="2067899"><a href="/runtime/proc.go.html#2067883">s</a></span><span class="op" id="2067900">.</span><span class="ident" id="2067901">elem</span>&nbsp;<span class="op" id="2067906">!=</span>&nbsp;<span class="ident" id="2067909">nil</span>&nbsp;<span class="op" id="2067913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067917"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2067924">(</span><span class="string" id="2067925">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;elem&#34;</span><span class="op" id="2067959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2067962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2067965">if</span>&nbsp;<span class="ident" id="2067968"><a href="/runtime/proc.go.html#2067883">s</a></span><span class="op" id="2067969">.</span><span class="ident" id="2067970">selectdone</span>&nbsp;<span class="op" id="2067981">!=</span>&nbsp;<span class="ident" id="2067984">nil</span>&nbsp;<span class="op" id="2067988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2067992"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2067999">(</span><span class="string" id="2068000">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;selectdone&#34;</span><span class="op" id="2068040">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2068043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068046">if</span>&nbsp;<span class="ident" id="2068049"><a href="/runtime/proc.go.html#2067883">s</a></span><span class="op" id="2068050">.</span><span class="ident" id="2068051">next</span>&nbsp;<span class="op" id="2068056">!=</span>&nbsp;<span class="ident" id="2068059">nil</span>&nbsp;<span class="op" id="2068063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068067"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2068074">(</span><span class="string" id="2068075">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;next&#34;</span><span class="op" id="2068109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2068112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068115">if</span>&nbsp;<span class="ident" id="2068118"><a href="/runtime/proc.go.html#2067883">s</a></span><span class="op" id="2068119">.</span><span class="ident" id="2068120">prev</span>&nbsp;<span class="op" id="2068125">!=</span>&nbsp;<span class="ident" id="2068128">nil</span>&nbsp;<span class="op" id="2068132">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068136"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2068143">(</span><span class="string" id="2068144">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;prev&#34;</span><span class="op" id="2068178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2068181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068184">if</span>&nbsp;<span class="ident" id="2068187"><a href="/runtime/proc.go.html#2067883">s</a></span><span class="op" id="2068188">.</span><span class="ident" id="2068189">waitlink</span>&nbsp;<span class="op" id="2068198">!=</span>&nbsp;<span class="ident" id="2068201">nil</span>&nbsp;<span class="op" id="2068205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068209"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2068216">(</span><span class="string" id="2068217">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;waitlink&#34;</span><span class="op" id="2068255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2068258">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068261">gp</span>&nbsp;<span class="op" id="2068264">:=</span>&nbsp;<span class="ident" id="2068267"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="2068271">(</span><span class="op" id="2068272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068275">if</span>&nbsp;<span class="ident" id="2068278"><a href="/runtime/proc.go.html#2068261">gp</a></span><span class="op" id="2068280">.</span><span class="ident" id="2068281">param</span>&nbsp;<span class="op" id="2068287">!=</span>&nbsp;<span class="ident" id="2068290">nil</span>&nbsp;<span class="op" id="2068294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068298"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2068305">(</span><span class="string" id="2068306">&#34;runtime:&nbsp;releaseSudog&nbsp;with&nbsp;non-nil&nbsp;gp.param&#34;</span><span class="op" id="2068351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2068354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068357">c</span>&nbsp;<span class="op" id="2068359">:=</span>&nbsp;<span class="ident" id="2068362"><a href="/runtime/stubs.go.html#2132076">gomcache</a></span><span class="op" id="2068370">(</span><span class="op" id="2068371">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068374"><a href="/runtime/proc.go.html#2067883">s</a></span><span class="op" id="2068375">.</span><span class="ident" id="2068376">next</span>&nbsp;<span class="op" id="2068381">=</span>&nbsp;<span class="ident" id="2068383"><a href="/runtime/proc.go.html#2068357">c</a></span><span class="op" id="2068384">.</span><span class="ident" id="2068385">sudogcache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068397"><a href="/runtime/proc.go.html#2068357">c</a></span><span class="op" id="2068398">.</span><span class="ident" id="2068399">sudogcache</span>&nbsp;<span class="op" id="2068410">=</span>&nbsp;<span class="ident" id="2068412"><a href="/runtime/proc.go.html#2067883">s</a></span><br>
<span class="lineno"></span><span class="op" id="2068414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2068417">//&nbsp;funcPC&nbsp;returns&nbsp;the&nbsp;entry&nbsp;PC&nbsp;of&nbsp;the&nbsp;function&nbsp;f.</span><br>
<span class="lineno">200</span><span class="comment" id="2068467">//&nbsp;It&nbsp;assumes&nbsp;that&nbsp;f&nbsp;is&nbsp;a&nbsp;func&nbsp;value.&nbsp;Otherwise&nbsp;the&nbsp;behavior&nbsp;is&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="comment" id="2068542">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="2068555">func</span>&nbsp;<span class="ident" id="2068560">funcPC</span><span class="op" id="2068566">(</span><span class="ident" id="2068567">f</span>&nbsp;<span class="keyword" id="2068569">interface</span><span class="op" id="2068578">{</span><span class="op" id="2068579">}</span><span class="op" id="2068580">)</span>&nbsp;<span class="builtintype" id="2068582">uintptr</span>&nbsp;<span class="op" id="2068590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068593">return</span>&nbsp;<span class="op" id="2068600">*</span><span class="op" id="2068601">*</span><span class="op" id="2068602">(</span><span class="op" id="2068603">*</span><span class="op" id="2068604">*</span><span class="builtintype" id="2068605">uintptr</span><span class="op" id="2068612">)</span><span class="op" id="2068613">(</span><span class="ident" id="2068614"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="2068617">(</span><span class="ident" id="2068618"><a href="/runtime/proc.go.html#2063943">unsafe</a></span><span class="op" id="2068624">.</span><span class="ident" id="2068625">Pointer</span><span class="op" id="2068632">(</span><span class="op" id="2068633">&amp;</span><span class="ident" id="2068634"><a href="/runtime/proc.go.html#2068567">f</a></span><span class="op" id="2068635">)</span><span class="op" id="2068636">,</span>&nbsp;<span class="ident" id="2068638"><a href="/runtime/stubs.go.html#2131510">ptrSize</a></span><span class="op" id="2068645">)</span><span class="op" id="2068646">)</span><br>
<span class="lineno"></span><span class="op" id="2068648">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="2068651">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno"></span><span class="keyword" id="2068675">func</span>&nbsp;<span class="ident" id="2068680">badmcall</span><span class="op" id="2068688">(</span><span class="ident" id="2068689">fn</span>&nbsp;<span class="keyword" id="2068692">func</span><span class="op" id="2068696">(</span><span class="op" id="2068697">*</span><span class="ident" id="2068698"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span><span class="op" id="2068699">)</span><span class="op" id="2068700">)</span>&nbsp;<span class="op" id="2068702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068705"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2068712">(</span><span class="string" id="2068713">&#34;runtime:&nbsp;mcall&nbsp;called&nbsp;on&nbsp;m-&gt;g0&nbsp;stack&#34;</span><span class="op" id="2068751">)</span><br>
<span class="lineno"></span><span class="op" id="2068753">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="2068756">func</span>&nbsp;<span class="ident" id="2068761">badmcall2</span><span class="op" id="2068770">(</span><span class="ident" id="2068771">fn</span>&nbsp;<span class="keyword" id="2068774">func</span><span class="op" id="2068778">(</span><span class="op" id="2068779">*</span><span class="ident" id="2068780"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span><span class="op" id="2068781">)</span><span class="op" id="2068782">)</span>&nbsp;<span class="op" id="2068784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068787"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2068794">(</span><span class="string" id="2068795">&#34;runtime:&nbsp;mcall&nbsp;function&nbsp;returned&#34;</span><span class="op" id="2068829">)</span><br>
<span class="lineno"></span><span class="op" id="2068831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="2068834">func</span>&nbsp;<span class="ident" id="2068839">badreflectcall</span><span class="op" id="2068853">(</span><span class="op" id="2068854">)</span>&nbsp;<span class="op" id="2068856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2068859">panic</span><span class="op" id="2068864">(</span><span class="string" id="2068865">&#34;runtime:&nbsp;arg&nbsp;size&nbsp;to&nbsp;reflect.call&nbsp;more&nbsp;than&nbsp;1GB&#34;</span><span class="op" id="2068914">)</span><br>
<span class="lineno"></span><span class="op" id="2068916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2068919">func</span>&nbsp;<span class="ident" id="2068924">lockedOSThread</span><span class="op" id="2068938">(</span><span class="op" id="2068939">)</span>&nbsp;<span class="builtintype" id="2068941">bool</span>&nbsp;<span class="op" id="2068946">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2068949">gp</span>&nbsp;<span class="op" id="2068952">:=</span>&nbsp;<span class="ident" id="2068955"><a href="/runtime/stubs.go.html#2132021">getg</a></span><span class="op" id="2068959">(</span><span class="op" id="2068960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2068963">return</span>&nbsp;<span class="ident" id="2068970"><a href="/runtime/proc.go.html#2068949">gp</a></span><span class="op" id="2068972">.</span><span class="ident" id="2068973">lockedm</span>&nbsp;<span class="op" id="2068981">!=</span>&nbsp;<span class="ident" id="2068984">nil</span>&nbsp;<span class="op" id="2068988">&amp;&amp;</span>&nbsp;<span class="ident" id="2068991"><a href="/runtime/proc.go.html#2068949">gp</a></span><span class="op" id="2068993">.</span><span class="ident" id="2068994">m</span><span class="op" id="2068995">.</span><span class="ident" id="2068996">lockedg</span>&nbsp;<span class="op" id="2069004">!=</span>&nbsp;<span class="ident" id="2069007">nil</span><br>
<span class="lineno"></span><span class="op" id="2069011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2069014">func</span>&nbsp;<span class="ident" id="2069019">newP</span><span class="op" id="2069023">(</span><span class="op" id="2069024">)</span>&nbsp;<span class="op" id="2069026">*</span><span class="ident" id="2069027"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2181698">p</a></span>&nbsp;<span class="op" id="2069029">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069032">return</span>&nbsp;<span class="builtinfunc" id="2069039">new</span><span class="op" id="2069042">(</span><span class="ident" id="2069043"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2181698">p</a></span><span class="op" id="2069044">)</span><br>
<span class="lineno"></span><span class="op" id="2069046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2069049">func</span>&nbsp;<span class="ident" id="2069054">newM</span><span class="op" id="2069058">(</span><span class="op" id="2069059">)</span>&nbsp;<span class="op" id="2069061">*</span><span class="ident" id="2069062"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180912">m</a></span>&nbsp;<span class="op" id="2069064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069067">return</span>&nbsp;<span class="builtinfunc" id="2069074">new</span><span class="op" id="2069077">(</span><span class="ident" id="2069078"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180912">m</a></span><span class="op" id="2069079">)</span><br>
<span class="lineno">230</span><span class="op" id="2069081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2069084">func</span>&nbsp;<span class="ident" id="2069089">newG</span><span class="op" id="2069093">(</span><span class="op" id="2069094">)</span>&nbsp;<span class="op" id="2069096">*</span><span class="ident" id="2069097"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span>&nbsp;<span class="op" id="2069099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069102">return</span>&nbsp;<span class="builtinfunc" id="2069109">new</span><span class="op" id="2069112">(</span><span class="ident" id="2069113"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span><span class="op" id="2069114">)</span><br>
<span class="lineno"></span><span class="op" id="2069116">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="2069119">func</span>&nbsp;<span class="ident" id="2069124">allgadd</span><span class="op" id="2069131">(</span><span class="ident" id="2069132">gp</span>&nbsp;<span class="op" id="2069135">*</span><span class="ident" id="2069136"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span><span class="op" id="2069137">)</span>&nbsp;<span class="op" id="2069139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2069142">if</span>&nbsp;<span class="ident" id="2069145"><a href="/runtime/stubs.go.html#2132100">readgstatus</a></span><span class="op" id="2069156">(</span><span class="ident" id="2069157"><a href="/runtime/proc.go.html#2069132">gp</a></span><span class="op" id="2069159">)</span>&nbsp;<span class="op" id="2069161">==</span>&nbsp;<span class="ident" id="2069164"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2178858">_Gidle</a></span>&nbsp;<span class="op" id="2069171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069175"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2069182">(</span><span class="string" id="2069183">&#34;allgadd:&nbsp;bad&nbsp;status&nbsp;Gidle&#34;</span><span class="op" id="2069210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2069213">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069217"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2069221">(</span><span class="op" id="2069222">&amp;</span><span class="ident" id="2069223"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2196731">allglock</a></span><span class="op" id="2069231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069234"><a href="/runtime/mprof.go.html#2026632">allgs</a></span>&nbsp;<span class="op" id="2069240">=</span>&nbsp;<span class="builtinfunc" id="2069242">append</span><span class="op" id="2069248">(</span><span class="ident" id="2069249"><a href="/runtime/mprof.go.html#2026632">allgs</a></span><span class="op" id="2069254">,</span>&nbsp;<span class="ident" id="2069256"><a href="/runtime/proc.go.html#2069132">gp</a></span><span class="op" id="2069258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069261"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184298">allg</a></span>&nbsp;<span class="op" id="2069266">=</span>&nbsp;<span class="op" id="2069268">&amp;</span><span class="ident" id="2069269"><a href="/runtime/mprof.go.html#2026632">allgs</a></span><span class="op" id="2069274">[</span><span class="num" id="2069275">0</span><span class="op" id="2069276">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069279"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2184311">allglen</a></span>&nbsp;<span class="op" id="2069287">=</span>&nbsp;<span class="builtintype" id="2069289">uintptr</span><span class="op" id="2069296">(</span><span class="builtinfunc" id="2069297">len</span><span class="op" id="2069300">(</span><span class="ident" id="2069301"><a href="/runtime/mprof.go.html#2026632">allgs</a></span><span class="op" id="2069306">)</span><span class="op" id="2069307">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2069310"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2069316">(</span><span class="op" id="2069317">&amp;</span><span class="ident" id="2069318"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2196731">allglock</a></span><span class="op" id="2069326">)</span><br>
<span class="lineno"></span><span class="op" id="2069328">}</span>
</div>
</body>
</html>
