<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/des</h2>
<ul>
<li><a href="/gostd/crypto/des/block.go.html">block.go</a></li>
<li><a href="/gostd/crypto/des/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/des/const.go.html">const.go</a></li>
<li><a href="/gostd/crypto/des/des_test.go.html">des_test.go</a></li>
<li><a href="/gostd/crypto/des/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3770189">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3770244">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3770298">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3770349">package</span>&nbsp;<span class="ident" id="3770357">des</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3770362">import</span>&nbsp;<span class="op" id="3770369">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3770372">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span><span class="op" id="3770390">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3770393">func</span>&nbsp;<span class="ident" id="3770398">cryptBlock</span><span class="op" id="3770408">(</span><span class="ident" id="3770409">subkeys</span>&nbsp;<span class="op" id="3770417">[</span><span class="op" id="3770418">]</span><span class="ident" id="3770419">uint64</span><span class="op" id="3770425">,</span>&nbsp;<span class="ident" id="3770427">dst</span><span class="op" id="3770430">,</span>&nbsp;<span class="ident" id="3770432">src</span>&nbsp;<span class="op" id="3770436">[</span><span class="op" id="3770437">]</span><span class="builtintype" id="3770438">byte</span><span class="op" id="3770442">,</span>&nbsp;<span class="ident" id="3770444">decrypt</span>&nbsp;<span class="builtintype" id="3770452">bool</span><span class="op" id="3770456">)</span>&nbsp;<span class="op" id="3770458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770461">b</span>&nbsp;<span class="op" id="3770463">:=</span>&nbsp;<span class="ident" id="3770466">binary</span><span class="op" id="3770472">.</span><span class="ident" id="3770473">BigEndian</span><span class="op" id="3770482">.</span><span class="ident" id="3770483">Uint64</span><span class="op" id="3770489">(</span><span class="ident" id="3770490">src</span><span class="op" id="3770493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770496">b</span>&nbsp;<span class="op" id="3770498">=</span>&nbsp;<span class="ident" id="3770500">permuteInitialBlock</span><span class="op" id="3770519">(</span><span class="ident" id="3770520">b</span><span class="op" id="3770521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770524">left</span><span class="op" id="3770528">,</span>&nbsp;<span class="ident" id="3770530">right</span>&nbsp;<span class="op" id="3770536">:=</span>&nbsp;<span class="builtintype" id="3770539">uint32</span><span class="op" id="3770545">(</span><span class="ident" id="3770546">b</span><span class="op" id="3770547">&gt;&gt;</span><span class="num" id="3770549">32</span><span class="op" id="3770551">)</span><span class="op" id="3770552">,</span>&nbsp;<span class="builtintype" id="3770554">uint32</span><span class="op" id="3770560">(</span><span class="ident" id="3770561">b</span><span class="op" id="3770562">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770566">var</span>&nbsp;<span class="ident" id="3770570">subkey</span>&nbsp;<span class="ident" id="3770577">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770585">for</span>&nbsp;<span class="ident" id="3770589">i</span>&nbsp;<span class="op" id="3770591">:=</span>&nbsp;<span class="num" id="3770594">0</span><span class="op" id="3770595">;</span>&nbsp;<span class="ident" id="3770597">i</span>&nbsp;<span class="op" id="3770599">&lt;</span>&nbsp;<span class="num" id="3770601">16</span><span class="op" id="3770603">;</span>&nbsp;<span class="ident" id="3770605">i</span><span class="op" id="3770606">++</span>&nbsp;<span class="op" id="3770609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770613">if</span>&nbsp;<span class="ident" id="3770616">decrypt</span>&nbsp;<span class="op" id="3770624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770629">subkey</span>&nbsp;<span class="op" id="3770636">=</span>&nbsp;<span class="ident" id="3770638">subkeys</span><span class="op" id="3770645">[</span><span class="num" id="3770646">15</span><span class="op" id="3770648">-</span><span class="ident" id="3770649">i</span><span class="op" id="3770650">]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770654">}</span>&nbsp;<span class="keyword" id="3770656">else</span>&nbsp;<span class="op" id="3770661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770666">subkey</span>&nbsp;<span class="op" id="3770673">=</span>&nbsp;<span class="ident" id="3770675">subkeys</span><span class="op" id="3770682">[</span><span class="ident" id="3770683">i</span><span class="op" id="3770684">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770693">left</span><span class="op" id="3770697">,</span>&nbsp;<span class="ident" id="3770699">right</span>&nbsp;<span class="op" id="3770705">=</span>&nbsp;<span class="ident" id="3770707">right</span><span class="op" id="3770712">,</span>&nbsp;<span class="ident" id="3770714">left</span><span class="op" id="3770718">^</span><span class="ident" id="3770719">feistel</span><span class="op" id="3770726">(</span><span class="ident" id="3770727">right</span><span class="op" id="3770732">,</span>&nbsp;<span class="ident" id="3770734">subkey</span><span class="op" id="3770740">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3770746">//&nbsp;switch&nbsp;left&nbsp;&amp;&nbsp;right&nbsp;and&nbsp;perform&nbsp;final&nbsp;permutation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770800">preOutput</span>&nbsp;<span class="op" id="3770810">:=</span>&nbsp;<span class="op" id="3770813">(</span><span class="ident" id="3770814">uint64</span><span class="op" id="3770820">(</span><span class="ident" id="3770821">right</span><span class="op" id="3770826">)</span>&nbsp;<span class="op" id="3770828">&lt;&lt;</span>&nbsp;<span class="num" id="3770831">32</span><span class="op" id="3770833">)</span>&nbsp;<span class="op" id="3770835">|</span>&nbsp;<span class="ident" id="3770837">uint64</span><span class="op" id="3770843">(</span><span class="ident" id="3770844">left</span><span class="op" id="3770848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770851">binary</span><span class="op" id="3770857">.</span><span class="ident" id="3770858">BigEndian</span><span class="op" id="3770867">.</span><span class="ident" id="3770868">PutUint64</span><span class="op" id="3770877">(</span><span class="ident" id="3770878">dst</span><span class="op" id="3770881">,</span>&nbsp;<span class="ident" id="3770883">permuteFinalBlock</span><span class="op" id="3770900">(</span><span class="ident" id="3770901">preOutput</span><span class="op" id="3770910">)</span><span class="op" id="3770911">)</span><br>
<span class="lineno"></span><span class="op" id="3770913">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="3770916">//&nbsp;Encrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;subkeys.</span><br>
<span class="lineno"></span><span class="keyword" id="3770975">func</span>&nbsp;<span class="ident" id="3770980">encryptBlock</span><span class="op" id="3770992">(</span><span class="ident" id="3770993">subkeys</span>&nbsp;<span class="op" id="3771001">[</span><span class="op" id="3771002">]</span><span class="ident" id="3771003">uint64</span><span class="op" id="3771009">,</span>&nbsp;<span class="ident" id="3771011">dst</span><span class="op" id="3771014">,</span>&nbsp;<span class="ident" id="3771016">src</span>&nbsp;<span class="op" id="3771020">[</span><span class="op" id="3771021">]</span><span class="builtintype" id="3771022">byte</span><span class="op" id="3771026">)</span>&nbsp;<span class="op" id="3771028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771031">cryptBlock</span><span class="op" id="3771041">(</span><span class="ident" id="3771042">subkeys</span><span class="op" id="3771049">,</span>&nbsp;<span class="ident" id="3771051">dst</span><span class="op" id="3771054">,</span>&nbsp;<span class="ident" id="3771056">src</span><span class="op" id="3771059">,</span>&nbsp;<span class="builtintype" id="3771061">false</span><span class="op" id="3771066">)</span><br>
<span class="lineno"></span><span class="op" id="3771068">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="3771071">//&nbsp;Decrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;subkeys.</span><br>
<span class="lineno"></span><span class="keyword" id="3771130">func</span>&nbsp;<span class="ident" id="3771135">decryptBlock</span><span class="op" id="3771147">(</span><span class="ident" id="3771148">subkeys</span>&nbsp;<span class="op" id="3771156">[</span><span class="op" id="3771157">]</span><span class="ident" id="3771158">uint64</span><span class="op" id="3771164">,</span>&nbsp;<span class="ident" id="3771166">dst</span><span class="op" id="3771169">,</span>&nbsp;<span class="ident" id="3771171">src</span>&nbsp;<span class="op" id="3771175">[</span><span class="op" id="3771176">]</span><span class="builtintype" id="3771177">byte</span><span class="op" id="3771181">)</span>&nbsp;<span class="op" id="3771183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771186">cryptBlock</span><span class="op" id="3771196">(</span><span class="ident" id="3771197">subkeys</span><span class="op" id="3771204">,</span>&nbsp;<span class="ident" id="3771206">dst</span><span class="op" id="3771209">,</span>&nbsp;<span class="ident" id="3771211">src</span><span class="op" id="3771214">,</span>&nbsp;<span class="builtintype" id="3771216">true</span><span class="op" id="3771220">)</span><br>
<span class="lineno"></span><span class="op" id="3771222">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3771225">//&nbsp;DES&nbsp;Feistel&nbsp;function</span><br>
<span class="lineno"></span><span class="keyword" id="3771249">func</span>&nbsp;<span class="ident" id="3771254">feistel</span><span class="op" id="3771261">(</span><span class="ident" id="3771262">right</span>&nbsp;<span class="builtintype" id="3771268">uint32</span><span class="op" id="3771274">,</span>&nbsp;<span class="ident" id="3771276">key</span>&nbsp;<span class="ident" id="3771280">uint64</span><span class="op" id="3771286">)</span>&nbsp;<span class="op" id="3771288">(</span><span class="ident" id="3771289">result</span>&nbsp;<span class="builtintype" id="3771296">uint32</span><span class="op" id="3771302">)</span>&nbsp;<span class="op" id="3771304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771307">sBoxLocations</span>&nbsp;<span class="op" id="3771321">:=</span>&nbsp;<span class="ident" id="3771324">key</span>&nbsp;<span class="op" id="3771328">^</span>&nbsp;<span class="ident" id="3771330">expandBlock</span><span class="op" id="3771341">(</span><span class="ident" id="3771342">right</span><span class="op" id="3771347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771350">var</span>&nbsp;<span class="ident" id="3771354">sBoxResult</span>&nbsp;<span class="builtintype" id="3771365">uint32</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771373">for</span>&nbsp;<span class="ident" id="3771377">i</span>&nbsp;<span class="op" id="3771379">:=</span>&nbsp;<span class="builtintype" id="3771382">uint8</span><span class="op" id="3771387">(</span><span class="num" id="3771388">0</span><span class="op" id="3771389">)</span><span class="op" id="3771390">;</span>&nbsp;<span class="ident" id="3771392">i</span>&nbsp;<span class="op" id="3771394">&lt;</span>&nbsp;<span class="num" id="3771396">8</span><span class="op" id="3771397">;</span>&nbsp;<span class="ident" id="3771399">i</span><span class="op" id="3771400">++</span>&nbsp;<span class="op" id="3771403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771407">sBoxLocation</span>&nbsp;<span class="op" id="3771420">:=</span>&nbsp;<span class="builtintype" id="3771423">uint8</span><span class="op" id="3771428">(</span><span class="ident" id="3771429">sBoxLocations</span><span class="op" id="3771442">&gt;&gt;</span><span class="num" id="3771444">42</span><span class="op" id="3771446">)</span>&nbsp;<span class="op" id="3771448">&amp;</span>&nbsp;<span class="num" id="3771450">0x3f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771457">sBoxLocations</span>&nbsp;<span class="op" id="3771471">&lt;&lt;=</span>&nbsp;<span class="num" id="3771475">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771479">//&nbsp;row&nbsp;determined&nbsp;by&nbsp;1st&nbsp;and&nbsp;6th&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771518">//&nbsp;column&nbsp;is&nbsp;middle&nbsp;four&nbsp;bits</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771550">row</span>&nbsp;<span class="op" id="3771554">:=</span>&nbsp;<span class="op" id="3771557">(</span><span class="ident" id="3771558">sBoxLocation</span>&nbsp;<span class="op" id="3771571">&amp;</span>&nbsp;<span class="num" id="3771573">0x1</span><span class="op" id="3771576">)</span>&nbsp;<span class="op" id="3771578">|</span>&nbsp;<span class="op" id="3771580">(</span><span class="op" id="3771581">(</span><span class="ident" id="3771582">sBoxLocation</span>&nbsp;<span class="op" id="3771595">&amp;</span>&nbsp;<span class="num" id="3771597">0x20</span><span class="op" id="3771601">)</span>&nbsp;<span class="op" id="3771603">&gt;&gt;</span>&nbsp;<span class="num" id="3771606">4</span><span class="op" id="3771607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771611">column</span>&nbsp;<span class="op" id="3771618">:=</span>&nbsp;<span class="op" id="3771621">(</span><span class="ident" id="3771622">sBoxLocation</span>&nbsp;<span class="op" id="3771635">&gt;&gt;</span>&nbsp;<span class="num" id="3771638">1</span><span class="op" id="3771639">)</span>&nbsp;<span class="op" id="3771641">&amp;</span>&nbsp;<span class="num" id="3771643">0xf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771649">sBoxResult</span>&nbsp;<span class="op" id="3771660">^=</span>&nbsp;<span class="ident" id="3771663">feistelBox</span><span class="op" id="3771673">[</span><span class="ident" id="3771674">i</span><span class="op" id="3771675">]</span><span class="op" id="3771676">[</span><span class="num" id="3771677">16</span><span class="op" id="3771679">*</span><span class="ident" id="3771680">row</span><span class="op" id="3771683">+</span><span class="ident" id="3771684">column</span><span class="op" id="3771690">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3771693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771696">return</span>&nbsp;<span class="ident" id="3771703">sBoxResult</span><br>
<span class="lineno">55</span><span class="op" id="3771714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3771717">//&nbsp;feistelBox[s][16*i+j]&nbsp;contains&nbsp;the&nbsp;output&nbsp;of&nbsp;permutationFunction</span><br>
<span class="lineno"></span><span class="comment" id="3771785">//&nbsp;for&nbsp;sBoxes[s][i][j]&nbsp;&lt;&lt;&nbsp;4*(7-s)</span><br>
<span class="lineno"></span><span class="keyword" id="3771819">var</span>&nbsp;<span class="ident" id="3771823">feistelBox</span>&nbsp;<span class="op" id="3771834">[</span><span class="num" id="3771835">8</span><span class="op" id="3771836">]</span><span class="op" id="3771837">[</span><span class="num" id="3771838">64</span><span class="op" id="3771840">]</span><span class="builtintype" id="3771841">uint32</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="3771849">//&nbsp;general&nbsp;purpose&nbsp;function&nbsp;to&nbsp;perform&nbsp;DES&nbsp;block&nbsp;permutations</span><br>
<span class="lineno"></span><span class="keyword" id="3771911">func</span>&nbsp;<span class="ident" id="3771916">permuteBlock</span><span class="op" id="3771928">(</span><span class="ident" id="3771929">src</span>&nbsp;<span class="ident" id="3771933">uint64</span><span class="op" id="3771939">,</span>&nbsp;<span class="ident" id="3771941">permutation</span>&nbsp;<span class="op" id="3771953">[</span><span class="op" id="3771954">]</span><span class="builtintype" id="3771955">uint8</span><span class="op" id="3771960">)</span>&nbsp;<span class="op" id="3771962">(</span><span class="ident" id="3771963">block</span>&nbsp;<span class="ident" id="3771969">uint64</span><span class="op" id="3771975">)</span>&nbsp;<span class="op" id="3771977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771980">for</span>&nbsp;<span class="ident" id="3771984">position</span><span class="op" id="3771992">,</span>&nbsp;<span class="ident" id="3771994">n</span>&nbsp;<span class="op" id="3771996">:=</span>&nbsp;<span class="keyword" id="3771999">range</span>&nbsp;<span class="ident" id="3772005">permutation</span>&nbsp;<span class="op" id="3772017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772021">bit</span>&nbsp;<span class="op" id="3772025">:=</span>&nbsp;<span class="op" id="3772028">(</span><span class="ident" id="3772029">src</span>&nbsp;<span class="op" id="3772033">&gt;&gt;</span>&nbsp;<span class="ident" id="3772036">n</span><span class="op" id="3772037">)</span>&nbsp;<span class="op" id="3772039">&amp;</span>&nbsp;<span class="num" id="3772041">1</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772045">block</span>&nbsp;<span class="op" id="3772051">|=</span>&nbsp;<span class="ident" id="3772054">bit</span>&nbsp;<span class="op" id="3772058">&lt;&lt;</span>&nbsp;<span class="builtintype" id="3772061">uint</span><span class="op" id="3772065">(</span><span class="op" id="3772066">(</span><span class="builtinfunc" id="3772067">len</span><span class="op" id="3772070">(</span><span class="ident" id="3772071">permutation</span><span class="op" id="3772082">)</span><span class="op" id="3772083">-</span><span class="num" id="3772084">1</span><span class="op" id="3772085">)</span><span class="op" id="3772086">-</span><span class="ident" id="3772087">position</span><span class="op" id="3772095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772101">return</span><br>
<span class="lineno"></span><span class="op" id="3772108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="3772111">func</span>&nbsp;<span class="ident" id="3772116">init</span><span class="op" id="3772120">(</span><span class="op" id="3772121">)</span>&nbsp;<span class="op" id="3772123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772126">for</span>&nbsp;<span class="ident" id="3772130">s</span>&nbsp;<span class="op" id="3772132">:=</span>&nbsp;<span class="keyword" id="3772135">range</span>&nbsp;<span class="ident" id="3772141">sBoxes</span>&nbsp;<span class="op" id="3772148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772152">for</span>&nbsp;<span class="ident" id="3772156">i</span>&nbsp;<span class="op" id="3772158">:=</span>&nbsp;<span class="num" id="3772161">0</span><span class="op" id="3772162">;</span>&nbsp;<span class="ident" id="3772164">i</span>&nbsp;<span class="op" id="3772166">&lt;</span>&nbsp;<span class="num" id="3772168">4</span><span class="op" id="3772169">;</span>&nbsp;<span class="ident" id="3772171">i</span><span class="op" id="3772172">++</span>&nbsp;<span class="op" id="3772175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772180">for</span>&nbsp;<span class="ident" id="3772184">j</span>&nbsp;<span class="op" id="3772186">:=</span>&nbsp;<span class="num" id="3772189">0</span><span class="op" id="3772190">;</span>&nbsp;<span class="ident" id="3772192">j</span>&nbsp;<span class="op" id="3772194">&lt;</span>&nbsp;<span class="num" id="3772196">16</span><span class="op" id="3772198">;</span>&nbsp;<span class="ident" id="3772200">j</span><span class="op" id="3772201">++</span>&nbsp;<span class="op" id="3772204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772210">f</span>&nbsp;<span class="op" id="3772212">:=</span>&nbsp;<span class="ident" id="3772215">uint64</span><span class="op" id="3772221">(</span><span class="ident" id="3772222">sBoxes</span><span class="op" id="3772228">[</span><span class="ident" id="3772229">s</span><span class="op" id="3772230">]</span><span class="op" id="3772231">[</span><span class="ident" id="3772232">i</span><span class="op" id="3772233">]</span><span class="op" id="3772234">[</span><span class="ident" id="3772235">j</span><span class="op" id="3772236">]</span><span class="op" id="3772237">)</span>&nbsp;<span class="op" id="3772239">&lt;&lt;</span>&nbsp;<span class="op" id="3772242">(</span><span class="num" id="3772243">4</span>&nbsp;<span class="op" id="3772245">*</span>&nbsp;<span class="op" id="3772247">(</span><span class="num" id="3772248">7</span>&nbsp;<span class="op" id="3772250">-</span>&nbsp;<span class="builtintype" id="3772252">uint</span><span class="op" id="3772256">(</span><span class="ident" id="3772257">s</span><span class="op" id="3772258">)</span><span class="op" id="3772259">)</span><span class="op" id="3772260">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772266">f</span>&nbsp;<span class="op" id="3772268">=</span>&nbsp;<span class="ident" id="3772270">permuteBlock</span><span class="op" id="3772282">(</span><span class="ident" id="3772283">uint64</span><span class="op" id="3772289">(</span><span class="ident" id="3772290">f</span><span class="op" id="3772291">)</span><span class="op" id="3772292">,</span>&nbsp;<span class="ident" id="3772294">permutationFunction</span><span class="op" id="3772313">[</span><span class="op" id="3772314">:</span><span class="op" id="3772315">]</span><span class="op" id="3772316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772322">feistelBox</span><span class="op" id="3772332">[</span><span class="ident" id="3772333">s</span><span class="op" id="3772334">]</span><span class="op" id="3772335">[</span><span class="num" id="3772336">16</span><span class="op" id="3772338">*</span><span class="ident" id="3772339">i</span><span class="op" id="3772340">+</span><span class="ident" id="3772341">j</span><span class="op" id="3772342">]</span>&nbsp;<span class="op" id="3772344">=</span>&nbsp;<span class="builtintype" id="3772346">uint32</span><span class="op" id="3772352">(</span><span class="ident" id="3772353">f</span><span class="op" id="3772354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772366">}</span><br>
<span class="lineno">80</span><span class="op" id="3772368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3772371">//&nbsp;expandBlock&nbsp;expands&nbsp;an&nbsp;input&nbsp;block&nbsp;of&nbsp;32&nbsp;bits,</span><br>
<span class="lineno"></span><span class="comment" id="3772421">//&nbsp;producing&nbsp;an&nbsp;output&nbsp;block&nbsp;of&nbsp;48&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="3772462">func</span>&nbsp;<span class="ident" id="3772467">expandBlock</span><span class="op" id="3772478">(</span><span class="ident" id="3772479">src</span>&nbsp;<span class="builtintype" id="3772483">uint32</span><span class="op" id="3772489">)</span>&nbsp;<span class="op" id="3772491">(</span><span class="ident" id="3772492">block</span>&nbsp;<span class="ident" id="3772498">uint64</span><span class="op" id="3772504">)</span>&nbsp;<span class="op" id="3772506">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772509">//&nbsp;rotate&nbsp;the&nbsp;5&nbsp;highest&nbsp;bits&nbsp;to&nbsp;the&nbsp;right.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772553">src</span>&nbsp;<span class="op" id="3772557">=</span>&nbsp;<span class="op" id="3772559">(</span><span class="ident" id="3772560">src</span>&nbsp;<span class="op" id="3772564">&lt;&lt;</span>&nbsp;<span class="num" id="3772567">5</span><span class="op" id="3772568">)</span>&nbsp;<span class="op" id="3772570">|</span>&nbsp;<span class="op" id="3772572">(</span><span class="ident" id="3772573">src</span>&nbsp;<span class="op" id="3772577">&gt;&gt;</span>&nbsp;<span class="num" id="3772580">27</span><span class="op" id="3772582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772585">for</span>&nbsp;<span class="ident" id="3772589">i</span>&nbsp;<span class="op" id="3772591">:=</span>&nbsp;<span class="num" id="3772594">0</span><span class="op" id="3772595">;</span>&nbsp;<span class="ident" id="3772597">i</span>&nbsp;<span class="op" id="3772599">&lt;</span>&nbsp;<span class="num" id="3772601">8</span><span class="op" id="3772602">;</span>&nbsp;<span class="ident" id="3772604">i</span><span class="op" id="3772605">++</span>&nbsp;<span class="op" id="3772608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772612">block</span>&nbsp;<span class="op" id="3772618">&lt;&lt;=</span>&nbsp;<span class="num" id="3772622">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772626">//&nbsp;take&nbsp;the&nbsp;6&nbsp;bits&nbsp;on&nbsp;the&nbsp;right</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772660">block</span>&nbsp;<span class="op" id="3772666">|=</span>&nbsp;<span class="ident" id="3772669">uint64</span><span class="op" id="3772675">(</span><span class="ident" id="3772676">src</span><span class="op" id="3772679">)</span>&nbsp;<span class="op" id="3772681">&amp;</span>&nbsp;<span class="op" id="3772683">(</span><span class="num" id="3772684">1</span><span class="op" id="3772685">&lt;&lt;</span><span class="num" id="3772687">6</span>&nbsp;<span class="op" id="3772689">-</span>&nbsp;<span class="num" id="3772691">1</span><span class="op" id="3772692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772696">//&nbsp;advance&nbsp;by&nbsp;4&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772720">src</span>&nbsp;<span class="op" id="3772724">=</span>&nbsp;<span class="op" id="3772726">(</span><span class="ident" id="3772727">src</span>&nbsp;<span class="op" id="3772731">&lt;&lt;</span>&nbsp;<span class="num" id="3772734">4</span><span class="op" id="3772735">)</span>&nbsp;<span class="op" id="3772737">|</span>&nbsp;<span class="op" id="3772739">(</span><span class="ident" id="3772740">src</span>&nbsp;<span class="op" id="3772744">&gt;&gt;</span>&nbsp;<span class="num" id="3772747">28</span><span class="op" id="3772749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772755">return</span><br>
<span class="lineno">95</span><span class="op" id="3772762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3772765">//&nbsp;permuteInitialBlock&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;permutation&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment" id="3772829">//&nbsp;by&nbsp;initialPermutation.</span><br>
<span class="lineno"></span><span class="keyword" id="3772855">func</span>&nbsp;<span class="ident" id="3772860">permuteInitialBlock</span><span class="op" id="3772879">(</span><span class="ident" id="3772880">block</span>&nbsp;<span class="ident" id="3772886">uint64</span><span class="op" id="3772892">)</span>&nbsp;<span class="ident" id="3772894">uint64</span>&nbsp;<span class="op" id="3772901">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772904">//&nbsp;block&nbsp;=&nbsp;b7&nbsp;b6&nbsp;b5&nbsp;b4&nbsp;b3&nbsp;b2&nbsp;b1&nbsp;b0&nbsp;(8&nbsp;bytes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772950">b1</span>&nbsp;<span class="op" id="3772953">:=</span>&nbsp;<span class="ident" id="3772956">block</span>&nbsp;<span class="op" id="3772962">&gt;&gt;</span>&nbsp;<span class="num" id="3772965">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772969">b2</span>&nbsp;<span class="op" id="3772972">:=</span>&nbsp;<span class="ident" id="3772975">block</span>&nbsp;<span class="op" id="3772981">&lt;&lt;</span>&nbsp;<span class="num" id="3772984">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772988">block</span>&nbsp;<span class="op" id="3772994">^=</span>&nbsp;<span class="ident" id="3772997">b1</span>&nbsp;<span class="op" id="3773000">^</span>&nbsp;<span class="ident" id="3773002">b2</span>&nbsp;<span class="op" id="3773005">^</span>&nbsp;<span class="ident" id="3773007">b1</span><span class="op" id="3773009">&lt;&lt;</span><span class="num" id="3773011">48</span>&nbsp;<span class="op" id="3773014">^</span>&nbsp;<span class="ident" id="3773016">b2</span><span class="op" id="3773018">&gt;&gt;</span><span class="num" id="3773020">48</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773025">//&nbsp;block&nbsp;=&nbsp;b1&nbsp;b0&nbsp;b5&nbsp;b4&nbsp;b3&nbsp;b2&nbsp;b7&nbsp;b6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773061">b1</span>&nbsp;<span class="op" id="3773064">=</span>&nbsp;<span class="ident" id="3773066">block</span>&nbsp;<span class="op" id="3773072">&gt;&gt;</span>&nbsp;<span class="num" id="3773075">32</span>&nbsp;<span class="op" id="3773078">&amp;</span>&nbsp;<span class="num" id="3773080">0xff00ff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773090">b2</span>&nbsp;<span class="op" id="3773093">=</span>&nbsp;<span class="op" id="3773095">(</span><span class="ident" id="3773096">block</span>&nbsp;<span class="op" id="3773102">&amp;</span>&nbsp;<span class="num" id="3773104">0xff00ff00</span><span class="op" id="3773114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773117">block</span>&nbsp;<span class="op" id="3773123">^=</span>&nbsp;<span class="ident" id="3773126">b1</span><span class="op" id="3773128">&lt;&lt;</span><span class="num" id="3773130">32</span>&nbsp;<span class="op" id="3773133">^</span>&nbsp;<span class="ident" id="3773135">b2</span>&nbsp;<span class="op" id="3773138">^</span>&nbsp;<span class="ident" id="3773140">b1</span><span class="op" id="3773142">&lt;&lt;</span><span class="num" id="3773144">8</span>&nbsp;<span class="op" id="3773146">^</span>&nbsp;<span class="ident" id="3773148">b2</span><span class="op" id="3773150">&lt;&lt;</span><span class="num" id="3773152">24</span>&nbsp;<span class="comment" id="3773155">//&nbsp;exchange&nbsp;b0&nbsp;b4&nbsp;with&nbsp;b3&nbsp;b7</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773186">//&nbsp;block&nbsp;is&nbsp;now&nbsp;b1&nbsp;b3&nbsp;b5&nbsp;b7&nbsp;b0&nbsp;b2&nbsp;b4&nbsp;b7,&nbsp;the&nbsp;permutation:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773245">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773273">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773301">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773329">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;56</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773357">//&nbsp;&nbsp;7&nbsp;&nbsp;6&nbsp;&nbsp;5&nbsp;&nbsp;4&nbsp;&nbsp;3&nbsp;&nbsp;2&nbsp;&nbsp;1&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773385">//&nbsp;23&nbsp;22&nbsp;21&nbsp;20&nbsp;19&nbsp;18&nbsp;17&nbsp;16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773413">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773441">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;48</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773470">//&nbsp;exchange&nbsp;4,5,6,7&nbsp;with&nbsp;32,33,34,35&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773513">b1</span>&nbsp;<span class="op" id="3773516">=</span>&nbsp;<span class="ident" id="3773518">block</span>&nbsp;<span class="op" id="3773524">&amp;</span>&nbsp;<span class="num" id="3773526">0x0f0f00000f0f0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773546">b2</span>&nbsp;<span class="op" id="3773549">=</span>&nbsp;<span class="ident" id="3773551">block</span>&nbsp;<span class="op" id="3773557">&amp;</span>&nbsp;<span class="num" id="3773559">0x0000f0f00000f0f0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773579">block</span>&nbsp;<span class="op" id="3773585">^=</span>&nbsp;<span class="ident" id="3773588">b1</span>&nbsp;<span class="op" id="3773591">^</span>&nbsp;<span class="ident" id="3773593">b2</span>&nbsp;<span class="op" id="3773596">^</span>&nbsp;<span class="ident" id="3773598">b1</span><span class="op" id="3773600">&gt;&gt;</span><span class="num" id="3773602">12</span>&nbsp;<span class="op" id="3773605">^</span>&nbsp;<span class="ident" id="3773607">b2</span><span class="op" id="3773609">&lt;&lt;</span><span class="num" id="3773611">12</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773616">//&nbsp;block&nbsp;is&nbsp;the&nbsp;permutation:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773646">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773650">//&nbsp;&nbsp;&nbsp;[+8]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[+40]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773675">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773679">//&nbsp;&nbsp;7&nbsp;&nbsp;6&nbsp;&nbsp;5&nbsp;&nbsp;4</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773695">//&nbsp;23&nbsp;22&nbsp;21&nbsp;20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773711">//&nbsp;&nbsp;3&nbsp;&nbsp;2&nbsp;&nbsp;1&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773727">//&nbsp;19&nbsp;18&nbsp;17&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;[+32]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773753">//&nbsp;exchange&nbsp;0,1,4,5&nbsp;with&nbsp;18,19,22,23</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773791">b1</span>&nbsp;<span class="op" id="3773794">=</span>&nbsp;<span class="ident" id="3773796">block</span>&nbsp;<span class="op" id="3773802">&amp;</span>&nbsp;<span class="num" id="3773804">0x3300330033003300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773824">b2</span>&nbsp;<span class="op" id="3773827">=</span>&nbsp;<span class="ident" id="3773829">block</span>&nbsp;<span class="op" id="3773835">&amp;</span>&nbsp;<span class="num" id="3773837">0x00cc00cc00cc00cc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773857">block</span>&nbsp;<span class="op" id="3773863">^=</span>&nbsp;<span class="ident" id="3773866">b1</span>&nbsp;<span class="op" id="3773869">^</span>&nbsp;<span class="ident" id="3773871">b2</span>&nbsp;<span class="op" id="3773874">^</span>&nbsp;<span class="ident" id="3773876">b1</span><span class="op" id="3773878">&gt;&gt;</span><span class="num" id="3773880">6</span>&nbsp;<span class="op" id="3773882">^</span>&nbsp;<span class="ident" id="3773884">b2</span><span class="op" id="3773886">&lt;&lt;</span><span class="num" id="3773888">6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773892">//&nbsp;block&nbsp;is&nbsp;the&nbsp;permutation:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773922">//&nbsp;15&nbsp;14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773932">//&nbsp;13&nbsp;12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773942">//&nbsp;11&nbsp;10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773952">//&nbsp;&nbsp;9&nbsp;&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773962">//&nbsp;&nbsp;7&nbsp;&nbsp;6</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773972">//&nbsp;&nbsp;5&nbsp;&nbsp;4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773982">//&nbsp;&nbsp;3&nbsp;&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773992">//&nbsp;&nbsp;1&nbsp;&nbsp;0&nbsp;[+16]&nbsp;[+32]&nbsp;[+64]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774021">//&nbsp;exchange&nbsp;0,2,4,6&nbsp;with&nbsp;9,11,13,15:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774059">b1</span>&nbsp;<span class="op" id="3774062">=</span>&nbsp;<span class="ident" id="3774064">block</span>&nbsp;<span class="op" id="3774070">&amp;</span>&nbsp;<span class="num" id="3774072">0xaaaaaaaa55555555</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774092">block</span>&nbsp;<span class="op" id="3774098">^=</span>&nbsp;<span class="ident" id="3774101">b1</span>&nbsp;<span class="op" id="3774104">^</span>&nbsp;<span class="ident" id="3774106">b1</span><span class="op" id="3774108">&gt;&gt;</span><span class="num" id="3774110">33</span>&nbsp;<span class="op" id="3774113">^</span>&nbsp;<span class="ident" id="3774115">b1</span><span class="op" id="3774117">&lt;&lt;</span><span class="num" id="3774119">33</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774124">//&nbsp;block&nbsp;is&nbsp;the&nbsp;permutation:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774154">//&nbsp;6&nbsp;14&nbsp;22&nbsp;30&nbsp;38&nbsp;46&nbsp;54&nbsp;62</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774181">//&nbsp;4&nbsp;12&nbsp;20&nbsp;28&nbsp;36&nbsp;44&nbsp;52&nbsp;60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774208">//&nbsp;2&nbsp;10&nbsp;18&nbsp;26&nbsp;34&nbsp;42&nbsp;50&nbsp;58</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774235">//&nbsp;0&nbsp;&nbsp;8&nbsp;16&nbsp;24&nbsp;32&nbsp;40&nbsp;48&nbsp;56</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774262">//&nbsp;7&nbsp;15&nbsp;23&nbsp;31&nbsp;39&nbsp;47&nbsp;55&nbsp;63</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774289">//&nbsp;5&nbsp;13&nbsp;21&nbsp;29&nbsp;37&nbsp;45&nbsp;53&nbsp;61</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774316">//&nbsp;3&nbsp;11&nbsp;19&nbsp;27&nbsp;35&nbsp;43&nbsp;51&nbsp;59</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774343">//&nbsp;1&nbsp;&nbsp;9&nbsp;17&nbsp;25&nbsp;33&nbsp;41&nbsp;49&nbsp;57</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774370">return</span>&nbsp;<span class="ident" id="3774377">block</span><br>
<span class="lineno"></span><span class="op" id="3774383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3774386">//&nbsp;permuteInitialBlock&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;permutation&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment" id="3774450">//&nbsp;by&nbsp;finalPermutation.</span><br>
<span class="lineno"></span><span class="keyword" id="3774474">func</span>&nbsp;<span class="ident" id="3774479">permuteFinalBlock</span><span class="op" id="3774496">(</span><span class="ident" id="3774497">block</span>&nbsp;<span class="ident" id="3774503">uint64</span><span class="op" id="3774509">)</span>&nbsp;<span class="ident" id="3774511">uint64</span>&nbsp;<span class="op" id="3774518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774521">//&nbsp;Perform&nbsp;the&nbsp;same&nbsp;bit&nbsp;exchanges&nbsp;as&nbsp;permuteInitialBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774579">//&nbsp;but&nbsp;in&nbsp;reverse&nbsp;order.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774605">b1</span>&nbsp;<span class="op" id="3774608">:=</span>&nbsp;<span class="ident" id="3774611">block</span>&nbsp;<span class="op" id="3774617">&amp;</span>&nbsp;<span class="num" id="3774619">0xaaaaaaaa55555555</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774639">block</span>&nbsp;<span class="op" id="3774645">^=</span>&nbsp;<span class="ident" id="3774648">b1</span>&nbsp;<span class="op" id="3774651">^</span>&nbsp;<span class="ident" id="3774653">b1</span><span class="op" id="3774655">&gt;&gt;</span><span class="num" id="3774657">33</span>&nbsp;<span class="op" id="3774660">^</span>&nbsp;<span class="ident" id="3774662">b1</span><span class="op" id="3774664">&lt;&lt;</span><span class="num" id="3774666">33</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774671">b1</span>&nbsp;<span class="op" id="3774674">=</span>&nbsp;<span class="ident" id="3774676">block</span>&nbsp;<span class="op" id="3774682">&amp;</span>&nbsp;<span class="num" id="3774684">0x3300330033003300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774704">b2</span>&nbsp;<span class="op" id="3774707">:=</span>&nbsp;<span class="ident" id="3774710">block</span>&nbsp;<span class="op" id="3774716">&amp;</span>&nbsp;<span class="num" id="3774718">0x00cc00cc00cc00cc</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774738">block</span>&nbsp;<span class="op" id="3774744">^=</span>&nbsp;<span class="ident" id="3774747">b1</span>&nbsp;<span class="op" id="3774750">^</span>&nbsp;<span class="ident" id="3774752">b2</span>&nbsp;<span class="op" id="3774755">^</span>&nbsp;<span class="ident" id="3774757">b1</span><span class="op" id="3774759">&gt;&gt;</span><span class="num" id="3774761">6</span>&nbsp;<span class="op" id="3774763">^</span>&nbsp;<span class="ident" id="3774765">b2</span><span class="op" id="3774767">&lt;&lt;</span><span class="num" id="3774769">6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774773">b1</span>&nbsp;<span class="op" id="3774776">=</span>&nbsp;<span class="ident" id="3774778">block</span>&nbsp;<span class="op" id="3774784">&amp;</span>&nbsp;<span class="num" id="3774786">0x0f0f00000f0f0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774806">b2</span>&nbsp;<span class="op" id="3774809">=</span>&nbsp;<span class="ident" id="3774811">block</span>&nbsp;<span class="op" id="3774817">&amp;</span>&nbsp;<span class="num" id="3774819">0x0000f0f00000f0f0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774839">block</span>&nbsp;<span class="op" id="3774845">^=</span>&nbsp;<span class="ident" id="3774848">b1</span>&nbsp;<span class="op" id="3774851">^</span>&nbsp;<span class="ident" id="3774853">b2</span>&nbsp;<span class="op" id="3774856">^</span>&nbsp;<span class="ident" id="3774858">b1</span><span class="op" id="3774860">&gt;&gt;</span><span class="num" id="3774862">12</span>&nbsp;<span class="op" id="3774865">^</span>&nbsp;<span class="ident" id="3774867">b2</span><span class="op" id="3774869">&lt;&lt;</span><span class="num" id="3774871">12</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774876">b1</span>&nbsp;<span class="op" id="3774879">=</span>&nbsp;<span class="ident" id="3774881">block</span>&nbsp;<span class="op" id="3774887">&gt;&gt;</span>&nbsp;<span class="num" id="3774890">32</span>&nbsp;<span class="op" id="3774893">&amp;</span>&nbsp;<span class="num" id="3774895">0xff00ff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774905">b2</span>&nbsp;<span class="op" id="3774908">=</span>&nbsp;<span class="op" id="3774910">(</span><span class="ident" id="3774911">block</span>&nbsp;<span class="op" id="3774917">&amp;</span>&nbsp;<span class="num" id="3774919">0xff00ff00</span><span class="op" id="3774929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774932">block</span>&nbsp;<span class="op" id="3774938">^=</span>&nbsp;<span class="ident" id="3774941">b1</span><span class="op" id="3774943">&lt;&lt;</span><span class="num" id="3774945">32</span>&nbsp;<span class="op" id="3774948">^</span>&nbsp;<span class="ident" id="3774950">b2</span>&nbsp;<span class="op" id="3774953">^</span>&nbsp;<span class="ident" id="3774955">b1</span><span class="op" id="3774957">&lt;&lt;</span><span class="num" id="3774959">8</span>&nbsp;<span class="op" id="3774961">^</span>&nbsp;<span class="ident" id="3774963">b2</span><span class="op" id="3774965">&lt;&lt;</span><span class="num" id="3774967">24</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774972">b1</span>&nbsp;<span class="op" id="3774975">=</span>&nbsp;<span class="ident" id="3774977">block</span>&nbsp;<span class="op" id="3774983">&gt;&gt;</span>&nbsp;<span class="num" id="3774986">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774990">b2</span>&nbsp;<span class="op" id="3774993">=</span>&nbsp;<span class="ident" id="3774995">block</span>&nbsp;<span class="op" id="3775001">&lt;&lt;</span>&nbsp;<span class="num" id="3775004">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775008">block</span>&nbsp;<span class="op" id="3775014">^=</span>&nbsp;<span class="ident" id="3775017">b1</span>&nbsp;<span class="op" id="3775020">^</span>&nbsp;<span class="ident" id="3775022">b2</span>&nbsp;<span class="op" id="3775025">^</span>&nbsp;<span class="ident" id="3775027">b1</span><span class="op" id="3775029">&lt;&lt;</span><span class="num" id="3775031">48</span>&nbsp;<span class="op" id="3775034">^</span>&nbsp;<span class="ident" id="3775036">b2</span><span class="op" id="3775038">&gt;&gt;</span><span class="num" id="3775040">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775044">return</span>&nbsp;<span class="ident" id="3775051">block</span><br>
<span class="lineno"></span><span class="op" id="3775057">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="3775060">//&nbsp;creates&nbsp;16&nbsp;28-bit&nbsp;blocks&nbsp;rotated&nbsp;according</span><br>
<span class="lineno"></span><span class="comment" id="3775106">//&nbsp;to&nbsp;the&nbsp;rotation&nbsp;schedule</span><br>
<span class="lineno"></span><span class="keyword" id="3775134">func</span>&nbsp;<span class="ident" id="3775139">ksRotate</span><span class="op" id="3775147">(</span><span class="ident" id="3775148">in</span>&nbsp;<span class="builtintype" id="3775151">uint32</span><span class="op" id="3775157">)</span>&nbsp;<span class="op" id="3775159">(</span><span class="ident" id="3775160">out</span>&nbsp;<span class="op" id="3775164">[</span><span class="op" id="3775165">]</span><span class="builtintype" id="3775166">uint32</span><span class="op" id="3775172">)</span>&nbsp;<span class="op" id="3775174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775177">out</span>&nbsp;<span class="op" id="3775181">=</span>&nbsp;<span class="builtinfunc" id="3775183">make</span><span class="op" id="3775187">(</span><span class="op" id="3775188">[</span><span class="op" id="3775189">]</span><span class="builtintype" id="3775190">uint32</span><span class="op" id="3775196">,</span>&nbsp;<span class="num" id="3775198">16</span><span class="op" id="3775200">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775203">last</span>&nbsp;<span class="op" id="3775208">:=</span>&nbsp;<span class="ident" id="3775211">in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775215">for</span>&nbsp;<span class="ident" id="3775219">i</span>&nbsp;<span class="op" id="3775221">:=</span>&nbsp;<span class="num" id="3775224">0</span><span class="op" id="3775225">;</span>&nbsp;<span class="ident" id="3775227">i</span>&nbsp;<span class="op" id="3775229">&lt;</span>&nbsp;<span class="num" id="3775231">16</span><span class="op" id="3775233">;</span>&nbsp;<span class="ident" id="3775235">i</span><span class="op" id="3775236">++</span>&nbsp;<span class="op" id="3775239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775243">//&nbsp;28-bit&nbsp;circular&nbsp;left&nbsp;shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775275">left</span>&nbsp;<span class="op" id="3775280">:=</span>&nbsp;<span class="op" id="3775283">(</span><span class="ident" id="3775284">last</span>&nbsp;<span class="op" id="3775289">&lt;&lt;</span>&nbsp;<span class="op" id="3775292">(</span><span class="num" id="3775293">4</span>&nbsp;<span class="op" id="3775295">+</span>&nbsp;<span class="ident" id="3775297">ksRotations</span><span class="op" id="3775308">[</span><span class="ident" id="3775309">i</span><span class="op" id="3775310">]</span><span class="op" id="3775311">)</span><span class="op" id="3775312">)</span>&nbsp;<span class="op" id="3775314">&gt;&gt;</span>&nbsp;<span class="num" id="3775317">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775321">right</span>&nbsp;<span class="op" id="3775327">:=</span>&nbsp;<span class="op" id="3775330">(</span><span class="ident" id="3775331">last</span>&nbsp;<span class="op" id="3775336">&lt;&lt;</span>&nbsp;<span class="num" id="3775339">4</span><span class="op" id="3775340">)</span>&nbsp;<span class="op" id="3775342">&gt;&gt;</span>&nbsp;<span class="op" id="3775345">(</span><span class="num" id="3775346">32</span>&nbsp;<span class="op" id="3775349">-</span>&nbsp;<span class="ident" id="3775351">ksRotations</span><span class="op" id="3775362">[</span><span class="ident" id="3775363">i</span><span class="op" id="3775364">]</span><span class="op" id="3775365">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775369">out</span><span class="op" id="3775372">[</span><span class="ident" id="3775373">i</span><span class="op" id="3775374">]</span>&nbsp;<span class="op" id="3775376">=</span>&nbsp;<span class="ident" id="3775378">left</span>&nbsp;<span class="op" id="3775383">|</span>&nbsp;<span class="ident" id="3775385">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775393">last</span>&nbsp;<span class="op" id="3775398">=</span>&nbsp;<span class="ident" id="3775400">out</span><span class="op" id="3775403">[</span><span class="ident" id="3775404">i</span><span class="op" id="3775405">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775411">return</span><br>
<span class="lineno"></span><span class="op" id="3775418">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="3775421">//&nbsp;creates&nbsp;16&nbsp;56-bit&nbsp;subkeys&nbsp;from&nbsp;the&nbsp;original&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword" id="3775472">func</span>&nbsp;<span class="op" id="3775477">(</span><span class="ident" id="3775478">c</span>&nbsp;<span class="op" id="3775480">*</span><span class="ident" id="3775481">desCipher</span><span class="op" id="3775490">)</span>&nbsp;<span class="ident" id="3775492">generateSubkeys</span><span class="op" id="3775507">(</span><span class="ident" id="3775508">keyBytes</span>&nbsp;<span class="op" id="3775517">[</span><span class="op" id="3775518">]</span><span class="builtintype" id="3775519">byte</span><span class="op" id="3775523">)</span>&nbsp;<span class="op" id="3775525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775528">//&nbsp;apply&nbsp;PC1&nbsp;permutation&nbsp;to&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775561">key</span>&nbsp;<span class="op" id="3775565">:=</span>&nbsp;<span class="ident" id="3775568">binary</span><span class="op" id="3775574">.</span><span class="ident" id="3775575">BigEndian</span><span class="op" id="3775584">.</span><span class="ident" id="3775585">Uint64</span><span class="op" id="3775591">(</span><span class="ident" id="3775592">keyBytes</span><span class="op" id="3775600">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775603">permutedKey</span>&nbsp;<span class="op" id="3775615">:=</span>&nbsp;<span class="ident" id="3775618">permuteBlock</span><span class="op" id="3775630">(</span><span class="ident" id="3775631">key</span><span class="op" id="3775634">,</span>&nbsp;<span class="ident" id="3775636">permutedChoice1</span><span class="op" id="3775651">[</span><span class="op" id="3775652">:</span><span class="op" id="3775653">]</span><span class="op" id="3775654">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775658">//&nbsp;rotate&nbsp;halves&nbsp;of&nbsp;permuted&nbsp;key&nbsp;according&nbsp;to&nbsp;the&nbsp;rotation&nbsp;schedule</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775727">leftRotations</span>&nbsp;<span class="op" id="3775741">:=</span>&nbsp;<span class="ident" id="3775744">ksRotate</span><span class="op" id="3775752">(</span><span class="builtintype" id="3775753">uint32</span><span class="op" id="3775759">(</span><span class="ident" id="3775760">permutedKey</span>&nbsp;<span class="op" id="3775772">&gt;&gt;</span>&nbsp;<span class="num" id="3775775">28</span><span class="op" id="3775777">)</span><span class="op" id="3775778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775781">rightRotations</span>&nbsp;<span class="op" id="3775796">:=</span>&nbsp;<span class="ident" id="3775799">ksRotate</span><span class="op" id="3775807">(</span><span class="builtintype" id="3775808">uint32</span><span class="op" id="3775814">(</span><span class="ident" id="3775815">permutedKey</span><span class="op" id="3775826">&lt;&lt;</span><span class="num" id="3775828">4</span><span class="op" id="3775829">)</span>&nbsp;<span class="op" id="3775831">&gt;&gt;</span>&nbsp;<span class="num" id="3775834">4</span><span class="op" id="3775835">)</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775839">//&nbsp;generate&nbsp;subkeys</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775860">for</span>&nbsp;<span class="ident" id="3775864">i</span>&nbsp;<span class="op" id="3775866">:=</span>&nbsp;<span class="num" id="3775869">0</span><span class="op" id="3775870">;</span>&nbsp;<span class="ident" id="3775872">i</span>&nbsp;<span class="op" id="3775874">&lt;</span>&nbsp;<span class="num" id="3775876">16</span><span class="op" id="3775878">;</span>&nbsp;<span class="ident" id="3775880">i</span><span class="op" id="3775881">++</span>&nbsp;<span class="op" id="3775884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775888">//&nbsp;combine&nbsp;halves&nbsp;to&nbsp;form&nbsp;56-bit&nbsp;input&nbsp;to&nbsp;PC2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775936">pc2Input</span>&nbsp;<span class="op" id="3775945">:=</span>&nbsp;<span class="ident" id="3775948">uint64</span><span class="op" id="3775954">(</span><span class="ident" id="3775955">leftRotations</span><span class="op" id="3775968">[</span><span class="ident" id="3775969">i</span><span class="op" id="3775970">]</span><span class="op" id="3775971">)</span><span class="op" id="3775972">&lt;&lt;</span><span class="num" id="3775974">28</span>&nbsp;<span class="op" id="3775977">|</span>&nbsp;<span class="ident" id="3775979">uint64</span><span class="op" id="3775985">(</span><span class="ident" id="3775986">rightRotations</span><span class="op" id="3776000">[</span><span class="ident" id="3776001">i</span><span class="op" id="3776002">]</span><span class="op" id="3776003">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776007">//&nbsp;apply&nbsp;PC2&nbsp;permutation&nbsp;to&nbsp;7&nbsp;byte&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776050">c</span><span class="op" id="3776051">.</span><span class="ident" id="3776052">subkeys</span><span class="op" id="3776059">[</span><span class="ident" id="3776060">i</span><span class="op" id="3776061">]</span>&nbsp;<span class="op" id="3776063">=</span>&nbsp;<span class="ident" id="3776065">permuteBlock</span><span class="op" id="3776077">(</span><span class="ident" id="3776078">pc2Input</span><span class="op" id="3776086">,</span>&nbsp;<span class="ident" id="3776088">permutedChoice2</span><span class="op" id="3776103">[</span><span class="op" id="3776104">:</span><span class="op" id="3776105">]</span><span class="op" id="3776106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776109">}</span><br>
<span class="lineno"></span><span class="op" id="3776111">}</span>
</div>
</body>
</html>
