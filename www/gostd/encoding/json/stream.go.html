<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html" class="current">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2046854">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2046910">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2046964">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2047015">package</span>&nbsp;<span class="ident" id="2047023">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2047029">import</span>&nbsp;<span class="op" id="2047036">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2047039">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2047048">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2047058">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="2047063">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2047066">//&nbsp;A&nbsp;Decoder&nbsp;reads&nbsp;and&nbsp;decodes&nbsp;JSON&nbsp;objects&nbsp;from&nbsp;an&nbsp;input&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="2047132">type</span>&nbsp;<span class="ident" id="2047137">Decoder</span>&nbsp;<span class="keyword" id="2047145">struct</span>&nbsp;<span class="op" id="2047152">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2047155">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2047160">io</span><span class="op" id="2047162">.</span><span class="ident" id="2047163">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2047171">buf</span>&nbsp;&nbsp;<span class="op" id="2047176">[</span><span class="op" id="2047177">]</span><span class="builtintype" id="2047178">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2047184">d</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2047189">decodeState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2047202">scan</span>&nbsp;<span class="ident" id="2047207">scanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2047216">err</span>&nbsp;&nbsp;<span class="builtintype" id="2047221">error</span><br>
<span class="lineno">20</span><span class="op" id="2047227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2047230">//&nbsp;NewDecoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;decoder&nbsp;that&nbsp;reads&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="2047285">//</span><br>
<span class="lineno"></span><span class="comment" id="2047288">//&nbsp;The&nbsp;decoder&nbsp;introduces&nbsp;its&nbsp;own&nbsp;buffering&nbsp;and&nbsp;may</span><br>
<span class="lineno">25</span><span class="comment" id="2047340">//&nbsp;read&nbsp;data&nbsp;from&nbsp;r&nbsp;beyond&nbsp;the&nbsp;JSON&nbsp;values&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="2047394">func</span>&nbsp;<span class="ident" id="2047399">NewDecoder</span><span class="op" id="2047409">(</span><span class="ident" id="2047410">r</span>&nbsp;<span class="ident" id="2047412">io</span><span class="op" id="2047414">.</span><span class="ident" id="2047415">Reader</span><span class="op" id="2047421">)</span>&nbsp;<span class="op" id="2047423">*</span><span class="ident" id="2047424">Decoder</span>&nbsp;<span class="op" id="2047432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2047435">return</span>&nbsp;<span class="op" id="2047442">&amp;</span><span class="ident" id="2047443">Decoder</span><span class="op" id="2047450">{</span><span class="ident" id="2047451">r</span><span class="op" id="2047452">:</span>&nbsp;<span class="ident" id="2047454">r</span><span class="op" id="2047455">}</span><br>
<span class="lineno"></span><span class="op" id="2047457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2047460">//&nbsp;UseNumber&nbsp;causes&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;unmarshal&nbsp;a&nbsp;number&nbsp;into&nbsp;an&nbsp;interface{}&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2047539">//&nbsp;Number&nbsp;instead&nbsp;of&nbsp;as&nbsp;a&nbsp;float64.</span><br>
<span class="lineno"></span><span class="keyword" id="2047574">func</span>&nbsp;<span class="op" id="2047579">(</span><span class="ident" id="2047580">dec</span>&nbsp;<span class="op" id="2047584">*</span><span class="ident" id="2047585">Decoder</span><span class="op" id="2047592">)</span>&nbsp;<span class="ident" id="2047594">UseNumber</span><span class="op" id="2047603">(</span><span class="op" id="2047604">)</span>&nbsp;<span class="op" id="2047606">{</span>&nbsp;<span class="ident" id="2047608">dec</span><span class="op" id="2047611">.</span><span class="ident" id="2047612">d</span><span class="op" id="2047613">.</span><span class="ident" id="2047614">useNumber</span>&nbsp;<span class="op" id="2047624">=</span>&nbsp;<span class="builtintype" id="2047626">true</span>&nbsp;<span class="op" id="2047631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2047634">//&nbsp;Decode&nbsp;reads&nbsp;the&nbsp;next&nbsp;JSON-encoded&nbsp;value&nbsp;from&nbsp;its</span><br>
<span class="lineno">35</span><span class="comment" id="2047687">//&nbsp;input&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to&nbsp;by&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="2047740">//</span><br>
<span class="lineno"></span><span class="comment" id="2047743">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Unmarshal&nbsp;for&nbsp;details&nbsp;about</span><br>
<span class="lineno"></span><span class="comment" id="2047800">//&nbsp;the&nbsp;conversion&nbsp;of&nbsp;JSON&nbsp;into&nbsp;a&nbsp;Go&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="2047843">func</span>&nbsp;<span class="op" id="2047848">(</span><span class="ident" id="2047849">dec</span>&nbsp;<span class="op" id="2047853">*</span><span class="ident" id="2047854">Decoder</span><span class="op" id="2047861">)</span>&nbsp;<span class="ident" id="2047863">Decode</span><span class="op" id="2047869">(</span><span class="ident" id="2047870">v</span>&nbsp;<span class="keyword" id="2047872">interface</span><span class="op" id="2047881">{</span><span class="op" id="2047882">}</span><span class="op" id="2047883">)</span>&nbsp;<span class="builtintype" id="2047885">error</span>&nbsp;<span class="op" id="2047891">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2047894">if</span>&nbsp;<span class="ident" id="2047897">dec</span><span class="op" id="2047900">.</span><span class="ident" id="2047901">err</span>&nbsp;<span class="op" id="2047905">!=</span>&nbsp;<span class="builtintype" id="2047908">nil</span>&nbsp;<span class="op" id="2047912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2047916">return</span>&nbsp;<span class="ident" id="2047923">dec</span><span class="op" id="2047926">.</span><span class="ident" id="2047927">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2047932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2047936">n</span><span class="op" id="2047937">,</span>&nbsp;<span class="ident" id="2047939">err</span>&nbsp;<span class="op" id="2047943">:=</span>&nbsp;<span class="ident" id="2047946">dec</span><span class="op" id="2047949">.</span><span class="ident" id="2047950">readValue</span><span class="op" id="2047959">(</span><span class="op" id="2047960">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2047963">if</span>&nbsp;<span class="ident" id="2047966">err</span>&nbsp;<span class="op" id="2047970">!=</span>&nbsp;<span class="builtintype" id="2047973">nil</span>&nbsp;<span class="op" id="2047977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2047981">return</span>&nbsp;<span class="ident" id="2047988">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2047993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2047997">//&nbsp;Don&#39;t&nbsp;save&nbsp;err&nbsp;from&nbsp;unmarshal&nbsp;into&nbsp;dec.err:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2048045">//&nbsp;the&nbsp;connection&nbsp;is&nbsp;still&nbsp;usable&nbsp;since&nbsp;we&nbsp;read&nbsp;a&nbsp;complete&nbsp;JSON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2048110">//&nbsp;object&nbsp;from&nbsp;it&nbsp;before&nbsp;the&nbsp;error&nbsp;happened.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2048156">dec</span><span class="op" id="2048159">.</span><span class="ident" id="2048160">d</span><span class="op" id="2048161">.</span><span class="ident" id="2048162">init</span><span class="op" id="2048166">(</span><span class="ident" id="2048167">dec</span><span class="op" id="2048170">.</span><span class="ident" id="2048171">buf</span><span class="op" id="2048174">[</span><span class="num" id="2048175">0</span><span class="op" id="2048176">:</span><span class="ident" id="2048177">n</span><span class="op" id="2048178">]</span><span class="op" id="2048179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2048182">err</span>&nbsp;<span class="op" id="2048186">=</span>&nbsp;<span class="ident" id="2048188">dec</span><span class="op" id="2048191">.</span><span class="ident" id="2048192">d</span><span class="op" id="2048193">.</span><span class="ident" id="2048194">unmarshal</span><span class="op" id="2048203">(</span><span class="ident" id="2048204">v</span><span class="op" id="2048205">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2048209">//&nbsp;Slide&nbsp;rest&nbsp;of&nbsp;data&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2048238">rest</span>&nbsp;<span class="op" id="2048243">:=</span>&nbsp;<span class="builtinfunc" id="2048246">copy</span><span class="op" id="2048250">(</span><span class="ident" id="2048251">dec</span><span class="op" id="2048254">.</span><span class="ident" id="2048255">buf</span><span class="op" id="2048258">,</span>&nbsp;<span class="ident" id="2048260">dec</span><span class="op" id="2048263">.</span><span class="ident" id="2048264">buf</span><span class="op" id="2048267">[</span><span class="ident" id="2048268">n</span><span class="op" id="2048269">:</span><span class="op" id="2048270">]</span><span class="op" id="2048271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2048274">dec</span><span class="op" id="2048277">.</span><span class="ident" id="2048278">buf</span>&nbsp;<span class="op" id="2048282">=</span>&nbsp;<span class="ident" id="2048284">dec</span><span class="op" id="2048287">.</span><span class="ident" id="2048288">buf</span><span class="op" id="2048291">[</span><span class="num" id="2048292">0</span><span class="op" id="2048293">:</span><span class="ident" id="2048294">rest</span><span class="op" id="2048298">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2048302">return</span>&nbsp;<span class="ident" id="2048309">err</span><br>
<span class="lineno">60</span><span class="op" id="2048313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2048316">//&nbsp;Buffered&nbsp;returns&nbsp;a&nbsp;reader&nbsp;of&nbsp;the&nbsp;data&nbsp;remaining&nbsp;in&nbsp;the&nbsp;Decoder&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="2048384">//&nbsp;buffer.&nbsp;The&nbsp;reader&nbsp;is&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="keyword" id="2048446">func</span>&nbsp;<span class="op" id="2048451">(</span><span class="ident" id="2048452">dec</span>&nbsp;<span class="op" id="2048456">*</span><span class="ident" id="2048457">Decoder</span><span class="op" id="2048464">)</span>&nbsp;<span class="ident" id="2048466">Buffered</span><span class="op" id="2048474">(</span><span class="op" id="2048475">)</span>&nbsp;<span class="ident" id="2048477">io</span><span class="op" id="2048479">.</span><span class="ident" id="2048480">Reader</span>&nbsp;<span class="op" id="2048487">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2048490">return</span>&nbsp;<span class="ident" id="2048497">bytes</span><span class="op" id="2048502">.</span><span class="ident" id="2048503">NewReader</span><span class="op" id="2048512">(</span><span class="ident" id="2048513">dec</span><span class="op" id="2048516">.</span><span class="ident" id="2048517">buf</span><span class="op" id="2048520">)</span><br>
<span class="lineno"></span><span class="op" id="2048522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2048525">//&nbsp;readValue&nbsp;reads&nbsp;a&nbsp;JSON&nbsp;value&nbsp;into&nbsp;dec.buf.</span><br>
<span class="lineno"></span><span class="comment" id="2048571">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno">70</span><span class="keyword" id="2048613">func</span>&nbsp;<span class="op" id="2048618">(</span><span class="ident" id="2048619">dec</span>&nbsp;<span class="op" id="2048623">*</span><span class="ident" id="2048624">Decoder</span><span class="op" id="2048631">)</span>&nbsp;<span class="ident" id="2048633">readValue</span><span class="op" id="2048642">(</span><span class="op" id="2048643">)</span>&nbsp;<span class="op" id="2048645">(</span><span class="builtintype" id="2048646">int</span><span class="op" id="2048649">,</span>&nbsp;<span class="builtintype" id="2048651">error</span><span class="op" id="2048656">)</span>&nbsp;<span class="op" id="2048658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2048661">dec</span><span class="op" id="2048664">.</span><span class="ident" id="2048665">scan</span><span class="op" id="2048669">.</span><span class="ident" id="2048670">reset</span><span class="op" id="2048675">(</span><span class="op" id="2048676">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2048680">scanp</span>&nbsp;<span class="op" id="2048686">:=</span>&nbsp;<span class="num" id="2048689">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2048692">var</span>&nbsp;<span class="ident" id="2048696">err</span>&nbsp;<span class="builtintype" id="2048700">error</span><br>
<span class="lineno">75</span><span class="ident" id="2048706">Input</span><span class="op" id="2048711">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2048714">for</span>&nbsp;<span class="op" id="2048718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2048722">//&nbsp;Look&nbsp;in&nbsp;the&nbsp;buffer&nbsp;for&nbsp;a&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2048763">for</span>&nbsp;<span class="ident" id="2048767">i</span><span class="op" id="2048768">,</span>&nbsp;<span class="ident" id="2048770">c</span>&nbsp;<span class="op" id="2048772">:=</span>&nbsp;<span class="keyword" id="2048775">range</span>&nbsp;<span class="ident" id="2048781">dec</span><span class="op" id="2048784">.</span><span class="ident" id="2048785">buf</span><span class="op" id="2048788">[</span><span class="ident" id="2048789">scanp</span><span class="op" id="2048794">:</span><span class="op" id="2048795">]</span>&nbsp;<span class="op" id="2048797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2048802">dec</span><span class="op" id="2048805">.</span><span class="ident" id="2048806">scan</span><span class="op" id="2048810">.</span><span class="ident" id="2048811">bytes</span><span class="op" id="2048816">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2048822">v</span>&nbsp;<span class="op" id="2048824">:=</span>&nbsp;<span class="ident" id="2048827">dec</span><span class="op" id="2048830">.</span><span class="ident" id="2048831">scan</span><span class="op" id="2048835">.</span><span class="ident" id="2048836">step</span><span class="op" id="2048840">(</span><span class="op" id="2048841">&amp;</span><span class="ident" id="2048842">dec</span><span class="op" id="2048845">.</span><span class="ident" id="2048846">scan</span><span class="op" id="2048850">,</span>&nbsp;<span class="builtintype" id="2048852">int</span><span class="op" id="2048855">(</span><span class="ident" id="2048856">c</span><span class="op" id="2048857">)</span><span class="op" id="2048858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2048863">if</span>&nbsp;<span class="ident" id="2048866">v</span>&nbsp;<span class="op" id="2048868">==</span>&nbsp;<span class="ident" id="2048871">scanEnd</span>&nbsp;<span class="op" id="2048879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2048885">scanp</span>&nbsp;<span class="op" id="2048891">+=</span>&nbsp;<span class="ident" id="2048894">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2048900">break</span>&nbsp;<span class="ident" id="2048906">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2048915">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2048920">//&nbsp;scanEnd&nbsp;is&nbsp;delayed&nbsp;one&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2048955">//&nbsp;We&nbsp;might&nbsp;block&nbsp;trying&nbsp;to&nbsp;get&nbsp;that&nbsp;byte&nbsp;from&nbsp;src,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2049010">//&nbsp;so&nbsp;instead&nbsp;invent&nbsp;a&nbsp;space&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2049048">if</span>&nbsp;<span class="op" id="2049051">(</span><span class="ident" id="2049052">v</span>&nbsp;<span class="op" id="2049054">==</span>&nbsp;<span class="ident" id="2049057">scanEndObject</span>&nbsp;<span class="op" id="2049071">||</span>&nbsp;<span class="ident" id="2049074">v</span>&nbsp;<span class="op" id="2049076">==</span>&nbsp;<span class="ident" id="2049079">scanEndArray</span><span class="op" id="2049091">)</span>&nbsp;<span class="op" id="2049093">&amp;&amp;</span>&nbsp;<span class="ident" id="2049096">dec</span><span class="op" id="2049099">.</span><span class="ident" id="2049100">scan</span><span class="op" id="2049104">.</span><span class="ident" id="2049105">step</span><span class="op" id="2049109">(</span><span class="op" id="2049110">&amp;</span><span class="ident" id="2049111">dec</span><span class="op" id="2049114">.</span><span class="ident" id="2049115">scan</span><span class="op" id="2049119">,</span>&nbsp;<span class="string" id="2049121">&#39;&nbsp;&#39;</span><span class="op" id="2049124">)</span>&nbsp;<span class="op" id="2049126">==</span>&nbsp;<span class="ident" id="2049129">scanEnd</span>&nbsp;<span class="op" id="2049137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2049143">scanp</span>&nbsp;<span class="op" id="2049149">+=</span>&nbsp;<span class="ident" id="2049152">i</span>&nbsp;<span class="op" id="2049154">+</span>&nbsp;<span class="num" id="2049156">1</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2049162">break</span>&nbsp;<span class="ident" id="2049168">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2049177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2049182">if</span>&nbsp;<span class="ident" id="2049185">v</span>&nbsp;<span class="op" id="2049187">==</span>&nbsp;<span class="ident" id="2049190">scanError</span>&nbsp;<span class="op" id="2049200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2049206">dec</span><span class="op" id="2049209">.</span><span class="ident" id="2049210">err</span>&nbsp;<span class="op" id="2049214">=</span>&nbsp;<span class="ident" id="2049216">dec</span><span class="op" id="2049219">.</span><span class="ident" id="2049220">scan</span><span class="op" id="2049224">.</span><span class="ident" id="2049225">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2049233">return</span>&nbsp;<span class="num" id="2049240">0</span><span class="op" id="2049241">,</span>&nbsp;<span class="ident" id="2049243">dec</span><span class="op" id="2049246">.</span><span class="ident" id="2049247">scan</span><span class="op" id="2049251">.</span><span class="ident" id="2049252">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2049259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2049263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2049267">scanp</span>&nbsp;<span class="op" id="2049273">=</span>&nbsp;<span class="builtinfunc" id="2049275">len</span><span class="op" id="2049278">(</span><span class="ident" id="2049279">dec</span><span class="op" id="2049282">.</span><span class="ident" id="2049283">buf</span><span class="op" id="2049286">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2049291">//&nbsp;Did&nbsp;the&nbsp;last&nbsp;read&nbsp;have&nbsp;an&nbsp;error?</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2049329">//&nbsp;Delayed&nbsp;until&nbsp;now&nbsp;to&nbsp;allow&nbsp;buffer&nbsp;scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2049374">if</span>&nbsp;<span class="ident" id="2049377">err</span>&nbsp;<span class="op" id="2049381">!=</span>&nbsp;<span class="builtintype" id="2049384">nil</span>&nbsp;<span class="op" id="2049388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2049393">if</span>&nbsp;<span class="ident" id="2049396">err</span>&nbsp;<span class="op" id="2049400">==</span>&nbsp;<span class="ident" id="2049403">io</span><span class="op" id="2049405">.</span><span class="ident" id="2049406">EOF</span>&nbsp;<span class="op" id="2049410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2049416">if</span>&nbsp;<span class="ident" id="2049419">dec</span><span class="op" id="2049422">.</span><span class="ident" id="2049423">scan</span><span class="op" id="2049427">.</span><span class="ident" id="2049428">step</span><span class="op" id="2049432">(</span><span class="op" id="2049433">&amp;</span><span class="ident" id="2049434">dec</span><span class="op" id="2049437">.</span><span class="ident" id="2049438">scan</span><span class="op" id="2049442">,</span>&nbsp;<span class="string" id="2049444">&#39;&nbsp;&#39;</span><span class="op" id="2049447">)</span>&nbsp;<span class="op" id="2049449">==</span>&nbsp;<span class="ident" id="2049452">scanEnd</span>&nbsp;<span class="op" id="2049460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2049467">break</span>&nbsp;<span class="ident" id="2049473">Input</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2049483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2049489">if</span>&nbsp;<span class="ident" id="2049492">nonSpace</span><span class="op" id="2049500">(</span><span class="ident" id="2049501">dec</span><span class="op" id="2049504">.</span><span class="ident" id="2049505">buf</span><span class="op" id="2049508">)</span>&nbsp;<span class="op" id="2049510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2049517">err</span>&nbsp;<span class="op" id="2049521">=</span>&nbsp;<span class="ident" id="2049523">io</span><span class="op" id="2049525">.</span><span class="ident" id="2049526">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2049547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2049552">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2049557">dec</span><span class="op" id="2049560">.</span><span class="ident" id="2049561">err</span>&nbsp;<span class="op" id="2049565">=</span>&nbsp;<span class="ident" id="2049567">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2049574">return</span>&nbsp;<span class="num" id="2049581">0</span><span class="op" id="2049582">,</span>&nbsp;<span class="ident" id="2049584">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2049590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2049595">//&nbsp;Make&nbsp;room&nbsp;to&nbsp;read&nbsp;more&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2049640">const</span>&nbsp;<span class="ident" id="2049646">minRead</span>&nbsp;<span class="op" id="2049654">=</span>&nbsp;<span class="num" id="2049656">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2049662">if</span>&nbsp;<span class="builtinfunc" id="2049665">cap</span><span class="op" id="2049668">(</span><span class="ident" id="2049669">dec</span><span class="op" id="2049672">.</span><span class="ident" id="2049673">buf</span><span class="op" id="2049676">)</span><span class="op" id="2049677">-</span><span class="builtinfunc" id="2049678">len</span><span class="op" id="2049681">(</span><span class="ident" id="2049682">dec</span><span class="op" id="2049685">.</span><span class="ident" id="2049686">buf</span><span class="op" id="2049689">)</span>&nbsp;<span class="op" id="2049691">&lt;</span>&nbsp;<span class="ident" id="2049693">minRead</span>&nbsp;<span class="op" id="2049701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2049706">newBuf</span>&nbsp;<span class="op" id="2049713">:=</span>&nbsp;<span class="builtinfunc" id="2049716">make</span><span class="op" id="2049720">(</span><span class="op" id="2049721">[</span><span class="op" id="2049722">]</span><span class="builtintype" id="2049723">byte</span><span class="op" id="2049727">,</span>&nbsp;<span class="builtinfunc" id="2049729">len</span><span class="op" id="2049732">(</span><span class="ident" id="2049733">dec</span><span class="op" id="2049736">.</span><span class="ident" id="2049737">buf</span><span class="op" id="2049740">)</span><span class="op" id="2049741">,</span>&nbsp;<span class="num" id="2049743">2</span><span class="op" id="2049744">*</span><span class="builtinfunc" id="2049745">cap</span><span class="op" id="2049748">(</span><span class="ident" id="2049749">dec</span><span class="op" id="2049752">.</span><span class="ident" id="2049753">buf</span><span class="op" id="2049756">)</span><span class="op" id="2049757">+</span><span class="ident" id="2049758">minRead</span><span class="op" id="2049765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2049770">copy</span><span class="op" id="2049774">(</span><span class="ident" id="2049775">newBuf</span><span class="op" id="2049781">,</span>&nbsp;<span class="ident" id="2049783">dec</span><span class="op" id="2049786">.</span><span class="ident" id="2049787">buf</span><span class="op" id="2049790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2049795">dec</span><span class="op" id="2049798">.</span><span class="ident" id="2049799">buf</span>&nbsp;<span class="op" id="2049803">=</span>&nbsp;<span class="ident" id="2049805">newBuf</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2049814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2049819">//&nbsp;Read.&nbsp;&nbsp;Delay&nbsp;error&nbsp;for&nbsp;next&nbsp;iteration&nbsp;(after&nbsp;scan).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2049876">var</span>&nbsp;<span class="ident" id="2049880">n</span>&nbsp;<span class="builtintype" id="2049882">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2049888">n</span><span class="op" id="2049889">,</span>&nbsp;<span class="ident" id="2049891">err</span>&nbsp;<span class="op" id="2049895">=</span>&nbsp;<span class="ident" id="2049897">dec</span><span class="op" id="2049900">.</span><span class="ident" id="2049901">r</span><span class="op" id="2049902">.</span><span class="ident" id="2049903">Read</span><span class="op" id="2049907">(</span><span class="ident" id="2049908">dec</span><span class="op" id="2049911">.</span><span class="ident" id="2049912">buf</span><span class="op" id="2049915">[</span><span class="builtinfunc" id="2049916">len</span><span class="op" id="2049919">(</span><span class="ident" id="2049920">dec</span><span class="op" id="2049923">.</span><span class="ident" id="2049924">buf</span><span class="op" id="2049927">)</span><span class="op" id="2049928">:</span><span class="builtinfunc" id="2049929">cap</span><span class="op" id="2049932">(</span><span class="ident" id="2049933">dec</span><span class="op" id="2049936">.</span><span class="ident" id="2049937">buf</span><span class="op" id="2049940">)</span><span class="op" id="2049941">]</span><span class="op" id="2049942">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2049946">dec</span><span class="op" id="2049949">.</span><span class="ident" id="2049950">buf</span>&nbsp;<span class="op" id="2049954">=</span>&nbsp;<span class="ident" id="2049956">dec</span><span class="op" id="2049959">.</span><span class="ident" id="2049960">buf</span><span class="op" id="2049963">[</span><span class="num" id="2049964">0</span>&nbsp;<span class="op" id="2049966">:</span>&nbsp;<span class="builtinfunc" id="2049968">len</span><span class="op" id="2049971">(</span><span class="ident" id="2049972">dec</span><span class="op" id="2049975">.</span><span class="ident" id="2049976">buf</span><span class="op" id="2049979">)</span><span class="op" id="2049980">+</span><span class="ident" id="2049981">n</span><span class="op" id="2049982">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2049985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2049988">return</span>&nbsp;<span class="ident" id="2049995">scanp</span><span class="op" id="2050000">,</span>&nbsp;<span class="builtintype" id="2050002">nil</span><br>
<span class="lineno"></span><span class="op" id="2050006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2050009">func</span>&nbsp;<span class="ident" id="2050014">nonSpace</span><span class="op" id="2050022">(</span><span class="ident" id="2050023">b</span>&nbsp;<span class="op" id="2050025">[</span><span class="op" id="2050026">]</span><span class="builtintype" id="2050027">byte</span><span class="op" id="2050031">)</span>&nbsp;<span class="builtintype" id="2050033">bool</span>&nbsp;<span class="op" id="2050038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2050041">for</span>&nbsp;<span class="ident" id="2050045">_</span><span class="op" id="2050046">,</span>&nbsp;<span class="ident" id="2050048">c</span>&nbsp;<span class="op" id="2050050">:=</span>&nbsp;<span class="keyword" id="2050053">range</span>&nbsp;<span class="ident" id="2050059">b</span>&nbsp;<span class="op" id="2050061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2050065">if</span>&nbsp;<span class="op" id="2050068">!</span><span class="ident" id="2050069">isSpace</span><span class="op" id="2050076">(</span><span class="builtintype" id="2050077">rune</span><span class="op" id="2050081">(</span><span class="ident" id="2050082">c</span><span class="op" id="2050083">)</span><span class="op" id="2050084">)</span>&nbsp;<span class="op" id="2050086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2050091">return</span>&nbsp;<span class="builtintype" id="2050098">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2050105">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2050108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2050111">return</span>&nbsp;<span class="builtintype" id="2050118">false</span><br>
<span class="lineno"></span><span class="op" id="2050124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2050127">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;JSON&nbsp;objects&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">140</span><span class="keyword" id="2050182">type</span>&nbsp;<span class="ident" id="2050187">Encoder</span>&nbsp;<span class="keyword" id="2050195">struct</span>&nbsp;<span class="op" id="2050202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2050205">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2050209">io</span><span class="op" id="2050211">.</span><span class="ident" id="2050212">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2050220">err</span>&nbsp;<span class="builtintype" id="2050224">error</span><br>
<span class="lineno"></span><span class="op" id="2050230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="2050233">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="2050287">func</span>&nbsp;<span class="ident" id="2050292">NewEncoder</span><span class="op" id="2050302">(</span><span class="ident" id="2050303">w</span>&nbsp;<span class="ident" id="2050305">io</span><span class="op" id="2050307">.</span><span class="ident" id="2050308">Writer</span><span class="op" id="2050314">)</span>&nbsp;<span class="op" id="2050316">*</span><span class="ident" id="2050317">Encoder</span>&nbsp;<span class="op" id="2050325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2050328">return</span>&nbsp;<span class="op" id="2050335">&amp;</span><span class="ident" id="2050336">Encoder</span><span class="op" id="2050343">{</span><span class="ident" id="2050344">w</span><span class="op" id="2050345">:</span>&nbsp;<span class="ident" id="2050347">w</span><span class="op" id="2050348">}</span><br>
<span class="lineno"></span><span class="op" id="2050350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="2050353">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="2050408">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="2050444">//</span><br>
<span class="lineno"></span><span class="comment" id="2050447">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2050506">//&nbsp;conversion&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;JSON.</span><br>
<span class="lineno">155</span><span class="keyword" id="2050542">func</span>&nbsp;<span class="op" id="2050547">(</span><span class="ident" id="2050548">enc</span>&nbsp;<span class="op" id="2050552">*</span><span class="ident" id="2050553">Encoder</span><span class="op" id="2050560">)</span>&nbsp;<span class="ident" id="2050562">Encode</span><span class="op" id="2050568">(</span><span class="ident" id="2050569">v</span>&nbsp;<span class="keyword" id="2050571">interface</span><span class="op" id="2050580">{</span><span class="op" id="2050581">}</span><span class="op" id="2050582">)</span>&nbsp;<span class="builtintype" id="2050584">error</span>&nbsp;<span class="op" id="2050590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2050593">if</span>&nbsp;<span class="ident" id="2050596">enc</span><span class="op" id="2050599">.</span><span class="ident" id="2050600">err</span>&nbsp;<span class="op" id="2050604">!=</span>&nbsp;<span class="builtintype" id="2050607">nil</span>&nbsp;<span class="op" id="2050611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2050615">return</span>&nbsp;<span class="ident" id="2050622">enc</span><span class="op" id="2050625">.</span><span class="ident" id="2050626">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2050631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2050634">e</span>&nbsp;<span class="op" id="2050636">:=</span>&nbsp;<span class="ident" id="2050639">newEncodeState</span><span class="op" id="2050653">(</span><span class="op" id="2050654">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2050657">err</span>&nbsp;<span class="op" id="2050661">:=</span>&nbsp;<span class="ident" id="2050664">e</span><span class="op" id="2050665">.</span><span class="ident" id="2050666">marshal</span><span class="op" id="2050673">(</span><span class="ident" id="2050674">v</span><span class="op" id="2050675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2050678">if</span>&nbsp;<span class="ident" id="2050681">err</span>&nbsp;<span class="op" id="2050685">!=</span>&nbsp;<span class="builtintype" id="2050688">nil</span>&nbsp;<span class="op" id="2050692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2050696">return</span>&nbsp;<span class="ident" id="2050703">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2050708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2050712">//&nbsp;Terminate&nbsp;each&nbsp;value&nbsp;with&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2050753">//&nbsp;This&nbsp;makes&nbsp;the&nbsp;output&nbsp;look&nbsp;a&nbsp;little&nbsp;nicer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2050799">//&nbsp;when&nbsp;debugging,&nbsp;and&nbsp;some&nbsp;kind&nbsp;of&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2050842">//&nbsp;is&nbsp;required&nbsp;if&nbsp;the&nbsp;encoded&nbsp;value&nbsp;was&nbsp;a&nbsp;number,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2050893">//&nbsp;so&nbsp;that&nbsp;the&nbsp;reader&nbsp;knows&nbsp;there&nbsp;aren&#39;t&nbsp;more</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2050940">//&nbsp;digits&nbsp;coming.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2050959">e</span><span class="op" id="2050960">.</span><span class="ident" id="2050961">WriteByte</span><span class="op" id="2050970">(</span><span class="string" id="2050971">&#39;\n&#39;</span><span class="op" id="2050975">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2050979">if</span>&nbsp;<span class="ident" id="2050982">_</span><span class="op" id="2050983">,</span>&nbsp;<span class="ident" id="2050985">err</span>&nbsp;<span class="op" id="2050989">=</span>&nbsp;<span class="ident" id="2050991">enc</span><span class="op" id="2050994">.</span><span class="ident" id="2050995">w</span><span class="op" id="2050996">.</span><span class="ident" id="2050997">Write</span><span class="op" id="2051002">(</span><span class="ident" id="2051003">e</span><span class="op" id="2051004">.</span><span class="ident" id="2051005">Bytes</span><span class="op" id="2051010">(</span><span class="op" id="2051011">)</span><span class="op" id="2051012">)</span><span class="op" id="2051013">;</span>&nbsp;<span class="ident" id="2051015">err</span>&nbsp;<span class="op" id="2051019">!=</span>&nbsp;<span class="builtintype" id="2051022">nil</span>&nbsp;<span class="op" id="2051026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2051030">enc</span><span class="op" id="2051033">.</span><span class="ident" id="2051034">err</span>&nbsp;<span class="op" id="2051038">=</span>&nbsp;<span class="ident" id="2051040">err</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2051045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2051048">encodeStatePool</span><span class="op" id="2051063">.</span><span class="ident" id="2051064">Put</span><span class="op" id="2051067">(</span><span class="ident" id="2051068">e</span><span class="op" id="2051069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2051072">return</span>&nbsp;<span class="ident" id="2051079">err</span><br>
<span class="lineno"></span><span class="op" id="2051083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="2051086">//&nbsp;RawMessage&nbsp;is&nbsp;a&nbsp;raw&nbsp;encoded&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="2051130">//&nbsp;It&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;and&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="2051181">//&nbsp;be&nbsp;used&nbsp;to&nbsp;delay&nbsp;JSON&nbsp;decoding&nbsp;or&nbsp;precompute&nbsp;a&nbsp;JSON&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="2051246">type</span>&nbsp;<span class="ident" id="2051251">RawMessage</span>&nbsp;<span class="op" id="2051262">[</span><span class="op" id="2051263">]</span><span class="builtintype" id="2051264">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="2051270">//&nbsp;MarshalJSON&nbsp;returns&nbsp;*m&nbsp;as&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;m.</span><br>
<span class="lineno"></span><span class="keyword" id="2051323">func</span>&nbsp;<span class="op" id="2051328">(</span><span class="ident" id="2051329">m</span>&nbsp;<span class="op" id="2051331">*</span><span class="ident" id="2051332">RawMessage</span><span class="op" id="2051342">)</span>&nbsp;<span class="ident" id="2051344">MarshalJSON</span><span class="op" id="2051355">(</span><span class="op" id="2051356">)</span>&nbsp;<span class="op" id="2051358">(</span><span class="op" id="2051359">[</span><span class="op" id="2051360">]</span><span class="builtintype" id="2051361">byte</span><span class="op" id="2051365">,</span>&nbsp;<span class="builtintype" id="2051367">error</span><span class="op" id="2051372">)</span>&nbsp;<span class="op" id="2051374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2051377">return</span>&nbsp;<span class="op" id="2051384">*</span><span class="ident" id="2051385">m</span><span class="op" id="2051386">,</span>&nbsp;<span class="builtintype" id="2051388">nil</span><br>
<span class="lineno"></span><span class="op" id="2051392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="2051395">//&nbsp;UnmarshalJSON&nbsp;sets&nbsp;*m&nbsp;to&nbsp;a&nbsp;copy&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="2051439">func</span>&nbsp;<span class="op" id="2051444">(</span><span class="ident" id="2051445">m</span>&nbsp;<span class="op" id="2051447">*</span><span class="ident" id="2051448">RawMessage</span><span class="op" id="2051458">)</span>&nbsp;<span class="ident" id="2051460">UnmarshalJSON</span><span class="op" id="2051473">(</span><span class="ident" id="2051474">data</span>&nbsp;<span class="op" id="2051479">[</span><span class="op" id="2051480">]</span><span class="builtintype" id="2051481">byte</span><span class="op" id="2051485">)</span>&nbsp;<span class="builtintype" id="2051487">error</span>&nbsp;<span class="op" id="2051493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2051496">if</span>&nbsp;<span class="ident" id="2051499">m</span>&nbsp;<span class="op" id="2051501">==</span>&nbsp;<span class="builtintype" id="2051504">nil</span>&nbsp;<span class="op" id="2051508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2051512">return</span>&nbsp;<span class="ident" id="2051519">errors</span><span class="op" id="2051525">.</span><span class="ident" id="2051526">New</span><span class="op" id="2051529">(</span><span class="string" id="2051530">&#34;json.RawMessage:&nbsp;UnmarshalJSON&nbsp;on&nbsp;nil&nbsp;pointer&#34;</span><span class="op" id="2051577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2051580">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2051583">*</span><span class="ident" id="2051584">m</span>&nbsp;<span class="op" id="2051586">=</span>&nbsp;<span class="builtinfunc" id="2051588">append</span><span class="op" id="2051594">(</span><span class="op" id="2051595">(</span><span class="op" id="2051596">*</span><span class="ident" id="2051597">m</span><span class="op" id="2051598">)</span><span class="op" id="2051599">[</span><span class="num" id="2051600">0</span><span class="op" id="2051601">:</span><span class="num" id="2051602">0</span><span class="op" id="2051603">]</span><span class="op" id="2051604">,</span>&nbsp;<span class="ident" id="2051606">data</span><span class="op" id="2051610">...</span><span class="op" id="2051613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2051616">return</span>&nbsp;<span class="builtintype" id="2051623">nil</span><br>
<span class="lineno"></span><span class="op" id="2051627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2051630">var</span>&nbsp;<span class="ident" id="2051634">_</span>&nbsp;<span class="ident" id="2051636">Marshaler</span>&nbsp;<span class="op" id="2051646">=</span>&nbsp;<span class="op" id="2051648">(</span><span class="op" id="2051649">*</span><span class="ident" id="2051650">RawMessage</span><span class="op" id="2051660">)</span><span class="op" id="2051661">(</span><span class="builtintype" id="2051662">nil</span><span class="op" id="2051665">)</span><br>
<span class="lineno">200</span><span class="keyword" id="2051667">var</span>&nbsp;<span class="ident" id="2051671">_</span>&nbsp;<span class="ident" id="2051673">Unmarshaler</span>&nbsp;<span class="op" id="2051685">=</span>&nbsp;<span class="op" id="2051687">(</span><span class="op" id="2051688">*</span><span class="ident" id="2051689">RawMessage</span><span class="op" id="2051699">)</span><span class="op" id="2051700">(</span><span class="builtintype" id="2051701">nil</span><span class="op" id="2051704">)</span>
</div>
</body>
</html>
