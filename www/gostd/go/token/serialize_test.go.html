<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7181731">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7181786">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7181840">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7181891">package</span>&nbsp;<span class="ident" id="7181899">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7181906">import</span>&nbsp;<span class="op" id="7181913">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7181916">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7181925">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7181941">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7181948">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7181958">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7181961">//&nbsp;equal&nbsp;returns&nbsp;nil&nbsp;if&nbsp;p&nbsp;and&nbsp;q&nbsp;describe&nbsp;the&nbsp;same&nbsp;file&nbsp;set;</span><br>
<span class="lineno">15</span><span class="comment" id="7182021">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;discrepancy.</span><br>
<span class="lineno"></span><span class="keyword" id="7182082">func</span>&nbsp;<span class="ident" id="7182087">equal</span><span class="op" id="7182092">(</span><span class="ident" id="7182093">p</span><span class="op" id="7182094">,</span>&nbsp;<span class="ident" id="7182096">q</span>&nbsp;<span class="op" id="7182098">*</span><span class="ident" id="7182099">FileSet</span><span class="op" id="7182106">)</span>&nbsp;<span class="builtintype" id="7182108">error</span>&nbsp;<span class="op" id="7182114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182117">if</span>&nbsp;<span class="ident" id="7182120">p</span>&nbsp;<span class="op" id="7182122">==</span>&nbsp;<span class="ident" id="7182125">q</span>&nbsp;<span class="op" id="7182127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7182131">//&nbsp;avoid&nbsp;deadlock&nbsp;if&nbsp;p&nbsp;==&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182161">return</span>&nbsp;<span class="ident" id="7182168">nil</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7182177">//&nbsp;not&nbsp;strictly&nbsp;needed&nbsp;for&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182214">p</span><span class="op" id="7182215">.</span><span class="ident" id="7182216">mutex</span><span class="op" id="7182221">.</span><span class="ident" id="7182222">Lock</span><span class="op" id="7182226">(</span><span class="op" id="7182227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182230">q</span><span class="op" id="7182231">.</span><span class="ident" id="7182232">mutex</span><span class="op" id="7182237">.</span><span class="ident" id="7182238">Lock</span><span class="op" id="7182242">(</span><span class="op" id="7182243">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182246">defer</span>&nbsp;<span class="ident" id="7182252">q</span><span class="op" id="7182253">.</span><span class="ident" id="7182254">mutex</span><span class="op" id="7182259">.</span><span class="ident" id="7182260">Unlock</span><span class="op" id="7182266">(</span><span class="op" id="7182267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182270">defer</span>&nbsp;<span class="ident" id="7182276">p</span><span class="op" id="7182277">.</span><span class="ident" id="7182278">mutex</span><span class="op" id="7182283">.</span><span class="ident" id="7182284">Unlock</span><span class="op" id="7182290">(</span><span class="op" id="7182291">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182295">if</span>&nbsp;<span class="ident" id="7182298">p</span><span class="op" id="7182299">.</span><span class="ident" id="7182300">base</span>&nbsp;<span class="op" id="7182305">!=</span>&nbsp;<span class="ident" id="7182308">q</span><span class="op" id="7182309">.</span><span class="ident" id="7182310">base</span>&nbsp;<span class="op" id="7182315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182319">return</span>&nbsp;<span class="ident" id="7182326">fmt</span><span class="op" id="7182329">.</span><span class="ident" id="7182330">Errorf</span><span class="op" id="7182336">(</span><span class="string" id="7182337">&#34;different&nbsp;bases:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7182364">,</span>&nbsp;<span class="ident" id="7182366">p</span><span class="op" id="7182367">.</span><span class="ident" id="7182368">base</span><span class="op" id="7182372">,</span>&nbsp;<span class="ident" id="7182374">q</span><span class="op" id="7182375">.</span><span class="ident" id="7182376">base</span><span class="op" id="7182380">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182387">if</span>&nbsp;<span class="builtinfunc" id="7182390">len</span><span class="op" id="7182393">(</span><span class="ident" id="7182394">p</span><span class="op" id="7182395">.</span><span class="ident" id="7182396">files</span><span class="op" id="7182401">)</span>&nbsp;<span class="op" id="7182403">!=</span>&nbsp;<span class="builtinfunc" id="7182406">len</span><span class="op" id="7182409">(</span><span class="ident" id="7182410">q</span><span class="op" id="7182411">.</span><span class="ident" id="7182412">files</span><span class="op" id="7182417">)</span>&nbsp;<span class="op" id="7182419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182423">return</span>&nbsp;<span class="ident" id="7182430">fmt</span><span class="op" id="7182433">.</span><span class="ident" id="7182434">Errorf</span><span class="op" id="7182440">(</span><span class="string" id="7182441">&#34;different&nbsp;number&nbsp;of&nbsp;files:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7182478">,</span>&nbsp;<span class="builtinfunc" id="7182480">len</span><span class="op" id="7182483">(</span><span class="ident" id="7182484">p</span><span class="op" id="7182485">.</span><span class="ident" id="7182486">files</span><span class="op" id="7182491">)</span><span class="op" id="7182492">,</span>&nbsp;<span class="builtinfunc" id="7182494">len</span><span class="op" id="7182497">(</span><span class="ident" id="7182498">q</span><span class="op" id="7182499">.</span><span class="ident" id="7182500">files</span><span class="op" id="7182505">)</span><span class="op" id="7182506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182509">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182513">for</span>&nbsp;<span class="ident" id="7182517">i</span><span class="op" id="7182518">,</span>&nbsp;<span class="ident" id="7182520">f</span>&nbsp;<span class="op" id="7182522">:=</span>&nbsp;<span class="keyword" id="7182525">range</span>&nbsp;<span class="ident" id="7182531">p</span><span class="op" id="7182532">.</span><span class="ident" id="7182533">files</span>&nbsp;<span class="op" id="7182539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7182543">g</span>&nbsp;<span class="op" id="7182545">:=</span>&nbsp;<span class="ident" id="7182548">q</span><span class="op" id="7182549">.</span><span class="ident" id="7182550">files</span><span class="op" id="7182555">[</span><span class="ident" id="7182556">i</span><span class="op" id="7182557">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182561">if</span>&nbsp;<span class="ident" id="7182564">f</span><span class="op" id="7182565">.</span><span class="ident" id="7182566">set</span>&nbsp;<span class="op" id="7182570">!=</span>&nbsp;<span class="ident" id="7182573">p</span>&nbsp;<span class="op" id="7182575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182580">return</span>&nbsp;<span class="ident" id="7182587">fmt</span><span class="op" id="7182590">.</span><span class="ident" id="7182591">Errorf</span><span class="op" id="7182597">(</span><span class="string" id="7182598">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7182620">,</span>&nbsp;<span class="ident" id="7182622">f</span><span class="op" id="7182623">.</span><span class="ident" id="7182624">name</span><span class="op" id="7182628">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182636">if</span>&nbsp;<span class="ident" id="7182639">g</span><span class="op" id="7182640">.</span><span class="ident" id="7182641">set</span>&nbsp;<span class="op" id="7182645">!=</span>&nbsp;<span class="ident" id="7182648">q</span>&nbsp;<span class="op" id="7182650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182655">return</span>&nbsp;<span class="ident" id="7182662">fmt</span><span class="op" id="7182665">.</span><span class="ident" id="7182666">Errorf</span><span class="op" id="7182672">(</span><span class="string" id="7182673">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7182695">,</span>&nbsp;<span class="ident" id="7182697">g</span><span class="op" id="7182698">.</span><span class="ident" id="7182699">name</span><span class="op" id="7182703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182711">if</span>&nbsp;<span class="ident" id="7182714">f</span><span class="op" id="7182715">.</span><span class="ident" id="7182716">name</span>&nbsp;<span class="op" id="7182721">!=</span>&nbsp;<span class="ident" id="7182724">g</span><span class="op" id="7182725">.</span><span class="ident" id="7182726">name</span>&nbsp;<span class="op" id="7182731">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182736">return</span>&nbsp;<span class="ident" id="7182743">fmt</span><span class="op" id="7182746">.</span><span class="ident" id="7182747">Errorf</span><span class="op" id="7182753">(</span><span class="string" id="7182754">&#34;different&nbsp;filenames:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="7182785">,</span>&nbsp;<span class="ident" id="7182787">f</span><span class="op" id="7182788">.</span><span class="ident" id="7182789">name</span><span class="op" id="7182793">,</span>&nbsp;<span class="ident" id="7182795">g</span><span class="op" id="7182796">.</span><span class="ident" id="7182797">name</span><span class="op" id="7182801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182809">if</span>&nbsp;<span class="ident" id="7182812">f</span><span class="op" id="7182813">.</span><span class="ident" id="7182814">base</span>&nbsp;<span class="op" id="7182819">!=</span>&nbsp;<span class="ident" id="7182822">g</span><span class="op" id="7182823">.</span><span class="ident" id="7182824">base</span>&nbsp;<span class="op" id="7182829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182834">return</span>&nbsp;<span class="ident" id="7182841">fmt</span><span class="op" id="7182844">.</span><span class="ident" id="7182845">Errorf</span><span class="op" id="7182851">(</span><span class="string" id="7182852">&#34;different&nbsp;base&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7182885">,</span>&nbsp;<span class="ident" id="7182887">f</span><span class="op" id="7182888">.</span><span class="ident" id="7182889">name</span><span class="op" id="7182893">,</span>&nbsp;<span class="ident" id="7182895">f</span><span class="op" id="7182896">.</span><span class="ident" id="7182897">base</span><span class="op" id="7182901">,</span>&nbsp;<span class="ident" id="7182903">g</span><span class="op" id="7182904">.</span><span class="ident" id="7182905">base</span><span class="op" id="7182909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7182913">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182917">if</span>&nbsp;<span class="ident" id="7182920">f</span><span class="op" id="7182921">.</span><span class="ident" id="7182922">size</span>&nbsp;<span class="op" id="7182927">!=</span>&nbsp;<span class="ident" id="7182930">g</span><span class="op" id="7182931">.</span><span class="ident" id="7182932">size</span>&nbsp;<span class="op" id="7182937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7182942">return</span>&nbsp;<span class="ident" id="7182949">fmt</span><span class="op" id="7182952">.</span><span class="ident" id="7182953">Errorf</span><span class="op" id="7182959">(</span><span class="string" id="7182960">&#34;different&nbsp;size&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7182993">,</span>&nbsp;<span class="ident" id="7182995">f</span><span class="op" id="7182996">.</span><span class="ident" id="7182997">name</span><span class="op" id="7183001">,</span>&nbsp;<span class="ident" id="7183003">f</span><span class="op" id="7183004">.</span><span class="ident" id="7183005">size</span><span class="op" id="7183009">,</span>&nbsp;<span class="ident" id="7183011">g</span><span class="op" id="7183012">.</span><span class="ident" id="7183013">size</span><span class="op" id="7183017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183025">for</span>&nbsp;<span class="ident" id="7183029">j</span><span class="op" id="7183030">,</span>&nbsp;<span class="ident" id="7183032">l</span>&nbsp;<span class="op" id="7183034">:=</span>&nbsp;<span class="keyword" id="7183037">range</span>&nbsp;<span class="ident" id="7183043">f</span><span class="op" id="7183044">.</span><span class="ident" id="7183045">lines</span>&nbsp;<span class="op" id="7183051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183056">m</span>&nbsp;<span class="op" id="7183058">:=</span>&nbsp;<span class="ident" id="7183061">g</span><span class="op" id="7183062">.</span><span class="ident" id="7183063">lines</span><span class="op" id="7183068">[</span><span class="ident" id="7183069">j</span><span class="op" id="7183070">]</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183075">if</span>&nbsp;<span class="ident" id="7183078">l</span>&nbsp;<span class="op" id="7183080">!=</span>&nbsp;<span class="ident" id="7183083">m</span>&nbsp;<span class="op" id="7183085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183091">return</span>&nbsp;<span class="ident" id="7183098">fmt</span><span class="op" id="7183101">.</span><span class="ident" id="7183102">Errorf</span><span class="op" id="7183108">(</span><span class="string" id="7183109">&#34;different&nbsp;offsets&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7183135">,</span>&nbsp;<span class="ident" id="7183137">f</span><span class="op" id="7183138">.</span><span class="ident" id="7183139">name</span><span class="op" id="7183143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183156">for</span>&nbsp;<span class="ident" id="7183160">j</span><span class="op" id="7183161">,</span>&nbsp;<span class="ident" id="7183163">l</span>&nbsp;<span class="op" id="7183165">:=</span>&nbsp;<span class="keyword" id="7183168">range</span>&nbsp;<span class="ident" id="7183174">f</span><span class="op" id="7183175">.</span><span class="ident" id="7183176">infos</span>&nbsp;<span class="op" id="7183182">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183187">m</span>&nbsp;<span class="op" id="7183189">:=</span>&nbsp;<span class="ident" id="7183192">g</span><span class="op" id="7183193">.</span><span class="ident" id="7183194">infos</span><span class="op" id="7183199">[</span><span class="ident" id="7183200">j</span><span class="op" id="7183201">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183206">if</span>&nbsp;<span class="ident" id="7183209">l</span><span class="op" id="7183210">.</span><span class="ident" id="7183211">Offset</span>&nbsp;<span class="op" id="7183218">!=</span>&nbsp;<span class="ident" id="7183221">m</span><span class="op" id="7183222">.</span><span class="ident" id="7183223">Offset</span>&nbsp;<span class="op" id="7183230">||</span>&nbsp;<span class="ident" id="7183233">l</span><span class="op" id="7183234">.</span><span class="ident" id="7183235">Filename</span>&nbsp;<span class="op" id="7183244">!=</span>&nbsp;<span class="ident" id="7183247">m</span><span class="op" id="7183248">.</span><span class="ident" id="7183249">Filename</span>&nbsp;<span class="op" id="7183258">||</span>&nbsp;<span class="ident" id="7183261">l</span><span class="op" id="7183262">.</span><span class="ident" id="7183263">Line</span>&nbsp;<span class="op" id="7183268">!=</span>&nbsp;<span class="ident" id="7183271">m</span><span class="op" id="7183272">.</span><span class="ident" id="7183273">Line</span>&nbsp;<span class="op" id="7183278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183284">return</span>&nbsp;<span class="ident" id="7183291">fmt</span><span class="op" id="7183294">.</span><span class="ident" id="7183295">Errorf</span><span class="op" id="7183301">(</span><span class="string" id="7183302">&#34;different&nbsp;infos&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7183326">,</span>&nbsp;<span class="ident" id="7183328">f</span><span class="op" id="7183329">.</span><span class="ident" id="7183330">name</span><span class="op" id="7183334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183343">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7183350">//&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;about&nbsp;.last&nbsp;-&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183400">return</span>&nbsp;<span class="ident" id="7183407">nil</span><br>
<span class="lineno"></span><span class="op" id="7183411">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7183414">func</span>&nbsp;<span class="ident" id="7183419">checkSerialize</span><span class="op" id="7183433">(</span><span class="ident" id="7183434">t</span>&nbsp;<span class="op" id="7183436">*</span><span class="ident" id="7183437">testing</span><span class="op" id="7183444">.</span><span class="ident" id="7183445">T</span><span class="op" id="7183446">,</span>&nbsp;<span class="ident" id="7183448">p</span>&nbsp;<span class="op" id="7183450">*</span><span class="ident" id="7183451">FileSet</span><span class="op" id="7183458">)</span>&nbsp;<span class="op" id="7183460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183463">var</span>&nbsp;<span class="ident" id="7183467">buf</span>&nbsp;<span class="ident" id="7183471">bytes</span><span class="op" id="7183476">.</span><span class="ident" id="7183477">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183485">encode</span>&nbsp;<span class="op" id="7183492">:=</span>&nbsp;<span class="keyword" id="7183495">func</span><span class="op" id="7183499">(</span><span class="ident" id="7183500">x</span>&nbsp;<span class="keyword" id="7183502">interface</span><span class="op" id="7183511">{</span><span class="op" id="7183512">}</span><span class="op" id="7183513">)</span>&nbsp;<span class="builtintype" id="7183515">error</span>&nbsp;<span class="op" id="7183521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183525">return</span>&nbsp;<span class="ident" id="7183532">gob</span><span class="op" id="7183535">.</span><span class="ident" id="7183536">NewEncoder</span><span class="op" id="7183546">(</span><span class="op" id="7183547">&amp;</span><span class="ident" id="7183548">buf</span><span class="op" id="7183551">)</span><span class="op" id="7183552">.</span><span class="ident" id="7183553">Encode</span><span class="op" id="7183559">(</span><span class="ident" id="7183560">x</span><span class="op" id="7183561">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183567">if</span>&nbsp;<span class="ident" id="7183570">err</span>&nbsp;<span class="op" id="7183574">:=</span>&nbsp;<span class="ident" id="7183577">p</span><span class="op" id="7183578">.</span><span class="ident" id="7183579">Write</span><span class="op" id="7183584">(</span><span class="ident" id="7183585">encode</span><span class="op" id="7183591">)</span><span class="op" id="7183592">;</span>&nbsp;<span class="ident" id="7183594">err</span>&nbsp;<span class="op" id="7183598">!=</span>&nbsp;<span class="ident" id="7183601">nil</span>&nbsp;<span class="op" id="7183605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183609">t</span><span class="op" id="7183610">.</span><span class="ident" id="7183611">Errorf</span><span class="op" id="7183617">(</span><span class="string" id="7183618">&#34;writing&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7183646">,</span>&nbsp;<span class="ident" id="7183648">err</span><span class="op" id="7183651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183655">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183663">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183666">q</span>&nbsp;<span class="op" id="7183668">:=</span>&nbsp;<span class="ident" id="7183671">NewFileSet</span><span class="op" id="7183681">(</span><span class="op" id="7183682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183685">decode</span>&nbsp;<span class="op" id="7183692">:=</span>&nbsp;<span class="keyword" id="7183695">func</span><span class="op" id="7183699">(</span><span class="ident" id="7183700">x</span>&nbsp;<span class="keyword" id="7183702">interface</span><span class="op" id="7183711">{</span><span class="op" id="7183712">}</span><span class="op" id="7183713">)</span>&nbsp;<span class="builtintype" id="7183715">error</span>&nbsp;<span class="op" id="7183721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183725">return</span>&nbsp;<span class="ident" id="7183732">gob</span><span class="op" id="7183735">.</span><span class="ident" id="7183736">NewDecoder</span><span class="op" id="7183746">(</span><span class="op" id="7183747">&amp;</span><span class="ident" id="7183748">buf</span><span class="op" id="7183751">)</span><span class="op" id="7183752">.</span><span class="ident" id="7183753">Decode</span><span class="op" id="7183759">(</span><span class="ident" id="7183760">x</span><span class="op" id="7183761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183767">if</span>&nbsp;<span class="ident" id="7183770">err</span>&nbsp;<span class="op" id="7183774">:=</span>&nbsp;<span class="ident" id="7183777">q</span><span class="op" id="7183778">.</span><span class="ident" id="7183779">Read</span><span class="op" id="7183783">(</span><span class="ident" id="7183784">decode</span><span class="op" id="7183790">)</span><span class="op" id="7183791">;</span>&nbsp;<span class="ident" id="7183793">err</span>&nbsp;<span class="op" id="7183797">!=</span>&nbsp;<span class="ident" id="7183800">nil</span>&nbsp;<span class="op" id="7183804">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183808">t</span><span class="op" id="7183809">.</span><span class="ident" id="7183810">Errorf</span><span class="op" id="7183816">(</span><span class="string" id="7183817">&#34;reading&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7183845">,</span>&nbsp;<span class="ident" id="7183847">err</span><span class="op" id="7183850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183854">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7183865">if</span>&nbsp;<span class="ident" id="7183868">err</span>&nbsp;<span class="op" id="7183872">:=</span>&nbsp;<span class="ident" id="7183875">equal</span><span class="op" id="7183880">(</span><span class="ident" id="7183881">p</span><span class="op" id="7183882">,</span>&nbsp;<span class="ident" id="7183884">q</span><span class="op" id="7183885">)</span><span class="op" id="7183886">;</span>&nbsp;<span class="ident" id="7183888">err</span>&nbsp;<span class="op" id="7183892">!=</span>&nbsp;<span class="ident" id="7183895">nil</span>&nbsp;<span class="op" id="7183899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183903">t</span><span class="op" id="7183904">.</span><span class="ident" id="7183905">Errorf</span><span class="op" id="7183911">(</span><span class="string" id="7183912">&#34;filesets&nbsp;not&nbsp;identical:&nbsp;%s&#34;</span><span class="op" id="7183940">,</span>&nbsp;<span class="ident" id="7183942">err</span><span class="op" id="7183945">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7183948">}</span><br>
<span class="lineno"></span><span class="op" id="7183950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7183953">func</span>&nbsp;<span class="ident" id="7183958">TestSerialization</span><span class="op" id="7183975">(</span><span class="ident" id="7183976">t</span>&nbsp;<span class="op" id="7183978">*</span><span class="ident" id="7183979">testing</span><span class="op" id="7183986">.</span><span class="ident" id="7183987">T</span><span class="op" id="7183988">)</span>&nbsp;<span class="op" id="7183990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7183993">p</span>&nbsp;<span class="op" id="7183995">:=</span>&nbsp;<span class="ident" id="7183998">NewFileSet</span><span class="op" id="7184008">(</span><span class="op" id="7184009">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7184012">checkSerialize</span><span class="op" id="7184026">(</span><span class="ident" id="7184027">t</span><span class="op" id="7184028">,</span>&nbsp;<span class="ident" id="7184030">p</span><span class="op" id="7184031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7184034">//&nbsp;add&nbsp;some&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7184053">for</span>&nbsp;<span class="ident" id="7184057">i</span>&nbsp;<span class="op" id="7184059">:=</span>&nbsp;<span class="num" id="7184062">0</span><span class="op" id="7184063">;</span>&nbsp;<span class="ident" id="7184065">i</span>&nbsp;<span class="op" id="7184067">&lt;</span>&nbsp;<span class="num" id="7184069">10</span><span class="op" id="7184071">;</span>&nbsp;<span class="ident" id="7184073">i</span><span class="op" id="7184074">++</span>&nbsp;<span class="op" id="7184077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7184081">f</span>&nbsp;<span class="op" id="7184083">:=</span>&nbsp;<span class="ident" id="7184086">p</span><span class="op" id="7184087">.</span><span class="ident" id="7184088">AddFile</span><span class="op" id="7184095">(</span><span class="ident" id="7184096">fmt</span><span class="op" id="7184099">.</span><span class="ident" id="7184100">Sprintf</span><span class="op" id="7184107">(</span><span class="string" id="7184108">&#34;file%d&#34;</span><span class="op" id="7184116">,</span>&nbsp;<span class="ident" id="7184118">i</span><span class="op" id="7184119">)</span><span class="op" id="7184120">,</span>&nbsp;<span class="ident" id="7184122">p</span><span class="op" id="7184123">.</span><span class="ident" id="7184124">Base</span><span class="op" id="7184128">(</span><span class="op" id="7184129">)</span><span class="op" id="7184130">+</span><span class="ident" id="7184131">i</span><span class="op" id="7184132">,</span>&nbsp;<span class="ident" id="7184134">i</span><span class="op" id="7184135">*</span><span class="num" id="7184136">100</span><span class="op" id="7184139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7184143">checkSerialize</span><span class="op" id="7184157">(</span><span class="ident" id="7184158">t</span><span class="op" id="7184159">,</span>&nbsp;<span class="ident" id="7184161">p</span><span class="op" id="7184162">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7184166">//&nbsp;add&nbsp;some&nbsp;lines&nbsp;and&nbsp;alternative&nbsp;file&nbsp;infos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7184213">line</span>&nbsp;<span class="op" id="7184218">:=</span>&nbsp;<span class="num" id="7184221">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7184228">for</span>&nbsp;<span class="ident" id="7184232">offs</span>&nbsp;<span class="op" id="7184237">:=</span>&nbsp;<span class="num" id="7184240">0</span><span class="op" id="7184241">;</span>&nbsp;<span class="ident" id="7184243">offs</span>&nbsp;<span class="op" id="7184248">&lt;</span>&nbsp;<span class="ident" id="7184250">f</span><span class="op" id="7184251">.</span><span class="ident" id="7184252">Size</span><span class="op" id="7184256">(</span><span class="op" id="7184257">)</span><span class="op" id="7184258">;</span>&nbsp;<span class="ident" id="7184260">offs</span>&nbsp;<span class="op" id="7184265">+=</span>&nbsp;<span class="num" id="7184268">40</span>&nbsp;<span class="op" id="7184271">+</span>&nbsp;<span class="ident" id="7184273">i</span>&nbsp;<span class="op" id="7184275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7184280">f</span><span class="op" id="7184281">.</span><span class="ident" id="7184282">AddLine</span><span class="op" id="7184289">(</span><span class="ident" id="7184290">offs</span><span class="op" id="7184294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7184299">if</span>&nbsp;<span class="ident" id="7184302">offs</span><span class="op" id="7184306">%</span><span class="num" id="7184307">7</span>&nbsp;<span class="op" id="7184309">==</span>&nbsp;<span class="num" id="7184312">0</span>&nbsp;<span class="op" id="7184314">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7184320">f</span><span class="op" id="7184321">.</span><span class="ident" id="7184322">AddLineInfo</span><span class="op" id="7184333">(</span><span class="ident" id="7184334">offs</span><span class="op" id="7184338">,</span>&nbsp;<span class="ident" id="7184340">fmt</span><span class="op" id="7184343">.</span><span class="ident" id="7184344">Sprintf</span><span class="op" id="7184351">(</span><span class="string" id="7184352">&#34;file%d&#34;</span><span class="op" id="7184360">,</span>&nbsp;<span class="ident" id="7184362">offs</span><span class="op" id="7184366">)</span><span class="op" id="7184367">,</span>&nbsp;<span class="ident" id="7184369">line</span><span class="op" id="7184373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7184379">line</span>&nbsp;<span class="op" id="7184384">+=</span>&nbsp;<span class="num" id="7184387">33</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7184393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7184397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7184401">checkSerialize</span><span class="op" id="7184415">(</span><span class="ident" id="7184416">t</span><span class="op" id="7184417">,</span>&nbsp;<span class="ident" id="7184419">p</span><span class="op" id="7184420">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7184423">}</span><br>
<span class="lineno"></span><span class="op" id="7184425">}</span>
</div>
</body>
</html>
