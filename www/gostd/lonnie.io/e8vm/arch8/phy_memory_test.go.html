<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/arch8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/arch8/console.go.html">console.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu.go.html">cpu.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu_test.go.html">cpu_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/device.go.html">device.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/exception.go.html">exception.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br_test.go.html">inst_br_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm_test.go.html">inst_imm_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg_test.go.html">inst_reg_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/int_bus.go.html">int_bus.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt.go.html">interrupt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt_test.go.html">interrupt_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/machine.go.html">machine.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/multi_core.go.html">multi_core.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page.go.html">page.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table.go.html">page_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table_test.go.html">page_table_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_test.go.html">page_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory.go.html">phy_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory_test.go.html">phy_memory_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs.go.html">regs.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs_test.go.html">regs_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/run_image.go.html">run_image.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/serial.go.html">serial.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/ticker.go.html">ticker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory.go.html">virt_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory_test.go.html">virt_memory_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="6760321">package</span>&nbsp;<span class="ident" id="6760329">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6760336">import</span>&nbsp;<span class="op" id="6760343">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6760346">&#34;testing&#34;</span><br>
<span class="lineno">5</span><span class="op" id="6760356">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6760359">func</span>&nbsp;<span class="ident" id="6760364">TestPhyMemory</span><span class="op" id="6760377">(</span><span class="ident" id="6760378">t</span>&nbsp;<span class="op" id="6760380">*</span><span class="ident" id="6760381">testing</span><span class="op" id="6760388">.</span><span class="ident" id="6760389">T</span><span class="op" id="6760390">)</span>&nbsp;<span class="op" id="6760392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760395">eo</span>&nbsp;<span class="op" id="6760398">:=</span>&nbsp;<span class="keyword" id="6760401">func</span><span class="op" id="6760405">(</span><span class="ident" id="6760406">cond</span>&nbsp;<span class="builtintype" id="6760411">bool</span><span class="op" id="6760415">,</span>&nbsp;<span class="ident" id="6760417">s</span>&nbsp;<span class="builtintype" id="6760419">string</span><span class="op" id="6760425">,</span>&nbsp;<span class="ident" id="6760427">args</span>&nbsp;<span class="op" id="6760432">...</span><span class="keyword" id="6760435">interface</span><span class="op" id="6760444">{</span><span class="op" id="6760445">}</span><span class="op" id="6760446">)</span>&nbsp;<span class="op" id="6760448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760452">if</span>&nbsp;<span class="ident" id="6760455">cond</span>&nbsp;<span class="op" id="6760460">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760465">t</span><span class="op" id="6760466">.</span><span class="ident" id="6760467">Fatalf</span><span class="op" id="6760473">(</span><span class="ident" id="6760474">s</span><span class="op" id="6760475">,</span>&nbsp;<span class="ident" id="6760477">args</span><span class="op" id="6760481">...</span><span class="op" id="6760484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760495">as</span>&nbsp;<span class="op" id="6760498">:=</span>&nbsp;<span class="keyword" id="6760501">func</span><span class="op" id="6760505">(</span><span class="ident" id="6760506">cond</span>&nbsp;<span class="builtintype" id="6760511">bool</span><span class="op" id="6760515">)</span>&nbsp;<span class="op" id="6760517">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6760521">if</span>&nbsp;<span class="op" id="6760524">!</span><span class="ident" id="6760525">cond</span>&nbsp;<span class="op" id="6760530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760535">t</span><span class="op" id="6760536">.</span><span class="ident" id="6760537">Fatal</span><span class="op" id="6760542">(</span><span class="string" id="6760543">&#34;assertion&nbsp;failed&#34;</span><span class="op" id="6760561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6760568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760572">size</span>&nbsp;<span class="op" id="6760577">:=</span>&nbsp;<span class="builtintype" id="6760580">uint32</span><span class="op" id="6760586">(</span><span class="num" id="6760587">20</span>&nbsp;<span class="op" id="6760590">*</span>&nbsp;<span class="ident" id="6760592">PageSize</span><span class="op" id="6760600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760603">m</span>&nbsp;<span class="op" id="6760605">:=</span>&nbsp;<span class="ident" id="6760608">newPhyMemory</span><span class="op" id="6760620">(</span><span class="ident" id="6760621">size</span><span class="op" id="6760625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760628">eo</span><span class="op" id="6760630">(</span><span class="ident" id="6760631">m</span><span class="op" id="6760632">.</span><span class="ident" id="6760633">Size</span><span class="op" id="6760637">(</span><span class="op" id="6760638">)</span>&nbsp;<span class="op" id="6760640">!=</span>&nbsp;<span class="ident" id="6760643">size</span><span class="op" id="6760647">,</span>&nbsp;<span class="string" id="6760649">&#34;size&nbsp;mismatch&#34;</span><span class="op" id="6760664">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760668">w</span><span class="op" id="6760669">,</span>&nbsp;<span class="ident" id="6760671">e</span>&nbsp;<span class="op" id="6760673">:=</span>&nbsp;<span class="ident" id="6760676">m</span><span class="op" id="6760677">.</span><span class="ident" id="6760678">ReadWord</span><span class="op" id="6760686">(</span><span class="num" id="6760687">4</span><span class="op" id="6760688">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760691">eo</span><span class="op" id="6760693">(</span><span class="ident" id="6760694">e</span>&nbsp;<span class="op" id="6760696">!=</span>&nbsp;<span class="ident" id="6760699">nil</span><span class="op" id="6760702">,</span>&nbsp;<span class="string" id="6760704">&#34;get&nbsp;an&nbsp;error&nbsp;for&nbsp;word&nbsp;reading&#34;</span><span class="op" id="6760735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760738">eo</span><span class="op" id="6760740">(</span><span class="ident" id="6760741">w</span>&nbsp;<span class="op" id="6760743">!=</span>&nbsp;<span class="num" id="6760746">0</span><span class="op" id="6760747">,</span>&nbsp;<span class="string" id="6760749">&#34;page&nbsp;is&nbsp;not&nbsp;zeroed&nbsp;out&#34;</span><span class="op" id="6760773">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760777">_</span><span class="op" id="6760778">,</span>&nbsp;<span class="ident" id="6760780">e</span>&nbsp;<span class="op" id="6760782">=</span>&nbsp;<span class="ident" id="6760784">m</span><span class="op" id="6760785">.</span><span class="ident" id="6760786">ReadWord</span><span class="op" id="6760794">(</span><span class="num" id="6760795">13</span><span class="op" id="6760797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760800">eo</span><span class="op" id="6760802">(</span><span class="ident" id="6760803">e</span>&nbsp;<span class="op" id="6760805">!=</span>&nbsp;<span class="ident" id="6760808">errMisalign</span><span class="op" id="6760819">,</span>&nbsp;<span class="string" id="6760821">&#34;should&nbsp;have&nbsp;misalign&nbsp;error&#34;</span><span class="op" id="6760849">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760852">_</span><span class="op" id="6760853">,</span>&nbsp;<span class="ident" id="6760855">e</span>&nbsp;<span class="op" id="6760857">=</span>&nbsp;<span class="ident" id="6760859">m</span><span class="op" id="6760860">.</span><span class="ident" id="6760861">ReadWord</span><span class="op" id="6760869">(</span><span class="ident" id="6760870">size</span>&nbsp;<span class="op" id="6760875">-</span>&nbsp;<span class="num" id="6760877">1</span><span class="op" id="6760878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760881">eo</span><span class="op" id="6760883">(</span><span class="ident" id="6760884">e</span>&nbsp;<span class="op" id="6760886">!=</span>&nbsp;<span class="ident" id="6760889">errMisalign</span><span class="op" id="6760900">,</span>&nbsp;<span class="string" id="6760902">&#34;should&nbsp;have&nbsp;misalign&nbsp;error&#34;</span><span class="op" id="6760930">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760934">_</span><span class="op" id="6760935">,</span>&nbsp;<span class="ident" id="6760937">e</span>&nbsp;<span class="op" id="6760939">=</span>&nbsp;<span class="ident" id="6760941">m</span><span class="op" id="6760942">.</span><span class="ident" id="6760943">ReadWord</span><span class="op" id="6760951">(</span><span class="ident" id="6760952">size</span><span class="op" id="6760956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6760959">eo</span><span class="op" id="6760961">(</span><span class="ident" id="6760962">e</span>&nbsp;<span class="op" id="6760964">!=</span>&nbsp;<span class="ident" id="6760967">errOutOfRange</span><span class="op" id="6760980">,</span>&nbsp;<span class="string" id="6760982">&#34;should&nbsp;have&nbsp;out&nbsp;of&nbsp;range&nbsp;error&#34;</span><span class="op" id="6761014">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761018">off</span>&nbsp;<span class="op" id="6761022">:=</span>&nbsp;<span class="builtintype" id="6761025">uint32</span><span class="op" id="6761031">(</span><span class="num" id="6761032">56</span>&nbsp;<span class="op" id="6761035">+</span>&nbsp;<span class="ident" id="6761037">PageSize</span><span class="op" id="6761045">*</span><span class="num" id="6761046">2</span><span class="op" id="6761047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761050">as</span><span class="op" id="6761052">(</span><span class="ident" id="6761053">m</span><span class="op" id="6761054">.</span><span class="ident" id="6761055">WriteByte</span><span class="op" id="6761064">(</span><span class="ident" id="6761065">off</span><span class="op" id="6761068">+</span><span class="num" id="6761069">0</span><span class="op" id="6761070">,</span>&nbsp;<span class="num" id="6761072">0x37</span><span class="op" id="6761076">)</span>&nbsp;<span class="op" id="6761078">==</span>&nbsp;<span class="ident" id="6761081">nil</span><span class="op" id="6761084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761087">as</span><span class="op" id="6761089">(</span><span class="ident" id="6761090">m</span><span class="op" id="6761091">.</span><span class="ident" id="6761092">WriteByte</span><span class="op" id="6761101">(</span><span class="ident" id="6761102">off</span><span class="op" id="6761105">+</span><span class="num" id="6761106">1</span><span class="op" id="6761107">,</span>&nbsp;<span class="num" id="6761109">0x21</span><span class="op" id="6761113">)</span>&nbsp;<span class="op" id="6761115">==</span>&nbsp;<span class="ident" id="6761118">nil</span><span class="op" id="6761121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761124">as</span><span class="op" id="6761126">(</span><span class="ident" id="6761127">m</span><span class="op" id="6761128">.</span><span class="ident" id="6761129">WriteByte</span><span class="op" id="6761138">(</span><span class="ident" id="6761139">off</span><span class="op" id="6761142">+</span><span class="num" id="6761143">2</span><span class="op" id="6761144">,</span>&nbsp;<span class="num" id="6761146">0x5a</span><span class="op" id="6761150">)</span>&nbsp;<span class="op" id="6761152">==</span>&nbsp;<span class="ident" id="6761155">nil</span><span class="op" id="6761158">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761161">as</span><span class="op" id="6761163">(</span><span class="ident" id="6761164">m</span><span class="op" id="6761165">.</span><span class="ident" id="6761166">WriteByte</span><span class="op" id="6761175">(</span><span class="ident" id="6761176">off</span><span class="op" id="6761179">+</span><span class="num" id="6761180">3</span><span class="op" id="6761181">,</span>&nbsp;<span class="num" id="6761183">0x70</span><span class="op" id="6761187">)</span>&nbsp;<span class="op" id="6761189">==</span>&nbsp;<span class="ident" id="6761192">nil</span><span class="op" id="6761195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761198">exp</span>&nbsp;<span class="op" id="6761202">:=</span>&nbsp;<span class="builtintype" id="6761205">uint32</span><span class="op" id="6761211">(</span><span class="num" id="6761212">0x705a2137</span><span class="op" id="6761222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761225">w</span><span class="op" id="6761226">,</span>&nbsp;<span class="ident" id="6761228">e</span>&nbsp;<span class="op" id="6761230">=</span>&nbsp;<span class="ident" id="6761232">m</span><span class="op" id="6761233">.</span><span class="ident" id="6761234">ReadWord</span><span class="op" id="6761242">(</span><span class="ident" id="6761243">off</span><span class="op" id="6761246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761249">as</span><span class="op" id="6761251">(</span><span class="ident" id="6761252">e</span>&nbsp;<span class="op" id="6761254">==</span>&nbsp;<span class="ident" id="6761257">nil</span><span class="op" id="6761260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761263">eo</span><span class="op" id="6761265">(</span><span class="ident" id="6761266">w</span>&nbsp;<span class="op" id="6761268">!=</span>&nbsp;<span class="ident" id="6761271">exp</span><span class="op" id="6761274">,</span>&nbsp;<span class="string" id="6761276">&#34;expect&nbsp;0x%08x&nbsp;got&nbsp;0x%08x&#34;</span><span class="op" id="6761302">,</span>&nbsp;<span class="ident" id="6761304">exp</span><span class="op" id="6761307">,</span>&nbsp;<span class="ident" id="6761309">w</span><span class="op" id="6761310">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761313">b</span><span class="op" id="6761314">,</span>&nbsp;<span class="ident" id="6761316">e</span>&nbsp;<span class="op" id="6761318">:=</span>&nbsp;<span class="ident" id="6761321">m</span><span class="op" id="6761322">.</span><span class="ident" id="6761323">ReadByte</span><span class="op" id="6761331">(</span><span class="ident" id="6761332">off</span>&nbsp;<span class="op" id="6761336">+</span>&nbsp;<span class="num" id="6761338">2</span><span class="op" id="6761339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761342">as</span><span class="op" id="6761344">(</span><span class="ident" id="6761345">e</span>&nbsp;<span class="op" id="6761347">==</span>&nbsp;<span class="ident" id="6761350">nil</span><span class="op" id="6761353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6761356">eo</span><span class="op" id="6761358">(</span><span class="ident" id="6761359">b</span>&nbsp;<span class="op" id="6761361">!=</span>&nbsp;<span class="num" id="6761364">0x5a</span><span class="op" id="6761368">,</span>&nbsp;<span class="string" id="6761370">&#34;expect&nbsp;0x5a&nbsp;got&nbsp;%02x&#34;</span><span class="op" id="6761392">,</span>&nbsp;<span class="ident" id="6761394">b</span><span class="op" id="6761395">)</span><br>
<span class="lineno"></span><span class="op" id="6761397">}</span>
</div>
</body>
</html>
