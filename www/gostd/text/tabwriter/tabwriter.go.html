<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5027424">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5027479">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5027533">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5027584">//&nbsp;Package&nbsp;tabwriter&nbsp;implements&nbsp;a&nbsp;write&nbsp;filter&nbsp;(tabwriter.Writer)&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5027655">//&nbsp;translates&nbsp;tabbed&nbsp;columns&nbsp;in&nbsp;input&nbsp;into&nbsp;properly&nbsp;aligned&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="5027721">//</span><br>
<span class="lineno"></span><span class="comment" id="5027724">//&nbsp;The&nbsp;package&nbsp;is&nbsp;using&nbsp;the&nbsp;Elastic&nbsp;Tabstops&nbsp;algorithm&nbsp;described&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5027792">//&nbsp;http://nickgravgaard.com/elastictabstops/index.html.</span><br>
<span class="lineno">10</span><span class="comment" id="5027848">//</span><br>
<span class="lineno"></span><span class="keyword" id="5027851">package</span>&nbsp;<span class="ident" id="5027859">tabwriter</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5027870">import</span>&nbsp;<span class="op" id="5027877">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5027880">&#34;bytes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5027889">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5027895">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5027910">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5027913">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">20</span><span class="comment" id="5027993">//&nbsp;Filter&nbsp;implementation</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5028019">//&nbsp;A&nbsp;cell&nbsp;represents&nbsp;a&nbsp;segment&nbsp;of&nbsp;text&nbsp;terminated&nbsp;by&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks.</span><br>
<span class="lineno"></span><span class="comment" id="5028093">//&nbsp;The&nbsp;text&nbsp;itself&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;separate&nbsp;buffer;&nbsp;cell&nbsp;only&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5028168">//&nbsp;segment&#39;s&nbsp;size&nbsp;in&nbsp;bytes,&nbsp;its&nbsp;width&nbsp;in&nbsp;runes,&nbsp;and&nbsp;whether&nbsp;it&#39;s&nbsp;an&nbsp;htab</span><br>
<span class="lineno">25</span><span class="comment" id="5028241">//&nbsp;(&#39;\t&#39;)&nbsp;terminated&nbsp;cell.</span><br>
<span class="lineno"></span><span class="comment" id="5028268">//</span><br>
<span class="lineno"></span><span class="keyword" id="5028271">type</span>&nbsp;<span class="ident" id="5028276">cell</span>&nbsp;<span class="keyword" id="5028281">struct</span>&nbsp;<span class="op" id="5028288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028291">size</span>&nbsp;&nbsp;<span class="builtintype" id="5028297">int</span>&nbsp;&nbsp;<span class="comment" id="5028302">//&nbsp;cell&nbsp;size&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028325">width</span>&nbsp;<span class="builtintype" id="5028331">int</span>&nbsp;&nbsp;<span class="comment" id="5028336">//&nbsp;cell&nbsp;width&nbsp;in&nbsp;runes</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028360">htab</span>&nbsp;&nbsp;<span class="builtintype" id="5028366">bool</span>&nbsp;<span class="comment" id="5028371">//&nbsp;true&nbsp;if&nbsp;the&nbsp;cell&nbsp;is&nbsp;terminated&nbsp;by&nbsp;an&nbsp;htab&nbsp;(&#39;\t&#39;)</span><br>
<span class="lineno"></span><span class="op" id="5028423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5028426">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;filter&nbsp;that&nbsp;inserts&nbsp;padding&nbsp;around&nbsp;tab-delimited</span><br>
<span class="lineno"></span><span class="comment" id="5028492">//&nbsp;columns&nbsp;in&nbsp;its&nbsp;input&nbsp;to&nbsp;align&nbsp;them&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno">35</span><span class="comment" id="5028545">//</span><br>
<span class="lineno"></span><span class="comment" id="5028548">//&nbsp;The&nbsp;Writer&nbsp;treats&nbsp;incoming&nbsp;bytes&nbsp;as&nbsp;UTF-8&nbsp;encoded&nbsp;text&nbsp;consisting</span><br>
<span class="lineno"></span><span class="comment" id="5028617">//&nbsp;of&nbsp;cells&nbsp;terminated&nbsp;by&nbsp;(horizontal&nbsp;or&nbsp;vertical)&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5028681">//&nbsp;breaks&nbsp;(newline&nbsp;or&nbsp;formfeed&nbsp;characters).&nbsp;Cells&nbsp;in&nbsp;adjacent&nbsp;lines</span><br>
<span class="lineno"></span><span class="comment" id="5028749">//&nbsp;constitute&nbsp;a&nbsp;column.&nbsp;The&nbsp;Writer&nbsp;inserts&nbsp;padding&nbsp;as&nbsp;needed&nbsp;to</span><br>
<span class="lineno">40</span><span class="comment" id="5028813">//&nbsp;make&nbsp;all&nbsp;cells&nbsp;in&nbsp;a&nbsp;column&nbsp;have&nbsp;the&nbsp;same&nbsp;width,&nbsp;effectively</span><br>
<span class="lineno"></span><span class="comment" id="5028876">//&nbsp;aligning&nbsp;the&nbsp;columns.&nbsp;It&nbsp;assumes&nbsp;that&nbsp;all&nbsp;characters&nbsp;have&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5028941">//&nbsp;same&nbsp;width&nbsp;except&nbsp;for&nbsp;tabs&nbsp;for&nbsp;which&nbsp;a&nbsp;tabwidth&nbsp;must&nbsp;be&nbsp;specified.</span><br>
<span class="lineno"></span><span class="comment" id="5029011">//&nbsp;Note&nbsp;that&nbsp;cells&nbsp;are&nbsp;tab-terminated,&nbsp;not&nbsp;tab-separated:&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="5029078">//&nbsp;non-tab&nbsp;text&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;line&nbsp;does&nbsp;not&nbsp;form&nbsp;a&nbsp;column&nbsp;cell.</span><br>
<span class="lineno">45</span><span class="comment" id="5029144">//</span><br>
<span class="lineno"></span><span class="comment" id="5029147">//&nbsp;The&nbsp;Writer&nbsp;assumes&nbsp;that&nbsp;all&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;have&nbsp;the&nbsp;same&nbsp;width;</span><br>
<span class="lineno"></span><span class="comment" id="5029219">//&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;true&nbsp;in&nbsp;some&nbsp;fonts.</span><br>
<span class="lineno"></span><span class="comment" id="5029258">//</span><br>
<span class="lineno"></span><span class="comment" id="5029261">//&nbsp;If&nbsp;DiscardEmptyColumns&nbsp;is&nbsp;set,&nbsp;empty&nbsp;columns&nbsp;that&nbsp;are&nbsp;terminated</span><br>
<span class="lineno">50</span><span class="comment" id="5029329">//&nbsp;entirely&nbsp;by&nbsp;vertical&nbsp;(or&nbsp;&#34;soft&#34;)&nbsp;tabs&nbsp;are&nbsp;discarded.&nbsp;Columns</span><br>
<span class="lineno"></span><span class="comment" id="5029393">//&nbsp;terminated&nbsp;by&nbsp;horizontal&nbsp;(or&nbsp;&#34;hard&#34;)&nbsp;tabs&nbsp;are&nbsp;not&nbsp;affected&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5029458">//&nbsp;this&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="5029472">//</span><br>
<span class="lineno"></span><span class="comment" id="5029475">//&nbsp;If&nbsp;a&nbsp;Writer&nbsp;is&nbsp;configured&nbsp;to&nbsp;filter&nbsp;HTML,&nbsp;HTML&nbsp;tags&nbsp;and&nbsp;entities</span><br>
<span class="lineno">55</span><span class="comment" id="5029543">//&nbsp;are&nbsp;passed&nbsp;through.&nbsp;The&nbsp;widths&nbsp;of&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5029602">//&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;(tags)&nbsp;and&nbsp;one&nbsp;(entities)&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="5029675">//</span><br>
<span class="lineno"></span><span class="comment" id="5029678">//&nbsp;A&nbsp;segment&nbsp;of&nbsp;text&nbsp;may&nbsp;be&nbsp;escaped&nbsp;by&nbsp;bracketing&nbsp;it&nbsp;with&nbsp;Escape</span><br>
<span class="lineno"></span><span class="comment" id="5029743">//&nbsp;characters.&nbsp;The&nbsp;tabwriter&nbsp;passes&nbsp;escaped&nbsp;text&nbsp;segments&nbsp;through</span><br>
<span class="lineno">60</span><span class="comment" id="5029809">//&nbsp;unchanged.&nbsp;In&nbsp;particular,&nbsp;it&nbsp;does&nbsp;not&nbsp;interpret&nbsp;any&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5029877">//&nbsp;breaks&nbsp;within&nbsp;the&nbsp;segment.&nbsp;If&nbsp;the&nbsp;StripEscape&nbsp;flag&nbsp;is&nbsp;set,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5029943">//&nbsp;Escape&nbsp;characters&nbsp;are&nbsp;stripped&nbsp;from&nbsp;the&nbsp;output;&nbsp;otherwise&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="5030009">//&nbsp;are&nbsp;passed&nbsp;through&nbsp;as&nbsp;well.&nbsp;For&nbsp;the&nbsp;purpose&nbsp;of&nbsp;formatting,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5030075">//&nbsp;width&nbsp;of&nbsp;the&nbsp;escaped&nbsp;text&nbsp;is&nbsp;always&nbsp;computed&nbsp;excluding&nbsp;the&nbsp;Escape</span><br>
<span class="lineno">65</span><span class="comment" id="5030144">//&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="5030159">//</span><br>
<span class="lineno"></span><span class="comment" id="5030162">//&nbsp;The&nbsp;formfeed&nbsp;character&nbsp;(&#39;\f&#39;)&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline&nbsp;but&nbsp;it&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="5030227">//&nbsp;terminates&nbsp;all&nbsp;columns&nbsp;in&nbsp;the&nbsp;current&nbsp;line&nbsp;(effectively&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="5030294">//&nbsp;Flush).&nbsp;Cells&nbsp;in&nbsp;the&nbsp;next&nbsp;line&nbsp;start&nbsp;new&nbsp;columns.&nbsp;Unless&nbsp;found</span><br>
<span class="lineno">70</span><span class="comment" id="5030360">//&nbsp;inside&nbsp;an&nbsp;HTML&nbsp;tag&nbsp;or&nbsp;inside&nbsp;an&nbsp;escaped&nbsp;text&nbsp;segment,&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="5030426">//&nbsp;characters&nbsp;appear&nbsp;as&nbsp;newlines&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="5030474">//</span><br>
<span class="lineno"></span><span class="comment" id="5030477">//&nbsp;The&nbsp;Writer&nbsp;must&nbsp;buffer&nbsp;input&nbsp;internally,&nbsp;because&nbsp;proper&nbsp;spacing</span><br>
<span class="lineno"></span><span class="comment" id="5030544">//&nbsp;of&nbsp;one&nbsp;line&nbsp;may&nbsp;depend&nbsp;on&nbsp;the&nbsp;cells&nbsp;in&nbsp;future&nbsp;lines.&nbsp;Clients&nbsp;must</span><br>
<span class="lineno">75</span><span class="comment" id="5030613">//&nbsp;call&nbsp;Flush&nbsp;when&nbsp;done&nbsp;calling&nbsp;Write.</span><br>
<span class="lineno"></span><span class="comment" id="5030652">//</span><br>
<span class="lineno"></span><span class="keyword" id="5030655">type</span>&nbsp;<span class="ident" id="5030660">Writer</span>&nbsp;<span class="keyword" id="5030667">struct</span>&nbsp;<span class="op" id="5030674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5030677">//&nbsp;configuration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030695">output</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5030704">io</span><span class="op" id="5030706">.</span><span class="ident" id="5030707">Writer</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030715">minwidth</span>&nbsp;<span class="builtintype" id="5030724">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030729">tabwidth</span>&nbsp;<span class="builtintype" id="5030738">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030743">padding</span>&nbsp;&nbsp;<span class="builtintype" id="5030752">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030757">padbytes</span>&nbsp;<span class="op" id="5030766">[</span><span class="num" id="5030767">8</span><span class="op" id="5030768">]</span><span class="builtintype" id="5030769">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030775">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5030784">uint</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5030791">//&nbsp;current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030809">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5030817">bytes</span><span class="op" id="5030822">.</span><span class="ident" id="5030823">Buffer</span>&nbsp;<span class="comment" id="5030830">//&nbsp;collected&nbsp;text&nbsp;excluding&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030879">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5030887">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5030900">//&nbsp;buffer&nbsp;position&nbsp;up&nbsp;to&nbsp;which&nbsp;cell.width&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;has&nbsp;been&nbsp;computed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5030980">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5030988">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5031001">//&nbsp;current&nbsp;incomplete&nbsp;cell;&nbsp;cell.width&nbsp;is&nbsp;up&nbsp;to&nbsp;buf[pos]&nbsp;excluding&nbsp;ignored&nbsp;sections</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031086">endChar</span>&nbsp;<span class="builtintype" id="5031094">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5031107">//&nbsp;terminating&nbsp;char&nbsp;of&nbsp;escaped&nbsp;sequence&nbsp;(Escape&nbsp;for&nbsp;escapes,&nbsp;&#39;&gt;&#39;,&nbsp;&#39;;&#39;&nbsp;for&nbsp;HTML&nbsp;tags/entities,&nbsp;or&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031208">lines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5031216">[</span><span class="op" id="5031217">]</span><span class="op" id="5031218">[</span><span class="op" id="5031219">]</span><span class="ident" id="5031220">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5031229">//&nbsp;list&nbsp;of&nbsp;lines;&nbsp;each&nbsp;line&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031277">widths</span>&nbsp;&nbsp;<span class="op" id="5031285">[</span><span class="op" id="5031286">]</span><span class="builtintype" id="5031287">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5031298">//&nbsp;list&nbsp;of&nbsp;column&nbsp;widths&nbsp;in&nbsp;runes&nbsp;-&nbsp;re-used&nbsp;during&nbsp;formatting</span><br>
<span class="lineno"></span><span class="op" id="5031360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5031363">func</span>&nbsp;<span class="op" id="5031368">(</span><span class="ident" id="5031369">b</span>&nbsp;<span class="op" id="5031371">*</span><span class="ident" id="5031372">Writer</span><span class="op" id="5031378">)</span>&nbsp;<span class="ident" id="5031380">addLine</span><span class="op" id="5031387">(</span><span class="op" id="5031388">)</span>&nbsp;<span class="op" id="5031390">{</span>&nbsp;<span class="ident" id="5031392">b</span><span class="op" id="5031393">.</span><span class="ident" id="5031394">lines</span>&nbsp;<span class="op" id="5031400">=</span>&nbsp;<span class="builtinfunc" id="5031402">append</span><span class="op" id="5031408">(</span><span class="ident" id="5031409">b</span><span class="op" id="5031410">.</span><span class="ident" id="5031411">lines</span><span class="op" id="5031416">,</span>&nbsp;<span class="op" id="5031418">[</span><span class="op" id="5031419">]</span><span class="ident" id="5031420">cell</span><span class="op" id="5031424">{</span><span class="op" id="5031425">}</span><span class="op" id="5031426">)</span>&nbsp;<span class="op" id="5031428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5031431">//&nbsp;Reset&nbsp;the&nbsp;current&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5031459">func</span>&nbsp;<span class="op" id="5031464">(</span><span class="ident" id="5031465">b</span>&nbsp;<span class="op" id="5031467">*</span><span class="ident" id="5031468">Writer</span><span class="op" id="5031474">)</span>&nbsp;<span class="ident" id="5031476">reset</span><span class="op" id="5031481">(</span><span class="op" id="5031482">)</span>&nbsp;<span class="op" id="5031484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031487">b</span><span class="op" id="5031488">.</span><span class="ident" id="5031489">buf</span><span class="op" id="5031492">.</span><span class="ident" id="5031493">Reset</span><span class="op" id="5031498">(</span><span class="op" id="5031499">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031502">b</span><span class="op" id="5031503">.</span><span class="ident" id="5031504">pos</span>&nbsp;<span class="op" id="5031508">=</span>&nbsp;<span class="num" id="5031510">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031513">b</span><span class="op" id="5031514">.</span><span class="ident" id="5031515">cell</span>&nbsp;<span class="op" id="5031520">=</span>&nbsp;<span class="ident" id="5031522">cell</span><span class="op" id="5031526">{</span><span class="op" id="5031527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031530">b</span><span class="op" id="5031531">.</span><span class="ident" id="5031532">endChar</span>&nbsp;<span class="op" id="5031540">=</span>&nbsp;<span class="num" id="5031542">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031545">b</span><span class="op" id="5031546">.</span><span class="ident" id="5031547">lines</span>&nbsp;<span class="op" id="5031553">=</span>&nbsp;<span class="ident" id="5031555">b</span><span class="op" id="5031556">.</span><span class="ident" id="5031557">lines</span><span class="op" id="5031562">[</span><span class="num" id="5031563">0</span><span class="op" id="5031564">:</span><span class="num" id="5031565">0</span><span class="op" id="5031566">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031569">b</span><span class="op" id="5031570">.</span><span class="ident" id="5031571">widths</span>&nbsp;<span class="op" id="5031578">=</span>&nbsp;<span class="ident" id="5031580">b</span><span class="op" id="5031581">.</span><span class="ident" id="5031582">widths</span><span class="op" id="5031588">[</span><span class="num" id="5031589">0</span><span class="op" id="5031590">:</span><span class="num" id="5031591">0</span><span class="op" id="5031592">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5031595">b</span><span class="op" id="5031596">.</span><span class="ident" id="5031597">addLine</span><span class="op" id="5031604">(</span><span class="op" id="5031605">)</span><br>
<span class="lineno"></span><span class="op" id="5031607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5031610">//&nbsp;Internal&nbsp;representation&nbsp;(current&nbsp;state):</span><br>
<span class="lineno"></span><span class="comment" id="5031654">//</span><br>
<span class="lineno">110</span><span class="comment" id="5031657">//&nbsp;-&nbsp;all&nbsp;text&nbsp;written&nbsp;is&nbsp;appended&nbsp;to&nbsp;buf;&nbsp;tabs&nbsp;and&nbsp;line&nbsp;breaks&nbsp;are&nbsp;stripped&nbsp;away</span><br>
<span class="lineno"></span><span class="comment" id="5031738">//&nbsp;-&nbsp;at&nbsp;any&nbsp;given&nbsp;time&nbsp;there&nbsp;is&nbsp;a&nbsp;(possibly&nbsp;empty)&nbsp;incomplete&nbsp;cell&nbsp;at&nbsp;the&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="5031816">//&nbsp;&nbsp;&nbsp;(the&nbsp;cell&nbsp;starts&nbsp;after&nbsp;a&nbsp;tab&nbsp;or&nbsp;line&nbsp;break)</span><br>
<span class="lineno"></span><span class="comment" id="5031865">//&nbsp;-&nbsp;cell.size&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;belonging&nbsp;to&nbsp;the&nbsp;cell&nbsp;so&nbsp;far</span><br>
<span class="lineno"></span><span class="comment" id="5031932">//&nbsp;-&nbsp;cell.width&nbsp;is&nbsp;text&nbsp;width&nbsp;in&nbsp;runes&nbsp;of&nbsp;that&nbsp;cell&nbsp;from&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;cell&nbsp;to</span><br>
<span class="lineno">115</span><span class="comment" id="5032014">//&nbsp;&nbsp;&nbsp;position&nbsp;pos;&nbsp;html&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are&nbsp;excluded&nbsp;from&nbsp;this&nbsp;width&nbsp;if&nbsp;html</span><br>
<span class="lineno"></span><span class="comment" id="5032093">//&nbsp;&nbsp;&nbsp;filtering&nbsp;is&nbsp;enabled</span><br>
<span class="lineno"></span><span class="comment" id="5032119">//&nbsp;-&nbsp;the&nbsp;sizes&nbsp;and&nbsp;widths&nbsp;of&nbsp;processed&nbsp;text&nbsp;are&nbsp;kept&nbsp;in&nbsp;the&nbsp;lines&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5032190">//&nbsp;&nbsp;&nbsp;which&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;cells&nbsp;for&nbsp;each&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5032240">//&nbsp;-&nbsp;the&nbsp;widths&nbsp;list&nbsp;is&nbsp;a&nbsp;temporary&nbsp;list&nbsp;with&nbsp;current&nbsp;widths&nbsp;used&nbsp;during</span><br>
<span class="lineno">120</span><span class="comment" id="5032313">//&nbsp;&nbsp;&nbsp;formatting;&nbsp;it&nbsp;is&nbsp;kept&nbsp;in&nbsp;Writer&nbsp;because&nbsp;it&#39;s&nbsp;re-used</span><br>
<span class="lineno"></span><span class="comment" id="5032372">//</span><br>
<span class="lineno"></span><span class="comment" id="5032375">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;----------&nbsp;size&nbsp;----------&gt;|</span><br>
<span class="lineno"></span><span class="comment" id="5032428">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="5032481">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;-&nbsp;width&nbsp;-&gt;|&lt;-&nbsp;ignored&nbsp;-&gt;|&nbsp;&nbsp;|</span><br>
<span class="lineno">125</span><span class="comment" id="5032534">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="5032587">//&nbsp;[---processed---tab------------&lt;tag&gt;...&lt;/tag&gt;...]</span><br>
<span class="lineno"></span><span class="comment" id="5032640">//&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</span><br>
<span class="lineno"></span><span class="comment" id="5032690">//&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="5032740">//&nbsp;buf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;&nbsp;pos</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="5032793">//&nbsp;Formatting&nbsp;can&nbsp;be&nbsp;controlled&nbsp;with&nbsp;these&nbsp;flags.</span><br>
<span class="lineno"></span><span class="keyword" id="5032843">const</span>&nbsp;<span class="op" id="5032849">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5032852">//&nbsp;Ignore&nbsp;html&nbsp;tags&nbsp;and&nbsp;treat&nbsp;entities&nbsp;(starting&nbsp;with&nbsp;&#39;&amp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5032911">//&nbsp;and&nbsp;ending&nbsp;in&nbsp;&#39;;&#39;)&nbsp;as&nbsp;single&nbsp;characters&nbsp;(width&nbsp;=&nbsp;1).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5032968">FilterHTML</span>&nbsp;<span class="builtintype" id="5032979">uint</span>&nbsp;<span class="op" id="5032984">=</span>&nbsp;<span class="num" id="5032986">1</span>&nbsp;<span class="op" id="5032988">&lt;&lt;</span>&nbsp;<span class="ident" id="5032991">iota</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5032998">//&nbsp;Strip&nbsp;Escape&nbsp;characters&nbsp;bracketing&nbsp;escaped&nbsp;text&nbsp;segments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5033059">//&nbsp;instead&nbsp;of&nbsp;passing&nbsp;them&nbsp;through&nbsp;unchanged&nbsp;with&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033120">StripEscape</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5033134">//&nbsp;Force&nbsp;right-alignment&nbsp;of&nbsp;cell&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5033177">//&nbsp;Default&nbsp;is&nbsp;left-alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033208">AlignRight</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5033221">//&nbsp;Handle&nbsp;empty&nbsp;columns&nbsp;as&nbsp;if&nbsp;they&nbsp;were&nbsp;not&nbsp;present&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5033277">//&nbsp;the&nbsp;input&nbsp;in&nbsp;the&nbsp;first&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033311">DiscardEmptyColumns</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5033333">//&nbsp;Always&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;columns&nbsp;(i.e.,&nbsp;padding&nbsp;of</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5033395">//&nbsp;leading&nbsp;empty&nbsp;cells&nbsp;on&nbsp;the&nbsp;left)&nbsp;independent&nbsp;of&nbsp;padchar.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033456">TabIndent</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5033468">//&nbsp;Print&nbsp;a&nbsp;vertical&nbsp;bar&nbsp;(&#39;|&#39;)&nbsp;between&nbsp;columns&nbsp;(after&nbsp;formatting).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5033535">//&nbsp;Discarded&nbsp;columns&nbsp;appear&nbsp;as&nbsp;zero-width&nbsp;columns&nbsp;(&#34;||&#34;).</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033594">Debug</span><br>
<span class="lineno"></span><span class="op" id="5033600">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5033603">//&nbsp;A&nbsp;Writer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;with&nbsp;a&nbsp;call&nbsp;to&nbsp;Init.&nbsp;The&nbsp;first&nbsp;parameter&nbsp;(output)</span><br>
<span class="lineno"></span><span class="comment" id="5033685">//&nbsp;specifies&nbsp;the&nbsp;filter&nbsp;output.&nbsp;The&nbsp;remaining&nbsp;parameters&nbsp;control&nbsp;the&nbsp;formatting:</span><br>
<span class="lineno">160</span><span class="comment" id="5033766">//</span><br>
<span class="lineno"></span><span class="comment" id="5033769">//&nbsp;&nbsp;&nbsp;&nbspminwidth&nbsp;&nbsp;&nbsp;&nbspminimal&nbsp;cell&nbsp;width&nbsp;including&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span><span class="comment" id="5033822">//&nbsp;&nbsp;&nbsp;&nbsptabwidth&nbsp;&nbsp;&nbsp;&nbspwidth&nbsp;of&nbsp;tab&nbsp;characters&nbsp;(equivalent&nbsp;number&nbsp;of&nbsp;spaces)</span><br>
<span class="lineno"></span><span class="comment" id="5033888">//&nbsp;&nbsp;&nbsp;&nbsppadding&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsppadding&nbsp;added&nbsp;to&nbsp;a&nbsp;cell&nbsp;before&nbsp;computing&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="5033951">//&nbsp;&nbsp;&nbsp;&nbsppadchar&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspASCII&nbsp;char&nbsp;used&nbsp;for&nbsp;padding</span><br>
<span class="lineno">165</span><span class="comment" id="5033991">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;padchar&nbsp;==&nbsp;&#39;\t&#39;,&nbsp;the&nbsp;Writer&nbsp;will&nbsp;assume&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5034048">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspwidth&nbsp;of&nbsp;a&nbsp;&#39;\t&#39;&nbsp;in&nbsp;the&nbsp;formatted&nbsp;output&nbsp;is&nbsp;tabwidth,</span><br>
<span class="lineno"></span><span class="comment" id="5034106">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspand&nbsp;cells&nbsp;are&nbsp;left-aligned&nbsp;independent&nbsp;of&nbsp;align_left</span><br>
<span class="lineno"></span><span class="comment" id="5034164">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(for&nbsp;correct-looking&nbsp;results,&nbsp;tabwidth&nbsp;must&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="5034224">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspto&nbsp;the&nbsp;tab&nbsp;width&nbsp;in&nbsp;the&nbsp;viewer&nbsp;displaying&nbsp;the&nbsp;result)</span><br>
<span class="lineno">170</span><span class="comment" id="5034283">//&nbsp;&nbsp;&nbsp;&nbspflags&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspformatting&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="5034312">//</span><br>
<span class="lineno"></span><span class="keyword" id="5034315">func</span>&nbsp;<span class="op" id="5034320">(</span><span class="ident" id="5034321">b</span>&nbsp;<span class="op" id="5034323">*</span><span class="ident" id="5034324">Writer</span><span class="op" id="5034330">)</span>&nbsp;<span class="ident" id="5034332">Init</span><span class="op" id="5034336">(</span><span class="ident" id="5034337">output</span>&nbsp;<span class="ident" id="5034344">io</span><span class="op" id="5034346">.</span><span class="ident" id="5034347">Writer</span><span class="op" id="5034353">,</span>&nbsp;<span class="ident" id="5034355">minwidth</span><span class="op" id="5034363">,</span>&nbsp;<span class="ident" id="5034365">tabwidth</span><span class="op" id="5034373">,</span>&nbsp;<span class="ident" id="5034375">padding</span>&nbsp;<span class="builtintype" id="5034383">int</span><span class="op" id="5034386">,</span>&nbsp;<span class="ident" id="5034388">padchar</span>&nbsp;<span class="builtintype" id="5034396">byte</span><span class="op" id="5034400">,</span>&nbsp;<span class="ident" id="5034402">flags</span>&nbsp;<span class="builtintype" id="5034408">uint</span><span class="op" id="5034412">)</span>&nbsp;<span class="op" id="5034414">*</span><span class="ident" id="5034415">Writer</span>&nbsp;<span class="op" id="5034422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034425">if</span>&nbsp;<span class="ident" id="5034428">minwidth</span>&nbsp;<span class="op" id="5034437">&lt;</span>&nbsp;<span class="num" id="5034439">0</span>&nbsp;<span class="op" id="5034441">||</span>&nbsp;<span class="ident" id="5034444">tabwidth</span>&nbsp;<span class="op" id="5034453">&lt;</span>&nbsp;<span class="num" id="5034455">0</span>&nbsp;<span class="op" id="5034457">||</span>&nbsp;<span class="ident" id="5034460">padding</span>&nbsp;<span class="op" id="5034468">&lt;</span>&nbsp;<span class="num" id="5034470">0</span>&nbsp;<span class="op" id="5034472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5034476">panic</span><span class="op" id="5034481">(</span><span class="string" id="5034482">&#34;negative&nbsp;minwidth,&nbsp;tabwidth,&nbsp;or&nbsp;padding&#34;</span><span class="op" id="5034523">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5034526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034529">b</span><span class="op" id="5034530">.</span><span class="ident" id="5034531">output</span>&nbsp;<span class="op" id="5034538">=</span>&nbsp;<span class="ident" id="5034540">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034548">b</span><span class="op" id="5034549">.</span><span class="ident" id="5034550">minwidth</span>&nbsp;<span class="op" id="5034559">=</span>&nbsp;<span class="ident" id="5034561">minwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034571">b</span><span class="op" id="5034572">.</span><span class="ident" id="5034573">tabwidth</span>&nbsp;<span class="op" id="5034582">=</span>&nbsp;<span class="ident" id="5034584">tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034594">b</span><span class="op" id="5034595">.</span><span class="ident" id="5034596">padding</span>&nbsp;<span class="op" id="5034604">=</span>&nbsp;<span class="ident" id="5034606">padding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034615">for</span>&nbsp;<span class="ident" id="5034619">i</span>&nbsp;<span class="op" id="5034621">:=</span>&nbsp;<span class="keyword" id="5034624">range</span>&nbsp;<span class="ident" id="5034630">b</span><span class="op" id="5034631">.</span><span class="ident" id="5034632">padbytes</span>&nbsp;<span class="op" id="5034641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034645">b</span><span class="op" id="5034646">.</span><span class="ident" id="5034647">padbytes</span><span class="op" id="5034655">[</span><span class="ident" id="5034656">i</span><span class="op" id="5034657">]</span>&nbsp;<span class="op" id="5034659">=</span>&nbsp;<span class="ident" id="5034661">padchar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5034670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034673">if</span>&nbsp;<span class="ident" id="5034676">padchar</span>&nbsp;<span class="op" id="5034684">==</span>&nbsp;<span class="string" id="5034687">&#39;\t&#39;</span>&nbsp;<span class="op" id="5034692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5034696">//&nbsp;tab&nbsp;padding&nbsp;enforces&nbsp;left-alignment</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034737">flags</span>&nbsp;<span class="op" id="5034743">&amp;^=</span>&nbsp;<span class="ident" id="5034747">AlignRight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5034759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034762">b</span><span class="op" id="5034763">.</span><span class="ident" id="5034764">flags</span>&nbsp;<span class="op" id="5034770">=</span>&nbsp;<span class="ident" id="5034772">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034780">b</span><span class="op" id="5034781">.</span><span class="ident" id="5034782">reset</span><span class="op" id="5034787">(</span><span class="op" id="5034788">)</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034792">return</span>&nbsp;<span class="ident" id="5034799">b</span><br>
<span class="lineno"></span><span class="op" id="5034801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5034804">//&nbsp;debugging&nbsp;support&nbsp;(keep&nbsp;code&nbsp;around)</span><br>
<span class="lineno">195</span><span class="keyword" id="5034844">func</span>&nbsp;<span class="op" id="5034849">(</span><span class="ident" id="5034850">b</span>&nbsp;<span class="op" id="5034852">*</span><span class="ident" id="5034853">Writer</span><span class="op" id="5034859">)</span>&nbsp;<span class="ident" id="5034861">dump</span><span class="op" id="5034865">(</span><span class="op" id="5034866">)</span>&nbsp;<span class="op" id="5034868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034871">pos</span>&nbsp;<span class="op" id="5034875">:=</span>&nbsp;<span class="num" id="5034878">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034881">for</span>&nbsp;<span class="ident" id="5034885">i</span><span class="op" id="5034886">,</span>&nbsp;<span class="ident" id="5034888">line</span>&nbsp;<span class="op" id="5034893">:=</span>&nbsp;<span class="keyword" id="5034896">range</span>&nbsp;<span class="ident" id="5034902">b</span><span class="op" id="5034903">.</span><span class="ident" id="5034904">lines</span>&nbsp;<span class="op" id="5034910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5034914">print</span><span class="op" id="5034919">(</span><span class="string" id="5034920">&#34;(&#34;</span><span class="op" id="5034923">,</span>&nbsp;<span class="ident" id="5034925">i</span><span class="op" id="5034926">,</span>&nbsp;<span class="string" id="5034928">&#34;)&nbsp;&#34;</span><span class="op" id="5034932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034936">for</span>&nbsp;<span class="ident" id="5034940">_</span><span class="op" id="5034941">,</span>&nbsp;<span class="ident" id="5034943">c</span>&nbsp;<span class="op" id="5034945">:=</span>&nbsp;<span class="keyword" id="5034948">range</span>&nbsp;<span class="ident" id="5034954">line</span>&nbsp;<span class="op" id="5034959">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5034964">print</span><span class="op" id="5034969">(</span><span class="string" id="5034970">&#34;[&#34;</span><span class="op" id="5034973">,</span>&nbsp;<span class="builtintype" id="5034975">string</span><span class="op" id="5034981">(</span><span class="ident" id="5034982">b</span><span class="op" id="5034983">.</span><span class="ident" id="5034984">buf</span><span class="op" id="5034987">.</span><span class="ident" id="5034988">Bytes</span><span class="op" id="5034993">(</span><span class="op" id="5034994">)</span><span class="op" id="5034995">[</span><span class="ident" id="5034996">pos</span><span class="op" id="5034999">:</span><span class="ident" id="5035000">pos</span><span class="op" id="5035003">+</span><span class="ident" id="5035004">c</span><span class="op" id="5035005">.</span><span class="ident" id="5035006">size</span><span class="op" id="5035010">]</span><span class="op" id="5035011">)</span><span class="op" id="5035012">,</span>&nbsp;<span class="string" id="5035014">&#34;]&#34;</span><span class="op" id="5035017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035022">pos</span>&nbsp;<span class="op" id="5035026">+=</span>&nbsp;<span class="ident" id="5035029">c</span><span class="op" id="5035030">.</span><span class="ident" id="5035031">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5035038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5035042">print</span><span class="op" id="5035047">(</span><span class="string" id="5035048">&#34;\n&#34;</span><span class="op" id="5035052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5035055">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5035058">print</span><span class="op" id="5035063">(</span><span class="string" id="5035064">&#34;\n&#34;</span><span class="op" id="5035068">)</span><br>
<span class="lineno"></span><span class="op" id="5035070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5035073">//&nbsp;local&nbsp;error&nbsp;wrapper&nbsp;so&nbsp;we&nbsp;can&nbsp;distinguish&nbsp;errors&nbsp;we&nbsp;want&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5035143">//&nbsp;as&nbsp;errors&nbsp;from&nbsp;genuine&nbsp;panics&nbsp;(which&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;return&nbsp;as&nbsp;errors)</span><br>
<span class="lineno">210</span><span class="keyword" id="5035218">type</span>&nbsp;<span class="ident" id="5035223">osError</span>&nbsp;<span class="keyword" id="5035231">struct</span>&nbsp;<span class="op" id="5035238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035241">err</span>&nbsp;<span class="builtintype" id="5035245">error</span><br>
<span class="lineno"></span><span class="op" id="5035251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5035254">func</span>&nbsp;<span class="op" id="5035259">(</span><span class="ident" id="5035260">b</span>&nbsp;<span class="op" id="5035262">*</span><span class="ident" id="5035263">Writer</span><span class="op" id="5035269">)</span>&nbsp;<span class="ident" id="5035271">write0</span><span class="op" id="5035277">(</span><span class="ident" id="5035278">buf</span>&nbsp;<span class="op" id="5035282">[</span><span class="op" id="5035283">]</span><span class="builtintype" id="5035284">byte</span><span class="op" id="5035288">)</span>&nbsp;<span class="op" id="5035290">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035293">n</span><span class="op" id="5035294">,</span>&nbsp;<span class="ident" id="5035296">err</span>&nbsp;<span class="op" id="5035300">:=</span>&nbsp;<span class="ident" id="5035303">b</span><span class="op" id="5035304">.</span><span class="ident" id="5035305">output</span><span class="op" id="5035311">.</span><span class="ident" id="5035312">Write</span><span class="op" id="5035317">(</span><span class="ident" id="5035318">buf</span><span class="op" id="5035321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035324">if</span>&nbsp;<span class="ident" id="5035327">n</span>&nbsp;<span class="op" id="5035329">!=</span>&nbsp;<span class="builtinfunc" id="5035332">len</span><span class="op" id="5035335">(</span><span class="ident" id="5035336">buf</span><span class="op" id="5035339">)</span>&nbsp;<span class="op" id="5035341">&amp;&amp;</span>&nbsp;<span class="ident" id="5035344">err</span>&nbsp;<span class="op" id="5035348">==</span>&nbsp;<span class="ident" id="5035351">nil</span>&nbsp;<span class="op" id="5035355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035359">err</span>&nbsp;<span class="op" id="5035363">=</span>&nbsp;<span class="ident" id="5035365">io</span><span class="op" id="5035367">.</span><span class="ident" id="5035368">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5035383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035386">if</span>&nbsp;<span class="ident" id="5035389">err</span>&nbsp;<span class="op" id="5035393">!=</span>&nbsp;<span class="ident" id="5035396">nil</span>&nbsp;<span class="op" id="5035400">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5035404">panic</span><span class="op" id="5035409">(</span><span class="ident" id="5035410">osError</span><span class="op" id="5035417">{</span><span class="ident" id="5035418">err</span><span class="op" id="5035421">}</span><span class="op" id="5035422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5035425">}</span><br>
<span class="lineno"></span><span class="op" id="5035427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5035430">func</span>&nbsp;<span class="op" id="5035435">(</span><span class="ident" id="5035436">b</span>&nbsp;<span class="op" id="5035438">*</span><span class="ident" id="5035439">Writer</span><span class="op" id="5035445">)</span>&nbsp;<span class="ident" id="5035447">writeN</span><span class="op" id="5035453">(</span><span class="ident" id="5035454">src</span>&nbsp;<span class="op" id="5035458">[</span><span class="op" id="5035459">]</span><span class="builtintype" id="5035460">byte</span><span class="op" id="5035464">,</span>&nbsp;<span class="ident" id="5035466">n</span>&nbsp;<span class="builtintype" id="5035468">int</span><span class="op" id="5035471">)</span>&nbsp;<span class="op" id="5035473">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035476">for</span>&nbsp;<span class="ident" id="5035480">n</span>&nbsp;<span class="op" id="5035482">&gt;</span>&nbsp;<span class="builtinfunc" id="5035484">len</span><span class="op" id="5035487">(</span><span class="ident" id="5035488">src</span><span class="op" id="5035491">)</span>&nbsp;<span class="op" id="5035493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035497">b</span><span class="op" id="5035498">.</span><span class="ident" id="5035499">write0</span><span class="op" id="5035505">(</span><span class="ident" id="5035506">src</span><span class="op" id="5035509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035513">n</span>&nbsp;<span class="op" id="5035515">-=</span>&nbsp;<span class="builtinfunc" id="5035518">len</span><span class="op" id="5035521">(</span><span class="ident" id="5035522">src</span><span class="op" id="5035525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5035528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035531">b</span><span class="op" id="5035532">.</span><span class="ident" id="5035533">write0</span><span class="op" id="5035539">(</span><span class="ident" id="5035540">src</span><span class="op" id="5035543">[</span><span class="num" id="5035544">0</span><span class="op" id="5035545">:</span><span class="ident" id="5035546">n</span><span class="op" id="5035547">]</span><span class="op" id="5035548">)</span><br>
<span class="lineno">230</span><span class="op" id="5035550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5035553">var</span>&nbsp;<span class="op" id="5035557">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035560">newline</span>&nbsp;<span class="op" id="5035568">=</span>&nbsp;<span class="op" id="5035570">[</span><span class="op" id="5035571">]</span><span class="builtintype" id="5035572">byte</span><span class="op" id="5035576">{</span><span class="string" id="5035577">&#39;\n&#39;</span><span class="op" id="5035581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035584">tabs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5035592">=</span>&nbsp;<span class="op" id="5035594">[</span><span class="op" id="5035595">]</span><span class="builtintype" id="5035596">byte</span><span class="op" id="5035600">(</span><span class="string" id="5035601">&#34;\t\t\t\t\t\t\t\t&#34;</span><span class="op" id="5035619">)</span><br>
<span class="lineno">235</span><span class="op" id="5035621">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5035624">func</span>&nbsp;<span class="op" id="5035629">(</span><span class="ident" id="5035630">b</span>&nbsp;<span class="op" id="5035632">*</span><span class="ident" id="5035633">Writer</span><span class="op" id="5035639">)</span>&nbsp;<span class="ident" id="5035641">writePadding</span><span class="op" id="5035653">(</span><span class="ident" id="5035654">textw</span><span class="op" id="5035659">,</span>&nbsp;<span class="ident" id="5035661">cellw</span>&nbsp;<span class="builtintype" id="5035667">int</span><span class="op" id="5035670">,</span>&nbsp;<span class="ident" id="5035672">useTabs</span>&nbsp;<span class="builtintype" id="5035680">bool</span><span class="op" id="5035684">)</span>&nbsp;<span class="op" id="5035686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035689">if</span>&nbsp;<span class="ident" id="5035692">b</span><span class="op" id="5035693">.</span><span class="ident" id="5035694">padbytes</span><span class="op" id="5035702">[</span><span class="num" id="5035703">0</span><span class="op" id="5035704">]</span>&nbsp;<span class="op" id="5035706">==</span>&nbsp;<span class="string" id="5035709">&#39;\t&#39;</span>&nbsp;<span class="op" id="5035714">||</span>&nbsp;<span class="ident" id="5035717">useTabs</span>&nbsp;<span class="op" id="5035725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5035729">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;tabs</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035760">if</span>&nbsp;<span class="ident" id="5035763">b</span><span class="op" id="5035764">.</span><span class="ident" id="5035765">tabwidth</span>&nbsp;<span class="op" id="5035774">==</span>&nbsp;<span class="num" id="5035777">0</span>&nbsp;<span class="op" id="5035779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035784">return</span>&nbsp;<span class="comment" id="5035791">//&nbsp;tabs&nbsp;have&nbsp;no&nbsp;width&nbsp;-&nbsp;can&#39;t&nbsp;do&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5035838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5035842">//&nbsp;make&nbsp;cellw&nbsp;the&nbsp;smallest&nbsp;multiple&nbsp;of&nbsp;b.tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035894">cellw</span>&nbsp;<span class="op" id="5035900">=</span>&nbsp;<span class="op" id="5035902">(</span><span class="ident" id="5035903">cellw</span>&nbsp;<span class="op" id="5035909">+</span>&nbsp;<span class="ident" id="5035911">b</span><span class="op" id="5035912">.</span><span class="ident" id="5035913">tabwidth</span>&nbsp;<span class="op" id="5035922">-</span>&nbsp;<span class="num" id="5035924">1</span><span class="op" id="5035925">)</span>&nbsp;<span class="op" id="5035927">/</span>&nbsp;<span class="ident" id="5035929">b</span><span class="op" id="5035930">.</span><span class="ident" id="5035931">tabwidth</span>&nbsp;<span class="op" id="5035940">*</span>&nbsp;<span class="ident" id="5035942">b</span><span class="op" id="5035943">.</span><span class="ident" id="5035944">tabwidth</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035955">n</span>&nbsp;<span class="op" id="5035957">:=</span>&nbsp;<span class="ident" id="5035960">cellw</span>&nbsp;<span class="op" id="5035966">-</span>&nbsp;<span class="ident" id="5035968">textw</span>&nbsp;<span class="comment" id="5035974">//&nbsp;amount&nbsp;of&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035997">if</span>&nbsp;<span class="ident" id="5036000">n</span>&nbsp;<span class="op" id="5036002">&lt;</span>&nbsp;<span class="num" id="5036004">0</span>&nbsp;<span class="op" id="5036006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5036011">panic</span><span class="op" id="5036016">(</span><span class="string" id="5036017">&#34;internal&nbsp;error&#34;</span><span class="op" id="5036033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5036037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036041">b</span><span class="op" id="5036042">.</span><span class="ident" id="5036043">writeN</span><span class="op" id="5036049">(</span><span class="ident" id="5036050">tabs</span><span class="op" id="5036054">,</span>&nbsp;<span class="op" id="5036056">(</span><span class="ident" id="5036057">n</span><span class="op" id="5036058">+</span><span class="ident" id="5036059">b</span><span class="op" id="5036060">.</span><span class="ident" id="5036061">tabwidth</span><span class="op" id="5036069">-</span><span class="num" id="5036070">1</span><span class="op" id="5036071">)</span><span class="op" id="5036072">/</span><span class="ident" id="5036073">b</span><span class="op" id="5036074">.</span><span class="ident" id="5036075">tabwidth</span><span class="op" id="5036083">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5036087">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5036095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5036099">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;non-tab&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036143">b</span><span class="op" id="5036144">.</span><span class="ident" id="5036145">writeN</span><span class="op" id="5036151">(</span><span class="ident" id="5036152">b</span><span class="op" id="5036153">.</span><span class="ident" id="5036154">padbytes</span><span class="op" id="5036162">[</span><span class="num" id="5036163">0</span><span class="op" id="5036164">:</span><span class="op" id="5036165">]</span><span class="op" id="5036166">,</span>&nbsp;<span class="ident" id="5036168">cellw</span><span class="op" id="5036173">-</span><span class="ident" id="5036174">textw</span><span class="op" id="5036179">)</span><br>
<span class="lineno">255</span><span class="op" id="5036181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5036184">var</span>&nbsp;<span class="ident" id="5036188">vbar</span>&nbsp;<span class="op" id="5036193">=</span>&nbsp;<span class="op" id="5036195">[</span><span class="op" id="5036196">]</span><span class="builtintype" id="5036197">byte</span><span class="op" id="5036201">{</span><span class="string" id="5036202">&#39;|&#39;</span><span class="op" id="5036205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5036208">func</span>&nbsp;<span class="op" id="5036213">(</span><span class="ident" id="5036214">b</span>&nbsp;<span class="op" id="5036216">*</span><span class="ident" id="5036217">Writer</span><span class="op" id="5036223">)</span>&nbsp;<span class="ident" id="5036225">writeLines</span><span class="op" id="5036235">(</span><span class="ident" id="5036236">pos0</span>&nbsp;<span class="builtintype" id="5036241">int</span><span class="op" id="5036244">,</span>&nbsp;<span class="ident" id="5036246">line0</span><span class="op" id="5036251">,</span>&nbsp;<span class="ident" id="5036253">line1</span>&nbsp;<span class="builtintype" id="5036259">int</span><span class="op" id="5036262">)</span>&nbsp;<span class="op" id="5036264">(</span><span class="ident" id="5036265">pos</span>&nbsp;<span class="builtintype" id="5036269">int</span><span class="op" id="5036272">)</span>&nbsp;<span class="op" id="5036274">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036277">pos</span>&nbsp;<span class="op" id="5036281">=</span>&nbsp;<span class="ident" id="5036283">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5036289">for</span>&nbsp;<span class="ident" id="5036293">i</span>&nbsp;<span class="op" id="5036295">:=</span>&nbsp;<span class="ident" id="5036298">line0</span><span class="op" id="5036303">;</span>&nbsp;<span class="ident" id="5036305">i</span>&nbsp;<span class="op" id="5036307">&lt;</span>&nbsp;<span class="ident" id="5036309">line1</span><span class="op" id="5036314">;</span>&nbsp;<span class="ident" id="5036316">i</span><span class="op" id="5036317">++</span>&nbsp;<span class="op" id="5036320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036324">line</span>&nbsp;<span class="op" id="5036329">:=</span>&nbsp;<span class="ident" id="5036332">b</span><span class="op" id="5036333">.</span><span class="ident" id="5036334">lines</span><span class="op" id="5036339">[</span><span class="ident" id="5036340">i</span><span class="op" id="5036341">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5036346">//&nbsp;if&nbsp;TabIndent&nbsp;is&nbsp;set,&nbsp;use&nbsp;tabs&nbsp;to&nbsp;pad&nbsp;leading&nbsp;empty&nbsp;cells</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036408">useTabs</span>&nbsp;<span class="op" id="5036416">:=</span>&nbsp;<span class="ident" id="5036419">b</span><span class="op" id="5036420">.</span><span class="ident" id="5036421">flags</span><span class="op" id="5036426">&amp;</span><span class="ident" id="5036427">TabIndent</span>&nbsp;<span class="op" id="5036437">!=</span>&nbsp;<span class="num" id="5036440">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5036445">for</span>&nbsp;<span class="ident" id="5036449">j</span><span class="op" id="5036450">,</span>&nbsp;<span class="ident" id="5036452">c</span>&nbsp;<span class="op" id="5036454">:=</span>&nbsp;<span class="keyword" id="5036457">range</span>&nbsp;<span class="ident" id="5036463">line</span>&nbsp;<span class="op" id="5036468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5036473">if</span>&nbsp;<span class="ident" id="5036476">j</span>&nbsp;<span class="op" id="5036478">&gt;</span>&nbsp;<span class="num" id="5036480">0</span>&nbsp;<span class="op" id="5036482">&amp;&amp;</span>&nbsp;<span class="ident" id="5036485">b</span><span class="op" id="5036486">.</span><span class="ident" id="5036487">flags</span><span class="op" id="5036492">&amp;</span><span class="ident" id="5036493">Debug</span>&nbsp;<span class="op" id="5036499">!=</span>&nbsp;<span class="num" id="5036502">0</span>&nbsp;<span class="op" id="5036504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5036510">//&nbsp;indicate&nbsp;column&nbsp;break</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036539">b</span><span class="op" id="5036540">.</span><span class="ident" id="5036541">write0</span><span class="op" id="5036547">(</span><span class="ident" id="5036548">vbar</span><span class="op" id="5036552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5036557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5036563">if</span>&nbsp;<span class="ident" id="5036566">c</span><span class="op" id="5036567">.</span><span class="ident" id="5036568">size</span>&nbsp;<span class="op" id="5036573">==</span>&nbsp;<span class="num" id="5036576">0</span>&nbsp;<span class="op" id="5036578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5036584">//&nbsp;empty&nbsp;cell</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5036602">if</span>&nbsp;<span class="ident" id="5036605">j</span>&nbsp;<span class="op" id="5036607">&lt;</span>&nbsp;<span class="builtinfunc" id="5036609">len</span><span class="op" id="5036612">(</span><span class="ident" id="5036613">b</span><span class="op" id="5036614">.</span><span class="ident" id="5036615">widths</span><span class="op" id="5036621">)</span>&nbsp;<span class="op" id="5036623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036630">b</span><span class="op" id="5036631">.</span><span class="ident" id="5036632">writePadding</span><span class="op" id="5036644">(</span><span class="ident" id="5036645">c</span><span class="op" id="5036646">.</span><span class="ident" id="5036647">width</span><span class="op" id="5036652">,</span>&nbsp;<span class="ident" id="5036654">b</span><span class="op" id="5036655">.</span><span class="ident" id="5036656">widths</span><span class="op" id="5036662">[</span><span class="ident" id="5036663">j</span><span class="op" id="5036664">]</span><span class="op" id="5036665">,</span>&nbsp;<span class="ident" id="5036667">useTabs</span><span class="op" id="5036674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5036680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5036685">}</span>&nbsp;<span class="keyword" id="5036687">else</span>&nbsp;<span class="op" id="5036692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5036698">//&nbsp;non-empty&nbsp;cell</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036720">useTabs</span>&nbsp;<span class="op" id="5036728">=</span>&nbsp;<span class="builtintype" id="5036730">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5036740">if</span>&nbsp;<span class="ident" id="5036743">b</span><span class="op" id="5036744">.</span><span class="ident" id="5036745">flags</span><span class="op" id="5036750">&amp;</span><span class="ident" id="5036751">AlignRight</span>&nbsp;<span class="op" id="5036762">==</span>&nbsp;<span class="num" id="5036765">0</span>&nbsp;<span class="op" id="5036767">{</span>&nbsp;<span class="comment" id="5036769">//&nbsp;align&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036788">b</span><span class="op" id="5036789">.</span><span class="ident" id="5036790">write0</span><span class="op" id="5036796">(</span><span class="ident" id="5036797">b</span><span class="op" id="5036798">.</span><span class="ident" id="5036799">buf</span><span class="op" id="5036802">.</span><span class="ident" id="5036803">Bytes</span><span class="op" id="5036808">(</span><span class="op" id="5036809">)</span><span class="op" id="5036810">[</span><span class="ident" id="5036811">pos</span>&nbsp;<span class="op" id="5036815">:</span>&nbsp;<span class="ident" id="5036817">pos</span><span class="op" id="5036820">+</span><span class="ident" id="5036821">c</span><span class="op" id="5036822">.</span><span class="ident" id="5036823">size</span><span class="op" id="5036827">]</span><span class="op" id="5036828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036835">pos</span>&nbsp;<span class="op" id="5036839">+=</span>&nbsp;<span class="ident" id="5036842">c</span><span class="op" id="5036843">.</span><span class="ident" id="5036844">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5036854">if</span>&nbsp;<span class="ident" id="5036857">j</span>&nbsp;<span class="op" id="5036859">&lt;</span>&nbsp;<span class="builtinfunc" id="5036861">len</span><span class="op" id="5036864">(</span><span class="ident" id="5036865">b</span><span class="op" id="5036866">.</span><span class="ident" id="5036867">widths</span><span class="op" id="5036873">)</span>&nbsp;<span class="op" id="5036875">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036883">b</span><span class="op" id="5036884">.</span><span class="ident" id="5036885">writePadding</span><span class="op" id="5036897">(</span><span class="ident" id="5036898">c</span><span class="op" id="5036899">.</span><span class="ident" id="5036900">width</span><span class="op" id="5036905">,</span>&nbsp;<span class="ident" id="5036907">b</span><span class="op" id="5036908">.</span><span class="ident" id="5036909">widths</span><span class="op" id="5036915">[</span><span class="ident" id="5036916">j</span><span class="op" id="5036917">]</span><span class="op" id="5036918">,</span>&nbsp;<span class="builtintype" id="5036920">false</span><span class="op" id="5036925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5036932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5036938">}</span>&nbsp;<span class="keyword" id="5036940">else</span>&nbsp;<span class="op" id="5036945">{</span>&nbsp;<span class="comment" id="5036947">//&nbsp;align&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5036967">if</span>&nbsp;<span class="ident" id="5036970">j</span>&nbsp;<span class="op" id="5036972">&lt;</span>&nbsp;<span class="builtinfunc" id="5036974">len</span><span class="op" id="5036977">(</span><span class="ident" id="5036978">b</span><span class="op" id="5036979">.</span><span class="ident" id="5036980">widths</span><span class="op" id="5036986">)</span>&nbsp;<span class="op" id="5036988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036996">b</span><span class="op" id="5036997">.</span><span class="ident" id="5036998">writePadding</span><span class="op" id="5037010">(</span><span class="ident" id="5037011">c</span><span class="op" id="5037012">.</span><span class="ident" id="5037013">width</span><span class="op" id="5037018">,</span>&nbsp;<span class="ident" id="5037020">b</span><span class="op" id="5037021">.</span><span class="ident" id="5037022">widths</span><span class="op" id="5037028">[</span><span class="ident" id="5037029">j</span><span class="op" id="5037030">]</span><span class="op" id="5037031">,</span>&nbsp;<span class="builtintype" id="5037033">false</span><span class="op" id="5037038">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5037045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037052">b</span><span class="op" id="5037053">.</span><span class="ident" id="5037054">write0</span><span class="op" id="5037060">(</span><span class="ident" id="5037061">b</span><span class="op" id="5037062">.</span><span class="ident" id="5037063">buf</span><span class="op" id="5037066">.</span><span class="ident" id="5037067">Bytes</span><span class="op" id="5037072">(</span><span class="op" id="5037073">)</span><span class="op" id="5037074">[</span><span class="ident" id="5037075">pos</span>&nbsp;<span class="op" id="5037079">:</span>&nbsp;<span class="ident" id="5037081">pos</span><span class="op" id="5037084">+</span><span class="ident" id="5037085">c</span><span class="op" id="5037086">.</span><span class="ident" id="5037087">size</span><span class="op" id="5037091">]</span><span class="op" id="5037092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037099">pos</span>&nbsp;<span class="op" id="5037103">+=</span>&nbsp;<span class="ident" id="5037106">c</span><span class="op" id="5037107">.</span><span class="ident" id="5037108">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5037117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5037122">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5037126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037131">if</span>&nbsp;<span class="ident" id="5037134">i</span><span class="op" id="5037135">+</span><span class="num" id="5037136">1</span>&nbsp;<span class="op" id="5037138">==</span>&nbsp;<span class="builtinfunc" id="5037141">len</span><span class="op" id="5037144">(</span><span class="ident" id="5037145">b</span><span class="op" id="5037146">.</span><span class="ident" id="5037147">lines</span><span class="op" id="5037152">)</span>&nbsp;<span class="op" id="5037154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5037159">//&nbsp;last&nbsp;buffered&nbsp;line&nbsp;-&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;newline,&nbsp;so&nbsp;just&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5037225">//&nbsp;any&nbsp;outstanding&nbsp;buffered&nbsp;data</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037261">b</span><span class="op" id="5037262">.</span><span class="ident" id="5037263">write0</span><span class="op" id="5037269">(</span><span class="ident" id="5037270">b</span><span class="op" id="5037271">.</span><span class="ident" id="5037272">buf</span><span class="op" id="5037275">.</span><span class="ident" id="5037276">Bytes</span><span class="op" id="5037281">(</span><span class="op" id="5037282">)</span><span class="op" id="5037283">[</span><span class="ident" id="5037284">pos</span>&nbsp;<span class="op" id="5037288">:</span>&nbsp;<span class="ident" id="5037290">pos</span><span class="op" id="5037293">+</span><span class="ident" id="5037294">b</span><span class="op" id="5037295">.</span><span class="ident" id="5037296">cell</span><span class="op" id="5037300">.</span><span class="ident" id="5037301">size</span><span class="op" id="5037305">]</span><span class="op" id="5037306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037311">pos</span>&nbsp;<span class="op" id="5037315">+=</span>&nbsp;<span class="ident" id="5037318">b</span><span class="op" id="5037319">.</span><span class="ident" id="5037320">cell</span><span class="op" id="5037324">.</span><span class="ident" id="5037325">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5037332">}</span>&nbsp;<span class="keyword" id="5037334">else</span>&nbsp;<span class="op" id="5037339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5037344">//&nbsp;not&nbsp;the&nbsp;last&nbsp;line&nbsp;-&nbsp;write&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037384">b</span><span class="op" id="5037385">.</span><span class="ident" id="5037386">write0</span><span class="op" id="5037392">(</span><span class="ident" id="5037393">newline</span><span class="op" id="5037400">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5037404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5037407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037410">return</span><br>
<span class="lineno"></span><span class="op" id="5037417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="5037420">//&nbsp;Format&nbsp;the&nbsp;text&nbsp;between&nbsp;line0&nbsp;and&nbsp;line1&nbsp;(excluding&nbsp;line1);&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="5037486">//&nbsp;is&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;line0.</span><br>
<span class="lineno"></span><span class="comment" id="5037553">//&nbsp;Returns&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5037618">//&nbsp;line1&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="5037649">//</span><br>
<span class="lineno">315</span><span class="keyword" id="5037652">func</span>&nbsp;<span class="op" id="5037657">(</span><span class="ident" id="5037658">b</span>&nbsp;<span class="op" id="5037660">*</span><span class="ident" id="5037661">Writer</span><span class="op" id="5037667">)</span>&nbsp;<span class="ident" id="5037669">format</span><span class="op" id="5037675">(</span><span class="ident" id="5037676">pos0</span>&nbsp;<span class="builtintype" id="5037681">int</span><span class="op" id="5037684">,</span>&nbsp;<span class="ident" id="5037686">line0</span><span class="op" id="5037691">,</span>&nbsp;<span class="ident" id="5037693">line1</span>&nbsp;<span class="builtintype" id="5037699">int</span><span class="op" id="5037702">)</span>&nbsp;<span class="op" id="5037704">(</span><span class="ident" id="5037705">pos</span>&nbsp;<span class="builtintype" id="5037709">int</span><span class="op" id="5037712">)</span>&nbsp;<span class="op" id="5037714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037717">pos</span>&nbsp;<span class="op" id="5037721">=</span>&nbsp;<span class="ident" id="5037723">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037729">column</span>&nbsp;<span class="op" id="5037736">:=</span>&nbsp;<span class="builtinfunc" id="5037739">len</span><span class="op" id="5037742">(</span><span class="ident" id="5037743">b</span><span class="op" id="5037744">.</span><span class="ident" id="5037745">widths</span><span class="op" id="5037751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037754">for</span>&nbsp;<span class="ident" id="5037758">this</span>&nbsp;<span class="op" id="5037763">:=</span>&nbsp;<span class="ident" id="5037766">line0</span><span class="op" id="5037771">;</span>&nbsp;<span class="ident" id="5037773">this</span>&nbsp;<span class="op" id="5037778">&lt;</span>&nbsp;<span class="ident" id="5037780">line1</span><span class="op" id="5037785">;</span>&nbsp;<span class="ident" id="5037787">this</span><span class="op" id="5037791">++</span>&nbsp;<span class="op" id="5037794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037798">line</span>&nbsp;<span class="op" id="5037803">:=</span>&nbsp;<span class="ident" id="5037806">b</span><span class="op" id="5037807">.</span><span class="ident" id="5037808">lines</span><span class="op" id="5037813">[</span><span class="ident" id="5037814">this</span><span class="op" id="5037818">]</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037823">if</span>&nbsp;<span class="ident" id="5037826">column</span>&nbsp;<span class="op" id="5037833">&lt;</span>&nbsp;<span class="builtinfunc" id="5037835">len</span><span class="op" id="5037838">(</span><span class="ident" id="5037839">line</span><span class="op" id="5037843">)</span><span class="op" id="5037844">-</span><span class="num" id="5037845">1</span>&nbsp;<span class="op" id="5037847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5037852">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column&nbsp;=&gt;&nbsp;this&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5037898">//&nbsp;has&nbsp;more&nbsp;cells&nbsp;than&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5037942">//&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;is&nbsp;ignored&nbsp;because&nbsp;cells&nbsp;are</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5038001">//&nbsp;tab-terminated;&nbsp;the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5038060">//&nbsp;text&nbsp;before&nbsp;the&nbsp;newline/formfeed&nbsp;and&nbsp;does&nbsp;not&nbsp;belong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5038119">//&nbsp;to&nbsp;a&nbsp;column)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5038139">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;beginning&nbsp;of&nbsp;block</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038192">pos</span>&nbsp;<span class="op" id="5038196">=</span>&nbsp;<span class="ident" id="5038198">b</span><span class="op" id="5038199">.</span><span class="ident" id="5038200">writeLines</span><span class="op" id="5038210">(</span><span class="ident" id="5038211">pos</span><span class="op" id="5038214">,</span>&nbsp;<span class="ident" id="5038216">line0</span><span class="op" id="5038221">,</span>&nbsp;<span class="ident" id="5038223">this</span><span class="op" id="5038227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038232">line0</span>&nbsp;<span class="op" id="5038238">=</span>&nbsp;<span class="ident" id="5038240">this</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5038249">//&nbsp;column&nbsp;block&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038274">width</span>&nbsp;<span class="op" id="5038280">:=</span>&nbsp;<span class="ident" id="5038283">b</span><span class="op" id="5038284">.</span><span class="ident" id="5038285">minwidth</span>&nbsp;<span class="comment" id="5038294">//&nbsp;minimal&nbsp;column&nbsp;width</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038321">discardable</span>&nbsp;<span class="op" id="5038333">:=</span>&nbsp;<span class="builtintype" id="5038336">true</span>&nbsp;<span class="comment" id="5038341">//&nbsp;true&nbsp;if&nbsp;all&nbsp;cells&nbsp;in&nbsp;this&nbsp;column&nbsp;are&nbsp;empty&nbsp;and&nbsp;&#34;soft&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5038401">for</span>&nbsp;<span class="op" id="5038405">;</span>&nbsp;<span class="ident" id="5038407">this</span>&nbsp;<span class="op" id="5038412">&lt;</span>&nbsp;<span class="ident" id="5038414">line1</span><span class="op" id="5038419">;</span>&nbsp;<span class="ident" id="5038421">this</span><span class="op" id="5038425">++</span>&nbsp;<span class="op" id="5038428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038434">line</span>&nbsp;<span class="op" id="5038439">=</span>&nbsp;<span class="ident" id="5038441">b</span><span class="op" id="5038442">.</span><span class="ident" id="5038443">lines</span><span class="op" id="5038448">[</span><span class="ident" id="5038449">this</span><span class="op" id="5038453">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5038459">if</span>&nbsp;<span class="ident" id="5038462">column</span>&nbsp;<span class="op" id="5038469">&lt;</span>&nbsp;<span class="builtinfunc" id="5038471">len</span><span class="op" id="5038474">(</span><span class="ident" id="5038475">line</span><span class="op" id="5038479">)</span><span class="op" id="5038480">-</span><span class="num" id="5038481">1</span>&nbsp;<span class="op" id="5038483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5038490">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038525">c</span>&nbsp;<span class="op" id="5038527">:=</span>&nbsp;<span class="ident" id="5038530">line</span><span class="op" id="5038534">[</span><span class="ident" id="5038535">column</span><span class="op" id="5038541">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5038548">//&nbsp;update&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5038569">if</span>&nbsp;<span class="ident" id="5038572">w</span>&nbsp;<span class="op" id="5038574">:=</span>&nbsp;<span class="ident" id="5038577">c</span><span class="op" id="5038578">.</span><span class="ident" id="5038579">width</span>&nbsp;<span class="op" id="5038585">+</span>&nbsp;<span class="ident" id="5038587">b</span><span class="op" id="5038588">.</span><span class="ident" id="5038589">padding</span><span class="op" id="5038596">;</span>&nbsp;<span class="ident" id="5038598">w</span>&nbsp;<span class="op" id="5038600">&gt;</span>&nbsp;<span class="ident" id="5038602">width</span>&nbsp;<span class="op" id="5038608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038616">width</span>&nbsp;<span class="op" id="5038622">=</span>&nbsp;<span class="ident" id="5038624">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5038631">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5038638">//&nbsp;update&nbsp;discardable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5038665">if</span>&nbsp;<span class="ident" id="5038668">c</span><span class="op" id="5038669">.</span><span class="ident" id="5038670">width</span>&nbsp;<span class="op" id="5038676">&gt;</span>&nbsp;<span class="num" id="5038678">0</span>&nbsp;<span class="op" id="5038680">||</span>&nbsp;<span class="ident" id="5038683">c</span><span class="op" id="5038684">.</span><span class="ident" id="5038685">htab</span>&nbsp;<span class="op" id="5038690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038698">discardable</span>&nbsp;<span class="op" id="5038710">=</span>&nbsp;<span class="builtintype" id="5038712">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5038723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5038729">}</span>&nbsp;<span class="keyword" id="5038731">else</span>&nbsp;<span class="op" id="5038736">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5038743">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5038753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5038758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5038763">//&nbsp;column&nbsp;block&nbsp;end</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5038787">//&nbsp;discard&nbsp;empty&nbsp;columns&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5038828">if</span>&nbsp;<span class="ident" id="5038831">discardable</span>&nbsp;<span class="op" id="5038843">&amp;&amp;</span>&nbsp;<span class="ident" id="5038846">b</span><span class="op" id="5038847">.</span><span class="ident" id="5038848">flags</span><span class="op" id="5038853">&amp;</span><span class="ident" id="5038854">DiscardEmptyColumns</span>&nbsp;<span class="op" id="5038874">!=</span>&nbsp;<span class="num" id="5038877">0</span>&nbsp;<span class="op" id="5038879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038885">width</span>&nbsp;<span class="op" id="5038891">=</span>&nbsp;<span class="num" id="5038893">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5038898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5038904">//&nbsp;format&nbsp;and&nbsp;print&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;right&nbsp;of&nbsp;this&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5038967">//&nbsp;(we&nbsp;know&nbsp;the&nbsp;widths&nbsp;of&nbsp;this&nbsp;column&nbsp;and&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;left)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039037">b</span><span class="op" id="5039038">.</span><span class="ident" id="5039039">widths</span>&nbsp;<span class="op" id="5039046">=</span>&nbsp;<span class="builtinfunc" id="5039048">append</span><span class="op" id="5039054">(</span><span class="ident" id="5039055">b</span><span class="op" id="5039056">.</span><span class="ident" id="5039057">widths</span><span class="op" id="5039063">,</span>&nbsp;<span class="ident" id="5039065">width</span><span class="op" id="5039070">)</span>&nbsp;<span class="comment" id="5039072">//&nbsp;push&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039089">pos</span>&nbsp;<span class="op" id="5039093">=</span>&nbsp;<span class="ident" id="5039095">b</span><span class="op" id="5039096">.</span><span class="ident" id="5039097">format</span><span class="op" id="5039103">(</span><span class="ident" id="5039104">pos</span><span class="op" id="5039107">,</span>&nbsp;<span class="ident" id="5039109">line0</span><span class="op" id="5039114">,</span>&nbsp;<span class="ident" id="5039116">this</span><span class="op" id="5039120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039125">b</span><span class="op" id="5039126">.</span><span class="ident" id="5039127">widths</span>&nbsp;<span class="op" id="5039134">=</span>&nbsp;<span class="ident" id="5039136">b</span><span class="op" id="5039137">.</span><span class="ident" id="5039138">widths</span><span class="op" id="5039144">[</span><span class="num" id="5039145">0</span>&nbsp;<span class="op" id="5039147">:</span>&nbsp;<span class="builtinfunc" id="5039149">len</span><span class="op" id="5039152">(</span><span class="ident" id="5039153">b</span><span class="op" id="5039154">.</span><span class="ident" id="5039155">widths</span><span class="op" id="5039161">)</span><span class="op" id="5039162">-</span><span class="num" id="5039163">1</span><span class="op" id="5039164">]</span>&nbsp;<span class="comment" id="5039166">//&nbsp;pop&nbsp;width</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039182">line0</span>&nbsp;<span class="op" id="5039188">=</span>&nbsp;<span class="ident" id="5039190">this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5039197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5039200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5039204">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;end</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5039240">return</span>&nbsp;<span class="ident" id="5039247">b</span><span class="op" id="5039248">.</span><span class="ident" id="5039249">writeLines</span><span class="op" id="5039259">(</span><span class="ident" id="5039260">pos</span><span class="op" id="5039263">,</span>&nbsp;<span class="ident" id="5039265">line0</span><span class="op" id="5039270">,</span>&nbsp;<span class="ident" id="5039272">line1</span><span class="op" id="5039277">)</span><br>
<span class="lineno"></span><span class="op" id="5039279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5039282">//&nbsp;Append&nbsp;text&nbsp;to&nbsp;current&nbsp;cell.</span><br>
<span class="lineno"></span><span class="keyword" id="5039314">func</span>&nbsp;<span class="op" id="5039319">(</span><span class="ident" id="5039320">b</span>&nbsp;<span class="op" id="5039322">*</span><span class="ident" id="5039323">Writer</span><span class="op" id="5039329">)</span>&nbsp;<span class="builtinfunc" id="5039331">append</span><span class="op" id="5039337">(</span><span class="ident" id="5039338">text</span>&nbsp;<span class="op" id="5039343">[</span><span class="op" id="5039344">]</span><span class="builtintype" id="5039345">byte</span><span class="op" id="5039349">)</span>&nbsp;<span class="op" id="5039351">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039354">b</span><span class="op" id="5039355">.</span><span class="ident" id="5039356">buf</span><span class="op" id="5039359">.</span><span class="ident" id="5039360">Write</span><span class="op" id="5039365">(</span><span class="ident" id="5039366">text</span><span class="op" id="5039370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039373">b</span><span class="op" id="5039374">.</span><span class="ident" id="5039375">cell</span><span class="op" id="5039379">.</span><span class="ident" id="5039380">size</span>&nbsp;<span class="op" id="5039385">+=</span>&nbsp;<span class="builtinfunc" id="5039388">len</span><span class="op" id="5039391">(</span><span class="ident" id="5039392">text</span><span class="op" id="5039396">)</span><br>
<span class="lineno"></span><span class="op" id="5039398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5039401">//&nbsp;Update&nbsp;the&nbsp;cell&nbsp;width.</span><br>
<span class="lineno">380</span><span class="keyword" id="5039427">func</span>&nbsp;<span class="op" id="5039432">(</span><span class="ident" id="5039433">b</span>&nbsp;<span class="op" id="5039435">*</span><span class="ident" id="5039436">Writer</span><span class="op" id="5039442">)</span>&nbsp;<span class="ident" id="5039444">updateWidth</span><span class="op" id="5039455">(</span><span class="op" id="5039456">)</span>&nbsp;<span class="op" id="5039458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039461">b</span><span class="op" id="5039462">.</span><span class="ident" id="5039463">cell</span><span class="op" id="5039467">.</span><span class="ident" id="5039468">width</span>&nbsp;<span class="op" id="5039474">+=</span>&nbsp;<span class="ident" id="5039477">utf8</span><span class="op" id="5039481">.</span><span class="ident" id="5039482">RuneCount</span><span class="op" id="5039491">(</span><span class="ident" id="5039492">b</span><span class="op" id="5039493">.</span><span class="ident" id="5039494">buf</span><span class="op" id="5039497">.</span><span class="ident" id="5039498">Bytes</span><span class="op" id="5039503">(</span><span class="op" id="5039504">)</span><span class="op" id="5039505">[</span><span class="ident" id="5039506">b</span><span class="op" id="5039507">.</span><span class="ident" id="5039508">pos</span><span class="op" id="5039511">:</span><span class="ident" id="5039512">b</span><span class="op" id="5039513">.</span><span class="ident" id="5039514">buf</span><span class="op" id="5039517">.</span><span class="ident" id="5039518">Len</span><span class="op" id="5039521">(</span><span class="op" id="5039522">)</span><span class="op" id="5039523">]</span><span class="op" id="5039524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039527">b</span><span class="op" id="5039528">.</span><span class="ident" id="5039529">pos</span>&nbsp;<span class="op" id="5039533">=</span>&nbsp;<span class="ident" id="5039535">b</span><span class="op" id="5039536">.</span><span class="ident" id="5039537">buf</span><span class="op" id="5039540">.</span><span class="ident" id="5039541">Len</span><span class="op" id="5039544">(</span><span class="op" id="5039545">)</span><br>
<span class="lineno"></span><span class="op" id="5039547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="5039550">//&nbsp;To&nbsp;escape&nbsp;a&nbsp;text&nbsp;segment,&nbsp;bracket&nbsp;it&nbsp;with&nbsp;Escape&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="5039614">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;tab&nbsp;in&nbsp;this&nbsp;string&nbsp;&#34;Ignore&nbsp;this&nbsp;tab:&nbsp;\xff\t\xff&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5039684">//&nbsp;does&nbsp;not&nbsp;terminate&nbsp;a&nbsp;cell&nbsp;and&nbsp;constitutes&nbsp;a&nbsp;single&nbsp;character&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5039751">//&nbsp;width&nbsp;one&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="5039789">//</span><br>
<span class="lineno">390</span><span class="comment" id="5039792">//&nbsp;The&nbsp;value&nbsp;0xff&nbsp;was&nbsp;chosen&nbsp;because&nbsp;it&nbsp;cannot&nbsp;appear&nbsp;in&nbsp;a&nbsp;valid&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="5039873">//</span><br>
<span class="lineno"></span><span class="keyword" id="5039876">const</span>&nbsp;<span class="ident" id="5039882">Escape</span>&nbsp;<span class="op" id="5039889">=</span>&nbsp;<span class="string" id="5039891">&#39;\xff&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5039899">//&nbsp;Start&nbsp;escaped&nbsp;mode.</span><br>
<span class="lineno">395</span><span class="keyword" id="5039922">func</span>&nbsp;<span class="op" id="5039927">(</span><span class="ident" id="5039928">b</span>&nbsp;<span class="op" id="5039930">*</span><span class="ident" id="5039931">Writer</span><span class="op" id="5039937">)</span>&nbsp;<span class="ident" id="5039939">startEscape</span><span class="op" id="5039950">(</span><span class="ident" id="5039951">ch</span>&nbsp;<span class="builtintype" id="5039954">byte</span><span class="op" id="5039958">)</span>&nbsp;<span class="op" id="5039960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5039963">switch</span>&nbsp;<span class="ident" id="5039970">ch</span>&nbsp;<span class="op" id="5039973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5039976">case</span>&nbsp;<span class="ident" id="5039981">Escape</span><span class="op" id="5039987">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039991">b</span><span class="op" id="5039992">.</span><span class="ident" id="5039993">endChar</span>&nbsp;<span class="op" id="5040001">=</span>&nbsp;<span class="ident" id="5040003">Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040011">case</span>&nbsp;<span class="string" id="5040016">&#39;&lt;&#39;</span><span class="op" id="5040019">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040023">b</span><span class="op" id="5040024">.</span><span class="ident" id="5040025">endChar</span>&nbsp;<span class="op" id="5040033">=</span>&nbsp;<span class="string" id="5040035">&#39;&gt;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040040">case</span>&nbsp;<span class="string" id="5040045">&#39;&amp;&#39;</span><span class="op" id="5040048">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040052">b</span><span class="op" id="5040053">.</span><span class="ident" id="5040054">endChar</span>&nbsp;<span class="op" id="5040062">=</span>&nbsp;<span class="string" id="5040064">&#39;;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5040069">}</span><br>
<span class="lineno"></span><span class="op" id="5040071">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="5040074">//&nbsp;Terminate&nbsp;escaped&nbsp;mode.&nbsp;If&nbsp;the&nbsp;escaped&nbsp;text&nbsp;was&nbsp;an&nbsp;HTML&nbsp;tag,&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="5040148">//&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;for&nbsp;formatting&nbsp;purposes;&nbsp;if&nbsp;it&nbsp;was&nbsp;an&nbsp;HTML&nbsp;entity,</span><br>
<span class="lineno"></span><span class="comment" id="5040224">//&nbsp;its&nbsp;width&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;one.&nbsp;In&nbsp;all&nbsp;other&nbsp;cases,&nbsp;the&nbsp;width&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5040296">//&nbsp;unicode&nbsp;width&nbsp;of&nbsp;the&nbsp;text.</span><br>
<span class="lineno">410</span><span class="comment" id="5040326">//</span><br>
<span class="lineno"></span><span class="keyword" id="5040329">func</span>&nbsp;<span class="op" id="5040334">(</span><span class="ident" id="5040335">b</span>&nbsp;<span class="op" id="5040337">*</span><span class="ident" id="5040338">Writer</span><span class="op" id="5040344">)</span>&nbsp;<span class="ident" id="5040346">endEscape</span><span class="op" id="5040355">(</span><span class="op" id="5040356">)</span>&nbsp;<span class="op" id="5040358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040361">switch</span>&nbsp;<span class="ident" id="5040368">b</span><span class="op" id="5040369">.</span><span class="ident" id="5040370">endChar</span>&nbsp;<span class="op" id="5040378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040381">case</span>&nbsp;<span class="ident" id="5040386">Escape</span><span class="op" id="5040392">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040396">b</span><span class="op" id="5040397">.</span><span class="ident" id="5040398">updateWidth</span><span class="op" id="5040409">(</span><span class="op" id="5040410">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040414">if</span>&nbsp;<span class="ident" id="5040417">b</span><span class="op" id="5040418">.</span><span class="ident" id="5040419">flags</span><span class="op" id="5040424">&amp;</span><span class="ident" id="5040425">StripEscape</span>&nbsp;<span class="op" id="5040437">==</span>&nbsp;<span class="num" id="5040440">0</span>&nbsp;<span class="op" id="5040442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040447">b</span><span class="op" id="5040448">.</span><span class="ident" id="5040449">cell</span><span class="op" id="5040453">.</span><span class="ident" id="5040454">width</span>&nbsp;<span class="op" id="5040460">-=</span>&nbsp;<span class="num" id="5040463">2</span>&nbsp;<span class="comment" id="5040465">//&nbsp;don&#39;t&nbsp;count&nbsp;the&nbsp;Escape&nbsp;chars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5040499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040502">case</span>&nbsp;<span class="string" id="5040507">&#39;&gt;&#39;</span><span class="op" id="5040510">:</span>&nbsp;<span class="comment" id="5040512">//&nbsp;tag&nbsp;of&nbsp;zero&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040534">case</span>&nbsp;<span class="string" id="5040539">&#39;;&#39;</span><span class="op" id="5040542">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040546">b</span><span class="op" id="5040547">.</span><span class="ident" id="5040548">cell</span><span class="op" id="5040552">.</span><span class="ident" id="5040553">width</span><span class="op" id="5040558">++</span>&nbsp;<span class="comment" id="5040561">//&nbsp;entity,&nbsp;count&nbsp;as&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5040591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040594">b</span><span class="op" id="5040595">.</span><span class="ident" id="5040596">pos</span>&nbsp;<span class="op" id="5040600">=</span>&nbsp;<span class="ident" id="5040602">b</span><span class="op" id="5040603">.</span><span class="ident" id="5040604">buf</span><span class="op" id="5040607">.</span><span class="ident" id="5040608">Len</span><span class="op" id="5040611">(</span><span class="op" id="5040612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040615">b</span><span class="op" id="5040616">.</span><span class="ident" id="5040617">endChar</span>&nbsp;<span class="op" id="5040625">=</span>&nbsp;<span class="num" id="5040627">0</span><br>
<span class="lineno"></span><span class="op" id="5040629">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="comment" id="5040632">//&nbsp;Terminate&nbsp;the&nbsp;current&nbsp;cell&nbsp;by&nbsp;adding&nbsp;it&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;cells&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5040703">//&nbsp;current&nbsp;line.&nbsp;Returns&nbsp;the&nbsp;number&nbsp;of&nbsp;cells&nbsp;in&nbsp;that&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="5040762">//</span><br>
<span class="lineno"></span><span class="keyword" id="5040765">func</span>&nbsp;<span class="op" id="5040770">(</span><span class="ident" id="5040771">b</span>&nbsp;<span class="op" id="5040773">*</span><span class="ident" id="5040774">Writer</span><span class="op" id="5040780">)</span>&nbsp;<span class="ident" id="5040782">terminateCell</span><span class="op" id="5040795">(</span><span class="ident" id="5040796">htab</span>&nbsp;<span class="builtintype" id="5040801">bool</span><span class="op" id="5040805">)</span>&nbsp;<span class="builtintype" id="5040807">int</span>&nbsp;<span class="op" id="5040811">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040814">b</span><span class="op" id="5040815">.</span><span class="ident" id="5040816">cell</span><span class="op" id="5040820">.</span><span class="ident" id="5040821">htab</span>&nbsp;<span class="op" id="5040826">=</span>&nbsp;<span class="ident" id="5040828">htab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040834">line</span>&nbsp;<span class="op" id="5040839">:=</span>&nbsp;<span class="op" id="5040842">&amp;</span><span class="ident" id="5040843">b</span><span class="op" id="5040844">.</span><span class="ident" id="5040845">lines</span><span class="op" id="5040850">[</span><span class="builtinfunc" id="5040851">len</span><span class="op" id="5040854">(</span><span class="ident" id="5040855">b</span><span class="op" id="5040856">.</span><span class="ident" id="5040857">lines</span><span class="op" id="5040862">)</span><span class="op" id="5040863">-</span><span class="num" id="5040864">1</span><span class="op" id="5040865">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5040868">*</span><span class="ident" id="5040869">line</span>&nbsp;<span class="op" id="5040874">=</span>&nbsp;<span class="builtinfunc" id="5040876">append</span><span class="op" id="5040882">(</span><span class="op" id="5040883">*</span><span class="ident" id="5040884">line</span><span class="op" id="5040888">,</span>&nbsp;<span class="ident" id="5040890">b</span><span class="op" id="5040891">.</span><span class="ident" id="5040892">cell</span><span class="op" id="5040896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040899">b</span><span class="op" id="5040900">.</span><span class="ident" id="5040901">cell</span>&nbsp;<span class="op" id="5040906">=</span>&nbsp;<span class="ident" id="5040908">cell</span><span class="op" id="5040912">{</span><span class="op" id="5040913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040916">return</span>&nbsp;<span class="builtinfunc" id="5040923">len</span><span class="op" id="5040926">(</span><span class="op" id="5040927">*</span><span class="ident" id="5040928">line</span><span class="op" id="5040932">)</span><br>
<span class="lineno">435</span><span class="op" id="5040934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5040937">func</span>&nbsp;<span class="ident" id="5040942">handlePanic</span><span class="op" id="5040953">(</span><span class="ident" id="5040954">err</span>&nbsp;<span class="op" id="5040958">*</span><span class="builtintype" id="5040959">error</span><span class="op" id="5040964">,</span>&nbsp;<span class="ident" id="5040966">op</span>&nbsp;<span class="builtintype" id="5040969">string</span><span class="op" id="5040975">)</span>&nbsp;<span class="op" id="5040977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040980">if</span>&nbsp;<span class="ident" id="5040983">e</span>&nbsp;<span class="op" id="5040985">:=</span>&nbsp;<span class="builtinfunc" id="5040988">recover</span><span class="op" id="5040995">(</span><span class="op" id="5040996">)</span><span class="op" id="5040997">;</span>&nbsp;<span class="ident" id="5040999">e</span>&nbsp;<span class="op" id="5041001">!=</span>&nbsp;<span class="ident" id="5041004">nil</span>&nbsp;<span class="op" id="5041008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041012">if</span>&nbsp;<span class="ident" id="5041015">nerr</span><span class="op" id="5041019">,</span>&nbsp;<span class="ident" id="5041021">ok</span>&nbsp;<span class="op" id="5041024">:=</span>&nbsp;<span class="ident" id="5041027">e</span><span class="op" id="5041028">.</span><span class="op" id="5041029">(</span><span class="ident" id="5041030">osError</span><span class="op" id="5041037">)</span><span class="op" id="5041038">;</span>&nbsp;<span class="ident" id="5041040">ok</span>&nbsp;<span class="op" id="5041043">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041048">*</span><span class="ident" id="5041049">err</span>&nbsp;<span class="op" id="5041053">=</span>&nbsp;<span class="ident" id="5041055">nerr</span><span class="op" id="5041059">.</span><span class="ident" id="5041060">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041067">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5041080">panic</span><span class="op" id="5041085">(</span><span class="string" id="5041086">&#34;tabwriter:&nbsp;panic&nbsp;during&nbsp;&#34;</span>&nbsp;<span class="op" id="5041113">+</span>&nbsp;<span class="ident" id="5041115">op</span><span class="op" id="5041117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041120">}</span><br>
<span class="lineno">445</span><span class="op" id="5041122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5041125">//&nbsp;Flush&nbsp;should&nbsp;be&nbsp;called&nbsp;after&nbsp;the&nbsp;last&nbsp;call&nbsp;to&nbsp;Write&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="5041190">//&nbsp;that&nbsp;any&nbsp;data&nbsp;buffered&nbsp;in&nbsp;the&nbsp;Writer&nbsp;is&nbsp;written&nbsp;to&nbsp;output.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="5041256">//&nbsp;incomplete&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;end&nbsp;is&nbsp;considered</span><br>
<span class="lineno">450</span><span class="comment" id="5041311">//&nbsp;complete&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="5041348">//</span><br>
<span class="lineno"></span><span class="keyword" id="5041351">func</span>&nbsp;<span class="op" id="5041356">(</span><span class="ident" id="5041357">b</span>&nbsp;<span class="op" id="5041359">*</span><span class="ident" id="5041360">Writer</span><span class="op" id="5041366">)</span>&nbsp;<span class="ident" id="5041368">Flush</span><span class="op" id="5041373">(</span><span class="op" id="5041374">)</span>&nbsp;<span class="op" id="5041376">(</span><span class="ident" id="5041377">err</span>&nbsp;<span class="builtintype" id="5041381">error</span><span class="op" id="5041386">)</span>&nbsp;<span class="op" id="5041388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041391">defer</span>&nbsp;<span class="ident" id="5041397">b</span><span class="op" id="5041398">.</span><span class="ident" id="5041399">reset</span><span class="op" id="5041404">(</span><span class="op" id="5041405">)</span>&nbsp;<span class="comment" id="5041407">//&nbsp;even&nbsp;in&nbsp;the&nbsp;presence&nbsp;of&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041442">defer</span>&nbsp;<span class="ident" id="5041448">handlePanic</span><span class="op" id="5041459">(</span><span class="op" id="5041460">&amp;</span><span class="ident" id="5041461">err</span><span class="op" id="5041464">,</span>&nbsp;<span class="string" id="5041466">&#34;Flush&#34;</span><span class="op" id="5041473">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5041477">//&nbsp;add&nbsp;current&nbsp;cell&nbsp;if&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041511">if</span>&nbsp;<span class="ident" id="5041514">b</span><span class="op" id="5041515">.</span><span class="ident" id="5041516">cell</span><span class="op" id="5041520">.</span><span class="ident" id="5041521">size</span>&nbsp;<span class="op" id="5041526">&gt;</span>&nbsp;<span class="num" id="5041528">0</span>&nbsp;<span class="op" id="5041530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041534">if</span>&nbsp;<span class="ident" id="5041537">b</span><span class="op" id="5041538">.</span><span class="ident" id="5041539">endChar</span>&nbsp;<span class="op" id="5041547">!=</span>&nbsp;<span class="num" id="5041550">0</span>&nbsp;<span class="op" id="5041552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5041557">//&nbsp;inside&nbsp;escape&nbsp;-&nbsp;terminate&nbsp;it&nbsp;even&nbsp;if&nbsp;incomplete</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041611">b</span><span class="op" id="5041612">.</span><span class="ident" id="5041613">endEscape</span><span class="op" id="5041622">(</span><span class="op" id="5041623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041631">b</span><span class="op" id="5041632">.</span><span class="ident" id="5041633">terminateCell</span><span class="op" id="5041646">(</span><span class="builtintype" id="5041647">false</span><span class="op" id="5041652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5041659">//&nbsp;format&nbsp;contents&nbsp;of&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041689">b</span><span class="op" id="5041690">.</span><span class="ident" id="5041691">format</span><span class="op" id="5041697">(</span><span class="num" id="5041698">0</span><span class="op" id="5041699">,</span>&nbsp;<span class="num" id="5041701">0</span><span class="op" id="5041702">,</span>&nbsp;<span class="builtinfunc" id="5041704">len</span><span class="op" id="5041707">(</span><span class="ident" id="5041708">b</span><span class="op" id="5041709">.</span><span class="ident" id="5041710">lines</span><span class="op" id="5041715">)</span><span class="op" id="5041716">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041720">return</span><br>
<span class="lineno"></span><span class="op" id="5041727">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="5041730">var</span>&nbsp;<span class="ident" id="5041734">hbar</span>&nbsp;<span class="op" id="5041739">=</span>&nbsp;<span class="op" id="5041741">[</span><span class="op" id="5041742">]</span><span class="builtintype" id="5041743">byte</span><span class="op" id="5041747">(</span><span class="string" id="5041748">&#34;---\n&#34;</span><span class="op" id="5041755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5041758">//&nbsp;Write&nbsp;writes&nbsp;buf&nbsp;to&nbsp;the&nbsp;writer&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="5041795">//&nbsp;The&nbsp;only&nbsp;errors&nbsp;returned&nbsp;are&nbsp;ones&nbsp;encountered</span><br>
<span class="lineno">475</span><span class="comment" id="5041844">//&nbsp;while&nbsp;writing&nbsp;to&nbsp;the&nbsp;underlying&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="5041894">//</span><br>
<span class="lineno"></span><span class="keyword" id="5041897">func</span>&nbsp;<span class="op" id="5041902">(</span><span class="ident" id="5041903">b</span>&nbsp;<span class="op" id="5041905">*</span><span class="ident" id="5041906">Writer</span><span class="op" id="5041912">)</span>&nbsp;<span class="ident" id="5041914">Write</span><span class="op" id="5041919">(</span><span class="ident" id="5041920">buf</span>&nbsp;<span class="op" id="5041924">[</span><span class="op" id="5041925">]</span><span class="builtintype" id="5041926">byte</span><span class="op" id="5041930">)</span>&nbsp;<span class="op" id="5041932">(</span><span class="ident" id="5041933">n</span>&nbsp;<span class="builtintype" id="5041935">int</span><span class="op" id="5041938">,</span>&nbsp;<span class="ident" id="5041940">err</span>&nbsp;<span class="builtintype" id="5041944">error</span><span class="op" id="5041949">)</span>&nbsp;<span class="op" id="5041951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041954">defer</span>&nbsp;<span class="ident" id="5041960">handlePanic</span><span class="op" id="5041971">(</span><span class="op" id="5041972">&amp;</span><span class="ident" id="5041973">err</span><span class="op" id="5041976">,</span>&nbsp;<span class="string" id="5041978">&#34;Write&#34;</span><span class="op" id="5041985">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5041989">//&nbsp;split&nbsp;text&nbsp;into&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042015">n</span>&nbsp;<span class="op" id="5042017">=</span>&nbsp;<span class="num" id="5042019">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042022">for</span>&nbsp;<span class="ident" id="5042026">i</span><span class="op" id="5042027">,</span>&nbsp;<span class="ident" id="5042029">ch</span>&nbsp;<span class="op" id="5042032">:=</span>&nbsp;<span class="keyword" id="5042035">range</span>&nbsp;<span class="ident" id="5042041">buf</span>&nbsp;<span class="op" id="5042045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042049">if</span>&nbsp;<span class="ident" id="5042052">b</span><span class="op" id="5042053">.</span><span class="ident" id="5042054">endChar</span>&nbsp;<span class="op" id="5042062">==</span>&nbsp;<span class="num" id="5042065">0</span>&nbsp;<span class="op" id="5042067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042072">//&nbsp;outside&nbsp;escape</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042093">switch</span>&nbsp;<span class="ident" id="5042100">ch</span>&nbsp;<span class="op" id="5042103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042108">case</span>&nbsp;<span class="string" id="5042113">&#39;\t&#39;</span><span class="op" id="5042117">,</span>&nbsp;<span class="string" id="5042119">&#39;\v&#39;</span><span class="op" id="5042123">,</span>&nbsp;<span class="string" id="5042125">&#39;\n&#39;</span><span class="op" id="5042129">,</span>&nbsp;<span class="string" id="5042131">&#39;\f&#39;</span><span class="op" id="5042135">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042141">//&nbsp;end&nbsp;of&nbsp;cell</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042160">b</span><span class="op" id="5042161">.</span><span class="builtinfunc" id="5042162">append</span><span class="op" id="5042168">(</span><span class="ident" id="5042169">buf</span><span class="op" id="5042172">[</span><span class="ident" id="5042173">n</span><span class="op" id="5042174">:</span><span class="ident" id="5042175">i</span><span class="op" id="5042176">]</span><span class="op" id="5042177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042183">b</span><span class="op" id="5042184">.</span><span class="ident" id="5042185">updateWidth</span><span class="op" id="5042196">(</span><span class="op" id="5042197">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042203">n</span>&nbsp;<span class="op" id="5042205">=</span>&nbsp;<span class="ident" id="5042207">i</span>&nbsp;<span class="op" id="5042209">+</span>&nbsp;<span class="num" id="5042211">1</span>&nbsp;<span class="comment" id="5042213">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042232">ncells</span>&nbsp;<span class="op" id="5042239">:=</span>&nbsp;<span class="ident" id="5042242">b</span><span class="op" id="5042243">.</span><span class="ident" id="5042244">terminateCell</span><span class="op" id="5042257">(</span><span class="ident" id="5042258">ch</span>&nbsp;<span class="op" id="5042261">==</span>&nbsp;<span class="string" id="5042264">&#39;\t&#39;</span><span class="op" id="5042268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042274">if</span>&nbsp;<span class="ident" id="5042277">ch</span>&nbsp;<span class="op" id="5042280">==</span>&nbsp;<span class="string" id="5042283">&#39;\n&#39;</span>&nbsp;<span class="op" id="5042288">||</span>&nbsp;<span class="ident" id="5042291">ch</span>&nbsp;<span class="op" id="5042294">==</span>&nbsp;<span class="string" id="5042297">&#39;\f&#39;</span>&nbsp;<span class="op" id="5042302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042309">//&nbsp;terminate&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042332">b</span><span class="op" id="5042333">.</span><span class="ident" id="5042334">addLine</span><span class="op" id="5042341">(</span><span class="op" id="5042342">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042349">if</span>&nbsp;<span class="ident" id="5042352">ch</span>&nbsp;<span class="op" id="5042355">==</span>&nbsp;<span class="string" id="5042358">&#39;\f&#39;</span>&nbsp;<span class="op" id="5042363">||</span>&nbsp;<span class="ident" id="5042366">ncells</span>&nbsp;<span class="op" id="5042373">==</span>&nbsp;<span class="num" id="5042376">1</span>&nbsp;<span class="op" id="5042378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042386">//&nbsp;A&nbsp;&#39;\f&#39;&nbsp;always&nbsp;forces&nbsp;a&nbsp;flush.&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;previous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042452">//&nbsp;line&nbsp;has&nbsp;only&nbsp;one&nbsp;cell&nbsp;which&nbsp;does&nbsp;not&nbsp;have&nbsp;an&nbsp;impact&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042517">//&nbsp;the&nbsp;formatting&nbsp;of&nbsp;the&nbsp;following&nbsp;lines&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042583">//&nbsp;line&nbsp;is&nbsp;ignored&nbsp;by&nbsp;format()),&nbsp;thus&nbsp;we&nbsp;can&nbsp;flush&nbsp;the</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042644">//&nbsp;Writer&nbsp;contents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042670">if</span>&nbsp;<span class="ident" id="5042673">err</span>&nbsp;<span class="op" id="5042677">=</span>&nbsp;<span class="ident" id="5042679">b</span><span class="op" id="5042680">.</span><span class="ident" id="5042681">Flush</span><span class="op" id="5042686">(</span><span class="op" id="5042687">)</span><span class="op" id="5042688">;</span>&nbsp;<span class="ident" id="5042690">err</span>&nbsp;<span class="op" id="5042694">!=</span>&nbsp;<span class="ident" id="5042697">nil</span>&nbsp;<span class="op" id="5042701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042710">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042731">if</span>&nbsp;<span class="ident" id="5042734">ch</span>&nbsp;<span class="op" id="5042737">==</span>&nbsp;<span class="string" id="5042740">&#39;\f&#39;</span>&nbsp;<span class="op" id="5042745">&amp;&amp;</span>&nbsp;<span class="ident" id="5042748">b</span><span class="op" id="5042749">.</span><span class="ident" id="5042750">flags</span><span class="op" id="5042755">&amp;</span><span class="ident" id="5042756">Debug</span>&nbsp;<span class="op" id="5042762">!=</span>&nbsp;<span class="num" id="5042765">0</span>&nbsp;<span class="op" id="5042767">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042776">//&nbsp;indicate&nbsp;section&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042809">b</span><span class="op" id="5042810">.</span><span class="ident" id="5042811">write0</span><span class="op" id="5042817">(</span><span class="ident" id="5042818">hbar</span><span class="op" id="5042822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042843">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042849">case</span>&nbsp;<span class="ident" id="5042854">Escape</span><span class="op" id="5042860">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042866">//&nbsp;start&nbsp;of&nbsp;escaped&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042899">b</span><span class="op" id="5042900">.</span><span class="builtinfunc" id="5042901">append</span><span class="op" id="5042907">(</span><span class="ident" id="5042908">buf</span><span class="op" id="5042911">[</span><span class="ident" id="5042912">n</span><span class="op" id="5042913">:</span><span class="ident" id="5042914">i</span><span class="op" id="5042915">]</span><span class="op" id="5042916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042922">b</span><span class="op" id="5042923">.</span><span class="ident" id="5042924">updateWidth</span><span class="op" id="5042935">(</span><span class="op" id="5042936">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042942">n</span>&nbsp;<span class="op" id="5042944">=</span>&nbsp;<span class="ident" id="5042946">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042952">if</span>&nbsp;<span class="ident" id="5042955">b</span><span class="op" id="5042956">.</span><span class="ident" id="5042957">flags</span><span class="op" id="5042962">&amp;</span><span class="ident" id="5042963">StripEscape</span>&nbsp;<span class="op" id="5042975">!=</span>&nbsp;<span class="num" id="5042978">0</span>&nbsp;<span class="op" id="5042980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042987">n</span><span class="op" id="5042988">++</span>&nbsp;<span class="comment" id="5042991">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5043011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043017">b</span><span class="op" id="5043018">.</span><span class="ident" id="5043019">startEscape</span><span class="op" id="5043030">(</span><span class="ident" id="5043031">Escape</span><span class="op" id="5043037">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043043">case</span>&nbsp;<span class="string" id="5043048">&#39;&lt;&#39;</span><span class="op" id="5043051">,</span>&nbsp;<span class="string" id="5043053">&#39;&amp;&#39;</span><span class="op" id="5043056">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5043062">//&nbsp;possibly&nbsp;an&nbsp;html&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043097">if</span>&nbsp;<span class="ident" id="5043100">b</span><span class="op" id="5043101">.</span><span class="ident" id="5043102">flags</span><span class="op" id="5043107">&amp;</span><span class="ident" id="5043108">FilterHTML</span>&nbsp;<span class="op" id="5043119">!=</span>&nbsp;<span class="num" id="5043122">0</span>&nbsp;<span class="op" id="5043124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5043131">//&nbsp;begin&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043159">b</span><span class="op" id="5043160">.</span><span class="builtinfunc" id="5043161">append</span><span class="op" id="5043167">(</span><span class="ident" id="5043168">buf</span><span class="op" id="5043171">[</span><span class="ident" id="5043172">n</span><span class="op" id="5043173">:</span><span class="ident" id="5043174">i</span><span class="op" id="5043175">]</span><span class="op" id="5043176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043183">b</span><span class="op" id="5043184">.</span><span class="ident" id="5043185">updateWidth</span><span class="op" id="5043196">(</span><span class="op" id="5043197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043204">n</span>&nbsp;<span class="op" id="5043206">=</span>&nbsp;<span class="ident" id="5043208">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043215">b</span><span class="op" id="5043216">.</span><span class="ident" id="5043217">startEscape</span><span class="op" id="5043228">(</span><span class="ident" id="5043229">ch</span><span class="op" id="5043231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5043237">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5043242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5043247">}</span>&nbsp;<span class="keyword" id="5043249">else</span>&nbsp;<span class="op" id="5043254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5043259">//&nbsp;inside&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043279">if</span>&nbsp;<span class="ident" id="5043282">ch</span>&nbsp;<span class="op" id="5043285">==</span>&nbsp;<span class="ident" id="5043288">b</span><span class="op" id="5043289">.</span><span class="ident" id="5043290">endChar</span>&nbsp;<span class="op" id="5043298">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5043304">//&nbsp;end&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043329">j</span>&nbsp;<span class="op" id="5043331">:=</span>&nbsp;<span class="ident" id="5043334">i</span>&nbsp;<span class="op" id="5043336">+</span>&nbsp;<span class="num" id="5043338">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043344">if</span>&nbsp;<span class="ident" id="5043347">ch</span>&nbsp;<span class="op" id="5043350">==</span>&nbsp;<span class="ident" id="5043353">Escape</span>&nbsp;<span class="op" id="5043360">&amp;&amp;</span>&nbsp;<span class="ident" id="5043363">b</span><span class="op" id="5043364">.</span><span class="ident" id="5043365">flags</span><span class="op" id="5043370">&amp;</span><span class="ident" id="5043371">StripEscape</span>&nbsp;<span class="op" id="5043383">!=</span>&nbsp;<span class="num" id="5043386">0</span>&nbsp;<span class="op" id="5043388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043395">j</span>&nbsp;<span class="op" id="5043397">=</span>&nbsp;<span class="ident" id="5043399">i</span>&nbsp;<span class="comment" id="5043401">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5043421">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043427">b</span><span class="op" id="5043428">.</span><span class="builtinfunc" id="5043429">append</span><span class="op" id="5043435">(</span><span class="ident" id="5043436">buf</span><span class="op" id="5043439">[</span><span class="ident" id="5043440">n</span><span class="op" id="5043441">:</span><span class="ident" id="5043442">j</span><span class="op" id="5043443">]</span><span class="op" id="5043444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043450">n</span>&nbsp;<span class="op" id="5043452">=</span>&nbsp;<span class="ident" id="5043454">i</span>&nbsp;<span class="op" id="5043456">+</span>&nbsp;<span class="num" id="5043458">1</span>&nbsp;<span class="comment" id="5043460">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043479">b</span><span class="op" id="5043480">.</span><span class="ident" id="5043481">endEscape</span><span class="op" id="5043490">(</span><span class="op" id="5043491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5043496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5043500">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5043503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5043507">//&nbsp;append&nbsp;leftover&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043532">b</span><span class="op" id="5043533">.</span><span class="builtinfunc" id="5043534">append</span><span class="op" id="5043540">(</span><span class="ident" id="5043541">buf</span><span class="op" id="5043544">[</span><span class="ident" id="5043545">n</span><span class="op" id="5043546">:</span><span class="op" id="5043547">]</span><span class="op" id="5043548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043551">n</span>&nbsp;<span class="op" id="5043553">=</span>&nbsp;<span class="builtinfunc" id="5043555">len</span><span class="op" id="5043558">(</span><span class="ident" id="5043559">buf</span><span class="op" id="5043562">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043565">return</span><br>
<span class="lineno"></span><span class="op" id="5043572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5043575">//&nbsp;NewWriter&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;tabwriter.Writer.</span><br>
<span class="lineno"></span><span class="comment" id="5043638">//&nbsp;The&nbsp;parameters&nbsp;are&nbsp;the&nbsp;same&nbsp;as&nbsp;for&nbsp;the&nbsp;Init&nbsp;function.</span><br>
<span class="lineno">555</span><span class="comment" id="5043695">//</span><br>
<span class="lineno"></span><span class="keyword" id="5043698">func</span>&nbsp;<span class="ident" id="5043703">NewWriter</span><span class="op" id="5043712">(</span><span class="ident" id="5043713">output</span>&nbsp;<span class="ident" id="5043720">io</span><span class="op" id="5043722">.</span><span class="ident" id="5043723">Writer</span><span class="op" id="5043729">,</span>&nbsp;<span class="ident" id="5043731">minwidth</span><span class="op" id="5043739">,</span>&nbsp;<span class="ident" id="5043741">tabwidth</span><span class="op" id="5043749">,</span>&nbsp;<span class="ident" id="5043751">padding</span>&nbsp;<span class="builtintype" id="5043759">int</span><span class="op" id="5043762">,</span>&nbsp;<span class="ident" id="5043764">padchar</span>&nbsp;<span class="builtintype" id="5043772">byte</span><span class="op" id="5043776">,</span>&nbsp;<span class="ident" id="5043778">flags</span>&nbsp;<span class="builtintype" id="5043784">uint</span><span class="op" id="5043788">)</span>&nbsp;<span class="op" id="5043790">*</span><span class="ident" id="5043791">Writer</span>&nbsp;<span class="op" id="5043798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043801">return</span>&nbsp;<span class="builtinfunc" id="5043808">new</span><span class="op" id="5043811">(</span><span class="ident" id="5043812">Writer</span><span class="op" id="5043818">)</span><span class="op" id="5043819">.</span><span class="ident" id="5043820">Init</span><span class="op" id="5043824">(</span><span class="ident" id="5043825">output</span><span class="op" id="5043831">,</span>&nbsp;<span class="ident" id="5043833">minwidth</span><span class="op" id="5043841">,</span>&nbsp;<span class="ident" id="5043843">tabwidth</span><span class="op" id="5043851">,</span>&nbsp;<span class="ident" id="5043853">padding</span><span class="op" id="5043860">,</span>&nbsp;<span class="ident" id="5043862">padchar</span><span class="op" id="5043869">,</span>&nbsp;<span class="ident" id="5043871">flags</span><span class="op" id="5043876">)</span><br>
<span class="lineno"></span><span class="op" id="5043878">}</span>
</div>
</body>
</html>
