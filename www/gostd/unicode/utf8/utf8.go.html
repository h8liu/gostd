<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>unicode/utf8</h2>
<ul>
<li><a href="/gostd/unicode/utf8/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8.go.html" class="current">utf8.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8_test.go.html">utf8_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1769969">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1770024">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1770078">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1770129">//&nbsp;Package&nbsp;utf8&nbsp;implements&nbsp;functions&nbsp;and&nbsp;constants&nbsp;to&nbsp;support&nbsp;text&nbsp;encoded&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1770207">//&nbsp;UTF-8.&nbsp;It&nbsp;includes&nbsp;functions&nbsp;to&nbsp;translate&nbsp;between&nbsp;runes&nbsp;and&nbsp;UTF-8&nbsp;byte&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="keyword" id="1770292">package</span>&nbsp;<span class="ident" id="1770300">utf8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1770306">//&nbsp;The&nbsp;conditions&nbsp;RuneError==unicode.ReplacementChar&nbsp;and</span><br>
<span class="lineno">10</span><span class="comment" id="1770363">//&nbsp;MaxRune==unicode.MaxRune&nbsp;are&nbsp;verified&nbsp;in&nbsp;the&nbsp;tests.</span><br>
<span class="lineno"></span><span class="comment" id="1770418">//&nbsp;Defining&nbsp;them&nbsp;locally&nbsp;avoids&nbsp;this&nbsp;package&nbsp;depending&nbsp;on&nbsp;package&nbsp;unicode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1770494">//&nbsp;Numbers&nbsp;fundamental&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="1770534">const</span>&nbsp;<span class="op" id="1770540">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770543">RuneError</span>&nbsp;<span class="op" id="1770553">=</span>&nbsp;<span class="string" id="1770555">&#39;\uFFFD&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1770568">//&nbsp;the&nbsp;&#34;error&#34;&nbsp;Rune&nbsp;or&nbsp;&#34;Unicode&nbsp;replacement&nbsp;character&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770624">RuneSelf</span>&nbsp;&nbsp;<span class="op" id="1770634">=</span>&nbsp;<span class="num" id="1770636">0x80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1770649">//&nbsp;characters&nbsp;below&nbsp;Runeself&nbsp;are&nbsp;represented&nbsp;as&nbsp;themselves&nbsp;in&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770727">MaxRune</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1770737">=</span>&nbsp;<span class="string" id="1770739">&#39;\U0010FFFF&#39;</span>&nbsp;<span class="comment" id="1770752">//&nbsp;Maximum&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770790">UTFMax</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1770800">=</span>&nbsp;<span class="num" id="1770802">4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1770815">//&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;a&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character.</span><br>
<span class="lineno"></span><span class="op" id="1770880">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="1770883">//&nbsp;Code&nbsp;points&nbsp;in&nbsp;the&nbsp;surrogate&nbsp;range&nbsp;are&nbsp;not&nbsp;valid&nbsp;for&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="1770946">const</span>&nbsp;<span class="op" id="1770952">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770955">surrogateMin</span>&nbsp;<span class="op" id="1770968">=</span>&nbsp;<span class="num" id="1770970">0xD800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770978">surrogateMax</span>&nbsp;<span class="op" id="1770991">=</span>&nbsp;<span class="num" id="1770993">0xDFFF</span><br>
<span class="lineno">25</span><span class="op" id="1771000">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1771003">const</span>&nbsp;<span class="op" id="1771009">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771012">t1</span>&nbsp;<span class="op" id="1771015">=</span>&nbsp;<span class="num" id="1771017">0x00</span>&nbsp;<span class="comment" id="1771022">//&nbsp;0000&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771036">tx</span>&nbsp;<span class="op" id="1771039">=</span>&nbsp;<span class="num" id="1771041">0x80</span>&nbsp;<span class="comment" id="1771046">//&nbsp;1000&nbsp;0000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771060">t2</span>&nbsp;<span class="op" id="1771063">=</span>&nbsp;<span class="num" id="1771065">0xC0</span>&nbsp;<span class="comment" id="1771070">//&nbsp;1100&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771084">t3</span>&nbsp;<span class="op" id="1771087">=</span>&nbsp;<span class="num" id="1771089">0xE0</span>&nbsp;<span class="comment" id="1771094">//&nbsp;1110&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771108">t4</span>&nbsp;<span class="op" id="1771111">=</span>&nbsp;<span class="num" id="1771113">0xF0</span>&nbsp;<span class="comment" id="1771118">//&nbsp;1111&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771132">t5</span>&nbsp;<span class="op" id="1771135">=</span>&nbsp;<span class="num" id="1771137">0xF8</span>&nbsp;<span class="comment" id="1771142">//&nbsp;1111&nbsp;1000</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771157">maskx</span>&nbsp;<span class="op" id="1771163">=</span>&nbsp;<span class="num" id="1771165">0x3F</span>&nbsp;<span class="comment" id="1771170">//&nbsp;0011&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771184">mask2</span>&nbsp;<span class="op" id="1771190">=</span>&nbsp;<span class="num" id="1771192">0x1F</span>&nbsp;<span class="comment" id="1771197">//&nbsp;0001&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771211">mask3</span>&nbsp;<span class="op" id="1771217">=</span>&nbsp;<span class="num" id="1771219">0x0F</span>&nbsp;<span class="comment" id="1771224">//&nbsp;0000&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771238">mask4</span>&nbsp;<span class="op" id="1771244">=</span>&nbsp;<span class="num" id="1771246">0x07</span>&nbsp;<span class="comment" id="1771251">//&nbsp;0000&nbsp;0111</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771266">rune1Max</span>&nbsp;<span class="op" id="1771275">=</span>&nbsp;<span class="num" id="1771277">1</span><span class="op" id="1771278">&lt;&lt;</span><span class="num" id="1771280">7</span>&nbsp;<span class="op" id="1771282">-</span>&nbsp;<span class="num" id="1771284">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771287">rune2Max</span>&nbsp;<span class="op" id="1771296">=</span>&nbsp;<span class="num" id="1771298">1</span><span class="op" id="1771299">&lt;&lt;</span><span class="num" id="1771301">11</span>&nbsp;<span class="op" id="1771304">-</span>&nbsp;<span class="num" id="1771306">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771309">rune3Max</span>&nbsp;<span class="op" id="1771318">=</span>&nbsp;<span class="num" id="1771320">1</span><span class="op" id="1771321">&lt;&lt;</span><span class="num" id="1771323">16</span>&nbsp;<span class="op" id="1771326">-</span>&nbsp;<span class="num" id="1771328">1</span><br>
<span class="lineno"></span><span class="op" id="1771330">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="1771333">func</span>&nbsp;<span class="ident" id="1771338">decodeRuneInternal</span><span class="op" id="1771356">(</span><span class="ident" id="1771357">p</span>&nbsp;<span class="op" id="1771359">[</span><span class="op" id="1771360">]</span><span class="builtintype" id="1771361">byte</span><span class="op" id="1771365">)</span>&nbsp;<span class="op" id="1771367">(</span><span class="ident" id="1771368">r</span>&nbsp;<span class="builtintype" id="1771370">rune</span><span class="op" id="1771374">,</span>&nbsp;<span class="ident" id="1771376">size</span>&nbsp;<span class="builtintype" id="1771381">int</span><span class="op" id="1771384">,</span>&nbsp;<span class="ident" id="1771386">short</span>&nbsp;<span class="builtintype" id="1771392">bool</span><span class="op" id="1771396">)</span>&nbsp;<span class="op" id="1771398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771401">n</span>&nbsp;<span class="op" id="1771403">:=</span>&nbsp;<span class="builtinfunc" id="1771406">len</span><span class="op" id="1771409">(</span><span class="ident" id="1771410">p</span><span class="op" id="1771411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771414">if</span>&nbsp;<span class="ident" id="1771417">n</span>&nbsp;<span class="op" id="1771419">&lt;</span>&nbsp;<span class="num" id="1771421">1</span>&nbsp;<span class="op" id="1771423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771427">return</span>&nbsp;<span class="ident" id="1771434">RuneError</span><span class="op" id="1771443">,</span>&nbsp;<span class="num" id="1771445">0</span><span class="op" id="1771446">,</span>&nbsp;<span class="builtintype" id="1771448">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771454">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771457">c0</span>&nbsp;<span class="op" id="1771460">:=</span>&nbsp;<span class="ident" id="1771463">p</span><span class="op" id="1771464">[</span><span class="num" id="1771465">0</span><span class="op" id="1771466">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1771470">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771498">if</span>&nbsp;<span class="ident" id="1771501">c0</span>&nbsp;<span class="op" id="1771504">&lt;</span>&nbsp;<span class="ident" id="1771506">tx</span>&nbsp;<span class="op" id="1771509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771513">return</span>&nbsp;<span class="builtintype" id="1771520">rune</span><span class="op" id="1771524">(</span><span class="ident" id="1771525">c0</span><span class="op" id="1771527">)</span><span class="op" id="1771528">,</span>&nbsp;<span class="num" id="1771530">1</span><span class="op" id="1771531">,</span>&nbsp;<span class="builtintype" id="1771533">false</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1771544">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771578">if</span>&nbsp;<span class="ident" id="1771581">c0</span>&nbsp;<span class="op" id="1771584">&lt;</span>&nbsp;<span class="ident" id="1771586">t2</span>&nbsp;<span class="op" id="1771589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771593">return</span>&nbsp;<span class="ident" id="1771600">RuneError</span><span class="op" id="1771609">,</span>&nbsp;<span class="num" id="1771611">1</span><span class="op" id="1771612">,</span>&nbsp;<span class="builtintype" id="1771614">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1771625">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771658">if</span>&nbsp;<span class="ident" id="1771661">n</span>&nbsp;<span class="op" id="1771663">&lt;</span>&nbsp;<span class="num" id="1771665">2</span>&nbsp;<span class="op" id="1771667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771671">return</span>&nbsp;<span class="ident" id="1771678">RuneError</span><span class="op" id="1771687">,</span>&nbsp;<span class="num" id="1771689">1</span><span class="op" id="1771690">,</span>&nbsp;<span class="builtintype" id="1771692">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771701">c1</span>&nbsp;<span class="op" id="1771704">:=</span>&nbsp;<span class="ident" id="1771707">p</span><span class="op" id="1771708">[</span><span class="num" id="1771709">1</span><span class="op" id="1771710">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771713">if</span>&nbsp;<span class="ident" id="1771716">c1</span>&nbsp;<span class="op" id="1771719">&lt;</span>&nbsp;<span class="ident" id="1771721">tx</span>&nbsp;<span class="op" id="1771724">||</span>&nbsp;<span class="ident" id="1771727">t2</span>&nbsp;<span class="op" id="1771730">&lt;=</span>&nbsp;<span class="ident" id="1771733">c1</span>&nbsp;<span class="op" id="1771736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771740">return</span>&nbsp;<span class="ident" id="1771747">RuneError</span><span class="op" id="1771756">,</span>&nbsp;<span class="num" id="1771758">1</span><span class="op" id="1771759">,</span>&nbsp;<span class="builtintype" id="1771761">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771768">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1771772">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771801">if</span>&nbsp;<span class="ident" id="1771804">c0</span>&nbsp;<span class="op" id="1771807">&lt;</span>&nbsp;<span class="ident" id="1771809">t3</span>&nbsp;<span class="op" id="1771812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771816">r</span>&nbsp;<span class="op" id="1771818">=</span>&nbsp;<span class="builtintype" id="1771820">rune</span><span class="op" id="1771824">(</span><span class="ident" id="1771825">c0</span><span class="op" id="1771827">&amp;</span><span class="ident" id="1771828">mask2</span><span class="op" id="1771833">)</span><span class="op" id="1771834">&lt;&lt;</span><span class="num" id="1771836">6</span>&nbsp;<span class="op" id="1771838">|</span>&nbsp;<span class="builtintype" id="1771840">rune</span><span class="op" id="1771844">(</span><span class="ident" id="1771845">c1</span><span class="op" id="1771847">&amp;</span><span class="ident" id="1771848">maskx</span><span class="op" id="1771853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771857">if</span>&nbsp;<span class="ident" id="1771860">r</span>&nbsp;<span class="op" id="1771862">&lt;=</span>&nbsp;<span class="ident" id="1771865">rune1Max</span>&nbsp;<span class="op" id="1771874">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771879">return</span>&nbsp;<span class="ident" id="1771886">RuneError</span><span class="op" id="1771895">,</span>&nbsp;<span class="num" id="1771897">1</span><span class="op" id="1771898">,</span>&nbsp;<span class="builtintype" id="1771900">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771912">return</span>&nbsp;<span class="ident" id="1771919">r</span><span class="op" id="1771920">,</span>&nbsp;<span class="num" id="1771922">2</span><span class="op" id="1771923">,</span>&nbsp;<span class="builtintype" id="1771925">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1771936">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771970">if</span>&nbsp;<span class="ident" id="1771973">n</span>&nbsp;<span class="op" id="1771975">&lt;</span>&nbsp;<span class="num" id="1771977">3</span>&nbsp;<span class="op" id="1771979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771983">return</span>&nbsp;<span class="ident" id="1771990">RuneError</span><span class="op" id="1771999">,</span>&nbsp;<span class="num" id="1772001">1</span><span class="op" id="1772002">,</span>&nbsp;<span class="builtintype" id="1772004">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1772010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772013">c2</span>&nbsp;<span class="op" id="1772016">:=</span>&nbsp;<span class="ident" id="1772019">p</span><span class="op" id="1772020">[</span><span class="num" id="1772021">2</span><span class="op" id="1772022">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772025">if</span>&nbsp;<span class="ident" id="1772028">c2</span>&nbsp;<span class="op" id="1772031">&lt;</span>&nbsp;<span class="ident" id="1772033">tx</span>&nbsp;<span class="op" id="1772036">||</span>&nbsp;<span class="ident" id="1772039">t2</span>&nbsp;<span class="op" id="1772042">&lt;=</span>&nbsp;<span class="ident" id="1772045">c2</span>&nbsp;<span class="op" id="1772048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772052">return</span>&nbsp;<span class="ident" id="1772059">RuneError</span><span class="op" id="1772068">,</span>&nbsp;<span class="num" id="1772070">1</span><span class="op" id="1772071">,</span>&nbsp;<span class="builtintype" id="1772073">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1772080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1772084">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772113">if</span>&nbsp;<span class="ident" id="1772116">c0</span>&nbsp;<span class="op" id="1772119">&lt;</span>&nbsp;<span class="ident" id="1772121">t4</span>&nbsp;<span class="op" id="1772124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772128">r</span>&nbsp;<span class="op" id="1772130">=</span>&nbsp;<span class="builtintype" id="1772132">rune</span><span class="op" id="1772136">(</span><span class="ident" id="1772137">c0</span><span class="op" id="1772139">&amp;</span><span class="ident" id="1772140">mask3</span><span class="op" id="1772145">)</span><span class="op" id="1772146">&lt;&lt;</span><span class="num" id="1772148">12</span>&nbsp;<span class="op" id="1772151">|</span>&nbsp;<span class="builtintype" id="1772153">rune</span><span class="op" id="1772157">(</span><span class="ident" id="1772158">c1</span><span class="op" id="1772160">&amp;</span><span class="ident" id="1772161">maskx</span><span class="op" id="1772166">)</span><span class="op" id="1772167">&lt;&lt;</span><span class="num" id="1772169">6</span>&nbsp;<span class="op" id="1772171">|</span>&nbsp;<span class="builtintype" id="1772173">rune</span><span class="op" id="1772177">(</span><span class="ident" id="1772178">c2</span><span class="op" id="1772180">&amp;</span><span class="ident" id="1772181">maskx</span><span class="op" id="1772186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772190">if</span>&nbsp;<span class="ident" id="1772193">r</span>&nbsp;<span class="op" id="1772195">&lt;=</span>&nbsp;<span class="ident" id="1772198">rune2Max</span>&nbsp;<span class="op" id="1772207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772212">return</span>&nbsp;<span class="ident" id="1772219">RuneError</span><span class="op" id="1772228">,</span>&nbsp;<span class="num" id="1772230">1</span><span class="op" id="1772231">,</span>&nbsp;<span class="builtintype" id="1772233">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1772241">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772245">if</span>&nbsp;<span class="ident" id="1772248">surrogateMin</span>&nbsp;<span class="op" id="1772261">&lt;=</span>&nbsp;<span class="ident" id="1772264">r</span>&nbsp;<span class="op" id="1772266">&amp;&amp;</span>&nbsp;<span class="ident" id="1772269">r</span>&nbsp;<span class="op" id="1772271">&lt;=</span>&nbsp;<span class="ident" id="1772274">surrogateMax</span>&nbsp;<span class="op" id="1772287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772292">return</span>&nbsp;<span class="ident" id="1772299">RuneError</span><span class="op" id="1772308">,</span>&nbsp;<span class="num" id="1772310">1</span><span class="op" id="1772311">,</span>&nbsp;<span class="builtintype" id="1772313">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1772321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772325">return</span>&nbsp;<span class="ident" id="1772332">r</span><span class="op" id="1772333">,</span>&nbsp;<span class="num" id="1772335">3</span><span class="op" id="1772336">,</span>&nbsp;<span class="builtintype" id="1772338">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1772345">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1772349">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772382">if</span>&nbsp;<span class="ident" id="1772385">n</span>&nbsp;<span class="op" id="1772387">&lt;</span>&nbsp;<span class="num" id="1772389">4</span>&nbsp;<span class="op" id="1772391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772395">return</span>&nbsp;<span class="ident" id="1772402">RuneError</span><span class="op" id="1772411">,</span>&nbsp;<span class="num" id="1772413">1</span><span class="op" id="1772414">,</span>&nbsp;<span class="builtintype" id="1772416">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1772422">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772425">c3</span>&nbsp;<span class="op" id="1772428">:=</span>&nbsp;<span class="ident" id="1772431">p</span><span class="op" id="1772432">[</span><span class="num" id="1772433">3</span><span class="op" id="1772434">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772437">if</span>&nbsp;<span class="ident" id="1772440">c3</span>&nbsp;<span class="op" id="1772443">&lt;</span>&nbsp;<span class="ident" id="1772445">tx</span>&nbsp;<span class="op" id="1772448">||</span>&nbsp;<span class="ident" id="1772451">t2</span>&nbsp;<span class="op" id="1772454">&lt;=</span>&nbsp;<span class="ident" id="1772457">c3</span>&nbsp;<span class="op" id="1772460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772464">return</span>&nbsp;<span class="ident" id="1772471">RuneError</span><span class="op" id="1772480">,</span>&nbsp;<span class="num" id="1772482">1</span><span class="op" id="1772483">,</span>&nbsp;<span class="builtintype" id="1772485">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1772492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1772496">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772525">if</span>&nbsp;<span class="ident" id="1772528">c0</span>&nbsp;<span class="op" id="1772531">&lt;</span>&nbsp;<span class="ident" id="1772533">t5</span>&nbsp;<span class="op" id="1772536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772540">r</span>&nbsp;<span class="op" id="1772542">=</span>&nbsp;<span class="builtintype" id="1772544">rune</span><span class="op" id="1772548">(</span><span class="ident" id="1772549">c0</span><span class="op" id="1772551">&amp;</span><span class="ident" id="1772552">mask4</span><span class="op" id="1772557">)</span><span class="op" id="1772558">&lt;&lt;</span><span class="num" id="1772560">18</span>&nbsp;<span class="op" id="1772563">|</span>&nbsp;<span class="builtintype" id="1772565">rune</span><span class="op" id="1772569">(</span><span class="ident" id="1772570">c1</span><span class="op" id="1772572">&amp;</span><span class="ident" id="1772573">maskx</span><span class="op" id="1772578">)</span><span class="op" id="1772579">&lt;&lt;</span><span class="num" id="1772581">12</span>&nbsp;<span class="op" id="1772584">|</span>&nbsp;<span class="builtintype" id="1772586">rune</span><span class="op" id="1772590">(</span><span class="ident" id="1772591">c2</span><span class="op" id="1772593">&amp;</span><span class="ident" id="1772594">maskx</span><span class="op" id="1772599">)</span><span class="op" id="1772600">&lt;&lt;</span><span class="num" id="1772602">6</span>&nbsp;<span class="op" id="1772604">|</span>&nbsp;<span class="builtintype" id="1772606">rune</span><span class="op" id="1772610">(</span><span class="ident" id="1772611">c3</span><span class="op" id="1772613">&amp;</span><span class="ident" id="1772614">maskx</span><span class="op" id="1772619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772623">if</span>&nbsp;<span class="ident" id="1772626">r</span>&nbsp;<span class="op" id="1772628">&lt;=</span>&nbsp;<span class="ident" id="1772631">rune3Max</span>&nbsp;<span class="op" id="1772640">||</span>&nbsp;<span class="ident" id="1772643">MaxRune</span>&nbsp;<span class="op" id="1772651">&lt;</span>&nbsp;<span class="ident" id="1772653">r</span>&nbsp;<span class="op" id="1772655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772660">return</span>&nbsp;<span class="ident" id="1772667">RuneError</span><span class="op" id="1772676">,</span>&nbsp;<span class="num" id="1772678">1</span><span class="op" id="1772679">,</span>&nbsp;<span class="builtintype" id="1772681">false</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1772689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772693">return</span>&nbsp;<span class="ident" id="1772700">r</span><span class="op" id="1772701">,</span>&nbsp;<span class="num" id="1772703">4</span><span class="op" id="1772704">,</span>&nbsp;<span class="builtintype" id="1772706">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1772713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1772717">//&nbsp;error</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772727">return</span>&nbsp;<span class="ident" id="1772734">RuneError</span><span class="op" id="1772743">,</span>&nbsp;<span class="num" id="1772745">1</span><span class="op" id="1772746">,</span>&nbsp;<span class="builtintype" id="1772748">false</span><br>
<span class="lineno"></span><span class="op" id="1772754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1772757">func</span>&nbsp;<span class="ident" id="1772762">decodeRuneInStringInternal</span><span class="op" id="1772788">(</span><span class="ident" id="1772789">s</span>&nbsp;<span class="builtintype" id="1772791">string</span><span class="op" id="1772797">)</span>&nbsp;<span class="op" id="1772799">(</span><span class="ident" id="1772800">r</span>&nbsp;<span class="builtintype" id="1772802">rune</span><span class="op" id="1772806">,</span>&nbsp;<span class="ident" id="1772808">size</span>&nbsp;<span class="builtintype" id="1772813">int</span><span class="op" id="1772816">,</span>&nbsp;<span class="ident" id="1772818">short</span>&nbsp;<span class="builtintype" id="1772824">bool</span><span class="op" id="1772828">)</span>&nbsp;<span class="op" id="1772830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772833">n</span>&nbsp;<span class="op" id="1772835">:=</span>&nbsp;<span class="builtinfunc" id="1772838">len</span><span class="op" id="1772841">(</span><span class="ident" id="1772842">s</span><span class="op" id="1772843">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772846">if</span>&nbsp;<span class="ident" id="1772849">n</span>&nbsp;<span class="op" id="1772851">&lt;</span>&nbsp;<span class="num" id="1772853">1</span>&nbsp;<span class="op" id="1772855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772859">return</span>&nbsp;<span class="ident" id="1772866">RuneError</span><span class="op" id="1772875">,</span>&nbsp;<span class="num" id="1772877">0</span><span class="op" id="1772878">,</span>&nbsp;<span class="builtintype" id="1772880">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1772886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772889">c0</span>&nbsp;<span class="op" id="1772892">:=</span>&nbsp;<span class="ident" id="1772895">s</span><span class="op" id="1772896">[</span><span class="num" id="1772897">0</span><span class="op" id="1772898">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1772902">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772930">if</span>&nbsp;<span class="ident" id="1772933">c0</span>&nbsp;<span class="op" id="1772936">&lt;</span>&nbsp;<span class="ident" id="1772938">tx</span>&nbsp;<span class="op" id="1772941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772945">return</span>&nbsp;<span class="builtintype" id="1772952">rune</span><span class="op" id="1772956">(</span><span class="ident" id="1772957">c0</span><span class="op" id="1772959">)</span><span class="op" id="1772960">,</span>&nbsp;<span class="num" id="1772962">1</span><span class="op" id="1772963">,</span>&nbsp;<span class="builtintype" id="1772965">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1772972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1772976">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773010">if</span>&nbsp;<span class="ident" id="1773013">c0</span>&nbsp;<span class="op" id="1773016">&lt;</span>&nbsp;<span class="ident" id="1773018">t2</span>&nbsp;<span class="op" id="1773021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773025">return</span>&nbsp;<span class="ident" id="1773032">RuneError</span><span class="op" id="1773041">,</span>&nbsp;<span class="num" id="1773043">1</span><span class="op" id="1773044">,</span>&nbsp;<span class="builtintype" id="1773046">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1773057">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773090">if</span>&nbsp;<span class="ident" id="1773093">n</span>&nbsp;<span class="op" id="1773095">&lt;</span>&nbsp;<span class="num" id="1773097">2</span>&nbsp;<span class="op" id="1773099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773103">return</span>&nbsp;<span class="ident" id="1773110">RuneError</span><span class="op" id="1773119">,</span>&nbsp;<span class="num" id="1773121">1</span><span class="op" id="1773122">,</span>&nbsp;<span class="builtintype" id="1773124">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773133">c1</span>&nbsp;<span class="op" id="1773136">:=</span>&nbsp;<span class="ident" id="1773139">s</span><span class="op" id="1773140">[</span><span class="num" id="1773141">1</span><span class="op" id="1773142">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773145">if</span>&nbsp;<span class="ident" id="1773148">c1</span>&nbsp;<span class="op" id="1773151">&lt;</span>&nbsp;<span class="ident" id="1773153">tx</span>&nbsp;<span class="op" id="1773156">||</span>&nbsp;<span class="ident" id="1773159">t2</span>&nbsp;<span class="op" id="1773162">&lt;=</span>&nbsp;<span class="ident" id="1773165">c1</span>&nbsp;<span class="op" id="1773168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773172">return</span>&nbsp;<span class="ident" id="1773179">RuneError</span><span class="op" id="1773188">,</span>&nbsp;<span class="num" id="1773190">1</span><span class="op" id="1773191">,</span>&nbsp;<span class="builtintype" id="1773193">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1773204">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773233">if</span>&nbsp;<span class="ident" id="1773236">c0</span>&nbsp;<span class="op" id="1773239">&lt;</span>&nbsp;<span class="ident" id="1773241">t3</span>&nbsp;<span class="op" id="1773244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773248">r</span>&nbsp;<span class="op" id="1773250">=</span>&nbsp;<span class="builtintype" id="1773252">rune</span><span class="op" id="1773256">(</span><span class="ident" id="1773257">c0</span><span class="op" id="1773259">&amp;</span><span class="ident" id="1773260">mask2</span><span class="op" id="1773265">)</span><span class="op" id="1773266">&lt;&lt;</span><span class="num" id="1773268">6</span>&nbsp;<span class="op" id="1773270">|</span>&nbsp;<span class="builtintype" id="1773272">rune</span><span class="op" id="1773276">(</span><span class="ident" id="1773277">c1</span><span class="op" id="1773279">&amp;</span><span class="ident" id="1773280">maskx</span><span class="op" id="1773285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773289">if</span>&nbsp;<span class="ident" id="1773292">r</span>&nbsp;<span class="op" id="1773294">&lt;=</span>&nbsp;<span class="ident" id="1773297">rune1Max</span>&nbsp;<span class="op" id="1773306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773311">return</span>&nbsp;<span class="ident" id="1773318">RuneError</span><span class="op" id="1773327">,</span>&nbsp;<span class="num" id="1773329">1</span><span class="op" id="1773330">,</span>&nbsp;<span class="builtintype" id="1773332">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773340">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773344">return</span>&nbsp;<span class="ident" id="1773351">r</span><span class="op" id="1773352">,</span>&nbsp;<span class="num" id="1773354">2</span><span class="op" id="1773355">,</span>&nbsp;<span class="builtintype" id="1773357">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1773368">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773402">if</span>&nbsp;<span class="ident" id="1773405">n</span>&nbsp;<span class="op" id="1773407">&lt;</span>&nbsp;<span class="num" id="1773409">3</span>&nbsp;<span class="op" id="1773411">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773415">return</span>&nbsp;<span class="ident" id="1773422">RuneError</span><span class="op" id="1773431">,</span>&nbsp;<span class="num" id="1773433">1</span><span class="op" id="1773434">,</span>&nbsp;<span class="builtintype" id="1773436">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773445">c2</span>&nbsp;<span class="op" id="1773448">:=</span>&nbsp;<span class="ident" id="1773451">s</span><span class="op" id="1773452">[</span><span class="num" id="1773453">2</span><span class="op" id="1773454">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773457">if</span>&nbsp;<span class="ident" id="1773460">c2</span>&nbsp;<span class="op" id="1773463">&lt;</span>&nbsp;<span class="ident" id="1773465">tx</span>&nbsp;<span class="op" id="1773468">||</span>&nbsp;<span class="ident" id="1773471">t2</span>&nbsp;<span class="op" id="1773474">&lt;=</span>&nbsp;<span class="ident" id="1773477">c2</span>&nbsp;<span class="op" id="1773480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773484">return</span>&nbsp;<span class="ident" id="1773491">RuneError</span><span class="op" id="1773500">,</span>&nbsp;<span class="num" id="1773502">1</span><span class="op" id="1773503">,</span>&nbsp;<span class="builtintype" id="1773505">false</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1773516">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773545">if</span>&nbsp;<span class="ident" id="1773548">c0</span>&nbsp;<span class="op" id="1773551">&lt;</span>&nbsp;<span class="ident" id="1773553">t4</span>&nbsp;<span class="op" id="1773556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773560">r</span>&nbsp;<span class="op" id="1773562">=</span>&nbsp;<span class="builtintype" id="1773564">rune</span><span class="op" id="1773568">(</span><span class="ident" id="1773569">c0</span><span class="op" id="1773571">&amp;</span><span class="ident" id="1773572">mask3</span><span class="op" id="1773577">)</span><span class="op" id="1773578">&lt;&lt;</span><span class="num" id="1773580">12</span>&nbsp;<span class="op" id="1773583">|</span>&nbsp;<span class="builtintype" id="1773585">rune</span><span class="op" id="1773589">(</span><span class="ident" id="1773590">c1</span><span class="op" id="1773592">&amp;</span><span class="ident" id="1773593">maskx</span><span class="op" id="1773598">)</span><span class="op" id="1773599">&lt;&lt;</span><span class="num" id="1773601">6</span>&nbsp;<span class="op" id="1773603">|</span>&nbsp;<span class="builtintype" id="1773605">rune</span><span class="op" id="1773609">(</span><span class="ident" id="1773610">c2</span><span class="op" id="1773612">&amp;</span><span class="ident" id="1773613">maskx</span><span class="op" id="1773618">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773622">if</span>&nbsp;<span class="ident" id="1773625">r</span>&nbsp;<span class="op" id="1773627">&lt;=</span>&nbsp;<span class="ident" id="1773630">rune2Max</span>&nbsp;<span class="op" id="1773639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773644">return</span>&nbsp;<span class="ident" id="1773651">RuneError</span><span class="op" id="1773660">,</span>&nbsp;<span class="num" id="1773662">1</span><span class="op" id="1773663">,</span>&nbsp;<span class="builtintype" id="1773665">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773677">if</span>&nbsp;<span class="ident" id="1773680">surrogateMin</span>&nbsp;<span class="op" id="1773693">&lt;=</span>&nbsp;<span class="ident" id="1773696">r</span>&nbsp;<span class="op" id="1773698">&amp;&amp;</span>&nbsp;<span class="ident" id="1773701">r</span>&nbsp;<span class="op" id="1773703">&lt;=</span>&nbsp;<span class="ident" id="1773706">surrogateMax</span>&nbsp;<span class="op" id="1773719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773724">return</span>&nbsp;<span class="ident" id="1773731">RuneError</span><span class="op" id="1773740">,</span>&nbsp;<span class="num" id="1773742">1</span><span class="op" id="1773743">,</span>&nbsp;<span class="builtintype" id="1773745">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773757">return</span>&nbsp;<span class="ident" id="1773764">r</span><span class="op" id="1773765">,</span>&nbsp;<span class="num" id="1773767">3</span><span class="op" id="1773768">,</span>&nbsp;<span class="builtintype" id="1773770">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1773781">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773814">if</span>&nbsp;<span class="ident" id="1773817">n</span>&nbsp;<span class="op" id="1773819">&lt;</span>&nbsp;<span class="num" id="1773821">4</span>&nbsp;<span class="op" id="1773823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773827">return</span>&nbsp;<span class="ident" id="1773834">RuneError</span><span class="op" id="1773843">,</span>&nbsp;<span class="num" id="1773845">1</span><span class="op" id="1773846">,</span>&nbsp;<span class="builtintype" id="1773848">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773857">c3</span>&nbsp;<span class="op" id="1773860">:=</span>&nbsp;<span class="ident" id="1773863">s</span><span class="op" id="1773864">[</span><span class="num" id="1773865">3</span><span class="op" id="1773866">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773869">if</span>&nbsp;<span class="ident" id="1773872">c3</span>&nbsp;<span class="op" id="1773875">&lt;</span>&nbsp;<span class="ident" id="1773877">tx</span>&nbsp;<span class="op" id="1773880">||</span>&nbsp;<span class="ident" id="1773883">t2</span>&nbsp;<span class="op" id="1773886">&lt;=</span>&nbsp;<span class="ident" id="1773889">c3</span>&nbsp;<span class="op" id="1773892">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773896">return</span>&nbsp;<span class="ident" id="1773903">RuneError</span><span class="op" id="1773912">,</span>&nbsp;<span class="num" id="1773914">1</span><span class="op" id="1773915">,</span>&nbsp;<span class="builtintype" id="1773917">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1773928">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773957">if</span>&nbsp;<span class="ident" id="1773960">c0</span>&nbsp;<span class="op" id="1773963">&lt;</span>&nbsp;<span class="ident" id="1773965">t5</span>&nbsp;<span class="op" id="1773968">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773972">r</span>&nbsp;<span class="op" id="1773974">=</span>&nbsp;<span class="builtintype" id="1773976">rune</span><span class="op" id="1773980">(</span><span class="ident" id="1773981">c0</span><span class="op" id="1773983">&amp;</span><span class="ident" id="1773984">mask4</span><span class="op" id="1773989">)</span><span class="op" id="1773990">&lt;&lt;</span><span class="num" id="1773992">18</span>&nbsp;<span class="op" id="1773995">|</span>&nbsp;<span class="builtintype" id="1773997">rune</span><span class="op" id="1774001">(</span><span class="ident" id="1774002">c1</span><span class="op" id="1774004">&amp;</span><span class="ident" id="1774005">maskx</span><span class="op" id="1774010">)</span><span class="op" id="1774011">&lt;&lt;</span><span class="num" id="1774013">12</span>&nbsp;<span class="op" id="1774016">|</span>&nbsp;<span class="builtintype" id="1774018">rune</span><span class="op" id="1774022">(</span><span class="ident" id="1774023">c2</span><span class="op" id="1774025">&amp;</span><span class="ident" id="1774026">maskx</span><span class="op" id="1774031">)</span><span class="op" id="1774032">&lt;&lt;</span><span class="num" id="1774034">6</span>&nbsp;<span class="op" id="1774036">|</span>&nbsp;<span class="builtintype" id="1774038">rune</span><span class="op" id="1774042">(</span><span class="ident" id="1774043">c3</span><span class="op" id="1774045">&amp;</span><span class="ident" id="1774046">maskx</span><span class="op" id="1774051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774055">if</span>&nbsp;<span class="ident" id="1774058">r</span>&nbsp;<span class="op" id="1774060">&lt;=</span>&nbsp;<span class="ident" id="1774063">rune3Max</span>&nbsp;<span class="op" id="1774072">||</span>&nbsp;<span class="ident" id="1774075">MaxRune</span>&nbsp;<span class="op" id="1774083">&lt;</span>&nbsp;<span class="ident" id="1774085">r</span>&nbsp;<span class="op" id="1774087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774092">return</span>&nbsp;<span class="ident" id="1774099">RuneError</span><span class="op" id="1774108">,</span>&nbsp;<span class="num" id="1774110">1</span><span class="op" id="1774111">,</span>&nbsp;<span class="builtintype" id="1774113">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1774121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774125">return</span>&nbsp;<span class="ident" id="1774132">r</span><span class="op" id="1774133">,</span>&nbsp;<span class="num" id="1774135">4</span><span class="op" id="1774136">,</span>&nbsp;<span class="builtintype" id="1774138">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1774145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1774149">//&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774159">return</span>&nbsp;<span class="ident" id="1774166">RuneError</span><span class="op" id="1774175">,</span>&nbsp;<span class="num" id="1774177">1</span><span class="op" id="1774178">,</span>&nbsp;<span class="builtintype" id="1774180">false</span><br>
<span class="lineno"></span><span class="op" id="1774186">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="1774189">//&nbsp;FullRune&nbsp;reports&nbsp;whether&nbsp;the&nbsp;bytes&nbsp;in&nbsp;p&nbsp;begin&nbsp;with&nbsp;a&nbsp;full&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;a&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1774276">//&nbsp;An&nbsp;invalid&nbsp;encoding&nbsp;is&nbsp;considered&nbsp;a&nbsp;full&nbsp;Rune&nbsp;since&nbsp;it&nbsp;will&nbsp;convert&nbsp;as&nbsp;a&nbsp;width-1&nbsp;error&nbsp;rune.</span><br>
<span class="lineno"></span><span class="keyword" id="1774372">func</span>&nbsp;<span class="ident" id="1774377">FullRune</span><span class="op" id="1774385">(</span><span class="ident" id="1774386">p</span>&nbsp;<span class="op" id="1774388">[</span><span class="op" id="1774389">]</span><span class="builtintype" id="1774390">byte</span><span class="op" id="1774394">)</span>&nbsp;<span class="builtintype" id="1774396">bool</span>&nbsp;<span class="op" id="1774401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774404">_</span><span class="op" id="1774405">,</span>&nbsp;<span class="ident" id="1774407">_</span><span class="op" id="1774408">,</span>&nbsp;<span class="ident" id="1774410">short</span>&nbsp;<span class="op" id="1774416">:=</span>&nbsp;<span class="ident" id="1774419">decodeRuneInternal</span><span class="op" id="1774437">(</span><span class="ident" id="1774438">p</span><span class="op" id="1774439">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774442">return</span>&nbsp;<span class="op" id="1774449">!</span><span class="ident" id="1774450">short</span><br>
<span class="lineno"></span><span class="op" id="1774456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1774459">//&nbsp;FullRuneInString&nbsp;is&nbsp;like&nbsp;FullRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1774523">func</span>&nbsp;<span class="ident" id="1774528">FullRuneInString</span><span class="op" id="1774544">(</span><span class="ident" id="1774545">s</span>&nbsp;<span class="builtintype" id="1774547">string</span><span class="op" id="1774553">)</span>&nbsp;<span class="builtintype" id="1774555">bool</span>&nbsp;<span class="op" id="1774560">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774563">_</span><span class="op" id="1774564">,</span>&nbsp;<span class="ident" id="1774566">_</span><span class="op" id="1774567">,</span>&nbsp;<span class="ident" id="1774569">short</span>&nbsp;<span class="op" id="1774575">:=</span>&nbsp;<span class="ident" id="1774578">decodeRuneInStringInternal</span><span class="op" id="1774604">(</span><span class="ident" id="1774605">s</span><span class="op" id="1774606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774609">return</span>&nbsp;<span class="op" id="1774616">!</span><span class="ident" id="1774617">short</span><br>
<span class="lineno"></span><span class="op" id="1774623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1774626">//&nbsp;DecodeRune&nbsp;unpacks&nbsp;the&nbsp;first&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">215</span><span class="comment" id="1774703">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1774781">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1774856">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1774886">//</span><br>
<span class="lineno"></span><span class="comment" id="1774889">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">220</span><span class="comment" id="1774964">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1775036">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1775080">func</span>&nbsp;<span class="ident" id="1775085">DecodeRune</span><span class="op" id="1775095">(</span><span class="ident" id="1775096">p</span>&nbsp;<span class="op" id="1775098">[</span><span class="op" id="1775099">]</span><span class="builtintype" id="1775100">byte</span><span class="op" id="1775104">)</span>&nbsp;<span class="op" id="1775106">(</span><span class="ident" id="1775107">r</span>&nbsp;<span class="builtintype" id="1775109">rune</span><span class="op" id="1775113">,</span>&nbsp;<span class="ident" id="1775115">size</span>&nbsp;<span class="builtintype" id="1775120">int</span><span class="op" id="1775123">)</span>&nbsp;<span class="op" id="1775125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1775128">r</span><span class="op" id="1775129">,</span>&nbsp;<span class="ident" id="1775131">size</span><span class="op" id="1775135">,</span>&nbsp;<span class="ident" id="1775137">_</span>&nbsp;<span class="op" id="1775139">=</span>&nbsp;<span class="ident" id="1775141">decodeRuneInternal</span><span class="op" id="1775159">(</span><span class="ident" id="1775160">p</span><span class="op" id="1775161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1775164">return</span><br>
<span class="lineno">225</span><span class="op" id="1775171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1775174">//&nbsp;DecodeRuneInString&nbsp;is&nbsp;like&nbsp;DecodeRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If&nbsp;s&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1775250">//&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1775328">//&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno">230</span><span class="comment" id="1775402">//</span><br>
<span class="lineno"></span><span class="comment" id="1775405">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1775480">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1775552">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1775596">func</span>&nbsp;<span class="ident" id="1775601">DecodeRuneInString</span><span class="op" id="1775619">(</span><span class="ident" id="1775620">s</span>&nbsp;<span class="builtintype" id="1775622">string</span><span class="op" id="1775628">)</span>&nbsp;<span class="op" id="1775630">(</span><span class="ident" id="1775631">r</span>&nbsp;<span class="builtintype" id="1775633">rune</span><span class="op" id="1775637">,</span>&nbsp;<span class="ident" id="1775639">size</span>&nbsp;<span class="builtintype" id="1775644">int</span><span class="op" id="1775647">)</span>&nbsp;<span class="op" id="1775649">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1775652">r</span><span class="op" id="1775653">,</span>&nbsp;<span class="ident" id="1775655">size</span><span class="op" id="1775659">,</span>&nbsp;<span class="ident" id="1775661">_</span>&nbsp;<span class="op" id="1775663">=</span>&nbsp;<span class="ident" id="1775665">decodeRuneInStringInternal</span><span class="op" id="1775691">(</span><span class="ident" id="1775692">s</span><span class="op" id="1775693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1775696">return</span><br>
<span class="lineno"></span><span class="op" id="1775703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1775706">//&nbsp;DecodeLastRune&nbsp;unpacks&nbsp;the&nbsp;last&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">240</span><span class="comment" id="1775786">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1775864">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1775939">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1775969">//</span><br>
<span class="lineno"></span><span class="comment" id="1775972">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">245</span><span class="comment" id="1776047">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1776119">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1776163">func</span>&nbsp;<span class="ident" id="1776168">DecodeLastRune</span><span class="op" id="1776182">(</span><span class="ident" id="1776183">p</span>&nbsp;<span class="op" id="1776185">[</span><span class="op" id="1776186">]</span><span class="builtintype" id="1776187">byte</span><span class="op" id="1776191">)</span>&nbsp;<span class="op" id="1776193">(</span><span class="ident" id="1776194">r</span>&nbsp;<span class="builtintype" id="1776196">rune</span><span class="op" id="1776200">,</span>&nbsp;<span class="ident" id="1776202">size</span>&nbsp;<span class="builtintype" id="1776207">int</span><span class="op" id="1776210">)</span>&nbsp;<span class="op" id="1776212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1776215">end</span>&nbsp;<span class="op" id="1776219">:=</span>&nbsp;<span class="builtinfunc" id="1776222">len</span><span class="op" id="1776225">(</span><span class="ident" id="1776226">p</span><span class="op" id="1776227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1776230">if</span>&nbsp;<span class="ident" id="1776233">end</span>&nbsp;<span class="op" id="1776237">==</span>&nbsp;<span class="num" id="1776240">0</span>&nbsp;<span class="op" id="1776242">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1776246">return</span>&nbsp;<span class="ident" id="1776253">RuneError</span><span class="op" id="1776262">,</span>&nbsp;<span class="num" id="1776264">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1776267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1776270">start</span>&nbsp;<span class="op" id="1776276">:=</span>&nbsp;<span class="ident" id="1776279">end</span>&nbsp;<span class="op" id="1776283">-</span>&nbsp;<span class="num" id="1776285">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1776288">r</span>&nbsp;<span class="op" id="1776290">=</span>&nbsp;<span class="builtintype" id="1776292">rune</span><span class="op" id="1776296">(</span><span class="ident" id="1776297">p</span><span class="op" id="1776298">[</span><span class="ident" id="1776299">start</span><span class="op" id="1776304">]</span><span class="op" id="1776305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1776308">if</span>&nbsp;<span class="ident" id="1776311">r</span>&nbsp;<span class="op" id="1776313">&lt;</span>&nbsp;<span class="ident" id="1776315">RuneSelf</span>&nbsp;<span class="op" id="1776324">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1776328">return</span>&nbsp;<span class="ident" id="1776335">r</span><span class="op" id="1776336">,</span>&nbsp;<span class="num" id="1776338">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1776341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1776344">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1776394">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1776447">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1776466">lim</span>&nbsp;<span class="op" id="1776470">:=</span>&nbsp;<span class="ident" id="1776473">end</span>&nbsp;<span class="op" id="1776477">-</span>&nbsp;<span class="ident" id="1776479">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1776487">if</span>&nbsp;<span class="ident" id="1776490">lim</span>&nbsp;<span class="op" id="1776494">&lt;</span>&nbsp;<span class="num" id="1776496">0</span>&nbsp;<span class="op" id="1776498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1776502">lim</span>&nbsp;<span class="op" id="1776506">=</span>&nbsp;<span class="num" id="1776508">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1776511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1776514">for</span>&nbsp;<span class="ident" id="1776518">start</span><span class="op" id="1776523">--</span><span class="op" id="1776525">;</span>&nbsp;<span class="ident" id="1776527">start</span>&nbsp;<span class="op" id="1776533">&gt;=</span>&nbsp;<span class="ident" id="1776536">lim</span><span class="op" id="1776539">;</span>&nbsp;<span class="ident" id="1776541">start</span><span class="op" id="1776546">--</span>&nbsp;<span class="op" id="1776549">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1776553">if</span>&nbsp;<span class="ident" id="1776556">RuneStart</span><span class="op" id="1776565">(</span><span class="ident" id="1776566">p</span><span class="op" id="1776567">[</span><span class="ident" id="1776568">start</span><span class="op" id="1776573">]</span><span class="op" id="1776574">)</span>&nbsp;<span class="op" id="1776576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1776581">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1776589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1776592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1776595">if</span>&nbsp;<span class="ident" id="1776598">start</span>&nbsp;<span class="op" id="1776604">&lt;</span>&nbsp;<span class="num" id="1776606">0</span>&nbsp;<span class="op" id="1776608">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1776612">start</span>&nbsp;<span class="op" id="1776618">=</span>&nbsp;<span class="num" id="1776620">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1776623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1776626">r</span><span class="op" id="1776627">,</span>&nbsp;<span class="ident" id="1776629">size</span>&nbsp;<span class="op" id="1776634">=</span>&nbsp;<span class="ident" id="1776636">DecodeRune</span><span class="op" id="1776646">(</span><span class="ident" id="1776647">p</span><span class="op" id="1776648">[</span><span class="ident" id="1776649">start</span><span class="op" id="1776654">:</span><span class="ident" id="1776655">end</span><span class="op" id="1776658">]</span><span class="op" id="1776659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1776662">if</span>&nbsp;<span class="ident" id="1776665">start</span><span class="op" id="1776670">+</span><span class="ident" id="1776671">size</span>&nbsp;<span class="op" id="1776676">!=</span>&nbsp;<span class="ident" id="1776679">end</span>&nbsp;<span class="op" id="1776683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1776687">return</span>&nbsp;<span class="ident" id="1776694">RuneError</span><span class="op" id="1776703">,</span>&nbsp;<span class="num" id="1776705">1</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1776708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1776711">return</span>&nbsp;<span class="ident" id="1776718">r</span><span class="op" id="1776719">,</span>&nbsp;<span class="ident" id="1776721">size</span><br>
<span class="lineno"></span><span class="op" id="1776726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1776729">//&nbsp;DecodeLastRuneInString&nbsp;is&nbsp;like&nbsp;DecodeLastRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If</span><br>
<span class="lineno">280</span><span class="comment" id="1776808">//&nbsp;s&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,</span><br>
<span class="lineno"></span><span class="comment" id="1776888">//&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1776965">//</span><br>
<span class="lineno"></span><span class="comment" id="1776968">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1777043">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno">285</span><span class="comment" id="1777115">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1777159">func</span>&nbsp;<span class="ident" id="1777164">DecodeLastRuneInString</span><span class="op" id="1777186">(</span><span class="ident" id="1777187">s</span>&nbsp;<span class="builtintype" id="1777189">string</span><span class="op" id="1777195">)</span>&nbsp;<span class="op" id="1777197">(</span><span class="ident" id="1777198">r</span>&nbsp;<span class="builtintype" id="1777200">rune</span><span class="op" id="1777204">,</span>&nbsp;<span class="ident" id="1777206">size</span>&nbsp;<span class="builtintype" id="1777211">int</span><span class="op" id="1777214">)</span>&nbsp;<span class="op" id="1777216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777219">end</span>&nbsp;<span class="op" id="1777223">:=</span>&nbsp;<span class="builtinfunc" id="1777226">len</span><span class="op" id="1777229">(</span><span class="ident" id="1777230">s</span><span class="op" id="1777231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777234">if</span>&nbsp;<span class="ident" id="1777237">end</span>&nbsp;<span class="op" id="1777241">==</span>&nbsp;<span class="num" id="1777244">0</span>&nbsp;<span class="op" id="1777246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777250">return</span>&nbsp;<span class="ident" id="1777257">RuneError</span><span class="op" id="1777266">,</span>&nbsp;<span class="num" id="1777268">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1777271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777274">start</span>&nbsp;<span class="op" id="1777280">:=</span>&nbsp;<span class="ident" id="1777283">end</span>&nbsp;<span class="op" id="1777287">-</span>&nbsp;<span class="num" id="1777289">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777292">r</span>&nbsp;<span class="op" id="1777294">=</span>&nbsp;<span class="builtintype" id="1777296">rune</span><span class="op" id="1777300">(</span><span class="ident" id="1777301">s</span><span class="op" id="1777302">[</span><span class="ident" id="1777303">start</span><span class="op" id="1777308">]</span><span class="op" id="1777309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777312">if</span>&nbsp;<span class="ident" id="1777315">r</span>&nbsp;<span class="op" id="1777317">&lt;</span>&nbsp;<span class="ident" id="1777319">RuneSelf</span>&nbsp;<span class="op" id="1777328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777332">return</span>&nbsp;<span class="ident" id="1777339">r</span><span class="op" id="1777340">,</span>&nbsp;<span class="num" id="1777342">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1777345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1777348">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1777398">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1777451">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777470">lim</span>&nbsp;<span class="op" id="1777474">:=</span>&nbsp;<span class="ident" id="1777477">end</span>&nbsp;<span class="op" id="1777481">-</span>&nbsp;<span class="ident" id="1777483">UTFMax</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777491">if</span>&nbsp;<span class="ident" id="1777494">lim</span>&nbsp;<span class="op" id="1777498">&lt;</span>&nbsp;<span class="num" id="1777500">0</span>&nbsp;<span class="op" id="1777502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777506">lim</span>&nbsp;<span class="op" id="1777510">=</span>&nbsp;<span class="num" id="1777512">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1777515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777518">for</span>&nbsp;<span class="ident" id="1777522">start</span><span class="op" id="1777527">--</span><span class="op" id="1777529">;</span>&nbsp;<span class="ident" id="1777531">start</span>&nbsp;<span class="op" id="1777537">&gt;=</span>&nbsp;<span class="ident" id="1777540">lim</span><span class="op" id="1777543">;</span>&nbsp;<span class="ident" id="1777545">start</span><span class="op" id="1777550">--</span>&nbsp;<span class="op" id="1777553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777557">if</span>&nbsp;<span class="ident" id="1777560">RuneStart</span><span class="op" id="1777569">(</span><span class="ident" id="1777570">s</span><span class="op" id="1777571">[</span><span class="ident" id="1777572">start</span><span class="op" id="1777577">]</span><span class="op" id="1777578">)</span>&nbsp;<span class="op" id="1777580">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777585">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1777593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1777596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777599">if</span>&nbsp;<span class="ident" id="1777602">start</span>&nbsp;<span class="op" id="1777608">&lt;</span>&nbsp;<span class="num" id="1777610">0</span>&nbsp;<span class="op" id="1777612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777616">start</span>&nbsp;<span class="op" id="1777622">=</span>&nbsp;<span class="num" id="1777624">0</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1777627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1777630">r</span><span class="op" id="1777631">,</span>&nbsp;<span class="ident" id="1777633">size</span>&nbsp;<span class="op" id="1777638">=</span>&nbsp;<span class="ident" id="1777640">DecodeRuneInString</span><span class="op" id="1777658">(</span><span class="ident" id="1777659">s</span><span class="op" id="1777660">[</span><span class="ident" id="1777661">start</span><span class="op" id="1777666">:</span><span class="ident" id="1777667">end</span><span class="op" id="1777670">]</span><span class="op" id="1777671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777674">if</span>&nbsp;<span class="ident" id="1777677">start</span><span class="op" id="1777682">+</span><span class="ident" id="1777683">size</span>&nbsp;<span class="op" id="1777688">!=</span>&nbsp;<span class="ident" id="1777691">end</span>&nbsp;<span class="op" id="1777695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777699">return</span>&nbsp;<span class="ident" id="1777706">RuneError</span><span class="op" id="1777715">,</span>&nbsp;<span class="num" id="1777717">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1777720">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777723">return</span>&nbsp;<span class="ident" id="1777730">r</span><span class="op" id="1777731">,</span>&nbsp;<span class="ident" id="1777733">size</span><br>
<span class="lineno"></span><span class="op" id="1777738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1777741">//&nbsp;RuneLen&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;required&nbsp;to&nbsp;encode&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1777809">//&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;the&nbsp;rune&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;value&nbsp;to&nbsp;encode&nbsp;in&nbsp;UTF-8.</span><br>
<span class="lineno">320</span><span class="keyword" id="1777879">func</span>&nbsp;<span class="ident" id="1777884">RuneLen</span><span class="op" id="1777891">(</span><span class="ident" id="1777892">r</span>&nbsp;<span class="builtintype" id="1777894">rune</span><span class="op" id="1777898">)</span>&nbsp;<span class="builtintype" id="1777900">int</span>&nbsp;<span class="op" id="1777904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777907">switch</span>&nbsp;<span class="op" id="1777914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777917">case</span>&nbsp;<span class="ident" id="1777922">r</span>&nbsp;<span class="op" id="1777924">&lt;</span>&nbsp;<span class="num" id="1777926">0</span><span class="op" id="1777927">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777931">return</span>&nbsp;<span class="op" id="1777938">-</span><span class="num" id="1777939">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777942">case</span>&nbsp;<span class="ident" id="1777947">r</span>&nbsp;<span class="op" id="1777949">&lt;=</span>&nbsp;<span class="ident" id="1777952">rune1Max</span><span class="op" id="1777960">:</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777964">return</span>&nbsp;<span class="num" id="1777971">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777974">case</span>&nbsp;<span class="ident" id="1777979">r</span>&nbsp;<span class="op" id="1777981">&lt;=</span>&nbsp;<span class="ident" id="1777984">rune2Max</span><span class="op" id="1777992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1777996">return</span>&nbsp;<span class="num" id="1778003">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778006">case</span>&nbsp;<span class="ident" id="1778011">surrogateMin</span>&nbsp;<span class="op" id="1778024">&lt;=</span>&nbsp;<span class="ident" id="1778027">r</span>&nbsp;<span class="op" id="1778029">&amp;&amp;</span>&nbsp;<span class="ident" id="1778032">r</span>&nbsp;<span class="op" id="1778034">&lt;=</span>&nbsp;<span class="ident" id="1778037">surrogateMax</span><span class="op" id="1778049">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778053">return</span>&nbsp;<span class="op" id="1778060">-</span><span class="num" id="1778061">1</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778064">case</span>&nbsp;<span class="ident" id="1778069">r</span>&nbsp;<span class="op" id="1778071">&lt;=</span>&nbsp;<span class="ident" id="1778074">rune3Max</span><span class="op" id="1778082">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778086">return</span>&nbsp;<span class="num" id="1778093">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778096">case</span>&nbsp;<span class="ident" id="1778101">r</span>&nbsp;<span class="op" id="1778103">&lt;=</span>&nbsp;<span class="ident" id="1778106">MaxRune</span><span class="op" id="1778113">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778117">return</span>&nbsp;<span class="num" id="1778124">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1778127">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778130">return</span>&nbsp;<span class="op" id="1778137">-</span><span class="num" id="1778138">1</span><br>
<span class="lineno"></span><span class="op" id="1778140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1778143">//&nbsp;EncodeRune&nbsp;writes&nbsp;into&nbsp;p&nbsp;(which&nbsp;must&nbsp;be&nbsp;large&nbsp;enough)&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1778232">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">340</span><span class="keyword" id="1778275">func</span>&nbsp;<span class="ident" id="1778280">EncodeRune</span><span class="op" id="1778290">(</span><span class="ident" id="1778291">p</span>&nbsp;<span class="op" id="1778293">[</span><span class="op" id="1778294">]</span><span class="builtintype" id="1778295">byte</span><span class="op" id="1778299">,</span>&nbsp;<span class="ident" id="1778301">r</span>&nbsp;<span class="builtintype" id="1778303">rune</span><span class="op" id="1778307">)</span>&nbsp;<span class="builtintype" id="1778309">int</span>&nbsp;<span class="op" id="1778313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1778316">//&nbsp;Negative&nbsp;values&nbsp;are&nbsp;erroneous.&nbsp;&nbsp;Making&nbsp;it&nbsp;unsigned&nbsp;addresses&nbsp;the&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778394">switch</span>&nbsp;<span class="ident" id="1778401">i</span>&nbsp;<span class="op" id="1778403">:=</span>&nbsp;<span class="builtintype" id="1778406">uint32</span><span class="op" id="1778412">(</span><span class="ident" id="1778413">r</span><span class="op" id="1778414">)</span><span class="op" id="1778415">;</span>&nbsp;<span class="op" id="1778417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778420">case</span>&nbsp;<span class="ident" id="1778425">i</span>&nbsp;<span class="op" id="1778427">&lt;=</span>&nbsp;<span class="ident" id="1778430">rune1Max</span><span class="op" id="1778438">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778442">p</span><span class="op" id="1778443">[</span><span class="num" id="1778444">0</span><span class="op" id="1778445">]</span>&nbsp;<span class="op" id="1778447">=</span>&nbsp;<span class="builtintype" id="1778449">byte</span><span class="op" id="1778453">(</span><span class="ident" id="1778454">r</span><span class="op" id="1778455">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778459">return</span>&nbsp;<span class="num" id="1778466">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778469">case</span>&nbsp;<span class="ident" id="1778474">i</span>&nbsp;<span class="op" id="1778476">&lt;=</span>&nbsp;<span class="ident" id="1778479">rune2Max</span><span class="op" id="1778487">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778491">p</span><span class="op" id="1778492">[</span><span class="num" id="1778493">0</span><span class="op" id="1778494">]</span>&nbsp;<span class="op" id="1778496">=</span>&nbsp;<span class="ident" id="1778498">t2</span>&nbsp;<span class="op" id="1778501">|</span>&nbsp;<span class="builtintype" id="1778503">byte</span><span class="op" id="1778507">(</span><span class="ident" id="1778508">r</span><span class="op" id="1778509">&gt;&gt;</span><span class="num" id="1778511">6</span><span class="op" id="1778512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778516">p</span><span class="op" id="1778517">[</span><span class="num" id="1778518">1</span><span class="op" id="1778519">]</span>&nbsp;<span class="op" id="1778521">=</span>&nbsp;<span class="ident" id="1778523">tx</span>&nbsp;<span class="op" id="1778526">|</span>&nbsp;<span class="builtintype" id="1778528">byte</span><span class="op" id="1778532">(</span><span class="ident" id="1778533">r</span><span class="op" id="1778534">)</span><span class="op" id="1778535">&amp;</span><span class="ident" id="1778536">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778544">return</span>&nbsp;<span class="num" id="1778551">2</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778554">case</span>&nbsp;<span class="ident" id="1778559">i</span>&nbsp;<span class="op" id="1778561">&gt;</span>&nbsp;<span class="ident" id="1778563">MaxRune</span><span class="op" id="1778570">,</span>&nbsp;<span class="ident" id="1778572">surrogateMin</span>&nbsp;<span class="op" id="1778585">&lt;=</span>&nbsp;<span class="ident" id="1778588">i</span>&nbsp;<span class="op" id="1778590">&amp;&amp;</span>&nbsp;<span class="ident" id="1778593">i</span>&nbsp;<span class="op" id="1778595">&lt;=</span>&nbsp;<span class="ident" id="1778598">surrogateMax</span><span class="op" id="1778610">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778614">r</span>&nbsp;<span class="op" id="1778616">=</span>&nbsp;<span class="ident" id="1778618">RuneError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778630">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778643">case</span>&nbsp;<span class="ident" id="1778648">i</span>&nbsp;<span class="op" id="1778650">&lt;=</span>&nbsp;<span class="ident" id="1778653">rune3Max</span><span class="op" id="1778661">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778665">p</span><span class="op" id="1778666">[</span><span class="num" id="1778667">0</span><span class="op" id="1778668">]</span>&nbsp;<span class="op" id="1778670">=</span>&nbsp;<span class="ident" id="1778672">t3</span>&nbsp;<span class="op" id="1778675">|</span>&nbsp;<span class="builtintype" id="1778677">byte</span><span class="op" id="1778681">(</span><span class="ident" id="1778682">r</span><span class="op" id="1778683">&gt;&gt;</span><span class="num" id="1778685">12</span><span class="op" id="1778687">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778691">p</span><span class="op" id="1778692">[</span><span class="num" id="1778693">1</span><span class="op" id="1778694">]</span>&nbsp;<span class="op" id="1778696">=</span>&nbsp;<span class="ident" id="1778698">tx</span>&nbsp;<span class="op" id="1778701">|</span>&nbsp;<span class="builtintype" id="1778703">byte</span><span class="op" id="1778707">(</span><span class="ident" id="1778708">r</span><span class="op" id="1778709">&gt;&gt;</span><span class="num" id="1778711">6</span><span class="op" id="1778712">)</span><span class="op" id="1778713">&amp;</span><span class="ident" id="1778714">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778722">p</span><span class="op" id="1778723">[</span><span class="num" id="1778724">2</span><span class="op" id="1778725">]</span>&nbsp;<span class="op" id="1778727">=</span>&nbsp;<span class="ident" id="1778729">tx</span>&nbsp;<span class="op" id="1778732">|</span>&nbsp;<span class="builtintype" id="1778734">byte</span><span class="op" id="1778738">(</span><span class="ident" id="1778739">r</span><span class="op" id="1778740">)</span><span class="op" id="1778741">&amp;</span><span class="ident" id="1778742">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778750">return</span>&nbsp;<span class="num" id="1778757">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778760">default</span><span class="op" id="1778767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778771">p</span><span class="op" id="1778772">[</span><span class="num" id="1778773">0</span><span class="op" id="1778774">]</span>&nbsp;<span class="op" id="1778776">=</span>&nbsp;<span class="ident" id="1778778">t4</span>&nbsp;<span class="op" id="1778781">|</span>&nbsp;<span class="builtintype" id="1778783">byte</span><span class="op" id="1778787">(</span><span class="ident" id="1778788">r</span><span class="op" id="1778789">&gt;&gt;</span><span class="num" id="1778791">18</span><span class="op" id="1778793">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778797">p</span><span class="op" id="1778798">[</span><span class="num" id="1778799">1</span><span class="op" id="1778800">]</span>&nbsp;<span class="op" id="1778802">=</span>&nbsp;<span class="ident" id="1778804">tx</span>&nbsp;<span class="op" id="1778807">|</span>&nbsp;<span class="builtintype" id="1778809">byte</span><span class="op" id="1778813">(</span><span class="ident" id="1778814">r</span><span class="op" id="1778815">&gt;&gt;</span><span class="num" id="1778817">12</span><span class="op" id="1778819">)</span><span class="op" id="1778820">&amp;</span><span class="ident" id="1778821">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778829">p</span><span class="op" id="1778830">[</span><span class="num" id="1778831">2</span><span class="op" id="1778832">]</span>&nbsp;<span class="op" id="1778834">=</span>&nbsp;<span class="ident" id="1778836">tx</span>&nbsp;<span class="op" id="1778839">|</span>&nbsp;<span class="builtintype" id="1778841">byte</span><span class="op" id="1778845">(</span><span class="ident" id="1778846">r</span><span class="op" id="1778847">&gt;&gt;</span><span class="num" id="1778849">6</span><span class="op" id="1778850">)</span><span class="op" id="1778851">&amp;</span><span class="ident" id="1778852">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1778860">p</span><span class="op" id="1778861">[</span><span class="num" id="1778862">3</span><span class="op" id="1778863">]</span>&nbsp;<span class="op" id="1778865">=</span>&nbsp;<span class="ident" id="1778867">tx</span>&nbsp;<span class="op" id="1778870">|</span>&nbsp;<span class="builtintype" id="1778872">byte</span><span class="op" id="1778876">(</span><span class="ident" id="1778877">r</span><span class="op" id="1778878">)</span><span class="op" id="1778879">&amp;</span><span class="ident" id="1778880">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1778888">return</span>&nbsp;<span class="num" id="1778895">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1778898">}</span><br>
<span class="lineno">365</span><span class="op" id="1778900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1778903">//&nbsp;RuneCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;runes&nbsp;in&nbsp;p.&nbsp;&nbsp;Erroneous&nbsp;and&nbsp;short</span><br>
<span class="lineno"></span><span class="comment" id="1778971">//&nbsp;encodings&nbsp;are&nbsp;treated&nbsp;as&nbsp;single&nbsp;runes&nbsp;of&nbsp;width&nbsp;1&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="1779029">func</span>&nbsp;<span class="ident" id="1779034">RuneCount</span><span class="op" id="1779043">(</span><span class="ident" id="1779044">p</span>&nbsp;<span class="op" id="1779046">[</span><span class="op" id="1779047">]</span><span class="builtintype" id="1779048">byte</span><span class="op" id="1779052">)</span>&nbsp;<span class="builtintype" id="1779054">int</span>&nbsp;<span class="op" id="1779058">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779061">i</span>&nbsp;<span class="op" id="1779063">:=</span>&nbsp;<span class="num" id="1779066">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779069">var</span>&nbsp;<span class="ident" id="1779073">n</span>&nbsp;<span class="builtintype" id="1779075">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779080">for</span>&nbsp;<span class="ident" id="1779084">n</span>&nbsp;<span class="op" id="1779086">=</span>&nbsp;<span class="num" id="1779088">0</span><span class="op" id="1779089">;</span>&nbsp;<span class="ident" id="1779091">i</span>&nbsp;<span class="op" id="1779093">&lt;</span>&nbsp;<span class="builtinfunc" id="1779095">len</span><span class="op" id="1779098">(</span><span class="ident" id="1779099">p</span><span class="op" id="1779100">)</span><span class="op" id="1779101">;</span>&nbsp;<span class="ident" id="1779103">n</span><span class="op" id="1779104">++</span>&nbsp;<span class="op" id="1779107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779111">if</span>&nbsp;<span class="ident" id="1779114">p</span><span class="op" id="1779115">[</span><span class="ident" id="1779116">i</span><span class="op" id="1779117">]</span>&nbsp;<span class="op" id="1779119">&lt;</span>&nbsp;<span class="ident" id="1779121">RuneSelf</span>&nbsp;<span class="op" id="1779130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779135">i</span><span class="op" id="1779136">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1779141">}</span>&nbsp;<span class="keyword" id="1779143">else</span>&nbsp;<span class="op" id="1779148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779153">_</span><span class="op" id="1779154">,</span>&nbsp;<span class="ident" id="1779156">size</span>&nbsp;<span class="op" id="1779161">:=</span>&nbsp;<span class="ident" id="1779164">DecodeRune</span><span class="op" id="1779174">(</span><span class="ident" id="1779175">p</span><span class="op" id="1779176">[</span><span class="ident" id="1779177">i</span><span class="op" id="1779178">:</span><span class="op" id="1779179">]</span><span class="op" id="1779180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779185">i</span>&nbsp;<span class="op" id="1779187">+=</span>&nbsp;<span class="ident" id="1779190">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1779197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1779200">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779203">return</span>&nbsp;<span class="ident" id="1779210">n</span><br>
<span class="lineno"></span><span class="op" id="1779212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1779215">//&nbsp;RuneCountInString&nbsp;is&nbsp;like&nbsp;RuneCount&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1779281">func</span>&nbsp;<span class="ident" id="1779286">RuneCountInString</span><span class="op" id="1779303">(</span><span class="ident" id="1779304">s</span>&nbsp;<span class="builtintype" id="1779306">string</span><span class="op" id="1779312">)</span>&nbsp;<span class="op" id="1779314">(</span><span class="ident" id="1779315">n</span>&nbsp;<span class="builtintype" id="1779317">int</span><span class="op" id="1779320">)</span>&nbsp;<span class="op" id="1779322">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779325">for</span>&nbsp;<span class="keyword" id="1779329">range</span>&nbsp;<span class="ident" id="1779335">s</span>&nbsp;<span class="op" id="1779337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779341">n</span><span class="op" id="1779342">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1779346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779349">return</span><br>
<span class="lineno"></span><span class="op" id="1779356">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="1779359">//&nbsp;RuneStart&nbsp;reports&nbsp;whether&nbsp;the&nbsp;byte&nbsp;could&nbsp;be&nbsp;the&nbsp;first&nbsp;byte&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1779424">//&nbsp;an&nbsp;encoded&nbsp;rune.&nbsp;&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;bytes&nbsp;always&nbsp;have&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span><span class="comment" id="1779493">//&nbsp;two&nbsp;bits&nbsp;set&nbsp;to&nbsp;10.</span><br>
<span class="lineno"></span><span class="keyword" id="1779516">func</span>&nbsp;<span class="ident" id="1779521">RuneStart</span><span class="op" id="1779530">(</span><span class="ident" id="1779531">b</span>&nbsp;<span class="builtintype" id="1779533">byte</span><span class="op" id="1779537">)</span>&nbsp;<span class="builtintype" id="1779539">bool</span>&nbsp;<span class="op" id="1779544">{</span>&nbsp;<span class="keyword" id="1779546">return</span>&nbsp;<span class="ident" id="1779553">b</span><span class="op" id="1779554">&amp;</span><span class="num" id="1779555">0xC0</span>&nbsp;<span class="op" id="1779560">!=</span>&nbsp;<span class="num" id="1779563">0x80</span>&nbsp;<span class="op" id="1779568">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="1779571">//&nbsp;Valid&nbsp;reports&nbsp;whether&nbsp;p&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1779646">func</span>&nbsp;<span class="ident" id="1779651">Valid</span><span class="op" id="1779656">(</span><span class="ident" id="1779657">p</span>&nbsp;<span class="op" id="1779659">[</span><span class="op" id="1779660">]</span><span class="builtintype" id="1779661">byte</span><span class="op" id="1779665">)</span>&nbsp;<span class="builtintype" id="1779667">bool</span>&nbsp;<span class="op" id="1779672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779675">i</span>&nbsp;<span class="op" id="1779677">:=</span>&nbsp;<span class="num" id="1779680">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779683">for</span>&nbsp;<span class="ident" id="1779687">i</span>&nbsp;<span class="op" id="1779689">&lt;</span>&nbsp;<span class="builtinfunc" id="1779691">len</span><span class="op" id="1779694">(</span><span class="ident" id="1779695">p</span><span class="op" id="1779696">)</span>&nbsp;<span class="op" id="1779698">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779702">if</span>&nbsp;<span class="ident" id="1779705">p</span><span class="op" id="1779706">[</span><span class="ident" id="1779707">i</span><span class="op" id="1779708">]</span>&nbsp;<span class="op" id="1779710">&lt;</span>&nbsp;<span class="ident" id="1779712">RuneSelf</span>&nbsp;<span class="op" id="1779721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779726">i</span><span class="op" id="1779727">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1779732">}</span>&nbsp;<span class="keyword" id="1779734">else</span>&nbsp;<span class="op" id="1779739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779744">_</span><span class="op" id="1779745">,</span>&nbsp;<span class="ident" id="1779747">size</span>&nbsp;<span class="op" id="1779752">:=</span>&nbsp;<span class="ident" id="1779755">DecodeRune</span><span class="op" id="1779765">(</span><span class="ident" id="1779766">p</span><span class="op" id="1779767">[</span><span class="ident" id="1779768">i</span><span class="op" id="1779769">:</span><span class="op" id="1779770">]</span><span class="op" id="1779771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779776">if</span>&nbsp;<span class="ident" id="1779779">size</span>&nbsp;<span class="op" id="1779784">==</span>&nbsp;<span class="num" id="1779787">1</span>&nbsp;<span class="op" id="1779789">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1779795">//&nbsp;All&nbsp;valid&nbsp;runes&nbsp;of&nbsp;size&nbsp;1&nbsp;(those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1779835">//&nbsp;below&nbsp;RuneSelf)&nbsp;were&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1779878">//&nbsp;This&nbsp;must&nbsp;be&nbsp;a&nbsp;RuneError.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779911">return</span>&nbsp;<span class="builtintype" id="1779918">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1779927">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1779932">i</span>&nbsp;<span class="op" id="1779934">+=</span>&nbsp;<span class="ident" id="1779937">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1779944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1779947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1779950">return</span>&nbsp;<span class="builtintype" id="1779957">true</span><br>
<span class="lineno"></span><span class="op" id="1779962">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="1779965">//&nbsp;ValidString&nbsp;reports&nbsp;whether&nbsp;s&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1780046">func</span>&nbsp;<span class="ident" id="1780051">ValidString</span><span class="op" id="1780062">(</span><span class="ident" id="1780063">s</span>&nbsp;<span class="builtintype" id="1780065">string</span><span class="op" id="1780071">)</span>&nbsp;<span class="builtintype" id="1780073">bool</span>&nbsp;<span class="op" id="1780078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1780081">for</span>&nbsp;<span class="ident" id="1780085">i</span><span class="op" id="1780086">,</span>&nbsp;<span class="ident" id="1780088">r</span>&nbsp;<span class="op" id="1780090">:=</span>&nbsp;<span class="keyword" id="1780093">range</span>&nbsp;<span class="ident" id="1780099">s</span>&nbsp;<span class="op" id="1780101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1780105">if</span>&nbsp;<span class="ident" id="1780108">r</span>&nbsp;<span class="op" id="1780110">==</span>&nbsp;<span class="ident" id="1780113">RuneError</span>&nbsp;<span class="op" id="1780123">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1780128">//&nbsp;The&nbsp;RuneError&nbsp;value&nbsp;can&nbsp;be&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1780170">//&nbsp;sentinel&nbsp;value&nbsp;(if&nbsp;it&#39;s&nbsp;size&nbsp;1)&nbsp;or&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1780220">//&nbsp;value&nbsp;encoded&nbsp;properly.&nbsp;Decode&nbsp;it&nbsp;to&nbsp;see&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1780270">//&nbsp;it&#39;s&nbsp;the&nbsp;1&nbsp;byte&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1780308">_</span><span class="op" id="1780309">,</span>&nbsp;<span class="ident" id="1780311">size</span>&nbsp;<span class="op" id="1780316">:=</span>&nbsp;<span class="ident" id="1780319">DecodeRuneInString</span><span class="op" id="1780337">(</span><span class="ident" id="1780338">s</span><span class="op" id="1780339">[</span><span class="ident" id="1780340">i</span><span class="op" id="1780341">:</span><span class="op" id="1780342">]</span><span class="op" id="1780343">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1780348">if</span>&nbsp;<span class="ident" id="1780351">size</span>&nbsp;<span class="op" id="1780356">==</span>&nbsp;<span class="num" id="1780359">1</span>&nbsp;<span class="op" id="1780361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1780367">return</span>&nbsp;<span class="builtintype" id="1780374">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1780383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1780387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1780390">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1780393">return</span>&nbsp;<span class="builtintype" id="1780400">true</span><br>
<span class="lineno"></span><span class="op" id="1780405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1780408">//&nbsp;ValidRune&nbsp;reports&nbsp;whether&nbsp;r&nbsp;can&nbsp;be&nbsp;legally&nbsp;encoded&nbsp;as&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1780472">//&nbsp;Code&nbsp;points&nbsp;that&nbsp;are&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;a&nbsp;surrogate&nbsp;half&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno">435</span><span class="keyword" id="1780542">func</span>&nbsp;<span class="ident" id="1780547">ValidRune</span><span class="op" id="1780556">(</span><span class="ident" id="1780557">r</span>&nbsp;<span class="builtintype" id="1780559">rune</span><span class="op" id="1780563">)</span>&nbsp;<span class="builtintype" id="1780565">bool</span>&nbsp;<span class="op" id="1780570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1780573">switch</span>&nbsp;<span class="op" id="1780580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1780583">case</span>&nbsp;<span class="ident" id="1780588">r</span>&nbsp;<span class="op" id="1780590">&lt;</span>&nbsp;<span class="num" id="1780592">0</span><span class="op" id="1780593">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1780597">return</span>&nbsp;<span class="builtintype" id="1780604">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1780611">case</span>&nbsp;<span class="ident" id="1780616">surrogateMin</span>&nbsp;<span class="op" id="1780629">&lt;=</span>&nbsp;<span class="ident" id="1780632">r</span>&nbsp;<span class="op" id="1780634">&amp;&amp;</span>&nbsp;<span class="ident" id="1780637">r</span>&nbsp;<span class="op" id="1780639">&lt;=</span>&nbsp;<span class="ident" id="1780642">surrogateMax</span><span class="op" id="1780654">:</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1780658">return</span>&nbsp;<span class="builtintype" id="1780665">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1780672">case</span>&nbsp;<span class="ident" id="1780677">r</span>&nbsp;<span class="op" id="1780679">&gt;</span>&nbsp;<span class="ident" id="1780681">MaxRune</span><span class="op" id="1780688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1780692">return</span>&nbsp;<span class="builtintype" id="1780699">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1780706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1780709">return</span>&nbsp;<span class="builtintype" id="1780716">true</span><br>
<span class="lineno">445</span><span class="op" id="1780721">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
