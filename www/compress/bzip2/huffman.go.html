<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6244345">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6244400">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6244454">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6244505">package</span>&nbsp;<span class="ident" id="6244513">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6244520">import</span>&nbsp;<span class="string" id="6244527">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6244535">//&nbsp;A&nbsp;huffmanTree&nbsp;is&nbsp;a&nbsp;binary&nbsp;tree&nbsp;which&nbsp;is&nbsp;navigated,&nbsp;bit-by-bit&nbsp;to&nbsp;reach&nbsp;a</span><br>
<span class="lineno">10</span><span class="comment" id="6244611">//&nbsp;symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="6244622">type</span>&nbsp;<span class="ident" id="6244627">huffmanTree</span>&nbsp;<span class="keyword" id="6244639">struct</span>&nbsp;<span class="op" id="6244646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6244649">//&nbsp;nodes&nbsp;contains&nbsp;all&nbsp;the&nbsp;non-leaf&nbsp;nodes&nbsp;in&nbsp;the&nbsp;tree.&nbsp;nodes[0]&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6244720">//&nbsp;root&nbsp;of&nbsp;the&nbsp;tree&nbsp;and&nbsp;nextNode&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6244793">//&nbsp;of&nbsp;nodes&nbsp;to&nbsp;use&nbsp;when&nbsp;the&nbsp;tree&nbsp;is&nbsp;being&nbsp;constructed.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6244849">nodes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6244858">[</span><span class="op" id="6244859">]</span><span class="ident" id="6244860"><a href="/compress/bzip2/huffman.go.html#6245322">huffmanNode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6244873">nextNode</span>&nbsp;<span class="builtintype" id="6244882">int</span><br>
<span class="lineno"></span><span class="op" id="6244886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6244889">//&nbsp;A&nbsp;huffmanNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.&nbsp;left&nbsp;and&nbsp;right&nbsp;contain&nbsp;indexes&nbsp;into&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="6244969">//&nbsp;nodes&nbsp;slice&nbsp;of&nbsp;the&nbsp;tree.&nbsp;If&nbsp;left&nbsp;or&nbsp;right&nbsp;is&nbsp;invalidNodeValue&nbsp;then&nbsp;the&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="6245049">//&nbsp;is&nbsp;a&nbsp;left&nbsp;node&nbsp;and&nbsp;its&nbsp;value&nbsp;is&nbsp;in&nbsp;leftValue/rightValue.</span><br>
<span class="lineno"></span><span class="comment" id="6245109">//</span><br>
<span class="lineno"></span><span class="comment" id="6245112">//&nbsp;The&nbsp;symbols&nbsp;are&nbsp;uint16s&nbsp;because&nbsp;bzip2&nbsp;encodes&nbsp;not&nbsp;only&nbsp;MTF&nbsp;indexes&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6245189">//&nbsp;tree,&nbsp;but&nbsp;also&nbsp;two&nbsp;magic&nbsp;values&nbsp;for&nbsp;run-length&nbsp;encoding&nbsp;and&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno">25</span><span class="comment" id="6245267">//&nbsp;Thus&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;256&nbsp;possible&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="6245317">type</span>&nbsp;<span class="ident" id="6245322">huffmanNode</span>&nbsp;<span class="keyword" id="6245334">struct</span>&nbsp;<span class="op" id="6245341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6245344">left</span><span class="op" id="6245348">,</span>&nbsp;<span class="ident" id="6245350">right</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6245366">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6245374">leftValue</span><span class="op" id="6245383">,</span>&nbsp;<span class="ident" id="6245385">rightValue</span>&nbsp;<span class="builtintype" id="6245396">uint16</span><br>
<span class="lineno"></span><span class="op" id="6245403">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="6245406">//&nbsp;invalidNodeValue&nbsp;is&nbsp;an&nbsp;invalid&nbsp;index&nbsp;which&nbsp;marks&nbsp;a&nbsp;leaf&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><span class="keyword" id="6245483">const</span>&nbsp;<span class="ident" id="6245489">invalidNodeValue</span>&nbsp;<span class="op" id="6245506">=</span>&nbsp;<span class="num" id="6245508">0xffff</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6245516">//&nbsp;Decode&nbsp;reads&nbsp;bits&nbsp;from&nbsp;the&nbsp;given&nbsp;bitReader&nbsp;and&nbsp;navigates&nbsp;the&nbsp;tree&nbsp;until&nbsp;a</span><br>
<span class="lineno">35</span><span class="comment" id="6245593">//&nbsp;symbol&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="6245613">func</span>&nbsp;<span class="op" id="6245618">(</span><span class="ident" id="6245619">t</span>&nbsp;<span class="op" id="6245621">*</span><span class="ident" id="6245622"><a href="/compress/bzip2/huffman.go.html#6244627">huffmanTree</a></span><span class="op" id="6245633">)</span>&nbsp;<span class="ident" id="6245635">Decode</span><span class="op" id="6245641">(</span><span class="ident" id="6245642">br</span>&nbsp;<span class="op" id="6245645">*</span><span class="ident" id="6245646"><a href="/compress/bzip2/bit_reader.go.html#6229239">bitReader</a></span><span class="op" id="6245655">)</span>&nbsp;<span class="op" id="6245657">(</span><span class="ident" id="6245658">v</span>&nbsp;<span class="builtintype" id="6245660">uint16</span><span class="op" id="6245666">)</span>&nbsp;<span class="op" id="6245668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6245671">nodeIndex</span>&nbsp;<span class="op" id="6245681">:=</span>&nbsp;<span class="builtintype" id="6245684">uint16</span><span class="op" id="6245690">(</span><span class="num" id="6245691">0</span><span class="op" id="6245692">)</span>&nbsp;<span class="comment" id="6245694">//&nbsp;node&nbsp;0&nbsp;is&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6245731">for</span>&nbsp;<span class="op" id="6245735">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6245739">node</span>&nbsp;<span class="op" id="6245744">:=</span>&nbsp;<span class="op" id="6245747">&amp;</span><span class="ident" id="6245748"><a href="/compress/bzip2/huffman.go.html#6245619">t</a></span><span class="op" id="6245749">.</span><span class="ident" id="6245750">nodes</span><span class="op" id="6245755">[</span><span class="ident" id="6245756"><a href="/compress/bzip2/huffman.go.html#6245671">nodeIndex</a></span><span class="op" id="6245765">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6245769">bit</span><span class="op" id="6245772">,</span>&nbsp;<span class="ident" id="6245774">ok</span>&nbsp;<span class="op" id="6245777">:=</span>&nbsp;<span class="ident" id="6245780"><a href="/compress/bzip2/huffman.go.html#6245642">br</a></span><span class="op" id="6245782">.</span><span class="ident" id="6245783">TryReadBit</span><span class="op" id="6245793">(</span><span class="op" id="6245794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6245798">if</span>&nbsp;<span class="op" id="6245801">!</span><span class="ident" id="6245802"><a href="/compress/bzip2/huffman.go.html#6245774">ok</a></span>&nbsp;<span class="op" id="6245805">&amp;&amp;</span>&nbsp;<span class="ident" id="6245808"><a href="/compress/bzip2/huffman.go.html#6245642">br</a></span><span class="op" id="6245810">.</span><span class="ident" id="6245811">ReadBit</span><span class="op" id="6245818">(</span><span class="op" id="6245819">)</span>&nbsp;<span class="op" id="6245821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6245826"><a href="/compress/bzip2/huffman.go.html#6245769">bit</a></span>&nbsp;<span class="op" id="6245830">=</span>&nbsp;<span class="num" id="6245832">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6245836">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6245840">//&nbsp;bzip2&nbsp;encodes&nbsp;left&nbsp;as&nbsp;a&nbsp;true&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6245879">if</span>&nbsp;<span class="ident" id="6245882"><a href="/compress/bzip2/huffman.go.html#6245769">bit</a></span>&nbsp;<span class="op" id="6245886">!=</span>&nbsp;<span class="num" id="6245889">0</span>&nbsp;<span class="op" id="6245891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6245896">//&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6245907">if</span>&nbsp;<span class="ident" id="6245910"><a href="/compress/bzip2/huffman.go.html#6245739">node</a></span><span class="op" id="6245914">.</span><span class="ident" id="6245915">left</span>&nbsp;<span class="op" id="6245920">==</span>&nbsp;<span class="ident" id="6245923"><a href="/compress/bzip2/huffman.go.html#6245489">invalidNodeValue</a></span>&nbsp;<span class="op" id="6245940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6245946">return</span>&nbsp;<span class="ident" id="6245953"><a href="/compress/bzip2/huffman.go.html#6245739">node</a></span><span class="op" id="6245957">.</span><span class="ident" id="6245958">leftValue</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6245971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6245976"><a href="/compress/bzip2/huffman.go.html#6245671">nodeIndex</a></span>&nbsp;<span class="op" id="6245986">=</span>&nbsp;<span class="ident" id="6245988"><a href="/compress/bzip2/huffman.go.html#6245739">node</a></span><span class="op" id="6245992">.</span><span class="ident" id="6245993">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6246000">}</span>&nbsp;<span class="keyword" id="6246002">else</span>&nbsp;<span class="op" id="6246007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6246012">//&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6246024">if</span>&nbsp;<span class="ident" id="6246027"><a href="/compress/bzip2/huffman.go.html#6245739">node</a></span><span class="op" id="6246031">.</span><span class="ident" id="6246032">right</span>&nbsp;<span class="op" id="6246038">==</span>&nbsp;<span class="ident" id="6246041"><a href="/compress/bzip2/huffman.go.html#6245489">invalidNodeValue</a></span>&nbsp;<span class="op" id="6246058">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6246064">return</span>&nbsp;<span class="ident" id="6246071"><a href="/compress/bzip2/huffman.go.html#6245739">node</a></span><span class="op" id="6246075">.</span><span class="ident" id="6246076">rightValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6246090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6246095"><a href="/compress/bzip2/huffman.go.html#6245671">nodeIndex</a></span>&nbsp;<span class="op" id="6246105">=</span>&nbsp;<span class="ident" id="6246107"><a href="/compress/bzip2/huffman.go.html#6245739">node</a></span><span class="op" id="6246111">.</span><span class="ident" id="6246112">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6246120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6246123">}</span><br>
<span class="lineno">60</span><span class="op" id="6246125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6246128">//&nbsp;newHuffmanTree&nbsp;builds&nbsp;a&nbsp;Huffman&nbsp;tree&nbsp;from&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="6246201">//&nbsp;lengths&nbsp;of&nbsp;each&nbsp;symbol.&nbsp;The&nbsp;maximum&nbsp;code&nbsp;length&nbsp;is&nbsp;32&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="6246264">func</span>&nbsp;<span class="ident" id="6246269">newHuffmanTree</span><span class="op" id="6246283">(</span><span class="ident" id="6246284">lengths</span>&nbsp;<span class="op" id="6246292">[</span><span class="op" id="6246293">]</span><span class="builtintype" id="6246294">uint8</span><span class="op" id="6246299">)</span>&nbsp;<span class="op" id="6246301">(</span><span class="ident" id="6246302"><a href="/compress/bzip2/huffman.go.html#6244627">huffmanTree</a></span><span class="op" id="6246313">,</span>&nbsp;<span class="builtintype" id="6246315">error</span><span class="op" id="6246320">)</span>&nbsp;<span class="op" id="6246322">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6246325">//&nbsp;There&nbsp;are&nbsp;many&nbsp;possible&nbsp;trees&nbsp;that&nbsp;assign&nbsp;the&nbsp;same&nbsp;code&nbsp;length&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6246395">//&nbsp;each&nbsp;symbol&nbsp;(consider&nbsp;reflecting&nbsp;a&nbsp;tree&nbsp;down&nbsp;the&nbsp;middle,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6246460">//&nbsp;example).&nbsp;Since&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6246522">//&nbsp;efficiency&nbsp;of&nbsp;the&nbsp;tree,&nbsp;each&nbsp;of&nbsp;these&nbsp;trees&nbsp;is&nbsp;equally&nbsp;good.&nbsp;In</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6246590">//&nbsp;order&nbsp;to&nbsp;minimize&nbsp;the&nbsp;amount&nbsp;of&nbsp;information&nbsp;needed&nbsp;to&nbsp;build&nbsp;a&nbsp;tree</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6246661">//&nbsp;bzip2&nbsp;uses&nbsp;a&nbsp;canonical&nbsp;tree&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;reconstructed&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6246731">//&nbsp;only&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6246770">if</span>&nbsp;<span class="builtinfunc" id="6246773">len</span><span class="op" id="6246776">(</span><span class="ident" id="6246777"><a href="/compress/bzip2/huffman.go.html#6246284">lengths</a></span><span class="op" id="6246784">)</span>&nbsp;<span class="op" id="6246786">&lt;</span>&nbsp;<span class="num" id="6246788">2</span>&nbsp;<span class="op" id="6246790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6246794">panic</span><span class="op" id="6246799">(</span><span class="string" id="6246800">&#34;newHuffmanTree:&nbsp;too&nbsp;few&nbsp;symbols&#34;</span><span class="op" id="6246833">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6246836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6246840">var</span>&nbsp;<span class="ident" id="6246844">t</span>&nbsp;<span class="ident" id="6246846"><a href="/compress/bzip2/huffman.go.html#6244627">huffmanTree</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6246860">//&nbsp;First&nbsp;we&nbsp;sort&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;by&nbsp;ascending&nbsp;code&nbsp;length,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6246932">//&nbsp;using&nbsp;the&nbsp;symbol&nbsp;value&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6246974">pairs</span>&nbsp;<span class="op" id="6246980">:=</span>&nbsp;<span class="ident" id="6246983"><a href="/compress/bzip2/huffman.go.html#6248443">huffmanSymbolLengthPairs</a></span><span class="op" id="6247007">(</span><span class="builtinfunc" id="6247008">make</span><span class="op" id="6247012">(</span><span class="op" id="6247013">[</span><span class="op" id="6247014">]</span><span class="ident" id="6247015"><a href="/compress/bzip2/huffman.go.html#6248301">huffmanSymbolLengthPair</a></span><span class="op" id="6247038">,</span>&nbsp;<span class="builtinfunc" id="6247040">len</span><span class="op" id="6247043">(</span><span class="ident" id="6247044"><a href="/compress/bzip2/huffman.go.html#6246284">lengths</a></span><span class="op" id="6247051">)</span><span class="op" id="6247052">)</span><span class="op" id="6247053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6247056">for</span>&nbsp;<span class="ident" id="6247060">i</span><span class="op" id="6247061">,</span>&nbsp;<span class="ident" id="6247063">length</span>&nbsp;<span class="op" id="6247070">:=</span>&nbsp;<span class="keyword" id="6247073">range</span>&nbsp;<span class="ident" id="6247079"><a href="/compress/bzip2/huffman.go.html#6246284">lengths</a></span>&nbsp;<span class="op" id="6247087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247091"><a href="/compress/bzip2/huffman.go.html#6246974">pairs</a></span><span class="op" id="6247096">[</span><span class="ident" id="6247097"><a href="/compress/bzip2/huffman.go.html#6247060">i</a></span><span class="op" id="6247098">]</span><span class="op" id="6247099">.</span><span class="ident" id="6247100">value</span>&nbsp;<span class="op" id="6247106">=</span>&nbsp;<span class="builtintype" id="6247108">uint16</span><span class="op" id="6247114">(</span><span class="ident" id="6247115"><a href="/compress/bzip2/huffman.go.html#6247060">i</a></span><span class="op" id="6247116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247120"><a href="/compress/bzip2/huffman.go.html#6246974">pairs</a></span><span class="op" id="6247125">[</span><span class="ident" id="6247126"><a href="/compress/bzip2/huffman.go.html#6247060">i</a></span><span class="op" id="6247127">]</span><span class="op" id="6247128">.</span><span class="ident" id="6247129">length</span>&nbsp;<span class="op" id="6247136">=</span>&nbsp;<span class="ident" id="6247138"><a href="/compress/bzip2/huffman.go.html#6247063">length</a></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6247146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247150"><a href="/compress/bzip2/huffman.go.html#6244527">sort</a></span><span class="op" id="6247154">.</span><span class="ident" id="6247155">Sort</span><span class="op" id="6247159">(</span><span class="ident" id="6247160"><a href="/compress/bzip2/huffman.go.html#6246974">pairs</a></span><span class="op" id="6247165">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6247169">//&nbsp;Now&nbsp;we&nbsp;assign&nbsp;codes&nbsp;to&nbsp;the&nbsp;symbols,&nbsp;starting&nbsp;with&nbsp;the&nbsp;longest&nbsp;code.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6247241">//&nbsp;We&nbsp;keep&nbsp;the&nbsp;codes&nbsp;packed&nbsp;into&nbsp;a&nbsp;uint32,&nbsp;at&nbsp;the&nbsp;most-significant&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6247314">//&nbsp;So&nbsp;branches&nbsp;are&nbsp;taken&nbsp;from&nbsp;the&nbsp;MSB&nbsp;downwards.&nbsp;This&nbsp;makes&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6247386">//&nbsp;sort&nbsp;them&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247407">code</span>&nbsp;<span class="op" id="6247412">:=</span>&nbsp;<span class="builtintype" id="6247415">uint32</span><span class="op" id="6247421">(</span><span class="num" id="6247422">0</span><span class="op" id="6247423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247426">length</span>&nbsp;<span class="op" id="6247433">:=</span>&nbsp;<span class="builtintype" id="6247436">uint8</span><span class="op" id="6247441">(</span><span class="num" id="6247442">32</span><span class="op" id="6247444">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247448">codes</span>&nbsp;<span class="op" id="6247454">:=</span>&nbsp;<span class="ident" id="6247457"><a href="/compress/bzip2/huffman.go.html#6249059">huffmanCodes</a></span><span class="op" id="6247469">(</span><span class="builtinfunc" id="6247470">make</span><span class="op" id="6247474">(</span><span class="op" id="6247475">[</span><span class="op" id="6247476">]</span><span class="ident" id="6247477"><a href="/compress/bzip2/huffman.go.html#6248922">huffmanCode</a></span><span class="op" id="6247488">,</span>&nbsp;<span class="builtinfunc" id="6247490">len</span><span class="op" id="6247493">(</span><span class="ident" id="6247494"><a href="/compress/bzip2/huffman.go.html#6246284">lengths</a></span><span class="op" id="6247501">)</span><span class="op" id="6247502">)</span><span class="op" id="6247503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6247506">for</span>&nbsp;<span class="ident" id="6247510">i</span>&nbsp;<span class="op" id="6247512">:=</span>&nbsp;<span class="builtinfunc" id="6247515">len</span><span class="op" id="6247518">(</span><span class="ident" id="6247519"><a href="/compress/bzip2/huffman.go.html#6246974">pairs</a></span><span class="op" id="6247524">)</span>&nbsp;<span class="op" id="6247526">-</span>&nbsp;<span class="num" id="6247528">1</span><span class="op" id="6247529">;</span>&nbsp;<span class="ident" id="6247531"><a href="/compress/bzip2/huffman.go.html#6247510">i</a></span>&nbsp;<span class="op" id="6247533">&gt;=</span>&nbsp;<span class="num" id="6247536">0</span><span class="op" id="6247537">;</span>&nbsp;<span class="ident" id="6247539"><a href="/compress/bzip2/huffman.go.html#6247510">i</a></span><span class="op" id="6247540">--</span>&nbsp;<span class="op" id="6247543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6247547">if</span>&nbsp;<span class="ident" id="6247550"><a href="/compress/bzip2/huffman.go.html#6247426">length</a></span>&nbsp;<span class="op" id="6247557">&gt;</span>&nbsp;<span class="ident" id="6247559"><a href="/compress/bzip2/huffman.go.html#6246974">pairs</a></span><span class="op" id="6247564">[</span><span class="ident" id="6247565"><a href="/compress/bzip2/huffman.go.html#6247510">i</a></span><span class="op" id="6247566">]</span><span class="op" id="6247567">.</span><span class="ident" id="6247568">length</span>&nbsp;<span class="op" id="6247575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6247580">//&nbsp;If&nbsp;the&nbsp;code&nbsp;length&nbsp;decreases&nbsp;we&nbsp;shift&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6247636">//&nbsp;zero&nbsp;any&nbsp;bits&nbsp;beyond&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247684"><a href="/compress/bzip2/huffman.go.html#6247426">length</a></span>&nbsp;<span class="op" id="6247691">&gt;&gt;=</span>&nbsp;<span class="num" id="6247695">32</span>&nbsp;<span class="op" id="6247698">-</span>&nbsp;<span class="ident" id="6247700"><a href="/compress/bzip2/huffman.go.html#6246974">pairs</a></span><span class="op" id="6247705">[</span><span class="ident" id="6247706"><a href="/compress/bzip2/huffman.go.html#6247510">i</a></span><span class="op" id="6247707">]</span><span class="op" id="6247708">.</span><span class="ident" id="6247709">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247719"><a href="/compress/bzip2/huffman.go.html#6247426">length</a></span>&nbsp;<span class="op" id="6247726">&lt;&lt;=</span>&nbsp;<span class="num" id="6247730">32</span>&nbsp;<span class="op" id="6247733">-</span>&nbsp;<span class="ident" id="6247735"><a href="/compress/bzip2/huffman.go.html#6246974">pairs</a></span><span class="op" id="6247740">[</span><span class="ident" id="6247741"><a href="/compress/bzip2/huffman.go.html#6247510">i</a></span><span class="op" id="6247742">]</span><span class="op" id="6247743">.</span><span class="ident" id="6247744">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247754"><a href="/compress/bzip2/huffman.go.html#6247426">length</a></span>&nbsp;<span class="op" id="6247761">=</span>&nbsp;<span class="ident" id="6247763"><a href="/compress/bzip2/huffman.go.html#6246974">pairs</a></span><span class="op" id="6247768">[</span><span class="ident" id="6247769"><a href="/compress/bzip2/huffman.go.html#6247510">i</a></span><span class="op" id="6247770">]</span><span class="op" id="6247771">.</span><span class="ident" id="6247772">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6247781">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247785"><a href="/compress/bzip2/huffman.go.html#6247448">codes</a></span><span class="op" id="6247790">[</span><span class="ident" id="6247791"><a href="/compress/bzip2/huffman.go.html#6247510">i</a></span><span class="op" id="6247792">]</span><span class="op" id="6247793">.</span><span class="ident" id="6247794">code</span>&nbsp;<span class="op" id="6247799">=</span>&nbsp;<span class="ident" id="6247801"><a href="/compress/bzip2/huffman.go.html#6247407">code</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247808"><a href="/compress/bzip2/huffman.go.html#6247448">codes</a></span><span class="op" id="6247813">[</span><span class="ident" id="6247814"><a href="/compress/bzip2/huffman.go.html#6247510">i</a></span><span class="op" id="6247815">]</span><span class="op" id="6247816">.</span><span class="ident" id="6247817">codeLen</span>&nbsp;<span class="op" id="6247825">=</span>&nbsp;<span class="ident" id="6247827"><a href="/compress/bzip2/huffman.go.html#6247426">length</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247836"><a href="/compress/bzip2/huffman.go.html#6247448">codes</a></span><span class="op" id="6247841">[</span><span class="ident" id="6247842"><a href="/compress/bzip2/huffman.go.html#6247510">i</a></span><span class="op" id="6247843">]</span><span class="op" id="6247844">.</span><span class="ident" id="6247845">value</span>&nbsp;<span class="op" id="6247851">=</span>&nbsp;<span class="ident" id="6247853"><a href="/compress/bzip2/huffman.go.html#6246974">pairs</a></span><span class="op" id="6247858">[</span><span class="ident" id="6247859"><a href="/compress/bzip2/huffman.go.html#6247510">i</a></span><span class="op" id="6247860">]</span><span class="op" id="6247861">.</span><span class="ident" id="6247862">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6247870">//&nbsp;We&nbsp;need&nbsp;to&nbsp;&#39;increment&#39;&nbsp;the&nbsp;code,&nbsp;which&nbsp;means&nbsp;treating&nbsp;|code|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6247936">//&nbsp;like&nbsp;a&nbsp;|length|&nbsp;bit&nbsp;number.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6247969"><a href="/compress/bzip2/huffman.go.html#6247407">code</a></span>&nbsp;<span class="op" id="6247974">+=</span>&nbsp;<span class="num" id="6247977">1</span>&nbsp;<span class="op" id="6247979">&lt;&lt;</span>&nbsp;<span class="op" id="6247982">(</span><span class="num" id="6247983">32</span>&nbsp;<span class="op" id="6247986">-</span>&nbsp;<span class="ident" id="6247988"><a href="/compress/bzip2/huffman.go.html#6247426">length</a></span><span class="op" id="6247994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6247997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6248001">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;sort&nbsp;by&nbsp;the&nbsp;code&nbsp;so&nbsp;that&nbsp;the&nbsp;left&nbsp;half&nbsp;of&nbsp;each&nbsp;branch&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6248074">//&nbsp;grouped&nbsp;together,&nbsp;recursively.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6248109"><a href="/compress/bzip2/huffman.go.html#6244527">sort</a></span><span class="op" id="6248113">.</span><span class="ident" id="6248114">Sort</span><span class="op" id="6248118">(</span><span class="ident" id="6248119"><a href="/compress/bzip2/huffman.go.html#6247448">codes</a></span><span class="op" id="6248124">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6248128"><a href="/compress/bzip2/huffman.go.html#6246844">t</a></span><span class="op" id="6248129">.</span><span class="ident" id="6248130">nodes</span>&nbsp;<span class="op" id="6248136">=</span>&nbsp;<span class="builtinfunc" id="6248138">make</span><span class="op" id="6248142">(</span><span class="op" id="6248143">[</span><span class="op" id="6248144">]</span><span class="ident" id="6248145"><a href="/compress/bzip2/huffman.go.html#6245322">huffmanNode</a></span><span class="op" id="6248156">,</span>&nbsp;<span class="builtinfunc" id="6248158">len</span><span class="op" id="6248161">(</span><span class="ident" id="6248162"><a href="/compress/bzip2/huffman.go.html#6247448">codes</a></span><span class="op" id="6248167">)</span><span class="op" id="6248168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6248171">_</span><span class="op" id="6248172">,</span>&nbsp;<span class="ident" id="6248174">err</span>&nbsp;<span class="op" id="6248178">:=</span>&nbsp;<span class="ident" id="6248181"><a href="/compress/bzip2/huffman.go.html#6249461">buildHuffmanNode</a></span><span class="op" id="6248197">(</span><span class="op" id="6248198">&amp;</span><span class="ident" id="6248199"><a href="/compress/bzip2/huffman.go.html#6246844">t</a></span><span class="op" id="6248200">,</span>&nbsp;<span class="ident" id="6248202"><a href="/compress/bzip2/huffman.go.html#6247448">codes</a></span><span class="op" id="6248207">,</span>&nbsp;<span class="num" id="6248209">0</span><span class="op" id="6248210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248213">return</span>&nbsp;<span class="ident" id="6248220"><a href="/compress/bzip2/huffman.go.html#6246844">t</a></span><span class="op" id="6248221">,</span>&nbsp;<span class="ident" id="6248223"><a href="/compress/bzip2/huffman.go.html#6248174">err</a></span><br>
<span class="lineno">120</span><span class="op" id="6248227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6248230">//&nbsp;huffmanSymbolLengthPair&nbsp;contains&nbsp;a&nbsp;symbol&nbsp;and&nbsp;its&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="6248296">type</span>&nbsp;<span class="ident" id="6248301">huffmanSymbolLengthPair</span>&nbsp;<span class="keyword" id="6248325">struct</span>&nbsp;<span class="op" id="6248332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6248335">value</span>&nbsp;&nbsp;<span class="builtintype" id="6248342">uint16</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6248350">length</span>&nbsp;<span class="builtintype" id="6248357">uint8</span><br>
<span class="lineno"></span><span class="op" id="6248363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6248366">//&nbsp;huffmanSymbolLengthPair&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno"></span><span class="keyword" id="6248438">type</span>&nbsp;<span class="ident" id="6248443">huffmanSymbolLengthPairs</span>&nbsp;<span class="op" id="6248468">[</span><span class="op" id="6248469">]</span><span class="ident" id="6248470"><a href="/compress/bzip2/huffman.go.html#6248301">huffmanSymbolLengthPair</a></span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="6248495">func</span>&nbsp;<span class="op" id="6248500">(</span><span class="ident" id="6248501">h</span>&nbsp;<span class="ident" id="6248503"><a href="/compress/bzip2/huffman.go.html#6248443">huffmanSymbolLengthPairs</a></span><span class="op" id="6248527">)</span>&nbsp;<span class="ident" id="6248529">Len</span><span class="op" id="6248532">(</span><span class="op" id="6248533">)</span>&nbsp;<span class="builtintype" id="6248535">int</span>&nbsp;<span class="op" id="6248539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248542">return</span>&nbsp;<span class="builtinfunc" id="6248549">len</span><span class="op" id="6248552">(</span><span class="ident" id="6248553"><a href="/compress/bzip2/huffman.go.html#6248501">h</a></span><span class="op" id="6248554">)</span><br>
<span class="lineno"></span><span class="op" id="6248556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="6248559">func</span>&nbsp;<span class="op" id="6248564">(</span><span class="ident" id="6248565">h</span>&nbsp;<span class="ident" id="6248567"><a href="/compress/bzip2/huffman.go.html#6248443">huffmanSymbolLengthPairs</a></span><span class="op" id="6248591">)</span>&nbsp;<span class="ident" id="6248593">Less</span><span class="op" id="6248597">(</span><span class="ident" id="6248598">i</span><span class="op" id="6248599">,</span>&nbsp;<span class="ident" id="6248601">j</span>&nbsp;<span class="builtintype" id="6248603">int</span><span class="op" id="6248606">)</span>&nbsp;<span class="builtintype" id="6248608">bool</span>&nbsp;<span class="op" id="6248613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248616">if</span>&nbsp;<span class="ident" id="6248619"><a href="/compress/bzip2/huffman.go.html#6248565">h</a></span><span class="op" id="6248620">[</span><span class="ident" id="6248621"><a href="/compress/bzip2/huffman.go.html#6248598">i</a></span><span class="op" id="6248622">]</span><span class="op" id="6248623">.</span><span class="ident" id="6248624">length</span>&nbsp;<span class="op" id="6248631">&lt;</span>&nbsp;<span class="ident" id="6248633"><a href="/compress/bzip2/huffman.go.html#6248565">h</a></span><span class="op" id="6248634">[</span><span class="ident" id="6248635"><a href="/compress/bzip2/huffman.go.html#6248601">j</a></span><span class="op" id="6248636">]</span><span class="op" id="6248637">.</span><span class="ident" id="6248638">length</span>&nbsp;<span class="op" id="6248645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248649">return</span>&nbsp;<span class="builtintype" id="6248656">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6248662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248665">if</span>&nbsp;<span class="ident" id="6248668"><a href="/compress/bzip2/huffman.go.html#6248565">h</a></span><span class="op" id="6248669">[</span><span class="ident" id="6248670"><a href="/compress/bzip2/huffman.go.html#6248598">i</a></span><span class="op" id="6248671">]</span><span class="op" id="6248672">.</span><span class="ident" id="6248673">length</span>&nbsp;<span class="op" id="6248680">&gt;</span>&nbsp;<span class="ident" id="6248682"><a href="/compress/bzip2/huffman.go.html#6248565">h</a></span><span class="op" id="6248683">[</span><span class="ident" id="6248684"><a href="/compress/bzip2/huffman.go.html#6248601">j</a></span><span class="op" id="6248685">]</span><span class="op" id="6248686">.</span><span class="ident" id="6248687">length</span>&nbsp;<span class="op" id="6248694">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248698">return</span>&nbsp;<span class="builtintype" id="6248705">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6248712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248715">if</span>&nbsp;<span class="ident" id="6248718"><a href="/compress/bzip2/huffman.go.html#6248565">h</a></span><span class="op" id="6248719">[</span><span class="ident" id="6248720"><a href="/compress/bzip2/huffman.go.html#6248598">i</a></span><span class="op" id="6248721">]</span><span class="op" id="6248722">.</span><span class="ident" id="6248723">value</span>&nbsp;<span class="op" id="6248729">&lt;</span>&nbsp;<span class="ident" id="6248731"><a href="/compress/bzip2/huffman.go.html#6248565">h</a></span><span class="op" id="6248732">[</span><span class="ident" id="6248733"><a href="/compress/bzip2/huffman.go.html#6248601">j</a></span><span class="op" id="6248734">]</span><span class="op" id="6248735">.</span><span class="ident" id="6248736">value</span>&nbsp;<span class="op" id="6248742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248746">return</span>&nbsp;<span class="builtintype" id="6248753">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6248759">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6248762">return</span>&nbsp;<span class="builtintype" id="6248769">false</span><br>
<span class="lineno"></span><span class="op" id="6248775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6248778">func</span>&nbsp;<span class="op" id="6248783">(</span><span class="ident" id="6248784">h</span>&nbsp;<span class="ident" id="6248786"><a href="/compress/bzip2/huffman.go.html#6248443">huffmanSymbolLengthPairs</a></span><span class="op" id="6248810">)</span>&nbsp;<span class="ident" id="6248812">Swap</span><span class="op" id="6248816">(</span><span class="ident" id="6248817">i</span><span class="op" id="6248818">,</span>&nbsp;<span class="ident" id="6248820">j</span>&nbsp;<span class="builtintype" id="6248822">int</span><span class="op" id="6248825">)</span>&nbsp;<span class="op" id="6248827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6248830"><a href="/compress/bzip2/huffman.go.html#6248784">h</a></span><span class="op" id="6248831">[</span><span class="ident" id="6248832"><a href="/compress/bzip2/huffman.go.html#6248817">i</a></span><span class="op" id="6248833">]</span><span class="op" id="6248834">,</span>&nbsp;<span class="ident" id="6248836"><a href="/compress/bzip2/huffman.go.html#6248784">h</a></span><span class="op" id="6248837">[</span><span class="ident" id="6248838"><a href="/compress/bzip2/huffman.go.html#6248820">j</a></span><span class="op" id="6248839">]</span>&nbsp;<span class="op" id="6248841">=</span>&nbsp;<span class="ident" id="6248843"><a href="/compress/bzip2/huffman.go.html#6248784">h</a></span><span class="op" id="6248844">[</span><span class="ident" id="6248845"><a href="/compress/bzip2/huffman.go.html#6248820">j</a></span><span class="op" id="6248846">]</span><span class="op" id="6248847">,</span>&nbsp;<span class="ident" id="6248849"><a href="/compress/bzip2/huffman.go.html#6248784">h</a></span><span class="op" id="6248850">[</span><span class="ident" id="6248851"><a href="/compress/bzip2/huffman.go.html#6248817">i</a></span><span class="op" id="6248852">]</span><br>
<span class="lineno">150</span><span class="op" id="6248854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6248857">//&nbsp;huffmanCode&nbsp;contains&nbsp;a&nbsp;symbol,&nbsp;its&nbsp;code&nbsp;and&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="6248917">type</span>&nbsp;<span class="ident" id="6248922">huffmanCode</span>&nbsp;<span class="keyword" id="6248934">struct</span>&nbsp;<span class="op" id="6248941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6248944">code</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6248952">uint32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6248960">codeLen</span>&nbsp;<span class="builtintype" id="6248968">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6248975">value</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6248983">uint16</span><br>
<span class="lineno"></span><span class="op" id="6248990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6248993">//&nbsp;huffmanCodes&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno">160</span><span class="keyword" id="6249054">type</span>&nbsp;<span class="ident" id="6249059">huffmanCodes</span>&nbsp;<span class="op" id="6249072">[</span><span class="op" id="6249073">]</span><span class="ident" id="6249074"><a href="/compress/bzip2/huffman.go.html#6248922">huffmanCode</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6249087">func</span>&nbsp;<span class="op" id="6249092">(</span><span class="ident" id="6249093">n</span>&nbsp;<span class="ident" id="6249095"><a href="/compress/bzip2/huffman.go.html#6249059">huffmanCodes</a></span><span class="op" id="6249107">)</span>&nbsp;<span class="ident" id="6249109">Len</span><span class="op" id="6249112">(</span><span class="op" id="6249113">)</span>&nbsp;<span class="builtintype" id="6249115">int</span>&nbsp;<span class="op" id="6249119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249122">return</span>&nbsp;<span class="builtinfunc" id="6249129">len</span><span class="op" id="6249132">(</span><span class="ident" id="6249133"><a href="/compress/bzip2/huffman.go.html#6249093">n</a></span><span class="op" id="6249134">)</span><br>
<span class="lineno"></span><span class="op" id="6249136">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6249139">func</span>&nbsp;<span class="op" id="6249144">(</span><span class="ident" id="6249145">n</span>&nbsp;<span class="ident" id="6249147"><a href="/compress/bzip2/huffman.go.html#6249059">huffmanCodes</a></span><span class="op" id="6249159">)</span>&nbsp;<span class="ident" id="6249161">Less</span><span class="op" id="6249165">(</span><span class="ident" id="6249166">i</span><span class="op" id="6249167">,</span>&nbsp;<span class="ident" id="6249169">j</span>&nbsp;<span class="builtintype" id="6249171">int</span><span class="op" id="6249174">)</span>&nbsp;<span class="builtintype" id="6249176">bool</span>&nbsp;<span class="op" id="6249181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249184">return</span>&nbsp;<span class="ident" id="6249191"><a href="/compress/bzip2/huffman.go.html#6249145">n</a></span><span class="op" id="6249192">[</span><span class="ident" id="6249193"><a href="/compress/bzip2/huffman.go.html#6249166">i</a></span><span class="op" id="6249194">]</span><span class="op" id="6249195">.</span><span class="ident" id="6249196">code</span>&nbsp;<span class="op" id="6249201">&lt;</span>&nbsp;<span class="ident" id="6249203"><a href="/compress/bzip2/huffman.go.html#6249145">n</a></span><span class="op" id="6249204">[</span><span class="ident" id="6249205"><a href="/compress/bzip2/huffman.go.html#6249169">j</a></span><span class="op" id="6249206">]</span><span class="op" id="6249207">.</span><span class="ident" id="6249208">code</span><br>
<span class="lineno"></span><span class="op" id="6249213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="6249216">func</span>&nbsp;<span class="op" id="6249221">(</span><span class="ident" id="6249222">n</span>&nbsp;<span class="ident" id="6249224"><a href="/compress/bzip2/huffman.go.html#6249059">huffmanCodes</a></span><span class="op" id="6249236">)</span>&nbsp;<span class="ident" id="6249238">Swap</span><span class="op" id="6249242">(</span><span class="ident" id="6249243">i</span><span class="op" id="6249244">,</span>&nbsp;<span class="ident" id="6249246">j</span>&nbsp;<span class="builtintype" id="6249248">int</span><span class="op" id="6249251">)</span>&nbsp;<span class="op" id="6249253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249256"><a href="/compress/bzip2/huffman.go.html#6249222">n</a></span><span class="op" id="6249257">[</span><span class="ident" id="6249258"><a href="/compress/bzip2/huffman.go.html#6249243">i</a></span><span class="op" id="6249259">]</span><span class="op" id="6249260">,</span>&nbsp;<span class="ident" id="6249262"><a href="/compress/bzip2/huffman.go.html#6249222">n</a></span><span class="op" id="6249263">[</span><span class="ident" id="6249264"><a href="/compress/bzip2/huffman.go.html#6249246">j</a></span><span class="op" id="6249265">]</span>&nbsp;<span class="op" id="6249267">=</span>&nbsp;<span class="ident" id="6249269"><a href="/compress/bzip2/huffman.go.html#6249222">n</a></span><span class="op" id="6249270">[</span><span class="ident" id="6249271"><a href="/compress/bzip2/huffman.go.html#6249246">j</a></span><span class="op" id="6249272">]</span><span class="op" id="6249273">,</span>&nbsp;<span class="ident" id="6249275"><a href="/compress/bzip2/huffman.go.html#6249222">n</a></span><span class="op" id="6249276">[</span><span class="ident" id="6249277"><a href="/compress/bzip2/huffman.go.html#6249243">i</a></span><span class="op" id="6249278">]</span><br>
<span class="lineno"></span><span class="op" id="6249280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6249283">//&nbsp;buildHuffmanNode&nbsp;takes&nbsp;a&nbsp;slice&nbsp;of&nbsp;sorted&nbsp;huffmanCodes&nbsp;and&nbsp;builds&nbsp;a&nbsp;node&nbsp;in</span><br>
<span class="lineno">175</span><span class="comment" id="6249361">//&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;at&nbsp;the&nbsp;given&nbsp;level.&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;newly</span><br>
<span class="lineno"></span><span class="comment" id="6249435">//&nbsp;constructed&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="6249456">func</span>&nbsp;<span class="ident" id="6249461">buildHuffmanNode</span><span class="op" id="6249477">(</span><span class="ident" id="6249478">t</span>&nbsp;<span class="op" id="6249480">*</span><span class="ident" id="6249481"><a href="/compress/bzip2/huffman.go.html#6244627">huffmanTree</a></span><span class="op" id="6249492">,</span>&nbsp;<span class="ident" id="6249494">codes</span>&nbsp;<span class="op" id="6249500">[</span><span class="op" id="6249501">]</span><span class="ident" id="6249502"><a href="/compress/bzip2/huffman.go.html#6248922">huffmanCode</a></span><span class="op" id="6249513">,</span>&nbsp;<span class="ident" id="6249515">level</span>&nbsp;<span class="builtintype" id="6249521">uint32</span><span class="op" id="6249527">)</span>&nbsp;<span class="op" id="6249529">(</span><span class="ident" id="6249530">nodeIndex</span>&nbsp;<span class="builtintype" id="6249540">uint16</span><span class="op" id="6249546">,</span>&nbsp;<span class="ident" id="6249548">err</span>&nbsp;<span class="builtintype" id="6249552">error</span><span class="op" id="6249557">)</span>&nbsp;<span class="op" id="6249559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249562">test</span>&nbsp;<span class="op" id="6249567">:=</span>&nbsp;<span class="builtintype" id="6249570">uint32</span><span class="op" id="6249576">(</span><span class="num" id="6249577">1</span><span class="op" id="6249578">)</span>&nbsp;<span class="op" id="6249580">&lt;&lt;</span>&nbsp;<span class="op" id="6249583">(</span><span class="num" id="6249584">31</span>&nbsp;<span class="op" id="6249587">-</span>&nbsp;<span class="ident" id="6249589"><a href="/compress/bzip2/huffman.go.html#6249515">level</a></span><span class="op" id="6249594">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6249598">//&nbsp;We&nbsp;have&nbsp;to&nbsp;search&nbsp;the&nbsp;list&nbsp;of&nbsp;codes&nbsp;to&nbsp;find&nbsp;the&nbsp;divide&nbsp;between&nbsp;the&nbsp;left&nbsp;and&nbsp;right&nbsp;sides.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249691">firstRightIndex</span>&nbsp;<span class="op" id="6249707">:=</span>&nbsp;<span class="builtinfunc" id="6249710">len</span><span class="op" id="6249713">(</span><span class="ident" id="6249714"><a href="/compress/bzip2/huffman.go.html#6249494">codes</a></span><span class="op" id="6249719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249722">for</span>&nbsp;<span class="ident" id="6249726">i</span><span class="op" id="6249727">,</span>&nbsp;<span class="ident" id="6249729">code</span>&nbsp;<span class="op" id="6249734">:=</span>&nbsp;<span class="keyword" id="6249737">range</span>&nbsp;<span class="ident" id="6249743"><a href="/compress/bzip2/huffman.go.html#6249494">codes</a></span>&nbsp;<span class="op" id="6249749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249753">if</span>&nbsp;<span class="ident" id="6249756"><a href="/compress/bzip2/huffman.go.html#6249729">code</a></span><span class="op" id="6249760">.</span><span class="ident" id="6249761">code</span><span class="op" id="6249765">&amp;</span><span class="ident" id="6249766"><a href="/compress/bzip2/huffman.go.html#6249562">test</a></span>&nbsp;<span class="op" id="6249771">!=</span>&nbsp;<span class="num" id="6249774">0</span>&nbsp;<span class="op" id="6249776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249781"><a href="/compress/bzip2/huffman.go.html#6249691">firstRightIndex</a></span>&nbsp;<span class="op" id="6249797">=</span>&nbsp;<span class="ident" id="6249799"><a href="/compress/bzip2/huffman.go.html#6249726">i</a></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249804">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6249812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6249815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249819">left</span>&nbsp;<span class="op" id="6249824">:=</span>&nbsp;<span class="ident" id="6249827"><a href="/compress/bzip2/huffman.go.html#6249494">codes</a></span><span class="op" id="6249832">[</span><span class="op" id="6249833">:</span><span class="ident" id="6249834"><a href="/compress/bzip2/huffman.go.html#6249691">firstRightIndex</a></span><span class="op" id="6249849">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6249852">right</span>&nbsp;<span class="op" id="6249858">:=</span>&nbsp;<span class="ident" id="6249861"><a href="/compress/bzip2/huffman.go.html#6249494">codes</a></span><span class="op" id="6249866">[</span><span class="ident" id="6249867"><a href="/compress/bzip2/huffman.go.html#6249691">firstRightIndex</a></span><span class="op" id="6249882">:</span><span class="op" id="6249883">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6249887">if</span>&nbsp;<span class="builtinfunc" id="6249890">len</span><span class="op" id="6249893">(</span><span class="ident" id="6249894"><a href="/compress/bzip2/huffman.go.html#6249819">left</a></span><span class="op" id="6249898">)</span>&nbsp;<span class="op" id="6249900">==</span>&nbsp;<span class="num" id="6249903">0</span>&nbsp;<span class="op" id="6249905">||</span>&nbsp;<span class="builtinfunc" id="6249908">len</span><span class="op" id="6249911">(</span><span class="ident" id="6249912"><a href="/compress/bzip2/huffman.go.html#6249852">right</a></span><span class="op" id="6249917">)</span>&nbsp;<span class="op" id="6249919">==</span>&nbsp;<span class="num" id="6249922">0</span>&nbsp;<span class="op" id="6249924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6249928">//&nbsp;There&nbsp;is&nbsp;a&nbsp;superfluous&nbsp;level&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;indicating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6249993">//&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;encoder.&nbsp;However,&nbsp;this&nbsp;bug&nbsp;has&nbsp;been&nbsp;observed&nbsp;in</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250059">//&nbsp;the&nbsp;wild&nbsp;so&nbsp;we&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250091">//&nbsp;If&nbsp;this&nbsp;function&nbsp;was&nbsp;called&nbsp;recursively&nbsp;then&nbsp;we&nbsp;know&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250154">//&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;because,&nbsp;otherwise,&nbsp;we&nbsp;would&nbsp;have&nbsp;hit&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250217">//&nbsp;&#34;leaf&nbsp;node&#34;&nbsp;case,&nbsp;below,&nbsp;and&nbsp;not&nbsp;recursed.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250265">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250270">//&nbsp;However,&nbsp;for&nbsp;the&nbsp;initial&nbsp;call&nbsp;it&#39;s&nbsp;possible&nbsp;that&nbsp;len(codes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250335">//&nbsp;is&nbsp;zero&nbsp;or&nbsp;one.&nbsp;Both&nbsp;cases&nbsp;are&nbsp;invalid&nbsp;because&nbsp;a&nbsp;zero&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250401">//&nbsp;tree&nbsp;cannot&nbsp;encode&nbsp;anything&nbsp;and&nbsp;a&nbsp;length-1&nbsp;tree&nbsp;can&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250463">//&nbsp;encode&nbsp;EOF&nbsp;and&nbsp;so&nbsp;is&nbsp;superfluous.&nbsp;We&nbsp;reject&nbsp;both.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250518">if</span>&nbsp;<span class="builtinfunc" id="6250521">len</span><span class="op" id="6250524">(</span><span class="ident" id="6250525"><a href="/compress/bzip2/huffman.go.html#6249494">codes</a></span><span class="op" id="6250530">)</span>&nbsp;<span class="op" id="6250532">&lt;</span>&nbsp;<span class="num" id="6250534">2</span>&nbsp;<span class="op" id="6250536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250541">return</span>&nbsp;<span class="num" id="6250548">0</span><span class="op" id="6250549">,</span>&nbsp;<span class="ident" id="6250551"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6250566">(</span><span class="string" id="6250567">&#34;empty&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="6250587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6250591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250596">//&nbsp;In&nbsp;this&nbsp;case&nbsp;the&nbsp;recursion&nbsp;doesn&#39;t&nbsp;always&nbsp;reduce&nbsp;the&nbsp;length</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250661">//&nbsp;of&nbsp;codes&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;ensure&nbsp;termination&nbsp;via&nbsp;another</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250720">//&nbsp;mechanism.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250736">if</span>&nbsp;<span class="ident" id="6250739"><a href="/compress/bzip2/huffman.go.html#6249515">level</a></span>&nbsp;<span class="op" id="6250745">==</span>&nbsp;<span class="num" id="6250748">31</span>&nbsp;<span class="op" id="6250751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250756">//&nbsp;Since&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;the&nbsp;only&nbsp;way&nbsp;that&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250813">//&nbsp;can&nbsp;match&nbsp;at&nbsp;all&nbsp;32&nbsp;bits&nbsp;is&nbsp;if&nbsp;they&nbsp;are&nbsp;equal,&nbsp;which</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250872">//&nbsp;is&nbsp;invalid.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;we&nbsp;never&nbsp;enter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6250923">//&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6250949">return</span>&nbsp;<span class="num" id="6250956">0</span><span class="op" id="6250957">,</span>&nbsp;<span class="ident" id="6250959"><a href="/compress/bzip2/bzip2.go.html#6231525">StructuralError</a></span><span class="op" id="6250974">(</span><span class="string" id="6250975">&#34;equal&nbsp;symbols&nbsp;in&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="6251006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6251010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251015">if</span>&nbsp;<span class="builtinfunc" id="6251018">len</span><span class="op" id="6251021">(</span><span class="ident" id="6251022"><a href="/compress/bzip2/huffman.go.html#6249819">left</a></span><span class="op" id="6251026">)</span>&nbsp;<span class="op" id="6251028">==</span>&nbsp;<span class="num" id="6251031">0</span>&nbsp;<span class="op" id="6251033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251038">return</span>&nbsp;<span class="ident" id="6251045"><a href="/compress/bzip2/huffman.go.html#6249461">buildHuffmanNode</a></span><span class="op" id="6251061">(</span><span class="ident" id="6251062"><a href="/compress/bzip2/huffman.go.html#6249478">t</a></span><span class="op" id="6251063">,</span>&nbsp;<span class="ident" id="6251065"><a href="/compress/bzip2/huffman.go.html#6249852">right</a></span><span class="op" id="6251070">,</span>&nbsp;<span class="ident" id="6251072"><a href="/compress/bzip2/huffman.go.html#6249515">level</a></span><span class="op" id="6251077">+</span><span class="num" id="6251078">1</span><span class="op" id="6251079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6251083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251087">return</span>&nbsp;<span class="ident" id="6251094"><a href="/compress/bzip2/huffman.go.html#6249461">buildHuffmanNode</a></span><span class="op" id="6251110">(</span><span class="ident" id="6251111"><a href="/compress/bzip2/huffman.go.html#6249478">t</a></span><span class="op" id="6251112">,</span>&nbsp;<span class="ident" id="6251114"><a href="/compress/bzip2/huffman.go.html#6249819">left</a></span><span class="op" id="6251118">,</span>&nbsp;<span class="ident" id="6251120"><a href="/compress/bzip2/huffman.go.html#6249515">level</a></span><span class="op" id="6251125">+</span><span class="num" id="6251126">1</span><span class="op" id="6251127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6251130">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251134"><a href="/compress/bzip2/huffman.go.html#6249530">nodeIndex</a></span>&nbsp;<span class="op" id="6251144">=</span>&nbsp;<span class="builtintype" id="6251146">uint16</span><span class="op" id="6251152">(</span><span class="ident" id="6251153"><a href="/compress/bzip2/huffman.go.html#6249478">t</a></span><span class="op" id="6251154">.</span><span class="ident" id="6251155">nextNode</span><span class="op" id="6251163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251166">node</span>&nbsp;<span class="op" id="6251171">:=</span>&nbsp;<span class="op" id="6251174">&amp;</span><span class="ident" id="6251175"><a href="/compress/bzip2/huffman.go.html#6249478">t</a></span><span class="op" id="6251176">.</span><span class="ident" id="6251177">nodes</span><span class="op" id="6251182">[</span><span class="ident" id="6251183"><a href="/compress/bzip2/huffman.go.html#6249478">t</a></span><span class="op" id="6251184">.</span><span class="ident" id="6251185">nextNode</span><span class="op" id="6251193">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251196"><a href="/compress/bzip2/huffman.go.html#6249478">t</a></span><span class="op" id="6251197">.</span><span class="ident" id="6251198">nextNode</span><span class="op" id="6251206">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251211">if</span>&nbsp;<span class="builtinfunc" id="6251214">len</span><span class="op" id="6251217">(</span><span class="ident" id="6251218"><a href="/compress/bzip2/huffman.go.html#6249819">left</a></span><span class="op" id="6251222">)</span>&nbsp;<span class="op" id="6251224">==</span>&nbsp;<span class="num" id="6251227">1</span>&nbsp;<span class="op" id="6251229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251233">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251248"><a href="/compress/bzip2/huffman.go.html#6251166">node</a></span><span class="op" id="6251252">.</span><span class="ident" id="6251253">left</span>&nbsp;<span class="op" id="6251258">=</span>&nbsp;<span class="ident" id="6251260"><a href="/compress/bzip2/huffman.go.html#6245489">invalidNodeValue</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251279"><a href="/compress/bzip2/huffman.go.html#6251166">node</a></span><span class="op" id="6251283">.</span><span class="ident" id="6251284">leftValue</span>&nbsp;<span class="op" id="6251294">=</span>&nbsp;<span class="ident" id="6251296"><a href="/compress/bzip2/huffman.go.html#6249819">left</a></span><span class="op" id="6251300">[</span><span class="num" id="6251301">0</span><span class="op" id="6251302">]</span><span class="op" id="6251303">.</span><span class="ident" id="6251304">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6251311">}</span>&nbsp;<span class="keyword" id="6251313">else</span>&nbsp;<span class="op" id="6251318">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251322"><a href="/compress/bzip2/huffman.go.html#6251166">node</a></span><span class="op" id="6251326">.</span><span class="ident" id="6251327">left</span><span class="op" id="6251331">,</span>&nbsp;<span class="ident" id="6251333"><a href="/compress/bzip2/huffman.go.html#6249548">err</a></span>&nbsp;<span class="op" id="6251337">=</span>&nbsp;<span class="ident" id="6251339"><a href="/compress/bzip2/huffman.go.html#6249461">buildHuffmanNode</a></span><span class="op" id="6251355">(</span><span class="ident" id="6251356"><a href="/compress/bzip2/huffman.go.html#6249478">t</a></span><span class="op" id="6251357">,</span>&nbsp;<span class="ident" id="6251359"><a href="/compress/bzip2/huffman.go.html#6249819">left</a></span><span class="op" id="6251363">,</span>&nbsp;<span class="ident" id="6251365"><a href="/compress/bzip2/huffman.go.html#6249515">level</a></span><span class="op" id="6251370">+</span><span class="num" id="6251371">1</span><span class="op" id="6251372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6251375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251379">if</span>&nbsp;<span class="ident" id="6251382"><a href="/compress/bzip2/huffman.go.html#6249548">err</a></span>&nbsp;<span class="op" id="6251386">!=</span>&nbsp;<span class="ident" id="6251389">nil</span>&nbsp;<span class="op" id="6251393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251397">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6251405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251409">if</span>&nbsp;<span class="builtinfunc" id="6251412">len</span><span class="op" id="6251415">(</span><span class="ident" id="6251416"><a href="/compress/bzip2/huffman.go.html#6249852">right</a></span><span class="op" id="6251421">)</span>&nbsp;<span class="op" id="6251423">==</span>&nbsp;<span class="num" id="6251426">1</span>&nbsp;<span class="op" id="6251428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6251432">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251447"><a href="/compress/bzip2/huffman.go.html#6251166">node</a></span><span class="op" id="6251451">.</span><span class="ident" id="6251452">right</span>&nbsp;<span class="op" id="6251458">=</span>&nbsp;<span class="ident" id="6251460"><a href="/compress/bzip2/huffman.go.html#6245489">invalidNodeValue</a></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251479"><a href="/compress/bzip2/huffman.go.html#6251166">node</a></span><span class="op" id="6251483">.</span><span class="ident" id="6251484">rightValue</span>&nbsp;<span class="op" id="6251495">=</span>&nbsp;<span class="ident" id="6251497"><a href="/compress/bzip2/huffman.go.html#6249852">right</a></span><span class="op" id="6251502">[</span><span class="num" id="6251503">0</span><span class="op" id="6251504">]</span><span class="op" id="6251505">.</span><span class="ident" id="6251506">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6251513">}</span>&nbsp;<span class="keyword" id="6251515">else</span>&nbsp;<span class="op" id="6251520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6251524"><a href="/compress/bzip2/huffman.go.html#6251166">node</a></span><span class="op" id="6251528">.</span><span class="ident" id="6251529">right</span><span class="op" id="6251534">,</span>&nbsp;<span class="ident" id="6251536"><a href="/compress/bzip2/huffman.go.html#6249548">err</a></span>&nbsp;<span class="op" id="6251540">=</span>&nbsp;<span class="ident" id="6251542"><a href="/compress/bzip2/huffman.go.html#6249461">buildHuffmanNode</a></span><span class="op" id="6251558">(</span><span class="ident" id="6251559"><a href="/compress/bzip2/huffman.go.html#6249478">t</a></span><span class="op" id="6251560">,</span>&nbsp;<span class="ident" id="6251562"><a href="/compress/bzip2/huffman.go.html#6249852">right</a></span><span class="op" id="6251567">,</span>&nbsp;<span class="ident" id="6251569"><a href="/compress/bzip2/huffman.go.html#6249515">level</a></span><span class="op" id="6251574">+</span><span class="num" id="6251575">1</span><span class="op" id="6251576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6251579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6251583">return</span><br>
<span class="lineno"></span><span class="op" id="6251590">}</span>
</div>
</body>
</html>
