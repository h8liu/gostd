<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html" class="current">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1625701">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1625756">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1625810">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1625861">package</span>&nbsp;<span class="ident" id="1625869">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1625878">import</span>&nbsp;<span class="op" id="1625885">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1625888">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1625897">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1625900">type</span>&nbsp;<span class="ident" id="1625905">sliceStruct</span>&nbsp;<span class="keyword" id="1625917">struct</span>&nbsp;<span class="op" id="1625924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625927">array</span>&nbsp;<span class="ident" id="1625933">unsafe</span><span class="op" id="1625939">.</span><span class="ident" id="1625940">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1625949">len</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1625955">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1625960">cap</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1625966">int</span><br>
<span class="lineno">15</span><span class="op" id="1625970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1625973">//&nbsp;TODO:&nbsp;take&nbsp;uintptrs&nbsp;instead&nbsp;of&nbsp;int64s?</span><br>
<span class="lineno"></span><span class="keyword" id="1626015">func</span>&nbsp;<span class="ident" id="1626020">makeslice</span><span class="op" id="1626029">(</span><span class="ident" id="1626030">t</span>&nbsp;<span class="op" id="1626032">*</span><span class="ident" id="1626033">slicetype</span><span class="op" id="1626042">,</span>&nbsp;<span class="ident" id="1626044">len64</span>&nbsp;<span class="builtintype" id="1626050">int64</span><span class="op" id="1626055">,</span>&nbsp;<span class="ident" id="1626057">cap64</span>&nbsp;<span class="builtintype" id="1626063">int64</span><span class="op" id="1626068">)</span>&nbsp;<span class="ident" id="1626070">sliceStruct</span>&nbsp;<span class="op" id="1626082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1626085">//&nbsp;NOTE:&nbsp;The&nbsp;len&nbsp;&gt;&nbsp;MaxMem/elemsize&nbsp;check&nbsp;here&nbsp;is&nbsp;not&nbsp;strictly&nbsp;necessary,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1626159">//&nbsp;but&nbsp;it&nbsp;produces&nbsp;a&nbsp;&#39;len&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error&nbsp;instead&nbsp;of&nbsp;a&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1626244">//&nbsp;when&nbsp;someone&nbsp;does&nbsp;make([]T,&nbsp;bignumber).&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;is&nbsp;true&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1626320">//&nbsp;but&nbsp;since&nbsp;the&nbsp;cap&nbsp;is&nbsp;only&nbsp;being&nbsp;supplied&nbsp;implicitly,&nbsp;saying&nbsp;len&nbsp;is&nbsp;clearer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1626400">//&nbsp;See&nbsp;issue&nbsp;4085.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1626420">len</span>&nbsp;<span class="op" id="1626424">:=</span>&nbsp;<span class="builtintype" id="1626427">int</span><span class="op" id="1626430">(</span><span class="ident" id="1626431">len64</span><span class="op" id="1626436">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1626439">if</span>&nbsp;<span class="ident" id="1626442">len64</span>&nbsp;<span class="op" id="1626448">&lt;</span>&nbsp;<span class="num" id="1626450">0</span>&nbsp;<span class="op" id="1626452">||</span>&nbsp;<span class="builtintype" id="1626455">int64</span><span class="op" id="1626460">(</span><span class="builtinfunc" id="1626461">len</span><span class="op" id="1626464">)</span>&nbsp;<span class="op" id="1626466">!=</span>&nbsp;<span class="ident" id="1626469">len64</span>&nbsp;<span class="op" id="1626475">||</span>&nbsp;<span class="ident" id="1626478">t</span><span class="op" id="1626479">.</span><span class="ident" id="1626480">elem</span><span class="op" id="1626484">.</span><span class="ident" id="1626485">size</span>&nbsp;<span class="op" id="1626490">&gt;</span>&nbsp;<span class="num" id="1626492">0</span>&nbsp;<span class="op" id="1626494">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1626497">uintptr</span><span class="op" id="1626504">(</span><span class="builtinfunc" id="1626505">len</span><span class="op" id="1626508">)</span>&nbsp;<span class="op" id="1626510">&gt;</span>&nbsp;<span class="ident" id="1626512">maxmem</span><span class="op" id="1626518">/</span><span class="builtintype" id="1626519">uintptr</span><span class="op" id="1626526">(</span><span class="ident" id="1626527">t</span><span class="op" id="1626528">.</span><span class="ident" id="1626529">elem</span><span class="op" id="1626533">.</span><span class="ident" id="1626534">size</span><span class="op" id="1626538">)</span>&nbsp;<span class="op" id="1626540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1626544">panic</span><span class="op" id="1626549">(</span><span class="ident" id="1626550">errorString</span><span class="op" id="1626561">(</span><span class="string" id="1626562">&#34;makeslice:&nbsp;len&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1626591">)</span><span class="op" id="1626592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1626595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1626598">cap</span>&nbsp;<span class="op" id="1626602">:=</span>&nbsp;<span class="builtintype" id="1626605">int</span><span class="op" id="1626608">(</span><span class="ident" id="1626609">cap64</span><span class="op" id="1626614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1626617">if</span>&nbsp;<span class="builtinfunc" id="1626620">cap</span>&nbsp;<span class="op" id="1626624">&lt;</span>&nbsp;<span class="builtinfunc" id="1626626">len</span>&nbsp;<span class="op" id="1626630">||</span>&nbsp;<span class="builtintype" id="1626633">int64</span><span class="op" id="1626638">(</span><span class="builtinfunc" id="1626639">cap</span><span class="op" id="1626642">)</span>&nbsp;<span class="op" id="1626644">!=</span>&nbsp;<span class="ident" id="1626647">cap64</span>&nbsp;<span class="op" id="1626653">||</span>&nbsp;<span class="ident" id="1626656">t</span><span class="op" id="1626657">.</span><span class="ident" id="1626658">elem</span><span class="op" id="1626662">.</span><span class="ident" id="1626663">size</span>&nbsp;<span class="op" id="1626668">&gt;</span>&nbsp;<span class="num" id="1626670">0</span>&nbsp;<span class="op" id="1626672">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1626675">uintptr</span><span class="op" id="1626682">(</span><span class="builtinfunc" id="1626683">cap</span><span class="op" id="1626686">)</span>&nbsp;<span class="op" id="1626688">&gt;</span>&nbsp;<span class="ident" id="1626690">maxmem</span><span class="op" id="1626696">/</span><span class="builtintype" id="1626697">uintptr</span><span class="op" id="1626704">(</span><span class="ident" id="1626705">t</span><span class="op" id="1626706">.</span><span class="ident" id="1626707">elem</span><span class="op" id="1626711">.</span><span class="ident" id="1626712">size</span><span class="op" id="1626716">)</span>&nbsp;<span class="op" id="1626718">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1626722">panic</span><span class="op" id="1626727">(</span><span class="ident" id="1626728">errorString</span><span class="op" id="1626739">(</span><span class="string" id="1626740">&#34;makeslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1626769">)</span><span class="op" id="1626770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1626773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626776">p</span>&nbsp;<span class="op" id="1626778">:=</span>&nbsp;<span class="ident" id="1626781">newarray</span><span class="op" id="1626789">(</span><span class="ident" id="1626790">t</span><span class="op" id="1626791">.</span><span class="ident" id="1626792">elem</span><span class="op" id="1626796">,</span>&nbsp;<span class="builtintype" id="1626798">uintptr</span><span class="op" id="1626805">(</span><span class="builtinfunc" id="1626806">cap</span><span class="op" id="1626809">)</span><span class="op" id="1626810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1626813">return</span>&nbsp;<span class="ident" id="1626820">sliceStruct</span><span class="op" id="1626831">{</span><span class="ident" id="1626832">p</span><span class="op" id="1626833">,</span>&nbsp;<span class="builtinfunc" id="1626835">len</span><span class="op" id="1626838">,</span>&nbsp;<span class="builtinfunc" id="1626840">cap</span><span class="op" id="1626843">}</span><br>
<span class="lineno"></span><span class="op" id="1626845">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1626848">//&nbsp;TODO:&nbsp;take&nbsp;uintptr&nbsp;instead&nbsp;of&nbsp;int64?</span><br>
<span class="lineno"></span><span class="keyword" id="1626888">func</span>&nbsp;<span class="ident" id="1626893">growslice</span><span class="op" id="1626902">(</span><span class="ident" id="1626903">t</span>&nbsp;<span class="op" id="1626905">*</span><span class="ident" id="1626906">slicetype</span><span class="op" id="1626915">,</span>&nbsp;<span class="ident" id="1626917">old</span>&nbsp;<span class="ident" id="1626921">sliceStruct</span><span class="op" id="1626932">,</span>&nbsp;<span class="ident" id="1626934">n</span>&nbsp;<span class="builtintype" id="1626936">int64</span><span class="op" id="1626941">)</span>&nbsp;<span class="ident" id="1626943">sliceStruct</span>&nbsp;<span class="op" id="1626955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1626958">if</span>&nbsp;<span class="ident" id="1626961">n</span>&nbsp;<span class="op" id="1626963">&lt;</span>&nbsp;<span class="num" id="1626965">1</span>&nbsp;<span class="op" id="1626967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1626971">panic</span><span class="op" id="1626976">(</span><span class="ident" id="1626977">errorString</span><span class="op" id="1626988">(</span><span class="string" id="1626989">&#34;growslice:&nbsp;invalid&nbsp;n&#34;</span><span class="op" id="1627011">)</span><span class="op" id="1627012">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627019">cap64</span>&nbsp;<span class="op" id="1627025">:=</span>&nbsp;<span class="builtintype" id="1627028">int64</span><span class="op" id="1627033">(</span><span class="ident" id="1627034">old</span><span class="op" id="1627037">.</span><span class="builtinfunc" id="1627038">cap</span><span class="op" id="1627041">)</span>&nbsp;<span class="op" id="1627043">+</span>&nbsp;<span class="ident" id="1627045">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1627048">cap</span>&nbsp;<span class="op" id="1627052">:=</span>&nbsp;<span class="builtintype" id="1627055">int</span><span class="op" id="1627058">(</span><span class="ident" id="1627059">cap64</span><span class="op" id="1627064">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627068">if</span>&nbsp;<span class="builtintype" id="1627071">int64</span><span class="op" id="1627076">(</span><span class="builtinfunc" id="1627077">cap</span><span class="op" id="1627080">)</span>&nbsp;<span class="op" id="1627082">!=</span>&nbsp;<span class="ident" id="1627085">cap64</span>&nbsp;<span class="op" id="1627091">||</span>&nbsp;<span class="builtinfunc" id="1627094">cap</span>&nbsp;<span class="op" id="1627098">&lt;</span>&nbsp;<span class="ident" id="1627100">old</span><span class="op" id="1627103">.</span><span class="builtinfunc" id="1627104">cap</span>&nbsp;<span class="op" id="1627108">||</span>&nbsp;<span class="ident" id="1627111">t</span><span class="op" id="1627112">.</span><span class="ident" id="1627113">elem</span><span class="op" id="1627117">.</span><span class="ident" id="1627118">size</span>&nbsp;<span class="op" id="1627123">&gt;</span>&nbsp;<span class="num" id="1627125">0</span>&nbsp;<span class="op" id="1627127">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1627130">uintptr</span><span class="op" id="1627137">(</span><span class="builtinfunc" id="1627138">cap</span><span class="op" id="1627141">)</span>&nbsp;<span class="op" id="1627143">&gt;</span>&nbsp;<span class="ident" id="1627145">maxmem</span><span class="op" id="1627151">/</span><span class="builtintype" id="1627152">uintptr</span><span class="op" id="1627159">(</span><span class="ident" id="1627160">t</span><span class="op" id="1627161">.</span><span class="ident" id="1627162">elem</span><span class="op" id="1627166">.</span><span class="ident" id="1627167">size</span><span class="op" id="1627171">)</span>&nbsp;<span class="op" id="1627173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1627177">panic</span><span class="op" id="1627182">(</span><span class="ident" id="1627183">errorString</span><span class="op" id="1627194">(</span><span class="string" id="1627195">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1627224">)</span><span class="op" id="1627225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627232">if</span>&nbsp;<span class="ident" id="1627235">raceenabled</span>&nbsp;<span class="op" id="1627247">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627251">callerpc</span>&nbsp;<span class="op" id="1627260">:=</span>&nbsp;<span class="ident" id="1627263">getcallerpc</span><span class="op" id="1627274">(</span><span class="ident" id="1627275">unsafe</span><span class="op" id="1627281">.</span><span class="ident" id="1627282">Pointer</span><span class="op" id="1627289">(</span><span class="op" id="1627290">&amp;</span><span class="ident" id="1627291">t</span><span class="op" id="1627292">)</span><span class="op" id="1627293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627297">racereadrangepc</span><span class="op" id="1627312">(</span><span class="ident" id="1627313">old</span><span class="op" id="1627316">.</span><span class="ident" id="1627317">array</span><span class="op" id="1627322">,</span>&nbsp;<span class="builtintype" id="1627324">uintptr</span><span class="op" id="1627331">(</span><span class="ident" id="1627332">old</span><span class="op" id="1627335">.</span><span class="builtinfunc" id="1627336">len</span><span class="op" id="1627339">*</span><span class="builtintype" id="1627340">int</span><span class="op" id="1627343">(</span><span class="ident" id="1627344">t</span><span class="op" id="1627345">.</span><span class="ident" id="1627346">elem</span><span class="op" id="1627350">.</span><span class="ident" id="1627351">size</span><span class="op" id="1627355">)</span><span class="op" id="1627356">)</span><span class="op" id="1627357">,</span>&nbsp;<span class="ident" id="1627359">callerpc</span><span class="op" id="1627367">,</span>&nbsp;<span class="ident" id="1627369">funcPC</span><span class="op" id="1627375">(</span><span class="ident" id="1627376">growslice</span><span class="op" id="1627385">)</span><span class="op" id="1627386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627393">et</span>&nbsp;<span class="op" id="1627396">:=</span>&nbsp;<span class="ident" id="1627399">t</span><span class="op" id="1627400">.</span><span class="ident" id="1627401">elem</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627407">if</span>&nbsp;<span class="ident" id="1627410">et</span><span class="op" id="1627412">.</span><span class="ident" id="1627413">size</span>&nbsp;<span class="op" id="1627418">==</span>&nbsp;<span class="num" id="1627421">0</span>&nbsp;<span class="op" id="1627423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627427">return</span>&nbsp;<span class="ident" id="1627434">sliceStruct</span><span class="op" id="1627445">{</span><span class="ident" id="1627446">old</span><span class="op" id="1627449">.</span><span class="ident" id="1627450">array</span><span class="op" id="1627455">,</span>&nbsp;<span class="ident" id="1627457">old</span><span class="op" id="1627460">.</span><span class="builtinfunc" id="1627461">len</span><span class="op" id="1627464">,</span>&nbsp;<span class="builtinfunc" id="1627466">cap</span><span class="op" id="1627469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627476">newcap</span>&nbsp;<span class="op" id="1627483">:=</span>&nbsp;<span class="ident" id="1627486">old</span><span class="op" id="1627489">.</span><span class="builtinfunc" id="1627490">cap</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627495">if</span>&nbsp;<span class="ident" id="1627498">newcap</span><span class="op" id="1627504">+</span><span class="ident" id="1627505">newcap</span>&nbsp;<span class="op" id="1627512">&lt;</span>&nbsp;<span class="builtinfunc" id="1627514">cap</span>&nbsp;<span class="op" id="1627518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627522">newcap</span>&nbsp;<span class="op" id="1627529">=</span>&nbsp;<span class="builtinfunc" id="1627531">cap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627536">}</span>&nbsp;<span class="keyword" id="1627538">else</span>&nbsp;<span class="op" id="1627543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627547">for</span>&nbsp;<span class="op" id="1627551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627556">if</span>&nbsp;<span class="ident" id="1627559">old</span><span class="op" id="1627562">.</span><span class="builtinfunc" id="1627563">len</span>&nbsp;<span class="op" id="1627567">&lt;</span>&nbsp;<span class="num" id="1627569">1024</span>&nbsp;<span class="op" id="1627574">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627580">newcap</span>&nbsp;<span class="op" id="1627587">+=</span>&nbsp;<span class="ident" id="1627590">newcap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627600">}</span>&nbsp;<span class="keyword" id="1627602">else</span>&nbsp;<span class="op" id="1627607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627613">newcap</span>&nbsp;<span class="op" id="1627620">+=</span>&nbsp;<span class="ident" id="1627623">newcap</span>&nbsp;<span class="op" id="1627630">/</span>&nbsp;<span class="num" id="1627632">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627642">if</span>&nbsp;<span class="ident" id="1627645">newcap</span>&nbsp;<span class="op" id="1627652">&gt;=</span>&nbsp;<span class="builtinfunc" id="1627655">cap</span>&nbsp;<span class="op" id="1627659">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627665">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627685">if</span>&nbsp;<span class="builtintype" id="1627688">uintptr</span><span class="op" id="1627695">(</span><span class="ident" id="1627696">newcap</span><span class="op" id="1627702">)</span>&nbsp;<span class="op" id="1627704">&gt;=</span>&nbsp;<span class="ident" id="1627707">maxmem</span><span class="op" id="1627713">/</span><span class="builtintype" id="1627714">uintptr</span><span class="op" id="1627721">(</span><span class="ident" id="1627722">et</span><span class="op" id="1627724">.</span><span class="ident" id="1627725">size</span><span class="op" id="1627729">)</span>&nbsp;<span class="op" id="1627731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1627735">panic</span><span class="op" id="1627740">(</span><span class="ident" id="1627741">errorString</span><span class="op" id="1627752">(</span><span class="string" id="1627753">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1627782">)</span><span class="op" id="1627783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627789">lenmem</span>&nbsp;<span class="op" id="1627796">:=</span>&nbsp;<span class="builtintype" id="1627799">uintptr</span><span class="op" id="1627806">(</span><span class="ident" id="1627807">old</span><span class="op" id="1627810">.</span><span class="builtinfunc" id="1627811">len</span><span class="op" id="1627814">)</span>&nbsp;<span class="op" id="1627816">*</span>&nbsp;<span class="builtintype" id="1627818">uintptr</span><span class="op" id="1627825">(</span><span class="ident" id="1627826">et</span><span class="op" id="1627828">.</span><span class="ident" id="1627829">size</span><span class="op" id="1627833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627836">capmem</span>&nbsp;<span class="op" id="1627843">:=</span>&nbsp;<span class="ident" id="1627846">goroundupsize</span><span class="op" id="1627859">(</span><span class="builtintype" id="1627860">uintptr</span><span class="op" id="1627867">(</span><span class="ident" id="1627868">newcap</span><span class="op" id="1627874">)</span>&nbsp;<span class="op" id="1627876">*</span>&nbsp;<span class="builtintype" id="1627878">uintptr</span><span class="op" id="1627885">(</span><span class="ident" id="1627886">et</span><span class="op" id="1627888">.</span><span class="ident" id="1627889">size</span><span class="op" id="1627893">)</span><span class="op" id="1627894">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627897">newcap</span>&nbsp;<span class="op" id="1627904">=</span>&nbsp;<span class="builtintype" id="1627906">int</span><span class="op" id="1627909">(</span><span class="ident" id="1627910">capmem</span>&nbsp;<span class="op" id="1627917">/</span>&nbsp;<span class="builtintype" id="1627919">uintptr</span><span class="op" id="1627926">(</span><span class="ident" id="1627927">et</span><span class="op" id="1627929">.</span><span class="ident" id="1627930">size</span><span class="op" id="1627934">)</span><span class="op" id="1627935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627938">var</span>&nbsp;<span class="ident" id="1627942">p</span>&nbsp;<span class="ident" id="1627944">unsafe</span><span class="op" id="1627950">.</span><span class="ident" id="1627951">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627960">if</span>&nbsp;<span class="ident" id="1627963">et</span><span class="op" id="1627965">.</span><span class="ident" id="1627966">kind</span><span class="op" id="1627970">&amp;</span><span class="ident" id="1627971">kindNoPointers</span>&nbsp;<span class="op" id="1627986">!=</span>&nbsp;<span class="num" id="1627989">0</span>&nbsp;<span class="op" id="1627991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627995">p</span>&nbsp;<span class="op" id="1627997">=</span>&nbsp;<span class="ident" id="1627999">rawmem</span><span class="op" id="1628005">(</span><span class="ident" id="1628006">capmem</span><span class="op" id="1628012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628016">memclr</span><span class="op" id="1628022">(</span><span class="ident" id="1628023">add</span><span class="op" id="1628026">(</span><span class="ident" id="1628027">p</span><span class="op" id="1628028">,</span>&nbsp;<span class="ident" id="1628030">lenmem</span><span class="op" id="1628036">)</span><span class="op" id="1628037">,</span>&nbsp;<span class="ident" id="1628039">capmem</span><span class="op" id="1628045">-</span><span class="ident" id="1628046">lenmem</span><span class="op" id="1628052">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1628055">}</span>&nbsp;<span class="keyword" id="1628057">else</span>&nbsp;<span class="op" id="1628062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1628066">//&nbsp;Note:&nbsp;can&#39;t&nbsp;use&nbsp;rawmem&nbsp;(which&nbsp;avoids&nbsp;zeroing&nbsp;of&nbsp;memory),&nbsp;because&nbsp;then&nbsp;GC&nbsp;can&nbsp;scan&nbsp;unitialized&nbsp;memory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628172">p</span>&nbsp;<span class="op" id="1628174">=</span>&nbsp;<span class="ident" id="1628176">newarray</span><span class="op" id="1628184">(</span><span class="ident" id="1628185">et</span><span class="op" id="1628187">,</span>&nbsp;<span class="builtintype" id="1628189">uintptr</span><span class="op" id="1628196">(</span><span class="ident" id="1628197">newcap</span><span class="op" id="1628203">)</span><span class="op" id="1628204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1628207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628210">memmove</span><span class="op" id="1628217">(</span><span class="ident" id="1628218">p</span><span class="op" id="1628219">,</span>&nbsp;<span class="ident" id="1628221">old</span><span class="op" id="1628224">.</span><span class="ident" id="1628225">array</span><span class="op" id="1628230">,</span>&nbsp;<span class="ident" id="1628232">lenmem</span><span class="op" id="1628238">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1628242">return</span>&nbsp;<span class="ident" id="1628249">sliceStruct</span><span class="op" id="1628260">{</span><span class="ident" id="1628261">p</span><span class="op" id="1628262">,</span>&nbsp;<span class="ident" id="1628264">old</span><span class="op" id="1628267">.</span><span class="builtinfunc" id="1628268">len</span><span class="op" id="1628271">,</span>&nbsp;<span class="ident" id="1628273">newcap</span><span class="op" id="1628279">}</span><br>
<span class="lineno"></span><span class="op" id="1628281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1628284">func</span>&nbsp;<span class="ident" id="1628289">slicecopy</span><span class="op" id="1628298">(</span><span class="ident" id="1628299">to</span>&nbsp;<span class="ident" id="1628302">sliceStruct</span><span class="op" id="1628313">,</span>&nbsp;<span class="ident" id="1628315">fm</span>&nbsp;<span class="ident" id="1628318">sliceStruct</span><span class="op" id="1628329">,</span>&nbsp;<span class="ident" id="1628331">width</span>&nbsp;<span class="builtintype" id="1628337">uintptr</span><span class="op" id="1628344">)</span>&nbsp;<span class="builtintype" id="1628346">int</span>&nbsp;<span class="op" id="1628350">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1628353">if</span>&nbsp;<span class="ident" id="1628356">fm</span><span class="op" id="1628358">.</span><span class="builtinfunc" id="1628359">len</span>&nbsp;<span class="op" id="1628363">==</span>&nbsp;<span class="num" id="1628366">0</span>&nbsp;<span class="op" id="1628368">||</span>&nbsp;<span class="ident" id="1628371">to</span><span class="op" id="1628373">.</span><span class="builtinfunc" id="1628374">len</span>&nbsp;<span class="op" id="1628378">==</span>&nbsp;<span class="num" id="1628381">0</span>&nbsp;<span class="op" id="1628383">||</span>&nbsp;<span class="ident" id="1628386">width</span>&nbsp;<span class="op" id="1628392">==</span>&nbsp;<span class="num" id="1628395">0</span>&nbsp;<span class="op" id="1628397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1628401">return</span>&nbsp;<span class="num" id="1628408">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1628411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628415">n</span>&nbsp;<span class="op" id="1628417">:=</span>&nbsp;<span class="ident" id="1628420">fm</span><span class="op" id="1628422">.</span><span class="builtinfunc" id="1628423">len</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1628428">if</span>&nbsp;<span class="ident" id="1628431">to</span><span class="op" id="1628433">.</span><span class="builtinfunc" id="1628434">len</span>&nbsp;<span class="op" id="1628438">&lt;</span>&nbsp;<span class="ident" id="1628440">n</span>&nbsp;<span class="op" id="1628442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628446">n</span>&nbsp;<span class="op" id="1628448">=</span>&nbsp;<span class="ident" id="1628450">to</span><span class="op" id="1628452">.</span><span class="builtinfunc" id="1628453">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1628458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1628462">if</span>&nbsp;<span class="ident" id="1628465">raceenabled</span>&nbsp;<span class="op" id="1628477">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628481">callerpc</span>&nbsp;<span class="op" id="1628490">:=</span>&nbsp;<span class="ident" id="1628493">getcallerpc</span><span class="op" id="1628504">(</span><span class="ident" id="1628505">unsafe</span><span class="op" id="1628511">.</span><span class="ident" id="1628512">Pointer</span><span class="op" id="1628519">(</span><span class="op" id="1628520">&amp;</span><span class="ident" id="1628521">to</span><span class="op" id="1628523">)</span><span class="op" id="1628524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628528">pc</span>&nbsp;<span class="op" id="1628531">:=</span>&nbsp;<span class="ident" id="1628534">funcPC</span><span class="op" id="1628540">(</span><span class="ident" id="1628541">slicecopy</span><span class="op" id="1628550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628554">racewriterangepc</span><span class="op" id="1628570">(</span><span class="ident" id="1628571">to</span><span class="op" id="1628573">.</span><span class="ident" id="1628574">array</span><span class="op" id="1628579">,</span>&nbsp;<span class="builtintype" id="1628581">uintptr</span><span class="op" id="1628588">(</span><span class="ident" id="1628589">n</span><span class="op" id="1628590">*</span><span class="builtintype" id="1628591">int</span><span class="op" id="1628594">(</span><span class="ident" id="1628595">width</span><span class="op" id="1628600">)</span><span class="op" id="1628601">)</span><span class="op" id="1628602">,</span>&nbsp;<span class="ident" id="1628604">callerpc</span><span class="op" id="1628612">,</span>&nbsp;<span class="ident" id="1628614">pc</span><span class="op" id="1628616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628620">racereadrangepc</span><span class="op" id="1628635">(</span><span class="ident" id="1628636">fm</span><span class="op" id="1628638">.</span><span class="ident" id="1628639">array</span><span class="op" id="1628644">,</span>&nbsp;<span class="builtintype" id="1628646">uintptr</span><span class="op" id="1628653">(</span><span class="ident" id="1628654">n</span><span class="op" id="1628655">*</span><span class="builtintype" id="1628656">int</span><span class="op" id="1628659">(</span><span class="ident" id="1628660">width</span><span class="op" id="1628665">)</span><span class="op" id="1628666">)</span><span class="op" id="1628667">,</span>&nbsp;<span class="ident" id="1628669">callerpc</span><span class="op" id="1628677">,</span>&nbsp;<span class="ident" id="1628679">pc</span><span class="op" id="1628681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1628684">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628688">size</span>&nbsp;<span class="op" id="1628693">:=</span>&nbsp;<span class="builtintype" id="1628696">uintptr</span><span class="op" id="1628703">(</span><span class="ident" id="1628704">n</span><span class="op" id="1628705">)</span>&nbsp;<span class="op" id="1628707">*</span>&nbsp;<span class="ident" id="1628709">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1628716">if</span>&nbsp;<span class="ident" id="1628719">size</span>&nbsp;<span class="op" id="1628724">==</span>&nbsp;<span class="num" id="1628727">1</span>&nbsp;<span class="op" id="1628729">{</span>&nbsp;<span class="comment" id="1628731">//&nbsp;common&nbsp;case&nbsp;worth&nbsp;about&nbsp;2x&nbsp;to&nbsp;do&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1628774">//&nbsp;TODO:&nbsp;is&nbsp;this&nbsp;still&nbsp;worth&nbsp;it&nbsp;with&nbsp;new&nbsp;memmove&nbsp;impl?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1628831">*</span><span class="op" id="1628832">(</span><span class="op" id="1628833">*</span><span class="builtintype" id="1628834">byte</span><span class="op" id="1628838">)</span><span class="op" id="1628839">(</span><span class="ident" id="1628840">to</span><span class="op" id="1628842">.</span><span class="ident" id="1628843">array</span><span class="op" id="1628848">)</span>&nbsp;<span class="op" id="1628850">=</span>&nbsp;<span class="op" id="1628852">*</span><span class="op" id="1628853">(</span><span class="op" id="1628854">*</span><span class="builtintype" id="1628855">byte</span><span class="op" id="1628859">)</span><span class="op" id="1628860">(</span><span class="ident" id="1628861">fm</span><span class="op" id="1628863">.</span><span class="ident" id="1628864">array</span><span class="op" id="1628869">)</span>&nbsp;<span class="comment" id="1628871">//&nbsp;known&nbsp;to&nbsp;be&nbsp;a&nbsp;byte&nbsp;pointer</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1628902">}</span>&nbsp;<span class="keyword" id="1628904">else</span>&nbsp;<span class="op" id="1628909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628913">memmove</span><span class="op" id="1628920">(</span><span class="ident" id="1628921">to</span><span class="op" id="1628923">.</span><span class="ident" id="1628924">array</span><span class="op" id="1628929">,</span>&nbsp;<span class="ident" id="1628931">fm</span><span class="op" id="1628933">.</span><span class="ident" id="1628934">array</span><span class="op" id="1628939">,</span>&nbsp;<span class="ident" id="1628941">size</span><span class="op" id="1628945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1628948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1628951">return</span>&nbsp;<span class="builtintype" id="1628958">int</span><span class="op" id="1628961">(</span><span class="ident" id="1628962">n</span><span class="op" id="1628963">)</span><br>
<span class="lineno"></span><span class="op" id="1628965">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="1628968">func</span>&nbsp;<span class="ident" id="1628973">slicestringcopy</span><span class="op" id="1628988">(</span><span class="ident" id="1628989">to</span>&nbsp;<span class="op" id="1628992">[</span><span class="op" id="1628993">]</span><span class="builtintype" id="1628994">byte</span><span class="op" id="1628998">,</span>&nbsp;<span class="ident" id="1629000">fm</span>&nbsp;<span class="builtintype" id="1629003">string</span><span class="op" id="1629009">)</span>&nbsp;<span class="builtintype" id="1629011">int</span>&nbsp;<span class="op" id="1629015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1629018">if</span>&nbsp;<span class="builtinfunc" id="1629021">len</span><span class="op" id="1629024">(</span><span class="ident" id="1629025">fm</span><span class="op" id="1629027">)</span>&nbsp;<span class="op" id="1629029">==</span>&nbsp;<span class="num" id="1629032">0</span>&nbsp;<span class="op" id="1629034">||</span>&nbsp;<span class="builtinfunc" id="1629037">len</span><span class="op" id="1629040">(</span><span class="ident" id="1629041">to</span><span class="op" id="1629043">)</span>&nbsp;<span class="op" id="1629045">==</span>&nbsp;<span class="num" id="1629048">0</span>&nbsp;<span class="op" id="1629050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1629054">return</span>&nbsp;<span class="num" id="1629061">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1629064">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629068">n</span>&nbsp;<span class="op" id="1629070">:=</span>&nbsp;<span class="builtinfunc" id="1629073">len</span><span class="op" id="1629076">(</span><span class="ident" id="1629077">fm</span><span class="op" id="1629079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1629082">if</span>&nbsp;<span class="builtinfunc" id="1629085">len</span><span class="op" id="1629088">(</span><span class="ident" id="1629089">to</span><span class="op" id="1629091">)</span>&nbsp;<span class="op" id="1629093">&lt;</span>&nbsp;<span class="ident" id="1629095">n</span>&nbsp;<span class="op" id="1629097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629101">n</span>&nbsp;<span class="op" id="1629103">=</span>&nbsp;<span class="builtinfunc" id="1629105">len</span><span class="op" id="1629108">(</span><span class="ident" id="1629109">to</span><span class="op" id="1629111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1629114">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1629118">if</span>&nbsp;<span class="ident" id="1629121">raceenabled</span>&nbsp;<span class="op" id="1629133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629137">callerpc</span>&nbsp;<span class="op" id="1629146">:=</span>&nbsp;<span class="ident" id="1629149">getcallerpc</span><span class="op" id="1629160">(</span><span class="ident" id="1629161">unsafe</span><span class="op" id="1629167">.</span><span class="ident" id="1629168">Pointer</span><span class="op" id="1629175">(</span><span class="op" id="1629176">&amp;</span><span class="ident" id="1629177">to</span><span class="op" id="1629179">)</span><span class="op" id="1629180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629184">pc</span>&nbsp;<span class="op" id="1629187">:=</span>&nbsp;<span class="ident" id="1629190">funcPC</span><span class="op" id="1629196">(</span><span class="ident" id="1629197">slicestringcopy</span><span class="op" id="1629212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629216">racewriterangepc</span><span class="op" id="1629232">(</span><span class="ident" id="1629233">unsafe</span><span class="op" id="1629239">.</span><span class="ident" id="1629240">Pointer</span><span class="op" id="1629247">(</span><span class="op" id="1629248">&amp;</span><span class="ident" id="1629249">to</span><span class="op" id="1629251">[</span><span class="num" id="1629252">0</span><span class="op" id="1629253">]</span><span class="op" id="1629254">)</span><span class="op" id="1629255">,</span>&nbsp;<span class="builtintype" id="1629257">uintptr</span><span class="op" id="1629264">(</span><span class="ident" id="1629265">n</span><span class="op" id="1629266">)</span><span class="op" id="1629267">,</span>&nbsp;<span class="ident" id="1629269">callerpc</span><span class="op" id="1629277">,</span>&nbsp;<span class="ident" id="1629279">pc</span><span class="op" id="1629281">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1629284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629288">memmove</span><span class="op" id="1629295">(</span><span class="ident" id="1629296">unsafe</span><span class="op" id="1629302">.</span><span class="ident" id="1629303">Pointer</span><span class="op" id="1629310">(</span><span class="op" id="1629311">&amp;</span><span class="ident" id="1629312">to</span><span class="op" id="1629314">[</span><span class="num" id="1629315">0</span><span class="op" id="1629316">]</span><span class="op" id="1629317">)</span><span class="op" id="1629318">,</span>&nbsp;<span class="ident" id="1629320">unsafe</span><span class="op" id="1629326">.</span><span class="ident" id="1629327">Pointer</span><span class="op" id="1629334">(</span><span class="op" id="1629335">(</span><span class="op" id="1629336">*</span><span class="ident" id="1629337">stringStruct</span><span class="op" id="1629349">)</span><span class="op" id="1629350">(</span><span class="ident" id="1629351">unsafe</span><span class="op" id="1629357">.</span><span class="ident" id="1629358">Pointer</span><span class="op" id="1629365">(</span><span class="op" id="1629366">&amp;</span><span class="ident" id="1629367">fm</span><span class="op" id="1629369">)</span><span class="op" id="1629370">)</span><span class="op" id="1629371">.</span><span class="ident" id="1629372">str</span><span class="op" id="1629375">)</span><span class="op" id="1629376">,</span>&nbsp;<span class="builtintype" id="1629378">uintptr</span><span class="op" id="1629385">(</span><span class="ident" id="1629386">n</span><span class="op" id="1629387">)</span><span class="op" id="1629388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1629391">return</span>&nbsp;<span class="ident" id="1629398">n</span><br>
<span class="lineno"></span><span class="op" id="1629400">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
