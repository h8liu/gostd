<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/tabwriter</h2>
<ul>
<li><a href="/gostd/text/tabwriter/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter.go.html">tabwriter.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter_test.go.html">tabwriter_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4179610">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4179665">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4179719">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4179770">//&nbsp;Package&nbsp;tabwriter&nbsp;implements&nbsp;a&nbsp;write&nbsp;filter&nbsp;(tabwriter.Writer)&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4179841">//&nbsp;translates&nbsp;tabbed&nbsp;columns&nbsp;in&nbsp;input&nbsp;into&nbsp;properly&nbsp;aligned&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="4179907">//</span><br>
<span class="lineno"></span><span class="comment" id="4179910">//&nbsp;The&nbsp;package&nbsp;is&nbsp;using&nbsp;the&nbsp;Elastic&nbsp;Tabstops&nbsp;algorithm&nbsp;described&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="4179978">//&nbsp;http://nickgravgaard.com/elastictabstops/index.html.</span><br>
<span class="lineno">10</span><span class="comment" id="4180034">//</span><br>
<span class="lineno"></span><span class="keyword" id="4180037">package</span>&nbsp;<span class="ident" id="4180045">tabwriter</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4180056">import</span>&nbsp;<span class="op" id="4180063">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4180066">&#34;bytes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4180075">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4180081">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4180096">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4180099">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">20</span><span class="comment" id="4180179">//&nbsp;Filter&nbsp;implementation</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4180205">//&nbsp;A&nbsp;cell&nbsp;represents&nbsp;a&nbsp;segment&nbsp;of&nbsp;text&nbsp;terminated&nbsp;by&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks.</span><br>
<span class="lineno"></span><span class="comment" id="4180279">//&nbsp;The&nbsp;text&nbsp;itself&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;separate&nbsp;buffer;&nbsp;cell&nbsp;only&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4180354">//&nbsp;segment&#39;s&nbsp;size&nbsp;in&nbsp;bytes,&nbsp;its&nbsp;width&nbsp;in&nbsp;runes,&nbsp;and&nbsp;whether&nbsp;it&#39;s&nbsp;an&nbsp;htab</span><br>
<span class="lineno">25</span><span class="comment" id="4180427">//&nbsp;(&#39;\t&#39;)&nbsp;terminated&nbsp;cell.</span><br>
<span class="lineno"></span><span class="comment" id="4180454">//</span><br>
<span class="lineno"></span><span class="keyword" id="4180457">type</span>&nbsp;<span class="ident" id="4180462">cell</span>&nbsp;<span class="keyword" id="4180467">struct</span>&nbsp;<span class="op" id="4180474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4180477">size</span>&nbsp;&nbsp;<span class="builtintype" id="4180483">int</span>&nbsp;&nbsp;<span class="comment" id="4180488">//&nbsp;cell&nbsp;size&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4180511">width</span>&nbsp;<span class="builtintype" id="4180517">int</span>&nbsp;&nbsp;<span class="comment" id="4180522">//&nbsp;cell&nbsp;width&nbsp;in&nbsp;runes</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4180546">htab</span>&nbsp;&nbsp;<span class="builtintype" id="4180552">bool</span>&nbsp;<span class="comment" id="4180557">//&nbsp;true&nbsp;if&nbsp;the&nbsp;cell&nbsp;is&nbsp;terminated&nbsp;by&nbsp;an&nbsp;htab&nbsp;(&#39;\t&#39;)</span><br>
<span class="lineno"></span><span class="op" id="4180609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4180612">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;filter&nbsp;that&nbsp;inserts&nbsp;padding&nbsp;around&nbsp;tab-delimited</span><br>
<span class="lineno"></span><span class="comment" id="4180678">//&nbsp;columns&nbsp;in&nbsp;its&nbsp;input&nbsp;to&nbsp;align&nbsp;them&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno">35</span><span class="comment" id="4180731">//</span><br>
<span class="lineno"></span><span class="comment" id="4180734">//&nbsp;The&nbsp;Writer&nbsp;treats&nbsp;incoming&nbsp;bytes&nbsp;as&nbsp;UTF-8&nbsp;encoded&nbsp;text&nbsp;consisting</span><br>
<span class="lineno"></span><span class="comment" id="4180803">//&nbsp;of&nbsp;cells&nbsp;terminated&nbsp;by&nbsp;(horizontal&nbsp;or&nbsp;vertical)&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4180867">//&nbsp;breaks&nbsp;(newline&nbsp;or&nbsp;formfeed&nbsp;characters).&nbsp;Cells&nbsp;in&nbsp;adjacent&nbsp;lines</span><br>
<span class="lineno"></span><span class="comment" id="4180935">//&nbsp;constitute&nbsp;a&nbsp;column.&nbsp;The&nbsp;Writer&nbsp;inserts&nbsp;padding&nbsp;as&nbsp;needed&nbsp;to</span><br>
<span class="lineno">40</span><span class="comment" id="4180999">//&nbsp;make&nbsp;all&nbsp;cells&nbsp;in&nbsp;a&nbsp;column&nbsp;have&nbsp;the&nbsp;same&nbsp;width,&nbsp;effectively</span><br>
<span class="lineno"></span><span class="comment" id="4181062">//&nbsp;aligning&nbsp;the&nbsp;columns.&nbsp;It&nbsp;assumes&nbsp;that&nbsp;all&nbsp;characters&nbsp;have&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4181127">//&nbsp;same&nbsp;width&nbsp;except&nbsp;for&nbsp;tabs&nbsp;for&nbsp;which&nbsp;a&nbsp;tabwidth&nbsp;must&nbsp;be&nbsp;specified.</span><br>
<span class="lineno"></span><span class="comment" id="4181197">//&nbsp;Note&nbsp;that&nbsp;cells&nbsp;are&nbsp;tab-terminated,&nbsp;not&nbsp;tab-separated:&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="4181264">//&nbsp;non-tab&nbsp;text&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;line&nbsp;does&nbsp;not&nbsp;form&nbsp;a&nbsp;column&nbsp;cell.</span><br>
<span class="lineno">45</span><span class="comment" id="4181330">//</span><br>
<span class="lineno"></span><span class="comment" id="4181333">//&nbsp;The&nbsp;Writer&nbsp;assumes&nbsp;that&nbsp;all&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;have&nbsp;the&nbsp;same&nbsp;width;</span><br>
<span class="lineno"></span><span class="comment" id="4181405">//&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;true&nbsp;in&nbsp;some&nbsp;fonts.</span><br>
<span class="lineno"></span><span class="comment" id="4181444">//</span><br>
<span class="lineno"></span><span class="comment" id="4181447">//&nbsp;If&nbsp;DiscardEmptyColumns&nbsp;is&nbsp;set,&nbsp;empty&nbsp;columns&nbsp;that&nbsp;are&nbsp;terminated</span><br>
<span class="lineno">50</span><span class="comment" id="4181515">//&nbsp;entirely&nbsp;by&nbsp;vertical&nbsp;(or&nbsp;&#34;soft&#34;)&nbsp;tabs&nbsp;are&nbsp;discarded.&nbsp;Columns</span><br>
<span class="lineno"></span><span class="comment" id="4181579">//&nbsp;terminated&nbsp;by&nbsp;horizontal&nbsp;(or&nbsp;&#34;hard&#34;)&nbsp;tabs&nbsp;are&nbsp;not&nbsp;affected&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4181644">//&nbsp;this&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="4181658">//</span><br>
<span class="lineno"></span><span class="comment" id="4181661">//&nbsp;If&nbsp;a&nbsp;Writer&nbsp;is&nbsp;configured&nbsp;to&nbsp;filter&nbsp;HTML,&nbsp;HTML&nbsp;tags&nbsp;and&nbsp;entities</span><br>
<span class="lineno">55</span><span class="comment" id="4181729">//&nbsp;are&nbsp;passed&nbsp;through.&nbsp;The&nbsp;widths&nbsp;of&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4181788">//&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;(tags)&nbsp;and&nbsp;one&nbsp;(entities)&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4181861">//</span><br>
<span class="lineno"></span><span class="comment" id="4181864">//&nbsp;A&nbsp;segment&nbsp;of&nbsp;text&nbsp;may&nbsp;be&nbsp;escaped&nbsp;by&nbsp;bracketing&nbsp;it&nbsp;with&nbsp;Escape</span><br>
<span class="lineno"></span><span class="comment" id="4181929">//&nbsp;characters.&nbsp;The&nbsp;tabwriter&nbsp;passes&nbsp;escaped&nbsp;text&nbsp;segments&nbsp;through</span><br>
<span class="lineno">60</span><span class="comment" id="4181995">//&nbsp;unchanged.&nbsp;In&nbsp;particular,&nbsp;it&nbsp;does&nbsp;not&nbsp;interpret&nbsp;any&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4182063">//&nbsp;breaks&nbsp;within&nbsp;the&nbsp;segment.&nbsp;If&nbsp;the&nbsp;StripEscape&nbsp;flag&nbsp;is&nbsp;set,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4182129">//&nbsp;Escape&nbsp;characters&nbsp;are&nbsp;stripped&nbsp;from&nbsp;the&nbsp;output;&nbsp;otherwise&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="4182195">//&nbsp;are&nbsp;passed&nbsp;through&nbsp;as&nbsp;well.&nbsp;For&nbsp;the&nbsp;purpose&nbsp;of&nbsp;formatting,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4182261">//&nbsp;width&nbsp;of&nbsp;the&nbsp;escaped&nbsp;text&nbsp;is&nbsp;always&nbsp;computed&nbsp;excluding&nbsp;the&nbsp;Escape</span><br>
<span class="lineno">65</span><span class="comment" id="4182330">//&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="4182345">//</span><br>
<span class="lineno"></span><span class="comment" id="4182348">//&nbsp;The&nbsp;formfeed&nbsp;character&nbsp;(&#39;\f&#39;)&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline&nbsp;but&nbsp;it&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="4182413">//&nbsp;terminates&nbsp;all&nbsp;columns&nbsp;in&nbsp;the&nbsp;current&nbsp;line&nbsp;(effectively&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="4182480">//&nbsp;Flush).&nbsp;Cells&nbsp;in&nbsp;the&nbsp;next&nbsp;line&nbsp;start&nbsp;new&nbsp;columns.&nbsp;Unless&nbsp;found</span><br>
<span class="lineno">70</span><span class="comment" id="4182546">//&nbsp;inside&nbsp;an&nbsp;HTML&nbsp;tag&nbsp;or&nbsp;inside&nbsp;an&nbsp;escaped&nbsp;text&nbsp;segment,&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="4182612">//&nbsp;characters&nbsp;appear&nbsp;as&nbsp;newlines&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="4182660">//</span><br>
<span class="lineno"></span><span class="comment" id="4182663">//&nbsp;The&nbsp;Writer&nbsp;must&nbsp;buffer&nbsp;input&nbsp;internally,&nbsp;because&nbsp;proper&nbsp;spacing</span><br>
<span class="lineno"></span><span class="comment" id="4182730">//&nbsp;of&nbsp;one&nbsp;line&nbsp;may&nbsp;depend&nbsp;on&nbsp;the&nbsp;cells&nbsp;in&nbsp;future&nbsp;lines.&nbsp;Clients&nbsp;must</span><br>
<span class="lineno">75</span><span class="comment" id="4182799">//&nbsp;call&nbsp;Flush&nbsp;when&nbsp;done&nbsp;calling&nbsp;Write.</span><br>
<span class="lineno"></span><span class="comment" id="4182838">//</span><br>
<span class="lineno"></span><span class="keyword" id="4182841">type</span>&nbsp;<span class="ident" id="4182846">Writer</span>&nbsp;<span class="keyword" id="4182853">struct</span>&nbsp;<span class="op" id="4182860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182863">//&nbsp;configuration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182881">output</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4182890">io</span><span class="op" id="4182892">.</span><span class="ident" id="4182893">Writer</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182901">minwidth</span>&nbsp;<span class="builtintype" id="4182910">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182915">tabwidth</span>&nbsp;<span class="builtintype" id="4182924">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182929">padding</span>&nbsp;&nbsp;<span class="builtintype" id="4182938">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182943">padbytes</span>&nbsp;<span class="op" id="4182952">[</span><span class="num" id="4182953">8</span><span class="op" id="4182954">]</span><span class="builtintype" id="4182955">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182961">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4182970">uint</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4182977">//&nbsp;current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4182995">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4183003">bytes</span><span class="op" id="4183008">.</span><span class="ident" id="4183009">Buffer</span>&nbsp;<span class="comment" id="4183016">//&nbsp;collected&nbsp;text&nbsp;excluding&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183065">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4183073">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183086">//&nbsp;buffer&nbsp;position&nbsp;up&nbsp;to&nbsp;which&nbsp;cell.width&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;has&nbsp;been&nbsp;computed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183166">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4183174">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183187">//&nbsp;current&nbsp;incomplete&nbsp;cell;&nbsp;cell.width&nbsp;is&nbsp;up&nbsp;to&nbsp;buf[pos]&nbsp;excluding&nbsp;ignored&nbsp;sections</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183272">endChar</span>&nbsp;<span class="builtintype" id="4183280">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183293">//&nbsp;terminating&nbsp;char&nbsp;of&nbsp;escaped&nbsp;sequence&nbsp;(Escape&nbsp;for&nbsp;escapes,&nbsp;&#39;&gt;&#39;,&nbsp;&#39;;&#39;&nbsp;for&nbsp;HTML&nbsp;tags/entities,&nbsp;or&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183394">lines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4183402">[</span><span class="op" id="4183403">]</span><span class="op" id="4183404">[</span><span class="op" id="4183405">]</span><span class="ident" id="4183406">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183415">//&nbsp;list&nbsp;of&nbsp;lines;&nbsp;each&nbsp;line&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183463">widths</span>&nbsp;&nbsp;<span class="op" id="4183471">[</span><span class="op" id="4183472">]</span><span class="builtintype" id="4183473">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183484">//&nbsp;list&nbsp;of&nbsp;column&nbsp;widths&nbsp;in&nbsp;runes&nbsp;-&nbsp;re-used&nbsp;during&nbsp;formatting</span><br>
<span class="lineno"></span><span class="op" id="4183546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4183549">func</span>&nbsp;<span class="op" id="4183554">(</span><span class="ident" id="4183555">b</span>&nbsp;<span class="op" id="4183557">*</span><span class="ident" id="4183558">Writer</span><span class="op" id="4183564">)</span>&nbsp;<span class="ident" id="4183566">addLine</span><span class="op" id="4183573">(</span><span class="op" id="4183574">)</span>&nbsp;<span class="op" id="4183576">{</span>&nbsp;<span class="ident" id="4183578">b</span><span class="op" id="4183579">.</span><span class="ident" id="4183580">lines</span>&nbsp;<span class="op" id="4183586">=</span>&nbsp;<span class="builtinfunc" id="4183588">append</span><span class="op" id="4183594">(</span><span class="ident" id="4183595">b</span><span class="op" id="4183596">.</span><span class="ident" id="4183597">lines</span><span class="op" id="4183602">,</span>&nbsp;<span class="op" id="4183604">[</span><span class="op" id="4183605">]</span><span class="ident" id="4183606">cell</span><span class="op" id="4183610">{</span><span class="op" id="4183611">}</span><span class="op" id="4183612">)</span>&nbsp;<span class="op" id="4183614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4183617">//&nbsp;Reset&nbsp;the&nbsp;current&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4183645">func</span>&nbsp;<span class="op" id="4183650">(</span><span class="ident" id="4183651">b</span>&nbsp;<span class="op" id="4183653">*</span><span class="ident" id="4183654">Writer</span><span class="op" id="4183660">)</span>&nbsp;<span class="ident" id="4183662">reset</span><span class="op" id="4183667">(</span><span class="op" id="4183668">)</span>&nbsp;<span class="op" id="4183670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183673">b</span><span class="op" id="4183674">.</span><span class="ident" id="4183675">buf</span><span class="op" id="4183678">.</span><span class="ident" id="4183679">Reset</span><span class="op" id="4183684">(</span><span class="op" id="4183685">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183688">b</span><span class="op" id="4183689">.</span><span class="ident" id="4183690">pos</span>&nbsp;<span class="op" id="4183694">=</span>&nbsp;<span class="num" id="4183696">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183699">b</span><span class="op" id="4183700">.</span><span class="ident" id="4183701">cell</span>&nbsp;<span class="op" id="4183706">=</span>&nbsp;<span class="ident" id="4183708">cell</span><span class="op" id="4183712">{</span><span class="op" id="4183713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183716">b</span><span class="op" id="4183717">.</span><span class="ident" id="4183718">endChar</span>&nbsp;<span class="op" id="4183726">=</span>&nbsp;<span class="num" id="4183728">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183731">b</span><span class="op" id="4183732">.</span><span class="ident" id="4183733">lines</span>&nbsp;<span class="op" id="4183739">=</span>&nbsp;<span class="ident" id="4183741">b</span><span class="op" id="4183742">.</span><span class="ident" id="4183743">lines</span><span class="op" id="4183748">[</span><span class="num" id="4183749">0</span><span class="op" id="4183750">:</span><span class="num" id="4183751">0</span><span class="op" id="4183752">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183755">b</span><span class="op" id="4183756">.</span><span class="ident" id="4183757">widths</span>&nbsp;<span class="op" id="4183764">=</span>&nbsp;<span class="ident" id="4183766">b</span><span class="op" id="4183767">.</span><span class="ident" id="4183768">widths</span><span class="op" id="4183774">[</span><span class="num" id="4183775">0</span><span class="op" id="4183776">:</span><span class="num" id="4183777">0</span><span class="op" id="4183778">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4183781">b</span><span class="op" id="4183782">.</span><span class="ident" id="4183783">addLine</span><span class="op" id="4183790">(</span><span class="op" id="4183791">)</span><br>
<span class="lineno"></span><span class="op" id="4183793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4183796">//&nbsp;Internal&nbsp;representation&nbsp;(current&nbsp;state):</span><br>
<span class="lineno"></span><span class="comment" id="4183840">//</span><br>
<span class="lineno">110</span><span class="comment" id="4183843">//&nbsp;-&nbsp;all&nbsp;text&nbsp;written&nbsp;is&nbsp;appended&nbsp;to&nbsp;buf;&nbsp;tabs&nbsp;and&nbsp;line&nbsp;breaks&nbsp;are&nbsp;stripped&nbsp;away</span><br>
<span class="lineno"></span><span class="comment" id="4183924">//&nbsp;-&nbsp;at&nbsp;any&nbsp;given&nbsp;time&nbsp;there&nbsp;is&nbsp;a&nbsp;(possibly&nbsp;empty)&nbsp;incomplete&nbsp;cell&nbsp;at&nbsp;the&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="4184002">//&nbsp;&nbsp;&nbsp;(the&nbsp;cell&nbsp;starts&nbsp;after&nbsp;a&nbsp;tab&nbsp;or&nbsp;line&nbsp;break)</span><br>
<span class="lineno"></span><span class="comment" id="4184051">//&nbsp;-&nbsp;cell.size&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;belonging&nbsp;to&nbsp;the&nbsp;cell&nbsp;so&nbsp;far</span><br>
<span class="lineno"></span><span class="comment" id="4184118">//&nbsp;-&nbsp;cell.width&nbsp;is&nbsp;text&nbsp;width&nbsp;in&nbsp;runes&nbsp;of&nbsp;that&nbsp;cell&nbsp;from&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;cell&nbsp;to</span><br>
<span class="lineno">115</span><span class="comment" id="4184200">//&nbsp;&nbsp;&nbsp;position&nbsp;pos;&nbsp;html&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are&nbsp;excluded&nbsp;from&nbsp;this&nbsp;width&nbsp;if&nbsp;html</span><br>
<span class="lineno"></span><span class="comment" id="4184279">//&nbsp;&nbsp;&nbsp;filtering&nbsp;is&nbsp;enabled</span><br>
<span class="lineno"></span><span class="comment" id="4184305">//&nbsp;-&nbsp;the&nbsp;sizes&nbsp;and&nbsp;widths&nbsp;of&nbsp;processed&nbsp;text&nbsp;are&nbsp;kept&nbsp;in&nbsp;the&nbsp;lines&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="4184376">//&nbsp;&nbsp;&nbsp;which&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;cells&nbsp;for&nbsp;each&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4184426">//&nbsp;-&nbsp;the&nbsp;widths&nbsp;list&nbsp;is&nbsp;a&nbsp;temporary&nbsp;list&nbsp;with&nbsp;current&nbsp;widths&nbsp;used&nbsp;during</span><br>
<span class="lineno">120</span><span class="comment" id="4184499">//&nbsp;&nbsp;&nbsp;formatting;&nbsp;it&nbsp;is&nbsp;kept&nbsp;in&nbsp;Writer&nbsp;because&nbsp;it&#39;s&nbsp;re-used</span><br>
<span class="lineno"></span><span class="comment" id="4184558">//</span><br>
<span class="lineno"></span><span class="comment" id="4184561">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;----------&nbsp;size&nbsp;----------&gt;|</span><br>
<span class="lineno"></span><span class="comment" id="4184614">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4184667">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;-&nbsp;width&nbsp;-&gt;|&lt;-&nbsp;ignored&nbsp;-&gt;|&nbsp;&nbsp;|</span><br>
<span class="lineno">125</span><span class="comment" id="4184720">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4184773">//&nbsp;[---processed---tab------------&lt;tag&gt;...&lt;/tag&gt;...]</span><br>
<span class="lineno"></span><span class="comment" id="4184826">//&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</span><br>
<span class="lineno"></span><span class="comment" id="4184876">//&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4184926">//&nbsp;buf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;&nbsp;pos</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4184979">//&nbsp;Formatting&nbsp;can&nbsp;be&nbsp;controlled&nbsp;with&nbsp;these&nbsp;flags.</span><br>
<span class="lineno"></span><span class="keyword" id="4185029">const</span>&nbsp;<span class="op" id="4185035">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185038">//&nbsp;Ignore&nbsp;html&nbsp;tags&nbsp;and&nbsp;treat&nbsp;entities&nbsp;(starting&nbsp;with&nbsp;&#39;&amp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185097">//&nbsp;and&nbsp;ending&nbsp;in&nbsp;&#39;;&#39;)&nbsp;as&nbsp;single&nbsp;characters&nbsp;(width&nbsp;=&nbsp;1).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185154">FilterHTML</span>&nbsp;<span class="builtintype" id="4185165">uint</span>&nbsp;<span class="op" id="4185170">=</span>&nbsp;<span class="num" id="4185172">1</span>&nbsp;<span class="op" id="4185174">&lt;&lt;</span>&nbsp;<span class="ident" id="4185177">iota</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185184">//&nbsp;Strip&nbsp;Escape&nbsp;characters&nbsp;bracketing&nbsp;escaped&nbsp;text&nbsp;segments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185245">//&nbsp;instead&nbsp;of&nbsp;passing&nbsp;them&nbsp;through&nbsp;unchanged&nbsp;with&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185306">StripEscape</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185320">//&nbsp;Force&nbsp;right-alignment&nbsp;of&nbsp;cell&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185363">//&nbsp;Default&nbsp;is&nbsp;left-alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185394">AlignRight</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185407">//&nbsp;Handle&nbsp;empty&nbsp;columns&nbsp;as&nbsp;if&nbsp;they&nbsp;were&nbsp;not&nbsp;present&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185463">//&nbsp;the&nbsp;input&nbsp;in&nbsp;the&nbsp;first&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185497">DiscardEmptyColumns</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185519">//&nbsp;Always&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;columns&nbsp;(i.e.,&nbsp;padding&nbsp;of</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185581">//&nbsp;leading&nbsp;empty&nbsp;cells&nbsp;on&nbsp;the&nbsp;left)&nbsp;independent&nbsp;of&nbsp;padchar.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185642">TabIndent</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185654">//&nbsp;Print&nbsp;a&nbsp;vertical&nbsp;bar&nbsp;(&#39;|&#39;)&nbsp;between&nbsp;columns&nbsp;(after&nbsp;formatting).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4185721">//&nbsp;Discarded&nbsp;columns&nbsp;appear&nbsp;as&nbsp;zero-width&nbsp;columns&nbsp;(&#34;||&#34;).</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4185780">Debug</span><br>
<span class="lineno"></span><span class="op" id="4185786">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4185789">//&nbsp;A&nbsp;Writer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;with&nbsp;a&nbsp;call&nbsp;to&nbsp;Init.&nbsp;The&nbsp;first&nbsp;parameter&nbsp;(output)</span><br>
<span class="lineno"></span><span class="comment" id="4185871">//&nbsp;specifies&nbsp;the&nbsp;filter&nbsp;output.&nbsp;The&nbsp;remaining&nbsp;parameters&nbsp;control&nbsp;the&nbsp;formatting:</span><br>
<span class="lineno">160</span><span class="comment" id="4185952">//</span><br>
<span class="lineno"></span><span class="comment" id="4185955">//&nbsp;&nbsp;&nbsp;&nbspminwidth&nbsp;&nbsp;&nbsp;&nbspminimal&nbsp;cell&nbsp;width&nbsp;including&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span><span class="comment" id="4186008">//&nbsp;&nbsp;&nbsp;&nbsptabwidth&nbsp;&nbsp;&nbsp;&nbspwidth&nbsp;of&nbsp;tab&nbsp;characters&nbsp;(equivalent&nbsp;number&nbsp;of&nbsp;spaces)</span><br>
<span class="lineno"></span><span class="comment" id="4186074">//&nbsp;&nbsp;&nbsp;&nbsppadding&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsppadding&nbsp;added&nbsp;to&nbsp;a&nbsp;cell&nbsp;before&nbsp;computing&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="4186137">//&nbsp;&nbsp;&nbsp;&nbsppadchar&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspASCII&nbsp;char&nbsp;used&nbsp;for&nbsp;padding</span><br>
<span class="lineno">165</span><span class="comment" id="4186177">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;padchar&nbsp;==&nbsp;&#39;\t&#39;,&nbsp;the&nbsp;Writer&nbsp;will&nbsp;assume&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4186234">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspwidth&nbsp;of&nbsp;a&nbsp;&#39;\t&#39;&nbsp;in&nbsp;the&nbsp;formatted&nbsp;output&nbsp;is&nbsp;tabwidth,</span><br>
<span class="lineno"></span><span class="comment" id="4186292">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspand&nbsp;cells&nbsp;are&nbsp;left-aligned&nbsp;independent&nbsp;of&nbsp;align_left</span><br>
<span class="lineno"></span><span class="comment" id="4186350">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(for&nbsp;correct-looking&nbsp;results,&nbsp;tabwidth&nbsp;must&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="4186410">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspto&nbsp;the&nbsp;tab&nbsp;width&nbsp;in&nbsp;the&nbsp;viewer&nbsp;displaying&nbsp;the&nbsp;result)</span><br>
<span class="lineno">170</span><span class="comment" id="4186469">//&nbsp;&nbsp;&nbsp;&nbspflags&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspformatting&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="4186498">//</span><br>
<span class="lineno"></span><span class="keyword" id="4186501">func</span>&nbsp;<span class="op" id="4186506">(</span><span class="ident" id="4186507">b</span>&nbsp;<span class="op" id="4186509">*</span><span class="ident" id="4186510">Writer</span><span class="op" id="4186516">)</span>&nbsp;<span class="ident" id="4186518">Init</span><span class="op" id="4186522">(</span><span class="ident" id="4186523">output</span>&nbsp;<span class="ident" id="4186530">io</span><span class="op" id="4186532">.</span><span class="ident" id="4186533">Writer</span><span class="op" id="4186539">,</span>&nbsp;<span class="ident" id="4186541">minwidth</span><span class="op" id="4186549">,</span>&nbsp;<span class="ident" id="4186551">tabwidth</span><span class="op" id="4186559">,</span>&nbsp;<span class="ident" id="4186561">padding</span>&nbsp;<span class="builtintype" id="4186569">int</span><span class="op" id="4186572">,</span>&nbsp;<span class="ident" id="4186574">padchar</span>&nbsp;<span class="builtintype" id="4186582">byte</span><span class="op" id="4186586">,</span>&nbsp;<span class="ident" id="4186588">flags</span>&nbsp;<span class="builtintype" id="4186594">uint</span><span class="op" id="4186598">)</span>&nbsp;<span class="op" id="4186600">*</span><span class="ident" id="4186601">Writer</span>&nbsp;<span class="op" id="4186608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186611">if</span>&nbsp;<span class="ident" id="4186614">minwidth</span>&nbsp;<span class="op" id="4186623">&lt;</span>&nbsp;<span class="num" id="4186625">0</span>&nbsp;<span class="op" id="4186627">||</span>&nbsp;<span class="ident" id="4186630">tabwidth</span>&nbsp;<span class="op" id="4186639">&lt;</span>&nbsp;<span class="num" id="4186641">0</span>&nbsp;<span class="op" id="4186643">||</span>&nbsp;<span class="ident" id="4186646">padding</span>&nbsp;<span class="op" id="4186654">&lt;</span>&nbsp;<span class="num" id="4186656">0</span>&nbsp;<span class="op" id="4186658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4186662">panic</span><span class="op" id="4186667">(</span><span class="string" id="4186668">&#34;negative&nbsp;minwidth,&nbsp;tabwidth,&nbsp;or&nbsp;padding&#34;</span><span class="op" id="4186709">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4186712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4186715">b</span><span class="op" id="4186716">.</span><span class="ident" id="4186717">output</span>&nbsp;<span class="op" id="4186724">=</span>&nbsp;<span class="ident" id="4186726">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4186734">b</span><span class="op" id="4186735">.</span><span class="ident" id="4186736">minwidth</span>&nbsp;<span class="op" id="4186745">=</span>&nbsp;<span class="ident" id="4186747">minwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4186757">b</span><span class="op" id="4186758">.</span><span class="ident" id="4186759">tabwidth</span>&nbsp;<span class="op" id="4186768">=</span>&nbsp;<span class="ident" id="4186770">tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4186780">b</span><span class="op" id="4186781">.</span><span class="ident" id="4186782">padding</span>&nbsp;<span class="op" id="4186790">=</span>&nbsp;<span class="ident" id="4186792">padding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186801">for</span>&nbsp;<span class="ident" id="4186805">i</span>&nbsp;<span class="op" id="4186807">:=</span>&nbsp;<span class="keyword" id="4186810">range</span>&nbsp;<span class="ident" id="4186816">b</span><span class="op" id="4186817">.</span><span class="ident" id="4186818">padbytes</span>&nbsp;<span class="op" id="4186827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4186831">b</span><span class="op" id="4186832">.</span><span class="ident" id="4186833">padbytes</span><span class="op" id="4186841">[</span><span class="ident" id="4186842">i</span><span class="op" id="4186843">]</span>&nbsp;<span class="op" id="4186845">=</span>&nbsp;<span class="ident" id="4186847">padchar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4186856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186859">if</span>&nbsp;<span class="ident" id="4186862">padchar</span>&nbsp;<span class="op" id="4186870">==</span>&nbsp;<span class="string" id="4186873">&#39;\t&#39;</span>&nbsp;<span class="op" id="4186878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4186882">//&nbsp;tab&nbsp;padding&nbsp;enforces&nbsp;left-alignment</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4186923">flags</span>&nbsp;<span class="op" id="4186929">&amp;^=</span>&nbsp;<span class="ident" id="4186933">AlignRight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4186945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4186948">b</span><span class="op" id="4186949">.</span><span class="ident" id="4186950">flags</span>&nbsp;<span class="op" id="4186956">=</span>&nbsp;<span class="ident" id="4186958">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4186966">b</span><span class="op" id="4186967">.</span><span class="ident" id="4186968">reset</span><span class="op" id="4186973">(</span><span class="op" id="4186974">)</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4186978">return</span>&nbsp;<span class="ident" id="4186985">b</span><br>
<span class="lineno"></span><span class="op" id="4186987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4186990">//&nbsp;debugging&nbsp;support&nbsp;(keep&nbsp;code&nbsp;around)</span><br>
<span class="lineno">195</span><span class="keyword" id="4187030">func</span>&nbsp;<span class="op" id="4187035">(</span><span class="ident" id="4187036">b</span>&nbsp;<span class="op" id="4187038">*</span><span class="ident" id="4187039">Writer</span><span class="op" id="4187045">)</span>&nbsp;<span class="ident" id="4187047">dump</span><span class="op" id="4187051">(</span><span class="op" id="4187052">)</span>&nbsp;<span class="op" id="4187054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187057">pos</span>&nbsp;<span class="op" id="4187061">:=</span>&nbsp;<span class="num" id="4187064">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187067">for</span>&nbsp;<span class="ident" id="4187071">i</span><span class="op" id="4187072">,</span>&nbsp;<span class="ident" id="4187074">line</span>&nbsp;<span class="op" id="4187079">:=</span>&nbsp;<span class="keyword" id="4187082">range</span>&nbsp;<span class="ident" id="4187088">b</span><span class="op" id="4187089">.</span><span class="ident" id="4187090">lines</span>&nbsp;<span class="op" id="4187096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4187100">print</span><span class="op" id="4187105">(</span><span class="string" id="4187106">&#34;(&#34;</span><span class="op" id="4187109">,</span>&nbsp;<span class="ident" id="4187111">i</span><span class="op" id="4187112">,</span>&nbsp;<span class="string" id="4187114">&#34;)&nbsp;&#34;</span><span class="op" id="4187118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187122">for</span>&nbsp;<span class="ident" id="4187126">_</span><span class="op" id="4187127">,</span>&nbsp;<span class="ident" id="4187129">c</span>&nbsp;<span class="op" id="4187131">:=</span>&nbsp;<span class="keyword" id="4187134">range</span>&nbsp;<span class="ident" id="4187140">line</span>&nbsp;<span class="op" id="4187145">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4187150">print</span><span class="op" id="4187155">(</span><span class="string" id="4187156">&#34;[&#34;</span><span class="op" id="4187159">,</span>&nbsp;<span class="builtintype" id="4187161">string</span><span class="op" id="4187167">(</span><span class="ident" id="4187168">b</span><span class="op" id="4187169">.</span><span class="ident" id="4187170">buf</span><span class="op" id="4187173">.</span><span class="ident" id="4187174">Bytes</span><span class="op" id="4187179">(</span><span class="op" id="4187180">)</span><span class="op" id="4187181">[</span><span class="ident" id="4187182">pos</span><span class="op" id="4187185">:</span><span class="ident" id="4187186">pos</span><span class="op" id="4187189">+</span><span class="ident" id="4187190">c</span><span class="op" id="4187191">.</span><span class="ident" id="4187192">size</span><span class="op" id="4187196">]</span><span class="op" id="4187197">)</span><span class="op" id="4187198">,</span>&nbsp;<span class="string" id="4187200">&#34;]&#34;</span><span class="op" id="4187203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187208">pos</span>&nbsp;<span class="op" id="4187212">+=</span>&nbsp;<span class="ident" id="4187215">c</span><span class="op" id="4187216">.</span><span class="ident" id="4187217">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4187224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4187228">print</span><span class="op" id="4187233">(</span><span class="string" id="4187234">&#34;\n&#34;</span><span class="op" id="4187238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4187241">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4187244">print</span><span class="op" id="4187249">(</span><span class="string" id="4187250">&#34;\n&#34;</span><span class="op" id="4187254">)</span><br>
<span class="lineno"></span><span class="op" id="4187256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4187259">//&nbsp;local&nbsp;error&nbsp;wrapper&nbsp;so&nbsp;we&nbsp;can&nbsp;distinguish&nbsp;errors&nbsp;we&nbsp;want&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4187329">//&nbsp;as&nbsp;errors&nbsp;from&nbsp;genuine&nbsp;panics&nbsp;(which&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;return&nbsp;as&nbsp;errors)</span><br>
<span class="lineno">210</span><span class="keyword" id="4187404">type</span>&nbsp;<span class="ident" id="4187409">osError</span>&nbsp;<span class="keyword" id="4187417">struct</span>&nbsp;<span class="op" id="4187424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187427">err</span>&nbsp;<span class="builtintype" id="4187431">error</span><br>
<span class="lineno"></span><span class="op" id="4187437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4187440">func</span>&nbsp;<span class="op" id="4187445">(</span><span class="ident" id="4187446">b</span>&nbsp;<span class="op" id="4187448">*</span><span class="ident" id="4187449">Writer</span><span class="op" id="4187455">)</span>&nbsp;<span class="ident" id="4187457">write0</span><span class="op" id="4187463">(</span><span class="ident" id="4187464">buf</span>&nbsp;<span class="op" id="4187468">[</span><span class="op" id="4187469">]</span><span class="builtintype" id="4187470">byte</span><span class="op" id="4187474">)</span>&nbsp;<span class="op" id="4187476">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187479">n</span><span class="op" id="4187480">,</span>&nbsp;<span class="ident" id="4187482">err</span>&nbsp;<span class="op" id="4187486">:=</span>&nbsp;<span class="ident" id="4187489">b</span><span class="op" id="4187490">.</span><span class="ident" id="4187491">output</span><span class="op" id="4187497">.</span><span class="ident" id="4187498">Write</span><span class="op" id="4187503">(</span><span class="ident" id="4187504">buf</span><span class="op" id="4187507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187510">if</span>&nbsp;<span class="ident" id="4187513">n</span>&nbsp;<span class="op" id="4187515">!=</span>&nbsp;<span class="builtinfunc" id="4187518">len</span><span class="op" id="4187521">(</span><span class="ident" id="4187522">buf</span><span class="op" id="4187525">)</span>&nbsp;<span class="op" id="4187527">&amp;&amp;</span>&nbsp;<span class="ident" id="4187530">err</span>&nbsp;<span class="op" id="4187534">==</span>&nbsp;<span class="ident" id="4187537">nil</span>&nbsp;<span class="op" id="4187541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187545">err</span>&nbsp;<span class="op" id="4187549">=</span>&nbsp;<span class="ident" id="4187551">io</span><span class="op" id="4187553">.</span><span class="ident" id="4187554">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4187569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187572">if</span>&nbsp;<span class="ident" id="4187575">err</span>&nbsp;<span class="op" id="4187579">!=</span>&nbsp;<span class="ident" id="4187582">nil</span>&nbsp;<span class="op" id="4187586">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4187590">panic</span><span class="op" id="4187595">(</span><span class="ident" id="4187596">osError</span><span class="op" id="4187603">{</span><span class="ident" id="4187604">err</span><span class="op" id="4187607">}</span><span class="op" id="4187608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4187611">}</span><br>
<span class="lineno"></span><span class="op" id="4187613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4187616">func</span>&nbsp;<span class="op" id="4187621">(</span><span class="ident" id="4187622">b</span>&nbsp;<span class="op" id="4187624">*</span><span class="ident" id="4187625">Writer</span><span class="op" id="4187631">)</span>&nbsp;<span class="ident" id="4187633">writeN</span><span class="op" id="4187639">(</span><span class="ident" id="4187640">src</span>&nbsp;<span class="op" id="4187644">[</span><span class="op" id="4187645">]</span><span class="builtintype" id="4187646">byte</span><span class="op" id="4187650">,</span>&nbsp;<span class="ident" id="4187652">n</span>&nbsp;<span class="builtintype" id="4187654">int</span><span class="op" id="4187657">)</span>&nbsp;<span class="op" id="4187659">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187662">for</span>&nbsp;<span class="ident" id="4187666">n</span>&nbsp;<span class="op" id="4187668">&gt;</span>&nbsp;<span class="builtinfunc" id="4187670">len</span><span class="op" id="4187673">(</span><span class="ident" id="4187674">src</span><span class="op" id="4187677">)</span>&nbsp;<span class="op" id="4187679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187683">b</span><span class="op" id="4187684">.</span><span class="ident" id="4187685">write0</span><span class="op" id="4187691">(</span><span class="ident" id="4187692">src</span><span class="op" id="4187695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187699">n</span>&nbsp;<span class="op" id="4187701">-=</span>&nbsp;<span class="builtinfunc" id="4187704">len</span><span class="op" id="4187707">(</span><span class="ident" id="4187708">src</span><span class="op" id="4187711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4187714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187717">b</span><span class="op" id="4187718">.</span><span class="ident" id="4187719">write0</span><span class="op" id="4187725">(</span><span class="ident" id="4187726">src</span><span class="op" id="4187729">[</span><span class="num" id="4187730">0</span><span class="op" id="4187731">:</span><span class="ident" id="4187732">n</span><span class="op" id="4187733">]</span><span class="op" id="4187734">)</span><br>
<span class="lineno">230</span><span class="op" id="4187736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4187739">var</span>&nbsp;<span class="op" id="4187743">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187746">newline</span>&nbsp;<span class="op" id="4187754">=</span>&nbsp;<span class="op" id="4187756">[</span><span class="op" id="4187757">]</span><span class="builtintype" id="4187758">byte</span><span class="op" id="4187762">{</span><span class="string" id="4187763">&#39;\n&#39;</span><span class="op" id="4187767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4187770">tabs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4187778">=</span>&nbsp;<span class="op" id="4187780">[</span><span class="op" id="4187781">]</span><span class="builtintype" id="4187782">byte</span><span class="op" id="4187786">(</span><span class="string" id="4187787">&#34;\t\t\t\t\t\t\t\t&#34;</span><span class="op" id="4187805">)</span><br>
<span class="lineno">235</span><span class="op" id="4187807">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4187810">func</span>&nbsp;<span class="op" id="4187815">(</span><span class="ident" id="4187816">b</span>&nbsp;<span class="op" id="4187818">*</span><span class="ident" id="4187819">Writer</span><span class="op" id="4187825">)</span>&nbsp;<span class="ident" id="4187827">writePadding</span><span class="op" id="4187839">(</span><span class="ident" id="4187840">textw</span><span class="op" id="4187845">,</span>&nbsp;<span class="ident" id="4187847">cellw</span>&nbsp;<span class="builtintype" id="4187853">int</span><span class="op" id="4187856">,</span>&nbsp;<span class="ident" id="4187858">useTabs</span>&nbsp;<span class="builtintype" id="4187866">bool</span><span class="op" id="4187870">)</span>&nbsp;<span class="op" id="4187872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187875">if</span>&nbsp;<span class="ident" id="4187878">b</span><span class="op" id="4187879">.</span><span class="ident" id="4187880">padbytes</span><span class="op" id="4187888">[</span><span class="num" id="4187889">0</span><span class="op" id="4187890">]</span>&nbsp;<span class="op" id="4187892">==</span>&nbsp;<span class="string" id="4187895">&#39;\t&#39;</span>&nbsp;<span class="op" id="4187900">||</span>&nbsp;<span class="ident" id="4187903">useTabs</span>&nbsp;<span class="op" id="4187911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4187915">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;tabs</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187946">if</span>&nbsp;<span class="ident" id="4187949">b</span><span class="op" id="4187950">.</span><span class="ident" id="4187951">tabwidth</span>&nbsp;<span class="op" id="4187960">==</span>&nbsp;<span class="num" id="4187963">0</span>&nbsp;<span class="op" id="4187965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4187970">return</span>&nbsp;<span class="comment" id="4187977">//&nbsp;tabs&nbsp;have&nbsp;no&nbsp;width&nbsp;-&nbsp;can&#39;t&nbsp;do&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4188028">//&nbsp;make&nbsp;cellw&nbsp;the&nbsp;smallest&nbsp;multiple&nbsp;of&nbsp;b.tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188080">cellw</span>&nbsp;<span class="op" id="4188086">=</span>&nbsp;<span class="op" id="4188088">(</span><span class="ident" id="4188089">cellw</span>&nbsp;<span class="op" id="4188095">+</span>&nbsp;<span class="ident" id="4188097">b</span><span class="op" id="4188098">.</span><span class="ident" id="4188099">tabwidth</span>&nbsp;<span class="op" id="4188108">-</span>&nbsp;<span class="num" id="4188110">1</span><span class="op" id="4188111">)</span>&nbsp;<span class="op" id="4188113">/</span>&nbsp;<span class="ident" id="4188115">b</span><span class="op" id="4188116">.</span><span class="ident" id="4188117">tabwidth</span>&nbsp;<span class="op" id="4188126">*</span>&nbsp;<span class="ident" id="4188128">b</span><span class="op" id="4188129">.</span><span class="ident" id="4188130">tabwidth</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188141">n</span>&nbsp;<span class="op" id="4188143">:=</span>&nbsp;<span class="ident" id="4188146">cellw</span>&nbsp;<span class="op" id="4188152">-</span>&nbsp;<span class="ident" id="4188154">textw</span>&nbsp;<span class="comment" id="4188160">//&nbsp;amount&nbsp;of&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188183">if</span>&nbsp;<span class="ident" id="4188186">n</span>&nbsp;<span class="op" id="4188188">&lt;</span>&nbsp;<span class="num" id="4188190">0</span>&nbsp;<span class="op" id="4188192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4188197">panic</span><span class="op" id="4188202">(</span><span class="string" id="4188203">&#34;internal&nbsp;error&#34;</span><span class="op" id="4188219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188227">b</span><span class="op" id="4188228">.</span><span class="ident" id="4188229">writeN</span><span class="op" id="4188235">(</span><span class="ident" id="4188236">tabs</span><span class="op" id="4188240">,</span>&nbsp;<span class="op" id="4188242">(</span><span class="ident" id="4188243">n</span><span class="op" id="4188244">+</span><span class="ident" id="4188245">b</span><span class="op" id="4188246">.</span><span class="ident" id="4188247">tabwidth</span><span class="op" id="4188255">-</span><span class="num" id="4188256">1</span><span class="op" id="4188257">)</span><span class="op" id="4188258">/</span><span class="ident" id="4188259">b</span><span class="op" id="4188260">.</span><span class="ident" id="4188261">tabwidth</span><span class="op" id="4188269">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188273">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4188285">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;non-tab&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188329">b</span><span class="op" id="4188330">.</span><span class="ident" id="4188331">writeN</span><span class="op" id="4188337">(</span><span class="ident" id="4188338">b</span><span class="op" id="4188339">.</span><span class="ident" id="4188340">padbytes</span><span class="op" id="4188348">[</span><span class="num" id="4188349">0</span><span class="op" id="4188350">:</span><span class="op" id="4188351">]</span><span class="op" id="4188352">,</span>&nbsp;<span class="ident" id="4188354">cellw</span><span class="op" id="4188359">-</span><span class="ident" id="4188360">textw</span><span class="op" id="4188365">)</span><br>
<span class="lineno">255</span><span class="op" id="4188367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4188370">var</span>&nbsp;<span class="ident" id="4188374">vbar</span>&nbsp;<span class="op" id="4188379">=</span>&nbsp;<span class="op" id="4188381">[</span><span class="op" id="4188382">]</span><span class="builtintype" id="4188383">byte</span><span class="op" id="4188387">{</span><span class="string" id="4188388">&#39;|&#39;</span><span class="op" id="4188391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4188394">func</span>&nbsp;<span class="op" id="4188399">(</span><span class="ident" id="4188400">b</span>&nbsp;<span class="op" id="4188402">*</span><span class="ident" id="4188403">Writer</span><span class="op" id="4188409">)</span>&nbsp;<span class="ident" id="4188411">writeLines</span><span class="op" id="4188421">(</span><span class="ident" id="4188422">pos0</span>&nbsp;<span class="builtintype" id="4188427">int</span><span class="op" id="4188430">,</span>&nbsp;<span class="ident" id="4188432">line0</span><span class="op" id="4188437">,</span>&nbsp;<span class="ident" id="4188439">line1</span>&nbsp;<span class="builtintype" id="4188445">int</span><span class="op" id="4188448">)</span>&nbsp;<span class="op" id="4188450">(</span><span class="ident" id="4188451">pos</span>&nbsp;<span class="builtintype" id="4188455">int</span><span class="op" id="4188458">)</span>&nbsp;<span class="op" id="4188460">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188463">pos</span>&nbsp;<span class="op" id="4188467">=</span>&nbsp;<span class="ident" id="4188469">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188475">for</span>&nbsp;<span class="ident" id="4188479">i</span>&nbsp;<span class="op" id="4188481">:=</span>&nbsp;<span class="ident" id="4188484">line0</span><span class="op" id="4188489">;</span>&nbsp;<span class="ident" id="4188491">i</span>&nbsp;<span class="op" id="4188493">&lt;</span>&nbsp;<span class="ident" id="4188495">line1</span><span class="op" id="4188500">;</span>&nbsp;<span class="ident" id="4188502">i</span><span class="op" id="4188503">++</span>&nbsp;<span class="op" id="4188506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188510">line</span>&nbsp;<span class="op" id="4188515">:=</span>&nbsp;<span class="ident" id="4188518">b</span><span class="op" id="4188519">.</span><span class="ident" id="4188520">lines</span><span class="op" id="4188525">[</span><span class="ident" id="4188526">i</span><span class="op" id="4188527">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4188532">//&nbsp;if&nbsp;TabIndent&nbsp;is&nbsp;set,&nbsp;use&nbsp;tabs&nbsp;to&nbsp;pad&nbsp;leading&nbsp;empty&nbsp;cells</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188594">useTabs</span>&nbsp;<span class="op" id="4188602">:=</span>&nbsp;<span class="ident" id="4188605">b</span><span class="op" id="4188606">.</span><span class="ident" id="4188607">flags</span><span class="op" id="4188612">&amp;</span><span class="ident" id="4188613">TabIndent</span>&nbsp;<span class="op" id="4188623">!=</span>&nbsp;<span class="num" id="4188626">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188631">for</span>&nbsp;<span class="ident" id="4188635">j</span><span class="op" id="4188636">,</span>&nbsp;<span class="ident" id="4188638">c</span>&nbsp;<span class="op" id="4188640">:=</span>&nbsp;<span class="keyword" id="4188643">range</span>&nbsp;<span class="ident" id="4188649">line</span>&nbsp;<span class="op" id="4188654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188659">if</span>&nbsp;<span class="ident" id="4188662">j</span>&nbsp;<span class="op" id="4188664">&gt;</span>&nbsp;<span class="num" id="4188666">0</span>&nbsp;<span class="op" id="4188668">&amp;&amp;</span>&nbsp;<span class="ident" id="4188671">b</span><span class="op" id="4188672">.</span><span class="ident" id="4188673">flags</span><span class="op" id="4188678">&amp;</span><span class="ident" id="4188679">Debug</span>&nbsp;<span class="op" id="4188685">!=</span>&nbsp;<span class="num" id="4188688">0</span>&nbsp;<span class="op" id="4188690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4188696">//&nbsp;indicate&nbsp;column&nbsp;break</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188725">b</span><span class="op" id="4188726">.</span><span class="ident" id="4188727">write0</span><span class="op" id="4188733">(</span><span class="ident" id="4188734">vbar</span><span class="op" id="4188738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188749">if</span>&nbsp;<span class="ident" id="4188752">c</span><span class="op" id="4188753">.</span><span class="ident" id="4188754">size</span>&nbsp;<span class="op" id="4188759">==</span>&nbsp;<span class="num" id="4188762">0</span>&nbsp;<span class="op" id="4188764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4188770">//&nbsp;empty&nbsp;cell</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188788">if</span>&nbsp;<span class="ident" id="4188791">j</span>&nbsp;<span class="op" id="4188793">&lt;</span>&nbsp;<span class="builtinfunc" id="4188795">len</span><span class="op" id="4188798">(</span><span class="ident" id="4188799">b</span><span class="op" id="4188800">.</span><span class="ident" id="4188801">widths</span><span class="op" id="4188807">)</span>&nbsp;<span class="op" id="4188809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188816">b</span><span class="op" id="4188817">.</span><span class="ident" id="4188818">writePadding</span><span class="op" id="4188830">(</span><span class="ident" id="4188831">c</span><span class="op" id="4188832">.</span><span class="ident" id="4188833">width</span><span class="op" id="4188838">,</span>&nbsp;<span class="ident" id="4188840">b</span><span class="op" id="4188841">.</span><span class="ident" id="4188842">widths</span><span class="op" id="4188848">[</span><span class="ident" id="4188849">j</span><span class="op" id="4188850">]</span><span class="op" id="4188851">,</span>&nbsp;<span class="ident" id="4188853">useTabs</span><span class="op" id="4188860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4188871">}</span>&nbsp;<span class="keyword" id="4188873">else</span>&nbsp;<span class="op" id="4188878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4188884">//&nbsp;non-empty&nbsp;cell</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188906">useTabs</span>&nbsp;<span class="op" id="4188914">=</span>&nbsp;<span class="builtintype" id="4188916">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4188926">if</span>&nbsp;<span class="ident" id="4188929">b</span><span class="op" id="4188930">.</span><span class="ident" id="4188931">flags</span><span class="op" id="4188936">&amp;</span><span class="ident" id="4188937">AlignRight</span>&nbsp;<span class="op" id="4188948">==</span>&nbsp;<span class="num" id="4188951">0</span>&nbsp;<span class="op" id="4188953">{</span>&nbsp;<span class="comment" id="4188955">//&nbsp;align&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4188974">b</span><span class="op" id="4188975">.</span><span class="ident" id="4188976">write0</span><span class="op" id="4188982">(</span><span class="ident" id="4188983">b</span><span class="op" id="4188984">.</span><span class="ident" id="4188985">buf</span><span class="op" id="4188988">.</span><span class="ident" id="4188989">Bytes</span><span class="op" id="4188994">(</span><span class="op" id="4188995">)</span><span class="op" id="4188996">[</span><span class="ident" id="4188997">pos</span>&nbsp;<span class="op" id="4189001">:</span>&nbsp;<span class="ident" id="4189003">pos</span><span class="op" id="4189006">+</span><span class="ident" id="4189007">c</span><span class="op" id="4189008">.</span><span class="ident" id="4189009">size</span><span class="op" id="4189013">]</span><span class="op" id="4189014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189021">pos</span>&nbsp;<span class="op" id="4189025">+=</span>&nbsp;<span class="ident" id="4189028">c</span><span class="op" id="4189029">.</span><span class="ident" id="4189030">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189040">if</span>&nbsp;<span class="ident" id="4189043">j</span>&nbsp;<span class="op" id="4189045">&lt;</span>&nbsp;<span class="builtinfunc" id="4189047">len</span><span class="op" id="4189050">(</span><span class="ident" id="4189051">b</span><span class="op" id="4189052">.</span><span class="ident" id="4189053">widths</span><span class="op" id="4189059">)</span>&nbsp;<span class="op" id="4189061">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189069">b</span><span class="op" id="4189070">.</span><span class="ident" id="4189071">writePadding</span><span class="op" id="4189083">(</span><span class="ident" id="4189084">c</span><span class="op" id="4189085">.</span><span class="ident" id="4189086">width</span><span class="op" id="4189091">,</span>&nbsp;<span class="ident" id="4189093">b</span><span class="op" id="4189094">.</span><span class="ident" id="4189095">widths</span><span class="op" id="4189101">[</span><span class="ident" id="4189102">j</span><span class="op" id="4189103">]</span><span class="op" id="4189104">,</span>&nbsp;<span class="builtintype" id="4189106">false</span><span class="op" id="4189111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189124">}</span>&nbsp;<span class="keyword" id="4189126">else</span>&nbsp;<span class="op" id="4189131">{</span>&nbsp;<span class="comment" id="4189133">//&nbsp;align&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189153">if</span>&nbsp;<span class="ident" id="4189156">j</span>&nbsp;<span class="op" id="4189158">&lt;</span>&nbsp;<span class="builtinfunc" id="4189160">len</span><span class="op" id="4189163">(</span><span class="ident" id="4189164">b</span><span class="op" id="4189165">.</span><span class="ident" id="4189166">widths</span><span class="op" id="4189172">)</span>&nbsp;<span class="op" id="4189174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189182">b</span><span class="op" id="4189183">.</span><span class="ident" id="4189184">writePadding</span><span class="op" id="4189196">(</span><span class="ident" id="4189197">c</span><span class="op" id="4189198">.</span><span class="ident" id="4189199">width</span><span class="op" id="4189204">,</span>&nbsp;<span class="ident" id="4189206">b</span><span class="op" id="4189207">.</span><span class="ident" id="4189208">widths</span><span class="op" id="4189214">[</span><span class="ident" id="4189215">j</span><span class="op" id="4189216">]</span><span class="op" id="4189217">,</span>&nbsp;<span class="builtintype" id="4189219">false</span><span class="op" id="4189224">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189238">b</span><span class="op" id="4189239">.</span><span class="ident" id="4189240">write0</span><span class="op" id="4189246">(</span><span class="ident" id="4189247">b</span><span class="op" id="4189248">.</span><span class="ident" id="4189249">buf</span><span class="op" id="4189252">.</span><span class="ident" id="4189253">Bytes</span><span class="op" id="4189258">(</span><span class="op" id="4189259">)</span><span class="op" id="4189260">[</span><span class="ident" id="4189261">pos</span>&nbsp;<span class="op" id="4189265">:</span>&nbsp;<span class="ident" id="4189267">pos</span><span class="op" id="4189270">+</span><span class="ident" id="4189271">c</span><span class="op" id="4189272">.</span><span class="ident" id="4189273">size</span><span class="op" id="4189277">]</span><span class="op" id="4189278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189285">pos</span>&nbsp;<span class="op" id="4189289">+=</span>&nbsp;<span class="ident" id="4189292">c</span><span class="op" id="4189293">.</span><span class="ident" id="4189294">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189308">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189317">if</span>&nbsp;<span class="ident" id="4189320">i</span><span class="op" id="4189321">+</span><span class="num" id="4189322">1</span>&nbsp;<span class="op" id="4189324">==</span>&nbsp;<span class="builtinfunc" id="4189327">len</span><span class="op" id="4189330">(</span><span class="ident" id="4189331">b</span><span class="op" id="4189332">.</span><span class="ident" id="4189333">lines</span><span class="op" id="4189338">)</span>&nbsp;<span class="op" id="4189340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4189345">//&nbsp;last&nbsp;buffered&nbsp;line&nbsp;-&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;newline,&nbsp;so&nbsp;just&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4189411">//&nbsp;any&nbsp;outstanding&nbsp;buffered&nbsp;data</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189447">b</span><span class="op" id="4189448">.</span><span class="ident" id="4189449">write0</span><span class="op" id="4189455">(</span><span class="ident" id="4189456">b</span><span class="op" id="4189457">.</span><span class="ident" id="4189458">buf</span><span class="op" id="4189461">.</span><span class="ident" id="4189462">Bytes</span><span class="op" id="4189467">(</span><span class="op" id="4189468">)</span><span class="op" id="4189469">[</span><span class="ident" id="4189470">pos</span>&nbsp;<span class="op" id="4189474">:</span>&nbsp;<span class="ident" id="4189476">pos</span><span class="op" id="4189479">+</span><span class="ident" id="4189480">b</span><span class="op" id="4189481">.</span><span class="ident" id="4189482">cell</span><span class="op" id="4189486">.</span><span class="ident" id="4189487">size</span><span class="op" id="4189491">]</span><span class="op" id="4189492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189497">pos</span>&nbsp;<span class="op" id="4189501">+=</span>&nbsp;<span class="ident" id="4189504">b</span><span class="op" id="4189505">.</span><span class="ident" id="4189506">cell</span><span class="op" id="4189510">.</span><span class="ident" id="4189511">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189518">}</span>&nbsp;<span class="keyword" id="4189520">else</span>&nbsp;<span class="op" id="4189525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4189530">//&nbsp;not&nbsp;the&nbsp;last&nbsp;line&nbsp;-&nbsp;write&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189570">b</span><span class="op" id="4189571">.</span><span class="ident" id="4189572">write0</span><span class="op" id="4189578">(</span><span class="ident" id="4189579">newline</span><span class="op" id="4189586">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4189593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189596">return</span><br>
<span class="lineno"></span><span class="op" id="4189603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="4189606">//&nbsp;Format&nbsp;the&nbsp;text&nbsp;between&nbsp;line0&nbsp;and&nbsp;line1&nbsp;(excluding&nbsp;line1);&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="4189672">//&nbsp;is&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;line0.</span><br>
<span class="lineno"></span><span class="comment" id="4189739">//&nbsp;Returns&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4189804">//&nbsp;line1&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="4189835">//</span><br>
<span class="lineno">315</span><span class="keyword" id="4189838">func</span>&nbsp;<span class="op" id="4189843">(</span><span class="ident" id="4189844">b</span>&nbsp;<span class="op" id="4189846">*</span><span class="ident" id="4189847">Writer</span><span class="op" id="4189853">)</span>&nbsp;<span class="ident" id="4189855">format</span><span class="op" id="4189861">(</span><span class="ident" id="4189862">pos0</span>&nbsp;<span class="builtintype" id="4189867">int</span><span class="op" id="4189870">,</span>&nbsp;<span class="ident" id="4189872">line0</span><span class="op" id="4189877">,</span>&nbsp;<span class="ident" id="4189879">line1</span>&nbsp;<span class="builtintype" id="4189885">int</span><span class="op" id="4189888">)</span>&nbsp;<span class="op" id="4189890">(</span><span class="ident" id="4189891">pos</span>&nbsp;<span class="builtintype" id="4189895">int</span><span class="op" id="4189898">)</span>&nbsp;<span class="op" id="4189900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189903">pos</span>&nbsp;<span class="op" id="4189907">=</span>&nbsp;<span class="ident" id="4189909">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189915">column</span>&nbsp;<span class="op" id="4189922">:=</span>&nbsp;<span class="builtinfunc" id="4189925">len</span><span class="op" id="4189928">(</span><span class="ident" id="4189929">b</span><span class="op" id="4189930">.</span><span class="ident" id="4189931">widths</span><span class="op" id="4189937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4189940">for</span>&nbsp;<span class="ident" id="4189944">this</span>&nbsp;<span class="op" id="4189949">:=</span>&nbsp;<span class="ident" id="4189952">line0</span><span class="op" id="4189957">;</span>&nbsp;<span class="ident" id="4189959">this</span>&nbsp;<span class="op" id="4189964">&lt;</span>&nbsp;<span class="ident" id="4189966">line1</span><span class="op" id="4189971">;</span>&nbsp;<span class="ident" id="4189973">this</span><span class="op" id="4189977">++</span>&nbsp;<span class="op" id="4189980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4189984">line</span>&nbsp;<span class="op" id="4189989">:=</span>&nbsp;<span class="ident" id="4189992">b</span><span class="op" id="4189993">.</span><span class="ident" id="4189994">lines</span><span class="op" id="4189999">[</span><span class="ident" id="4190000">this</span><span class="op" id="4190004">]</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190009">if</span>&nbsp;<span class="ident" id="4190012">column</span>&nbsp;<span class="op" id="4190019">&lt;</span>&nbsp;<span class="builtinfunc" id="4190021">len</span><span class="op" id="4190024">(</span><span class="ident" id="4190025">line</span><span class="op" id="4190029">)</span><span class="op" id="4190030">-</span><span class="num" id="4190031">1</span>&nbsp;<span class="op" id="4190033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190038">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column&nbsp;=&gt;&nbsp;this&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190084">//&nbsp;has&nbsp;more&nbsp;cells&nbsp;than&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190128">//&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;is&nbsp;ignored&nbsp;because&nbsp;cells&nbsp;are</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190187">//&nbsp;tab-terminated;&nbsp;the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190246">//&nbsp;text&nbsp;before&nbsp;the&nbsp;newline/formfeed&nbsp;and&nbsp;does&nbsp;not&nbsp;belong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190305">//&nbsp;to&nbsp;a&nbsp;column)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190325">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;beginning&nbsp;of&nbsp;block</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190378">pos</span>&nbsp;<span class="op" id="4190382">=</span>&nbsp;<span class="ident" id="4190384">b</span><span class="op" id="4190385">.</span><span class="ident" id="4190386">writeLines</span><span class="op" id="4190396">(</span><span class="ident" id="4190397">pos</span><span class="op" id="4190400">,</span>&nbsp;<span class="ident" id="4190402">line0</span><span class="op" id="4190407">,</span>&nbsp;<span class="ident" id="4190409">this</span><span class="op" id="4190413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190418">line0</span>&nbsp;<span class="op" id="4190424">=</span>&nbsp;<span class="ident" id="4190426">this</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190435">//&nbsp;column&nbsp;block&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190460">width</span>&nbsp;<span class="op" id="4190466">:=</span>&nbsp;<span class="ident" id="4190469">b</span><span class="op" id="4190470">.</span><span class="ident" id="4190471">minwidth</span>&nbsp;<span class="comment" id="4190480">//&nbsp;minimal&nbsp;column&nbsp;width</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190507">discardable</span>&nbsp;<span class="op" id="4190519">:=</span>&nbsp;<span class="builtintype" id="4190522">true</span>&nbsp;<span class="comment" id="4190527">//&nbsp;true&nbsp;if&nbsp;all&nbsp;cells&nbsp;in&nbsp;this&nbsp;column&nbsp;are&nbsp;empty&nbsp;and&nbsp;&#34;soft&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190587">for</span>&nbsp;<span class="op" id="4190591">;</span>&nbsp;<span class="ident" id="4190593">this</span>&nbsp;<span class="op" id="4190598">&lt;</span>&nbsp;<span class="ident" id="4190600">line1</span><span class="op" id="4190605">;</span>&nbsp;<span class="ident" id="4190607">this</span><span class="op" id="4190611">++</span>&nbsp;<span class="op" id="4190614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190620">line</span>&nbsp;<span class="op" id="4190625">=</span>&nbsp;<span class="ident" id="4190627">b</span><span class="op" id="4190628">.</span><span class="ident" id="4190629">lines</span><span class="op" id="4190634">[</span><span class="ident" id="4190635">this</span><span class="op" id="4190639">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190645">if</span>&nbsp;<span class="ident" id="4190648">column</span>&nbsp;<span class="op" id="4190655">&lt;</span>&nbsp;<span class="builtinfunc" id="4190657">len</span><span class="op" id="4190660">(</span><span class="ident" id="4190661">line</span><span class="op" id="4190665">)</span><span class="op" id="4190666">-</span><span class="num" id="4190667">1</span>&nbsp;<span class="op" id="4190669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190676">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190711">c</span>&nbsp;<span class="op" id="4190713">:=</span>&nbsp;<span class="ident" id="4190716">line</span><span class="op" id="4190720">[</span><span class="ident" id="4190721">column</span><span class="op" id="4190727">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190734">//&nbsp;update&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190755">if</span>&nbsp;<span class="ident" id="4190758">w</span>&nbsp;<span class="op" id="4190760">:=</span>&nbsp;<span class="ident" id="4190763">c</span><span class="op" id="4190764">.</span><span class="ident" id="4190765">width</span>&nbsp;<span class="op" id="4190771">+</span>&nbsp;<span class="ident" id="4190773">b</span><span class="op" id="4190774">.</span><span class="ident" id="4190775">padding</span><span class="op" id="4190782">;</span>&nbsp;<span class="ident" id="4190784">w</span>&nbsp;<span class="op" id="4190786">&gt;</span>&nbsp;<span class="ident" id="4190788">width</span>&nbsp;<span class="op" id="4190794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190802">width</span>&nbsp;<span class="op" id="4190808">=</span>&nbsp;<span class="ident" id="4190810">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190817">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190824">//&nbsp;update&nbsp;discardable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190851">if</span>&nbsp;<span class="ident" id="4190854">c</span><span class="op" id="4190855">.</span><span class="ident" id="4190856">width</span>&nbsp;<span class="op" id="4190862">&gt;</span>&nbsp;<span class="num" id="4190864">0</span>&nbsp;<span class="op" id="4190866">||</span>&nbsp;<span class="ident" id="4190869">c</span><span class="op" id="4190870">.</span><span class="ident" id="4190871">htab</span>&nbsp;<span class="op" id="4190876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4190884">discardable</span>&nbsp;<span class="op" id="4190896">=</span>&nbsp;<span class="builtintype" id="4190898">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190915">}</span>&nbsp;<span class="keyword" id="4190917">else</span>&nbsp;<span class="op" id="4190922">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4190929">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4190944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190949">//&nbsp;column&nbsp;block&nbsp;end</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4190973">//&nbsp;discard&nbsp;empty&nbsp;columns&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191014">if</span>&nbsp;<span class="ident" id="4191017">discardable</span>&nbsp;<span class="op" id="4191029">&amp;&amp;</span>&nbsp;<span class="ident" id="4191032">b</span><span class="op" id="4191033">.</span><span class="ident" id="4191034">flags</span><span class="op" id="4191039">&amp;</span><span class="ident" id="4191040">DiscardEmptyColumns</span>&nbsp;<span class="op" id="4191060">!=</span>&nbsp;<span class="num" id="4191063">0</span>&nbsp;<span class="op" id="4191065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191071">width</span>&nbsp;<span class="op" id="4191077">=</span>&nbsp;<span class="num" id="4191079">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4191084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4191090">//&nbsp;format&nbsp;and&nbsp;print&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;right&nbsp;of&nbsp;this&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4191153">//&nbsp;(we&nbsp;know&nbsp;the&nbsp;widths&nbsp;of&nbsp;this&nbsp;column&nbsp;and&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;left)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191223">b</span><span class="op" id="4191224">.</span><span class="ident" id="4191225">widths</span>&nbsp;<span class="op" id="4191232">=</span>&nbsp;<span class="builtinfunc" id="4191234">append</span><span class="op" id="4191240">(</span><span class="ident" id="4191241">b</span><span class="op" id="4191242">.</span><span class="ident" id="4191243">widths</span><span class="op" id="4191249">,</span>&nbsp;<span class="ident" id="4191251">width</span><span class="op" id="4191256">)</span>&nbsp;<span class="comment" id="4191258">//&nbsp;push&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191275">pos</span>&nbsp;<span class="op" id="4191279">=</span>&nbsp;<span class="ident" id="4191281">b</span><span class="op" id="4191282">.</span><span class="ident" id="4191283">format</span><span class="op" id="4191289">(</span><span class="ident" id="4191290">pos</span><span class="op" id="4191293">,</span>&nbsp;<span class="ident" id="4191295">line0</span><span class="op" id="4191300">,</span>&nbsp;<span class="ident" id="4191302">this</span><span class="op" id="4191306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191311">b</span><span class="op" id="4191312">.</span><span class="ident" id="4191313">widths</span>&nbsp;<span class="op" id="4191320">=</span>&nbsp;<span class="ident" id="4191322">b</span><span class="op" id="4191323">.</span><span class="ident" id="4191324">widths</span><span class="op" id="4191330">[</span><span class="num" id="4191331">0</span>&nbsp;<span class="op" id="4191333">:</span>&nbsp;<span class="builtinfunc" id="4191335">len</span><span class="op" id="4191338">(</span><span class="ident" id="4191339">b</span><span class="op" id="4191340">.</span><span class="ident" id="4191341">widths</span><span class="op" id="4191347">)</span><span class="op" id="4191348">-</span><span class="num" id="4191349">1</span><span class="op" id="4191350">]</span>&nbsp;<span class="comment" id="4191352">//&nbsp;pop&nbsp;width</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191368">line0</span>&nbsp;<span class="op" id="4191374">=</span>&nbsp;<span class="ident" id="4191376">this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4191383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4191386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4191390">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;end</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4191426">return</span>&nbsp;<span class="ident" id="4191433">b</span><span class="op" id="4191434">.</span><span class="ident" id="4191435">writeLines</span><span class="op" id="4191445">(</span><span class="ident" id="4191446">pos</span><span class="op" id="4191449">,</span>&nbsp;<span class="ident" id="4191451">line0</span><span class="op" id="4191456">,</span>&nbsp;<span class="ident" id="4191458">line1</span><span class="op" id="4191463">)</span><br>
<span class="lineno"></span><span class="op" id="4191465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4191468">//&nbsp;Append&nbsp;text&nbsp;to&nbsp;current&nbsp;cell.</span><br>
<span class="lineno"></span><span class="keyword" id="4191500">func</span>&nbsp;<span class="op" id="4191505">(</span><span class="ident" id="4191506">b</span>&nbsp;<span class="op" id="4191508">*</span><span class="ident" id="4191509">Writer</span><span class="op" id="4191515">)</span>&nbsp;<span class="builtinfunc" id="4191517">append</span><span class="op" id="4191523">(</span><span class="ident" id="4191524">text</span>&nbsp;<span class="op" id="4191529">[</span><span class="op" id="4191530">]</span><span class="builtintype" id="4191531">byte</span><span class="op" id="4191535">)</span>&nbsp;<span class="op" id="4191537">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191540">b</span><span class="op" id="4191541">.</span><span class="ident" id="4191542">buf</span><span class="op" id="4191545">.</span><span class="ident" id="4191546">Write</span><span class="op" id="4191551">(</span><span class="ident" id="4191552">text</span><span class="op" id="4191556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191559">b</span><span class="op" id="4191560">.</span><span class="ident" id="4191561">cell</span><span class="op" id="4191565">.</span><span class="ident" id="4191566">size</span>&nbsp;<span class="op" id="4191571">+=</span>&nbsp;<span class="builtinfunc" id="4191574">len</span><span class="op" id="4191577">(</span><span class="ident" id="4191578">text</span><span class="op" id="4191582">)</span><br>
<span class="lineno"></span><span class="op" id="4191584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4191587">//&nbsp;Update&nbsp;the&nbsp;cell&nbsp;width.</span><br>
<span class="lineno">380</span><span class="keyword" id="4191613">func</span>&nbsp;<span class="op" id="4191618">(</span><span class="ident" id="4191619">b</span>&nbsp;<span class="op" id="4191621">*</span><span class="ident" id="4191622">Writer</span><span class="op" id="4191628">)</span>&nbsp;<span class="ident" id="4191630">updateWidth</span><span class="op" id="4191641">(</span><span class="op" id="4191642">)</span>&nbsp;<span class="op" id="4191644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191647">b</span><span class="op" id="4191648">.</span><span class="ident" id="4191649">cell</span><span class="op" id="4191653">.</span><span class="ident" id="4191654">width</span>&nbsp;<span class="op" id="4191660">+=</span>&nbsp;<span class="ident" id="4191663">utf8</span><span class="op" id="4191667">.</span><span class="ident" id="4191668">RuneCount</span><span class="op" id="4191677">(</span><span class="ident" id="4191678">b</span><span class="op" id="4191679">.</span><span class="ident" id="4191680">buf</span><span class="op" id="4191683">.</span><span class="ident" id="4191684">Bytes</span><span class="op" id="4191689">(</span><span class="op" id="4191690">)</span><span class="op" id="4191691">[</span><span class="ident" id="4191692">b</span><span class="op" id="4191693">.</span><span class="ident" id="4191694">pos</span><span class="op" id="4191697">:</span><span class="ident" id="4191698">b</span><span class="op" id="4191699">.</span><span class="ident" id="4191700">buf</span><span class="op" id="4191703">.</span><span class="ident" id="4191704">Len</span><span class="op" id="4191707">(</span><span class="op" id="4191708">)</span><span class="op" id="4191709">]</span><span class="op" id="4191710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4191713">b</span><span class="op" id="4191714">.</span><span class="ident" id="4191715">pos</span>&nbsp;<span class="op" id="4191719">=</span>&nbsp;<span class="ident" id="4191721">b</span><span class="op" id="4191722">.</span><span class="ident" id="4191723">buf</span><span class="op" id="4191726">.</span><span class="ident" id="4191727">Len</span><span class="op" id="4191730">(</span><span class="op" id="4191731">)</span><br>
<span class="lineno"></span><span class="op" id="4191733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="4191736">//&nbsp;To&nbsp;escape&nbsp;a&nbsp;text&nbsp;segment,&nbsp;bracket&nbsp;it&nbsp;with&nbsp;Escape&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="4191800">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;tab&nbsp;in&nbsp;this&nbsp;string&nbsp;&#34;Ignore&nbsp;this&nbsp;tab:&nbsp;\xff\t\xff&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4191870">//&nbsp;does&nbsp;not&nbsp;terminate&nbsp;a&nbsp;cell&nbsp;and&nbsp;constitutes&nbsp;a&nbsp;single&nbsp;character&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4191937">//&nbsp;width&nbsp;one&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4191975">//</span><br>
<span class="lineno">390</span><span class="comment" id="4191978">//&nbsp;The&nbsp;value&nbsp;0xff&nbsp;was&nbsp;chosen&nbsp;because&nbsp;it&nbsp;cannot&nbsp;appear&nbsp;in&nbsp;a&nbsp;valid&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="4192059">//</span><br>
<span class="lineno"></span><span class="keyword" id="4192062">const</span>&nbsp;<span class="ident" id="4192068">Escape</span>&nbsp;<span class="op" id="4192075">=</span>&nbsp;<span class="string" id="4192077">&#39;\xff&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4192085">//&nbsp;Start&nbsp;escaped&nbsp;mode.</span><br>
<span class="lineno">395</span><span class="keyword" id="4192108">func</span>&nbsp;<span class="op" id="4192113">(</span><span class="ident" id="4192114">b</span>&nbsp;<span class="op" id="4192116">*</span><span class="ident" id="4192117">Writer</span><span class="op" id="4192123">)</span>&nbsp;<span class="ident" id="4192125">startEscape</span><span class="op" id="4192136">(</span><span class="ident" id="4192137">ch</span>&nbsp;<span class="builtintype" id="4192140">byte</span><span class="op" id="4192144">)</span>&nbsp;<span class="op" id="4192146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192149">switch</span>&nbsp;<span class="ident" id="4192156">ch</span>&nbsp;<span class="op" id="4192159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192162">case</span>&nbsp;<span class="ident" id="4192167">Escape</span><span class="op" id="4192173">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192177">b</span><span class="op" id="4192178">.</span><span class="ident" id="4192179">endChar</span>&nbsp;<span class="op" id="4192187">=</span>&nbsp;<span class="ident" id="4192189">Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192197">case</span>&nbsp;<span class="string" id="4192202">&#39;&lt;&#39;</span><span class="op" id="4192205">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192209">b</span><span class="op" id="4192210">.</span><span class="ident" id="4192211">endChar</span>&nbsp;<span class="op" id="4192219">=</span>&nbsp;<span class="string" id="4192221">&#39;&gt;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192226">case</span>&nbsp;<span class="string" id="4192231">&#39;&amp;&#39;</span><span class="op" id="4192234">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192238">b</span><span class="op" id="4192239">.</span><span class="ident" id="4192240">endChar</span>&nbsp;<span class="op" id="4192248">=</span>&nbsp;<span class="string" id="4192250">&#39;;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192255">}</span><br>
<span class="lineno"></span><span class="op" id="4192257">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="4192260">//&nbsp;Terminate&nbsp;escaped&nbsp;mode.&nbsp;If&nbsp;the&nbsp;escaped&nbsp;text&nbsp;was&nbsp;an&nbsp;HTML&nbsp;tag,&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="4192334">//&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;for&nbsp;formatting&nbsp;purposes;&nbsp;if&nbsp;it&nbsp;was&nbsp;an&nbsp;HTML&nbsp;entity,</span><br>
<span class="lineno"></span><span class="comment" id="4192410">//&nbsp;its&nbsp;width&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;one.&nbsp;In&nbsp;all&nbsp;other&nbsp;cases,&nbsp;the&nbsp;width&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4192482">//&nbsp;unicode&nbsp;width&nbsp;of&nbsp;the&nbsp;text.</span><br>
<span class="lineno">410</span><span class="comment" id="4192512">//</span><br>
<span class="lineno"></span><span class="keyword" id="4192515">func</span>&nbsp;<span class="op" id="4192520">(</span><span class="ident" id="4192521">b</span>&nbsp;<span class="op" id="4192523">*</span><span class="ident" id="4192524">Writer</span><span class="op" id="4192530">)</span>&nbsp;<span class="ident" id="4192532">endEscape</span><span class="op" id="4192541">(</span><span class="op" id="4192542">)</span>&nbsp;<span class="op" id="4192544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192547">switch</span>&nbsp;<span class="ident" id="4192554">b</span><span class="op" id="4192555">.</span><span class="ident" id="4192556">endChar</span>&nbsp;<span class="op" id="4192564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192567">case</span>&nbsp;<span class="ident" id="4192572">Escape</span><span class="op" id="4192578">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192582">b</span><span class="op" id="4192583">.</span><span class="ident" id="4192584">updateWidth</span><span class="op" id="4192595">(</span><span class="op" id="4192596">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192600">if</span>&nbsp;<span class="ident" id="4192603">b</span><span class="op" id="4192604">.</span><span class="ident" id="4192605">flags</span><span class="op" id="4192610">&amp;</span><span class="ident" id="4192611">StripEscape</span>&nbsp;<span class="op" id="4192623">==</span>&nbsp;<span class="num" id="4192626">0</span>&nbsp;<span class="op" id="4192628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192633">b</span><span class="op" id="4192634">.</span><span class="ident" id="4192635">cell</span><span class="op" id="4192639">.</span><span class="ident" id="4192640">width</span>&nbsp;<span class="op" id="4192646">-=</span>&nbsp;<span class="num" id="4192649">2</span>&nbsp;<span class="comment" id="4192651">//&nbsp;don&#39;t&nbsp;count&nbsp;the&nbsp;Escape&nbsp;chars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192688">case</span>&nbsp;<span class="string" id="4192693">&#39;&gt;&#39;</span><span class="op" id="4192696">:</span>&nbsp;<span class="comment" id="4192698">//&nbsp;tag&nbsp;of&nbsp;zero&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4192720">case</span>&nbsp;<span class="string" id="4192725">&#39;;&#39;</span><span class="op" id="4192728">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192732">b</span><span class="op" id="4192733">.</span><span class="ident" id="4192734">cell</span><span class="op" id="4192738">.</span><span class="ident" id="4192739">width</span><span class="op" id="4192744">++</span>&nbsp;<span class="comment" id="4192747">//&nbsp;entity,&nbsp;count&nbsp;as&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4192777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192780">b</span><span class="op" id="4192781">.</span><span class="ident" id="4192782">pos</span>&nbsp;<span class="op" id="4192786">=</span>&nbsp;<span class="ident" id="4192788">b</span><span class="op" id="4192789">.</span><span class="ident" id="4192790">buf</span><span class="op" id="4192793">.</span><span class="ident" id="4192794">Len</span><span class="op" id="4192797">(</span><span class="op" id="4192798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4192801">b</span><span class="op" id="4192802">.</span><span class="ident" id="4192803">endChar</span>&nbsp;<span class="op" id="4192811">=</span>&nbsp;<span class="num" id="4192813">0</span><br>
<span class="lineno"></span><span class="op" id="4192815">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="comment" id="4192818">//&nbsp;Terminate&nbsp;the&nbsp;current&nbsp;cell&nbsp;by&nbsp;adding&nbsp;it&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;cells&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4192889">//&nbsp;current&nbsp;line.&nbsp;Returns&nbsp;the&nbsp;number&nbsp;of&nbsp;cells&nbsp;in&nbsp;that&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="4192948">//</span><br>
<span class="lineno"></span><span class="keyword" id="4192951">func</span>&nbsp;<span class="op" id="4192956">(</span><span class="ident" id="4192957">b</span>&nbsp;<span class="op" id="4192959">*</span><span class="ident" id="4192960">Writer</span><span class="op" id="4192966">)</span>&nbsp;<span class="ident" id="4192968">terminateCell</span><span class="op" id="4192981">(</span><span class="ident" id="4192982">htab</span>&nbsp;<span class="builtintype" id="4192987">bool</span><span class="op" id="4192991">)</span>&nbsp;<span class="builtintype" id="4192993">int</span>&nbsp;<span class="op" id="4192997">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193000">b</span><span class="op" id="4193001">.</span><span class="ident" id="4193002">cell</span><span class="op" id="4193006">.</span><span class="ident" id="4193007">htab</span>&nbsp;<span class="op" id="4193012">=</span>&nbsp;<span class="ident" id="4193014">htab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193020">line</span>&nbsp;<span class="op" id="4193025">:=</span>&nbsp;<span class="op" id="4193028">&amp;</span><span class="ident" id="4193029">b</span><span class="op" id="4193030">.</span><span class="ident" id="4193031">lines</span><span class="op" id="4193036">[</span><span class="builtinfunc" id="4193037">len</span><span class="op" id="4193040">(</span><span class="ident" id="4193041">b</span><span class="op" id="4193042">.</span><span class="ident" id="4193043">lines</span><span class="op" id="4193048">)</span><span class="op" id="4193049">-</span><span class="num" id="4193050">1</span><span class="op" id="4193051">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193054">*</span><span class="ident" id="4193055">line</span>&nbsp;<span class="op" id="4193060">=</span>&nbsp;<span class="builtinfunc" id="4193062">append</span><span class="op" id="4193068">(</span><span class="op" id="4193069">*</span><span class="ident" id="4193070">line</span><span class="op" id="4193074">,</span>&nbsp;<span class="ident" id="4193076">b</span><span class="op" id="4193077">.</span><span class="ident" id="4193078">cell</span><span class="op" id="4193082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193085">b</span><span class="op" id="4193086">.</span><span class="ident" id="4193087">cell</span>&nbsp;<span class="op" id="4193092">=</span>&nbsp;<span class="ident" id="4193094">cell</span><span class="op" id="4193098">{</span><span class="op" id="4193099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193102">return</span>&nbsp;<span class="builtinfunc" id="4193109">len</span><span class="op" id="4193112">(</span><span class="op" id="4193113">*</span><span class="ident" id="4193114">line</span><span class="op" id="4193118">)</span><br>
<span class="lineno">435</span><span class="op" id="4193120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4193123">func</span>&nbsp;<span class="ident" id="4193128">handlePanic</span><span class="op" id="4193139">(</span><span class="ident" id="4193140">err</span>&nbsp;<span class="op" id="4193144">*</span><span class="builtintype" id="4193145">error</span><span class="op" id="4193150">,</span>&nbsp;<span class="ident" id="4193152">op</span>&nbsp;<span class="builtintype" id="4193155">string</span><span class="op" id="4193161">)</span>&nbsp;<span class="op" id="4193163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193166">if</span>&nbsp;<span class="ident" id="4193169">e</span>&nbsp;<span class="op" id="4193171">:=</span>&nbsp;<span class="builtinfunc" id="4193174">recover</span><span class="op" id="4193181">(</span><span class="op" id="4193182">)</span><span class="op" id="4193183">;</span>&nbsp;<span class="ident" id="4193185">e</span>&nbsp;<span class="op" id="4193187">!=</span>&nbsp;<span class="ident" id="4193190">nil</span>&nbsp;<span class="op" id="4193194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193198">if</span>&nbsp;<span class="ident" id="4193201">nerr</span><span class="op" id="4193205">,</span>&nbsp;<span class="ident" id="4193207">ok</span>&nbsp;<span class="op" id="4193210">:=</span>&nbsp;<span class="ident" id="4193213">e</span><span class="op" id="4193214">.</span><span class="op" id="4193215">(</span><span class="ident" id="4193216">osError</span><span class="op" id="4193223">)</span><span class="op" id="4193224">;</span>&nbsp;<span class="ident" id="4193226">ok</span>&nbsp;<span class="op" id="4193229">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193234">*</span><span class="ident" id="4193235">err</span>&nbsp;<span class="op" id="4193239">=</span>&nbsp;<span class="ident" id="4193241">nerr</span><span class="op" id="4193245">.</span><span class="ident" id="4193246">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193253">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4193266">panic</span><span class="op" id="4193271">(</span><span class="string" id="4193272">&#34;tabwriter:&nbsp;panic&nbsp;during&nbsp;&#34;</span>&nbsp;<span class="op" id="4193299">+</span>&nbsp;<span class="ident" id="4193301">op</span><span class="op" id="4193303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193306">}</span><br>
<span class="lineno">445</span><span class="op" id="4193308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4193311">//&nbsp;Flush&nbsp;should&nbsp;be&nbsp;called&nbsp;after&nbsp;the&nbsp;last&nbsp;call&nbsp;to&nbsp;Write&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="4193376">//&nbsp;that&nbsp;any&nbsp;data&nbsp;buffered&nbsp;in&nbsp;the&nbsp;Writer&nbsp;is&nbsp;written&nbsp;to&nbsp;output.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="4193442">//&nbsp;incomplete&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;end&nbsp;is&nbsp;considered</span><br>
<span class="lineno">450</span><span class="comment" id="4193497">//&nbsp;complete&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4193534">//</span><br>
<span class="lineno"></span><span class="keyword" id="4193537">func</span>&nbsp;<span class="op" id="4193542">(</span><span class="ident" id="4193543">b</span>&nbsp;<span class="op" id="4193545">*</span><span class="ident" id="4193546">Writer</span><span class="op" id="4193552">)</span>&nbsp;<span class="ident" id="4193554">Flush</span><span class="op" id="4193559">(</span><span class="op" id="4193560">)</span>&nbsp;<span class="op" id="4193562">(</span><span class="ident" id="4193563">err</span>&nbsp;<span class="builtintype" id="4193567">error</span><span class="op" id="4193572">)</span>&nbsp;<span class="op" id="4193574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193577">defer</span>&nbsp;<span class="ident" id="4193583">b</span><span class="op" id="4193584">.</span><span class="ident" id="4193585">reset</span><span class="op" id="4193590">(</span><span class="op" id="4193591">)</span>&nbsp;<span class="comment" id="4193593">//&nbsp;even&nbsp;in&nbsp;the&nbsp;presence&nbsp;of&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193628">defer</span>&nbsp;<span class="ident" id="4193634">handlePanic</span><span class="op" id="4193645">(</span><span class="op" id="4193646">&amp;</span><span class="ident" id="4193647">err</span><span class="op" id="4193650">,</span>&nbsp;<span class="string" id="4193652">&#34;Flush&#34;</span><span class="op" id="4193659">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4193663">//&nbsp;add&nbsp;current&nbsp;cell&nbsp;if&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193697">if</span>&nbsp;<span class="ident" id="4193700">b</span><span class="op" id="4193701">.</span><span class="ident" id="4193702">cell</span><span class="op" id="4193706">.</span><span class="ident" id="4193707">size</span>&nbsp;<span class="op" id="4193712">&gt;</span>&nbsp;<span class="num" id="4193714">0</span>&nbsp;<span class="op" id="4193716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193720">if</span>&nbsp;<span class="ident" id="4193723">b</span><span class="op" id="4193724">.</span><span class="ident" id="4193725">endChar</span>&nbsp;<span class="op" id="4193733">!=</span>&nbsp;<span class="num" id="4193736">0</span>&nbsp;<span class="op" id="4193738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4193743">//&nbsp;inside&nbsp;escape&nbsp;-&nbsp;terminate&nbsp;it&nbsp;even&nbsp;if&nbsp;incomplete</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193797">b</span><span class="op" id="4193798">.</span><span class="ident" id="4193799">endEscape</span><span class="op" id="4193808">(</span><span class="op" id="4193809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193817">b</span><span class="op" id="4193818">.</span><span class="ident" id="4193819">terminateCell</span><span class="op" id="4193832">(</span><span class="builtintype" id="4193833">false</span><span class="op" id="4193838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4193841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4193845">//&nbsp;format&nbsp;contents&nbsp;of&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4193875">b</span><span class="op" id="4193876">.</span><span class="ident" id="4193877">format</span><span class="op" id="4193883">(</span><span class="num" id="4193884">0</span><span class="op" id="4193885">,</span>&nbsp;<span class="num" id="4193887">0</span><span class="op" id="4193888">,</span>&nbsp;<span class="builtinfunc" id="4193890">len</span><span class="op" id="4193893">(</span><span class="ident" id="4193894">b</span><span class="op" id="4193895">.</span><span class="ident" id="4193896">lines</span><span class="op" id="4193901">)</span><span class="op" id="4193902">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4193906">return</span><br>
<span class="lineno"></span><span class="op" id="4193913">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="4193916">var</span>&nbsp;<span class="ident" id="4193920">hbar</span>&nbsp;<span class="op" id="4193925">=</span>&nbsp;<span class="op" id="4193927">[</span><span class="op" id="4193928">]</span><span class="builtintype" id="4193929">byte</span><span class="op" id="4193933">(</span><span class="string" id="4193934">&#34;---\n&#34;</span><span class="op" id="4193941">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4193944">//&nbsp;Write&nbsp;writes&nbsp;buf&nbsp;to&nbsp;the&nbsp;writer&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="4193981">//&nbsp;The&nbsp;only&nbsp;errors&nbsp;returned&nbsp;are&nbsp;ones&nbsp;encountered</span><br>
<span class="lineno">475</span><span class="comment" id="4194030">//&nbsp;while&nbsp;writing&nbsp;to&nbsp;the&nbsp;underlying&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="4194080">//</span><br>
<span class="lineno"></span><span class="keyword" id="4194083">func</span>&nbsp;<span class="op" id="4194088">(</span><span class="ident" id="4194089">b</span>&nbsp;<span class="op" id="4194091">*</span><span class="ident" id="4194092">Writer</span><span class="op" id="4194098">)</span>&nbsp;<span class="ident" id="4194100">Write</span><span class="op" id="4194105">(</span><span class="ident" id="4194106">buf</span>&nbsp;<span class="op" id="4194110">[</span><span class="op" id="4194111">]</span><span class="builtintype" id="4194112">byte</span><span class="op" id="4194116">)</span>&nbsp;<span class="op" id="4194118">(</span><span class="ident" id="4194119">n</span>&nbsp;<span class="builtintype" id="4194121">int</span><span class="op" id="4194124">,</span>&nbsp;<span class="ident" id="4194126">err</span>&nbsp;<span class="builtintype" id="4194130">error</span><span class="op" id="4194135">)</span>&nbsp;<span class="op" id="4194137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194140">defer</span>&nbsp;<span class="ident" id="4194146">handlePanic</span><span class="op" id="4194157">(</span><span class="op" id="4194158">&amp;</span><span class="ident" id="4194159">err</span><span class="op" id="4194162">,</span>&nbsp;<span class="string" id="4194164">&#34;Write&#34;</span><span class="op" id="4194171">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194175">//&nbsp;split&nbsp;text&nbsp;into&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4194201">n</span>&nbsp;<span class="op" id="4194203">=</span>&nbsp;<span class="num" id="4194205">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194208">for</span>&nbsp;<span class="ident" id="4194212">i</span><span class="op" id="4194213">,</span>&nbsp;<span class="ident" id="4194215">ch</span>&nbsp;<span class="op" id="4194218">:=</span>&nbsp;<span class="keyword" id="4194221">range</span>&nbsp;<span class="ident" id="4194227">buf</span>&nbsp;<span class="op" id="4194231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194235">if</span>&nbsp;<span class="ident" id="4194238">b</span><span class="op" id="4194239">.</span><span class="ident" id="4194240">endChar</span>&nbsp;<span class="op" id="4194248">==</span>&nbsp;<span class="num" id="4194251">0</span>&nbsp;<span class="op" id="4194253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194258">//&nbsp;outside&nbsp;escape</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194279">switch</span>&nbsp;<span class="ident" id="4194286">ch</span>&nbsp;<span class="op" id="4194289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194294">case</span>&nbsp;<span class="string" id="4194299">&#39;\t&#39;</span><span class="op" id="4194303">,</span>&nbsp;<span class="string" id="4194305">&#39;\v&#39;</span><span class="op" id="4194309">,</span>&nbsp;<span class="string" id="4194311">&#39;\n&#39;</span><span class="op" id="4194315">,</span>&nbsp;<span class="string" id="4194317">&#39;\f&#39;</span><span class="op" id="4194321">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194327">//&nbsp;end&nbsp;of&nbsp;cell</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4194346">b</span><span class="op" id="4194347">.</span><span class="builtinfunc" id="4194348">append</span><span class="op" id="4194354">(</span><span class="ident" id="4194355">buf</span><span class="op" id="4194358">[</span><span class="ident" id="4194359">n</span><span class="op" id="4194360">:</span><span class="ident" id="4194361">i</span><span class="op" id="4194362">]</span><span class="op" id="4194363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4194369">b</span><span class="op" id="4194370">.</span><span class="ident" id="4194371">updateWidth</span><span class="op" id="4194382">(</span><span class="op" id="4194383">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4194389">n</span>&nbsp;<span class="op" id="4194391">=</span>&nbsp;<span class="ident" id="4194393">i</span>&nbsp;<span class="op" id="4194395">+</span>&nbsp;<span class="num" id="4194397">1</span>&nbsp;<span class="comment" id="4194399">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4194418">ncells</span>&nbsp;<span class="op" id="4194425">:=</span>&nbsp;<span class="ident" id="4194428">b</span><span class="op" id="4194429">.</span><span class="ident" id="4194430">terminateCell</span><span class="op" id="4194443">(</span><span class="ident" id="4194444">ch</span>&nbsp;<span class="op" id="4194447">==</span>&nbsp;<span class="string" id="4194450">&#39;\t&#39;</span><span class="op" id="4194454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194460">if</span>&nbsp;<span class="ident" id="4194463">ch</span>&nbsp;<span class="op" id="4194466">==</span>&nbsp;<span class="string" id="4194469">&#39;\n&#39;</span>&nbsp;<span class="op" id="4194474">||</span>&nbsp;<span class="ident" id="4194477">ch</span>&nbsp;<span class="op" id="4194480">==</span>&nbsp;<span class="string" id="4194483">&#39;\f&#39;</span>&nbsp;<span class="op" id="4194488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194495">//&nbsp;terminate&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4194518">b</span><span class="op" id="4194519">.</span><span class="ident" id="4194520">addLine</span><span class="op" id="4194527">(</span><span class="op" id="4194528">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194535">if</span>&nbsp;<span class="ident" id="4194538">ch</span>&nbsp;<span class="op" id="4194541">==</span>&nbsp;<span class="string" id="4194544">&#39;\f&#39;</span>&nbsp;<span class="op" id="4194549">||</span>&nbsp;<span class="ident" id="4194552">ncells</span>&nbsp;<span class="op" id="4194559">==</span>&nbsp;<span class="num" id="4194562">1</span>&nbsp;<span class="op" id="4194564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194572">//&nbsp;A&nbsp;&#39;\f&#39;&nbsp;always&nbsp;forces&nbsp;a&nbsp;flush.&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;previous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194638">//&nbsp;line&nbsp;has&nbsp;only&nbsp;one&nbsp;cell&nbsp;which&nbsp;does&nbsp;not&nbsp;have&nbsp;an&nbsp;impact&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194703">//&nbsp;the&nbsp;formatting&nbsp;of&nbsp;the&nbsp;following&nbsp;lines&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194769">//&nbsp;line&nbsp;is&nbsp;ignored&nbsp;by&nbsp;format()),&nbsp;thus&nbsp;we&nbsp;can&nbsp;flush&nbsp;the</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194830">//&nbsp;Writer&nbsp;contents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194856">if</span>&nbsp;<span class="ident" id="4194859">err</span>&nbsp;<span class="op" id="4194863">=</span>&nbsp;<span class="ident" id="4194865">b</span><span class="op" id="4194866">.</span><span class="ident" id="4194867">Flush</span><span class="op" id="4194872">(</span><span class="op" id="4194873">)</span><span class="op" id="4194874">;</span>&nbsp;<span class="ident" id="4194876">err</span>&nbsp;<span class="op" id="4194880">!=</span>&nbsp;<span class="ident" id="4194883">nil</span>&nbsp;<span class="op" id="4194887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194896">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4194909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4194917">if</span>&nbsp;<span class="ident" id="4194920">ch</span>&nbsp;<span class="op" id="4194923">==</span>&nbsp;<span class="string" id="4194926">&#39;\f&#39;</span>&nbsp;<span class="op" id="4194931">&amp;&amp;</span>&nbsp;<span class="ident" id="4194934">b</span><span class="op" id="4194935">.</span><span class="ident" id="4194936">flags</span><span class="op" id="4194941">&amp;</span><span class="ident" id="4194942">Debug</span>&nbsp;<span class="op" id="4194948">!=</span>&nbsp;<span class="num" id="4194951">0</span>&nbsp;<span class="op" id="4194953">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4194962">//&nbsp;indicate&nbsp;section&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4194995">b</span><span class="op" id="4194996">.</span><span class="ident" id="4194997">write0</span><span class="op" id="4195003">(</span><span class="ident" id="4195004">hbar</span><span class="op" id="4195008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195029">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195035">case</span>&nbsp;<span class="ident" id="4195040">Escape</span><span class="op" id="4195046">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4195052">//&nbsp;start&nbsp;of&nbsp;escaped&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195085">b</span><span class="op" id="4195086">.</span><span class="builtinfunc" id="4195087">append</span><span class="op" id="4195093">(</span><span class="ident" id="4195094">buf</span><span class="op" id="4195097">[</span><span class="ident" id="4195098">n</span><span class="op" id="4195099">:</span><span class="ident" id="4195100">i</span><span class="op" id="4195101">]</span><span class="op" id="4195102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195108">b</span><span class="op" id="4195109">.</span><span class="ident" id="4195110">updateWidth</span><span class="op" id="4195121">(</span><span class="op" id="4195122">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195128">n</span>&nbsp;<span class="op" id="4195130">=</span>&nbsp;<span class="ident" id="4195132">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195138">if</span>&nbsp;<span class="ident" id="4195141">b</span><span class="op" id="4195142">.</span><span class="ident" id="4195143">flags</span><span class="op" id="4195148">&amp;</span><span class="ident" id="4195149">StripEscape</span>&nbsp;<span class="op" id="4195161">!=</span>&nbsp;<span class="num" id="4195164">0</span>&nbsp;<span class="op" id="4195166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195173">n</span><span class="op" id="4195174">++</span>&nbsp;<span class="comment" id="4195177">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195203">b</span><span class="op" id="4195204">.</span><span class="ident" id="4195205">startEscape</span><span class="op" id="4195216">(</span><span class="ident" id="4195217">Escape</span><span class="op" id="4195223">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195229">case</span>&nbsp;<span class="string" id="4195234">&#39;&lt;&#39;</span><span class="op" id="4195237">,</span>&nbsp;<span class="string" id="4195239">&#39;&amp;&#39;</span><span class="op" id="4195242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4195248">//&nbsp;possibly&nbsp;an&nbsp;html&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195283">if</span>&nbsp;<span class="ident" id="4195286">b</span><span class="op" id="4195287">.</span><span class="ident" id="4195288">flags</span><span class="op" id="4195293">&amp;</span><span class="ident" id="4195294">FilterHTML</span>&nbsp;<span class="op" id="4195305">!=</span>&nbsp;<span class="num" id="4195308">0</span>&nbsp;<span class="op" id="4195310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4195317">//&nbsp;begin&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195345">b</span><span class="op" id="4195346">.</span><span class="builtinfunc" id="4195347">append</span><span class="op" id="4195353">(</span><span class="ident" id="4195354">buf</span><span class="op" id="4195357">[</span><span class="ident" id="4195358">n</span><span class="op" id="4195359">:</span><span class="ident" id="4195360">i</span><span class="op" id="4195361">]</span><span class="op" id="4195362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195369">b</span><span class="op" id="4195370">.</span><span class="ident" id="4195371">updateWidth</span><span class="op" id="4195382">(</span><span class="op" id="4195383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195390">n</span>&nbsp;<span class="op" id="4195392">=</span>&nbsp;<span class="ident" id="4195394">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195401">b</span><span class="op" id="4195402">.</span><span class="ident" id="4195403">startEscape</span><span class="op" id="4195414">(</span><span class="ident" id="4195415">ch</span><span class="op" id="4195417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195423">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195433">}</span>&nbsp;<span class="keyword" id="4195435">else</span>&nbsp;<span class="op" id="4195440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4195445">//&nbsp;inside&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195465">if</span>&nbsp;<span class="ident" id="4195468">ch</span>&nbsp;<span class="op" id="4195471">==</span>&nbsp;<span class="ident" id="4195474">b</span><span class="op" id="4195475">.</span><span class="ident" id="4195476">endChar</span>&nbsp;<span class="op" id="4195484">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4195490">//&nbsp;end&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195515">j</span>&nbsp;<span class="op" id="4195517">:=</span>&nbsp;<span class="ident" id="4195520">i</span>&nbsp;<span class="op" id="4195522">+</span>&nbsp;<span class="num" id="4195524">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195530">if</span>&nbsp;<span class="ident" id="4195533">ch</span>&nbsp;<span class="op" id="4195536">==</span>&nbsp;<span class="ident" id="4195539">Escape</span>&nbsp;<span class="op" id="4195546">&amp;&amp;</span>&nbsp;<span class="ident" id="4195549">b</span><span class="op" id="4195550">.</span><span class="ident" id="4195551">flags</span><span class="op" id="4195556">&amp;</span><span class="ident" id="4195557">StripEscape</span>&nbsp;<span class="op" id="4195569">!=</span>&nbsp;<span class="num" id="4195572">0</span>&nbsp;<span class="op" id="4195574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195581">j</span>&nbsp;<span class="op" id="4195583">=</span>&nbsp;<span class="ident" id="4195585">i</span>&nbsp;<span class="comment" id="4195587">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195607">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195613">b</span><span class="op" id="4195614">.</span><span class="builtinfunc" id="4195615">append</span><span class="op" id="4195621">(</span><span class="ident" id="4195622">buf</span><span class="op" id="4195625">[</span><span class="ident" id="4195626">n</span><span class="op" id="4195627">:</span><span class="ident" id="4195628">j</span><span class="op" id="4195629">]</span><span class="op" id="4195630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195636">n</span>&nbsp;<span class="op" id="4195638">=</span>&nbsp;<span class="ident" id="4195640">i</span>&nbsp;<span class="op" id="4195642">+</span>&nbsp;<span class="num" id="4195644">1</span>&nbsp;<span class="comment" id="4195646">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195665">b</span><span class="op" id="4195666">.</span><span class="ident" id="4195667">endEscape</span><span class="op" id="4195676">(</span><span class="op" id="4195677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195686">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4195689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4195693">//&nbsp;append&nbsp;leftover&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195718">b</span><span class="op" id="4195719">.</span><span class="builtinfunc" id="4195720">append</span><span class="op" id="4195726">(</span><span class="ident" id="4195727">buf</span><span class="op" id="4195730">[</span><span class="ident" id="4195731">n</span><span class="op" id="4195732">:</span><span class="op" id="4195733">]</span><span class="op" id="4195734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4195737">n</span>&nbsp;<span class="op" id="4195739">=</span>&nbsp;<span class="builtinfunc" id="4195741">len</span><span class="op" id="4195744">(</span><span class="ident" id="4195745">buf</span><span class="op" id="4195748">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195751">return</span><br>
<span class="lineno"></span><span class="op" id="4195758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4195761">//&nbsp;NewWriter&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;tabwriter.Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4195824">//&nbsp;The&nbsp;parameters&nbsp;are&nbsp;the&nbsp;same&nbsp;as&nbsp;for&nbsp;the&nbsp;Init&nbsp;function.</span><br>
<span class="lineno">555</span><span class="comment" id="4195881">//</span><br>
<span class="lineno"></span><span class="keyword" id="4195884">func</span>&nbsp;<span class="ident" id="4195889">NewWriter</span><span class="op" id="4195898">(</span><span class="ident" id="4195899">output</span>&nbsp;<span class="ident" id="4195906">io</span><span class="op" id="4195908">.</span><span class="ident" id="4195909">Writer</span><span class="op" id="4195915">,</span>&nbsp;<span class="ident" id="4195917">minwidth</span><span class="op" id="4195925">,</span>&nbsp;<span class="ident" id="4195927">tabwidth</span><span class="op" id="4195935">,</span>&nbsp;<span class="ident" id="4195937">padding</span>&nbsp;<span class="builtintype" id="4195945">int</span><span class="op" id="4195948">,</span>&nbsp;<span class="ident" id="4195950">padchar</span>&nbsp;<span class="builtintype" id="4195958">byte</span><span class="op" id="4195962">,</span>&nbsp;<span class="ident" id="4195964">flags</span>&nbsp;<span class="builtintype" id="4195970">uint</span><span class="op" id="4195974">)</span>&nbsp;<span class="op" id="4195976">*</span><span class="ident" id="4195977">Writer</span>&nbsp;<span class="op" id="4195984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4195987">return</span>&nbsp;<span class="builtinfunc" id="4195994">new</span><span class="op" id="4195997">(</span><span class="ident" id="4195998">Writer</span><span class="op" id="4196004">)</span><span class="op" id="4196005">.</span><span class="ident" id="4196006">Init</span><span class="op" id="4196010">(</span><span class="ident" id="4196011">output</span><span class="op" id="4196017">,</span>&nbsp;<span class="ident" id="4196019">minwidth</span><span class="op" id="4196027">,</span>&nbsp;<span class="ident" id="4196029">tabwidth</span><span class="op" id="4196037">,</span>&nbsp;<span class="ident" id="4196039">padding</span><span class="op" id="4196046">,</span>&nbsp;<span class="ident" id="4196048">padchar</span><span class="op" id="4196055">,</span>&nbsp;<span class="ident" id="4196057">flags</span><span class="op" id="4196062">)</span><br>
<span class="lineno"></span><span class="op" id="4196064">}</span>
</div>
</body>
</html>
