<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3587298">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3587353">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3587407">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3587458">//&nbsp;+build&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3587521">package</span>&nbsp;<span class="ident" id="3587529">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3587535">import</span>&nbsp;<span class="string" id="3587542">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="3587555">//&nbsp;Possible&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;finding&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="3587610">var</span>&nbsp;<span class="ident" id="3587614">certFiles</span>&nbsp;<span class="op" id="3587624">=</span>&nbsp;<span class="op" id="3587626">[</span><span class="op" id="3587627">]</span><span class="builtintype" id="3587628">string</span><span class="op" id="3587634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3587637">&#34;/etc/ssl/certs/ca-certificates.crt&#34;</span><span class="op" id="3587673">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3587679">//&nbsp;Debian/Ubuntu/Gentoo&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3587709">&#34;/etc/pki/tls/certs/ca-bundle.crt&#34;</span><span class="op" id="3587743">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3587751">//&nbsp;Fedora/RHEL</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3587767">&#34;/etc/ssl/ca-bundle.pem&#34;</span><span class="op" id="3587791">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3587809">//&nbsp;OpenSUSE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3587822">&#34;/etc/ssl/cert.pem&#34;</span><span class="op" id="3587841">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3587864">//&nbsp;OpenBSD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3587876">&#34;/usr/local/share/certs/ca-root-nss.crt&#34;</span><span class="op" id="3587916">,</span>&nbsp;<span class="comment" id="3587918">//&nbsp;FreeBSD/DragonFly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3587940">&#34;/etc/pki/tls/cacert.pem&#34;</span><span class="op" id="3587965">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3587982">//&nbsp;OpenELEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3587995">&#34;/etc/certs/ca-certificates.crt&#34;</span><span class="op" id="3588027">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3588037">//&nbsp;Solaris&nbsp;11.2+</span><br>
<span class="lineno">20</span><span class="op" id="3588054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3588057">//&nbsp;Possible&nbsp;directories&nbsp;with&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;successfully</span><br>
<span class="lineno"></span><span class="comment" id="3588129">//&nbsp;reading&nbsp;at&nbsp;least&nbsp;one&nbsp;file&nbsp;from&nbsp;a&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="3588176">var</span>&nbsp;<span class="ident" id="3588180">certDirectories</span>&nbsp;<span class="op" id="3588196">=</span>&nbsp;<span class="op" id="3588198">[</span><span class="op" id="3588199">]</span><span class="builtintype" id="3588200">string</span><span class="op" id="3588206">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3588209">&#34;/system/etc/security/cacerts&#34;</span><span class="op" id="3588239">,</span>&nbsp;<span class="comment" id="3588241">//&nbsp;Android</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="3588253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3588256">func</span>&nbsp;<span class="op" id="3588261">(</span><span class="ident" id="3588262">c</span>&nbsp;<span class="op" id="3588264">*</span><span class="ident" id="3588265">Certificate</span><span class="op" id="3588276">)</span>&nbsp;<span class="ident" id="3588278">systemVerify</span><span class="op" id="3588290">(</span><span class="ident" id="3588291">opts</span>&nbsp;<span class="op" id="3588296">*</span><span class="ident" id="3588297">VerifyOptions</span><span class="op" id="3588310">)</span>&nbsp;<span class="op" id="3588312">(</span><span class="ident" id="3588313">chains</span>&nbsp;<span class="op" id="3588320">[</span><span class="op" id="3588321">]</span><span class="op" id="3588322">[</span><span class="op" id="3588323">]</span><span class="op" id="3588324">*</span><span class="ident" id="3588325">Certificate</span><span class="op" id="3588336">,</span>&nbsp;<span class="ident" id="3588338">err</span>&nbsp;<span class="builtintype" id="3588342">error</span><span class="op" id="3588347">)</span>&nbsp;<span class="op" id="3588349">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588352">return</span>&nbsp;<span class="ident" id="3588359">nil</span><span class="op" id="3588362">,</span>&nbsp;<span class="ident" id="3588364">nil</span><br>
<span class="lineno"></span><span class="op" id="3588368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3588371">func</span>&nbsp;<span class="ident" id="3588376">initSystemRoots</span><span class="op" id="3588391">(</span><span class="op" id="3588392">)</span>&nbsp;<span class="op" id="3588394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3588397">roots</span>&nbsp;<span class="op" id="3588403">:=</span>&nbsp;<span class="ident" id="3588406">NewCertPool</span><span class="op" id="3588417">(</span><span class="op" id="3588418">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588421">for</span>&nbsp;<span class="ident" id="3588425">_</span><span class="op" id="3588426">,</span>&nbsp;<span class="ident" id="3588428">file</span>&nbsp;<span class="op" id="3588433">:=</span>&nbsp;<span class="keyword" id="3588436">range</span>&nbsp;<span class="ident" id="3588442">certFiles</span>&nbsp;<span class="op" id="3588452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3588456">data</span><span class="op" id="3588460">,</span>&nbsp;<span class="ident" id="3588462">err</span>&nbsp;<span class="op" id="3588466">:=</span>&nbsp;<span class="ident" id="3588469">ioutil</span><span class="op" id="3588475">.</span><span class="ident" id="3588476">ReadFile</span><span class="op" id="3588484">(</span><span class="ident" id="3588485">file</span><span class="op" id="3588489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588493">if</span>&nbsp;<span class="ident" id="3588496">err</span>&nbsp;<span class="op" id="3588500">==</span>&nbsp;<span class="ident" id="3588503">nil</span>&nbsp;<span class="op" id="3588507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3588512">roots</span><span class="op" id="3588517">.</span><span class="ident" id="3588518">AppendCertsFromPEM</span><span class="op" id="3588536">(</span><span class="ident" id="3588537">data</span><span class="op" id="3588541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3588546">systemRoots</span>&nbsp;<span class="op" id="3588558">=</span>&nbsp;<span class="ident" id="3588560">roots</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588569">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3588578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3588581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588585">for</span>&nbsp;<span class="ident" id="3588589">_</span><span class="op" id="3588590">,</span>&nbsp;<span class="ident" id="3588592">directory</span>&nbsp;<span class="op" id="3588602">:=</span>&nbsp;<span class="keyword" id="3588605">range</span>&nbsp;<span class="ident" id="3588611">certDirectories</span>&nbsp;<span class="op" id="3588627">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3588631">fis</span><span class="op" id="3588634">,</span>&nbsp;<span class="ident" id="3588636">err</span>&nbsp;<span class="op" id="3588640">:=</span>&nbsp;<span class="ident" id="3588643">ioutil</span><span class="op" id="3588649">.</span><span class="ident" id="3588650">ReadDir</span><span class="op" id="3588657">(</span><span class="ident" id="3588658">directory</span><span class="op" id="3588667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588671">if</span>&nbsp;<span class="ident" id="3588674">err</span>&nbsp;<span class="op" id="3588678">!=</span>&nbsp;<span class="ident" id="3588681">nil</span>&nbsp;<span class="op" id="3588685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588690">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3588701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3588705">rootsAdded</span>&nbsp;<span class="op" id="3588716">:=</span>&nbsp;<span class="builtintype" id="3588719">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588727">for</span>&nbsp;<span class="ident" id="3588731">_</span><span class="op" id="3588732">,</span>&nbsp;<span class="ident" id="3588734">fi</span>&nbsp;<span class="op" id="3588737">:=</span>&nbsp;<span class="keyword" id="3588740">range</span>&nbsp;<span class="ident" id="3588746">fis</span>&nbsp;<span class="op" id="3588750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3588755">data</span><span class="op" id="3588759">,</span>&nbsp;<span class="ident" id="3588761">err</span>&nbsp;<span class="op" id="3588765">:=</span>&nbsp;<span class="ident" id="3588768">ioutil</span><span class="op" id="3588774">.</span><span class="ident" id="3588775">ReadFile</span><span class="op" id="3588783">(</span><span class="ident" id="3588784">directory</span>&nbsp;<span class="op" id="3588794">+</span>&nbsp;<span class="string" id="3588796">&#34;/&#34;</span>&nbsp;<span class="op" id="3588800">+</span>&nbsp;<span class="ident" id="3588802">fi</span><span class="op" id="3588804">.</span><span class="ident" id="3588805">Name</span><span class="op" id="3588809">(</span><span class="op" id="3588810">)</span><span class="op" id="3588811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588816">if</span>&nbsp;<span class="ident" id="3588819">err</span>&nbsp;<span class="op" id="3588823">==</span>&nbsp;<span class="ident" id="3588826">nil</span>&nbsp;<span class="op" id="3588830">&amp;&amp;</span>&nbsp;<span class="ident" id="3588833">roots</span><span class="op" id="3588838">.</span><span class="ident" id="3588839">AppendCertsFromPEM</span><span class="op" id="3588857">(</span><span class="ident" id="3588858">data</span><span class="op" id="3588862">)</span>&nbsp;<span class="op" id="3588864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3588870">rootsAdded</span>&nbsp;<span class="op" id="3588881">=</span>&nbsp;<span class="builtintype" id="3588883">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3588891">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3588895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588899">if</span>&nbsp;<span class="ident" id="3588902">rootsAdded</span>&nbsp;<span class="op" id="3588913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3588918">systemRoots</span>&nbsp;<span class="op" id="3588930">=</span>&nbsp;<span class="ident" id="3588932">roots</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3588941">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3588950">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3588953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3588957">//&nbsp;All&nbsp;of&nbsp;the&nbsp;files&nbsp;failed&nbsp;to&nbsp;load.&nbsp;systemRoots&nbsp;will&nbsp;be&nbsp;nil&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3589029">//&nbsp;trigger&nbsp;a&nbsp;specific&nbsp;error&nbsp;at&nbsp;verification&nbsp;time.</span><br>
<span class="lineno"></span><span class="op" id="3589079">}</span>
</div>
</body>
</html>
