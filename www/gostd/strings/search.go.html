<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html" class="current">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2346813">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2346868">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2346922">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2346973">package</span>&nbsp;<span class="ident" id="2346981">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2346990">//&nbsp;stringFinder&nbsp;efficiently&nbsp;finds&nbsp;strings&nbsp;in&nbsp;a&nbsp;source&nbsp;text.&nbsp;It&#39;s&nbsp;implemented</span><br>
<span class="lineno"></span><span class="comment" id="2347067">//&nbsp;using&nbsp;the&nbsp;Boyer-Moore&nbsp;string&nbsp;search&nbsp;algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2347117">//&nbsp;http://en.wikipedia.org/wiki/Boyer-Moore_string_search_algorithm</span><br>
<span class="lineno">10</span><span class="comment" id="2347185">//&nbsp;http://www.cs.utexas.edu/~moore/publications/fstrpos.pdf&nbsp;(note:&nbsp;this&nbsp;aged</span><br>
<span class="lineno"></span><span class="comment" id="2347262">//&nbsp;document&nbsp;uses&nbsp;1-based&nbsp;indexing)</span><br>
<span class="lineno"></span><span class="keyword" id="2347297">type</span>&nbsp;<span class="ident" id="2347302">stringFinder</span>&nbsp;<span class="keyword" id="2347315">struct</span>&nbsp;<span class="op" id="2347322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2347325">//&nbsp;pattern&nbsp;is&nbsp;the&nbsp;string&nbsp;that&nbsp;we&nbsp;are&nbsp;searching&nbsp;for&nbsp;in&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2347390">pattern</span>&nbsp;<span class="builtintype" id="2347398">string</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2347407">//&nbsp;badCharSkip[b]&nbsp;contains&nbsp;the&nbsp;distance&nbsp;between&nbsp;the&nbsp;last&nbsp;byte&nbsp;of&nbsp;pattern</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2347481">//&nbsp;and&nbsp;the&nbsp;rightmost&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;pattern.&nbsp;If&nbsp;b&nbsp;is&nbsp;not&nbsp;in&nbsp;pattern,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2347555">//&nbsp;badCharSkip[b]&nbsp;is&nbsp;len(pattern).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2347591">//</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2347595">//&nbsp;Whenever&nbsp;a&nbsp;mismatch&nbsp;is&nbsp;found&nbsp;with&nbsp;byte&nbsp;b&nbsp;in&nbsp;the&nbsp;text,&nbsp;we&nbsp;can&nbsp;safely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2347667">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;at&nbsp;least&nbsp;badCharSkip[b]&nbsp;until&nbsp;the&nbsp;next&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2347740">//&nbsp;the&nbsp;matching&nbsp;char&nbsp;could&nbsp;be&nbsp;in&nbsp;alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2347785">badCharSkip</span>&nbsp;<span class="op" id="2347797">[</span><span class="num" id="2347798">256</span><span class="op" id="2347801">]</span><span class="builtintype" id="2347802">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2347808">//&nbsp;goodSuffixSkip[i]&nbsp;defines&nbsp;how&nbsp;far&nbsp;we&nbsp;can&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2347884">//&nbsp;that&nbsp;the&nbsp;suffix&nbsp;pattern[i+1:]&nbsp;matches,&nbsp;but&nbsp;the&nbsp;byte&nbsp;pattern[i]&nbsp;does</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2347956">//&nbsp;not.&nbsp;There&nbsp;are&nbsp;two&nbsp;cases&nbsp;to&nbsp;consider:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2347998">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348002">//&nbsp;1.&nbsp;The&nbsp;matched&nbsp;suffix&nbsp;occurs&nbsp;elsewhere&nbsp;in&nbsp;pattern&nbsp;(with&nbsp;a&nbsp;different</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348074">//&nbsp;byte&nbsp;preceding&nbsp;it&nbsp;that&nbsp;we&nbsp;might&nbsp;possibly&nbsp;match).&nbsp;In&nbsp;this&nbsp;case,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348148">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;to&nbsp;align&nbsp;with&nbsp;the&nbsp;next&nbsp;suffix&nbsp;chunk.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348218">//&nbsp;example,&nbsp;the&nbsp;pattern&nbsp;&#34;mississi&#34;&nbsp;has&nbsp;the&nbsp;suffix&nbsp;&#34;issi&#34;&nbsp;next&nbsp;occurring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348291">//&nbsp;(in&nbsp;right-to-left&nbsp;order)&nbsp;at&nbsp;index&nbsp;1,&nbsp;so&nbsp;goodSuffixSkip[3]&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348356">//&nbsp;shift+len(suffix)&nbsp;==&nbsp;3+4&nbsp;==&nbsp;7.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348391">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348395">//&nbsp;2.&nbsp;If&nbsp;the&nbsp;matched&nbsp;suffix&nbsp;does&nbsp;not&nbsp;occur&nbsp;elsewhere&nbsp;in&nbsp;pattern,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348470">//&nbsp;matching&nbsp;frame&nbsp;may&nbsp;share&nbsp;part&nbsp;of&nbsp;its&nbsp;prefix&nbsp;with&nbsp;the&nbsp;end&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348538">//&nbsp;matching&nbsp;suffix.&nbsp;In&nbsp;this&nbsp;case,&nbsp;goodSuffixSkip[i]&nbsp;will&nbsp;contain&nbsp;how&nbsp;far</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348612">//&nbsp;to&nbsp;shift&nbsp;the&nbsp;frame&nbsp;to&nbsp;align&nbsp;this&nbsp;portion&nbsp;of&nbsp;the&nbsp;prefix&nbsp;to&nbsp;the</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348678">//&nbsp;suffix.&nbsp;For&nbsp;example,&nbsp;in&nbsp;the&nbsp;pattern&nbsp;&#34;abcxxxabc&#34;,&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348746">//&nbsp;mismatch&nbsp;from&nbsp;the&nbsp;back&nbsp;is&nbsp;found&nbsp;to&nbsp;be&nbsp;in&nbsp;position&nbsp;3,&nbsp;the&nbsp;matching</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348816">//&nbsp;suffix&nbsp;&#34;xxabc&#34;&nbsp;is&nbsp;not&nbsp;found&nbsp;elsewhere&nbsp;in&nbsp;the&nbsp;pattern.&nbsp;However,&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348887">//&nbsp;rightmost&nbsp;&#34;abc&#34;&nbsp;(at&nbsp;position&nbsp;6)&nbsp;is&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;whole&nbsp;pattern,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2348960">//&nbsp;goodSuffixSkip[3]&nbsp;==&nbsp;shift+len(suffix)&nbsp;==&nbsp;6+5&nbsp;==&nbsp;11.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2349017">goodSuffixSkip</span>&nbsp;<span class="op" id="2349032">[</span><span class="op" id="2349033">]</span><span class="builtintype" id="2349034">int</span><br>
<span class="lineno"></span><span class="op" id="2349038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2349041">func</span>&nbsp;<span class="ident" id="2349046">makeStringFinder</span><span class="op" id="2349062">(</span><span class="ident" id="2349063">pattern</span>&nbsp;<span class="builtintype" id="2349071">string</span><span class="op" id="2349077">)</span>&nbsp;<span class="op" id="2349079">*</span><span class="ident" id="2349080">stringFinder</span>&nbsp;<span class="op" id="2349093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2349096">f</span>&nbsp;<span class="op" id="2349098">:=</span>&nbsp;<span class="op" id="2349101">&amp;</span><span class="ident" id="2349102">stringFinder</span><span class="op" id="2349114">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2349118">pattern</span><span class="op" id="2349125">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2349134">pattern</span><span class="op" id="2349141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2349145">goodSuffixSkip</span><span class="op" id="2349159">:</span>&nbsp;<span class="builtinfunc" id="2349161">make</span><span class="op" id="2349165">(</span><span class="op" id="2349166">[</span><span class="op" id="2349167">]</span><span class="builtintype" id="2349168">int</span><span class="op" id="2349171">,</span>&nbsp;<span class="builtinfunc" id="2349173">len</span><span class="op" id="2349176">(</span><span class="ident" id="2349177">pattern</span><span class="op" id="2349184">)</span><span class="op" id="2349185">)</span><span class="op" id="2349186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2349189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2349192">//&nbsp;last&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;character&nbsp;in&nbsp;the&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2349252">last</span>&nbsp;<span class="op" id="2349257">:=</span>&nbsp;<span class="builtinfunc" id="2349260">len</span><span class="op" id="2349263">(</span><span class="ident" id="2349264">pattern</span><span class="op" id="2349271">)</span>&nbsp;<span class="op" id="2349273">-</span>&nbsp;<span class="num" id="2349275">1</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2349279">//&nbsp;Build&nbsp;bad&nbsp;character&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2349310">//&nbsp;Bytes&nbsp;not&nbsp;in&nbsp;the&nbsp;pattern&nbsp;can&nbsp;skip&nbsp;one&nbsp;pattern&#39;s&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2349370">for</span>&nbsp;<span class="ident" id="2349374">i</span>&nbsp;<span class="op" id="2349376">:=</span>&nbsp;<span class="keyword" id="2349379">range</span>&nbsp;<span class="ident" id="2349385">f</span><span class="op" id="2349386">.</span><span class="ident" id="2349387">badCharSkip</span>&nbsp;<span class="op" id="2349399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2349403">f</span><span class="op" id="2349404">.</span><span class="ident" id="2349405">badCharSkip</span><span class="op" id="2349416">[</span><span class="ident" id="2349417">i</span><span class="op" id="2349418">]</span>&nbsp;<span class="op" id="2349420">=</span>&nbsp;<span class="builtinfunc" id="2349422">len</span><span class="op" id="2349425">(</span><span class="ident" id="2349426">pattern</span><span class="op" id="2349433">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2349436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2349439">//&nbsp;The&nbsp;loop&nbsp;condition&nbsp;is&nbsp;&lt;&nbsp;instead&nbsp;of&nbsp;&lt;=&nbsp;so&nbsp;that&nbsp;the&nbsp;last&nbsp;byte&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2349512">//&nbsp;have&nbsp;a&nbsp;zero&nbsp;distance&nbsp;to&nbsp;itself.&nbsp;Finding&nbsp;this&nbsp;byte&nbsp;out&nbsp;of&nbsp;place&nbsp;implies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2349587">//&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;last&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2349628">for</span>&nbsp;<span class="ident" id="2349632">i</span>&nbsp;<span class="op" id="2349634">:=</span>&nbsp;<span class="num" id="2349637">0</span><span class="op" id="2349638">;</span>&nbsp;<span class="ident" id="2349640">i</span>&nbsp;<span class="op" id="2349642">&lt;</span>&nbsp;<span class="ident" id="2349644">last</span><span class="op" id="2349648">;</span>&nbsp;<span class="ident" id="2349650">i</span><span class="op" id="2349651">++</span>&nbsp;<span class="op" id="2349654">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2349658">f</span><span class="op" id="2349659">.</span><span class="ident" id="2349660">badCharSkip</span><span class="op" id="2349671">[</span><span class="ident" id="2349672">pattern</span><span class="op" id="2349679">[</span><span class="ident" id="2349680">i</span><span class="op" id="2349681">]</span><span class="op" id="2349682">]</span>&nbsp;<span class="op" id="2349684">=</span>&nbsp;<span class="ident" id="2349686">last</span>&nbsp;<span class="op" id="2349691">-</span>&nbsp;<span class="ident" id="2349693">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2349696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2349700">//&nbsp;Build&nbsp;good&nbsp;suffix&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2349729">//&nbsp;First&nbsp;pass:&nbsp;set&nbsp;each&nbsp;value&nbsp;to&nbsp;the&nbsp;next&nbsp;index&nbsp;which&nbsp;starts&nbsp;a&nbsp;prefix&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2349803">//&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2349816">lastPrefix</span>&nbsp;<span class="op" id="2349827">:=</span>&nbsp;<span class="ident" id="2349830">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2349836">for</span>&nbsp;<span class="ident" id="2349840">i</span>&nbsp;<span class="op" id="2349842">:=</span>&nbsp;<span class="ident" id="2349845">last</span><span class="op" id="2349849">;</span>&nbsp;<span class="ident" id="2349851">i</span>&nbsp;<span class="op" id="2349853">&gt;=</span>&nbsp;<span class="num" id="2349856">0</span><span class="op" id="2349857">;</span>&nbsp;<span class="ident" id="2349859">i</span><span class="op" id="2349860">--</span>&nbsp;<span class="op" id="2349863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2349867">if</span>&nbsp;<span class="ident" id="2349870">HasPrefix</span><span class="op" id="2349879">(</span><span class="ident" id="2349880">pattern</span><span class="op" id="2349887">,</span>&nbsp;<span class="ident" id="2349889">pattern</span><span class="op" id="2349896">[</span><span class="ident" id="2349897">i</span><span class="op" id="2349898">+</span><span class="num" id="2349899">1</span><span class="op" id="2349900">:</span><span class="op" id="2349901">]</span><span class="op" id="2349902">)</span>&nbsp;<span class="op" id="2349904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2349909">lastPrefix</span>&nbsp;<span class="op" id="2349920">=</span>&nbsp;<span class="ident" id="2349922">i</span>&nbsp;<span class="op" id="2349924">+</span>&nbsp;<span class="num" id="2349926">1</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2349930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2349934">//&nbsp;lastPrefix&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;(last-i)&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2349993">f</span><span class="op" id="2349994">.</span><span class="ident" id="2349995">goodSuffixSkip</span><span class="op" id="2350009">[</span><span class="ident" id="2350010">i</span><span class="op" id="2350011">]</span>&nbsp;<span class="op" id="2350013">=</span>&nbsp;<span class="ident" id="2350015">lastPrefix</span>&nbsp;<span class="op" id="2350026">+</span>&nbsp;<span class="ident" id="2350028">last</span>&nbsp;<span class="op" id="2350033">-</span>&nbsp;<span class="ident" id="2350035">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2350038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2350041">//&nbsp;Second&nbsp;pass:&nbsp;find&nbsp;repeats&nbsp;of&nbsp;pattern&#39;s&nbsp;suffix&nbsp;starting&nbsp;from&nbsp;the&nbsp;front.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350116">for</span>&nbsp;<span class="ident" id="2350120">i</span>&nbsp;<span class="op" id="2350122">:=</span>&nbsp;<span class="num" id="2350125">0</span><span class="op" id="2350126">;</span>&nbsp;<span class="ident" id="2350128">i</span>&nbsp;<span class="op" id="2350130">&lt;</span>&nbsp;<span class="ident" id="2350132">last</span><span class="op" id="2350136">;</span>&nbsp;<span class="ident" id="2350138">i</span><span class="op" id="2350139">++</span>&nbsp;<span class="op" id="2350142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2350146">lenSuffix</span>&nbsp;<span class="op" id="2350156">:=</span>&nbsp;<span class="ident" id="2350159">longestCommonSuffix</span><span class="op" id="2350178">(</span><span class="ident" id="2350179">pattern</span><span class="op" id="2350186">,</span>&nbsp;<span class="ident" id="2350188">pattern</span><span class="op" id="2350195">[</span><span class="num" id="2350196">1</span><span class="op" id="2350197">:</span><span class="ident" id="2350198">i</span><span class="op" id="2350199">+</span><span class="num" id="2350200">1</span><span class="op" id="2350201">]</span><span class="op" id="2350202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350206">if</span>&nbsp;<span class="ident" id="2350209">pattern</span><span class="op" id="2350216">[</span><span class="ident" id="2350217">i</span><span class="op" id="2350218">-</span><span class="ident" id="2350219">lenSuffix</span><span class="op" id="2350228">]</span>&nbsp;<span class="op" id="2350230">!=</span>&nbsp;<span class="ident" id="2350233">pattern</span><span class="op" id="2350240">[</span><span class="ident" id="2350241">last</span><span class="op" id="2350245">-</span><span class="ident" id="2350246">lenSuffix</span><span class="op" id="2350255">]</span>&nbsp;<span class="op" id="2350257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2350262">//&nbsp;(last-i)&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;lenSuffix&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2350321">f</span><span class="op" id="2350322">.</span><span class="ident" id="2350323">goodSuffixSkip</span><span class="op" id="2350337">[</span><span class="ident" id="2350338">last</span><span class="op" id="2350342">-</span><span class="ident" id="2350343">lenSuffix</span><span class="op" id="2350352">]</span>&nbsp;<span class="op" id="2350354">=</span>&nbsp;<span class="ident" id="2350356">lenSuffix</span>&nbsp;<span class="op" id="2350366">+</span>&nbsp;<span class="ident" id="2350368">last</span>&nbsp;<span class="op" id="2350373">-</span>&nbsp;<span class="ident" id="2350375">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2350379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2350382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350386">return</span>&nbsp;<span class="ident" id="2350393">f</span><br>
<span class="lineno"></span><span class="op" id="2350395">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="2350398">func</span>&nbsp;<span class="ident" id="2350403">longestCommonSuffix</span><span class="op" id="2350422">(</span><span class="ident" id="2350423">a</span><span class="op" id="2350424">,</span>&nbsp;<span class="ident" id="2350426">b</span>&nbsp;<span class="builtintype" id="2350428">string</span><span class="op" id="2350434">)</span>&nbsp;<span class="op" id="2350436">(</span><span class="ident" id="2350437">i</span>&nbsp;<span class="builtintype" id="2350439">int</span><span class="op" id="2350442">)</span>&nbsp;<span class="op" id="2350444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350447">for</span>&nbsp;<span class="op" id="2350451">;</span>&nbsp;<span class="ident" id="2350453">i</span>&nbsp;<span class="op" id="2350455">&lt;</span>&nbsp;<span class="builtinfunc" id="2350457">len</span><span class="op" id="2350460">(</span><span class="ident" id="2350461">a</span><span class="op" id="2350462">)</span>&nbsp;<span class="op" id="2350464">&amp;&amp;</span>&nbsp;<span class="ident" id="2350467">i</span>&nbsp;<span class="op" id="2350469">&lt;</span>&nbsp;<span class="builtinfunc" id="2350471">len</span><span class="op" id="2350474">(</span><span class="ident" id="2350475">b</span><span class="op" id="2350476">)</span><span class="op" id="2350477">;</span>&nbsp;<span class="ident" id="2350479">i</span><span class="op" id="2350480">++</span>&nbsp;<span class="op" id="2350483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350487">if</span>&nbsp;<span class="ident" id="2350490">a</span><span class="op" id="2350491">[</span><span class="builtinfunc" id="2350492">len</span><span class="op" id="2350495">(</span><span class="ident" id="2350496">a</span><span class="op" id="2350497">)</span><span class="op" id="2350498">-</span><span class="num" id="2350499">1</span><span class="op" id="2350500">-</span><span class="ident" id="2350501">i</span><span class="op" id="2350502">]</span>&nbsp;<span class="op" id="2350504">!=</span>&nbsp;<span class="ident" id="2350507">b</span><span class="op" id="2350508">[</span><span class="builtinfunc" id="2350509">len</span><span class="op" id="2350512">(</span><span class="ident" id="2350513">b</span><span class="op" id="2350514">)</span><span class="op" id="2350515">-</span><span class="num" id="2350516">1</span><span class="op" id="2350517">-</span><span class="ident" id="2350518">i</span><span class="op" id="2350519">]</span>&nbsp;<span class="op" id="2350521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350526">break</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2350534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2350537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350540">return</span><br>
<span class="lineno"></span><span class="op" id="2350547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2350550">//&nbsp;next&nbsp;returns&nbsp;the&nbsp;index&nbsp;in&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;the&nbsp;pattern.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="2350627">//&nbsp;the&nbsp;pattern&nbsp;is&nbsp;not&nbsp;found,&nbsp;it&nbsp;returns&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2350671">func</span>&nbsp;<span class="op" id="2350676">(</span><span class="ident" id="2350677">f</span>&nbsp;<span class="op" id="2350679">*</span><span class="ident" id="2350680">stringFinder</span><span class="op" id="2350692">)</span>&nbsp;<span class="ident" id="2350694">next</span><span class="op" id="2350698">(</span><span class="ident" id="2350699">text</span>&nbsp;<span class="builtintype" id="2350704">string</span><span class="op" id="2350710">)</span>&nbsp;<span class="builtintype" id="2350712">int</span>&nbsp;<span class="op" id="2350716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2350719">i</span>&nbsp;<span class="op" id="2350721">:=</span>&nbsp;<span class="builtinfunc" id="2350724">len</span><span class="op" id="2350727">(</span><span class="ident" id="2350728">f</span><span class="op" id="2350729">.</span><span class="ident" id="2350730">pattern</span><span class="op" id="2350737">)</span>&nbsp;<span class="op" id="2350739">-</span>&nbsp;<span class="num" id="2350741">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350744">for</span>&nbsp;<span class="ident" id="2350748">i</span>&nbsp;<span class="op" id="2350750">&lt;</span>&nbsp;<span class="builtinfunc" id="2350752">len</span><span class="op" id="2350755">(</span><span class="ident" id="2350756">text</span><span class="op" id="2350760">)</span>&nbsp;<span class="op" id="2350762">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2350766">//&nbsp;Compare&nbsp;backwards&nbsp;from&nbsp;the&nbsp;end&nbsp;until&nbsp;the&nbsp;first&nbsp;unmatching&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2350840">j</span>&nbsp;<span class="op" id="2350842">:=</span>&nbsp;<span class="builtinfunc" id="2350845">len</span><span class="op" id="2350848">(</span><span class="ident" id="2350849">f</span><span class="op" id="2350850">.</span><span class="ident" id="2350851">pattern</span><span class="op" id="2350858">)</span>&nbsp;<span class="op" id="2350860">-</span>&nbsp;<span class="num" id="2350862">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350866">for</span>&nbsp;<span class="ident" id="2350870">j</span>&nbsp;<span class="op" id="2350872">&gt;=</span>&nbsp;<span class="num" id="2350875">0</span>&nbsp;<span class="op" id="2350877">&amp;&amp;</span>&nbsp;<span class="ident" id="2350880">text</span><span class="op" id="2350884">[</span><span class="ident" id="2350885">i</span><span class="op" id="2350886">]</span>&nbsp;<span class="op" id="2350888">==</span>&nbsp;<span class="ident" id="2350891">f</span><span class="op" id="2350892">.</span><span class="ident" id="2350893">pattern</span><span class="op" id="2350900">[</span><span class="ident" id="2350901">j</span><span class="op" id="2350902">]</span>&nbsp;<span class="op" id="2350904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2350909">i</span><span class="op" id="2350910">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2350916">j</span><span class="op" id="2350917">--</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2350922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350926">if</span>&nbsp;<span class="ident" id="2350929">j</span>&nbsp;<span class="op" id="2350931">&lt;</span>&nbsp;<span class="num" id="2350933">0</span>&nbsp;<span class="op" id="2350935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2350940">return</span>&nbsp;<span class="ident" id="2350947">i</span>&nbsp;<span class="op" id="2350949">+</span>&nbsp;<span class="num" id="2350951">1</span>&nbsp;<span class="comment" id="2350953">//&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2350964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2350968">i</span>&nbsp;<span class="op" id="2350970">+=</span>&nbsp;<span class="ident" id="2350973">max</span><span class="op" id="2350976">(</span><span class="ident" id="2350977">f</span><span class="op" id="2350978">.</span><span class="ident" id="2350979">badCharSkip</span><span class="op" id="2350990">[</span><span class="ident" id="2350991">text</span><span class="op" id="2350995">[</span><span class="ident" id="2350996">i</span><span class="op" id="2350997">]</span><span class="op" id="2350998">]</span><span class="op" id="2350999">,</span>&nbsp;<span class="ident" id="2351001">f</span><span class="op" id="2351002">.</span><span class="ident" id="2351003">goodSuffixSkip</span><span class="op" id="2351017">[</span><span class="ident" id="2351018">j</span><span class="op" id="2351019">]</span><span class="op" id="2351020">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2351023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2351026">return</span>&nbsp;<span class="op" id="2351033">-</span><span class="num" id="2351034">1</span><br>
<span class="lineno"></span><span class="op" id="2351036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2351039">func</span>&nbsp;<span class="ident" id="2351044">max</span><span class="op" id="2351047">(</span><span class="ident" id="2351048">a</span><span class="op" id="2351049">,</span>&nbsp;<span class="ident" id="2351051">b</span>&nbsp;<span class="builtintype" id="2351053">int</span><span class="op" id="2351056">)</span>&nbsp;<span class="builtintype" id="2351058">int</span>&nbsp;<span class="op" id="2351062">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2351065">if</span>&nbsp;<span class="ident" id="2351068">a</span>&nbsp;<span class="op" id="2351070">&gt;</span>&nbsp;<span class="ident" id="2351072">b</span>&nbsp;<span class="op" id="2351074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2351078">return</span>&nbsp;<span class="ident" id="2351085">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2351088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2351091">return</span>&nbsp;<span class="ident" id="2351098">b</span><br>
<span class="lineno"></span><span class="op" id="2351100">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
