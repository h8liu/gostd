<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html" class="current">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3415344">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3415399">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3415453">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3415504">//&nbsp;HTTP&nbsp;client.&nbsp;See&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="3415534">//</span><br>
<span class="lineno"></span><span class="comment" id="3415537">//&nbsp;This&nbsp;is&nbsp;the&nbsp;high-level&nbsp;Client&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="3415581">//&nbsp;The&nbsp;low-level&nbsp;implementation&nbsp;is&nbsp;in&nbsp;transport.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3415634">package</span>&nbsp;<span class="ident" id="3415642">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3415648">import</span>&nbsp;<span class="op" id="3415655">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3415658">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3415677">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3415687">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3415694">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3415700">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3415713">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3415720">&#34;net/url&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3415731">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3415742">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3415750">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3415757">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3415760">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;an&nbsp;HTTP&nbsp;client.&nbsp;Its&nbsp;zero&nbsp;value&nbsp;(DefaultClient)&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3415827">//&nbsp;usable&nbsp;client&nbsp;that&nbsp;uses&nbsp;DefaultTransport.</span><br>
<span class="lineno"></span><span class="comment" id="3415872">//</span><br>
<span class="lineno"></span><span class="comment" id="3415875">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;typically&nbsp;has&nbsp;internal&nbsp;state&nbsp;(cached&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="3415942">//&nbsp;connections),&nbsp;so&nbsp;Clients&nbsp;should&nbsp;be&nbsp;reused&nbsp;instead&nbsp;of&nbsp;created&nbsp;as</span><br>
<span class="lineno">30</span><span class="comment" id="3416009">//&nbsp;needed.&nbsp;Clients&nbsp;are&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="3416080">//</span><br>
<span class="lineno"></span><span class="comment" id="3416083">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;higher-level&nbsp;than&nbsp;a&nbsp;RoundTripper&nbsp;(such&nbsp;as&nbsp;Transport)</span><br>
<span class="lineno"></span><span class="comment" id="3416151">//&nbsp;and&nbsp;additionally&nbsp;handles&nbsp;HTTP&nbsp;details&nbsp;such&nbsp;as&nbsp;cookies&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3416212">//&nbsp;redirects.</span><br>
<span class="lineno">35</span><span class="keyword" id="3416226">type</span>&nbsp;<span class="ident" id="3416231">Client</span>&nbsp;<span class="keyword" id="3416238">struct</span>&nbsp;<span class="op" id="3416245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3416248">//&nbsp;Transport&nbsp;specifies&nbsp;the&nbsp;mechanism&nbsp;by&nbsp;which&nbsp;individual</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3416306">//&nbsp;HTTP&nbsp;requests&nbsp;are&nbsp;made.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3416334">//&nbsp;If&nbsp;nil,&nbsp;DefaultTransport&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3416372">Transport</span>&nbsp;<span class="ident" id="3416382">RoundTripper</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3416397">//&nbsp;CheckRedirect&nbsp;specifies&nbsp;the&nbsp;policy&nbsp;for&nbsp;handling&nbsp;redirects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3416460">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;not&nbsp;nil,&nbsp;the&nbsp;client&nbsp;calls&nbsp;it&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3416520">//&nbsp;following&nbsp;an&nbsp;HTTP&nbsp;redirect.&nbsp;The&nbsp;arguments&nbsp;req&nbsp;and&nbsp;via&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3416582">//&nbsp;the&nbsp;upcoming&nbsp;request&nbsp;and&nbsp;the&nbsp;requests&nbsp;made&nbsp;already,&nbsp;oldest</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3416645">//&nbsp;first.&nbsp;If&nbsp;CheckRedirect&nbsp;returns&nbsp;an&nbsp;error,&nbsp;the&nbsp;Client&#39;s&nbsp;Get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3416708">//&nbsp;method&nbsp;returns&nbsp;both&nbsp;the&nbsp;previous&nbsp;Response&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3416758">//&nbsp;CheckRedirect&#39;s&nbsp;error&nbsp;(wrapped&nbsp;in&nbsp;a&nbsp;url.Error)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3416820">//&nbsp;issuing&nbsp;the&nbsp;Request&nbsp;req.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3416849">//</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3416853">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;nil,&nbsp;the&nbsp;Client&nbsp;uses&nbsp;its&nbsp;default&nbsp;policy,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3416918">//&nbsp;which&nbsp;is&nbsp;to&nbsp;stop&nbsp;after&nbsp;10&nbsp;consecutive&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3416970">CheckRedirect</span>&nbsp;<span class="keyword" id="3416984">func</span><span class="op" id="3416988">(</span><span class="ident" id="3416989">req</span>&nbsp;<span class="op" id="3416993">*</span><span class="ident" id="3416994">Request</span><span class="op" id="3417001">,</span>&nbsp;<span class="ident" id="3417003">via</span>&nbsp;<span class="op" id="3417007">[</span><span class="op" id="3417008">]</span><span class="op" id="3417009">*</span><span class="ident" id="3417010">Request</span><span class="op" id="3417017">)</span>&nbsp;<span class="builtintype" id="3417019">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3417027">//&nbsp;Jar&nbsp;specifies&nbsp;the&nbsp;cookie&nbsp;jar.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3417061">//&nbsp;If&nbsp;Jar&nbsp;is&nbsp;nil,&nbsp;cookies&nbsp;are&nbsp;not&nbsp;sent&nbsp;in&nbsp;requests&nbsp;and&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3417125">//&nbsp;in&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3417143">Jar</span>&nbsp;<span class="ident" id="3417147">CookieJar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3417159">//&nbsp;Timeout&nbsp;specifies&nbsp;a&nbsp;time&nbsp;limit&nbsp;for&nbsp;requests&nbsp;made&nbsp;by&nbsp;this</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3417220">//&nbsp;Client.&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;connection&nbsp;time,&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3417274">//&nbsp;redirects,&nbsp;and&nbsp;reading&nbsp;the&nbsp;response&nbsp;body.&nbsp;The&nbsp;timer&nbsp;remains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3417338">//&nbsp;running&nbsp;after&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do&nbsp;return&nbsp;and&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3417395">//&nbsp;interrupt&nbsp;reading&nbsp;of&nbsp;the&nbsp;Response.Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3417439">//</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3417443">//&nbsp;A&nbsp;Timeout&nbsp;of&nbsp;zero&nbsp;means&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3417483">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3417487">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;must&nbsp;support&nbsp;the&nbsp;CancelRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3417545">//&nbsp;method&nbsp;or&nbsp;Client&nbsp;will&nbsp;return&nbsp;errors&nbsp;when&nbsp;attempting&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3417609">//&nbsp;a&nbsp;request&nbsp;with&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do.&nbsp;Client&#39;s&nbsp;default</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3417669">//&nbsp;Transport&nbsp;(DefaultTransport)&nbsp;supports&nbsp;CancelRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3417726">Timeout</span>&nbsp;<span class="ident" id="3417734">time</span><span class="op" id="3417738">.</span><span class="ident" id="3417739">Duration</span><br>
<span class="lineno"></span><span class="op" id="3417748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3417751">//&nbsp;DefaultClient&nbsp;is&nbsp;the&nbsp;default&nbsp;Client&nbsp;and&nbsp;is&nbsp;used&nbsp;by&nbsp;Get,&nbsp;Head,&nbsp;and&nbsp;Post.</span><br>
<span class="lineno">75</span><span class="keyword" id="3417826">var</span>&nbsp;<span class="ident" id="3417830">DefaultClient</span>&nbsp;<span class="op" id="3417844">=</span>&nbsp;<span class="op" id="3417846">&amp;</span><span class="ident" id="3417847">Client</span><span class="op" id="3417853">{</span><span class="op" id="3417854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3417857">//&nbsp;RoundTripper&nbsp;is&nbsp;an&nbsp;interface&nbsp;representing&nbsp;the&nbsp;ability&nbsp;to&nbsp;execute&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3417927">//&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;obtaining&nbsp;the&nbsp;Response&nbsp;for&nbsp;a&nbsp;given&nbsp;Request.</span><br>
<span class="lineno"></span><span class="comment" id="3417999">//</span><br>
<span class="lineno">80</span><span class="comment" id="3418002">//&nbsp;A&nbsp;RoundTripper&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple</span><br>
<span class="lineno"></span><span class="comment" id="3418064">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="3418079">type</span>&nbsp;<span class="ident" id="3418084">RoundTripper</span>&nbsp;<span class="keyword" id="3418097">interface</span>&nbsp;<span class="op" id="3418107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3418110">//&nbsp;RoundTrip&nbsp;executes&nbsp;a&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;returning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3418170">//&nbsp;the&nbsp;Response&nbsp;for&nbsp;the&nbsp;request&nbsp;req.&nbsp;&nbsp;RoundTrip&nbsp;should&nbsp;not</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3418230">//&nbsp;attempt&nbsp;to&nbsp;interpret&nbsp;the&nbsp;response.&nbsp;&nbsp;In&nbsp;particular,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3418285">//&nbsp;RoundTrip&nbsp;must&nbsp;return&nbsp;err&nbsp;==&nbsp;nil&nbsp;if&nbsp;it&nbsp;obtained&nbsp;a&nbsp;response,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3418349">//&nbsp;regardless&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;HTTP&nbsp;status&nbsp;code.&nbsp;&nbsp;A&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3418411">//&nbsp;err&nbsp;should&nbsp;be&nbsp;reserved&nbsp;for&nbsp;failure&nbsp;to&nbsp;obtain&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3418472">//&nbsp;Similarly,&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;attempt&nbsp;to&nbsp;handle</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3418526">//&nbsp;higher-level&nbsp;protocol&nbsp;details&nbsp;such&nbsp;as&nbsp;redirects,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3418579">//&nbsp;authentication,&nbsp;or&nbsp;cookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3418611">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3418615">//&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;modify&nbsp;the&nbsp;request,&nbsp;except&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3418671">//&nbsp;consuming&nbsp;and&nbsp;closing&nbsp;the&nbsp;Body,&nbsp;including&nbsp;on&nbsp;errors.&nbsp;The</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3418732">//&nbsp;request&#39;s&nbsp;URL&nbsp;and&nbsp;Header&nbsp;fields&nbsp;are&nbsp;guaranteed&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3418789">//&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3418806">RoundTrip</span><span class="op" id="3418815">(</span><span class="op" id="3418816">*</span><span class="ident" id="3418817">Request</span><span class="op" id="3418824">)</span>&nbsp;<span class="op" id="3418826">(</span><span class="op" id="3418827">*</span><span class="ident" id="3418828">Response</span><span class="op" id="3418836">,</span>&nbsp;<span class="builtintype" id="3418838">error</span><span class="op" id="3418843">)</span><br>
<span class="lineno"></span><span class="op" id="3418845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="3418848">//&nbsp;Given&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host&#34;,&nbsp;&#34;host:port&#34;,&nbsp;or&nbsp;&#34;[ipv6::address]:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3418926">//&nbsp;return&nbsp;true&nbsp;if&nbsp;the&nbsp;string&nbsp;includes&nbsp;a&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="3418972">func</span>&nbsp;<span class="ident" id="3418977">hasPort</span><span class="op" id="3418984">(</span><span class="ident" id="3418985">s</span>&nbsp;<span class="builtintype" id="3418987">string</span><span class="op" id="3418993">)</span>&nbsp;<span class="builtintype" id="3418995">bool</span>&nbsp;<span class="op" id="3419000">{</span>&nbsp;<span class="keyword" id="3419002">return</span>&nbsp;<span class="ident" id="3419009">strings</span><span class="op" id="3419016">.</span><span class="ident" id="3419017">LastIndex</span><span class="op" id="3419026">(</span><span class="ident" id="3419027">s</span><span class="op" id="3419028">,</span>&nbsp;<span class="string" id="3419030">&#34;:&#34;</span><span class="op" id="3419033">)</span>&nbsp;<span class="op" id="3419035">&gt;</span>&nbsp;<span class="ident" id="3419037">strings</span><span class="op" id="3419044">.</span><span class="ident" id="3419045">LastIndex</span><span class="op" id="3419054">(</span><span class="ident" id="3419055">s</span><span class="op" id="3419056">,</span>&nbsp;<span class="string" id="3419058">&#34;]&#34;</span><span class="op" id="3419061">)</span>&nbsp;<span class="op" id="3419063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3419066">//&nbsp;refererForURL&nbsp;returns&nbsp;a&nbsp;referer&nbsp;without&nbsp;any&nbsp;authentication&nbsp;info&nbsp;or</span><br>
<span class="lineno">105</span><span class="comment" id="3419136">//&nbsp;an&nbsp;empty&nbsp;string&nbsp;if&nbsp;lastReq&nbsp;scheme&nbsp;is&nbsp;https&nbsp;and&nbsp;newReq&nbsp;scheme&nbsp;is&nbsp;http.</span><br>
<span class="lineno"></span><span class="keyword" id="3419209">func</span>&nbsp;<span class="ident" id="3419214">refererForURL</span><span class="op" id="3419227">(</span><span class="ident" id="3419228">lastReq</span><span class="op" id="3419235">,</span>&nbsp;<span class="ident" id="3419237">newReq</span>&nbsp;<span class="op" id="3419244">*</span><span class="ident" id="3419245">url</span><span class="op" id="3419248">.</span><span class="ident" id="3419249">URL</span><span class="op" id="3419252">)</span>&nbsp;<span class="builtintype" id="3419254">string</span>&nbsp;<span class="op" id="3419261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3419264">//&nbsp;https://tools.ietf.org/html/rfc7231#section-5.5.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3419318">//&nbsp;&nbsp;&nbsp;&#34;Clients&nbsp;SHOULD&nbsp;NOT&nbsp;include&nbsp;a&nbsp;Referer&nbsp;header&nbsp;field&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3419380">//&nbsp;&nbsp;&nbsp;&nbsp;(non-secure)&nbsp;HTTP&nbsp;request&nbsp;if&nbsp;the&nbsp;referring&nbsp;page&nbsp;was</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3419439">//&nbsp;&nbsp;&nbsp;&nbsp;transferred&nbsp;with&nbsp;a&nbsp;secure&nbsp;protocol.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3419483">if</span>&nbsp;<span class="ident" id="3419486">lastReq</span><span class="op" id="3419493">.</span><span class="ident" id="3419494">Scheme</span>&nbsp;<span class="op" id="3419501">==</span>&nbsp;<span class="string" id="3419504">&#34;https&#34;</span>&nbsp;<span class="op" id="3419512">&amp;&amp;</span>&nbsp;<span class="ident" id="3419515">newReq</span><span class="op" id="3419521">.</span><span class="ident" id="3419522">Scheme</span>&nbsp;<span class="op" id="3419529">==</span>&nbsp;<span class="string" id="3419532">&#34;http&#34;</span>&nbsp;<span class="op" id="3419539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3419543">return</span>&nbsp;<span class="string" id="3419550">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3419554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3419557">referer</span>&nbsp;<span class="op" id="3419565">:=</span>&nbsp;<span class="ident" id="3419568">lastReq</span><span class="op" id="3419575">.</span><span class="ident" id="3419576">String</span><span class="op" id="3419582">(</span><span class="op" id="3419583">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3419586">if</span>&nbsp;<span class="ident" id="3419589">lastReq</span><span class="op" id="3419596">.</span><span class="ident" id="3419597">User</span>&nbsp;<span class="op" id="3419602">!=</span>&nbsp;<span class="ident" id="3419605">nil</span>&nbsp;<span class="op" id="3419609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3419613">//&nbsp;This&nbsp;is&nbsp;not&nbsp;very&nbsp;efficient,&nbsp;but&nbsp;is&nbsp;the&nbsp;best&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3419669">//&nbsp;do&nbsp;without:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3419686">//&nbsp;-&nbsp;introducing&nbsp;a&nbsp;new&nbsp;method&nbsp;on&nbsp;URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3419725">//&nbsp;-&nbsp;creating&nbsp;a&nbsp;race&nbsp;condition</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3419758">//&nbsp;-&nbsp;copying&nbsp;the&nbsp;URL&nbsp;struct&nbsp;manually,&nbsp;which&nbsp;would&nbsp;cause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3419816">//&nbsp;&nbsp;&nbsp;maintenance&nbsp;problems&nbsp;down&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3419858">auth</span>&nbsp;<span class="op" id="3419863">:=</span>&nbsp;<span class="ident" id="3419866">lastReq</span><span class="op" id="3419873">.</span><span class="ident" id="3419874">User</span><span class="op" id="3419878">.</span><span class="ident" id="3419879">String</span><span class="op" id="3419885">(</span><span class="op" id="3419886">)</span>&nbsp;<span class="op" id="3419888">+</span>&nbsp;<span class="string" id="3419890">&#34;@&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3419896">referer</span>&nbsp;<span class="op" id="3419904">=</span>&nbsp;<span class="ident" id="3419906">strings</span><span class="op" id="3419913">.</span><span class="ident" id="3419914">Replace</span><span class="op" id="3419921">(</span><span class="ident" id="3419922">referer</span><span class="op" id="3419929">,</span>&nbsp;<span class="ident" id="3419931">auth</span><span class="op" id="3419935">,</span>&nbsp;<span class="string" id="3419937">&#34;&#34;</span><span class="op" id="3419939">,</span>&nbsp;<span class="num" id="3419941">1</span><span class="op" id="3419942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3419945">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3419948">return</span>&nbsp;<span class="ident" id="3419955">referer</span><br>
<span class="lineno"></span><span class="op" id="3419963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3419966">//&nbsp;Used&nbsp;in&nbsp;Send&nbsp;to&nbsp;implement&nbsp;io.ReadCloser&nbsp;by&nbsp;bundling&nbsp;together&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3420034">//&nbsp;bufio.Reader&nbsp;through&nbsp;which&nbsp;we&nbsp;read&nbsp;the&nbsp;response,&nbsp;and&nbsp;the&nbsp;underlying</span><br>
<span class="lineno">130</span><span class="comment" id="3420105">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3420128">type</span>&nbsp;<span class="ident" id="3420133">readClose</span>&nbsp;<span class="keyword" id="3420143">struct</span>&nbsp;<span class="op" id="3420150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3420153">io</span><span class="op" id="3420155">.</span><span class="ident" id="3420156">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3420164">io</span><span class="op" id="3420166">.</span><span class="ident" id="3420167">Closer</span><br>
<span class="lineno"></span><span class="op" id="3420174">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="3420177">func</span>&nbsp;<span class="op" id="3420182">(</span><span class="ident" id="3420183">c</span>&nbsp;<span class="op" id="3420185">*</span><span class="ident" id="3420186">Client</span><span class="op" id="3420192">)</span>&nbsp;<span class="ident" id="3420194">send</span><span class="op" id="3420198">(</span><span class="ident" id="3420199">req</span>&nbsp;<span class="op" id="3420203">*</span><span class="ident" id="3420204">Request</span><span class="op" id="3420211">)</span>&nbsp;<span class="op" id="3420213">(</span><span class="op" id="3420214">*</span><span class="ident" id="3420215">Response</span><span class="op" id="3420223">,</span>&nbsp;<span class="builtintype" id="3420225">error</span><span class="op" id="3420230">)</span>&nbsp;<span class="op" id="3420232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3420235">if</span>&nbsp;<span class="ident" id="3420238">c</span><span class="op" id="3420239">.</span><span class="ident" id="3420240">Jar</span>&nbsp;<span class="op" id="3420244">!=</span>&nbsp;<span class="ident" id="3420247">nil</span>&nbsp;<span class="op" id="3420251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3420255">for</span>&nbsp;<span class="ident" id="3420259">_</span><span class="op" id="3420260">,</span>&nbsp;<span class="ident" id="3420262">cookie</span>&nbsp;<span class="op" id="3420269">:=</span>&nbsp;<span class="keyword" id="3420272">range</span>&nbsp;<span class="ident" id="3420278">c</span><span class="op" id="3420279">.</span><span class="ident" id="3420280">Jar</span><span class="op" id="3420283">.</span><span class="ident" id="3420284">Cookies</span><span class="op" id="3420291">(</span><span class="ident" id="3420292">req</span><span class="op" id="3420295">.</span><span class="ident" id="3420296">URL</span><span class="op" id="3420299">)</span>&nbsp;<span class="op" id="3420301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3420306">req</span><span class="op" id="3420309">.</span><span class="ident" id="3420310">AddCookie</span><span class="op" id="3420319">(</span><span class="ident" id="3420320">cookie</span><span class="op" id="3420326">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3420330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3420333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3420336">resp</span><span class="op" id="3420340">,</span>&nbsp;<span class="ident" id="3420342">err</span>&nbsp;<span class="op" id="3420346">:=</span>&nbsp;<span class="ident" id="3420349">send</span><span class="op" id="3420353">(</span><span class="ident" id="3420354">req</span><span class="op" id="3420357">,</span>&nbsp;<span class="ident" id="3420359">c</span><span class="op" id="3420360">.</span><span class="ident" id="3420361">transport</span><span class="op" id="3420370">(</span><span class="op" id="3420371">)</span><span class="op" id="3420372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3420375">if</span>&nbsp;<span class="ident" id="3420378">err</span>&nbsp;<span class="op" id="3420382">!=</span>&nbsp;<span class="ident" id="3420385">nil</span>&nbsp;<span class="op" id="3420389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3420393">return</span>&nbsp;<span class="ident" id="3420400">nil</span><span class="op" id="3420403">,</span>&nbsp;<span class="ident" id="3420405">err</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3420410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3420413">if</span>&nbsp;<span class="ident" id="3420416">c</span><span class="op" id="3420417">.</span><span class="ident" id="3420418">Jar</span>&nbsp;<span class="op" id="3420422">!=</span>&nbsp;<span class="ident" id="3420425">nil</span>&nbsp;<span class="op" id="3420429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3420433">if</span>&nbsp;<span class="ident" id="3420436">rc</span>&nbsp;<span class="op" id="3420439">:=</span>&nbsp;<span class="ident" id="3420442">resp</span><span class="op" id="3420446">.</span><span class="ident" id="3420447">Cookies</span><span class="op" id="3420454">(</span><span class="op" id="3420455">)</span><span class="op" id="3420456">;</span>&nbsp;<span class="builtinfunc" id="3420458">len</span><span class="op" id="3420461">(</span><span class="ident" id="3420462">rc</span><span class="op" id="3420464">)</span>&nbsp;<span class="op" id="3420466">&gt;</span>&nbsp;<span class="num" id="3420468">0</span>&nbsp;<span class="op" id="3420470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3420475">c</span><span class="op" id="3420476">.</span><span class="ident" id="3420477">Jar</span><span class="op" id="3420480">.</span><span class="ident" id="3420481">SetCookies</span><span class="op" id="3420491">(</span><span class="ident" id="3420492">req</span><span class="op" id="3420495">.</span><span class="ident" id="3420496">URL</span><span class="op" id="3420499">,</span>&nbsp;<span class="ident" id="3420501">rc</span><span class="op" id="3420503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3420507">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3420510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3420513">return</span>&nbsp;<span class="ident" id="3420520">resp</span><span class="op" id="3420524">,</span>&nbsp;<span class="ident" id="3420526">err</span><br>
<span class="lineno"></span><span class="op" id="3420530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3420533">//&nbsp;Do&nbsp;sends&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response,&nbsp;following</span><br>
<span class="lineno">155</span><span class="comment" id="3420601">//&nbsp;policy&nbsp;(e.g.&nbsp;redirects,&nbsp;cookies,&nbsp;auth)&nbsp;as&nbsp;configured&nbsp;on&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="3420672">//</span><br>
<span class="lineno"></span><span class="comment" id="3420675">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;caused&nbsp;by&nbsp;client&nbsp;policy&nbsp;(such&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3420735">//&nbsp;CheckRedirect),&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3420794">//&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno">160</span><span class="comment" id="3420840">//</span><br>
<span class="lineno"></span><span class="comment" id="3420843">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3420905">//</span><br>
<span class="lineno"></span><span class="comment" id="3420908">//&nbsp;Callers&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3420972">//&nbsp;resp.Body&nbsp;is&nbsp;not&nbsp;closed,&nbsp;the&nbsp;Client&#39;s&nbsp;underlying&nbsp;RoundTripper</span><br>
<span class="lineno">165</span><span class="comment" id="3421037">//&nbsp;(typically&nbsp;Transport)&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;re-use&nbsp;a&nbsp;persistent&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="3421105">//&nbsp;connection&nbsp;to&nbsp;the&nbsp;server&nbsp;for&nbsp;a&nbsp;subsequent&nbsp;&#34;keep-alive&#34;&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3421172">//</span><br>
<span class="lineno"></span><span class="comment" id="3421175">//&nbsp;The&nbsp;request&nbsp;Body,&nbsp;if&nbsp;non-nil,&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="3421241">//&nbsp;Transport,&nbsp;even&nbsp;on&nbsp;errors.</span><br>
<span class="lineno">170</span><span class="comment" id="3421271">//</span><br>
<span class="lineno"></span><span class="comment" id="3421274">//&nbsp;Generally&nbsp;Get,&nbsp;Post,&nbsp;or&nbsp;PostForm&nbsp;will&nbsp;be&nbsp;used&nbsp;instead&nbsp;of&nbsp;Do.</span><br>
<span class="lineno"></span><span class="keyword" id="3421338">func</span>&nbsp;<span class="op" id="3421343">(</span><span class="ident" id="3421344">c</span>&nbsp;<span class="op" id="3421346">*</span><span class="ident" id="3421347">Client</span><span class="op" id="3421353">)</span>&nbsp;<span class="ident" id="3421355">Do</span><span class="op" id="3421357">(</span><span class="ident" id="3421358">req</span>&nbsp;<span class="op" id="3421362">*</span><span class="ident" id="3421363">Request</span><span class="op" id="3421370">)</span>&nbsp;<span class="op" id="3421372">(</span><span class="ident" id="3421373">resp</span>&nbsp;<span class="op" id="3421378">*</span><span class="ident" id="3421379">Response</span><span class="op" id="3421387">,</span>&nbsp;<span class="ident" id="3421389">err</span>&nbsp;<span class="builtintype" id="3421393">error</span><span class="op" id="3421398">)</span>&nbsp;<span class="op" id="3421400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3421403">if</span>&nbsp;<span class="ident" id="3421406">req</span><span class="op" id="3421409">.</span><span class="ident" id="3421410">Method</span>&nbsp;<span class="op" id="3421417">==</span>&nbsp;<span class="string" id="3421420">&#34;GET&#34;</span>&nbsp;<span class="op" id="3421426">||</span>&nbsp;<span class="ident" id="3421429">req</span><span class="op" id="3421432">.</span><span class="ident" id="3421433">Method</span>&nbsp;<span class="op" id="3421440">==</span>&nbsp;<span class="string" id="3421443">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="3421450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3421454">return</span>&nbsp;<span class="ident" id="3421461">c</span><span class="op" id="3421462">.</span><span class="ident" id="3421463">doFollowingRedirects</span><span class="op" id="3421483">(</span><span class="ident" id="3421484">req</span><span class="op" id="3421487">,</span>&nbsp;<span class="ident" id="3421489">shouldRedirectGet</span><span class="op" id="3421506">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3421509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3421512">if</span>&nbsp;<span class="ident" id="3421515">req</span><span class="op" id="3421518">.</span><span class="ident" id="3421519">Method</span>&nbsp;<span class="op" id="3421526">==</span>&nbsp;<span class="string" id="3421529">&#34;POST&#34;</span>&nbsp;<span class="op" id="3421536">||</span>&nbsp;<span class="ident" id="3421539">req</span><span class="op" id="3421542">.</span><span class="ident" id="3421543">Method</span>&nbsp;<span class="op" id="3421550">==</span>&nbsp;<span class="string" id="3421553">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3421559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3421563">return</span>&nbsp;<span class="ident" id="3421570">c</span><span class="op" id="3421571">.</span><span class="ident" id="3421572">doFollowingRedirects</span><span class="op" id="3421592">(</span><span class="ident" id="3421593">req</span><span class="op" id="3421596">,</span>&nbsp;<span class="ident" id="3421598">shouldRedirectPost</span><span class="op" id="3421616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3421619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3421622">return</span>&nbsp;<span class="ident" id="3421629">c</span><span class="op" id="3421630">.</span><span class="ident" id="3421631">send</span><span class="op" id="3421635">(</span><span class="ident" id="3421636">req</span><span class="op" id="3421639">)</span><br>
<span class="lineno">180</span><span class="op" id="3421641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3421644">func</span>&nbsp;<span class="op" id="3421649">(</span><span class="ident" id="3421650">c</span>&nbsp;<span class="op" id="3421652">*</span><span class="ident" id="3421653">Client</span><span class="op" id="3421659">)</span>&nbsp;<span class="ident" id="3421661">transport</span><span class="op" id="3421670">(</span><span class="op" id="3421671">)</span>&nbsp;<span class="ident" id="3421673">RoundTripper</span>&nbsp;<span class="op" id="3421686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3421689">if</span>&nbsp;<span class="ident" id="3421692">c</span><span class="op" id="3421693">.</span><span class="ident" id="3421694">Transport</span>&nbsp;<span class="op" id="3421704">!=</span>&nbsp;<span class="ident" id="3421707">nil</span>&nbsp;<span class="op" id="3421711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3421715">return</span>&nbsp;<span class="ident" id="3421722">c</span><span class="op" id="3421723">.</span><span class="ident" id="3421724">Transport</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3421735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3421738">return</span>&nbsp;<span class="ident" id="3421745">DefaultTransport</span><br>
<span class="lineno"></span><span class="op" id="3421762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3421765">//&nbsp;send&nbsp;issues&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno">190</span><span class="comment" id="3421797">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3421857">func</span>&nbsp;<span class="ident" id="3421862">send</span><span class="op" id="3421866">(</span><span class="ident" id="3421867">req</span>&nbsp;<span class="op" id="3421871">*</span><span class="ident" id="3421872">Request</span><span class="op" id="3421879">,</span>&nbsp;<span class="ident" id="3421881">t</span>&nbsp;<span class="ident" id="3421883">RoundTripper</span><span class="op" id="3421895">)</span>&nbsp;<span class="op" id="3421897">(</span><span class="ident" id="3421898">resp</span>&nbsp;<span class="op" id="3421903">*</span><span class="ident" id="3421904">Response</span><span class="op" id="3421912">,</span>&nbsp;<span class="ident" id="3421914">err</span>&nbsp;<span class="builtintype" id="3421918">error</span><span class="op" id="3421923">)</span>&nbsp;<span class="op" id="3421925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3421928">if</span>&nbsp;<span class="ident" id="3421931">t</span>&nbsp;<span class="op" id="3421933">==</span>&nbsp;<span class="ident" id="3421936">nil</span>&nbsp;<span class="op" id="3421940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3421944">req</span><span class="op" id="3421947">.</span><span class="ident" id="3421948">closeBody</span><span class="op" id="3421957">(</span><span class="op" id="3421958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3421962">return</span>&nbsp;<span class="ident" id="3421969">nil</span><span class="op" id="3421972">,</span>&nbsp;<span class="ident" id="3421974">errors</span><span class="op" id="3421980">.</span><span class="ident" id="3421981">New</span><span class="op" id="3421984">(</span><span class="string" id="3421985">&#34;http:&nbsp;no&nbsp;Client.Transport&nbsp;or&nbsp;DefaultTransport&#34;</span><span class="op" id="3422032">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3422035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3422039">if</span>&nbsp;<span class="ident" id="3422042">req</span><span class="op" id="3422045">.</span><span class="ident" id="3422046">URL</span>&nbsp;<span class="op" id="3422050">==</span>&nbsp;<span class="ident" id="3422053">nil</span>&nbsp;<span class="op" id="3422057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3422061">req</span><span class="op" id="3422064">.</span><span class="ident" id="3422065">closeBody</span><span class="op" id="3422074">(</span><span class="op" id="3422075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3422079">return</span>&nbsp;<span class="ident" id="3422086">nil</span><span class="op" id="3422089">,</span>&nbsp;<span class="ident" id="3422091">errors</span><span class="op" id="3422097">.</span><span class="ident" id="3422098">New</span><span class="op" id="3422101">(</span><span class="string" id="3422102">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="3422125">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3422128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3422132">if</span>&nbsp;<span class="ident" id="3422135">req</span><span class="op" id="3422138">.</span><span class="ident" id="3422139">RequestURI</span>&nbsp;<span class="op" id="3422150">!=</span>&nbsp;<span class="string" id="3422153">&#34;&#34;</span>&nbsp;<span class="op" id="3422156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3422160">req</span><span class="op" id="3422163">.</span><span class="ident" id="3422164">closeBody</span><span class="op" id="3422173">(</span><span class="op" id="3422174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3422178">return</span>&nbsp;<span class="ident" id="3422185">nil</span><span class="op" id="3422188">,</span>&nbsp;<span class="ident" id="3422190">errors</span><span class="op" id="3422196">.</span><span class="ident" id="3422197">New</span><span class="op" id="3422200">(</span><span class="string" id="3422201">&#34;http:&nbsp;Request.RequestURI&nbsp;can&#39;t&nbsp;be&nbsp;set&nbsp;in&nbsp;client&nbsp;requests.&#34;</span><span class="op" id="3422260">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3422263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3422267">//&nbsp;Most&nbsp;the&nbsp;callers&nbsp;of&nbsp;send&nbsp;(Get,&nbsp;Post,&nbsp;et&nbsp;al)&nbsp;don&#39;t&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3422326">//&nbsp;Headers,&nbsp;leaving&nbsp;it&nbsp;uninitialized.&nbsp;&nbsp;We&nbsp;guarantee&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3422386">//&nbsp;Transport&nbsp;that&nbsp;this&nbsp;has&nbsp;been&nbsp;initialized,&nbsp;though.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3422440">if</span>&nbsp;<span class="ident" id="3422443">req</span><span class="op" id="3422446">.</span><span class="ident" id="3422447">Header</span>&nbsp;<span class="op" id="3422454">==</span>&nbsp;<span class="ident" id="3422457">nil</span>&nbsp;<span class="op" id="3422461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3422465">req</span><span class="op" id="3422468">.</span><span class="ident" id="3422469">Header</span>&nbsp;<span class="op" id="3422476">=</span>&nbsp;<span class="builtinfunc" id="3422478">make</span><span class="op" id="3422482">(</span><span class="ident" id="3422483">Header</span><span class="op" id="3422489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3422492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3422496">if</span>&nbsp;<span class="ident" id="3422499">u</span>&nbsp;<span class="op" id="3422501">:=</span>&nbsp;<span class="ident" id="3422504">req</span><span class="op" id="3422507">.</span><span class="ident" id="3422508">URL</span><span class="op" id="3422511">.</span><span class="ident" id="3422512">User</span><span class="op" id="3422516">;</span>&nbsp;<span class="ident" id="3422518">u</span>&nbsp;<span class="op" id="3422520">!=</span>&nbsp;<span class="ident" id="3422523">nil</span>&nbsp;<span class="op" id="3422527">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3422531">username</span>&nbsp;<span class="op" id="3422540">:=</span>&nbsp;<span class="ident" id="3422543">u</span><span class="op" id="3422544">.</span><span class="ident" id="3422545">Username</span><span class="op" id="3422553">(</span><span class="op" id="3422554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3422558">password</span><span class="op" id="3422566">,</span>&nbsp;<span class="ident" id="3422568">_</span>&nbsp;<span class="op" id="3422570">:=</span>&nbsp;<span class="ident" id="3422573">u</span><span class="op" id="3422574">.</span><span class="ident" id="3422575">Password</span><span class="op" id="3422583">(</span><span class="op" id="3422584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3422588">req</span><span class="op" id="3422591">.</span><span class="ident" id="3422592">Header</span><span class="op" id="3422598">.</span><span class="ident" id="3422599">Set</span><span class="op" id="3422602">(</span><span class="string" id="3422603">&#34;Authorization&#34;</span><span class="op" id="3422618">,</span>&nbsp;<span class="string" id="3422620">&#34;Basic&nbsp;&#34;</span><span class="op" id="3422628">+</span><span class="ident" id="3422629">basicAuth</span><span class="op" id="3422638">(</span><span class="ident" id="3422639">username</span><span class="op" id="3422647">,</span>&nbsp;<span class="ident" id="3422649">password</span><span class="op" id="3422657">)</span><span class="op" id="3422658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3422661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3422664">resp</span><span class="op" id="3422668">,</span>&nbsp;<span class="ident" id="3422670">err</span>&nbsp;<span class="op" id="3422674">=</span>&nbsp;<span class="ident" id="3422676">t</span><span class="op" id="3422677">.</span><span class="ident" id="3422678">RoundTrip</span><span class="op" id="3422687">(</span><span class="ident" id="3422688">req</span><span class="op" id="3422691">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3422694">if</span>&nbsp;<span class="ident" id="3422697">err</span>&nbsp;<span class="op" id="3422701">!=</span>&nbsp;<span class="ident" id="3422704">nil</span>&nbsp;<span class="op" id="3422708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3422712">if</span>&nbsp;<span class="ident" id="3422715">resp</span>&nbsp;<span class="op" id="3422720">!=</span>&nbsp;<span class="ident" id="3422723">nil</span>&nbsp;<span class="op" id="3422727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3422732">log</span><span class="op" id="3422735">.</span><span class="ident" id="3422736">Printf</span><span class="op" id="3422742">(</span><span class="string" id="3422743">&#34;RoundTripper&nbsp;returned&nbsp;a&nbsp;response&nbsp;&amp;&nbsp;error;&nbsp;ignoring&nbsp;response&#34;</span><span class="op" id="3422804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3422808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3422812">return</span>&nbsp;<span class="ident" id="3422819">nil</span><span class="op" id="3422822">,</span>&nbsp;<span class="ident" id="3422824">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3422829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3422832">return</span>&nbsp;<span class="ident" id="3422839">resp</span><span class="op" id="3422843">,</span>&nbsp;<span class="ident" id="3422845">nil</span><br>
<span class="lineno"></span><span class="op" id="3422849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3422852">//&nbsp;See&nbsp;2&nbsp;(end&nbsp;of&nbsp;page&nbsp;4)&nbsp;http://www.ietf.org/rfc/rfc2617.txt</span><br>
<span class="lineno">230</span><span class="comment" id="3422913">//&nbsp;&#34;To&nbsp;receive&nbsp;authorization,&nbsp;the&nbsp;client&nbsp;sends&nbsp;the&nbsp;userid&nbsp;and&nbsp;password,</span><br>
<span class="lineno"></span><span class="comment" id="3422985">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;single&nbsp;colon&nbsp;(&#34;:&#34;)&nbsp;character,&nbsp;within&nbsp;a&nbsp;base64</span><br>
<span class="lineno"></span><span class="comment" id="3423049">//&nbsp;encoded&nbsp;string&nbsp;in&nbsp;the&nbsp;credentials.&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3423088">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;urlencoded.</span><br>
<span class="lineno"></span><span class="keyword" id="3423125">func</span>&nbsp;<span class="ident" id="3423130">basicAuth</span><span class="op" id="3423139">(</span><span class="ident" id="3423140">username</span><span class="op" id="3423148">,</span>&nbsp;<span class="ident" id="3423150">password</span>&nbsp;<span class="builtintype" id="3423159">string</span><span class="op" id="3423165">)</span>&nbsp;<span class="builtintype" id="3423167">string</span>&nbsp;<span class="op" id="3423174">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3423177">auth</span>&nbsp;<span class="op" id="3423182">:=</span>&nbsp;<span class="ident" id="3423185">username</span>&nbsp;<span class="op" id="3423194">+</span>&nbsp;<span class="string" id="3423196">&#34;:&#34;</span>&nbsp;<span class="op" id="3423200">+</span>&nbsp;<span class="ident" id="3423202">password</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3423212">return</span>&nbsp;<span class="ident" id="3423219">base64</span><span class="op" id="3423225">.</span><span class="ident" id="3423226">StdEncoding</span><span class="op" id="3423237">.</span><span class="ident" id="3423238">EncodeToString</span><span class="op" id="3423252">(</span><span class="op" id="3423253">[</span><span class="op" id="3423254">]</span><span class="builtintype" id="3423255">byte</span><span class="op" id="3423259">(</span><span class="ident" id="3423260">auth</span><span class="op" id="3423264">)</span><span class="op" id="3423265">)</span><br>
<span class="lineno"></span><span class="op" id="3423267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3423270">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Get&nbsp;utility&nbsp;should</span><br>
<span class="lineno">240</span><span class="comment" id="3423352">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="3423379">func</span>&nbsp;<span class="ident" id="3423384">shouldRedirectGet</span><span class="op" id="3423401">(</span><span class="ident" id="3423402">statusCode</span>&nbsp;<span class="builtintype" id="3423413">int</span><span class="op" id="3423416">)</span>&nbsp;<span class="builtintype" id="3423418">bool</span>&nbsp;<span class="op" id="3423423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3423426">switch</span>&nbsp;<span class="ident" id="3423433">statusCode</span>&nbsp;<span class="op" id="3423444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3423447">case</span>&nbsp;<span class="ident" id="3423452">StatusMovedPermanently</span><span class="op" id="3423474">,</span>&nbsp;<span class="ident" id="3423476">StatusFound</span><span class="op" id="3423487">,</span>&nbsp;<span class="ident" id="3423489">StatusSeeOther</span><span class="op" id="3423503">,</span>&nbsp;<span class="ident" id="3423505">StatusTemporaryRedirect</span><span class="op" id="3423528">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3423532">return</span>&nbsp;<span class="builtintype" id="3423539">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3423545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3423548">return</span>&nbsp;<span class="builtintype" id="3423555">false</span><br>
<span class="lineno"></span><span class="op" id="3423561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3423564">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Post&nbsp;utility&nbsp;should</span><br>
<span class="lineno">250</span><span class="comment" id="3423647">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="3423674">func</span>&nbsp;<span class="ident" id="3423679">shouldRedirectPost</span><span class="op" id="3423697">(</span><span class="ident" id="3423698">statusCode</span>&nbsp;<span class="builtintype" id="3423709">int</span><span class="op" id="3423712">)</span>&nbsp;<span class="builtintype" id="3423714">bool</span>&nbsp;<span class="op" id="3423719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3423722">switch</span>&nbsp;<span class="ident" id="3423729">statusCode</span>&nbsp;<span class="op" id="3423740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3423743">case</span>&nbsp;<span class="ident" id="3423748">StatusFound</span><span class="op" id="3423759">,</span>&nbsp;<span class="ident" id="3423761">StatusSeeOther</span><span class="op" id="3423775">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3423779">return</span>&nbsp;<span class="builtintype" id="3423786">true</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3423792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3423795">return</span>&nbsp;<span class="builtintype" id="3423802">false</span><br>
<span class="lineno"></span><span class="op" id="3423808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3423811">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="3423894">//&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect,&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;10&nbsp;redirects:</span><br>
<span class="lineno"></span><span class="comment" id="3423972">//</span><br>
<span class="lineno"></span><span class="comment" id="3423975">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3424005">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="3424023">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">265</span><span class="comment" id="3424045">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="3424076">//</span><br>
<span class="lineno"></span><span class="comment" id="3424079">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;there&nbsp;were&nbsp;too&nbsp;many&nbsp;redirects&nbsp;or&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="3424148">//&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3424215">//&nbsp;error.</span><br>
<span class="lineno">270</span><span class="comment" id="3424225">//</span><br>
<span class="lineno"></span><span class="comment" id="3424228">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3424290">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3424350">//</span><br>
<span class="lineno"></span><span class="comment" id="3424353">//&nbsp;Get&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Get.</span><br>
<span class="lineno">275</span><span class="keyword" id="3424399">func</span>&nbsp;<span class="ident" id="3424404">Get</span><span class="op" id="3424407">(</span><span class="ident" id="3424408">url</span>&nbsp;<span class="builtintype" id="3424412">string</span><span class="op" id="3424418">)</span>&nbsp;<span class="op" id="3424420">(</span><span class="ident" id="3424421">resp</span>&nbsp;<span class="op" id="3424426">*</span><span class="ident" id="3424427">Response</span><span class="op" id="3424435">,</span>&nbsp;<span class="ident" id="3424437">err</span>&nbsp;<span class="builtintype" id="3424441">error</span><span class="op" id="3424446">)</span>&nbsp;<span class="op" id="3424448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3424451">return</span>&nbsp;<span class="ident" id="3424458">DefaultClient</span><span class="op" id="3424471">.</span><span class="ident" id="3424472">Get</span><span class="op" id="3424475">(</span><span class="ident" id="3424476">url</span><span class="op" id="3424479">)</span><br>
<span class="lineno"></span><span class="op" id="3424481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3424484">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">280</span><span class="comment" id="3424557">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3424629">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3424665">//</span><br>
<span class="lineno"></span><span class="comment" id="3424668">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3424698">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">285</span><span class="comment" id="3424716">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="3424738">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="3424769">//</span><br>
<span class="lineno"></span><span class="comment" id="3424772">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;the&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function&nbsp;fails</span><br>
<span class="lineno"></span><span class="comment" id="3424841">//&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t</span><br>
<span class="lineno">290</span><span class="comment" id="3424911">//&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3424930">//</span><br>
<span class="lineno"></span><span class="comment" id="3424933">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3424995">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3425055">func</span>&nbsp;<span class="op" id="3425060">(</span><span class="ident" id="3425061">c</span>&nbsp;<span class="op" id="3425063">*</span><span class="ident" id="3425064">Client</span><span class="op" id="3425070">)</span>&nbsp;<span class="ident" id="3425072">Get</span><span class="op" id="3425075">(</span><span class="ident" id="3425076">url</span>&nbsp;<span class="builtintype" id="3425080">string</span><span class="op" id="3425086">)</span>&nbsp;<span class="op" id="3425088">(</span><span class="ident" id="3425089">resp</span>&nbsp;<span class="op" id="3425094">*</span><span class="ident" id="3425095">Response</span><span class="op" id="3425103">,</span>&nbsp;<span class="ident" id="3425105">err</span>&nbsp;<span class="builtintype" id="3425109">error</span><span class="op" id="3425114">)</span>&nbsp;<span class="op" id="3425116">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3425119">req</span><span class="op" id="3425122">,</span>&nbsp;<span class="ident" id="3425124">err</span>&nbsp;<span class="op" id="3425128">:=</span>&nbsp;<span class="ident" id="3425131">NewRequest</span><span class="op" id="3425141">(</span><span class="string" id="3425142">&#34;GET&#34;</span><span class="op" id="3425147">,</span>&nbsp;<span class="ident" id="3425149">url</span><span class="op" id="3425152">,</span>&nbsp;<span class="ident" id="3425154">nil</span><span class="op" id="3425157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3425160">if</span>&nbsp;<span class="ident" id="3425163">err</span>&nbsp;<span class="op" id="3425167">!=</span>&nbsp;<span class="ident" id="3425170">nil</span>&nbsp;<span class="op" id="3425174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3425178">return</span>&nbsp;<span class="ident" id="3425185">nil</span><span class="op" id="3425188">,</span>&nbsp;<span class="ident" id="3425190">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3425195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3425198">return</span>&nbsp;<span class="ident" id="3425205">c</span><span class="op" id="3425206">.</span><span class="ident" id="3425207">doFollowingRedirects</span><span class="op" id="3425227">(</span><span class="ident" id="3425228">req</span><span class="op" id="3425231">,</span>&nbsp;<span class="ident" id="3425233">shouldRedirectGet</span><span class="op" id="3425250">)</span><br>
<span class="lineno">300</span><span class="op" id="3425252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3425255">func</span>&nbsp;<span class="op" id="3425260">(</span><span class="ident" id="3425261">c</span>&nbsp;<span class="op" id="3425263">*</span><span class="ident" id="3425264">Client</span><span class="op" id="3425270">)</span>&nbsp;<span class="ident" id="3425272">doFollowingRedirects</span><span class="op" id="3425292">(</span><span class="ident" id="3425293">ireq</span>&nbsp;<span class="op" id="3425298">*</span><span class="ident" id="3425299">Request</span><span class="op" id="3425306">,</span>&nbsp;<span class="ident" id="3425308">shouldRedirect</span>&nbsp;<span class="keyword" id="3425323">func</span><span class="op" id="3425327">(</span><span class="builtintype" id="3425328">int</span><span class="op" id="3425331">)</span>&nbsp;<span class="builtintype" id="3425333">bool</span><span class="op" id="3425337">)</span>&nbsp;<span class="op" id="3425339">(</span><span class="ident" id="3425340">resp</span>&nbsp;<span class="op" id="3425345">*</span><span class="ident" id="3425346">Response</span><span class="op" id="3425354">,</span>&nbsp;<span class="ident" id="3425356">err</span>&nbsp;<span class="builtintype" id="3425360">error</span><span class="op" id="3425365">)</span>&nbsp;<span class="op" id="3425367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3425370">var</span>&nbsp;<span class="ident" id="3425374">base</span>&nbsp;<span class="op" id="3425379">*</span><span class="ident" id="3425380">url</span><span class="op" id="3425383">.</span><span class="ident" id="3425384">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3425389">redirectChecker</span>&nbsp;<span class="op" id="3425405">:=</span>&nbsp;<span class="ident" id="3425408">c</span><span class="op" id="3425409">.</span><span class="ident" id="3425410">CheckRedirect</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3425425">if</span>&nbsp;<span class="ident" id="3425428">redirectChecker</span>&nbsp;<span class="op" id="3425444">==</span>&nbsp;<span class="ident" id="3425447">nil</span>&nbsp;<span class="op" id="3425451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3425455">redirectChecker</span>&nbsp;<span class="op" id="3425471">=</span>&nbsp;<span class="ident" id="3425473">defaultCheckRedirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3425495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3425498">var</span>&nbsp;<span class="ident" id="3425502">via</span>&nbsp;<span class="op" id="3425506">[</span><span class="op" id="3425507">]</span><span class="op" id="3425508">*</span><span class="ident" id="3425509">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3425519">if</span>&nbsp;<span class="ident" id="3425522">ireq</span><span class="op" id="3425526">.</span><span class="ident" id="3425527">URL</span>&nbsp;<span class="op" id="3425531">==</span>&nbsp;<span class="ident" id="3425534">nil</span>&nbsp;<span class="op" id="3425538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3425542">ireq</span><span class="op" id="3425546">.</span><span class="ident" id="3425547">closeBody</span><span class="op" id="3425556">(</span><span class="op" id="3425557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3425561">return</span>&nbsp;<span class="ident" id="3425568">nil</span><span class="op" id="3425571">,</span>&nbsp;<span class="ident" id="3425573">errors</span><span class="op" id="3425579">.</span><span class="ident" id="3425580">New</span><span class="op" id="3425583">(</span><span class="string" id="3425584">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="3425607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3425610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3425614">var</span>&nbsp;<span class="ident" id="3425618">reqmu</span>&nbsp;<span class="ident" id="3425624">sync</span><span class="op" id="3425628">.</span><span class="ident" id="3425629">Mutex</span>&nbsp;<span class="comment" id="3425635">//&nbsp;guards&nbsp;req</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3425650">req</span>&nbsp;<span class="op" id="3425654">:=</span>&nbsp;<span class="ident" id="3425657">ireq</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3425664">var</span>&nbsp;<span class="ident" id="3425668">timer</span>&nbsp;<span class="op" id="3425674">*</span><span class="ident" id="3425675">time</span><span class="op" id="3425679">.</span><span class="ident" id="3425680">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3425687">if</span>&nbsp;<span class="ident" id="3425690">c</span><span class="op" id="3425691">.</span><span class="ident" id="3425692">Timeout</span>&nbsp;<span class="op" id="3425700">&gt;</span>&nbsp;<span class="num" id="3425702">0</span>&nbsp;<span class="op" id="3425704">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3425708">type</span>&nbsp;<span class="ident" id="3425713">canceler</span>&nbsp;<span class="keyword" id="3425722">interface</span>&nbsp;<span class="op" id="3425732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3425737">CancelRequest</span><span class="op" id="3425750">(</span><span class="op" id="3425751">*</span><span class="ident" id="3425752">Request</span><span class="op" id="3425759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3425763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3425767">tr</span><span class="op" id="3425769">,</span>&nbsp;<span class="ident" id="3425771">ok</span>&nbsp;<span class="op" id="3425774">:=</span>&nbsp;<span class="ident" id="3425777">c</span><span class="op" id="3425778">.</span><span class="ident" id="3425779">transport</span><span class="op" id="3425788">(</span><span class="op" id="3425789">)</span><span class="op" id="3425790">.</span><span class="op" id="3425791">(</span><span class="ident" id="3425792">canceler</span><span class="op" id="3425800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3425804">if</span>&nbsp;<span class="op" id="3425807">!</span><span class="ident" id="3425808">ok</span>&nbsp;<span class="op" id="3425811">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3425816">return</span>&nbsp;<span class="ident" id="3425823">nil</span><span class="op" id="3425826">,</span>&nbsp;<span class="ident" id="3425828">fmt</span><span class="op" id="3425831">.</span><span class="ident" id="3425832">Errorf</span><span class="op" id="3425838">(</span><span class="string" id="3425839">&#34;net/http:&nbsp;Client&nbsp;Transport&nbsp;of&nbsp;type&nbsp;%T&nbsp;doesn&#39;t&nbsp;support&nbsp;CancelRequest;&nbsp;Timeout&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3425931">,</span>&nbsp;<span class="ident" id="3425933">c</span><span class="op" id="3425934">.</span><span class="ident" id="3425935">transport</span><span class="op" id="3425944">(</span><span class="op" id="3425945">)</span><span class="op" id="3425946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3425950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3425954">timer</span>&nbsp;<span class="op" id="3425960">=</span>&nbsp;<span class="ident" id="3425962">time</span><span class="op" id="3425966">.</span><span class="ident" id="3425967">AfterFunc</span><span class="op" id="3425976">(</span><span class="ident" id="3425977">c</span><span class="op" id="3425978">.</span><span class="ident" id="3425979">Timeout</span><span class="op" id="3425986">,</span>&nbsp;<span class="keyword" id="3425988">func</span><span class="op" id="3425992">(</span><span class="op" id="3425993">)</span>&nbsp;<span class="op" id="3425995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3426000">reqmu</span><span class="op" id="3426005">.</span><span class="ident" id="3426006">Lock</span><span class="op" id="3426010">(</span><span class="op" id="3426011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3426016">defer</span>&nbsp;<span class="ident" id="3426022">reqmu</span><span class="op" id="3426027">.</span><span class="ident" id="3426028">Unlock</span><span class="op" id="3426034">(</span><span class="op" id="3426035">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3426040">tr</span><span class="op" id="3426042">.</span><span class="ident" id="3426043">CancelRequest</span><span class="op" id="3426056">(</span><span class="ident" id="3426057">req</span><span class="op" id="3426060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3426064">}</span><span class="op" id="3426065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3426068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3426072">urlStr</span>&nbsp;<span class="op" id="3426079">:=</span>&nbsp;<span class="string" id="3426082">&#34;&#34;</span>&nbsp;<span class="comment" id="3426085">//&nbsp;next&nbsp;relative&nbsp;or&nbsp;absolute&nbsp;URL&nbsp;to&nbsp;fetch&nbsp;(after&nbsp;first&nbsp;request)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3426150">redirectFailed</span>&nbsp;<span class="op" id="3426165">:=</span>&nbsp;<span class="builtintype" id="3426168">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3426175">for</span>&nbsp;<span class="ident" id="3426179">redirect</span>&nbsp;<span class="op" id="3426188">:=</span>&nbsp;<span class="num" id="3426191">0</span><span class="op" id="3426192">;</span>&nbsp;<span class="op" id="3426194">;</span>&nbsp;<span class="ident" id="3426196">redirect</span><span class="op" id="3426204">++</span>&nbsp;<span class="op" id="3426207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3426211">if</span>&nbsp;<span class="ident" id="3426214">redirect</span>&nbsp;<span class="op" id="3426223">!=</span>&nbsp;<span class="num" id="3426226">0</span>&nbsp;<span class="op" id="3426228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3426233">nreq</span>&nbsp;<span class="op" id="3426238">:=</span>&nbsp;<span class="builtinfunc" id="3426241">new</span><span class="op" id="3426244">(</span><span class="ident" id="3426245">Request</span><span class="op" id="3426252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3426257">nreq</span><span class="op" id="3426261">.</span><span class="ident" id="3426262">Method</span>&nbsp;<span class="op" id="3426269">=</span>&nbsp;<span class="ident" id="3426271">ireq</span><span class="op" id="3426275">.</span><span class="ident" id="3426276">Method</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3426286">if</span>&nbsp;<span class="ident" id="3426289">ireq</span><span class="op" id="3426293">.</span><span class="ident" id="3426294">Method</span>&nbsp;<span class="op" id="3426301">==</span>&nbsp;<span class="string" id="3426304">&#34;POST&#34;</span>&nbsp;<span class="op" id="3426311">||</span>&nbsp;<span class="ident" id="3426314">ireq</span><span class="op" id="3426318">.</span><span class="ident" id="3426319">Method</span>&nbsp;<span class="op" id="3426326">==</span>&nbsp;<span class="string" id="3426329">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3426335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3426341">nreq</span><span class="op" id="3426345">.</span><span class="ident" id="3426346">Method</span>&nbsp;<span class="op" id="3426353">=</span>&nbsp;<span class="string" id="3426355">&#34;GET&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3426364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3426369">nreq</span><span class="op" id="3426373">.</span><span class="ident" id="3426374">Header</span>&nbsp;<span class="op" id="3426381">=</span>&nbsp;<span class="builtinfunc" id="3426383">make</span><span class="op" id="3426387">(</span><span class="ident" id="3426388">Header</span><span class="op" id="3426394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3426399">nreq</span><span class="op" id="3426403">.</span><span class="ident" id="3426404">URL</span><span class="op" id="3426407">,</span>&nbsp;<span class="ident" id="3426409">err</span>&nbsp;<span class="op" id="3426413">=</span>&nbsp;<span class="ident" id="3426415">base</span><span class="op" id="3426419">.</span><span class="ident" id="3426420">Parse</span><span class="op" id="3426425">(</span><span class="ident" id="3426426">urlStr</span><span class="op" id="3426432">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3426437">if</span>&nbsp;<span class="ident" id="3426440">err</span>&nbsp;<span class="op" id="3426444">!=</span>&nbsp;<span class="ident" id="3426447">nil</span>&nbsp;<span class="op" id="3426451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3426457">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3426466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3426471">if</span>&nbsp;<span class="builtinfunc" id="3426474">len</span><span class="op" id="3426477">(</span><span class="ident" id="3426478">via</span><span class="op" id="3426481">)</span>&nbsp;<span class="op" id="3426483">&gt;</span>&nbsp;<span class="num" id="3426485">0</span>&nbsp;<span class="op" id="3426487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3426493">//&nbsp;Add&nbsp;the&nbsp;Referer&nbsp;header.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3426524">lastReq</span>&nbsp;<span class="op" id="3426532">:=</span>&nbsp;<span class="ident" id="3426535">via</span><span class="op" id="3426538">[</span><span class="builtinfunc" id="3426539">len</span><span class="op" id="3426542">(</span><span class="ident" id="3426543">via</span><span class="op" id="3426546">)</span><span class="op" id="3426547">-</span><span class="num" id="3426548">1</span><span class="op" id="3426549">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3426555">if</span>&nbsp;<span class="ident" id="3426558">ref</span>&nbsp;<span class="op" id="3426562">:=</span>&nbsp;<span class="ident" id="3426565">refererForURL</span><span class="op" id="3426578">(</span><span class="ident" id="3426579">lastReq</span><span class="op" id="3426586">.</span><span class="ident" id="3426587">URL</span><span class="op" id="3426590">,</span>&nbsp;<span class="ident" id="3426592">nreq</span><span class="op" id="3426596">.</span><span class="ident" id="3426597">URL</span><span class="op" id="3426600">)</span><span class="op" id="3426601">;</span>&nbsp;<span class="ident" id="3426603">ref</span>&nbsp;<span class="op" id="3426607">!=</span>&nbsp;<span class="string" id="3426610">&#34;&#34;</span>&nbsp;<span class="op" id="3426613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3426620">nreq</span><span class="op" id="3426624">.</span><span class="ident" id="3426625">Header</span><span class="op" id="3426631">.</span><span class="ident" id="3426632">Set</span><span class="op" id="3426635">(</span><span class="string" id="3426636">&#34;Referer&#34;</span><span class="op" id="3426645">,</span>&nbsp;<span class="ident" id="3426647">ref</span><span class="op" id="3426650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3426656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3426663">err</span>&nbsp;<span class="op" id="3426667">=</span>&nbsp;<span class="ident" id="3426669">redirectChecker</span><span class="op" id="3426684">(</span><span class="ident" id="3426685">nreq</span><span class="op" id="3426689">,</span>&nbsp;<span class="ident" id="3426691">via</span><span class="op" id="3426694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3426700">if</span>&nbsp;<span class="ident" id="3426703">err</span>&nbsp;<span class="op" id="3426707">!=</span>&nbsp;<span class="ident" id="3426710">nil</span>&nbsp;<span class="op" id="3426714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3426721">redirectFailed</span>&nbsp;<span class="op" id="3426736">=</span>&nbsp;<span class="builtintype" id="3426738">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3426748">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3426758">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3426763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3426768">reqmu</span><span class="op" id="3426773">.</span><span class="ident" id="3426774">Lock</span><span class="op" id="3426778">(</span><span class="op" id="3426779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3426784">req</span>&nbsp;<span class="op" id="3426788">=</span>&nbsp;<span class="ident" id="3426790">nreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3426798">reqmu</span><span class="op" id="3426803">.</span><span class="ident" id="3426804">Unlock</span><span class="op" id="3426810">(</span><span class="op" id="3426811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3426815">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3426820">urlStr</span>&nbsp;<span class="op" id="3426827">=</span>&nbsp;<span class="ident" id="3426829">req</span><span class="op" id="3426832">.</span><span class="ident" id="3426833">URL</span><span class="op" id="3426836">.</span><span class="ident" id="3426837">String</span><span class="op" id="3426843">(</span><span class="op" id="3426844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3426848">if</span>&nbsp;<span class="ident" id="3426851">resp</span><span class="op" id="3426855">,</span>&nbsp;<span class="ident" id="3426857">err</span>&nbsp;<span class="op" id="3426861">=</span>&nbsp;<span class="ident" id="3426863">c</span><span class="op" id="3426864">.</span><span class="ident" id="3426865">send</span><span class="op" id="3426869">(</span><span class="ident" id="3426870">req</span><span class="op" id="3426873">)</span><span class="op" id="3426874">;</span>&nbsp;<span class="ident" id="3426876">err</span>&nbsp;<span class="op" id="3426880">!=</span>&nbsp;<span class="ident" id="3426883">nil</span>&nbsp;<span class="op" id="3426887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3426892">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3426900">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3426905">if</span>&nbsp;<span class="ident" id="3426908">shouldRedirect</span><span class="op" id="3426922">(</span><span class="ident" id="3426923">resp</span><span class="op" id="3426927">.</span><span class="ident" id="3426928">StatusCode</span><span class="op" id="3426938">)</span>&nbsp;<span class="op" id="3426940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3426945">//&nbsp;Read&nbsp;the&nbsp;body&nbsp;if&nbsp;small&nbsp;so&nbsp;underlying&nbsp;TCP&nbsp;connection&nbsp;will&nbsp;be&nbsp;re-used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3427020">//&nbsp;No&nbsp;need&nbsp;to&nbsp;check&nbsp;for&nbsp;errors:&nbsp;if&nbsp;it&nbsp;fails,&nbsp;Transport&nbsp;won&#39;t&nbsp;reuse&nbsp;it&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3427101">const</span>&nbsp;<span class="ident" id="3427107">maxBodySlurpSize</span>&nbsp;<span class="op" id="3427124">=</span>&nbsp;<span class="num" id="3427126">2</span>&nbsp;<span class="op" id="3427128">&lt;&lt;</span>&nbsp;<span class="num" id="3427131">10</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3427137">if</span>&nbsp;<span class="ident" id="3427140">resp</span><span class="op" id="3427144">.</span><span class="ident" id="3427145">ContentLength</span>&nbsp;<span class="op" id="3427159">==</span>&nbsp;<span class="op" id="3427162">-</span><span class="num" id="3427163">1</span>&nbsp;<span class="op" id="3427165">||</span>&nbsp;<span class="ident" id="3427168">resp</span><span class="op" id="3427172">.</span><span class="ident" id="3427173">ContentLength</span>&nbsp;<span class="op" id="3427187">&lt;=</span>&nbsp;<span class="ident" id="3427190">maxBodySlurpSize</span>&nbsp;<span class="op" id="3427207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3427213">io</span><span class="op" id="3427215">.</span><span class="ident" id="3427216">CopyN</span><span class="op" id="3427221">(</span><span class="ident" id="3427222">ioutil</span><span class="op" id="3427228">.</span><span class="ident" id="3427229">Discard</span><span class="op" id="3427236">,</span>&nbsp;<span class="ident" id="3427238">resp</span><span class="op" id="3427242">.</span><span class="ident" id="3427243">Body</span><span class="op" id="3427247">,</span>&nbsp;<span class="ident" id="3427249">maxBodySlurpSize</span><span class="op" id="3427265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3427270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3427275">resp</span><span class="op" id="3427279">.</span><span class="ident" id="3427280">Body</span><span class="op" id="3427284">.</span><span class="ident" id="3427285">Close</span><span class="op" id="3427290">(</span><span class="op" id="3427291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3427296">if</span>&nbsp;<span class="ident" id="3427299">urlStr</span>&nbsp;<span class="op" id="3427306">=</span>&nbsp;<span class="ident" id="3427308">resp</span><span class="op" id="3427312">.</span><span class="ident" id="3427313">Header</span><span class="op" id="3427319">.</span><span class="ident" id="3427320">Get</span><span class="op" id="3427323">(</span><span class="string" id="3427324">&#34;Location&#34;</span><span class="op" id="3427334">)</span><span class="op" id="3427335">;</span>&nbsp;<span class="ident" id="3427337">urlStr</span>&nbsp;<span class="op" id="3427344">==</span>&nbsp;<span class="string" id="3427347">&#34;&#34;</span>&nbsp;<span class="op" id="3427350">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3427356">err</span>&nbsp;<span class="op" id="3427360">=</span>&nbsp;<span class="ident" id="3427362">errors</span><span class="op" id="3427368">.</span><span class="ident" id="3427369">New</span><span class="op" id="3427372">(</span><span class="ident" id="3427373">fmt</span><span class="op" id="3427376">.</span><span class="ident" id="3427377">Sprintf</span><span class="op" id="3427384">(</span><span class="string" id="3427385">&#34;%d&nbsp;response&nbsp;missing&nbsp;Location&nbsp;header&#34;</span><span class="op" id="3427422">,</span>&nbsp;<span class="ident" id="3427424">resp</span><span class="op" id="3427428">.</span><span class="ident" id="3427429">StatusCode</span><span class="op" id="3427439">)</span><span class="op" id="3427440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3427446">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3427455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3427460">base</span>&nbsp;<span class="op" id="3427465">=</span>&nbsp;<span class="ident" id="3427467">req</span><span class="op" id="3427470">.</span><span class="ident" id="3427471">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3427478">via</span>&nbsp;<span class="op" id="3427482">=</span>&nbsp;<span class="builtinfunc" id="3427484">append</span><span class="op" id="3427490">(</span><span class="ident" id="3427491">via</span><span class="op" id="3427494">,</span>&nbsp;<span class="ident" id="3427496">req</span><span class="op" id="3427499">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3427504">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3427515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3427519">if</span>&nbsp;<span class="ident" id="3427522">timer</span>&nbsp;<span class="op" id="3427528">!=</span>&nbsp;<span class="ident" id="3427531">nil</span>&nbsp;<span class="op" id="3427535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3427540">resp</span><span class="op" id="3427544">.</span><span class="ident" id="3427545">Body</span>&nbsp;<span class="op" id="3427550">=</span>&nbsp;<span class="op" id="3427552">&amp;</span><span class="ident" id="3427553">cancelTimerBody</span><span class="op" id="3427568">{</span><span class="ident" id="3427569">timer</span><span class="op" id="3427574">,</span>&nbsp;<span class="ident" id="3427576">resp</span><span class="op" id="3427580">.</span><span class="ident" id="3427581">Body</span><span class="op" id="3427585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3427589">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3427593">return</span>&nbsp;<span class="ident" id="3427600">resp</span><span class="op" id="3427604">,</span>&nbsp;<span class="ident" id="3427606">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3427611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3427615">method</span>&nbsp;<span class="op" id="3427622">:=</span>&nbsp;<span class="ident" id="3427625">ireq</span><span class="op" id="3427629">.</span><span class="ident" id="3427630">Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3427638">urlErr</span>&nbsp;<span class="op" id="3427645">:=</span>&nbsp;<span class="op" id="3427648">&amp;</span><span class="ident" id="3427649">url</span><span class="op" id="3427652">.</span><span class="ident" id="3427653">Error</span><span class="op" id="3427658">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3427662">Op</span><span class="op" id="3427664">:</span>&nbsp;&nbsp;<span class="ident" id="3427667">method</span><span class="op" id="3427673">[</span><span class="num" id="3427674">0</span><span class="op" id="3427675">:</span><span class="num" id="3427676">1</span><span class="op" id="3427677">]</span>&nbsp;<span class="op" id="3427679">+</span>&nbsp;<span class="ident" id="3427681">strings</span><span class="op" id="3427688">.</span><span class="ident" id="3427689">ToLower</span><span class="op" id="3427696">(</span><span class="ident" id="3427697">method</span><span class="op" id="3427703">[</span><span class="num" id="3427704">1</span><span class="op" id="3427705">:</span><span class="op" id="3427706">]</span><span class="op" id="3427707">)</span><span class="op" id="3427708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3427712">URL</span><span class="op" id="3427715">:</span>&nbsp;<span class="ident" id="3427717">urlStr</span><span class="op" id="3427723">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3427727">Err</span><span class="op" id="3427730">:</span>&nbsp;<span class="ident" id="3427732">err</span><span class="op" id="3427735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3427738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3427742">if</span>&nbsp;<span class="ident" id="3427745">redirectFailed</span>&nbsp;<span class="op" id="3427760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3427764">//&nbsp;Special&nbsp;case&nbsp;for&nbsp;Go&nbsp;1&nbsp;compatibility:&nbsp;return&nbsp;both&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3427831">//&nbsp;and&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;CheckRedirect&nbsp;function&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3427887">//&nbsp;See&nbsp;http://golang.org/issue/3795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3427925">return</span>&nbsp;<span class="ident" id="3427932">resp</span><span class="op" id="3427936">,</span>&nbsp;<span class="ident" id="3427938">urlErr</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3427946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3427950">if</span>&nbsp;<span class="ident" id="3427953">resp</span>&nbsp;<span class="op" id="3427958">!=</span>&nbsp;<span class="ident" id="3427961">nil</span>&nbsp;<span class="op" id="3427965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3427969">resp</span><span class="op" id="3427973">.</span><span class="ident" id="3427974">Body</span><span class="op" id="3427978">.</span><span class="ident" id="3427979">Close</span><span class="op" id="3427984">(</span><span class="op" id="3427985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3427988">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3427991">return</span>&nbsp;<span class="ident" id="3427998">nil</span><span class="op" id="3428001">,</span>&nbsp;<span class="ident" id="3428003">urlErr</span><br>
<span class="lineno"></span><span class="op" id="3428010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3428013">func</span>&nbsp;<span class="ident" id="3428018">defaultCheckRedirect</span><span class="op" id="3428038">(</span><span class="ident" id="3428039">req</span>&nbsp;<span class="op" id="3428043">*</span><span class="ident" id="3428044">Request</span><span class="op" id="3428051">,</span>&nbsp;<span class="ident" id="3428053">via</span>&nbsp;<span class="op" id="3428057">[</span><span class="op" id="3428058">]</span><span class="op" id="3428059">*</span><span class="ident" id="3428060">Request</span><span class="op" id="3428067">)</span>&nbsp;<span class="builtintype" id="3428069">error</span>&nbsp;<span class="op" id="3428075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3428078">if</span>&nbsp;<span class="builtinfunc" id="3428081">len</span><span class="op" id="3428084">(</span><span class="ident" id="3428085">via</span><span class="op" id="3428088">)</span>&nbsp;<span class="op" id="3428090">&gt;=</span>&nbsp;<span class="num" id="3428093">10</span>&nbsp;<span class="op" id="3428096">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3428100">return</span>&nbsp;<span class="ident" id="3428107">errors</span><span class="op" id="3428113">.</span><span class="ident" id="3428114">New</span><span class="op" id="3428117">(</span><span class="string" id="3428118">&#34;stopped&nbsp;after&nbsp;10&nbsp;redirects&#34;</span><span class="op" id="3428146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3428149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3428152">return</span>&nbsp;<span class="ident" id="3428159">nil</span><br>
<span class="lineno"></span><span class="op" id="3428163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="3428166">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno"></span><span class="comment" id="3428210">//</span><br>
<span class="lineno"></span><span class="comment" id="3428213">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3428273">//</span><br>
<span class="lineno"></span><span class="comment" id="3428276">//&nbsp;Post&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Post</span><br>
<span class="lineno">425</span><span class="keyword" id="3428323">func</span>&nbsp;<span class="ident" id="3428328">Post</span><span class="op" id="3428332">(</span><span class="ident" id="3428333">url</span>&nbsp;<span class="builtintype" id="3428337">string</span><span class="op" id="3428343">,</span>&nbsp;<span class="ident" id="3428345">bodyType</span>&nbsp;<span class="builtintype" id="3428354">string</span><span class="op" id="3428360">,</span>&nbsp;<span class="ident" id="3428362">body</span>&nbsp;<span class="ident" id="3428367">io</span><span class="op" id="3428369">.</span><span class="ident" id="3428370">Reader</span><span class="op" id="3428376">)</span>&nbsp;<span class="op" id="3428378">(</span><span class="ident" id="3428379">resp</span>&nbsp;<span class="op" id="3428384">*</span><span class="ident" id="3428385">Response</span><span class="op" id="3428393">,</span>&nbsp;<span class="ident" id="3428395">err</span>&nbsp;<span class="builtintype" id="3428399">error</span><span class="op" id="3428404">)</span>&nbsp;<span class="op" id="3428406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3428409">return</span>&nbsp;<span class="ident" id="3428416">DefaultClient</span><span class="op" id="3428429">.</span><span class="ident" id="3428430">Post</span><span class="op" id="3428434">(</span><span class="ident" id="3428435">url</span><span class="op" id="3428438">,</span>&nbsp;<span class="ident" id="3428440">bodyType</span><span class="op" id="3428448">,</span>&nbsp;<span class="ident" id="3428450">body</span><span class="op" id="3428454">)</span><br>
<span class="lineno"></span><span class="op" id="3428456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3428459">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno">430</span><span class="comment" id="3428503">//</span><br>
<span class="lineno"></span><span class="comment" id="3428506">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3428566">//</span><br>
<span class="lineno"></span><span class="comment" id="3428569">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;it&nbsp;is&nbsp;closed&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3428638">//&nbsp;request.</span><br>
<span class="lineno">435</span><span class="keyword" id="3428650">func</span>&nbsp;<span class="op" id="3428655">(</span><span class="ident" id="3428656">c</span>&nbsp;<span class="op" id="3428658">*</span><span class="ident" id="3428659">Client</span><span class="op" id="3428665">)</span>&nbsp;<span class="ident" id="3428667">Post</span><span class="op" id="3428671">(</span><span class="ident" id="3428672">url</span>&nbsp;<span class="builtintype" id="3428676">string</span><span class="op" id="3428682">,</span>&nbsp;<span class="ident" id="3428684">bodyType</span>&nbsp;<span class="builtintype" id="3428693">string</span><span class="op" id="3428699">,</span>&nbsp;<span class="ident" id="3428701">body</span>&nbsp;<span class="ident" id="3428706">io</span><span class="op" id="3428708">.</span><span class="ident" id="3428709">Reader</span><span class="op" id="3428715">)</span>&nbsp;<span class="op" id="3428717">(</span><span class="ident" id="3428718">resp</span>&nbsp;<span class="op" id="3428723">*</span><span class="ident" id="3428724">Response</span><span class="op" id="3428732">,</span>&nbsp;<span class="ident" id="3428734">err</span>&nbsp;<span class="builtintype" id="3428738">error</span><span class="op" id="3428743">)</span>&nbsp;<span class="op" id="3428745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3428748">req</span><span class="op" id="3428751">,</span>&nbsp;<span class="ident" id="3428753">err</span>&nbsp;<span class="op" id="3428757">:=</span>&nbsp;<span class="ident" id="3428760">NewRequest</span><span class="op" id="3428770">(</span><span class="string" id="3428771">&#34;POST&#34;</span><span class="op" id="3428777">,</span>&nbsp;<span class="ident" id="3428779">url</span><span class="op" id="3428782">,</span>&nbsp;<span class="ident" id="3428784">body</span><span class="op" id="3428788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3428791">if</span>&nbsp;<span class="ident" id="3428794">err</span>&nbsp;<span class="op" id="3428798">!=</span>&nbsp;<span class="ident" id="3428801">nil</span>&nbsp;<span class="op" id="3428805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3428809">return</span>&nbsp;<span class="ident" id="3428816">nil</span><span class="op" id="3428819">,</span>&nbsp;<span class="ident" id="3428821">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3428826">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3428829">req</span><span class="op" id="3428832">.</span><span class="ident" id="3428833">Header</span><span class="op" id="3428839">.</span><span class="ident" id="3428840">Set</span><span class="op" id="3428843">(</span><span class="string" id="3428844">&#34;Content-Type&#34;</span><span class="op" id="3428858">,</span>&nbsp;<span class="ident" id="3428860">bodyType</span><span class="op" id="3428868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3428871">return</span>&nbsp;<span class="ident" id="3428878">c</span><span class="op" id="3428879">.</span><span class="ident" id="3428880">doFollowingRedirects</span><span class="op" id="3428900">(</span><span class="ident" id="3428901">req</span><span class="op" id="3428904">,</span>&nbsp;<span class="ident" id="3428906">shouldRedirectPost</span><span class="op" id="3428924">)</span><br>
<span class="lineno"></span><span class="op" id="3428926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3428929">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and</span><br>
<span class="lineno">445</span><span class="comment" id="3428998">//&nbsp;values&nbsp;URL-encoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="3429041">//</span><br>
<span class="lineno"></span><span class="comment" id="3429044">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3429106">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3429166">//</span><br>
<span class="lineno">450</span><span class="comment" id="3429169">//&nbsp;PostForm&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.PostForm</span><br>
<span class="lineno"></span><span class="keyword" id="3429224">func</span>&nbsp;<span class="ident" id="3429229">PostForm</span><span class="op" id="3429237">(</span><span class="ident" id="3429238">url</span>&nbsp;<span class="builtintype" id="3429242">string</span><span class="op" id="3429248">,</span>&nbsp;<span class="ident" id="3429250">data</span>&nbsp;<span class="ident" id="3429255">url</span><span class="op" id="3429258">.</span><span class="ident" id="3429259">Values</span><span class="op" id="3429265">)</span>&nbsp;<span class="op" id="3429267">(</span><span class="ident" id="3429268">resp</span>&nbsp;<span class="op" id="3429273">*</span><span class="ident" id="3429274">Response</span><span class="op" id="3429282">,</span>&nbsp;<span class="ident" id="3429284">err</span>&nbsp;<span class="builtintype" id="3429288">error</span><span class="op" id="3429293">)</span>&nbsp;<span class="op" id="3429295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3429298">return</span>&nbsp;<span class="ident" id="3429305">DefaultClient</span><span class="op" id="3429318">.</span><span class="ident" id="3429319">PostForm</span><span class="op" id="3429327">(</span><span class="ident" id="3429328">url</span><span class="op" id="3429331">,</span>&nbsp;<span class="ident" id="3429333">data</span><span class="op" id="3429337">)</span><br>
<span class="lineno"></span><span class="op" id="3429339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="3429342">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,</span><br>
<span class="lineno"></span><span class="comment" id="3429390">//&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and&nbsp;values&nbsp;urlencoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="3429453">//</span><br>
<span class="lineno"></span><span class="comment" id="3429456">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3429518">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno">460</span><span class="keyword" id="3429578">func</span>&nbsp;<span class="op" id="3429583">(</span><span class="ident" id="3429584">c</span>&nbsp;<span class="op" id="3429586">*</span><span class="ident" id="3429587">Client</span><span class="op" id="3429593">)</span>&nbsp;<span class="ident" id="3429595">PostForm</span><span class="op" id="3429603">(</span><span class="ident" id="3429604">url</span>&nbsp;<span class="builtintype" id="3429608">string</span><span class="op" id="3429614">,</span>&nbsp;<span class="ident" id="3429616">data</span>&nbsp;<span class="ident" id="3429621">url</span><span class="op" id="3429624">.</span><span class="ident" id="3429625">Values</span><span class="op" id="3429631">)</span>&nbsp;<span class="op" id="3429633">(</span><span class="ident" id="3429634">resp</span>&nbsp;<span class="op" id="3429639">*</span><span class="ident" id="3429640">Response</span><span class="op" id="3429648">,</span>&nbsp;<span class="ident" id="3429650">err</span>&nbsp;<span class="builtintype" id="3429654">error</span><span class="op" id="3429659">)</span>&nbsp;<span class="op" id="3429661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3429664">return</span>&nbsp;<span class="ident" id="3429671">c</span><span class="op" id="3429672">.</span><span class="ident" id="3429673">Post</span><span class="op" id="3429677">(</span><span class="ident" id="3429678">url</span><span class="op" id="3429681">,</span>&nbsp;<span class="string" id="3429683">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="3429718">,</span>&nbsp;<span class="ident" id="3429720">strings</span><span class="op" id="3429727">.</span><span class="ident" id="3429728">NewReader</span><span class="op" id="3429737">(</span><span class="ident" id="3429738">data</span><span class="op" id="3429742">.</span><span class="ident" id="3429743">Encode</span><span class="op" id="3429749">(</span><span class="op" id="3429750">)</span><span class="op" id="3429751">)</span><span class="op" id="3429752">)</span><br>
<span class="lineno"></span><span class="op" id="3429754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3429757">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="3429832">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3429905">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3429941">//</span><br>
<span class="lineno"></span><span class="comment" id="3429944">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3429974">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">470</span><span class="comment" id="3429992">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="3430014">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="3430045">//</span><br>
<span class="lineno"></span><span class="comment" id="3430048">//&nbsp;Head&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Head</span><br>
<span class="lineno"></span><span class="keyword" id="3430095">func</span>&nbsp;<span class="ident" id="3430100">Head</span><span class="op" id="3430104">(</span><span class="ident" id="3430105">url</span>&nbsp;<span class="builtintype" id="3430109">string</span><span class="op" id="3430115">)</span>&nbsp;<span class="op" id="3430117">(</span><span class="ident" id="3430118">resp</span>&nbsp;<span class="op" id="3430123">*</span><span class="ident" id="3430124">Response</span><span class="op" id="3430132">,</span>&nbsp;<span class="ident" id="3430134">err</span>&nbsp;<span class="builtintype" id="3430138">error</span><span class="op" id="3430143">)</span>&nbsp;<span class="op" id="3430145">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3430148">return</span>&nbsp;<span class="ident" id="3430155">DefaultClient</span><span class="op" id="3430168">.</span><span class="ident" id="3430169">Head</span><span class="op" id="3430173">(</span><span class="ident" id="3430174">url</span><span class="op" id="3430177">)</span><br>
<span class="lineno"></span><span class="op" id="3430179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3430182">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3430257">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="3430330">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3430366">//</span><br>
<span class="lineno"></span><span class="comment" id="3430369">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3430399">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="3430417">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">485</span><span class="comment" id="3430439">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="keyword" id="3430470">func</span>&nbsp;<span class="op" id="3430475">(</span><span class="ident" id="3430476">c</span>&nbsp;<span class="op" id="3430478">*</span><span class="ident" id="3430479">Client</span><span class="op" id="3430485">)</span>&nbsp;<span class="ident" id="3430487">Head</span><span class="op" id="3430491">(</span><span class="ident" id="3430492">url</span>&nbsp;<span class="builtintype" id="3430496">string</span><span class="op" id="3430502">)</span>&nbsp;<span class="op" id="3430504">(</span><span class="ident" id="3430505">resp</span>&nbsp;<span class="op" id="3430510">*</span><span class="ident" id="3430511">Response</span><span class="op" id="3430519">,</span>&nbsp;<span class="ident" id="3430521">err</span>&nbsp;<span class="builtintype" id="3430525">error</span><span class="op" id="3430530">)</span>&nbsp;<span class="op" id="3430532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3430535">req</span><span class="op" id="3430538">,</span>&nbsp;<span class="ident" id="3430540">err</span>&nbsp;<span class="op" id="3430544">:=</span>&nbsp;<span class="ident" id="3430547">NewRequest</span><span class="op" id="3430557">(</span><span class="string" id="3430558">&#34;HEAD&#34;</span><span class="op" id="3430564">,</span>&nbsp;<span class="ident" id="3430566">url</span><span class="op" id="3430569">,</span>&nbsp;<span class="ident" id="3430571">nil</span><span class="op" id="3430574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3430577">if</span>&nbsp;<span class="ident" id="3430580">err</span>&nbsp;<span class="op" id="3430584">!=</span>&nbsp;<span class="ident" id="3430587">nil</span>&nbsp;<span class="op" id="3430591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3430595">return</span>&nbsp;<span class="ident" id="3430602">nil</span><span class="op" id="3430605">,</span>&nbsp;<span class="ident" id="3430607">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3430612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3430615">return</span>&nbsp;<span class="ident" id="3430622">c</span><span class="op" id="3430623">.</span><span class="ident" id="3430624">doFollowingRedirects</span><span class="op" id="3430644">(</span><span class="ident" id="3430645">req</span><span class="op" id="3430648">,</span>&nbsp;<span class="ident" id="3430650">shouldRedirectGet</span><span class="op" id="3430667">)</span><br>
<span class="lineno"></span><span class="op" id="3430669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3430672">type</span>&nbsp;<span class="ident" id="3430677">cancelTimerBody</span>&nbsp;<span class="keyword" id="3430693">struct</span>&nbsp;<span class="op" id="3430700">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3430703">t</span>&nbsp;&nbsp;<span class="op" id="3430706">*</span><span class="ident" id="3430707">time</span><span class="op" id="3430711">.</span><span class="ident" id="3430712">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3430719">rc</span>&nbsp;<span class="ident" id="3430722">io</span><span class="op" id="3430724">.</span><span class="ident" id="3430725">ReadCloser</span><br>
<span class="lineno"></span><span class="op" id="3430736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3430739">func</span>&nbsp;<span class="op" id="3430744">(</span><span class="ident" id="3430745">b</span>&nbsp;<span class="op" id="3430747">*</span><span class="ident" id="3430748">cancelTimerBody</span><span class="op" id="3430763">)</span>&nbsp;<span class="ident" id="3430765">Read</span><span class="op" id="3430769">(</span><span class="ident" id="3430770">p</span>&nbsp;<span class="op" id="3430772">[</span><span class="op" id="3430773">]</span><span class="builtintype" id="3430774">byte</span><span class="op" id="3430778">)</span>&nbsp;<span class="op" id="3430780">(</span><span class="ident" id="3430781">n</span>&nbsp;<span class="builtintype" id="3430783">int</span><span class="op" id="3430786">,</span>&nbsp;<span class="ident" id="3430788">err</span>&nbsp;<span class="builtintype" id="3430792">error</span><span class="op" id="3430797">)</span>&nbsp;<span class="op" id="3430799">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3430802">n</span><span class="op" id="3430803">,</span>&nbsp;<span class="ident" id="3430805">err</span>&nbsp;<span class="op" id="3430809">=</span>&nbsp;<span class="ident" id="3430811">b</span><span class="op" id="3430812">.</span><span class="ident" id="3430813">rc</span><span class="op" id="3430815">.</span><span class="ident" id="3430816">Read</span><span class="op" id="3430820">(</span><span class="ident" id="3430821">p</span><span class="op" id="3430822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3430825">if</span>&nbsp;<span class="ident" id="3430828">err</span>&nbsp;<span class="op" id="3430832">==</span>&nbsp;<span class="ident" id="3430835">io</span><span class="op" id="3430837">.</span><span class="ident" id="3430838">EOF</span>&nbsp;<span class="op" id="3430842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3430846">b</span><span class="op" id="3430847">.</span><span class="ident" id="3430848">t</span><span class="op" id="3430849">.</span><span class="ident" id="3430850">Stop</span><span class="op" id="3430854">(</span><span class="op" id="3430855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3430858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3430861">return</span><br>
<span class="lineno">505</span><span class="op" id="3430868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3430871">func</span>&nbsp;<span class="op" id="3430876">(</span><span class="ident" id="3430877">b</span>&nbsp;<span class="op" id="3430879">*</span><span class="ident" id="3430880">cancelTimerBody</span><span class="op" id="3430895">)</span>&nbsp;<span class="ident" id="3430897">Close</span><span class="op" id="3430902">(</span><span class="op" id="3430903">)</span>&nbsp;<span class="builtintype" id="3430905">error</span>&nbsp;<span class="op" id="3430911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3430914">err</span>&nbsp;<span class="op" id="3430918">:=</span>&nbsp;<span class="ident" id="3430921">b</span><span class="op" id="3430922">.</span><span class="ident" id="3430923">rc</span><span class="op" id="3430925">.</span><span class="ident" id="3430926">Close</span><span class="op" id="3430931">(</span><span class="op" id="3430932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3430935">b</span><span class="op" id="3430936">.</span><span class="ident" id="3430937">t</span><span class="op" id="3430938">.</span><span class="ident" id="3430939">Stop</span><span class="op" id="3430943">(</span><span class="op" id="3430944">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3430947">return</span>&nbsp;<span class="ident" id="3430954">err</span><br>
<span class="lineno"></span><span class="op" id="3430958">}</span>
</div>
</body>
</html>
