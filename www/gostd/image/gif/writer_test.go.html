<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7941079">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7941134">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7941188">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7941239">package</span>&nbsp;<span class="ident" id="7941247">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7941252">import</span>&nbsp;<span class="op" id="7941259">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7941262">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7941271">&#34;image&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7941280">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941295">_</span>&nbsp;<span class="string" id="7941297">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7941310">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7941323">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7941336">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7941342">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7941352">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7941355">func</span>&nbsp;<span class="ident" id="7941360">readImg</span><span class="op" id="7941367">(</span><span class="ident" id="7941368">filename</span>&nbsp;<span class="builtintype" id="7941377">string</span><span class="op" id="7941383">)</span>&nbsp;<span class="op" id="7941385">(</span><span class="ident" id="7941386">image</span><span class="op" id="7941391">.</span><span class="ident" id="7941392">Image</span><span class="op" id="7941397">,</span>&nbsp;<span class="builtintype" id="7941399">error</span><span class="op" id="7941404">)</span>&nbsp;<span class="op" id="7941406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941409">f</span><span class="op" id="7941410">,</span>&nbsp;<span class="ident" id="7941412">err</span>&nbsp;<span class="op" id="7941416">:=</span>&nbsp;<span class="ident" id="7941419">os</span><span class="op" id="7941421">.</span><span class="ident" id="7941422">Open</span><span class="op" id="7941426">(</span><span class="ident" id="7941427">filename</span><span class="op" id="7941435">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941438">if</span>&nbsp;<span class="ident" id="7941441">err</span>&nbsp;<span class="op" id="7941445">!=</span>&nbsp;<span class="ident" id="7941448">nil</span>&nbsp;<span class="op" id="7941452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941456">return</span>&nbsp;<span class="ident" id="7941463">nil</span><span class="op" id="7941466">,</span>&nbsp;<span class="ident" id="7941468">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941476">defer</span>&nbsp;<span class="ident" id="7941482">f</span><span class="op" id="7941483">.</span><span class="ident" id="7941484">Close</span><span class="op" id="7941489">(</span><span class="op" id="7941490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941493">m</span><span class="op" id="7941494">,</span>&nbsp;<span class="ident" id="7941496">_</span><span class="op" id="7941497">,</span>&nbsp;<span class="ident" id="7941499">err</span>&nbsp;<span class="op" id="7941503">:=</span>&nbsp;<span class="ident" id="7941506">image</span><span class="op" id="7941511">.</span><span class="ident" id="7941512">Decode</span><span class="op" id="7941518">(</span><span class="ident" id="7941519">f</span><span class="op" id="7941520">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941523">return</span>&nbsp;<span class="ident" id="7941530">m</span><span class="op" id="7941531">,</span>&nbsp;<span class="ident" id="7941533">err</span><br>
<span class="lineno"></span><span class="op" id="7941537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7941540">func</span>&nbsp;<span class="ident" id="7941545">readGIF</span><span class="op" id="7941552">(</span><span class="ident" id="7941553">filename</span>&nbsp;<span class="builtintype" id="7941562">string</span><span class="op" id="7941568">)</span>&nbsp;<span class="op" id="7941570">(</span><span class="op" id="7941571">*</span><span class="ident" id="7941572">GIF</span><span class="op" id="7941575">,</span>&nbsp;<span class="builtintype" id="7941577">error</span><span class="op" id="7941582">)</span>&nbsp;<span class="op" id="7941584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941587">f</span><span class="op" id="7941588">,</span>&nbsp;<span class="ident" id="7941590">err</span>&nbsp;<span class="op" id="7941594">:=</span>&nbsp;<span class="ident" id="7941597">os</span><span class="op" id="7941599">.</span><span class="ident" id="7941600">Open</span><span class="op" id="7941604">(</span><span class="ident" id="7941605">filename</span><span class="op" id="7941613">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941616">if</span>&nbsp;<span class="ident" id="7941619">err</span>&nbsp;<span class="op" id="7941623">!=</span>&nbsp;<span class="ident" id="7941626">nil</span>&nbsp;<span class="op" id="7941630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941634">return</span>&nbsp;<span class="ident" id="7941641">nil</span><span class="op" id="7941644">,</span>&nbsp;<span class="ident" id="7941646">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941654">defer</span>&nbsp;<span class="ident" id="7941660">f</span><span class="op" id="7941661">.</span><span class="ident" id="7941662">Close</span><span class="op" id="7941667">(</span><span class="op" id="7941668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941671">return</span>&nbsp;<span class="ident" id="7941678">DecodeAll</span><span class="op" id="7941687">(</span><span class="ident" id="7941688">f</span><span class="op" id="7941689">)</span><br>
<span class="lineno">35</span><span class="op" id="7941691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7941694">func</span>&nbsp;<span class="ident" id="7941699">delta</span><span class="op" id="7941704">(</span><span class="ident" id="7941705">u0</span><span class="op" id="7941707">,</span>&nbsp;<span class="ident" id="7941709">u1</span>&nbsp;<span class="builtintype" id="7941712">uint32</span><span class="op" id="7941718">)</span>&nbsp;<span class="ident" id="7941720">int64</span>&nbsp;<span class="op" id="7941726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941729">d</span>&nbsp;<span class="op" id="7941731">:=</span>&nbsp;<span class="ident" id="7941734">int64</span><span class="op" id="7941739">(</span><span class="ident" id="7941740">u0</span><span class="op" id="7941742">)</span>&nbsp;<span class="op" id="7941744">-</span>&nbsp;<span class="ident" id="7941746">int64</span><span class="op" id="7941751">(</span><span class="ident" id="7941752">u1</span><span class="op" id="7941754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941757">if</span>&nbsp;<span class="ident" id="7941760">d</span>&nbsp;<span class="op" id="7941762">&lt;</span>&nbsp;<span class="num" id="7941764">0</span>&nbsp;<span class="op" id="7941766">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941770">return</span>&nbsp;<span class="op" id="7941777">-</span><span class="ident" id="7941778">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941784">return</span>&nbsp;<span class="ident" id="7941791">d</span><br>
<span class="lineno"></span><span class="op" id="7941793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="7941796">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="7941872">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="7941897">func</span>&nbsp;<span class="ident" id="7941902">averageDelta</span><span class="op" id="7941914">(</span><span class="ident" id="7941915">m0</span><span class="op" id="7941917">,</span>&nbsp;<span class="ident" id="7941919">m1</span>&nbsp;<span class="ident" id="7941922">image</span><span class="op" id="7941927">.</span><span class="ident" id="7941928">Image</span><span class="op" id="7941933">)</span>&nbsp;<span class="ident" id="7941935">int64</span>&nbsp;<span class="op" id="7941941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941944">b</span>&nbsp;<span class="op" id="7941946">:=</span>&nbsp;<span class="ident" id="7941949">m0</span><span class="op" id="7941951">.</span><span class="ident" id="7941952">Bounds</span><span class="op" id="7941958">(</span><span class="op" id="7941959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941962">var</span>&nbsp;<span class="ident" id="7941966">sum</span><span class="op" id="7941969">,</span>&nbsp;<span class="ident" id="7941971">n</span>&nbsp;<span class="ident" id="7941973">int64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941980">for</span>&nbsp;<span class="ident" id="7941984">y</span>&nbsp;<span class="op" id="7941986">:=</span>&nbsp;<span class="ident" id="7941989">b</span><span class="op" id="7941990">.</span><span class="ident" id="7941991">Min</span><span class="op" id="7941994">.</span><span class="ident" id="7941995">Y</span><span class="op" id="7941996">;</span>&nbsp;<span class="ident" id="7941998">y</span>&nbsp;<span class="op" id="7942000">&lt;</span>&nbsp;<span class="ident" id="7942002">b</span><span class="op" id="7942003">.</span><span class="ident" id="7942004">Max</span><span class="op" id="7942007">.</span><span class="ident" id="7942008">Y</span><span class="op" id="7942009">;</span>&nbsp;<span class="ident" id="7942011">y</span><span class="op" id="7942012">++</span>&nbsp;<span class="op" id="7942015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942019">for</span>&nbsp;<span class="ident" id="7942023">x</span>&nbsp;<span class="op" id="7942025">:=</span>&nbsp;<span class="ident" id="7942028">b</span><span class="op" id="7942029">.</span><span class="ident" id="7942030">Min</span><span class="op" id="7942033">.</span><span class="ident" id="7942034">X</span><span class="op" id="7942035">;</span>&nbsp;<span class="ident" id="7942037">x</span>&nbsp;<span class="op" id="7942039">&lt;</span>&nbsp;<span class="ident" id="7942041">b</span><span class="op" id="7942042">.</span><span class="ident" id="7942043">Max</span><span class="op" id="7942046">.</span><span class="ident" id="7942047">X</span><span class="op" id="7942048">;</span>&nbsp;<span class="ident" id="7942050">x</span><span class="op" id="7942051">++</span>&nbsp;<span class="op" id="7942054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942059">c0</span>&nbsp;<span class="op" id="7942062">:=</span>&nbsp;<span class="ident" id="7942065">m0</span><span class="op" id="7942067">.</span><span class="ident" id="7942068">At</span><span class="op" id="7942070">(</span><span class="ident" id="7942071">x</span><span class="op" id="7942072">,</span>&nbsp;<span class="ident" id="7942074">y</span><span class="op" id="7942075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942080">c1</span>&nbsp;<span class="op" id="7942083">:=</span>&nbsp;<span class="ident" id="7942086">m1</span><span class="op" id="7942088">.</span><span class="ident" id="7942089">At</span><span class="op" id="7942091">(</span><span class="ident" id="7942092">x</span><span class="op" id="7942093">,</span>&nbsp;<span class="ident" id="7942095">y</span><span class="op" id="7942096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942101">r0</span><span class="op" id="7942103">,</span>&nbsp;<span class="ident" id="7942105">g0</span><span class="op" id="7942107">,</span>&nbsp;<span class="ident" id="7942109">b0</span><span class="op" id="7942111">,</span>&nbsp;<span class="ident" id="7942113">_</span>&nbsp;<span class="op" id="7942115">:=</span>&nbsp;<span class="ident" id="7942118">c0</span><span class="op" id="7942120">.</span><span class="ident" id="7942121">RGBA</span><span class="op" id="7942125">(</span><span class="op" id="7942126">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942131">r1</span><span class="op" id="7942133">,</span>&nbsp;<span class="ident" id="7942135">g1</span><span class="op" id="7942137">,</span>&nbsp;<span class="ident" id="7942139">b1</span><span class="op" id="7942141">,</span>&nbsp;<span class="ident" id="7942143">_</span>&nbsp;<span class="op" id="7942145">:=</span>&nbsp;<span class="ident" id="7942148">c1</span><span class="op" id="7942150">.</span><span class="ident" id="7942151">RGBA</span><span class="op" id="7942155">(</span><span class="op" id="7942156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942161">sum</span>&nbsp;<span class="op" id="7942165">+=</span>&nbsp;<span class="ident" id="7942168">delta</span><span class="op" id="7942173">(</span><span class="ident" id="7942174">r0</span><span class="op" id="7942176">,</span>&nbsp;<span class="ident" id="7942178">r1</span><span class="op" id="7942180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942185">sum</span>&nbsp;<span class="op" id="7942189">+=</span>&nbsp;<span class="ident" id="7942192">delta</span><span class="op" id="7942197">(</span><span class="ident" id="7942198">g0</span><span class="op" id="7942200">,</span>&nbsp;<span class="ident" id="7942202">g1</span><span class="op" id="7942204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942209">sum</span>&nbsp;<span class="op" id="7942213">+=</span>&nbsp;<span class="ident" id="7942216">delta</span><span class="op" id="7942221">(</span><span class="ident" id="7942222">b0</span><span class="op" id="7942224">,</span>&nbsp;<span class="ident" id="7942226">b1</span><span class="op" id="7942228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942233">n</span>&nbsp;<span class="op" id="7942235">+=</span>&nbsp;<span class="num" id="7942238">3</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942248">return</span>&nbsp;<span class="ident" id="7942255">sum</span>&nbsp;<span class="op" id="7942259">/</span>&nbsp;<span class="ident" id="7942261">n</span><br>
<span class="lineno"></span><span class="op" id="7942263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7942266">var</span>&nbsp;<span class="ident" id="7942270">testCase</span>&nbsp;<span class="op" id="7942279">=</span>&nbsp;<span class="op" id="7942281">[</span><span class="op" id="7942282">]</span><span class="keyword" id="7942283">struct</span>&nbsp;<span class="op" id="7942290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942293">filename</span>&nbsp;&nbsp;<span class="builtintype" id="7942303">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942311">tolerance</span>&nbsp;<span class="ident" id="7942321">int64</span><br>
<span class="lineno"></span><span class="op" id="7942327">}</span><span class="op" id="7942328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942331">{</span><span class="string" id="7942332">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7942359">,</span>&nbsp;<span class="num" id="7942361">1</span>&nbsp;<span class="op" id="7942363">&lt;&lt;</span>&nbsp;<span class="num" id="7942366">12</span><span class="op" id="7942368">}</span><span class="op" id="7942369">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942372">{</span><span class="string" id="7942373">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7942400">,</span>&nbsp;<span class="num" id="7942402">0</span><span class="op" id="7942403">}</span><span class="op" id="7942404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942407">{</span><span class="string" id="7942408">&#34;../testdata/video-001.interlaced.gif&#34;</span><span class="op" id="7942446">,</span>&nbsp;<span class="num" id="7942448">0</span><span class="op" id="7942449">}</span><span class="op" id="7942450">,</span><br>
<span class="lineno"></span><span class="op" id="7942452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7942455">func</span>&nbsp;<span class="ident" id="7942460">TestWriter</span><span class="op" id="7942470">(</span><span class="ident" id="7942471">t</span>&nbsp;<span class="op" id="7942473">*</span><span class="ident" id="7942474">testing</span><span class="op" id="7942481">.</span><span class="ident" id="7942482">T</span><span class="op" id="7942483">)</span>&nbsp;<span class="op" id="7942485">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942488">for</span>&nbsp;<span class="ident" id="7942492">_</span><span class="op" id="7942493">,</span>&nbsp;<span class="ident" id="7942495">tc</span>&nbsp;<span class="op" id="7942498">:=</span>&nbsp;<span class="keyword" id="7942501">range</span>&nbsp;<span class="ident" id="7942507">testCase</span>&nbsp;<span class="op" id="7942516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942520">m0</span><span class="op" id="7942522">,</span>&nbsp;<span class="ident" id="7942524">err</span>&nbsp;<span class="op" id="7942528">:=</span>&nbsp;<span class="ident" id="7942531">readImg</span><span class="op" id="7942538">(</span><span class="ident" id="7942539">tc</span><span class="op" id="7942541">.</span><span class="ident" id="7942542">filename</span><span class="op" id="7942550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942554">if</span>&nbsp;<span class="ident" id="7942557">err</span>&nbsp;<span class="op" id="7942561">!=</span>&nbsp;<span class="ident" id="7942564">nil</span>&nbsp;<span class="op" id="7942568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942573">t</span><span class="op" id="7942574">.</span><span class="ident" id="7942575">Error</span><span class="op" id="7942580">(</span><span class="ident" id="7942581">tc</span><span class="op" id="7942583">.</span><span class="ident" id="7942584">filename</span><span class="op" id="7942592">,</span>&nbsp;<span class="ident" id="7942594">err</span><span class="op" id="7942597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942602">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942617">var</span>&nbsp;<span class="ident" id="7942621">buf</span>&nbsp;<span class="ident" id="7942625">bytes</span><span class="op" id="7942630">.</span><span class="ident" id="7942631">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942640">err</span>&nbsp;<span class="op" id="7942644">=</span>&nbsp;<span class="ident" id="7942646">Encode</span><span class="op" id="7942652">(</span><span class="op" id="7942653">&amp;</span><span class="ident" id="7942654">buf</span><span class="op" id="7942657">,</span>&nbsp;<span class="ident" id="7942659">m0</span><span class="op" id="7942661">,</span>&nbsp;<span class="ident" id="7942663">nil</span><span class="op" id="7942666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942670">if</span>&nbsp;<span class="ident" id="7942673">err</span>&nbsp;<span class="op" id="7942677">!=</span>&nbsp;<span class="ident" id="7942680">nil</span>&nbsp;<span class="op" id="7942684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942689">t</span><span class="op" id="7942690">.</span><span class="ident" id="7942691">Error</span><span class="op" id="7942696">(</span><span class="ident" id="7942697">tc</span><span class="op" id="7942699">.</span><span class="ident" id="7942700">filename</span><span class="op" id="7942708">,</span>&nbsp;<span class="ident" id="7942710">err</span><span class="op" id="7942713">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942718">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942733">m1</span><span class="op" id="7942735">,</span>&nbsp;<span class="ident" id="7942737">err</span>&nbsp;<span class="op" id="7942741">:=</span>&nbsp;<span class="ident" id="7942744">Decode</span><span class="op" id="7942750">(</span><span class="op" id="7942751">&amp;</span><span class="ident" id="7942752">buf</span><span class="op" id="7942755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942759">if</span>&nbsp;<span class="ident" id="7942762">err</span>&nbsp;<span class="op" id="7942766">!=</span>&nbsp;<span class="ident" id="7942769">nil</span>&nbsp;<span class="op" id="7942773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942778">t</span><span class="op" id="7942779">.</span><span class="ident" id="7942780">Error</span><span class="op" id="7942785">(</span><span class="ident" id="7942786">tc</span><span class="op" id="7942788">.</span><span class="ident" id="7942789">filename</span><span class="op" id="7942797">,</span>&nbsp;<span class="ident" id="7942799">err</span><span class="op" id="7942802">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942807">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942822">if</span>&nbsp;<span class="ident" id="7942825">m0</span><span class="op" id="7942827">.</span><span class="ident" id="7942828">Bounds</span><span class="op" id="7942834">(</span><span class="op" id="7942835">)</span>&nbsp;<span class="op" id="7942837">!=</span>&nbsp;<span class="ident" id="7942840">m1</span><span class="op" id="7942842">.</span><span class="ident" id="7942843">Bounds</span><span class="op" id="7942849">(</span><span class="op" id="7942850">)</span>&nbsp;<span class="op" id="7942852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942857">t</span><span class="op" id="7942858">.</span><span class="ident" id="7942859">Errorf</span><span class="op" id="7942865">(</span><span class="string" id="7942866">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7942896">,</span>&nbsp;<span class="ident" id="7942898">tc</span><span class="op" id="7942900">.</span><span class="ident" id="7942901">filename</span><span class="op" id="7942909">,</span>&nbsp;<span class="ident" id="7942911">m0</span><span class="op" id="7942913">.</span><span class="ident" id="7942914">Bounds</span><span class="op" id="7942920">(</span><span class="op" id="7942921">)</span><span class="op" id="7942922">,</span>&nbsp;<span class="ident" id="7942924">m1</span><span class="op" id="7942926">.</span><span class="ident" id="7942927">Bounds</span><span class="op" id="7942933">(</span><span class="op" id="7942934">)</span><span class="op" id="7942935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942940">continue</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7942955">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943010">avgDelta</span>&nbsp;<span class="op" id="7943019">:=</span>&nbsp;<span class="ident" id="7943022">averageDelta</span><span class="op" id="7943034">(</span><span class="ident" id="7943035">m0</span><span class="op" id="7943037">,</span>&nbsp;<span class="ident" id="7943039">m1</span><span class="op" id="7943041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943045">if</span>&nbsp;<span class="ident" id="7943048">avgDelta</span>&nbsp;<span class="op" id="7943057">&gt;</span>&nbsp;<span class="ident" id="7943059">tc</span><span class="op" id="7943061">.</span><span class="ident" id="7943062">tolerance</span>&nbsp;<span class="op" id="7943072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943077">t</span><span class="op" id="7943078">.</span><span class="ident" id="7943079">Errorf</span><span class="op" id="7943085">(</span><span class="string" id="7943086">&#34;%s:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high.&nbsp;expected:&nbsp;%d,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7943139">,</span>&nbsp;<span class="ident" id="7943141">tc</span><span class="op" id="7943143">.</span><span class="ident" id="7943144">filename</span><span class="op" id="7943152">,</span>&nbsp;<span class="ident" id="7943154">tc</span><span class="op" id="7943156">.</span><span class="ident" id="7943157">tolerance</span><span class="op" id="7943166">,</span>&nbsp;<span class="ident" id="7943168">avgDelta</span><span class="op" id="7943176">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943181">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943195">}</span><br>
<span class="lineno"></span><span class="op" id="7943197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7943200">func</span>&nbsp;<span class="ident" id="7943205">TestSubImage</span><span class="op" id="7943217">(</span><span class="ident" id="7943218">t</span>&nbsp;<span class="op" id="7943220">*</span><span class="ident" id="7943221">testing</span><span class="op" id="7943228">.</span><span class="ident" id="7943229">T</span><span class="op" id="7943230">)</span>&nbsp;<span class="op" id="7943232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943235">m0</span><span class="op" id="7943237">,</span>&nbsp;<span class="ident" id="7943239">err</span>&nbsp;<span class="op" id="7943243">:=</span>&nbsp;<span class="ident" id="7943246">readImg</span><span class="op" id="7943253">(</span><span class="string" id="7943254">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7943281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943284">if</span>&nbsp;<span class="ident" id="7943287">err</span>&nbsp;<span class="op" id="7943291">!=</span>&nbsp;<span class="ident" id="7943294">nil</span>&nbsp;<span class="op" id="7943298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943302">t</span><span class="op" id="7943303">.</span><span class="ident" id="7943304">Fatalf</span><span class="op" id="7943310">(</span><span class="string" id="7943311">&#34;readImg:&nbsp;%v&#34;</span><span class="op" id="7943324">,</span>&nbsp;<span class="ident" id="7943326">err</span><span class="op" id="7943329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943332">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943335">m0</span>&nbsp;<span class="op" id="7943338">=</span>&nbsp;<span class="ident" id="7943340">m0</span><span class="op" id="7943342">.</span><span class="op" id="7943343">(</span><span class="op" id="7943344">*</span><span class="ident" id="7943345">image</span><span class="op" id="7943350">.</span><span class="ident" id="7943351">Paletted</span><span class="op" id="7943359">)</span><span class="op" id="7943360">.</span><span class="ident" id="7943361">SubImage</span><span class="op" id="7943369">(</span><span class="ident" id="7943370">image</span><span class="op" id="7943375">.</span><span class="ident" id="7943376">Rect</span><span class="op" id="7943380">(</span><span class="num" id="7943381">0</span><span class="op" id="7943382">,</span>&nbsp;<span class="num" id="7943384">0</span><span class="op" id="7943385">,</span>&nbsp;<span class="num" id="7943387">50</span><span class="op" id="7943389">,</span>&nbsp;<span class="num" id="7943391">30</span><span class="op" id="7943393">)</span><span class="op" id="7943394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943397">var</span>&nbsp;<span class="ident" id="7943401">buf</span>&nbsp;<span class="ident" id="7943405">bytes</span><span class="op" id="7943410">.</span><span class="ident" id="7943411">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943419">err</span>&nbsp;<span class="op" id="7943423">=</span>&nbsp;<span class="ident" id="7943425">Encode</span><span class="op" id="7943431">(</span><span class="op" id="7943432">&amp;</span><span class="ident" id="7943433">buf</span><span class="op" id="7943436">,</span>&nbsp;<span class="ident" id="7943438">m0</span><span class="op" id="7943440">,</span>&nbsp;<span class="ident" id="7943442">nil</span><span class="op" id="7943445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943448">if</span>&nbsp;<span class="ident" id="7943451">err</span>&nbsp;<span class="op" id="7943455">!=</span>&nbsp;<span class="ident" id="7943458">nil</span>&nbsp;<span class="op" id="7943462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943466">t</span><span class="op" id="7943467">.</span><span class="ident" id="7943468">Fatalf</span><span class="op" id="7943474">(</span><span class="string" id="7943475">&#34;Encode:&nbsp;%v&#34;</span><span class="op" id="7943487">,</span>&nbsp;<span class="ident" id="7943489">err</span><span class="op" id="7943492">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943498">m1</span><span class="op" id="7943500">,</span>&nbsp;<span class="ident" id="7943502">err</span>&nbsp;<span class="op" id="7943506">:=</span>&nbsp;<span class="ident" id="7943509">Decode</span><span class="op" id="7943515">(</span><span class="op" id="7943516">&amp;</span><span class="ident" id="7943517">buf</span><span class="op" id="7943520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943523">if</span>&nbsp;<span class="ident" id="7943526">err</span>&nbsp;<span class="op" id="7943530">!=</span>&nbsp;<span class="ident" id="7943533">nil</span>&nbsp;<span class="op" id="7943537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943541">t</span><span class="op" id="7943542">.</span><span class="ident" id="7943543">Fatalf</span><span class="op" id="7943549">(</span><span class="string" id="7943550">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="7943562">,</span>&nbsp;<span class="ident" id="7943564">err</span><span class="op" id="7943567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943570">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943573">if</span>&nbsp;<span class="ident" id="7943576">m0</span><span class="op" id="7943578">.</span><span class="ident" id="7943579">Bounds</span><span class="op" id="7943585">(</span><span class="op" id="7943586">)</span>&nbsp;<span class="op" id="7943588">!=</span>&nbsp;<span class="ident" id="7943591">m1</span><span class="op" id="7943593">.</span><span class="ident" id="7943594">Bounds</span><span class="op" id="7943600">(</span><span class="op" id="7943601">)</span>&nbsp;<span class="op" id="7943603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943607">t</span><span class="op" id="7943608">.</span><span class="ident" id="7943609">Fatalf</span><span class="op" id="7943615">(</span><span class="string" id="7943616">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7943642">,</span>&nbsp;<span class="ident" id="7943644">m0</span><span class="op" id="7943646">.</span><span class="ident" id="7943647">Bounds</span><span class="op" id="7943653">(</span><span class="op" id="7943654">)</span><span class="op" id="7943655">,</span>&nbsp;<span class="ident" id="7943657">m1</span><span class="op" id="7943659">.</span><span class="ident" id="7943660">Bounds</span><span class="op" id="7943666">(</span><span class="op" id="7943667">)</span><span class="op" id="7943668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943674">if</span>&nbsp;<span class="ident" id="7943677">averageDelta</span><span class="op" id="7943689">(</span><span class="ident" id="7943690">m0</span><span class="op" id="7943692">,</span>&nbsp;<span class="ident" id="7943694">m1</span><span class="op" id="7943696">)</span>&nbsp;<span class="op" id="7943698">!=</span>&nbsp;<span class="num" id="7943701">0</span>&nbsp;<span class="op" id="7943703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943707">t</span><span class="op" id="7943708">.</span><span class="ident" id="7943709">Fatalf</span><span class="op" id="7943715">(</span><span class="string" id="7943716">&#34;images&nbsp;differ&#34;</span><span class="op" id="7943731">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943734">}</span><br>
<span class="lineno"></span><span class="op" id="7943736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7943739">var</span>&nbsp;<span class="ident" id="7943743">frames</span>&nbsp;<span class="op" id="7943750">=</span>&nbsp;<span class="op" id="7943752">[</span><span class="op" id="7943753">]</span><span class="builtintype" id="7943754">string</span><span class="op" id="7943760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7943763">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="7943790">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7943793">&#34;../testdata/video-005.gray.gif&#34;</span><span class="op" id="7943825">,</span><br>
<span class="lineno"></span><span class="op" id="7943827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7943830">func</span>&nbsp;<span class="ident" id="7943835">TestEncodeAll</span><span class="op" id="7943848">(</span><span class="ident" id="7943849">t</span>&nbsp;<span class="op" id="7943851">*</span><span class="ident" id="7943852">testing</span><span class="op" id="7943859">.</span><span class="ident" id="7943860">T</span><span class="op" id="7943861">)</span>&nbsp;<span class="op" id="7943863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943866">g0</span>&nbsp;<span class="op" id="7943869">:=</span>&nbsp;<span class="op" id="7943872">&amp;</span><span class="ident" id="7943873">GIF</span><span class="op" id="7943876">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943880">Image</span><span class="op" id="7943885">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7943891">make</span><span class="op" id="7943895">(</span><span class="op" id="7943896">[</span><span class="op" id="7943897">]</span><span class="op" id="7943898">*</span><span class="ident" id="7943899">image</span><span class="op" id="7943904">.</span><span class="ident" id="7943905">Paletted</span><span class="op" id="7943913">,</span>&nbsp;<span class="builtinfunc" id="7943915">len</span><span class="op" id="7943918">(</span><span class="ident" id="7943919">frames</span><span class="op" id="7943925">)</span><span class="op" id="7943926">)</span><span class="op" id="7943927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943931">Delay</span><span class="op" id="7943936">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7943942">make</span><span class="op" id="7943946">(</span><span class="op" id="7943947">[</span><span class="op" id="7943948">]</span><span class="builtintype" id="7943949">int</span><span class="op" id="7943952">,</span>&nbsp;<span class="builtinfunc" id="7943954">len</span><span class="op" id="7943957">(</span><span class="ident" id="7943958">frames</span><span class="op" id="7943964">)</span><span class="op" id="7943965">)</span><span class="op" id="7943966">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943970">LoopCount</span><span class="op" id="7943979">:</span>&nbsp;<span class="num" id="7943981">5</span><span class="op" id="7943982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943988">for</span>&nbsp;<span class="ident" id="7943992">i</span><span class="op" id="7943993">,</span>&nbsp;<span class="ident" id="7943995">f</span>&nbsp;<span class="op" id="7943997">:=</span>&nbsp;<span class="keyword" id="7944000">range</span>&nbsp;<span class="ident" id="7944006">frames</span>&nbsp;<span class="op" id="7944013">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944017">m</span><span class="op" id="7944018">,</span>&nbsp;<span class="ident" id="7944020">err</span>&nbsp;<span class="op" id="7944024">:=</span>&nbsp;<span class="ident" id="7944027">readGIF</span><span class="op" id="7944034">(</span><span class="ident" id="7944035">f</span><span class="op" id="7944036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944040">if</span>&nbsp;<span class="ident" id="7944043">err</span>&nbsp;<span class="op" id="7944047">!=</span>&nbsp;<span class="ident" id="7944050">nil</span>&nbsp;<span class="op" id="7944054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944059">t</span><span class="op" id="7944060">.</span><span class="ident" id="7944061">Fatal</span><span class="op" id="7944066">(</span><span class="ident" id="7944067">f</span><span class="op" id="7944068">,</span>&nbsp;<span class="ident" id="7944070">err</span><span class="op" id="7944073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944081">g0</span><span class="op" id="7944083">.</span><span class="ident" id="7944084">Image</span><span class="op" id="7944089">[</span><span class="ident" id="7944090">i</span><span class="op" id="7944091">]</span>&nbsp;<span class="op" id="7944093">=</span>&nbsp;<span class="ident" id="7944095">m</span><span class="op" id="7944096">.</span><span class="ident" id="7944097">Image</span><span class="op" id="7944102">[</span><span class="num" id="7944103">0</span><span class="op" id="7944104">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944110">var</span>&nbsp;<span class="ident" id="7944114">buf</span>&nbsp;<span class="ident" id="7944118">bytes</span><span class="op" id="7944123">.</span><span class="ident" id="7944124">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944132">if</span>&nbsp;<span class="ident" id="7944135">err</span>&nbsp;<span class="op" id="7944139">:=</span>&nbsp;<span class="ident" id="7944142">EncodeAll</span><span class="op" id="7944151">(</span><span class="op" id="7944152">&amp;</span><span class="ident" id="7944153">buf</span><span class="op" id="7944156">,</span>&nbsp;<span class="ident" id="7944158">g0</span><span class="op" id="7944160">)</span><span class="op" id="7944161">;</span>&nbsp;<span class="ident" id="7944163">err</span>&nbsp;<span class="op" id="7944167">!=</span>&nbsp;<span class="ident" id="7944170">nil</span>&nbsp;<span class="op" id="7944174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944178">t</span><span class="op" id="7944179">.</span><span class="ident" id="7944180">Fatal</span><span class="op" id="7944185">(</span><span class="string" id="7944186">&#34;EncodeAll:&#34;</span><span class="op" id="7944198">,</span>&nbsp;<span class="ident" id="7944200">err</span><span class="op" id="7944203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944206">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944209">g1</span><span class="op" id="7944211">,</span>&nbsp;<span class="ident" id="7944213">err</span>&nbsp;<span class="op" id="7944217">:=</span>&nbsp;<span class="ident" id="7944220">DecodeAll</span><span class="op" id="7944229">(</span><span class="op" id="7944230">&amp;</span><span class="ident" id="7944231">buf</span><span class="op" id="7944234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944237">if</span>&nbsp;<span class="ident" id="7944240">err</span>&nbsp;<span class="op" id="7944244">!=</span>&nbsp;<span class="ident" id="7944247">nil</span>&nbsp;<span class="op" id="7944251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944255">t</span><span class="op" id="7944256">.</span><span class="ident" id="7944257">Fatal</span><span class="op" id="7944262">(</span><span class="string" id="7944263">&#34;DecodeAll:&#34;</span><span class="op" id="7944275">,</span>&nbsp;<span class="ident" id="7944277">err</span><span class="op" id="7944280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944286">if</span>&nbsp;<span class="ident" id="7944289">g0</span><span class="op" id="7944291">.</span><span class="ident" id="7944292">LoopCount</span>&nbsp;<span class="op" id="7944302">!=</span>&nbsp;<span class="ident" id="7944305">g1</span><span class="op" id="7944307">.</span><span class="ident" id="7944308">LoopCount</span>&nbsp;<span class="op" id="7944318">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944322">t</span><span class="op" id="7944323">.</span><span class="ident" id="7944324">Errorf</span><span class="op" id="7944330">(</span><span class="string" id="7944331">&#34;loop&nbsp;counts&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="7944362">,</span>&nbsp;<span class="ident" id="7944364">g0</span><span class="op" id="7944366">.</span><span class="ident" id="7944367">LoopCount</span><span class="op" id="7944376">,</span>&nbsp;<span class="ident" id="7944378">g1</span><span class="op" id="7944380">.</span><span class="ident" id="7944381">LoopCount</span><span class="op" id="7944390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944396">for</span>&nbsp;<span class="ident" id="7944400">i</span>&nbsp;<span class="op" id="7944402">:=</span>&nbsp;<span class="keyword" id="7944405">range</span>&nbsp;<span class="ident" id="7944411">g0</span><span class="op" id="7944413">.</span><span class="ident" id="7944414">Image</span>&nbsp;<span class="op" id="7944420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944424">m0</span><span class="op" id="7944426">,</span>&nbsp;<span class="ident" id="7944428">m1</span>&nbsp;<span class="op" id="7944431">:=</span>&nbsp;<span class="ident" id="7944434">g0</span><span class="op" id="7944436">.</span><span class="ident" id="7944437">Image</span><span class="op" id="7944442">[</span><span class="ident" id="7944443">i</span><span class="op" id="7944444">]</span><span class="op" id="7944445">,</span>&nbsp;<span class="ident" id="7944447">g1</span><span class="op" id="7944449">.</span><span class="ident" id="7944450">Image</span><span class="op" id="7944455">[</span><span class="ident" id="7944456">i</span><span class="op" id="7944457">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944461">if</span>&nbsp;<span class="ident" id="7944464">m0</span><span class="op" id="7944466">.</span><span class="ident" id="7944467">Bounds</span><span class="op" id="7944473">(</span><span class="op" id="7944474">)</span>&nbsp;<span class="op" id="7944476">!=</span>&nbsp;<span class="ident" id="7944479">m1</span><span class="op" id="7944481">.</span><span class="ident" id="7944482">Bounds</span><span class="op" id="7944488">(</span><span class="op" id="7944489">)</span>&nbsp;<span class="op" id="7944491">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944496">t</span><span class="op" id="7944497">.</span><span class="ident" id="7944498">Errorf</span><span class="op" id="7944504">(</span><span class="string" id="7944505">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7944535">,</span>&nbsp;<span class="ident" id="7944537">frames</span><span class="op" id="7944543">[</span><span class="ident" id="7944544">i</span><span class="op" id="7944545">]</span><span class="op" id="7944546">,</span>&nbsp;<span class="ident" id="7944548">m0</span><span class="op" id="7944550">.</span><span class="ident" id="7944551">Bounds</span><span class="op" id="7944557">(</span><span class="op" id="7944558">)</span><span class="op" id="7944559">,</span>&nbsp;<span class="ident" id="7944561">m1</span><span class="op" id="7944563">.</span><span class="ident" id="7944564">Bounds</span><span class="op" id="7944570">(</span><span class="op" id="7944571">)</span><span class="op" id="7944572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944580">d0</span><span class="op" id="7944582">,</span>&nbsp;<span class="ident" id="7944584">d1</span>&nbsp;<span class="op" id="7944587">:=</span>&nbsp;<span class="ident" id="7944590">g0</span><span class="op" id="7944592">.</span><span class="ident" id="7944593">Delay</span><span class="op" id="7944598">[</span><span class="ident" id="7944599">i</span><span class="op" id="7944600">]</span><span class="op" id="7944601">,</span>&nbsp;<span class="ident" id="7944603">g1</span><span class="op" id="7944605">.</span><span class="ident" id="7944606">Delay</span><span class="op" id="7944611">[</span><span class="ident" id="7944612">i</span><span class="op" id="7944613">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944617">if</span>&nbsp;<span class="ident" id="7944620">d0</span>&nbsp;<span class="op" id="7944623">!=</span>&nbsp;<span class="ident" id="7944626">d1</span>&nbsp;<span class="op" id="7944629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944634">t</span><span class="op" id="7944635">.</span><span class="ident" id="7944636">Errorf</span><span class="op" id="7944642">(</span><span class="string" id="7944643">&#34;%s:&nbsp;delay&nbsp;values&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="7944679">,</span>&nbsp;<span class="ident" id="7944681">frames</span><span class="op" id="7944687">[</span><span class="ident" id="7944688">i</span><span class="op" id="7944689">]</span><span class="op" id="7944690">,</span>&nbsp;<span class="ident" id="7944692">d0</span><span class="op" id="7944694">,</span>&nbsp;<span class="ident" id="7944696">d1</span><span class="op" id="7944698">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944709">g1</span><span class="op" id="7944711">.</span><span class="ident" id="7944712">Delay</span>&nbsp;<span class="op" id="7944718">=</span>&nbsp;<span class="builtinfunc" id="7944720">make</span><span class="op" id="7944724">(</span><span class="op" id="7944725">[</span><span class="op" id="7944726">]</span><span class="builtintype" id="7944727">int</span><span class="op" id="7944730">,</span>&nbsp;<span class="num" id="7944732">1</span><span class="op" id="7944733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944736">if</span>&nbsp;<span class="ident" id="7944739">err</span>&nbsp;<span class="op" id="7944743">:=</span>&nbsp;<span class="ident" id="7944746">EncodeAll</span><span class="op" id="7944755">(</span><span class="ident" id="7944756">ioutil</span><span class="op" id="7944762">.</span><span class="ident" id="7944763">Discard</span><span class="op" id="7944770">,</span>&nbsp;<span class="ident" id="7944772">g1</span><span class="op" id="7944774">)</span><span class="op" id="7944775">;</span>&nbsp;<span class="ident" id="7944777">err</span>&nbsp;<span class="op" id="7944781">==</span>&nbsp;<span class="ident" id="7944784">nil</span>&nbsp;<span class="op" id="7944788">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944792">t</span><span class="op" id="7944793">.</span><span class="ident" id="7944794">Error</span><span class="op" id="7944799">(</span><span class="string" id="7944800">&#34;expected&nbsp;error&nbsp;from&nbsp;mismatched&nbsp;delay&nbsp;and&nbsp;image&nbsp;slice&nbsp;lengths&#34;</span><span class="op" id="7944862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944868">if</span>&nbsp;<span class="ident" id="7944871">err</span>&nbsp;<span class="op" id="7944875">:=</span>&nbsp;<span class="ident" id="7944878">EncodeAll</span><span class="op" id="7944887">(</span><span class="ident" id="7944888">ioutil</span><span class="op" id="7944894">.</span><span class="ident" id="7944895">Discard</span><span class="op" id="7944902">,</span>&nbsp;<span class="op" id="7944904">&amp;</span><span class="ident" id="7944905">GIF</span><span class="op" id="7944908">{</span><span class="op" id="7944909">}</span><span class="op" id="7944910">)</span><span class="op" id="7944911">;</span>&nbsp;<span class="ident" id="7944913">err</span>&nbsp;<span class="op" id="7944917">==</span>&nbsp;<span class="ident" id="7944920">nil</span>&nbsp;<span class="op" id="7944924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944928">t</span><span class="op" id="7944929">.</span><span class="ident" id="7944930">Error</span><span class="op" id="7944935">(</span><span class="string" id="7944936">&#34;expected&nbsp;error&nbsp;from&nbsp;providing&nbsp;empty&nbsp;gif&#34;</span><span class="op" id="7944977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944980">}</span><br>
<span class="lineno">175</span><span class="op" id="7944982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7944985">func</span>&nbsp;<span class="ident" id="7944990">BenchmarkEncode</span><span class="op" id="7945005">(</span><span class="ident" id="7945006">b</span>&nbsp;<span class="op" id="7945008">*</span><span class="ident" id="7945009">testing</span><span class="op" id="7945016">.</span><span class="ident" id="7945017">B</span><span class="op" id="7945018">)</span>&nbsp;<span class="op" id="7945020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945023">b</span><span class="op" id="7945024">.</span><span class="ident" id="7945025">StopTimer</span><span class="op" id="7945034">(</span><span class="op" id="7945035">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945039">bo</span>&nbsp;<span class="op" id="7945042">:=</span>&nbsp;<span class="ident" id="7945045">image</span><span class="op" id="7945050">.</span><span class="ident" id="7945051">Rect</span><span class="op" id="7945055">(</span><span class="num" id="7945056">0</span><span class="op" id="7945057">,</span>&nbsp;<span class="num" id="7945059">0</span><span class="op" id="7945060">,</span>&nbsp;<span class="num" id="7945062">640</span><span class="op" id="7945065">,</span>&nbsp;<span class="num" id="7945067">480</span><span class="op" id="7945070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945073">rnd</span>&nbsp;<span class="op" id="7945077">:=</span>&nbsp;<span class="ident" id="7945080">rand</span><span class="op" id="7945084">.</span><span class="ident" id="7945085">New</span><span class="op" id="7945088">(</span><span class="ident" id="7945089">rand</span><span class="op" id="7945093">.</span><span class="ident" id="7945094">NewSource</span><span class="op" id="7945103">(</span><span class="num" id="7945104">123</span><span class="op" id="7945107">)</span><span class="op" id="7945108">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7945112">//&nbsp;Restrict&nbsp;to&nbsp;a&nbsp;256-color&nbsp;paletted&nbsp;image&nbsp;to&nbsp;avoid&nbsp;quantization&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945183">palette</span>&nbsp;<span class="op" id="7945191">:=</span>&nbsp;<span class="builtinfunc" id="7945194">make</span><span class="op" id="7945198">(</span><span class="ident" id="7945199">color</span><span class="op" id="7945204">.</span><span class="ident" id="7945205">Palette</span><span class="op" id="7945212">,</span>&nbsp;<span class="num" id="7945214">256</span><span class="op" id="7945217">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945220">for</span>&nbsp;<span class="ident" id="7945224">i</span>&nbsp;<span class="op" id="7945226">:=</span>&nbsp;<span class="keyword" id="7945229">range</span>&nbsp;<span class="ident" id="7945235">palette</span>&nbsp;<span class="op" id="7945243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945247">palette</span><span class="op" id="7945254">[</span><span class="ident" id="7945255">i</span><span class="op" id="7945256">]</span>&nbsp;<span class="op" id="7945258">=</span>&nbsp;<span class="ident" id="7945260">color</span><span class="op" id="7945265">.</span><span class="ident" id="7945266">RGBA</span><span class="op" id="7945270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7945275">uint8</span><span class="op" id="7945280">(</span><span class="ident" id="7945281">rnd</span><span class="op" id="7945284">.</span><span class="ident" id="7945285">Intn</span><span class="op" id="7945289">(</span><span class="num" id="7945290">256</span><span class="op" id="7945293">)</span><span class="op" id="7945294">)</span><span class="op" id="7945295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7945300">uint8</span><span class="op" id="7945305">(</span><span class="ident" id="7945306">rnd</span><span class="op" id="7945309">.</span><span class="ident" id="7945310">Intn</span><span class="op" id="7945314">(</span><span class="num" id="7945315">256</span><span class="op" id="7945318">)</span><span class="op" id="7945319">)</span><span class="op" id="7945320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7945325">uint8</span><span class="op" id="7945330">(</span><span class="ident" id="7945331">rnd</span><span class="op" id="7945334">.</span><span class="ident" id="7945335">Intn</span><span class="op" id="7945339">(</span><span class="num" id="7945340">256</span><span class="op" id="7945343">)</span><span class="op" id="7945344">)</span><span class="op" id="7945345">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7945350">255</span><span class="op" id="7945353">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945363">img</span>&nbsp;<span class="op" id="7945367">:=</span>&nbsp;<span class="ident" id="7945370">image</span><span class="op" id="7945375">.</span><span class="ident" id="7945376">NewPaletted</span><span class="op" id="7945387">(</span><span class="ident" id="7945388">image</span><span class="op" id="7945393">.</span><span class="ident" id="7945394">Rect</span><span class="op" id="7945398">(</span><span class="num" id="7945399">0</span><span class="op" id="7945400">,</span>&nbsp;<span class="num" id="7945402">0</span><span class="op" id="7945403">,</span>&nbsp;<span class="num" id="7945405">640</span><span class="op" id="7945408">,</span>&nbsp;<span class="num" id="7945410">480</span><span class="op" id="7945413">)</span><span class="op" id="7945414">,</span>&nbsp;<span class="ident" id="7945416">palette</span><span class="op" id="7945423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945426">for</span>&nbsp;<span class="ident" id="7945430">y</span>&nbsp;<span class="op" id="7945432">:=</span>&nbsp;<span class="ident" id="7945435">bo</span><span class="op" id="7945437">.</span><span class="ident" id="7945438">Min</span><span class="op" id="7945441">.</span><span class="ident" id="7945442">Y</span><span class="op" id="7945443">;</span>&nbsp;<span class="ident" id="7945445">y</span>&nbsp;<span class="op" id="7945447">&lt;</span>&nbsp;<span class="ident" id="7945449">bo</span><span class="op" id="7945451">.</span><span class="ident" id="7945452">Max</span><span class="op" id="7945455">.</span><span class="ident" id="7945456">Y</span><span class="op" id="7945457">;</span>&nbsp;<span class="ident" id="7945459">y</span><span class="op" id="7945460">++</span>&nbsp;<span class="op" id="7945463">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945467">for</span>&nbsp;<span class="ident" id="7945471">x</span>&nbsp;<span class="op" id="7945473">:=</span>&nbsp;<span class="ident" id="7945476">bo</span><span class="op" id="7945478">.</span><span class="ident" id="7945479">Min</span><span class="op" id="7945482">.</span><span class="ident" id="7945483">X</span><span class="op" id="7945484">;</span>&nbsp;<span class="ident" id="7945486">x</span>&nbsp;<span class="op" id="7945488">&lt;</span>&nbsp;<span class="ident" id="7945490">bo</span><span class="op" id="7945492">.</span><span class="ident" id="7945493">Max</span><span class="op" id="7945496">.</span><span class="ident" id="7945497">X</span><span class="op" id="7945498">;</span>&nbsp;<span class="ident" id="7945500">x</span><span class="op" id="7945501">++</span>&nbsp;<span class="op" id="7945504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945509">img</span><span class="op" id="7945512">.</span><span class="ident" id="7945513">Set</span><span class="op" id="7945516">(</span><span class="ident" id="7945517">x</span><span class="op" id="7945518">,</span>&nbsp;<span class="ident" id="7945520">y</span><span class="op" id="7945521">,</span>&nbsp;<span class="ident" id="7945523">palette</span><span class="op" id="7945530">[</span><span class="ident" id="7945531">rnd</span><span class="op" id="7945534">.</span><span class="ident" id="7945535">Intn</span><span class="op" id="7945539">(</span><span class="num" id="7945540">256</span><span class="op" id="7945543">)</span><span class="op" id="7945544">]</span><span class="op" id="7945545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945556">b</span><span class="op" id="7945557">.</span><span class="ident" id="7945558">SetBytes</span><span class="op" id="7945566">(</span><span class="num" id="7945567">640</span>&nbsp;<span class="op" id="7945571">*</span>&nbsp;<span class="num" id="7945573">480</span>&nbsp;<span class="op" id="7945577">*</span>&nbsp;<span class="num" id="7945579">4</span><span class="op" id="7945580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945583">b</span><span class="op" id="7945584">.</span><span class="ident" id="7945585">StartTimer</span><span class="op" id="7945595">(</span><span class="op" id="7945596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945599">for</span>&nbsp;<span class="ident" id="7945603">i</span>&nbsp;<span class="op" id="7945605">:=</span>&nbsp;<span class="num" id="7945608">0</span><span class="op" id="7945609">;</span>&nbsp;<span class="ident" id="7945611">i</span>&nbsp;<span class="op" id="7945613">&lt;</span>&nbsp;<span class="ident" id="7945615">b</span><span class="op" id="7945616">.</span><span class="ident" id="7945617">N</span><span class="op" id="7945618">;</span>&nbsp;<span class="ident" id="7945620">i</span><span class="op" id="7945621">++</span>&nbsp;<span class="op" id="7945624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945628">Encode</span><span class="op" id="7945634">(</span><span class="ident" id="7945635">ioutil</span><span class="op" id="7945641">.</span><span class="ident" id="7945642">Discard</span><span class="op" id="7945649">,</span>&nbsp;<span class="ident" id="7945651">img</span><span class="op" id="7945654">,</span>&nbsp;<span class="ident" id="7945656">nil</span><span class="op" id="7945659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945662">}</span><br>
<span class="lineno">205</span><span class="op" id="7945664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7945667">func</span>&nbsp;<span class="ident" id="7945672">BenchmarkQuantizedEncode</span><span class="op" id="7945696">(</span><span class="ident" id="7945697">b</span>&nbsp;<span class="op" id="7945699">*</span><span class="ident" id="7945700">testing</span><span class="op" id="7945707">.</span><span class="ident" id="7945708">B</span><span class="op" id="7945709">)</span>&nbsp;<span class="op" id="7945711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945714">b</span><span class="op" id="7945715">.</span><span class="ident" id="7945716">StopTimer</span><span class="op" id="7945725">(</span><span class="op" id="7945726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945729">img</span>&nbsp;<span class="op" id="7945733">:=</span>&nbsp;<span class="ident" id="7945736">image</span><span class="op" id="7945741">.</span><span class="ident" id="7945742">NewRGBA</span><span class="op" id="7945749">(</span><span class="ident" id="7945750">image</span><span class="op" id="7945755">.</span><span class="ident" id="7945756">Rect</span><span class="op" id="7945760">(</span><span class="num" id="7945761">0</span><span class="op" id="7945762">,</span>&nbsp;<span class="num" id="7945764">0</span><span class="op" id="7945765">,</span>&nbsp;<span class="num" id="7945767">640</span><span class="op" id="7945770">,</span>&nbsp;<span class="num" id="7945772">480</span><span class="op" id="7945775">)</span><span class="op" id="7945776">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945779">bo</span>&nbsp;<span class="op" id="7945782">:=</span>&nbsp;<span class="ident" id="7945785">img</span><span class="op" id="7945788">.</span><span class="ident" id="7945789">Bounds</span><span class="op" id="7945795">(</span><span class="op" id="7945796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945799">rnd</span>&nbsp;<span class="op" id="7945803">:=</span>&nbsp;<span class="ident" id="7945806">rand</span><span class="op" id="7945810">.</span><span class="ident" id="7945811">New</span><span class="op" id="7945814">(</span><span class="ident" id="7945815">rand</span><span class="op" id="7945819">.</span><span class="ident" id="7945820">NewSource</span><span class="op" id="7945829">(</span><span class="num" id="7945830">123</span><span class="op" id="7945833">)</span><span class="op" id="7945834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945837">for</span>&nbsp;<span class="ident" id="7945841">y</span>&nbsp;<span class="op" id="7945843">:=</span>&nbsp;<span class="ident" id="7945846">bo</span><span class="op" id="7945848">.</span><span class="ident" id="7945849">Min</span><span class="op" id="7945852">.</span><span class="ident" id="7945853">Y</span><span class="op" id="7945854">;</span>&nbsp;<span class="ident" id="7945856">y</span>&nbsp;<span class="op" id="7945858">&lt;</span>&nbsp;<span class="ident" id="7945860">bo</span><span class="op" id="7945862">.</span><span class="ident" id="7945863">Max</span><span class="op" id="7945866">.</span><span class="ident" id="7945867">Y</span><span class="op" id="7945868">;</span>&nbsp;<span class="ident" id="7945870">y</span><span class="op" id="7945871">++</span>&nbsp;<span class="op" id="7945874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945878">for</span>&nbsp;<span class="ident" id="7945882">x</span>&nbsp;<span class="op" id="7945884">:=</span>&nbsp;<span class="ident" id="7945887">bo</span><span class="op" id="7945889">.</span><span class="ident" id="7945890">Min</span><span class="op" id="7945893">.</span><span class="ident" id="7945894">X</span><span class="op" id="7945895">;</span>&nbsp;<span class="ident" id="7945897">x</span>&nbsp;<span class="op" id="7945899">&lt;</span>&nbsp;<span class="ident" id="7945901">bo</span><span class="op" id="7945903">.</span><span class="ident" id="7945904">Max</span><span class="op" id="7945907">.</span><span class="ident" id="7945908">X</span><span class="op" id="7945909">;</span>&nbsp;<span class="ident" id="7945911">x</span><span class="op" id="7945912">++</span>&nbsp;<span class="op" id="7945915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945920">img</span><span class="op" id="7945923">.</span><span class="ident" id="7945924">SetRGBA</span><span class="op" id="7945931">(</span><span class="ident" id="7945932">x</span><span class="op" id="7945933">,</span>&nbsp;<span class="ident" id="7945935">y</span><span class="op" id="7945936">,</span>&nbsp;<span class="ident" id="7945938">color</span><span class="op" id="7945943">.</span><span class="ident" id="7945944">RGBA</span><span class="op" id="7945948">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7945954">uint8</span><span class="op" id="7945959">(</span><span class="ident" id="7945960">rnd</span><span class="op" id="7945963">.</span><span class="ident" id="7945964">Intn</span><span class="op" id="7945968">(</span><span class="num" id="7945969">256</span><span class="op" id="7945972">)</span><span class="op" id="7945973">)</span><span class="op" id="7945974">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7945980">uint8</span><span class="op" id="7945985">(</span><span class="ident" id="7945986">rnd</span><span class="op" id="7945989">.</span><span class="ident" id="7945990">Intn</span><span class="op" id="7945994">(</span><span class="num" id="7945995">256</span><span class="op" id="7945998">)</span><span class="op" id="7945999">)</span><span class="op" id="7946000">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7946006">uint8</span><span class="op" id="7946011">(</span><span class="ident" id="7946012">rnd</span><span class="op" id="7946015">.</span><span class="ident" id="7946016">Intn</span><span class="op" id="7946020">(</span><span class="num" id="7946021">256</span><span class="op" id="7946024">)</span><span class="op" id="7946025">)</span><span class="op" id="7946026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7946032">255</span><span class="op" id="7946035">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946040">}</span><span class="op" id="7946041">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946051">b</span><span class="op" id="7946052">.</span><span class="ident" id="7946053">SetBytes</span><span class="op" id="7946061">(</span><span class="num" id="7946062">640</span>&nbsp;<span class="op" id="7946066">*</span>&nbsp;<span class="num" id="7946068">480</span>&nbsp;<span class="op" id="7946072">*</span>&nbsp;<span class="num" id="7946074">4</span><span class="op" id="7946075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946078">b</span><span class="op" id="7946079">.</span><span class="ident" id="7946080">StartTimer</span><span class="op" id="7946090">(</span><span class="op" id="7946091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946094">for</span>&nbsp;<span class="ident" id="7946098">i</span>&nbsp;<span class="op" id="7946100">:=</span>&nbsp;<span class="num" id="7946103">0</span><span class="op" id="7946104">;</span>&nbsp;<span class="ident" id="7946106">i</span>&nbsp;<span class="op" id="7946108">&lt;</span>&nbsp;<span class="ident" id="7946110">b</span><span class="op" id="7946111">.</span><span class="ident" id="7946112">N</span><span class="op" id="7946113">;</span>&nbsp;<span class="ident" id="7946115">i</span><span class="op" id="7946116">++</span>&nbsp;<span class="op" id="7946119">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946123">Encode</span><span class="op" id="7946129">(</span><span class="ident" id="7946130">ioutil</span><span class="op" id="7946136">.</span><span class="ident" id="7946137">Discard</span><span class="op" id="7946144">,</span>&nbsp;<span class="ident" id="7946146">img</span><span class="op" id="7946149">,</span>&nbsp;<span class="ident" id="7946151">nil</span><span class="op" id="7946154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946157">}</span><br>
<span class="lineno"></span><span class="op" id="7946159">}</span>
</div>
</body>
</html>
