<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/fcgi</h2>
<ul>
<li><a href="/gostd/net/http/fcgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi.go.html">fcgi.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi_test.go.html" class="current">fcgi_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8480060">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8480115">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8480169">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8480220">package</span>&nbsp;<span class="ident" id="8480228">fcgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8480234">import</span>&nbsp;<span class="op" id="8480241">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8480244">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8480253">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8480263">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8480269">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8480279">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8480282">var</span>&nbsp;<span class="ident" id="8480286">sizeTests</span>&nbsp;<span class="op" id="8480296">=</span>&nbsp;<span class="op" id="8480298">[</span><span class="op" id="8480299">]</span><span class="keyword" id="8480300">struct</span>&nbsp;<span class="op" id="8480307">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8480310">size</span>&nbsp;&nbsp;<span class="builtintype" id="8480316">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8480324">bytes</span>&nbsp;<span class="op" id="8480330">[</span><span class="op" id="8480331">]</span><span class="builtintype" id="8480332">byte</span><br>
<span class="lineno"></span><span class="op" id="8480337">}</span><span class="op" id="8480338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480341">{</span><span class="num" id="8480342">0</span><span class="op" id="8480343">,</span>&nbsp;<span class="op" id="8480345">[</span><span class="op" id="8480346">]</span><span class="builtintype" id="8480347">byte</span><span class="op" id="8480351">{</span><span class="num" id="8480352">0x00</span><span class="op" id="8480356">}</span><span class="op" id="8480357">}</span><span class="op" id="8480358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480361">{</span><span class="num" id="8480362">127</span><span class="op" id="8480365">,</span>&nbsp;<span class="op" id="8480367">[</span><span class="op" id="8480368">]</span><span class="builtintype" id="8480369">byte</span><span class="op" id="8480373">{</span><span class="num" id="8480374">0x7F</span><span class="op" id="8480378">}</span><span class="op" id="8480379">}</span><span class="op" id="8480380">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480383">{</span><span class="num" id="8480384">128</span><span class="op" id="8480387">,</span>&nbsp;<span class="op" id="8480389">[</span><span class="op" id="8480390">]</span><span class="builtintype" id="8480391">byte</span><span class="op" id="8480395">{</span><span class="num" id="8480396">0x80</span><span class="op" id="8480400">,</span>&nbsp;<span class="num" id="8480402">0x00</span><span class="op" id="8480406">,</span>&nbsp;<span class="num" id="8480408">0x00</span><span class="op" id="8480412">,</span>&nbsp;<span class="num" id="8480414">0x80</span><span class="op" id="8480418">}</span><span class="op" id="8480419">}</span><span class="op" id="8480420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480423">{</span><span class="num" id="8480424">1000</span><span class="op" id="8480428">,</span>&nbsp;<span class="op" id="8480430">[</span><span class="op" id="8480431">]</span><span class="builtintype" id="8480432">byte</span><span class="op" id="8480436">{</span><span class="num" id="8480437">0x80</span><span class="op" id="8480441">,</span>&nbsp;<span class="num" id="8480443">0x00</span><span class="op" id="8480447">,</span>&nbsp;<span class="num" id="8480449">0x03</span><span class="op" id="8480453">,</span>&nbsp;<span class="num" id="8480455">0xE8</span><span class="op" id="8480459">}</span><span class="op" id="8480460">}</span><span class="op" id="8480461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480464">{</span><span class="num" id="8480465">33554431</span><span class="op" id="8480473">,</span>&nbsp;<span class="op" id="8480475">[</span><span class="op" id="8480476">]</span><span class="builtintype" id="8480477">byte</span><span class="op" id="8480481">{</span><span class="num" id="8480482">0x81</span><span class="op" id="8480486">,</span>&nbsp;<span class="num" id="8480488">0xFF</span><span class="op" id="8480492">,</span>&nbsp;<span class="num" id="8480494">0xFF</span><span class="op" id="8480498">,</span>&nbsp;<span class="num" id="8480500">0xFF</span><span class="op" id="8480504">}</span><span class="op" id="8480505">}</span><span class="op" id="8480506">,</span><br>
<span class="lineno"></span><span class="op" id="8480508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8480511">func</span>&nbsp;<span class="ident" id="8480516">TestSize</span><span class="op" id="8480524">(</span><span class="ident" id="8480525">t</span>&nbsp;<span class="op" id="8480527">*</span><span class="ident" id="8480528">testing</span><span class="op" id="8480535">.</span><span class="ident" id="8480536">T</span><span class="op" id="8480537">)</span>&nbsp;<span class="op" id="8480539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8480542">b</span>&nbsp;<span class="op" id="8480544">:=</span>&nbsp;<span class="builtinfunc" id="8480547">make</span><span class="op" id="8480551">(</span><span class="op" id="8480552">[</span><span class="op" id="8480553">]</span><span class="builtintype" id="8480554">byte</span><span class="op" id="8480558">,</span>&nbsp;<span class="num" id="8480560">4</span><span class="op" id="8480561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8480564">for</span>&nbsp;<span class="ident" id="8480568">i</span><span class="op" id="8480569">,</span>&nbsp;<span class="ident" id="8480571">test</span>&nbsp;<span class="op" id="8480576">:=</span>&nbsp;<span class="keyword" id="8480579">range</span>&nbsp;<span class="ident" id="8480585">sizeTests</span>&nbsp;<span class="op" id="8480595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8480599">n</span>&nbsp;<span class="op" id="8480601">:=</span>&nbsp;<span class="ident" id="8480604">encodeSize</span><span class="op" id="8480614">(</span><span class="ident" id="8480615">b</span><span class="op" id="8480616">,</span>&nbsp;<span class="ident" id="8480618">test</span><span class="op" id="8480622">.</span><span class="ident" id="8480623">size</span><span class="op" id="8480627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8480631">if</span>&nbsp;<span class="op" id="8480634">!</span><span class="ident" id="8480635">bytes</span><span class="op" id="8480640">.</span><span class="ident" id="8480641">Equal</span><span class="op" id="8480646">(</span><span class="ident" id="8480647">b</span><span class="op" id="8480648">[</span><span class="op" id="8480649">:</span><span class="ident" id="8480650">n</span><span class="op" id="8480651">]</span><span class="op" id="8480652">,</span>&nbsp;<span class="ident" id="8480654">test</span><span class="op" id="8480658">.</span><span class="ident" id="8480659">bytes</span><span class="op" id="8480664">)</span>&nbsp;<span class="op" id="8480666">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8480671">t</span><span class="op" id="8480672">.</span><span class="ident" id="8480673">Errorf</span><span class="op" id="8480679">(</span><span class="string" id="8480680">&#34;%d&nbsp;expected&nbsp;%x,&nbsp;encoded&nbsp;%x&#34;</span><span class="op" id="8480708">,</span>&nbsp;<span class="ident" id="8480710">i</span><span class="op" id="8480711">,</span>&nbsp;<span class="ident" id="8480713">test</span><span class="op" id="8480717">.</span><span class="ident" id="8480718">bytes</span><span class="op" id="8480723">,</span>&nbsp;<span class="ident" id="8480725">b</span><span class="op" id="8480726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8480734">size</span><span class="op" id="8480738">,</span>&nbsp;<span class="ident" id="8480740">n</span>&nbsp;<span class="op" id="8480742">:=</span>&nbsp;<span class="ident" id="8480745">readSize</span><span class="op" id="8480753">(</span><span class="ident" id="8480754">test</span><span class="op" id="8480758">.</span><span class="ident" id="8480759">bytes</span><span class="op" id="8480764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8480768">if</span>&nbsp;<span class="ident" id="8480771">size</span>&nbsp;<span class="op" id="8480776">!=</span>&nbsp;<span class="ident" id="8480779">test</span><span class="op" id="8480783">.</span><span class="ident" id="8480784">size</span>&nbsp;<span class="op" id="8480789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8480794">t</span><span class="op" id="8480795">.</span><span class="ident" id="8480796">Errorf</span><span class="op" id="8480802">(</span><span class="string" id="8480803">&#34;%d&nbsp;expected&nbsp;%d,&nbsp;read&nbsp;%d&#34;</span><span class="op" id="8480828">,</span>&nbsp;<span class="ident" id="8480830">i</span><span class="op" id="8480831">,</span>&nbsp;<span class="ident" id="8480833">test</span><span class="op" id="8480837">.</span><span class="ident" id="8480838">size</span><span class="op" id="8480842">,</span>&nbsp;<span class="ident" id="8480844">size</span><span class="op" id="8480848">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8480856">if</span>&nbsp;<span class="builtinfunc" id="8480859">len</span><span class="op" id="8480862">(</span><span class="ident" id="8480863">test</span><span class="op" id="8480867">.</span><span class="ident" id="8480868">bytes</span><span class="op" id="8480873">)</span>&nbsp;<span class="op" id="8480875">!=</span>&nbsp;<span class="ident" id="8480878">n</span>&nbsp;<span class="op" id="8480880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8480885">t</span><span class="op" id="8480886">.</span><span class="ident" id="8480887">Errorf</span><span class="op" id="8480893">(</span><span class="string" id="8480894">&#34;%d&nbsp;did&nbsp;not&nbsp;consume&nbsp;all&nbsp;the&nbsp;bytes&#34;</span><span class="op" id="8480928">,</span>&nbsp;<span class="ident" id="8480930">i</span><span class="op" id="8480931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480938">}</span><br>
<span class="lineno">40</span><span class="op" id="8480940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8480943">var</span>&nbsp;<span class="ident" id="8480947">streamTests</span>&nbsp;<span class="op" id="8480959">=</span>&nbsp;<span class="op" id="8480961">[</span><span class="op" id="8480962">]</span><span class="keyword" id="8480963">struct</span>&nbsp;<span class="op" id="8480970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8480973">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8480981">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8480989">recType</span>&nbsp;<span class="ident" id="8480997">recType</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481006">reqId</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8481014">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481022">content</span>&nbsp;<span class="op" id="8481030">[</span><span class="op" id="8481031">]</span><span class="builtintype" id="8481032">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481038">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481046">[</span><span class="op" id="8481047">]</span><span class="builtintype" id="8481048">byte</span><br>
<span class="lineno"></span><span class="op" id="8481053">}</span><span class="op" id="8481054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481057">{</span><span class="string" id="8481058">&#34;single&nbsp;record&#34;</span><span class="op" id="8481073">,</span>&nbsp;<span class="ident" id="8481075">typeStdout</span><span class="op" id="8481085">,</span>&nbsp;<span class="num" id="8481087">1</span><span class="op" id="8481088">,</span>&nbsp;<span class="builtintype" id="8481090">nil</span><span class="op" id="8481093">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481097">[</span><span class="op" id="8481098">]</span><span class="builtintype" id="8481099">byte</span><span class="op" id="8481103">{</span><span class="num" id="8481104">1</span><span class="op" id="8481105">,</span>&nbsp;<span class="builtintype" id="8481107">byte</span><span class="op" id="8481111">(</span><span class="ident" id="8481112">typeStdout</span><span class="op" id="8481122">)</span><span class="op" id="8481123">,</span>&nbsp;<span class="num" id="8481125">0</span><span class="op" id="8481126">,</span>&nbsp;<span class="num" id="8481128">1</span><span class="op" id="8481129">,</span>&nbsp;<span class="num" id="8481131">0</span><span class="op" id="8481132">,</span>&nbsp;<span class="num" id="8481134">0</span><span class="op" id="8481135">,</span>&nbsp;<span class="num" id="8481137">0</span><span class="op" id="8481138">,</span>&nbsp;<span class="num" id="8481140">0</span><span class="op" id="8481141">}</span><span class="op" id="8481142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481145">}</span><span class="op" id="8481146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8481149">//&nbsp;this&nbsp;data&nbsp;will&nbsp;have&nbsp;to&nbsp;be&nbsp;split&nbsp;into&nbsp;two&nbsp;records</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481202">{</span><span class="string" id="8481203">&#34;two&nbsp;records&#34;</span><span class="op" id="8481216">,</span>&nbsp;<span class="ident" id="8481218">typeStdin</span><span class="op" id="8481227">,</span>&nbsp;<span class="num" id="8481229">300</span><span class="op" id="8481232">,</span>&nbsp;<span class="builtinfunc" id="8481234">make</span><span class="op" id="8481238">(</span><span class="op" id="8481239">[</span><span class="op" id="8481240">]</span><span class="builtintype" id="8481241">byte</span><span class="op" id="8481245">,</span>&nbsp;<span class="num" id="8481247">66000</span><span class="op" id="8481252">)</span><span class="op" id="8481253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481257">bytes</span><span class="op" id="8481262">.</span><span class="ident" id="8481263">Join</span><span class="op" id="8481267">(</span><span class="op" id="8481268">[</span><span class="op" id="8481269">]</span><span class="op" id="8481270">[</span><span class="op" id="8481271">]</span><span class="builtintype" id="8481272">byte</span><span class="op" id="8481276">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8481281">//&nbsp;header&nbsp;for&nbsp;the&nbsp;first&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481315">{</span><span class="num" id="8481316">1</span><span class="op" id="8481317">,</span>&nbsp;<span class="builtintype" id="8481319">byte</span><span class="op" id="8481323">(</span><span class="ident" id="8481324">typeStdin</span><span class="op" id="8481333">)</span><span class="op" id="8481334">,</span>&nbsp;<span class="num" id="8481336">0x01</span><span class="op" id="8481340">,</span>&nbsp;<span class="num" id="8481342">0x2C</span><span class="op" id="8481346">,</span>&nbsp;<span class="num" id="8481348">0xFF</span><span class="op" id="8481352">,</span>&nbsp;<span class="num" id="8481354">0xFF</span><span class="op" id="8481358">,</span>&nbsp;<span class="num" id="8481360">1</span><span class="op" id="8481361">,</span>&nbsp;<span class="num" id="8481363">0</span><span class="op" id="8481364">}</span><span class="op" id="8481365">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8481370">make</span><span class="op" id="8481374">(</span><span class="op" id="8481375">[</span><span class="op" id="8481376">]</span><span class="builtintype" id="8481377">byte</span><span class="op" id="8481381">,</span>&nbsp;<span class="num" id="8481383">65536</span><span class="op" id="8481388">)</span><span class="op" id="8481389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8481394">//&nbsp;header&nbsp;for&nbsp;the&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481422">{</span><span class="num" id="8481423">1</span><span class="op" id="8481424">,</span>&nbsp;<span class="builtintype" id="8481426">byte</span><span class="op" id="8481430">(</span><span class="ident" id="8481431">typeStdin</span><span class="op" id="8481440">)</span><span class="op" id="8481441">,</span>&nbsp;<span class="num" id="8481443">0x01</span><span class="op" id="8481447">,</span>&nbsp;<span class="num" id="8481449">0x2C</span><span class="op" id="8481453">,</span>&nbsp;<span class="num" id="8481455">0x01</span><span class="op" id="8481459">,</span>&nbsp;<span class="num" id="8481461">0xD1</span><span class="op" id="8481465">,</span>&nbsp;<span class="num" id="8481467">7</span><span class="op" id="8481468">,</span>&nbsp;<span class="num" id="8481470">0</span><span class="op" id="8481471">}</span><span class="op" id="8481472">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8481477">make</span><span class="op" id="8481481">(</span><span class="op" id="8481482">[</span><span class="op" id="8481483">]</span><span class="builtintype" id="8481484">byte</span><span class="op" id="8481488">,</span>&nbsp;<span class="num" id="8481490">472</span><span class="op" id="8481493">)</span><span class="op" id="8481494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8481499">//&nbsp;header&nbsp;for&nbsp;the&nbsp;empty&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481533">{</span><span class="num" id="8481534">1</span><span class="op" id="8481535">,</span>&nbsp;<span class="builtintype" id="8481537">byte</span><span class="op" id="8481541">(</span><span class="ident" id="8481542">typeStdin</span><span class="op" id="8481551">)</span><span class="op" id="8481552">,</span>&nbsp;<span class="num" id="8481554">0x01</span><span class="op" id="8481558">,</span>&nbsp;<span class="num" id="8481560">0x2C</span><span class="op" id="8481564">,</span>&nbsp;<span class="num" id="8481566">0</span><span class="op" id="8481567">,</span>&nbsp;<span class="num" id="8481569">0</span><span class="op" id="8481570">,</span>&nbsp;<span class="num" id="8481572">0</span><span class="op" id="8481573">,</span>&nbsp;<span class="num" id="8481575">0</span><span class="op" id="8481576">}</span><span class="op" id="8481577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481581">}</span><span class="op" id="8481582">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8481587">nil</span><span class="op" id="8481590">)</span><span class="op" id="8481591">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481594">}</span><span class="op" id="8481595">,</span><br>
<span class="lineno"></span><span class="op" id="8481597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8481600">type</span>&nbsp;<span class="ident" id="8481605">nilCloser</span>&nbsp;<span class="keyword" id="8481615">struct</span>&nbsp;<span class="op" id="8481622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481625">io</span><span class="op" id="8481627">.</span><span class="ident" id="8481628">ReadWriter</span><br>
<span class="lineno">70</span><span class="op" id="8481639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8481642">func</span>&nbsp;<span class="op" id="8481647">(</span><span class="ident" id="8481648">c</span>&nbsp;<span class="op" id="8481650">*</span><span class="ident" id="8481651">nilCloser</span><span class="op" id="8481660">)</span>&nbsp;<span class="ident" id="8481662">Close</span><span class="op" id="8481667">(</span><span class="op" id="8481668">)</span>&nbsp;<span class="builtintype" id="8481670">error</span>&nbsp;<span class="op" id="8481676">{</span>&nbsp;<span class="keyword" id="8481678">return</span>&nbsp;<span class="builtintype" id="8481685">nil</span>&nbsp;<span class="op" id="8481689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8481692">func</span>&nbsp;<span class="ident" id="8481697">TestStreams</span><span class="op" id="8481708">(</span><span class="ident" id="8481709">t</span>&nbsp;<span class="op" id="8481711">*</span><span class="ident" id="8481712">testing</span><span class="op" id="8481719">.</span><span class="ident" id="8481720">T</span><span class="op" id="8481721">)</span>&nbsp;<span class="op" id="8481723">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8481726">var</span>&nbsp;<span class="ident" id="8481730">rec</span>&nbsp;<span class="ident" id="8481734">record</span><br>
<span class="lineno"></span><span class="ident" id="8481741">outer</span><span class="op" id="8481746">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8481749">for</span>&nbsp;<span class="ident" id="8481753">_</span><span class="op" id="8481754">,</span>&nbsp;<span class="ident" id="8481756">test</span>&nbsp;<span class="op" id="8481761">:=</span>&nbsp;<span class="keyword" id="8481764">range</span>&nbsp;<span class="ident" id="8481770">streamTests</span>&nbsp;<span class="op" id="8481782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481786">buf</span>&nbsp;<span class="op" id="8481790">:=</span>&nbsp;<span class="ident" id="8481793">bytes</span><span class="op" id="8481798">.</span><span class="ident" id="8481799">NewBuffer</span><span class="op" id="8481808">(</span><span class="ident" id="8481809">test</span><span class="op" id="8481813">.</span><span class="ident" id="8481814">raw</span><span class="op" id="8481817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8481821">var</span>&nbsp;<span class="ident" id="8481825">content</span>&nbsp;<span class="op" id="8481833">[</span><span class="op" id="8481834">]</span><span class="builtintype" id="8481835">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8481842">for</span>&nbsp;<span class="ident" id="8481846">buf</span><span class="op" id="8481849">.</span><span class="ident" id="8481850">Len</span><span class="op" id="8481853">(</span><span class="op" id="8481854">)</span>&nbsp;<span class="op" id="8481856">&gt;</span>&nbsp;<span class="num" id="8481858">0</span>&nbsp;<span class="op" id="8481860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8481865">if</span>&nbsp;<span class="ident" id="8481868">err</span>&nbsp;<span class="op" id="8481872">:=</span>&nbsp;<span class="ident" id="8481875">rec</span><span class="op" id="8481878">.</span><span class="ident" id="8481879">read</span><span class="op" id="8481883">(</span><span class="ident" id="8481884">buf</span><span class="op" id="8481887">)</span><span class="op" id="8481888">;</span>&nbsp;<span class="ident" id="8481890">err</span>&nbsp;<span class="op" id="8481894">!=</span>&nbsp;<span class="builtintype" id="8481897">nil</span>&nbsp;<span class="op" id="8481901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481907">t</span><span class="op" id="8481908">.</span><span class="ident" id="8481909">Errorf</span><span class="op" id="8481915">(</span><span class="string" id="8481916">&#34;%s:&nbsp;error&nbsp;reading&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="8481946">,</span>&nbsp;<span class="ident" id="8481948">test</span><span class="op" id="8481952">.</span><span class="ident" id="8481953">desc</span><span class="op" id="8481957">,</span>&nbsp;<span class="ident" id="8481959">err</span><span class="op" id="8481962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8481968">continue</span>&nbsp;<span class="ident" id="8481977">outer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481986">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481991">content</span>&nbsp;<span class="op" id="8481999">=</span>&nbsp;<span class="builtinfunc" id="8482001">append</span><span class="op" id="8482007">(</span><span class="ident" id="8482008">content</span><span class="op" id="8482015">,</span>&nbsp;<span class="ident" id="8482017">rec</span><span class="op" id="8482020">.</span><span class="ident" id="8482021">content</span><span class="op" id="8482028">(</span><span class="op" id="8482029">)</span><span class="op" id="8482030">...</span><span class="op" id="8482033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8482037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8482041">if</span>&nbsp;<span class="ident" id="8482044">rec</span><span class="op" id="8482047">.</span><span class="ident" id="8482048">h</span><span class="op" id="8482049">.</span><span class="ident" id="8482050">Type</span>&nbsp;<span class="op" id="8482055">!=</span>&nbsp;<span class="ident" id="8482058">test</span><span class="op" id="8482062">.</span><span class="ident" id="8482063">recType</span>&nbsp;<span class="op" id="8482071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482076">t</span><span class="op" id="8482077">.</span><span class="ident" id="8482078">Errorf</span><span class="op" id="8482084">(</span><span class="string" id="8482085">&#34;%s:&nbsp;got&nbsp;type&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8482114">,</span>&nbsp;<span class="ident" id="8482116">test</span><span class="op" id="8482120">.</span><span class="ident" id="8482121">desc</span><span class="op" id="8482125">,</span>&nbsp;<span class="ident" id="8482127">rec</span><span class="op" id="8482130">.</span><span class="ident" id="8482131">h</span><span class="op" id="8482132">.</span><span class="ident" id="8482133">Type</span><span class="op" id="8482137">,</span>&nbsp;<span class="ident" id="8482139">test</span><span class="op" id="8482143">.</span><span class="ident" id="8482144">recType</span><span class="op" id="8482151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8482156">continue</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8482167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8482171">if</span>&nbsp;<span class="ident" id="8482174">rec</span><span class="op" id="8482177">.</span><span class="ident" id="8482178">h</span><span class="op" id="8482179">.</span><span class="ident" id="8482180">Id</span>&nbsp;<span class="op" id="8482183">!=</span>&nbsp;<span class="ident" id="8482186">test</span><span class="op" id="8482190">.</span><span class="ident" id="8482191">reqId</span>&nbsp;<span class="op" id="8482197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482202">t</span><span class="op" id="8482203">.</span><span class="ident" id="8482204">Errorf</span><span class="op" id="8482210">(</span><span class="string" id="8482211">&#34;%s:&nbsp;got&nbsp;request&nbsp;ID&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8482246">,</span>&nbsp;<span class="ident" id="8482248">test</span><span class="op" id="8482252">.</span><span class="ident" id="8482253">desc</span><span class="op" id="8482257">,</span>&nbsp;<span class="ident" id="8482259">rec</span><span class="op" id="8482262">.</span><span class="ident" id="8482263">h</span><span class="op" id="8482264">.</span><span class="ident" id="8482265">Id</span><span class="op" id="8482267">,</span>&nbsp;<span class="ident" id="8482269">test</span><span class="op" id="8482273">.</span><span class="ident" id="8482274">reqId</span><span class="op" id="8482279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8482284">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8482295">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8482299">if</span>&nbsp;<span class="op" id="8482302">!</span><span class="ident" id="8482303">bytes</span><span class="op" id="8482308">.</span><span class="ident" id="8482309">Equal</span><span class="op" id="8482314">(</span><span class="ident" id="8482315">content</span><span class="op" id="8482322">,</span>&nbsp;<span class="ident" id="8482324">test</span><span class="op" id="8482328">.</span><span class="ident" id="8482329">content</span><span class="op" id="8482336">)</span>&nbsp;<span class="op" id="8482338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482343">t</span><span class="op" id="8482344">.</span><span class="ident" id="8482345">Errorf</span><span class="op" id="8482351">(</span><span class="string" id="8482352">&#34;%s:&nbsp;read&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="8482376">,</span>&nbsp;<span class="ident" id="8482378">test</span><span class="op" id="8482382">.</span><span class="ident" id="8482383">desc</span><span class="op" id="8482387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8482392">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8482403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482407">buf</span><span class="op" id="8482410">.</span><span class="ident" id="8482411">Reset</span><span class="op" id="8482416">(</span><span class="op" id="8482417">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482421">c</span>&nbsp;<span class="op" id="8482423">:=</span>&nbsp;<span class="ident" id="8482426">newConn</span><span class="op" id="8482433">(</span><span class="op" id="8482434">&amp;</span><span class="ident" id="8482435">nilCloser</span><span class="op" id="8482444">{</span><span class="ident" id="8482445">buf</span><span class="op" id="8482448">}</span><span class="op" id="8482449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482453">w</span>&nbsp;<span class="op" id="8482455">:=</span>&nbsp;<span class="ident" id="8482458">newWriter</span><span class="op" id="8482467">(</span><span class="ident" id="8482468">c</span><span class="op" id="8482469">,</span>&nbsp;<span class="ident" id="8482471">test</span><span class="op" id="8482475">.</span><span class="ident" id="8482476">recType</span><span class="op" id="8482483">,</span>&nbsp;<span class="ident" id="8482485">test</span><span class="op" id="8482489">.</span><span class="ident" id="8482490">reqId</span><span class="op" id="8482495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8482499">if</span>&nbsp;<span class="ident" id="8482502">_</span><span class="op" id="8482503">,</span>&nbsp;<span class="ident" id="8482505">err</span>&nbsp;<span class="op" id="8482509">:=</span>&nbsp;<span class="ident" id="8482512">w</span><span class="op" id="8482513">.</span><span class="ident" id="8482514">Write</span><span class="op" id="8482519">(</span><span class="ident" id="8482520">test</span><span class="op" id="8482524">.</span><span class="ident" id="8482525">content</span><span class="op" id="8482532">)</span><span class="op" id="8482533">;</span>&nbsp;<span class="ident" id="8482535">err</span>&nbsp;<span class="op" id="8482539">!=</span>&nbsp;<span class="builtintype" id="8482542">nil</span>&nbsp;<span class="op" id="8482546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482551">t</span><span class="op" id="8482552">.</span><span class="ident" id="8482553">Errorf</span><span class="op" id="8482559">(</span><span class="string" id="8482560">&#34;%s:&nbsp;error&nbsp;writing&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="8482590">,</span>&nbsp;<span class="ident" id="8482592">test</span><span class="op" id="8482596">.</span><span class="ident" id="8482597">desc</span><span class="op" id="8482601">,</span>&nbsp;<span class="ident" id="8482603">err</span><span class="op" id="8482606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8482611">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8482622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8482626">if</span>&nbsp;<span class="ident" id="8482629">err</span>&nbsp;<span class="op" id="8482633">:=</span>&nbsp;<span class="ident" id="8482636">w</span><span class="op" id="8482637">.</span><span class="ident" id="8482638">Close</span><span class="op" id="8482643">(</span><span class="op" id="8482644">)</span><span class="op" id="8482645">;</span>&nbsp;<span class="ident" id="8482647">err</span>&nbsp;<span class="op" id="8482651">!=</span>&nbsp;<span class="builtintype" id="8482654">nil</span>&nbsp;<span class="op" id="8482658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482663">t</span><span class="op" id="8482664">.</span><span class="ident" id="8482665">Errorf</span><span class="op" id="8482671">(</span><span class="string" id="8482672">&#34;%s:&nbsp;error&nbsp;closing&nbsp;stream:&nbsp;%v&#34;</span><span class="op" id="8482702">,</span>&nbsp;<span class="ident" id="8482704">test</span><span class="op" id="8482708">.</span><span class="ident" id="8482709">desc</span><span class="op" id="8482713">,</span>&nbsp;<span class="ident" id="8482715">err</span><span class="op" id="8482718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8482723">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8482734">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8482738">if</span>&nbsp;<span class="op" id="8482741">!</span><span class="ident" id="8482742">bytes</span><span class="op" id="8482747">.</span><span class="ident" id="8482748">Equal</span><span class="op" id="8482753">(</span><span class="ident" id="8482754">buf</span><span class="op" id="8482757">.</span><span class="ident" id="8482758">Bytes</span><span class="op" id="8482763">(</span><span class="op" id="8482764">)</span><span class="op" id="8482765">,</span>&nbsp;<span class="ident" id="8482767">test</span><span class="op" id="8482771">.</span><span class="ident" id="8482772">raw</span><span class="op" id="8482775">)</span>&nbsp;<span class="op" id="8482777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482782">t</span><span class="op" id="8482783">.</span><span class="ident" id="8482784">Errorf</span><span class="op" id="8482790">(</span><span class="string" id="8482791">&#34;%s:&nbsp;wrote&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="8482816">,</span>&nbsp;<span class="ident" id="8482818">test</span><span class="op" id="8482822">.</span><span class="ident" id="8482823">desc</span><span class="op" id="8482827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8482831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8482834">}</span><br>
<span class="lineno"></span><span class="op" id="8482836">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="8482839">type</span>&nbsp;<span class="ident" id="8482844">writeOnlyConn</span>&nbsp;<span class="keyword" id="8482858">struct</span>&nbsp;<span class="op" id="8482865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482868">buf</span>&nbsp;<span class="op" id="8482872">[</span><span class="op" id="8482873">]</span><span class="builtintype" id="8482874">byte</span><br>
<span class="lineno"></span><span class="op" id="8482879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8482882">func</span>&nbsp;<span class="op" id="8482887">(</span><span class="ident" id="8482888">c</span>&nbsp;<span class="op" id="8482890">*</span><span class="ident" id="8482891">writeOnlyConn</span><span class="op" id="8482904">)</span>&nbsp;<span class="ident" id="8482906">Write</span><span class="op" id="8482911">(</span><span class="ident" id="8482912">p</span>&nbsp;<span class="op" id="8482914">[</span><span class="op" id="8482915">]</span><span class="builtintype" id="8482916">byte</span><span class="op" id="8482920">)</span>&nbsp;<span class="op" id="8482922">(</span><span class="builtintype" id="8482923">int</span><span class="op" id="8482926">,</span>&nbsp;<span class="builtintype" id="8482928">error</span><span class="op" id="8482933">)</span>&nbsp;<span class="op" id="8482935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482938">c</span><span class="op" id="8482939">.</span><span class="ident" id="8482940">buf</span>&nbsp;<span class="op" id="8482944">=</span>&nbsp;<span class="builtinfunc" id="8482946">append</span><span class="op" id="8482952">(</span><span class="ident" id="8482953">c</span><span class="op" id="8482954">.</span><span class="ident" id="8482955">buf</span><span class="op" id="8482958">,</span>&nbsp;<span class="ident" id="8482960">p</span><span class="op" id="8482961">...</span><span class="op" id="8482964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8482967">return</span>&nbsp;<span class="builtinfunc" id="8482974">len</span><span class="op" id="8482977">(</span><span class="ident" id="8482978">p</span><span class="op" id="8482979">)</span><span class="op" id="8482980">,</span>&nbsp;<span class="builtintype" id="8482982">nil</span><br>
<span class="lineno"></span><span class="op" id="8482986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="8482989">func</span>&nbsp;<span class="op" id="8482994">(</span><span class="ident" id="8482995">c</span>&nbsp;<span class="op" id="8482997">*</span><span class="ident" id="8482998">writeOnlyConn</span><span class="op" id="8483011">)</span>&nbsp;<span class="ident" id="8483013">Read</span><span class="op" id="8483017">(</span><span class="ident" id="8483018">p</span>&nbsp;<span class="op" id="8483020">[</span><span class="op" id="8483021">]</span><span class="builtintype" id="8483022">byte</span><span class="op" id="8483026">)</span>&nbsp;<span class="op" id="8483028">(</span><span class="builtintype" id="8483029">int</span><span class="op" id="8483032">,</span>&nbsp;<span class="builtintype" id="8483034">error</span><span class="op" id="8483039">)</span>&nbsp;<span class="op" id="8483041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8483044">return</span>&nbsp;<span class="num" id="8483051">0</span><span class="op" id="8483052">,</span>&nbsp;<span class="ident" id="8483054">errors</span><span class="op" id="8483060">.</span><span class="ident" id="8483061">New</span><span class="op" id="8483064">(</span><span class="string" id="8483065">&#34;conn&nbsp;is&nbsp;write-only&#34;</span><span class="op" id="8483085">)</span><br>
<span class="lineno"></span><span class="op" id="8483087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8483090">func</span>&nbsp;<span class="op" id="8483095">(</span><span class="ident" id="8483096">c</span>&nbsp;<span class="op" id="8483098">*</span><span class="ident" id="8483099">writeOnlyConn</span><span class="op" id="8483112">)</span>&nbsp;<span class="ident" id="8483114">Close</span><span class="op" id="8483119">(</span><span class="op" id="8483120">)</span>&nbsp;<span class="builtintype" id="8483122">error</span>&nbsp;<span class="op" id="8483128">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8483131">return</span>&nbsp;<span class="builtintype" id="8483138">nil</span><br>
<span class="lineno"></span><span class="op" id="8483142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8483145">func</span>&nbsp;<span class="ident" id="8483150">TestGetValues</span><span class="op" id="8483163">(</span><span class="ident" id="8483164">t</span>&nbsp;<span class="op" id="8483166">*</span><span class="ident" id="8483167">testing</span><span class="op" id="8483174">.</span><span class="ident" id="8483175">T</span><span class="op" id="8483176">)</span>&nbsp;<span class="op" id="8483178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8483181">var</span>&nbsp;<span class="ident" id="8483185">rec</span>&nbsp;<span class="ident" id="8483189">record</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483197">rec</span><span class="op" id="8483200">.</span><span class="ident" id="8483201">h</span><span class="op" id="8483202">.</span><span class="ident" id="8483203">Type</span>&nbsp;<span class="op" id="8483208">=</span>&nbsp;<span class="ident" id="8483210">typeGetValues</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483226">wc</span>&nbsp;<span class="op" id="8483229">:=</span>&nbsp;<span class="builtinfunc" id="8483232">new</span><span class="op" id="8483235">(</span><span class="ident" id="8483236">writeOnlyConn</span><span class="op" id="8483249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483252">c</span>&nbsp;<span class="op" id="8483254">:=</span>&nbsp;<span class="ident" id="8483257">newChild</span><span class="op" id="8483265">(</span><span class="ident" id="8483266">wc</span><span class="op" id="8483268">,</span>&nbsp;<span class="builtintype" id="8483270">nil</span><span class="op" id="8483273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483276">err</span>&nbsp;<span class="op" id="8483280">:=</span>&nbsp;<span class="ident" id="8483283">c</span><span class="op" id="8483284">.</span><span class="ident" id="8483285">handleRecord</span><span class="op" id="8483297">(</span><span class="op" id="8483298">&amp;</span><span class="ident" id="8483299">rec</span><span class="op" id="8483302">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8483305">if</span>&nbsp;<span class="ident" id="8483308">err</span>&nbsp;<span class="op" id="8483312">!=</span>&nbsp;<span class="builtintype" id="8483315">nil</span>&nbsp;<span class="op" id="8483319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483323">t</span><span class="op" id="8483324">.</span><span class="ident" id="8483325">Fatalf</span><span class="op" id="8483331">(</span><span class="string" id="8483332">&#34;handleRecord:&nbsp;%v&#34;</span><span class="op" id="8483350">,</span>&nbsp;<span class="ident" id="8483352">err</span><span class="op" id="8483355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8483358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8483362">const</span>&nbsp;<span class="ident" id="8483368">want</span>&nbsp;<span class="op" id="8483373">=</span>&nbsp;<span class="string" id="8483375">&#34;\x01\n\x00\x00\x00\x12\x06\x00&#34;</span>&nbsp;<span class="op" id="8483408">+</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8483412">&#34;\x0f\x01FCGI_MPXS_CONNS1&#34;</span>&nbsp;<span class="op" id="8483439">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8483443">&#34;\x00\x00\x00\x00\x00\x00\x01\n\x00\x00\x00\x00\x00\x00&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8483501">if</span>&nbsp;<span class="ident" id="8483504">got</span>&nbsp;<span class="op" id="8483508">:=</span>&nbsp;<span class="builtintype" id="8483511">string</span><span class="op" id="8483517">(</span><span class="ident" id="8483518">wc</span><span class="op" id="8483520">.</span><span class="ident" id="8483521">buf</span><span class="op" id="8483524">)</span><span class="op" id="8483525">;</span>&nbsp;<span class="ident" id="8483527">got</span>&nbsp;<span class="op" id="8483531">!=</span>&nbsp;<span class="ident" id="8483534">want</span>&nbsp;<span class="op" id="8483539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483543">t</span><span class="op" id="8483544">.</span><span class="ident" id="8483545">Errorf</span><span class="op" id="8483551">(</span><span class="string" id="8483552">&#34;&nbsp;got:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="8483574">,</span>&nbsp;<span class="ident" id="8483576">got</span><span class="op" id="8483579">,</span>&nbsp;<span class="ident" id="8483581">want</span><span class="op" id="8483585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8483588">}</span><br>
<span class="lineno">150</span><span class="op" id="8483590">}</span>
</div>
</body>
</html>
