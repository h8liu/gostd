<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6062505">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6062560">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6062614">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6062665">package</span>&nbsp;<span class="ident" id="6062673">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6062679">import</span>&nbsp;<span class="op" id="6062686">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6062689">&#34;image&#34;</span><br>
<span class="lineno"></span><span class="op" id="6062697">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="6062700">//&nbsp;makeImg&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;the&nbsp;destination&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6062760">func</span>&nbsp;<span class="op" id="6062765">(</span><span class="ident" id="6062766">d</span>&nbsp;<span class="op" id="6062768">*</span><span class="ident" id="6062769">decoder</span><span class="op" id="6062776">)</span>&nbsp;<span class="ident" id="6062778">makeImg</span><span class="op" id="6062785">(</span><span class="ident" id="6062786">h0</span><span class="op" id="6062788">,</span>&nbsp;<span class="ident" id="6062790">v0</span><span class="op" id="6062792">,</span>&nbsp;<span class="ident" id="6062794">mxx</span><span class="op" id="6062797">,</span>&nbsp;<span class="ident" id="6062799">myy</span>&nbsp;<span class="builtintype" id="6062803">int</span><span class="op" id="6062806">)</span>&nbsp;<span class="op" id="6062808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062811">if</span>&nbsp;<span class="ident" id="6062814">d</span><span class="op" id="6062815">.</span><span class="ident" id="6062816">nComp</span>&nbsp;<span class="op" id="6062822">==</span>&nbsp;<span class="ident" id="6062825">nGrayComponent</span>&nbsp;<span class="op" id="6062840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062844">m</span>&nbsp;<span class="op" id="6062846">:=</span>&nbsp;<span class="ident" id="6062849">image</span><span class="op" id="6062854">.</span><span class="ident" id="6062855">NewGray</span><span class="op" id="6062862">(</span><span class="ident" id="6062863">image</span><span class="op" id="6062868">.</span><span class="ident" id="6062869">Rect</span><span class="op" id="6062873">(</span><span class="num" id="6062874">0</span><span class="op" id="6062875">,</span>&nbsp;<span class="num" id="6062877">0</span><span class="op" id="6062878">,</span>&nbsp;<span class="num" id="6062880">8</span><span class="op" id="6062881">*</span><span class="ident" id="6062882">mxx</span><span class="op" id="6062885">,</span>&nbsp;<span class="num" id="6062887">8</span><span class="op" id="6062888">*</span><span class="ident" id="6062889">myy</span><span class="op" id="6062892">)</span><span class="op" id="6062893">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062897">d</span><span class="op" id="6062898">.</span><span class="ident" id="6062899">img1</span>&nbsp;<span class="op" id="6062904">=</span>&nbsp;<span class="ident" id="6062906">m</span><span class="op" id="6062907">.</span><span class="ident" id="6062908">SubImage</span><span class="op" id="6062916">(</span><span class="ident" id="6062917">image</span><span class="op" id="6062922">.</span><span class="ident" id="6062923">Rect</span><span class="op" id="6062927">(</span><span class="num" id="6062928">0</span><span class="op" id="6062929">,</span>&nbsp;<span class="num" id="6062931">0</span><span class="op" id="6062932">,</span>&nbsp;<span class="ident" id="6062934">d</span><span class="op" id="6062935">.</span><span class="ident" id="6062936">width</span><span class="op" id="6062941">,</span>&nbsp;<span class="ident" id="6062943">d</span><span class="op" id="6062944">.</span><span class="ident" id="6062945">height</span><span class="op" id="6062951">)</span><span class="op" id="6062952">)</span><span class="op" id="6062953">.</span><span class="op" id="6062954">(</span><span class="op" id="6062955">*</span><span class="ident" id="6062956">image</span><span class="op" id="6062961">.</span><span class="ident" id="6062962">Gray</span><span class="op" id="6062966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062970">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062981">var</span>&nbsp;<span class="ident" id="6062985">subsampleRatio</span>&nbsp;<span class="ident" id="6063000">image</span><span class="op" id="6063005">.</span><span class="ident" id="6063006">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063027">switch</span>&nbsp;<span class="op" id="6063034">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063037">case</span>&nbsp;<span class="ident" id="6063042">h0</span>&nbsp;<span class="op" id="6063045">==</span>&nbsp;<span class="num" id="6063048">1</span>&nbsp;<span class="op" id="6063050">&amp;&amp;</span>&nbsp;<span class="ident" id="6063053">v0</span>&nbsp;<span class="op" id="6063056">==</span>&nbsp;<span class="num" id="6063059">1</span><span class="op" id="6063060">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063064">subsampleRatio</span>&nbsp;<span class="op" id="6063079">=</span>&nbsp;<span class="ident" id="6063081">image</span><span class="op" id="6063086">.</span><span class="ident" id="6063087">YCbCrSubsampleRatio444</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063111">case</span>&nbsp;<span class="ident" id="6063116">h0</span>&nbsp;<span class="op" id="6063119">==</span>&nbsp;<span class="num" id="6063122">1</span>&nbsp;<span class="op" id="6063124">&amp;&amp;</span>&nbsp;<span class="ident" id="6063127">v0</span>&nbsp;<span class="op" id="6063130">==</span>&nbsp;<span class="num" id="6063133">2</span><span class="op" id="6063134">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063138">subsampleRatio</span>&nbsp;<span class="op" id="6063153">=</span>&nbsp;<span class="ident" id="6063155">image</span><span class="op" id="6063160">.</span><span class="ident" id="6063161">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063185">case</span>&nbsp;<span class="ident" id="6063190">h0</span>&nbsp;<span class="op" id="6063193">==</span>&nbsp;<span class="num" id="6063196">2</span>&nbsp;<span class="op" id="6063198">&amp;&amp;</span>&nbsp;<span class="ident" id="6063201">v0</span>&nbsp;<span class="op" id="6063204">==</span>&nbsp;<span class="num" id="6063207">1</span><span class="op" id="6063208">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063212">subsampleRatio</span>&nbsp;<span class="op" id="6063227">=</span>&nbsp;<span class="ident" id="6063229">image</span><span class="op" id="6063234">.</span><span class="ident" id="6063235">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063259">case</span>&nbsp;<span class="ident" id="6063264">h0</span>&nbsp;<span class="op" id="6063267">==</span>&nbsp;<span class="num" id="6063270">2</span>&nbsp;<span class="op" id="6063272">&amp;&amp;</span>&nbsp;<span class="ident" id="6063275">v0</span>&nbsp;<span class="op" id="6063278">==</span>&nbsp;<span class="num" id="6063281">2</span><span class="op" id="6063282">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063286">subsampleRatio</span>&nbsp;<span class="op" id="6063301">=</span>&nbsp;<span class="ident" id="6063303">image</span><span class="op" id="6063308">.</span><span class="ident" id="6063309">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063333">default</span><span class="op" id="6063340">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6063344">panic</span><span class="op" id="6063349">(</span><span class="string" id="6063350">&#34;unreachable&#34;</span><span class="op" id="6063363">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063369">m</span>&nbsp;<span class="op" id="6063371">:=</span>&nbsp;<span class="ident" id="6063374">image</span><span class="op" id="6063379">.</span><span class="ident" id="6063380">NewYCbCr</span><span class="op" id="6063388">(</span><span class="ident" id="6063389">image</span><span class="op" id="6063394">.</span><span class="ident" id="6063395">Rect</span><span class="op" id="6063399">(</span><span class="num" id="6063400">0</span><span class="op" id="6063401">,</span>&nbsp;<span class="num" id="6063403">0</span><span class="op" id="6063404">,</span>&nbsp;<span class="num" id="6063406">8</span><span class="op" id="6063407">*</span><span class="ident" id="6063408">h0</span><span class="op" id="6063410">*</span><span class="ident" id="6063411">mxx</span><span class="op" id="6063414">,</span>&nbsp;<span class="num" id="6063416">8</span><span class="op" id="6063417">*</span><span class="ident" id="6063418">v0</span><span class="op" id="6063420">*</span><span class="ident" id="6063421">myy</span><span class="op" id="6063424">)</span><span class="op" id="6063425">,</span>&nbsp;<span class="ident" id="6063427">subsampleRatio</span><span class="op" id="6063441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063444">d</span><span class="op" id="6063445">.</span><span class="ident" id="6063446">img3</span>&nbsp;<span class="op" id="6063451">=</span>&nbsp;<span class="ident" id="6063453">m</span><span class="op" id="6063454">.</span><span class="ident" id="6063455">SubImage</span><span class="op" id="6063463">(</span><span class="ident" id="6063464">image</span><span class="op" id="6063469">.</span><span class="ident" id="6063470">Rect</span><span class="op" id="6063474">(</span><span class="num" id="6063475">0</span><span class="op" id="6063476">,</span>&nbsp;<span class="num" id="6063478">0</span><span class="op" id="6063479">,</span>&nbsp;<span class="ident" id="6063481">d</span><span class="op" id="6063482">.</span><span class="ident" id="6063483">width</span><span class="op" id="6063488">,</span>&nbsp;<span class="ident" id="6063490">d</span><span class="op" id="6063491">.</span><span class="ident" id="6063492">height</span><span class="op" id="6063498">)</span><span class="op" id="6063499">)</span><span class="op" id="6063500">.</span><span class="op" id="6063501">(</span><span class="op" id="6063502">*</span><span class="ident" id="6063503">image</span><span class="op" id="6063508">.</span><span class="ident" id="6063509">YCbCr</span><span class="op" id="6063514">)</span><br>
<span class="lineno"></span><span class="op" id="6063516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="6063519">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.3.</span><br>
<span class="lineno"></span><span class="keyword" id="6063550">func</span>&nbsp;<span class="op" id="6063555">(</span><span class="ident" id="6063556">d</span>&nbsp;<span class="op" id="6063558">*</span><span class="ident" id="6063559">decoder</span><span class="op" id="6063566">)</span>&nbsp;<span class="ident" id="6063568">processSOS</span><span class="op" id="6063578">(</span><span class="ident" id="6063579">n</span>&nbsp;<span class="builtintype" id="6063581">int</span><span class="op" id="6063584">)</span>&nbsp;<span class="builtintype" id="6063586">error</span>&nbsp;<span class="op" id="6063592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063595">if</span>&nbsp;<span class="ident" id="6063598">d</span><span class="op" id="6063599">.</span><span class="ident" id="6063600">nComp</span>&nbsp;<span class="op" id="6063606">==</span>&nbsp;<span class="num" id="6063609">0</span>&nbsp;<span class="op" id="6063611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063615">return</span>&nbsp;<span class="ident" id="6063622">FormatError</span><span class="op" id="6063633">(</span><span class="string" id="6063634">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="6063654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063657">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063660">if</span>&nbsp;<span class="ident" id="6063663">n</span>&nbsp;<span class="op" id="6063665">&lt;</span>&nbsp;<span class="num" id="6063667">6</span>&nbsp;<span class="op" id="6063669">||</span>&nbsp;<span class="num" id="6063672">4</span><span class="op" id="6063673">+</span><span class="num" id="6063674">2</span><span class="op" id="6063675">*</span><span class="ident" id="6063676">d</span><span class="op" id="6063677">.</span><span class="ident" id="6063678">nComp</span>&nbsp;<span class="op" id="6063684">&lt;</span>&nbsp;<span class="ident" id="6063686">n</span>&nbsp;<span class="op" id="6063688">||</span>&nbsp;<span class="ident" id="6063691">n</span><span class="op" id="6063692">%</span><span class="num" id="6063693">2</span>&nbsp;<span class="op" id="6063695">!=</span>&nbsp;<span class="num" id="6063698">0</span>&nbsp;<span class="op" id="6063700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063704">return</span>&nbsp;<span class="ident" id="6063711">FormatError</span><span class="op" id="6063722">(</span><span class="string" id="6063723">&#34;SOS&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="6063745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063751">if</span>&nbsp;<span class="ident" id="6063754">err</span>&nbsp;<span class="op" id="6063758">:=</span>&nbsp;<span class="ident" id="6063761">d</span><span class="op" id="6063762">.</span><span class="ident" id="6063763">readFull</span><span class="op" id="6063771">(</span><span class="ident" id="6063772">d</span><span class="op" id="6063773">.</span><span class="ident" id="6063774">tmp</span><span class="op" id="6063777">[</span><span class="op" id="6063778">:</span><span class="ident" id="6063779">n</span><span class="op" id="6063780">]</span><span class="op" id="6063781">)</span><span class="op" id="6063782">;</span>&nbsp;<span class="ident" id="6063784">err</span>&nbsp;<span class="op" id="6063788">!=</span>&nbsp;<span class="ident" id="6063791">nil</span>&nbsp;<span class="op" id="6063795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063799">return</span>&nbsp;<span class="ident" id="6063806">err</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063814">nComp</span>&nbsp;<span class="op" id="6063820">:=</span>&nbsp;<span class="builtintype" id="6063823">int</span><span class="op" id="6063826">(</span><span class="ident" id="6063827">d</span><span class="op" id="6063828">.</span><span class="ident" id="6063829">tmp</span><span class="op" id="6063832">[</span><span class="num" id="6063833">0</span><span class="op" id="6063834">]</span><span class="op" id="6063835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063838">if</span>&nbsp;<span class="ident" id="6063841">n</span>&nbsp;<span class="op" id="6063843">!=</span>&nbsp;<span class="num" id="6063846">4</span><span class="op" id="6063847">+</span><span class="num" id="6063848">2</span><span class="op" id="6063849">*</span><span class="ident" id="6063850">nComp</span>&nbsp;<span class="op" id="6063856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063860">return</span>&nbsp;<span class="ident" id="6063867">FormatError</span><span class="op" id="6063878">(</span><span class="string" id="6063879">&#34;SOS&nbsp;length&nbsp;inconsistent&nbsp;with&nbsp;number&nbsp;of&nbsp;components&#34;</span><span class="op" id="6063930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063933">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063936">var</span>&nbsp;<span class="ident" id="6063940">scan</span>&nbsp;<span class="op" id="6063945">[</span><span class="ident" id="6063946">nColorComponent</span><span class="op" id="6063961">]</span><span class="keyword" id="6063962">struct</span>&nbsp;<span class="op" id="6063969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063973">compIndex</span>&nbsp;<span class="builtintype" id="6063983">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063991">td</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6064001">uint8</span>&nbsp;<span class="comment" id="6064007">//&nbsp;DC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064031">ta</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6064041">uint8</span>&nbsp;<span class="comment" id="6064047">//&nbsp;AC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064070">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064073">for</span>&nbsp;<span class="ident" id="6064077">i</span>&nbsp;<span class="op" id="6064079">:=</span>&nbsp;<span class="num" id="6064082">0</span><span class="op" id="6064083">;</span>&nbsp;<span class="ident" id="6064085">i</span>&nbsp;<span class="op" id="6064087">&lt;</span>&nbsp;<span class="ident" id="6064089">nComp</span><span class="op" id="6064094">;</span>&nbsp;<span class="ident" id="6064096">i</span><span class="op" id="6064097">++</span>&nbsp;<span class="op" id="6064100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064104">cs</span>&nbsp;<span class="op" id="6064107">:=</span>&nbsp;<span class="ident" id="6064110">d</span><span class="op" id="6064111">.</span><span class="ident" id="6064112">tmp</span><span class="op" id="6064115">[</span><span class="num" id="6064116">1</span><span class="op" id="6064117">+</span><span class="num" id="6064118">2</span><span class="op" id="6064119">*</span><span class="ident" id="6064120">i</span><span class="op" id="6064121">]</span>&nbsp;<span class="comment" id="6064123">//&nbsp;Component&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064148">compIndex</span>&nbsp;<span class="op" id="6064158">:=</span>&nbsp;<span class="op" id="6064161">-</span><span class="num" id="6064162">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064166">for</span>&nbsp;<span class="ident" id="6064170">j</span><span class="op" id="6064171">,</span>&nbsp;<span class="ident" id="6064173">comp</span>&nbsp;<span class="op" id="6064178">:=</span>&nbsp;<span class="keyword" id="6064181">range</span>&nbsp;<span class="ident" id="6064187">d</span><span class="op" id="6064188">.</span><span class="ident" id="6064189">comp</span>&nbsp;<span class="op" id="6064194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064199">if</span>&nbsp;<span class="ident" id="6064202">cs</span>&nbsp;<span class="op" id="6064205">==</span>&nbsp;<span class="ident" id="6064208">comp</span><span class="op" id="6064212">.</span><span class="ident" id="6064213">c</span>&nbsp;<span class="op" id="6064215">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064221">compIndex</span>&nbsp;<span class="op" id="6064231">=</span>&nbsp;<span class="ident" id="6064233">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064246">if</span>&nbsp;<span class="ident" id="6064249">compIndex</span>&nbsp;<span class="op" id="6064259">&lt;</span>&nbsp;<span class="num" id="6064261">0</span>&nbsp;<span class="op" id="6064263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064268">return</span>&nbsp;<span class="ident" id="6064275">FormatError</span><span class="op" id="6064286">(</span><span class="string" id="6064287">&#34;unknown&nbsp;component&nbsp;selector&#34;</span><span class="op" id="6064315">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064323">scan</span><span class="op" id="6064327">[</span><span class="ident" id="6064328">i</span><span class="op" id="6064329">]</span><span class="op" id="6064330">.</span><span class="ident" id="6064331">compIndex</span>&nbsp;<span class="op" id="6064341">=</span>&nbsp;<span class="builtintype" id="6064343">uint8</span><span class="op" id="6064348">(</span><span class="ident" id="6064349">compIndex</span><span class="op" id="6064358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064362">scan</span><span class="op" id="6064366">[</span><span class="ident" id="6064367">i</span><span class="op" id="6064368">]</span><span class="op" id="6064369">.</span><span class="ident" id="6064370">td</span>&nbsp;<span class="op" id="6064373">=</span>&nbsp;<span class="ident" id="6064375">d</span><span class="op" id="6064376">.</span><span class="ident" id="6064377">tmp</span><span class="op" id="6064380">[</span><span class="num" id="6064381">2</span><span class="op" id="6064382">+</span><span class="num" id="6064383">2</span><span class="op" id="6064384">*</span><span class="ident" id="6064385">i</span><span class="op" id="6064386">]</span>&nbsp;<span class="op" id="6064388">&gt;&gt;</span>&nbsp;<span class="num" id="6064391">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064395">if</span>&nbsp;<span class="ident" id="6064398">scan</span><span class="op" id="6064402">[</span><span class="ident" id="6064403">i</span><span class="op" id="6064404">]</span><span class="op" id="6064405">.</span><span class="ident" id="6064406">td</span>&nbsp;<span class="op" id="6064409">&gt;</span>&nbsp;<span class="ident" id="6064411">maxTh</span>&nbsp;<span class="op" id="6064417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064422">return</span>&nbsp;<span class="ident" id="6064429">FormatError</span><span class="op" id="6064440">(</span><span class="string" id="6064441">&#34;bad&nbsp;Td&nbsp;value&#34;</span><span class="op" id="6064455">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064463">scan</span><span class="op" id="6064467">[</span><span class="ident" id="6064468">i</span><span class="op" id="6064469">]</span><span class="op" id="6064470">.</span><span class="ident" id="6064471">ta</span>&nbsp;<span class="op" id="6064474">=</span>&nbsp;<span class="ident" id="6064476">d</span><span class="op" id="6064477">.</span><span class="ident" id="6064478">tmp</span><span class="op" id="6064481">[</span><span class="num" id="6064482">2</span><span class="op" id="6064483">+</span><span class="num" id="6064484">2</span><span class="op" id="6064485">*</span><span class="ident" id="6064486">i</span><span class="op" id="6064487">]</span>&nbsp;<span class="op" id="6064489">&amp;</span>&nbsp;<span class="num" id="6064491">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064498">if</span>&nbsp;<span class="ident" id="6064501">scan</span><span class="op" id="6064505">[</span><span class="ident" id="6064506">i</span><span class="op" id="6064507">]</span><span class="op" id="6064508">.</span><span class="ident" id="6064509">ta</span>&nbsp;<span class="op" id="6064512">&gt;</span>&nbsp;<span class="ident" id="6064514">maxTh</span>&nbsp;<span class="op" id="6064520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064525">return</span>&nbsp;<span class="ident" id="6064532">FormatError</span><span class="op" id="6064543">(</span><span class="string" id="6064544">&#34;bad&nbsp;Ta&nbsp;value&#34;</span><span class="op" id="6064558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064562">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064569">//&nbsp;zigStart&nbsp;and&nbsp;zigEnd&nbsp;are&nbsp;the&nbsp;spectral&nbsp;selection&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064628">//&nbsp;ah&nbsp;and&nbsp;al&nbsp;are&nbsp;the&nbsp;successive&nbsp;approximation&nbsp;high&nbsp;and&nbsp;low&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064696">//&nbsp;The&nbsp;spec&nbsp;calls&nbsp;these&nbsp;values&nbsp;Ss,&nbsp;Se,&nbsp;Ah&nbsp;and&nbsp;Al.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064747">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064751">//&nbsp;For&nbsp;progressive&nbsp;JPEGs,&nbsp;these&nbsp;are&nbsp;the&nbsp;two&nbsp;more-or-less&nbsp;independent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064821">//&nbsp;aspects&nbsp;of&nbsp;progression.&nbsp;Spectral&nbsp;selection&nbsp;progression&nbsp;is&nbsp;when&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064892">//&nbsp;all&nbsp;of&nbsp;a&nbsp;block&#39;s&nbsp;64&nbsp;DCT&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064962">//&nbsp;For&nbsp;example,&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;coefficient&nbsp;0&nbsp;(the&nbsp;DC</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065029">//&nbsp;component),&nbsp;coefficients&nbsp;1-5,&nbsp;and&nbsp;coefficients&nbsp;6-63,&nbsp;in&nbsp;zig-zag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065097">//&nbsp;order.&nbsp;Successive&nbsp;approximation&nbsp;is&nbsp;when&nbsp;not&nbsp;all&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065166">//&nbsp;band&nbsp;of&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065233">//&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;the&nbsp;6&nbsp;most&nbsp;significant&nbsp;bits,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065303">//&nbsp;by&nbsp;the&nbsp;second-least&nbsp;significant&nbsp;bit,&nbsp;followed&nbsp;by&nbsp;the&nbsp;least</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065366">//&nbsp;significant&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065387">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065391">//&nbsp;For&nbsp;baseline&nbsp;JPEGs,&nbsp;these&nbsp;parameters&nbsp;are&nbsp;hard-coded&nbsp;to&nbsp;0/63/0/0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065460">zigStart</span><span class="op" id="6065468">,</span>&nbsp;<span class="ident" id="6065470">zigEnd</span><span class="op" id="6065476">,</span>&nbsp;<span class="ident" id="6065478">ah</span><span class="op" id="6065480">,</span>&nbsp;<span class="ident" id="6065482">al</span>&nbsp;<span class="op" id="6065485">:=</span>&nbsp;<span class="builtintype" id="6065488">int32</span><span class="op" id="6065493">(</span><span class="num" id="6065494">0</span><span class="op" id="6065495">)</span><span class="op" id="6065496">,</span>&nbsp;<span class="builtintype" id="6065498">int32</span><span class="op" id="6065503">(</span><span class="ident" id="6065504">blockSize</span><span class="op" id="6065513">-</span><span class="num" id="6065514">1</span><span class="op" id="6065515">)</span><span class="op" id="6065516">,</span>&nbsp;<span class="builtintype" id="6065518">uint32</span><span class="op" id="6065524">(</span><span class="num" id="6065525">0</span><span class="op" id="6065526">)</span><span class="op" id="6065527">,</span>&nbsp;<span class="builtintype" id="6065529">uint32</span><span class="op" id="6065535">(</span><span class="num" id="6065536">0</span><span class="op" id="6065537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065540">if</span>&nbsp;<span class="ident" id="6065543">d</span><span class="op" id="6065544">.</span><span class="ident" id="6065545">progressive</span>&nbsp;<span class="op" id="6065557">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065561">zigStart</span>&nbsp;<span class="op" id="6065570">=</span>&nbsp;<span class="builtintype" id="6065572">int32</span><span class="op" id="6065577">(</span><span class="ident" id="6065578">d</span><span class="op" id="6065579">.</span><span class="ident" id="6065580">tmp</span><span class="op" id="6065583">[</span><span class="num" id="6065584">1</span><span class="op" id="6065585">+</span><span class="num" id="6065586">2</span><span class="op" id="6065587">*</span><span class="ident" id="6065588">nComp</span><span class="op" id="6065593">]</span><span class="op" id="6065594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065598">zigEnd</span>&nbsp;<span class="op" id="6065605">=</span>&nbsp;<span class="builtintype" id="6065607">int32</span><span class="op" id="6065612">(</span><span class="ident" id="6065613">d</span><span class="op" id="6065614">.</span><span class="ident" id="6065615">tmp</span><span class="op" id="6065618">[</span><span class="num" id="6065619">2</span><span class="op" id="6065620">+</span><span class="num" id="6065621">2</span><span class="op" id="6065622">*</span><span class="ident" id="6065623">nComp</span><span class="op" id="6065628">]</span><span class="op" id="6065629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065633">ah</span>&nbsp;<span class="op" id="6065636">=</span>&nbsp;<span class="builtintype" id="6065638">uint32</span><span class="op" id="6065644">(</span><span class="ident" id="6065645">d</span><span class="op" id="6065646">.</span><span class="ident" id="6065647">tmp</span><span class="op" id="6065650">[</span><span class="num" id="6065651">3</span><span class="op" id="6065652">+</span><span class="num" id="6065653">2</span><span class="op" id="6065654">*</span><span class="ident" id="6065655">nComp</span><span class="op" id="6065660">]</span>&nbsp;<span class="op" id="6065662">&gt;&gt;</span>&nbsp;<span class="num" id="6065665">4</span><span class="op" id="6065666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065670">al</span>&nbsp;<span class="op" id="6065673">=</span>&nbsp;<span class="builtintype" id="6065675">uint32</span><span class="op" id="6065681">(</span><span class="ident" id="6065682">d</span><span class="op" id="6065683">.</span><span class="ident" id="6065684">tmp</span><span class="op" id="6065687">[</span><span class="num" id="6065688">3</span><span class="op" id="6065689">+</span><span class="num" id="6065690">2</span><span class="op" id="6065691">*</span><span class="ident" id="6065692">nComp</span><span class="op" id="6065697">]</span>&nbsp;<span class="op" id="6065699">&amp;</span>&nbsp;<span class="num" id="6065701">0x0f</span><span class="op" id="6065705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065709">if</span>&nbsp;<span class="op" id="6065712">(</span><span class="ident" id="6065713">zigStart</span>&nbsp;<span class="op" id="6065722">==</span>&nbsp;<span class="num" id="6065725">0</span>&nbsp;<span class="op" id="6065727">&amp;&amp;</span>&nbsp;<span class="ident" id="6065730">zigEnd</span>&nbsp;<span class="op" id="6065737">!=</span>&nbsp;<span class="num" id="6065740">0</span><span class="op" id="6065741">)</span>&nbsp;<span class="op" id="6065743">||</span>&nbsp;<span class="ident" id="6065746">zigStart</span>&nbsp;<span class="op" id="6065755">&gt;</span>&nbsp;<span class="ident" id="6065757">zigEnd</span>&nbsp;<span class="op" id="6065764">||</span>&nbsp;<span class="ident" id="6065767">blockSize</span>&nbsp;<span class="op" id="6065777">&lt;=</span>&nbsp;<span class="ident" id="6065780">zigEnd</span>&nbsp;<span class="op" id="6065787">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065792">return</span>&nbsp;<span class="ident" id="6065799">FormatError</span><span class="op" id="6065810">(</span><span class="string" id="6065811">&#34;bad&nbsp;spectral&nbsp;selection&nbsp;bounds&#34;</span><span class="op" id="6065842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6065846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065850">if</span>&nbsp;<span class="ident" id="6065853">zigStart</span>&nbsp;<span class="op" id="6065862">!=</span>&nbsp;<span class="num" id="6065865">0</span>&nbsp;<span class="op" id="6065867">&amp;&amp;</span>&nbsp;<span class="ident" id="6065870">nComp</span>&nbsp;<span class="op" id="6065876">!=</span>&nbsp;<span class="num" id="6065879">1</span>&nbsp;<span class="op" id="6065881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065886">return</span>&nbsp;<span class="ident" id="6065893">FormatError</span><span class="op" id="6065904">(</span><span class="string" id="6065905">&#34;progressive&nbsp;AC&nbsp;coefficients&nbsp;for&nbsp;more&nbsp;than&nbsp;one&nbsp;component&#34;</span><span class="op" id="6065962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6065966">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065970">if</span>&nbsp;<span class="ident" id="6065973">ah</span>&nbsp;<span class="op" id="6065976">!=</span>&nbsp;<span class="num" id="6065979">0</span>&nbsp;<span class="op" id="6065981">&amp;&amp;</span>&nbsp;<span class="ident" id="6065984">ah</span>&nbsp;<span class="op" id="6065987">!=</span>&nbsp;<span class="ident" id="6065990">al</span><span class="op" id="6065992">+</span><span class="num" id="6065993">1</span>&nbsp;<span class="op" id="6065995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066000">return</span>&nbsp;<span class="ident" id="6066007">FormatError</span><span class="op" id="6066018">(</span><span class="string" id="6066019">&#34;bad&nbsp;successive&nbsp;approximation&nbsp;values&#34;</span><span class="op" id="6066056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066067">//&nbsp;mxx&nbsp;and&nbsp;myy&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;MCUs&nbsp;(Minimum&nbsp;Coded&nbsp;Units)&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066142">h0</span><span class="op" id="6066144">,</span>&nbsp;<span class="ident" id="6066146">v0</span>&nbsp;<span class="op" id="6066149">:=</span>&nbsp;<span class="ident" id="6066152">d</span><span class="op" id="6066153">.</span><span class="ident" id="6066154">comp</span><span class="op" id="6066158">[</span><span class="num" id="6066159">0</span><span class="op" id="6066160">]</span><span class="op" id="6066161">.</span><span class="ident" id="6066162">h</span><span class="op" id="6066163">,</span>&nbsp;<span class="ident" id="6066165">d</span><span class="op" id="6066166">.</span><span class="ident" id="6066167">comp</span><span class="op" id="6066171">[</span><span class="num" id="6066172">0</span><span class="op" id="6066173">]</span><span class="op" id="6066174">.</span><span class="ident" id="6066175">v</span>&nbsp;<span class="comment" id="6066177">//&nbsp;The&nbsp;h&nbsp;and&nbsp;v&nbsp;values&nbsp;from&nbsp;the&nbsp;Y&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066223">mxx</span>&nbsp;<span class="op" id="6066227">:=</span>&nbsp;<span class="op" id="6066230">(</span><span class="ident" id="6066231">d</span><span class="op" id="6066232">.</span><span class="ident" id="6066233">width</span>&nbsp;<span class="op" id="6066239">+</span>&nbsp;<span class="num" id="6066241">8</span><span class="op" id="6066242">*</span><span class="ident" id="6066243">h0</span>&nbsp;<span class="op" id="6066246">-</span>&nbsp;<span class="num" id="6066248">1</span><span class="op" id="6066249">)</span>&nbsp;<span class="op" id="6066251">/</span>&nbsp;<span class="op" id="6066253">(</span><span class="num" id="6066254">8</span>&nbsp;<span class="op" id="6066256">*</span>&nbsp;<span class="ident" id="6066258">h0</span><span class="op" id="6066260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066263">myy</span>&nbsp;<span class="op" id="6066267">:=</span>&nbsp;<span class="op" id="6066270">(</span><span class="ident" id="6066271">d</span><span class="op" id="6066272">.</span><span class="ident" id="6066273">height</span>&nbsp;<span class="op" id="6066280">+</span>&nbsp;<span class="num" id="6066282">8</span><span class="op" id="6066283">*</span><span class="ident" id="6066284">v0</span>&nbsp;<span class="op" id="6066287">-</span>&nbsp;<span class="num" id="6066289">1</span><span class="op" id="6066290">)</span>&nbsp;<span class="op" id="6066292">/</span>&nbsp;<span class="op" id="6066294">(</span><span class="num" id="6066295">8</span>&nbsp;<span class="op" id="6066297">*</span>&nbsp;<span class="ident" id="6066299">v0</span><span class="op" id="6066301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066304">if</span>&nbsp;<span class="ident" id="6066307">d</span><span class="op" id="6066308">.</span><span class="ident" id="6066309">img1</span>&nbsp;<span class="op" id="6066314">==</span>&nbsp;<span class="ident" id="6066317">nil</span>&nbsp;<span class="op" id="6066321">&amp;&amp;</span>&nbsp;<span class="ident" id="6066324">d</span><span class="op" id="6066325">.</span><span class="ident" id="6066326">img3</span>&nbsp;<span class="op" id="6066331">==</span>&nbsp;<span class="ident" id="6066334">nil</span>&nbsp;<span class="op" id="6066338">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066342">d</span><span class="op" id="6066343">.</span><span class="ident" id="6066344">makeImg</span><span class="op" id="6066351">(</span><span class="ident" id="6066352">h0</span><span class="op" id="6066354">,</span>&nbsp;<span class="ident" id="6066356">v0</span><span class="op" id="6066358">,</span>&nbsp;<span class="ident" id="6066360">mxx</span><span class="op" id="6066363">,</span>&nbsp;<span class="ident" id="6066365">myy</span><span class="op" id="6066368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066374">if</span>&nbsp;<span class="ident" id="6066377">d</span><span class="op" id="6066378">.</span><span class="ident" id="6066379">progressive</span>&nbsp;<span class="op" id="6066391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066395">for</span>&nbsp;<span class="ident" id="6066399">i</span>&nbsp;<span class="op" id="6066401">:=</span>&nbsp;<span class="num" id="6066404">0</span><span class="op" id="6066405">;</span>&nbsp;<span class="ident" id="6066407">i</span>&nbsp;<span class="op" id="6066409">&lt;</span>&nbsp;<span class="ident" id="6066411">nComp</span><span class="op" id="6066416">;</span>&nbsp;<span class="ident" id="6066418">i</span><span class="op" id="6066419">++</span>&nbsp;<span class="op" id="6066422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066427">compIndex</span>&nbsp;<span class="op" id="6066437">:=</span>&nbsp;<span class="ident" id="6066440">scan</span><span class="op" id="6066444">[</span><span class="ident" id="6066445">i</span><span class="op" id="6066446">]</span><span class="op" id="6066447">.</span><span class="ident" id="6066448">compIndex</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066461">if</span>&nbsp;<span class="ident" id="6066464">d</span><span class="op" id="6066465">.</span><span class="ident" id="6066466">progCoeffs</span><span class="op" id="6066476">[</span><span class="ident" id="6066477">compIndex</span><span class="op" id="6066486">]</span>&nbsp;<span class="op" id="6066488">==</span>&nbsp;<span class="ident" id="6066491">nil</span>&nbsp;<span class="op" id="6066495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066501">d</span><span class="op" id="6066502">.</span><span class="ident" id="6066503">progCoeffs</span><span class="op" id="6066513">[</span><span class="ident" id="6066514">compIndex</span><span class="op" id="6066523">]</span>&nbsp;<span class="op" id="6066525">=</span>&nbsp;<span class="builtinfunc" id="6066527">make</span><span class="op" id="6066531">(</span><span class="op" id="6066532">[</span><span class="op" id="6066533">]</span><span class="ident" id="6066534">block</span><span class="op" id="6066539">,</span>&nbsp;<span class="ident" id="6066541">mxx</span><span class="op" id="6066544">*</span><span class="ident" id="6066545">myy</span><span class="op" id="6066548">*</span><span class="ident" id="6066549">d</span><span class="op" id="6066550">.</span><span class="ident" id="6066551">comp</span><span class="op" id="6066555">[</span><span class="ident" id="6066556">compIndex</span><span class="op" id="6066565">]</span><span class="op" id="6066566">.</span><span class="ident" id="6066567">h</span><span class="op" id="6066568">*</span><span class="ident" id="6066569">d</span><span class="op" id="6066570">.</span><span class="ident" id="6066571">comp</span><span class="op" id="6066575">[</span><span class="ident" id="6066576">compIndex</span><span class="op" id="6066585">]</span><span class="op" id="6066586">.</span><span class="ident" id="6066587">v</span><span class="op" id="6066588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066600">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066604">d</span><span class="op" id="6066605">.</span><span class="ident" id="6066606">bits</span>&nbsp;<span class="op" id="6066611">=</span>&nbsp;<span class="ident" id="6066613">bits</span><span class="op" id="6066617">{</span><span class="op" id="6066618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066621">mcu</span><span class="op" id="6066624">,</span>&nbsp;<span class="ident" id="6066626">expectedRST</span>&nbsp;<span class="op" id="6066638">:=</span>&nbsp;<span class="num" id="6066641">0</span><span class="op" id="6066642">,</span>&nbsp;<span class="builtintype" id="6066644">uint8</span><span class="op" id="6066649">(</span><span class="ident" id="6066650">rst0Marker</span><span class="op" id="6066660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066663">var</span>&nbsp;<span class="op" id="6066667">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066671">//&nbsp;b&nbsp;is&nbsp;the&nbsp;decoded&nbsp;coefficients,&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066739">b</span>&nbsp;&nbsp;<span class="ident" id="6066742">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066750">dc</span>&nbsp;<span class="op" id="6066753">[</span><span class="ident" id="6066754">nColorComponent</span><span class="op" id="6066769">]</span><span class="builtintype" id="6066770">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066778">//&nbsp;bx&nbsp;and&nbsp;by&nbsp;are&nbsp;the&nbsp;location&nbsp;of&nbsp;the&nbsp;current&nbsp;(in&nbsp;terms&nbsp;of&nbsp;8x8&nbsp;blocks).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066851">//&nbsp;For&nbsp;example,&nbsp;with&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling,&nbsp;the&nbsp;block&nbsp;whose&nbsp;top&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066925">//&nbsp;pixel&nbsp;co-ordinates&nbsp;are&nbsp;(16,&nbsp;8)&nbsp;is&nbsp;the&nbsp;third&nbsp;block&nbsp;in&nbsp;the&nbsp;first&nbsp;row:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066998">//&nbsp;bx&nbsp;is&nbsp;2&nbsp;and&nbsp;by&nbsp;is&nbsp;0,&nbsp;even&nbsp;though&nbsp;the&nbsp;pixel&nbsp;is&nbsp;in&nbsp;the&nbsp;second&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067068">bx</span><span class="op" id="6067070">,</span>&nbsp;<span class="ident" id="6067072">by</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6067079">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067085">blockCount</span>&nbsp;<span class="builtintype" id="6067096">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6067101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067104">for</span>&nbsp;<span class="ident" id="6067108">my</span>&nbsp;<span class="op" id="6067111">:=</span>&nbsp;<span class="num" id="6067114">0</span><span class="op" id="6067115">;</span>&nbsp;<span class="ident" id="6067117">my</span>&nbsp;<span class="op" id="6067120">&lt;</span>&nbsp;<span class="ident" id="6067122">myy</span><span class="op" id="6067125">;</span>&nbsp;<span class="ident" id="6067127">my</span><span class="op" id="6067129">++</span>&nbsp;<span class="op" id="6067132">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067136">for</span>&nbsp;<span class="ident" id="6067140">mx</span>&nbsp;<span class="op" id="6067143">:=</span>&nbsp;<span class="num" id="6067146">0</span><span class="op" id="6067147">;</span>&nbsp;<span class="ident" id="6067149">mx</span>&nbsp;<span class="op" id="6067152">&lt;</span>&nbsp;<span class="ident" id="6067154">mxx</span><span class="op" id="6067157">;</span>&nbsp;<span class="ident" id="6067159">mx</span><span class="op" id="6067161">++</span>&nbsp;<span class="op" id="6067164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067169">for</span>&nbsp;<span class="ident" id="6067173">i</span>&nbsp;<span class="op" id="6067175">:=</span>&nbsp;<span class="num" id="6067178">0</span><span class="op" id="6067179">;</span>&nbsp;<span class="ident" id="6067181">i</span>&nbsp;<span class="op" id="6067183">&lt;</span>&nbsp;<span class="ident" id="6067185">nComp</span><span class="op" id="6067190">;</span>&nbsp;<span class="ident" id="6067192">i</span><span class="op" id="6067193">++</span>&nbsp;<span class="op" id="6067196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067202">compIndex</span>&nbsp;<span class="op" id="6067212">:=</span>&nbsp;<span class="ident" id="6067215">scan</span><span class="op" id="6067219">[</span><span class="ident" id="6067220">i</span><span class="op" id="6067221">]</span><span class="op" id="6067222">.</span><span class="ident" id="6067223">compIndex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067237">qt</span>&nbsp;<span class="op" id="6067240">:=</span>&nbsp;<span class="op" id="6067243">&amp;</span><span class="ident" id="6067244">d</span><span class="op" id="6067245">.</span><span class="ident" id="6067246">quant</span><span class="op" id="6067251">[</span><span class="ident" id="6067252">d</span><span class="op" id="6067253">.</span><span class="ident" id="6067254">comp</span><span class="op" id="6067258">[</span><span class="ident" id="6067259">compIndex</span><span class="op" id="6067268">]</span><span class="op" id="6067269">.</span><span class="ident" id="6067270">tq</span><span class="op" id="6067272">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067278">for</span>&nbsp;<span class="ident" id="6067282">j</span>&nbsp;<span class="op" id="6067284">:=</span>&nbsp;<span class="num" id="6067287">0</span><span class="op" id="6067288">;</span>&nbsp;<span class="ident" id="6067290">j</span>&nbsp;<span class="op" id="6067292">&lt;</span>&nbsp;<span class="ident" id="6067294">d</span><span class="op" id="6067295">.</span><span class="ident" id="6067296">comp</span><span class="op" id="6067300">[</span><span class="ident" id="6067301">compIndex</span><span class="op" id="6067310">]</span><span class="op" id="6067311">.</span><span class="ident" id="6067312">h</span><span class="op" id="6067313">*</span><span class="ident" id="6067314">d</span><span class="op" id="6067315">.</span><span class="ident" id="6067316">comp</span><span class="op" id="6067320">[</span><span class="ident" id="6067321">compIndex</span><span class="op" id="6067330">]</span><span class="op" id="6067331">.</span><span class="ident" id="6067332">v</span><span class="op" id="6067333">;</span>&nbsp;<span class="ident" id="6067335">j</span><span class="op" id="6067336">++</span>&nbsp;<span class="op" id="6067339">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067346">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;traversed&nbsp;one&nbsp;MCU&nbsp;at&nbsp;a&nbsp;time.&nbsp;For&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067415">//&nbsp;subsampling,&nbsp;there&nbsp;are&nbsp;four&nbsp;Y&nbsp;8x8&nbsp;blocks&nbsp;in&nbsp;every&nbsp;16x16&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067484">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067492">//&nbsp;For&nbsp;a&nbsp;baseline&nbsp;32x16&nbsp;pixel&nbsp;image,&nbsp;the&nbsp;Y&nbsp;blocks&nbsp;visiting&nbsp;order&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067566">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067582">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067598">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067606">//&nbsp;For&nbsp;progressive&nbsp;images,&nbsp;the&nbsp;interleaved&nbsp;scans&nbsp;(those&nbsp;with&nbsp;nComp&nbsp;&gt;&nbsp;1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067683">//&nbsp;are&nbsp;traversed&nbsp;as&nbsp;above,&nbsp;but&nbsp;non-interleaved&nbsp;scans&nbsp;are&nbsp;traversed&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067760">//&nbsp;to&nbsp;right,&nbsp;top&nbsp;to&nbsp;bottom:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067793">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2&nbsp;3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067809">//&nbsp;&nbsp;&nbsp;&nbsp4&nbsp;5&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067825">//&nbsp;Only&nbsp;DC&nbsp;scans&nbsp;(zigStart&nbsp;==&nbsp;0)&nbsp;can&nbsp;be&nbsp;interleaved.&nbsp;AC&nbsp;scans&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067902">//&nbsp;only&nbsp;one&nbsp;component.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067930">//</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067938">//&nbsp;To&nbsp;further&nbsp;complicate&nbsp;matters,&nbsp;for&nbsp;non-interleaved&nbsp;scans,&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068016">//&nbsp;data&nbsp;for&nbsp;any&nbsp;blocks&nbsp;that&nbsp;are&nbsp;inside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;MCU&nbsp;level&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068091">//&nbsp;outside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;pixel&nbsp;level.&nbsp;For&nbsp;example,&nbsp;a&nbsp;24x16&nbsp;pixel&nbsp;4:2:0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068170">//&nbsp;progressive&nbsp;image&nbsp;consists&nbsp;of&nbsp;two&nbsp;16x16&nbsp;MCUs.&nbsp;The&nbsp;interleaved&nbsp;scans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068246">//&nbsp;will&nbsp;process&nbsp;8&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068279">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068295">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068311">//&nbsp;The&nbsp;non-interleaved&nbsp;scans&nbsp;will&nbsp;process&nbsp;only&nbsp;6&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068375">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068389">//&nbsp;&nbsp;&nbsp;&nbsp3&nbsp;4&nbsp;5</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068403">if</span>&nbsp;<span class="ident" id="6068406">nComp</span>&nbsp;<span class="op" id="6068412">!=</span>&nbsp;<span class="num" id="6068415">1</span>&nbsp;<span class="op" id="6068417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068425">bx</span><span class="op" id="6068427">,</span>&nbsp;<span class="ident" id="6068429">by</span>&nbsp;<span class="op" id="6068432">=</span>&nbsp;<span class="ident" id="6068434">d</span><span class="op" id="6068435">.</span><span class="ident" id="6068436">comp</span><span class="op" id="6068440">[</span><span class="ident" id="6068441">compIndex</span><span class="op" id="6068450">]</span><span class="op" id="6068451">.</span><span class="ident" id="6068452">h</span><span class="op" id="6068453">*</span><span class="ident" id="6068454">mx</span><span class="op" id="6068456">,</span>&nbsp;<span class="ident" id="6068458">d</span><span class="op" id="6068459">.</span><span class="ident" id="6068460">comp</span><span class="op" id="6068464">[</span><span class="ident" id="6068465">compIndex</span><span class="op" id="6068474">]</span><span class="op" id="6068475">.</span><span class="ident" id="6068476">v</span><span class="op" id="6068477">*</span><span class="ident" id="6068478">my</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068487">if</span>&nbsp;<span class="ident" id="6068490">h0</span>&nbsp;<span class="op" id="6068493">==</span>&nbsp;<span class="num" id="6068496">1</span>&nbsp;<span class="op" id="6068498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068507">by</span>&nbsp;<span class="op" id="6068510">+=</span>&nbsp;<span class="ident" id="6068513">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068521">}</span>&nbsp;<span class="keyword" id="6068523">else</span>&nbsp;<span class="op" id="6068528">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068537">bx</span>&nbsp;<span class="op" id="6068540">+=</span>&nbsp;<span class="ident" id="6068543">j</span>&nbsp;<span class="op" id="6068545">%</span>&nbsp;<span class="num" id="6068547">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068556">by</span>&nbsp;<span class="op" id="6068559">+=</span>&nbsp;<span class="ident" id="6068562">j</span>&nbsp;<span class="op" id="6068564">/</span>&nbsp;<span class="num" id="6068566">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068581">}</span>&nbsp;<span class="keyword" id="6068583">else</span>&nbsp;<span class="op" id="6068588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068596">q</span>&nbsp;<span class="op" id="6068598">:=</span>&nbsp;<span class="ident" id="6068601">mxx</span>&nbsp;<span class="op" id="6068605">*</span>&nbsp;<span class="ident" id="6068607">d</span><span class="op" id="6068608">.</span><span class="ident" id="6068609">comp</span><span class="op" id="6068613">[</span><span class="ident" id="6068614">compIndex</span><span class="op" id="6068623">]</span><span class="op" id="6068624">.</span><span class="ident" id="6068625">h</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068633">bx</span>&nbsp;<span class="op" id="6068636">=</span>&nbsp;<span class="ident" id="6068638">blockCount</span>&nbsp;<span class="op" id="6068649">%</span>&nbsp;<span class="ident" id="6068651">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068659">by</span>&nbsp;<span class="op" id="6068662">=</span>&nbsp;<span class="ident" id="6068664">blockCount</span>&nbsp;<span class="op" id="6068675">/</span>&nbsp;<span class="ident" id="6068677">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068685">blockCount</span><span class="op" id="6068695">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068704">if</span>&nbsp;<span class="ident" id="6068707">bx</span><span class="op" id="6068709">*</span><span class="num" id="6068710">8</span>&nbsp;<span class="op" id="6068712">&gt;=</span>&nbsp;<span class="ident" id="6068715">d</span><span class="op" id="6068716">.</span><span class="ident" id="6068717">width</span>&nbsp;<span class="op" id="6068723">||</span>&nbsp;<span class="ident" id="6068726">by</span><span class="op" id="6068728">*</span><span class="num" id="6068729">8</span>&nbsp;<span class="op" id="6068731">&gt;=</span>&nbsp;<span class="ident" id="6068734">d</span><span class="op" id="6068735">.</span><span class="ident" id="6068736">height</span>&nbsp;<span class="op" id="6068743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068752">continue</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068782">//&nbsp;Load&nbsp;the&nbsp;previous&nbsp;partially&nbsp;decoded&nbsp;coefficients,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068855">if</span>&nbsp;<span class="ident" id="6068858">d</span><span class="op" id="6068859">.</span><span class="ident" id="6068860">progressive</span>&nbsp;<span class="op" id="6068872">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068880">b</span>&nbsp;<span class="op" id="6068882">=</span>&nbsp;<span class="ident" id="6068884">d</span><span class="op" id="6068885">.</span><span class="ident" id="6068886">progCoeffs</span><span class="op" id="6068896">[</span><span class="ident" id="6068897">compIndex</span><span class="op" id="6068906">]</span><span class="op" id="6068907">[</span><span class="ident" id="6068908">by</span><span class="op" id="6068910">*</span><span class="ident" id="6068911">mxx</span><span class="op" id="6068914">*</span><span class="ident" id="6068915">d</span><span class="op" id="6068916">.</span><span class="ident" id="6068917">comp</span><span class="op" id="6068921">[</span><span class="ident" id="6068922">compIndex</span><span class="op" id="6068931">]</span><span class="op" id="6068932">.</span><span class="ident" id="6068933">h</span><span class="op" id="6068934">+</span><span class="ident" id="6068935">bx</span><span class="op" id="6068937">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068944">}</span>&nbsp;<span class="keyword" id="6068946">else</span>&nbsp;<span class="op" id="6068951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068959">b</span>&nbsp;<span class="op" id="6068961">=</span>&nbsp;<span class="ident" id="6068963">block</span><span class="op" id="6068968">{</span><span class="op" id="6068969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068984">if</span>&nbsp;<span class="ident" id="6068987">ah</span>&nbsp;<span class="op" id="6068990">!=</span>&nbsp;<span class="num" id="6068993">0</span>&nbsp;<span class="op" id="6068995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069003">if</span>&nbsp;<span class="ident" id="6069006">err</span>&nbsp;<span class="op" id="6069010">:=</span>&nbsp;<span class="ident" id="6069013">d</span><span class="op" id="6069014">.</span><span class="ident" id="6069015">refine</span><span class="op" id="6069021">(</span><span class="op" id="6069022">&amp;</span><span class="ident" id="6069023">b</span><span class="op" id="6069024">,</span>&nbsp;<span class="op" id="6069026">&amp;</span><span class="ident" id="6069027">d</span><span class="op" id="6069028">.</span><span class="ident" id="6069029">huff</span><span class="op" id="6069033">[</span><span class="ident" id="6069034">acTable</span><span class="op" id="6069041">]</span><span class="op" id="6069042">[</span><span class="ident" id="6069043">scan</span><span class="op" id="6069047">[</span><span class="ident" id="6069048">i</span><span class="op" id="6069049">]</span><span class="op" id="6069050">.</span><span class="ident" id="6069051">ta</span><span class="op" id="6069053">]</span><span class="op" id="6069054">,</span>&nbsp;<span class="ident" id="6069056">zigStart</span><span class="op" id="6069064">,</span>&nbsp;<span class="ident" id="6069066">zigEnd</span><span class="op" id="6069072">,</span>&nbsp;<span class="num" id="6069074">1</span><span class="op" id="6069075">&lt;&lt;</span><span class="ident" id="6069077">al</span><span class="op" id="6069079">)</span><span class="op" id="6069080">;</span>&nbsp;<span class="ident" id="6069082">err</span>&nbsp;<span class="op" id="6069086">!=</span>&nbsp;<span class="ident" id="6069089">nil</span>&nbsp;<span class="op" id="6069093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069102">return</span>&nbsp;<span class="ident" id="6069109">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069126">}</span>&nbsp;<span class="keyword" id="6069128">else</span>&nbsp;<span class="op" id="6069133">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069141">zig</span>&nbsp;<span class="op" id="6069145">:=</span>&nbsp;<span class="ident" id="6069148">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069163">if</span>&nbsp;<span class="ident" id="6069166">zig</span>&nbsp;<span class="op" id="6069170">==</span>&nbsp;<span class="num" id="6069173">0</span>&nbsp;<span class="op" id="6069175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069184">zig</span><span class="op" id="6069187">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6069197">//&nbsp;Decode&nbsp;the&nbsp;DC&nbsp;coefficient,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069267">value</span><span class="op" id="6069272">,</span>&nbsp;<span class="ident" id="6069274">err</span>&nbsp;<span class="op" id="6069278">:=</span>&nbsp;<span class="ident" id="6069281">d</span><span class="op" id="6069282">.</span><span class="ident" id="6069283">decodeHuffman</span><span class="op" id="6069296">(</span><span class="op" id="6069297">&amp;</span><span class="ident" id="6069298">d</span><span class="op" id="6069299">.</span><span class="ident" id="6069300">huff</span><span class="op" id="6069304">[</span><span class="ident" id="6069305">dcTable</span><span class="op" id="6069312">]</span><span class="op" id="6069313">[</span><span class="ident" id="6069314">scan</span><span class="op" id="6069318">[</span><span class="ident" id="6069319">i</span><span class="op" id="6069320">]</span><span class="op" id="6069321">.</span><span class="ident" id="6069322">td</span><span class="op" id="6069324">]</span><span class="op" id="6069325">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069334">if</span>&nbsp;<span class="ident" id="6069337">err</span>&nbsp;<span class="op" id="6069341">!=</span>&nbsp;<span class="ident" id="6069344">nil</span>&nbsp;<span class="op" id="6069348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069358">return</span>&nbsp;<span class="ident" id="6069365">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069385">if</span>&nbsp;<span class="ident" id="6069388">value</span>&nbsp;<span class="op" id="6069394">&gt;</span>&nbsp;<span class="num" id="6069396">16</span>&nbsp;<span class="op" id="6069399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069409">return</span>&nbsp;<span class="ident" id="6069416">UnsupportedError</span><span class="op" id="6069432">(</span><span class="string" id="6069433">&#34;excessive&nbsp;DC&nbsp;component&#34;</span><span class="op" id="6069457">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069475">dcDelta</span><span class="op" id="6069482">,</span>&nbsp;<span class="ident" id="6069484">err</span>&nbsp;<span class="op" id="6069488">:=</span>&nbsp;<span class="ident" id="6069491">d</span><span class="op" id="6069492">.</span><span class="ident" id="6069493">receiveExtend</span><span class="op" id="6069506">(</span><span class="ident" id="6069507">value</span><span class="op" id="6069512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069521">if</span>&nbsp;<span class="ident" id="6069524">err</span>&nbsp;<span class="op" id="6069528">!=</span>&nbsp;<span class="ident" id="6069531">nil</span>&nbsp;<span class="op" id="6069535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069545">return</span>&nbsp;<span class="ident" id="6069552">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069563">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069572">dc</span><span class="op" id="6069574">[</span><span class="ident" id="6069575">compIndex</span><span class="op" id="6069584">]</span>&nbsp;<span class="op" id="6069586">+=</span>&nbsp;<span class="ident" id="6069589">dcDelta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069604">b</span><span class="op" id="6069605">[</span><span class="num" id="6069606">0</span><span class="op" id="6069607">]</span>&nbsp;<span class="op" id="6069609">=</span>&nbsp;<span class="ident" id="6069611">dc</span><span class="op" id="6069613">[</span><span class="ident" id="6069614">compIndex</span><span class="op" id="6069623">]</span>&nbsp;<span class="op" id="6069625">&lt;&lt;</span>&nbsp;<span class="ident" id="6069628">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069646">if</span>&nbsp;<span class="ident" id="6069649">zig</span>&nbsp;<span class="op" id="6069653">&lt;=</span>&nbsp;<span class="ident" id="6069656">zigEnd</span>&nbsp;<span class="op" id="6069663">&amp;&amp;</span>&nbsp;<span class="ident" id="6069666">d</span><span class="op" id="6069667">.</span><span class="ident" id="6069668">eobRun</span>&nbsp;<span class="op" id="6069675">&gt;</span>&nbsp;<span class="num" id="6069677">0</span>&nbsp;<span class="op" id="6069679">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069688">d</span><span class="op" id="6069689">.</span><span class="ident" id="6069690">eobRun</span><span class="op" id="6069696">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069705">}</span>&nbsp;<span class="keyword" id="6069707">else</span>&nbsp;<span class="op" id="6069712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6069721">//&nbsp;Decode&nbsp;the&nbsp;AC&nbsp;coefficients,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069792">huff</span>&nbsp;<span class="op" id="6069797">:=</span>&nbsp;<span class="op" id="6069800">&amp;</span><span class="ident" id="6069801">d</span><span class="op" id="6069802">.</span><span class="ident" id="6069803">huff</span><span class="op" id="6069807">[</span><span class="ident" id="6069808">acTable</span><span class="op" id="6069815">]</span><span class="op" id="6069816">[</span><span class="ident" id="6069817">scan</span><span class="op" id="6069821">[</span><span class="ident" id="6069822">i</span><span class="op" id="6069823">]</span><span class="op" id="6069824">.</span><span class="ident" id="6069825">ta</span><span class="op" id="6069827">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069836">for</span>&nbsp;<span class="op" id="6069840">;</span>&nbsp;<span class="ident" id="6069842">zig</span>&nbsp;<span class="op" id="6069846">&lt;=</span>&nbsp;<span class="ident" id="6069849">zigEnd</span><span class="op" id="6069855">;</span>&nbsp;<span class="ident" id="6069857">zig</span><span class="op" id="6069860">++</span>&nbsp;<span class="op" id="6069863">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069873">value</span><span class="op" id="6069878">,</span>&nbsp;<span class="ident" id="6069880">err</span>&nbsp;<span class="op" id="6069884">:=</span>&nbsp;<span class="ident" id="6069887">d</span><span class="op" id="6069888">.</span><span class="ident" id="6069889">decodeHuffman</span><span class="op" id="6069902">(</span><span class="ident" id="6069903">huff</span><span class="op" id="6069907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069917">if</span>&nbsp;<span class="ident" id="6069920">err</span>&nbsp;<span class="op" id="6069924">!=</span>&nbsp;<span class="ident" id="6069927">nil</span>&nbsp;<span class="op" id="6069931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069942">return</span>&nbsp;<span class="ident" id="6069949">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069971">val0</span>&nbsp;<span class="op" id="6069976">:=</span>&nbsp;<span class="ident" id="6069979">value</span>&nbsp;<span class="op" id="6069985">&gt;&gt;</span>&nbsp;<span class="num" id="6069988">4</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069998">val1</span>&nbsp;<span class="op" id="6070003">:=</span>&nbsp;<span class="ident" id="6070006">value</span>&nbsp;<span class="op" id="6070012">&amp;</span>&nbsp;<span class="num" id="6070014">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070027">if</span>&nbsp;<span class="ident" id="6070030">val1</span>&nbsp;<span class="op" id="6070035">!=</span>&nbsp;<span class="num" id="6070038">0</span>&nbsp;<span class="op" id="6070040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070051">zig</span>&nbsp;<span class="op" id="6070055">+=</span>&nbsp;<span class="builtintype" id="6070058">int32</span><span class="op" id="6070063">(</span><span class="ident" id="6070064">val0</span><span class="op" id="6070068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070079">if</span>&nbsp;<span class="ident" id="6070082">zig</span>&nbsp;<span class="op" id="6070086">&gt;</span>&nbsp;<span class="ident" id="6070088">zigEnd</span>&nbsp;<span class="op" id="6070095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070107">break</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070133">ac</span><span class="op" id="6070135">,</span>&nbsp;<span class="ident" id="6070137">err</span>&nbsp;<span class="op" id="6070141">:=</span>&nbsp;<span class="ident" id="6070144">d</span><span class="op" id="6070145">.</span><span class="ident" id="6070146">receiveExtend</span><span class="op" id="6070159">(</span><span class="ident" id="6070160">val1</span><span class="op" id="6070164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070175">if</span>&nbsp;<span class="ident" id="6070178">err</span>&nbsp;<span class="op" id="6070182">!=</span>&nbsp;<span class="ident" id="6070185">nil</span>&nbsp;<span class="op" id="6070189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070201">return</span>&nbsp;<span class="ident" id="6070208">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070221">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070232">b</span><span class="op" id="6070233">[</span><span class="ident" id="6070234">unzig</span><span class="op" id="6070239">[</span><span class="ident" id="6070240">zig</span><span class="op" id="6070243">]</span><span class="op" id="6070244">]</span>&nbsp;<span class="op" id="6070246">=</span>&nbsp;<span class="ident" id="6070248">ac</span>&nbsp;<span class="op" id="6070251">&lt;&lt;</span>&nbsp;<span class="ident" id="6070254">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070265">}</span>&nbsp;<span class="keyword" id="6070267">else</span>&nbsp;<span class="op" id="6070272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070283">if</span>&nbsp;<span class="ident" id="6070286">val0</span>&nbsp;<span class="op" id="6070291">!=</span>&nbsp;<span class="num" id="6070294">0x0f</span>&nbsp;<span class="op" id="6070299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070311">d</span><span class="op" id="6070312">.</span><span class="ident" id="6070313">eobRun</span>&nbsp;<span class="op" id="6070320">=</span>&nbsp;<span class="builtintype" id="6070322">uint16</span><span class="op" id="6070328">(</span><span class="num" id="6070329">1</span>&nbsp;<span class="op" id="6070331">&lt;&lt;</span>&nbsp;<span class="ident" id="6070334">val0</span><span class="op" id="6070338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070350">if</span>&nbsp;<span class="ident" id="6070353">val0</span>&nbsp;<span class="op" id="6070358">!=</span>&nbsp;<span class="num" id="6070361">0</span>&nbsp;<span class="op" id="6070363">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070376">bits</span><span class="op" id="6070380">,</span>&nbsp;<span class="ident" id="6070382">err</span>&nbsp;<span class="op" id="6070386">:=</span>&nbsp;<span class="ident" id="6070389">d</span><span class="op" id="6070390">.</span><span class="ident" id="6070391">decodeBits</span><span class="op" id="6070401">(</span><span class="builtintype" id="6070402">int32</span><span class="op" id="6070407">(</span><span class="ident" id="6070408">val0</span><span class="op" id="6070412">)</span><span class="op" id="6070413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070426">if</span>&nbsp;<span class="ident" id="6070429">err</span>&nbsp;<span class="op" id="6070433">!=</span>&nbsp;<span class="ident" id="6070436">nil</span>&nbsp;<span class="op" id="6070440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070454">return</span>&nbsp;<span class="ident" id="6070461">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070489">d</span><span class="op" id="6070490">.</span><span class="ident" id="6070491">eobRun</span>&nbsp;<span class="op" id="6070498">|=</span>&nbsp;<span class="builtintype" id="6070501">uint16</span><span class="op" id="6070507">(</span><span class="ident" id="6070508">bits</span><span class="op" id="6070512">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070536">d</span><span class="op" id="6070537">.</span><span class="ident" id="6070538">eobRun</span><span class="op" id="6070544">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070557">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070583">zig</span>&nbsp;<span class="op" id="6070587">+=</span>&nbsp;<span class="num" id="6070590">0x0f</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070635">if</span>&nbsp;<span class="ident" id="6070638">d</span><span class="op" id="6070639">.</span><span class="ident" id="6070640">progressive</span>&nbsp;<span class="op" id="6070652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070660">if</span>&nbsp;<span class="ident" id="6070663">zigEnd</span>&nbsp;<span class="op" id="6070670">!=</span>&nbsp;<span class="ident" id="6070673">blockSize</span><span class="op" id="6070682">-</span><span class="num" id="6070683">1</span>&nbsp;<span class="op" id="6070685">||</span>&nbsp;<span class="ident" id="6070688">al</span>&nbsp;<span class="op" id="6070691">!=</span>&nbsp;<span class="num" id="6070694">0</span>&nbsp;<span class="op" id="6070696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070705">//&nbsp;We&nbsp;haven&#39;t&nbsp;completely&nbsp;decoded&nbsp;this&nbsp;8x8&nbsp;block.&nbsp;Save&nbsp;the&nbsp;coefficients.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070784">d</span><span class="op" id="6070785">.</span><span class="ident" id="6070786">progCoeffs</span><span class="op" id="6070796">[</span><span class="ident" id="6070797">compIndex</span><span class="op" id="6070806">]</span><span class="op" id="6070807">[</span><span class="ident" id="6070808">by</span><span class="op" id="6070810">*</span><span class="ident" id="6070811">mxx</span><span class="op" id="6070814">*</span><span class="ident" id="6070815">d</span><span class="op" id="6070816">.</span><span class="ident" id="6070817">comp</span><span class="op" id="6070821">[</span><span class="ident" id="6070822">compIndex</span><span class="op" id="6070831">]</span><span class="op" id="6070832">.</span><span class="ident" id="6070833">h</span><span class="op" id="6070834">+</span><span class="ident" id="6070835">bx</span><span class="op" id="6070837">]</span>&nbsp;<span class="op" id="6070839">=</span>&nbsp;<span class="ident" id="6070841">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070850">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;we&nbsp;could&nbsp;execute&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;loop&nbsp;body&nbsp;to&nbsp;dequantize&nbsp;and</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070936">//&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT,&nbsp;to&nbsp;save&nbsp;early&nbsp;stages&nbsp;of&nbsp;a&nbsp;progressive&nbsp;image&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6071022">//&nbsp;*image.YCbCr&nbsp;buffers&nbsp;(the&nbsp;whole&nbsp;point&nbsp;of&nbsp;progressive&nbsp;encoding),&nbsp;but&nbsp;in&nbsp;Go,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6071107">//&nbsp;the&nbsp;jpeg.Decode&nbsp;function&nbsp;does&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;entire&nbsp;image&nbsp;is&nbsp;decoded,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6071193">//&nbsp;so&nbsp;we&nbsp;&#34;continue&#34;&nbsp;here&nbsp;to&nbsp;avoid&nbsp;wasted&nbsp;computation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071254">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6071284">//&nbsp;Dequantize,&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT&nbsp;and&nbsp;store&nbsp;the&nbsp;block&nbsp;to&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071362">for</span>&nbsp;<span class="ident" id="6071366">zig</span>&nbsp;<span class="op" id="6071370">:=</span>&nbsp;<span class="num" id="6071373">0</span><span class="op" id="6071374">;</span>&nbsp;<span class="ident" id="6071376">zig</span>&nbsp;<span class="op" id="6071380">&lt;</span>&nbsp;<span class="ident" id="6071382">blockSize</span><span class="op" id="6071391">;</span>&nbsp;<span class="ident" id="6071393">zig</span><span class="op" id="6071396">++</span>&nbsp;<span class="op" id="6071399">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071407">b</span><span class="op" id="6071408">[</span><span class="ident" id="6071409">unzig</span><span class="op" id="6071414">[</span><span class="ident" id="6071415">zig</span><span class="op" id="6071418">]</span><span class="op" id="6071419">]</span>&nbsp;<span class="op" id="6071421">*=</span>&nbsp;<span class="ident" id="6071424">qt</span><span class="op" id="6071426">[</span><span class="ident" id="6071427">zig</span><span class="op" id="6071430">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071444">idct</span><span class="op" id="6071448">(</span><span class="op" id="6071449">&amp;</span><span class="ident" id="6071450">b</span><span class="op" id="6071451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071458">dst</span><span class="op" id="6071461">,</span>&nbsp;<span class="ident" id="6071463">stride</span>&nbsp;<span class="op" id="6071470">:=</span>&nbsp;<span class="op" id="6071473">[</span><span class="op" id="6071474">]</span><span class="builtintype" id="6071475">byte</span><span class="op" id="6071479">(</span><span class="ident" id="6071480">nil</span><span class="op" id="6071483">)</span><span class="op" id="6071484">,</span>&nbsp;<span class="num" id="6071486">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071493">if</span>&nbsp;<span class="ident" id="6071496">d</span><span class="op" id="6071497">.</span><span class="ident" id="6071498">nComp</span>&nbsp;<span class="op" id="6071504">==</span>&nbsp;<span class="ident" id="6071507">nGrayComponent</span>&nbsp;<span class="op" id="6071522">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071530">dst</span><span class="op" id="6071533">,</span>&nbsp;<span class="ident" id="6071535">stride</span>&nbsp;<span class="op" id="6071542">=</span>&nbsp;<span class="ident" id="6071544">d</span><span class="op" id="6071545">.</span><span class="ident" id="6071546">img1</span><span class="op" id="6071550">.</span><span class="ident" id="6071551">Pix</span><span class="op" id="6071554">[</span><span class="num" id="6071555">8</span><span class="op" id="6071556">*</span><span class="op" id="6071557">(</span><span class="ident" id="6071558">by</span><span class="op" id="6071560">*</span><span class="ident" id="6071561">d</span><span class="op" id="6071562">.</span><span class="ident" id="6071563">img1</span><span class="op" id="6071567">.</span><span class="ident" id="6071568">Stride</span><span class="op" id="6071574">+</span><span class="ident" id="6071575">bx</span><span class="op" id="6071577">)</span><span class="op" id="6071578">:</span><span class="op" id="6071579">]</span><span class="op" id="6071580">,</span>&nbsp;<span class="ident" id="6071582">d</span><span class="op" id="6071583">.</span><span class="ident" id="6071584">img1</span><span class="op" id="6071588">.</span><span class="ident" id="6071589">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071601">}</span>&nbsp;<span class="keyword" id="6071603">else</span>&nbsp;<span class="op" id="6071608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071616">switch</span>&nbsp;<span class="ident" id="6071623">compIndex</span>&nbsp;<span class="op" id="6071633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071641">case</span>&nbsp;<span class="num" id="6071646">0</span><span class="op" id="6071647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071656">dst</span><span class="op" id="6071659">,</span>&nbsp;<span class="ident" id="6071661">stride</span>&nbsp;<span class="op" id="6071668">=</span>&nbsp;<span class="ident" id="6071670">d</span><span class="op" id="6071671">.</span><span class="ident" id="6071672">img3</span><span class="op" id="6071676">.</span><span class="ident" id="6071677">Y</span><span class="op" id="6071678">[</span><span class="num" id="6071679">8</span><span class="op" id="6071680">*</span><span class="op" id="6071681">(</span><span class="ident" id="6071682">by</span><span class="op" id="6071684">*</span><span class="ident" id="6071685">d</span><span class="op" id="6071686">.</span><span class="ident" id="6071687">img3</span><span class="op" id="6071691">.</span><span class="ident" id="6071692">YStride</span><span class="op" id="6071699">+</span><span class="ident" id="6071700">bx</span><span class="op" id="6071702">)</span><span class="op" id="6071703">:</span><span class="op" id="6071704">]</span><span class="op" id="6071705">,</span>&nbsp;<span class="ident" id="6071707">d</span><span class="op" id="6071708">.</span><span class="ident" id="6071709">img3</span><span class="op" id="6071713">.</span><span class="ident" id="6071714">YStride</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071728">case</span>&nbsp;<span class="num" id="6071733">1</span><span class="op" id="6071734">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071743">dst</span><span class="op" id="6071746">,</span>&nbsp;<span class="ident" id="6071748">stride</span>&nbsp;<span class="op" id="6071755">=</span>&nbsp;<span class="ident" id="6071757">d</span><span class="op" id="6071758">.</span><span class="ident" id="6071759">img3</span><span class="op" id="6071763">.</span><span class="ident" id="6071764">Cb</span><span class="op" id="6071766">[</span><span class="num" id="6071767">8</span><span class="op" id="6071768">*</span><span class="op" id="6071769">(</span><span class="ident" id="6071770">by</span><span class="op" id="6071772">*</span><span class="ident" id="6071773">d</span><span class="op" id="6071774">.</span><span class="ident" id="6071775">img3</span><span class="op" id="6071779">.</span><span class="ident" id="6071780">CStride</span><span class="op" id="6071787">+</span><span class="ident" id="6071788">bx</span><span class="op" id="6071790">)</span><span class="op" id="6071791">:</span><span class="op" id="6071792">]</span><span class="op" id="6071793">,</span>&nbsp;<span class="ident" id="6071795">d</span><span class="op" id="6071796">.</span><span class="ident" id="6071797">img3</span><span class="op" id="6071801">.</span><span class="ident" id="6071802">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071816">case</span>&nbsp;<span class="num" id="6071821">2</span><span class="op" id="6071822">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071831">dst</span><span class="op" id="6071834">,</span>&nbsp;<span class="ident" id="6071836">stride</span>&nbsp;<span class="op" id="6071843">=</span>&nbsp;<span class="ident" id="6071845">d</span><span class="op" id="6071846">.</span><span class="ident" id="6071847">img3</span><span class="op" id="6071851">.</span><span class="ident" id="6071852">Cr</span><span class="op" id="6071854">[</span><span class="num" id="6071855">8</span><span class="op" id="6071856">*</span><span class="op" id="6071857">(</span><span class="ident" id="6071858">by</span><span class="op" id="6071860">*</span><span class="ident" id="6071861">d</span><span class="op" id="6071862">.</span><span class="ident" id="6071863">img3</span><span class="op" id="6071867">.</span><span class="ident" id="6071868">CStride</span><span class="op" id="6071875">+</span><span class="ident" id="6071876">bx</span><span class="op" id="6071878">)</span><span class="op" id="6071879">:</span><span class="op" id="6071880">]</span><span class="op" id="6071881">,</span>&nbsp;<span class="ident" id="6071883">d</span><span class="op" id="6071884">.</span><span class="ident" id="6071885">img3</span><span class="op" id="6071889">.</span><span class="ident" id="6071890">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071904">default</span><span class="op" id="6071911">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071920">return</span>&nbsp;<span class="ident" id="6071927">UnsupportedError</span><span class="op" id="6071943">(</span><span class="string" id="6071944">&#34;too&nbsp;many&nbsp;components&#34;</span><span class="op" id="6071965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6071987">//&nbsp;Level&nbsp;shift&nbsp;by&nbsp;+128,&nbsp;clip&nbsp;to&nbsp;[0,&nbsp;255],&nbsp;and&nbsp;write&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072052">for</span>&nbsp;<span class="ident" id="6072056">y</span>&nbsp;<span class="op" id="6072058">:=</span>&nbsp;<span class="num" id="6072061">0</span><span class="op" id="6072062">;</span>&nbsp;<span class="ident" id="6072064">y</span>&nbsp;<span class="op" id="6072066">&lt;</span>&nbsp;<span class="num" id="6072068">8</span><span class="op" id="6072069">;</span>&nbsp;<span class="ident" id="6072071">y</span><span class="op" id="6072072">++</span>&nbsp;<span class="op" id="6072075">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072083">y8</span>&nbsp;<span class="op" id="6072086">:=</span>&nbsp;<span class="ident" id="6072089">y</span>&nbsp;<span class="op" id="6072091">*</span>&nbsp;<span class="num" id="6072093">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072101">yStride</span>&nbsp;<span class="op" id="6072109">:=</span>&nbsp;<span class="ident" id="6072112">y</span>&nbsp;<span class="op" id="6072114">*</span>&nbsp;<span class="ident" id="6072116">stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072129">for</span>&nbsp;<span class="ident" id="6072133">x</span>&nbsp;<span class="op" id="6072135">:=</span>&nbsp;<span class="num" id="6072138">0</span><span class="op" id="6072139">;</span>&nbsp;<span class="ident" id="6072141">x</span>&nbsp;<span class="op" id="6072143">&lt;</span>&nbsp;<span class="num" id="6072145">8</span><span class="op" id="6072146">;</span>&nbsp;<span class="ident" id="6072148">x</span><span class="op" id="6072149">++</span>&nbsp;<span class="op" id="6072152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072161">c</span>&nbsp;<span class="op" id="6072163">:=</span>&nbsp;<span class="ident" id="6072166">b</span><span class="op" id="6072167">[</span><span class="ident" id="6072168">y8</span><span class="op" id="6072170">+</span><span class="ident" id="6072171">x</span><span class="op" id="6072172">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072181">if</span>&nbsp;<span class="ident" id="6072184">c</span>&nbsp;<span class="op" id="6072186">&lt;</span>&nbsp;<span class="op" id="6072188">-</span><span class="num" id="6072189">128</span>&nbsp;<span class="op" id="6072193">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072203">c</span>&nbsp;<span class="op" id="6072205">=</span>&nbsp;<span class="num" id="6072207">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072216">}</span>&nbsp;<span class="keyword" id="6072218">else</span>&nbsp;<span class="keyword" id="6072223">if</span>&nbsp;<span class="ident" id="6072226">c</span>&nbsp;<span class="op" id="6072228">&gt;</span>&nbsp;<span class="num" id="6072230">127</span>&nbsp;<span class="op" id="6072234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072244">c</span>&nbsp;<span class="op" id="6072246">=</span>&nbsp;<span class="num" id="6072248">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072259">}</span>&nbsp;<span class="keyword" id="6072261">else</span>&nbsp;<span class="op" id="6072266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072276">c</span>&nbsp;<span class="op" id="6072278">+=</span>&nbsp;<span class="num" id="6072281">128</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072301">dst</span><span class="op" id="6072304">[</span><span class="ident" id="6072305">yStride</span><span class="op" id="6072312">+</span><span class="ident" id="6072313">x</span><span class="op" id="6072314">]</span>&nbsp;<span class="op" id="6072316">=</span>&nbsp;<span class="builtintype" id="6072318">uint8</span><span class="op" id="6072323">(</span><span class="ident" id="6072324">c</span><span class="op" id="6072325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072346">}</span>&nbsp;<span class="comment" id="6072348">//&nbsp;for&nbsp;j</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072360">}</span>&nbsp;<span class="comment" id="6072362">//&nbsp;for&nbsp;i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072374">mcu</span><span class="op" id="6072377">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072383">if</span>&nbsp;<span class="ident" id="6072386">d</span><span class="op" id="6072387">.</span><span class="ident" id="6072388">ri</span>&nbsp;<span class="op" id="6072391">&gt;</span>&nbsp;<span class="num" id="6072393">0</span>&nbsp;<span class="op" id="6072395">&amp;&amp;</span>&nbsp;<span class="ident" id="6072398">mcu</span><span class="op" id="6072401">%</span><span class="ident" id="6072402">d</span><span class="op" id="6072403">.</span><span class="ident" id="6072404">ri</span>&nbsp;<span class="op" id="6072407">==</span>&nbsp;<span class="num" id="6072410">0</span>&nbsp;<span class="op" id="6072412">&amp;&amp;</span>&nbsp;<span class="ident" id="6072415">mcu</span>&nbsp;<span class="op" id="6072419">&lt;</span>&nbsp;<span class="ident" id="6072421">mxx</span><span class="op" id="6072424">*</span><span class="ident" id="6072425">myy</span>&nbsp;<span class="op" id="6072429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6072435">//&nbsp;A&nbsp;more&nbsp;sophisticated&nbsp;decoder&nbsp;could&nbsp;use&nbsp;RST[0-7]&nbsp;markers&nbsp;to&nbsp;resynchronize&nbsp;from&nbsp;corrupt&nbsp;input,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6072535">//&nbsp;but&nbsp;this&nbsp;one&nbsp;assumes&nbsp;well-formed&nbsp;input,&nbsp;and&nbsp;hence&nbsp;the&nbsp;restart&nbsp;marker&nbsp;follows&nbsp;immediately.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072632">if</span>&nbsp;<span class="ident" id="6072635">err</span>&nbsp;<span class="op" id="6072639">:=</span>&nbsp;<span class="ident" id="6072642">d</span><span class="op" id="6072643">.</span><span class="ident" id="6072644">readFull</span><span class="op" id="6072652">(</span><span class="ident" id="6072653">d</span><span class="op" id="6072654">.</span><span class="ident" id="6072655">tmp</span><span class="op" id="6072658">[</span><span class="op" id="6072659">:</span><span class="num" id="6072660">2</span><span class="op" id="6072661">]</span><span class="op" id="6072662">)</span><span class="op" id="6072663">;</span>&nbsp;<span class="ident" id="6072665">err</span>&nbsp;<span class="op" id="6072669">!=</span>&nbsp;<span class="ident" id="6072672">nil</span>&nbsp;<span class="op" id="6072676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072683">return</span>&nbsp;<span class="ident" id="6072690">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072704">if</span>&nbsp;<span class="ident" id="6072707">d</span><span class="op" id="6072708">.</span><span class="ident" id="6072709">tmp</span><span class="op" id="6072712">[</span><span class="num" id="6072713">0</span><span class="op" id="6072714">]</span>&nbsp;<span class="op" id="6072716">!=</span>&nbsp;<span class="num" id="6072719">0xff</span>&nbsp;<span class="op" id="6072724">||</span>&nbsp;<span class="ident" id="6072727">d</span><span class="op" id="6072728">.</span><span class="ident" id="6072729">tmp</span><span class="op" id="6072732">[</span><span class="num" id="6072733">1</span><span class="op" id="6072734">]</span>&nbsp;<span class="op" id="6072736">!=</span>&nbsp;<span class="ident" id="6072739">expectedRST</span>&nbsp;<span class="op" id="6072751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072758">return</span>&nbsp;<span class="ident" id="6072765">FormatError</span><span class="op" id="6072776">(</span><span class="string" id="6072777">&#34;bad&nbsp;RST&nbsp;marker&#34;</span><span class="op" id="6072793">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072805">expectedRST</span><span class="op" id="6072816">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072823">if</span>&nbsp;<span class="ident" id="6072826">expectedRST</span>&nbsp;<span class="op" id="6072838">==</span>&nbsp;<span class="ident" id="6072841">rst7Marker</span><span class="op" id="6072851">+</span><span class="num" id="6072852">1</span>&nbsp;<span class="op" id="6072854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072861">expectedRST</span>&nbsp;<span class="op" id="6072873">=</span>&nbsp;<span class="ident" id="6072875">rst0Marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072890">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6072896">//&nbsp;Reset&nbsp;the&nbsp;Huffman&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072930">d</span><span class="op" id="6072931">.</span><span class="ident" id="6072932">bits</span>&nbsp;<span class="op" id="6072937">=</span>&nbsp;<span class="ident" id="6072939">bits</span><span class="op" id="6072943">{</span><span class="op" id="6072944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6072950">//&nbsp;Reset&nbsp;the&nbsp;DC&nbsp;components,&nbsp;as&nbsp;per&nbsp;section&nbsp;F.2.1.3.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073008">dc</span>&nbsp;<span class="op" id="6073011">=</span>&nbsp;<span class="op" id="6073013">[</span><span class="ident" id="6073014">nColorComponent</span><span class="op" id="6073029">]</span><span class="builtintype" id="6073030">int32</span><span class="op" id="6073035">{</span><span class="op" id="6073036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6073042">//&nbsp;Reset&nbsp;the&nbsp;progressive&nbsp;decoder&nbsp;state,&nbsp;as&nbsp;per&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073110">d</span><span class="op" id="6073111">.</span><span class="ident" id="6073112">eobRun</span>&nbsp;<span class="op" id="6073119">=</span>&nbsp;<span class="num" id="6073121">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073130">}</span>&nbsp;<span class="comment" id="6073132">//&nbsp;for&nbsp;mx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073143">}</span>&nbsp;<span class="comment" id="6073145">//&nbsp;for&nbsp;my</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073157">return</span>&nbsp;<span class="ident" id="6073164">nil</span><br>
<span class="lineno"></span><span class="op" id="6073168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6073171">//&nbsp;refine&nbsp;decodes&nbsp;a&nbsp;successive&nbsp;approximation&nbsp;refinement&nbsp;block,&nbsp;as&nbsp;specified&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6073250">//&nbsp;section&nbsp;G.1.2.</span><br>
<span class="lineno">340</span><span class="keyword" id="6073268">func</span>&nbsp;<span class="op" id="6073273">(</span><span class="ident" id="6073274">d</span>&nbsp;<span class="op" id="6073276">*</span><span class="ident" id="6073277">decoder</span><span class="op" id="6073284">)</span>&nbsp;<span class="ident" id="6073286">refine</span><span class="op" id="6073292">(</span><span class="ident" id="6073293">b</span>&nbsp;<span class="op" id="6073295">*</span><span class="ident" id="6073296">block</span><span class="op" id="6073301">,</span>&nbsp;<span class="ident" id="6073303">h</span>&nbsp;<span class="op" id="6073305">*</span><span class="ident" id="6073306">huffman</span><span class="op" id="6073313">,</span>&nbsp;<span class="ident" id="6073315">zigStart</span><span class="op" id="6073323">,</span>&nbsp;<span class="ident" id="6073325">zigEnd</span><span class="op" id="6073331">,</span>&nbsp;<span class="ident" id="6073333">delta</span>&nbsp;<span class="builtintype" id="6073339">int32</span><span class="op" id="6073344">)</span>&nbsp;<span class="builtintype" id="6073346">error</span>&nbsp;<span class="op" id="6073352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6073355">//&nbsp;Refining&nbsp;a&nbsp;DC&nbsp;component&nbsp;is&nbsp;trivial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073395">if</span>&nbsp;<span class="ident" id="6073398">zigStart</span>&nbsp;<span class="op" id="6073407">==</span>&nbsp;<span class="num" id="6073410">0</span>&nbsp;<span class="op" id="6073412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073416">if</span>&nbsp;<span class="ident" id="6073419">zigEnd</span>&nbsp;<span class="op" id="6073426">!=</span>&nbsp;<span class="num" id="6073429">0</span>&nbsp;<span class="op" id="6073431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6073436">panic</span><span class="op" id="6073441">(</span><span class="string" id="6073442">&#34;unreachable&#34;</span><span class="op" id="6073455">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073463">bit</span><span class="op" id="6073466">,</span>&nbsp;<span class="ident" id="6073468">err</span>&nbsp;<span class="op" id="6073472">:=</span>&nbsp;<span class="ident" id="6073475">d</span><span class="op" id="6073476">.</span><span class="ident" id="6073477">decodeBit</span><span class="op" id="6073486">(</span><span class="op" id="6073487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073491">if</span>&nbsp;<span class="ident" id="6073494">err</span>&nbsp;<span class="op" id="6073498">!=</span>&nbsp;<span class="ident" id="6073501">nil</span>&nbsp;<span class="op" id="6073505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073510">return</span>&nbsp;<span class="ident" id="6073517">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073523">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073527">if</span>&nbsp;<span class="ident" id="6073530">bit</span>&nbsp;<span class="op" id="6073534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073539">b</span><span class="op" id="6073540">[</span><span class="num" id="6073541">0</span><span class="op" id="6073542">]</span>&nbsp;<span class="op" id="6073544">|=</span>&nbsp;<span class="ident" id="6073547">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073559">return</span>&nbsp;<span class="ident" id="6073566">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073571">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6073575">//&nbsp;Refining&nbsp;AC&nbsp;components&nbsp;is&nbsp;more&nbsp;complicated;&nbsp;see&nbsp;sections&nbsp;G.1.2.2&nbsp;and&nbsp;G.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073657">zig</span>&nbsp;<span class="op" id="6073661">:=</span>&nbsp;<span class="ident" id="6073664">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073674">if</span>&nbsp;<span class="ident" id="6073677">d</span><span class="op" id="6073678">.</span><span class="ident" id="6073679">eobRun</span>&nbsp;<span class="op" id="6073686">==</span>&nbsp;<span class="num" id="6073689">0</span>&nbsp;<span class="op" id="6073691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073694">loop</span><span class="op" id="6073698">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073702">for</span>&nbsp;<span class="op" id="6073706">;</span>&nbsp;<span class="ident" id="6073708">zig</span>&nbsp;<span class="op" id="6073712">&lt;=</span>&nbsp;<span class="ident" id="6073715">zigEnd</span><span class="op" id="6073721">;</span>&nbsp;<span class="ident" id="6073723">zig</span><span class="op" id="6073726">++</span>&nbsp;<span class="op" id="6073729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073734">z</span>&nbsp;<span class="op" id="6073736">:=</span>&nbsp;<span class="builtintype" id="6073739">int32</span><span class="op" id="6073744">(</span><span class="num" id="6073745">0</span><span class="op" id="6073746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073751">value</span><span class="op" id="6073756">,</span>&nbsp;<span class="ident" id="6073758">err</span>&nbsp;<span class="op" id="6073762">:=</span>&nbsp;<span class="ident" id="6073765">d</span><span class="op" id="6073766">.</span><span class="ident" id="6073767">decodeHuffman</span><span class="op" id="6073780">(</span><span class="ident" id="6073781">h</span><span class="op" id="6073782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073787">if</span>&nbsp;<span class="ident" id="6073790">err</span>&nbsp;<span class="op" id="6073794">!=</span>&nbsp;<span class="ident" id="6073797">nil</span>&nbsp;<span class="op" id="6073801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073807">return</span>&nbsp;<span class="ident" id="6073814">err</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073826">val0</span>&nbsp;<span class="op" id="6073831">:=</span>&nbsp;<span class="ident" id="6073834">value</span>&nbsp;<span class="op" id="6073840">&gt;&gt;</span>&nbsp;<span class="num" id="6073843">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073848">val1</span>&nbsp;<span class="op" id="6073853">:=</span>&nbsp;<span class="ident" id="6073856">value</span>&nbsp;<span class="op" id="6073862">&amp;</span>&nbsp;<span class="num" id="6073864">0x0f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073873">switch</span>&nbsp;<span class="ident" id="6073880">val1</span>&nbsp;<span class="op" id="6073885">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073890">case</span>&nbsp;<span class="num" id="6073895">0</span><span class="op" id="6073896">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073902">if</span>&nbsp;<span class="ident" id="6073905">val0</span>&nbsp;<span class="op" id="6073910">!=</span>&nbsp;<span class="num" id="6073913">0x0f</span>&nbsp;<span class="op" id="6073918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073925">d</span><span class="op" id="6073926">.</span><span class="ident" id="6073927">eobRun</span>&nbsp;<span class="op" id="6073934">=</span>&nbsp;<span class="builtintype" id="6073936">uint16</span><span class="op" id="6073942">(</span><span class="num" id="6073943">1</span>&nbsp;<span class="op" id="6073945">&lt;&lt;</span>&nbsp;<span class="ident" id="6073948">val0</span><span class="op" id="6073952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073959">if</span>&nbsp;<span class="ident" id="6073962">val0</span>&nbsp;<span class="op" id="6073967">!=</span>&nbsp;<span class="num" id="6073970">0</span>&nbsp;<span class="op" id="6073972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073980">bits</span><span class="op" id="6073984">,</span>&nbsp;<span class="ident" id="6073986">err</span>&nbsp;<span class="op" id="6073990">:=</span>&nbsp;<span class="ident" id="6073993">d</span><span class="op" id="6073994">.</span><span class="ident" id="6073995">decodeBits</span><span class="op" id="6074005">(</span><span class="builtintype" id="6074006">int32</span><span class="op" id="6074011">(</span><span class="ident" id="6074012">val0</span><span class="op" id="6074016">)</span><span class="op" id="6074017">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074025">if</span>&nbsp;<span class="ident" id="6074028">err</span>&nbsp;<span class="op" id="6074032">!=</span>&nbsp;<span class="ident" id="6074035">nil</span>&nbsp;<span class="op" id="6074039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074048">return</span>&nbsp;<span class="ident" id="6074055">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074073">d</span><span class="op" id="6074074">.</span><span class="ident" id="6074075">eobRun</span>&nbsp;<span class="op" id="6074082">|=</span>&nbsp;<span class="builtintype" id="6074085">uint16</span><span class="op" id="6074091">(</span><span class="ident" id="6074092">bits</span><span class="op" id="6074096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074103">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074110">break</span>&nbsp;<span class="ident" id="6074116">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074130">case</span>&nbsp;<span class="num" id="6074135">1</span><span class="op" id="6074136">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074142">z</span>&nbsp;<span class="op" id="6074144">=</span>&nbsp;<span class="ident" id="6074146">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074156">bit</span><span class="op" id="6074159">,</span>&nbsp;<span class="ident" id="6074161">err</span>&nbsp;<span class="op" id="6074165">:=</span>&nbsp;<span class="ident" id="6074168">d</span><span class="op" id="6074169">.</span><span class="ident" id="6074170">decodeBit</span><span class="op" id="6074179">(</span><span class="op" id="6074180">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074186">if</span>&nbsp;<span class="ident" id="6074189">err</span>&nbsp;<span class="op" id="6074193">!=</span>&nbsp;<span class="ident" id="6074196">nil</span>&nbsp;<span class="op" id="6074200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074207">return</span>&nbsp;<span class="ident" id="6074214">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074228">if</span>&nbsp;<span class="op" id="6074231">!</span><span class="ident" id="6074232">bit</span>&nbsp;<span class="op" id="6074236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074243">z</span>&nbsp;<span class="op" id="6074245">=</span>&nbsp;<span class="op" id="6074247">-</span><span class="ident" id="6074248">z</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074259">default</span><span class="op" id="6074266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074272">return</span>&nbsp;<span class="ident" id="6074279">FormatError</span><span class="op" id="6074290">(</span><span class="string" id="6074291">&#34;unexpected&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="6074316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074327">zig</span><span class="op" id="6074330">,</span>&nbsp;<span class="ident" id="6074332">err</span>&nbsp;<span class="op" id="6074336">=</span>&nbsp;<span class="ident" id="6074338">d</span><span class="op" id="6074339">.</span><span class="ident" id="6074340">refineNonZeroes</span><span class="op" id="6074355">(</span><span class="ident" id="6074356">b</span><span class="op" id="6074357">,</span>&nbsp;<span class="ident" id="6074359">zig</span><span class="op" id="6074362">,</span>&nbsp;<span class="ident" id="6074364">zigEnd</span><span class="op" id="6074370">,</span>&nbsp;<span class="builtintype" id="6074372">int32</span><span class="op" id="6074377">(</span><span class="ident" id="6074378">val0</span><span class="op" id="6074382">)</span><span class="op" id="6074383">,</span>&nbsp;<span class="ident" id="6074385">delta</span><span class="op" id="6074390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074395">if</span>&nbsp;<span class="ident" id="6074398">err</span>&nbsp;<span class="op" id="6074402">!=</span>&nbsp;<span class="ident" id="6074405">nil</span>&nbsp;<span class="op" id="6074409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074415">return</span>&nbsp;<span class="ident" id="6074422">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074434">if</span>&nbsp;<span class="ident" id="6074437">zig</span>&nbsp;<span class="op" id="6074441">&gt;</span>&nbsp;<span class="ident" id="6074443">zigEnd</span>&nbsp;<span class="op" id="6074450">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074456">return</span>&nbsp;<span class="ident" id="6074463">FormatError</span><span class="op" id="6074474">(</span><span class="string" id="6074475">&#34;too&nbsp;many&nbsp;coefficients&#34;</span><span class="op" id="6074498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074508">if</span>&nbsp;<span class="ident" id="6074511">z</span>&nbsp;<span class="op" id="6074513">!=</span>&nbsp;<span class="num" id="6074516">0</span>&nbsp;<span class="op" id="6074518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074524">b</span><span class="op" id="6074525">[</span><span class="ident" id="6074526">unzig</span><span class="op" id="6074531">[</span><span class="ident" id="6074532">zig</span><span class="op" id="6074535">]</span><span class="op" id="6074536">]</span>&nbsp;<span class="op" id="6074538">=</span>&nbsp;<span class="ident" id="6074540">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074545">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074555">if</span>&nbsp;<span class="ident" id="6074558">d</span><span class="op" id="6074559">.</span><span class="ident" id="6074560">eobRun</span>&nbsp;<span class="op" id="6074567">&gt;</span>&nbsp;<span class="num" id="6074569">0</span>&nbsp;<span class="op" id="6074571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074575">d</span><span class="op" id="6074576">.</span><span class="ident" id="6074577">eobRun</span><span class="op" id="6074583">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074588">if</span>&nbsp;<span class="ident" id="6074591">_</span><span class="op" id="6074592">,</span>&nbsp;<span class="ident" id="6074594">err</span>&nbsp;<span class="op" id="6074598">:=</span>&nbsp;<span class="ident" id="6074601">d</span><span class="op" id="6074602">.</span><span class="ident" id="6074603">refineNonZeroes</span><span class="op" id="6074618">(</span><span class="ident" id="6074619">b</span><span class="op" id="6074620">,</span>&nbsp;<span class="ident" id="6074622">zig</span><span class="op" id="6074625">,</span>&nbsp;<span class="ident" id="6074627">zigEnd</span><span class="op" id="6074633">,</span>&nbsp;<span class="op" id="6074635">-</span><span class="num" id="6074636">1</span><span class="op" id="6074637">,</span>&nbsp;<span class="ident" id="6074639">delta</span><span class="op" id="6074644">)</span><span class="op" id="6074645">;</span>&nbsp;<span class="ident" id="6074647">err</span>&nbsp;<span class="op" id="6074651">!=</span>&nbsp;<span class="ident" id="6074654">nil</span>&nbsp;<span class="op" id="6074658">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074663">return</span>&nbsp;<span class="ident" id="6074670">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074682">return</span>&nbsp;<span class="ident" id="6074689">nil</span><br>
<span class="lineno"></span><span class="op" id="6074693">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="6074696">//&nbsp;refineNonZeroes&nbsp;refines&nbsp;non-zero&nbsp;entries&nbsp;of&nbsp;b&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;If&nbsp;nz&nbsp;&gt;=&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="6074775">//&nbsp;the&nbsp;first&nbsp;nz&nbsp;zero&nbsp;entries&nbsp;are&nbsp;skipped&nbsp;over.</span><br>
<span class="lineno"></span><span class="keyword" id="6074822">func</span>&nbsp;<span class="op" id="6074827">(</span><span class="ident" id="6074828">d</span>&nbsp;<span class="op" id="6074830">*</span><span class="ident" id="6074831">decoder</span><span class="op" id="6074838">)</span>&nbsp;<span class="ident" id="6074840">refineNonZeroes</span><span class="op" id="6074855">(</span><span class="ident" id="6074856">b</span>&nbsp;<span class="op" id="6074858">*</span><span class="ident" id="6074859">block</span><span class="op" id="6074864">,</span>&nbsp;<span class="ident" id="6074866">zig</span><span class="op" id="6074869">,</span>&nbsp;<span class="ident" id="6074871">zigEnd</span><span class="op" id="6074877">,</span>&nbsp;<span class="ident" id="6074879">nz</span><span class="op" id="6074881">,</span>&nbsp;<span class="ident" id="6074883">delta</span>&nbsp;<span class="builtintype" id="6074889">int32</span><span class="op" id="6074894">)</span>&nbsp;<span class="op" id="6074896">(</span><span class="builtintype" id="6074897">int32</span><span class="op" id="6074902">,</span>&nbsp;<span class="builtintype" id="6074904">error</span><span class="op" id="6074909">)</span>&nbsp;<span class="op" id="6074911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074914">for</span>&nbsp;<span class="op" id="6074918">;</span>&nbsp;<span class="ident" id="6074920">zig</span>&nbsp;<span class="op" id="6074924">&lt;=</span>&nbsp;<span class="ident" id="6074927">zigEnd</span><span class="op" id="6074933">;</span>&nbsp;<span class="ident" id="6074935">zig</span><span class="op" id="6074938">++</span>&nbsp;<span class="op" id="6074941">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074945">u</span>&nbsp;<span class="op" id="6074947">:=</span>&nbsp;<span class="ident" id="6074950">unzig</span><span class="op" id="6074955">[</span><span class="ident" id="6074956">zig</span><span class="op" id="6074959">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074963">if</span>&nbsp;<span class="ident" id="6074966">b</span><span class="op" id="6074967">[</span><span class="ident" id="6074968">u</span><span class="op" id="6074969">]</span>&nbsp;<span class="op" id="6074971">==</span>&nbsp;<span class="num" id="6074974">0</span>&nbsp;<span class="op" id="6074976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074981">if</span>&nbsp;<span class="ident" id="6074984">nz</span>&nbsp;<span class="op" id="6074987">==</span>&nbsp;<span class="num" id="6074990">0</span>&nbsp;<span class="op" id="6074992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074998">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075007">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075012">nz</span><span class="op" id="6075014">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075020">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075035">bit</span><span class="op" id="6075038">,</span>&nbsp;<span class="ident" id="6075040">err</span>&nbsp;<span class="op" id="6075044">:=</span>&nbsp;<span class="ident" id="6075047">d</span><span class="op" id="6075048">.</span><span class="ident" id="6075049">decodeBit</span><span class="op" id="6075058">(</span><span class="op" id="6075059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075063">if</span>&nbsp;<span class="ident" id="6075066">err</span>&nbsp;<span class="op" id="6075070">!=</span>&nbsp;<span class="ident" id="6075073">nil</span>&nbsp;<span class="op" id="6075077">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075082">return</span>&nbsp;<span class="num" id="6075089">0</span><span class="op" id="6075090">,</span>&nbsp;<span class="ident" id="6075092">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075102">if</span>&nbsp;<span class="op" id="6075105">!</span><span class="ident" id="6075106">bit</span>&nbsp;<span class="op" id="6075110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075115">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075126">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075130">if</span>&nbsp;<span class="ident" id="6075133">b</span><span class="op" id="6075134">[</span><span class="ident" id="6075135">u</span><span class="op" id="6075136">]</span>&nbsp;<span class="op" id="6075138">&gt;=</span>&nbsp;<span class="num" id="6075141">0</span>&nbsp;<span class="op" id="6075143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075148">b</span><span class="op" id="6075149">[</span><span class="ident" id="6075150">u</span><span class="op" id="6075151">]</span>&nbsp;<span class="op" id="6075153">+=</span>&nbsp;<span class="ident" id="6075156">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075164">}</span>&nbsp;<span class="keyword" id="6075166">else</span>&nbsp;<span class="op" id="6075171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075176">b</span><span class="op" id="6075177">[</span><span class="ident" id="6075178">u</span><span class="op" id="6075179">]</span>&nbsp;<span class="op" id="6075181">-=</span>&nbsp;<span class="ident" id="6075184">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075192">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075198">return</span>&nbsp;<span class="ident" id="6075205">zig</span><span class="op" id="6075208">,</span>&nbsp;<span class="ident" id="6075210">nil</span><br>
<span class="lineno"></span><span class="op" id="6075214">}</span>
</div>
</body>
</html>
