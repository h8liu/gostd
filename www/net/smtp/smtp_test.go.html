<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7282557">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7282612">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7282666">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7282717">package</span>&nbsp;<span class="ident" id="7282725">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7282731">import</span>&nbsp;<span class="op" id="7282738">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7282741">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7282750">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7282759">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7282773">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7282788">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7282794">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7282801">&#34;net/textproto&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7282818">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7282829">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7282840">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7282847">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7282850">type</span>&nbsp;<span class="ident" id="7282855">authTest</span>&nbsp;<span class="keyword" id="7282864">struct</span>&nbsp;<span class="op" id="7282871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7282874">auth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7282885"><a href="/net/smtp/auth.go.html#5182815">Auth</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7282891">challenges</span>&nbsp;<span class="op" id="7282902">[</span><span class="op" id="7282903">]</span><span class="builtintype" id="7282904">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7282912">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7282923">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7282931">responses</span>&nbsp;&nbsp;<span class="op" id="7282942">[</span><span class="op" id="7282943">]</span><span class="builtintype" id="7282944">string</span><br>
<span class="lineno">25</span><span class="op" id="7282951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7282954">var</span>&nbsp;<span class="ident" id="7282958">authTests</span>&nbsp;<span class="op" id="7282968">=</span>&nbsp;<span class="op" id="7282970">[</span><span class="op" id="7282971">]</span><span class="ident" id="7282972"><a href="/net/smtp/smtp_test.go.html#7282855">authTest</a></span><span class="op" id="7282980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7282983">{</span><span class="ident" id="7282984"><a href="/net/smtp/auth.go.html#5184343">PlainAuth</a></span><span class="op" id="7282993">(</span><span class="string" id="7282994">&#34;&#34;</span><span class="op" id="7282996">,</span>&nbsp;<span class="string" id="7282998">&#34;user&#34;</span><span class="op" id="7283004">,</span>&nbsp;<span class="string" id="7283006">&#34;pass&#34;</span><span class="op" id="7283012">,</span>&nbsp;<span class="string" id="7283014">&#34;testserver&#34;</span><span class="op" id="7283026">)</span><span class="op" id="7283027">,</span>&nbsp;<span class="op" id="7283029">[</span><span class="op" id="7283030">]</span><span class="builtintype" id="7283031">string</span><span class="op" id="7283037">{</span><span class="op" id="7283038">}</span><span class="op" id="7283039">,</span>&nbsp;<span class="string" id="7283041">&#34;PLAIN&#34;</span><span class="op" id="7283048">,</span>&nbsp;<span class="op" id="7283050">[</span><span class="op" id="7283051">]</span><span class="builtintype" id="7283052">string</span><span class="op" id="7283058">{</span><span class="string" id="7283059">&#34;\x00user\x00pass&#34;</span><span class="op" id="7283077">}</span><span class="op" id="7283078">}</span><span class="op" id="7283079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7283082">{</span><span class="ident" id="7283083"><a href="/net/smtp/auth.go.html#5184343">PlainAuth</a></span><span class="op" id="7283092">(</span><span class="string" id="7283093">&#34;foo&#34;</span><span class="op" id="7283098">,</span>&nbsp;<span class="string" id="7283100">&#34;bar&#34;</span><span class="op" id="7283105">,</span>&nbsp;<span class="string" id="7283107">&#34;baz&#34;</span><span class="op" id="7283112">,</span>&nbsp;<span class="string" id="7283114">&#34;testserver&#34;</span><span class="op" id="7283126">)</span><span class="op" id="7283127">,</span>&nbsp;<span class="op" id="7283129">[</span><span class="op" id="7283130">]</span><span class="builtintype" id="7283131">string</span><span class="op" id="7283137">{</span><span class="op" id="7283138">}</span><span class="op" id="7283139">,</span>&nbsp;<span class="string" id="7283141">&#34;PLAIN&#34;</span><span class="op" id="7283148">,</span>&nbsp;<span class="op" id="7283150">[</span><span class="op" id="7283151">]</span><span class="builtintype" id="7283152">string</span><span class="op" id="7283158">{</span><span class="string" id="7283159">&#34;foo\x00bar\x00baz&#34;</span><span class="op" id="7283178">}</span><span class="op" id="7283179">}</span><span class="op" id="7283180">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7283183">{</span><span class="ident" id="7283184"><a href="/net/smtp/auth.go.html#5185447">CRAMMD5Auth</a></span><span class="op" id="7283195">(</span><span class="string" id="7283196">&#34;user&#34;</span><span class="op" id="7283202">,</span>&nbsp;<span class="string" id="7283204">&#34;pass&#34;</span><span class="op" id="7283210">)</span><span class="op" id="7283211">,</span>&nbsp;<span class="op" id="7283213">[</span><span class="op" id="7283214">]</span><span class="builtintype" id="7283215">string</span><span class="op" id="7283221">{</span><span class="string" id="7283222">&#34;&lt;123456.1322876914@testserver&gt;&#34;</span><span class="op" id="7283254">}</span><span class="op" id="7283255">,</span>&nbsp;<span class="string" id="7283257">&#34;CRAM-MD5&#34;</span><span class="op" id="7283267">,</span>&nbsp;<span class="op" id="7283269">[</span><span class="op" id="7283270">]</span><span class="builtintype" id="7283271">string</span><span class="op" id="7283277">{</span><span class="string" id="7283278">&#34;&#34;</span><span class="op" id="7283280">,</span>&nbsp;<span class="string" id="7283282">&#34;user&nbsp;287eb355114cf5c471c26a875f1ca4ae&#34;</span><span class="op" id="7283321">}</span><span class="op" id="7283322">}</span><span class="op" id="7283323">,</span><br>
<span class="lineno"></span><span class="op" id="7283325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7283328">func</span>&nbsp;<span class="ident" id="7283333">TestAuth</span><span class="op" id="7283341">(</span><span class="ident" id="7283342">t</span>&nbsp;<span class="op" id="7283344">*</span><span class="ident" id="7283345"><a href="/net/smtp/smtp_test.go.html#7282829">testing</a></span><span class="op" id="7283352">.</span><span class="ident" id="7283353">T</span><span class="op" id="7283354">)</span>&nbsp;<span class="op" id="7283356">{</span><br>
<span class="lineno"></span><span class="ident" id="7283358">testLoop</span><span class="op" id="7283366">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7283369">for</span>&nbsp;<span class="ident" id="7283373">i</span><span class="op" id="7283374">,</span>&nbsp;<span class="ident" id="7283376">test</span>&nbsp;<span class="op" id="7283381">:=</span>&nbsp;<span class="keyword" id="7283384">range</span>&nbsp;<span class="ident" id="7283390"><a href="/net/smtp/smtp_test.go.html#7282958">authTests</a></span>&nbsp;<span class="op" id="7283400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7283404">name</span><span class="op" id="7283408">,</span>&nbsp;<span class="ident" id="7283410">resp</span><span class="op" id="7283414">,</span>&nbsp;<span class="ident" id="7283416">err</span>&nbsp;<span class="op" id="7283420">:=</span>&nbsp;<span class="ident" id="7283423"><a href="/net/smtp/smtp_test.go.html#7283376">test</a></span><span class="op" id="7283427">.</span><span class="ident" id="7283428">auth</span><span class="op" id="7283432">.</span><span class="ident" id="7283433">Start</span><span class="op" id="7283438">(</span><span class="op" id="7283439">&amp;</span><span class="ident" id="7283440"><a href="/net/smtp/auth.go.html#5183772">ServerInfo</a></span><span class="op" id="7283450">{</span><span class="string" id="7283451">&#34;testserver&#34;</span><span class="op" id="7283463">,</span>&nbsp;<span class="ident" id="7283465">true</span><span class="op" id="7283469">,</span>&nbsp;<span class="ident" id="7283471">nil</span><span class="op" id="7283474">}</span><span class="op" id="7283475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7283479">if</span>&nbsp;<span class="ident" id="7283482"><a href="/net/smtp/smtp_test.go.html#7283404">name</a></span>&nbsp;<span class="op" id="7283487">!=</span>&nbsp;<span class="ident" id="7283490"><a href="/net/smtp/smtp_test.go.html#7283376">test</a></span><span class="op" id="7283494">.</span><span class="ident" id="7283495">name</span>&nbsp;<span class="op" id="7283500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7283505"><a href="/net/smtp/smtp_test.go.html#7283342">t</a></span><span class="op" id="7283506">.</span><span class="ident" id="7283507">Errorf</span><span class="op" id="7283513">(</span><span class="string" id="7283514">&#34;#%d&nbsp;got&nbsp;name&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="7283544">,</span>&nbsp;<span class="ident" id="7283546"><a href="/net/smtp/smtp_test.go.html#7283373">i</a></span><span class="op" id="7283547">,</span>&nbsp;<span class="ident" id="7283549"><a href="/net/smtp/smtp_test.go.html#7283404">name</a></span><span class="op" id="7283553">,</span>&nbsp;<span class="ident" id="7283555"><a href="/net/smtp/smtp_test.go.html#7283376">test</a></span><span class="op" id="7283559">.</span><span class="ident" id="7283560">name</span><span class="op" id="7283564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7283568">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7283572">if</span>&nbsp;<span class="op" id="7283575">!</span><span class="ident" id="7283576"><a href="/net/smtp/smtp_test.go.html#7282750">bytes</a></span><span class="op" id="7283581">.</span><span class="ident" id="7283582">Equal</span><span class="op" id="7283587">(</span><span class="ident" id="7283588"><a href="/net/smtp/smtp_test.go.html#7283410">resp</a></span><span class="op" id="7283592">,</span>&nbsp;<span class="op" id="7283594">[</span><span class="op" id="7283595">]</span><span class="builtintype" id="7283596">byte</span><span class="op" id="7283600">(</span><span class="ident" id="7283601"><a href="/net/smtp/smtp_test.go.html#7283376">test</a></span><span class="op" id="7283605">.</span><span class="ident" id="7283606">responses</span><span class="op" id="7283615">[</span><span class="num" id="7283616">0</span><span class="op" id="7283617">]</span><span class="op" id="7283618">)</span><span class="op" id="7283619">)</span>&nbsp;<span class="op" id="7283621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7283626"><a href="/net/smtp/smtp_test.go.html#7283342">t</a></span><span class="op" id="7283627">.</span><span class="ident" id="7283628">Errorf</span><span class="op" id="7283634">(</span><span class="string" id="7283635">&#34;#%d&nbsp;got&nbsp;response&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="7283669">,</span>&nbsp;<span class="ident" id="7283671"><a href="/net/smtp/smtp_test.go.html#7283373">i</a></span><span class="op" id="7283672">,</span>&nbsp;<span class="ident" id="7283674"><a href="/net/smtp/smtp_test.go.html#7283410">resp</a></span><span class="op" id="7283678">,</span>&nbsp;<span class="ident" id="7283680"><a href="/net/smtp/smtp_test.go.html#7283376">test</a></span><span class="op" id="7283684">.</span><span class="ident" id="7283685">responses</span><span class="op" id="7283694">[</span><span class="num" id="7283695">0</span><span class="op" id="7283696">]</span><span class="op" id="7283697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7283701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7283705">if</span>&nbsp;<span class="ident" id="7283708"><a href="/net/smtp/smtp_test.go.html#7283416">err</a></span>&nbsp;<span class="op" id="7283712">!=</span>&nbsp;<span class="ident" id="7283715">nil</span>&nbsp;<span class="op" id="7283719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7283724"><a href="/net/smtp/smtp_test.go.html#7283342">t</a></span><span class="op" id="7283725">.</span><span class="ident" id="7283726">Errorf</span><span class="op" id="7283732">(</span><span class="string" id="7283733">&#34;#%d&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7283748">,</span>&nbsp;<span class="ident" id="7283750"><a href="/net/smtp/smtp_test.go.html#7283373">i</a></span><span class="op" id="7283751">,</span>&nbsp;<span class="ident" id="7283753"><a href="/net/smtp/smtp_test.go.html#7283416">err</a></span><span class="op" id="7283756">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7283760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7283764">for</span>&nbsp;<span class="ident" id="7283768">j</span>&nbsp;<span class="op" id="7283770">:=</span>&nbsp;<span class="keyword" id="7283773">range</span>&nbsp;<span class="ident" id="7283779"><a href="/net/smtp/smtp_test.go.html#7283376">test</a></span><span class="op" id="7283783">.</span><span class="ident" id="7283784">challenges</span>&nbsp;<span class="op" id="7283795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7283800">challenge</span>&nbsp;<span class="op" id="7283810">:=</span>&nbsp;<span class="op" id="7283813">[</span><span class="op" id="7283814">]</span><span class="builtintype" id="7283815">byte</span><span class="op" id="7283819">(</span><span class="ident" id="7283820"><a href="/net/smtp/smtp_test.go.html#7283376">test</a></span><span class="op" id="7283824">.</span><span class="ident" id="7283825">challenges</span><span class="op" id="7283835">[</span><span class="ident" id="7283836"><a href="/net/smtp/smtp_test.go.html#7283768">j</a></span><span class="op" id="7283837">]</span><span class="op" id="7283838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7283843">expected</span>&nbsp;<span class="op" id="7283852">:=</span>&nbsp;<span class="op" id="7283855">[</span><span class="op" id="7283856">]</span><span class="builtintype" id="7283857">byte</span><span class="op" id="7283861">(</span><span class="ident" id="7283862"><a href="/net/smtp/smtp_test.go.html#7283376">test</a></span><span class="op" id="7283866">.</span><span class="ident" id="7283867">responses</span><span class="op" id="7283876">[</span><span class="ident" id="7283877"><a href="/net/smtp/smtp_test.go.html#7283768">j</a></span><span class="op" id="7283878">+</span><span class="num" id="7283879">1</span><span class="op" id="7283880">]</span><span class="op" id="7283881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7283886">resp</span><span class="op" id="7283890">,</span>&nbsp;<span class="ident" id="7283892">err</span>&nbsp;<span class="op" id="7283896">:=</span>&nbsp;<span class="ident" id="7283899"><a href="/net/smtp/smtp_test.go.html#7283376">test</a></span><span class="op" id="7283903">.</span><span class="ident" id="7283904">auth</span><span class="op" id="7283908">.</span><span class="ident" id="7283909">Next</span><span class="op" id="7283913">(</span><span class="ident" id="7283914"><a href="/net/smtp/smtp_test.go.html#7283800">challenge</a></span><span class="op" id="7283923">,</span>&nbsp;<span class="ident" id="7283925">true</span><span class="op" id="7283929">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7283934">if</span>&nbsp;<span class="ident" id="7283937"><a href="/net/smtp/smtp_test.go.html#7283892">err</a></span>&nbsp;<span class="op" id="7283941">!=</span>&nbsp;<span class="ident" id="7283944">nil</span>&nbsp;<span class="op" id="7283948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7283954"><a href="/net/smtp/smtp_test.go.html#7283342">t</a></span><span class="op" id="7283955">.</span><span class="ident" id="7283956">Errorf</span><span class="op" id="7283962">(</span><span class="string" id="7283963">&#34;#%d&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7283978">,</span>&nbsp;<span class="ident" id="7283980"><a href="/net/smtp/smtp_test.go.html#7283373">i</a></span><span class="op" id="7283981">,</span>&nbsp;<span class="ident" id="7283983"><a href="/net/smtp/smtp_test.go.html#7283892">err</a></span><span class="op" id="7283986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7283992">continue</span>&nbsp;<span class="ident" id="7284001">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7284018">if</span>&nbsp;<span class="op" id="7284021">!</span><span class="ident" id="7284022"><a href="/net/smtp/smtp_test.go.html#7282750">bytes</a></span><span class="op" id="7284027">.</span><span class="ident" id="7284028">Equal</span><span class="op" id="7284033">(</span><span class="ident" id="7284034"><a href="/net/smtp/smtp_test.go.html#7283886">resp</a></span><span class="op" id="7284038">,</span>&nbsp;<span class="ident" id="7284040"><a href="/net/smtp/smtp_test.go.html#7283843">expected</a></span><span class="op" id="7284048">)</span>&nbsp;<span class="op" id="7284050">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284056"><a href="/net/smtp/smtp_test.go.html#7283342">t</a></span><span class="op" id="7284057">.</span><span class="ident" id="7284058">Errorf</span><span class="op" id="7284064">(</span><span class="string" id="7284065">&#34;#%d&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="7284090">,</span>&nbsp;<span class="ident" id="7284092"><a href="/net/smtp/smtp_test.go.html#7283373">i</a></span><span class="op" id="7284093">,</span>&nbsp;<span class="ident" id="7284095"><a href="/net/smtp/smtp_test.go.html#7283886">resp</a></span><span class="op" id="7284099">,</span>&nbsp;<span class="ident" id="7284101"><a href="/net/smtp/smtp_test.go.html#7283843">expected</a></span><span class="op" id="7284109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7284115">continue</span>&nbsp;<span class="ident" id="7284124">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284143">}</span><br>
<span class="lineno">60</span><span class="op" id="7284145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7284148">func</span>&nbsp;<span class="ident" id="7284153">TestAuthPlain</span><span class="op" id="7284166">(</span><span class="ident" id="7284167">t</span>&nbsp;<span class="op" id="7284169">*</span><span class="ident" id="7284170"><a href="/net/smtp/smtp_test.go.html#7282829">testing</a></span><span class="op" id="7284177">.</span><span class="ident" id="7284178">T</span><span class="op" id="7284179">)</span>&nbsp;<span class="op" id="7284181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284184">auth</span>&nbsp;<span class="op" id="7284189">:=</span>&nbsp;<span class="ident" id="7284192"><a href="/net/smtp/auth.go.html#5184343">PlainAuth</a></span><span class="op" id="7284201">(</span><span class="string" id="7284202">&#34;foo&#34;</span><span class="op" id="7284207">,</span>&nbsp;<span class="string" id="7284209">&#34;bar&#34;</span><span class="op" id="7284214">,</span>&nbsp;<span class="string" id="7284216">&#34;baz&#34;</span><span class="op" id="7284221">,</span>&nbsp;<span class="string" id="7284223">&#34;servername&#34;</span><span class="op" id="7284235">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284239">tests</span>&nbsp;<span class="op" id="7284245">:=</span>&nbsp;<span class="op" id="7284248">[</span><span class="op" id="7284249">]</span><span class="keyword" id="7284250">struct</span>&nbsp;<span class="op" id="7284257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284261">server</span>&nbsp;<span class="op" id="7284268">*</span><span class="ident" id="7284269"><a href="/net/smtp/auth.go.html#5183772">ServerInfo</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284282">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7284289">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284297">}</span><span class="op" id="7284298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284302">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284307">server</span><span class="op" id="7284313">:</span>&nbsp;<span class="op" id="7284315">&amp;</span><span class="ident" id="7284316"><a href="/net/smtp/auth.go.html#5183772">ServerInfo</a></span><span class="op" id="7284326">{</span><span class="ident" id="7284327">Name</span><span class="op" id="7284331">:</span>&nbsp;<span class="string" id="7284333">&#34;servername&#34;</span><span class="op" id="7284345">,</span>&nbsp;<span class="ident" id="7284347">TLS</span><span class="op" id="7284350">:</span>&nbsp;<span class="ident" id="7284352">true</span><span class="op" id="7284356">}</span><span class="op" id="7284357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284361">}</span><span class="op" id="7284362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7284371">//&nbsp;Okay;&nbsp;explicitly&nbsp;advertised&nbsp;by&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284416">server</span><span class="op" id="7284422">:</span>&nbsp;<span class="op" id="7284424">&amp;</span><span class="ident" id="7284425"><a href="/net/smtp/auth.go.html#5183772">ServerInfo</a></span><span class="op" id="7284435">{</span><span class="ident" id="7284436">Name</span><span class="op" id="7284440">:</span>&nbsp;<span class="string" id="7284442">&#34;servername&#34;</span><span class="op" id="7284454">,</span>&nbsp;<span class="ident" id="7284456">Auth</span><span class="op" id="7284460">:</span>&nbsp;<span class="op" id="7284462">[</span><span class="op" id="7284463">]</span><span class="builtintype" id="7284464">string</span><span class="op" id="7284470">{</span><span class="string" id="7284471">&#34;PLAIN&#34;</span><span class="op" id="7284478">}</span><span class="op" id="7284479">}</span><span class="op" id="7284480">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284484">}</span><span class="op" id="7284485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284494">server</span><span class="op" id="7284500">:</span>&nbsp;<span class="op" id="7284502">&amp;</span><span class="ident" id="7284503"><a href="/net/smtp/auth.go.html#5183772">ServerInfo</a></span><span class="op" id="7284513">{</span><span class="ident" id="7284514">Name</span><span class="op" id="7284518">:</span>&nbsp;<span class="string" id="7284520">&#34;servername&#34;</span><span class="op" id="7284532">,</span>&nbsp;<span class="ident" id="7284534">Auth</span><span class="op" id="7284538">:</span>&nbsp;<span class="op" id="7284540">[</span><span class="op" id="7284541">]</span><span class="builtintype" id="7284542">string</span><span class="op" id="7284548">{</span><span class="string" id="7284549">&#34;CRAM-MD5&#34;</span><span class="op" id="7284559">}</span><span class="op" id="7284560">}</span><span class="op" id="7284561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284566">err</span><span class="op" id="7284569">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7284574">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="7284598">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284602">}</span><span class="op" id="7284603">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284612">server</span><span class="op" id="7284618">:</span>&nbsp;<span class="op" id="7284620">&amp;</span><span class="ident" id="7284621"><a href="/net/smtp/auth.go.html#5183772">ServerInfo</a></span><span class="op" id="7284631">{</span><span class="ident" id="7284632">Name</span><span class="op" id="7284636">:</span>&nbsp;<span class="string" id="7284638">&#34;attacker&#34;</span><span class="op" id="7284648">,</span>&nbsp;<span class="ident" id="7284650">TLS</span><span class="op" id="7284653">:</span>&nbsp;<span class="ident" id="7284655">true</span><span class="op" id="7284659">}</span><span class="op" id="7284660">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284665">err</span><span class="op" id="7284668">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7284673">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="7284690">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284694">}</span><span class="op" id="7284695">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284698">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7284701">for</span>&nbsp;<span class="ident" id="7284705">i</span><span class="op" id="7284706">,</span>&nbsp;<span class="ident" id="7284708">tt</span>&nbsp;<span class="op" id="7284711">:=</span>&nbsp;<span class="keyword" id="7284714">range</span>&nbsp;<span class="ident" id="7284720"><a href="/net/smtp/smtp_test.go.html#7284239">tests</a></span>&nbsp;<span class="op" id="7284726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284730">_</span><span class="op" id="7284731">,</span>&nbsp;<span class="ident" id="7284733">_</span><span class="op" id="7284734">,</span>&nbsp;<span class="ident" id="7284736">err</span>&nbsp;<span class="op" id="7284740">:=</span>&nbsp;<span class="ident" id="7284743"><a href="/net/smtp/smtp_test.go.html#7284184">auth</a></span><span class="op" id="7284747">.</span><span class="ident" id="7284748">Start</span><span class="op" id="7284753">(</span><span class="ident" id="7284754"><a href="/net/smtp/smtp_test.go.html#7284708">tt</a></span><span class="op" id="7284756">.</span><span class="ident" id="7284757">server</span><span class="op" id="7284763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284767">got</span>&nbsp;<span class="op" id="7284771">:=</span>&nbsp;<span class="string" id="7284774">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7284779">if</span>&nbsp;<span class="ident" id="7284782"><a href="/net/smtp/smtp_test.go.html#7284736">err</a></span>&nbsp;<span class="op" id="7284786">!=</span>&nbsp;<span class="ident" id="7284789">nil</span>&nbsp;<span class="op" id="7284793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284798"><a href="/net/smtp/smtp_test.go.html#7284767">got</a></span>&nbsp;<span class="op" id="7284802">=</span>&nbsp;<span class="ident" id="7284804"><a href="/net/smtp/smtp_test.go.html#7284736">err</a></span><span class="op" id="7284807">.</span><span class="ident" id="7284808">Error</span><span class="op" id="7284813">(</span><span class="op" id="7284814">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7284822">if</span>&nbsp;<span class="ident" id="7284825"><a href="/net/smtp/smtp_test.go.html#7284767">got</a></span>&nbsp;<span class="op" id="7284829">!=</span>&nbsp;<span class="ident" id="7284832"><a href="/net/smtp/smtp_test.go.html#7284708">tt</a></span><span class="op" id="7284834">.</span><span class="ident" id="7284835">err</span>&nbsp;<span class="op" id="7284839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284844"><a href="/net/smtp/smtp_test.go.html#7284167">t</a></span><span class="op" id="7284845">.</span><span class="ident" id="7284846">Errorf</span><span class="op" id="7284852">(</span><span class="string" id="7284853">&#34;%d.&nbsp;got&nbsp;error&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7284882">,</span>&nbsp;<span class="ident" id="7284884"><a href="/net/smtp/smtp_test.go.html#7284705">i</a></span><span class="op" id="7284885">,</span>&nbsp;<span class="ident" id="7284887"><a href="/net/smtp/smtp_test.go.html#7284767">got</a></span><span class="op" id="7284890">,</span>&nbsp;<span class="ident" id="7284892"><a href="/net/smtp/smtp_test.go.html#7284708">tt</a></span><span class="op" id="7284894">.</span><span class="ident" id="7284895">err</span><span class="op" id="7284898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7284905">}</span><br>
<span class="lineno">95</span><span class="op" id="7284907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7284910">type</span>&nbsp;<span class="ident" id="7284915">faker</span>&nbsp;<span class="keyword" id="7284921">struct</span>&nbsp;<span class="op" id="7284928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7284931"><a href="/net/smtp/smtp_test.go.html#7282788">io</a></span><span class="op" id="7284933">.</span><span class="ident" id="7284934">ReadWriter</span><br>
<span class="lineno"></span><span class="op" id="7284945">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="7284948">func</span>&nbsp;<span class="op" id="7284953">(</span><span class="ident" id="7284954">f</span>&nbsp;<span class="ident" id="7284956"><a href="/net/smtp/smtp_test.go.html#7284915">faker</a></span><span class="op" id="7284961">)</span>&nbsp;<span class="ident" id="7284963">Close</span><span class="op" id="7284968">(</span><span class="op" id="7284969">)</span>&nbsp;<span class="builtintype" id="7284971">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7284997">{</span>&nbsp;<span class="keyword" id="7284999">return</span>&nbsp;<span class="ident" id="7285006">nil</span>&nbsp;<span class="op" id="7285010">}</span><br>
<span class="lineno"></span><span class="keyword" id="7285012">func</span>&nbsp;<span class="op" id="7285017">(</span><span class="ident" id="7285018">f</span>&nbsp;<span class="ident" id="7285020"><a href="/net/smtp/smtp_test.go.html#7284915">faker</a></span><span class="op" id="7285025">)</span>&nbsp;<span class="ident" id="7285027">LocalAddr</span><span class="op" id="7285036">(</span><span class="op" id="7285037">)</span>&nbsp;<span class="ident" id="7285039"><a href="/net/smtp/smtp_test.go.html#7282794">net</a></span><span class="op" id="7285042">.</span><span class="ident" id="7285043">Addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7285061">{</span>&nbsp;<span class="keyword" id="7285063">return</span>&nbsp;<span class="ident" id="7285070">nil</span>&nbsp;<span class="op" id="7285074">}</span><br>
<span class="lineno"></span><span class="keyword" id="7285076">func</span>&nbsp;<span class="op" id="7285081">(</span><span class="ident" id="7285082">f</span>&nbsp;<span class="ident" id="7285084"><a href="/net/smtp/smtp_test.go.html#7284915">faker</a></span><span class="op" id="7285089">)</span>&nbsp;<span class="ident" id="7285091">RemoteAddr</span><span class="op" id="7285101">(</span><span class="op" id="7285102">)</span>&nbsp;<span class="ident" id="7285104"><a href="/net/smtp/smtp_test.go.html#7282794">net</a></span><span class="op" id="7285107">.</span><span class="ident" id="7285108">Addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7285125">{</span>&nbsp;<span class="keyword" id="7285127">return</span>&nbsp;<span class="ident" id="7285134">nil</span>&nbsp;<span class="op" id="7285138">}</span><br>
<span class="lineno"></span><span class="keyword" id="7285140">func</span>&nbsp;<span class="op" id="7285145">(</span><span class="ident" id="7285146">f</span>&nbsp;<span class="ident" id="7285148"><a href="/net/smtp/smtp_test.go.html#7284915">faker</a></span><span class="op" id="7285153">)</span>&nbsp;<span class="ident" id="7285155">SetDeadline</span><span class="op" id="7285166">(</span><span class="ident" id="7285167"><a href="/net/smtp/smtp_test.go.html#7282840">time</a></span><span class="op" id="7285171">.</span><span class="ident" id="7285172">Time</span><span class="op" id="7285176">)</span>&nbsp;<span class="builtintype" id="7285178">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7285189">{</span>&nbsp;<span class="keyword" id="7285191">return</span>&nbsp;<span class="ident" id="7285198">nil</span>&nbsp;<span class="op" id="7285202">}</span><br>
<span class="lineno">105</span><span class="keyword" id="7285204">func</span>&nbsp;<span class="op" id="7285209">(</span><span class="ident" id="7285210">f</span>&nbsp;<span class="ident" id="7285212"><a href="/net/smtp/smtp_test.go.html#7284915">faker</a></span><span class="op" id="7285217">)</span>&nbsp;<span class="ident" id="7285219">SetReadDeadline</span><span class="op" id="7285234">(</span><span class="ident" id="7285235"><a href="/net/smtp/smtp_test.go.html#7282840">time</a></span><span class="op" id="7285239">.</span><span class="ident" id="7285240">Time</span><span class="op" id="7285244">)</span>&nbsp;<span class="builtintype" id="7285246">error</span>&nbsp;&nbsp;<span class="op" id="7285253">{</span>&nbsp;<span class="keyword" id="7285255">return</span>&nbsp;<span class="ident" id="7285262">nil</span>&nbsp;<span class="op" id="7285266">}</span><br>
<span class="lineno"></span><span class="keyword" id="7285268">func</span>&nbsp;<span class="op" id="7285273">(</span><span class="ident" id="7285274">f</span>&nbsp;<span class="ident" id="7285276"><a href="/net/smtp/smtp_test.go.html#7284915">faker</a></span><span class="op" id="7285281">)</span>&nbsp;<span class="ident" id="7285283">SetWriteDeadline</span><span class="op" id="7285299">(</span><span class="ident" id="7285300"><a href="/net/smtp/smtp_test.go.html#7282840">time</a></span><span class="op" id="7285304">.</span><span class="ident" id="7285305">Time</span><span class="op" id="7285309">)</span>&nbsp;<span class="builtintype" id="7285311">error</span>&nbsp;<span class="op" id="7285317">{</span>&nbsp;<span class="keyword" id="7285319">return</span>&nbsp;<span class="ident" id="7285326">nil</span>&nbsp;<span class="op" id="7285330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7285333">func</span>&nbsp;<span class="ident" id="7285338">TestBasic</span><span class="op" id="7285347">(</span><span class="ident" id="7285348">t</span>&nbsp;<span class="op" id="7285350">*</span><span class="ident" id="7285351"><a href="/net/smtp/smtp_test.go.html#7282829">testing</a></span><span class="op" id="7285358">.</span><span class="ident" id="7285359">T</span><span class="op" id="7285360">)</span>&nbsp;<span class="op" id="7285362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7285365">server</span>&nbsp;<span class="op" id="7285372">:=</span>&nbsp;<span class="ident" id="7285375"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7285382">.</span><span class="ident" id="7285383">Join</span><span class="op" id="7285387">(</span><span class="ident" id="7285388"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7285395">.</span><span class="ident" id="7285396">Split</span><span class="op" id="7285401">(</span><span class="ident" id="7285402"><a href="/net/smtp/smtp_test.go.html#7287496">basicServer</a></span><span class="op" id="7285413">,</span>&nbsp;<span class="string" id="7285415">&#34;\n&#34;</span><span class="op" id="7285419">)</span><span class="op" id="7285420">,</span>&nbsp;<span class="string" id="7285422">&#34;\r\n&#34;</span><span class="op" id="7285428">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7285431">client</span>&nbsp;<span class="op" id="7285438">:=</span>&nbsp;<span class="ident" id="7285441"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7285448">.</span><span class="ident" id="7285449">Join</span><span class="op" id="7285453">(</span><span class="ident" id="7285454"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7285461">.</span><span class="ident" id="7285462">Split</span><span class="op" id="7285467">(</span><span class="ident" id="7285468"><a href="/net/smtp/smtp_test.go.html#7287822">basicClient</a></span><span class="op" id="7285479">,</span>&nbsp;<span class="string" id="7285481">&#34;\n&#34;</span><span class="op" id="7285485">)</span><span class="op" id="7285486">,</span>&nbsp;<span class="string" id="7285488">&#34;\r\n&#34;</span><span class="op" id="7285494">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7285498">var</span>&nbsp;<span class="ident" id="7285502">cmdbuf</span>&nbsp;<span class="ident" id="7285509"><a href="/net/smtp/smtp_test.go.html#7282750">bytes</a></span><span class="op" id="7285514">.</span><span class="ident" id="7285515">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7285523">bcmdbuf</span>&nbsp;<span class="op" id="7285531">:=</span>&nbsp;<span class="ident" id="7285534"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7285539">.</span><span class="ident" id="7285540">NewWriter</span><span class="op" id="7285549">(</span><span class="op" id="7285550">&amp;</span><span class="ident" id="7285551"><a href="/net/smtp/smtp_test.go.html#7285502">cmdbuf</a></span><span class="op" id="7285557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7285560">var</span>&nbsp;<span class="ident" id="7285564">fake</span>&nbsp;<span class="ident" id="7285569"><a href="/net/smtp/smtp_test.go.html#7284915">faker</a></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7285576"><a href="/net/smtp/smtp_test.go.html#7285564">fake</a></span><span class="op" id="7285580">.</span><span class="ident" id="7285581">ReadWriter</span>&nbsp;<span class="op" id="7285592">=</span>&nbsp;<span class="ident" id="7285594"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7285599">.</span><span class="ident" id="7285600">NewReadWriter</span><span class="op" id="7285613">(</span><span class="ident" id="7285614"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7285619">.</span><span class="ident" id="7285620">NewReader</span><span class="op" id="7285629">(</span><span class="ident" id="7285630"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7285637">.</span><span class="ident" id="7285638">NewReader</span><span class="op" id="7285647">(</span><span class="ident" id="7285648"><a href="/net/smtp/smtp_test.go.html#7285365">server</a></span><span class="op" id="7285654">)</span><span class="op" id="7285655">)</span><span class="op" id="7285656">,</span>&nbsp;<span class="ident" id="7285658"><a href="/net/smtp/smtp_test.go.html#7285523">bcmdbuf</a></span><span class="op" id="7285665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7285668">c</span>&nbsp;<span class="op" id="7285670">:=</span>&nbsp;<span class="op" id="7285673">&amp;</span><span class="ident" id="7285674"><a href="/net/smtp/smtp.go.html#5186499">Client</a></span><span class="op" id="7285680">{</span><span class="ident" id="7285681">Text</span><span class="op" id="7285685">:</span>&nbsp;<span class="ident" id="7285687"><a href="/net/smtp/smtp_test.go.html#7282801">textproto</a></span><span class="op" id="7285696">.</span><span class="ident" id="7285697">NewConn</span><span class="op" id="7285704">(</span><span class="ident" id="7285705"><a href="/net/smtp/smtp_test.go.html#7285564">fake</a></span><span class="op" id="7285709">)</span><span class="op" id="7285710">,</span>&nbsp;<span class="ident" id="7285712">localName</span><span class="op" id="7285721">:</span>&nbsp;<span class="string" id="7285723">&#34;localhost&#34;</span><span class="op" id="7285734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7285738">if</span>&nbsp;<span class="ident" id="7285741">err</span>&nbsp;<span class="op" id="7285745">:=</span>&nbsp;<span class="ident" id="7285748"><a href="/net/smtp/smtp_test.go.html#7285668">c</a></span><span class="op" id="7285749">.</span><span class="ident" id="7285750">helo</span><span class="op" id="7285754">(</span><span class="op" id="7285755">)</span><span class="op" id="7285756">;</span>&nbsp;<span class="ident" id="7285758"><a href="/net/smtp/smtp_test.go.html#7285741">err</a></span>&nbsp;<span class="op" id="7285762">!=</span>&nbsp;<span class="ident" id="7285765">nil</span>&nbsp;<span class="op" id="7285769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7285773"><a href="/net/smtp/smtp_test.go.html#7285348">t</a></span><span class="op" id="7285774">.</span><span class="ident" id="7285775">Fatalf</span><span class="op" id="7285781">(</span><span class="string" id="7285782">&#34;HELO&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7285799">,</span>&nbsp;<span class="ident" id="7285801"><a href="/net/smtp/smtp_test.go.html#7285741">err</a></span><span class="op" id="7285804">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7285807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7285810">if</span>&nbsp;<span class="ident" id="7285813">err</span>&nbsp;<span class="op" id="7285817">:=</span>&nbsp;<span class="ident" id="7285820"><a href="/net/smtp/smtp_test.go.html#7285668">c</a></span><span class="op" id="7285821">.</span><span class="ident" id="7285822">ehlo</span><span class="op" id="7285826">(</span><span class="op" id="7285827">)</span><span class="op" id="7285828">;</span>&nbsp;<span class="ident" id="7285830"><a href="/net/smtp/smtp_test.go.html#7285813">err</a></span>&nbsp;<span class="op" id="7285834">==</span>&nbsp;<span class="ident" id="7285837">nil</span>&nbsp;<span class="op" id="7285841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7285845"><a href="/net/smtp/smtp_test.go.html#7285348">t</a></span><span class="op" id="7285846">.</span><span class="ident" id="7285847">Fatalf</span><span class="op" id="7285853">(</span><span class="string" id="7285854">&#34;Expected&nbsp;first&nbsp;EHLO&nbsp;to&nbsp;fail&#34;</span><span class="op" id="7285883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7285886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7285889">if</span>&nbsp;<span class="ident" id="7285892">err</span>&nbsp;<span class="op" id="7285896">:=</span>&nbsp;<span class="ident" id="7285899"><a href="/net/smtp/smtp_test.go.html#7285668">c</a></span><span class="op" id="7285900">.</span><span class="ident" id="7285901">ehlo</span><span class="op" id="7285905">(</span><span class="op" id="7285906">)</span><span class="op" id="7285907">;</span>&nbsp;<span class="ident" id="7285909"><a href="/net/smtp/smtp_test.go.html#7285892">err</a></span>&nbsp;<span class="op" id="7285913">!=</span>&nbsp;<span class="ident" id="7285916">nil</span>&nbsp;<span class="op" id="7285920">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7285924"><a href="/net/smtp/smtp_test.go.html#7285348">t</a></span><span class="op" id="7285925">.</span><span class="ident" id="7285926">Fatalf</span><span class="op" id="7285932">(</span><span class="string" id="7285933">&#34;Second&nbsp;EHLO&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7285957">,</span>&nbsp;<span class="ident" id="7285959"><a href="/net/smtp/smtp_test.go.html#7285892">err</a></span><span class="op" id="7285962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7285965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7285969"><a href="/net/smtp/smtp_test.go.html#7285668">c</a></span><span class="op" id="7285970">.</span><span class="ident" id="7285971">didHello</span>&nbsp;<span class="op" id="7285980">=</span>&nbsp;<span class="ident" id="7285982">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7285988">if</span>&nbsp;<span class="ident" id="7285991">ok</span><span class="op" id="7285993">,</span>&nbsp;<span class="ident" id="7285995">args</span>&nbsp;<span class="op" id="7286000">:=</span>&nbsp;<span class="ident" id="7286003"><a href="/net/smtp/smtp_test.go.html#7285668">c</a></span><span class="op" id="7286004">.</span><span class="ident" id="7286005">Extension</span><span class="op" id="7286014">(</span><span class="string" id="7286015">&#34;aUtH&#34;</span><span class="op" id="7286021">)</span><span class="op" id="7286022">;</span>&nbsp;<span class="op" id="7286024">!</span><span class="ident" id="7286025"><a href="/net/smtp/smtp_test.go.html#7285991">ok</a></span>&nbsp;<span class="op" id="7286028">||</span>&nbsp;<span class="ident" id="7286031"><a href="/net/smtp/smtp_test.go.html#7285995">args</a></span>&nbsp;<span class="op" id="7286036">!=</span>&nbsp;<span class="string" id="7286039">&#34;LOGIN&nbsp;PLAIN&#34;</span>&nbsp;<span class="op" id="7286053">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7286057"><a href="/net/smtp/smtp_test.go.html#7285348">t</a></span><span class="op" id="7286058">.</span><span class="ident" id="7286059">Fatalf</span><span class="op" id="7286065">(</span><span class="string" id="7286066">&#34;Expected&nbsp;AUTH&nbsp;supported&#34;</span><span class="op" id="7286091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7286094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7286097">if</span>&nbsp;<span class="ident" id="7286100">ok</span><span class="op" id="7286102">,</span>&nbsp;<span class="ident" id="7286104">_</span>&nbsp;<span class="op" id="7286106">:=</span>&nbsp;<span class="ident" id="7286109"><a href="/net/smtp/smtp_test.go.html#7285668">c</a></span><span class="op" id="7286110">.</span><span class="ident" id="7286111">Extension</span><span class="op" id="7286120">(</span><span class="string" id="7286121">&#34;DSN&#34;</span><span class="op" id="7286126">)</span><span class="op" id="7286127">;</span>&nbsp;<span class="ident" id="7286129"><a href="/net/smtp/smtp_test.go.html#7286100">ok</a></span>&nbsp;<span class="op" id="7286132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7286136"><a href="/net/smtp/smtp_test.go.html#7285348">t</a></span><span class="op" id="7286137">.</span><span class="ident" id="7286138">Fatalf</span><span class="op" id="7286144">(</span><span class="string" id="7286145">&#34;Shouldn&#39;t&nbsp;support&nbsp;DSN&#34;</span><span class="op" id="7286168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7286171">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7286175">if</span>&nbsp;<span class="ident" id="7286178">err</span>&nbsp;<span class="op" id="7286182">:=</span>&nbsp;<span class="ident" id="7286185"><a href="/net/smtp/smtp_test.go.html#7285668">c</a></span><span class="op" id="7286186">.</span><span class="ident" id="7286187">Mail</span><span class="op" id="7286191">(</span><span class="string" id="7286192">&#34;user@gmail.com&#34;</span><span class="op" id="7286208">)</span><span class="op" id="7286209">;</span>&nbsp;<span class="ident" id="7286211"><a href="/net/smtp/smtp_test.go.html#7286178">err</a></span>&nbsp;<span class="op" id="7286215">==</span>&nbsp;<span class="ident" id="7286218">nil</span>&nbsp;<span class="op" id="7286222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7286226"><a href="/net/smtp/smtp_test.go.html#7285348">t</a></span><span class="op" id="7286227">.</span><span class="ident" id="7286228">Fatalf</span><span class="op" id="7286234">(</span><span class="string" id="7286235">&#34;MAIL&nbsp;should&nbsp;require&nbsp;authentication&#34;</span><span class="op" id="7286271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7286274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7286278">if</span>&nbsp;<span class="ident" id="7286281">err</span>&nbsp;<span class="op" id="7286285">:=</span>&nbsp;<span class="ident" id="7286288"><a href="/net/smtp/smtp_test.go.html#7285668">c</a></span><span class="op" id="7286289">.</span><span class="ident" id="7286290">Verify</span><span class="op" id="7286296">(</span><span class="string" id="7286297">&#34;user1@gmail.com&#34;</span><span class="op" id="7286314">)</span><span class="op" id="7286315">;</span>&nbsp;<span class="ident" id="7286317"><a href="/net/smtp/smtp_test.go.html#7286281">err</a></span>&nbsp;<span class="op" id="7286321">==</span>&nbsp;<span class="ident" id="7286324">nil</span>&nbsp;<span class="op" id="7286328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7286332"><a href="/net/smtp/smtp_test.go.html#7285348">t</a></span><span class="op" id="7286333">.</span><span class="ident" id="7286334">Fatalf</span><span class="op" id="7286340">(</span><span class="string" id="7286341">&#34;First&nbsp;VRFY:&nbsp;expected&nbsp;no&nbsp;verification&#34;</span><span class="op" id="7286379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7286382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7286385">if</span>&nbsp;<span class="ident" id="7286388">err</span>&nbsp;<span class="op" id="7286392">:=</span>&nbsp;<span class="ident" id="7286395"><a href="/net/smtp/smtp_test.go.html#7285668">c</a></span><span class="op" id="7286396">.</span><span class="ident" id="7286397">Verify</span><span class="op" id="7286403">(</span><span class="string" id="7286404">&#34;user2@gmail.com&#34;</span><span class="op" id="7286421">)</span><span class="op" id="7286422">;</span>&nbsp;<span class="ident" id="7286424"><a href="/net/smtp/smtp_test.go.html#7286388">err</a></span>&nbsp;<span class="op" id="7286428">!=</span>&nbsp;<span class="ident" id="7286431">nil</span>&nbsp;<span class="op" id="7286435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7286439"><a href="/net/smtp/smtp_test.go.html#7285348">t</a></span><span class="op" id="7286440">.</span><span class="ident" id="7286441">Fatalf</span><span class="op" id="7286447">(</span><span class="string" id="7286448">&#34;Second&nbsp;VRFY:&nbsp;expected&nbsp;verification,&nbsp;got&nbsp;%s&#34;</span><span class="op" id="7286492">,</span>&nbsp;<span class="ident" id="7286494"><a href="/net/smtp/smtp_test.go.html#7286388">err</a></span><span class="op" id="7286497">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7286500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7286504">//&nbsp;fake&nbsp;TLS&nbsp;so&nbsp;authentication&nbsp;won&#39;t&nbsp;complain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7286550"><a href="/net/smtp/smtp_test.go.html#7285668">c</a></span><span class="op" id="7286551">.</span><span class="ident" id="7286552">tls</span>&nbsp;<span class="op" id="7286556">=</span>&nbsp;<span class="ident" id="7286558">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7286564"><a href="/net/smtp/smtp_test.go.html#7285668">c</a></span><span class="op" id="7286565">.</span><span class="ident" id="7286566">serverName</span>&nbsp;<span class="op" id="7286577">=</span>&nbsp;<span class="string" id="7286579">&#34;smtp.google.com&#34;</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7286598">if</span>&nbsp;<span class="ident" id="7286601">err</span>&nbsp;<span class="op" id="7286605">:=</span>&nbsp;<span class="ident" id="7286608"><a href="/net/smtp/smtp_test.go.html#7285668">c</a></span><span class="op" id="7286609">.</span><span class="ident" id="7286610">Auth</span><span class="op" id="7286614">(</span><span class="ident" id="7286615"><a href="/net/smtp/auth.go.html#5184343">PlainAuth</a></span><span class="op" id="7286624">(</span><span class="string" id="7286625">&#34;&#34;</span><span class="op" id="7286627">,</span>&nbsp;<span class="string" id="7286629">&#34;user&#34;</span><span class="op" id="7286635">,</span>&nbsp;<span class="string" id="7286637">&#34;pass&#34;</span><span class="op" id="7286643">,</span>&nbsp;<span class="string" id="7286645">&#34;smtp.google.com&#34;</span><span class="op" id="7286662">)</span><span class="op" id="7286663">)</span><span class="op" id="7286664">;</span>&nbsp;<span class="ident" id="7286666"><a href="/net/smtp/smtp_test.go.html#7286601">err</a></span>&nbsp;<span class="op" id="7286670">!=</span>&nbsp;<span class="ident" id="7286673">nil</span>&nbsp;<span class="op" id="7286677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7286681"><a href="/net/smtp/smtp_test.go.html#7285348">t</a></span><span class="op" id="7286682">.</span><span class="ident" id="7286683">Fatalf</span><span class="op" id="7286689">(</span><span class="string" id="7286690">&#34;AUTH&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7286707">,</span>&nbsp;<span class="ident" id="7286709"><a href="/net/smtp/smtp_test.go.html#7286601">err</a></span><span class="op" id="7286712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7286715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7286719">if</span>&nbsp;<span class="ident" id="7286722">err</span>&nbsp;<span class="op" id="7286726">:=</span>&nbsp;<span class="ident" id="7286729"><a href="/net/smtp/smtp_test.go.html#7285668">c</a></span><span class="op" id="7286730">.</span><span class="ident" id="7286731">Mail</span><span class="op" id="7286735">(</span><span class="string" id="7286736">&#34;user@gmail.com&#34;</span><span class="op" id="7286752">)</span><span class="op" id="7286753">;</span>&nbsp;<span class="ident" id="7286755"><a href="/net/smtp/smtp_test.go.html#7286722">err</a></span>&nbsp;<span class="op" id="7286759">!=</span>&nbsp;<span class="ident" id="7286762">nil</span>&nbsp;<span class="op" id="7286766">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7286770"><a href="/net/smtp/smtp_test.go.html#7285348">t</a></span><span class="op" id="7286771">.</span><span class="ident" id="7286772">Fatalf</span><span class="op" id="7286778">(</span><span class="string" id="7286779">&#34;MAIL&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7286796">,</span>&nbsp;<span class="ident" id="7286798"><a href="/net/smtp/smtp_test.go.html#7286722">err</a></span><span class="op" id="7286801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7286804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7286807">if</span>&nbsp;<span class="ident" id="7286810">err</span>&nbsp;<span class="op" id="7286814">:=</span>&nbsp;<span class="ident" id="7286817"><a href="/net/smtp/smtp_test.go.html#7285668">c</a></span><span class="op" id="7286818">.</span><span class="ident" id="7286819">Rcpt</span><span class="op" id="7286823">(</span><span class="string" id="7286824">&#34;golang-nuts@googlegroups.com&#34;</span><span class="op" id="7286854">)</span><span class="op" id="7286855">;</span>&nbsp;<span class="ident" id="7286857"><a href="/net/smtp/smtp_test.go.html#7286810">err</a></span>&nbsp;<span class="op" id="7286861">!=</span>&nbsp;<span class="ident" id="7286864">nil</span>&nbsp;<span class="op" id="7286868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7286872"><a href="/net/smtp/smtp_test.go.html#7285348">t</a></span><span class="op" id="7286873">.</span><span class="ident" id="7286874">Fatalf</span><span class="op" id="7286880">(</span><span class="string" id="7286881">&#34;RCPT&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7286898">,</span>&nbsp;<span class="ident" id="7286900"><a href="/net/smtp/smtp_test.go.html#7286810">err</a></span><span class="op" id="7286903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7286906">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7286909">msg</span>&nbsp;<span class="op" id="7286913">:=</span>&nbsp;<span class="string" id="7286916">`From:&nbsp;user@gmail.com<br>
<span class="lineno"></span>To:&nbsp;golang-nuts@googlegroups.com<br>
<span class="lineno"></span>Subject:&nbsp;Hooray&nbsp;for&nbsp;Go<br>
<span class="lineno"></span><br>
<span class="lineno"></span>Line&nbsp;1<br>
<span class="lineno">165</span>.Leading&nbsp;dot&nbsp;line&nbsp;.<br>
<span class="lineno"></span>Goodbye.`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7287033">w</span><span class="op" id="7287034">,</span>&nbsp;<span class="ident" id="7287036">err</span>&nbsp;<span class="op" id="7287040">:=</span>&nbsp;<span class="ident" id="7287043"><a href="/net/smtp/smtp_test.go.html#7285668">c</a></span><span class="op" id="7287044">.</span><span class="ident" id="7287045">Data</span><span class="op" id="7287049">(</span><span class="op" id="7287050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7287053">if</span>&nbsp;<span class="ident" id="7287056"><a href="/net/smtp/smtp_test.go.html#7287036">err</a></span>&nbsp;<span class="op" id="7287060">!=</span>&nbsp;<span class="ident" id="7287063">nil</span>&nbsp;<span class="op" id="7287067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7287071"><a href="/net/smtp/smtp_test.go.html#7285348">t</a></span><span class="op" id="7287072">.</span><span class="ident" id="7287073">Fatalf</span><span class="op" id="7287079">(</span><span class="string" id="7287080">&#34;DATA&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7287097">,</span>&nbsp;<span class="ident" id="7287099"><a href="/net/smtp/smtp_test.go.html#7287036">err</a></span><span class="op" id="7287102">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7287105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7287108">if</span>&nbsp;<span class="ident" id="7287111">_</span><span class="op" id="7287112">,</span>&nbsp;<span class="ident" id="7287114">err</span>&nbsp;<span class="op" id="7287118">:=</span>&nbsp;<span class="ident" id="7287121"><a href="/net/smtp/smtp_test.go.html#7287033">w</a></span><span class="op" id="7287122">.</span><span class="ident" id="7287123">Write</span><span class="op" id="7287128">(</span><span class="op" id="7287129">[</span><span class="op" id="7287130">]</span><span class="builtintype" id="7287131">byte</span><span class="op" id="7287135">(</span><span class="ident" id="7287136"><a href="/net/smtp/smtp_test.go.html#7286909">msg</a></span><span class="op" id="7287139">)</span><span class="op" id="7287140">)</span><span class="op" id="7287141">;</span>&nbsp;<span class="ident" id="7287143"><a href="/net/smtp/smtp_test.go.html#7287114">err</a></span>&nbsp;<span class="op" id="7287147">!=</span>&nbsp;<span class="ident" id="7287150">nil</span>&nbsp;<span class="op" id="7287154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7287158"><a href="/net/smtp/smtp_test.go.html#7285348">t</a></span><span class="op" id="7287159">.</span><span class="ident" id="7287160">Fatalf</span><span class="op" id="7287166">(</span><span class="string" id="7287167">&#34;Data&nbsp;write&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7287190">,</span>&nbsp;<span class="ident" id="7287192"><a href="/net/smtp/smtp_test.go.html#7287114">err</a></span><span class="op" id="7287195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7287198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7287201">if</span>&nbsp;<span class="ident" id="7287204">err</span>&nbsp;<span class="op" id="7287208">:=</span>&nbsp;<span class="ident" id="7287211"><a href="/net/smtp/smtp_test.go.html#7287033">w</a></span><span class="op" id="7287212">.</span><span class="ident" id="7287213">Close</span><span class="op" id="7287218">(</span><span class="op" id="7287219">)</span><span class="op" id="7287220">;</span>&nbsp;<span class="ident" id="7287222"><a href="/net/smtp/smtp_test.go.html#7287204">err</a></span>&nbsp;<span class="op" id="7287226">!=</span>&nbsp;<span class="ident" id="7287229">nil</span>&nbsp;<span class="op" id="7287233">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7287237"><a href="/net/smtp/smtp_test.go.html#7285348">t</a></span><span class="op" id="7287238">.</span><span class="ident" id="7287239">Fatalf</span><span class="op" id="7287245">(</span><span class="string" id="7287246">&#34;Bad&nbsp;data&nbsp;response:&nbsp;%s&#34;</span><span class="op" id="7287269">,</span>&nbsp;<span class="ident" id="7287271"><a href="/net/smtp/smtp_test.go.html#7287204">err</a></span><span class="op" id="7287274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7287277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7287281">if</span>&nbsp;<span class="ident" id="7287284">err</span>&nbsp;<span class="op" id="7287288">:=</span>&nbsp;<span class="ident" id="7287291"><a href="/net/smtp/smtp_test.go.html#7285668">c</a></span><span class="op" id="7287292">.</span><span class="ident" id="7287293">Quit</span><span class="op" id="7287297">(</span><span class="op" id="7287298">)</span><span class="op" id="7287299">;</span>&nbsp;<span class="ident" id="7287301"><a href="/net/smtp/smtp_test.go.html#7287284">err</a></span>&nbsp;<span class="op" id="7287305">!=</span>&nbsp;<span class="ident" id="7287308">nil</span>&nbsp;<span class="op" id="7287312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7287316"><a href="/net/smtp/smtp_test.go.html#7285348">t</a></span><span class="op" id="7287317">.</span><span class="ident" id="7287318">Fatalf</span><span class="op" id="7287324">(</span><span class="string" id="7287325">&#34;QUIT&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7287342">,</span>&nbsp;<span class="ident" id="7287344"><a href="/net/smtp/smtp_test.go.html#7287284">err</a></span><span class="op" id="7287347">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7287350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7287354"><a href="/net/smtp/smtp_test.go.html#7285523">bcmdbuf</a></span><span class="op" id="7287361">.</span><span class="ident" id="7287362">Flush</span><span class="op" id="7287367">(</span><span class="op" id="7287368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7287371">actualcmds</span>&nbsp;<span class="op" id="7287382">:=</span>&nbsp;<span class="ident" id="7287385"><a href="/net/smtp/smtp_test.go.html#7285502">cmdbuf</a></span><span class="op" id="7287391">.</span><span class="ident" id="7287392">String</span><span class="op" id="7287398">(</span><span class="op" id="7287399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7287402">if</span>&nbsp;<span class="ident" id="7287405"><a href="/net/smtp/smtp_test.go.html#7285431">client</a></span>&nbsp;<span class="op" id="7287412">!=</span>&nbsp;<span class="ident" id="7287415"><a href="/net/smtp/smtp_test.go.html#7287371">actualcmds</a></span>&nbsp;<span class="op" id="7287426">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7287430"><a href="/net/smtp/smtp_test.go.html#7285348">t</a></span><span class="op" id="7287431">.</span><span class="ident" id="7287432">Fatalf</span><span class="op" id="7287438">(</span><span class="string" id="7287439">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7287464">,</span>&nbsp;<span class="ident" id="7287466"><a href="/net/smtp/smtp_test.go.html#7287371">actualcmds</a></span><span class="op" id="7287476">,</span>&nbsp;<span class="ident" id="7287478"><a href="/net/smtp/smtp_test.go.html#7285431">client</a></span><span class="op" id="7287484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7287487">}</span><br>
<span class="lineno"></span><span class="op" id="7287489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7287492">var</span>&nbsp;<span class="ident" id="7287496">basicServer</span>&nbsp;<span class="op" id="7287508">=</span>&nbsp;<span class="string" id="7287510">`250&nbsp;mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno">190</span>502&nbsp;Unrecognized&nbsp;command.<br>
<span class="lineno"></span>250-mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250-SIZE&nbsp;35651584<br>
<span class="lineno"></span>250-AUTH&nbsp;LOGIN&nbsp;PLAIN<br>
<span class="lineno"></span>250&nbsp;8BITMIME<br>
<span class="lineno">195</span>530&nbsp;Authentication&nbsp;required<br>
<span class="lineno"></span>252&nbsp;Send&nbsp;some&nbsp;mail,&nbsp;I&#39;ll&nbsp;try&nbsp;my&nbsp;best<br>
<span class="lineno"></span>250&nbsp;User&nbsp;is&nbsp;valid<br>
<span class="lineno"></span>235&nbsp;Accepted<br>
<span class="lineno"></span>250&nbsp;Sender&nbsp;OK<br>
<span class="lineno">200</span>250&nbsp;Receiver&nbsp;OK<br>
<span class="lineno"></span>354&nbsp;Go&nbsp;ahead<br>
<span class="lineno"></span>250&nbsp;Data&nbsp;OK<br>
<span class="lineno"></span>221&nbsp;OK<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="keyword" id="7287818">var</span>&nbsp;<span class="ident" id="7287822">basicClient</span>&nbsp;<span class="op" id="7287834">=</span>&nbsp;<span class="string" id="7287836">`HELO&nbsp;localhost<br>
<span class="lineno"></span>EHLO&nbsp;localhost<br>
<span class="lineno"></span>EHLO&nbsp;localhost<br>
<span class="lineno"></span>MAIL&nbsp;FROM:&lt;user@gmail.com&gt;&nbsp;BODY=8BITMIME<br>
<span class="lineno">210</span>VRFY&nbsp;user1@gmail.com<br>
<span class="lineno"></span>VRFY&nbsp;user2@gmail.com<br>
<span class="lineno"></span>AUTH&nbsp;PLAIN&nbsp;AHVzZXIAcGFzcw==<br>
<span class="lineno"></span>MAIL&nbsp;FROM:&lt;user@gmail.com&gt;&nbsp;BODY=8BITMIME<br>
<span class="lineno"></span>RCPT&nbsp;TO:&lt;golang-nuts@googlegroups.com&gt;<br>
<span class="lineno">215</span>DATA<br>
<span class="lineno"></span>From:&nbsp;user@gmail.com<br>
<span class="lineno"></span>To:&nbsp;golang-nuts@googlegroups.com<br>
<span class="lineno"></span>Subject:&nbsp;Hooray&nbsp;for&nbsp;Go<br>
<span class="lineno"></span><br>
<span class="lineno">220</span>Line&nbsp;1<br>
<span class="lineno"></span>..Leading&nbsp;dot&nbsp;line&nbsp;.<br>
<span class="lineno"></span>Goodbye.<br>
<span class="lineno"></span>.<br>
<span class="lineno"></span>QUIT<br>
<span class="lineno">225</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7288203">func</span>&nbsp;<span class="ident" id="7288208">TestNewClient</span><span class="op" id="7288221">(</span><span class="ident" id="7288222">t</span>&nbsp;<span class="op" id="7288224">*</span><span class="ident" id="7288225"><a href="/net/smtp/smtp_test.go.html#7282829">testing</a></span><span class="op" id="7288232">.</span><span class="ident" id="7288233">T</span><span class="op" id="7288234">)</span>&nbsp;<span class="op" id="7288236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288239">server</span>&nbsp;<span class="op" id="7288246">:=</span>&nbsp;<span class="ident" id="7288249"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7288256">.</span><span class="ident" id="7288257">Join</span><span class="op" id="7288261">(</span><span class="ident" id="7288262"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7288269">.</span><span class="ident" id="7288270">Split</span><span class="op" id="7288275">(</span><span class="ident" id="7288276"><a href="/net/smtp/smtp_test.go.html#7289123">newClientServer</a></span><span class="op" id="7288291">,</span>&nbsp;<span class="string" id="7288293">&#34;\n&#34;</span><span class="op" id="7288297">)</span><span class="op" id="7288298">,</span>&nbsp;<span class="string" id="7288300">&#34;\r\n&#34;</span><span class="op" id="7288306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288309">client</span>&nbsp;<span class="op" id="7288316">:=</span>&nbsp;<span class="ident" id="7288319"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7288326">.</span><span class="ident" id="7288327">Join</span><span class="op" id="7288331">(</span><span class="ident" id="7288332"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7288339">.</span><span class="ident" id="7288340">Split</span><span class="op" id="7288345">(</span><span class="ident" id="7288346"><a href="/net/smtp/smtp_test.go.html#7289258">newClientClient</a></span><span class="op" id="7288361">,</span>&nbsp;<span class="string" id="7288363">&#34;\n&#34;</span><span class="op" id="7288367">)</span><span class="op" id="7288368">,</span>&nbsp;<span class="string" id="7288370">&#34;\r\n&#34;</span><span class="op" id="7288376">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7288380">var</span>&nbsp;<span class="ident" id="7288384">cmdbuf</span>&nbsp;<span class="ident" id="7288391"><a href="/net/smtp/smtp_test.go.html#7282750">bytes</a></span><span class="op" id="7288396">.</span><span class="ident" id="7288397">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288405">bcmdbuf</span>&nbsp;<span class="op" id="7288413">:=</span>&nbsp;<span class="ident" id="7288416"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7288421">.</span><span class="ident" id="7288422">NewWriter</span><span class="op" id="7288431">(</span><span class="op" id="7288432">&amp;</span><span class="ident" id="7288433"><a href="/net/smtp/smtp_test.go.html#7288384">cmdbuf</a></span><span class="op" id="7288439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288442">out</span>&nbsp;<span class="op" id="7288446">:=</span>&nbsp;<span class="keyword" id="7288449">func</span><span class="op" id="7288453">(</span><span class="op" id="7288454">)</span>&nbsp;<span class="builtintype" id="7288456">string</span>&nbsp;<span class="op" id="7288463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288467"><a href="/net/smtp/smtp_test.go.html#7288405">bcmdbuf</a></span><span class="op" id="7288474">.</span><span class="ident" id="7288475">Flush</span><span class="op" id="7288480">(</span><span class="op" id="7288481">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7288485">return</span>&nbsp;<span class="ident" id="7288492"><a href="/net/smtp/smtp_test.go.html#7288384">cmdbuf</a></span><span class="op" id="7288498">.</span><span class="ident" id="7288499">String</span><span class="op" id="7288505">(</span><span class="op" id="7288506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7288509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7288512">var</span>&nbsp;<span class="ident" id="7288516">fake</span>&nbsp;<span class="ident" id="7288521"><a href="/net/smtp/smtp_test.go.html#7284915">faker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288528"><a href="/net/smtp/smtp_test.go.html#7288516">fake</a></span><span class="op" id="7288532">.</span><span class="ident" id="7288533">ReadWriter</span>&nbsp;<span class="op" id="7288544">=</span>&nbsp;<span class="ident" id="7288546"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7288551">.</span><span class="ident" id="7288552">NewReadWriter</span><span class="op" id="7288565">(</span><span class="ident" id="7288566"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7288571">.</span><span class="ident" id="7288572">NewReader</span><span class="op" id="7288581">(</span><span class="ident" id="7288582"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7288589">.</span><span class="ident" id="7288590">NewReader</span><span class="op" id="7288599">(</span><span class="ident" id="7288600"><a href="/net/smtp/smtp_test.go.html#7288239">server</a></span><span class="op" id="7288606">)</span><span class="op" id="7288607">)</span><span class="op" id="7288608">,</span>&nbsp;<span class="ident" id="7288610"><a href="/net/smtp/smtp_test.go.html#7288405">bcmdbuf</a></span><span class="op" id="7288617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288620">c</span><span class="op" id="7288621">,</span>&nbsp;<span class="ident" id="7288623">err</span>&nbsp;<span class="op" id="7288627">:=</span>&nbsp;<span class="ident" id="7288630"><a href="/net/smtp/smtp.go.html#5187509">NewClient</a></span><span class="op" id="7288639">(</span><span class="ident" id="7288640"><a href="/net/smtp/smtp_test.go.html#7288516">fake</a></span><span class="op" id="7288644">,</span>&nbsp;<span class="string" id="7288646">&#34;fake.host&#34;</span><span class="op" id="7288657">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7288660">if</span>&nbsp;<span class="ident" id="7288663"><a href="/net/smtp/smtp_test.go.html#7288623">err</a></span>&nbsp;<span class="op" id="7288667">!=</span>&nbsp;<span class="ident" id="7288670">nil</span>&nbsp;<span class="op" id="7288674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288678"><a href="/net/smtp/smtp_test.go.html#7288222">t</a></span><span class="op" id="7288679">.</span><span class="ident" id="7288680">Fatalf</span><span class="op" id="7288686">(</span><span class="string" id="7288687">&#34;NewClient:&nbsp;%v\n(after&nbsp;%v)&#34;</span><span class="op" id="7288714">,</span>&nbsp;<span class="ident" id="7288716"><a href="/net/smtp/smtp_test.go.html#7288623">err</a></span><span class="op" id="7288719">,</span>&nbsp;<span class="ident" id="7288721"><a href="/net/smtp/smtp_test.go.html#7288442">out</a></span><span class="op" id="7288724">(</span><span class="op" id="7288725">)</span><span class="op" id="7288726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7288729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7288732">defer</span>&nbsp;<span class="ident" id="7288738"><a href="/net/smtp/smtp_test.go.html#7288620">c</a></span><span class="op" id="7288739">.</span><span class="ident" id="7288740">Close</span><span class="op" id="7288745">(</span><span class="op" id="7288746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7288749">if</span>&nbsp;<span class="ident" id="7288752">ok</span><span class="op" id="7288754">,</span>&nbsp;<span class="ident" id="7288756">args</span>&nbsp;<span class="op" id="7288761">:=</span>&nbsp;<span class="ident" id="7288764"><a href="/net/smtp/smtp_test.go.html#7288620">c</a></span><span class="op" id="7288765">.</span><span class="ident" id="7288766">Extension</span><span class="op" id="7288775">(</span><span class="string" id="7288776">&#34;aUtH&#34;</span><span class="op" id="7288782">)</span><span class="op" id="7288783">;</span>&nbsp;<span class="op" id="7288785">!</span><span class="ident" id="7288786"><a href="/net/smtp/smtp_test.go.html#7288752">ok</a></span>&nbsp;<span class="op" id="7288789">||</span>&nbsp;<span class="ident" id="7288792"><a href="/net/smtp/smtp_test.go.html#7288756">args</a></span>&nbsp;<span class="op" id="7288797">!=</span>&nbsp;<span class="string" id="7288800">&#34;LOGIN&nbsp;PLAIN&#34;</span>&nbsp;<span class="op" id="7288814">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288818"><a href="/net/smtp/smtp_test.go.html#7288222">t</a></span><span class="op" id="7288819">.</span><span class="ident" id="7288820">Fatalf</span><span class="op" id="7288826">(</span><span class="string" id="7288827">&#34;Expected&nbsp;AUTH&nbsp;supported&#34;</span><span class="op" id="7288852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7288855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7288858">if</span>&nbsp;<span class="ident" id="7288861">ok</span><span class="op" id="7288863">,</span>&nbsp;<span class="ident" id="7288865">_</span>&nbsp;<span class="op" id="7288867">:=</span>&nbsp;<span class="ident" id="7288870"><a href="/net/smtp/smtp_test.go.html#7288620">c</a></span><span class="op" id="7288871">.</span><span class="ident" id="7288872">Extension</span><span class="op" id="7288881">(</span><span class="string" id="7288882">&#34;DSN&#34;</span><span class="op" id="7288887">)</span><span class="op" id="7288888">;</span>&nbsp;<span class="ident" id="7288890"><a href="/net/smtp/smtp_test.go.html#7288861">ok</a></span>&nbsp;<span class="op" id="7288893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288897"><a href="/net/smtp/smtp_test.go.html#7288222">t</a></span><span class="op" id="7288898">.</span><span class="ident" id="7288899">Fatalf</span><span class="op" id="7288905">(</span><span class="string" id="7288906">&#34;Shouldn&#39;t&nbsp;support&nbsp;DSN&#34;</span><span class="op" id="7288929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7288932">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7288935">if</span>&nbsp;<span class="ident" id="7288938">err</span>&nbsp;<span class="op" id="7288942">:=</span>&nbsp;<span class="ident" id="7288945"><a href="/net/smtp/smtp_test.go.html#7288620">c</a></span><span class="op" id="7288946">.</span><span class="ident" id="7288947">Quit</span><span class="op" id="7288951">(</span><span class="op" id="7288952">)</span><span class="op" id="7288953">;</span>&nbsp;<span class="ident" id="7288955"><a href="/net/smtp/smtp_test.go.html#7288938">err</a></span>&nbsp;<span class="op" id="7288959">!=</span>&nbsp;<span class="ident" id="7288962">nil</span>&nbsp;<span class="op" id="7288966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288970"><a href="/net/smtp/smtp_test.go.html#7288222">t</a></span><span class="op" id="7288971">.</span><span class="ident" id="7288972">Fatalf</span><span class="op" id="7288978">(</span><span class="string" id="7288979">&#34;QUIT&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7288996">,</span>&nbsp;<span class="ident" id="7288998"><a href="/net/smtp/smtp_test.go.html#7288938">err</a></span><span class="op" id="7289001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7289004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289008">actualcmds</span>&nbsp;<span class="op" id="7289019">:=</span>&nbsp;<span class="ident" id="7289022"><a href="/net/smtp/smtp_test.go.html#7288442">out</a></span><span class="op" id="7289025">(</span><span class="op" id="7289026">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7289029">if</span>&nbsp;<span class="ident" id="7289032"><a href="/net/smtp/smtp_test.go.html#7288309">client</a></span>&nbsp;<span class="op" id="7289039">!=</span>&nbsp;<span class="ident" id="7289042"><a href="/net/smtp/smtp_test.go.html#7289008">actualcmds</a></span>&nbsp;<span class="op" id="7289053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289057"><a href="/net/smtp/smtp_test.go.html#7288222">t</a></span><span class="op" id="7289058">.</span><span class="ident" id="7289059">Fatalf</span><span class="op" id="7289065">(</span><span class="string" id="7289066">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7289091">,</span>&nbsp;<span class="ident" id="7289093"><a href="/net/smtp/smtp_test.go.html#7289008">actualcmds</a></span><span class="op" id="7289103">,</span>&nbsp;<span class="ident" id="7289105"><a href="/net/smtp/smtp_test.go.html#7288309">client</a></span><span class="op" id="7289111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7289114">}</span><br>
<span class="lineno"></span><span class="op" id="7289116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="7289119">var</span>&nbsp;<span class="ident" id="7289123">newClientServer</span>&nbsp;<span class="op" id="7289139">=</span>&nbsp;<span class="string" id="7289141">`220&nbsp;hello&nbsp;world<br>
<span class="lineno"></span>250-mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250-SIZE&nbsp;35651584<br>
<span class="lineno"></span>250-AUTH&nbsp;LOGIN&nbsp;PLAIN<br>
<span class="lineno"></span>250&nbsp;8BITMIME<br>
<span class="lineno">265</span>221&nbsp;OK<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7289254">var</span>&nbsp;<span class="ident" id="7289258">newClientClient</span>&nbsp;<span class="op" id="7289274">=</span>&nbsp;<span class="string" id="7289276">`EHLO&nbsp;localhost<br>
<span class="lineno"></span>QUIT<br>
<span class="lineno">270</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7289300">func</span>&nbsp;<span class="ident" id="7289305">TestNewClient2</span><span class="op" id="7289319">(</span><span class="ident" id="7289320">t</span>&nbsp;<span class="op" id="7289322">*</span><span class="ident" id="7289323"><a href="/net/smtp/smtp_test.go.html#7282829">testing</a></span><span class="op" id="7289330">.</span><span class="ident" id="7289331">T</span><span class="op" id="7289332">)</span>&nbsp;<span class="op" id="7289334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289337">server</span>&nbsp;<span class="op" id="7289344">:=</span>&nbsp;<span class="ident" id="7289347"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7289354">.</span><span class="ident" id="7289355">Join</span><span class="op" id="7289359">(</span><span class="ident" id="7289360"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7289367">.</span><span class="ident" id="7289368">Split</span><span class="op" id="7289373">(</span><span class="ident" id="7289374"><a href="/net/smtp/smtp_test.go.html#7290052">newClient2Server</a></span><span class="op" id="7289390">,</span>&nbsp;<span class="string" id="7289392">&#34;\n&#34;</span><span class="op" id="7289396">)</span><span class="op" id="7289397">,</span>&nbsp;<span class="string" id="7289399">&#34;\r\n&#34;</span><span class="op" id="7289405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289408">client</span>&nbsp;<span class="op" id="7289415">:=</span>&nbsp;<span class="ident" id="7289418"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7289425">.</span><span class="ident" id="7289426">Join</span><span class="op" id="7289430">(</span><span class="ident" id="7289431"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7289438">.</span><span class="ident" id="7289439">Split</span><span class="op" id="7289444">(</span><span class="ident" id="7289445"><a href="/net/smtp/smtp_test.go.html#7290196">newClient2Client</a></span><span class="op" id="7289461">,</span>&nbsp;<span class="string" id="7289463">&#34;\n&#34;</span><span class="op" id="7289467">)</span><span class="op" id="7289468">,</span>&nbsp;<span class="string" id="7289470">&#34;\r\n&#34;</span><span class="op" id="7289476">)</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7289480">var</span>&nbsp;<span class="ident" id="7289484">cmdbuf</span>&nbsp;<span class="ident" id="7289491"><a href="/net/smtp/smtp_test.go.html#7282750">bytes</a></span><span class="op" id="7289496">.</span><span class="ident" id="7289497">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289505">bcmdbuf</span>&nbsp;<span class="op" id="7289513">:=</span>&nbsp;<span class="ident" id="7289516"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7289521">.</span><span class="ident" id="7289522">NewWriter</span><span class="op" id="7289531">(</span><span class="op" id="7289532">&amp;</span><span class="ident" id="7289533"><a href="/net/smtp/smtp_test.go.html#7289484">cmdbuf</a></span><span class="op" id="7289539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7289542">var</span>&nbsp;<span class="ident" id="7289546">fake</span>&nbsp;<span class="ident" id="7289551"><a href="/net/smtp/smtp_test.go.html#7284915">faker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289558"><a href="/net/smtp/smtp_test.go.html#7289546">fake</a></span><span class="op" id="7289562">.</span><span class="ident" id="7289563">ReadWriter</span>&nbsp;<span class="op" id="7289574">=</span>&nbsp;<span class="ident" id="7289576"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7289581">.</span><span class="ident" id="7289582">NewReadWriter</span><span class="op" id="7289595">(</span><span class="ident" id="7289596"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7289601">.</span><span class="ident" id="7289602">NewReader</span><span class="op" id="7289611">(</span><span class="ident" id="7289612"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7289619">.</span><span class="ident" id="7289620">NewReader</span><span class="op" id="7289629">(</span><span class="ident" id="7289630"><a href="/net/smtp/smtp_test.go.html#7289337">server</a></span><span class="op" id="7289636">)</span><span class="op" id="7289637">)</span><span class="op" id="7289638">,</span>&nbsp;<span class="ident" id="7289640"><a href="/net/smtp/smtp_test.go.html#7289505">bcmdbuf</a></span><span class="op" id="7289647">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289650">c</span><span class="op" id="7289651">,</span>&nbsp;<span class="ident" id="7289653">err</span>&nbsp;<span class="op" id="7289657">:=</span>&nbsp;<span class="ident" id="7289660"><a href="/net/smtp/smtp.go.html#5187509">NewClient</a></span><span class="op" id="7289669">(</span><span class="ident" id="7289670"><a href="/net/smtp/smtp_test.go.html#7289546">fake</a></span><span class="op" id="7289674">,</span>&nbsp;<span class="string" id="7289676">&#34;fake.host&#34;</span><span class="op" id="7289687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7289690">if</span>&nbsp;<span class="ident" id="7289693"><a href="/net/smtp/smtp_test.go.html#7289653">err</a></span>&nbsp;<span class="op" id="7289697">!=</span>&nbsp;<span class="ident" id="7289700">nil</span>&nbsp;<span class="op" id="7289704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289708"><a href="/net/smtp/smtp_test.go.html#7289320">t</a></span><span class="op" id="7289709">.</span><span class="ident" id="7289710">Fatalf</span><span class="op" id="7289716">(</span><span class="string" id="7289717">&#34;NewClient:&nbsp;%v&#34;</span><span class="op" id="7289732">,</span>&nbsp;<span class="ident" id="7289734"><a href="/net/smtp/smtp_test.go.html#7289653">err</a></span><span class="op" id="7289737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7289740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7289743">defer</span>&nbsp;<span class="ident" id="7289749"><a href="/net/smtp/smtp_test.go.html#7289650">c</a></span><span class="op" id="7289750">.</span><span class="ident" id="7289751">Close</span><span class="op" id="7289756">(</span><span class="op" id="7289757">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7289760">if</span>&nbsp;<span class="ident" id="7289763">ok</span><span class="op" id="7289765">,</span>&nbsp;<span class="ident" id="7289767">_</span>&nbsp;<span class="op" id="7289769">:=</span>&nbsp;<span class="ident" id="7289772"><a href="/net/smtp/smtp_test.go.html#7289650">c</a></span><span class="op" id="7289773">.</span><span class="ident" id="7289774">Extension</span><span class="op" id="7289783">(</span><span class="string" id="7289784">&#34;DSN&#34;</span><span class="op" id="7289789">)</span><span class="op" id="7289790">;</span>&nbsp;<span class="ident" id="7289792"><a href="/net/smtp/smtp_test.go.html#7289763">ok</a></span>&nbsp;<span class="op" id="7289795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289799"><a href="/net/smtp/smtp_test.go.html#7289320">t</a></span><span class="op" id="7289800">.</span><span class="ident" id="7289801">Fatalf</span><span class="op" id="7289807">(</span><span class="string" id="7289808">&#34;Shouldn&#39;t&nbsp;support&nbsp;DSN&#34;</span><span class="op" id="7289831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7289834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7289837">if</span>&nbsp;<span class="ident" id="7289840">err</span>&nbsp;<span class="op" id="7289844">:=</span>&nbsp;<span class="ident" id="7289847"><a href="/net/smtp/smtp_test.go.html#7289650">c</a></span><span class="op" id="7289848">.</span><span class="ident" id="7289849">Quit</span><span class="op" id="7289853">(</span><span class="op" id="7289854">)</span><span class="op" id="7289855">;</span>&nbsp;<span class="ident" id="7289857"><a href="/net/smtp/smtp_test.go.html#7289840">err</a></span>&nbsp;<span class="op" id="7289861">!=</span>&nbsp;<span class="ident" id="7289864">nil</span>&nbsp;<span class="op" id="7289868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289872"><a href="/net/smtp/smtp_test.go.html#7289320">t</a></span><span class="op" id="7289873">.</span><span class="ident" id="7289874">Fatalf</span><span class="op" id="7289880">(</span><span class="string" id="7289881">&#34;QUIT&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7289898">,</span>&nbsp;<span class="ident" id="7289900"><a href="/net/smtp/smtp_test.go.html#7289840">err</a></span><span class="op" id="7289903">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7289906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289910"><a href="/net/smtp/smtp_test.go.html#7289505">bcmdbuf</a></span><span class="op" id="7289917">.</span><span class="ident" id="7289918">Flush</span><span class="op" id="7289923">(</span><span class="op" id="7289924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289927">actualcmds</span>&nbsp;<span class="op" id="7289938">:=</span>&nbsp;<span class="ident" id="7289941"><a href="/net/smtp/smtp_test.go.html#7289484">cmdbuf</a></span><span class="op" id="7289947">.</span><span class="ident" id="7289948">String</span><span class="op" id="7289954">(</span><span class="op" id="7289955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7289958">if</span>&nbsp;<span class="ident" id="7289961"><a href="/net/smtp/smtp_test.go.html#7289408">client</a></span>&nbsp;<span class="op" id="7289968">!=</span>&nbsp;<span class="ident" id="7289971"><a href="/net/smtp/smtp_test.go.html#7289927">actualcmds</a></span>&nbsp;<span class="op" id="7289982">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289986"><a href="/net/smtp/smtp_test.go.html#7289320">t</a></span><span class="op" id="7289987">.</span><span class="ident" id="7289988">Fatalf</span><span class="op" id="7289994">(</span><span class="string" id="7289995">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7290020">,</span>&nbsp;<span class="ident" id="7290022"><a href="/net/smtp/smtp_test.go.html#7289927">actualcmds</a></span><span class="op" id="7290032">,</span>&nbsp;<span class="ident" id="7290034"><a href="/net/smtp/smtp_test.go.html#7289408">client</a></span><span class="op" id="7290040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7290043">}</span><br>
<span class="lineno"></span><span class="op" id="7290045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7290048">var</span>&nbsp;<span class="ident" id="7290052">newClient2Server</span>&nbsp;<span class="op" id="7290069">=</span>&nbsp;<span class="string" id="7290071">`220&nbsp;hello&nbsp;world<br>
<span class="lineno">300</span>502&nbsp;EH?<br>
<span class="lineno"></span>250-mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250-SIZE&nbsp;35651584<br>
<span class="lineno"></span>250-AUTH&nbsp;LOGIN&nbsp;PLAIN<br>
<span class="lineno"></span>250&nbsp;8BITMIME<br>
<span class="lineno">305</span>221&nbsp;OK<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7290192">var</span>&nbsp;<span class="ident" id="7290196">newClient2Client</span>&nbsp;<span class="op" id="7290213">=</span>&nbsp;<span class="string" id="7290215">`EHLO&nbsp;localhost<br>
<span class="lineno"></span>HELO&nbsp;localhost<br>
<span class="lineno">310</span>QUIT<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7290254">func</span>&nbsp;<span class="ident" id="7290259">TestHello</span><span class="op" id="7290268">(</span><span class="ident" id="7290269">t</span>&nbsp;<span class="op" id="7290271">*</span><span class="ident" id="7290272"><a href="/net/smtp/smtp_test.go.html#7282829">testing</a></span><span class="op" id="7290279">.</span><span class="ident" id="7290280">T</span><span class="op" id="7290281">)</span>&nbsp;<span class="op" id="7290283">{</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7290287">if</span>&nbsp;<span class="builtinfunc" id="7290290">len</span><span class="op" id="7290293">(</span><span class="ident" id="7290294"><a href="/net/smtp/smtp_test.go.html#7292007">helloServer</a></span><span class="op" id="7290305">)</span>&nbsp;<span class="op" id="7290307">!=</span>&nbsp;<span class="builtinfunc" id="7290310">len</span><span class="op" id="7290313">(</span><span class="ident" id="7290314"><a href="/net/smtp/smtp_test.go.html#7292252">helloClient</a></span><span class="op" id="7290325">)</span>&nbsp;<span class="op" id="7290327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290331"><a href="/net/smtp/smtp_test.go.html#7290269">t</a></span><span class="op" id="7290332">.</span><span class="ident" id="7290333">Fatalf</span><span class="op" id="7290339">(</span><span class="string" id="7290340">&#34;Hello&nbsp;server&nbsp;and&nbsp;client&nbsp;size&nbsp;mismatch&#34;</span><span class="op" id="7290379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7290382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7290386">for</span>&nbsp;<span class="ident" id="7290390">i</span>&nbsp;<span class="op" id="7290392">:=</span>&nbsp;<span class="num" id="7290395">0</span><span class="op" id="7290396">;</span>&nbsp;<span class="ident" id="7290398"><a href="/net/smtp/smtp_test.go.html#7290390">i</a></span>&nbsp;<span class="op" id="7290400">&lt;</span>&nbsp;<span class="builtinfunc" id="7290402">len</span><span class="op" id="7290405">(</span><span class="ident" id="7290406"><a href="/net/smtp/smtp_test.go.html#7292007">helloServer</a></span><span class="op" id="7290417">)</span><span class="op" id="7290418">;</span>&nbsp;<span class="ident" id="7290420"><a href="/net/smtp/smtp_test.go.html#7290390">i</a></span><span class="op" id="7290421">++</span>&nbsp;<span class="op" id="7290424">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290428">server</span>&nbsp;<span class="op" id="7290435">:=</span>&nbsp;<span class="ident" id="7290438"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7290445">.</span><span class="ident" id="7290446">Join</span><span class="op" id="7290450">(</span><span class="ident" id="7290451"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7290458">.</span><span class="ident" id="7290459">Split</span><span class="op" id="7290464">(</span><span class="ident" id="7290465"><a href="/net/smtp/smtp_test.go.html#7291911">baseHelloServer</a></span><span class="op" id="7290480">+</span><span class="ident" id="7290481"><a href="/net/smtp/smtp_test.go.html#7292007">helloServer</a></span><span class="op" id="7290492">[</span><span class="ident" id="7290493"><a href="/net/smtp/smtp_test.go.html#7290390">i</a></span><span class="op" id="7290494">]</span><span class="op" id="7290495">,</span>&nbsp;<span class="string" id="7290497">&#34;\n&#34;</span><span class="op" id="7290501">)</span><span class="op" id="7290502">,</span>&nbsp;<span class="string" id="7290504">&#34;\r\n&#34;</span><span class="op" id="7290510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290514">client</span>&nbsp;<span class="op" id="7290521">:=</span>&nbsp;<span class="ident" id="7290524"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7290531">.</span><span class="ident" id="7290532">Join</span><span class="op" id="7290536">(</span><span class="ident" id="7290537"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7290544">.</span><span class="ident" id="7290545">Split</span><span class="op" id="7290550">(</span><span class="ident" id="7290551"><a href="/net/smtp/smtp_test.go.html#7292194">baseHelloClient</a></span><span class="op" id="7290566">+</span><span class="ident" id="7290567"><a href="/net/smtp/smtp_test.go.html#7292252">helloClient</a></span><span class="op" id="7290578">[</span><span class="ident" id="7290579"><a href="/net/smtp/smtp_test.go.html#7290390">i</a></span><span class="op" id="7290580">]</span><span class="op" id="7290581">,</span>&nbsp;<span class="string" id="7290583">&#34;\n&#34;</span><span class="op" id="7290587">)</span><span class="op" id="7290588">,</span>&nbsp;<span class="string" id="7290590">&#34;\r\n&#34;</span><span class="op" id="7290596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7290600">var</span>&nbsp;<span class="ident" id="7290604">cmdbuf</span>&nbsp;<span class="ident" id="7290611"><a href="/net/smtp/smtp_test.go.html#7282750">bytes</a></span><span class="op" id="7290616">.</span><span class="ident" id="7290617">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290626">bcmdbuf</span>&nbsp;<span class="op" id="7290634">:=</span>&nbsp;<span class="ident" id="7290637"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7290642">.</span><span class="ident" id="7290643">NewWriter</span><span class="op" id="7290652">(</span><span class="op" id="7290653">&amp;</span><span class="ident" id="7290654"><a href="/net/smtp/smtp_test.go.html#7290604">cmdbuf</a></span><span class="op" id="7290660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7290664">var</span>&nbsp;<span class="ident" id="7290668">fake</span>&nbsp;<span class="ident" id="7290673"><a href="/net/smtp/smtp_test.go.html#7284915">faker</a></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290681"><a href="/net/smtp/smtp_test.go.html#7290668">fake</a></span><span class="op" id="7290685">.</span><span class="ident" id="7290686">ReadWriter</span>&nbsp;<span class="op" id="7290697">=</span>&nbsp;<span class="ident" id="7290699"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7290704">.</span><span class="ident" id="7290705">NewReadWriter</span><span class="op" id="7290718">(</span><span class="ident" id="7290719"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7290724">.</span><span class="ident" id="7290725">NewReader</span><span class="op" id="7290734">(</span><span class="ident" id="7290735"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7290742">.</span><span class="ident" id="7290743">NewReader</span><span class="op" id="7290752">(</span><span class="ident" id="7290753"><a href="/net/smtp/smtp_test.go.html#7290428">server</a></span><span class="op" id="7290759">)</span><span class="op" id="7290760">)</span><span class="op" id="7290761">,</span>&nbsp;<span class="ident" id="7290763"><a href="/net/smtp/smtp_test.go.html#7290626">bcmdbuf</a></span><span class="op" id="7290770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290774">c</span><span class="op" id="7290775">,</span>&nbsp;<span class="ident" id="7290777">err</span>&nbsp;<span class="op" id="7290781">:=</span>&nbsp;<span class="ident" id="7290784"><a href="/net/smtp/smtp.go.html#5187509">NewClient</a></span><span class="op" id="7290793">(</span><span class="ident" id="7290794"><a href="/net/smtp/smtp_test.go.html#7290668">fake</a></span><span class="op" id="7290798">,</span>&nbsp;<span class="string" id="7290800">&#34;fake.host&#34;</span><span class="op" id="7290811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7290815">if</span>&nbsp;<span class="ident" id="7290818"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span>&nbsp;<span class="op" id="7290822">!=</span>&nbsp;<span class="ident" id="7290825">nil</span>&nbsp;<span class="op" id="7290829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290834"><a href="/net/smtp/smtp_test.go.html#7290269">t</a></span><span class="op" id="7290835">.</span><span class="ident" id="7290836">Fatalf</span><span class="op" id="7290842">(</span><span class="string" id="7290843">&#34;NewClient:&nbsp;%v&#34;</span><span class="op" id="7290858">,</span>&nbsp;<span class="ident" id="7290860"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span><span class="op" id="7290863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7290867">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7290871">defer</span>&nbsp;<span class="ident" id="7290877"><a href="/net/smtp/smtp_test.go.html#7290774">c</a></span><span class="op" id="7290878">.</span><span class="ident" id="7290879">Close</span><span class="op" id="7290884">(</span><span class="op" id="7290885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290889"><a href="/net/smtp/smtp_test.go.html#7290774">c</a></span><span class="op" id="7290890">.</span><span class="ident" id="7290891">localName</span>&nbsp;<span class="op" id="7290901">=</span>&nbsp;<span class="string" id="7290903">&#34;customhost&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290918"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span>&nbsp;<span class="op" id="7290922">=</span>&nbsp;<span class="ident" id="7290924">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7290931">switch</span>&nbsp;<span class="ident" id="7290938"><a href="/net/smtp/smtp_test.go.html#7290390">i</a></span>&nbsp;<span class="op" id="7290940">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7290944">case</span>&nbsp;<span class="num" id="7290949">0</span><span class="op" id="7290950">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290955"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span>&nbsp;<span class="op" id="7290959">=</span>&nbsp;<span class="ident" id="7290961"><a href="/net/smtp/smtp_test.go.html#7290774">c</a></span><span class="op" id="7290962">.</span><span class="ident" id="7290963">Hello</span><span class="op" id="7290968">(</span><span class="string" id="7290969">&#34;customhost&#34;</span><span class="op" id="7290981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7290985">case</span>&nbsp;<span class="num" id="7290990">1</span><span class="op" id="7290991">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290996"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span>&nbsp;<span class="op" id="7291000">=</span>&nbsp;<span class="ident" id="7291002"><a href="/net/smtp/smtp_test.go.html#7290774">c</a></span><span class="op" id="7291003">.</span><span class="ident" id="7291004">StartTLS</span><span class="op" id="7291012">(</span><span class="ident" id="7291013">nil</span><span class="op" id="7291016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291021">if</span>&nbsp;<span class="ident" id="7291024"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span><span class="op" id="7291027">.</span><span class="ident" id="7291028">Error</span><span class="op" id="7291033">(</span><span class="op" id="7291034">)</span>&nbsp;<span class="op" id="7291036">==</span>&nbsp;<span class="string" id="7291039">&#34;502&nbsp;Not&nbsp;implemented&#34;</span>&nbsp;<span class="op" id="7291061">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291067"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span>&nbsp;<span class="op" id="7291071">=</span>&nbsp;<span class="ident" id="7291073">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7291080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291084">case</span>&nbsp;<span class="num" id="7291089">2</span><span class="op" id="7291090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291095"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span>&nbsp;<span class="op" id="7291099">=</span>&nbsp;<span class="ident" id="7291101"><a href="/net/smtp/smtp_test.go.html#7290774">c</a></span><span class="op" id="7291102">.</span><span class="ident" id="7291103">Verify</span><span class="op" id="7291109">(</span><span class="string" id="7291110">&#34;test@example.com&#34;</span><span class="op" id="7291128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291132">case</span>&nbsp;<span class="num" id="7291137">3</span><span class="op" id="7291138">:</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291143"><a href="/net/smtp/smtp_test.go.html#7290774">c</a></span><span class="op" id="7291144">.</span><span class="ident" id="7291145">tls</span>&nbsp;<span class="op" id="7291149">=</span>&nbsp;<span class="ident" id="7291151">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291159"><a href="/net/smtp/smtp_test.go.html#7290774">c</a></span><span class="op" id="7291160">.</span><span class="ident" id="7291161">serverName</span>&nbsp;<span class="op" id="7291172">=</span>&nbsp;<span class="string" id="7291174">&#34;smtp.google.com&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291195"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span>&nbsp;<span class="op" id="7291199">=</span>&nbsp;<span class="ident" id="7291201"><a href="/net/smtp/smtp_test.go.html#7290774">c</a></span><span class="op" id="7291202">.</span><span class="ident" id="7291203">Auth</span><span class="op" id="7291207">(</span><span class="ident" id="7291208"><a href="/net/smtp/auth.go.html#5184343">PlainAuth</a></span><span class="op" id="7291217">(</span><span class="string" id="7291218">&#34;&#34;</span><span class="op" id="7291220">,</span>&nbsp;<span class="string" id="7291222">&#34;user&#34;</span><span class="op" id="7291228">,</span>&nbsp;<span class="string" id="7291230">&#34;pass&#34;</span><span class="op" id="7291236">,</span>&nbsp;<span class="string" id="7291238">&#34;smtp.google.com&#34;</span><span class="op" id="7291255">)</span><span class="op" id="7291256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291260">case</span>&nbsp;<span class="num" id="7291265">4</span><span class="op" id="7291266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291271"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span>&nbsp;<span class="op" id="7291275">=</span>&nbsp;<span class="ident" id="7291277"><a href="/net/smtp/smtp_test.go.html#7290774">c</a></span><span class="op" id="7291278">.</span><span class="ident" id="7291279">Mail</span><span class="op" id="7291283">(</span><span class="string" id="7291284">&#34;test@example.com&#34;</span><span class="op" id="7291302">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291306">case</span>&nbsp;<span class="num" id="7291311">5</span><span class="op" id="7291312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291317">ok</span><span class="op" id="7291319">,</span>&nbsp;<span class="ident" id="7291321">_</span>&nbsp;<span class="op" id="7291323">:=</span>&nbsp;<span class="ident" id="7291326"><a href="/net/smtp/smtp_test.go.html#7290774">c</a></span><span class="op" id="7291327">.</span><span class="ident" id="7291328">Extension</span><span class="op" id="7291337">(</span><span class="string" id="7291338">&#34;feature&#34;</span><span class="op" id="7291347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291352">if</span>&nbsp;<span class="ident" id="7291355"><a href="/net/smtp/smtp_test.go.html#7291317">ok</a></span>&nbsp;<span class="op" id="7291358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291364"><a href="/net/smtp/smtp_test.go.html#7290269">t</a></span><span class="op" id="7291365">.</span><span class="ident" id="7291366">Errorf</span><span class="op" id="7291372">(</span><span class="string" id="7291373">&#34;Expected&nbsp;FEATURE&nbsp;not&nbsp;to&nbsp;be&nbsp;supported&#34;</span><span class="op" id="7291411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7291416">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291420">case</span>&nbsp;<span class="num" id="7291425">6</span><span class="op" id="7291426">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291431"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span>&nbsp;<span class="op" id="7291435">=</span>&nbsp;<span class="ident" id="7291437"><a href="/net/smtp/smtp_test.go.html#7290774">c</a></span><span class="op" id="7291438">.</span><span class="ident" id="7291439">Reset</span><span class="op" id="7291444">(</span><span class="op" id="7291445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291449">case</span>&nbsp;<span class="num" id="7291454">7</span><span class="op" id="7291455">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291460"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span>&nbsp;<span class="op" id="7291464">=</span>&nbsp;<span class="ident" id="7291466"><a href="/net/smtp/smtp_test.go.html#7290774">c</a></span><span class="op" id="7291467">.</span><span class="ident" id="7291468">Quit</span><span class="op" id="7291472">(</span><span class="op" id="7291473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291477">case</span>&nbsp;<span class="num" id="7291482">8</span><span class="op" id="7291483">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291488"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span>&nbsp;<span class="op" id="7291492">=</span>&nbsp;<span class="ident" id="7291494"><a href="/net/smtp/smtp_test.go.html#7290774">c</a></span><span class="op" id="7291495">.</span><span class="ident" id="7291496">Verify</span><span class="op" id="7291502">(</span><span class="string" id="7291503">&#34;test@example.com&#34;</span><span class="op" id="7291521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291526">if</span>&nbsp;<span class="ident" id="7291529"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span>&nbsp;<span class="op" id="7291533">!=</span>&nbsp;<span class="ident" id="7291536">nil</span>&nbsp;<span class="op" id="7291540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291546"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span>&nbsp;<span class="op" id="7291550">=</span>&nbsp;<span class="ident" id="7291552"><a href="/net/smtp/smtp_test.go.html#7290774">c</a></span><span class="op" id="7291553">.</span><span class="ident" id="7291554">Hello</span><span class="op" id="7291559">(</span><span class="string" id="7291560">&#34;customhost&#34;</span><span class="op" id="7291572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291578">if</span>&nbsp;<span class="ident" id="7291581"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span>&nbsp;<span class="op" id="7291585">!=</span>&nbsp;<span class="ident" id="7291588">nil</span>&nbsp;<span class="op" id="7291592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291599"><a href="/net/smtp/smtp_test.go.html#7290269">t</a></span><span class="op" id="7291600">.</span><span class="ident" id="7291601">Errorf</span><span class="op" id="7291607">(</span><span class="string" id="7291608">&#34;Want&nbsp;error,&nbsp;got&nbsp;none&#34;</span><span class="op" id="7291630">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7291636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7291641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291645">default</span><span class="op" id="7291652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291657"><a href="/net/smtp/smtp_test.go.html#7290269">t</a></span><span class="op" id="7291658">.</span><span class="ident" id="7291659">Fatalf</span><span class="op" id="7291665">(</span><span class="string" id="7291666">&#34;Unhandled&nbsp;command&#34;</span><span class="op" id="7291685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7291689">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291694">if</span>&nbsp;<span class="ident" id="7291697"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span>&nbsp;<span class="op" id="7291701">!=</span>&nbsp;<span class="ident" id="7291704">nil</span>&nbsp;<span class="op" id="7291708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291713"><a href="/net/smtp/smtp_test.go.html#7290269">t</a></span><span class="op" id="7291714">.</span><span class="ident" id="7291715">Errorf</span><span class="op" id="7291721">(</span><span class="string" id="7291722">&#34;Command&nbsp;%d&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7291745">,</span>&nbsp;<span class="ident" id="7291747"><a href="/net/smtp/smtp_test.go.html#7290390">i</a></span><span class="op" id="7291748">,</span>&nbsp;<span class="ident" id="7291750"><a href="/net/smtp/smtp_test.go.html#7290777">err</a></span><span class="op" id="7291753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7291757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291762"><a href="/net/smtp/smtp_test.go.html#7290626">bcmdbuf</a></span><span class="op" id="7291769">.</span><span class="ident" id="7291770">Flush</span><span class="op" id="7291775">(</span><span class="op" id="7291776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291780">actualcmds</span>&nbsp;<span class="op" id="7291791">:=</span>&nbsp;<span class="ident" id="7291794"><a href="/net/smtp/smtp_test.go.html#7290604">cmdbuf</a></span><span class="op" id="7291800">.</span><span class="ident" id="7291801">String</span><span class="op" id="7291807">(</span><span class="op" id="7291808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291812">if</span>&nbsp;<span class="ident" id="7291815"><a href="/net/smtp/smtp_test.go.html#7290514">client</a></span>&nbsp;<span class="op" id="7291822">!=</span>&nbsp;<span class="ident" id="7291825"><a href="/net/smtp/smtp_test.go.html#7291780">actualcmds</a></span>&nbsp;<span class="op" id="7291836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291841"><a href="/net/smtp/smtp_test.go.html#7290269">t</a></span><span class="op" id="7291842">.</span><span class="ident" id="7291843">Errorf</span><span class="op" id="7291849">(</span><span class="string" id="7291850">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7291875">,</span>&nbsp;<span class="ident" id="7291877"><a href="/net/smtp/smtp_test.go.html#7291780">actualcmds</a></span><span class="op" id="7291887">,</span>&nbsp;<span class="ident" id="7291889"><a href="/net/smtp/smtp_test.go.html#7290514">client</a></span><span class="op" id="7291895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7291899">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7291902">}</span><br>
<span class="lineno"></span><span class="op" id="7291904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7291907">var</span>&nbsp;<span class="ident" id="7291911">baseHelloServer</span>&nbsp;<span class="op" id="7291927">=</span>&nbsp;<span class="string" id="7291929">`220&nbsp;hello&nbsp;world<br>
<span class="lineno"></span>502&nbsp;EH?<br>
<span class="lineno">385</span>250-mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250&nbsp;FEATURE<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7292003">var</span>&nbsp;<span class="ident" id="7292007">helloServer</span>&nbsp;<span class="op" id="7292019">=</span>&nbsp;<span class="op" id="7292021">[</span><span class="op" id="7292022">]</span><span class="builtintype" id="7292023">string</span><span class="op" id="7292029">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292032">&#34;&#34;</span><span class="op" id="7292034">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292037">&#34;502&nbsp;Not&nbsp;implemented\n&#34;</span><span class="op" id="7292060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292063">&#34;250&nbsp;User&nbsp;is&nbsp;valid\n&#34;</span><span class="op" id="7292084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292087">&#34;235&nbsp;Accepted\n&#34;</span><span class="op" id="7292103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292106">&#34;250&nbsp;Sender&nbsp;ok\n&#34;</span><span class="op" id="7292123">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292126">&#34;&#34;</span><span class="op" id="7292128">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292131">&#34;250&nbsp;Reset&nbsp;ok\n&#34;</span><span class="op" id="7292147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292150">&#34;221&nbsp;Goodbye\n&#34;</span><span class="op" id="7292165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292168">&#34;250&nbsp;Sender&nbsp;ok\n&#34;</span><span class="op" id="7292185">,</span><br>
<span class="lineno"></span><span class="op" id="7292187">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="keyword" id="7292190">var</span>&nbsp;<span class="ident" id="7292194">baseHelloClient</span>&nbsp;<span class="op" id="7292210">=</span>&nbsp;<span class="string" id="7292212">`EHLO&nbsp;customhost<br>
<span class="lineno"></span>HELO&nbsp;customhost<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="keyword" id="7292248">var</span>&nbsp;<span class="ident" id="7292252">helloClient</span>&nbsp;<span class="op" id="7292264">=</span>&nbsp;<span class="op" id="7292266">[</span><span class="op" id="7292267">]</span><span class="builtintype" id="7292268">string</span><span class="op" id="7292274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292277">&#34;&#34;</span><span class="op" id="7292279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292282">&#34;STARTTLS\n&#34;</span><span class="op" id="7292294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292297">&#34;VRFY&nbsp;test@example.com\n&#34;</span><span class="op" id="7292322">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292325">&#34;AUTH&nbsp;PLAIN&nbsp;AHVzZXIAcGFzcw==\n&#34;</span><span class="op" id="7292356">,</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292359">&#34;MAIL&nbsp;FROM:&lt;test@example.com&gt;\n&#34;</span><span class="op" id="7292391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292394">&#34;&#34;</span><span class="op" id="7292396">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292399">&#34;RSET\n&#34;</span><span class="op" id="7292407">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292410">&#34;QUIT\n&#34;</span><span class="op" id="7292418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292421">&#34;VRFY&nbsp;test@example.com\n&#34;</span><span class="op" id="7292446">,</span><br>
<span class="lineno">415</span><span class="op" id="7292448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7292451">func</span>&nbsp;<span class="ident" id="7292456">TestSendMail</span><span class="op" id="7292468">(</span><span class="ident" id="7292469">t</span>&nbsp;<span class="op" id="7292471">*</span><span class="ident" id="7292472"><a href="/net/smtp/smtp_test.go.html#7282829">testing</a></span><span class="op" id="7292479">.</span><span class="ident" id="7292480">T</span><span class="op" id="7292481">)</span>&nbsp;<span class="op" id="7292483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292486">server</span>&nbsp;<span class="op" id="7292493">:=</span>&nbsp;<span class="ident" id="7292496"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7292503">.</span><span class="ident" id="7292504">Join</span><span class="op" id="7292508">(</span><span class="ident" id="7292509"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7292516">.</span><span class="ident" id="7292517">Split</span><span class="op" id="7292522">(</span><span class="ident" id="7292523"><a href="/net/smtp/smtp_test.go.html#7294058">sendMailServer</a></span><span class="op" id="7292537">,</span>&nbsp;<span class="string" id="7292539">&#34;\n&#34;</span><span class="op" id="7292543">)</span><span class="op" id="7292544">,</span>&nbsp;<span class="string" id="7292546">&#34;\r\n&#34;</span><span class="op" id="7292552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292555">client</span>&nbsp;<span class="op" id="7292562">:=</span>&nbsp;<span class="ident" id="7292565"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7292572">.</span><span class="ident" id="7292573">Join</span><span class="op" id="7292577">(</span><span class="ident" id="7292578"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7292585">.</span><span class="ident" id="7292586">Split</span><span class="op" id="7292591">(</span><span class="ident" id="7292592"><a href="/net/smtp/smtp_test.go.html#7294208">sendMailClient</a></span><span class="op" id="7292606">,</span>&nbsp;<span class="string" id="7292608">&#34;\n&#34;</span><span class="op" id="7292612">)</span><span class="op" id="7292613">,</span>&nbsp;<span class="string" id="7292615">&#34;\r\n&#34;</span><span class="op" id="7292621">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292624">var</span>&nbsp;<span class="ident" id="7292628">cmdbuf</span>&nbsp;<span class="ident" id="7292635"><a href="/net/smtp/smtp_test.go.html#7282750">bytes</a></span><span class="op" id="7292640">.</span><span class="ident" id="7292641">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292649">bcmdbuf</span>&nbsp;<span class="op" id="7292657">:=</span>&nbsp;<span class="ident" id="7292660"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7292665">.</span><span class="ident" id="7292666">NewWriter</span><span class="op" id="7292675">(</span><span class="op" id="7292676">&amp;</span><span class="ident" id="7292677"><a href="/net/smtp/smtp_test.go.html#7292628">cmdbuf</a></span><span class="op" id="7292683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292686">l</span><span class="op" id="7292687">,</span>&nbsp;<span class="ident" id="7292689">err</span>&nbsp;<span class="op" id="7292693">:=</span>&nbsp;<span class="ident" id="7292696"><a href="/net/smtp/smtp_test.go.html#7282794">net</a></span><span class="op" id="7292699">.</span><span class="ident" id="7292700">Listen</span><span class="op" id="7292706">(</span><span class="string" id="7292707">&#34;tcp&#34;</span><span class="op" id="7292712">,</span>&nbsp;<span class="string" id="7292714">&#34;127.0.0.1:0&#34;</span><span class="op" id="7292727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292730">if</span>&nbsp;<span class="ident" id="7292733"><a href="/net/smtp/smtp_test.go.html#7292689">err</a></span>&nbsp;<span class="op" id="7292737">!=</span>&nbsp;<span class="ident" id="7292740">nil</span>&nbsp;<span class="op" id="7292744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292748"><a href="/net/smtp/smtp_test.go.html#7292469">t</a></span><span class="op" id="7292749">.</span><span class="ident" id="7292750">Fatalf</span><span class="op" id="7292756">(</span><span class="string" id="7292757">&#34;Unable&nbsp;to&nbsp;to&nbsp;create&nbsp;listener:&nbsp;%v&#34;</span><span class="op" id="7292791">,</span>&nbsp;<span class="ident" id="7292793"><a href="/net/smtp/smtp_test.go.html#7292689">err</a></span><span class="op" id="7292796">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7292799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292802">defer</span>&nbsp;<span class="ident" id="7292808"><a href="/net/smtp/smtp_test.go.html#7292686">l</a></span><span class="op" id="7292809">.</span><span class="ident" id="7292810">Close</span><span class="op" id="7292815">(</span><span class="op" id="7292816">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7292820">//&nbsp;prevent&nbsp;data&nbsp;race&nbsp;on&nbsp;bcmdbuf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292853">var</span>&nbsp;<span class="ident" id="7292857">done</span>&nbsp;<span class="op" id="7292862">=</span>&nbsp;<span class="builtinfunc" id="7292864">make</span><span class="op" id="7292868">(</span><span class="keyword" id="7292869">chan</span>&nbsp;<span class="keyword" id="7292874">struct</span><span class="op" id="7292880">{</span><span class="op" id="7292881">}</span><span class="op" id="7292882">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292885">go</span>&nbsp;<span class="keyword" id="7292888">func</span><span class="op" id="7292892">(</span><span class="ident" id="7292893">data</span>&nbsp;<span class="op" id="7292898">[</span><span class="op" id="7292899">]</span><span class="builtintype" id="7292900">string</span><span class="op" id="7292906">)</span>&nbsp;<span class="op" id="7292908">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292913">defer</span>&nbsp;<span class="builtinfunc" id="7292919">close</span><span class="op" id="7292924">(</span><span class="ident" id="7292925"><a href="/net/smtp/smtp_test.go.html#7292857">done</a></span><span class="op" id="7292929">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292934">conn</span><span class="op" id="7292938">,</span>&nbsp;<span class="ident" id="7292940">err</span>&nbsp;<span class="op" id="7292944">:=</span>&nbsp;<span class="ident" id="7292947"><a href="/net/smtp/smtp_test.go.html#7292686">l</a></span><span class="op" id="7292948">.</span><span class="ident" id="7292949">Accept</span><span class="op" id="7292955">(</span><span class="op" id="7292956">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292960">if</span>&nbsp;<span class="ident" id="7292963"><a href="/net/smtp/smtp_test.go.html#7292940">err</a></span>&nbsp;<span class="op" id="7292967">!=</span>&nbsp;<span class="ident" id="7292970">nil</span>&nbsp;<span class="op" id="7292974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292979"><a href="/net/smtp/smtp_test.go.html#7292469">t</a></span><span class="op" id="7292980">.</span><span class="ident" id="7292981">Errorf</span><span class="op" id="7292987">(</span><span class="string" id="7292988">&#34;Accept&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7293006">,</span>&nbsp;<span class="ident" id="7293008"><a href="/net/smtp/smtp_test.go.html#7292940">err</a></span><span class="op" id="7293011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293016">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293029">defer</span>&nbsp;<span class="ident" id="7293035"><a href="/net/smtp/smtp_test.go.html#7292934">conn</a></span><span class="op" id="7293039">.</span><span class="ident" id="7293040">Close</span><span class="op" id="7293045">(</span><span class="op" id="7293046">)</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293051">tc</span>&nbsp;<span class="op" id="7293054">:=</span>&nbsp;<span class="ident" id="7293057"><a href="/net/smtp/smtp_test.go.html#7282801">textproto</a></span><span class="op" id="7293066">.</span><span class="ident" id="7293067">NewConn</span><span class="op" id="7293074">(</span><span class="ident" id="7293075"><a href="/net/smtp/smtp_test.go.html#7292934">conn</a></span><span class="op" id="7293079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293083">for</span>&nbsp;<span class="ident" id="7293087">i</span>&nbsp;<span class="op" id="7293089">:=</span>&nbsp;<span class="num" id="7293092">0</span><span class="op" id="7293093">;</span>&nbsp;<span class="ident" id="7293095"><a href="/net/smtp/smtp_test.go.html#7293087">i</a></span>&nbsp;<span class="op" id="7293097">&lt;</span>&nbsp;<span class="builtinfunc" id="7293099">len</span><span class="op" id="7293102">(</span><span class="ident" id="7293103"><a href="/net/smtp/smtp_test.go.html#7292893">data</a></span><span class="op" id="7293107">)</span>&nbsp;<span class="op" id="7293109">&amp;&amp;</span>&nbsp;<span class="ident" id="7293112"><a href="/net/smtp/smtp_test.go.html#7292893">data</a></span><span class="op" id="7293116">[</span><span class="ident" id="7293117"><a href="/net/smtp/smtp_test.go.html#7293087">i</a></span><span class="op" id="7293118">]</span>&nbsp;<span class="op" id="7293120">!=</span>&nbsp;<span class="string" id="7293123">&#34;&#34;</span><span class="op" id="7293125">;</span>&nbsp;<span class="ident" id="7293127"><a href="/net/smtp/smtp_test.go.html#7293087">i</a></span><span class="op" id="7293128">++</span>&nbsp;<span class="op" id="7293131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293136"><a href="/net/smtp/smtp_test.go.html#7293051">tc</a></span><span class="op" id="7293138">.</span><span class="ident" id="7293139">PrintfLine</span><span class="op" id="7293149">(</span><span class="ident" id="7293150"><a href="/net/smtp/smtp_test.go.html#7292893">data</a></span><span class="op" id="7293154">[</span><span class="ident" id="7293155"><a href="/net/smtp/smtp_test.go.html#7293087">i</a></span><span class="op" id="7293156">]</span><span class="op" id="7293157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293162">for</span>&nbsp;<span class="builtinfunc" id="7293166">len</span><span class="op" id="7293169">(</span><span class="ident" id="7293170"><a href="/net/smtp/smtp_test.go.html#7292893">data</a></span><span class="op" id="7293174">[</span><span class="ident" id="7293175"><a href="/net/smtp/smtp_test.go.html#7293087">i</a></span><span class="op" id="7293176">]</span><span class="op" id="7293177">)</span>&nbsp;<span class="op" id="7293179">&gt;=</span>&nbsp;<span class="num" id="7293182">4</span>&nbsp;<span class="op" id="7293184">&amp;&amp;</span>&nbsp;<span class="ident" id="7293187"><a href="/net/smtp/smtp_test.go.html#7292893">data</a></span><span class="op" id="7293191">[</span><span class="ident" id="7293192"><a href="/net/smtp/smtp_test.go.html#7293087">i</a></span><span class="op" id="7293193">]</span><span class="op" id="7293194">[</span><span class="num" id="7293195">3</span><span class="op" id="7293196">]</span>&nbsp;<span class="op" id="7293198">==</span>&nbsp;<span class="string" id="7293201">&#39;-&#39;</span>&nbsp;<span class="op" id="7293205">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293211"><a href="/net/smtp/smtp_test.go.html#7293087">i</a></span><span class="op" id="7293212">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293219"><a href="/net/smtp/smtp_test.go.html#7293051">tc</a></span><span class="op" id="7293221">.</span><span class="ident" id="7293222">PrintfLine</span><span class="op" id="7293232">(</span><span class="ident" id="7293233"><a href="/net/smtp/smtp_test.go.html#7292893">data</a></span><span class="op" id="7293237">[</span><span class="ident" id="7293238"><a href="/net/smtp/smtp_test.go.html#7293087">i</a></span><span class="op" id="7293239">]</span><span class="op" id="7293240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293250">if</span>&nbsp;<span class="ident" id="7293253"><a href="/net/smtp/smtp_test.go.html#7292893">data</a></span><span class="op" id="7293257">[</span><span class="ident" id="7293258"><a href="/net/smtp/smtp_test.go.html#7293087">i</a></span><span class="op" id="7293259">]</span>&nbsp;<span class="op" id="7293261">==</span>&nbsp;<span class="string" id="7293264">&#34;221&nbsp;Goodbye&#34;</span>&nbsp;<span class="op" id="7293278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293284">return</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293299">read</span>&nbsp;<span class="op" id="7293304">:=</span>&nbsp;<span class="ident" id="7293307">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293316">for</span>&nbsp;<span class="op" id="7293320">!</span><span class="ident" id="7293321"><a href="/net/smtp/smtp_test.go.html#7293299">read</a></span>&nbsp;<span class="op" id="7293326">||</span>&nbsp;<span class="ident" id="7293329"><a href="/net/smtp/smtp_test.go.html#7292893">data</a></span><span class="op" id="7293333">[</span><span class="ident" id="7293334"><a href="/net/smtp/smtp_test.go.html#7293087">i</a></span><span class="op" id="7293335">]</span>&nbsp;<span class="op" id="7293337">==</span>&nbsp;<span class="string" id="7293340">&#34;354&nbsp;Go&nbsp;ahead&#34;</span>&nbsp;<span class="op" id="7293355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293361">msg</span><span class="op" id="7293364">,</span>&nbsp;<span class="ident" id="7293366">err</span>&nbsp;<span class="op" id="7293370">:=</span>&nbsp;<span class="ident" id="7293373"><a href="/net/smtp/smtp_test.go.html#7293051">tc</a></span><span class="op" id="7293375">.</span><span class="ident" id="7293376">ReadLine</span><span class="op" id="7293384">(</span><span class="op" id="7293385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293391"><a href="/net/smtp/smtp_test.go.html#7292649">bcmdbuf</a></span><span class="op" id="7293398">.</span><span class="ident" id="7293399">Write</span><span class="op" id="7293404">(</span><span class="op" id="7293405">[</span><span class="op" id="7293406">]</span><span class="builtintype" id="7293407">byte</span><span class="op" id="7293411">(</span><span class="ident" id="7293412"><a href="/net/smtp/smtp_test.go.html#7293361">msg</a></span>&nbsp;<span class="op" id="7293416">+</span>&nbsp;<span class="string" id="7293418">&#34;\r\n&#34;</span><span class="op" id="7293424">)</span><span class="op" id="7293425">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293431"><a href="/net/smtp/smtp_test.go.html#7293299">read</a></span>&nbsp;<span class="op" id="7293436">=</span>&nbsp;<span class="ident" id="7293438">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293447">if</span>&nbsp;<span class="ident" id="7293450"><a href="/net/smtp/smtp_test.go.html#7293366">err</a></span>&nbsp;<span class="op" id="7293454">!=</span>&nbsp;<span class="ident" id="7293457">nil</span>&nbsp;<span class="op" id="7293461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293468"><a href="/net/smtp/smtp_test.go.html#7292469">t</a></span><span class="op" id="7293469">.</span><span class="ident" id="7293470">Errorf</span><span class="op" id="7293476">(</span><span class="string" id="7293477">&#34;Read&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7293493">,</span>&nbsp;<span class="ident" id="7293495"><a href="/net/smtp/smtp_test.go.html#7293366">err</a></span><span class="op" id="7293498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293505">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293516">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293522">if</span>&nbsp;<span class="ident" id="7293525"><a href="/net/smtp/smtp_test.go.html#7292893">data</a></span><span class="op" id="7293529">[</span><span class="ident" id="7293530"><a href="/net/smtp/smtp_test.go.html#7293087">i</a></span><span class="op" id="7293531">]</span>&nbsp;<span class="op" id="7293533">==</span>&nbsp;<span class="string" id="7293536">&#34;354&nbsp;Go&nbsp;ahead&#34;</span>&nbsp;<span class="op" id="7293551">&amp;&amp;</span>&nbsp;<span class="ident" id="7293554"><a href="/net/smtp/smtp_test.go.html#7293361">msg</a></span>&nbsp;<span class="op" id="7293558">==</span>&nbsp;<span class="string" id="7293561">&#34;.&#34;</span>&nbsp;<span class="op" id="7293565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293572">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293591">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293594">}</span><span class="op" id="7293595">(</span><span class="ident" id="7293596"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7293603">.</span><span class="ident" id="7293604">Split</span><span class="op" id="7293609">(</span><span class="ident" id="7293610"><a href="/net/smtp/smtp_test.go.html#7292486">server</a></span><span class="op" id="7293616">,</span>&nbsp;<span class="string" id="7293618">&#34;\r\n&#34;</span><span class="op" id="7293624">)</span><span class="op" id="7293625">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293629"><a href="/net/smtp/smtp_test.go.html#7292689">err</a></span>&nbsp;<span class="op" id="7293633">=</span>&nbsp;<span class="ident" id="7293635"><a href="/net/smtp/smtp.go.html#5193526">SendMail</a></span><span class="op" id="7293643">(</span><span class="ident" id="7293644"><a href="/net/smtp/smtp_test.go.html#7292686">l</a></span><span class="op" id="7293645">.</span><span class="ident" id="7293646">Addr</span><span class="op" id="7293650">(</span><span class="op" id="7293651">)</span><span class="op" id="7293652">.</span><span class="ident" id="7293653">String</span><span class="op" id="7293659">(</span><span class="op" id="7293660">)</span><span class="op" id="7293661">,</span>&nbsp;<span class="ident" id="7293663">nil</span><span class="op" id="7293666">,</span>&nbsp;<span class="string" id="7293668">&#34;test@example.com&#34;</span><span class="op" id="7293686">,</span>&nbsp;<span class="op" id="7293688">[</span><span class="op" id="7293689">]</span><span class="builtintype" id="7293690">string</span><span class="op" id="7293696">{</span><span class="string" id="7293697">&#34;other@example.com&#34;</span><span class="op" id="7293716">}</span><span class="op" id="7293717">,</span>&nbsp;<span class="op" id="7293719">[</span><span class="op" id="7293720">]</span><span class="builtintype" id="7293721">byte</span><span class="op" id="7293725">(</span><span class="ident" id="7293726"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7293733">.</span><span class="ident" id="7293734">Replace</span><span class="op" id="7293741">(</span><span class="string" id="7293742">`From:&nbsp;test@example.com<br>
<span class="lineno"></span>To:&nbsp;other@example.com<br>
<span class="lineno"></span>Subject:&nbsp;SendMail&nbsp;test<br>
<span class="lineno">470</span><br>
<span class="lineno"></span>SendMail&nbsp;is&nbsp;working&nbsp;for&nbsp;me.<br>
<span class="lineno"></span>`</span><span class="op" id="7293841">,</span>&nbsp;<span class="string" id="7293843">&#34;\n&#34;</span><span class="op" id="7293847">,</span>&nbsp;<span class="string" id="7293849">&#34;\r\n&#34;</span><span class="op" id="7293855">,</span>&nbsp;<span class="op" id="7293857">-</span><span class="num" id="7293858">1</span><span class="op" id="7293859">)</span><span class="op" id="7293860">)</span><span class="op" id="7293861">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293865">if</span>&nbsp;<span class="ident" id="7293868"><a href="/net/smtp/smtp_test.go.html#7292689">err</a></span>&nbsp;<span class="op" id="7293872">!=</span>&nbsp;<span class="ident" id="7293875">nil</span>&nbsp;<span class="op" id="7293879">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293883"><a href="/net/smtp/smtp_test.go.html#7292469">t</a></span><span class="op" id="7293884">.</span><span class="ident" id="7293885">Errorf</span><span class="op" id="7293891">(</span><span class="string" id="7293892">&#34;%v&#34;</span><span class="op" id="7293896">,</span>&nbsp;<span class="ident" id="7293898"><a href="/net/smtp/smtp_test.go.html#7292689">err</a></span><span class="op" id="7293901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293908">&lt;-</span><span class="ident" id="7293910"><a href="/net/smtp/smtp_test.go.html#7292857">done</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293916"><a href="/net/smtp/smtp_test.go.html#7292649">bcmdbuf</a></span><span class="op" id="7293923">.</span><span class="ident" id="7293924">Flush</span><span class="op" id="7293929">(</span><span class="op" id="7293930">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293933">actualcmds</span>&nbsp;<span class="op" id="7293944">:=</span>&nbsp;<span class="ident" id="7293947"><a href="/net/smtp/smtp_test.go.html#7292628">cmdbuf</a></span><span class="op" id="7293953">.</span><span class="ident" id="7293954">String</span><span class="op" id="7293960">(</span><span class="op" id="7293961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293964">if</span>&nbsp;<span class="ident" id="7293967"><a href="/net/smtp/smtp_test.go.html#7292555">client</a></span>&nbsp;<span class="op" id="7293974">!=</span>&nbsp;<span class="ident" id="7293977"><a href="/net/smtp/smtp_test.go.html#7293933">actualcmds</a></span>&nbsp;<span class="op" id="7293988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293992"><a href="/net/smtp/smtp_test.go.html#7292469">t</a></span><span class="op" id="7293993">.</span><span class="ident" id="7293994">Errorf</span><span class="op" id="7294000">(</span><span class="string" id="7294001">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7294026">,</span>&nbsp;<span class="ident" id="7294028"><a href="/net/smtp/smtp_test.go.html#7293933">actualcmds</a></span><span class="op" id="7294038">,</span>&nbsp;<span class="ident" id="7294040"><a href="/net/smtp/smtp_test.go.html#7292555">client</a></span><span class="op" id="7294046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7294049">}</span><br>
<span class="lineno"></span><span class="op" id="7294051">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="keyword" id="7294054">var</span>&nbsp;<span class="ident" id="7294058">sendMailServer</span>&nbsp;<span class="op" id="7294073">=</span>&nbsp;<span class="string" id="7294075">`220&nbsp;hello&nbsp;world<br>
<span class="lineno"></span>502&nbsp;EH?<br>
<span class="lineno"></span>250&nbsp;mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250&nbsp;Sender&nbsp;ok<br>
<span class="lineno">490</span>250&nbsp;Receiver&nbsp;ok<br>
<span class="lineno"></span>354&nbsp;Go&nbsp;ahead<br>
<span class="lineno"></span>250&nbsp;Data&nbsp;ok<br>
<span class="lineno"></span>221&nbsp;Goodbye<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="7294204">var</span>&nbsp;<span class="ident" id="7294208">sendMailClient</span>&nbsp;<span class="op" id="7294223">=</span>&nbsp;<span class="string" id="7294225">`EHLO&nbsp;localhost<br>
<span class="lineno"></span>HELO&nbsp;localhost<br>
<span class="lineno"></span>MAIL&nbsp;FROM:&lt;test@example.com&gt;<br>
<span class="lineno"></span>RCPT&nbsp;TO:&lt;other@example.com&gt;<br>
<span class="lineno">500</span>DATA<br>
<span class="lineno"></span>From:&nbsp;test@example.com<br>
<span class="lineno"></span>To:&nbsp;other@example.com<br>
<span class="lineno"></span>Subject:&nbsp;SendMail&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno">505</span>SendMail&nbsp;is&nbsp;working&nbsp;for&nbsp;me.<br>
<span class="lineno"></span>.<br>
<span class="lineno"></span>QUIT<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span><span class="keyword" id="7294425">func</span>&nbsp;<span class="ident" id="7294430">TestAuthFailed</span><span class="op" id="7294444">(</span><span class="ident" id="7294445">t</span>&nbsp;<span class="op" id="7294447">*</span><span class="ident" id="7294448"><a href="/net/smtp/smtp_test.go.html#7282829">testing</a></span><span class="op" id="7294455">.</span><span class="ident" id="7294456">T</span><span class="op" id="7294457">)</span>&nbsp;<span class="op" id="7294459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294462">server</span>&nbsp;<span class="op" id="7294469">:=</span>&nbsp;<span class="ident" id="7294472"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7294479">.</span><span class="ident" id="7294480">Join</span><span class="op" id="7294484">(</span><span class="ident" id="7294485"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7294492">.</span><span class="ident" id="7294493">Split</span><span class="op" id="7294498">(</span><span class="ident" id="7294499"><a href="/net/smtp/smtp_test.go.html#7295391">authFailedServer</a></span><span class="op" id="7294515">,</span>&nbsp;<span class="string" id="7294517">&#34;\n&#34;</span><span class="op" id="7294521">)</span><span class="op" id="7294522">,</span>&nbsp;<span class="string" id="7294524">&#34;\r\n&#34;</span><span class="op" id="7294530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294533">client</span>&nbsp;<span class="op" id="7294540">:=</span>&nbsp;<span class="ident" id="7294543"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7294550">.</span><span class="ident" id="7294551">Join</span><span class="op" id="7294555">(</span><span class="ident" id="7294556"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7294563">.</span><span class="ident" id="7294564">Split</span><span class="op" id="7294569">(</span><span class="ident" id="7294570"><a href="/net/smtp/smtp_test.go.html#7295556">authFailedClient</a></span><span class="op" id="7294586">,</span>&nbsp;<span class="string" id="7294588">&#34;\n&#34;</span><span class="op" id="7294592">)</span><span class="op" id="7294593">,</span>&nbsp;<span class="string" id="7294595">&#34;\r\n&#34;</span><span class="op" id="7294601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294604">var</span>&nbsp;<span class="ident" id="7294608">cmdbuf</span>&nbsp;<span class="ident" id="7294615"><a href="/net/smtp/smtp_test.go.html#7282750">bytes</a></span><span class="op" id="7294620">.</span><span class="ident" id="7294621">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294629">bcmdbuf</span>&nbsp;<span class="op" id="7294637">:=</span>&nbsp;<span class="ident" id="7294640"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7294645">.</span><span class="ident" id="7294646">NewWriter</span><span class="op" id="7294655">(</span><span class="op" id="7294656">&amp;</span><span class="ident" id="7294657"><a href="/net/smtp/smtp_test.go.html#7294608">cmdbuf</a></span><span class="op" id="7294663">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294666">var</span>&nbsp;<span class="ident" id="7294670">fake</span>&nbsp;<span class="ident" id="7294675"><a href="/net/smtp/smtp_test.go.html#7284915">faker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294682"><a href="/net/smtp/smtp_test.go.html#7294670">fake</a></span><span class="op" id="7294686">.</span><span class="ident" id="7294687">ReadWriter</span>&nbsp;<span class="op" id="7294698">=</span>&nbsp;<span class="ident" id="7294700"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7294705">.</span><span class="ident" id="7294706">NewReadWriter</span><span class="op" id="7294719">(</span><span class="ident" id="7294720"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7294725">.</span><span class="ident" id="7294726">NewReader</span><span class="op" id="7294735">(</span><span class="ident" id="7294736"><a href="/net/smtp/smtp_test.go.html#7282818">strings</a></span><span class="op" id="7294743">.</span><span class="ident" id="7294744">NewReader</span><span class="op" id="7294753">(</span><span class="ident" id="7294754"><a href="/net/smtp/smtp_test.go.html#7294462">server</a></span><span class="op" id="7294760">)</span><span class="op" id="7294761">)</span><span class="op" id="7294762">,</span>&nbsp;<span class="ident" id="7294764"><a href="/net/smtp/smtp_test.go.html#7294629">bcmdbuf</a></span><span class="op" id="7294771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294774">c</span><span class="op" id="7294775">,</span>&nbsp;<span class="ident" id="7294777">err</span>&nbsp;<span class="op" id="7294781">:=</span>&nbsp;<span class="ident" id="7294784"><a href="/net/smtp/smtp.go.html#5187509">NewClient</a></span><span class="op" id="7294793">(</span><span class="ident" id="7294794"><a href="/net/smtp/smtp_test.go.html#7294670">fake</a></span><span class="op" id="7294798">,</span>&nbsp;<span class="string" id="7294800">&#34;fake.host&#34;</span><span class="op" id="7294811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294814">if</span>&nbsp;<span class="ident" id="7294817"><a href="/net/smtp/smtp_test.go.html#7294777">err</a></span>&nbsp;<span class="op" id="7294821">!=</span>&nbsp;<span class="ident" id="7294824">nil</span>&nbsp;<span class="op" id="7294828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294832"><a href="/net/smtp/smtp_test.go.html#7294445">t</a></span><span class="op" id="7294833">.</span><span class="ident" id="7294834">Fatalf</span><span class="op" id="7294840">(</span><span class="string" id="7294841">&#34;NewClient:&nbsp;%v&#34;</span><span class="op" id="7294856">,</span>&nbsp;<span class="ident" id="7294858"><a href="/net/smtp/smtp_test.go.html#7294777">err</a></span><span class="op" id="7294861">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7294864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294867">defer</span>&nbsp;<span class="ident" id="7294873"><a href="/net/smtp/smtp_test.go.html#7294774">c</a></span><span class="op" id="7294874">.</span><span class="ident" id="7294875">Close</span><span class="op" id="7294880">(</span><span class="op" id="7294881">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294885"><a href="/net/smtp/smtp_test.go.html#7294774">c</a></span><span class="op" id="7294886">.</span><span class="ident" id="7294887">tls</span>&nbsp;<span class="op" id="7294891">=</span>&nbsp;<span class="ident" id="7294893">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294899"><a href="/net/smtp/smtp_test.go.html#7294774">c</a></span><span class="op" id="7294900">.</span><span class="ident" id="7294901">serverName</span>&nbsp;<span class="op" id="7294912">=</span>&nbsp;<span class="string" id="7294914">&#34;smtp.google.com&#34;</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294933"><a href="/net/smtp/smtp_test.go.html#7294777">err</a></span>&nbsp;<span class="op" id="7294937">=</span>&nbsp;<span class="ident" id="7294939"><a href="/net/smtp/smtp_test.go.html#7294774">c</a></span><span class="op" id="7294940">.</span><span class="ident" id="7294941">Auth</span><span class="op" id="7294945">(</span><span class="ident" id="7294946"><a href="/net/smtp/auth.go.html#5184343">PlainAuth</a></span><span class="op" id="7294955">(</span><span class="string" id="7294956">&#34;&#34;</span><span class="op" id="7294958">,</span>&nbsp;<span class="string" id="7294960">&#34;user&#34;</span><span class="op" id="7294966">,</span>&nbsp;<span class="string" id="7294968">&#34;pass&#34;</span><span class="op" id="7294974">,</span>&nbsp;<span class="string" id="7294976">&#34;smtp.google.com&#34;</span><span class="op" id="7294993">)</span><span class="op" id="7294994">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294998">if</span>&nbsp;<span class="ident" id="7295001"><a href="/net/smtp/smtp_test.go.html#7294777">err</a></span>&nbsp;<span class="op" id="7295005">==</span>&nbsp;<span class="ident" id="7295008">nil</span>&nbsp;<span class="op" id="7295012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7295016"><a href="/net/smtp/smtp_test.go.html#7294445">t</a></span><span class="op" id="7295017">.</span><span class="ident" id="7295018">Error</span><span class="op" id="7295023">(</span><span class="string" id="7295024">&#34;Auth:&nbsp;expected&nbsp;error;&nbsp;got&nbsp;none&#34;</span><span class="op" id="7295056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7295059">}</span>&nbsp;<span class="keyword" id="7295061">else</span>&nbsp;<span class="keyword" id="7295066">if</span>&nbsp;<span class="ident" id="7295069"><a href="/net/smtp/smtp_test.go.html#7294777">err</a></span><span class="op" id="7295072">.</span><span class="ident" id="7295073">Error</span><span class="op" id="7295078">(</span><span class="op" id="7295079">)</span>&nbsp;<span class="op" id="7295081">!=</span>&nbsp;<span class="string" id="7295084">&#34;535&nbsp;Invalid&nbsp;credentials\nplease&nbsp;see&nbsp;www.example.com&#34;</span>&nbsp;<span class="op" id="7295138">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7295142"><a href="/net/smtp/smtp_test.go.html#7294445">t</a></span><span class="op" id="7295143">.</span><span class="ident" id="7295144">Errorf</span><span class="op" id="7295150">(</span><span class="string" id="7295151">&#34;Auth:&nbsp;got&nbsp;error:&nbsp;%v,&nbsp;want:&nbsp;%s&#34;</span><span class="op" id="7295182">,</span>&nbsp;<span class="ident" id="7295184"><a href="/net/smtp/smtp_test.go.html#7294777">err</a></span><span class="op" id="7295187">,</span>&nbsp;<span class="string" id="7295189">&#34;535&nbsp;Invalid&nbsp;credentials\nplease&nbsp;see&nbsp;www.example.com&#34;</span><span class="op" id="7295242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7295245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7295249"><a href="/net/smtp/smtp_test.go.html#7294629">bcmdbuf</a></span><span class="op" id="7295256">.</span><span class="ident" id="7295257">Flush</span><span class="op" id="7295262">(</span><span class="op" id="7295263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7295266">actualcmds</span>&nbsp;<span class="op" id="7295277">:=</span>&nbsp;<span class="ident" id="7295280"><a href="/net/smtp/smtp_test.go.html#7294608">cmdbuf</a></span><span class="op" id="7295286">.</span><span class="ident" id="7295287">String</span><span class="op" id="7295293">(</span><span class="op" id="7295294">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7295297">if</span>&nbsp;<span class="ident" id="7295300"><a href="/net/smtp/smtp_test.go.html#7294533">client</a></span>&nbsp;<span class="op" id="7295307">!=</span>&nbsp;<span class="ident" id="7295310"><a href="/net/smtp/smtp_test.go.html#7295266">actualcmds</a></span>&nbsp;<span class="op" id="7295321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7295325"><a href="/net/smtp/smtp_test.go.html#7294445">t</a></span><span class="op" id="7295326">.</span><span class="ident" id="7295327">Errorf</span><span class="op" id="7295333">(</span><span class="string" id="7295334">&#34;Got:\n%s\nExpected:\n%s&#34;</span><span class="op" id="7295359">,</span>&nbsp;<span class="ident" id="7295361"><a href="/net/smtp/smtp_test.go.html#7295266">actualcmds</a></span><span class="op" id="7295371">,</span>&nbsp;<span class="ident" id="7295373"><a href="/net/smtp/smtp_test.go.html#7294533">client</a></span><span class="op" id="7295379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7295382">}</span><br>
<span class="lineno"></span><span class="op" id="7295384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="keyword" id="7295387">var</span>&nbsp;<span class="ident" id="7295391">authFailedServer</span>&nbsp;<span class="op" id="7295408">=</span>&nbsp;<span class="string" id="7295410">`220&nbsp;hello&nbsp;world<br>
<span class="lineno"></span>250-mx.google.com&nbsp;at&nbsp;your&nbsp;service<br>
<span class="lineno"></span>250&nbsp;AUTH&nbsp;LOGIN&nbsp;PLAIN<br>
<span class="lineno"></span>535-Invalid&nbsp;credentials<br>
<span class="lineno"></span>535&nbsp;please&nbsp;see&nbsp;www.example.com<br>
<span class="lineno">545</span>221&nbsp;Goodbye<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7295552">var</span>&nbsp;<span class="ident" id="7295556">authFailedClient</span>&nbsp;<span class="op" id="7295573">=</span>&nbsp;<span class="string" id="7295575">`EHLO&nbsp;localhost<br>
<span class="lineno"></span>AUTH&nbsp;PLAIN&nbsp;AHVzZXIAcGFzcw==<br>
<span class="lineno">550</span>*<br>
<span class="lineno"></span>QUIT<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7295629">func</span>&nbsp;<span class="ident" id="7295634">TestTLSClient</span><span class="op" id="7295647">(</span><span class="ident" id="7295648">t</span>&nbsp;<span class="op" id="7295650">*</span><span class="ident" id="7295651"><a href="/net/smtp/smtp_test.go.html#7282829">testing</a></span><span class="op" id="7295658">.</span><span class="ident" id="7295659">T</span><span class="op" id="7295660">)</span>&nbsp;<span class="op" id="7295662">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7295665">ln</span>&nbsp;<span class="op" id="7295668">:=</span>&nbsp;<span class="ident" id="7295671"><a href="/net/smtp/smtp_test.go.html#7296089">newLocalListener</a></span><span class="op" id="7295687">(</span><span class="ident" id="7295688"><a href="/net/smtp/smtp_test.go.html#7295648">t</a></span><span class="op" id="7295689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7295692">defer</span>&nbsp;<span class="ident" id="7295698"><a href="/net/smtp/smtp_test.go.html#7295665">ln</a></span><span class="op" id="7295700">.</span><span class="ident" id="7295701">Close</span><span class="op" id="7295706">(</span><span class="op" id="7295707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7295710">errc</span>&nbsp;<span class="op" id="7295715">:=</span>&nbsp;<span class="builtinfunc" id="7295718">make</span><span class="op" id="7295722">(</span><span class="keyword" id="7295723">chan</span>&nbsp;<span class="builtintype" id="7295728">error</span><span class="op" id="7295733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7295736">go</span>&nbsp;<span class="keyword" id="7295739">func</span><span class="op" id="7295743">(</span><span class="op" id="7295744">)</span>&nbsp;<span class="op" id="7295746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7295750"><a href="/net/smtp/smtp_test.go.html#7295710">errc</a></span>&nbsp;<span class="op" id="7295755">&lt;-</span>&nbsp;<span class="ident" id="7295758"><a href="/net/smtp/smtp_test.go.html#7297978">sendMail</a></span><span class="op" id="7295766">(</span><span class="ident" id="7295767"><a href="/net/smtp/smtp_test.go.html#7295665">ln</a></span><span class="op" id="7295769">.</span><span class="ident" id="7295770">Addr</span><span class="op" id="7295774">(</span><span class="op" id="7295775">)</span><span class="op" id="7295776">.</span><span class="ident" id="7295777">String</span><span class="op" id="7295783">(</span><span class="op" id="7295784">)</span><span class="op" id="7295785">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7295788">}</span><span class="op" id="7295789">(</span><span class="op" id="7295790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7295793">conn</span><span class="op" id="7295797">,</span>&nbsp;<span class="ident" id="7295799">err</span>&nbsp;<span class="op" id="7295803">:=</span>&nbsp;<span class="ident" id="7295806"><a href="/net/smtp/smtp_test.go.html#7295665">ln</a></span><span class="op" id="7295808">.</span><span class="ident" id="7295809">Accept</span><span class="op" id="7295815">(</span><span class="op" id="7295816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7295819">if</span>&nbsp;<span class="ident" id="7295822"><a href="/net/smtp/smtp_test.go.html#7295799">err</a></span>&nbsp;<span class="op" id="7295826">!=</span>&nbsp;<span class="ident" id="7295829">nil</span>&nbsp;<span class="op" id="7295833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7295837"><a href="/net/smtp/smtp_test.go.html#7295648">t</a></span><span class="op" id="7295838">.</span><span class="ident" id="7295839">Fatalf</span><span class="op" id="7295845">(</span><span class="string" id="7295846">&#34;failed&nbsp;to&nbsp;accept&nbsp;connection:&nbsp;%v&#34;</span><span class="op" id="7295879">,</span>&nbsp;<span class="ident" id="7295881"><a href="/net/smtp/smtp_test.go.html#7295799">err</a></span><span class="op" id="7295884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7295887">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7295890">defer</span>&nbsp;<span class="ident" id="7295896"><a href="/net/smtp/smtp_test.go.html#7295793">conn</a></span><span class="op" id="7295900">.</span><span class="ident" id="7295901">Close</span><span class="op" id="7295906">(</span><span class="op" id="7295907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7295910">if</span>&nbsp;<span class="ident" id="7295913">err</span>&nbsp;<span class="op" id="7295917">:=</span>&nbsp;<span class="ident" id="7295920"><a href="/net/smtp/smtp_test.go.html#7296474">serverHandle</a></span><span class="op" id="7295932">(</span><span class="ident" id="7295933"><a href="/net/smtp/smtp_test.go.html#7295793">conn</a></span><span class="op" id="7295937">,</span>&nbsp;<span class="ident" id="7295939"><a href="/net/smtp/smtp_test.go.html#7295648">t</a></span><span class="op" id="7295940">)</span><span class="op" id="7295941">;</span>&nbsp;<span class="ident" id="7295943"><a href="/net/smtp/smtp_test.go.html#7295913">err</a></span>&nbsp;<span class="op" id="7295947">!=</span>&nbsp;<span class="ident" id="7295950">nil</span>&nbsp;<span class="op" id="7295954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7295958"><a href="/net/smtp/smtp_test.go.html#7295648">t</a></span><span class="op" id="7295959">.</span><span class="ident" id="7295960">Fatalf</span><span class="op" id="7295966">(</span><span class="string" id="7295967">&#34;failed&nbsp;to&nbsp;handle&nbsp;connection:&nbsp;%v&#34;</span><span class="op" id="7296000">,</span>&nbsp;<span class="ident" id="7296002"><a href="/net/smtp/smtp_test.go.html#7295913">err</a></span><span class="op" id="7296005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7296008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7296011">if</span>&nbsp;<span class="ident" id="7296014">err</span>&nbsp;<span class="op" id="7296018">:=</span>&nbsp;<span class="op" id="7296021">&lt;-</span><span class="ident" id="7296023"><a href="/net/smtp/smtp_test.go.html#7295710">errc</a></span><span class="op" id="7296027">;</span>&nbsp;<span class="ident" id="7296029"><a href="/net/smtp/smtp_test.go.html#7296014">err</a></span>&nbsp;<span class="op" id="7296033">!=</span>&nbsp;<span class="ident" id="7296036">nil</span>&nbsp;<span class="op" id="7296040">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296044"><a href="/net/smtp/smtp_test.go.html#7295648">t</a></span><span class="op" id="7296045">.</span><span class="ident" id="7296046">Fatalf</span><span class="op" id="7296052">(</span><span class="string" id="7296053">&#34;client&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7296071">,</span>&nbsp;<span class="ident" id="7296073"><a href="/net/smtp/smtp_test.go.html#7296014">err</a></span><span class="op" id="7296076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7296079">}</span><br>
<span class="lineno"></span><span class="op" id="7296081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7296084">func</span>&nbsp;<span class="ident" id="7296089">newLocalListener</span><span class="op" id="7296105">(</span><span class="ident" id="7296106">t</span>&nbsp;<span class="op" id="7296108">*</span><span class="ident" id="7296109"><a href="/net/smtp/smtp_test.go.html#7282829">testing</a></span><span class="op" id="7296116">.</span><span class="ident" id="7296117">T</span><span class="op" id="7296118">)</span>&nbsp;<span class="ident" id="7296120"><a href="/net/smtp/smtp_test.go.html#7282794">net</a></span><span class="op" id="7296123">.</span><span class="ident" id="7296124">Listener</span>&nbsp;<span class="op" id="7296133">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296136">ln</span><span class="op" id="7296138">,</span>&nbsp;<span class="ident" id="7296140">err</span>&nbsp;<span class="op" id="7296144">:=</span>&nbsp;<span class="ident" id="7296147"><a href="/net/smtp/smtp_test.go.html#7282794">net</a></span><span class="op" id="7296150">.</span><span class="ident" id="7296151">Listen</span><span class="op" id="7296157">(</span><span class="string" id="7296158">&#34;tcp&#34;</span><span class="op" id="7296163">,</span>&nbsp;<span class="string" id="7296165">&#34;127.0.0.1:0&#34;</span><span class="op" id="7296178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7296181">if</span>&nbsp;<span class="ident" id="7296184"><a href="/net/smtp/smtp_test.go.html#7296140">err</a></span>&nbsp;<span class="op" id="7296188">!=</span>&nbsp;<span class="ident" id="7296191">nil</span>&nbsp;<span class="op" id="7296195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296199"><a href="/net/smtp/smtp_test.go.html#7296136">ln</a></span><span class="op" id="7296201">,</span>&nbsp;<span class="ident" id="7296203"><a href="/net/smtp/smtp_test.go.html#7296140">err</a></span>&nbsp;<span class="op" id="7296207">=</span>&nbsp;<span class="ident" id="7296209"><a href="/net/smtp/smtp_test.go.html#7282794">net</a></span><span class="op" id="7296212">.</span><span class="ident" id="7296213">Listen</span><span class="op" id="7296219">(</span><span class="string" id="7296220">&#34;tcp6&#34;</span><span class="op" id="7296226">,</span>&nbsp;<span class="string" id="7296228">&#34;[::1]:0&#34;</span><span class="op" id="7296237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7296240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7296243">if</span>&nbsp;<span class="ident" id="7296246"><a href="/net/smtp/smtp_test.go.html#7296140">err</a></span>&nbsp;<span class="op" id="7296250">!=</span>&nbsp;<span class="ident" id="7296253">nil</span>&nbsp;<span class="op" id="7296257">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296261"><a href="/net/smtp/smtp_test.go.html#7296106">t</a></span><span class="op" id="7296262">.</span><span class="ident" id="7296263">Fatal</span><span class="op" id="7296268">(</span><span class="ident" id="7296269"><a href="/net/smtp/smtp_test.go.html#7296140">err</a></span><span class="op" id="7296272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7296275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7296278">return</span>&nbsp;<span class="ident" id="7296285"><a href="/net/smtp/smtp_test.go.html#7296136">ln</a></span><br>
<span class="lineno"></span><span class="op" id="7296288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="keyword" id="7296291">type</span>&nbsp;<span class="ident" id="7296296">smtpSender</span>&nbsp;<span class="keyword" id="7296307">struct</span>&nbsp;<span class="op" id="7296314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296317">w</span>&nbsp;<span class="ident" id="7296319"><a href="/net/smtp/smtp_test.go.html#7282788">io</a></span><span class="op" id="7296321">.</span><span class="ident" id="7296322">Writer</span><br>
<span class="lineno"></span><span class="op" id="7296329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7296332">func</span>&nbsp;<span class="op" id="7296337">(</span><span class="ident" id="7296338">s</span>&nbsp;<span class="ident" id="7296340"><a href="/net/smtp/smtp_test.go.html#7296296">smtpSender</a></span><span class="op" id="7296350">)</span>&nbsp;<span class="ident" id="7296352">send</span><span class="op" id="7296356">(</span><span class="ident" id="7296357">f</span>&nbsp;<span class="builtintype" id="7296359">string</span><span class="op" id="7296365">)</span>&nbsp;<span class="op" id="7296367">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296370"><a href="/net/smtp/smtp_test.go.html#7296338">s</a></span><span class="op" id="7296371">.</span><span class="ident" id="7296372">w</span><span class="op" id="7296373">.</span><span class="ident" id="7296374">Write</span><span class="op" id="7296379">(</span><span class="op" id="7296380">[</span><span class="op" id="7296381">]</span><span class="builtintype" id="7296382">byte</span><span class="op" id="7296386">(</span><span class="ident" id="7296387"><a href="/net/smtp/smtp_test.go.html#7296357">f</a></span>&nbsp;<span class="op" id="7296389">+</span>&nbsp;<span class="string" id="7296391">&#34;\r\n&#34;</span><span class="op" id="7296397">)</span><span class="op" id="7296398">)</span><br>
<span class="lineno"></span><span class="op" id="7296400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7296403">//&nbsp;smtp&nbsp;server,&nbsp;finely&nbsp;tailored&nbsp;to&nbsp;deal&nbsp;with&nbsp;our&nbsp;own&nbsp;client&nbsp;only!</span><br>
<span class="lineno"></span><span class="keyword" id="7296469">func</span>&nbsp;<span class="ident" id="7296474">serverHandle</span><span class="op" id="7296486">(</span><span class="ident" id="7296487">c</span>&nbsp;<span class="ident" id="7296489"><a href="/net/smtp/smtp_test.go.html#7282794">net</a></span><span class="op" id="7296492">.</span><span class="ident" id="7296493">Conn</span><span class="op" id="7296497">,</span>&nbsp;<span class="ident" id="7296499">t</span>&nbsp;<span class="op" id="7296501">*</span><span class="ident" id="7296502"><a href="/net/smtp/smtp_test.go.html#7282829">testing</a></span><span class="op" id="7296509">.</span><span class="ident" id="7296510">T</span><span class="op" id="7296511">)</span>&nbsp;<span class="builtintype" id="7296513">error</span>&nbsp;<span class="op" id="7296519">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296522">send</span>&nbsp;<span class="op" id="7296527">:=</span>&nbsp;<span class="ident" id="7296530"><a href="/net/smtp/smtp_test.go.html#7296296">smtpSender</a></span><span class="op" id="7296540">{</span><span class="ident" id="7296541"><a href="/net/smtp/smtp_test.go.html#7296487">c</a></span><span class="op" id="7296542">}</span><span class="op" id="7296543">.</span><span class="ident" id="7296544">send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296550"><a href="/net/smtp/smtp_test.go.html#7296522">send</a></span><span class="op" id="7296554">(</span><span class="string" id="7296555">&#34;220&nbsp;127.0.0.1&nbsp;ESMTP&nbsp;service&nbsp;ready&#34;</span><span class="op" id="7296590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296593">s</span>&nbsp;<span class="op" id="7296595">:=</span>&nbsp;<span class="ident" id="7296598"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7296603">.</span><span class="ident" id="7296604">NewScanner</span><span class="op" id="7296614">(</span><span class="ident" id="7296615"><a href="/net/smtp/smtp_test.go.html#7296487">c</a></span><span class="op" id="7296616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7296619">for</span>&nbsp;<span class="ident" id="7296623"><a href="/net/smtp/smtp_test.go.html#7296593">s</a></span><span class="op" id="7296624">.</span><span class="ident" id="7296625">Scan</span><span class="op" id="7296629">(</span><span class="op" id="7296630">)</span>&nbsp;<span class="op" id="7296632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7296636">switch</span>&nbsp;<span class="ident" id="7296643"><a href="/net/smtp/smtp_test.go.html#7296593">s</a></span><span class="op" id="7296644">.</span><span class="ident" id="7296645">Text</span><span class="op" id="7296649">(</span><span class="op" id="7296650">)</span>&nbsp;<span class="op" id="7296652">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7296656">case</span>&nbsp;<span class="string" id="7296661">&#34;EHLO&nbsp;localhost&#34;</span><span class="op" id="7296677">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296682"><a href="/net/smtp/smtp_test.go.html#7296522">send</a></span><span class="op" id="7296686">(</span><span class="string" id="7296687">&#34;250-127.0.0.1&nbsp;ESMTP&nbsp;offers&nbsp;a&nbsp;warm&nbsp;hug&nbsp;of&nbsp;welcome&#34;</span><span class="op" id="7296737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296742"><a href="/net/smtp/smtp_test.go.html#7296522">send</a></span><span class="op" id="7296746">(</span><span class="string" id="7296747">&#34;250-STARTTLS&#34;</span><span class="op" id="7296761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296766"><a href="/net/smtp/smtp_test.go.html#7296522">send</a></span><span class="op" id="7296770">(</span><span class="string" id="7296771">&#34;250&nbsp;Ok&#34;</span><span class="op" id="7296779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7296783">case</span>&nbsp;<span class="string" id="7296788">&#34;STARTTLS&#34;</span><span class="op" id="7296798">:</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296803"><a href="/net/smtp/smtp_test.go.html#7296522">send</a></span><span class="op" id="7296807">(</span><span class="string" id="7296808">&#34;220&nbsp;Go&nbsp;ahead&#34;</span><span class="op" id="7296822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296827">keypair</span><span class="op" id="7296834">,</span>&nbsp;<span class="ident" id="7296836">err</span>&nbsp;<span class="op" id="7296840">:=</span>&nbsp;<span class="ident" id="7296843"><a href="/net/smtp/smtp_test.go.html#7282759">tls</a></span><span class="op" id="7296846">.</span><span class="ident" id="7296847">X509KeyPair</span><span class="op" id="7296858">(</span><span class="ident" id="7296859"><a href="/net/smtp/smtp_test.go.html#7298629">localhostCert</a></span><span class="op" id="7296872">,</span>&nbsp;<span class="ident" id="7296874"><a href="/net/smtp/smtp_test.go.html#7299284">localhostKey</a></span><span class="op" id="7296886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7296891">if</span>&nbsp;<span class="ident" id="7296894"><a href="/net/smtp/smtp_test.go.html#7296836">err</a></span>&nbsp;<span class="op" id="7296898">!=</span>&nbsp;<span class="ident" id="7296901">nil</span>&nbsp;<span class="op" id="7296905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7296911">return</span>&nbsp;<span class="ident" id="7296918"><a href="/net/smtp/smtp_test.go.html#7296836">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7296925">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296930">config</span>&nbsp;<span class="op" id="7296937">:=</span>&nbsp;<span class="op" id="7296940">&amp;</span><span class="ident" id="7296941"><a href="/net/smtp/smtp_test.go.html#7282759">tls</a></span><span class="op" id="7296944">.</span><span class="ident" id="7296945">Config</span><span class="op" id="7296951">{</span><span class="ident" id="7296952">Certificates</span><span class="op" id="7296964">:</span>&nbsp;<span class="op" id="7296966">[</span><span class="op" id="7296967">]</span><span class="ident" id="7296968"><a href="/net/smtp/smtp_test.go.html#7282759">tls</a></span><span class="op" id="7296971">.</span><span class="ident" id="7296972">Certificate</span><span class="op" id="7296983">{</span><span class="ident" id="7296984"><a href="/net/smtp/smtp_test.go.html#7296827">keypair</a></span><span class="op" id="7296991">}</span><span class="op" id="7296992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296997"><a href="/net/smtp/smtp_test.go.html#7296487">c</a></span>&nbsp;<span class="op" id="7296999">=</span>&nbsp;<span class="ident" id="7297001"><a href="/net/smtp/smtp_test.go.html#7282759">tls</a></span><span class="op" id="7297004">.</span><span class="ident" id="7297005">Server</span><span class="op" id="7297011">(</span><span class="ident" id="7297012"><a href="/net/smtp/smtp_test.go.html#7296487">c</a></span><span class="op" id="7297013">,</span>&nbsp;<span class="ident" id="7297015"><a href="/net/smtp/smtp_test.go.html#7296930">config</a></span><span class="op" id="7297021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297026">defer</span>&nbsp;<span class="ident" id="7297032"><a href="/net/smtp/smtp_test.go.html#7296487">c</a></span><span class="op" id="7297033">.</span><span class="ident" id="7297034">Close</span><span class="op" id="7297039">(</span><span class="op" id="7297040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297045">return</span>&nbsp;<span class="ident" id="7297052"><a href="/net/smtp/smtp_test.go.html#7297166">serverHandleTLS</a></span><span class="op" id="7297067">(</span><span class="ident" id="7297068"><a href="/net/smtp/smtp_test.go.html#7296487">c</a></span><span class="op" id="7297069">,</span>&nbsp;<span class="ident" id="7297071"><a href="/net/smtp/smtp_test.go.html#7296499">t</a></span><span class="op" id="7297072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297076">default</span><span class="op" id="7297083">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297088"><a href="/net/smtp/smtp_test.go.html#7296499">t</a></span><span class="op" id="7297089">.</span><span class="ident" id="7297090">Fatalf</span><span class="op" id="7297096">(</span><span class="string" id="7297097">&#34;unrecognized&nbsp;command:&nbsp;%q&#34;</span><span class="op" id="7297123">,</span>&nbsp;<span class="ident" id="7297125"><a href="/net/smtp/smtp_test.go.html#7296593">s</a></span><span class="op" id="7297126">.</span><span class="ident" id="7297127">Text</span><span class="op" id="7297131">(</span><span class="op" id="7297132">)</span><span class="op" id="7297133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7297137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7297140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297143">return</span>&nbsp;<span class="ident" id="7297150"><a href="/net/smtp/smtp_test.go.html#7296593">s</a></span><span class="op" id="7297151">.</span><span class="ident" id="7297152">Err</span><span class="op" id="7297155">(</span><span class="op" id="7297156">)</span><br>
<span class="lineno"></span><span class="op" id="7297158">}</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span><span class="keyword" id="7297161">func</span>&nbsp;<span class="ident" id="7297166">serverHandleTLS</span><span class="op" id="7297181">(</span><span class="ident" id="7297182">c</span>&nbsp;<span class="ident" id="7297184"><a href="/net/smtp/smtp_test.go.html#7282794">net</a></span><span class="op" id="7297187">.</span><span class="ident" id="7297188">Conn</span><span class="op" id="7297192">,</span>&nbsp;<span class="ident" id="7297194">t</span>&nbsp;<span class="op" id="7297196">*</span><span class="ident" id="7297197"><a href="/net/smtp/smtp_test.go.html#7282829">testing</a></span><span class="op" id="7297204">.</span><span class="ident" id="7297205">T</span><span class="op" id="7297206">)</span>&nbsp;<span class="builtintype" id="7297208">error</span>&nbsp;<span class="op" id="7297214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297217">send</span>&nbsp;<span class="op" id="7297222">:=</span>&nbsp;<span class="ident" id="7297225"><a href="/net/smtp/smtp_test.go.html#7296296">smtpSender</a></span><span class="op" id="7297235">{</span><span class="ident" id="7297236"><a href="/net/smtp/smtp_test.go.html#7297182">c</a></span><span class="op" id="7297237">}</span><span class="op" id="7297238">.</span><span class="ident" id="7297239">send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297245">s</span>&nbsp;<span class="op" id="7297247">:=</span>&nbsp;<span class="ident" id="7297250"><a href="/net/smtp/smtp_test.go.html#7282741">bufio</a></span><span class="op" id="7297255">.</span><span class="ident" id="7297256">NewScanner</span><span class="op" id="7297266">(</span><span class="ident" id="7297267"><a href="/net/smtp/smtp_test.go.html#7297182">c</a></span><span class="op" id="7297268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297271">for</span>&nbsp;<span class="ident" id="7297275"><a href="/net/smtp/smtp_test.go.html#7297245">s</a></span><span class="op" id="7297276">.</span><span class="ident" id="7297277">Scan</span><span class="op" id="7297281">(</span><span class="op" id="7297282">)</span>&nbsp;<span class="op" id="7297284">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297288">switch</span>&nbsp;<span class="ident" id="7297295"><a href="/net/smtp/smtp_test.go.html#7297245">s</a></span><span class="op" id="7297296">.</span><span class="ident" id="7297297">Text</span><span class="op" id="7297301">(</span><span class="op" id="7297302">)</span>&nbsp;<span class="op" id="7297304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297308">case</span>&nbsp;<span class="string" id="7297313">&#34;EHLO&nbsp;localhost&#34;</span><span class="op" id="7297329">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297334"><a href="/net/smtp/smtp_test.go.html#7297217">send</a></span><span class="op" id="7297338">(</span><span class="string" id="7297339">&#34;250&nbsp;Ok&#34;</span><span class="op" id="7297347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297351">case</span>&nbsp;<span class="string" id="7297356">&#34;MAIL&nbsp;FROM:&lt;joe1@example.com&gt;&#34;</span><span class="op" id="7297386">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297391"><a href="/net/smtp/smtp_test.go.html#7297217">send</a></span><span class="op" id="7297395">(</span><span class="string" id="7297396">&#34;250&nbsp;Ok&#34;</span><span class="op" id="7297404">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297408">case</span>&nbsp;<span class="string" id="7297413">&#34;RCPT&nbsp;TO:&lt;joe2@example.com&gt;&#34;</span><span class="op" id="7297441">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297446"><a href="/net/smtp/smtp_test.go.html#7297217">send</a></span><span class="op" id="7297450">(</span><span class="string" id="7297451">&#34;250&nbsp;Ok&#34;</span><span class="op" id="7297459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297463">case</span>&nbsp;<span class="string" id="7297468">&#34;DATA&#34;</span><span class="op" id="7297474">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297479"><a href="/net/smtp/smtp_test.go.html#7297217">send</a></span><span class="op" id="7297483">(</span><span class="string" id="7297484">&#34;354&nbsp;send&nbsp;the&nbsp;mail&nbsp;data,&nbsp;end&nbsp;with&nbsp;.&#34;</span><span class="op" id="7297520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297525"><a href="/net/smtp/smtp_test.go.html#7297217">send</a></span><span class="op" id="7297529">(</span><span class="string" id="7297530">&#34;250&nbsp;Ok&#34;</span><span class="op" id="7297538">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297542">case</span>&nbsp;<span class="string" id="7297547">&#34;Subject:&nbsp;test&#34;</span><span class="op" id="7297562">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297566">case</span>&nbsp;<span class="string" id="7297571">&#34;&#34;</span><span class="op" id="7297573">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297577">case</span>&nbsp;<span class="string" id="7297582">&#34;howdy!&#34;</span><span class="op" id="7297590">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297594">case</span>&nbsp;<span class="string" id="7297599">&#34;.&#34;</span><span class="op" id="7297602">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297606">case</span>&nbsp;<span class="string" id="7297611">&#34;QUIT&#34;</span><span class="op" id="7297617">:</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297622"><a href="/net/smtp/smtp_test.go.html#7297217">send</a></span><span class="op" id="7297626">(</span><span class="string" id="7297627">&#34;221&nbsp;127.0.0.1&nbsp;Service&nbsp;closing&nbsp;transmission&nbsp;channel&#34;</span><span class="op" id="7297679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297684">return</span>&nbsp;<span class="ident" id="7297691">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297697">default</span><span class="op" id="7297704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297709"><a href="/net/smtp/smtp_test.go.html#7297194">t</a></span><span class="op" id="7297710">.</span><span class="ident" id="7297711">Fatalf</span><span class="op" id="7297717">(</span><span class="string" id="7297718">&#34;unrecognized&nbsp;command&nbsp;during&nbsp;TLS:&nbsp;%q&#34;</span><span class="op" id="7297755">,</span>&nbsp;<span class="ident" id="7297757"><a href="/net/smtp/smtp_test.go.html#7297245">s</a></span><span class="op" id="7297758">.</span><span class="ident" id="7297759">Text</span><span class="op" id="7297763">(</span><span class="op" id="7297764">)</span><span class="op" id="7297765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7297769">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7297772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297775">return</span>&nbsp;<span class="ident" id="7297782"><a href="/net/smtp/smtp_test.go.html#7297245">s</a></span><span class="op" id="7297783">.</span><span class="ident" id="7297784">Err</span><span class="op" id="7297787">(</span><span class="op" id="7297788">)</span><br>
<span class="lineno"></span><span class="op" id="7297790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7297793">func</span>&nbsp;<span class="ident" id="7297798">init</span><span class="op" id="7297802">(</span><span class="op" id="7297803">)</span>&nbsp;<span class="op" id="7297805">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297808">testRootCAs</span>&nbsp;<span class="op" id="7297820">:=</span>&nbsp;<span class="ident" id="7297823"><a href="/net/smtp/smtp_test.go.html#7282773">x509</a></span><span class="op" id="7297827">.</span><span class="ident" id="7297828">NewCertPool</span><span class="op" id="7297839">(</span><span class="op" id="7297840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297843"><a href="/net/smtp/smtp_test.go.html#7297808">testRootCAs</a></span><span class="op" id="7297854">.</span><span class="ident" id="7297855">AppendCertsFromPEM</span><span class="op" id="7297873">(</span><span class="ident" id="7297874"><a href="/net/smtp/smtp_test.go.html#7298629">localhostCert</a></span><span class="op" id="7297887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297890"><a href="/net/smtp/smtp.go.html#5193243">testHookStartTLS</a></span>&nbsp;<span class="op" id="7297907">=</span>&nbsp;<span class="keyword" id="7297909">func</span><span class="op" id="7297913">(</span><span class="ident" id="7297914">config</span>&nbsp;<span class="op" id="7297921">*</span><span class="ident" id="7297922"><a href="/net/smtp/smtp_test.go.html#7282759">tls</a></span><span class="op" id="7297925">.</span><span class="ident" id="7297926">Config</span><span class="op" id="7297932">)</span>&nbsp;<span class="op" id="7297934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297938"><a href="/net/smtp/smtp_test.go.html#7297914">config</a></span><span class="op" id="7297944">.</span><span class="ident" id="7297945">RootCAs</span>&nbsp;<span class="op" id="7297953">=</span>&nbsp;<span class="ident" id="7297955"><a href="/net/smtp/smtp_test.go.html#7297808">testRootCAs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7297968">}</span><br>
<span class="lineno">655</span><span class="op" id="7297970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7297973">func</span>&nbsp;<span class="ident" id="7297978">sendMail</span><span class="op" id="7297986">(</span><span class="ident" id="7297987">hostPort</span>&nbsp;<span class="builtintype" id="7297996">string</span><span class="op" id="7298002">)</span>&nbsp;<span class="builtintype" id="7298004">error</span>&nbsp;<span class="op" id="7298010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7298013">host</span><span class="op" id="7298017">,</span>&nbsp;<span class="ident" id="7298019">_</span><span class="op" id="7298020">,</span>&nbsp;<span class="ident" id="7298022">err</span>&nbsp;<span class="op" id="7298026">:=</span>&nbsp;<span class="ident" id="7298029"><a href="/net/smtp/smtp_test.go.html#7282794">net</a></span><span class="op" id="7298032">.</span><span class="ident" id="7298033">SplitHostPort</span><span class="op" id="7298046">(</span><span class="ident" id="7298047"><a href="/net/smtp/smtp_test.go.html#7297987">hostPort</a></span><span class="op" id="7298055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7298058">if</span>&nbsp;<span class="ident" id="7298061"><a href="/net/smtp/smtp_test.go.html#7298022">err</a></span>&nbsp;<span class="op" id="7298065">!=</span>&nbsp;<span class="ident" id="7298068">nil</span>&nbsp;<span class="op" id="7298072">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7298076">return</span>&nbsp;<span class="ident" id="7298083"><a href="/net/smtp/smtp_test.go.html#7298022">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7298088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7298091">auth</span>&nbsp;<span class="op" id="7298096">:=</span>&nbsp;<span class="ident" id="7298099"><a href="/net/smtp/auth.go.html#5184343">PlainAuth</a></span><span class="op" id="7298108">(</span><span class="string" id="7298109">&#34;&#34;</span><span class="op" id="7298111">,</span>&nbsp;<span class="string" id="7298113">&#34;&#34;</span><span class="op" id="7298115">,</span>&nbsp;<span class="string" id="7298117">&#34;&#34;</span><span class="op" id="7298119">,</span>&nbsp;<span class="ident" id="7298121"><a href="/net/smtp/smtp_test.go.html#7298013">host</a></span><span class="op" id="7298125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7298128">from</span>&nbsp;<span class="op" id="7298133">:=</span>&nbsp;<span class="string" id="7298136">&#34;joe1@example.com&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7298156">to</span>&nbsp;<span class="op" id="7298159">:=</span>&nbsp;<span class="op" id="7298162">[</span><span class="op" id="7298163">]</span><span class="builtintype" id="7298164">string</span><span class="op" id="7298170">{</span><span class="string" id="7298171">&#34;joe2@example.com&#34;</span><span class="op" id="7298189">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7298192">return</span>&nbsp;<span class="ident" id="7298199"><a href="/net/smtp/smtp.go.html#5193526">SendMail</a></span><span class="op" id="7298207">(</span><span class="ident" id="7298208"><a href="/net/smtp/smtp_test.go.html#7297987">hostPort</a></span><span class="op" id="7298216">,</span>&nbsp;<span class="ident" id="7298218"><a href="/net/smtp/smtp_test.go.html#7298091">auth</a></span><span class="op" id="7298222">,</span>&nbsp;<span class="ident" id="7298224"><a href="/net/smtp/smtp_test.go.html#7298128">from</a></span><span class="op" id="7298228">,</span>&nbsp;<span class="ident" id="7298230"><a href="/net/smtp/smtp_test.go.html#7298156">to</a></span><span class="op" id="7298232">,</span>&nbsp;<span class="op" id="7298234">[</span><span class="op" id="7298235">]</span><span class="builtintype" id="7298236">byte</span><span class="op" id="7298240">(</span><span class="string" id="7298241">&#34;Subject:&nbsp;test\n\nhowdy!&#34;</span><span class="op" id="7298266">)</span><span class="op" id="7298267">)</span><br>
<span class="lineno"></span><span class="op" id="7298269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7298272">//&nbsp;(copied&nbsp;from&nbsp;net/http/httptest)</span><br>
<span class="lineno"></span><span class="comment" id="7298307">//&nbsp;localhostCert&nbsp;is&nbsp;a&nbsp;PEM-encoded&nbsp;TLS&nbsp;cert&nbsp;with&nbsp;SAN&nbsp;IPs</span><br>
<span class="lineno">670</span><span class="comment" id="7298363">//&nbsp;&#34;127.0.0.1&#34;&nbsp;and&nbsp;&#34;[::1]&#34;,&nbsp;expiring&nbsp;at&nbsp;the&nbsp;last&nbsp;second&nbsp;of&nbsp;2049&nbsp;(the&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="7298436">//&nbsp;of&nbsp;ASN.1&nbsp;time).</span><br>
<span class="lineno"></span><span class="comment" id="7298455">//&nbsp;generated&nbsp;from&nbsp;src/crypto/tls:</span><br>
<span class="lineno"></span><span class="comment" id="7298489">//&nbsp;go&nbsp;run&nbsp;generate_cert.go&nbsp;&nbsp;--rsa-bits&nbsp;512&nbsp;--host&nbsp;127.0.0.1,::1,example.com&nbsp;--ca&nbsp;--start-date&nbsp;&#34;Jan&nbsp;1&nbsp;00:00:00&nbsp;1970&#34;&nbsp;--duration=1000000h</span><br>
<span class="lineno"></span><span class="keyword" id="7298625">var</span>&nbsp;<span class="ident" id="7298629">localhostCert</span>&nbsp;<span class="op" id="7298643">=</span>&nbsp;<span class="op" id="7298645">[</span><span class="op" id="7298646">]</span><span class="builtintype" id="7298647">byte</span><span class="op" id="7298651">(</span><span class="string" id="7298652">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno">675</span>MIIBdzCCASOgAwIBAgIBADALBgkqhkiG9w0BAQUwEjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno"></span>bzAeFw03MDAxMDEwMDAwMDBaFw00OTEyMzEyMzU5NTlaMBIxEDAOBgNVBAoTB0Fj<br>
<span class="lineno"></span>bWUgQ28wWjALBgkqhkiG9w0BAQEDSwAwSAJBAN55NcYKZeInyTuhcCwFMhDHCmwa<br>
<span class="lineno"></span>IUSdtXdcbItRB/yfXGBhiex00IaLXQnSU+QZPRZWYqeTEbFSgihqi1PUDy8CAwEA<br>
<span class="lineno"></span>AaNoMGYwDgYDVR0PAQH/BAQDAgCkMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA8GA1Ud<br>
<span class="lineno">680</span>EwEB/wQFMAMBAf8wLgYDVR0RBCcwJYILZXhhbXBsZS5jb22HBH8AAAGHEAAAAAAA<br>
<span class="lineno"></span>AAAAAAAAAAAAAAEwCwYJKoZIhvcNAQEFA0EAAoQn/ytgqpiLcZu9XKbCJsJcvkgk<br>
<span class="lineno"></span>Se6AbGXgSlq+ZCEVo0qIwSgeBqmsJxUu7NCSOwVJLYNEBO2DtIxoYVk+MA==<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><span class="op" id="7299223">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span><span class="comment" id="7299226">//&nbsp;localhostKey&nbsp;is&nbsp;the&nbsp;private&nbsp;key&nbsp;for&nbsp;localhostCert.</span><br>
<span class="lineno"></span><span class="keyword" id="7299280">var</span>&nbsp;<span class="ident" id="7299284">localhostKey</span>&nbsp;<span class="op" id="7299297">=</span>&nbsp;<span class="op" id="7299299">[</span><span class="op" id="7299300">]</span><span class="builtintype" id="7299301">byte</span><span class="op" id="7299305">(</span><span class="string" id="7299306">`-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIIBPAIBAAJBAN55NcYKZeInyTuhcCwFMhDHCmwaIUSdtXdcbItRB/yfXGBhiex0<br>
<span class="lineno"></span>0IaLXQnSU+QZPRZWYqeTEbFSgihqi1PUDy8CAwEAAQJBAQdUx66rfh8sYsgfdcvV<br>
<span class="lineno"></span>NoafYpnEcB5s4m/vSVe6SU7dCK6eYec9f9wpT353ljhDUHq3EbmE4foNzJngh35d<br>
<span class="lineno">690</span>AekCIQDhRQG5Li0Wj8TM4obOnnXUXf1jRv0UkzE9AHWLG5q3AwIhAPzSjpYUDjVW<br>
<span class="lineno"></span>MCUXgckTpKCuGwbJk7424Nb8bLzf3kllAiA5mUBgjfr/WtFSJdWcPQ4Zt9KTMNKD<br>
<span class="lineno"></span>EUO0ukpTwEIl6wIhAMbGqZK3zAAFdq8DD2jPx+UJXnh0rnOkZBzDtJ6/iN69AiEA<br>
<span class="lineno"></span>1Aq8MJgTaYsDQWyU/hDq5YkDJc9e9DSCvUIzqxQWMQE=<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><span class="op" id="7299804">)</span>
</div>
</body>
</html>
