<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4640933">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4640988">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4641042">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4641093">package</span>&nbsp;<span class="ident" id="4641101">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4641111">import</span>&nbsp;<span class="op" id="4641118">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4641121">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4641130">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4641137">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4641147">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4641150">//&nbsp;urlFilter&nbsp;returns&nbsp;its&nbsp;input&nbsp;unless&nbsp;it&nbsp;contains&nbsp;an&nbsp;unsafe&nbsp;protocol&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="4641228">//&nbsp;case&nbsp;it&nbsp;defangs&nbsp;the&nbsp;entire&nbsp;URL.</span><br>
<span class="lineno">15</span><span class="keyword" id="4641263">func</span>&nbsp;<span class="ident" id="4641268">urlFilter</span><span class="op" id="4641277">(</span><span class="ident" id="4641278">args</span>&nbsp;<span class="op" id="4641283">...</span><span class="keyword" id="4641286">interface</span><span class="op" id="4641295">{</span><span class="op" id="4641296">}</span><span class="op" id="4641297">)</span>&nbsp;<span class="builtintype" id="4641299">string</span>&nbsp;<span class="op" id="4641306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641309">s</span><span class="op" id="4641310">,</span>&nbsp;<span class="ident" id="4641312">t</span>&nbsp;<span class="op" id="4641314">:=</span>&nbsp;<span class="ident" id="4641317">stringify</span><span class="op" id="4641326">(</span><span class="ident" id="4641327">args</span><span class="op" id="4641331">...</span><span class="op" id="4641334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641337">if</span>&nbsp;<span class="ident" id="4641340">t</span>&nbsp;<span class="op" id="4641342">==</span>&nbsp;<span class="ident" id="4641345">contentTypeURL</span>&nbsp;<span class="op" id="4641360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641364">return</span>&nbsp;<span class="ident" id="4641371">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4641374">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641377">if</span>&nbsp;<span class="ident" id="4641380">i</span>&nbsp;<span class="op" id="4641382">:=</span>&nbsp;<span class="ident" id="4641385">strings</span><span class="op" id="4641392">.</span><span class="ident" id="4641393">IndexRune</span><span class="op" id="4641402">(</span><span class="ident" id="4641403">s</span><span class="op" id="4641404">,</span>&nbsp;<span class="string" id="4641406">&#39;:&#39;</span><span class="op" id="4641409">)</span><span class="op" id="4641410">;</span>&nbsp;<span class="ident" id="4641412">i</span>&nbsp;<span class="op" id="4641414">&gt;=</span>&nbsp;<span class="num" id="4641417">0</span>&nbsp;<span class="op" id="4641419">&amp;&amp;</span>&nbsp;<span class="ident" id="4641422">strings</span><span class="op" id="4641429">.</span><span class="ident" id="4641430">IndexRune</span><span class="op" id="4641439">(</span><span class="ident" id="4641440">s</span><span class="op" id="4641441">[</span><span class="op" id="4641442">:</span><span class="ident" id="4641443">i</span><span class="op" id="4641444">]</span><span class="op" id="4641445">,</span>&nbsp;<span class="string" id="4641447">&#39;/&#39;</span><span class="op" id="4641450">)</span>&nbsp;<span class="op" id="4641452">&lt;</span>&nbsp;<span class="num" id="4641454">0</span>&nbsp;<span class="op" id="4641456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641460">protocol</span>&nbsp;<span class="op" id="4641469">:=</span>&nbsp;<span class="ident" id="4641472">strings</span><span class="op" id="4641479">.</span><span class="ident" id="4641480">ToLower</span><span class="op" id="4641487">(</span><span class="ident" id="4641488">s</span><span class="op" id="4641489">[</span><span class="op" id="4641490">:</span><span class="ident" id="4641491">i</span><span class="op" id="4641492">]</span><span class="op" id="4641493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641497">if</span>&nbsp;<span class="ident" id="4641500">protocol</span>&nbsp;<span class="op" id="4641509">!=</span>&nbsp;<span class="string" id="4641512">&#34;http&#34;</span>&nbsp;<span class="op" id="4641519">&amp;&amp;</span>&nbsp;<span class="ident" id="4641522">protocol</span>&nbsp;<span class="op" id="4641531">!=</span>&nbsp;<span class="string" id="4641534">&#34;https&#34;</span>&nbsp;<span class="op" id="4641542">&amp;&amp;</span>&nbsp;<span class="ident" id="4641545">protocol</span>&nbsp;<span class="op" id="4641554">!=</span>&nbsp;<span class="string" id="4641557">&#34;mailto&#34;</span>&nbsp;<span class="op" id="4641566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641571">return</span>&nbsp;<span class="string" id="4641578">&#34;#&#34;</span>&nbsp;<span class="op" id="4641582">+</span>&nbsp;<span class="ident" id="4641584">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4641601">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4641604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641607">return</span>&nbsp;<span class="ident" id="4641614">s</span><br>
<span class="lineno"></span><span class="op" id="4641616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4641619">//&nbsp;urlEscaper&nbsp;produces&nbsp;an&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno">30</span><span class="comment" id="4641689">//&nbsp;The&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;without&nbsp;further&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="keyword" id="4641766">func</span>&nbsp;<span class="ident" id="4641771">urlEscaper</span><span class="op" id="4641781">(</span><span class="ident" id="4641782">args</span>&nbsp;<span class="op" id="4641787">...</span><span class="keyword" id="4641790">interface</span><span class="op" id="4641799">{</span><span class="op" id="4641800">}</span><span class="op" id="4641801">)</span>&nbsp;<span class="builtintype" id="4641803">string</span>&nbsp;<span class="op" id="4641810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641813">return</span>&nbsp;<span class="ident" id="4641820">urlProcessor</span><span class="op" id="4641832">(</span><span class="builtintype" id="4641833">false</span><span class="op" id="4641838">,</span>&nbsp;<span class="ident" id="4641840">args</span><span class="op" id="4641844">...</span><span class="op" id="4641847">)</span><br>
<span class="lineno"></span><span class="op" id="4641849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4641852">//&nbsp;urlEscaper&nbsp;normalizes&nbsp;URL&nbsp;content&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;a&nbsp;quote-delimited</span><br>
<span class="lineno"></span><span class="comment" id="4641932">//&nbsp;string&nbsp;or&nbsp;parenthesis&nbsp;delimited&nbsp;url(...).</span><br>
<span class="lineno"></span><span class="comment" id="4641977">//&nbsp;The&nbsp;normalizer&nbsp;does&nbsp;not&nbsp;encode&nbsp;all&nbsp;HTML&nbsp;specials.&nbsp;Specifically,&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4642056">//&nbsp;encode&nbsp;&#39;&amp;&#39;&nbsp;so&nbsp;correct&nbsp;embedding&nbsp;in&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;requires&nbsp;escaping&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4642133">//&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;&#39;&amp;amp;&#39;.</span><br>
<span class="lineno">40</span><span class="keyword" id="4642152">func</span>&nbsp;<span class="ident" id="4642157">urlNormalizer</span><span class="op" id="4642170">(</span><span class="ident" id="4642171">args</span>&nbsp;<span class="op" id="4642176">...</span><span class="keyword" id="4642179">interface</span><span class="op" id="4642188">{</span><span class="op" id="4642189">}</span><span class="op" id="4642190">)</span>&nbsp;<span class="builtintype" id="4642192">string</span>&nbsp;<span class="op" id="4642199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4642202">return</span>&nbsp;<span class="ident" id="4642209">urlProcessor</span><span class="op" id="4642221">(</span><span class="builtintype" id="4642222">true</span><span class="op" id="4642226">,</span>&nbsp;<span class="ident" id="4642228">args</span><span class="op" id="4642232">...</span><span class="op" id="4642235">)</span><br>
<span class="lineno"></span><span class="op" id="4642237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4642240">//&nbsp;urlProcessor&nbsp;normalizes&nbsp;(when&nbsp;norm&nbsp;is&nbsp;true)&nbsp;or&nbsp;escapes&nbsp;its&nbsp;input&nbsp;to&nbsp;produce</span><br>
<span class="lineno">45</span><span class="comment" id="4642319">//&nbsp;a&nbsp;valid&nbsp;hierarchical&nbsp;or&nbsp;opaque&nbsp;URL&nbsp;part.</span><br>
<span class="lineno"></span><span class="keyword" id="4642363">func</span>&nbsp;<span class="ident" id="4642368">urlProcessor</span><span class="op" id="4642380">(</span><span class="ident" id="4642381">norm</span>&nbsp;<span class="builtintype" id="4642386">bool</span><span class="op" id="4642390">,</span>&nbsp;<span class="ident" id="4642392">args</span>&nbsp;<span class="op" id="4642397">...</span><span class="keyword" id="4642400">interface</span><span class="op" id="4642409">{</span><span class="op" id="4642410">}</span><span class="op" id="4642411">)</span>&nbsp;<span class="builtintype" id="4642413">string</span>&nbsp;<span class="op" id="4642420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642423">s</span><span class="op" id="4642424">,</span>&nbsp;<span class="ident" id="4642426">t</span>&nbsp;<span class="op" id="4642428">:=</span>&nbsp;<span class="ident" id="4642431">stringify</span><span class="op" id="4642440">(</span><span class="ident" id="4642441">args</span><span class="op" id="4642445">...</span><span class="op" id="4642448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4642451">if</span>&nbsp;<span class="ident" id="4642454">t</span>&nbsp;<span class="op" id="4642456">==</span>&nbsp;<span class="ident" id="4642459">contentTypeURL</span>&nbsp;<span class="op" id="4642474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642478">norm</span>&nbsp;<span class="op" id="4642483">=</span>&nbsp;<span class="builtintype" id="4642485">true</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4642491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4642494">var</span>&nbsp;<span class="ident" id="4642498">b</span>&nbsp;<span class="ident" id="4642500">bytes</span><span class="op" id="4642505">.</span><span class="ident" id="4642506">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642514">written</span>&nbsp;<span class="op" id="4642522">:=</span>&nbsp;<span class="num" id="4642525">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4642528">//&nbsp;The&nbsp;byte&nbsp;loop&nbsp;below&nbsp;assumes&nbsp;that&nbsp;all&nbsp;URLs&nbsp;use&nbsp;UTF-8&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4642591">//&nbsp;content-encoding.&nbsp;This&nbsp;is&nbsp;similar&nbsp;to&nbsp;the&nbsp;URI&nbsp;to&nbsp;IRI&nbsp;encoding&nbsp;scheme</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4642663">//&nbsp;defined&nbsp;in&nbsp;section&nbsp;3.1&nbsp;of&nbsp;&nbsp;RFC&nbsp;3987,&nbsp;and&nbsp;behaves&nbsp;the&nbsp;same&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4642732">//&nbsp;EcmaScript&nbsp;builtin&nbsp;encodeURIComponent.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4642775">//&nbsp;It&nbsp;should&nbsp;not&nbsp;cause&nbsp;any&nbsp;misencoding&nbsp;of&nbsp;URLs&nbsp;in&nbsp;pages&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4642837">//&nbsp;Content-type:&nbsp;text/html;charset=UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4642880">for</span>&nbsp;<span class="ident" id="4642884">i</span><span class="op" id="4642885">,</span>&nbsp;<span class="ident" id="4642887">n</span>&nbsp;<span class="op" id="4642889">:=</span>&nbsp;<span class="num" id="4642892">0</span><span class="op" id="4642893">,</span>&nbsp;<span class="builtinfunc" id="4642895">len</span><span class="op" id="4642898">(</span><span class="ident" id="4642899">s</span><span class="op" id="4642900">)</span><span class="op" id="4642901">;</span>&nbsp;<span class="ident" id="4642903">i</span>&nbsp;<span class="op" id="4642905">&lt;</span>&nbsp;<span class="ident" id="4642907">n</span><span class="op" id="4642908">;</span>&nbsp;<span class="ident" id="4642910">i</span><span class="op" id="4642911">++</span>&nbsp;<span class="op" id="4642914">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642918">c</span>&nbsp;<span class="op" id="4642920">:=</span>&nbsp;<span class="ident" id="4642923">s</span><span class="op" id="4642924">[</span><span class="ident" id="4642925">i</span><span class="op" id="4642926">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4642930">switch</span>&nbsp;<span class="ident" id="4642937">c</span>&nbsp;<span class="op" id="4642939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4642943">//&nbsp;Single&nbsp;quote&nbsp;and&nbsp;parens&nbsp;are&nbsp;sub-delims&nbsp;in&nbsp;RFC&nbsp;3986,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4643007">//&nbsp;escape&nbsp;them&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded&nbsp;in&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4643064">//&nbsp;quoted&nbsp;attributes&nbsp;and&nbsp;unquoted&nbsp;CSS&nbsp;url(...)&nbsp;constructs.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4643125">//&nbsp;Single&nbsp;quotes&nbsp;are&nbsp;reserved&nbsp;in&nbsp;URLs,&nbsp;but&nbsp;are&nbsp;only&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4643187">//&nbsp;the&nbsp;obsolete&nbsp;&#34;mark&#34;&nbsp;rule&nbsp;in&nbsp;an&nbsp;appendix&nbsp;in&nbsp;RFC&nbsp;3986</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4643244">//&nbsp;so&nbsp;can&nbsp;be&nbsp;safely&nbsp;encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643275">case</span>&nbsp;<span class="string" id="4643280">&#39;!&#39;</span><span class="op" id="4643283">,</span>&nbsp;<span class="string" id="4643285">&#39;#&#39;</span><span class="op" id="4643288">,</span>&nbsp;<span class="string" id="4643290">&#39;$&#39;</span><span class="op" id="4643293">,</span>&nbsp;<span class="string" id="4643295">&#39;&amp;&#39;</span><span class="op" id="4643298">,</span>&nbsp;<span class="string" id="4643300">&#39;*&#39;</span><span class="op" id="4643303">,</span>&nbsp;<span class="string" id="4643305">&#39;+&#39;</span><span class="op" id="4643308">,</span>&nbsp;<span class="string" id="4643310">&#39;,&#39;</span><span class="op" id="4643313">,</span>&nbsp;<span class="string" id="4643315">&#39;/&#39;</span><span class="op" id="4643318">,</span>&nbsp;<span class="string" id="4643320">&#39;:&#39;</span><span class="op" id="4643323">,</span>&nbsp;<span class="string" id="4643325">&#39;;&#39;</span><span class="op" id="4643328">,</span>&nbsp;<span class="string" id="4643330">&#39;=&#39;</span><span class="op" id="4643333">,</span>&nbsp;<span class="string" id="4643335">&#39;?&#39;</span><span class="op" id="4643338">,</span>&nbsp;<span class="string" id="4643340">&#39;@&#39;</span><span class="op" id="4643343">,</span>&nbsp;<span class="string" id="4643345">&#39;[&#39;</span><span class="op" id="4643348">,</span>&nbsp;<span class="string" id="4643350">&#39;]&#39;</span><span class="op" id="4643353">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643358">if</span>&nbsp;<span class="ident" id="4643361">norm</span>&nbsp;<span class="op" id="4643366">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643372">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4643384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4643388">//&nbsp;Unreserved&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986&nbsp;sec&nbsp;2.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4643434">//&nbsp;&#34;For&nbsp;consistency,&nbsp;percent-encoded&nbsp;octets&nbsp;in&nbsp;the&nbsp;ranges&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4643497">//&nbsp;ALPHA&nbsp;(%41-%5A&nbsp;and&nbsp;%61-%7A),&nbsp;DIGIT&nbsp;(%30-%39),&nbsp;hyphen&nbsp;(%2D),</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4643562">//&nbsp;period&nbsp;(%2E),&nbsp;underscore&nbsp;(%5F),&nbsp;or&nbsp;tilde&nbsp;(%7E)&nbsp;should&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4643628">//&nbsp;created&nbsp;by&nbsp;URI&nbsp;producers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643658">case</span>&nbsp;<span class="string" id="4643663">&#39;-&#39;</span><span class="op" id="4643666">,</span>&nbsp;<span class="string" id="4643668">&#39;.&#39;</span><span class="op" id="4643671">,</span>&nbsp;<span class="string" id="4643673">&#39;_&#39;</span><span class="op" id="4643676">,</span>&nbsp;<span class="string" id="4643678">&#39;~&#39;</span><span class="op" id="4643681">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643686">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643697">case</span>&nbsp;<span class="string" id="4643702">&#39;%&#39;</span><span class="op" id="4643705">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4643710">//&nbsp;When&nbsp;normalizing&nbsp;do&nbsp;not&nbsp;re-encode&nbsp;valid&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643765">if</span>&nbsp;<span class="ident" id="4643768">norm</span>&nbsp;<span class="op" id="4643773">&amp;&amp;</span>&nbsp;<span class="ident" id="4643776">i</span><span class="op" id="4643777">+</span><span class="num" id="4643778">2</span>&nbsp;<span class="op" id="4643780">&lt;</span>&nbsp;<span class="builtinfunc" id="4643782">len</span><span class="op" id="4643785">(</span><span class="ident" id="4643786">s</span><span class="op" id="4643787">)</span>&nbsp;<span class="op" id="4643789">&amp;&amp;</span>&nbsp;<span class="ident" id="4643792">isHex</span><span class="op" id="4643797">(</span><span class="ident" id="4643798">s</span><span class="op" id="4643799">[</span><span class="ident" id="4643800">i</span><span class="op" id="4643801">+</span><span class="num" id="4643802">1</span><span class="op" id="4643803">]</span><span class="op" id="4643804">)</span>&nbsp;<span class="op" id="4643806">&amp;&amp;</span>&nbsp;<span class="ident" id="4643809">isHex</span><span class="op" id="4643814">(</span><span class="ident" id="4643815">s</span><span class="op" id="4643816">[</span><span class="ident" id="4643817">i</span><span class="op" id="4643818">+</span><span class="num" id="4643819">2</span><span class="op" id="4643820">]</span><span class="op" id="4643821">)</span>&nbsp;<span class="op" id="4643823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643829">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4643841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643845">default</span><span class="op" id="4643852">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4643857">//&nbsp;Unreserved&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986&nbsp;sec&nbsp;2.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643904">if</span>&nbsp;<span class="string" id="4643907">&#39;a&#39;</span>&nbsp;<span class="op" id="4643911">&lt;=</span>&nbsp;<span class="ident" id="4643914">c</span>&nbsp;<span class="op" id="4643916">&amp;&amp;</span>&nbsp;<span class="ident" id="4643919">c</span>&nbsp;<span class="op" id="4643921">&lt;=</span>&nbsp;<span class="string" id="4643924">&#39;z&#39;</span>&nbsp;<span class="op" id="4643928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643934">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4643946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643951">if</span>&nbsp;<span class="string" id="4643954">&#39;A&#39;</span>&nbsp;<span class="op" id="4643958">&lt;=</span>&nbsp;<span class="ident" id="4643961">c</span>&nbsp;<span class="op" id="4643963">&amp;&amp;</span>&nbsp;<span class="ident" id="4643966">c</span>&nbsp;<span class="op" id="4643968">&lt;=</span>&nbsp;<span class="string" id="4643971">&#39;Z&#39;</span>&nbsp;<span class="op" id="4643975">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643981">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4643993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643998">if</span>&nbsp;<span class="string" id="4644001">&#39;0&#39;</span>&nbsp;<span class="op" id="4644005">&lt;=</span>&nbsp;<span class="ident" id="4644008">c</span>&nbsp;<span class="op" id="4644010">&amp;&amp;</span>&nbsp;<span class="ident" id="4644013">c</span>&nbsp;<span class="op" id="4644015">&lt;=</span>&nbsp;<span class="string" id="4644018">&#39;9&#39;</span>&nbsp;<span class="op" id="4644022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644028">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644040">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644048">b</span><span class="op" id="4644049">.</span><span class="ident" id="4644050">WriteString</span><span class="op" id="4644061">(</span><span class="ident" id="4644062">s</span><span class="op" id="4644063">[</span><span class="ident" id="4644064">written</span><span class="op" id="4644071">:</span><span class="ident" id="4644072">i</span><span class="op" id="4644073">]</span><span class="op" id="4644074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644078">fmt</span><span class="op" id="4644081">.</span><span class="ident" id="4644082">Fprintf</span><span class="op" id="4644089">(</span><span class="op" id="4644090">&amp;</span><span class="ident" id="4644091">b</span><span class="op" id="4644092">,</span>&nbsp;<span class="string" id="4644094">&#34;%%%02x&#34;</span><span class="op" id="4644102">,</span>&nbsp;<span class="ident" id="4644104">c</span><span class="op" id="4644105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644109">written</span>&nbsp;<span class="op" id="4644117">=</span>&nbsp;<span class="ident" id="4644119">i</span>&nbsp;<span class="op" id="4644121">+</span>&nbsp;<span class="num" id="4644123">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644126">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644129">if</span>&nbsp;<span class="ident" id="4644132">written</span>&nbsp;<span class="op" id="4644140">==</span>&nbsp;<span class="num" id="4644143">0</span>&nbsp;<span class="op" id="4644145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644149">return</span>&nbsp;<span class="ident" id="4644156">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4644159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4644162">b</span><span class="op" id="4644163">.</span><span class="ident" id="4644164">WriteString</span><span class="op" id="4644175">(</span><span class="ident" id="4644176">s</span><span class="op" id="4644177">[</span><span class="ident" id="4644178">written</span><span class="op" id="4644185">:</span><span class="op" id="4644186">]</span><span class="op" id="4644187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4644190">return</span>&nbsp;<span class="ident" id="4644197">b</span><span class="op" id="4644198">.</span><span class="ident" id="4644199">String</span><span class="op" id="4644205">(</span><span class="op" id="4644206">)</span><br>
<span class="lineno">105</span><span class="op" id="4644208">}</span>
</div>
</body>
</html>
