<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8343002">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8343057">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8343111">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8343162">//&nbsp;+build&nbsp;!windows,!nacl,!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8343195">package</span>&nbsp;<span class="ident" id="8343203">syslog</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8343211">import</span>&nbsp;<span class="op" id="8343218">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343221">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343230">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343237">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343243">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343256">&#34;log&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343263">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343270">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343276">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343284">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8343295">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="8343302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8343305">func</span>&nbsp;<span class="ident" id="8343310">runPktSyslog</span><span class="op" id="8343322">(</span><span class="ident" id="8343323">c</span>&nbsp;<span class="ident" id="8343325"><a href="/log/syslog/syslog_test.go.html#8343263">net</a></span><span class="op" id="8343328">.</span><span class="ident" id="8343329">PacketConn</span><span class="op" id="8343339">,</span>&nbsp;<span class="ident" id="8343341">done</span>&nbsp;<span class="keyword" id="8343346">chan</span><span class="op" id="8343350">&lt;-</span>&nbsp;<span class="builtintype" id="8343353">string</span><span class="op" id="8343359">)</span>&nbsp;<span class="op" id="8343361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343364">var</span>&nbsp;<span class="ident" id="8343368">buf</span>&nbsp;<span class="op" id="8343372">[</span><span class="num" id="8343373">4096</span><span class="op" id="8343377">]</span><span class="builtintype" id="8343378">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343384">var</span>&nbsp;<span class="ident" id="8343388">rcvd</span>&nbsp;<span class="builtintype" id="8343393">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343401">ct</span>&nbsp;<span class="op" id="8343404">:=</span>&nbsp;<span class="num" id="8343407">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343410">for</span>&nbsp;<span class="op" id="8343414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343418">var</span>&nbsp;<span class="ident" id="8343422">n</span>&nbsp;<span class="builtintype" id="8343424">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343430">var</span>&nbsp;<span class="ident" id="8343434">err</span>&nbsp;<span class="builtintype" id="8343438">error</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343447"><a href="/log/syslog/syslog_test.go.html#8343323">c</a></span><span class="op" id="8343448">.</span><span class="ident" id="8343449">SetReadDeadline</span><span class="op" id="8343464">(</span><span class="ident" id="8343465"><a href="/log/syslog/syslog_test.go.html#8343295">time</a></span><span class="op" id="8343469">.</span><span class="ident" id="8343470">Now</span><span class="op" id="8343473">(</span><span class="op" id="8343474">)</span><span class="op" id="8343475">.</span><span class="ident" id="8343476">Add</span><span class="op" id="8343479">(</span><span class="num" id="8343480">100</span>&nbsp;<span class="op" id="8343484">*</span>&nbsp;<span class="ident" id="8343486"><a href="/log/syslog/syslog_test.go.html#8343295">time</a></span><span class="op" id="8343490">.</span><span class="ident" id="8343491">Millisecond</span><span class="op" id="8343502">)</span><span class="op" id="8343503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343507"><a href="/log/syslog/syslog_test.go.html#8343422">n</a></span><span class="op" id="8343508">,</span>&nbsp;<span class="ident" id="8343510">_</span><span class="op" id="8343511">,</span>&nbsp;<span class="ident" id="8343513"><a href="/log/syslog/syslog_test.go.html#8343434">err</a></span>&nbsp;<span class="op" id="8343517">=</span>&nbsp;<span class="ident" id="8343519"><a href="/log/syslog/syslog_test.go.html#8343323">c</a></span><span class="op" id="8343520">.</span><span class="ident" id="8343521">ReadFrom</span><span class="op" id="8343529">(</span><span class="ident" id="8343530"><a href="/log/syslog/syslog_test.go.html#8343368">buf</a></span><span class="op" id="8343533">[</span><span class="op" id="8343534">:</span><span class="op" id="8343535">]</span><span class="op" id="8343536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343540"><a href="/log/syslog/syslog_test.go.html#8343388">rcvd</a></span>&nbsp;<span class="op" id="8343545">+=</span>&nbsp;<span class="builtintype" id="8343548">string</span><span class="op" id="8343554">(</span><span class="ident" id="8343555"><a href="/log/syslog/syslog_test.go.html#8343368">buf</a></span><span class="op" id="8343558">[</span><span class="op" id="8343559">:</span><span class="ident" id="8343560"><a href="/log/syslog/syslog_test.go.html#8343422">n</a></span><span class="op" id="8343561">]</span><span class="op" id="8343562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343566">if</span>&nbsp;<span class="ident" id="8343569"><a href="/log/syslog/syslog_test.go.html#8343434">err</a></span>&nbsp;<span class="op" id="8343573">!=</span>&nbsp;<span class="ident" id="8343576">nil</span>&nbsp;<span class="op" id="8343580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343585">if</span>&nbsp;<span class="ident" id="8343588">oe</span><span class="op" id="8343590">,</span>&nbsp;<span class="ident" id="8343592">ok</span>&nbsp;<span class="op" id="8343595">:=</span>&nbsp;<span class="ident" id="8343598"><a href="/log/syslog/syslog_test.go.html#8343434">err</a></span><span class="op" id="8343601">.</span><span class="op" id="8343602">(</span><span class="op" id="8343603">*</span><span class="ident" id="8343604"><a href="/log/syslog/syslog_test.go.html#8343263">net</a></span><span class="op" id="8343607">.</span><span class="ident" id="8343608">OpError</span><span class="op" id="8343615">)</span><span class="op" id="8343616">;</span>&nbsp;<span class="ident" id="8343618"><a href="/log/syslog/syslog_test.go.html#8343592">ok</a></span>&nbsp;<span class="op" id="8343621">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343627">if</span>&nbsp;<span class="ident" id="8343630"><a href="/log/syslog/syslog_test.go.html#8343401">ct</a></span>&nbsp;<span class="op" id="8343633">&lt;</span>&nbsp;<span class="num" id="8343635">3</span>&nbsp;<span class="op" id="8343637">&amp;&amp;</span>&nbsp;<span class="ident" id="8343640"><a href="/log/syslog/syslog_test.go.html#8343588">oe</a></span><span class="op" id="8343642">.</span><span class="ident" id="8343643">Temporary</span><span class="op" id="8343652">(</span><span class="op" id="8343653">)</span>&nbsp;<span class="op" id="8343655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343662"><a href="/log/syslog/syslog_test.go.html#8343401">ct</a></span><span class="op" id="8343664">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343672">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343690">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343695">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343709"><a href="/log/syslog/syslog_test.go.html#8343323">c</a></span><span class="op" id="8343710">.</span><span class="ident" id="8343711">Close</span><span class="op" id="8343716">(</span><span class="op" id="8343717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343720"><a href="/log/syslog/syslog_test.go.html#8343341">done</a></span>&nbsp;<span class="op" id="8343725">&lt;-</span>&nbsp;<span class="ident" id="8343728"><a href="/log/syslog/syslog_test.go.html#8343388">rcvd</a></span><br>
<span class="lineno">45</span><span class="op" id="8343733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8343736">var</span>&nbsp;<span class="ident" id="8343740">crashy</span>&nbsp;<span class="op" id="8343747">=</span>&nbsp;<span class="builtintype" id="8343749">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8343756">func</span>&nbsp;<span class="ident" id="8343761">runStreamSyslog</span><span class="op" id="8343776">(</span><span class="ident" id="8343777">l</span>&nbsp;<span class="ident" id="8343779"><a href="/log/syslog/syslog_test.go.html#8343263">net</a></span><span class="op" id="8343782">.</span><span class="ident" id="8343783">Listener</span><span class="op" id="8343791">,</span>&nbsp;<span class="ident" id="8343793">done</span>&nbsp;<span class="keyword" id="8343798">chan</span><span class="op" id="8343802">&lt;-</span>&nbsp;<span class="builtintype" id="8343805">string</span><span class="op" id="8343811">,</span>&nbsp;<span class="ident" id="8343813">wg</span>&nbsp;<span class="op" id="8343816">*</span><span class="ident" id="8343817"><a href="/log/syslog/syslog_test.go.html#8343276">sync</a></span><span class="op" id="8343821">.</span><span class="ident" id="8343822">WaitGroup</span><span class="op" id="8343831">)</span>&nbsp;<span class="op" id="8343833">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343836">for</span>&nbsp;<span class="op" id="8343840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343844">var</span>&nbsp;<span class="ident" id="8343848">c</span>&nbsp;<span class="ident" id="8343850"><a href="/log/syslog/syslog_test.go.html#8343263">net</a></span><span class="op" id="8343853">.</span><span class="ident" id="8343854">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343861">var</span>&nbsp;<span class="ident" id="8343865">err</span>&nbsp;<span class="builtintype" id="8343869">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343877">if</span>&nbsp;<span class="ident" id="8343880"><a href="/log/syslog/syslog_test.go.html#8343848">c</a></span><span class="op" id="8343881">,</span>&nbsp;<span class="ident" id="8343883"><a href="/log/syslog/syslog_test.go.html#8343865">err</a></span>&nbsp;<span class="op" id="8343887">=</span>&nbsp;<span class="ident" id="8343889"><a href="/log/syslog/syslog_test.go.html#8343777">l</a></span><span class="op" id="8343890">.</span><span class="ident" id="8343891">Accept</span><span class="op" id="8343897">(</span><span class="op" id="8343898">)</span><span class="op" id="8343899">;</span>&nbsp;<span class="ident" id="8343901"><a href="/log/syslog/syslog_test.go.html#8343865">err</a></span>&nbsp;<span class="op" id="8343905">!=</span>&nbsp;<span class="ident" id="8343908">nil</span>&nbsp;<span class="op" id="8343912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343917">return</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8343926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343930"><a href="/log/syslog/syslog_test.go.html#8343813">wg</a></span><span class="op" id="8343932">.</span><span class="ident" id="8343933">Add</span><span class="op" id="8343936">(</span><span class="num" id="8343937">1</span><span class="op" id="8343938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343942">go</span>&nbsp;<span class="keyword" id="8343945">func</span><span class="op" id="8343949">(</span><span class="ident" id="8343950">c</span>&nbsp;<span class="ident" id="8343952"><a href="/log/syslog/syslog_test.go.html#8343263">net</a></span><span class="op" id="8343955">.</span><span class="ident" id="8343956">Conn</span><span class="op" id="8343960">)</span>&nbsp;<span class="op" id="8343962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8343967">defer</span>&nbsp;<span class="ident" id="8343973"><a href="/log/syslog/syslog_test.go.html#8343813">wg</a></span><span class="op" id="8343975">.</span><span class="ident" id="8343976">Done</span><span class="op" id="8343980">(</span><span class="op" id="8343981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8343986"><a href="/log/syslog/syslog_test.go.html#8343950">c</a></span><span class="op" id="8343987">.</span><span class="ident" id="8343988">SetReadDeadline</span><span class="op" id="8344003">(</span><span class="ident" id="8344004"><a href="/log/syslog/syslog_test.go.html#8343295">time</a></span><span class="op" id="8344008">.</span><span class="ident" id="8344009">Now</span><span class="op" id="8344012">(</span><span class="op" id="8344013">)</span><span class="op" id="8344014">.</span><span class="ident" id="8344015">Add</span><span class="op" id="8344018">(</span><span class="num" id="8344019">5</span>&nbsp;<span class="op" id="8344021">*</span>&nbsp;<span class="ident" id="8344023"><a href="/log/syslog/syslog_test.go.html#8343295">time</a></span><span class="op" id="8344027">.</span><span class="ident" id="8344028">Second</span><span class="op" id="8344034">)</span><span class="op" id="8344035">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344040">b</span>&nbsp;<span class="op" id="8344042">:=</span>&nbsp;<span class="ident" id="8344045"><a href="/log/syslog/syslog_test.go.html#8343221">bufio</a></span><span class="op" id="8344050">.</span><span class="ident" id="8344051">NewReader</span><span class="op" id="8344060">(</span><span class="ident" id="8344061"><a href="/log/syslog/syslog_test.go.html#8343950">c</a></span><span class="op" id="8344062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344067">for</span>&nbsp;<span class="ident" id="8344071">ct</span>&nbsp;<span class="op" id="8344074">:=</span>&nbsp;<span class="num" id="8344077">1</span><span class="op" id="8344078">;</span>&nbsp;<span class="op" id="8344080">!</span><span class="ident" id="8344081"><a href="/log/syslog/syslog_test.go.html#8343740">crashy</a></span>&nbsp;<span class="op" id="8344088">||</span>&nbsp;<span class="ident" id="8344091"><a href="/log/syslog/syslog_test.go.html#8344071">ct</a></span><span class="op" id="8344093">&amp;</span><span class="num" id="8344094">7</span>&nbsp;<span class="op" id="8344096">!=</span>&nbsp;<span class="num" id="8344099">0</span><span class="op" id="8344100">;</span>&nbsp;<span class="ident" id="8344102"><a href="/log/syslog/syslog_test.go.html#8344071">ct</a></span><span class="op" id="8344104">++</span>&nbsp;<span class="op" id="8344107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344113">s</span><span class="op" id="8344114">,</span>&nbsp;<span class="ident" id="8344116">err</span>&nbsp;<span class="op" id="8344120">:=</span>&nbsp;<span class="ident" id="8344123"><a href="/log/syslog/syslog_test.go.html#8344040">b</a></span><span class="op" id="8344124">.</span><span class="ident" id="8344125">ReadString</span><span class="op" id="8344135">(</span><span class="string" id="8344136">&#39;\n&#39;</span><span class="op" id="8344140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344146">if</span>&nbsp;<span class="ident" id="8344149"><a href="/log/syslog/syslog_test.go.html#8344116">err</a></span>&nbsp;<span class="op" id="8344153">!=</span>&nbsp;<span class="ident" id="8344156">nil</span>&nbsp;<span class="op" id="8344160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344167">break</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344183"><a href="/log/syslog/syslog_test.go.html#8343793">done</a></span>&nbsp;<span class="op" id="8344188">&lt;-</span>&nbsp;<span class="ident" id="8344191"><a href="/log/syslog/syslog_test.go.html#8344113">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344201"><a href="/log/syslog/syslog_test.go.html#8343950">c</a></span><span class="op" id="8344202">.</span><span class="ident" id="8344203">Close</span><span class="op" id="8344208">(</span><span class="op" id="8344209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344213">}</span><span class="op" id="8344214">(</span><span class="ident" id="8344215"><a href="/log/syslog/syslog_test.go.html#8343848">c</a></span><span class="op" id="8344216">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344219">}</span><br>
<span class="lineno"></span><span class="op" id="8344221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8344224">func</span>&nbsp;<span class="ident" id="8344229">startServer</span><span class="op" id="8344240">(</span><span class="ident" id="8344241">n</span><span class="op" id="8344242">,</span>&nbsp;<span class="ident" id="8344244">la</span>&nbsp;<span class="builtintype" id="8344247">string</span><span class="op" id="8344253">,</span>&nbsp;<span class="ident" id="8344255">done</span>&nbsp;<span class="keyword" id="8344260">chan</span><span class="op" id="8344264">&lt;-</span>&nbsp;<span class="builtintype" id="8344267">string</span><span class="op" id="8344273">)</span>&nbsp;<span class="op" id="8344275">(</span><span class="ident" id="8344276">addr</span>&nbsp;<span class="builtintype" id="8344281">string</span><span class="op" id="8344287">,</span>&nbsp;<span class="ident" id="8344289">sock</span>&nbsp;<span class="ident" id="8344294"><a href="/log/syslog/syslog_test.go.html#8343237">io</a></span><span class="op" id="8344296">.</span><span class="ident" id="8344297">Closer</span><span class="op" id="8344303">,</span>&nbsp;<span class="ident" id="8344305">wg</span>&nbsp;<span class="op" id="8344308">*</span><span class="ident" id="8344309"><a href="/log/syslog/syslog_test.go.html#8343276">sync</a></span><span class="op" id="8344313">.</span><span class="ident" id="8344314">WaitGroup</span><span class="op" id="8344323">)</span>&nbsp;<span class="op" id="8344325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344328">if</span>&nbsp;<span class="ident" id="8344331"><a href="/log/syslog/syslog_test.go.html#8344241">n</a></span>&nbsp;<span class="op" id="8344333">==</span>&nbsp;<span class="string" id="8344336">&#34;udp&#34;</span>&nbsp;<span class="op" id="8344342">||</span>&nbsp;<span class="ident" id="8344345"><a href="/log/syslog/syslog_test.go.html#8344241">n</a></span>&nbsp;<span class="op" id="8344347">==</span>&nbsp;<span class="string" id="8344350">&#34;tcp&#34;</span>&nbsp;<span class="op" id="8344356">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344360"><a href="/log/syslog/syslog_test.go.html#8344244">la</a></span>&nbsp;<span class="op" id="8344363">=</span>&nbsp;<span class="string" id="8344365">&#34;127.0.0.1:0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344380">}</span>&nbsp;<span class="keyword" id="8344382">else</span>&nbsp;<span class="op" id="8344387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8344391">//&nbsp;unix&nbsp;and&nbsp;unixgram:&nbsp;choose&nbsp;an&nbsp;address&nbsp;if&nbsp;none&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344447">if</span>&nbsp;<span class="ident" id="8344450"><a href="/log/syslog/syslog_test.go.html#8344244">la</a></span>&nbsp;<span class="op" id="8344453">==</span>&nbsp;<span class="string" id="8344456">&#34;&#34;</span>&nbsp;<span class="op" id="8344459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8344464">//&nbsp;use&nbsp;ioutil.TempFile&nbsp;to&nbsp;get&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;unique</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344519">f</span><span class="op" id="8344520">,</span>&nbsp;<span class="ident" id="8344522">err</span>&nbsp;<span class="op" id="8344526">:=</span>&nbsp;<span class="ident" id="8344529"><a href="/log/syslog/syslog_test.go.html#8343243">ioutil</a></span><span class="op" id="8344535">.</span><span class="ident" id="8344536">TempFile</span><span class="op" id="8344544">(</span><span class="string" id="8344545">&#34;&#34;</span><span class="op" id="8344547">,</span>&nbsp;<span class="string" id="8344549">&#34;syslogtest&#34;</span><span class="op" id="8344561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344566">if</span>&nbsp;<span class="ident" id="8344569"><a href="/log/syslog/syslog_test.go.html#8344522">err</a></span>&nbsp;<span class="op" id="8344573">!=</span>&nbsp;<span class="ident" id="8344576">nil</span>&nbsp;<span class="op" id="8344580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344586"><a href="/log/syslog/syslog_test.go.html#8343256">log</a></span><span class="op" id="8344589">.</span><span class="ident" id="8344590">Fatal</span><span class="op" id="8344595">(</span><span class="string" id="8344596">&#34;TempFile:&nbsp;&#34;</span><span class="op" id="8344608">,</span>&nbsp;<span class="ident" id="8344610"><a href="/log/syslog/syslog_test.go.html#8344522">err</a></span><span class="op" id="8344613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344623"><a href="/log/syslog/syslog_test.go.html#8344519">f</a></span><span class="op" id="8344624">.</span><span class="ident" id="8344625">Close</span><span class="op" id="8344630">(</span><span class="op" id="8344631">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344636"><a href="/log/syslog/syslog_test.go.html#8344244">la</a></span>&nbsp;<span class="op" id="8344639">=</span>&nbsp;<span class="ident" id="8344641"><a href="/log/syslog/syslog_test.go.html#8344519">f</a></span><span class="op" id="8344642">.</span><span class="ident" id="8344643">Name</span><span class="op" id="8344647">(</span><span class="op" id="8344648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344656"><a href="/log/syslog/syslog_test.go.html#8343270">os</a></span><span class="op" id="8344658">.</span><span class="ident" id="8344659">Remove</span><span class="op" id="8344665">(</span><span class="ident" id="8344666"><a href="/log/syslog/syslog_test.go.html#8344244">la</a></span><span class="op" id="8344668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344675"><a href="/log/syslog/syslog_test.go.html#8344305">wg</a></span>&nbsp;<span class="op" id="8344678">=</span>&nbsp;<span class="builtinfunc" id="8344680">new</span><span class="op" id="8344683">(</span><span class="ident" id="8344684"><a href="/log/syslog/syslog_test.go.html#8343276">sync</a></span><span class="op" id="8344688">.</span><span class="ident" id="8344689">WaitGroup</span><span class="op" id="8344698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344701">if</span>&nbsp;<span class="ident" id="8344704"><a href="/log/syslog/syslog_test.go.html#8344241">n</a></span>&nbsp;<span class="op" id="8344706">==</span>&nbsp;<span class="string" id="8344709">&#34;udp&#34;</span>&nbsp;<span class="op" id="8344715">||</span>&nbsp;<span class="ident" id="8344718"><a href="/log/syslog/syslog_test.go.html#8344241">n</a></span>&nbsp;<span class="op" id="8344720">==</span>&nbsp;<span class="string" id="8344723">&#34;unixgram&#34;</span>&nbsp;<span class="op" id="8344734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344738">l</span><span class="op" id="8344739">,</span>&nbsp;<span class="ident" id="8344741">e</span>&nbsp;<span class="op" id="8344743">:=</span>&nbsp;<span class="ident" id="8344746"><a href="/log/syslog/syslog_test.go.html#8343263">net</a></span><span class="op" id="8344749">.</span><span class="ident" id="8344750">ListenPacket</span><span class="op" id="8344762">(</span><span class="ident" id="8344763"><a href="/log/syslog/syslog_test.go.html#8344241">n</a></span><span class="op" id="8344764">,</span>&nbsp;<span class="ident" id="8344766"><a href="/log/syslog/syslog_test.go.html#8344244">la</a></span><span class="op" id="8344768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344772">if</span>&nbsp;<span class="ident" id="8344775"><a href="/log/syslog/syslog_test.go.html#8344741">e</a></span>&nbsp;<span class="op" id="8344777">!=</span>&nbsp;<span class="ident" id="8344780">nil</span>&nbsp;<span class="op" id="8344784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344789"><a href="/log/syslog/syslog_test.go.html#8343256">log</a></span><span class="op" id="8344792">.</span><span class="ident" id="8344793">Fatalf</span><span class="op" id="8344799">(</span><span class="string" id="8344800">&#34;startServer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8344824">,</span>&nbsp;<span class="ident" id="8344826"><a href="/log/syslog/syslog_test.go.html#8344741">e</a></span><span class="op" id="8344827">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344835"><a href="/log/syslog/syslog_test.go.html#8344276">addr</a></span>&nbsp;<span class="op" id="8344840">=</span>&nbsp;<span class="ident" id="8344842"><a href="/log/syslog/syslog_test.go.html#8344738">l</a></span><span class="op" id="8344843">.</span><span class="ident" id="8344844">LocalAddr</span><span class="op" id="8344853">(</span><span class="op" id="8344854">)</span><span class="op" id="8344855">.</span><span class="ident" id="8344856">String</span><span class="op" id="8344862">(</span><span class="op" id="8344863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344867"><a href="/log/syslog/syslog_test.go.html#8344289">sock</a></span>&nbsp;<span class="op" id="8344872">=</span>&nbsp;<span class="ident" id="8344874"><a href="/log/syslog/syslog_test.go.html#8344738">l</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344878"><a href="/log/syslog/syslog_test.go.html#8344305">wg</a></span><span class="op" id="8344880">.</span><span class="ident" id="8344881">Add</span><span class="op" id="8344884">(</span><span class="num" id="8344885">1</span><span class="op" id="8344886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344890">go</span>&nbsp;<span class="keyword" id="8344893">func</span><span class="op" id="8344897">(</span><span class="op" id="8344898">)</span>&nbsp;<span class="op" id="8344900">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344905">defer</span>&nbsp;<span class="ident" id="8344911"><a href="/log/syslog/syslog_test.go.html#8344305">wg</a></span><span class="op" id="8344913">.</span><span class="ident" id="8344914">Done</span><span class="op" id="8344918">(</span><span class="op" id="8344919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344924"><a href="/log/syslog/syslog_test.go.html#8343310">runPktSyslog</a></span><span class="op" id="8344936">(</span><span class="ident" id="8344937"><a href="/log/syslog/syslog_test.go.html#8344738">l</a></span><span class="op" id="8344938">,</span>&nbsp;<span class="ident" id="8344940"><a href="/log/syslog/syslog_test.go.html#8344255">done</a></span><span class="op" id="8344944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344948">}</span><span class="op" id="8344949">(</span><span class="op" id="8344950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8344953">}</span>&nbsp;<span class="keyword" id="8344955">else</span>&nbsp;<span class="op" id="8344960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8344964">l</span><span class="op" id="8344965">,</span>&nbsp;<span class="ident" id="8344967">e</span>&nbsp;<span class="op" id="8344969">:=</span>&nbsp;<span class="ident" id="8344972"><a href="/log/syslog/syslog_test.go.html#8343263">net</a></span><span class="op" id="8344975">.</span><span class="ident" id="8344976">Listen</span><span class="op" id="8344982">(</span><span class="ident" id="8344983"><a href="/log/syslog/syslog_test.go.html#8344241">n</a></span><span class="op" id="8344984">,</span>&nbsp;<span class="ident" id="8344986"><a href="/log/syslog/syslog_test.go.html#8344244">la</a></span><span class="op" id="8344988">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8344992">if</span>&nbsp;<span class="ident" id="8344995"><a href="/log/syslog/syslog_test.go.html#8344967">e</a></span>&nbsp;<span class="op" id="8344997">!=</span>&nbsp;<span class="ident" id="8345000">nil</span>&nbsp;<span class="op" id="8345004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345009"><a href="/log/syslog/syslog_test.go.html#8343256">log</a></span><span class="op" id="8345012">.</span><span class="ident" id="8345013">Fatalf</span><span class="op" id="8345019">(</span><span class="string" id="8345020">&#34;startServer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8345044">,</span>&nbsp;<span class="ident" id="8345046"><a href="/log/syslog/syslog_test.go.html#8344967">e</a></span><span class="op" id="8345047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345055"><a href="/log/syslog/syslog_test.go.html#8344276">addr</a></span>&nbsp;<span class="op" id="8345060">=</span>&nbsp;<span class="ident" id="8345062"><a href="/log/syslog/syslog_test.go.html#8344964">l</a></span><span class="op" id="8345063">.</span><span class="ident" id="8345064">Addr</span><span class="op" id="8345068">(</span><span class="op" id="8345069">)</span><span class="op" id="8345070">.</span><span class="ident" id="8345071">String</span><span class="op" id="8345077">(</span><span class="op" id="8345078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345082"><a href="/log/syslog/syslog_test.go.html#8344289">sock</a></span>&nbsp;<span class="op" id="8345087">=</span>&nbsp;<span class="ident" id="8345089"><a href="/log/syslog/syslog_test.go.html#8344964">l</a></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345093"><a href="/log/syslog/syslog_test.go.html#8344305">wg</a></span><span class="op" id="8345095">.</span><span class="ident" id="8345096">Add</span><span class="op" id="8345099">(</span><span class="num" id="8345100">1</span><span class="op" id="8345101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345105">go</span>&nbsp;<span class="keyword" id="8345108">func</span><span class="op" id="8345112">(</span><span class="op" id="8345113">)</span>&nbsp;<span class="op" id="8345115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345120">defer</span>&nbsp;<span class="ident" id="8345126"><a href="/log/syslog/syslog_test.go.html#8344305">wg</a></span><span class="op" id="8345128">.</span><span class="ident" id="8345129">Done</span><span class="op" id="8345133">(</span><span class="op" id="8345134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345139"><a href="/log/syslog/syslog_test.go.html#8343761">runStreamSyslog</a></span><span class="op" id="8345154">(</span><span class="ident" id="8345155"><a href="/log/syslog/syslog_test.go.html#8344964">l</a></span><span class="op" id="8345156">,</span>&nbsp;<span class="ident" id="8345158"><a href="/log/syslog/syslog_test.go.html#8344255">done</a></span><span class="op" id="8345162">,</span>&nbsp;<span class="ident" id="8345164"><a href="/log/syslog/syslog_test.go.html#8344305">wg</a></span><span class="op" id="8345166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345170">}</span><span class="op" id="8345171">(</span><span class="op" id="8345172">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345178">return</span><br>
<span class="lineno"></span><span class="op" id="8345185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8345188">func</span>&nbsp;<span class="ident" id="8345193">TestWithSimulated</span><span class="op" id="8345210">(</span><span class="ident" id="8345211">t</span>&nbsp;<span class="op" id="8345213">*</span><span class="ident" id="8345214"><a href="/log/syslog/syslog_test.go.html#8343284">testing</a></span><span class="op" id="8345221">.</span><span class="ident" id="8345222">T</span><span class="op" id="8345223">)</span>&nbsp;<span class="op" id="8345225">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345228">msg</span>&nbsp;<span class="op" id="8345232">:=</span>&nbsp;<span class="string" id="8345235">&#34;Test&nbsp;123&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345247">transport</span>&nbsp;<span class="op" id="8345257">:=</span>&nbsp;<span class="op" id="8345260">[</span><span class="op" id="8345261">]</span><span class="builtintype" id="8345262">string</span><span class="op" id="8345268">{</span><span class="string" id="8345269">&#34;unix&#34;</span><span class="op" id="8345275">,</span>&nbsp;<span class="string" id="8345277">&#34;unixgram&#34;</span><span class="op" id="8345287">,</span>&nbsp;<span class="string" id="8345289">&#34;udp&#34;</span><span class="op" id="8345294">,</span>&nbsp;<span class="string" id="8345296">&#34;tcp&#34;</span><span class="op" id="8345301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345305">for</span>&nbsp;<span class="ident" id="8345309">_</span><span class="op" id="8345310">,</span>&nbsp;<span class="ident" id="8345312">tr</span>&nbsp;<span class="op" id="8345315">:=</span>&nbsp;<span class="keyword" id="8345318">range</span>&nbsp;<span class="ident" id="8345324"><a href="/log/syslog/syslog_test.go.html#8345247">transport</a></span>&nbsp;<span class="op" id="8345334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345338">done</span>&nbsp;<span class="op" id="8345343">:=</span>&nbsp;<span class="builtinfunc" id="8345346">make</span><span class="op" id="8345350">(</span><span class="keyword" id="8345351">chan</span>&nbsp;<span class="builtintype" id="8345356">string</span><span class="op" id="8345362">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345366">addr</span><span class="op" id="8345370">,</span>&nbsp;<span class="ident" id="8345372">sock</span><span class="op" id="8345376">,</span>&nbsp;<span class="ident" id="8345378">srvWG</span>&nbsp;<span class="op" id="8345384">:=</span>&nbsp;<span class="ident" id="8345387"><a href="/log/syslog/syslog_test.go.html#8344229">startServer</a></span><span class="op" id="8345398">(</span><span class="ident" id="8345399"><a href="/log/syslog/syslog_test.go.html#8345312">tr</a></span><span class="op" id="8345401">,</span>&nbsp;<span class="string" id="8345403">&#34;&#34;</span><span class="op" id="8345405">,</span>&nbsp;<span class="ident" id="8345407"><a href="/log/syslog/syslog_test.go.html#8345338">done</a></span><span class="op" id="8345411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345415">defer</span>&nbsp;<span class="ident" id="8345421"><a href="/log/syslog/syslog_test.go.html#8345378">srvWG</a></span><span class="op" id="8345426">.</span><span class="ident" id="8345427">Wait</span><span class="op" id="8345431">(</span><span class="op" id="8345432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345436">defer</span>&nbsp;<span class="ident" id="8345442"><a href="/log/syslog/syslog_test.go.html#8345372">sock</a></span><span class="op" id="8345446">.</span><span class="ident" id="8345447">Close</span><span class="op" id="8345452">(</span><span class="op" id="8345453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345457">if</span>&nbsp;<span class="ident" id="8345460"><a href="/log/syslog/syslog_test.go.html#8345312">tr</a></span>&nbsp;<span class="op" id="8345463">==</span>&nbsp;<span class="string" id="8345466">&#34;unix&#34;</span>&nbsp;<span class="op" id="8345473">||</span>&nbsp;<span class="ident" id="8345476"><a href="/log/syslog/syslog_test.go.html#8345312">tr</a></span>&nbsp;<span class="op" id="8345479">==</span>&nbsp;<span class="string" id="8345482">&#34;unixgram&#34;</span>&nbsp;<span class="op" id="8345493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345498">defer</span>&nbsp;<span class="ident" id="8345504"><a href="/log/syslog/syslog_test.go.html#8343270">os</a></span><span class="op" id="8345506">.</span><span class="ident" id="8345507">Remove</span><span class="op" id="8345513">(</span><span class="ident" id="8345514"><a href="/log/syslog/syslog_test.go.html#8345366">addr</a></span><span class="op" id="8345518">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345526">s</span><span class="op" id="8345527">,</span>&nbsp;<span class="ident" id="8345529">err</span>&nbsp;<span class="op" id="8345533">:=</span>&nbsp;<span class="ident" id="8345536"><a href="/log/syslog/syslog.go.html#5675608">Dial</a></span><span class="op" id="8345540">(</span><span class="ident" id="8345541"><a href="/log/syslog/syslog_test.go.html#8345312">tr</a></span><span class="op" id="8345543">,</span>&nbsp;<span class="ident" id="8345545"><a href="/log/syslog/syslog_test.go.html#8345366">addr</a></span><span class="op" id="8345549">,</span>&nbsp;<span class="ident" id="8345551"><a href="/log/syslog/syslog.go.html#5673880">LOG_INFO</a></span><span class="op" id="8345559">|</span><span class="ident" id="8345560"><a href="/log/syslog/syslog.go.html#5674056">LOG_USER</a></span><span class="op" id="8345568">,</span>&nbsp;<span class="string" id="8345570">&#34;syslog_test&#34;</span><span class="op" id="8345583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345587">if</span>&nbsp;<span class="ident" id="8345590"><a href="/log/syslog/syslog_test.go.html#8345529">err</a></span>&nbsp;<span class="op" id="8345594">!=</span>&nbsp;<span class="ident" id="8345597">nil</span>&nbsp;<span class="op" id="8345601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345606"><a href="/log/syslog/syslog_test.go.html#8345211">t</a></span><span class="op" id="8345607">.</span><span class="ident" id="8345608">Fatalf</span><span class="op" id="8345614">(</span><span class="string" id="8345615">&#34;Dial()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8345634">,</span>&nbsp;<span class="ident" id="8345636"><a href="/log/syslog/syslog_test.go.html#8345529">err</a></span><span class="op" id="8345639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345643">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345647"><a href="/log/syslog/syslog_test.go.html#8345529">err</a></span>&nbsp;<span class="op" id="8345651">=</span>&nbsp;<span class="ident" id="8345653"><a href="/log/syslog/syslog_test.go.html#8345526">s</a></span><span class="op" id="8345654">.</span><span class="ident" id="8345655">Info</span><span class="op" id="8345659">(</span><span class="ident" id="8345660"><a href="/log/syslog/syslog_test.go.html#8345228">msg</a></span><span class="op" id="8345663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345667">if</span>&nbsp;<span class="ident" id="8345670"><a href="/log/syslog/syslog_test.go.html#8345529">err</a></span>&nbsp;<span class="op" id="8345674">!=</span>&nbsp;<span class="ident" id="8345677">nil</span>&nbsp;<span class="op" id="8345681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345686"><a href="/log/syslog/syslog_test.go.html#8345211">t</a></span><span class="op" id="8345687">.</span><span class="ident" id="8345688">Fatalf</span><span class="op" id="8345694">(</span><span class="string" id="8345695">&#34;log&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8345711">,</span>&nbsp;<span class="ident" id="8345713"><a href="/log/syslog/syslog_test.go.html#8345529">err</a></span><span class="op" id="8345716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345724"><a href="/log/syslog/syslog_test.go.html#8347486">check</a></span><span class="op" id="8345729">(</span><span class="ident" id="8345730"><a href="/log/syslog/syslog_test.go.html#8345211">t</a></span><span class="op" id="8345731">,</span>&nbsp;<span class="ident" id="8345733"><a href="/log/syslog/syslog_test.go.html#8345228">msg</a></span><span class="op" id="8345736">,</span>&nbsp;<span class="op" id="8345738">&lt;-</span><span class="ident" id="8345740"><a href="/log/syslog/syslog_test.go.html#8345338">done</a></span><span class="op" id="8345744">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345748"><a href="/log/syslog/syslog_test.go.html#8345526">s</a></span><span class="op" id="8345749">.</span><span class="ident" id="8345750">Close</span><span class="op" id="8345755">(</span><span class="op" id="8345756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8345759">}</span><br>
<span class="lineno"></span><span class="op" id="8345761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8345764">func</span>&nbsp;<span class="ident" id="8345769">TestFlap</span><span class="op" id="8345777">(</span><span class="ident" id="8345778">t</span>&nbsp;<span class="op" id="8345780">*</span><span class="ident" id="8345781"><a href="/log/syslog/syslog_test.go.html#8343284">testing</a></span><span class="op" id="8345788">.</span><span class="ident" id="8345789">T</span><span class="op" id="8345790">)</span>&nbsp;<span class="op" id="8345792">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345795">net</span>&nbsp;<span class="op" id="8345799">:=</span>&nbsp;<span class="string" id="8345802">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345810">done</span>&nbsp;<span class="op" id="8345815">:=</span>&nbsp;<span class="builtinfunc" id="8345818">make</span><span class="op" id="8345822">(</span><span class="keyword" id="8345823">chan</span>&nbsp;<span class="builtintype" id="8345828">string</span><span class="op" id="8345834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345837">addr</span><span class="op" id="8345841">,</span>&nbsp;<span class="ident" id="8345843">sock</span><span class="op" id="8345847">,</span>&nbsp;<span class="ident" id="8345849">srvWG</span>&nbsp;<span class="op" id="8345855">:=</span>&nbsp;<span class="ident" id="8345858"><a href="/log/syslog/syslog_test.go.html#8344229">startServer</a></span><span class="op" id="8345869">(</span><span class="ident" id="8345870"><a href="/log/syslog/syslog_test.go.html#8345795">net</a></span><span class="op" id="8345873">,</span>&nbsp;<span class="string" id="8345875">&#34;&#34;</span><span class="op" id="8345877">,</span>&nbsp;<span class="ident" id="8345879"><a href="/log/syslog/syslog_test.go.html#8345810">done</a></span><span class="op" id="8345883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345886">defer</span>&nbsp;<span class="ident" id="8345892"><a href="/log/syslog/syslog_test.go.html#8345849">srvWG</a></span><span class="op" id="8345897">.</span><span class="ident" id="8345898">Wait</span><span class="op" id="8345902">(</span><span class="op" id="8345903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345906">defer</span>&nbsp;<span class="ident" id="8345912"><a href="/log/syslog/syslog_test.go.html#8343270">os</a></span><span class="op" id="8345914">.</span><span class="ident" id="8345915">Remove</span><span class="op" id="8345921">(</span><span class="ident" id="8345922"><a href="/log/syslog/syslog_test.go.html#8345837">addr</a></span><span class="op" id="8345926">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8345929">defer</span>&nbsp;<span class="ident" id="8345935"><a href="/log/syslog/syslog_test.go.html#8345843">sock</a></span><span class="op" id="8345939">.</span><span class="ident" id="8345940">Close</span><span class="op" id="8345945">(</span><span class="op" id="8345946">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8345950">s</span><span class="op" id="8345951">,</span>&nbsp;<span class="ident" id="8345953">err</span>&nbsp;<span class="op" id="8345957">:=</span>&nbsp;<span class="ident" id="8345960"><a href="/log/syslog/syslog.go.html#5675608">Dial</a></span><span class="op" id="8345964">(</span><span class="ident" id="8345965"><a href="/log/syslog/syslog_test.go.html#8345795">net</a></span><span class="op" id="8345968">,</span>&nbsp;<span class="ident" id="8345970"><a href="/log/syslog/syslog_test.go.html#8345837">addr</a></span><span class="op" id="8345974">,</span>&nbsp;<span class="ident" id="8345976"><a href="/log/syslog/syslog.go.html#5673880">LOG_INFO</a></span><span class="op" id="8345984">|</span><span class="ident" id="8345985"><a href="/log/syslog/syslog.go.html#5674056">LOG_USER</a></span><span class="op" id="8345993">,</span>&nbsp;<span class="string" id="8345995">&#34;syslog_test&#34;</span><span class="op" id="8346008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346011">if</span>&nbsp;<span class="ident" id="8346014"><a href="/log/syslog/syslog_test.go.html#8345953">err</a></span>&nbsp;<span class="op" id="8346018">!=</span>&nbsp;<span class="ident" id="8346021">nil</span>&nbsp;<span class="op" id="8346025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346029"><a href="/log/syslog/syslog_test.go.html#8345778">t</a></span><span class="op" id="8346030">.</span><span class="ident" id="8346031">Fatalf</span><span class="op" id="8346037">(</span><span class="string" id="8346038">&#34;Dial()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8346057">,</span>&nbsp;<span class="ident" id="8346059"><a href="/log/syslog/syslog_test.go.html#8345953">err</a></span><span class="op" id="8346062">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346068">msg</span>&nbsp;<span class="op" id="8346072">:=</span>&nbsp;<span class="string" id="8346075">&#34;Moo&nbsp;2&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346084"><a href="/log/syslog/syslog_test.go.html#8345953">err</a></span>&nbsp;<span class="op" id="8346088">=</span>&nbsp;<span class="ident" id="8346090"><a href="/log/syslog/syslog_test.go.html#8345950">s</a></span><span class="op" id="8346091">.</span><span class="ident" id="8346092">Info</span><span class="op" id="8346096">(</span><span class="ident" id="8346097"><a href="/log/syslog/syslog_test.go.html#8346068">msg</a></span><span class="op" id="8346100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346103">if</span>&nbsp;<span class="ident" id="8346106"><a href="/log/syslog/syslog_test.go.html#8345953">err</a></span>&nbsp;<span class="op" id="8346110">!=</span>&nbsp;<span class="ident" id="8346113">nil</span>&nbsp;<span class="op" id="8346117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346121"><a href="/log/syslog/syslog_test.go.html#8345778">t</a></span><span class="op" id="8346122">.</span><span class="ident" id="8346123">Fatalf</span><span class="op" id="8346129">(</span><span class="string" id="8346130">&#34;log&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8346146">,</span>&nbsp;<span class="ident" id="8346148"><a href="/log/syslog/syslog_test.go.html#8345953">err</a></span><span class="op" id="8346151">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346157"><a href="/log/syslog/syslog_test.go.html#8347486">check</a></span><span class="op" id="8346162">(</span><span class="ident" id="8346163"><a href="/log/syslog/syslog_test.go.html#8345778">t</a></span><span class="op" id="8346164">,</span>&nbsp;<span class="ident" id="8346166"><a href="/log/syslog/syslog_test.go.html#8346068">msg</a></span><span class="op" id="8346169">,</span>&nbsp;<span class="op" id="8346171">&lt;-</span><span class="ident" id="8346173"><a href="/log/syslog/syslog_test.go.html#8345810">done</a></span><span class="op" id="8346177">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8346181">//&nbsp;restart&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346204">_</span><span class="op" id="8346205">,</span>&nbsp;<span class="ident" id="8346207">sock2</span><span class="op" id="8346212">,</span>&nbsp;<span class="ident" id="8346214">srvWG2</span>&nbsp;<span class="op" id="8346221">:=</span>&nbsp;<span class="ident" id="8346224"><a href="/log/syslog/syslog_test.go.html#8344229">startServer</a></span><span class="op" id="8346235">(</span><span class="ident" id="8346236"><a href="/log/syslog/syslog_test.go.html#8345795">net</a></span><span class="op" id="8346239">,</span>&nbsp;<span class="ident" id="8346241"><a href="/log/syslog/syslog_test.go.html#8345837">addr</a></span><span class="op" id="8346245">,</span>&nbsp;<span class="ident" id="8346247"><a href="/log/syslog/syslog_test.go.html#8345810">done</a></span><span class="op" id="8346251">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346254">defer</span>&nbsp;<span class="ident" id="8346260"><a href="/log/syslog/syslog_test.go.html#8346214">srvWG2</a></span><span class="op" id="8346266">.</span><span class="ident" id="8346267">Wait</span><span class="op" id="8346271">(</span><span class="op" id="8346272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346275">defer</span>&nbsp;<span class="ident" id="8346281"><a href="/log/syslog/syslog_test.go.html#8346207">sock2</a></span><span class="op" id="8346286">.</span><span class="ident" id="8346287">Close</span><span class="op" id="8346292">(</span><span class="op" id="8346293">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8346297">//&nbsp;and&nbsp;try&nbsp;retransmitting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346324"><a href="/log/syslog/syslog_test.go.html#8346068">msg</a></span>&nbsp;<span class="op" id="8346328">=</span>&nbsp;<span class="string" id="8346330">&#34;Moo&nbsp;3&#34;</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346339"><a href="/log/syslog/syslog_test.go.html#8345953">err</a></span>&nbsp;<span class="op" id="8346343">=</span>&nbsp;<span class="ident" id="8346345"><a href="/log/syslog/syslog_test.go.html#8345950">s</a></span><span class="op" id="8346346">.</span><span class="ident" id="8346347">Info</span><span class="op" id="8346351">(</span><span class="ident" id="8346352"><a href="/log/syslog/syslog_test.go.html#8346068">msg</a></span><span class="op" id="8346355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346358">if</span>&nbsp;<span class="ident" id="8346361"><a href="/log/syslog/syslog_test.go.html#8345953">err</a></span>&nbsp;<span class="op" id="8346365">!=</span>&nbsp;<span class="ident" id="8346368">nil</span>&nbsp;<span class="op" id="8346372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346376"><a href="/log/syslog/syslog_test.go.html#8345778">t</a></span><span class="op" id="8346377">.</span><span class="ident" id="8346378">Fatalf</span><span class="op" id="8346384">(</span><span class="string" id="8346385">&#34;log&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8346401">,</span>&nbsp;<span class="ident" id="8346403"><a href="/log/syslog/syslog_test.go.html#8345953">err</a></span><span class="op" id="8346406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346412"><a href="/log/syslog/syslog_test.go.html#8347486">check</a></span><span class="op" id="8346417">(</span><span class="ident" id="8346418"><a href="/log/syslog/syslog_test.go.html#8345778">t</a></span><span class="op" id="8346419">,</span>&nbsp;<span class="ident" id="8346421"><a href="/log/syslog/syslog_test.go.html#8346068">msg</a></span><span class="op" id="8346424">,</span>&nbsp;<span class="op" id="8346426">&lt;-</span><span class="ident" id="8346428"><a href="/log/syslog/syslog_test.go.html#8345810">done</a></span><span class="op" id="8346432">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346436"><a href="/log/syslog/syslog_test.go.html#8345950">s</a></span><span class="op" id="8346437">.</span><span class="ident" id="8346438">Close</span><span class="op" id="8346443">(</span><span class="op" id="8346444">)</span><br>
<span class="lineno"></span><span class="op" id="8346446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8346449">func</span>&nbsp;<span class="ident" id="8346454">TestNew</span><span class="op" id="8346461">(</span><span class="ident" id="8346462">t</span>&nbsp;<span class="op" id="8346464">*</span><span class="ident" id="8346465"><a href="/log/syslog/syslog_test.go.html#8343284">testing</a></span><span class="op" id="8346472">.</span><span class="ident" id="8346473">T</span><span class="op" id="8346474">)</span>&nbsp;<span class="op" id="8346476">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346479">if</span>&nbsp;<span class="ident" id="8346482"><a href="/log/syslog/syslog.go.html#5674308">LOG_LOCAL7</a></span>&nbsp;<span class="op" id="8346493">!=</span>&nbsp;<span class="num" id="8346496">23</span><span class="op" id="8346498">&lt;&lt;</span><span class="num" id="8346500">3</span>&nbsp;<span class="op" id="8346502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346506"><a href="/log/syslog/syslog_test.go.html#8346462">t</a></span><span class="op" id="8346507">.</span><span class="ident" id="8346508">Fatalf</span><span class="op" id="8346514">(</span><span class="string" id="8346515">&#34;LOG_LOCAL7&nbsp;has&nbsp;wrong&nbsp;value&#34;</span><span class="op" id="8346543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346549">if</span>&nbsp;<span class="ident" id="8346552"><a href="/log/syslog/syslog_test.go.html#8343284">testing</a></span><span class="op" id="8346559">.</span><span class="ident" id="8346560">Short</span><span class="op" id="8346565">(</span><span class="op" id="8346566">)</span>&nbsp;<span class="op" id="8346568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8346572">//&nbsp;Depends&nbsp;on&nbsp;syslog&nbsp;daemon&nbsp;running,&nbsp;and&nbsp;sometimes&nbsp;it&#39;s&nbsp;not.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346635"><a href="/log/syslog/syslog_test.go.html#8346462">t</a></span><span class="op" id="8346636">.</span><span class="ident" id="8346637">Skip</span><span class="op" id="8346641">(</span><span class="string" id="8346642">&#34;skipping&nbsp;syslog&nbsp;test&nbsp;during&nbsp;-short&#34;</span><span class="op" id="8346678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346685">s</span><span class="op" id="8346686">,</span>&nbsp;<span class="ident" id="8346688">err</span>&nbsp;<span class="op" id="8346692">:=</span>&nbsp;<span class="ident" id="8346695"><a href="/log/syslog/syslog.go.html#5675221">New</a></span><span class="op" id="8346698">(</span><span class="ident" id="8346699"><a href="/log/syslog/syslog.go.html#5673880">LOG_INFO</a></span><span class="op" id="8346707">|</span><span class="ident" id="8346708"><a href="/log/syslog/syslog.go.html#5674056">LOG_USER</a></span><span class="op" id="8346716">,</span>&nbsp;<span class="string" id="8346718">&#34;the_tag&#34;</span><span class="op" id="8346727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346730">if</span>&nbsp;<span class="ident" id="8346733"><a href="/log/syslog/syslog_test.go.html#8346688">err</a></span>&nbsp;<span class="op" id="8346737">!=</span>&nbsp;<span class="ident" id="8346740">nil</span>&nbsp;<span class="op" id="8346744">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346748"><a href="/log/syslog/syslog_test.go.html#8346462">t</a></span><span class="op" id="8346749">.</span><span class="ident" id="8346750">Fatalf</span><span class="op" id="8346756">(</span><span class="string" id="8346757">&#34;New()&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8346775">,</span>&nbsp;<span class="ident" id="8346777"><a href="/log/syslog/syslog_test.go.html#8346688">err</a></span><span class="op" id="8346780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8346786">//&nbsp;Don&#39;t&nbsp;send&nbsp;any&nbsp;messages.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346815"><a href="/log/syslog/syslog_test.go.html#8346685">s</a></span><span class="op" id="8346816">.</span><span class="ident" id="8346817">Close</span><span class="op" id="8346822">(</span><span class="op" id="8346823">)</span><br>
<span class="lineno"></span><span class="op" id="8346825">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="8346828">func</span>&nbsp;<span class="ident" id="8346833">TestNewLogger</span><span class="op" id="8346846">(</span><span class="ident" id="8346847">t</span>&nbsp;<span class="op" id="8346849">*</span><span class="ident" id="8346850"><a href="/log/syslog/syslog_test.go.html#8343284">testing</a></span><span class="op" id="8346857">.</span><span class="ident" id="8346858">T</span><span class="op" id="8346859">)</span>&nbsp;<span class="op" id="8346861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346864">if</span>&nbsp;<span class="ident" id="8346867"><a href="/log/syslog/syslog_test.go.html#8343284">testing</a></span><span class="op" id="8346874">.</span><span class="ident" id="8346875">Short</span><span class="op" id="8346880">(</span><span class="op" id="8346881">)</span>&nbsp;<span class="op" id="8346883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346887"><a href="/log/syslog/syslog_test.go.html#8346847">t</a></span><span class="op" id="8346888">.</span><span class="ident" id="8346889">Skip</span><span class="op" id="8346893">(</span><span class="string" id="8346894">&#34;skipping&nbsp;syslog&nbsp;test&nbsp;during&nbsp;-short&#34;</span><span class="op" id="8346930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8346933">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346936">f</span><span class="op" id="8346937">,</span>&nbsp;<span class="ident" id="8346939">err</span>&nbsp;<span class="op" id="8346943">:=</span>&nbsp;<span class="ident" id="8346946"><a href="/log/syslog/syslog.go.html#5680262">NewLogger</a></span><span class="op" id="8346955">(</span><span class="ident" id="8346956"><a href="/log/syslog/syslog.go.html#5674056">LOG_USER</a></span><span class="op" id="8346964">|</span><span class="ident" id="8346965"><a href="/log/syslog/syslog.go.html#5673880">LOG_INFO</a></span><span class="op" id="8346973">,</span>&nbsp;<span class="num" id="8346975">0</span><span class="op" id="8346976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8346979">if</span>&nbsp;<span class="ident" id="8346982"><a href="/log/syslog/syslog_test.go.html#8346936">f</a></span>&nbsp;<span class="op" id="8346984">==</span>&nbsp;<span class="ident" id="8346987">nil</span>&nbsp;<span class="op" id="8346991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8346995"><a href="/log/syslog/syslog_test.go.html#8346847">t</a></span><span class="op" id="8346996">.</span><span class="ident" id="8346997">Error</span><span class="op" id="8347002">(</span><span class="ident" id="8347003"><a href="/log/syslog/syslog_test.go.html#8346939">err</a></span><span class="op" id="8347006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347009">}</span><br>
<span class="lineno"></span><span class="op" id="8347011">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="keyword" id="8347014">func</span>&nbsp;<span class="ident" id="8347019">TestDial</span><span class="op" id="8347027">(</span><span class="ident" id="8347028">t</span>&nbsp;<span class="op" id="8347030">*</span><span class="ident" id="8347031"><a href="/log/syslog/syslog_test.go.html#8343284">testing</a></span><span class="op" id="8347038">.</span><span class="ident" id="8347039">T</span><span class="op" id="8347040">)</span>&nbsp;<span class="op" id="8347042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347045">if</span>&nbsp;<span class="ident" id="8347048"><a href="/log/syslog/syslog_test.go.html#8343284">testing</a></span><span class="op" id="8347055">.</span><span class="ident" id="8347056">Short</span><span class="op" id="8347061">(</span><span class="op" id="8347062">)</span>&nbsp;<span class="op" id="8347064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347068"><a href="/log/syslog/syslog_test.go.html#8347028">t</a></span><span class="op" id="8347069">.</span><span class="ident" id="8347070">Skip</span><span class="op" id="8347074">(</span><span class="string" id="8347075">&#34;skipping&nbsp;syslog&nbsp;test&nbsp;during&nbsp;-short&#34;</span><span class="op" id="8347111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347114">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347117">f</span><span class="op" id="8347118">,</span>&nbsp;<span class="ident" id="8347120">err</span>&nbsp;<span class="op" id="8347124">:=</span>&nbsp;<span class="ident" id="8347127"><a href="/log/syslog/syslog.go.html#5675608">Dial</a></span><span class="op" id="8347131">(</span><span class="string" id="8347132">&#34;&#34;</span><span class="op" id="8347134">,</span>&nbsp;<span class="string" id="8347136">&#34;&#34;</span><span class="op" id="8347138">,</span>&nbsp;<span class="op" id="8347140">(</span><span class="ident" id="8347141"><a href="/log/syslog/syslog.go.html#5674308">LOG_LOCAL7</a></span><span class="op" id="8347151">|</span><span class="ident" id="8347152"><a href="/log/syslog/syslog.go.html#5673890">LOG_DEBUG</a></span><span class="op" id="8347161">)</span><span class="op" id="8347162">+</span><span class="num" id="8347163">1</span><span class="op" id="8347164">,</span>&nbsp;<span class="string" id="8347166">&#34;syslog_test&#34;</span><span class="op" id="8347179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347182">if</span>&nbsp;<span class="ident" id="8347185"><a href="/log/syslog/syslog_test.go.html#8347117">f</a></span>&nbsp;<span class="op" id="8347187">!=</span>&nbsp;<span class="ident" id="8347190">nil</span>&nbsp;<span class="op" id="8347194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347198"><a href="/log/syslog/syslog_test.go.html#8347028">t</a></span><span class="op" id="8347199">.</span><span class="ident" id="8347200">Fatalf</span><span class="op" id="8347206">(</span><span class="string" id="8347207">&#34;Should&nbsp;have&nbsp;trapped&nbsp;bad&nbsp;priority&#34;</span><span class="op" id="8347241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347247"><a href="/log/syslog/syslog_test.go.html#8347117">f</a></span><span class="op" id="8347248">,</span>&nbsp;<span class="ident" id="8347250"><a href="/log/syslog/syslog_test.go.html#8347120">err</a></span>&nbsp;<span class="op" id="8347254">=</span>&nbsp;<span class="ident" id="8347256"><a href="/log/syslog/syslog.go.html#5675608">Dial</a></span><span class="op" id="8347260">(</span><span class="string" id="8347261">&#34;&#34;</span><span class="op" id="8347263">,</span>&nbsp;<span class="string" id="8347265">&#34;&#34;</span><span class="op" id="8347267">,</span>&nbsp;<span class="op" id="8347269">-</span><span class="num" id="8347270">1</span><span class="op" id="8347271">,</span>&nbsp;<span class="string" id="8347273">&#34;syslog_test&#34;</span><span class="op" id="8347286">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347289">if</span>&nbsp;<span class="ident" id="8347292"><a href="/log/syslog/syslog_test.go.html#8347117">f</a></span>&nbsp;<span class="op" id="8347294">!=</span>&nbsp;<span class="ident" id="8347297">nil</span>&nbsp;<span class="op" id="8347301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347305"><a href="/log/syslog/syslog_test.go.html#8347028">t</a></span><span class="op" id="8347306">.</span><span class="ident" id="8347307">Fatalf</span><span class="op" id="8347313">(</span><span class="string" id="8347314">&#34;Should&nbsp;have&nbsp;trapped&nbsp;bad&nbsp;priority&#34;</span><span class="op" id="8347348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347354">l</span><span class="op" id="8347355">,</span>&nbsp;<span class="ident" id="8347357"><a href="/log/syslog/syslog_test.go.html#8347120">err</a></span>&nbsp;<span class="op" id="8347361">:=</span>&nbsp;<span class="ident" id="8347364"><a href="/log/syslog/syslog.go.html#5675608">Dial</a></span><span class="op" id="8347368">(</span><span class="string" id="8347369">&#34;&#34;</span><span class="op" id="8347371">,</span>&nbsp;<span class="string" id="8347373">&#34;&#34;</span><span class="op" id="8347375">,</span>&nbsp;<span class="ident" id="8347377"><a href="/log/syslog/syslog.go.html#5674056">LOG_USER</a></span><span class="op" id="8347385">|</span><span class="ident" id="8347386"><a href="/log/syslog/syslog.go.html#5673846">LOG_ERR</a></span><span class="op" id="8347393">,</span>&nbsp;<span class="string" id="8347395">&#34;syslog_test&#34;</span><span class="op" id="8347408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347411">if</span>&nbsp;<span class="ident" id="8347414"><a href="/log/syslog/syslog_test.go.html#8347120">err</a></span>&nbsp;<span class="op" id="8347418">!=</span>&nbsp;<span class="ident" id="8347421">nil</span>&nbsp;<span class="op" id="8347425">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347429"><a href="/log/syslog/syslog_test.go.html#8347028">t</a></span><span class="op" id="8347430">.</span><span class="ident" id="8347431">Fatalf</span><span class="op" id="8347437">(</span><span class="string" id="8347438">&#34;Dial()&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8347457">,</span>&nbsp;<span class="ident" id="8347459"><a href="/log/syslog/syslog_test.go.html#8347120">err</a></span><span class="op" id="8347462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347468"><a href="/log/syslog/syslog_test.go.html#8347354">l</a></span><span class="op" id="8347469">.</span><span class="ident" id="8347470">Close</span><span class="op" id="8347475">(</span><span class="op" id="8347476">)</span><br>
<span class="lineno"></span><span class="op" id="8347478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="8347481">func</span>&nbsp;<span class="ident" id="8347486">check</span><span class="op" id="8347491">(</span><span class="ident" id="8347492">t</span>&nbsp;<span class="op" id="8347494">*</span><span class="ident" id="8347495"><a href="/log/syslog/syslog_test.go.html#8343284">testing</a></span><span class="op" id="8347502">.</span><span class="ident" id="8347503">T</span><span class="op" id="8347504">,</span>&nbsp;<span class="ident" id="8347506">in</span><span class="op" id="8347508">,</span>&nbsp;<span class="ident" id="8347510">out</span>&nbsp;<span class="builtintype" id="8347514">string</span><span class="op" id="8347520">)</span>&nbsp;<span class="op" id="8347522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347525">tmpl</span>&nbsp;<span class="op" id="8347530">:=</span>&nbsp;<span class="ident" id="8347533"><a href="/log/syslog/syslog_test.go.html#8343230">fmt</a></span><span class="op" id="8347536">.</span><span class="ident" id="8347537">Sprintf</span><span class="op" id="8347544">(</span><span class="string" id="8347545">&#34;&lt;%d&gt;%%s&nbsp;%%s&nbsp;syslog_test[%%d]:&nbsp;%s\n&#34;</span><span class="op" id="8347581">,</span>&nbsp;<span class="ident" id="8347583"><a href="/log/syslog/syslog.go.html#5674056">LOG_USER</a></span><span class="op" id="8347591">+</span><span class="ident" id="8347592"><a href="/log/syslog/syslog.go.html#5673880">LOG_INFO</a></span><span class="op" id="8347600">,</span>&nbsp;<span class="ident" id="8347602"><a href="/log/syslog/syslog_test.go.html#8347506">in</a></span><span class="op" id="8347604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347607">if</span>&nbsp;<span class="ident" id="8347610">hostname</span><span class="op" id="8347618">,</span>&nbsp;<span class="ident" id="8347620">err</span>&nbsp;<span class="op" id="8347624">:=</span>&nbsp;<span class="ident" id="8347627"><a href="/log/syslog/syslog_test.go.html#8343270">os</a></span><span class="op" id="8347629">.</span><span class="ident" id="8347630">Hostname</span><span class="op" id="8347638">(</span><span class="op" id="8347639">)</span><span class="op" id="8347640">;</span>&nbsp;<span class="ident" id="8347642"><a href="/log/syslog/syslog_test.go.html#8347620">err</a></span>&nbsp;<span class="op" id="8347646">!=</span>&nbsp;<span class="ident" id="8347649">nil</span>&nbsp;<span class="op" id="8347653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347657"><a href="/log/syslog/syslog_test.go.html#8347492">t</a></span><span class="op" id="8347658">.</span><span class="ident" id="8347659">Error</span><span class="op" id="8347664">(</span><span class="string" id="8347665">&#34;Error&nbsp;retrieving&nbsp;hostname&#34;</span><span class="op" id="8347692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347695">}</span>&nbsp;<span class="keyword" id="8347697">else</span>&nbsp;<span class="op" id="8347702">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347706">var</span>&nbsp;<span class="ident" id="8347710">parsedHostname</span><span class="op" id="8347724">,</span>&nbsp;<span class="ident" id="8347726">timestamp</span>&nbsp;<span class="builtintype" id="8347736">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347745">var</span>&nbsp;<span class="ident" id="8347749">pid</span>&nbsp;<span class="builtintype" id="8347753">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8347759">if</span>&nbsp;<span class="ident" id="8347762">n</span><span class="op" id="8347763">,</span>&nbsp;<span class="ident" id="8347765">err</span>&nbsp;<span class="op" id="8347769">:=</span>&nbsp;<span class="ident" id="8347772"><a href="/log/syslog/syslog_test.go.html#8343230">fmt</a></span><span class="op" id="8347775">.</span><span class="ident" id="8347776">Sscanf</span><span class="op" id="8347782">(</span><span class="ident" id="8347783"><a href="/log/syslog/syslog_test.go.html#8347510">out</a></span><span class="op" id="8347786">,</span>&nbsp;<span class="ident" id="8347788"><a href="/log/syslog/syslog_test.go.html#8347525">tmpl</a></span><span class="op" id="8347792">,</span>&nbsp;<span class="op" id="8347794">&amp;</span><span class="ident" id="8347795"><a href="/log/syslog/syslog_test.go.html#8347726">timestamp</a></span><span class="op" id="8347804">,</span>&nbsp;<span class="op" id="8347806">&amp;</span><span class="ident" id="8347807"><a href="/log/syslog/syslog_test.go.html#8347710">parsedHostname</a></span><span class="op" id="8347821">,</span>&nbsp;<span class="op" id="8347823">&amp;</span><span class="ident" id="8347824"><a href="/log/syslog/syslog_test.go.html#8347749">pid</a></span><span class="op" id="8347827">)</span><span class="op" id="8347828">;</span>&nbsp;<span class="ident" id="8347830"><a href="/log/syslog/syslog_test.go.html#8347762">n</a></span>&nbsp;<span class="op" id="8347832">!=</span>&nbsp;<span class="num" id="8347835">3</span>&nbsp;<span class="op" id="8347837">||</span>&nbsp;<span class="ident" id="8347840"><a href="/log/syslog/syslog_test.go.html#8347765">err</a></span>&nbsp;<span class="op" id="8347844">!=</span>&nbsp;<span class="ident" id="8347847">nil</span>&nbsp;<span class="op" id="8347851">||</span>&nbsp;<span class="ident" id="8347854"><a href="/log/syslog/syslog_test.go.html#8347610">hostname</a></span>&nbsp;<span class="op" id="8347863">!=</span>&nbsp;<span class="ident" id="8347866"><a href="/log/syslog/syslog_test.go.html#8347710">parsedHostname</a></span>&nbsp;<span class="op" id="8347881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8347886"><a href="/log/syslog/syslog_test.go.html#8347492">t</a></span><span class="op" id="8347887">.</span><span class="ident" id="8347888">Errorf</span><span class="op" id="8347894">(</span><span class="string" id="8347895">&#34;Got&nbsp;%q,&nbsp;does&nbsp;not&nbsp;match&nbsp;template&nbsp;%q&nbsp;(%d&nbsp;%s)&#34;</span><span class="op" id="8347939">,</span>&nbsp;<span class="ident" id="8347941"><a href="/log/syslog/syslog_test.go.html#8347510">out</a></span><span class="op" id="8347944">,</span>&nbsp;<span class="ident" id="8347946"><a href="/log/syslog/syslog_test.go.html#8347525">tmpl</a></span><span class="op" id="8347950">,</span>&nbsp;<span class="ident" id="8347952"><a href="/log/syslog/syslog_test.go.html#8347762">n</a></span><span class="op" id="8347953">,</span>&nbsp;<span class="ident" id="8347955"><a href="/log/syslog/syslog_test.go.html#8347765">err</a></span><span class="op" id="8347958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347962">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8347965">}</span><br>
<span class="lineno"></span><span class="op" id="8347967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8347970">func</span>&nbsp;<span class="ident" id="8347975">TestWrite</span><span class="op" id="8347984">(</span><span class="ident" id="8347985">t</span>&nbsp;<span class="op" id="8347987">*</span><span class="ident" id="8347988"><a href="/log/syslog/syslog_test.go.html#8343284">testing</a></span><span class="op" id="8347995">.</span><span class="ident" id="8347996">T</span><span class="op" id="8347997">)</span>&nbsp;<span class="op" id="8347999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348002">tests</span>&nbsp;<span class="op" id="8348008">:=</span>&nbsp;<span class="op" id="8348011">[</span><span class="op" id="8348012">]</span><span class="keyword" id="8348013">struct</span>&nbsp;<span class="op" id="8348020">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348024">pri</span>&nbsp;<span class="ident" id="8348028"><a href="/log/syslog/syslog.go.html#5673623">Priority</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348039">pre</span>&nbsp;<span class="builtintype" id="8348043">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348052">msg</span>&nbsp;<span class="builtintype" id="8348056">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348065">exp</span>&nbsp;<span class="builtintype" id="8348069">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348077">}</span><span class="op" id="8348078">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348082">{</span><span class="ident" id="8348083"><a href="/log/syslog/syslog.go.html#5674056">LOG_USER</a></span>&nbsp;<span class="op" id="8348092">|</span>&nbsp;<span class="ident" id="8348094"><a href="/log/syslog/syslog.go.html#5673846">LOG_ERR</a></span><span class="op" id="8348101">,</span>&nbsp;<span class="string" id="8348103">&#34;syslog_test&#34;</span><span class="op" id="8348116">,</span>&nbsp;<span class="string" id="8348118">&#34;&#34;</span><span class="op" id="8348120">,</span>&nbsp;<span class="string" id="8348122">&#34;%s&nbsp;%s&nbsp;syslog_test[%d]:&nbsp;\n&#34;</span><span class="op" id="8348149">}</span><span class="op" id="8348150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348154">{</span><span class="ident" id="8348155"><a href="/log/syslog/syslog.go.html#5674056">LOG_USER</a></span>&nbsp;<span class="op" id="8348164">|</span>&nbsp;<span class="ident" id="8348166"><a href="/log/syslog/syslog.go.html#5673846">LOG_ERR</a></span><span class="op" id="8348173">,</span>&nbsp;<span class="string" id="8348175">&#34;syslog_test&#34;</span><span class="op" id="8348188">,</span>&nbsp;<span class="string" id="8348190">&#34;write&nbsp;test&#34;</span><span class="op" id="8348202">,</span>&nbsp;<span class="string" id="8348204">&#34;%s&nbsp;%s&nbsp;syslog_test[%d]:&nbsp;write&nbsp;test\n&#34;</span><span class="op" id="8348241">}</span><span class="op" id="8348242">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8348246">//&nbsp;Write&nbsp;should&nbsp;not&nbsp;add&nbsp;\n&nbsp;if&nbsp;there&nbsp;already&nbsp;is&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348299">{</span><span class="ident" id="8348300"><a href="/log/syslog/syslog.go.html#5674056">LOG_USER</a></span>&nbsp;<span class="op" id="8348309">|</span>&nbsp;<span class="ident" id="8348311"><a href="/log/syslog/syslog.go.html#5673846">LOG_ERR</a></span><span class="op" id="8348318">,</span>&nbsp;<span class="string" id="8348320">&#34;syslog_test&#34;</span><span class="op" id="8348333">,</span>&nbsp;<span class="string" id="8348335">&#34;write&nbsp;test&nbsp;2\n&#34;</span><span class="op" id="8348351">,</span>&nbsp;<span class="string" id="8348353">&#34;%s&nbsp;%s&nbsp;syslog_test[%d]:&nbsp;write&nbsp;test&nbsp;2\n&#34;</span><span class="op" id="8348392">}</span><span class="op" id="8348393">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348396">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348400">if</span>&nbsp;<span class="ident" id="8348403">hostname</span><span class="op" id="8348411">,</span>&nbsp;<span class="ident" id="8348413">err</span>&nbsp;<span class="op" id="8348417">:=</span>&nbsp;<span class="ident" id="8348420"><a href="/log/syslog/syslog_test.go.html#8343270">os</a></span><span class="op" id="8348422">.</span><span class="ident" id="8348423">Hostname</span><span class="op" id="8348431">(</span><span class="op" id="8348432">)</span><span class="op" id="8348433">;</span>&nbsp;<span class="ident" id="8348435"><a href="/log/syslog/syslog_test.go.html#8348413">err</a></span>&nbsp;<span class="op" id="8348439">!=</span>&nbsp;<span class="ident" id="8348442">nil</span>&nbsp;<span class="op" id="8348446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348450"><a href="/log/syslog/syslog_test.go.html#8347985">t</a></span><span class="op" id="8348451">.</span><span class="ident" id="8348452">Fatalf</span><span class="op" id="8348458">(</span><span class="string" id="8348459">&#34;Error&nbsp;retrieving&nbsp;hostname&#34;</span><span class="op" id="8348486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348489">}</span>&nbsp;<span class="keyword" id="8348491">else</span>&nbsp;<span class="op" id="8348496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348500">for</span>&nbsp;<span class="ident" id="8348504">_</span><span class="op" id="8348505">,</span>&nbsp;<span class="ident" id="8348507">test</span>&nbsp;<span class="op" id="8348512">:=</span>&nbsp;<span class="keyword" id="8348515">range</span>&nbsp;<span class="ident" id="8348521"><a href="/log/syslog/syslog_test.go.html#8348002">tests</a></span>&nbsp;<span class="op" id="8348527">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348532">done</span>&nbsp;<span class="op" id="8348537">:=</span>&nbsp;<span class="builtinfunc" id="8348540">make</span><span class="op" id="8348544">(</span><span class="keyword" id="8348545">chan</span>&nbsp;<span class="builtintype" id="8348550">string</span><span class="op" id="8348556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348561">addr</span><span class="op" id="8348565">,</span>&nbsp;<span class="ident" id="8348567">sock</span><span class="op" id="8348571">,</span>&nbsp;<span class="ident" id="8348573">srvWG</span>&nbsp;<span class="op" id="8348579">:=</span>&nbsp;<span class="ident" id="8348582"><a href="/log/syslog/syslog_test.go.html#8344229">startServer</a></span><span class="op" id="8348593">(</span><span class="string" id="8348594">&#34;udp&#34;</span><span class="op" id="8348599">,</span>&nbsp;<span class="string" id="8348601">&#34;&#34;</span><span class="op" id="8348603">,</span>&nbsp;<span class="ident" id="8348605"><a href="/log/syslog/syslog_test.go.html#8348532">done</a></span><span class="op" id="8348609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348614">defer</span>&nbsp;<span class="ident" id="8348620"><a href="/log/syslog/syslog_test.go.html#8348573">srvWG</a></span><span class="op" id="8348625">.</span><span class="ident" id="8348626">Wait</span><span class="op" id="8348630">(</span><span class="op" id="8348631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348636">defer</span>&nbsp;<span class="ident" id="8348642"><a href="/log/syslog/syslog_test.go.html#8348567">sock</a></span><span class="op" id="8348646">.</span><span class="ident" id="8348647">Close</span><span class="op" id="8348652">(</span><span class="op" id="8348653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348658">l</span><span class="op" id="8348659">,</span>&nbsp;<span class="ident" id="8348661">err</span>&nbsp;<span class="op" id="8348665">:=</span>&nbsp;<span class="ident" id="8348668"><a href="/log/syslog/syslog.go.html#5675608">Dial</a></span><span class="op" id="8348672">(</span><span class="string" id="8348673">&#34;udp&#34;</span><span class="op" id="8348678">,</span>&nbsp;<span class="ident" id="8348680"><a href="/log/syslog/syslog_test.go.html#8348561">addr</a></span><span class="op" id="8348684">,</span>&nbsp;<span class="ident" id="8348686"><a href="/log/syslog/syslog_test.go.html#8348507">test</a></span><span class="op" id="8348690">.</span><span class="ident" id="8348691">pri</span><span class="op" id="8348694">,</span>&nbsp;<span class="ident" id="8348696"><a href="/log/syslog/syslog_test.go.html#8348507">test</a></span><span class="op" id="8348700">.</span><span class="ident" id="8348701">pre</span><span class="op" id="8348704">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348709">if</span>&nbsp;<span class="ident" id="8348712"><a href="/log/syslog/syslog_test.go.html#8348661">err</a></span>&nbsp;<span class="op" id="8348716">!=</span>&nbsp;<span class="ident" id="8348719">nil</span>&nbsp;<span class="op" id="8348723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348729"><a href="/log/syslog/syslog_test.go.html#8347985">t</a></span><span class="op" id="8348730">.</span><span class="ident" id="8348731">Fatalf</span><span class="op" id="8348737">(</span><span class="string" id="8348738">&#34;syslog.Dial()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8348764">,</span>&nbsp;<span class="ident" id="8348766"><a href="/log/syslog/syslog_test.go.html#8348661">err</a></span><span class="op" id="8348769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348779">defer</span>&nbsp;<span class="ident" id="8348785"><a href="/log/syslog/syslog_test.go.html#8348658">l</a></span><span class="op" id="8348786">.</span><span class="ident" id="8348787">Close</span><span class="op" id="8348792">(</span><span class="op" id="8348793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348798">_</span><span class="op" id="8348799">,</span>&nbsp;<span class="ident" id="8348801"><a href="/log/syslog/syslog_test.go.html#8348661">err</a></span>&nbsp;<span class="op" id="8348805">=</span>&nbsp;<span class="ident" id="8348807"><a href="/log/syslog/syslog_test.go.html#8343237">io</a></span><span class="op" id="8348809">.</span><span class="ident" id="8348810">WriteString</span><span class="op" id="8348821">(</span><span class="ident" id="8348822"><a href="/log/syslog/syslog_test.go.html#8348658">l</a></span><span class="op" id="8348823">,</span>&nbsp;<span class="ident" id="8348825"><a href="/log/syslog/syslog_test.go.html#8348507">test</a></span><span class="op" id="8348829">.</span><span class="ident" id="8348830">msg</span><span class="op" id="8348833">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348838">if</span>&nbsp;<span class="ident" id="8348841"><a href="/log/syslog/syslog_test.go.html#8348661">err</a></span>&nbsp;<span class="op" id="8348845">!=</span>&nbsp;<span class="ident" id="8348848">nil</span>&nbsp;<span class="op" id="8348852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348858"><a href="/log/syslog/syslog_test.go.html#8347985">t</a></span><span class="op" id="8348859">.</span><span class="ident" id="8348860">Fatalf</span><span class="op" id="8348866">(</span><span class="string" id="8348867">&#34;WriteString()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8348893">,</span>&nbsp;<span class="ident" id="8348895"><a href="/log/syslog/syslog_test.go.html#8348661">err</a></span><span class="op" id="8348898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8348903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348908">rcvd</span>&nbsp;<span class="op" id="8348913">:=</span>&nbsp;<span class="op" id="8348916">&lt;-</span><span class="ident" id="8348918"><a href="/log/syslog/syslog_test.go.html#8348532">done</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8348926"><a href="/log/syslog/syslog_test.go.html#8348507">test</a></span><span class="op" id="8348930">.</span><span class="ident" id="8348931">exp</span>&nbsp;<span class="op" id="8348935">=</span>&nbsp;<span class="ident" id="8348937"><a href="/log/syslog/syslog_test.go.html#8343230">fmt</a></span><span class="op" id="8348940">.</span><span class="ident" id="8348941">Sprintf</span><span class="op" id="8348948">(</span><span class="string" id="8348949">&#34;&lt;%d&gt;&#34;</span><span class="op" id="8348955">,</span>&nbsp;<span class="ident" id="8348957"><a href="/log/syslog/syslog_test.go.html#8348507">test</a></span><span class="op" id="8348961">.</span><span class="ident" id="8348962">pri</span><span class="op" id="8348965">)</span>&nbsp;<span class="op" id="8348967">+</span>&nbsp;<span class="ident" id="8348969"><a href="/log/syslog/syslog_test.go.html#8348507">test</a></span><span class="op" id="8348973">.</span><span class="ident" id="8348974">exp</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8348981">var</span>&nbsp;<span class="ident" id="8348985">parsedHostname</span><span class="op" id="8348999">,</span>&nbsp;<span class="ident" id="8349001">timestamp</span>&nbsp;<span class="builtintype" id="8349011">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349021">var</span>&nbsp;<span class="ident" id="8349025">pid</span>&nbsp;<span class="builtintype" id="8349029">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349036">if</span>&nbsp;<span class="ident" id="8349039">n</span><span class="op" id="8349040">,</span>&nbsp;<span class="ident" id="8349042">err</span>&nbsp;<span class="op" id="8349046">:=</span>&nbsp;<span class="ident" id="8349049"><a href="/log/syslog/syslog_test.go.html#8343230">fmt</a></span><span class="op" id="8349052">.</span><span class="ident" id="8349053">Sscanf</span><span class="op" id="8349059">(</span><span class="ident" id="8349060"><a href="/log/syslog/syslog_test.go.html#8348908">rcvd</a></span><span class="op" id="8349064">,</span>&nbsp;<span class="ident" id="8349066"><a href="/log/syslog/syslog_test.go.html#8348507">test</a></span><span class="op" id="8349070">.</span><span class="ident" id="8349071">exp</span><span class="op" id="8349074">,</span>&nbsp;<span class="op" id="8349076">&amp;</span><span class="ident" id="8349077"><a href="/log/syslog/syslog_test.go.html#8349001">timestamp</a></span><span class="op" id="8349086">,</span>&nbsp;<span class="op" id="8349088">&amp;</span><span class="ident" id="8349089"><a href="/log/syslog/syslog_test.go.html#8348985">parsedHostname</a></span><span class="op" id="8349103">,</span>&nbsp;<span class="op" id="8349105">&amp;</span><span class="ident" id="8349106"><a href="/log/syslog/syslog_test.go.html#8349025">pid</a></span><span class="op" id="8349109">)</span><span class="op" id="8349110">;</span>&nbsp;<span class="ident" id="8349112"><a href="/log/syslog/syslog_test.go.html#8349039">n</a></span>&nbsp;<span class="op" id="8349114">!=</span>&nbsp;<span class="num" id="8349117">3</span>&nbsp;<span class="op" id="8349119">||</span>&nbsp;<span class="ident" id="8349122"><a href="/log/syslog/syslog_test.go.html#8349042">err</a></span>&nbsp;<span class="op" id="8349126">!=</span>&nbsp;<span class="ident" id="8349129">nil</span>&nbsp;<span class="op" id="8349133">||</span>&nbsp;<span class="ident" id="8349136"><a href="/log/syslog/syslog_test.go.html#8348403">hostname</a></span>&nbsp;<span class="op" id="8349145">!=</span>&nbsp;<span class="ident" id="8349148"><a href="/log/syslog/syslog_test.go.html#8348985">parsedHostname</a></span>&nbsp;<span class="op" id="8349163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349169"><a href="/log/syslog/syslog_test.go.html#8347985">t</a></span><span class="op" id="8349170">.</span><span class="ident" id="8349171">Errorf</span><span class="op" id="8349177">(</span><span class="string" id="8349178">&#34;s.Info()&nbsp;=&nbsp;&#39;%q&#39;,&nbsp;didn&#39;t&nbsp;match&nbsp;&#39;%q&#39;&nbsp;(%d&nbsp;%s)&#34;</span><span class="op" id="8349222">,</span>&nbsp;<span class="ident" id="8349224"><a href="/log/syslog/syslog_test.go.html#8348908">rcvd</a></span><span class="op" id="8349228">,</span>&nbsp;<span class="ident" id="8349230"><a href="/log/syslog/syslog_test.go.html#8348507">test</a></span><span class="op" id="8349234">.</span><span class="ident" id="8349235">exp</span><span class="op" id="8349238">,</span>&nbsp;<span class="ident" id="8349240"><a href="/log/syslog/syslog_test.go.html#8349039">n</a></span><span class="op" id="8349241">,</span>&nbsp;<span class="ident" id="8349243"><a href="/log/syslog/syslog_test.go.html#8349042">err</a></span><span class="op" id="8349246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349251">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349258">}</span><br>
<span class="lineno"></span><span class="op" id="8349260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8349263">func</span>&nbsp;<span class="ident" id="8349268">TestConcurrentWrite</span><span class="op" id="8349287">(</span><span class="ident" id="8349288">t</span>&nbsp;<span class="op" id="8349290">*</span><span class="ident" id="8349291"><a href="/log/syslog/syslog_test.go.html#8343284">testing</a></span><span class="op" id="8349298">.</span><span class="ident" id="8349299">T</span><span class="op" id="8349300">)</span>&nbsp;<span class="op" id="8349302">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349305">addr</span><span class="op" id="8349309">,</span>&nbsp;<span class="ident" id="8349311">sock</span><span class="op" id="8349315">,</span>&nbsp;<span class="ident" id="8349317">srvWG</span>&nbsp;<span class="op" id="8349323">:=</span>&nbsp;<span class="ident" id="8349326"><a href="/log/syslog/syslog_test.go.html#8344229">startServer</a></span><span class="op" id="8349337">(</span><span class="string" id="8349338">&#34;udp&#34;</span><span class="op" id="8349343">,</span>&nbsp;<span class="string" id="8349345">&#34;&#34;</span><span class="op" id="8349347">,</span>&nbsp;<span class="builtinfunc" id="8349349">make</span><span class="op" id="8349353">(</span><span class="keyword" id="8349354">chan</span>&nbsp;<span class="builtintype" id="8349359">string</span><span class="op" id="8349365">,</span>&nbsp;<span class="num" id="8349367">1</span><span class="op" id="8349368">)</span><span class="op" id="8349369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349372">defer</span>&nbsp;<span class="ident" id="8349378"><a href="/log/syslog/syslog_test.go.html#8349317">srvWG</a></span><span class="op" id="8349383">.</span><span class="ident" id="8349384">Wait</span><span class="op" id="8349388">(</span><span class="op" id="8349389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349392">defer</span>&nbsp;<span class="ident" id="8349398"><a href="/log/syslog/syslog_test.go.html#8349311">sock</a></span><span class="op" id="8349402">.</span><span class="ident" id="8349403">Close</span><span class="op" id="8349408">(</span><span class="op" id="8349409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349412">w</span><span class="op" id="8349413">,</span>&nbsp;<span class="ident" id="8349415">err</span>&nbsp;<span class="op" id="8349419">:=</span>&nbsp;<span class="ident" id="8349422"><a href="/log/syslog/syslog.go.html#5675608">Dial</a></span><span class="op" id="8349426">(</span><span class="string" id="8349427">&#34;udp&#34;</span><span class="op" id="8349432">,</span>&nbsp;<span class="ident" id="8349434"><a href="/log/syslog/syslog_test.go.html#8349305">addr</a></span><span class="op" id="8349438">,</span>&nbsp;<span class="ident" id="8349440"><a href="/log/syslog/syslog.go.html#5674056">LOG_USER</a></span><span class="op" id="8349448">|</span><span class="ident" id="8349449"><a href="/log/syslog/syslog.go.html#5673846">LOG_ERR</a></span><span class="op" id="8349456">,</span>&nbsp;<span class="string" id="8349458">&#34;how&#39;s&nbsp;it&nbsp;going?&#34;</span><span class="op" id="8349475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349478">if</span>&nbsp;<span class="ident" id="8349481"><a href="/log/syslog/syslog_test.go.html#8349415">err</a></span>&nbsp;<span class="op" id="8349485">!=</span>&nbsp;<span class="ident" id="8349488">nil</span>&nbsp;<span class="op" id="8349492">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349496"><a href="/log/syslog/syslog_test.go.html#8349288">t</a></span><span class="op" id="8349497">.</span><span class="ident" id="8349498">Fatalf</span><span class="op" id="8349504">(</span><span class="string" id="8349505">&#34;syslog.Dial()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8349531">,</span>&nbsp;<span class="ident" id="8349533"><a href="/log/syslog/syslog_test.go.html#8349415">err</a></span><span class="op" id="8349536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349542">var</span>&nbsp;<span class="ident" id="8349546">wg</span>&nbsp;<span class="ident" id="8349549"><a href="/log/syslog/syslog_test.go.html#8343276">sync</a></span><span class="op" id="8349553">.</span><span class="ident" id="8349554">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349565">for</span>&nbsp;<span class="ident" id="8349569">i</span>&nbsp;<span class="op" id="8349571">:=</span>&nbsp;<span class="num" id="8349574">0</span><span class="op" id="8349575">;</span>&nbsp;<span class="ident" id="8349577"><a href="/log/syslog/syslog_test.go.html#8349569">i</a></span>&nbsp;<span class="op" id="8349579">&lt;</span>&nbsp;<span class="num" id="8349581">10</span><span class="op" id="8349583">;</span>&nbsp;<span class="ident" id="8349585"><a href="/log/syslog/syslog_test.go.html#8349569">i</a></span><span class="op" id="8349586">++</span>&nbsp;<span class="op" id="8349589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349593"><a href="/log/syslog/syslog_test.go.html#8349546">wg</a></span><span class="op" id="8349595">.</span><span class="ident" id="8349596">Add</span><span class="op" id="8349599">(</span><span class="num" id="8349600">1</span><span class="op" id="8349601">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349605">go</span>&nbsp;<span class="keyword" id="8349608">func</span><span class="op" id="8349612">(</span><span class="op" id="8349613">)</span>&nbsp;<span class="op" id="8349615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349620">defer</span>&nbsp;<span class="ident" id="8349626"><a href="/log/syslog/syslog_test.go.html#8349546">wg</a></span><span class="op" id="8349628">.</span><span class="ident" id="8349629">Done</span><span class="op" id="8349633">(</span><span class="op" id="8349634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349639">err</span>&nbsp;<span class="op" id="8349643">:=</span>&nbsp;<span class="ident" id="8349646"><a href="/log/syslog/syslog_test.go.html#8349412">w</a></span><span class="op" id="8349647">.</span><span class="ident" id="8349648">Info</span><span class="op" id="8349652">(</span><span class="string" id="8349653">&#34;test&#34;</span><span class="op" id="8349659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349664">if</span>&nbsp;<span class="ident" id="8349667"><a href="/log/syslog/syslog_test.go.html#8349639">err</a></span>&nbsp;<span class="op" id="8349671">!=</span>&nbsp;<span class="ident" id="8349674">nil</span>&nbsp;<span class="op" id="8349678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349684"><a href="/log/syslog/syslog_test.go.html#8349288">t</a></span><span class="op" id="8349685">.</span><span class="ident" id="8349686">Errorf</span><span class="op" id="8349692">(</span><span class="string" id="8349693">&#34;Info()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8349712">,</span>&nbsp;<span class="ident" id="8349714"><a href="/log/syslog/syslog_test.go.html#8349639">err</a></span><span class="op" id="8349717">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349723">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349737">}</span><span class="op" id="8349738">(</span><span class="op" id="8349739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8349742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349745"><a href="/log/syslog/syslog_test.go.html#8349546">wg</a></span><span class="op" id="8349747">.</span><span class="ident" id="8349748">Wait</span><span class="op" id="8349752">(</span><span class="op" id="8349753">)</span><br>
<span class="lineno">300</span><span class="op" id="8349755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8349758">func</span>&nbsp;<span class="ident" id="8349763">TestConcurrentReconnect</span><span class="op" id="8349786">(</span><span class="ident" id="8349787">t</span>&nbsp;<span class="op" id="8349789">*</span><span class="ident" id="8349790"><a href="/log/syslog/syslog_test.go.html#8343284">testing</a></span><span class="op" id="8349797">.</span><span class="ident" id="8349798">T</span><span class="op" id="8349799">)</span>&nbsp;<span class="op" id="8349801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349804"><a href="/log/syslog/syslog_test.go.html#8343740">crashy</a></span>&nbsp;<span class="op" id="8349811">=</span>&nbsp;<span class="builtintype" id="8349813">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349819">defer</span>&nbsp;<span class="keyword" id="8349825">func</span><span class="op" id="8349829">(</span><span class="op" id="8349830">)</span>&nbsp;<span class="op" id="8349832">{</span>&nbsp;<span class="ident" id="8349834"><a href="/log/syslog/syslog_test.go.html#8343740">crashy</a></span>&nbsp;<span class="op" id="8349841">=</span>&nbsp;<span class="builtintype" id="8349843">false</span>&nbsp;<span class="op" id="8349849">}</span><span class="op" id="8349850">(</span><span class="op" id="8349851">)</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349855">const</span>&nbsp;<span class="ident" id="8349861">N</span>&nbsp;<span class="op" id="8349863">=</span>&nbsp;<span class="num" id="8349865">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349869">const</span>&nbsp;<span class="ident" id="8349875">M</span>&nbsp;<span class="op" id="8349877">=</span>&nbsp;<span class="num" id="8349879">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349884">net</span>&nbsp;<span class="op" id="8349888">:=</span>&nbsp;<span class="string" id="8349891">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349899">done</span>&nbsp;<span class="op" id="8349904">:=</span>&nbsp;<span class="builtinfunc" id="8349907">make</span><span class="op" id="8349911">(</span><span class="keyword" id="8349912">chan</span>&nbsp;<span class="builtintype" id="8349917">string</span><span class="op" id="8349923">,</span>&nbsp;<span class="ident" id="8349925"><a href="/log/syslog/syslog_test.go.html#8349861">N</a></span><span class="op" id="8349926">*</span><span class="ident" id="8349927"><a href="/log/syslog/syslog_test.go.html#8349875">M</a></span><span class="op" id="8349928">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8349931">addr</span><span class="op" id="8349935">,</span>&nbsp;<span class="ident" id="8349937">sock</span><span class="op" id="8349941">,</span>&nbsp;<span class="ident" id="8349943">srvWG</span>&nbsp;<span class="op" id="8349949">:=</span>&nbsp;<span class="ident" id="8349952"><a href="/log/syslog/syslog_test.go.html#8344229">startServer</a></span><span class="op" id="8349963">(</span><span class="ident" id="8349964"><a href="/log/syslog/syslog_test.go.html#8349884">net</a></span><span class="op" id="8349967">,</span>&nbsp;<span class="string" id="8349969">&#34;&#34;</span><span class="op" id="8349971">,</span>&nbsp;<span class="ident" id="8349973"><a href="/log/syslog/syslog_test.go.html#8349899">done</a></span><span class="op" id="8349977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8349980">defer</span>&nbsp;<span class="ident" id="8349986"><a href="/log/syslog/syslog_test.go.html#8343270">os</a></span><span class="op" id="8349988">.</span><span class="ident" id="8349989">Remove</span><span class="op" id="8349995">(</span><span class="ident" id="8349996"><a href="/log/syslog/syslog_test.go.html#8349931">addr</a></span><span class="op" id="8350000">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8350004">//&nbsp;count&nbsp;all&nbsp;the&nbsp;messages&nbsp;arriving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350040">count</span>&nbsp;<span class="op" id="8350046">:=</span>&nbsp;<span class="builtinfunc" id="8350049">make</span><span class="op" id="8350053">(</span><span class="keyword" id="8350054">chan</span>&nbsp;<span class="builtintype" id="8350059">int</span><span class="op" id="8350062">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350065">go</span>&nbsp;<span class="keyword" id="8350068">func</span><span class="op" id="8350072">(</span><span class="op" id="8350073">)</span>&nbsp;<span class="op" id="8350075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350079">ct</span>&nbsp;<span class="op" id="8350082">:=</span>&nbsp;<span class="num" id="8350085">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350089">for</span>&nbsp;<span class="keyword" id="8350093">range</span>&nbsp;<span class="ident" id="8350099"><a href="/log/syslog/syslog_test.go.html#8349899">done</a></span>&nbsp;<span class="op" id="8350104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350109"><a href="/log/syslog/syslog_test.go.html#8350079">ct</a></span><span class="op" id="8350111">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8350117">//&nbsp;we&nbsp;are&nbsp;looking&nbsp;for&nbsp;500&nbsp;out&nbsp;of&nbsp;1000&nbsp;events</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8350165">//&nbsp;here&nbsp;because&nbsp;lots&nbsp;of&nbsp;log&nbsp;messages&nbsp;are&nbsp;lost</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8350214">//&nbsp;in&nbsp;buffers&nbsp;(kernel&nbsp;and/or&nbsp;bufio)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350253">if</span>&nbsp;<span class="ident" id="8350256"><a href="/log/syslog/syslog_test.go.html#8350079">ct</a></span>&nbsp;<span class="op" id="8350259">&gt;</span>&nbsp;<span class="ident" id="8350261"><a href="/log/syslog/syslog_test.go.html#8349861">N</a></span><span class="op" id="8350262">*</span><span class="ident" id="8350263"><a href="/log/syslog/syslog_test.go.html#8349875">M</a></span><span class="op" id="8350264">/</span><span class="num" id="8350265">2</span>&nbsp;<span class="op" id="8350267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350273">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350282">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350290"><a href="/log/syslog/syslog_test.go.html#8350040">count</a></span>&nbsp;<span class="op" id="8350296">&lt;-</span>&nbsp;<span class="ident" id="8350299"><a href="/log/syslog/syslog_test.go.html#8350079">ct</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350303">}</span><span class="op" id="8350304">(</span><span class="op" id="8350305">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350309">var</span>&nbsp;<span class="ident" id="8350313">wg</span>&nbsp;<span class="ident" id="8350316"><a href="/log/syslog/syslog_test.go.html#8343276">sync</a></span><span class="op" id="8350320">.</span><span class="ident" id="8350321">WaitGroup</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350332"><a href="/log/syslog/syslog_test.go.html#8350313">wg</a></span><span class="op" id="8350334">.</span><span class="ident" id="8350335">Add</span><span class="op" id="8350338">(</span><span class="ident" id="8350339"><a href="/log/syslog/syslog_test.go.html#8349861">N</a></span><span class="op" id="8350340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350343">for</span>&nbsp;<span class="ident" id="8350347">i</span>&nbsp;<span class="op" id="8350349">:=</span>&nbsp;<span class="num" id="8350352">0</span><span class="op" id="8350353">;</span>&nbsp;<span class="ident" id="8350355"><a href="/log/syslog/syslog_test.go.html#8350347">i</a></span>&nbsp;<span class="op" id="8350357">&lt;</span>&nbsp;<span class="ident" id="8350359"><a href="/log/syslog/syslog_test.go.html#8349861">N</a></span><span class="op" id="8350360">;</span>&nbsp;<span class="ident" id="8350362"><a href="/log/syslog/syslog_test.go.html#8350347">i</a></span><span class="op" id="8350363">++</span>&nbsp;<span class="op" id="8350366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350370">go</span>&nbsp;<span class="keyword" id="8350373">func</span><span class="op" id="8350377">(</span><span class="op" id="8350378">)</span>&nbsp;<span class="op" id="8350380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350385">defer</span>&nbsp;<span class="ident" id="8350391"><a href="/log/syslog/syslog_test.go.html#8350313">wg</a></span><span class="op" id="8350393">.</span><span class="ident" id="8350394">Done</span><span class="op" id="8350398">(</span><span class="op" id="8350399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350404">w</span><span class="op" id="8350405">,</span>&nbsp;<span class="ident" id="8350407">err</span>&nbsp;<span class="op" id="8350411">:=</span>&nbsp;<span class="ident" id="8350414"><a href="/log/syslog/syslog.go.html#5675608">Dial</a></span><span class="op" id="8350418">(</span><span class="ident" id="8350419"><a href="/log/syslog/syslog_test.go.html#8349884">net</a></span><span class="op" id="8350422">,</span>&nbsp;<span class="ident" id="8350424"><a href="/log/syslog/syslog_test.go.html#8349931">addr</a></span><span class="op" id="8350428">,</span>&nbsp;<span class="ident" id="8350430"><a href="/log/syslog/syslog.go.html#5674056">LOG_USER</a></span><span class="op" id="8350438">|</span><span class="ident" id="8350439"><a href="/log/syslog/syslog.go.html#5673846">LOG_ERR</a></span><span class="op" id="8350446">,</span>&nbsp;<span class="string" id="8350448">&#34;tag&#34;</span><span class="op" id="8350453">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350458">if</span>&nbsp;<span class="ident" id="8350461"><a href="/log/syslog/syslog_test.go.html#8350407">err</a></span>&nbsp;<span class="op" id="8350465">!=</span>&nbsp;<span class="ident" id="8350468">nil</span>&nbsp;<span class="op" id="8350472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350478"><a href="/log/syslog/syslog_test.go.html#8349787">t</a></span><span class="op" id="8350479">.</span><span class="ident" id="8350480">Fatalf</span><span class="op" id="8350486">(</span><span class="string" id="8350487">&#34;syslog.Dial()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8350513">,</span>&nbsp;<span class="ident" id="8350515"><a href="/log/syslog/syslog_test.go.html#8350407">err</a></span><span class="op" id="8350518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350528">defer</span>&nbsp;<span class="ident" id="8350534"><a href="/log/syslog/syslog_test.go.html#8350404">w</a></span><span class="op" id="8350535">.</span><span class="ident" id="8350536">Close</span><span class="op" id="8350541">(</span><span class="op" id="8350542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350547">for</span>&nbsp;<span class="ident" id="8350551">i</span>&nbsp;<span class="op" id="8350553">:=</span>&nbsp;<span class="num" id="8350556">0</span><span class="op" id="8350557">;</span>&nbsp;<span class="ident" id="8350559"><a href="/log/syslog/syslog_test.go.html#8350551">i</a></span>&nbsp;<span class="op" id="8350561">&lt;</span>&nbsp;<span class="ident" id="8350563"><a href="/log/syslog/syslog_test.go.html#8349875">M</a></span><span class="op" id="8350564">;</span>&nbsp;<span class="ident" id="8350566"><a href="/log/syslog/syslog_test.go.html#8350551">i</a></span><span class="op" id="8350567">++</span>&nbsp;<span class="op" id="8350570">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350576">err</span>&nbsp;<span class="op" id="8350580">:=</span>&nbsp;<span class="ident" id="8350583"><a href="/log/syslog/syslog_test.go.html#8350404">w</a></span><span class="op" id="8350584">.</span><span class="ident" id="8350585">Info</span><span class="op" id="8350589">(</span><span class="string" id="8350590">&#34;test&#34;</span><span class="op" id="8350596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350602">if</span>&nbsp;<span class="ident" id="8350605"><a href="/log/syslog/syslog_test.go.html#8350576">err</a></span>&nbsp;<span class="op" id="8350609">!=</span>&nbsp;<span class="ident" id="8350612">nil</span>&nbsp;<span class="op" id="8350616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350623"><a href="/log/syslog/syslog_test.go.html#8349787">t</a></span><span class="op" id="8350624">.</span><span class="ident" id="8350625">Errorf</span><span class="op" id="8350631">(</span><span class="string" id="8350632">&#34;Info()&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8350651">,</span>&nbsp;<span class="ident" id="8350653"><a href="/log/syslog/syslog_test.go.html#8350576">err</a></span><span class="op" id="8350656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350663">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350674">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350683">}</span><span class="op" id="8350684">(</span><span class="op" id="8350685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350691"><a href="/log/syslog/syslog_test.go.html#8350313">wg</a></span><span class="op" id="8350693">.</span><span class="ident" id="8350694">Wait</span><span class="op" id="8350698">(</span><span class="op" id="8350699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350702"><a href="/log/syslog/syslog_test.go.html#8349937">sock</a></span><span class="op" id="8350706">.</span><span class="ident" id="8350707">Close</span><span class="op" id="8350712">(</span><span class="op" id="8350713">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350716"><a href="/log/syslog/syslog_test.go.html#8349943">srvWG</a></span><span class="op" id="8350721">.</span><span class="ident" id="8350722">Wait</span><span class="op" id="8350726">(</span><span class="op" id="8350727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8350730">close</span><span class="op" id="8350735">(</span><span class="ident" id="8350736"><a href="/log/syslog/syslog_test.go.html#8349899">done</a></span><span class="op" id="8350740">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350744">select</span>&nbsp;<span class="op" id="8350751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350754">case</span>&nbsp;<span class="op" id="8350759">&lt;-</span><span class="ident" id="8350761"><a href="/log/syslog/syslog_test.go.html#8350040">count</a></span><span class="op" id="8350766">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8350769">case</span>&nbsp;<span class="op" id="8350774">&lt;-</span><span class="ident" id="8350776"><a href="/log/syslog/syslog_test.go.html#8343295">time</a></span><span class="op" id="8350780">.</span><span class="ident" id="8350781">After</span><span class="op" id="8350786">(</span><span class="num" id="8350787">100</span>&nbsp;<span class="op" id="8350791">*</span>&nbsp;<span class="ident" id="8350793"><a href="/log/syslog/syslog_test.go.html#8343295">time</a></span><span class="op" id="8350797">.</span><span class="ident" id="8350798">Millisecond</span><span class="op" id="8350809">)</span><span class="op" id="8350810">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8350814"><a href="/log/syslog/syslog_test.go.html#8349787">t</a></span><span class="op" id="8350815">.</span><span class="ident" id="8350816">Error</span><span class="op" id="8350821">(</span><span class="string" id="8350822">&#34;timeout&nbsp;in&nbsp;concurrent&nbsp;reconnect&#34;</span><span class="op" id="8350855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8350858">}</span><br>
<span class="lineno"></span><span class="op" id="8350860">}</span>
</div>
</body>
</html>
