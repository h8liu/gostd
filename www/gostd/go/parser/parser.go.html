<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html" class="current">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5622764">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5622819">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5622873">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5622924">//&nbsp;Package&nbsp;parser&nbsp;implements&nbsp;a&nbsp;parser&nbsp;for&nbsp;Go&nbsp;source&nbsp;files.&nbsp;Input&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5622996">//&nbsp;provided&nbsp;in&nbsp;a&nbsp;variety&nbsp;of&nbsp;forms&nbsp;(see&nbsp;the&nbsp;various&nbsp;Parse*&nbsp;functions);&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5623070">//&nbsp;output&nbsp;is&nbsp;an&nbsp;abstract&nbsp;syntax&nbsp;tree&nbsp;(AST)&nbsp;representing&nbsp;the&nbsp;Go&nbsp;source.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5623145">//&nbsp;parser&nbsp;is&nbsp;invoked&nbsp;through&nbsp;one&nbsp;of&nbsp;the&nbsp;Parse*&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5623203">//</span><br>
<span class="lineno">10</span><span class="keyword" id="5623206">package</span>&nbsp;<span class="ident" id="5623214">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5623222">import</span>&nbsp;<span class="op" id="5623229">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5623232">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5623239">&#34;go/ast&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5623249">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5623263">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5623275">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5623286">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5623297">&#34;unicode&#34;</span><br>
<span class="lineno">20</span><span class="op" id="5623307">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5623310">//&nbsp;The&nbsp;parser&nbsp;structure&nbsp;holds&nbsp;the&nbsp;parser&#39;s&nbsp;internal&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5623369">type</span>&nbsp;<span class="ident" id="5623374">parser</span>&nbsp;<span class="keyword" id="5623381">struct</span>&nbsp;<span class="op" id="5623388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623391">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5623399">*</span><span class="ident" id="5623400">token</span><span class="op" id="5623405">.</span><span class="ident" id="5623406">File</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623412">errors</span>&nbsp;&nbsp;<span class="ident" id="5623420">scanner</span><span class="op" id="5623427">.</span><span class="ident" id="5623428">ErrorList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623439">scanner</span>&nbsp;<span class="ident" id="5623447">scanner</span><span class="op" id="5623454">.</span><span class="ident" id="5623455">Scanner</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5623465">//&nbsp;Tracing/debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623487">mode</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5623494">Mode</span>&nbsp;<span class="comment" id="5623499">//&nbsp;parsing&nbsp;mode</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623516">trace</span>&nbsp;&nbsp;<span class="builtintype" id="5623523">bool</span>&nbsp;<span class="comment" id="5623528">//&nbsp;==&nbsp;(mode&nbsp;&amp;&nbsp;Trace&nbsp;!=&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623555">indent</span>&nbsp;<span class="builtintype" id="5623562">int</span>&nbsp;&nbsp;<span class="comment" id="5623567">//&nbsp;indentation&nbsp;used&nbsp;for&nbsp;tracing&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5623608">//&nbsp;Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623621">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5623633">[</span><span class="op" id="5623634">]</span><span class="op" id="5623635">*</span><span class="ident" id="5623636">ast</span><span class="op" id="5623639">.</span><span class="ident" id="5623640">CommentGroup</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623654">leadComment</span>&nbsp;<span class="op" id="5623666">*</span><span class="ident" id="5623667">ast</span><span class="op" id="5623670">.</span><span class="ident" id="5623671">CommentGroup</span>&nbsp;<span class="comment" id="5623684">//&nbsp;last&nbsp;lead&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623706">lineComment</span>&nbsp;<span class="op" id="5623718">*</span><span class="ident" id="5623719">ast</span><span class="op" id="5623722">.</span><span class="ident" id="5623723">CommentGroup</span>&nbsp;<span class="comment" id="5623736">//&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5623759">//&nbsp;Next&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623774">pos</span>&nbsp;<span class="ident" id="5623778">token</span><span class="op" id="5623783">.</span><span class="ident" id="5623784">Pos</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5623790">//&nbsp;token&nbsp;position</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623809">tok</span>&nbsp;<span class="ident" id="5623813">token</span><span class="op" id="5623818">.</span><span class="ident" id="5623819">Token</span>&nbsp;<span class="comment" id="5623825">//&nbsp;one&nbsp;token&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5623850">lit</span>&nbsp;<span class="builtintype" id="5623854">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5623866">//&nbsp;token&nbsp;literal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5623885">//&nbsp;Error&nbsp;recovery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5623904">//&nbsp;(used&nbsp;to&nbsp;limit&nbsp;the&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;functions</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5623964">//&nbsp;w/o&nbsp;making&nbsp;scanning&nbsp;progress&nbsp;-&nbsp;avoids&nbsp;potential&nbsp;endless</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5624024">//&nbsp;loops&nbsp;across&nbsp;multiple&nbsp;parser&nbsp;functions&nbsp;during&nbsp;error&nbsp;recovery)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624090">syncPos</span>&nbsp;<span class="ident" id="5624098">token</span><span class="op" id="5624103">.</span><span class="ident" id="5624104">Pos</span>&nbsp;<span class="comment" id="5624108">//&nbsp;last&nbsp;synchronization&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624142">syncCnt</span>&nbsp;<span class="builtintype" id="5624150">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5624160">//&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;without&nbsp;progress</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5624209">//&nbsp;Non-syntactic&nbsp;parser&nbsp;control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624242">exprLev</span>&nbsp;<span class="builtintype" id="5624250">int</span>&nbsp;&nbsp;<span class="comment" id="5624255">//&nbsp;&lt;&nbsp;0:&nbsp;in&nbsp;control&nbsp;clause,&nbsp;&gt;=&nbsp;0:&nbsp;in&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624303">inRhs</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5624311">bool</span>&nbsp;<span class="comment" id="5624316">//&nbsp;if&nbsp;set,&nbsp;the&nbsp;parser&nbsp;is&nbsp;parsing&nbsp;a&nbsp;rhs&nbsp;expression</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5624368">//&nbsp;Ordinary&nbsp;identifier&nbsp;scopes</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624399">pkgScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5624410">*</span><span class="ident" id="5624411">ast</span><span class="op" id="5624414">.</span><span class="ident" id="5624415">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5624428">//&nbsp;pkgScope.Outer&nbsp;==&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624454">topScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5624465">*</span><span class="ident" id="5624466">ast</span><span class="op" id="5624469">.</span><span class="ident" id="5624470">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5624483">//&nbsp;top-most&nbsp;scope;&nbsp;may&nbsp;be&nbsp;pkgScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624519">unresolved</span>&nbsp;<span class="op" id="5624530">[</span><span class="op" id="5624531">]</span><span class="op" id="5624532">*</span><span class="ident" id="5624533">ast</span><span class="op" id="5624536">.</span><span class="ident" id="5624537">Ident</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5624548">//&nbsp;unresolved&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624575">imports</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5624586">[</span><span class="op" id="5624587">]</span><span class="op" id="5624588">*</span><span class="ident" id="5624589">ast</span><span class="op" id="5624592">.</span><span class="ident" id="5624593">ImportSpec</span>&nbsp;<span class="comment" id="5624604">//&nbsp;list&nbsp;of&nbsp;imports</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5624625">//&nbsp;Label&nbsp;scopes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5624642">//&nbsp;(maintained&nbsp;by&nbsp;open/close&nbsp;LabelScope)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624684">labelScope</span>&nbsp;&nbsp;<span class="op" id="5624696">*</span><span class="ident" id="5624697">ast</span><span class="op" id="5624700">.</span><span class="ident" id="5624701">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5624711">//&nbsp;label&nbsp;scope&nbsp;for&nbsp;current&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624748">targetStack</span>&nbsp;<span class="op" id="5624760">[</span><span class="op" id="5624761">]</span><span class="op" id="5624762">[</span><span class="op" id="5624763">]</span><span class="op" id="5624764">*</span><span class="ident" id="5624765">ast</span><span class="op" id="5624768">.</span><span class="ident" id="5624769">Ident</span>&nbsp;<span class="comment" id="5624775">//&nbsp;stack&nbsp;of&nbsp;unresolved&nbsp;labels</span><br>
<span class="lineno"></span><span class="op" id="5624805">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="5624808">func</span>&nbsp;<span class="op" id="5624813">(</span><span class="ident" id="5624814">p</span>&nbsp;<span class="op" id="5624816">*</span><span class="ident" id="5624817">parser</span><span class="op" id="5624823">)</span>&nbsp;<span class="ident" id="5624825">init</span><span class="op" id="5624829">(</span><span class="ident" id="5624830">fset</span>&nbsp;<span class="op" id="5624835">*</span><span class="ident" id="5624836">token</span><span class="op" id="5624841">.</span><span class="ident" id="5624842">FileSet</span><span class="op" id="5624849">,</span>&nbsp;<span class="ident" id="5624851">filename</span>&nbsp;<span class="builtintype" id="5624860">string</span><span class="op" id="5624866">,</span>&nbsp;<span class="ident" id="5624868">src</span>&nbsp;<span class="op" id="5624872">[</span><span class="op" id="5624873">]</span><span class="builtintype" id="5624874">byte</span><span class="op" id="5624878">,</span>&nbsp;<span class="ident" id="5624880">mode</span>&nbsp;<span class="ident" id="5624885">Mode</span><span class="op" id="5624889">)</span>&nbsp;<span class="op" id="5624891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624894">p</span><span class="op" id="5624895">.</span><span class="ident" id="5624896">file</span>&nbsp;<span class="op" id="5624901">=</span>&nbsp;<span class="ident" id="5624903">fset</span><span class="op" id="5624907">.</span><span class="ident" id="5624908">AddFile</span><span class="op" id="5624915">(</span><span class="ident" id="5624916">filename</span><span class="op" id="5624924">,</span>&nbsp;<span class="op" id="5624926">-</span><span class="num" id="5624927">1</span><span class="op" id="5624928">,</span>&nbsp;<span class="builtinfunc" id="5624930">len</span><span class="op" id="5624933">(</span><span class="ident" id="5624934">src</span><span class="op" id="5624937">)</span><span class="op" id="5624938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624941">var</span>&nbsp;<span class="ident" id="5624945">m</span>&nbsp;<span class="ident" id="5624947">scanner</span><span class="op" id="5624954">.</span><span class="ident" id="5624955">Mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5624961">if</span>&nbsp;<span class="ident" id="5624964">mode</span><span class="op" id="5624968">&amp;</span><span class="ident" id="5624969">ParseComments</span>&nbsp;<span class="op" id="5624983">!=</span>&nbsp;<span class="num" id="5624986">0</span>&nbsp;<span class="op" id="5624988">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5624992">m</span>&nbsp;<span class="op" id="5624994">=</span>&nbsp;<span class="ident" id="5624996">scanner</span><span class="op" id="5625003">.</span><span class="ident" id="5625004">ScanComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5625018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625021">eh</span>&nbsp;<span class="op" id="5625024">:=</span>&nbsp;<span class="keyword" id="5625027">func</span><span class="op" id="5625031">(</span><span class="ident" id="5625032">pos</span>&nbsp;<span class="ident" id="5625036">token</span><span class="op" id="5625041">.</span><span class="ident" id="5625042">Position</span><span class="op" id="5625050">,</span>&nbsp;<span class="ident" id="5625052">msg</span>&nbsp;<span class="builtintype" id="5625056">string</span><span class="op" id="5625062">)</span>&nbsp;<span class="op" id="5625064">{</span>&nbsp;<span class="ident" id="5625066">p</span><span class="op" id="5625067">.</span><span class="ident" id="5625068">errors</span><span class="op" id="5625074">.</span><span class="ident" id="5625075">Add</span><span class="op" id="5625078">(</span><span class="ident" id="5625079">pos</span><span class="op" id="5625082">,</span>&nbsp;<span class="ident" id="5625084">msg</span><span class="op" id="5625087">)</span>&nbsp;<span class="op" id="5625089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625092">p</span><span class="op" id="5625093">.</span><span class="ident" id="5625094">scanner</span><span class="op" id="5625101">.</span><span class="ident" id="5625102">Init</span><span class="op" id="5625106">(</span><span class="ident" id="5625107">p</span><span class="op" id="5625108">.</span><span class="ident" id="5625109">file</span><span class="op" id="5625113">,</span>&nbsp;<span class="ident" id="5625115">src</span><span class="op" id="5625118">,</span>&nbsp;<span class="ident" id="5625120">eh</span><span class="op" id="5625122">,</span>&nbsp;<span class="ident" id="5625124">m</span><span class="op" id="5625125">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625129">p</span><span class="op" id="5625130">.</span><span class="ident" id="5625131">mode</span>&nbsp;<span class="op" id="5625136">=</span>&nbsp;<span class="ident" id="5625138">mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625144">p</span><span class="op" id="5625145">.</span><span class="ident" id="5625146">trace</span>&nbsp;<span class="op" id="5625152">=</span>&nbsp;<span class="ident" id="5625154">mode</span><span class="op" id="5625158">&amp;</span><span class="ident" id="5625159">Trace</span>&nbsp;<span class="op" id="5625165">!=</span>&nbsp;<span class="num" id="5625168">0</span>&nbsp;<span class="comment" id="5625170">//&nbsp;for&nbsp;convenience&nbsp;(p.trace&nbsp;is&nbsp;used&nbsp;frequently)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625220">p</span><span class="op" id="5625221">.</span><span class="ident" id="5625222">next</span><span class="op" id="5625226">(</span><span class="op" id="5625227">)</span><br>
<span class="lineno"></span><span class="op" id="5625229">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="5625232">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5625312">//&nbsp;Scoping&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5625332">func</span>&nbsp;<span class="op" id="5625337">(</span><span class="ident" id="5625338">p</span>&nbsp;<span class="op" id="5625340">*</span><span class="ident" id="5625341">parser</span><span class="op" id="5625347">)</span>&nbsp;<span class="ident" id="5625349">openScope</span><span class="op" id="5625358">(</span><span class="op" id="5625359">)</span>&nbsp;<span class="op" id="5625361">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625364">p</span><span class="op" id="5625365">.</span><span class="ident" id="5625366">topScope</span>&nbsp;<span class="op" id="5625375">=</span>&nbsp;<span class="ident" id="5625377">ast</span><span class="op" id="5625380">.</span><span class="ident" id="5625381">NewScope</span><span class="op" id="5625389">(</span><span class="ident" id="5625390">p</span><span class="op" id="5625391">.</span><span class="ident" id="5625392">topScope</span><span class="op" id="5625400">)</span><br>
<span class="lineno"></span><span class="op" id="5625402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5625405">func</span>&nbsp;<span class="op" id="5625410">(</span><span class="ident" id="5625411">p</span>&nbsp;<span class="op" id="5625413">*</span><span class="ident" id="5625414">parser</span><span class="op" id="5625420">)</span>&nbsp;<span class="ident" id="5625422">closeScope</span><span class="op" id="5625432">(</span><span class="op" id="5625433">)</span>&nbsp;<span class="op" id="5625435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625438">p</span><span class="op" id="5625439">.</span><span class="ident" id="5625440">topScope</span>&nbsp;<span class="op" id="5625449">=</span>&nbsp;<span class="ident" id="5625451">p</span><span class="op" id="5625452">.</span><span class="ident" id="5625453">topScope</span><span class="op" id="5625461">.</span><span class="ident" id="5625462">Outer</span><br>
<span class="lineno">90</span><span class="op" id="5625468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5625471">func</span>&nbsp;<span class="op" id="5625476">(</span><span class="ident" id="5625477">p</span>&nbsp;<span class="op" id="5625479">*</span><span class="ident" id="5625480">parser</span><span class="op" id="5625486">)</span>&nbsp;<span class="ident" id="5625488">openLabelScope</span><span class="op" id="5625502">(</span><span class="op" id="5625503">)</span>&nbsp;<span class="op" id="5625505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625508">p</span><span class="op" id="5625509">.</span><span class="ident" id="5625510">labelScope</span>&nbsp;<span class="op" id="5625521">=</span>&nbsp;<span class="ident" id="5625523">ast</span><span class="op" id="5625526">.</span><span class="ident" id="5625527">NewScope</span><span class="op" id="5625535">(</span><span class="ident" id="5625536">p</span><span class="op" id="5625537">.</span><span class="ident" id="5625538">labelScope</span><span class="op" id="5625548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625551">p</span><span class="op" id="5625552">.</span><span class="ident" id="5625553">targetStack</span>&nbsp;<span class="op" id="5625565">=</span>&nbsp;<span class="builtinfunc" id="5625567">append</span><span class="op" id="5625573">(</span><span class="ident" id="5625574">p</span><span class="op" id="5625575">.</span><span class="ident" id="5625576">targetStack</span><span class="op" id="5625587">,</span>&nbsp;<span class="ident" id="5625589">nil</span><span class="op" id="5625592">)</span><br>
<span class="lineno">95</span><span class="op" id="5625594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5625597">func</span>&nbsp;<span class="op" id="5625602">(</span><span class="ident" id="5625603">p</span>&nbsp;<span class="op" id="5625605">*</span><span class="ident" id="5625606">parser</span><span class="op" id="5625612">)</span>&nbsp;<span class="ident" id="5625614">closeLabelScope</span><span class="op" id="5625629">(</span><span class="op" id="5625630">)</span>&nbsp;<span class="op" id="5625632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5625635">//&nbsp;resolve&nbsp;labels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625654">n</span>&nbsp;<span class="op" id="5625656">:=</span>&nbsp;<span class="builtinfunc" id="5625659">len</span><span class="op" id="5625662">(</span><span class="ident" id="5625663">p</span><span class="op" id="5625664">.</span><span class="ident" id="5625665">targetStack</span><span class="op" id="5625676">)</span>&nbsp;<span class="op" id="5625678">-</span>&nbsp;<span class="num" id="5625680">1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625683">scope</span>&nbsp;<span class="op" id="5625689">:=</span>&nbsp;<span class="ident" id="5625692">p</span><span class="op" id="5625693">.</span><span class="ident" id="5625694">labelScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5625706">for</span>&nbsp;<span class="ident" id="5625710">_</span><span class="op" id="5625711">,</span>&nbsp;<span class="ident" id="5625713">ident</span>&nbsp;<span class="op" id="5625719">:=</span>&nbsp;<span class="keyword" id="5625722">range</span>&nbsp;<span class="ident" id="5625728">p</span><span class="op" id="5625729">.</span><span class="ident" id="5625730">targetStack</span><span class="op" id="5625741">[</span><span class="ident" id="5625742">n</span><span class="op" id="5625743">]</span>&nbsp;<span class="op" id="5625745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625749">ident</span><span class="op" id="5625754">.</span><span class="ident" id="5625755">Obj</span>&nbsp;<span class="op" id="5625759">=</span>&nbsp;<span class="ident" id="5625761">scope</span><span class="op" id="5625766">.</span><span class="ident" id="5625767">Lookup</span><span class="op" id="5625773">(</span><span class="ident" id="5625774">ident</span><span class="op" id="5625779">.</span><span class="ident" id="5625780">Name</span><span class="op" id="5625784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5625788">if</span>&nbsp;<span class="ident" id="5625791">ident</span><span class="op" id="5625796">.</span><span class="ident" id="5625797">Obj</span>&nbsp;<span class="op" id="5625801">==</span>&nbsp;<span class="ident" id="5625804">nil</span>&nbsp;<span class="op" id="5625808">&amp;&amp;</span>&nbsp;<span class="ident" id="5625811">p</span><span class="op" id="5625812">.</span><span class="ident" id="5625813">mode</span><span class="op" id="5625817">&amp;</span><span class="ident" id="5625818">DeclarationErrors</span>&nbsp;<span class="op" id="5625836">!=</span>&nbsp;<span class="num" id="5625839">0</span>&nbsp;<span class="op" id="5625841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625846">p</span><span class="op" id="5625847">.</span><span class="builtintype" id="5625848">error</span><span class="op" id="5625853">(</span><span class="ident" id="5625854">ident</span><span class="op" id="5625859">.</span><span class="ident" id="5625860">Pos</span><span class="op" id="5625863">(</span><span class="op" id="5625864">)</span><span class="op" id="5625865">,</span>&nbsp;<span class="ident" id="5625867">fmt</span><span class="op" id="5625870">.</span><span class="ident" id="5625871">Sprintf</span><span class="op" id="5625878">(</span><span class="string" id="5625879">&#34;label&nbsp;%s&nbsp;undefined&#34;</span><span class="op" id="5625899">,</span>&nbsp;<span class="ident" id="5625901">ident</span><span class="op" id="5625906">.</span><span class="ident" id="5625907">Name</span><span class="op" id="5625911">)</span><span class="op" id="5625912">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5625916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5625919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5625922">//&nbsp;pop&nbsp;label&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625942">p</span><span class="op" id="5625943">.</span><span class="ident" id="5625944">targetStack</span>&nbsp;<span class="op" id="5625956">=</span>&nbsp;<span class="ident" id="5625958">p</span><span class="op" id="5625959">.</span><span class="ident" id="5625960">targetStack</span><span class="op" id="5625971">[</span><span class="num" id="5625972">0</span><span class="op" id="5625973">:</span><span class="ident" id="5625974">n</span><span class="op" id="5625975">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5625978">p</span><span class="op" id="5625979">.</span><span class="ident" id="5625980">labelScope</span>&nbsp;<span class="op" id="5625991">=</span>&nbsp;<span class="ident" id="5625993">p</span><span class="op" id="5625994">.</span><span class="ident" id="5625995">labelScope</span><span class="op" id="5626005">.</span><span class="ident" id="5626006">Outer</span><br>
<span class="lineno">110</span><span class="op" id="5626012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5626015">func</span>&nbsp;<span class="op" id="5626020">(</span><span class="ident" id="5626021">p</span>&nbsp;<span class="op" id="5626023">*</span><span class="ident" id="5626024">parser</span><span class="op" id="5626030">)</span>&nbsp;<span class="ident" id="5626032">declare</span><span class="op" id="5626039">(</span><span class="ident" id="5626040">decl</span><span class="op" id="5626044">,</span>&nbsp;<span class="ident" id="5626046">data</span>&nbsp;<span class="keyword" id="5626051">interface</span><span class="op" id="5626060">{</span><span class="op" id="5626061">}</span><span class="op" id="5626062">,</span>&nbsp;<span class="ident" id="5626064">scope</span>&nbsp;<span class="op" id="5626070">*</span><span class="ident" id="5626071">ast</span><span class="op" id="5626074">.</span><span class="ident" id="5626075">Scope</span><span class="op" id="5626080">,</span>&nbsp;<span class="ident" id="5626082">kind</span>&nbsp;<span class="ident" id="5626087">ast</span><span class="op" id="5626090">.</span><span class="ident" id="5626091">ObjKind</span><span class="op" id="5626098">,</span>&nbsp;<span class="ident" id="5626100">idents</span>&nbsp;<span class="op" id="5626107">...</span><span class="op" id="5626110">*</span><span class="ident" id="5626111">ast</span><span class="op" id="5626114">.</span><span class="ident" id="5626115">Ident</span><span class="op" id="5626120">)</span>&nbsp;<span class="op" id="5626122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5626125">for</span>&nbsp;<span class="ident" id="5626129">_</span><span class="op" id="5626130">,</span>&nbsp;<span class="ident" id="5626132">ident</span>&nbsp;<span class="op" id="5626138">:=</span>&nbsp;<span class="keyword" id="5626141">range</span>&nbsp;<span class="ident" id="5626147">idents</span>&nbsp;<span class="op" id="5626154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5626158">assert</span><span class="op" id="5626164">(</span><span class="ident" id="5626165">ident</span><span class="op" id="5626170">.</span><span class="ident" id="5626171">Obj</span>&nbsp;<span class="op" id="5626175">==</span>&nbsp;<span class="ident" id="5626178">nil</span><span class="op" id="5626181">,</span>&nbsp;<span class="string" id="5626183">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="5626224">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5626228">obj</span>&nbsp;<span class="op" id="5626232">:=</span>&nbsp;<span class="ident" id="5626235">ast</span><span class="op" id="5626238">.</span><span class="ident" id="5626239">NewObj</span><span class="op" id="5626245">(</span><span class="ident" id="5626246">kind</span><span class="op" id="5626250">,</span>&nbsp;<span class="ident" id="5626252">ident</span><span class="op" id="5626257">.</span><span class="ident" id="5626258">Name</span><span class="op" id="5626262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5626266">//&nbsp;remember&nbsp;the&nbsp;corresponding&nbsp;declaration&nbsp;for&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5626328">//&nbsp;errors&nbsp;and&nbsp;global&nbsp;variable&nbsp;resolution/typechecking&nbsp;phase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5626390">obj</span><span class="op" id="5626393">.</span><span class="ident" id="5626394">Decl</span>&nbsp;<span class="op" id="5626399">=</span>&nbsp;<span class="ident" id="5626401">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5626408">obj</span><span class="op" id="5626411">.</span><span class="ident" id="5626412">Data</span>&nbsp;<span class="op" id="5626417">=</span>&nbsp;<span class="ident" id="5626419">data</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5626426">ident</span><span class="op" id="5626431">.</span><span class="ident" id="5626432">Obj</span>&nbsp;<span class="op" id="5626436">=</span>&nbsp;<span class="ident" id="5626438">obj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5626444">if</span>&nbsp;<span class="ident" id="5626447">ident</span><span class="op" id="5626452">.</span><span class="ident" id="5626453">Name</span>&nbsp;<span class="op" id="5626458">!=</span>&nbsp;<span class="string" id="5626461">&#34;_&#34;</span>&nbsp;<span class="op" id="5626465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5626470">if</span>&nbsp;<span class="ident" id="5626473">alt</span>&nbsp;<span class="op" id="5626477">:=</span>&nbsp;<span class="ident" id="5626480">scope</span><span class="op" id="5626485">.</span><span class="ident" id="5626486">Insert</span><span class="op" id="5626492">(</span><span class="ident" id="5626493">obj</span><span class="op" id="5626496">)</span><span class="op" id="5626497">;</span>&nbsp;<span class="ident" id="5626499">alt</span>&nbsp;<span class="op" id="5626503">!=</span>&nbsp;<span class="ident" id="5626506">nil</span>&nbsp;<span class="op" id="5626510">&amp;&amp;</span>&nbsp;<span class="ident" id="5626513">p</span><span class="op" id="5626514">.</span><span class="ident" id="5626515">mode</span><span class="op" id="5626519">&amp;</span><span class="ident" id="5626520">DeclarationErrors</span>&nbsp;<span class="op" id="5626538">!=</span>&nbsp;<span class="num" id="5626541">0</span>&nbsp;<span class="op" id="5626543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5626549">prevDecl</span>&nbsp;<span class="op" id="5626558">:=</span>&nbsp;<span class="string" id="5626561">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5626568">if</span>&nbsp;<span class="ident" id="5626571">pos</span>&nbsp;<span class="op" id="5626575">:=</span>&nbsp;<span class="ident" id="5626578">alt</span><span class="op" id="5626581">.</span><span class="ident" id="5626582">Pos</span><span class="op" id="5626585">(</span><span class="op" id="5626586">)</span><span class="op" id="5626587">;</span>&nbsp;<span class="ident" id="5626589">pos</span><span class="op" id="5626592">.</span><span class="ident" id="5626593">IsValid</span><span class="op" id="5626600">(</span><span class="op" id="5626601">)</span>&nbsp;<span class="op" id="5626603">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5626610">prevDecl</span>&nbsp;<span class="op" id="5626619">=</span>&nbsp;<span class="ident" id="5626621">fmt</span><span class="op" id="5626624">.</span><span class="ident" id="5626625">Sprintf</span><span class="op" id="5626632">(</span><span class="string" id="5626633">&#34;\n\tprevious&nbsp;declaration&nbsp;at&nbsp;%s&#34;</span><span class="op" id="5626665">,</span>&nbsp;<span class="ident" id="5626667">p</span><span class="op" id="5626668">.</span><span class="ident" id="5626669">file</span><span class="op" id="5626673">.</span><span class="ident" id="5626674">Position</span><span class="op" id="5626682">(</span><span class="ident" id="5626683">pos</span><span class="op" id="5626686">)</span><span class="op" id="5626687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5626693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5626699">p</span><span class="op" id="5626700">.</span><span class="builtintype" id="5626701">error</span><span class="op" id="5626706">(</span><span class="ident" id="5626707">ident</span><span class="op" id="5626712">.</span><span class="ident" id="5626713">Pos</span><span class="op" id="5626716">(</span><span class="op" id="5626717">)</span><span class="op" id="5626718">,</span>&nbsp;<span class="ident" id="5626720">fmt</span><span class="op" id="5626723">.</span><span class="ident" id="5626724">Sprintf</span><span class="op" id="5626731">(</span><span class="string" id="5626732">&#34;%s&nbsp;redeclared&nbsp;in&nbsp;this&nbsp;block%s&#34;</span><span class="op" id="5626763">,</span>&nbsp;<span class="ident" id="5626765">ident</span><span class="op" id="5626770">.</span><span class="ident" id="5626771">Name</span><span class="op" id="5626775">,</span>&nbsp;<span class="ident" id="5626777">prevDecl</span><span class="op" id="5626785">)</span><span class="op" id="5626786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5626791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5626795">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5626798">}</span><br>
<span class="lineno"></span><span class="op" id="5626800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5626803">func</span>&nbsp;<span class="op" id="5626808">(</span><span class="ident" id="5626809">p</span>&nbsp;<span class="op" id="5626811">*</span><span class="ident" id="5626812">parser</span><span class="op" id="5626818">)</span>&nbsp;<span class="ident" id="5626820">shortVarDecl</span><span class="op" id="5626832">(</span><span class="ident" id="5626833">decl</span>&nbsp;<span class="op" id="5626838">*</span><span class="ident" id="5626839">ast</span><span class="op" id="5626842">.</span><span class="ident" id="5626843">AssignStmt</span><span class="op" id="5626853">,</span>&nbsp;<span class="ident" id="5626855">list</span>&nbsp;<span class="op" id="5626860">[</span><span class="op" id="5626861">]</span><span class="ident" id="5626862">ast</span><span class="op" id="5626865">.</span><span class="ident" id="5626866">Expr</span><span class="op" id="5626870">)</span>&nbsp;<span class="op" id="5626872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5626875">//&nbsp;Go&nbsp;spec:&nbsp;A&nbsp;short&nbsp;variable&nbsp;declaration&nbsp;may&nbsp;redeclare&nbsp;variables</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5626941">//&nbsp;provided&nbsp;they&nbsp;were&nbsp;originally&nbsp;declared&nbsp;in&nbsp;the&nbsp;same&nbsp;block&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5627007">//&nbsp;the&nbsp;same&nbsp;type,&nbsp;and&nbsp;at&nbsp;least&nbsp;one&nbsp;of&nbsp;the&nbsp;non-blank&nbsp;variables&nbsp;is&nbsp;new.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627078">n</span>&nbsp;<span class="op" id="5627080">:=</span>&nbsp;<span class="num" id="5627083">0</span>&nbsp;<span class="comment" id="5627085">//&nbsp;number&nbsp;of&nbsp;new&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5627113">for</span>&nbsp;<span class="ident" id="5627117">_</span><span class="op" id="5627118">,</span>&nbsp;<span class="ident" id="5627120">x</span>&nbsp;<span class="op" id="5627122">:=</span>&nbsp;<span class="keyword" id="5627125">range</span>&nbsp;<span class="ident" id="5627131">list</span>&nbsp;<span class="op" id="5627136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5627140">if</span>&nbsp;<span class="ident" id="5627143">ident</span><span class="op" id="5627148">,</span>&nbsp;<span class="ident" id="5627150">isIdent</span>&nbsp;<span class="op" id="5627158">:=</span>&nbsp;<span class="ident" id="5627161">x</span><span class="op" id="5627162">.</span><span class="op" id="5627163">(</span><span class="op" id="5627164">*</span><span class="ident" id="5627165">ast</span><span class="op" id="5627168">.</span><span class="ident" id="5627169">Ident</span><span class="op" id="5627174">)</span><span class="op" id="5627175">;</span>&nbsp;<span class="ident" id="5627177">isIdent</span>&nbsp;<span class="op" id="5627185">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627190">assert</span><span class="op" id="5627196">(</span><span class="ident" id="5627197">ident</span><span class="op" id="5627202">.</span><span class="ident" id="5627203">Obj</span>&nbsp;<span class="op" id="5627207">==</span>&nbsp;<span class="ident" id="5627210">nil</span><span class="op" id="5627213">,</span>&nbsp;<span class="string" id="5627215">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="5627256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627261">obj</span>&nbsp;<span class="op" id="5627265">:=</span>&nbsp;<span class="ident" id="5627268">ast</span><span class="op" id="5627271">.</span><span class="ident" id="5627272">NewObj</span><span class="op" id="5627278">(</span><span class="ident" id="5627279">ast</span><span class="op" id="5627282">.</span><span class="ident" id="5627283">Var</span><span class="op" id="5627286">,</span>&nbsp;<span class="ident" id="5627288">ident</span><span class="op" id="5627293">.</span><span class="ident" id="5627294">Name</span><span class="op" id="5627298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5627303">//&nbsp;remember&nbsp;corresponding&nbsp;assignment&nbsp;for&nbsp;other&nbsp;tools</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627359">obj</span><span class="op" id="5627362">.</span><span class="ident" id="5627363">Decl</span>&nbsp;<span class="op" id="5627368">=</span>&nbsp;<span class="ident" id="5627370">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627378">ident</span><span class="op" id="5627383">.</span><span class="ident" id="5627384">Obj</span>&nbsp;<span class="op" id="5627388">=</span>&nbsp;<span class="ident" id="5627390">obj</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5627397">if</span>&nbsp;<span class="ident" id="5627400">ident</span><span class="op" id="5627405">.</span><span class="ident" id="5627406">Name</span>&nbsp;<span class="op" id="5627411">!=</span>&nbsp;<span class="string" id="5627414">&#34;_&#34;</span>&nbsp;<span class="op" id="5627418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5627424">if</span>&nbsp;<span class="ident" id="5627427">alt</span>&nbsp;<span class="op" id="5627431">:=</span>&nbsp;<span class="ident" id="5627434">p</span><span class="op" id="5627435">.</span><span class="ident" id="5627436">topScope</span><span class="op" id="5627444">.</span><span class="ident" id="5627445">Insert</span><span class="op" id="5627451">(</span><span class="ident" id="5627452">obj</span><span class="op" id="5627455">)</span><span class="op" id="5627456">;</span>&nbsp;<span class="ident" id="5627458">alt</span>&nbsp;<span class="op" id="5627462">!=</span>&nbsp;<span class="ident" id="5627465">nil</span>&nbsp;<span class="op" id="5627469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627476">ident</span><span class="op" id="5627481">.</span><span class="ident" id="5627482">Obj</span>&nbsp;<span class="op" id="5627486">=</span>&nbsp;<span class="ident" id="5627488">alt</span>&nbsp;<span class="comment" id="5627492">//&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5627513">}</span>&nbsp;<span class="keyword" id="5627515">else</span>&nbsp;<span class="op" id="5627520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627527">n</span><span class="op" id="5627528">++</span>&nbsp;<span class="comment" id="5627531">//&nbsp;new&nbsp;declaration</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5627554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5627559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5627563">}</span>&nbsp;<span class="keyword" id="5627565">else</span>&nbsp;<span class="op" id="5627570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627575">p</span><span class="op" id="5627576">.</span><span class="ident" id="5627577">errorExpected</span><span class="op" id="5627590">(</span><span class="ident" id="5627591">x</span><span class="op" id="5627592">.</span><span class="ident" id="5627593">Pos</span><span class="op" id="5627596">(</span><span class="op" id="5627597">)</span><span class="op" id="5627598">,</span>&nbsp;<span class="string" id="5627600">&#34;identifier&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="5627631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5627635">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5627638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5627641">if</span>&nbsp;<span class="ident" id="5627644">n</span>&nbsp;<span class="op" id="5627646">==</span>&nbsp;<span class="num" id="5627649">0</span>&nbsp;<span class="op" id="5627651">&amp;&amp;</span>&nbsp;<span class="ident" id="5627654">p</span><span class="op" id="5627655">.</span><span class="ident" id="5627656">mode</span><span class="op" id="5627660">&amp;</span><span class="ident" id="5627661">DeclarationErrors</span>&nbsp;<span class="op" id="5627679">!=</span>&nbsp;<span class="num" id="5627682">0</span>&nbsp;<span class="op" id="5627684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5627688">p</span><span class="op" id="5627689">.</span><span class="builtintype" id="5627690">error</span><span class="op" id="5627695">(</span><span class="ident" id="5627696">list</span><span class="op" id="5627700">[</span><span class="num" id="5627701">0</span><span class="op" id="5627702">]</span><span class="op" id="5627703">.</span><span class="ident" id="5627704">Pos</span><span class="op" id="5627707">(</span><span class="op" id="5627708">)</span><span class="op" id="5627709">,</span>&nbsp;<span class="string" id="5627711">&#34;no&nbsp;new&nbsp;variables&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="5627748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5627751">}</span><br>
<span class="lineno"></span><span class="op" id="5627753">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="5627756">//&nbsp;The&nbsp;unresolved&nbsp;object&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;to&nbsp;mark&nbsp;identifiers&nbsp;that&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="5627836">//&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;identifiers.&nbsp;The&nbsp;sentinel&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;verifying</span><br>
<span class="lineno"></span><span class="comment" id="5627918">//&nbsp;internal&nbsp;consistency.</span><br>
<span class="lineno"></span><span class="keyword" id="5627943">var</span>&nbsp;<span class="ident" id="5627947">unresolved</span>&nbsp;<span class="op" id="5627958">=</span>&nbsp;<span class="builtinfunc" id="5627960">new</span><span class="op" id="5627963">(</span><span class="ident" id="5627964">ast</span><span class="op" id="5627967">.</span><span class="ident" id="5627968">Object</span><span class="op" id="5627974">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="5627977">//&nbsp;If&nbsp;x&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;tryResolve&nbsp;attempts&nbsp;to&nbsp;resolve&nbsp;x&nbsp;by&nbsp;looking&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="5628050">//&nbsp;the&nbsp;object&nbsp;it&nbsp;denotes.&nbsp;If&nbsp;no&nbsp;object&nbsp;is&nbsp;found&nbsp;and&nbsp;collectUnresolved&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5628123">//&nbsp;set,&nbsp;x&nbsp;is&nbsp;marked&nbsp;as&nbsp;unresolved&nbsp;and&nbsp;collected&nbsp;in&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved</span><br>
<span class="lineno"></span><span class="comment" id="5628197">//&nbsp;identifiers.</span><br>
<span class="lineno">170</span><span class="comment" id="5628213">//</span><br>
<span class="lineno"></span><span class="keyword" id="5628216">func</span>&nbsp;<span class="op" id="5628221">(</span><span class="ident" id="5628222">p</span>&nbsp;<span class="op" id="5628224">*</span><span class="ident" id="5628225">parser</span><span class="op" id="5628231">)</span>&nbsp;<span class="ident" id="5628233">tryResolve</span><span class="op" id="5628243">(</span><span class="ident" id="5628244">x</span>&nbsp;<span class="ident" id="5628246">ast</span><span class="op" id="5628249">.</span><span class="ident" id="5628250">Expr</span><span class="op" id="5628254">,</span>&nbsp;<span class="ident" id="5628256">collectUnresolved</span>&nbsp;<span class="builtintype" id="5628274">bool</span><span class="op" id="5628278">)</span>&nbsp;<span class="op" id="5628280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5628283">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;if&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;identifier&nbsp;or&nbsp;the&nbsp;blank&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5628351">ident</span><span class="op" id="5628356">,</span>&nbsp;<span class="ident" id="5628358">_</span>&nbsp;<span class="op" id="5628360">:=</span>&nbsp;<span class="ident" id="5628363">x</span><span class="op" id="5628364">.</span><span class="op" id="5628365">(</span><span class="op" id="5628366">*</span><span class="ident" id="5628367">ast</span><span class="op" id="5628370">.</span><span class="ident" id="5628371">Ident</span><span class="op" id="5628376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5628379">if</span>&nbsp;<span class="ident" id="5628382">ident</span>&nbsp;<span class="op" id="5628388">==</span>&nbsp;<span class="ident" id="5628391">nil</span>&nbsp;<span class="op" id="5628395">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5628399">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5628407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5628410">assert</span><span class="op" id="5628416">(</span><span class="ident" id="5628417">ident</span><span class="op" id="5628422">.</span><span class="ident" id="5628423">Obj</span>&nbsp;<span class="op" id="5628427">==</span>&nbsp;<span class="ident" id="5628430">nil</span><span class="op" id="5628433">,</span>&nbsp;<span class="string" id="5628435">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="5628476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5628479">if</span>&nbsp;<span class="ident" id="5628482">ident</span><span class="op" id="5628487">.</span><span class="ident" id="5628488">Name</span>&nbsp;<span class="op" id="5628493">==</span>&nbsp;<span class="string" id="5628496">&#34;_&#34;</span>&nbsp;<span class="op" id="5628500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5628504">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5628512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5628515">//&nbsp;try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5628549">for</span>&nbsp;<span class="ident" id="5628553">s</span>&nbsp;<span class="op" id="5628555">:=</span>&nbsp;<span class="ident" id="5628558">p</span><span class="op" id="5628559">.</span><span class="ident" id="5628560">topScope</span><span class="op" id="5628568">;</span>&nbsp;<span class="ident" id="5628570">s</span>&nbsp;<span class="op" id="5628572">!=</span>&nbsp;<span class="ident" id="5628575">nil</span><span class="op" id="5628578">;</span>&nbsp;<span class="ident" id="5628580">s</span>&nbsp;<span class="op" id="5628582">=</span>&nbsp;<span class="ident" id="5628584">s</span><span class="op" id="5628585">.</span><span class="ident" id="5628586">Outer</span>&nbsp;<span class="op" id="5628592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5628596">if</span>&nbsp;<span class="ident" id="5628599">obj</span>&nbsp;<span class="op" id="5628603">:=</span>&nbsp;<span class="ident" id="5628606">s</span><span class="op" id="5628607">.</span><span class="ident" id="5628608">Lookup</span><span class="op" id="5628614">(</span><span class="ident" id="5628615">ident</span><span class="op" id="5628620">.</span><span class="ident" id="5628621">Name</span><span class="op" id="5628625">)</span><span class="op" id="5628626">;</span>&nbsp;<span class="ident" id="5628628">obj</span>&nbsp;<span class="op" id="5628632">!=</span>&nbsp;<span class="ident" id="5628635">nil</span>&nbsp;<span class="op" id="5628639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5628644">ident</span><span class="op" id="5628649">.</span><span class="ident" id="5628650">Obj</span>&nbsp;<span class="op" id="5628654">=</span>&nbsp;<span class="ident" id="5628656">obj</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5628663">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5628672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5628675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5628678">//&nbsp;all&nbsp;local&nbsp;scopes&nbsp;are&nbsp;known,&nbsp;so&nbsp;any&nbsp;unresolved&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5628739">//&nbsp;must&nbsp;be&nbsp;found&nbsp;either&nbsp;in&nbsp;the&nbsp;file&nbsp;scope,&nbsp;package&nbsp;scope</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5628797">//&nbsp;(perhaps&nbsp;in&nbsp;another&nbsp;file),&nbsp;or&nbsp;universe&nbsp;scope&nbsp;---&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5628858">//&nbsp;them&nbsp;so&nbsp;that&nbsp;they&nbsp;can&nbsp;be&nbsp;resolved&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5628902">if</span>&nbsp;<span class="ident" id="5628905">collectUnresolved</span>&nbsp;<span class="op" id="5628923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5628927">ident</span><span class="op" id="5628932">.</span><span class="ident" id="5628933">Obj</span>&nbsp;<span class="op" id="5628937">=</span>&nbsp;<span class="ident" id="5628939">unresolved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5628952">p</span><span class="op" id="5628953">.</span><span class="ident" id="5628954">unresolved</span>&nbsp;<span class="op" id="5628965">=</span>&nbsp;<span class="builtinfunc" id="5628967">append</span><span class="op" id="5628973">(</span><span class="ident" id="5628974">p</span><span class="op" id="5628975">.</span><span class="ident" id="5628976">unresolved</span><span class="op" id="5628986">,</span>&nbsp;<span class="ident" id="5628988">ident</span><span class="op" id="5628993">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5628996">}</span><br>
<span class="lineno"></span><span class="op" id="5628998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5629001">func</span>&nbsp;<span class="op" id="5629006">(</span><span class="ident" id="5629007">p</span>&nbsp;<span class="op" id="5629009">*</span><span class="ident" id="5629010">parser</span><span class="op" id="5629016">)</span>&nbsp;<span class="ident" id="5629018">resolve</span><span class="op" id="5629025">(</span><span class="ident" id="5629026">x</span>&nbsp;<span class="ident" id="5629028">ast</span><span class="op" id="5629031">.</span><span class="ident" id="5629032">Expr</span><span class="op" id="5629036">)</span>&nbsp;<span class="op" id="5629038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629041">p</span><span class="op" id="5629042">.</span><span class="ident" id="5629043">tryResolve</span><span class="op" id="5629053">(</span><span class="ident" id="5629054">x</span><span class="op" id="5629055">,</span>&nbsp;<span class="builtintype" id="5629057">true</span><span class="op" id="5629061">)</span><br>
<span class="lineno">200</span><span class="op" id="5629063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5629066">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5629146">//&nbsp;Parsing&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="5629166">func</span>&nbsp;<span class="op" id="5629171">(</span><span class="ident" id="5629172">p</span>&nbsp;<span class="op" id="5629174">*</span><span class="ident" id="5629175">parser</span><span class="op" id="5629181">)</span>&nbsp;<span class="ident" id="5629183">printTrace</span><span class="op" id="5629193">(</span><span class="ident" id="5629194">a</span>&nbsp;<span class="op" id="5629196">...</span><span class="keyword" id="5629199">interface</span><span class="op" id="5629208">{</span><span class="op" id="5629209">}</span><span class="op" id="5629210">)</span>&nbsp;<span class="op" id="5629212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5629215">const</span>&nbsp;<span class="ident" id="5629221">dots</span>&nbsp;<span class="op" id="5629226">=</span>&nbsp;<span class="string" id="5629228">&#34;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5629296">const</span>&nbsp;<span class="ident" id="5629302">n</span>&nbsp;<span class="op" id="5629304">=</span>&nbsp;<span class="builtinfunc" id="5629306">len</span><span class="op" id="5629309">(</span><span class="ident" id="5629310">dots</span><span class="op" id="5629314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629317">pos</span>&nbsp;<span class="op" id="5629321">:=</span>&nbsp;<span class="ident" id="5629324">p</span><span class="op" id="5629325">.</span><span class="ident" id="5629326">file</span><span class="op" id="5629330">.</span><span class="ident" id="5629331">Position</span><span class="op" id="5629339">(</span><span class="ident" id="5629340">p</span><span class="op" id="5629341">.</span><span class="ident" id="5629342">pos</span><span class="op" id="5629345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629348">fmt</span><span class="op" id="5629351">.</span><span class="ident" id="5629352">Printf</span><span class="op" id="5629358">(</span><span class="string" id="5629359">&#34;%5d:%3d:&nbsp;&#34;</span><span class="op" id="5629370">,</span>&nbsp;<span class="ident" id="5629372">pos</span><span class="op" id="5629375">.</span><span class="ident" id="5629376">Line</span><span class="op" id="5629380">,</span>&nbsp;<span class="ident" id="5629382">pos</span><span class="op" id="5629385">.</span><span class="ident" id="5629386">Column</span><span class="op" id="5629392">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629395">i</span>&nbsp;<span class="op" id="5629397">:=</span>&nbsp;<span class="num" id="5629400">2</span>&nbsp;<span class="op" id="5629402">*</span>&nbsp;<span class="ident" id="5629404">p</span><span class="op" id="5629405">.</span><span class="ident" id="5629406">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5629414">for</span>&nbsp;<span class="ident" id="5629418">i</span>&nbsp;<span class="op" id="5629420">&gt;</span>&nbsp;<span class="ident" id="5629422">n</span>&nbsp;<span class="op" id="5629424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629428">fmt</span><span class="op" id="5629431">.</span><span class="ident" id="5629432">Print</span><span class="op" id="5629437">(</span><span class="ident" id="5629438">dots</span><span class="op" id="5629442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629446">i</span>&nbsp;<span class="op" id="5629448">-=</span>&nbsp;<span class="ident" id="5629451">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5629454">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5629457">//&nbsp;i&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629468">fmt</span><span class="op" id="5629471">.</span><span class="ident" id="5629472">Print</span><span class="op" id="5629477">(</span><span class="ident" id="5629478">dots</span><span class="op" id="5629482">[</span><span class="num" id="5629483">0</span><span class="op" id="5629484">:</span><span class="ident" id="5629485">i</span><span class="op" id="5629486">]</span><span class="op" id="5629487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629490">fmt</span><span class="op" id="5629493">.</span><span class="ident" id="5629494">Println</span><span class="op" id="5629501">(</span><span class="ident" id="5629502">a</span><span class="op" id="5629503">...</span><span class="op" id="5629506">)</span><br>
<span class="lineno"></span><span class="op" id="5629508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="keyword" id="5629511">func</span>&nbsp;<span class="ident" id="5629516">trace</span><span class="op" id="5629521">(</span><span class="ident" id="5629522">p</span>&nbsp;<span class="op" id="5629524">*</span><span class="ident" id="5629525">parser</span><span class="op" id="5629531">,</span>&nbsp;<span class="ident" id="5629533">msg</span>&nbsp;<span class="builtintype" id="5629537">string</span><span class="op" id="5629543">)</span>&nbsp;<span class="op" id="5629545">*</span><span class="ident" id="5629546">parser</span>&nbsp;<span class="op" id="5629553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629556">p</span><span class="op" id="5629557">.</span><span class="ident" id="5629558">printTrace</span><span class="op" id="5629568">(</span><span class="ident" id="5629569">msg</span><span class="op" id="5629572">,</span>&nbsp;<span class="string" id="5629574">&#34;(&#34;</span><span class="op" id="5629577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629580">p</span><span class="op" id="5629581">.</span><span class="ident" id="5629582">indent</span><span class="op" id="5629588">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5629592">return</span>&nbsp;<span class="ident" id="5629599">p</span><br>
<span class="lineno"></span><span class="op" id="5629601">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="5629604">//&nbsp;Usage&nbsp;pattern:&nbsp;defer&nbsp;un(trace(p,&nbsp;&#34;...&#34;))</span><br>
<span class="lineno"></span><span class="keyword" id="5629648">func</span>&nbsp;<span class="ident" id="5629653">un</span><span class="op" id="5629655">(</span><span class="ident" id="5629656">p</span>&nbsp;<span class="op" id="5629658">*</span><span class="ident" id="5629659">parser</span><span class="op" id="5629665">)</span>&nbsp;<span class="op" id="5629667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629670">p</span><span class="op" id="5629671">.</span><span class="ident" id="5629672">indent</span><span class="op" id="5629678">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5629682">p</span><span class="op" id="5629683">.</span><span class="ident" id="5629684">printTrace</span><span class="op" id="5629694">(</span><span class="string" id="5629695">&#34;)&#34;</span><span class="op" id="5629698">)</span><br>
<span class="lineno">230</span><span class="op" id="5629700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5629703">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="5629733">func</span>&nbsp;<span class="op" id="5629738">(</span><span class="ident" id="5629739">p</span>&nbsp;<span class="op" id="5629741">*</span><span class="ident" id="5629742">parser</span><span class="op" id="5629748">)</span>&nbsp;<span class="ident" id="5629750">next0</span><span class="op" id="5629755">(</span><span class="op" id="5629756">)</span>&nbsp;<span class="op" id="5629758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5629761">//&nbsp;Because&nbsp;of&nbsp;one-token&nbsp;look-ahead,&nbsp;print&nbsp;the&nbsp;previous&nbsp;token</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5629823">//&nbsp;when&nbsp;tracing&nbsp;as&nbsp;it&nbsp;provides&nbsp;a&nbsp;more&nbsp;readable&nbsp;output.&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5629883">//&nbsp;very&nbsp;first&nbsp;token&nbsp;(!p.pos.IsValid())&nbsp;is&nbsp;not&nbsp;initialized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5629942">//&nbsp;(it&nbsp;is&nbsp;token.ILLEGAL),&nbsp;so&nbsp;don&#39;t&nbsp;print&nbsp;it&nbsp;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5629989">if</span>&nbsp;<span class="ident" id="5629992">p</span><span class="op" id="5629993">.</span><span class="ident" id="5629994">trace</span>&nbsp;<span class="op" id="5630000">&amp;&amp;</span>&nbsp;<span class="ident" id="5630003">p</span><span class="op" id="5630004">.</span><span class="ident" id="5630005">pos</span><span class="op" id="5630008">.</span><span class="ident" id="5630009">IsValid</span><span class="op" id="5630016">(</span><span class="op" id="5630017">)</span>&nbsp;<span class="op" id="5630019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630023">s</span>&nbsp;<span class="op" id="5630025">:=</span>&nbsp;<span class="ident" id="5630028">p</span><span class="op" id="5630029">.</span><span class="ident" id="5630030">tok</span><span class="op" id="5630033">.</span><span class="ident" id="5630034">String</span><span class="op" id="5630040">(</span><span class="op" id="5630041">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5630045">switch</span>&nbsp;<span class="op" id="5630052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5630056">case</span>&nbsp;<span class="ident" id="5630061">p</span><span class="op" id="5630062">.</span><span class="ident" id="5630063">tok</span><span class="op" id="5630066">.</span><span class="ident" id="5630067">IsLiteral</span><span class="op" id="5630076">(</span><span class="op" id="5630077">)</span><span class="op" id="5630078">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630083">p</span><span class="op" id="5630084">.</span><span class="ident" id="5630085">printTrace</span><span class="op" id="5630095">(</span><span class="ident" id="5630096">s</span><span class="op" id="5630097">,</span>&nbsp;<span class="ident" id="5630099">p</span><span class="op" id="5630100">.</span><span class="ident" id="5630101">lit</span><span class="op" id="5630104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5630108">case</span>&nbsp;<span class="ident" id="5630113">p</span><span class="op" id="5630114">.</span><span class="ident" id="5630115">tok</span><span class="op" id="5630118">.</span><span class="ident" id="5630119">IsOperator</span><span class="op" id="5630129">(</span><span class="op" id="5630130">)</span><span class="op" id="5630131">,</span>&nbsp;<span class="ident" id="5630133">p</span><span class="op" id="5630134">.</span><span class="ident" id="5630135">tok</span><span class="op" id="5630138">.</span><span class="ident" id="5630139">IsKeyword</span><span class="op" id="5630148">(</span><span class="op" id="5630149">)</span><span class="op" id="5630150">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630155">p</span><span class="op" id="5630156">.</span><span class="ident" id="5630157">printTrace</span><span class="op" id="5630167">(</span><span class="string" id="5630168">&#34;\&#34;&#34;</span>&nbsp;<span class="op" id="5630173">+</span>&nbsp;<span class="ident" id="5630175">s</span>&nbsp;<span class="op" id="5630177">+</span>&nbsp;<span class="string" id="5630179">&#34;\&#34;&#34;</span><span class="op" id="5630183">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5630187">default</span><span class="op" id="5630194">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630199">p</span><span class="op" id="5630200">.</span><span class="ident" id="5630201">printTrace</span><span class="op" id="5630211">(</span><span class="ident" id="5630212">s</span><span class="op" id="5630213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5630217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5630220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630224">p</span><span class="op" id="5630225">.</span><span class="ident" id="5630226">pos</span><span class="op" id="5630229">,</span>&nbsp;<span class="ident" id="5630231">p</span><span class="op" id="5630232">.</span><span class="ident" id="5630233">tok</span><span class="op" id="5630236">,</span>&nbsp;<span class="ident" id="5630238">p</span><span class="op" id="5630239">.</span><span class="ident" id="5630240">lit</span>&nbsp;<span class="op" id="5630244">=</span>&nbsp;<span class="ident" id="5630246">p</span><span class="op" id="5630247">.</span><span class="ident" id="5630248">scanner</span><span class="op" id="5630255">.</span><span class="ident" id="5630256">Scan</span><span class="op" id="5630260">(</span><span class="op" id="5630261">)</span><br>
<span class="lineno"></span><span class="op" id="5630263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5630266">//&nbsp;Consume&nbsp;a&nbsp;comment&nbsp;and&nbsp;return&nbsp;it&nbsp;and&nbsp;the&nbsp;line&nbsp;on&nbsp;which&nbsp;it&nbsp;ends.</span><br>
<span class="lineno"></span><span class="keyword" id="5630332">func</span>&nbsp;<span class="op" id="5630337">(</span><span class="ident" id="5630338">p</span>&nbsp;<span class="op" id="5630340">*</span><span class="ident" id="5630341">parser</span><span class="op" id="5630347">)</span>&nbsp;<span class="ident" id="5630349">consumeComment</span><span class="op" id="5630363">(</span><span class="op" id="5630364">)</span>&nbsp;<span class="op" id="5630366">(</span><span class="ident" id="5630367">comment</span>&nbsp;<span class="op" id="5630375">*</span><span class="ident" id="5630376">ast</span><span class="op" id="5630379">.</span><span class="ident" id="5630380">Comment</span><span class="op" id="5630387">,</span>&nbsp;<span class="ident" id="5630389">endline</span>&nbsp;<span class="builtintype" id="5630397">int</span><span class="op" id="5630400">)</span>&nbsp;<span class="op" id="5630402">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5630405">//&nbsp;/*-style&nbsp;comments&nbsp;may&nbsp;end&nbsp;on&nbsp;a&nbsp;different&nbsp;line&nbsp;than&nbsp;where&nbsp;they&nbsp;start.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5630478">//&nbsp;Scan&nbsp;the&nbsp;comment&nbsp;for&nbsp;&#39;\n&#39;&nbsp;chars&nbsp;and&nbsp;adjust&nbsp;endline&nbsp;accordingly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630546">endline</span>&nbsp;<span class="op" id="5630554">=</span>&nbsp;<span class="ident" id="5630556">p</span><span class="op" id="5630557">.</span><span class="ident" id="5630558">file</span><span class="op" id="5630562">.</span><span class="ident" id="5630563">Line</span><span class="op" id="5630567">(</span><span class="ident" id="5630568">p</span><span class="op" id="5630569">.</span><span class="ident" id="5630570">pos</span><span class="op" id="5630573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5630576">if</span>&nbsp;<span class="ident" id="5630579">p</span><span class="op" id="5630580">.</span><span class="ident" id="5630581">lit</span><span class="op" id="5630584">[</span><span class="num" id="5630585">1</span><span class="op" id="5630586">]</span>&nbsp;<span class="op" id="5630588">==</span>&nbsp;<span class="string" id="5630591">&#39;*&#39;</span>&nbsp;<span class="op" id="5630595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5630599">//&nbsp;don&#39;t&nbsp;use&nbsp;range&nbsp;here&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;decode&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5630665">for</span>&nbsp;<span class="ident" id="5630669">i</span>&nbsp;<span class="op" id="5630671">:=</span>&nbsp;<span class="num" id="5630674">0</span><span class="op" id="5630675">;</span>&nbsp;<span class="ident" id="5630677">i</span>&nbsp;<span class="op" id="5630679">&lt;</span>&nbsp;<span class="builtinfunc" id="5630681">len</span><span class="op" id="5630684">(</span><span class="ident" id="5630685">p</span><span class="op" id="5630686">.</span><span class="ident" id="5630687">lit</span><span class="op" id="5630690">)</span><span class="op" id="5630691">;</span>&nbsp;<span class="ident" id="5630693">i</span><span class="op" id="5630694">++</span>&nbsp;<span class="op" id="5630697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5630702">if</span>&nbsp;<span class="ident" id="5630705">p</span><span class="op" id="5630706">.</span><span class="ident" id="5630707">lit</span><span class="op" id="5630710">[</span><span class="ident" id="5630711">i</span><span class="op" id="5630712">]</span>&nbsp;<span class="op" id="5630714">==</span>&nbsp;<span class="string" id="5630717">&#39;\n&#39;</span>&nbsp;<span class="op" id="5630722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630728">endline</span><span class="op" id="5630735">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5630741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5630745">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5630748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630752">comment</span>&nbsp;<span class="op" id="5630760">=</span>&nbsp;<span class="op" id="5630762">&amp;</span><span class="ident" id="5630763">ast</span><span class="op" id="5630766">.</span><span class="ident" id="5630767">Comment</span><span class="op" id="5630774">{</span><span class="ident" id="5630775">Slash</span><span class="op" id="5630780">:</span>&nbsp;<span class="ident" id="5630782">p</span><span class="op" id="5630783">.</span><span class="ident" id="5630784">pos</span><span class="op" id="5630787">,</span>&nbsp;<span class="ident" id="5630789">Text</span><span class="op" id="5630793">:</span>&nbsp;<span class="ident" id="5630795">p</span><span class="op" id="5630796">.</span><span class="ident" id="5630797">lit</span><span class="op" id="5630800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5630803">p</span><span class="op" id="5630804">.</span><span class="ident" id="5630805">next0</span><span class="op" id="5630810">(</span><span class="op" id="5630811">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5630815">return</span><br>
<span class="lineno"></span><span class="op" id="5630822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5630825">//&nbsp;Consume&nbsp;a&nbsp;group&nbsp;of&nbsp;adjacent&nbsp;comments,&nbsp;add&nbsp;it&nbsp;to&nbsp;the&nbsp;parser&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5630889">//&nbsp;comments&nbsp;list,&nbsp;and&nbsp;return&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;line&nbsp;at&nbsp;which</span><br>
<span class="lineno">275</span><span class="comment" id="5630953">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;in&nbsp;the&nbsp;group&nbsp;ends.&nbsp;A&nbsp;non-comment&nbsp;token&nbsp;or&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="5631017">//&nbsp;empty&nbsp;lines&nbsp;terminate&nbsp;a&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="5631059">//</span><br>
<span class="lineno"></span><span class="keyword" id="5631062">func</span>&nbsp;<span class="op" id="5631067">(</span><span class="ident" id="5631068">p</span>&nbsp;<span class="op" id="5631070">*</span><span class="ident" id="5631071">parser</span><span class="op" id="5631077">)</span>&nbsp;<span class="ident" id="5631079">consumeCommentGroup</span><span class="op" id="5631098">(</span><span class="ident" id="5631099">n</span>&nbsp;<span class="builtintype" id="5631101">int</span><span class="op" id="5631104">)</span>&nbsp;<span class="op" id="5631106">(</span><span class="ident" id="5631107">comments</span>&nbsp;<span class="op" id="5631116">*</span><span class="ident" id="5631117">ast</span><span class="op" id="5631120">.</span><span class="ident" id="5631121">CommentGroup</span><span class="op" id="5631133">,</span>&nbsp;<span class="ident" id="5631135">endline</span>&nbsp;<span class="builtintype" id="5631143">int</span><span class="op" id="5631146">)</span>&nbsp;<span class="op" id="5631148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5631151">var</span>&nbsp;<span class="ident" id="5631155">list</span>&nbsp;<span class="op" id="5631160">[</span><span class="op" id="5631161">]</span><span class="op" id="5631162">*</span><span class="ident" id="5631163">ast</span><span class="op" id="5631166">.</span><span class="ident" id="5631167">Comment</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5631176">endline</span>&nbsp;<span class="op" id="5631184">=</span>&nbsp;<span class="ident" id="5631186">p</span><span class="op" id="5631187">.</span><span class="ident" id="5631188">file</span><span class="op" id="5631192">.</span><span class="ident" id="5631193">Line</span><span class="op" id="5631197">(</span><span class="ident" id="5631198">p</span><span class="op" id="5631199">.</span><span class="ident" id="5631200">pos</span><span class="op" id="5631203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5631206">for</span>&nbsp;<span class="ident" id="5631210">p</span><span class="op" id="5631211">.</span><span class="ident" id="5631212">tok</span>&nbsp;<span class="op" id="5631216">==</span>&nbsp;<span class="ident" id="5631219">token</span><span class="op" id="5631224">.</span><span class="ident" id="5631225">COMMENT</span>&nbsp;<span class="op" id="5631233">&amp;&amp;</span>&nbsp;<span class="ident" id="5631236">p</span><span class="op" id="5631237">.</span><span class="ident" id="5631238">file</span><span class="op" id="5631242">.</span><span class="ident" id="5631243">Line</span><span class="op" id="5631247">(</span><span class="ident" id="5631248">p</span><span class="op" id="5631249">.</span><span class="ident" id="5631250">pos</span><span class="op" id="5631253">)</span>&nbsp;<span class="op" id="5631255">&lt;=</span>&nbsp;<span class="ident" id="5631258">endline</span><span class="op" id="5631265">+</span><span class="ident" id="5631266">n</span>&nbsp;<span class="op" id="5631268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5631272">var</span>&nbsp;<span class="ident" id="5631276">comment</span>&nbsp;<span class="op" id="5631284">*</span><span class="ident" id="5631285">ast</span><span class="op" id="5631288">.</span><span class="ident" id="5631289">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5631299">comment</span><span class="op" id="5631306">,</span>&nbsp;<span class="ident" id="5631308">endline</span>&nbsp;<span class="op" id="5631316">=</span>&nbsp;<span class="ident" id="5631318">p</span><span class="op" id="5631319">.</span><span class="ident" id="5631320">consumeComment</span><span class="op" id="5631334">(</span><span class="op" id="5631335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5631339">list</span>&nbsp;<span class="op" id="5631344">=</span>&nbsp;<span class="builtinfunc" id="5631346">append</span><span class="op" id="5631352">(</span><span class="ident" id="5631353">list</span><span class="op" id="5631357">,</span>&nbsp;<span class="ident" id="5631359">comment</span><span class="op" id="5631366">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5631369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5631373">//&nbsp;add&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;comments&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5631416">comments</span>&nbsp;<span class="op" id="5631425">=</span>&nbsp;<span class="op" id="5631427">&amp;</span><span class="ident" id="5631428">ast</span><span class="op" id="5631431">.</span><span class="ident" id="5631432">CommentGroup</span><span class="op" id="5631444">{</span><span class="ident" id="5631445">List</span><span class="op" id="5631449">:</span>&nbsp;<span class="ident" id="5631451">list</span><span class="op" id="5631455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5631458">p</span><span class="op" id="5631459">.</span><span class="ident" id="5631460">comments</span>&nbsp;<span class="op" id="5631469">=</span>&nbsp;<span class="builtinfunc" id="5631471">append</span><span class="op" id="5631477">(</span><span class="ident" id="5631478">p</span><span class="op" id="5631479">.</span><span class="ident" id="5631480">comments</span><span class="op" id="5631488">,</span>&nbsp;<span class="ident" id="5631490">comments</span><span class="op" id="5631498">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5631502">return</span><br>
<span class="lineno"></span><span class="op" id="5631509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5631512">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;non-comment&nbsp;token.&nbsp;In&nbsp;the&nbsp;process,&nbsp;collect</span><br>
<span class="lineno">295</span><span class="comment" id="5631578">//&nbsp;any&nbsp;comment&nbsp;groups&nbsp;encountered,&nbsp;and&nbsp;remember&nbsp;the&nbsp;last&nbsp;lead&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5631644">//&nbsp;and&nbsp;line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5631666">//</span><br>
<span class="lineno"></span><span class="comment" id="5631669">//&nbsp;A&nbsp;lead&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;starts&nbsp;and&nbsp;ends&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5631732">//&nbsp;line&nbsp;without&nbsp;any&nbsp;other&nbsp;tokens&nbsp;and&nbsp;that&nbsp;is&nbsp;followed&nbsp;by&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno">300</span><span class="comment" id="5631803">//&nbsp;token&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="5631861">//</span><br>
<span class="lineno"></span><span class="comment" id="5631864">//&nbsp;A&nbsp;line&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;follows&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno"></span><span class="comment" id="5631928">//&nbsp;token&nbsp;on&nbsp;the&nbsp;same&nbsp;line,&nbsp;and&nbsp;that&nbsp;has&nbsp;no&nbsp;tokens&nbsp;after&nbsp;it&nbsp;on&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5631999">//&nbsp;where&nbsp;it&nbsp;ends.</span><br>
<span class="lineno">305</span><span class="comment" id="5632017">//</span><br>
<span class="lineno"></span><span class="comment" id="5632020">//&nbsp;Lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;may&nbsp;be&nbsp;considered&nbsp;documentation&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5632086">//&nbsp;stored&nbsp;in&nbsp;the&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="5632108">//</span><br>
<span class="lineno"></span><span class="keyword" id="5632111">func</span>&nbsp;<span class="op" id="5632116">(</span><span class="ident" id="5632117">p</span>&nbsp;<span class="op" id="5632119">*</span><span class="ident" id="5632120">parser</span><span class="op" id="5632126">)</span>&nbsp;<span class="ident" id="5632128">next</span><span class="op" id="5632132">(</span><span class="op" id="5632133">)</span>&nbsp;<span class="op" id="5632135">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5632138">p</span><span class="op" id="5632139">.</span><span class="ident" id="5632140">leadComment</span>&nbsp;<span class="op" id="5632152">=</span>&nbsp;<span class="ident" id="5632154">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5632159">p</span><span class="op" id="5632160">.</span><span class="ident" id="5632161">lineComment</span>&nbsp;<span class="op" id="5632173">=</span>&nbsp;<span class="ident" id="5632175">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5632180">prev</span>&nbsp;<span class="op" id="5632185">:=</span>&nbsp;<span class="ident" id="5632188">p</span><span class="op" id="5632189">.</span><span class="ident" id="5632190">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5632195">p</span><span class="op" id="5632196">.</span><span class="ident" id="5632197">next0</span><span class="op" id="5632202">(</span><span class="op" id="5632203">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5632207">if</span>&nbsp;<span class="ident" id="5632210">p</span><span class="op" id="5632211">.</span><span class="ident" id="5632212">tok</span>&nbsp;<span class="op" id="5632216">==</span>&nbsp;<span class="ident" id="5632219">token</span><span class="op" id="5632224">.</span><span class="ident" id="5632225">COMMENT</span>&nbsp;<span class="op" id="5632233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5632237">var</span>&nbsp;<span class="ident" id="5632241">comment</span>&nbsp;<span class="op" id="5632249">*</span><span class="ident" id="5632250">ast</span><span class="op" id="5632253">.</span><span class="ident" id="5632254">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5632269">var</span>&nbsp;<span class="ident" id="5632273">endline</span>&nbsp;<span class="builtintype" id="5632281">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5632288">if</span>&nbsp;<span class="ident" id="5632291">p</span><span class="op" id="5632292">.</span><span class="ident" id="5632293">file</span><span class="op" id="5632297">.</span><span class="ident" id="5632298">Line</span><span class="op" id="5632302">(</span><span class="ident" id="5632303">p</span><span class="op" id="5632304">.</span><span class="ident" id="5632305">pos</span><span class="op" id="5632308">)</span>&nbsp;<span class="op" id="5632310">==</span>&nbsp;<span class="ident" id="5632313">p</span><span class="op" id="5632314">.</span><span class="ident" id="5632315">file</span><span class="op" id="5632319">.</span><span class="ident" id="5632320">Line</span><span class="op" id="5632324">(</span><span class="ident" id="5632325">prev</span><span class="op" id="5632329">)</span>&nbsp;<span class="op" id="5632331">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5632336">//&nbsp;The&nbsp;comment&nbsp;is&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;token;&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5632396">//&nbsp;cannot&nbsp;be&nbsp;a&nbsp;lead&nbsp;comment&nbsp;but&nbsp;may&nbsp;be&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5632454">comment</span><span class="op" id="5632461">,</span>&nbsp;<span class="ident" id="5632463">endline</span>&nbsp;<span class="op" id="5632471">=</span>&nbsp;<span class="ident" id="5632473">p</span><span class="op" id="5632474">.</span><span class="ident" id="5632475">consumeCommentGroup</span><span class="op" id="5632494">(</span><span class="num" id="5632495">0</span><span class="op" id="5632496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5632501">if</span>&nbsp;<span class="ident" id="5632504">p</span><span class="op" id="5632505">.</span><span class="ident" id="5632506">file</span><span class="op" id="5632510">.</span><span class="ident" id="5632511">Line</span><span class="op" id="5632515">(</span><span class="ident" id="5632516">p</span><span class="op" id="5632517">.</span><span class="ident" id="5632518">pos</span><span class="op" id="5632521">)</span>&nbsp;<span class="op" id="5632523">!=</span>&nbsp;<span class="ident" id="5632526">endline</span>&nbsp;<span class="op" id="5632534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5632540">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;on&nbsp;a&nbsp;different&nbsp;line,&nbsp;thus</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5632591">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5632640">p</span><span class="op" id="5632641">.</span><span class="ident" id="5632642">lineComment</span>&nbsp;<span class="op" id="5632654">=</span>&nbsp;<span class="ident" id="5632656">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5632667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5632671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5632676">//&nbsp;consume&nbsp;successor&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5632716">endline</span>&nbsp;<span class="op" id="5632724">=</span>&nbsp;<span class="op" id="5632726">-</span><span class="num" id="5632727">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5632731">for</span>&nbsp;<span class="ident" id="5632735">p</span><span class="op" id="5632736">.</span><span class="ident" id="5632737">tok</span>&nbsp;<span class="op" id="5632741">==</span>&nbsp;<span class="ident" id="5632744">token</span><span class="op" id="5632749">.</span><span class="ident" id="5632750">COMMENT</span>&nbsp;<span class="op" id="5632758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5632763">comment</span><span class="op" id="5632770">,</span>&nbsp;<span class="ident" id="5632772">endline</span>&nbsp;<span class="op" id="5632780">=</span>&nbsp;<span class="ident" id="5632782">p</span><span class="op" id="5632783">.</span><span class="ident" id="5632784">consumeCommentGroup</span><span class="op" id="5632803">(</span><span class="num" id="5632804">1</span><span class="op" id="5632805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5632809">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5632814">if</span>&nbsp;<span class="ident" id="5632817">endline</span><span class="op" id="5632824">+</span><span class="num" id="5632825">1</span>&nbsp;<span class="op" id="5632827">==</span>&nbsp;<span class="ident" id="5632830">p</span><span class="op" id="5632831">.</span><span class="ident" id="5632832">file</span><span class="op" id="5632836">.</span><span class="ident" id="5632837">Line</span><span class="op" id="5632841">(</span><span class="ident" id="5632842">p</span><span class="op" id="5632843">.</span><span class="ident" id="5632844">pos</span><span class="op" id="5632847">)</span>&nbsp;<span class="op" id="5632849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5632854">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;following&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5632922">//&nbsp;comment&nbsp;group,&nbsp;thus&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;lead&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5632990">p</span><span class="op" id="5632991">.</span><span class="ident" id="5632992">leadComment</span>&nbsp;<span class="op" id="5633004">=</span>&nbsp;<span class="ident" id="5633006">comment</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5633016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5633019">}</span><br>
<span class="lineno"></span><span class="op" id="5633021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5633024">//&nbsp;A&nbsp;bailout&nbsp;panic&nbsp;is&nbsp;raised&nbsp;to&nbsp;indicate&nbsp;early&nbsp;termination.</span><br>
<span class="lineno">345</span><span class="keyword" id="5633084">type</span>&nbsp;<span class="ident" id="5633089">bailout</span>&nbsp;<span class="keyword" id="5633097">struct</span><span class="op" id="5633103">{</span><span class="op" id="5633104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5633107">func</span>&nbsp;<span class="op" id="5633112">(</span><span class="ident" id="5633113">p</span>&nbsp;<span class="op" id="5633115">*</span><span class="ident" id="5633116">parser</span><span class="op" id="5633122">)</span>&nbsp;<span class="builtintype" id="5633124">error</span><span class="op" id="5633129">(</span><span class="ident" id="5633130">pos</span>&nbsp;<span class="ident" id="5633134">token</span><span class="op" id="5633139">.</span><span class="ident" id="5633140">Pos</span><span class="op" id="5633143">,</span>&nbsp;<span class="ident" id="5633145">msg</span>&nbsp;<span class="builtintype" id="5633149">string</span><span class="op" id="5633155">)</span>&nbsp;<span class="op" id="5633157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633160">epos</span>&nbsp;<span class="op" id="5633165">:=</span>&nbsp;<span class="ident" id="5633168">p</span><span class="op" id="5633169">.</span><span class="ident" id="5633170">file</span><span class="op" id="5633174">.</span><span class="ident" id="5633175">Position</span><span class="op" id="5633183">(</span><span class="ident" id="5633184">pos</span><span class="op" id="5633187">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5633191">//&nbsp;If&nbsp;AllErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;discard&nbsp;errors&nbsp;reported&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5633261">//&nbsp;as&nbsp;the&nbsp;last&nbsp;recorded&nbsp;error&nbsp;and&nbsp;stop&nbsp;parsing&nbsp;if&nbsp;there&nbsp;are&nbsp;more&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5633332">//&nbsp;10&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5633347">if</span>&nbsp;<span class="ident" id="5633350">p</span><span class="op" id="5633351">.</span><span class="ident" id="5633352">mode</span><span class="op" id="5633356">&amp;</span><span class="ident" id="5633357">AllErrors</span>&nbsp;<span class="op" id="5633367">==</span>&nbsp;<span class="num" id="5633370">0</span>&nbsp;<span class="op" id="5633372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633376">n</span>&nbsp;<span class="op" id="5633378">:=</span>&nbsp;<span class="builtinfunc" id="5633381">len</span><span class="op" id="5633384">(</span><span class="ident" id="5633385">p</span><span class="op" id="5633386">.</span><span class="ident" id="5633387">errors</span><span class="op" id="5633393">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5633397">if</span>&nbsp;<span class="ident" id="5633400">n</span>&nbsp;<span class="op" id="5633402">&gt;</span>&nbsp;<span class="num" id="5633404">0</span>&nbsp;<span class="op" id="5633406">&amp;&amp;</span>&nbsp;<span class="ident" id="5633409">p</span><span class="op" id="5633410">.</span><span class="ident" id="5633411">errors</span><span class="op" id="5633417">[</span><span class="ident" id="5633418">n</span><span class="op" id="5633419">-</span><span class="num" id="5633420">1</span><span class="op" id="5633421">]</span><span class="op" id="5633422">.</span><span class="ident" id="5633423">Pos</span><span class="op" id="5633426">.</span><span class="ident" id="5633427">Line</span>&nbsp;<span class="op" id="5633432">==</span>&nbsp;<span class="ident" id="5633435">epos</span><span class="op" id="5633439">.</span><span class="ident" id="5633440">Line</span>&nbsp;<span class="op" id="5633445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5633450">return</span>&nbsp;<span class="comment" id="5633457">//&nbsp;discard&nbsp;-&nbsp;likely&nbsp;a&nbsp;spurious&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5633496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5633500">if</span>&nbsp;<span class="ident" id="5633503">n</span>&nbsp;<span class="op" id="5633505">&gt;</span>&nbsp;<span class="num" id="5633507">10</span>&nbsp;<span class="op" id="5633510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5633515">panic</span><span class="op" id="5633520">(</span><span class="ident" id="5633521">bailout</span><span class="op" id="5633528">{</span><span class="op" id="5633529">}</span><span class="op" id="5633530">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5633534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5633537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633541">p</span><span class="op" id="5633542">.</span><span class="ident" id="5633543">errors</span><span class="op" id="5633549">.</span><span class="ident" id="5633550">Add</span><span class="op" id="5633553">(</span><span class="ident" id="5633554">epos</span><span class="op" id="5633558">,</span>&nbsp;<span class="ident" id="5633560">msg</span><span class="op" id="5633563">)</span><br>
<span class="lineno"></span><span class="op" id="5633565">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="5633568">func</span>&nbsp;<span class="op" id="5633573">(</span><span class="ident" id="5633574">p</span>&nbsp;<span class="op" id="5633576">*</span><span class="ident" id="5633577">parser</span><span class="op" id="5633583">)</span>&nbsp;<span class="ident" id="5633585">errorExpected</span><span class="op" id="5633598">(</span><span class="ident" id="5633599">pos</span>&nbsp;<span class="ident" id="5633603">token</span><span class="op" id="5633608">.</span><span class="ident" id="5633609">Pos</span><span class="op" id="5633612">,</span>&nbsp;<span class="ident" id="5633614">msg</span>&nbsp;<span class="builtintype" id="5633618">string</span><span class="op" id="5633624">)</span>&nbsp;<span class="op" id="5633626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633629">msg</span>&nbsp;<span class="op" id="5633633">=</span>&nbsp;<span class="string" id="5633635">&#34;expected&nbsp;&#34;</span>&nbsp;<span class="op" id="5633647">+</span>&nbsp;<span class="ident" id="5633649">msg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5633654">if</span>&nbsp;<span class="ident" id="5633657">pos</span>&nbsp;<span class="op" id="5633661">==</span>&nbsp;<span class="ident" id="5633664">p</span><span class="op" id="5633665">.</span><span class="ident" id="5633666">pos</span>&nbsp;<span class="op" id="5633670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5633674">//&nbsp;the&nbsp;error&nbsp;happened&nbsp;at&nbsp;the&nbsp;current&nbsp;position;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5633723">//&nbsp;make&nbsp;the&nbsp;error&nbsp;message&nbsp;more&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5633765">if</span>&nbsp;<span class="ident" id="5633768">p</span><span class="op" id="5633769">.</span><span class="ident" id="5633770">tok</span>&nbsp;<span class="op" id="5633774">==</span>&nbsp;<span class="ident" id="5633777">token</span><span class="op" id="5633782">.</span><span class="ident" id="5633783">SEMICOLON</span>&nbsp;<span class="op" id="5633793">&amp;&amp;</span>&nbsp;<span class="ident" id="5633796">p</span><span class="op" id="5633797">.</span><span class="ident" id="5633798">lit</span>&nbsp;<span class="op" id="5633802">==</span>&nbsp;<span class="string" id="5633805">&#34;\n&#34;</span>&nbsp;<span class="op" id="5633810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633815">msg</span>&nbsp;<span class="op" id="5633819">+=</span>&nbsp;<span class="string" id="5633822">&#34;,&nbsp;found&nbsp;newline&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5633842">}</span>&nbsp;<span class="keyword" id="5633844">else</span>&nbsp;<span class="op" id="5633849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633854">msg</span>&nbsp;<span class="op" id="5633858">+=</span>&nbsp;<span class="string" id="5633861">&#34;,&nbsp;found&nbsp;&#39;&#34;</span>&nbsp;<span class="op" id="5633873">+</span>&nbsp;<span class="ident" id="5633875">p</span><span class="op" id="5633876">.</span><span class="ident" id="5633877">tok</span><span class="op" id="5633880">.</span><span class="ident" id="5633881">String</span><span class="op" id="5633887">(</span><span class="op" id="5633888">)</span>&nbsp;<span class="op" id="5633890">+</span>&nbsp;<span class="string" id="5633892">&#34;&#39;&#34;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5633899">if</span>&nbsp;<span class="ident" id="5633902">p</span><span class="op" id="5633903">.</span><span class="ident" id="5633904">tok</span><span class="op" id="5633907">.</span><span class="ident" id="5633908">IsLiteral</span><span class="op" id="5633917">(</span><span class="op" id="5633918">)</span>&nbsp;<span class="op" id="5633920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633926">msg</span>&nbsp;<span class="op" id="5633930">+=</span>&nbsp;<span class="string" id="5633933">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5633937">+</span>&nbsp;<span class="ident" id="5633939">p</span><span class="op" id="5633940">.</span><span class="ident" id="5633941">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5633948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5633952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5633955">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5633958">p</span><span class="op" id="5633959">.</span><span class="builtintype" id="5633960">error</span><span class="op" id="5633965">(</span><span class="ident" id="5633966">pos</span><span class="op" id="5633969">,</span>&nbsp;<span class="ident" id="5633971">msg</span><span class="op" id="5633974">)</span><br>
<span class="lineno"></span><span class="op" id="5633976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5633979">func</span>&nbsp;<span class="op" id="5633984">(</span><span class="ident" id="5633985">p</span>&nbsp;<span class="op" id="5633987">*</span><span class="ident" id="5633988">parser</span><span class="op" id="5633994">)</span>&nbsp;<span class="ident" id="5633996">expect</span><span class="op" id="5634002">(</span><span class="ident" id="5634003">tok</span>&nbsp;<span class="ident" id="5634007">token</span><span class="op" id="5634012">.</span><span class="ident" id="5634013">Token</span><span class="op" id="5634018">)</span>&nbsp;<span class="ident" id="5634020">token</span><span class="op" id="5634025">.</span><span class="ident" id="5634026">Pos</span>&nbsp;<span class="op" id="5634030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5634033">pos</span>&nbsp;<span class="op" id="5634037">:=</span>&nbsp;<span class="ident" id="5634040">p</span><span class="op" id="5634041">.</span><span class="ident" id="5634042">pos</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5634047">if</span>&nbsp;<span class="ident" id="5634050">p</span><span class="op" id="5634051">.</span><span class="ident" id="5634052">tok</span>&nbsp;<span class="op" id="5634056">!=</span>&nbsp;<span class="ident" id="5634059">tok</span>&nbsp;<span class="op" id="5634063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5634067">p</span><span class="op" id="5634068">.</span><span class="ident" id="5634069">errorExpected</span><span class="op" id="5634082">(</span><span class="ident" id="5634083">pos</span><span class="op" id="5634086">,</span>&nbsp;<span class="string" id="5634088">&#34;&#39;&#34;</span><span class="op" id="5634091">+</span><span class="ident" id="5634092">tok</span><span class="op" id="5634095">.</span><span class="ident" id="5634096">String</span><span class="op" id="5634102">(</span><span class="op" id="5634103">)</span><span class="op" id="5634104">+</span><span class="string" id="5634105">&#34;&#39;&#34;</span><span class="op" id="5634108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5634111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5634114">p</span><span class="op" id="5634115">.</span><span class="ident" id="5634116">next</span><span class="op" id="5634120">(</span><span class="op" id="5634121">)</span>&nbsp;<span class="comment" id="5634123">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5634141">return</span>&nbsp;<span class="ident" id="5634148">pos</span><br>
<span class="lineno">390</span><span class="op" id="5634152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5634155">//&nbsp;expectClosing&nbsp;is&nbsp;like&nbsp;expect&nbsp;but&nbsp;provides&nbsp;a&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="5634223">//&nbsp;for&nbsp;the&nbsp;common&nbsp;case&nbsp;of&nbsp;a&nbsp;missing&nbsp;comma&nbsp;before&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span><span class="comment" id="5634283">//</span><br>
<span class="lineno">395</span><span class="keyword" id="5634286">func</span>&nbsp;<span class="op" id="5634291">(</span><span class="ident" id="5634292">p</span>&nbsp;<span class="op" id="5634294">*</span><span class="ident" id="5634295">parser</span><span class="op" id="5634301">)</span>&nbsp;<span class="ident" id="5634303">expectClosing</span><span class="op" id="5634316">(</span><span class="ident" id="5634317">tok</span>&nbsp;<span class="ident" id="5634321">token</span><span class="op" id="5634326">.</span><span class="ident" id="5634327">Token</span><span class="op" id="5634332">,</span>&nbsp;<span class="ident" id="5634334">context</span>&nbsp;<span class="builtintype" id="5634342">string</span><span class="op" id="5634348">)</span>&nbsp;<span class="ident" id="5634350">token</span><span class="op" id="5634355">.</span><span class="ident" id="5634356">Pos</span>&nbsp;<span class="op" id="5634360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5634363">if</span>&nbsp;<span class="ident" id="5634366">p</span><span class="op" id="5634367">.</span><span class="ident" id="5634368">tok</span>&nbsp;<span class="op" id="5634372">!=</span>&nbsp;<span class="ident" id="5634375">tok</span>&nbsp;<span class="op" id="5634379">&amp;&amp;</span>&nbsp;<span class="ident" id="5634382">p</span><span class="op" id="5634383">.</span><span class="ident" id="5634384">tok</span>&nbsp;<span class="op" id="5634388">==</span>&nbsp;<span class="ident" id="5634391">token</span><span class="op" id="5634396">.</span><span class="ident" id="5634397">SEMICOLON</span>&nbsp;<span class="op" id="5634407">&amp;&amp;</span>&nbsp;<span class="ident" id="5634410">p</span><span class="op" id="5634411">.</span><span class="ident" id="5634412">lit</span>&nbsp;<span class="op" id="5634416">==</span>&nbsp;<span class="string" id="5634419">&#34;\n&#34;</span>&nbsp;<span class="op" id="5634424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5634428">p</span><span class="op" id="5634429">.</span><span class="builtintype" id="5634430">error</span><span class="op" id="5634435">(</span><span class="ident" id="5634436">p</span><span class="op" id="5634437">.</span><span class="ident" id="5634438">pos</span><span class="op" id="5634441">,</span>&nbsp;<span class="string" id="5634443">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="5634475">+</span><span class="ident" id="5634476">context</span><span class="op" id="5634483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5634487">p</span><span class="op" id="5634488">.</span><span class="ident" id="5634489">next</span><span class="op" id="5634493">(</span><span class="op" id="5634494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5634497">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5634500">return</span>&nbsp;<span class="ident" id="5634507">p</span><span class="op" id="5634508">.</span><span class="ident" id="5634509">expect</span><span class="op" id="5634515">(</span><span class="ident" id="5634516">tok</span><span class="op" id="5634519">)</span><br>
<span class="lineno"></span><span class="op" id="5634521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5634524">func</span>&nbsp;<span class="op" id="5634529">(</span><span class="ident" id="5634530">p</span>&nbsp;<span class="op" id="5634532">*</span><span class="ident" id="5634533">parser</span><span class="op" id="5634539">)</span>&nbsp;<span class="ident" id="5634541">expectSemi</span><span class="op" id="5634551">(</span><span class="op" id="5634552">)</span>&nbsp;<span class="op" id="5634554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5634557">//&nbsp;semicolon&nbsp;is&nbsp;optional&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;}&#39;</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5634611">if</span>&nbsp;<span class="ident" id="5634614">p</span><span class="op" id="5634615">.</span><span class="ident" id="5634616">tok</span>&nbsp;<span class="op" id="5634620">!=</span>&nbsp;<span class="ident" id="5634623">token</span><span class="op" id="5634628">.</span><span class="ident" id="5634629">RPAREN</span>&nbsp;<span class="op" id="5634636">&amp;&amp;</span>&nbsp;<span class="ident" id="5634639">p</span><span class="op" id="5634640">.</span><span class="ident" id="5634641">tok</span>&nbsp;<span class="op" id="5634645">!=</span>&nbsp;<span class="ident" id="5634648">token</span><span class="op" id="5634653">.</span><span class="ident" id="5634654">RBRACE</span>&nbsp;<span class="op" id="5634661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5634665">if</span>&nbsp;<span class="ident" id="5634668">p</span><span class="op" id="5634669">.</span><span class="ident" id="5634670">tok</span>&nbsp;<span class="op" id="5634674">==</span>&nbsp;<span class="ident" id="5634677">token</span><span class="op" id="5634682">.</span><span class="ident" id="5634683">SEMICOLON</span>&nbsp;<span class="op" id="5634693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5634698">p</span><span class="op" id="5634699">.</span><span class="ident" id="5634700">next</span><span class="op" id="5634704">(</span><span class="op" id="5634705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5634709">}</span>&nbsp;<span class="keyword" id="5634711">else</span>&nbsp;<span class="op" id="5634716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5634721">p</span><span class="op" id="5634722">.</span><span class="ident" id="5634723">errorExpected</span><span class="op" id="5634736">(</span><span class="ident" id="5634737">p</span><span class="op" id="5634738">.</span><span class="ident" id="5634739">pos</span><span class="op" id="5634742">,</span>&nbsp;<span class="string" id="5634744">&#34;&#39;;&#39;&#34;</span><span class="op" id="5634749">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5634754">syncStmt</span><span class="op" id="5634762">(</span><span class="ident" id="5634763">p</span><span class="op" id="5634764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5634768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5634771">}</span><br>
<span class="lineno"></span><span class="op" id="5634773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="5634776">func</span>&nbsp;<span class="op" id="5634781">(</span><span class="ident" id="5634782">p</span>&nbsp;<span class="op" id="5634784">*</span><span class="ident" id="5634785">parser</span><span class="op" id="5634791">)</span>&nbsp;<span class="ident" id="5634793">atComma</span><span class="op" id="5634800">(</span><span class="ident" id="5634801">context</span>&nbsp;<span class="builtintype" id="5634809">string</span><span class="op" id="5634815">)</span>&nbsp;<span class="builtintype" id="5634817">bool</span>&nbsp;<span class="op" id="5634822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5634825">if</span>&nbsp;<span class="ident" id="5634828">p</span><span class="op" id="5634829">.</span><span class="ident" id="5634830">tok</span>&nbsp;<span class="op" id="5634834">==</span>&nbsp;<span class="ident" id="5634837">token</span><span class="op" id="5634842">.</span><span class="ident" id="5634843">COMMA</span>&nbsp;<span class="op" id="5634849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5634853">return</span>&nbsp;<span class="builtintype" id="5634860">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5634866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5634869">if</span>&nbsp;<span class="ident" id="5634872">p</span><span class="op" id="5634873">.</span><span class="ident" id="5634874">tok</span>&nbsp;<span class="op" id="5634878">==</span>&nbsp;<span class="ident" id="5634881">token</span><span class="op" id="5634886">.</span><span class="ident" id="5634887">SEMICOLON</span>&nbsp;<span class="op" id="5634897">&amp;&amp;</span>&nbsp;<span class="ident" id="5634900">p</span><span class="op" id="5634901">.</span><span class="ident" id="5634902">lit</span>&nbsp;<span class="op" id="5634906">==</span>&nbsp;<span class="string" id="5634909">&#34;\n&#34;</span>&nbsp;<span class="op" id="5634914">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5634918">p</span><span class="op" id="5634919">.</span><span class="builtintype" id="5634920">error</span><span class="op" id="5634925">(</span><span class="ident" id="5634926">p</span><span class="op" id="5634927">.</span><span class="ident" id="5634928">pos</span><span class="op" id="5634931">,</span>&nbsp;<span class="string" id="5634933">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="5634965">+</span><span class="ident" id="5634966">context</span><span class="op" id="5634973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5634977">return</span>&nbsp;<span class="builtintype" id="5634984">true</span>&nbsp;<span class="comment" id="5634989">//&nbsp;&#34;insert&#34;&nbsp;the&nbsp;comma&nbsp;and&nbsp;continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5635026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5635029">return</span>&nbsp;<span class="builtintype" id="5635036">false</span><br>
<span class="lineno">425</span><span class="op" id="5635042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5635045">func</span>&nbsp;<span class="ident" id="5635050">assert</span><span class="op" id="5635056">(</span><span class="ident" id="5635057">cond</span>&nbsp;<span class="builtintype" id="5635062">bool</span><span class="op" id="5635066">,</span>&nbsp;<span class="ident" id="5635068">msg</span>&nbsp;<span class="builtintype" id="5635072">string</span><span class="op" id="5635078">)</span>&nbsp;<span class="op" id="5635080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5635083">if</span>&nbsp;<span class="op" id="5635086">!</span><span class="ident" id="5635087">cond</span>&nbsp;<span class="op" id="5635092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5635096">panic</span><span class="op" id="5635101">(</span><span class="string" id="5635102">&#34;go/parser&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="5635131">+</span>&nbsp;<span class="ident" id="5635133">msg</span><span class="op" id="5635136">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5635139">}</span><br>
<span class="lineno"></span><span class="op" id="5635141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5635144">//&nbsp;syncStmt&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="5635188">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno">435</span><span class="comment" id="5635232">//</span><br>
<span class="lineno"></span><span class="keyword" id="5635235">func</span>&nbsp;<span class="ident" id="5635240">syncStmt</span><span class="op" id="5635248">(</span><span class="ident" id="5635249">p</span>&nbsp;<span class="op" id="5635251">*</span><span class="ident" id="5635252">parser</span><span class="op" id="5635258">)</span>&nbsp;<span class="op" id="5635260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5635263">for</span>&nbsp;<span class="op" id="5635267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5635271">switch</span>&nbsp;<span class="ident" id="5635278">p</span><span class="op" id="5635279">.</span><span class="ident" id="5635280">tok</span>&nbsp;<span class="op" id="5635284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5635288">case</span>&nbsp;<span class="ident" id="5635293">token</span><span class="op" id="5635298">.</span><span class="ident" id="5635299">BREAK</span><span class="op" id="5635304">,</span>&nbsp;<span class="ident" id="5635306">token</span><span class="op" id="5635311">.</span><span class="ident" id="5635312">CONST</span><span class="op" id="5635317">,</span>&nbsp;<span class="ident" id="5635319">token</span><span class="op" id="5635324">.</span><span class="ident" id="5635325">CONTINUE</span><span class="op" id="5635333">,</span>&nbsp;<span class="ident" id="5635335">token</span><span class="op" id="5635340">.</span><span class="ident" id="5635341">DEFER</span><span class="op" id="5635346">,</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635351">token</span><span class="op" id="5635356">.</span><span class="ident" id="5635357">FALLTHROUGH</span><span class="op" id="5635368">,</span>&nbsp;<span class="ident" id="5635370">token</span><span class="op" id="5635375">.</span><span class="ident" id="5635376">FOR</span><span class="op" id="5635379">,</span>&nbsp;<span class="ident" id="5635381">token</span><span class="op" id="5635386">.</span><span class="ident" id="5635387">GO</span><span class="op" id="5635389">,</span>&nbsp;<span class="ident" id="5635391">token</span><span class="op" id="5635396">.</span><span class="ident" id="5635397">GOTO</span><span class="op" id="5635401">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635406">token</span><span class="op" id="5635411">.</span><span class="ident" id="5635412">IF</span><span class="op" id="5635414">,</span>&nbsp;<span class="ident" id="5635416">token</span><span class="op" id="5635421">.</span><span class="ident" id="5635422">RETURN</span><span class="op" id="5635428">,</span>&nbsp;<span class="ident" id="5635430">token</span><span class="op" id="5635435">.</span><span class="ident" id="5635436">SELECT</span><span class="op" id="5635442">,</span>&nbsp;<span class="ident" id="5635444">token</span><span class="op" id="5635449">.</span><span class="ident" id="5635450">SWITCH</span><span class="op" id="5635456">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635461">token</span><span class="op" id="5635466">.</span><span class="ident" id="5635467">TYPE</span><span class="op" id="5635471">,</span>&nbsp;<span class="ident" id="5635473">token</span><span class="op" id="5635478">.</span><span class="ident" id="5635479">VAR</span><span class="op" id="5635482">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5635487">//&nbsp;Return&nbsp;only&nbsp;if&nbsp;parser&nbsp;made&nbsp;some&nbsp;progress&nbsp;since&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5635545">//&nbsp;sync&nbsp;or&nbsp;if&nbsp;it&nbsp;has&nbsp;not&nbsp;reached&nbsp;10&nbsp;sync&nbsp;calls&nbsp;without</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5635603">//&nbsp;progress.&nbsp;Otherwise&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;token&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5635659">//&nbsp;avoid&nbsp;an&nbsp;endless&nbsp;parser&nbsp;loop&nbsp;(it&nbsp;is&nbsp;possible&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5635715">//&nbsp;both&nbsp;parseOperand&nbsp;and&nbsp;parseStmt&nbsp;call&nbsp;syncStmt&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5635771">//&nbsp;correctly&nbsp;do&nbsp;not&nbsp;advance,&nbsp;thus&nbsp;the&nbsp;need&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5635825">//&nbsp;invocation&nbsp;limit&nbsp;p.syncCnt).</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5635860">if</span>&nbsp;<span class="ident" id="5635863">p</span><span class="op" id="5635864">.</span><span class="ident" id="5635865">pos</span>&nbsp;<span class="op" id="5635869">==</span>&nbsp;<span class="ident" id="5635872">p</span><span class="op" id="5635873">.</span><span class="ident" id="5635874">syncPos</span>&nbsp;<span class="op" id="5635882">&amp;&amp;</span>&nbsp;<span class="ident" id="5635885">p</span><span class="op" id="5635886">.</span><span class="ident" id="5635887">syncCnt</span>&nbsp;<span class="op" id="5635895">&lt;</span>&nbsp;<span class="num" id="5635897">10</span>&nbsp;<span class="op" id="5635900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635906">p</span><span class="op" id="5635907">.</span><span class="ident" id="5635908">syncCnt</span><span class="op" id="5635915">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5635922">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5635932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5635937">if</span>&nbsp;<span class="ident" id="5635940">p</span><span class="op" id="5635941">.</span><span class="ident" id="5635942">pos</span>&nbsp;<span class="op" id="5635946">&gt;</span>&nbsp;<span class="ident" id="5635948">p</span><span class="op" id="5635949">.</span><span class="ident" id="5635950">syncPos</span>&nbsp;<span class="op" id="5635958">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635964">p</span><span class="op" id="5635965">.</span><span class="ident" id="5635966">syncPos</span>&nbsp;<span class="op" id="5635974">=</span>&nbsp;<span class="ident" id="5635976">p</span><span class="op" id="5635977">.</span><span class="ident" id="5635978">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5635986">p</span><span class="op" id="5635987">.</span><span class="ident" id="5635988">syncCnt</span>&nbsp;<span class="op" id="5635996">=</span>&nbsp;<span class="num" id="5635998">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636004">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5636014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5636019">//&nbsp;Reaching&nbsp;here&nbsp;indicates&nbsp;a&nbsp;parser&nbsp;bug,&nbsp;likely&nbsp;an</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5636073">//&nbsp;incorrect&nbsp;token&nbsp;list&nbsp;in&nbsp;this&nbsp;function,&nbsp;but&nbsp;it&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5636130">//&nbsp;leads&nbsp;to&nbsp;skipping&nbsp;of&nbsp;possibly&nbsp;correct&nbsp;code&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5636184">//&nbsp;previous&nbsp;error&nbsp;is&nbsp;present,&nbsp;and&nbsp;thus&nbsp;is&nbsp;preferred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5636239">//&nbsp;over&nbsp;a&nbsp;non-terminating&nbsp;parse.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636274">case</span>&nbsp;<span class="ident" id="5636279">token</span><span class="op" id="5636284">.</span><span class="ident" id="5636285">EOF</span><span class="op" id="5636288">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636293">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5636302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636306">p</span><span class="op" id="5636307">.</span><span class="ident" id="5636308">next</span><span class="op" id="5636312">(</span><span class="op" id="5636313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5636316">}</span><br>
<span class="lineno"></span><span class="op" id="5636318">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="5636321">//&nbsp;syncDecl&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;declaration.</span><br>
<span class="lineno"></span><span class="comment" id="5636367">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="5636411">//</span><br>
<span class="lineno"></span><span class="keyword" id="5636414">func</span>&nbsp;<span class="ident" id="5636419">syncDecl</span><span class="op" id="5636427">(</span><span class="ident" id="5636428">p</span>&nbsp;<span class="op" id="5636430">*</span><span class="ident" id="5636431">parser</span><span class="op" id="5636437">)</span>&nbsp;<span class="op" id="5636439">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636442">for</span>&nbsp;<span class="op" id="5636446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636450">switch</span>&nbsp;<span class="ident" id="5636457">p</span><span class="op" id="5636458">.</span><span class="ident" id="5636459">tok</span>&nbsp;<span class="op" id="5636463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636467">case</span>&nbsp;<span class="ident" id="5636472">token</span><span class="op" id="5636477">.</span><span class="ident" id="5636478">CONST</span><span class="op" id="5636483">,</span>&nbsp;<span class="ident" id="5636485">token</span><span class="op" id="5636490">.</span><span class="ident" id="5636491">TYPE</span><span class="op" id="5636495">,</span>&nbsp;<span class="ident" id="5636497">token</span><span class="op" id="5636502">.</span><span class="ident" id="5636503">VAR</span><span class="op" id="5636506">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5636511">//&nbsp;see&nbsp;comments&nbsp;in&nbsp;syncStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636542">if</span>&nbsp;<span class="ident" id="5636545">p</span><span class="op" id="5636546">.</span><span class="ident" id="5636547">pos</span>&nbsp;<span class="op" id="5636551">==</span>&nbsp;<span class="ident" id="5636554">p</span><span class="op" id="5636555">.</span><span class="ident" id="5636556">syncPos</span>&nbsp;<span class="op" id="5636564">&amp;&amp;</span>&nbsp;<span class="ident" id="5636567">p</span><span class="op" id="5636568">.</span><span class="ident" id="5636569">syncCnt</span>&nbsp;<span class="op" id="5636577">&lt;</span>&nbsp;<span class="num" id="5636579">10</span>&nbsp;<span class="op" id="5636582">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636588">p</span><span class="op" id="5636589">.</span><span class="ident" id="5636590">syncCnt</span><span class="op" id="5636597">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636604">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5636614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636619">if</span>&nbsp;<span class="ident" id="5636622">p</span><span class="op" id="5636623">.</span><span class="ident" id="5636624">pos</span>&nbsp;<span class="op" id="5636628">&gt;</span>&nbsp;<span class="ident" id="5636630">p</span><span class="op" id="5636631">.</span><span class="ident" id="5636632">syncPos</span>&nbsp;<span class="op" id="5636640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636646">p</span><span class="op" id="5636647">.</span><span class="ident" id="5636648">syncPos</span>&nbsp;<span class="op" id="5636656">=</span>&nbsp;<span class="ident" id="5636658">p</span><span class="op" id="5636659">.</span><span class="ident" id="5636660">pos</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636668">p</span><span class="op" id="5636669">.</span><span class="ident" id="5636670">syncCnt</span>&nbsp;<span class="op" id="5636678">=</span>&nbsp;<span class="num" id="5636680">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636686">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5636696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636700">case</span>&nbsp;<span class="ident" id="5636705">token</span><span class="op" id="5636710">.</span><span class="ident" id="5636711">EOF</span><span class="op" id="5636714">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5636719">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5636728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5636732">p</span><span class="op" id="5636733">.</span><span class="ident" id="5636734">next</span><span class="op" id="5636738">(</span><span class="op" id="5636739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5636742">}</span><br>
<span class="lineno"></span><span class="op" id="5636744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="5636747">//&nbsp;safePos&nbsp;returns&nbsp;a&nbsp;valid&nbsp;file&nbsp;position&nbsp;for&nbsp;a&nbsp;given&nbsp;position:&nbsp;If&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="5636817">//&nbsp;is&nbsp;valid&nbsp;to&nbsp;begin&nbsp;with,&nbsp;safePos&nbsp;returns&nbsp;pos.&nbsp;If&nbsp;pos&nbsp;is&nbsp;out-of-range,</span><br>
<span class="lineno"></span><span class="comment" id="5636889">//&nbsp;safePos&nbsp;returns&nbsp;the&nbsp;EOF&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="5636926">//</span><br>
<span class="lineno"></span><span class="comment" id="5636929">//&nbsp;This&nbsp;is&nbsp;hack&nbsp;to&nbsp;work&nbsp;around&nbsp;&#34;artificial&#34;&nbsp;end&nbsp;positions&nbsp;in&nbsp;the&nbsp;AST&nbsp;which</span><br>
<span class="lineno">500</span><span class="comment" id="5637004">//&nbsp;are&nbsp;computed&nbsp;by&nbsp;adding&nbsp;1&nbsp;to&nbsp;(presumably&nbsp;valid)&nbsp;token&nbsp;positions.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5637078">//&nbsp;token&nbsp;positions&nbsp;are&nbsp;invalid&nbsp;due&nbsp;to&nbsp;parse&nbsp;errors,&nbsp;the&nbsp;resulting&nbsp;end&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5637157">//&nbsp;may&nbsp;be&nbsp;past&nbsp;the&nbsp;file&#39;s&nbsp;EOF&nbsp;position,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to&nbsp;panics&nbsp;if&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="5637232">//&nbsp;later&nbsp;on.</span><br>
<span class="lineno"></span><span class="comment" id="5637245">//</span><br>
<span class="lineno">505</span><span class="keyword" id="5637248">func</span>&nbsp;<span class="op" id="5637253">(</span><span class="ident" id="5637254">p</span>&nbsp;<span class="op" id="5637256">*</span><span class="ident" id="5637257">parser</span><span class="op" id="5637263">)</span>&nbsp;<span class="ident" id="5637265">safePos</span><span class="op" id="5637272">(</span><span class="ident" id="5637273">pos</span>&nbsp;<span class="ident" id="5637277">token</span><span class="op" id="5637282">.</span><span class="ident" id="5637283">Pos</span><span class="op" id="5637286">)</span>&nbsp;<span class="op" id="5637288">(</span><span class="ident" id="5637289">res</span>&nbsp;<span class="ident" id="5637293">token</span><span class="op" id="5637298">.</span><span class="ident" id="5637299">Pos</span><span class="op" id="5637302">)</span>&nbsp;<span class="op" id="5637304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637307">defer</span>&nbsp;<span class="keyword" id="5637313">func</span><span class="op" id="5637317">(</span><span class="op" id="5637318">)</span>&nbsp;<span class="op" id="5637320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637324">if</span>&nbsp;<span class="builtinfunc" id="5637327">recover</span><span class="op" id="5637334">(</span><span class="op" id="5637335">)</span>&nbsp;<span class="op" id="5637337">!=</span>&nbsp;<span class="ident" id="5637340">nil</span>&nbsp;<span class="op" id="5637344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637349">res</span>&nbsp;<span class="op" id="5637353">=</span>&nbsp;<span class="ident" id="5637355">token</span><span class="op" id="5637360">.</span><span class="ident" id="5637361">Pos</span><span class="op" id="5637364">(</span><span class="ident" id="5637365">p</span><span class="op" id="5637366">.</span><span class="ident" id="5637367">file</span><span class="op" id="5637371">.</span><span class="ident" id="5637372">Base</span><span class="op" id="5637376">(</span><span class="op" id="5637377">)</span>&nbsp;<span class="op" id="5637379">+</span>&nbsp;<span class="ident" id="5637381">p</span><span class="op" id="5637382">.</span><span class="ident" id="5637383">file</span><span class="op" id="5637387">.</span><span class="ident" id="5637388">Size</span><span class="op" id="5637392">(</span><span class="op" id="5637393">)</span><span class="op" id="5637394">)</span>&nbsp;<span class="comment" id="5637396">//&nbsp;EOF&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5637414">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5637417">}</span><span class="op" id="5637418">(</span><span class="op" id="5637419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637422">_</span>&nbsp;<span class="op" id="5637424">=</span>&nbsp;<span class="ident" id="5637426">p</span><span class="op" id="5637427">.</span><span class="ident" id="5637428">file</span><span class="op" id="5637432">.</span><span class="ident" id="5637433">Offset</span><span class="op" id="5637439">(</span><span class="ident" id="5637440">pos</span><span class="op" id="5637443">)</span>&nbsp;<span class="comment" id="5637445">//&nbsp;trigger&nbsp;a&nbsp;panic&nbsp;if&nbsp;position&nbsp;is&nbsp;out-of-range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637493">return</span>&nbsp;<span class="ident" id="5637500">pos</span><br>
<span class="lineno"></span><span class="op" id="5637504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="comment" id="5637507">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5637587">//&nbsp;Identifiers</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5637603">func</span>&nbsp;<span class="op" id="5637608">(</span><span class="ident" id="5637609">p</span>&nbsp;<span class="op" id="5637611">*</span><span class="ident" id="5637612">parser</span><span class="op" id="5637618">)</span>&nbsp;<span class="ident" id="5637620">parseIdent</span><span class="op" id="5637630">(</span><span class="op" id="5637631">)</span>&nbsp;<span class="op" id="5637633">*</span><span class="ident" id="5637634">ast</span><span class="op" id="5637637">.</span><span class="ident" id="5637638">Ident</span>&nbsp;<span class="op" id="5637644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637647">pos</span>&nbsp;<span class="op" id="5637651">:=</span>&nbsp;<span class="ident" id="5637654">p</span><span class="op" id="5637655">.</span><span class="ident" id="5637656">pos</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637661">name</span>&nbsp;<span class="op" id="5637666">:=</span>&nbsp;<span class="string" id="5637669">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637674">if</span>&nbsp;<span class="ident" id="5637677">p</span><span class="op" id="5637678">.</span><span class="ident" id="5637679">tok</span>&nbsp;<span class="op" id="5637683">==</span>&nbsp;<span class="ident" id="5637686">token</span><span class="op" id="5637691">.</span><span class="ident" id="5637692">IDENT</span>&nbsp;<span class="op" id="5637698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637702">name</span>&nbsp;<span class="op" id="5637707">=</span>&nbsp;<span class="ident" id="5637709">p</span><span class="op" id="5637710">.</span><span class="ident" id="5637711">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637717">p</span><span class="op" id="5637718">.</span><span class="ident" id="5637719">next</span><span class="op" id="5637723">(</span><span class="op" id="5637724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5637727">}</span>&nbsp;<span class="keyword" id="5637729">else</span>&nbsp;<span class="op" id="5637734">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637738">p</span><span class="op" id="5637739">.</span><span class="ident" id="5637740">expect</span><span class="op" id="5637746">(</span><span class="ident" id="5637747">token</span><span class="op" id="5637752">.</span><span class="ident" id="5637753">IDENT</span><span class="op" id="5637758">)</span>&nbsp;<span class="comment" id="5637760">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5637792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637795">return</span>&nbsp;<span class="op" id="5637802">&amp;</span><span class="ident" id="5637803">ast</span><span class="op" id="5637806">.</span><span class="ident" id="5637807">Ident</span><span class="op" id="5637812">{</span><span class="ident" id="5637813">NamePos</span><span class="op" id="5637820">:</span>&nbsp;<span class="ident" id="5637822">pos</span><span class="op" id="5637825">,</span>&nbsp;<span class="ident" id="5637827">Name</span><span class="op" id="5637831">:</span>&nbsp;<span class="ident" id="5637833">name</span><span class="op" id="5637837">}</span><br>
<span class="lineno"></span><span class="op" id="5637839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="keyword" id="5637842">func</span>&nbsp;<span class="op" id="5637847">(</span><span class="ident" id="5637848">p</span>&nbsp;<span class="op" id="5637850">*</span><span class="ident" id="5637851">parser</span><span class="op" id="5637857">)</span>&nbsp;<span class="ident" id="5637859">parseIdentList</span><span class="op" id="5637873">(</span><span class="op" id="5637874">)</span>&nbsp;<span class="op" id="5637876">(</span><span class="ident" id="5637877">list</span>&nbsp;<span class="op" id="5637882">[</span><span class="op" id="5637883">]</span><span class="op" id="5637884">*</span><span class="ident" id="5637885">ast</span><span class="op" id="5637888">.</span><span class="ident" id="5637889">Ident</span><span class="op" id="5637894">)</span>&nbsp;<span class="op" id="5637896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637899">if</span>&nbsp;<span class="ident" id="5637902">p</span><span class="op" id="5637903">.</span><span class="ident" id="5637904">trace</span>&nbsp;<span class="op" id="5637910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637914">defer</span>&nbsp;<span class="ident" id="5637920">un</span><span class="op" id="5637922">(</span><span class="ident" id="5637923">trace</span><span class="op" id="5637928">(</span><span class="ident" id="5637929">p</span><span class="op" id="5637930">,</span>&nbsp;<span class="string" id="5637932">&#34;IdentList&#34;</span><span class="op" id="5637943">)</span><span class="op" id="5637944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5637947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5637951">list</span>&nbsp;<span class="op" id="5637956">=</span>&nbsp;<span class="builtinfunc" id="5637958">append</span><span class="op" id="5637964">(</span><span class="ident" id="5637965">list</span><span class="op" id="5637969">,</span>&nbsp;<span class="ident" id="5637971">p</span><span class="op" id="5637972">.</span><span class="ident" id="5637973">parseIdent</span><span class="op" id="5637983">(</span><span class="op" id="5637984">)</span><span class="op" id="5637985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5637988">for</span>&nbsp;<span class="ident" id="5637992">p</span><span class="op" id="5637993">.</span><span class="ident" id="5637994">tok</span>&nbsp;<span class="op" id="5637998">==</span>&nbsp;<span class="ident" id="5638001">token</span><span class="op" id="5638006">.</span><span class="ident" id="5638007">COMMA</span>&nbsp;<span class="op" id="5638013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638017">p</span><span class="op" id="5638018">.</span><span class="ident" id="5638019">next</span><span class="op" id="5638023">(</span><span class="op" id="5638024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638028">list</span>&nbsp;<span class="op" id="5638033">=</span>&nbsp;<span class="builtinfunc" id="5638035">append</span><span class="op" id="5638041">(</span><span class="ident" id="5638042">list</span><span class="op" id="5638046">,</span>&nbsp;<span class="ident" id="5638048">p</span><span class="op" id="5638049">.</span><span class="ident" id="5638050">parseIdent</span><span class="op" id="5638060">(</span><span class="op" id="5638061">)</span><span class="op" id="5638062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638065">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638069">return</span><br>
<span class="lineno"></span><span class="op" id="5638076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5638079">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">545</span><span class="comment" id="5638159">//&nbsp;Common&nbsp;productions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5638182">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set,&nbsp;result&nbsp;list&nbsp;elements&nbsp;which&nbsp;are&nbsp;identifiers&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5638261">func</span>&nbsp;<span class="op" id="5638266">(</span><span class="ident" id="5638267">p</span>&nbsp;<span class="op" id="5638269">*</span><span class="ident" id="5638270">parser</span><span class="op" id="5638276">)</span>&nbsp;<span class="ident" id="5638278">parseExprList</span><span class="op" id="5638291">(</span><span class="ident" id="5638292">lhs</span>&nbsp;<span class="builtintype" id="5638296">bool</span><span class="op" id="5638300">)</span>&nbsp;<span class="op" id="5638302">(</span><span class="ident" id="5638303">list</span>&nbsp;<span class="op" id="5638308">[</span><span class="op" id="5638309">]</span><span class="ident" id="5638310">ast</span><span class="op" id="5638313">.</span><span class="ident" id="5638314">Expr</span><span class="op" id="5638318">)</span>&nbsp;<span class="op" id="5638320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638323">if</span>&nbsp;<span class="ident" id="5638326">p</span><span class="op" id="5638327">.</span><span class="ident" id="5638328">trace</span>&nbsp;<span class="op" id="5638334">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638338">defer</span>&nbsp;<span class="ident" id="5638344">un</span><span class="op" id="5638346">(</span><span class="ident" id="5638347">trace</span><span class="op" id="5638352">(</span><span class="ident" id="5638353">p</span><span class="op" id="5638354">,</span>&nbsp;<span class="string" id="5638356">&#34;ExpressionList&#34;</span><span class="op" id="5638372">)</span><span class="op" id="5638373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638380">list</span>&nbsp;<span class="op" id="5638385">=</span>&nbsp;<span class="builtinfunc" id="5638387">append</span><span class="op" id="5638393">(</span><span class="ident" id="5638394">list</span><span class="op" id="5638398">,</span>&nbsp;<span class="ident" id="5638400">p</span><span class="op" id="5638401">.</span><span class="ident" id="5638402">checkExpr</span><span class="op" id="5638411">(</span><span class="ident" id="5638412">p</span><span class="op" id="5638413">.</span><span class="ident" id="5638414">parseExpr</span><span class="op" id="5638423">(</span><span class="ident" id="5638424">lhs</span><span class="op" id="5638427">)</span><span class="op" id="5638428">)</span><span class="op" id="5638429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638432">for</span>&nbsp;<span class="ident" id="5638436">p</span><span class="op" id="5638437">.</span><span class="ident" id="5638438">tok</span>&nbsp;<span class="op" id="5638442">==</span>&nbsp;<span class="ident" id="5638445">token</span><span class="op" id="5638450">.</span><span class="ident" id="5638451">COMMA</span>&nbsp;<span class="op" id="5638457">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638461">p</span><span class="op" id="5638462">.</span><span class="ident" id="5638463">next</span><span class="op" id="5638467">(</span><span class="op" id="5638468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638472">list</span>&nbsp;<span class="op" id="5638477">=</span>&nbsp;<span class="builtinfunc" id="5638479">append</span><span class="op" id="5638485">(</span><span class="ident" id="5638486">list</span><span class="op" id="5638490">,</span>&nbsp;<span class="ident" id="5638492">p</span><span class="op" id="5638493">.</span><span class="ident" id="5638494">checkExpr</span><span class="op" id="5638503">(</span><span class="ident" id="5638504">p</span><span class="op" id="5638505">.</span><span class="ident" id="5638506">parseExpr</span><span class="op" id="5638515">(</span><span class="ident" id="5638516">lhs</span><span class="op" id="5638519">)</span><span class="op" id="5638520">)</span><span class="op" id="5638521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5638524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638528">return</span><br>
<span class="lineno">560</span><span class="op" id="5638535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5638538">func</span>&nbsp;<span class="op" id="5638543">(</span><span class="ident" id="5638544">p</span>&nbsp;<span class="op" id="5638546">*</span><span class="ident" id="5638547">parser</span><span class="op" id="5638553">)</span>&nbsp;<span class="ident" id="5638555">parseLhsList</span><span class="op" id="5638567">(</span><span class="op" id="5638568">)</span>&nbsp;<span class="op" id="5638570">[</span><span class="op" id="5638571">]</span><span class="ident" id="5638572">ast</span><span class="op" id="5638575">.</span><span class="ident" id="5638576">Expr</span>&nbsp;<span class="op" id="5638581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638584">old</span>&nbsp;<span class="op" id="5638588">:=</span>&nbsp;<span class="ident" id="5638591">p</span><span class="op" id="5638592">.</span><span class="ident" id="5638593">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638600">p</span><span class="op" id="5638601">.</span><span class="ident" id="5638602">inRhs</span>&nbsp;<span class="op" id="5638608">=</span>&nbsp;<span class="builtintype" id="5638610">false</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5638617">list</span>&nbsp;<span class="op" id="5638622">:=</span>&nbsp;<span class="ident" id="5638625">p</span><span class="op" id="5638626">.</span><span class="ident" id="5638627">parseExprList</span><span class="op" id="5638640">(</span><span class="builtintype" id="5638641">true</span><span class="op" id="5638645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638648">switch</span>&nbsp;<span class="ident" id="5638655">p</span><span class="op" id="5638656">.</span><span class="ident" id="5638657">tok</span>&nbsp;<span class="op" id="5638661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638664">case</span>&nbsp;<span class="ident" id="5638669">token</span><span class="op" id="5638674">.</span><span class="ident" id="5638675">DEFINE</span><span class="op" id="5638681">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638685">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;short&nbsp;variable&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638726">//&nbsp;but&nbsp;doesn&#39;t&nbsp;enter&nbsp;scope&nbsp;until&nbsp;later:</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638768">//&nbsp;caller&nbsp;must&nbsp;call&nbsp;p.shortVarDecl(p.makeIdentList(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638828">//&nbsp;at&nbsp;appropriate&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5638853">case</span>&nbsp;<span class="ident" id="5638858">token</span><span class="op" id="5638863">.</span><span class="ident" id="5638864">COLON</span><span class="op" id="5638869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638873">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;label&nbsp;declaration&nbsp;or&nbsp;a&nbsp;communication&nbsp;clause&nbsp;of&nbsp;a&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5638943">//&nbsp;statement&nbsp;(parseLhsList&nbsp;is&nbsp;not&nbsp;called&nbsp;when&nbsp;parsing&nbsp;the&nbsp;case&nbsp;clause</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5639015">//&nbsp;of&nbsp;a&nbsp;switch&nbsp;statement):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5639044">//&nbsp;-&nbsp;labels&nbsp;are&nbsp;declared&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;parseLhsList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5639101">//&nbsp;-&nbsp;for&nbsp;communication&nbsp;clauses,&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;stand-alone&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5639172">//&nbsp;&nbsp;&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;we&nbsp;have&nbsp;a&nbsp;syntax&nbsp;error;&nbsp;there&nbsp;is&nbsp;no&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5639241">//&nbsp;&nbsp;&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639286">default</span><span class="op" id="5639293">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5639297">//&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;declared&nbsp;elsewhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639341">for</span>&nbsp;<span class="ident" id="5639345">_</span><span class="op" id="5639346">,</span>&nbsp;<span class="ident" id="5639348">x</span>&nbsp;<span class="op" id="5639350">:=</span>&nbsp;<span class="keyword" id="5639353">range</span>&nbsp;<span class="ident" id="5639359">list</span>&nbsp;<span class="op" id="5639364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639369">p</span><span class="op" id="5639370">.</span><span class="ident" id="5639371">resolve</span><span class="op" id="5639378">(</span><span class="ident" id="5639379">x</span><span class="op" id="5639380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639384">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639390">p</span><span class="op" id="5639391">.</span><span class="ident" id="5639392">inRhs</span>&nbsp;<span class="op" id="5639398">=</span>&nbsp;<span class="ident" id="5639400">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639405">return</span>&nbsp;<span class="ident" id="5639412">list</span><br>
<span class="lineno"></span><span class="op" id="5639417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="keyword" id="5639420">func</span>&nbsp;<span class="op" id="5639425">(</span><span class="ident" id="5639426">p</span>&nbsp;<span class="op" id="5639428">*</span><span class="ident" id="5639429">parser</span><span class="op" id="5639435">)</span>&nbsp;<span class="ident" id="5639437">parseRhsList</span><span class="op" id="5639449">(</span><span class="op" id="5639450">)</span>&nbsp;<span class="op" id="5639452">[</span><span class="op" id="5639453">]</span><span class="ident" id="5639454">ast</span><span class="op" id="5639457">.</span><span class="ident" id="5639458">Expr</span>&nbsp;<span class="op" id="5639463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639466">old</span>&nbsp;<span class="op" id="5639470">:=</span>&nbsp;<span class="ident" id="5639473">p</span><span class="op" id="5639474">.</span><span class="ident" id="5639475">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639482">p</span><span class="op" id="5639483">.</span><span class="ident" id="5639484">inRhs</span>&nbsp;<span class="op" id="5639490">=</span>&nbsp;<span class="builtintype" id="5639492">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639498">list</span>&nbsp;<span class="op" id="5639503">:=</span>&nbsp;<span class="ident" id="5639506">p</span><span class="op" id="5639507">.</span><span class="ident" id="5639508">parseExprList</span><span class="op" id="5639521">(</span><span class="builtintype" id="5639522">false</span><span class="op" id="5639527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639530">p</span><span class="op" id="5639531">.</span><span class="ident" id="5639532">inRhs</span>&nbsp;<span class="op" id="5639538">=</span>&nbsp;<span class="ident" id="5639540">old</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639545">return</span>&nbsp;<span class="ident" id="5639552">list</span><br>
<span class="lineno"></span><span class="op" id="5639557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5639560">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5639640">//&nbsp;Types</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="5639650">func</span>&nbsp;<span class="op" id="5639655">(</span><span class="ident" id="5639656">p</span>&nbsp;<span class="op" id="5639658">*</span><span class="ident" id="5639659">parser</span><span class="op" id="5639665">)</span>&nbsp;<span class="ident" id="5639667">parseType</span><span class="op" id="5639676">(</span><span class="op" id="5639677">)</span>&nbsp;<span class="ident" id="5639679">ast</span><span class="op" id="5639682">.</span><span class="ident" id="5639683">Expr</span>&nbsp;<span class="op" id="5639688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639691">if</span>&nbsp;<span class="ident" id="5639694">p</span><span class="op" id="5639695">.</span><span class="ident" id="5639696">trace</span>&nbsp;<span class="op" id="5639702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639706">defer</span>&nbsp;<span class="ident" id="5639712">un</span><span class="op" id="5639714">(</span><span class="ident" id="5639715">trace</span><span class="op" id="5639720">(</span><span class="ident" id="5639721">p</span><span class="op" id="5639722">,</span>&nbsp;<span class="string" id="5639724">&#34;Type&#34;</span><span class="op" id="5639730">)</span><span class="op" id="5639731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639734">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639738">typ</span>&nbsp;<span class="op" id="5639742">:=</span>&nbsp;<span class="ident" id="5639745">p</span><span class="op" id="5639746">.</span><span class="ident" id="5639747">tryType</span><span class="op" id="5639754">(</span><span class="op" id="5639755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639759">if</span>&nbsp;<span class="ident" id="5639762">typ</span>&nbsp;<span class="op" id="5639766">==</span>&nbsp;<span class="ident" id="5639769">nil</span>&nbsp;<span class="op" id="5639773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639777">pos</span>&nbsp;<span class="op" id="5639781">:=</span>&nbsp;<span class="ident" id="5639784">p</span><span class="op" id="5639785">.</span><span class="ident" id="5639786">pos</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639792">p</span><span class="op" id="5639793">.</span><span class="ident" id="5639794">errorExpected</span><span class="op" id="5639807">(</span><span class="ident" id="5639808">pos</span><span class="op" id="5639811">,</span>&nbsp;<span class="string" id="5639813">&#34;type&#34;</span><span class="op" id="5639819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5639823">p</span><span class="op" id="5639824">.</span><span class="ident" id="5639825">next</span><span class="op" id="5639829">(</span><span class="op" id="5639830">)</span>&nbsp;<span class="comment" id="5639832">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639851">return</span>&nbsp;<span class="op" id="5639858">&amp;</span><span class="ident" id="5639859">ast</span><span class="op" id="5639862">.</span><span class="ident" id="5639863">BadExpr</span><span class="op" id="5639870">{</span><span class="ident" id="5639871">From</span><span class="op" id="5639875">:</span>&nbsp;<span class="ident" id="5639877">pos</span><span class="op" id="5639880">,</span>&nbsp;<span class="ident" id="5639882">To</span><span class="op" id="5639884">:</span>&nbsp;<span class="ident" id="5639886">p</span><span class="op" id="5639887">.</span><span class="ident" id="5639888">pos</span><span class="op" id="5639891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5639894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5639898">return</span>&nbsp;<span class="ident" id="5639905">typ</span><br>
<span class="lineno"></span><span class="op" id="5639909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5639912">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5639967">func</span>&nbsp;<span class="op" id="5639972">(</span><span class="ident" id="5639973">p</span>&nbsp;<span class="op" id="5639975">*</span><span class="ident" id="5639976">parser</span><span class="op" id="5639982">)</span>&nbsp;<span class="ident" id="5639984">parseTypeName</span><span class="op" id="5639997">(</span><span class="op" id="5639998">)</span>&nbsp;<span class="ident" id="5640000">ast</span><span class="op" id="5640003">.</span><span class="ident" id="5640004">Expr</span>&nbsp;<span class="op" id="5640009">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640012">if</span>&nbsp;<span class="ident" id="5640015">p</span><span class="op" id="5640016">.</span><span class="ident" id="5640017">trace</span>&nbsp;<span class="op" id="5640023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640027">defer</span>&nbsp;<span class="ident" id="5640033">un</span><span class="op" id="5640035">(</span><span class="ident" id="5640036">trace</span><span class="op" id="5640041">(</span><span class="ident" id="5640042">p</span><span class="op" id="5640043">,</span>&nbsp;<span class="string" id="5640045">&#34;TypeName&#34;</span><span class="op" id="5640055">)</span><span class="op" id="5640056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640063">ident</span>&nbsp;<span class="op" id="5640069">:=</span>&nbsp;<span class="ident" id="5640072">p</span><span class="op" id="5640073">.</span><span class="ident" id="5640074">parseIdent</span><span class="op" id="5640084">(</span><span class="op" id="5640085">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5640088">//&nbsp;don&#39;t&nbsp;resolve&nbsp;ident&nbsp;yet&nbsp;-&nbsp;it&nbsp;may&nbsp;be&nbsp;a&nbsp;parameter&nbsp;or&nbsp;field&nbsp;name</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640155">if</span>&nbsp;<span class="ident" id="5640158">p</span><span class="op" id="5640159">.</span><span class="ident" id="5640160">tok</span>&nbsp;<span class="op" id="5640164">==</span>&nbsp;<span class="ident" id="5640167">token</span><span class="op" id="5640172">.</span><span class="ident" id="5640173">PERIOD</span>&nbsp;<span class="op" id="5640180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5640184">//&nbsp;ident&nbsp;is&nbsp;a&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640213">p</span><span class="op" id="5640214">.</span><span class="ident" id="5640215">next</span><span class="op" id="5640219">(</span><span class="op" id="5640220">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640224">p</span><span class="op" id="5640225">.</span><span class="ident" id="5640226">resolve</span><span class="op" id="5640233">(</span><span class="ident" id="5640234">ident</span><span class="op" id="5640239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640243">sel</span>&nbsp;<span class="op" id="5640247">:=</span>&nbsp;<span class="ident" id="5640250">p</span><span class="op" id="5640251">.</span><span class="ident" id="5640252">parseIdent</span><span class="op" id="5640262">(</span><span class="op" id="5640263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640267">return</span>&nbsp;<span class="op" id="5640274">&amp;</span><span class="ident" id="5640275">ast</span><span class="op" id="5640278">.</span><span class="ident" id="5640279">SelectorExpr</span><span class="op" id="5640291">{</span><span class="ident" id="5640292">X</span><span class="op" id="5640293">:</span>&nbsp;<span class="ident" id="5640295">ident</span><span class="op" id="5640300">,</span>&nbsp;<span class="ident" id="5640302">Sel</span><span class="op" id="5640305">:</span>&nbsp;<span class="ident" id="5640307">sel</span><span class="op" id="5640310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640317">return</span>&nbsp;<span class="ident" id="5640324">ident</span><br>
<span class="lineno"></span><span class="op" id="5640330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5640333">func</span>&nbsp;<span class="op" id="5640338">(</span><span class="ident" id="5640339">p</span>&nbsp;<span class="op" id="5640341">*</span><span class="ident" id="5640342">parser</span><span class="op" id="5640348">)</span>&nbsp;<span class="ident" id="5640350">parseArrayType</span><span class="op" id="5640364">(</span><span class="op" id="5640365">)</span>&nbsp;<span class="ident" id="5640367">ast</span><span class="op" id="5640370">.</span><span class="ident" id="5640371">Expr</span>&nbsp;<span class="op" id="5640376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640379">if</span>&nbsp;<span class="ident" id="5640382">p</span><span class="op" id="5640383">.</span><span class="ident" id="5640384">trace</span>&nbsp;<span class="op" id="5640390">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640394">defer</span>&nbsp;<span class="ident" id="5640400">un</span><span class="op" id="5640402">(</span><span class="ident" id="5640403">trace</span><span class="op" id="5640408">(</span><span class="ident" id="5640409">p</span><span class="op" id="5640410">,</span>&nbsp;<span class="string" id="5640412">&#34;ArrayType&#34;</span><span class="op" id="5640423">)</span><span class="op" id="5640424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640431">lbrack</span>&nbsp;<span class="op" id="5640438">:=</span>&nbsp;<span class="ident" id="5640441">p</span><span class="op" id="5640442">.</span><span class="ident" id="5640443">expect</span><span class="op" id="5640449">(</span><span class="ident" id="5640450">token</span><span class="op" id="5640455">.</span><span class="ident" id="5640456">LBRACK</span><span class="op" id="5640462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640465">p</span><span class="op" id="5640466">.</span><span class="ident" id="5640467">exprLev</span><span class="op" id="5640474">++</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640478">var</span>&nbsp;<span class="builtinfunc" id="5640482">len</span>&nbsp;<span class="ident" id="5640486">ast</span><span class="op" id="5640489">.</span><span class="ident" id="5640490">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5640496">//&nbsp;always&nbsp;permit&nbsp;ellipsis&nbsp;for&nbsp;more&nbsp;fault-tolerant&nbsp;parsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640555">if</span>&nbsp;<span class="ident" id="5640558">p</span><span class="op" id="5640559">.</span><span class="ident" id="5640560">tok</span>&nbsp;<span class="op" id="5640564">==</span>&nbsp;<span class="ident" id="5640567">token</span><span class="op" id="5640572">.</span><span class="ident" id="5640573">ELLIPSIS</span>&nbsp;<span class="op" id="5640582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5640586">len</span>&nbsp;<span class="op" id="5640590">=</span>&nbsp;<span class="op" id="5640592">&amp;</span><span class="ident" id="5640593">ast</span><span class="op" id="5640596">.</span><span class="ident" id="5640597">Ellipsis</span><span class="op" id="5640605">{</span><span class="ident" id="5640606">Ellipsis</span><span class="op" id="5640614">:</span>&nbsp;<span class="ident" id="5640616">p</span><span class="op" id="5640617">.</span><span class="ident" id="5640618">pos</span><span class="op" id="5640621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640625">p</span><span class="op" id="5640626">.</span><span class="ident" id="5640627">next</span><span class="op" id="5640631">(</span><span class="op" id="5640632">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640635">}</span>&nbsp;<span class="keyword" id="5640637">else</span>&nbsp;<span class="keyword" id="5640642">if</span>&nbsp;<span class="ident" id="5640645">p</span><span class="op" id="5640646">.</span><span class="ident" id="5640647">tok</span>&nbsp;<span class="op" id="5640651">!=</span>&nbsp;<span class="ident" id="5640654">token</span><span class="op" id="5640659">.</span><span class="ident" id="5640660">RBRACK</span>&nbsp;<span class="op" id="5640667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5640671">len</span>&nbsp;<span class="op" id="5640675">=</span>&nbsp;<span class="ident" id="5640677">p</span><span class="op" id="5640678">.</span><span class="ident" id="5640679">parseRhs</span><span class="op" id="5640687">(</span><span class="op" id="5640688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5640691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640694">p</span><span class="op" id="5640695">.</span><span class="ident" id="5640696">exprLev</span><span class="op" id="5640703">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640707">p</span><span class="op" id="5640708">.</span><span class="ident" id="5640709">expect</span><span class="op" id="5640715">(</span><span class="ident" id="5640716">token</span><span class="op" id="5640721">.</span><span class="ident" id="5640722">RBRACK</span><span class="op" id="5640728">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640731">elt</span>&nbsp;<span class="op" id="5640735">:=</span>&nbsp;<span class="ident" id="5640738">p</span><span class="op" id="5640739">.</span><span class="ident" id="5640740">parseType</span><span class="op" id="5640749">(</span><span class="op" id="5640750">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640754">return</span>&nbsp;<span class="op" id="5640761">&amp;</span><span class="ident" id="5640762">ast</span><span class="op" id="5640765">.</span><span class="ident" id="5640766">ArrayType</span><span class="op" id="5640775">{</span><span class="ident" id="5640776">Lbrack</span><span class="op" id="5640782">:</span>&nbsp;<span class="ident" id="5640784">lbrack</span><span class="op" id="5640790">,</span>&nbsp;<span class="ident" id="5640792">Len</span><span class="op" id="5640795">:</span>&nbsp;<span class="builtinfunc" id="5640797">len</span><span class="op" id="5640800">,</span>&nbsp;<span class="ident" id="5640802">Elt</span><span class="op" id="5640805">:</span>&nbsp;<span class="ident" id="5640807">elt</span><span class="op" id="5640810">}</span><br>
<span class="lineno"></span><span class="op" id="5640812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="keyword" id="5640815">func</span>&nbsp;<span class="op" id="5640820">(</span><span class="ident" id="5640821">p</span>&nbsp;<span class="op" id="5640823">*</span><span class="ident" id="5640824">parser</span><span class="op" id="5640830">)</span>&nbsp;<span class="ident" id="5640832">makeIdentList</span><span class="op" id="5640845">(</span><span class="ident" id="5640846">list</span>&nbsp;<span class="op" id="5640851">[</span><span class="op" id="5640852">]</span><span class="ident" id="5640853">ast</span><span class="op" id="5640856">.</span><span class="ident" id="5640857">Expr</span><span class="op" id="5640861">)</span>&nbsp;<span class="op" id="5640863">[</span><span class="op" id="5640864">]</span><span class="op" id="5640865">*</span><span class="ident" id="5640866">ast</span><span class="op" id="5640869">.</span><span class="ident" id="5640870">Ident</span>&nbsp;<span class="op" id="5640876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640879">idents</span>&nbsp;<span class="op" id="5640886">:=</span>&nbsp;<span class="builtinfunc" id="5640889">make</span><span class="op" id="5640893">(</span><span class="op" id="5640894">[</span><span class="op" id="5640895">]</span><span class="op" id="5640896">*</span><span class="ident" id="5640897">ast</span><span class="op" id="5640900">.</span><span class="ident" id="5640901">Ident</span><span class="op" id="5640906">,</span>&nbsp;<span class="builtinfunc" id="5640908">len</span><span class="op" id="5640911">(</span><span class="ident" id="5640912">list</span><span class="op" id="5640916">)</span><span class="op" id="5640917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640920">for</span>&nbsp;<span class="ident" id="5640924">i</span><span class="op" id="5640925">,</span>&nbsp;<span class="ident" id="5640927">x</span>&nbsp;<span class="op" id="5640929">:=</span>&nbsp;<span class="keyword" id="5640932">range</span>&nbsp;<span class="ident" id="5640938">list</span>&nbsp;<span class="op" id="5640943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640947">ident</span><span class="op" id="5640952">,</span>&nbsp;<span class="ident" id="5640954">isIdent</span>&nbsp;<span class="op" id="5640962">:=</span>&nbsp;<span class="ident" id="5640965">x</span><span class="op" id="5640966">.</span><span class="op" id="5640967">(</span><span class="op" id="5640968">*</span><span class="ident" id="5640969">ast</span><span class="op" id="5640972">.</span><span class="ident" id="5640973">Ident</span><span class="op" id="5640978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640982">if</span>&nbsp;<span class="op" id="5640985">!</span><span class="ident" id="5640986">isIdent</span>&nbsp;<span class="op" id="5640994">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640999">if</span>&nbsp;<span class="ident" id="5641002">_</span><span class="op" id="5641003">,</span>&nbsp;<span class="ident" id="5641005">isBad</span>&nbsp;<span class="op" id="5641011">:=</span>&nbsp;<span class="ident" id="5641014">x</span><span class="op" id="5641015">.</span><span class="op" id="5641016">(</span><span class="op" id="5641017">*</span><span class="ident" id="5641018">ast</span><span class="op" id="5641021">.</span><span class="ident" id="5641022">BadExpr</span><span class="op" id="5641029">)</span><span class="op" id="5641030">;</span>&nbsp;<span class="op" id="5641032">!</span><span class="ident" id="5641033">isBad</span>&nbsp;<span class="op" id="5641039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641045">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641088">p</span><span class="op" id="5641089">.</span><span class="ident" id="5641090">errorExpected</span><span class="op" id="5641103">(</span><span class="ident" id="5641104">x</span><span class="op" id="5641105">.</span><span class="ident" id="5641106">Pos</span><span class="op" id="5641109">(</span><span class="op" id="5641110">)</span><span class="op" id="5641111">,</span>&nbsp;<span class="string" id="5641113">&#34;identifier&#34;</span><span class="op" id="5641125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641135">ident</span>&nbsp;<span class="op" id="5641141">=</span>&nbsp;<span class="op" id="5641143">&amp;</span><span class="ident" id="5641144">ast</span><span class="op" id="5641147">.</span><span class="ident" id="5641148">Ident</span><span class="op" id="5641153">{</span><span class="ident" id="5641154">NamePos</span><span class="op" id="5641161">:</span>&nbsp;<span class="ident" id="5641163">x</span><span class="op" id="5641164">.</span><span class="ident" id="5641165">Pos</span><span class="op" id="5641168">(</span><span class="op" id="5641169">)</span><span class="op" id="5641170">,</span>&nbsp;<span class="ident" id="5641172">Name</span><span class="op" id="5641176">:</span>&nbsp;<span class="string" id="5641178">&#34;_&#34;</span><span class="op" id="5641181">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641189">idents</span><span class="op" id="5641195">[</span><span class="ident" id="5641196">i</span><span class="op" id="5641197">]</span>&nbsp;<span class="op" id="5641199">=</span>&nbsp;<span class="ident" id="5641201">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641211">return</span>&nbsp;<span class="ident" id="5641218">idents</span><br>
<span class="lineno"></span><span class="op" id="5641225">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="5641228">func</span>&nbsp;<span class="op" id="5641233">(</span><span class="ident" id="5641234">p</span>&nbsp;<span class="op" id="5641236">*</span><span class="ident" id="5641237">parser</span><span class="op" id="5641243">)</span>&nbsp;<span class="ident" id="5641245">parseFieldDecl</span><span class="op" id="5641259">(</span><span class="ident" id="5641260">scope</span>&nbsp;<span class="op" id="5641266">*</span><span class="ident" id="5641267">ast</span><span class="op" id="5641270">.</span><span class="ident" id="5641271">Scope</span><span class="op" id="5641276">)</span>&nbsp;<span class="op" id="5641278">*</span><span class="ident" id="5641279">ast</span><span class="op" id="5641282">.</span><span class="ident" id="5641283">Field</span>&nbsp;<span class="op" id="5641289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641292">if</span>&nbsp;<span class="ident" id="5641295">p</span><span class="op" id="5641296">.</span><span class="ident" id="5641297">trace</span>&nbsp;<span class="op" id="5641303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641307">defer</span>&nbsp;<span class="ident" id="5641313">un</span><span class="op" id="5641315">(</span><span class="ident" id="5641316">trace</span><span class="op" id="5641321">(</span><span class="ident" id="5641322">p</span><span class="op" id="5641323">,</span>&nbsp;<span class="string" id="5641325">&#34;FieldDecl&#34;</span><span class="op" id="5641336">)</span><span class="op" id="5641337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641340">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641344">doc</span>&nbsp;<span class="op" id="5641348">:=</span>&nbsp;<span class="ident" id="5641351">p</span><span class="op" id="5641352">.</span><span class="ident" id="5641353">leadComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641367">//&nbsp;FieldDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641381">list</span><span class="op" id="5641385">,</span>&nbsp;<span class="ident" id="5641387">typ</span>&nbsp;<span class="op" id="5641391">:=</span>&nbsp;<span class="ident" id="5641394">p</span><span class="op" id="5641395">.</span><span class="ident" id="5641396">parseVarList</span><span class="op" id="5641408">(</span><span class="builtintype" id="5641409">false</span><span class="op" id="5641414">)</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641418">//&nbsp;Tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641426">var</span>&nbsp;<span class="ident" id="5641430">tag</span>&nbsp;<span class="op" id="5641434">*</span><span class="ident" id="5641435">ast</span><span class="op" id="5641438">.</span><span class="ident" id="5641439">BasicLit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641449">if</span>&nbsp;<span class="ident" id="5641452">p</span><span class="op" id="5641453">.</span><span class="ident" id="5641454">tok</span>&nbsp;<span class="op" id="5641458">==</span>&nbsp;<span class="ident" id="5641461">token</span><span class="op" id="5641466">.</span><span class="ident" id="5641467">STRING</span>&nbsp;<span class="op" id="5641474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641478">tag</span>&nbsp;<span class="op" id="5641482">=</span>&nbsp;<span class="op" id="5641484">&amp;</span><span class="ident" id="5641485">ast</span><span class="op" id="5641488">.</span><span class="ident" id="5641489">BasicLit</span><span class="op" id="5641497">{</span><span class="ident" id="5641498">ValuePos</span><span class="op" id="5641506">:</span>&nbsp;<span class="ident" id="5641508">p</span><span class="op" id="5641509">.</span><span class="ident" id="5641510">pos</span><span class="op" id="5641513">,</span>&nbsp;<span class="ident" id="5641515">Kind</span><span class="op" id="5641519">:</span>&nbsp;<span class="ident" id="5641521">p</span><span class="op" id="5641522">.</span><span class="ident" id="5641523">tok</span><span class="op" id="5641526">,</span>&nbsp;<span class="ident" id="5641528">Value</span><span class="op" id="5641533">:</span>&nbsp;<span class="ident" id="5641535">p</span><span class="op" id="5641536">.</span><span class="ident" id="5641537">lit</span><span class="op" id="5641540">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641544">p</span><span class="op" id="5641545">.</span><span class="ident" id="5641546">next</span><span class="op" id="5641550">(</span><span class="op" id="5641551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641558">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641575">var</span>&nbsp;<span class="ident" id="5641579">idents</span>&nbsp;<span class="op" id="5641586">[</span><span class="op" id="5641587">]</span><span class="op" id="5641588">*</span><span class="ident" id="5641589">ast</span><span class="op" id="5641592">.</span><span class="ident" id="5641593">Ident</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641600">if</span>&nbsp;<span class="ident" id="5641603">typ</span>&nbsp;<span class="op" id="5641607">!=</span>&nbsp;<span class="ident" id="5641610">nil</span>&nbsp;<span class="op" id="5641614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641618">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641643">idents</span>&nbsp;<span class="op" id="5641650">=</span>&nbsp;<span class="ident" id="5641652">p</span><span class="op" id="5641653">.</span><span class="ident" id="5641654">makeIdentList</span><span class="op" id="5641667">(</span><span class="ident" id="5641668">list</span><span class="op" id="5641672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641675">}</span>&nbsp;<span class="keyword" id="5641677">else</span>&nbsp;<span class="op" id="5641682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641686">//&nbsp;[&#34;*&#34;]&nbsp;TypeName&nbsp;(AnonymousField)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641723">typ</span>&nbsp;<span class="op" id="5641727">=</span>&nbsp;<span class="ident" id="5641729">list</span><span class="op" id="5641733">[</span><span class="num" id="5641734">0</span><span class="op" id="5641735">]</span>&nbsp;<span class="comment" id="5641737">//&nbsp;we&nbsp;always&nbsp;have&nbsp;at&nbsp;least&nbsp;one&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641778">if</span>&nbsp;<span class="ident" id="5641781">n</span>&nbsp;<span class="op" id="5641783">:=</span>&nbsp;<span class="builtinfunc" id="5641786">len</span><span class="op" id="5641789">(</span><span class="ident" id="5641790">list</span><span class="op" id="5641794">)</span><span class="op" id="5641795">;</span>&nbsp;<span class="ident" id="5641797">n</span>&nbsp;<span class="op" id="5641799">&gt;</span>&nbsp;<span class="num" id="5641801">1</span>&nbsp;<span class="op" id="5641803">||</span>&nbsp;<span class="op" id="5641806">!</span><span class="ident" id="5641807">isTypeName</span><span class="op" id="5641817">(</span><span class="ident" id="5641818">deref</span><span class="op" id="5641823">(</span><span class="ident" id="5641824">typ</span><span class="op" id="5641827">)</span><span class="op" id="5641828">)</span>&nbsp;<span class="op" id="5641830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641835">pos</span>&nbsp;<span class="op" id="5641839">:=</span>&nbsp;<span class="ident" id="5641842">typ</span><span class="op" id="5641845">.</span><span class="ident" id="5641846">Pos</span><span class="op" id="5641849">(</span><span class="op" id="5641850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641855">p</span><span class="op" id="5641856">.</span><span class="ident" id="5641857">errorExpected</span><span class="op" id="5641870">(</span><span class="ident" id="5641871">pos</span><span class="op" id="5641874">,</span>&nbsp;<span class="string" id="5641876">&#34;anonymous&nbsp;field&#34;</span><span class="op" id="5641893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641898">typ</span>&nbsp;<span class="op" id="5641902">=</span>&nbsp;<span class="op" id="5641904">&amp;</span><span class="ident" id="5641905">ast</span><span class="op" id="5641908">.</span><span class="ident" id="5641909">BadExpr</span><span class="op" id="5641916">{</span><span class="ident" id="5641917">From</span><span class="op" id="5641921">:</span>&nbsp;<span class="ident" id="5641923">pos</span><span class="op" id="5641926">,</span>&nbsp;<span class="ident" id="5641928">To</span><span class="op" id="5641930">:</span>&nbsp;<span class="ident" id="5641932">p</span><span class="op" id="5641933">.</span><span class="ident" id="5641934">safePos</span><span class="op" id="5641941">(</span><span class="ident" id="5641942">list</span><span class="op" id="5641946">[</span><span class="ident" id="5641947">n</span><span class="op" id="5641948">-</span><span class="num" id="5641949">1</span><span class="op" id="5641950">]</span><span class="op" id="5641951">.</span><span class="ident" id="5641952">End</span><span class="op" id="5641955">(</span><span class="op" id="5641956">)</span><span class="op" id="5641957">)</span><span class="op" id="5641958">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641969">p</span><span class="op" id="5641970">.</span><span class="ident" id="5641971">expectSemi</span><span class="op" id="5641981">(</span><span class="op" id="5641982">)</span>&nbsp;<span class="comment" id="5641984">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642025">field</span>&nbsp;<span class="op" id="5642031">:=</span>&nbsp;<span class="op" id="5642034">&amp;</span><span class="ident" id="5642035">ast</span><span class="op" id="5642038">.</span><span class="ident" id="5642039">Field</span><span class="op" id="5642044">{</span><span class="ident" id="5642045">Doc</span><span class="op" id="5642048">:</span>&nbsp;<span class="ident" id="5642050">doc</span><span class="op" id="5642053">,</span>&nbsp;<span class="ident" id="5642055">Names</span><span class="op" id="5642060">:</span>&nbsp;<span class="ident" id="5642062">idents</span><span class="op" id="5642068">,</span>&nbsp;<span class="ident" id="5642070">Type</span><span class="op" id="5642074">:</span>&nbsp;<span class="ident" id="5642076">typ</span><span class="op" id="5642079">,</span>&nbsp;<span class="ident" id="5642081">Tag</span><span class="op" id="5642084">:</span>&nbsp;<span class="ident" id="5642086">tag</span><span class="op" id="5642089">,</span>&nbsp;<span class="ident" id="5642091">Comment</span><span class="op" id="5642098">:</span>&nbsp;<span class="ident" id="5642100">p</span><span class="op" id="5642101">.</span><span class="ident" id="5642102">lineComment</span><span class="op" id="5642113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642116">p</span><span class="op" id="5642117">.</span><span class="ident" id="5642118">declare</span><span class="op" id="5642125">(</span><span class="ident" id="5642126">field</span><span class="op" id="5642131">,</span>&nbsp;<span class="ident" id="5642133">nil</span><span class="op" id="5642136">,</span>&nbsp;<span class="ident" id="5642138">scope</span><span class="op" id="5642143">,</span>&nbsp;<span class="ident" id="5642145">ast</span><span class="op" id="5642148">.</span><span class="ident" id="5642149">Var</span><span class="op" id="5642152">,</span>&nbsp;<span class="ident" id="5642154">idents</span><span class="op" id="5642160">...</span><span class="op" id="5642163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642166">p</span><span class="op" id="5642167">.</span><span class="ident" id="5642168">resolve</span><span class="op" id="5642175">(</span><span class="ident" id="5642176">typ</span><span class="op" id="5642179">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642183">return</span>&nbsp;<span class="ident" id="5642190">field</span><br>
<span class="lineno">715</span><span class="op" id="5642196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5642199">func</span>&nbsp;<span class="op" id="5642204">(</span><span class="ident" id="5642205">p</span>&nbsp;<span class="op" id="5642207">*</span><span class="ident" id="5642208">parser</span><span class="op" id="5642214">)</span>&nbsp;<span class="ident" id="5642216">parseStructType</span><span class="op" id="5642231">(</span><span class="op" id="5642232">)</span>&nbsp;<span class="op" id="5642234">*</span><span class="ident" id="5642235">ast</span><span class="op" id="5642238">.</span><span class="ident" id="5642239">StructType</span>&nbsp;<span class="op" id="5642250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642253">if</span>&nbsp;<span class="ident" id="5642256">p</span><span class="op" id="5642257">.</span><span class="ident" id="5642258">trace</span>&nbsp;<span class="op" id="5642264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642268">defer</span>&nbsp;<span class="ident" id="5642274">un</span><span class="op" id="5642276">(</span><span class="ident" id="5642277">trace</span><span class="op" id="5642282">(</span><span class="ident" id="5642283">p</span><span class="op" id="5642284">,</span>&nbsp;<span class="string" id="5642286">&#34;StructType&#34;</span><span class="op" id="5642298">)</span><span class="op" id="5642299">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642306">pos</span>&nbsp;<span class="op" id="5642310">:=</span>&nbsp;<span class="ident" id="5642313">p</span><span class="op" id="5642314">.</span><span class="ident" id="5642315">expect</span><span class="op" id="5642321">(</span><span class="ident" id="5642322">token</span><span class="op" id="5642327">.</span><span class="ident" id="5642328">STRUCT</span><span class="op" id="5642334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642337">lbrace</span>&nbsp;<span class="op" id="5642344">:=</span>&nbsp;<span class="ident" id="5642347">p</span><span class="op" id="5642348">.</span><span class="ident" id="5642349">expect</span><span class="op" id="5642355">(</span><span class="ident" id="5642356">token</span><span class="op" id="5642361">.</span><span class="ident" id="5642362">LBRACE</span><span class="op" id="5642368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642371">scope</span>&nbsp;<span class="op" id="5642377">:=</span>&nbsp;<span class="ident" id="5642380">ast</span><span class="op" id="5642383">.</span><span class="ident" id="5642384">NewScope</span><span class="op" id="5642392">(</span><span class="ident" id="5642393">nil</span><span class="op" id="5642396">)</span>&nbsp;<span class="comment" id="5642398">//&nbsp;struct&nbsp;scope</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642415">var</span>&nbsp;<span class="ident" id="5642419">list</span>&nbsp;<span class="op" id="5642424">[</span><span class="op" id="5642425">]</span><span class="op" id="5642426">*</span><span class="ident" id="5642427">ast</span><span class="op" id="5642430">.</span><span class="ident" id="5642431">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642438">for</span>&nbsp;<span class="ident" id="5642442">p</span><span class="op" id="5642443">.</span><span class="ident" id="5642444">tok</span>&nbsp;<span class="op" id="5642448">==</span>&nbsp;<span class="ident" id="5642451">token</span><span class="op" id="5642456">.</span><span class="ident" id="5642457">IDENT</span>&nbsp;<span class="op" id="5642463">||</span>&nbsp;<span class="ident" id="5642466">p</span><span class="op" id="5642467">.</span><span class="ident" id="5642468">tok</span>&nbsp;<span class="op" id="5642472">==</span>&nbsp;<span class="ident" id="5642475">token</span><span class="op" id="5642480">.</span><span class="ident" id="5642481">MUL</span>&nbsp;<span class="op" id="5642485">||</span>&nbsp;<span class="ident" id="5642488">p</span><span class="op" id="5642489">.</span><span class="ident" id="5642490">tok</span>&nbsp;<span class="op" id="5642494">==</span>&nbsp;<span class="ident" id="5642497">token</span><span class="op" id="5642502">.</span><span class="ident" id="5642503">LPAREN</span>&nbsp;<span class="op" id="5642510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5642514">//&nbsp;a&nbsp;field&nbsp;declaration&nbsp;cannot&nbsp;start&nbsp;with&nbsp;a&nbsp;&#39;(&#39;&nbsp;but&nbsp;we&nbsp;accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5642577">//&nbsp;it&nbsp;here&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;better&nbsp;error&nbsp;messages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5642640">//&nbsp;(parseFieldDecl&nbsp;will&nbsp;check&nbsp;and&nbsp;complain&nbsp;if&nbsp;necessary)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642699">list</span>&nbsp;<span class="op" id="5642704">=</span>&nbsp;<span class="builtinfunc" id="5642706">append</span><span class="op" id="5642712">(</span><span class="ident" id="5642713">list</span><span class="op" id="5642717">,</span>&nbsp;<span class="ident" id="5642719">p</span><span class="op" id="5642720">.</span><span class="ident" id="5642721">parseFieldDecl</span><span class="op" id="5642735">(</span><span class="ident" id="5642736">scope</span><span class="op" id="5642741">)</span><span class="op" id="5642742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642748">rbrace</span>&nbsp;<span class="op" id="5642755">:=</span>&nbsp;<span class="ident" id="5642758">p</span><span class="op" id="5642759">.</span><span class="ident" id="5642760">expect</span><span class="op" id="5642766">(</span><span class="ident" id="5642767">token</span><span class="op" id="5642772">.</span><span class="ident" id="5642773">RBRACE</span><span class="op" id="5642779">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642783">return</span>&nbsp;<span class="op" id="5642790">&amp;</span><span class="ident" id="5642791">ast</span><span class="op" id="5642794">.</span><span class="ident" id="5642795">StructType</span><span class="op" id="5642805">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642809">Struct</span><span class="op" id="5642815">:</span>&nbsp;<span class="ident" id="5642817">pos</span><span class="op" id="5642820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642824">Fields</span><span class="op" id="5642830">:</span>&nbsp;<span class="op" id="5642832">&amp;</span><span class="ident" id="5642833">ast</span><span class="op" id="5642836">.</span><span class="ident" id="5642837">FieldList</span><span class="op" id="5642846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642851">Opening</span><span class="op" id="5642858">:</span>&nbsp;<span class="ident" id="5642860">lbrace</span><span class="op" id="5642866">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642871">List</span><span class="op" id="5642875">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5642880">list</span><span class="op" id="5642884">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642889">Closing</span><span class="op" id="5642896">:</span>&nbsp;<span class="ident" id="5642898">rbrace</span><span class="op" id="5642904">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642908">}</span><span class="op" id="5642909">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642912">}</span><br>
<span class="lineno"></span><span class="op" id="5642914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5642917">func</span>&nbsp;<span class="op" id="5642922">(</span><span class="ident" id="5642923">p</span>&nbsp;<span class="op" id="5642925">*</span><span class="ident" id="5642926">parser</span><span class="op" id="5642932">)</span>&nbsp;<span class="ident" id="5642934">parsePointerType</span><span class="op" id="5642950">(</span><span class="op" id="5642951">)</span>&nbsp;<span class="op" id="5642953">*</span><span class="ident" id="5642954">ast</span><span class="op" id="5642957">.</span><span class="ident" id="5642958">StarExpr</span>&nbsp;<span class="op" id="5642967">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642970">if</span>&nbsp;<span class="ident" id="5642973">p</span><span class="op" id="5642974">.</span><span class="ident" id="5642975">trace</span>&nbsp;<span class="op" id="5642981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642985">defer</span>&nbsp;<span class="ident" id="5642991">un</span><span class="op" id="5642993">(</span><span class="ident" id="5642994">trace</span><span class="op" id="5642999">(</span><span class="ident" id="5643000">p</span><span class="op" id="5643001">,</span>&nbsp;<span class="string" id="5643003">&#34;PointerType&#34;</span><span class="op" id="5643016">)</span><span class="op" id="5643017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643024">star</span>&nbsp;<span class="op" id="5643029">:=</span>&nbsp;<span class="ident" id="5643032">p</span><span class="op" id="5643033">.</span><span class="ident" id="5643034">expect</span><span class="op" id="5643040">(</span><span class="ident" id="5643041">token</span><span class="op" id="5643046">.</span><span class="ident" id="5643047">MUL</span><span class="op" id="5643050">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643053">base</span>&nbsp;<span class="op" id="5643058">:=</span>&nbsp;<span class="ident" id="5643061">p</span><span class="op" id="5643062">.</span><span class="ident" id="5643063">parseType</span><span class="op" id="5643072">(</span><span class="op" id="5643073">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643077">return</span>&nbsp;<span class="op" id="5643084">&amp;</span><span class="ident" id="5643085">ast</span><span class="op" id="5643088">.</span><span class="ident" id="5643089">StarExpr</span><span class="op" id="5643097">{</span><span class="ident" id="5643098">Star</span><span class="op" id="5643102">:</span>&nbsp;<span class="ident" id="5643104">star</span><span class="op" id="5643108">,</span>&nbsp;<span class="ident" id="5643110">X</span><span class="op" id="5643111">:</span>&nbsp;<span class="ident" id="5643113">base</span><span class="op" id="5643117">}</span><br>
<span class="lineno"></span><span class="op" id="5643119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="5643122">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5643177">func</span>&nbsp;<span class="op" id="5643182">(</span><span class="ident" id="5643183">p</span>&nbsp;<span class="op" id="5643185">*</span><span class="ident" id="5643186">parser</span><span class="op" id="5643192">)</span>&nbsp;<span class="ident" id="5643194">tryVarType</span><span class="op" id="5643204">(</span><span class="ident" id="5643205">isParam</span>&nbsp;<span class="builtintype" id="5643213">bool</span><span class="op" id="5643217">)</span>&nbsp;<span class="ident" id="5643219">ast</span><span class="op" id="5643222">.</span><span class="ident" id="5643223">Expr</span>&nbsp;<span class="op" id="5643228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643231">if</span>&nbsp;<span class="ident" id="5643234">isParam</span>&nbsp;<span class="op" id="5643242">&amp;&amp;</span>&nbsp;<span class="ident" id="5643245">p</span><span class="op" id="5643246">.</span><span class="ident" id="5643247">tok</span>&nbsp;<span class="op" id="5643251">==</span>&nbsp;<span class="ident" id="5643254">token</span><span class="op" id="5643259">.</span><span class="ident" id="5643260">ELLIPSIS</span>&nbsp;<span class="op" id="5643269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643273">pos</span>&nbsp;<span class="op" id="5643277">:=</span>&nbsp;<span class="ident" id="5643280">p</span><span class="op" id="5643281">.</span><span class="ident" id="5643282">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643288">p</span><span class="op" id="5643289">.</span><span class="ident" id="5643290">next</span><span class="op" id="5643294">(</span><span class="op" id="5643295">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643299">typ</span>&nbsp;<span class="op" id="5643303">:=</span>&nbsp;<span class="ident" id="5643306">p</span><span class="op" id="5643307">.</span><span class="ident" id="5643308">tryIdentOrType</span><span class="op" id="5643322">(</span><span class="op" id="5643323">)</span>&nbsp;<span class="comment" id="5643325">//&nbsp;don&#39;t&nbsp;use&nbsp;parseType&nbsp;so&nbsp;we&nbsp;can&nbsp;provide&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643389">if</span>&nbsp;<span class="ident" id="5643392">typ</span>&nbsp;<span class="op" id="5643396">!=</span>&nbsp;<span class="ident" id="5643399">nil</span>&nbsp;<span class="op" id="5643403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643408">p</span><span class="op" id="5643409">.</span><span class="ident" id="5643410">resolve</span><span class="op" id="5643417">(</span><span class="ident" id="5643418">typ</span><span class="op" id="5643421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643425">}</span>&nbsp;<span class="keyword" id="5643427">else</span>&nbsp;<span class="op" id="5643432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643437">p</span><span class="op" id="5643438">.</span><span class="builtintype" id="5643439">error</span><span class="op" id="5643444">(</span><span class="ident" id="5643445">pos</span><span class="op" id="5643448">,</span>&nbsp;<span class="string" id="5643450">&#34;&#39;...&#39;&nbsp;parameter&nbsp;is&nbsp;missing&nbsp;type&#34;</span><span class="op" id="5643483">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643488">typ</span>&nbsp;<span class="op" id="5643492">=</span>&nbsp;<span class="op" id="5643494">&amp;</span><span class="ident" id="5643495">ast</span><span class="op" id="5643498">.</span><span class="ident" id="5643499">BadExpr</span><span class="op" id="5643506">{</span><span class="ident" id="5643507">From</span><span class="op" id="5643511">:</span>&nbsp;<span class="ident" id="5643513">pos</span><span class="op" id="5643516">,</span>&nbsp;<span class="ident" id="5643518">To</span><span class="op" id="5643520">:</span>&nbsp;<span class="ident" id="5643522">p</span><span class="op" id="5643523">.</span><span class="ident" id="5643524">pos</span><span class="op" id="5643527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643535">return</span>&nbsp;<span class="op" id="5643542">&amp;</span><span class="ident" id="5643543">ast</span><span class="op" id="5643546">.</span><span class="ident" id="5643547">Ellipsis</span><span class="op" id="5643555">{</span><span class="ident" id="5643556">Ellipsis</span><span class="op" id="5643564">:</span>&nbsp;<span class="ident" id="5643566">pos</span><span class="op" id="5643569">,</span>&nbsp;<span class="ident" id="5643571">Elt</span><span class="op" id="5643574">:</span>&nbsp;<span class="ident" id="5643576">typ</span><span class="op" id="5643579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643585">return</span>&nbsp;<span class="ident" id="5643592">p</span><span class="op" id="5643593">.</span><span class="ident" id="5643594">tryIdentOrType</span><span class="op" id="5643608">(</span><span class="op" id="5643609">)</span><br>
<span class="lineno">770</span><span class="op" id="5643611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5643614">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5643669">func</span>&nbsp;<span class="op" id="5643674">(</span><span class="ident" id="5643675">p</span>&nbsp;<span class="op" id="5643677">*</span><span class="ident" id="5643678">parser</span><span class="op" id="5643684">)</span>&nbsp;<span class="ident" id="5643686">parseVarType</span><span class="op" id="5643698">(</span><span class="ident" id="5643699">isParam</span>&nbsp;<span class="builtintype" id="5643707">bool</span><span class="op" id="5643711">)</span>&nbsp;<span class="ident" id="5643713">ast</span><span class="op" id="5643716">.</span><span class="ident" id="5643717">Expr</span>&nbsp;<span class="op" id="5643722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643725">typ</span>&nbsp;<span class="op" id="5643729">:=</span>&nbsp;<span class="ident" id="5643732">p</span><span class="op" id="5643733">.</span><span class="ident" id="5643734">tryVarType</span><span class="op" id="5643744">(</span><span class="ident" id="5643745">isParam</span><span class="op" id="5643752">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643755">if</span>&nbsp;<span class="ident" id="5643758">typ</span>&nbsp;<span class="op" id="5643762">==</span>&nbsp;<span class="ident" id="5643765">nil</span>&nbsp;<span class="op" id="5643769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643773">pos</span>&nbsp;<span class="op" id="5643777">:=</span>&nbsp;<span class="ident" id="5643780">p</span><span class="op" id="5643781">.</span><span class="ident" id="5643782">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643788">p</span><span class="op" id="5643789">.</span><span class="ident" id="5643790">errorExpected</span><span class="op" id="5643803">(</span><span class="ident" id="5643804">pos</span><span class="op" id="5643807">,</span>&nbsp;<span class="string" id="5643809">&#34;type&#34;</span><span class="op" id="5643815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643819">p</span><span class="op" id="5643820">.</span><span class="ident" id="5643821">next</span><span class="op" id="5643825">(</span><span class="op" id="5643826">)</span>&nbsp;<span class="comment" id="5643828">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643847">typ</span>&nbsp;<span class="op" id="5643851">=</span>&nbsp;<span class="op" id="5643853">&amp;</span><span class="ident" id="5643854">ast</span><span class="op" id="5643857">.</span><span class="ident" id="5643858">BadExpr</span><span class="op" id="5643865">{</span><span class="ident" id="5643866">From</span><span class="op" id="5643870">:</span>&nbsp;<span class="ident" id="5643872">pos</span><span class="op" id="5643875">,</span>&nbsp;<span class="ident" id="5643877">To</span><span class="op" id="5643879">:</span>&nbsp;<span class="ident" id="5643881">p</span><span class="op" id="5643882">.</span><span class="ident" id="5643883">pos</span><span class="op" id="5643886">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643892">return</span>&nbsp;<span class="ident" id="5643899">typ</span><br>
<span class="lineno"></span><span class="op" id="5643903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5643906">//&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;results&nbsp;are&nbsp;identifiers,&nbsp;they&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">785</span><span class="keyword" id="5643971">func</span>&nbsp;<span class="op" id="5643976">(</span><span class="ident" id="5643977">p</span>&nbsp;<span class="op" id="5643979">*</span><span class="ident" id="5643980">parser</span><span class="op" id="5643986">)</span>&nbsp;<span class="ident" id="5643988">parseVarList</span><span class="op" id="5644000">(</span><span class="ident" id="5644001">isParam</span>&nbsp;<span class="builtintype" id="5644009">bool</span><span class="op" id="5644013">)</span>&nbsp;<span class="op" id="5644015">(</span><span class="ident" id="5644016">list</span>&nbsp;<span class="op" id="5644021">[</span><span class="op" id="5644022">]</span><span class="ident" id="5644023">ast</span><span class="op" id="5644026">.</span><span class="ident" id="5644027">Expr</span><span class="op" id="5644031">,</span>&nbsp;<span class="ident" id="5644033">typ</span>&nbsp;<span class="ident" id="5644037">ast</span><span class="op" id="5644040">.</span><span class="ident" id="5644041">Expr</span><span class="op" id="5644045">)</span>&nbsp;<span class="op" id="5644047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5644050">if</span>&nbsp;<span class="ident" id="5644053">p</span><span class="op" id="5644054">.</span><span class="ident" id="5644055">trace</span>&nbsp;<span class="op" id="5644061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5644065">defer</span>&nbsp;<span class="ident" id="5644071">un</span><span class="op" id="5644073">(</span><span class="ident" id="5644074">trace</span><span class="op" id="5644079">(</span><span class="ident" id="5644080">p</span><span class="op" id="5644081">,</span>&nbsp;<span class="string" id="5644083">&#34;VarList&#34;</span><span class="op" id="5644092">)</span><span class="op" id="5644093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5644096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644100">//&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers&nbsp;looks&nbsp;like&nbsp;a&nbsp;list&nbsp;of&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644158">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644162">//&nbsp;parse/tryVarType&nbsp;accepts&nbsp;any&nbsp;type&nbsp;(including&nbsp;parenthesized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644225">//&nbsp;ones)&nbsp;even&nbsp;though&nbsp;the&nbsp;syntax&nbsp;does&nbsp;not&nbsp;permit&nbsp;them&nbsp;here:&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644288">//&nbsp;accept&nbsp;them&nbsp;all&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;complain&nbsp;later</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5644351">for</span>&nbsp;<span class="ident" id="5644355">typ</span>&nbsp;<span class="op" id="5644359">:=</span>&nbsp;<span class="ident" id="5644362">p</span><span class="op" id="5644363">.</span><span class="ident" id="5644364">parseVarType</span><span class="op" id="5644376">(</span><span class="ident" id="5644377">isParam</span><span class="op" id="5644384">)</span><span class="op" id="5644385">;</span>&nbsp;<span class="ident" id="5644387">typ</span>&nbsp;<span class="op" id="5644391">!=</span>&nbsp;<span class="ident" id="5644394">nil</span><span class="op" id="5644397">;</span>&nbsp;<span class="op" id="5644399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5644403">list</span>&nbsp;<span class="op" id="5644408">=</span>&nbsp;<span class="builtinfunc" id="5644410">append</span><span class="op" id="5644416">(</span><span class="ident" id="5644417">list</span><span class="op" id="5644421">,</span>&nbsp;<span class="ident" id="5644423">typ</span><span class="op" id="5644426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5644430">if</span>&nbsp;<span class="ident" id="5644433">p</span><span class="op" id="5644434">.</span><span class="ident" id="5644435">tok</span>&nbsp;<span class="op" id="5644439">!=</span>&nbsp;<span class="ident" id="5644442">token</span><span class="op" id="5644447">.</span><span class="ident" id="5644448">COMMA</span>&nbsp;<span class="op" id="5644454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5644459">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5644467">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5644471">p</span><span class="op" id="5644472">.</span><span class="ident" id="5644473">next</span><span class="op" id="5644477">(</span><span class="op" id="5644478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5644482">typ</span>&nbsp;<span class="op" id="5644486">=</span>&nbsp;<span class="ident" id="5644488">p</span><span class="op" id="5644489">.</span><span class="ident" id="5644490">tryVarType</span><span class="op" id="5644500">(</span><span class="ident" id="5644501">isParam</span><span class="op" id="5644508">)</span>&nbsp;<span class="comment" id="5644510">//&nbsp;maybe&nbsp;nil&nbsp;as&nbsp;in:&nbsp;func&nbsp;f(int,)&nbsp;{}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5644547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644551">//&nbsp;if&nbsp;we&nbsp;had&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers,&nbsp;it&nbsp;must&nbsp;be&nbsp;followed&nbsp;by&nbsp;a&nbsp;type</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5644618">typ</span>&nbsp;<span class="op" id="5644622">=</span>&nbsp;<span class="ident" id="5644624">p</span><span class="op" id="5644625">.</span><span class="ident" id="5644626">tryVarType</span><span class="op" id="5644636">(</span><span class="ident" id="5644637">isParam</span><span class="op" id="5644644">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5644648">return</span><br>
<span class="lineno"></span><span class="op" id="5644655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="5644658">func</span>&nbsp;<span class="op" id="5644663">(</span><span class="ident" id="5644664">p</span>&nbsp;<span class="op" id="5644666">*</span><span class="ident" id="5644667">parser</span><span class="op" id="5644673">)</span>&nbsp;<span class="ident" id="5644675">parseParameterList</span><span class="op" id="5644693">(</span><span class="ident" id="5644694">scope</span>&nbsp;<span class="op" id="5644700">*</span><span class="ident" id="5644701">ast</span><span class="op" id="5644704">.</span><span class="ident" id="5644705">Scope</span><span class="op" id="5644710">,</span>&nbsp;<span class="ident" id="5644712">ellipsisOk</span>&nbsp;<span class="builtintype" id="5644723">bool</span><span class="op" id="5644727">)</span>&nbsp;<span class="op" id="5644729">(</span><span class="ident" id="5644730">params</span>&nbsp;<span class="op" id="5644737">[</span><span class="op" id="5644738">]</span><span class="op" id="5644739">*</span><span class="ident" id="5644740">ast</span><span class="op" id="5644743">.</span><span class="ident" id="5644744">Field</span><span class="op" id="5644749">)</span>&nbsp;<span class="op" id="5644751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5644754">if</span>&nbsp;<span class="ident" id="5644757">p</span><span class="op" id="5644758">.</span><span class="ident" id="5644759">trace</span>&nbsp;<span class="op" id="5644765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5644769">defer</span>&nbsp;<span class="ident" id="5644775">un</span><span class="op" id="5644777">(</span><span class="ident" id="5644778">trace</span><span class="op" id="5644783">(</span><span class="ident" id="5644784">p</span><span class="op" id="5644785">,</span>&nbsp;<span class="string" id="5644787">&#34;ParameterList&#34;</span><span class="op" id="5644802">)</span><span class="op" id="5644803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5644806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644810">//&nbsp;ParameterDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5644828">list</span><span class="op" id="5644832">,</span>&nbsp;<span class="ident" id="5644834">typ</span>&nbsp;<span class="op" id="5644838">:=</span>&nbsp;<span class="ident" id="5644841">p</span><span class="op" id="5644842">.</span><span class="ident" id="5644843">parseVarList</span><span class="op" id="5644855">(</span><span class="ident" id="5644856">ellipsisOk</span><span class="op" id="5644866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644870">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5644887">if</span>&nbsp;<span class="ident" id="5644890">typ</span>&nbsp;<span class="op" id="5644894">!=</span>&nbsp;<span class="ident" id="5644897">nil</span>&nbsp;<span class="op" id="5644901">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644905">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5644930">idents</span>&nbsp;<span class="op" id="5644937">:=</span>&nbsp;<span class="ident" id="5644940">p</span><span class="op" id="5644941">.</span><span class="ident" id="5644942">makeIdentList</span><span class="op" id="5644955">(</span><span class="ident" id="5644956">list</span><span class="op" id="5644960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5644964">field</span>&nbsp;<span class="op" id="5644970">:=</span>&nbsp;<span class="op" id="5644973">&amp;</span><span class="ident" id="5644974">ast</span><span class="op" id="5644977">.</span><span class="ident" id="5644978">Field</span><span class="op" id="5644983">{</span><span class="ident" id="5644984">Names</span><span class="op" id="5644989">:</span>&nbsp;<span class="ident" id="5644991">idents</span><span class="op" id="5644997">,</span>&nbsp;<span class="ident" id="5644999">Type</span><span class="op" id="5645003">:</span>&nbsp;<span class="ident" id="5645005">typ</span><span class="op" id="5645008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645012">params</span>&nbsp;<span class="op" id="5645019">=</span>&nbsp;<span class="builtinfunc" id="5645021">append</span><span class="op" id="5645027">(</span><span class="ident" id="5645028">params</span><span class="op" id="5645034">,</span>&nbsp;<span class="ident" id="5645036">field</span><span class="op" id="5645041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645045">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645106">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645162">p</span><span class="op" id="5645163">.</span><span class="ident" id="5645164">declare</span><span class="op" id="5645171">(</span><span class="ident" id="5645172">field</span><span class="op" id="5645177">,</span>&nbsp;<span class="ident" id="5645179">nil</span><span class="op" id="5645182">,</span>&nbsp;<span class="ident" id="5645184">scope</span><span class="op" id="5645189">,</span>&nbsp;<span class="ident" id="5645191">ast</span><span class="op" id="5645194">.</span><span class="ident" id="5645195">Var</span><span class="op" id="5645198">,</span>&nbsp;<span class="ident" id="5645200">idents</span><span class="op" id="5645206">...</span><span class="op" id="5645209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645213">p</span><span class="op" id="5645214">.</span><span class="ident" id="5645215">resolve</span><span class="op" id="5645222">(</span><span class="ident" id="5645223">typ</span><span class="op" id="5645226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645230">if</span>&nbsp;<span class="op" id="5645233">!</span><span class="ident" id="5645234">p</span><span class="op" id="5645235">.</span><span class="ident" id="5645236">atComma</span><span class="op" id="5645243">(</span><span class="string" id="5645244">&#34;parameter&nbsp;list&#34;</span><span class="op" id="5645260">)</span>&nbsp;<span class="op" id="5645262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645267">return</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5645276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645280">p</span><span class="op" id="5645281">.</span><span class="ident" id="5645282">next</span><span class="op" id="5645286">(</span><span class="op" id="5645287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645291">for</span>&nbsp;<span class="ident" id="5645295">p</span><span class="op" id="5645296">.</span><span class="ident" id="5645297">tok</span>&nbsp;<span class="op" id="5645301">!=</span>&nbsp;<span class="ident" id="5645304">token</span><span class="op" id="5645309">.</span><span class="ident" id="5645310">RPAREN</span>&nbsp;<span class="op" id="5645317">&amp;&amp;</span>&nbsp;<span class="ident" id="5645320">p</span><span class="op" id="5645321">.</span><span class="ident" id="5645322">tok</span>&nbsp;<span class="op" id="5645326">!=</span>&nbsp;<span class="ident" id="5645329">token</span><span class="op" id="5645334">.</span><span class="ident" id="5645335">EOF</span>&nbsp;<span class="op" id="5645339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645344">idents</span>&nbsp;<span class="op" id="5645351">:=</span>&nbsp;<span class="ident" id="5645354">p</span><span class="op" id="5645355">.</span><span class="ident" id="5645356">parseIdentList</span><span class="op" id="5645370">(</span><span class="op" id="5645371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645376">typ</span>&nbsp;<span class="op" id="5645380">:=</span>&nbsp;<span class="ident" id="5645383">p</span><span class="op" id="5645384">.</span><span class="ident" id="5645385">parseVarType</span><span class="op" id="5645397">(</span><span class="ident" id="5645398">ellipsisOk</span><span class="op" id="5645408">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645413">field</span>&nbsp;<span class="op" id="5645419">:=</span>&nbsp;<span class="op" id="5645422">&amp;</span><span class="ident" id="5645423">ast</span><span class="op" id="5645426">.</span><span class="ident" id="5645427">Field</span><span class="op" id="5645432">{</span><span class="ident" id="5645433">Names</span><span class="op" id="5645438">:</span>&nbsp;<span class="ident" id="5645440">idents</span><span class="op" id="5645446">,</span>&nbsp;<span class="ident" id="5645448">Type</span><span class="op" id="5645452">:</span>&nbsp;<span class="ident" id="5645454">typ</span><span class="op" id="5645457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645462">params</span>&nbsp;<span class="op" id="5645469">=</span>&nbsp;<span class="builtinfunc" id="5645471">append</span><span class="op" id="5645477">(</span><span class="ident" id="5645478">params</span><span class="op" id="5645484">,</span>&nbsp;<span class="ident" id="5645486">field</span><span class="op" id="5645491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645496">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645558">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645615">p</span><span class="op" id="5645616">.</span><span class="ident" id="5645617">declare</span><span class="op" id="5645624">(</span><span class="ident" id="5645625">field</span><span class="op" id="5645630">,</span>&nbsp;<span class="ident" id="5645632">nil</span><span class="op" id="5645635">,</span>&nbsp;<span class="ident" id="5645637">scope</span><span class="op" id="5645642">,</span>&nbsp;<span class="ident" id="5645644">ast</span><span class="op" id="5645647">.</span><span class="ident" id="5645648">Var</span><span class="op" id="5645651">,</span>&nbsp;<span class="ident" id="5645653">idents</span><span class="op" id="5645659">...</span><span class="op" id="5645662">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645667">p</span><span class="op" id="5645668">.</span><span class="ident" id="5645669">resolve</span><span class="op" id="5645676">(</span><span class="ident" id="5645677">typ</span><span class="op" id="5645680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645685">if</span>&nbsp;<span class="op" id="5645688">!</span><span class="ident" id="5645689">p</span><span class="op" id="5645690">.</span><span class="ident" id="5645691">atComma</span><span class="op" id="5645698">(</span><span class="string" id="5645699">&#34;parameter&nbsp;list&#34;</span><span class="op" id="5645715">)</span>&nbsp;<span class="op" id="5645717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645723">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5645732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645737">p</span><span class="op" id="5645738">.</span><span class="ident" id="5645739">next</span><span class="op" id="5645743">(</span><span class="op" id="5645744">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5645748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645752">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5645760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645764">//&nbsp;Type&nbsp;{&nbsp;&#34;,&#34;&nbsp;Type&nbsp;}&nbsp;(anonymous&nbsp;parameters)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645809">params</span>&nbsp;<span class="op" id="5645816">=</span>&nbsp;<span class="builtinfunc" id="5645818">make</span><span class="op" id="5645822">(</span><span class="op" id="5645823">[</span><span class="op" id="5645824">]</span><span class="op" id="5645825">*</span><span class="ident" id="5645826">ast</span><span class="op" id="5645829">.</span><span class="ident" id="5645830">Field</span><span class="op" id="5645835">,</span>&nbsp;<span class="builtinfunc" id="5645837">len</span><span class="op" id="5645840">(</span><span class="ident" id="5645841">list</span><span class="op" id="5645845">)</span><span class="op" id="5645846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645849">for</span>&nbsp;<span class="ident" id="5645853">i</span><span class="op" id="5645854">,</span>&nbsp;<span class="ident" id="5645856">typ</span>&nbsp;<span class="op" id="5645860">:=</span>&nbsp;<span class="keyword" id="5645863">range</span>&nbsp;<span class="ident" id="5645869">list</span>&nbsp;<span class="op" id="5645874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645878">p</span><span class="op" id="5645879">.</span><span class="ident" id="5645880">resolve</span><span class="op" id="5645887">(</span><span class="ident" id="5645888">typ</span><span class="op" id="5645891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645895">params</span><span class="op" id="5645901">[</span><span class="ident" id="5645902">i</span><span class="op" id="5645903">]</span>&nbsp;<span class="op" id="5645905">=</span>&nbsp;<span class="op" id="5645907">&amp;</span><span class="ident" id="5645908">ast</span><span class="op" id="5645911">.</span><span class="ident" id="5645912">Field</span><span class="op" id="5645917">{</span><span class="ident" id="5645918">Type</span><span class="op" id="5645922">:</span>&nbsp;<span class="ident" id="5645924">typ</span><span class="op" id="5645927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5645930">}</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645933">return</span><br>
<span class="lineno"></span><span class="op" id="5645940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5645943">func</span>&nbsp;<span class="op" id="5645948">(</span><span class="ident" id="5645949">p</span>&nbsp;<span class="op" id="5645951">*</span><span class="ident" id="5645952">parser</span><span class="op" id="5645958">)</span>&nbsp;<span class="ident" id="5645960">parseParameters</span><span class="op" id="5645975">(</span><span class="ident" id="5645976">scope</span>&nbsp;<span class="op" id="5645982">*</span><span class="ident" id="5645983">ast</span><span class="op" id="5645986">.</span><span class="ident" id="5645987">Scope</span><span class="op" id="5645992">,</span>&nbsp;<span class="ident" id="5645994">ellipsisOk</span>&nbsp;<span class="builtintype" id="5646005">bool</span><span class="op" id="5646009">)</span>&nbsp;<span class="op" id="5646011">*</span><span class="ident" id="5646012">ast</span><span class="op" id="5646015">.</span><span class="ident" id="5646016">FieldList</span>&nbsp;<span class="op" id="5646026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646029">if</span>&nbsp;<span class="ident" id="5646032">p</span><span class="op" id="5646033">.</span><span class="ident" id="5646034">trace</span>&nbsp;<span class="op" id="5646040">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646044">defer</span>&nbsp;<span class="ident" id="5646050">un</span><span class="op" id="5646052">(</span><span class="ident" id="5646053">trace</span><span class="op" id="5646058">(</span><span class="ident" id="5646059">p</span><span class="op" id="5646060">,</span>&nbsp;<span class="string" id="5646062">&#34;Parameters&#34;</span><span class="op" id="5646074">)</span><span class="op" id="5646075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5646078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646082">var</span>&nbsp;<span class="ident" id="5646086">params</span>&nbsp;<span class="op" id="5646093">[</span><span class="op" id="5646094">]</span><span class="op" id="5646095">*</span><span class="ident" id="5646096">ast</span><span class="op" id="5646099">.</span><span class="ident" id="5646100">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646107">lparen</span>&nbsp;<span class="op" id="5646114">:=</span>&nbsp;<span class="ident" id="5646117">p</span><span class="op" id="5646118">.</span><span class="ident" id="5646119">expect</span><span class="op" id="5646125">(</span><span class="ident" id="5646126">token</span><span class="op" id="5646131">.</span><span class="ident" id="5646132">LPAREN</span><span class="op" id="5646138">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646141">if</span>&nbsp;<span class="ident" id="5646144">p</span><span class="op" id="5646145">.</span><span class="ident" id="5646146">tok</span>&nbsp;<span class="op" id="5646150">!=</span>&nbsp;<span class="ident" id="5646153">token</span><span class="op" id="5646158">.</span><span class="ident" id="5646159">RPAREN</span>&nbsp;<span class="op" id="5646166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646170">params</span>&nbsp;<span class="op" id="5646177">=</span>&nbsp;<span class="ident" id="5646179">p</span><span class="op" id="5646180">.</span><span class="ident" id="5646181">parseParameterList</span><span class="op" id="5646199">(</span><span class="ident" id="5646200">scope</span><span class="op" id="5646205">,</span>&nbsp;<span class="ident" id="5646207">ellipsisOk</span><span class="op" id="5646217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5646220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646223">rparen</span>&nbsp;<span class="op" id="5646230">:=</span>&nbsp;<span class="ident" id="5646233">p</span><span class="op" id="5646234">.</span><span class="ident" id="5646235">expect</span><span class="op" id="5646241">(</span><span class="ident" id="5646242">token</span><span class="op" id="5646247">.</span><span class="ident" id="5646248">RPAREN</span><span class="op" id="5646254">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646258">return</span>&nbsp;<span class="op" id="5646265">&amp;</span><span class="ident" id="5646266">ast</span><span class="op" id="5646269">.</span><span class="ident" id="5646270">FieldList</span><span class="op" id="5646279">{</span><span class="ident" id="5646280">Opening</span><span class="op" id="5646287">:</span>&nbsp;<span class="ident" id="5646289">lparen</span><span class="op" id="5646295">,</span>&nbsp;<span class="ident" id="5646297">List</span><span class="op" id="5646301">:</span>&nbsp;<span class="ident" id="5646303">params</span><span class="op" id="5646309">,</span>&nbsp;<span class="ident" id="5646311">Closing</span><span class="op" id="5646318">:</span>&nbsp;<span class="ident" id="5646320">rparen</span><span class="op" id="5646326">}</span><br>
<span class="lineno"></span><span class="op" id="5646328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5646331">func</span>&nbsp;<span class="op" id="5646336">(</span><span class="ident" id="5646337">p</span>&nbsp;<span class="op" id="5646339">*</span><span class="ident" id="5646340">parser</span><span class="op" id="5646346">)</span>&nbsp;<span class="ident" id="5646348">parseResult</span><span class="op" id="5646359">(</span><span class="ident" id="5646360">scope</span>&nbsp;<span class="op" id="5646366">*</span><span class="ident" id="5646367">ast</span><span class="op" id="5646370">.</span><span class="ident" id="5646371">Scope</span><span class="op" id="5646376">)</span>&nbsp;<span class="op" id="5646378">*</span><span class="ident" id="5646379">ast</span><span class="op" id="5646382">.</span><span class="ident" id="5646383">FieldList</span>&nbsp;<span class="op" id="5646393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646396">if</span>&nbsp;<span class="ident" id="5646399">p</span><span class="op" id="5646400">.</span><span class="ident" id="5646401">trace</span>&nbsp;<span class="op" id="5646407">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646411">defer</span>&nbsp;<span class="ident" id="5646417">un</span><span class="op" id="5646419">(</span><span class="ident" id="5646420">trace</span><span class="op" id="5646425">(</span><span class="ident" id="5646426">p</span><span class="op" id="5646427">,</span>&nbsp;<span class="string" id="5646429">&#34;Result&#34;</span><span class="op" id="5646437">)</span><span class="op" id="5646438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5646441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646445">if</span>&nbsp;<span class="ident" id="5646448">p</span><span class="op" id="5646449">.</span><span class="ident" id="5646450">tok</span>&nbsp;<span class="op" id="5646454">==</span>&nbsp;<span class="ident" id="5646457">token</span><span class="op" id="5646462">.</span><span class="ident" id="5646463">LPAREN</span>&nbsp;<span class="op" id="5646470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646474">return</span>&nbsp;<span class="ident" id="5646481">p</span><span class="op" id="5646482">.</span><span class="ident" id="5646483">parseParameters</span><span class="op" id="5646498">(</span><span class="ident" id="5646499">scope</span><span class="op" id="5646504">,</span>&nbsp;<span class="builtintype" id="5646506">false</span><span class="op" id="5646511">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5646514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646518">typ</span>&nbsp;<span class="op" id="5646522">:=</span>&nbsp;<span class="ident" id="5646525">p</span><span class="op" id="5646526">.</span><span class="ident" id="5646527">tryType</span><span class="op" id="5646534">(</span><span class="op" id="5646535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646538">if</span>&nbsp;<span class="ident" id="5646541">typ</span>&nbsp;<span class="op" id="5646545">!=</span>&nbsp;<span class="ident" id="5646548">nil</span>&nbsp;<span class="op" id="5646552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646556">list</span>&nbsp;<span class="op" id="5646561">:=</span>&nbsp;<span class="builtinfunc" id="5646564">make</span><span class="op" id="5646568">(</span><span class="op" id="5646569">[</span><span class="op" id="5646570">]</span><span class="op" id="5646571">*</span><span class="ident" id="5646572">ast</span><span class="op" id="5646575">.</span><span class="ident" id="5646576">Field</span><span class="op" id="5646581">,</span>&nbsp;<span class="num" id="5646583">1</span><span class="op" id="5646584">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646588">list</span><span class="op" id="5646592">[</span><span class="num" id="5646593">0</span><span class="op" id="5646594">]</span>&nbsp;<span class="op" id="5646596">=</span>&nbsp;<span class="op" id="5646598">&amp;</span><span class="ident" id="5646599">ast</span><span class="op" id="5646602">.</span><span class="ident" id="5646603">Field</span><span class="op" id="5646608">{</span><span class="ident" id="5646609">Type</span><span class="op" id="5646613">:</span>&nbsp;<span class="ident" id="5646615">typ</span><span class="op" id="5646618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646622">return</span>&nbsp;<span class="op" id="5646629">&amp;</span><span class="ident" id="5646630">ast</span><span class="op" id="5646633">.</span><span class="ident" id="5646634">FieldList</span><span class="op" id="5646643">{</span><span class="ident" id="5646644">List</span><span class="op" id="5646648">:</span>&nbsp;<span class="ident" id="5646650">list</span><span class="op" id="5646654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5646657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646661">return</span>&nbsp;<span class="ident" id="5646668">nil</span><br>
<span class="lineno">890</span><span class="op" id="5646672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5646675">func</span>&nbsp;<span class="op" id="5646680">(</span><span class="ident" id="5646681">p</span>&nbsp;<span class="op" id="5646683">*</span><span class="ident" id="5646684">parser</span><span class="op" id="5646690">)</span>&nbsp;<span class="ident" id="5646692">parseSignature</span><span class="op" id="5646706">(</span><span class="ident" id="5646707">scope</span>&nbsp;<span class="op" id="5646713">*</span><span class="ident" id="5646714">ast</span><span class="op" id="5646717">.</span><span class="ident" id="5646718">Scope</span><span class="op" id="5646723">)</span>&nbsp;<span class="op" id="5646725">(</span><span class="ident" id="5646726">params</span><span class="op" id="5646732">,</span>&nbsp;<span class="ident" id="5646734">results</span>&nbsp;<span class="op" id="5646742">*</span><span class="ident" id="5646743">ast</span><span class="op" id="5646746">.</span><span class="ident" id="5646747">FieldList</span><span class="op" id="5646756">)</span>&nbsp;<span class="op" id="5646758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646761">if</span>&nbsp;<span class="ident" id="5646764">p</span><span class="op" id="5646765">.</span><span class="ident" id="5646766">trace</span>&nbsp;<span class="op" id="5646772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646776">defer</span>&nbsp;<span class="ident" id="5646782">un</span><span class="op" id="5646784">(</span><span class="ident" id="5646785">trace</span><span class="op" id="5646790">(</span><span class="ident" id="5646791">p</span><span class="op" id="5646792">,</span>&nbsp;<span class="string" id="5646794">&#34;Signature&#34;</span><span class="op" id="5646805">)</span><span class="op" id="5646806">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5646809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646813">params</span>&nbsp;<span class="op" id="5646820">=</span>&nbsp;<span class="ident" id="5646822">p</span><span class="op" id="5646823">.</span><span class="ident" id="5646824">parseParameters</span><span class="op" id="5646839">(</span><span class="ident" id="5646840">scope</span><span class="op" id="5646845">,</span>&nbsp;<span class="builtintype" id="5646847">true</span><span class="op" id="5646851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646854">results</span>&nbsp;<span class="op" id="5646862">=</span>&nbsp;<span class="ident" id="5646864">p</span><span class="op" id="5646865">.</span><span class="ident" id="5646866">parseResult</span><span class="op" id="5646877">(</span><span class="ident" id="5646878">scope</span><span class="op" id="5646883">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646887">return</span><br>
<span class="lineno"></span><span class="op" id="5646894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5646897">func</span>&nbsp;<span class="op" id="5646902">(</span><span class="ident" id="5646903">p</span>&nbsp;<span class="op" id="5646905">*</span><span class="ident" id="5646906">parser</span><span class="op" id="5646912">)</span>&nbsp;<span class="ident" id="5646914">parseFuncType</span><span class="op" id="5646927">(</span><span class="op" id="5646928">)</span>&nbsp;<span class="op" id="5646930">(</span><span class="op" id="5646931">*</span><span class="ident" id="5646932">ast</span><span class="op" id="5646935">.</span><span class="ident" id="5646936">FuncType</span><span class="op" id="5646944">,</span>&nbsp;<span class="op" id="5646946">*</span><span class="ident" id="5646947">ast</span><span class="op" id="5646950">.</span><span class="ident" id="5646951">Scope</span><span class="op" id="5646956">)</span>&nbsp;<span class="op" id="5646958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646961">if</span>&nbsp;<span class="ident" id="5646964">p</span><span class="op" id="5646965">.</span><span class="ident" id="5646966">trace</span>&nbsp;<span class="op" id="5646972">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646976">defer</span>&nbsp;<span class="ident" id="5646982">un</span><span class="op" id="5646984">(</span><span class="ident" id="5646985">trace</span><span class="op" id="5646990">(</span><span class="ident" id="5646991">p</span><span class="op" id="5646992">,</span>&nbsp;<span class="string" id="5646994">&#34;FuncType&#34;</span><span class="op" id="5647004">)</span><span class="op" id="5647005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5647008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647012">pos</span>&nbsp;<span class="op" id="5647016">:=</span>&nbsp;<span class="ident" id="5647019">p</span><span class="op" id="5647020">.</span><span class="ident" id="5647021">expect</span><span class="op" id="5647027">(</span><span class="ident" id="5647028">token</span><span class="op" id="5647033">.</span><span class="ident" id="5647034">FUNC</span><span class="op" id="5647038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647041">scope</span>&nbsp;<span class="op" id="5647047">:=</span>&nbsp;<span class="ident" id="5647050">ast</span><span class="op" id="5647053">.</span><span class="ident" id="5647054">NewScope</span><span class="op" id="5647062">(</span><span class="ident" id="5647063">p</span><span class="op" id="5647064">.</span><span class="ident" id="5647065">topScope</span><span class="op" id="5647073">)</span>&nbsp;<span class="comment" id="5647075">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647094">params</span><span class="op" id="5647100">,</span>&nbsp;<span class="ident" id="5647102">results</span>&nbsp;<span class="op" id="5647110">:=</span>&nbsp;<span class="ident" id="5647113">p</span><span class="op" id="5647114">.</span><span class="ident" id="5647115">parseSignature</span><span class="op" id="5647129">(</span><span class="ident" id="5647130">scope</span><span class="op" id="5647135">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5647139">return</span>&nbsp;<span class="op" id="5647146">&amp;</span><span class="ident" id="5647147">ast</span><span class="op" id="5647150">.</span><span class="ident" id="5647151">FuncType</span><span class="op" id="5647159">{</span><span class="ident" id="5647160">Func</span><span class="op" id="5647164">:</span>&nbsp;<span class="ident" id="5647166">pos</span><span class="op" id="5647169">,</span>&nbsp;<span class="ident" id="5647171">Params</span><span class="op" id="5647177">:</span>&nbsp;<span class="ident" id="5647179">params</span><span class="op" id="5647185">,</span>&nbsp;<span class="ident" id="5647187">Results</span><span class="op" id="5647194">:</span>&nbsp;<span class="ident" id="5647196">results</span><span class="op" id="5647203">}</span><span class="op" id="5647204">,</span>&nbsp;<span class="ident" id="5647206">scope</span><br>
<span class="lineno"></span><span class="op" id="5647212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="5647215">func</span>&nbsp;<span class="op" id="5647220">(</span><span class="ident" id="5647221">p</span>&nbsp;<span class="op" id="5647223">*</span><span class="ident" id="5647224">parser</span><span class="op" id="5647230">)</span>&nbsp;<span class="ident" id="5647232">parseMethodSpec</span><span class="op" id="5647247">(</span><span class="ident" id="5647248">scope</span>&nbsp;<span class="op" id="5647254">*</span><span class="ident" id="5647255">ast</span><span class="op" id="5647258">.</span><span class="ident" id="5647259">Scope</span><span class="op" id="5647264">)</span>&nbsp;<span class="op" id="5647266">*</span><span class="ident" id="5647267">ast</span><span class="op" id="5647270">.</span><span class="ident" id="5647271">Field</span>&nbsp;<span class="op" id="5647277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5647280">if</span>&nbsp;<span class="ident" id="5647283">p</span><span class="op" id="5647284">.</span><span class="ident" id="5647285">trace</span>&nbsp;<span class="op" id="5647291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5647295">defer</span>&nbsp;<span class="ident" id="5647301">un</span><span class="op" id="5647303">(</span><span class="ident" id="5647304">trace</span><span class="op" id="5647309">(</span><span class="ident" id="5647310">p</span><span class="op" id="5647311">,</span>&nbsp;<span class="string" id="5647313">&#34;MethodSpec&#34;</span><span class="op" id="5647325">)</span><span class="op" id="5647326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5647329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647333">doc</span>&nbsp;<span class="op" id="5647337">:=</span>&nbsp;<span class="ident" id="5647340">p</span><span class="op" id="5647341">.</span><span class="ident" id="5647342">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5647355">var</span>&nbsp;<span class="ident" id="5647359">idents</span>&nbsp;<span class="op" id="5647366">[</span><span class="op" id="5647367">]</span><span class="op" id="5647368">*</span><span class="ident" id="5647369">ast</span><span class="op" id="5647372">.</span><span class="ident" id="5647373">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5647380">var</span>&nbsp;<span class="ident" id="5647384">typ</span>&nbsp;<span class="ident" id="5647388">ast</span><span class="op" id="5647391">.</span><span class="ident" id="5647392">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647398">x</span>&nbsp;<span class="op" id="5647400">:=</span>&nbsp;<span class="ident" id="5647403">p</span><span class="op" id="5647404">.</span><span class="ident" id="5647405">parseTypeName</span><span class="op" id="5647418">(</span><span class="op" id="5647419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5647422">if</span>&nbsp;<span class="ident" id="5647425">ident</span><span class="op" id="5647430">,</span>&nbsp;<span class="ident" id="5647432">isIdent</span>&nbsp;<span class="op" id="5647440">:=</span>&nbsp;<span class="ident" id="5647443">x</span><span class="op" id="5647444">.</span><span class="op" id="5647445">(</span><span class="op" id="5647446">*</span><span class="ident" id="5647447">ast</span><span class="op" id="5647450">.</span><span class="ident" id="5647451">Ident</span><span class="op" id="5647456">)</span><span class="op" id="5647457">;</span>&nbsp;<span class="ident" id="5647459">isIdent</span>&nbsp;<span class="op" id="5647467">&amp;&amp;</span>&nbsp;<span class="ident" id="5647470">p</span><span class="op" id="5647471">.</span><span class="ident" id="5647472">tok</span>&nbsp;<span class="op" id="5647476">==</span>&nbsp;<span class="ident" id="5647479">token</span><span class="op" id="5647484">.</span><span class="ident" id="5647485">LPAREN</span>&nbsp;<span class="op" id="5647492">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5647496">//&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647508">idents</span>&nbsp;<span class="op" id="5647515">=</span>&nbsp;<span class="op" id="5647517">[</span><span class="op" id="5647518">]</span><span class="op" id="5647519">*</span><span class="ident" id="5647520">ast</span><span class="op" id="5647523">.</span><span class="ident" id="5647524">Ident</span><span class="op" id="5647529">{</span><span class="ident" id="5647530">ident</span><span class="op" id="5647535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647539">scope</span>&nbsp;<span class="op" id="5647545">:=</span>&nbsp;<span class="ident" id="5647548">ast</span><span class="op" id="5647551">.</span><span class="ident" id="5647552">NewScope</span><span class="op" id="5647560">(</span><span class="ident" id="5647561">nil</span><span class="op" id="5647564">)</span>&nbsp;<span class="comment" id="5647566">//&nbsp;method&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647584">params</span><span class="op" id="5647590">,</span>&nbsp;<span class="ident" id="5647592">results</span>&nbsp;<span class="op" id="5647600">:=</span>&nbsp;<span class="ident" id="5647603">p</span><span class="op" id="5647604">.</span><span class="ident" id="5647605">parseSignature</span><span class="op" id="5647619">(</span><span class="ident" id="5647620">scope</span><span class="op" id="5647625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647629">typ</span>&nbsp;<span class="op" id="5647633">=</span>&nbsp;<span class="op" id="5647635">&amp;</span><span class="ident" id="5647636">ast</span><span class="op" id="5647639">.</span><span class="ident" id="5647640">FuncType</span><span class="op" id="5647648">{</span><span class="ident" id="5647649">Func</span><span class="op" id="5647653">:</span>&nbsp;<span class="ident" id="5647655">token</span><span class="op" id="5647660">.</span><span class="ident" id="5647661">NoPos</span><span class="op" id="5647666">,</span>&nbsp;<span class="ident" id="5647668">Params</span><span class="op" id="5647674">:</span>&nbsp;<span class="ident" id="5647676">params</span><span class="op" id="5647682">,</span>&nbsp;<span class="ident" id="5647684">Results</span><span class="op" id="5647691">:</span>&nbsp;<span class="ident" id="5647693">results</span><span class="op" id="5647700">}</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5647703">}</span>&nbsp;<span class="keyword" id="5647705">else</span>&nbsp;<span class="op" id="5647710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5647714">//&nbsp;embedded&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647738">typ</span>&nbsp;<span class="op" id="5647742">=</span>&nbsp;<span class="ident" id="5647744">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647748">p</span><span class="op" id="5647749">.</span><span class="ident" id="5647750">resolve</span><span class="op" id="5647757">(</span><span class="ident" id="5647758">typ</span><span class="op" id="5647761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5647764">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647767">p</span><span class="op" id="5647768">.</span><span class="ident" id="5647769">expectSemi</span><span class="op" id="5647779">(</span><span class="op" id="5647780">)</span>&nbsp;<span class="comment" id="5647782">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647823">spec</span>&nbsp;<span class="op" id="5647828">:=</span>&nbsp;<span class="op" id="5647831">&amp;</span><span class="ident" id="5647832">ast</span><span class="op" id="5647835">.</span><span class="ident" id="5647836">Field</span><span class="op" id="5647841">{</span><span class="ident" id="5647842">Doc</span><span class="op" id="5647845">:</span>&nbsp;<span class="ident" id="5647847">doc</span><span class="op" id="5647850">,</span>&nbsp;<span class="ident" id="5647852">Names</span><span class="op" id="5647857">:</span>&nbsp;<span class="ident" id="5647859">idents</span><span class="op" id="5647865">,</span>&nbsp;<span class="ident" id="5647867">Type</span><span class="op" id="5647871">:</span>&nbsp;<span class="ident" id="5647873">typ</span><span class="op" id="5647876">,</span>&nbsp;<span class="ident" id="5647878">Comment</span><span class="op" id="5647885">:</span>&nbsp;<span class="ident" id="5647887">p</span><span class="op" id="5647888">.</span><span class="ident" id="5647889">lineComment</span><span class="op" id="5647900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647903">p</span><span class="op" id="5647904">.</span><span class="ident" id="5647905">declare</span><span class="op" id="5647912">(</span><span class="ident" id="5647913">spec</span><span class="op" id="5647917">,</span>&nbsp;<span class="ident" id="5647919">nil</span><span class="op" id="5647922">,</span>&nbsp;<span class="ident" id="5647924">scope</span><span class="op" id="5647929">,</span>&nbsp;<span class="ident" id="5647931">ast</span><span class="op" id="5647934">.</span><span class="ident" id="5647935">Fun</span><span class="op" id="5647938">,</span>&nbsp;<span class="ident" id="5647940">idents</span><span class="op" id="5647946">...</span><span class="op" id="5647949">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5647953">return</span>&nbsp;<span class="ident" id="5647960">spec</span><br>
<span class="lineno"></span><span class="op" id="5647965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5647968">func</span>&nbsp;<span class="op" id="5647973">(</span><span class="ident" id="5647974">p</span>&nbsp;<span class="op" id="5647976">*</span><span class="ident" id="5647977">parser</span><span class="op" id="5647983">)</span>&nbsp;<span class="ident" id="5647985">parseInterfaceType</span><span class="op" id="5648003">(</span><span class="op" id="5648004">)</span>&nbsp;<span class="op" id="5648006">*</span><span class="ident" id="5648007">ast</span><span class="op" id="5648010">.</span><span class="ident" id="5648011">InterfaceType</span>&nbsp;<span class="op" id="5648025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5648028">if</span>&nbsp;<span class="ident" id="5648031">p</span><span class="op" id="5648032">.</span><span class="ident" id="5648033">trace</span>&nbsp;<span class="op" id="5648039">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5648043">defer</span>&nbsp;<span class="ident" id="5648049">un</span><span class="op" id="5648051">(</span><span class="ident" id="5648052">trace</span><span class="op" id="5648057">(</span><span class="ident" id="5648058">p</span><span class="op" id="5648059">,</span>&nbsp;<span class="string" id="5648061">&#34;InterfaceType&#34;</span><span class="op" id="5648076">)</span><span class="op" id="5648077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5648080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648084">pos</span>&nbsp;<span class="op" id="5648088">:=</span>&nbsp;<span class="ident" id="5648091">p</span><span class="op" id="5648092">.</span><span class="ident" id="5648093">expect</span><span class="op" id="5648099">(</span><span class="ident" id="5648100">token</span><span class="op" id="5648105">.</span><span class="ident" id="5648106">INTERFACE</span><span class="op" id="5648115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648118">lbrace</span>&nbsp;<span class="op" id="5648125">:=</span>&nbsp;<span class="ident" id="5648128">p</span><span class="op" id="5648129">.</span><span class="ident" id="5648130">expect</span><span class="op" id="5648136">(</span><span class="ident" id="5648137">token</span><span class="op" id="5648142">.</span><span class="ident" id="5648143">LBRACE</span><span class="op" id="5648149">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648152">scope</span>&nbsp;<span class="op" id="5648158">:=</span>&nbsp;<span class="ident" id="5648161">ast</span><span class="op" id="5648164">.</span><span class="ident" id="5648165">NewScope</span><span class="op" id="5648173">(</span><span class="ident" id="5648174">nil</span><span class="op" id="5648177">)</span>&nbsp;<span class="comment" id="5648179">//&nbsp;interface&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5648199">var</span>&nbsp;<span class="ident" id="5648203">list</span>&nbsp;<span class="op" id="5648208">[</span><span class="op" id="5648209">]</span><span class="op" id="5648210">*</span><span class="ident" id="5648211">ast</span><span class="op" id="5648214">.</span><span class="ident" id="5648215">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5648222">for</span>&nbsp;<span class="ident" id="5648226">p</span><span class="op" id="5648227">.</span><span class="ident" id="5648228">tok</span>&nbsp;<span class="op" id="5648232">==</span>&nbsp;<span class="ident" id="5648235">token</span><span class="op" id="5648240">.</span><span class="ident" id="5648241">IDENT</span>&nbsp;<span class="op" id="5648247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648251">list</span>&nbsp;<span class="op" id="5648256">=</span>&nbsp;<span class="builtinfunc" id="5648258">append</span><span class="op" id="5648264">(</span><span class="ident" id="5648265">list</span><span class="op" id="5648269">,</span>&nbsp;<span class="ident" id="5648271">p</span><span class="op" id="5648272">.</span><span class="ident" id="5648273">parseMethodSpec</span><span class="op" id="5648288">(</span><span class="ident" id="5648289">scope</span><span class="op" id="5648294">)</span><span class="op" id="5648295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5648298">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648301">rbrace</span>&nbsp;<span class="op" id="5648308">:=</span>&nbsp;<span class="ident" id="5648311">p</span><span class="op" id="5648312">.</span><span class="ident" id="5648313">expect</span><span class="op" id="5648319">(</span><span class="ident" id="5648320">token</span><span class="op" id="5648325">.</span><span class="ident" id="5648326">RBRACE</span><span class="op" id="5648332">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5648336">return</span>&nbsp;<span class="op" id="5648343">&amp;</span><span class="ident" id="5648344">ast</span><span class="op" id="5648347">.</span><span class="ident" id="5648348">InterfaceType</span><span class="op" id="5648361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648365">Interface</span><span class="op" id="5648374">:</span>&nbsp;<span class="ident" id="5648376">pos</span><span class="op" id="5648379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648383">Methods</span><span class="op" id="5648390">:</span>&nbsp;<span class="op" id="5648392">&amp;</span><span class="ident" id="5648393">ast</span><span class="op" id="5648396">.</span><span class="ident" id="5648397">FieldList</span><span class="op" id="5648406">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648411">Opening</span><span class="op" id="5648418">:</span>&nbsp;<span class="ident" id="5648420">lbrace</span><span class="op" id="5648426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648431">List</span><span class="op" id="5648435">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648440">list</span><span class="op" id="5648444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648449">Closing</span><span class="op" id="5648456">:</span>&nbsp;<span class="ident" id="5648458">rbrace</span><span class="op" id="5648464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5648468">}</span><span class="op" id="5648469">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5648472">}</span><br>
<span class="lineno">965</span><span class="op" id="5648474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5648477">func</span>&nbsp;<span class="op" id="5648482">(</span><span class="ident" id="5648483">p</span>&nbsp;<span class="op" id="5648485">*</span><span class="ident" id="5648486">parser</span><span class="op" id="5648492">)</span>&nbsp;<span class="ident" id="5648494">parseMapType</span><span class="op" id="5648506">(</span><span class="op" id="5648507">)</span>&nbsp;<span class="op" id="5648509">*</span><span class="ident" id="5648510">ast</span><span class="op" id="5648513">.</span><span class="ident" id="5648514">MapType</span>&nbsp;<span class="op" id="5648522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5648525">if</span>&nbsp;<span class="ident" id="5648528">p</span><span class="op" id="5648529">.</span><span class="ident" id="5648530">trace</span>&nbsp;<span class="op" id="5648536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5648540">defer</span>&nbsp;<span class="ident" id="5648546">un</span><span class="op" id="5648548">(</span><span class="ident" id="5648549">trace</span><span class="op" id="5648554">(</span><span class="ident" id="5648555">p</span><span class="op" id="5648556">,</span>&nbsp;<span class="string" id="5648558">&#34;MapType&#34;</span><span class="op" id="5648567">)</span><span class="op" id="5648568">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5648571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648575">pos</span>&nbsp;<span class="op" id="5648579">:=</span>&nbsp;<span class="ident" id="5648582">p</span><span class="op" id="5648583">.</span><span class="ident" id="5648584">expect</span><span class="op" id="5648590">(</span><span class="ident" id="5648591">token</span><span class="op" id="5648596">.</span><span class="ident" id="5648597">MAP</span><span class="op" id="5648600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648603">p</span><span class="op" id="5648604">.</span><span class="ident" id="5648605">expect</span><span class="op" id="5648611">(</span><span class="ident" id="5648612">token</span><span class="op" id="5648617">.</span><span class="ident" id="5648618">LBRACK</span><span class="op" id="5648624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648627">key</span>&nbsp;<span class="op" id="5648631">:=</span>&nbsp;<span class="ident" id="5648634">p</span><span class="op" id="5648635">.</span><span class="ident" id="5648636">parseType</span><span class="op" id="5648645">(</span><span class="op" id="5648646">)</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648649">p</span><span class="op" id="5648650">.</span><span class="ident" id="5648651">expect</span><span class="op" id="5648657">(</span><span class="ident" id="5648658">token</span><span class="op" id="5648663">.</span><span class="ident" id="5648664">RBRACK</span><span class="op" id="5648670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648673">value</span>&nbsp;<span class="op" id="5648679">:=</span>&nbsp;<span class="ident" id="5648682">p</span><span class="op" id="5648683">.</span><span class="ident" id="5648684">parseType</span><span class="op" id="5648693">(</span><span class="op" id="5648694">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5648698">return</span>&nbsp;<span class="op" id="5648705">&amp;</span><span class="ident" id="5648706">ast</span><span class="op" id="5648709">.</span><span class="ident" id="5648710">MapType</span><span class="op" id="5648717">{</span><span class="ident" id="5648718">Map</span><span class="op" id="5648721">:</span>&nbsp;<span class="ident" id="5648723">pos</span><span class="op" id="5648726">,</span>&nbsp;<span class="ident" id="5648728">Key</span><span class="op" id="5648731">:</span>&nbsp;<span class="ident" id="5648733">key</span><span class="op" id="5648736">,</span>&nbsp;<span class="ident" id="5648738">Value</span><span class="op" id="5648743">:</span>&nbsp;<span class="ident" id="5648745">value</span><span class="op" id="5648750">}</span><br>
<span class="lineno"></span><span class="op" id="5648752">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span><span class="keyword" id="5648755">func</span>&nbsp;<span class="op" id="5648760">(</span><span class="ident" id="5648761">p</span>&nbsp;<span class="op" id="5648763">*</span><span class="ident" id="5648764">parser</span><span class="op" id="5648770">)</span>&nbsp;<span class="ident" id="5648772">parseChanType</span><span class="op" id="5648785">(</span><span class="op" id="5648786">)</span>&nbsp;<span class="op" id="5648788">*</span><span class="ident" id="5648789">ast</span><span class="op" id="5648792">.</span><span class="ident" id="5648793">ChanType</span>&nbsp;<span class="op" id="5648802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5648805">if</span>&nbsp;<span class="ident" id="5648808">p</span><span class="op" id="5648809">.</span><span class="ident" id="5648810">trace</span>&nbsp;<span class="op" id="5648816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5648820">defer</span>&nbsp;<span class="ident" id="5648826">un</span><span class="op" id="5648828">(</span><span class="ident" id="5648829">trace</span><span class="op" id="5648834">(</span><span class="ident" id="5648835">p</span><span class="op" id="5648836">,</span>&nbsp;<span class="string" id="5648838">&#34;ChanType&#34;</span><span class="op" id="5648848">)</span><span class="op" id="5648849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5648852">}</span><br>
<span class="lineno">985</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648856">pos</span>&nbsp;<span class="op" id="5648860">:=</span>&nbsp;<span class="ident" id="5648863">p</span><span class="op" id="5648864">.</span><span class="ident" id="5648865">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648870">dir</span>&nbsp;<span class="op" id="5648874">:=</span>&nbsp;<span class="ident" id="5648877">ast</span><span class="op" id="5648880">.</span><span class="ident" id="5648881">SEND</span>&nbsp;<span class="op" id="5648886">|</span>&nbsp;<span class="ident" id="5648888">ast</span><span class="op" id="5648891">.</span><span class="ident" id="5648892">RECV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5648898">var</span>&nbsp;<span class="ident" id="5648902">arrow</span>&nbsp;<span class="ident" id="5648908">token</span><span class="op" id="5648913">.</span><span class="ident" id="5648914">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5648919">if</span>&nbsp;<span class="ident" id="5648922">p</span><span class="op" id="5648923">.</span><span class="ident" id="5648924">tok</span>&nbsp;<span class="op" id="5648928">==</span>&nbsp;<span class="ident" id="5648931">token</span><span class="op" id="5648936">.</span><span class="ident" id="5648937">CHAN</span>&nbsp;<span class="op" id="5648942">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648946">p</span><span class="op" id="5648947">.</span><span class="ident" id="5648948">next</span><span class="op" id="5648952">(</span><span class="op" id="5648953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5648957">if</span>&nbsp;<span class="ident" id="5648960">p</span><span class="op" id="5648961">.</span><span class="ident" id="5648962">tok</span>&nbsp;<span class="op" id="5648966">==</span>&nbsp;<span class="ident" id="5648969">token</span><span class="op" id="5648974">.</span><span class="ident" id="5648975">ARROW</span>&nbsp;<span class="op" id="5648981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5648986">arrow</span>&nbsp;<span class="op" id="5648992">=</span>&nbsp;<span class="ident" id="5648994">p</span><span class="op" id="5648995">.</span><span class="ident" id="5648996">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5649003">p</span><span class="op" id="5649004">.</span><span class="ident" id="5649005">next</span><span class="op" id="5649009">(</span><span class="op" id="5649010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5649015">dir</span>&nbsp;<span class="op" id="5649019">=</span>&nbsp;<span class="ident" id="5649021">ast</span><span class="op" id="5649024">.</span><span class="ident" id="5649025">SEND</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5649032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5649035">}</span>&nbsp;<span class="keyword" id="5649037">else</span>&nbsp;<span class="op" id="5649042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5649046">arrow</span>&nbsp;<span class="op" id="5649052">=</span>&nbsp;<span class="ident" id="5649054">p</span><span class="op" id="5649055">.</span><span class="ident" id="5649056">expect</span><span class="op" id="5649062">(</span><span class="ident" id="5649063">token</span><span class="op" id="5649068">.</span><span class="ident" id="5649069">ARROW</span><span class="op" id="5649074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5649078">p</span><span class="op" id="5649079">.</span><span class="ident" id="5649080">expect</span><span class="op" id="5649086">(</span><span class="ident" id="5649087">token</span><span class="op" id="5649092">.</span><span class="ident" id="5649093">CHAN</span><span class="op" id="5649097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5649101">dir</span>&nbsp;<span class="op" id="5649105">=</span>&nbsp;<span class="ident" id="5649107">ast</span><span class="op" id="5649110">.</span><span class="ident" id="5649111">RECV</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5649117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5649120">value</span>&nbsp;<span class="op" id="5649126">:=</span>&nbsp;<span class="ident" id="5649129">p</span><span class="op" id="5649130">.</span><span class="ident" id="5649131">parseType</span><span class="op" id="5649140">(</span><span class="op" id="5649141">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649145">return</span>&nbsp;<span class="op" id="5649152">&amp;</span><span class="ident" id="5649153">ast</span><span class="op" id="5649156">.</span><span class="ident" id="5649157">ChanType</span><span class="op" id="5649165">{</span><span class="ident" id="5649166">Begin</span><span class="op" id="5649171">:</span>&nbsp;<span class="ident" id="5649173">pos</span><span class="op" id="5649176">,</span>&nbsp;<span class="ident" id="5649178">Arrow</span><span class="op" id="5649183">:</span>&nbsp;<span class="ident" id="5649185">arrow</span><span class="op" id="5649190">,</span>&nbsp;<span class="ident" id="5649192">Dir</span><span class="op" id="5649195">:</span>&nbsp;<span class="ident" id="5649197">dir</span><span class="op" id="5649200">,</span>&nbsp;<span class="ident" id="5649202">Value</span><span class="op" id="5649207">:</span>&nbsp;<span class="ident" id="5649209">value</span><span class="op" id="5649214">}</span><br>
<span class="lineno"></span><span class="op" id="5649216">}</span><br>
<span class="lineno">1005</span><br>
<span class="lineno"></span><span class="comment" id="5649219">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5649274">func</span>&nbsp;<span class="op" id="5649279">(</span><span class="ident" id="5649280">p</span>&nbsp;<span class="op" id="5649282">*</span><span class="ident" id="5649283">parser</span><span class="op" id="5649289">)</span>&nbsp;<span class="ident" id="5649291">tryIdentOrType</span><span class="op" id="5649305">(</span><span class="op" id="5649306">)</span>&nbsp;<span class="ident" id="5649308">ast</span><span class="op" id="5649311">.</span><span class="ident" id="5649312">Expr</span>&nbsp;<span class="op" id="5649317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649320">switch</span>&nbsp;<span class="ident" id="5649327">p</span><span class="op" id="5649328">.</span><span class="ident" id="5649329">tok</span>&nbsp;<span class="op" id="5649333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649336">case</span>&nbsp;<span class="ident" id="5649341">token</span><span class="op" id="5649346">.</span><span class="ident" id="5649347">IDENT</span><span class="op" id="5649352">:</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649356">return</span>&nbsp;<span class="ident" id="5649363">p</span><span class="op" id="5649364">.</span><span class="ident" id="5649365">parseTypeName</span><span class="op" id="5649378">(</span><span class="op" id="5649379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649382">case</span>&nbsp;<span class="ident" id="5649387">token</span><span class="op" id="5649392">.</span><span class="ident" id="5649393">LBRACK</span><span class="op" id="5649399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649403">return</span>&nbsp;<span class="ident" id="5649410">p</span><span class="op" id="5649411">.</span><span class="ident" id="5649412">parseArrayType</span><span class="op" id="5649426">(</span><span class="op" id="5649427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649430">case</span>&nbsp;<span class="ident" id="5649435">token</span><span class="op" id="5649440">.</span><span class="ident" id="5649441">STRUCT</span><span class="op" id="5649447">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649451">return</span>&nbsp;<span class="ident" id="5649458">p</span><span class="op" id="5649459">.</span><span class="ident" id="5649460">parseStructType</span><span class="op" id="5649475">(</span><span class="op" id="5649476">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649479">case</span>&nbsp;<span class="ident" id="5649484">token</span><span class="op" id="5649489">.</span><span class="ident" id="5649490">MUL</span><span class="op" id="5649493">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649497">return</span>&nbsp;<span class="ident" id="5649504">p</span><span class="op" id="5649505">.</span><span class="ident" id="5649506">parsePointerType</span><span class="op" id="5649522">(</span><span class="op" id="5649523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649526">case</span>&nbsp;<span class="ident" id="5649531">token</span><span class="op" id="5649536">.</span><span class="ident" id="5649537">FUNC</span><span class="op" id="5649541">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5649545">typ</span><span class="op" id="5649548">,</span>&nbsp;<span class="ident" id="5649550">_</span>&nbsp;<span class="op" id="5649552">:=</span>&nbsp;<span class="ident" id="5649555">p</span><span class="op" id="5649556">.</span><span class="ident" id="5649557">parseFuncType</span><span class="op" id="5649570">(</span><span class="op" id="5649571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649575">return</span>&nbsp;<span class="ident" id="5649582">typ</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649587">case</span>&nbsp;<span class="ident" id="5649592">token</span><span class="op" id="5649597">.</span><span class="ident" id="5649598">INTERFACE</span><span class="op" id="5649607">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649611">return</span>&nbsp;<span class="ident" id="5649618">p</span><span class="op" id="5649619">.</span><span class="ident" id="5649620">parseInterfaceType</span><span class="op" id="5649638">(</span><span class="op" id="5649639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649642">case</span>&nbsp;<span class="ident" id="5649647">token</span><span class="op" id="5649652">.</span><span class="ident" id="5649653">MAP</span><span class="op" id="5649656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649660">return</span>&nbsp;<span class="ident" id="5649667">p</span><span class="op" id="5649668">.</span><span class="ident" id="5649669">parseMapType</span><span class="op" id="5649681">(</span><span class="op" id="5649682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649685">case</span>&nbsp;<span class="ident" id="5649690">token</span><span class="op" id="5649695">.</span><span class="ident" id="5649696">CHAN</span><span class="op" id="5649700">,</span>&nbsp;<span class="ident" id="5649702">token</span><span class="op" id="5649707">.</span><span class="ident" id="5649708">ARROW</span><span class="op" id="5649713">:</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649717">return</span>&nbsp;<span class="ident" id="5649724">p</span><span class="op" id="5649725">.</span><span class="ident" id="5649726">parseChanType</span><span class="op" id="5649739">(</span><span class="op" id="5649740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649743">case</span>&nbsp;<span class="ident" id="5649748">token</span><span class="op" id="5649753">.</span><span class="ident" id="5649754">LPAREN</span><span class="op" id="5649760">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5649764">lparen</span>&nbsp;<span class="op" id="5649771">:=</span>&nbsp;<span class="ident" id="5649774">p</span><span class="op" id="5649775">.</span><span class="ident" id="5649776">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5649782">p</span><span class="op" id="5649783">.</span><span class="ident" id="5649784">next</span><span class="op" id="5649788">(</span><span class="op" id="5649789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5649793">typ</span>&nbsp;<span class="op" id="5649797">:=</span>&nbsp;<span class="ident" id="5649800">p</span><span class="op" id="5649801">.</span><span class="ident" id="5649802">parseType</span><span class="op" id="5649811">(</span><span class="op" id="5649812">)</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5649816">rparen</span>&nbsp;<span class="op" id="5649823">:=</span>&nbsp;<span class="ident" id="5649826">p</span><span class="op" id="5649827">.</span><span class="ident" id="5649828">expect</span><span class="op" id="5649834">(</span><span class="ident" id="5649835">token</span><span class="op" id="5649840">.</span><span class="ident" id="5649841">RPAREN</span><span class="op" id="5649847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649851">return</span>&nbsp;<span class="op" id="5649858">&amp;</span><span class="ident" id="5649859">ast</span><span class="op" id="5649862">.</span><span class="ident" id="5649863">ParenExpr</span><span class="op" id="5649872">{</span><span class="ident" id="5649873">Lparen</span><span class="op" id="5649879">:</span>&nbsp;<span class="ident" id="5649881">lparen</span><span class="op" id="5649887">,</span>&nbsp;<span class="ident" id="5649889">X</span><span class="op" id="5649890">:</span>&nbsp;<span class="ident" id="5649892">typ</span><span class="op" id="5649895">,</span>&nbsp;<span class="ident" id="5649897">Rparen</span><span class="op" id="5649903">:</span>&nbsp;<span class="ident" id="5649905">rparen</span><span class="op" id="5649911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5649914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5649918">//&nbsp;no&nbsp;type&nbsp;found</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5649936">return</span>&nbsp;<span class="ident" id="5649943">nil</span><br>
<span class="lineno"></span><span class="op" id="5649947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5649950">func</span>&nbsp;<span class="op" id="5649955">(</span><span class="ident" id="5649956">p</span>&nbsp;<span class="op" id="5649958">*</span><span class="ident" id="5649959">parser</span><span class="op" id="5649965">)</span>&nbsp;<span class="ident" id="5649967">tryType</span><span class="op" id="5649974">(</span><span class="op" id="5649975">)</span>&nbsp;<span class="ident" id="5649977">ast</span><span class="op" id="5649980">.</span><span class="ident" id="5649981">Expr</span>&nbsp;<span class="op" id="5649986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5649989">typ</span>&nbsp;<span class="op" id="5649993">:=</span>&nbsp;<span class="ident" id="5649996">p</span><span class="op" id="5649997">.</span><span class="ident" id="5649998">tryIdentOrType</span><span class="op" id="5650012">(</span><span class="op" id="5650013">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650016">if</span>&nbsp;<span class="ident" id="5650019">typ</span>&nbsp;<span class="op" id="5650023">!=</span>&nbsp;<span class="ident" id="5650026">nil</span>&nbsp;<span class="op" id="5650030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650034">p</span><span class="op" id="5650035">.</span><span class="ident" id="5650036">resolve</span><span class="op" id="5650043">(</span><span class="ident" id="5650044">typ</span><span class="op" id="5650047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5650050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650053">return</span>&nbsp;<span class="ident" id="5650060">typ</span><br>
<span class="lineno"></span><span class="op" id="5650064">}</span><br>
<span class="lineno">1045</span><br>
<span class="lineno"></span><span class="comment" id="5650067">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5650147">//&nbsp;Blocks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5650158">func</span>&nbsp;<span class="op" id="5650163">(</span><span class="ident" id="5650164">p</span>&nbsp;<span class="op" id="5650166">*</span><span class="ident" id="5650167">parser</span><span class="op" id="5650173">)</span>&nbsp;<span class="ident" id="5650175">parseStmtList</span><span class="op" id="5650188">(</span><span class="op" id="5650189">)</span>&nbsp;<span class="op" id="5650191">(</span><span class="ident" id="5650192">list</span>&nbsp;<span class="op" id="5650197">[</span><span class="op" id="5650198">]</span><span class="ident" id="5650199">ast</span><span class="op" id="5650202">.</span><span class="ident" id="5650203">Stmt</span><span class="op" id="5650207">)</span>&nbsp;<span class="op" id="5650209">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650212">if</span>&nbsp;<span class="ident" id="5650215">p</span><span class="op" id="5650216">.</span><span class="ident" id="5650217">trace</span>&nbsp;<span class="op" id="5650223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650227">defer</span>&nbsp;<span class="ident" id="5650233">un</span><span class="op" id="5650235">(</span><span class="ident" id="5650236">trace</span><span class="op" id="5650241">(</span><span class="ident" id="5650242">p</span><span class="op" id="5650243">,</span>&nbsp;<span class="string" id="5650245">&#34;StatementList&#34;</span><span class="op" id="5650260">)</span><span class="op" id="5650261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5650264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650268">for</span>&nbsp;<span class="ident" id="5650272">p</span><span class="op" id="5650273">.</span><span class="ident" id="5650274">tok</span>&nbsp;<span class="op" id="5650278">!=</span>&nbsp;<span class="ident" id="5650281">token</span><span class="op" id="5650286">.</span><span class="ident" id="5650287">CASE</span>&nbsp;<span class="op" id="5650292">&amp;&amp;</span>&nbsp;<span class="ident" id="5650295">p</span><span class="op" id="5650296">.</span><span class="ident" id="5650297">tok</span>&nbsp;<span class="op" id="5650301">!=</span>&nbsp;<span class="ident" id="5650304">token</span><span class="op" id="5650309">.</span><span class="ident" id="5650310">DEFAULT</span>&nbsp;<span class="op" id="5650318">&amp;&amp;</span>&nbsp;<span class="ident" id="5650321">p</span><span class="op" id="5650322">.</span><span class="ident" id="5650323">tok</span>&nbsp;<span class="op" id="5650327">!=</span>&nbsp;<span class="ident" id="5650330">token</span><span class="op" id="5650335">.</span><span class="ident" id="5650336">RBRACE</span>&nbsp;<span class="op" id="5650343">&amp;&amp;</span>&nbsp;<span class="ident" id="5650346">p</span><span class="op" id="5650347">.</span><span class="ident" id="5650348">tok</span>&nbsp;<span class="op" id="5650352">!=</span>&nbsp;<span class="ident" id="5650355">token</span><span class="op" id="5650360">.</span><span class="ident" id="5650361">EOF</span>&nbsp;<span class="op" id="5650365">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650369">list</span>&nbsp;<span class="op" id="5650374">=</span>&nbsp;<span class="builtinfunc" id="5650376">append</span><span class="op" id="5650382">(</span><span class="ident" id="5650383">list</span><span class="op" id="5650387">,</span>&nbsp;<span class="ident" id="5650389">p</span><span class="op" id="5650390">.</span><span class="ident" id="5650391">parseStmt</span><span class="op" id="5650400">(</span><span class="op" id="5650401">)</span><span class="op" id="5650402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5650405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650409">return</span><br>
<span class="lineno"></span><span class="op" id="5650416">}</span><br>
<span class="lineno">1060</span><br>
<span class="lineno"></span><span class="keyword" id="5650419">func</span>&nbsp;<span class="op" id="5650424">(</span><span class="ident" id="5650425">p</span>&nbsp;<span class="op" id="5650427">*</span><span class="ident" id="5650428">parser</span><span class="op" id="5650434">)</span>&nbsp;<span class="ident" id="5650436">parseBody</span><span class="op" id="5650445">(</span><span class="ident" id="5650446">scope</span>&nbsp;<span class="op" id="5650452">*</span><span class="ident" id="5650453">ast</span><span class="op" id="5650456">.</span><span class="ident" id="5650457">Scope</span><span class="op" id="5650462">)</span>&nbsp;<span class="op" id="5650464">*</span><span class="ident" id="5650465">ast</span><span class="op" id="5650468">.</span><span class="ident" id="5650469">BlockStmt</span>&nbsp;<span class="op" id="5650479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650482">if</span>&nbsp;<span class="ident" id="5650485">p</span><span class="op" id="5650486">.</span><span class="ident" id="5650487">trace</span>&nbsp;<span class="op" id="5650493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650497">defer</span>&nbsp;<span class="ident" id="5650503">un</span><span class="op" id="5650505">(</span><span class="ident" id="5650506">trace</span><span class="op" id="5650511">(</span><span class="ident" id="5650512">p</span><span class="op" id="5650513">,</span>&nbsp;<span class="string" id="5650515">&#34;Body&#34;</span><span class="op" id="5650521">)</span><span class="op" id="5650522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5650525">}</span><br>
<span class="lineno">1065</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650529">lbrace</span>&nbsp;<span class="op" id="5650536">:=</span>&nbsp;<span class="ident" id="5650539">p</span><span class="op" id="5650540">.</span><span class="ident" id="5650541">expect</span><span class="op" id="5650547">(</span><span class="ident" id="5650548">token</span><span class="op" id="5650553">.</span><span class="ident" id="5650554">LBRACE</span><span class="op" id="5650560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650563">p</span><span class="op" id="5650564">.</span><span class="ident" id="5650565">topScope</span>&nbsp;<span class="op" id="5650574">=</span>&nbsp;<span class="ident" id="5650576">scope</span>&nbsp;<span class="comment" id="5650582">//&nbsp;open&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650606">p</span><span class="op" id="5650607">.</span><span class="ident" id="5650608">openLabelScope</span><span class="op" id="5650622">(</span><span class="op" id="5650623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650626">list</span>&nbsp;<span class="op" id="5650631">:=</span>&nbsp;<span class="ident" id="5650634">p</span><span class="op" id="5650635">.</span><span class="ident" id="5650636">parseStmtList</span><span class="op" id="5650649">(</span><span class="op" id="5650650">)</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650653">p</span><span class="op" id="5650654">.</span><span class="ident" id="5650655">closeLabelScope</span><span class="op" id="5650670">(</span><span class="op" id="5650671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650674">p</span><span class="op" id="5650675">.</span><span class="ident" id="5650676">closeScope</span><span class="op" id="5650686">(</span><span class="op" id="5650687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650690">rbrace</span>&nbsp;<span class="op" id="5650697">:=</span>&nbsp;<span class="ident" id="5650700">p</span><span class="op" id="5650701">.</span><span class="ident" id="5650702">expect</span><span class="op" id="5650708">(</span><span class="ident" id="5650709">token</span><span class="op" id="5650714">.</span><span class="ident" id="5650715">RBRACE</span><span class="op" id="5650721">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650725">return</span>&nbsp;<span class="op" id="5650732">&amp;</span><span class="ident" id="5650733">ast</span><span class="op" id="5650736">.</span><span class="ident" id="5650737">BlockStmt</span><span class="op" id="5650746">{</span><span class="ident" id="5650747">Lbrace</span><span class="op" id="5650753">:</span>&nbsp;<span class="ident" id="5650755">lbrace</span><span class="op" id="5650761">,</span>&nbsp;<span class="ident" id="5650763">List</span><span class="op" id="5650767">:</span>&nbsp;<span class="ident" id="5650769">list</span><span class="op" id="5650773">,</span>&nbsp;<span class="ident" id="5650775">Rbrace</span><span class="op" id="5650781">:</span>&nbsp;<span class="ident" id="5650783">rbrace</span><span class="op" id="5650789">}</span><br>
<span class="lineno">1075</span><span class="op" id="5650791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5650794">func</span>&nbsp;<span class="op" id="5650799">(</span><span class="ident" id="5650800">p</span>&nbsp;<span class="op" id="5650802">*</span><span class="ident" id="5650803">parser</span><span class="op" id="5650809">)</span>&nbsp;<span class="ident" id="5650811">parseBlockStmt</span><span class="op" id="5650825">(</span><span class="op" id="5650826">)</span>&nbsp;<span class="op" id="5650828">*</span><span class="ident" id="5650829">ast</span><span class="op" id="5650832">.</span><span class="ident" id="5650833">BlockStmt</span>&nbsp;<span class="op" id="5650843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650846">if</span>&nbsp;<span class="ident" id="5650849">p</span><span class="op" id="5650850">.</span><span class="ident" id="5650851">trace</span>&nbsp;<span class="op" id="5650857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650861">defer</span>&nbsp;<span class="ident" id="5650867">un</span><span class="op" id="5650869">(</span><span class="ident" id="5650870">trace</span><span class="op" id="5650875">(</span><span class="ident" id="5650876">p</span><span class="op" id="5650877">,</span>&nbsp;<span class="string" id="5650879">&#34;BlockStmt&#34;</span><span class="op" id="5650890">)</span><span class="op" id="5650891">)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5650894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650898">lbrace</span>&nbsp;<span class="op" id="5650905">:=</span>&nbsp;<span class="ident" id="5650908">p</span><span class="op" id="5650909">.</span><span class="ident" id="5650910">expect</span><span class="op" id="5650916">(</span><span class="ident" id="5650917">token</span><span class="op" id="5650922">.</span><span class="ident" id="5650923">LBRACE</span><span class="op" id="5650929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650932">p</span><span class="op" id="5650933">.</span><span class="ident" id="5650934">openScope</span><span class="op" id="5650943">(</span><span class="op" id="5650944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650947">list</span>&nbsp;<span class="op" id="5650952">:=</span>&nbsp;<span class="ident" id="5650955">p</span><span class="op" id="5650956">.</span><span class="ident" id="5650957">parseStmtList</span><span class="op" id="5650970">(</span><span class="op" id="5650971">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650974">p</span><span class="op" id="5650975">.</span><span class="ident" id="5650976">closeScope</span><span class="op" id="5650986">(</span><span class="op" id="5650987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650990">rbrace</span>&nbsp;<span class="op" id="5650997">:=</span>&nbsp;<span class="ident" id="5651000">p</span><span class="op" id="5651001">.</span><span class="ident" id="5651002">expect</span><span class="op" id="5651008">(</span><span class="ident" id="5651009">token</span><span class="op" id="5651014">.</span><span class="ident" id="5651015">RBRACE</span><span class="op" id="5651021">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651025">return</span>&nbsp;<span class="op" id="5651032">&amp;</span><span class="ident" id="5651033">ast</span><span class="op" id="5651036">.</span><span class="ident" id="5651037">BlockStmt</span><span class="op" id="5651046">{</span><span class="ident" id="5651047">Lbrace</span><span class="op" id="5651053">:</span>&nbsp;<span class="ident" id="5651055">lbrace</span><span class="op" id="5651061">,</span>&nbsp;<span class="ident" id="5651063">List</span><span class="op" id="5651067">:</span>&nbsp;<span class="ident" id="5651069">list</span><span class="op" id="5651073">,</span>&nbsp;<span class="ident" id="5651075">Rbrace</span><span class="op" id="5651081">:</span>&nbsp;<span class="ident" id="5651083">rbrace</span><span class="op" id="5651089">}</span><br>
<span class="lineno"></span><span class="op" id="5651091">}</span><br>
<span class="lineno">1090</span><br>
<span class="lineno"></span><span class="comment" id="5651094">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5651174">//&nbsp;Expressions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5651190">func</span>&nbsp;<span class="op" id="5651195">(</span><span class="ident" id="5651196">p</span>&nbsp;<span class="op" id="5651198">*</span><span class="ident" id="5651199">parser</span><span class="op" id="5651205">)</span>&nbsp;<span class="ident" id="5651207">parseFuncTypeOrLit</span><span class="op" id="5651225">(</span><span class="op" id="5651226">)</span>&nbsp;<span class="ident" id="5651228">ast</span><span class="op" id="5651231">.</span><span class="ident" id="5651232">Expr</span>&nbsp;<span class="op" id="5651237">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651240">if</span>&nbsp;<span class="ident" id="5651243">p</span><span class="op" id="5651244">.</span><span class="ident" id="5651245">trace</span>&nbsp;<span class="op" id="5651251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651255">defer</span>&nbsp;<span class="ident" id="5651261">un</span><span class="op" id="5651263">(</span><span class="ident" id="5651264">trace</span><span class="op" id="5651269">(</span><span class="ident" id="5651270">p</span><span class="op" id="5651271">,</span>&nbsp;<span class="string" id="5651273">&#34;FuncTypeOrLit&#34;</span><span class="op" id="5651288">)</span><span class="op" id="5651289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5651292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651296">typ</span><span class="op" id="5651299">,</span>&nbsp;<span class="ident" id="5651301">scope</span>&nbsp;<span class="op" id="5651307">:=</span>&nbsp;<span class="ident" id="5651310">p</span><span class="op" id="5651311">.</span><span class="ident" id="5651312">parseFuncType</span><span class="op" id="5651325">(</span><span class="op" id="5651326">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651329">if</span>&nbsp;<span class="ident" id="5651332">p</span><span class="op" id="5651333">.</span><span class="ident" id="5651334">tok</span>&nbsp;<span class="op" id="5651338">!=</span>&nbsp;<span class="ident" id="5651341">token</span><span class="op" id="5651346">.</span><span class="ident" id="5651347">LBRACE</span>&nbsp;<span class="op" id="5651354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5651358">//&nbsp;function&nbsp;type&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651382">return</span>&nbsp;<span class="ident" id="5651389">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5651394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651398">p</span><span class="op" id="5651399">.</span><span class="ident" id="5651400">exprLev</span><span class="op" id="5651407">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651411">body</span>&nbsp;<span class="op" id="5651416">:=</span>&nbsp;<span class="ident" id="5651419">p</span><span class="op" id="5651420">.</span><span class="ident" id="5651421">parseBody</span><span class="op" id="5651430">(</span><span class="ident" id="5651431">scope</span><span class="op" id="5651436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651439">p</span><span class="op" id="5651440">.</span><span class="ident" id="5651441">exprLev</span><span class="op" id="5651448">--</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651453">return</span>&nbsp;<span class="op" id="5651460">&amp;</span><span class="ident" id="5651461">ast</span><span class="op" id="5651464">.</span><span class="ident" id="5651465">FuncLit</span><span class="op" id="5651472">{</span><span class="ident" id="5651473">Type</span><span class="op" id="5651477">:</span>&nbsp;<span class="ident" id="5651479">typ</span><span class="op" id="5651482">,</span>&nbsp;<span class="ident" id="5651484">Body</span><span class="op" id="5651488">:</span>&nbsp;<span class="ident" id="5651490">body</span><span class="op" id="5651494">}</span><br>
<span class="lineno">1110</span><span class="op" id="5651496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5651499">//&nbsp;parseOperand&nbsp;may&nbsp;return&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;raw&nbsp;type&nbsp;(incl.&nbsp;array</span><br>
<span class="lineno"></span><span class="comment" id="5651567">//&nbsp;types&nbsp;of&nbsp;the&nbsp;form&nbsp;[...]T.&nbsp;Callers&nbsp;must&nbsp;verify&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="5651628">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1115</span><span class="comment" id="5651698">//</span><br>
<span class="lineno"></span><span class="keyword" id="5651701">func</span>&nbsp;<span class="op" id="5651706">(</span><span class="ident" id="5651707">p</span>&nbsp;<span class="op" id="5651709">*</span><span class="ident" id="5651710">parser</span><span class="op" id="5651716">)</span>&nbsp;<span class="ident" id="5651718">parseOperand</span><span class="op" id="5651730">(</span><span class="ident" id="5651731">lhs</span>&nbsp;<span class="builtintype" id="5651735">bool</span><span class="op" id="5651739">)</span>&nbsp;<span class="ident" id="5651741">ast</span><span class="op" id="5651744">.</span><span class="ident" id="5651745">Expr</span>&nbsp;<span class="op" id="5651750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651753">if</span>&nbsp;<span class="ident" id="5651756">p</span><span class="op" id="5651757">.</span><span class="ident" id="5651758">trace</span>&nbsp;<span class="op" id="5651764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651768">defer</span>&nbsp;<span class="ident" id="5651774">un</span><span class="op" id="5651776">(</span><span class="ident" id="5651777">trace</span><span class="op" id="5651782">(</span><span class="ident" id="5651783">p</span><span class="op" id="5651784">,</span>&nbsp;<span class="string" id="5651786">&#34;Operand&#34;</span><span class="op" id="5651795">)</span><span class="op" id="5651796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5651799">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651803">switch</span>&nbsp;<span class="ident" id="5651810">p</span><span class="op" id="5651811">.</span><span class="ident" id="5651812">tok</span>&nbsp;<span class="op" id="5651816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651819">case</span>&nbsp;<span class="ident" id="5651824">token</span><span class="op" id="5651829">.</span><span class="ident" id="5651830">IDENT</span><span class="op" id="5651835">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651839">x</span>&nbsp;<span class="op" id="5651841">:=</span>&nbsp;<span class="ident" id="5651844">p</span><span class="op" id="5651845">.</span><span class="ident" id="5651846">parseIdent</span><span class="op" id="5651856">(</span><span class="op" id="5651857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651861">if</span>&nbsp;<span class="op" id="5651864">!</span><span class="ident" id="5651865">lhs</span>&nbsp;<span class="op" id="5651869">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651874">p</span><span class="op" id="5651875">.</span><span class="ident" id="5651876">resolve</span><span class="op" id="5651883">(</span><span class="ident" id="5651884">x</span><span class="op" id="5651885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5651889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651893">return</span>&nbsp;<span class="ident" id="5651900">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651904">case</span>&nbsp;<span class="ident" id="5651909">token</span><span class="op" id="5651914">.</span><span class="ident" id="5651915">INT</span><span class="op" id="5651918">,</span>&nbsp;<span class="ident" id="5651920">token</span><span class="op" id="5651925">.</span><span class="ident" id="5651926">FLOAT</span><span class="op" id="5651931">,</span>&nbsp;<span class="ident" id="5651933">token</span><span class="op" id="5651938">.</span><span class="ident" id="5651939">IMAG</span><span class="op" id="5651943">,</span>&nbsp;<span class="ident" id="5651945">token</span><span class="op" id="5651950">.</span><span class="ident" id="5651951">CHAR</span><span class="op" id="5651955">,</span>&nbsp;<span class="ident" id="5651957">token</span><span class="op" id="5651962">.</span><span class="ident" id="5651963">STRING</span><span class="op" id="5651969">:</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651973">x</span>&nbsp;<span class="op" id="5651975">:=</span>&nbsp;<span class="op" id="5651978">&amp;</span><span class="ident" id="5651979">ast</span><span class="op" id="5651982">.</span><span class="ident" id="5651983">BasicLit</span><span class="op" id="5651991">{</span><span class="ident" id="5651992">ValuePos</span><span class="op" id="5652000">:</span>&nbsp;<span class="ident" id="5652002">p</span><span class="op" id="5652003">.</span><span class="ident" id="5652004">pos</span><span class="op" id="5652007">,</span>&nbsp;<span class="ident" id="5652009">Kind</span><span class="op" id="5652013">:</span>&nbsp;<span class="ident" id="5652015">p</span><span class="op" id="5652016">.</span><span class="ident" id="5652017">tok</span><span class="op" id="5652020">,</span>&nbsp;<span class="ident" id="5652022">Value</span><span class="op" id="5652027">:</span>&nbsp;<span class="ident" id="5652029">p</span><span class="op" id="5652030">.</span><span class="ident" id="5652031">lit</span><span class="op" id="5652034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652038">p</span><span class="op" id="5652039">.</span><span class="ident" id="5652040">next</span><span class="op" id="5652044">(</span><span class="op" id="5652045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652049">return</span>&nbsp;<span class="ident" id="5652056">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652060">case</span>&nbsp;<span class="ident" id="5652065">token</span><span class="op" id="5652070">.</span><span class="ident" id="5652071">LPAREN</span><span class="op" id="5652077">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652081">lparen</span>&nbsp;<span class="op" id="5652088">:=</span>&nbsp;<span class="ident" id="5652091">p</span><span class="op" id="5652092">.</span><span class="ident" id="5652093">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652099">p</span><span class="op" id="5652100">.</span><span class="ident" id="5652101">next</span><span class="op" id="5652105">(</span><span class="op" id="5652106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652110">p</span><span class="op" id="5652111">.</span><span class="ident" id="5652112">exprLev</span><span class="op" id="5652119">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652124">x</span>&nbsp;<span class="op" id="5652126">:=</span>&nbsp;<span class="ident" id="5652129">p</span><span class="op" id="5652130">.</span><span class="ident" id="5652131">parseRhsOrType</span><span class="op" id="5652145">(</span><span class="op" id="5652146">)</span>&nbsp;<span class="comment" id="5652148">//&nbsp;types&nbsp;may&nbsp;be&nbsp;parenthesized:&nbsp;(some&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652193">p</span><span class="op" id="5652194">.</span><span class="ident" id="5652195">exprLev</span><span class="op" id="5652202">--</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652207">rparen</span>&nbsp;<span class="op" id="5652214">:=</span>&nbsp;<span class="ident" id="5652217">p</span><span class="op" id="5652218">.</span><span class="ident" id="5652219">expect</span><span class="op" id="5652225">(</span><span class="ident" id="5652226">token</span><span class="op" id="5652231">.</span><span class="ident" id="5652232">RPAREN</span><span class="op" id="5652238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652242">return</span>&nbsp;<span class="op" id="5652249">&amp;</span><span class="ident" id="5652250">ast</span><span class="op" id="5652253">.</span><span class="ident" id="5652254">ParenExpr</span><span class="op" id="5652263">{</span><span class="ident" id="5652264">Lparen</span><span class="op" id="5652270">:</span>&nbsp;<span class="ident" id="5652272">lparen</span><span class="op" id="5652278">,</span>&nbsp;<span class="ident" id="5652280">X</span><span class="op" id="5652281">:</span>&nbsp;<span class="ident" id="5652283">x</span><span class="op" id="5652284">,</span>&nbsp;<span class="ident" id="5652286">Rparen</span><span class="op" id="5652292">:</span>&nbsp;<span class="ident" id="5652294">rparen</span><span class="op" id="5652300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652304">case</span>&nbsp;<span class="ident" id="5652309">token</span><span class="op" id="5652314">.</span><span class="ident" id="5652315">FUNC</span><span class="op" id="5652319">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652323">return</span>&nbsp;<span class="ident" id="5652330">p</span><span class="op" id="5652331">.</span><span class="ident" id="5652332">parseFuncTypeOrLit</span><span class="op" id="5652350">(</span><span class="op" id="5652351">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5652354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652358">if</span>&nbsp;<span class="ident" id="5652361">typ</span>&nbsp;<span class="op" id="5652365">:=</span>&nbsp;<span class="ident" id="5652368">p</span><span class="op" id="5652369">.</span><span class="ident" id="5652370">tryIdentOrType</span><span class="op" id="5652384">(</span><span class="op" id="5652385">)</span><span class="op" id="5652386">;</span>&nbsp;<span class="ident" id="5652388">typ</span>&nbsp;<span class="op" id="5652392">!=</span>&nbsp;<span class="ident" id="5652395">nil</span>&nbsp;<span class="op" id="5652399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5652403">//&nbsp;could&nbsp;be&nbsp;type&nbsp;for&nbsp;composite&nbsp;literal&nbsp;or&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652458">_</span><span class="op" id="5652459">,</span>&nbsp;<span class="ident" id="5652461">isIdent</span>&nbsp;<span class="op" id="5652469">:=</span>&nbsp;<span class="ident" id="5652472">typ</span><span class="op" id="5652475">.</span><span class="op" id="5652476">(</span><span class="op" id="5652477">*</span><span class="ident" id="5652478">ast</span><span class="op" id="5652481">.</span><span class="ident" id="5652482">Ident</span><span class="op" id="5652487">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652491">assert</span><span class="op" id="5652497">(</span><span class="op" id="5652498">!</span><span class="ident" id="5652499">isIdent</span><span class="op" id="5652506">,</span>&nbsp;<span class="string" id="5652508">&#34;type&nbsp;cannot&nbsp;be&nbsp;identifier&#34;</span><span class="op" id="5652535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652539">return</span>&nbsp;<span class="ident" id="5652546">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5652551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5652555">//&nbsp;we&nbsp;have&nbsp;an&nbsp;error</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652576">pos</span>&nbsp;<span class="op" id="5652580">:=</span>&nbsp;<span class="ident" id="5652583">p</span><span class="op" id="5652584">.</span><span class="ident" id="5652585">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652590">p</span><span class="op" id="5652591">.</span><span class="ident" id="5652592">errorExpected</span><span class="op" id="5652605">(</span><span class="ident" id="5652606">pos</span><span class="op" id="5652609">,</span>&nbsp;<span class="string" id="5652611">&#34;operand&#34;</span><span class="op" id="5652620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652623">syncStmt</span><span class="op" id="5652631">(</span><span class="ident" id="5652632">p</span><span class="op" id="5652633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652636">return</span>&nbsp;<span class="op" id="5652643">&amp;</span><span class="ident" id="5652644">ast</span><span class="op" id="5652647">.</span><span class="ident" id="5652648">BadExpr</span><span class="op" id="5652655">{</span><span class="ident" id="5652656">From</span><span class="op" id="5652660">:</span>&nbsp;<span class="ident" id="5652662">pos</span><span class="op" id="5652665">,</span>&nbsp;<span class="ident" id="5652667">To</span><span class="op" id="5652669">:</span>&nbsp;<span class="ident" id="5652671">p</span><span class="op" id="5652672">.</span><span class="ident" id="5652673">pos</span><span class="op" id="5652676">}</span><br>
<span class="lineno"></span><span class="op" id="5652678">}</span><br>
<span class="lineno">1160</span><br>
<span class="lineno"></span><span class="keyword" id="5652681">func</span>&nbsp;<span class="op" id="5652686">(</span><span class="ident" id="5652687">p</span>&nbsp;<span class="op" id="5652689">*</span><span class="ident" id="5652690">parser</span><span class="op" id="5652696">)</span>&nbsp;<span class="ident" id="5652698">parseSelector</span><span class="op" id="5652711">(</span><span class="ident" id="5652712">x</span>&nbsp;<span class="ident" id="5652714">ast</span><span class="op" id="5652717">.</span><span class="ident" id="5652718">Expr</span><span class="op" id="5652722">)</span>&nbsp;<span class="ident" id="5652724">ast</span><span class="op" id="5652727">.</span><span class="ident" id="5652728">Expr</span>&nbsp;<span class="op" id="5652733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652736">if</span>&nbsp;<span class="ident" id="5652739">p</span><span class="op" id="5652740">.</span><span class="ident" id="5652741">trace</span>&nbsp;<span class="op" id="5652747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652751">defer</span>&nbsp;<span class="ident" id="5652757">un</span><span class="op" id="5652759">(</span><span class="ident" id="5652760">trace</span><span class="op" id="5652765">(</span><span class="ident" id="5652766">p</span><span class="op" id="5652767">,</span>&nbsp;<span class="string" id="5652769">&#34;Selector&#34;</span><span class="op" id="5652779">)</span><span class="op" id="5652780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5652783">}</span><br>
<span class="lineno">1165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652787">sel</span>&nbsp;<span class="op" id="5652791">:=</span>&nbsp;<span class="ident" id="5652794">p</span><span class="op" id="5652795">.</span><span class="ident" id="5652796">parseIdent</span><span class="op" id="5652806">(</span><span class="op" id="5652807">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652811">return</span>&nbsp;<span class="op" id="5652818">&amp;</span><span class="ident" id="5652819">ast</span><span class="op" id="5652822">.</span><span class="ident" id="5652823">SelectorExpr</span><span class="op" id="5652835">{</span><span class="ident" id="5652836">X</span><span class="op" id="5652837">:</span>&nbsp;<span class="ident" id="5652839">x</span><span class="op" id="5652840">,</span>&nbsp;<span class="ident" id="5652842">Sel</span><span class="op" id="5652845">:</span>&nbsp;<span class="ident" id="5652847">sel</span><span class="op" id="5652850">}</span><br>
<span class="lineno"></span><span class="op" id="5652852">}</span><br>
<span class="lineno">1170</span><br>
<span class="lineno"></span><span class="keyword" id="5652855">func</span>&nbsp;<span class="op" id="5652860">(</span><span class="ident" id="5652861">p</span>&nbsp;<span class="op" id="5652863">*</span><span class="ident" id="5652864">parser</span><span class="op" id="5652870">)</span>&nbsp;<span class="ident" id="5652872">parseTypeAssertion</span><span class="op" id="5652890">(</span><span class="ident" id="5652891">x</span>&nbsp;<span class="ident" id="5652893">ast</span><span class="op" id="5652896">.</span><span class="ident" id="5652897">Expr</span><span class="op" id="5652901">)</span>&nbsp;<span class="ident" id="5652903">ast</span><span class="op" id="5652906">.</span><span class="ident" id="5652907">Expr</span>&nbsp;<span class="op" id="5652912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652915">if</span>&nbsp;<span class="ident" id="5652918">p</span><span class="op" id="5652919">.</span><span class="ident" id="5652920">trace</span>&nbsp;<span class="op" id="5652926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652930">defer</span>&nbsp;<span class="ident" id="5652936">un</span><span class="op" id="5652938">(</span><span class="ident" id="5652939">trace</span><span class="op" id="5652944">(</span><span class="ident" id="5652945">p</span><span class="op" id="5652946">,</span>&nbsp;<span class="string" id="5652948">&#34;TypeAssertion&#34;</span><span class="op" id="5652963">)</span><span class="op" id="5652964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5652967">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652971">lparen</span>&nbsp;<span class="op" id="5652978">:=</span>&nbsp;<span class="ident" id="5652981">p</span><span class="op" id="5652982">.</span><span class="ident" id="5652983">expect</span><span class="op" id="5652989">(</span><span class="ident" id="5652990">token</span><span class="op" id="5652995">.</span><span class="ident" id="5652996">LPAREN</span><span class="op" id="5653002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653005">var</span>&nbsp;<span class="ident" id="5653009">typ</span>&nbsp;<span class="ident" id="5653013">ast</span><span class="op" id="5653016">.</span><span class="ident" id="5653017">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653023">if</span>&nbsp;<span class="ident" id="5653026">p</span><span class="op" id="5653027">.</span><span class="ident" id="5653028">tok</span>&nbsp;<span class="op" id="5653032">==</span>&nbsp;<span class="ident" id="5653035">token</span><span class="op" id="5653040">.</span><span class="ident" id="5653041">TYPE</span>&nbsp;<span class="op" id="5653046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5653050">//&nbsp;type&nbsp;switch:&nbsp;typ&nbsp;==&nbsp;nil</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653079">p</span><span class="op" id="5653080">.</span><span class="ident" id="5653081">next</span><span class="op" id="5653085">(</span><span class="op" id="5653086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5653089">}</span>&nbsp;<span class="keyword" id="5653091">else</span>&nbsp;<span class="op" id="5653096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653100">typ</span>&nbsp;<span class="op" id="5653104">=</span>&nbsp;<span class="ident" id="5653106">p</span><span class="op" id="5653107">.</span><span class="ident" id="5653108">parseType</span><span class="op" id="5653117">(</span><span class="op" id="5653118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5653121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653124">rparen</span>&nbsp;<span class="op" id="5653131">:=</span>&nbsp;<span class="ident" id="5653134">p</span><span class="op" id="5653135">.</span><span class="ident" id="5653136">expect</span><span class="op" id="5653142">(</span><span class="ident" id="5653143">token</span><span class="op" id="5653148">.</span><span class="ident" id="5653149">RPAREN</span><span class="op" id="5653155">)</span><br>
<span class="lineno">1185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653159">return</span>&nbsp;<span class="op" id="5653166">&amp;</span><span class="ident" id="5653167">ast</span><span class="op" id="5653170">.</span><span class="ident" id="5653171">TypeAssertExpr</span><span class="op" id="5653185">{</span><span class="ident" id="5653186">X</span><span class="op" id="5653187">:</span>&nbsp;<span class="ident" id="5653189">x</span><span class="op" id="5653190">,</span>&nbsp;<span class="ident" id="5653192">Type</span><span class="op" id="5653196">:</span>&nbsp;<span class="ident" id="5653198">typ</span><span class="op" id="5653201">,</span>&nbsp;<span class="ident" id="5653203">Lparen</span><span class="op" id="5653209">:</span>&nbsp;<span class="ident" id="5653211">lparen</span><span class="op" id="5653217">,</span>&nbsp;<span class="ident" id="5653219">Rparen</span><span class="op" id="5653225">:</span>&nbsp;<span class="ident" id="5653227">rparen</span><span class="op" id="5653233">}</span><br>
<span class="lineno"></span><span class="op" id="5653235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5653238">func</span>&nbsp;<span class="op" id="5653243">(</span><span class="ident" id="5653244">p</span>&nbsp;<span class="op" id="5653246">*</span><span class="ident" id="5653247">parser</span><span class="op" id="5653253">)</span>&nbsp;<span class="ident" id="5653255">parseIndexOrSlice</span><span class="op" id="5653272">(</span><span class="ident" id="5653273">x</span>&nbsp;<span class="ident" id="5653275">ast</span><span class="op" id="5653278">.</span><span class="ident" id="5653279">Expr</span><span class="op" id="5653283">)</span>&nbsp;<span class="ident" id="5653285">ast</span><span class="op" id="5653288">.</span><span class="ident" id="5653289">Expr</span>&nbsp;<span class="op" id="5653294">{</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653297">if</span>&nbsp;<span class="ident" id="5653300">p</span><span class="op" id="5653301">.</span><span class="ident" id="5653302">trace</span>&nbsp;<span class="op" id="5653308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653312">defer</span>&nbsp;<span class="ident" id="5653318">un</span><span class="op" id="5653320">(</span><span class="ident" id="5653321">trace</span><span class="op" id="5653326">(</span><span class="ident" id="5653327">p</span><span class="op" id="5653328">,</span>&nbsp;<span class="string" id="5653330">&#34;IndexOrSlice&#34;</span><span class="op" id="5653344">)</span><span class="op" id="5653345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5653348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653352">const</span>&nbsp;<span class="ident" id="5653358">N</span>&nbsp;<span class="op" id="5653360">=</span>&nbsp;<span class="num" id="5653362">3</span>&nbsp;<span class="comment" id="5653364">//&nbsp;change&nbsp;the&nbsp;3&nbsp;to&nbsp;2&nbsp;to&nbsp;disable&nbsp;3-index&nbsp;slices</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653412">lbrack</span>&nbsp;<span class="op" id="5653419">:=</span>&nbsp;<span class="ident" id="5653422">p</span><span class="op" id="5653423">.</span><span class="ident" id="5653424">expect</span><span class="op" id="5653430">(</span><span class="ident" id="5653431">token</span><span class="op" id="5653436">.</span><span class="ident" id="5653437">LBRACK</span><span class="op" id="5653443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653446">p</span><span class="op" id="5653447">.</span><span class="ident" id="5653448">exprLev</span><span class="op" id="5653455">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653459">var</span>&nbsp;<span class="ident" id="5653463">index</span>&nbsp;<span class="op" id="5653469">[</span><span class="ident" id="5653470">N</span><span class="op" id="5653471">]</span><span class="ident" id="5653472">ast</span><span class="op" id="5653475">.</span><span class="ident" id="5653476">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653482">var</span>&nbsp;<span class="ident" id="5653486">colons</span>&nbsp;<span class="op" id="5653493">[</span><span class="ident" id="5653494">N</span>&nbsp;<span class="op" id="5653496">-</span>&nbsp;<span class="num" id="5653498">1</span><span class="op" id="5653499">]</span><span class="ident" id="5653500">token</span><span class="op" id="5653505">.</span><span class="ident" id="5653506">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653511">if</span>&nbsp;<span class="ident" id="5653514">p</span><span class="op" id="5653515">.</span><span class="ident" id="5653516">tok</span>&nbsp;<span class="op" id="5653520">!=</span>&nbsp;<span class="ident" id="5653523">token</span><span class="op" id="5653528">.</span><span class="ident" id="5653529">COLON</span>&nbsp;<span class="op" id="5653535">{</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653539">index</span><span class="op" id="5653544">[</span><span class="num" id="5653545">0</span><span class="op" id="5653546">]</span>&nbsp;<span class="op" id="5653548">=</span>&nbsp;<span class="ident" id="5653550">p</span><span class="op" id="5653551">.</span><span class="ident" id="5653552">parseRhs</span><span class="op" id="5653560">(</span><span class="op" id="5653561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5653564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653567">ncolons</span>&nbsp;<span class="op" id="5653575">:=</span>&nbsp;<span class="num" id="5653578">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653581">for</span>&nbsp;<span class="ident" id="5653585">p</span><span class="op" id="5653586">.</span><span class="ident" id="5653587">tok</span>&nbsp;<span class="op" id="5653591">==</span>&nbsp;<span class="ident" id="5653594">token</span><span class="op" id="5653599">.</span><span class="ident" id="5653600">COLON</span>&nbsp;<span class="op" id="5653606">&amp;&amp;</span>&nbsp;<span class="ident" id="5653609">ncolons</span>&nbsp;<span class="op" id="5653617">&lt;</span>&nbsp;<span class="builtinfunc" id="5653619">len</span><span class="op" id="5653622">(</span><span class="ident" id="5653623">colons</span><span class="op" id="5653629">)</span>&nbsp;<span class="op" id="5653631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653635">colons</span><span class="op" id="5653641">[</span><span class="ident" id="5653642">ncolons</span><span class="op" id="5653649">]</span>&nbsp;<span class="op" id="5653651">=</span>&nbsp;<span class="ident" id="5653653">p</span><span class="op" id="5653654">.</span><span class="ident" id="5653655">pos</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653661">ncolons</span><span class="op" id="5653668">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653673">p</span><span class="op" id="5653674">.</span><span class="ident" id="5653675">next</span><span class="op" id="5653679">(</span><span class="op" id="5653680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653684">if</span>&nbsp;<span class="ident" id="5653687">p</span><span class="op" id="5653688">.</span><span class="ident" id="5653689">tok</span>&nbsp;<span class="op" id="5653693">!=</span>&nbsp;<span class="ident" id="5653696">token</span><span class="op" id="5653701">.</span><span class="ident" id="5653702">COLON</span>&nbsp;<span class="op" id="5653708">&amp;&amp;</span>&nbsp;<span class="ident" id="5653711">p</span><span class="op" id="5653712">.</span><span class="ident" id="5653713">tok</span>&nbsp;<span class="op" id="5653717">!=</span>&nbsp;<span class="ident" id="5653720">token</span><span class="op" id="5653725">.</span><span class="ident" id="5653726">RBRACK</span>&nbsp;<span class="op" id="5653733">&amp;&amp;</span>&nbsp;<span class="ident" id="5653736">p</span><span class="op" id="5653737">.</span><span class="ident" id="5653738">tok</span>&nbsp;<span class="op" id="5653742">!=</span>&nbsp;<span class="ident" id="5653745">token</span><span class="op" id="5653750">.</span><span class="ident" id="5653751">EOF</span>&nbsp;<span class="op" id="5653755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653760">index</span><span class="op" id="5653765">[</span><span class="ident" id="5653766">ncolons</span><span class="op" id="5653773">]</span>&nbsp;<span class="op" id="5653775">=</span>&nbsp;<span class="ident" id="5653777">p</span><span class="op" id="5653778">.</span><span class="ident" id="5653779">parseRhs</span><span class="op" id="5653787">(</span><span class="op" id="5653788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5653792">}</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5653795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653798">p</span><span class="op" id="5653799">.</span><span class="ident" id="5653800">exprLev</span><span class="op" id="5653807">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653811">rbrack</span>&nbsp;<span class="op" id="5653818">:=</span>&nbsp;<span class="ident" id="5653821">p</span><span class="op" id="5653822">.</span><span class="ident" id="5653823">expect</span><span class="op" id="5653829">(</span><span class="ident" id="5653830">token</span><span class="op" id="5653835">.</span><span class="ident" id="5653836">RBRACK</span><span class="op" id="5653842">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653846">if</span>&nbsp;<span class="ident" id="5653849">ncolons</span>&nbsp;<span class="op" id="5653857">&gt;</span>&nbsp;<span class="num" id="5653859">0</span>&nbsp;<span class="op" id="5653861">{</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5653865">//&nbsp;slice&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653887">slice3</span>&nbsp;<span class="op" id="5653894">:=</span>&nbsp;<span class="builtintype" id="5653897">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653905">if</span>&nbsp;<span class="ident" id="5653908">ncolons</span>&nbsp;<span class="op" id="5653916">==</span>&nbsp;<span class="num" id="5653919">2</span>&nbsp;<span class="op" id="5653921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653926">slice3</span>&nbsp;<span class="op" id="5653933">=</span>&nbsp;<span class="builtintype" id="5653935">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5653943">//&nbsp;Check&nbsp;presence&nbsp;of&nbsp;2nd&nbsp;and&nbsp;3rd&nbsp;index&nbsp;here&nbsp;rather&nbsp;than&nbsp;during&nbsp;type-checking</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5654023">//&nbsp;to&nbsp;prevent&nbsp;erroneous&nbsp;programs&nbsp;from&nbsp;passing&nbsp;through&nbsp;gofmt&nbsp;(was&nbsp;issue&nbsp;7305).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654104">if</span>&nbsp;<span class="ident" id="5654107">index</span><span class="op" id="5654112">[</span><span class="num" id="5654113">1</span><span class="op" id="5654114">]</span>&nbsp;<span class="op" id="5654116">==</span>&nbsp;<span class="ident" id="5654119">nil</span>&nbsp;<span class="op" id="5654123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654129">p</span><span class="op" id="5654130">.</span><span class="builtintype" id="5654131">error</span><span class="op" id="5654136">(</span><span class="ident" id="5654137">colons</span><span class="op" id="5654143">[</span><span class="num" id="5654144">0</span><span class="op" id="5654145">]</span><span class="op" id="5654146">,</span>&nbsp;<span class="string" id="5654148">&#34;2nd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="5654185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654191">index</span><span class="op" id="5654196">[</span><span class="num" id="5654197">1</span><span class="op" id="5654198">]</span>&nbsp;<span class="op" id="5654200">=</span>&nbsp;<span class="op" id="5654202">&amp;</span><span class="ident" id="5654203">ast</span><span class="op" id="5654206">.</span><span class="ident" id="5654207">BadExpr</span><span class="op" id="5654214">{</span><span class="ident" id="5654215">From</span><span class="op" id="5654219">:</span>&nbsp;<span class="ident" id="5654221">colons</span><span class="op" id="5654227">[</span><span class="num" id="5654228">0</span><span class="op" id="5654229">]</span>&nbsp;<span class="op" id="5654231">+</span>&nbsp;<span class="num" id="5654233">1</span><span class="op" id="5654234">,</span>&nbsp;<span class="ident" id="5654236">To</span><span class="op" id="5654238">:</span>&nbsp;<span class="ident" id="5654240">colons</span><span class="op" id="5654246">[</span><span class="num" id="5654247">1</span><span class="op" id="5654248">]</span><span class="op" id="5654249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5654254">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654259">if</span>&nbsp;<span class="ident" id="5654262">index</span><span class="op" id="5654267">[</span><span class="num" id="5654268">2</span><span class="op" id="5654269">]</span>&nbsp;<span class="op" id="5654271">==</span>&nbsp;<span class="ident" id="5654274">nil</span>&nbsp;<span class="op" id="5654278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654284">p</span><span class="op" id="5654285">.</span><span class="builtintype" id="5654286">error</span><span class="op" id="5654291">(</span><span class="ident" id="5654292">colons</span><span class="op" id="5654298">[</span><span class="num" id="5654299">1</span><span class="op" id="5654300">]</span><span class="op" id="5654301">,</span>&nbsp;<span class="string" id="5654303">&#34;3rd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="5654340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654346">index</span><span class="op" id="5654351">[</span><span class="num" id="5654352">2</span><span class="op" id="5654353">]</span>&nbsp;<span class="op" id="5654355">=</span>&nbsp;<span class="op" id="5654357">&amp;</span><span class="ident" id="5654358">ast</span><span class="op" id="5654361">.</span><span class="ident" id="5654362">BadExpr</span><span class="op" id="5654369">{</span><span class="ident" id="5654370">From</span><span class="op" id="5654374">:</span>&nbsp;<span class="ident" id="5654376">colons</span><span class="op" id="5654382">[</span><span class="num" id="5654383">1</span><span class="op" id="5654384">]</span>&nbsp;<span class="op" id="5654386">+</span>&nbsp;<span class="num" id="5654388">1</span><span class="op" id="5654389">,</span>&nbsp;<span class="ident" id="5654391">To</span><span class="op" id="5654393">:</span>&nbsp;<span class="ident" id="5654395">rbrack</span><span class="op" id="5654401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5654406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5654410">}</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654414">return</span>&nbsp;<span class="op" id="5654421">&amp;</span><span class="ident" id="5654422">ast</span><span class="op" id="5654425">.</span><span class="ident" id="5654426">SliceExpr</span><span class="op" id="5654435">{</span><span class="ident" id="5654436">X</span><span class="op" id="5654437">:</span>&nbsp;<span class="ident" id="5654439">x</span><span class="op" id="5654440">,</span>&nbsp;<span class="ident" id="5654442">Lbrack</span><span class="op" id="5654448">:</span>&nbsp;<span class="ident" id="5654450">lbrack</span><span class="op" id="5654456">,</span>&nbsp;<span class="ident" id="5654458">Low</span><span class="op" id="5654461">:</span>&nbsp;<span class="ident" id="5654463">index</span><span class="op" id="5654468">[</span><span class="num" id="5654469">0</span><span class="op" id="5654470">]</span><span class="op" id="5654471">,</span>&nbsp;<span class="ident" id="5654473">High</span><span class="op" id="5654477">:</span>&nbsp;<span class="ident" id="5654479">index</span><span class="op" id="5654484">[</span><span class="num" id="5654485">1</span><span class="op" id="5654486">]</span><span class="op" id="5654487">,</span>&nbsp;<span class="ident" id="5654489">Max</span><span class="op" id="5654492">:</span>&nbsp;<span class="ident" id="5654494">index</span><span class="op" id="5654499">[</span><span class="num" id="5654500">2</span><span class="op" id="5654501">]</span><span class="op" id="5654502">,</span>&nbsp;<span class="ident" id="5654504">Slice3</span><span class="op" id="5654510">:</span>&nbsp;<span class="ident" id="5654512">slice3</span><span class="op" id="5654518">,</span>&nbsp;<span class="ident" id="5654520">Rbrack</span><span class="op" id="5654526">:</span>&nbsp;<span class="ident" id="5654528">rbrack</span><span class="op" id="5654534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5654537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654541">return</span>&nbsp;<span class="op" id="5654548">&amp;</span><span class="ident" id="5654549">ast</span><span class="op" id="5654552">.</span><span class="ident" id="5654553">IndexExpr</span><span class="op" id="5654562">{</span><span class="ident" id="5654563">X</span><span class="op" id="5654564">:</span>&nbsp;<span class="ident" id="5654566">x</span><span class="op" id="5654567">,</span>&nbsp;<span class="ident" id="5654569">Lbrack</span><span class="op" id="5654575">:</span>&nbsp;<span class="ident" id="5654577">lbrack</span><span class="op" id="5654583">,</span>&nbsp;<span class="ident" id="5654585">Index</span><span class="op" id="5654590">:</span>&nbsp;<span class="ident" id="5654592">index</span><span class="op" id="5654597">[</span><span class="num" id="5654598">0</span><span class="op" id="5654599">]</span><span class="op" id="5654600">,</span>&nbsp;<span class="ident" id="5654602">Rbrack</span><span class="op" id="5654608">:</span>&nbsp;<span class="ident" id="5654610">rbrack</span><span class="op" id="5654616">}</span><br>
<span class="lineno"></span><span class="op" id="5654618">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span><span class="keyword" id="5654621">func</span>&nbsp;<span class="op" id="5654626">(</span><span class="ident" id="5654627">p</span>&nbsp;<span class="op" id="5654629">*</span><span class="ident" id="5654630">parser</span><span class="op" id="5654636">)</span>&nbsp;<span class="ident" id="5654638">parseCallOrConversion</span><span class="op" id="5654659">(</span><span class="ident" id="5654660">fun</span>&nbsp;<span class="ident" id="5654664">ast</span><span class="op" id="5654667">.</span><span class="ident" id="5654668">Expr</span><span class="op" id="5654672">)</span>&nbsp;<span class="op" id="5654674">*</span><span class="ident" id="5654675">ast</span><span class="op" id="5654678">.</span><span class="ident" id="5654679">CallExpr</span>&nbsp;<span class="op" id="5654688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654691">if</span>&nbsp;<span class="ident" id="5654694">p</span><span class="op" id="5654695">.</span><span class="ident" id="5654696">trace</span>&nbsp;<span class="op" id="5654702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654706">defer</span>&nbsp;<span class="ident" id="5654712">un</span><span class="op" id="5654714">(</span><span class="ident" id="5654715">trace</span><span class="op" id="5654720">(</span><span class="ident" id="5654721">p</span><span class="op" id="5654722">,</span>&nbsp;<span class="string" id="5654724">&#34;CallOrConversion&#34;</span><span class="op" id="5654742">)</span><span class="op" id="5654743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5654746">}</span><br>
<span class="lineno">1240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654750">lparen</span>&nbsp;<span class="op" id="5654757">:=</span>&nbsp;<span class="ident" id="5654760">p</span><span class="op" id="5654761">.</span><span class="ident" id="5654762">expect</span><span class="op" id="5654768">(</span><span class="ident" id="5654769">token</span><span class="op" id="5654774">.</span><span class="ident" id="5654775">LPAREN</span><span class="op" id="5654781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654784">p</span><span class="op" id="5654785">.</span><span class="ident" id="5654786">exprLev</span><span class="op" id="5654793">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654797">var</span>&nbsp;<span class="ident" id="5654801">list</span>&nbsp;<span class="op" id="5654806">[</span><span class="op" id="5654807">]</span><span class="ident" id="5654808">ast</span><span class="op" id="5654811">.</span><span class="ident" id="5654812">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654818">var</span>&nbsp;<span class="ident" id="5654822">ellipsis</span>&nbsp;<span class="ident" id="5654831">token</span><span class="op" id="5654836">.</span><span class="ident" id="5654837">Pos</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654842">for</span>&nbsp;<span class="ident" id="5654846">p</span><span class="op" id="5654847">.</span><span class="ident" id="5654848">tok</span>&nbsp;<span class="op" id="5654852">!=</span>&nbsp;<span class="ident" id="5654855">token</span><span class="op" id="5654860">.</span><span class="ident" id="5654861">RPAREN</span>&nbsp;<span class="op" id="5654868">&amp;&amp;</span>&nbsp;<span class="ident" id="5654871">p</span><span class="op" id="5654872">.</span><span class="ident" id="5654873">tok</span>&nbsp;<span class="op" id="5654877">!=</span>&nbsp;<span class="ident" id="5654880">token</span><span class="op" id="5654885">.</span><span class="ident" id="5654886">EOF</span>&nbsp;<span class="op" id="5654890">&amp;&amp;</span>&nbsp;<span class="op" id="5654893">!</span><span class="ident" id="5654894">ellipsis</span><span class="op" id="5654902">.</span><span class="ident" id="5654903">IsValid</span><span class="op" id="5654910">(</span><span class="op" id="5654911">)</span>&nbsp;<span class="op" id="5654913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654917">list</span>&nbsp;<span class="op" id="5654922">=</span>&nbsp;<span class="builtinfunc" id="5654924">append</span><span class="op" id="5654930">(</span><span class="ident" id="5654931">list</span><span class="op" id="5654935">,</span>&nbsp;<span class="ident" id="5654937">p</span><span class="op" id="5654938">.</span><span class="ident" id="5654939">parseRhsOrType</span><span class="op" id="5654953">(</span><span class="op" id="5654954">)</span><span class="op" id="5654955">)</span>&nbsp;<span class="comment" id="5654957">//&nbsp;builtins&nbsp;may&nbsp;expect&nbsp;a&nbsp;type:&nbsp;make(some&nbsp;type,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655011">if</span>&nbsp;<span class="ident" id="5655014">p</span><span class="op" id="5655015">.</span><span class="ident" id="5655016">tok</span>&nbsp;<span class="op" id="5655020">==</span>&nbsp;<span class="ident" id="5655023">token</span><span class="op" id="5655028">.</span><span class="ident" id="5655029">ELLIPSIS</span>&nbsp;<span class="op" id="5655038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5655043">ellipsis</span>&nbsp;<span class="op" id="5655052">=</span>&nbsp;<span class="ident" id="5655054">p</span><span class="op" id="5655055">.</span><span class="ident" id="5655056">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5655063">p</span><span class="op" id="5655064">.</span><span class="ident" id="5655065">next</span><span class="op" id="5655069">(</span><span class="op" id="5655070">)</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5655074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655078">if</span>&nbsp;<span class="op" id="5655081">!</span><span class="ident" id="5655082">p</span><span class="op" id="5655083">.</span><span class="ident" id="5655084">atComma</span><span class="op" id="5655091">(</span><span class="string" id="5655092">&#34;argument&nbsp;list&#34;</span><span class="op" id="5655107">)</span>&nbsp;<span class="op" id="5655109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655114">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5655122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5655126">p</span><span class="op" id="5655127">.</span><span class="ident" id="5655128">next</span><span class="op" id="5655132">(</span><span class="op" id="5655133">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5655136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5655139">p</span><span class="op" id="5655140">.</span><span class="ident" id="5655141">exprLev</span><span class="op" id="5655148">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5655152">rparen</span>&nbsp;<span class="op" id="5655159">:=</span>&nbsp;<span class="ident" id="5655162">p</span><span class="op" id="5655163">.</span><span class="ident" id="5655164">expectClosing</span><span class="op" id="5655177">(</span><span class="ident" id="5655178">token</span><span class="op" id="5655183">.</span><span class="ident" id="5655184">RPAREN</span><span class="op" id="5655190">,</span>&nbsp;<span class="string" id="5655192">&#34;argument&nbsp;list&#34;</span><span class="op" id="5655207">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655211">return</span>&nbsp;<span class="op" id="5655218">&amp;</span><span class="ident" id="5655219">ast</span><span class="op" id="5655222">.</span><span class="ident" id="5655223">CallExpr</span><span class="op" id="5655231">{</span><span class="ident" id="5655232">Fun</span><span class="op" id="5655235">:</span>&nbsp;<span class="ident" id="5655237">fun</span><span class="op" id="5655240">,</span>&nbsp;<span class="ident" id="5655242">Lparen</span><span class="op" id="5655248">:</span>&nbsp;<span class="ident" id="5655250">lparen</span><span class="op" id="5655256">,</span>&nbsp;<span class="ident" id="5655258">Args</span><span class="op" id="5655262">:</span>&nbsp;<span class="ident" id="5655264">list</span><span class="op" id="5655268">,</span>&nbsp;<span class="ident" id="5655270">Ellipsis</span><span class="op" id="5655278">:</span>&nbsp;<span class="ident" id="5655280">ellipsis</span><span class="op" id="5655288">,</span>&nbsp;<span class="ident" id="5655290">Rparen</span><span class="op" id="5655296">:</span>&nbsp;<span class="ident" id="5655298">rparen</span><span class="op" id="5655304">}</span><br>
<span class="lineno">1260</span><span class="op" id="5655306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5655309">func</span>&nbsp;<span class="op" id="5655314">(</span><span class="ident" id="5655315">p</span>&nbsp;<span class="op" id="5655317">*</span><span class="ident" id="5655318">parser</span><span class="op" id="5655324">)</span>&nbsp;<span class="ident" id="5655326">parseElement</span><span class="op" id="5655338">(</span><span class="ident" id="5655339">keyOk</span>&nbsp;<span class="builtintype" id="5655345">bool</span><span class="op" id="5655349">)</span>&nbsp;<span class="ident" id="5655351">ast</span><span class="op" id="5655354">.</span><span class="ident" id="5655355">Expr</span>&nbsp;<span class="op" id="5655360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655363">if</span>&nbsp;<span class="ident" id="5655366">p</span><span class="op" id="5655367">.</span><span class="ident" id="5655368">trace</span>&nbsp;<span class="op" id="5655374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655378">defer</span>&nbsp;<span class="ident" id="5655384">un</span><span class="op" id="5655386">(</span><span class="ident" id="5655387">trace</span><span class="op" id="5655392">(</span><span class="ident" id="5655393">p</span><span class="op" id="5655394">,</span>&nbsp;<span class="string" id="5655396">&#34;Element&#34;</span><span class="op" id="5655405">)</span><span class="op" id="5655406">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5655409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655413">if</span>&nbsp;<span class="ident" id="5655416">p</span><span class="op" id="5655417">.</span><span class="ident" id="5655418">tok</span>&nbsp;<span class="op" id="5655422">==</span>&nbsp;<span class="ident" id="5655425">token</span><span class="op" id="5655430">.</span><span class="ident" id="5655431">LBRACE</span>&nbsp;<span class="op" id="5655438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655442">return</span>&nbsp;<span class="ident" id="5655449">p</span><span class="op" id="5655450">.</span><span class="ident" id="5655451">parseLiteralValue</span><span class="op" id="5655468">(</span><span class="ident" id="5655469">nil</span><span class="op" id="5655472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5655475">}</span><br>
<span class="lineno">1270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655479">//&nbsp;Because&nbsp;the&nbsp;parser&nbsp;doesn&#39;t&nbsp;know&nbsp;the&nbsp;composite&nbsp;literal&nbsp;type,&nbsp;it&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655553">//&nbsp;know&nbsp;if&nbsp;a&nbsp;key&nbsp;that&#39;s&nbsp;an&nbsp;identifier&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;name&nbsp;or&nbsp;a&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655625">//&nbsp;denoting&nbsp;a&nbsp;value.&nbsp;The&nbsp;former&nbsp;is&nbsp;not&nbsp;resolved&nbsp;by&nbsp;the&nbsp;parser&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655695">//&nbsp;resolver.</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655709">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655713">//&nbsp;Instead,&nbsp;_try_&nbsp;to&nbsp;resolve&nbsp;such&nbsp;a&nbsp;key&nbsp;if&nbsp;possible.&nbsp;If&nbsp;it&nbsp;resolves,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655783">//&nbsp;it&nbsp;a)&nbsp;has&nbsp;correctly&nbsp;resolved,&nbsp;or&nbsp;b)&nbsp;incorrectly&nbsp;resolved&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655852">//&nbsp;the&nbsp;key&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;matching&nbsp;another&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655923">//&nbsp;In&nbsp;the&nbsp;former&nbsp;case&nbsp;we&nbsp;are&nbsp;done,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;we&nbsp;don&#39;t</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655991">//&nbsp;care&nbsp;because&nbsp;the&nbsp;type&nbsp;checker&nbsp;will&nbsp;do&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656058">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656062">//&nbsp;If&nbsp;the&nbsp;key&nbsp;does&nbsp;not&nbsp;resolve,&nbsp;it&nbsp;a)&nbsp;must&nbsp;be&nbsp;defined&nbsp;at&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656128">//&nbsp;level&nbsp;in&nbsp;another&nbsp;file&nbsp;of&nbsp;the&nbsp;same&nbsp;package,&nbsp;the&nbsp;universe&nbsp;scope,&nbsp;or&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656201">//&nbsp;undeclared;&nbsp;or&nbsp;b)&nbsp;it&nbsp;is&nbsp;a&nbsp;struct&nbsp;field.&nbsp;In&nbsp;the&nbsp;former&nbsp;case,&nbsp;the&nbsp;type</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656274">//&nbsp;checker&nbsp;can&nbsp;do&nbsp;a&nbsp;top-level&nbsp;lookup,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;it&nbsp;will&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656347">//&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656376">x</span>&nbsp;<span class="op" id="5656378">:=</span>&nbsp;<span class="ident" id="5656381">p</span><span class="op" id="5656382">.</span><span class="ident" id="5656383">checkExpr</span><span class="op" id="5656392">(</span><span class="ident" id="5656393">p</span><span class="op" id="5656394">.</span><span class="ident" id="5656395">parseExpr</span><span class="op" id="5656404">(</span><span class="ident" id="5656405">keyOk</span><span class="op" id="5656410">)</span><span class="op" id="5656411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656414">if</span>&nbsp;<span class="ident" id="5656417">keyOk</span>&nbsp;<span class="op" id="5656423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656427">if</span>&nbsp;<span class="ident" id="5656430">p</span><span class="op" id="5656431">.</span><span class="ident" id="5656432">tok</span>&nbsp;<span class="op" id="5656436">==</span>&nbsp;<span class="ident" id="5656439">token</span><span class="op" id="5656444">.</span><span class="ident" id="5656445">COLON</span>&nbsp;<span class="op" id="5656451">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656456">colon</span>&nbsp;<span class="op" id="5656462">:=</span>&nbsp;<span class="ident" id="5656465">p</span><span class="op" id="5656466">.</span><span class="ident" id="5656467">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656474">p</span><span class="op" id="5656475">.</span><span class="ident" id="5656476">next</span><span class="op" id="5656480">(</span><span class="op" id="5656481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656486">//&nbsp;Try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;key&nbsp;but&nbsp;don&#39;t&nbsp;collect&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656536">//&nbsp;as&nbsp;unresolved&nbsp;identifier&nbsp;if&nbsp;it&nbsp;fails&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656587">//&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;(possibly&nbsp;false)&nbsp;errors&nbsp;about</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656636">//&nbsp;undeclared&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656660">p</span><span class="op" id="5656661">.</span><span class="ident" id="5656662">tryResolve</span><span class="op" id="5656672">(</span><span class="ident" id="5656673">x</span><span class="op" id="5656674">,</span>&nbsp;<span class="builtintype" id="5656676">false</span><span class="op" id="5656681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656686">return</span>&nbsp;<span class="op" id="5656693">&amp;</span><span class="ident" id="5656694">ast</span><span class="op" id="5656697">.</span><span class="ident" id="5656698">KeyValueExpr</span><span class="op" id="5656710">{</span><span class="ident" id="5656711">Key</span><span class="op" id="5656714">:</span>&nbsp;<span class="ident" id="5656716">x</span><span class="op" id="5656717">,</span>&nbsp;<span class="ident" id="5656719">Colon</span><span class="op" id="5656724">:</span>&nbsp;<span class="ident" id="5656726">colon</span><span class="op" id="5656731">,</span>&nbsp;<span class="ident" id="5656733">Value</span><span class="op" id="5656738">:</span>&nbsp;<span class="ident" id="5656740">p</span><span class="op" id="5656741">.</span><span class="ident" id="5656742">parseElement</span><span class="op" id="5656754">(</span><span class="builtintype" id="5656755">false</span><span class="op" id="5656760">)</span><span class="op" id="5656761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5656765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656769">p</span><span class="op" id="5656770">.</span><span class="ident" id="5656771">resolve</span><span class="op" id="5656778">(</span><span class="ident" id="5656779">x</span><span class="op" id="5656780">)</span>&nbsp;<span class="comment" id="5656782">//&nbsp;not&nbsp;a&nbsp;key</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5656796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656800">return</span>&nbsp;<span class="ident" id="5656807">x</span><br>
<span class="lineno"></span><span class="op" id="5656809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1305</span><span class="keyword" id="5656812">func</span>&nbsp;<span class="op" id="5656817">(</span><span class="ident" id="5656818">p</span>&nbsp;<span class="op" id="5656820">*</span><span class="ident" id="5656821">parser</span><span class="op" id="5656827">)</span>&nbsp;<span class="ident" id="5656829">parseElementList</span><span class="op" id="5656845">(</span><span class="op" id="5656846">)</span>&nbsp;<span class="op" id="5656848">(</span><span class="ident" id="5656849">list</span>&nbsp;<span class="op" id="5656854">[</span><span class="op" id="5656855">]</span><span class="ident" id="5656856">ast</span><span class="op" id="5656859">.</span><span class="ident" id="5656860">Expr</span><span class="op" id="5656864">)</span>&nbsp;<span class="op" id="5656866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656869">if</span>&nbsp;<span class="ident" id="5656872">p</span><span class="op" id="5656873">.</span><span class="ident" id="5656874">trace</span>&nbsp;<span class="op" id="5656880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656884">defer</span>&nbsp;<span class="ident" id="5656890">un</span><span class="op" id="5656892">(</span><span class="ident" id="5656893">trace</span><span class="op" id="5656898">(</span><span class="ident" id="5656899">p</span><span class="op" id="5656900">,</span>&nbsp;<span class="string" id="5656902">&#34;ElementList&#34;</span><span class="op" id="5656915">)</span><span class="op" id="5656916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5656919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656923">for</span>&nbsp;<span class="ident" id="5656927">p</span><span class="op" id="5656928">.</span><span class="ident" id="5656929">tok</span>&nbsp;<span class="op" id="5656933">!=</span>&nbsp;<span class="ident" id="5656936">token</span><span class="op" id="5656941">.</span><span class="ident" id="5656942">RBRACE</span>&nbsp;<span class="op" id="5656949">&amp;&amp;</span>&nbsp;<span class="ident" id="5656952">p</span><span class="op" id="5656953">.</span><span class="ident" id="5656954">tok</span>&nbsp;<span class="op" id="5656958">!=</span>&nbsp;<span class="ident" id="5656961">token</span><span class="op" id="5656966">.</span><span class="ident" id="5656967">EOF</span>&nbsp;<span class="op" id="5656971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656975">list</span>&nbsp;<span class="op" id="5656980">=</span>&nbsp;<span class="builtinfunc" id="5656982">append</span><span class="op" id="5656988">(</span><span class="ident" id="5656989">list</span><span class="op" id="5656993">,</span>&nbsp;<span class="ident" id="5656995">p</span><span class="op" id="5656996">.</span><span class="ident" id="5656997">parseElement</span><span class="op" id="5657009">(</span><span class="builtintype" id="5657010">true</span><span class="op" id="5657014">)</span><span class="op" id="5657015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657019">if</span>&nbsp;<span class="op" id="5657022">!</span><span class="ident" id="5657023">p</span><span class="op" id="5657024">.</span><span class="ident" id="5657025">atComma</span><span class="op" id="5657032">(</span><span class="string" id="5657033">&#34;composite&nbsp;literal&#34;</span><span class="op" id="5657052">)</span>&nbsp;<span class="op" id="5657054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657059">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5657067">}</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657071">p</span><span class="op" id="5657072">.</span><span class="ident" id="5657073">next</span><span class="op" id="5657077">(</span><span class="op" id="5657078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5657081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657085">return</span><br>
<span class="lineno"></span><span class="op" id="5657092">}</span><br>
<span class="lineno">1320</span><br>
<span class="lineno"></span><span class="keyword" id="5657095">func</span>&nbsp;<span class="op" id="5657100">(</span><span class="ident" id="5657101">p</span>&nbsp;<span class="op" id="5657103">*</span><span class="ident" id="5657104">parser</span><span class="op" id="5657110">)</span>&nbsp;<span class="ident" id="5657112">parseLiteralValue</span><span class="op" id="5657129">(</span><span class="ident" id="5657130">typ</span>&nbsp;<span class="ident" id="5657134">ast</span><span class="op" id="5657137">.</span><span class="ident" id="5657138">Expr</span><span class="op" id="5657142">)</span>&nbsp;<span class="ident" id="5657144">ast</span><span class="op" id="5657147">.</span><span class="ident" id="5657148">Expr</span>&nbsp;<span class="op" id="5657153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657156">if</span>&nbsp;<span class="ident" id="5657159">p</span><span class="op" id="5657160">.</span><span class="ident" id="5657161">trace</span>&nbsp;<span class="op" id="5657167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657171">defer</span>&nbsp;<span class="ident" id="5657177">un</span><span class="op" id="5657179">(</span><span class="ident" id="5657180">trace</span><span class="op" id="5657185">(</span><span class="ident" id="5657186">p</span><span class="op" id="5657187">,</span>&nbsp;<span class="string" id="5657189">&#34;LiteralValue&#34;</span><span class="op" id="5657203">)</span><span class="op" id="5657204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5657207">}</span><br>
<span class="lineno">1325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657211">lbrace</span>&nbsp;<span class="op" id="5657218">:=</span>&nbsp;<span class="ident" id="5657221">p</span><span class="op" id="5657222">.</span><span class="ident" id="5657223">expect</span><span class="op" id="5657229">(</span><span class="ident" id="5657230">token</span><span class="op" id="5657235">.</span><span class="ident" id="5657236">LBRACE</span><span class="op" id="5657242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657245">var</span>&nbsp;<span class="ident" id="5657249">elts</span>&nbsp;<span class="op" id="5657254">[</span><span class="op" id="5657255">]</span><span class="ident" id="5657256">ast</span><span class="op" id="5657259">.</span><span class="ident" id="5657260">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657266">p</span><span class="op" id="5657267">.</span><span class="ident" id="5657268">exprLev</span><span class="op" id="5657275">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657279">if</span>&nbsp;<span class="ident" id="5657282">p</span><span class="op" id="5657283">.</span><span class="ident" id="5657284">tok</span>&nbsp;<span class="op" id="5657288">!=</span>&nbsp;<span class="ident" id="5657291">token</span><span class="op" id="5657296">.</span><span class="ident" id="5657297">RBRACE</span>&nbsp;<span class="op" id="5657304">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657308">elts</span>&nbsp;<span class="op" id="5657313">=</span>&nbsp;<span class="ident" id="5657315">p</span><span class="op" id="5657316">.</span><span class="ident" id="5657317">parseElementList</span><span class="op" id="5657333">(</span><span class="op" id="5657334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5657337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657340">p</span><span class="op" id="5657341">.</span><span class="ident" id="5657342">exprLev</span><span class="op" id="5657349">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657353">rbrace</span>&nbsp;<span class="op" id="5657360">:=</span>&nbsp;<span class="ident" id="5657363">p</span><span class="op" id="5657364">.</span><span class="ident" id="5657365">expectClosing</span><span class="op" id="5657378">(</span><span class="ident" id="5657379">token</span><span class="op" id="5657384">.</span><span class="ident" id="5657385">RBRACE</span><span class="op" id="5657391">,</span>&nbsp;<span class="string" id="5657393">&#34;composite&nbsp;literal&#34;</span><span class="op" id="5657412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657415">return</span>&nbsp;<span class="op" id="5657422">&amp;</span><span class="ident" id="5657423">ast</span><span class="op" id="5657426">.</span><span class="ident" id="5657427">CompositeLit</span><span class="op" id="5657439">{</span><span class="ident" id="5657440">Type</span><span class="op" id="5657444">:</span>&nbsp;<span class="ident" id="5657446">typ</span><span class="op" id="5657449">,</span>&nbsp;<span class="ident" id="5657451">Lbrace</span><span class="op" id="5657457">:</span>&nbsp;<span class="ident" id="5657459">lbrace</span><span class="op" id="5657465">,</span>&nbsp;<span class="ident" id="5657467">Elts</span><span class="op" id="5657471">:</span>&nbsp;<span class="ident" id="5657473">elts</span><span class="op" id="5657477">,</span>&nbsp;<span class="ident" id="5657479">Rbrace</span><span class="op" id="5657485">:</span>&nbsp;<span class="ident" id="5657487">rbrace</span><span class="op" id="5657493">}</span><br>
<span class="lineno">1335</span><span class="op" id="5657495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5657498">//&nbsp;checkExpr&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;(and&nbsp;not&nbsp;a&nbsp;type).</span><br>
<span class="lineno"></span><span class="keyword" id="5657560">func</span>&nbsp;<span class="op" id="5657565">(</span><span class="ident" id="5657566">p</span>&nbsp;<span class="op" id="5657568">*</span><span class="ident" id="5657569">parser</span><span class="op" id="5657575">)</span>&nbsp;<span class="ident" id="5657577">checkExpr</span><span class="op" id="5657586">(</span><span class="ident" id="5657587">x</span>&nbsp;<span class="ident" id="5657589">ast</span><span class="op" id="5657592">.</span><span class="ident" id="5657593">Expr</span><span class="op" id="5657597">)</span>&nbsp;<span class="ident" id="5657599">ast</span><span class="op" id="5657602">.</span><span class="ident" id="5657603">Expr</span>&nbsp;<span class="op" id="5657608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657611">switch</span>&nbsp;<span class="ident" id="5657618">unparen</span><span class="op" id="5657625">(</span><span class="ident" id="5657626">x</span><span class="op" id="5657627">)</span><span class="op" id="5657628">.</span><span class="op" id="5657629">(</span><span class="keyword" id="5657630">type</span><span class="op" id="5657634">)</span>&nbsp;<span class="op" id="5657636">{</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657639">case</span>&nbsp;<span class="op" id="5657644">*</span><span class="ident" id="5657645">ast</span><span class="op" id="5657648">.</span><span class="ident" id="5657649">BadExpr</span><span class="op" id="5657656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657659">case</span>&nbsp;<span class="op" id="5657664">*</span><span class="ident" id="5657665">ast</span><span class="op" id="5657668">.</span><span class="ident" id="5657669">Ident</span><span class="op" id="5657674">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657677">case</span>&nbsp;<span class="op" id="5657682">*</span><span class="ident" id="5657683">ast</span><span class="op" id="5657686">.</span><span class="ident" id="5657687">BasicLit</span><span class="op" id="5657695">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657698">case</span>&nbsp;<span class="op" id="5657703">*</span><span class="ident" id="5657704">ast</span><span class="op" id="5657707">.</span><span class="ident" id="5657708">FuncLit</span><span class="op" id="5657715">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657718">case</span>&nbsp;<span class="op" id="5657723">*</span><span class="ident" id="5657724">ast</span><span class="op" id="5657727">.</span><span class="ident" id="5657728">CompositeLit</span><span class="op" id="5657740">:</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657743">case</span>&nbsp;<span class="op" id="5657748">*</span><span class="ident" id="5657749">ast</span><span class="op" id="5657752">.</span><span class="ident" id="5657753">ParenExpr</span><span class="op" id="5657762">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5657766">panic</span><span class="op" id="5657771">(</span><span class="string" id="5657772">&#34;unreachable&#34;</span><span class="op" id="5657785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657788">case</span>&nbsp;<span class="op" id="5657793">*</span><span class="ident" id="5657794">ast</span><span class="op" id="5657797">.</span><span class="ident" id="5657798">SelectorExpr</span><span class="op" id="5657810">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657813">case</span>&nbsp;<span class="op" id="5657818">*</span><span class="ident" id="5657819">ast</span><span class="op" id="5657822">.</span><span class="ident" id="5657823">IndexExpr</span><span class="op" id="5657832">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657835">case</span>&nbsp;<span class="op" id="5657840">*</span><span class="ident" id="5657841">ast</span><span class="op" id="5657844">.</span><span class="ident" id="5657845">SliceExpr</span><span class="op" id="5657854">:</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657857">case</span>&nbsp;<span class="op" id="5657862">*</span><span class="ident" id="5657863">ast</span><span class="op" id="5657866">.</span><span class="ident" id="5657867">TypeAssertExpr</span><span class="op" id="5657881">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5657885">//&nbsp;If&nbsp;t.Type&nbsp;==&nbsp;nil&nbsp;we&nbsp;have&nbsp;a&nbsp;type&nbsp;assertion&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5657944">//&nbsp;y.(type),&nbsp;which&nbsp;is&nbsp;only&nbsp;allowed&nbsp;in&nbsp;type&nbsp;switch&nbsp;expressions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5658009">//&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;exclude&nbsp;those&nbsp;but&nbsp;for&nbsp;the&nbsp;case&nbsp;where&nbsp;we&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5658074">//&nbsp;a&nbsp;type&nbsp;switch.&nbsp;Instead&nbsp;be&nbsp;lenient&nbsp;and&nbsp;test&nbsp;this&nbsp;in&nbsp;the&nbsp;type</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5658139">//&nbsp;checker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658152">case</span>&nbsp;<span class="op" id="5658157">*</span><span class="ident" id="5658158">ast</span><span class="op" id="5658161">.</span><span class="ident" id="5658162">CallExpr</span><span class="op" id="5658170">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658173">case</span>&nbsp;<span class="op" id="5658178">*</span><span class="ident" id="5658179">ast</span><span class="op" id="5658182">.</span><span class="ident" id="5658183">StarExpr</span><span class="op" id="5658191">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658194">case</span>&nbsp;<span class="op" id="5658199">*</span><span class="ident" id="5658200">ast</span><span class="op" id="5658203">.</span><span class="ident" id="5658204">UnaryExpr</span><span class="op" id="5658213">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658216">case</span>&nbsp;<span class="op" id="5658221">*</span><span class="ident" id="5658222">ast</span><span class="op" id="5658225">.</span><span class="ident" id="5658226">BinaryExpr</span><span class="op" id="5658236">:</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658239">default</span><span class="op" id="5658246">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5658250">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;proper&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5658298">p</span><span class="op" id="5658299">.</span><span class="ident" id="5658300">errorExpected</span><span class="op" id="5658313">(</span><span class="ident" id="5658314">x</span><span class="op" id="5658315">.</span><span class="ident" id="5658316">Pos</span><span class="op" id="5658319">(</span><span class="op" id="5658320">)</span><span class="op" id="5658321">,</span>&nbsp;<span class="string" id="5658323">&#34;expression&#34;</span><span class="op" id="5658335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5658339">x</span>&nbsp;<span class="op" id="5658341">=</span>&nbsp;<span class="op" id="5658343">&amp;</span><span class="ident" id="5658344">ast</span><span class="op" id="5658347">.</span><span class="ident" id="5658348">BadExpr</span><span class="op" id="5658355">{</span><span class="ident" id="5658356">From</span><span class="op" id="5658360">:</span>&nbsp;<span class="ident" id="5658362">x</span><span class="op" id="5658363">.</span><span class="ident" id="5658364">Pos</span><span class="op" id="5658367">(</span><span class="op" id="5658368">)</span><span class="op" id="5658369">,</span>&nbsp;<span class="ident" id="5658371">To</span><span class="op" id="5658373">:</span>&nbsp;<span class="ident" id="5658375">p</span><span class="op" id="5658376">.</span><span class="ident" id="5658377">safePos</span><span class="op" id="5658384">(</span><span class="ident" id="5658385">x</span><span class="op" id="5658386">.</span><span class="ident" id="5658387">End</span><span class="op" id="5658390">(</span><span class="op" id="5658391">)</span><span class="op" id="5658392">)</span><span class="op" id="5658393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5658396">}</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658399">return</span>&nbsp;<span class="ident" id="5658406">x</span><br>
<span class="lineno"></span><span class="op" id="5658408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5658411">//&nbsp;isTypeName&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;(qualified)&nbsp;TypeName.</span><br>
<span class="lineno"></span><span class="keyword" id="5658471">func</span>&nbsp;<span class="ident" id="5658476">isTypeName</span><span class="op" id="5658486">(</span><span class="ident" id="5658487">x</span>&nbsp;<span class="ident" id="5658489">ast</span><span class="op" id="5658492">.</span><span class="ident" id="5658493">Expr</span><span class="op" id="5658497">)</span>&nbsp;<span class="builtintype" id="5658499">bool</span>&nbsp;<span class="op" id="5658504">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658507">switch</span>&nbsp;<span class="ident" id="5658514">t</span>&nbsp;<span class="op" id="5658516">:=</span>&nbsp;<span class="ident" id="5658519">x</span><span class="op" id="5658520">.</span><span class="op" id="5658521">(</span><span class="keyword" id="5658522">type</span><span class="op" id="5658526">)</span>&nbsp;<span class="op" id="5658528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658531">case</span>&nbsp;<span class="op" id="5658536">*</span><span class="ident" id="5658537">ast</span><span class="op" id="5658540">.</span><span class="ident" id="5658541">BadExpr</span><span class="op" id="5658548">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658551">case</span>&nbsp;<span class="op" id="5658556">*</span><span class="ident" id="5658557">ast</span><span class="op" id="5658560">.</span><span class="ident" id="5658561">Ident</span><span class="op" id="5658566">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658569">case</span>&nbsp;<span class="op" id="5658574">*</span><span class="ident" id="5658575">ast</span><span class="op" id="5658578">.</span><span class="ident" id="5658579">SelectorExpr</span><span class="op" id="5658591">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5658595">_</span><span class="op" id="5658596">,</span>&nbsp;<span class="ident" id="5658598">isIdent</span>&nbsp;<span class="op" id="5658606">:=</span>&nbsp;<span class="ident" id="5658609">t</span><span class="op" id="5658610">.</span><span class="ident" id="5658611">X</span><span class="op" id="5658612">.</span><span class="op" id="5658613">(</span><span class="op" id="5658614">*</span><span class="ident" id="5658615">ast</span><span class="op" id="5658618">.</span><span class="ident" id="5658619">Ident</span><span class="op" id="5658624">)</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658628">return</span>&nbsp;<span class="ident" id="5658635">isIdent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658644">default</span><span class="op" id="5658651">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658655">return</span>&nbsp;<span class="builtintype" id="5658662">false</span>&nbsp;<span class="comment" id="5658668">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5658707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658710">return</span>&nbsp;<span class="builtintype" id="5658717">true</span><br>
<span class="lineno">1380</span><span class="op" id="5658722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5658725">//&nbsp;isLiteralType&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5658796">func</span>&nbsp;<span class="ident" id="5658801">isLiteralType</span><span class="op" id="5658814">(</span><span class="ident" id="5658815">x</span>&nbsp;<span class="ident" id="5658817">ast</span><span class="op" id="5658820">.</span><span class="ident" id="5658821">Expr</span><span class="op" id="5658825">)</span>&nbsp;<span class="builtintype" id="5658827">bool</span>&nbsp;<span class="op" id="5658832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658835">switch</span>&nbsp;<span class="ident" id="5658842">t</span>&nbsp;<span class="op" id="5658844">:=</span>&nbsp;<span class="ident" id="5658847">x</span><span class="op" id="5658848">.</span><span class="op" id="5658849">(</span><span class="keyword" id="5658850">type</span><span class="op" id="5658854">)</span>&nbsp;<span class="op" id="5658856">{</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658859">case</span>&nbsp;<span class="op" id="5658864">*</span><span class="ident" id="5658865">ast</span><span class="op" id="5658868">.</span><span class="ident" id="5658869">BadExpr</span><span class="op" id="5658876">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658879">case</span>&nbsp;<span class="op" id="5658884">*</span><span class="ident" id="5658885">ast</span><span class="op" id="5658888">.</span><span class="ident" id="5658889">Ident</span><span class="op" id="5658894">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658897">case</span>&nbsp;<span class="op" id="5658902">*</span><span class="ident" id="5658903">ast</span><span class="op" id="5658906">.</span><span class="ident" id="5658907">SelectorExpr</span><span class="op" id="5658919">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5658923">_</span><span class="op" id="5658924">,</span>&nbsp;<span class="ident" id="5658926">isIdent</span>&nbsp;<span class="op" id="5658934">:=</span>&nbsp;<span class="ident" id="5658937">t</span><span class="op" id="5658938">.</span><span class="ident" id="5658939">X</span><span class="op" id="5658940">.</span><span class="op" id="5658941">(</span><span class="op" id="5658942">*</span><span class="ident" id="5658943">ast</span><span class="op" id="5658946">.</span><span class="ident" id="5658947">Ident</span><span class="op" id="5658952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658956">return</span>&nbsp;<span class="ident" id="5658963">isIdent</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658972">case</span>&nbsp;<span class="op" id="5658977">*</span><span class="ident" id="5658978">ast</span><span class="op" id="5658981">.</span><span class="ident" id="5658982">ArrayType</span><span class="op" id="5658991">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658994">case</span>&nbsp;<span class="op" id="5658999">*</span><span class="ident" id="5659000">ast</span><span class="op" id="5659003">.</span><span class="ident" id="5659004">StructType</span><span class="op" id="5659014">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659017">case</span>&nbsp;<span class="op" id="5659022">*</span><span class="ident" id="5659023">ast</span><span class="op" id="5659026">.</span><span class="ident" id="5659027">MapType</span><span class="op" id="5659034">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659037">default</span><span class="op" id="5659044">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659048">return</span>&nbsp;<span class="builtintype" id="5659055">false</span>&nbsp;<span class="comment" id="5659061">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;types</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659122">return</span>&nbsp;<span class="builtintype" id="5659129">true</span><br>
<span class="lineno"></span><span class="op" id="5659134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5659137">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;*T,&nbsp;deref&nbsp;returns&nbsp;T,&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno">1400</span><span class="keyword" id="5659205">func</span>&nbsp;<span class="ident" id="5659210">deref</span><span class="op" id="5659215">(</span><span class="ident" id="5659216">x</span>&nbsp;<span class="ident" id="5659218">ast</span><span class="op" id="5659221">.</span><span class="ident" id="5659222">Expr</span><span class="op" id="5659226">)</span>&nbsp;<span class="ident" id="5659228">ast</span><span class="op" id="5659231">.</span><span class="ident" id="5659232">Expr</span>&nbsp;<span class="op" id="5659237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659240">if</span>&nbsp;<span class="ident" id="5659243">p</span><span class="op" id="5659244">,</span>&nbsp;<span class="ident" id="5659246">isPtr</span>&nbsp;<span class="op" id="5659252">:=</span>&nbsp;<span class="ident" id="5659255">x</span><span class="op" id="5659256">.</span><span class="op" id="5659257">(</span><span class="op" id="5659258">*</span><span class="ident" id="5659259">ast</span><span class="op" id="5659262">.</span><span class="ident" id="5659263">StarExpr</span><span class="op" id="5659271">)</span><span class="op" id="5659272">;</span>&nbsp;<span class="ident" id="5659274">isPtr</span>&nbsp;<span class="op" id="5659280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659284">x</span>&nbsp;<span class="op" id="5659286">=</span>&nbsp;<span class="ident" id="5659288">p</span><span class="op" id="5659289">.</span><span class="ident" id="5659290">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659296">return</span>&nbsp;<span class="ident" id="5659303">x</span><br>
<span class="lineno">1405</span><span class="op" id="5659305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5659308">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;(T),&nbsp;unparen&nbsp;returns&nbsp;unparen(T),&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="5659388">func</span>&nbsp;<span class="ident" id="5659393">unparen</span><span class="op" id="5659400">(</span><span class="ident" id="5659401">x</span>&nbsp;<span class="ident" id="5659403">ast</span><span class="op" id="5659406">.</span><span class="ident" id="5659407">Expr</span><span class="op" id="5659411">)</span>&nbsp;<span class="ident" id="5659413">ast</span><span class="op" id="5659416">.</span><span class="ident" id="5659417">Expr</span>&nbsp;<span class="op" id="5659422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659425">if</span>&nbsp;<span class="ident" id="5659428">p</span><span class="op" id="5659429">,</span>&nbsp;<span class="ident" id="5659431">isParen</span>&nbsp;<span class="op" id="5659439">:=</span>&nbsp;<span class="ident" id="5659442">x</span><span class="op" id="5659443">.</span><span class="op" id="5659444">(</span><span class="op" id="5659445">*</span><span class="ident" id="5659446">ast</span><span class="op" id="5659449">.</span><span class="ident" id="5659450">ParenExpr</span><span class="op" id="5659459">)</span><span class="op" id="5659460">;</span>&nbsp;<span class="ident" id="5659462">isParen</span>&nbsp;<span class="op" id="5659470">{</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659474">x</span>&nbsp;<span class="op" id="5659476">=</span>&nbsp;<span class="ident" id="5659478">unparen</span><span class="op" id="5659485">(</span><span class="ident" id="5659486">p</span><span class="op" id="5659487">.</span><span class="ident" id="5659488">X</span><span class="op" id="5659489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659495">return</span>&nbsp;<span class="ident" id="5659502">x</span><br>
<span class="lineno"></span><span class="op" id="5659504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1415</span><span class="comment" id="5659507">//&nbsp;checkExprOrType&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5659567">//&nbsp;(and&nbsp;not&nbsp;a&nbsp;raw&nbsp;type&nbsp;such&nbsp;as&nbsp;[...]T).</span><br>
<span class="lineno"></span><span class="comment" id="5659607">//</span><br>
<span class="lineno"></span><span class="keyword" id="5659610">func</span>&nbsp;<span class="op" id="5659615">(</span><span class="ident" id="5659616">p</span>&nbsp;<span class="op" id="5659618">*</span><span class="ident" id="5659619">parser</span><span class="op" id="5659625">)</span>&nbsp;<span class="ident" id="5659627">checkExprOrType</span><span class="op" id="5659642">(</span><span class="ident" id="5659643">x</span>&nbsp;<span class="ident" id="5659645">ast</span><span class="op" id="5659648">.</span><span class="ident" id="5659649">Expr</span><span class="op" id="5659653">)</span>&nbsp;<span class="ident" id="5659655">ast</span><span class="op" id="5659658">.</span><span class="ident" id="5659659">Expr</span>&nbsp;<span class="op" id="5659664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659667">switch</span>&nbsp;<span class="ident" id="5659674">t</span>&nbsp;<span class="op" id="5659676">:=</span>&nbsp;<span class="ident" id="5659679">unparen</span><span class="op" id="5659686">(</span><span class="ident" id="5659687">x</span><span class="op" id="5659688">)</span><span class="op" id="5659689">.</span><span class="op" id="5659690">(</span><span class="keyword" id="5659691">type</span><span class="op" id="5659695">)</span>&nbsp;<span class="op" id="5659697">{</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659700">case</span>&nbsp;<span class="op" id="5659705">*</span><span class="ident" id="5659706">ast</span><span class="op" id="5659709">.</span><span class="ident" id="5659710">ParenExpr</span><span class="op" id="5659719">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5659723">panic</span><span class="op" id="5659728">(</span><span class="string" id="5659729">&#34;unreachable&#34;</span><span class="op" id="5659742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659745">case</span>&nbsp;<span class="op" id="5659750">*</span><span class="ident" id="5659751">ast</span><span class="op" id="5659754">.</span><span class="ident" id="5659755">UnaryExpr</span><span class="op" id="5659764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659767">case</span>&nbsp;<span class="op" id="5659772">*</span><span class="ident" id="5659773">ast</span><span class="op" id="5659776">.</span><span class="ident" id="5659777">ArrayType</span><span class="op" id="5659786">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659790">if</span>&nbsp;<span class="builtinfunc" id="5659793">len</span><span class="op" id="5659796">,</span>&nbsp;<span class="ident" id="5659798">isEllipsis</span>&nbsp;<span class="op" id="5659809">:=</span>&nbsp;<span class="ident" id="5659812">t</span><span class="op" id="5659813">.</span><span class="ident" id="5659814">Len</span><span class="op" id="5659817">.</span><span class="op" id="5659818">(</span><span class="op" id="5659819">*</span><span class="ident" id="5659820">ast</span><span class="op" id="5659823">.</span><span class="ident" id="5659824">Ellipsis</span><span class="op" id="5659832">)</span><span class="op" id="5659833">;</span>&nbsp;<span class="ident" id="5659835">isEllipsis</span>&nbsp;<span class="op" id="5659846">{</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659851">p</span><span class="op" id="5659852">.</span><span class="builtintype" id="5659853">error</span><span class="op" id="5659858">(</span><span class="builtinfunc" id="5659859">len</span><span class="op" id="5659862">.</span><span class="ident" id="5659863">Pos</span><span class="op" id="5659866">(</span><span class="op" id="5659867">)</span><span class="op" id="5659868">,</span>&nbsp;<span class="string" id="5659870">&#34;expected&nbsp;array&nbsp;length,&nbsp;found&nbsp;&#39;...&#39;&#34;</span><span class="op" id="5659906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659911">x</span>&nbsp;<span class="op" id="5659913">=</span>&nbsp;<span class="op" id="5659915">&amp;</span><span class="ident" id="5659916">ast</span><span class="op" id="5659919">.</span><span class="ident" id="5659920">BadExpr</span><span class="op" id="5659927">{</span><span class="ident" id="5659928">From</span><span class="op" id="5659932">:</span>&nbsp;<span class="ident" id="5659934">x</span><span class="op" id="5659935">.</span><span class="ident" id="5659936">Pos</span><span class="op" id="5659939">(</span><span class="op" id="5659940">)</span><span class="op" id="5659941">,</span>&nbsp;<span class="ident" id="5659943">To</span><span class="op" id="5659945">:</span>&nbsp;<span class="ident" id="5659947">p</span><span class="op" id="5659948">.</span><span class="ident" id="5659949">safePos</span><span class="op" id="5659956">(</span><span class="ident" id="5659957">x</span><span class="op" id="5659958">.</span><span class="ident" id="5659959">End</span><span class="op" id="5659962">(</span><span class="op" id="5659963">)</span><span class="op" id="5659964">)</span><span class="op" id="5659965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5659976">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;expressions&nbsp;or&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660021">return</span>&nbsp;<span class="ident" id="5660028">x</span><br>
<span class="lineno"></span><span class="op" id="5660030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5660033">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1435</span><span class="keyword" id="5660103">func</span>&nbsp;<span class="op" id="5660108">(</span><span class="ident" id="5660109">p</span>&nbsp;<span class="op" id="5660111">*</span><span class="ident" id="5660112">parser</span><span class="op" id="5660118">)</span>&nbsp;<span class="ident" id="5660120">parsePrimaryExpr</span><span class="op" id="5660136">(</span><span class="ident" id="5660137">lhs</span>&nbsp;<span class="builtintype" id="5660141">bool</span><span class="op" id="5660145">)</span>&nbsp;<span class="ident" id="5660147">ast</span><span class="op" id="5660150">.</span><span class="ident" id="5660151">Expr</span>&nbsp;<span class="op" id="5660156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660159">if</span>&nbsp;<span class="ident" id="5660162">p</span><span class="op" id="5660163">.</span><span class="ident" id="5660164">trace</span>&nbsp;<span class="op" id="5660170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660174">defer</span>&nbsp;<span class="ident" id="5660180">un</span><span class="op" id="5660182">(</span><span class="ident" id="5660183">trace</span><span class="op" id="5660188">(</span><span class="ident" id="5660189">p</span><span class="op" id="5660190">,</span>&nbsp;<span class="string" id="5660192">&#34;PrimaryExpr&#34;</span><span class="op" id="5660205">)</span><span class="op" id="5660206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5660209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660213">x</span>&nbsp;<span class="op" id="5660215">:=</span>&nbsp;<span class="ident" id="5660218">p</span><span class="op" id="5660219">.</span><span class="ident" id="5660220">parseOperand</span><span class="op" id="5660232">(</span><span class="ident" id="5660233">lhs</span><span class="op" id="5660236">)</span><br>
<span class="lineno"></span><span class="ident" id="5660238">L</span><span class="op" id="5660239">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660242">for</span>&nbsp;<span class="op" id="5660246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660250">switch</span>&nbsp;<span class="ident" id="5660257">p</span><span class="op" id="5660258">.</span><span class="ident" id="5660259">tok</span>&nbsp;<span class="op" id="5660263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660267">case</span>&nbsp;<span class="ident" id="5660272">token</span><span class="op" id="5660277">.</span><span class="ident" id="5660278">PERIOD</span><span class="op" id="5660284">:</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660289">p</span><span class="op" id="5660290">.</span><span class="ident" id="5660291">next</span><span class="op" id="5660295">(</span><span class="op" id="5660296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660301">if</span>&nbsp;<span class="ident" id="5660304">lhs</span>&nbsp;<span class="op" id="5660308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660314">p</span><span class="op" id="5660315">.</span><span class="ident" id="5660316">resolve</span><span class="op" id="5660323">(</span><span class="ident" id="5660324">x</span><span class="op" id="5660325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5660330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660335">switch</span>&nbsp;<span class="ident" id="5660342">p</span><span class="op" id="5660343">.</span><span class="ident" id="5660344">tok</span>&nbsp;<span class="op" id="5660348">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660353">case</span>&nbsp;<span class="ident" id="5660358">token</span><span class="op" id="5660363">.</span><span class="ident" id="5660364">IDENT</span><span class="op" id="5660369">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660375">x</span>&nbsp;<span class="op" id="5660377">=</span>&nbsp;<span class="ident" id="5660379">p</span><span class="op" id="5660380">.</span><span class="ident" id="5660381">parseSelector</span><span class="op" id="5660394">(</span><span class="ident" id="5660395">p</span><span class="op" id="5660396">.</span><span class="ident" id="5660397">checkExprOrType</span><span class="op" id="5660412">(</span><span class="ident" id="5660413">x</span><span class="op" id="5660414">)</span><span class="op" id="5660415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660420">case</span>&nbsp;<span class="ident" id="5660425">token</span><span class="op" id="5660430">.</span><span class="ident" id="5660431">LPAREN</span><span class="op" id="5660437">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660443">x</span>&nbsp;<span class="op" id="5660445">=</span>&nbsp;<span class="ident" id="5660447">p</span><span class="op" id="5660448">.</span><span class="ident" id="5660449">parseTypeAssertion</span><span class="op" id="5660467">(</span><span class="ident" id="5660468">p</span><span class="op" id="5660469">.</span><span class="ident" id="5660470">checkExpr</span><span class="op" id="5660479">(</span><span class="ident" id="5660480">x</span><span class="op" id="5660481">)</span><span class="op" id="5660482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660487">default</span><span class="op" id="5660494">:</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660500">pos</span>&nbsp;<span class="op" id="5660504">:=</span>&nbsp;<span class="ident" id="5660507">p</span><span class="op" id="5660508">.</span><span class="ident" id="5660509">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660517">p</span><span class="op" id="5660518">.</span><span class="ident" id="5660519">errorExpected</span><span class="op" id="5660532">(</span><span class="ident" id="5660533">pos</span><span class="op" id="5660536">,</span>&nbsp;<span class="string" id="5660538">&#34;selector&nbsp;or&nbsp;type&nbsp;assertion&#34;</span><span class="op" id="5660566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660572">p</span><span class="op" id="5660573">.</span><span class="ident" id="5660574">next</span><span class="op" id="5660578">(</span><span class="op" id="5660579">)</span>&nbsp;<span class="comment" id="5660581">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660602">x</span>&nbsp;<span class="op" id="5660604">=</span>&nbsp;<span class="op" id="5660606">&amp;</span><span class="ident" id="5660607">ast</span><span class="op" id="5660610">.</span><span class="ident" id="5660611">BadExpr</span><span class="op" id="5660618">{</span><span class="ident" id="5660619">From</span><span class="op" id="5660623">:</span>&nbsp;<span class="ident" id="5660625">pos</span><span class="op" id="5660628">,</span>&nbsp;<span class="ident" id="5660630">To</span><span class="op" id="5660632">:</span>&nbsp;<span class="ident" id="5660634">p</span><span class="op" id="5660635">.</span><span class="ident" id="5660636">pos</span><span class="op" id="5660639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5660644">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660648">case</span>&nbsp;<span class="ident" id="5660653">token</span><span class="op" id="5660658">.</span><span class="ident" id="5660659">LBRACK</span><span class="op" id="5660665">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660670">if</span>&nbsp;<span class="ident" id="5660673">lhs</span>&nbsp;<span class="op" id="5660677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660683">p</span><span class="op" id="5660684">.</span><span class="ident" id="5660685">resolve</span><span class="op" id="5660692">(</span><span class="ident" id="5660693">x</span><span class="op" id="5660694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5660699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660704">x</span>&nbsp;<span class="op" id="5660706">=</span>&nbsp;<span class="ident" id="5660708">p</span><span class="op" id="5660709">.</span><span class="ident" id="5660710">parseIndexOrSlice</span><span class="op" id="5660727">(</span><span class="ident" id="5660728">p</span><span class="op" id="5660729">.</span><span class="ident" id="5660730">checkExpr</span><span class="op" id="5660739">(</span><span class="ident" id="5660740">x</span><span class="op" id="5660741">)</span><span class="op" id="5660742">)</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660746">case</span>&nbsp;<span class="ident" id="5660751">token</span><span class="op" id="5660756">.</span><span class="ident" id="5660757">LPAREN</span><span class="op" id="5660763">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660768">if</span>&nbsp;<span class="ident" id="5660771">lhs</span>&nbsp;<span class="op" id="5660775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660781">p</span><span class="op" id="5660782">.</span><span class="ident" id="5660783">resolve</span><span class="op" id="5660790">(</span><span class="ident" id="5660791">x</span><span class="op" id="5660792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5660797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660802">x</span>&nbsp;<span class="op" id="5660804">=</span>&nbsp;<span class="ident" id="5660806">p</span><span class="op" id="5660807">.</span><span class="ident" id="5660808">parseCallOrConversion</span><span class="op" id="5660829">(</span><span class="ident" id="5660830">p</span><span class="op" id="5660831">.</span><span class="ident" id="5660832">checkExprOrType</span><span class="op" id="5660847">(</span><span class="ident" id="5660848">x</span><span class="op" id="5660849">)</span><span class="op" id="5660850">)</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660854">case</span>&nbsp;<span class="ident" id="5660859">token</span><span class="op" id="5660864">.</span><span class="ident" id="5660865">LBRACE</span><span class="op" id="5660871">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660876">if</span>&nbsp;<span class="ident" id="5660879">isLiteralType</span><span class="op" id="5660892">(</span><span class="ident" id="5660893">x</span><span class="op" id="5660894">)</span>&nbsp;<span class="op" id="5660896">&amp;&amp;</span>&nbsp;<span class="op" id="5660899">(</span><span class="ident" id="5660900">p</span><span class="op" id="5660901">.</span><span class="ident" id="5660902">exprLev</span>&nbsp;<span class="op" id="5660910">&gt;=</span>&nbsp;<span class="num" id="5660913">0</span>&nbsp;<span class="op" id="5660915">||</span>&nbsp;<span class="op" id="5660918">!</span><span class="ident" id="5660919">isTypeName</span><span class="op" id="5660929">(</span><span class="ident" id="5660930">x</span><span class="op" id="5660931">)</span><span class="op" id="5660932">)</span>&nbsp;<span class="op" id="5660934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660940">if</span>&nbsp;<span class="ident" id="5660943">lhs</span>&nbsp;<span class="op" id="5660947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660954">p</span><span class="op" id="5660955">.</span><span class="ident" id="5660956">resolve</span><span class="op" id="5660963">(</span><span class="ident" id="5660964">x</span><span class="op" id="5660965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5660971">}</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660977">x</span>&nbsp;<span class="op" id="5660979">=</span>&nbsp;<span class="ident" id="5660981">p</span><span class="op" id="5660982">.</span><span class="ident" id="5660983">parseLiteralValue</span><span class="op" id="5661000">(</span><span class="ident" id="5661001">x</span><span class="op" id="5661002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5661007">}</span>&nbsp;<span class="keyword" id="5661009">else</span>&nbsp;<span class="op" id="5661014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661020">break</span>&nbsp;<span class="ident" id="5661026">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5661031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661035">default</span><span class="op" id="5661042">:</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661047">break</span>&nbsp;<span class="ident" id="5661053">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5661057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661061">lhs</span>&nbsp;<span class="op" id="5661065">=</span>&nbsp;<span class="builtintype" id="5661067">false</span>&nbsp;<span class="comment" id="5661073">//&nbsp;no&nbsp;need&nbsp;to&nbsp;try&nbsp;to&nbsp;resolve&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5661109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661113">return</span>&nbsp;<span class="ident" id="5661120">x</span><br>
<span class="lineno"></span><span class="op" id="5661122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5661125">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5661195">func</span>&nbsp;<span class="op" id="5661200">(</span><span class="ident" id="5661201">p</span>&nbsp;<span class="op" id="5661203">*</span><span class="ident" id="5661204">parser</span><span class="op" id="5661210">)</span>&nbsp;<span class="ident" id="5661212">parseUnaryExpr</span><span class="op" id="5661226">(</span><span class="ident" id="5661227">lhs</span>&nbsp;<span class="builtintype" id="5661231">bool</span><span class="op" id="5661235">)</span>&nbsp;<span class="ident" id="5661237">ast</span><span class="op" id="5661240">.</span><span class="ident" id="5661241">Expr</span>&nbsp;<span class="op" id="5661246">{</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661249">if</span>&nbsp;<span class="ident" id="5661252">p</span><span class="op" id="5661253">.</span><span class="ident" id="5661254">trace</span>&nbsp;<span class="op" id="5661260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661264">defer</span>&nbsp;<span class="ident" id="5661270">un</span><span class="op" id="5661272">(</span><span class="ident" id="5661273">trace</span><span class="op" id="5661278">(</span><span class="ident" id="5661279">p</span><span class="op" id="5661280">,</span>&nbsp;<span class="string" id="5661282">&#34;UnaryExpr&#34;</span><span class="op" id="5661293">)</span><span class="op" id="5661294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5661297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661301">switch</span>&nbsp;<span class="ident" id="5661308">p</span><span class="op" id="5661309">.</span><span class="ident" id="5661310">tok</span>&nbsp;<span class="op" id="5661314">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661317">case</span>&nbsp;<span class="ident" id="5661322">token</span><span class="op" id="5661327">.</span><span class="ident" id="5661328">ADD</span><span class="op" id="5661331">,</span>&nbsp;<span class="ident" id="5661333">token</span><span class="op" id="5661338">.</span><span class="ident" id="5661339">SUB</span><span class="op" id="5661342">,</span>&nbsp;<span class="ident" id="5661344">token</span><span class="op" id="5661349">.</span><span class="ident" id="5661350">NOT</span><span class="op" id="5661353">,</span>&nbsp;<span class="ident" id="5661355">token</span><span class="op" id="5661360">.</span><span class="ident" id="5661361">XOR</span><span class="op" id="5661364">,</span>&nbsp;<span class="ident" id="5661366">token</span><span class="op" id="5661371">.</span><span class="ident" id="5661372">AND</span><span class="op" id="5661375">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661379">pos</span><span class="op" id="5661382">,</span>&nbsp;<span class="ident" id="5661384">op</span>&nbsp;<span class="op" id="5661387">:=</span>&nbsp;<span class="ident" id="5661390">p</span><span class="op" id="5661391">.</span><span class="ident" id="5661392">pos</span><span class="op" id="5661395">,</span>&nbsp;<span class="ident" id="5661397">p</span><span class="op" id="5661398">.</span><span class="ident" id="5661399">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661405">p</span><span class="op" id="5661406">.</span><span class="ident" id="5661407">next</span><span class="op" id="5661411">(</span><span class="op" id="5661412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661416">x</span>&nbsp;<span class="op" id="5661418">:=</span>&nbsp;<span class="ident" id="5661421">p</span><span class="op" id="5661422">.</span><span class="ident" id="5661423">parseUnaryExpr</span><span class="op" id="5661437">(</span><span class="builtintype" id="5661438">false</span><span class="op" id="5661443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661447">return</span>&nbsp;<span class="op" id="5661454">&amp;</span><span class="ident" id="5661455">ast</span><span class="op" id="5661458">.</span><span class="ident" id="5661459">UnaryExpr</span><span class="op" id="5661468">{</span><span class="ident" id="5661469">OpPos</span><span class="op" id="5661474">:</span>&nbsp;<span class="ident" id="5661476">pos</span><span class="op" id="5661479">,</span>&nbsp;<span class="ident" id="5661481">Op</span><span class="op" id="5661483">:</span>&nbsp;<span class="ident" id="5661485">op</span><span class="op" id="5661487">,</span>&nbsp;<span class="ident" id="5661489">X</span><span class="op" id="5661490">:</span>&nbsp;<span class="ident" id="5661492">p</span><span class="op" id="5661493">.</span><span class="ident" id="5661494">checkExpr</span><span class="op" id="5661503">(</span><span class="ident" id="5661504">x</span><span class="op" id="5661505">)</span><span class="op" id="5661506">}</span><br>
<span class="lineno">1500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5661510">case</span>&nbsp;<span class="ident" id="5661515">token</span><span class="op" id="5661520">.</span><span class="ident" id="5661521">ARROW</span><span class="op" id="5661526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661530">//&nbsp;channel&nbsp;type&nbsp;or&nbsp;receive&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661570">arrow</span>&nbsp;<span class="op" id="5661576">:=</span>&nbsp;<span class="ident" id="5661579">p</span><span class="op" id="5661580">.</span><span class="ident" id="5661581">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5661587">p</span><span class="op" id="5661588">.</span><span class="ident" id="5661589">next</span><span class="op" id="5661593">(</span><span class="op" id="5661594">)</span><br>
<span class="lineno">1505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661599">//&nbsp;If&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;token.CHAN&nbsp;we&nbsp;still&nbsp;don&#39;t&nbsp;know&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661662">//&nbsp;is&nbsp;a&nbsp;channel&nbsp;type&nbsp;or&nbsp;a&nbsp;receive&nbsp;operation&nbsp;-&nbsp;we&nbsp;only&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661723">//&nbsp;once&nbsp;we&nbsp;have&nbsp;found&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;unary&nbsp;expression.&nbsp;There</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661786">//&nbsp;are&nbsp;two&nbsp;cases:</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661806">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661811">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;type&nbsp;&nbsp;=&gt;&nbsp;(&lt;-type)&nbsp;must&nbsp;be&nbsp;channel&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661860">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;expr&nbsp;&nbsp;=&gt;&nbsp;&lt;-(expr)&nbsp;is&nbsp;a&nbsp;receive&nbsp;from&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661920">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661925">//&nbsp;In&nbsp;the&nbsp;first&nbsp;case,&nbsp;the&nbsp;arrow&nbsp;must&nbsp;be&nbsp;re-associated&nbsp;with</span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5661986">//&nbsp;the&nbsp;channel&nbsp;type&nbsp;parsed&nbsp;already:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662024">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662029">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&nbsp;type)&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662072">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&lt;-&nbsp;type)&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;(&lt;-type))</span><br>
<span class="lineno"></span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662120">x</span>&nbsp;<span class="op" id="5662122">:=</span>&nbsp;<span class="ident" id="5662125">p</span><span class="op" id="5662126">.</span><span class="ident" id="5662127">parseUnaryExpr</span><span class="op" id="5662141">(</span><span class="builtintype" id="5662142">false</span><span class="op" id="5662147">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662152">//&nbsp;determine&nbsp;which&nbsp;case&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662186">if</span>&nbsp;<span class="ident" id="5662189">typ</span><span class="op" id="5662192">,</span>&nbsp;<span class="ident" id="5662194">ok</span>&nbsp;<span class="op" id="5662197">:=</span>&nbsp;<span class="ident" id="5662200">x</span><span class="op" id="5662201">.</span><span class="op" id="5662202">(</span><span class="op" id="5662203">*</span><span class="ident" id="5662204">ast</span><span class="op" id="5662207">.</span><span class="ident" id="5662208">ChanType</span><span class="op" id="5662216">)</span><span class="op" id="5662217">;</span>&nbsp;<span class="ident" id="5662219">ok</span>&nbsp;<span class="op" id="5662222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662227">//&nbsp;(&lt;-type)</span><br>
<span class="lineno">1525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662243">//&nbsp;re-associate&nbsp;position&nbsp;info&nbsp;and&nbsp;&lt;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662283">dir</span>&nbsp;<span class="op" id="5662287">:=</span>&nbsp;<span class="ident" id="5662290">ast</span><span class="op" id="5662293">.</span><span class="ident" id="5662294">SEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662302">for</span>&nbsp;<span class="ident" id="5662306">ok</span>&nbsp;<span class="op" id="5662309">&amp;&amp;</span>&nbsp;<span class="ident" id="5662312">dir</span>&nbsp;<span class="op" id="5662316">==</span>&nbsp;<span class="ident" id="5662319">ast</span><span class="op" id="5662322">.</span><span class="ident" id="5662323">SEND</span>&nbsp;<span class="op" id="5662328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662334">if</span>&nbsp;<span class="ident" id="5662337">typ</span><span class="op" id="5662340">.</span><span class="ident" id="5662341">Dir</span>&nbsp;<span class="op" id="5662345">==</span>&nbsp;<span class="ident" id="5662348">ast</span><span class="op" id="5662351">.</span><span class="ident" id="5662352">RECV</span>&nbsp;<span class="op" id="5662357">{</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662364">//&nbsp;error:&nbsp;(&lt;-type)&nbsp;is&nbsp;(&lt;-(&lt;-chan&nbsp;T))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662406">p</span><span class="op" id="5662407">.</span><span class="ident" id="5662408">errorExpected</span><span class="op" id="5662421">(</span><span class="ident" id="5662422">typ</span><span class="op" id="5662425">.</span><span class="ident" id="5662426">Arrow</span><span class="op" id="5662431">,</span>&nbsp;<span class="string" id="5662433">&#34;&#39;chan&#39;&#34;</span><span class="op" id="5662441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5662447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662453">arrow</span><span class="op" id="5662458">,</span>&nbsp;<span class="ident" id="5662460">typ</span><span class="op" id="5662463">.</span><span class="ident" id="5662464">Begin</span><span class="op" id="5662469">,</span>&nbsp;<span class="ident" id="5662471">typ</span><span class="op" id="5662474">.</span><span class="ident" id="5662475">Arrow</span>&nbsp;<span class="op" id="5662481">=</span>&nbsp;<span class="ident" id="5662483">typ</span><span class="op" id="5662486">.</span><span class="ident" id="5662487">Arrow</span><span class="op" id="5662492">,</span>&nbsp;<span class="ident" id="5662494">arrow</span><span class="op" id="5662499">,</span>&nbsp;<span class="ident" id="5662501">arrow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662511">dir</span><span class="op" id="5662514">,</span>&nbsp;<span class="ident" id="5662516">typ</span><span class="op" id="5662519">.</span><span class="ident" id="5662520">Dir</span>&nbsp;<span class="op" id="5662524">=</span>&nbsp;<span class="ident" id="5662526">typ</span><span class="op" id="5662529">.</span><span class="ident" id="5662530">Dir</span><span class="op" id="5662533">,</span>&nbsp;<span class="ident" id="5662535">ast</span><span class="op" id="5662538">.</span><span class="ident" id="5662539">RECV</span><br>
<span class="lineno">1535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662548">typ</span><span class="op" id="5662551">,</span>&nbsp;<span class="ident" id="5662553">ok</span>&nbsp;<span class="op" id="5662556">=</span>&nbsp;<span class="ident" id="5662558">typ</span><span class="op" id="5662561">.</span><span class="ident" id="5662562">Value</span><span class="op" id="5662567">.</span><span class="op" id="5662568">(</span><span class="op" id="5662569">*</span><span class="ident" id="5662570">ast</span><span class="op" id="5662573">.</span><span class="ident" id="5662574">ChanType</span><span class="op" id="5662582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5662587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662592">if</span>&nbsp;<span class="ident" id="5662595">dir</span>&nbsp;<span class="op" id="5662599">==</span>&nbsp;<span class="ident" id="5662602">ast</span><span class="op" id="5662605">.</span><span class="ident" id="5662606">SEND</span>&nbsp;<span class="op" id="5662611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662617">p</span><span class="op" id="5662618">.</span><span class="ident" id="5662619">errorExpected</span><span class="op" id="5662632">(</span><span class="ident" id="5662633">arrow</span><span class="op" id="5662638">,</span>&nbsp;<span class="string" id="5662640">&#34;channel&nbsp;type&#34;</span><span class="op" id="5662654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5662659">}</span><br>
<span class="lineno">1540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662665">return</span>&nbsp;<span class="ident" id="5662672">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5662676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662681">//&nbsp;&lt;-(expr)</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662695">return</span>&nbsp;<span class="op" id="5662702">&amp;</span><span class="ident" id="5662703">ast</span><span class="op" id="5662706">.</span><span class="ident" id="5662707">UnaryExpr</span><span class="op" id="5662716">{</span><span class="ident" id="5662717">OpPos</span><span class="op" id="5662722">:</span>&nbsp;<span class="ident" id="5662724">arrow</span><span class="op" id="5662729">,</span>&nbsp;<span class="ident" id="5662731">Op</span><span class="op" id="5662733">:</span>&nbsp;<span class="ident" id="5662735">token</span><span class="op" id="5662740">.</span><span class="ident" id="5662741">ARROW</span><span class="op" id="5662746">,</span>&nbsp;<span class="ident" id="5662748">X</span><span class="op" id="5662749">:</span>&nbsp;<span class="ident" id="5662751">p</span><span class="op" id="5662752">.</span><span class="ident" id="5662753">checkExpr</span><span class="op" id="5662762">(</span><span class="ident" id="5662763">x</span><span class="op" id="5662764">)</span><span class="op" id="5662765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662769">case</span>&nbsp;<span class="ident" id="5662774">token</span><span class="op" id="5662779">.</span><span class="ident" id="5662780">MUL</span><span class="op" id="5662783">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5662787">//&nbsp;pointer&nbsp;type&nbsp;or&nbsp;unary&nbsp;&#34;*&#34;&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662829">pos</span>&nbsp;<span class="op" id="5662833">:=</span>&nbsp;<span class="ident" id="5662836">p</span><span class="op" id="5662837">.</span><span class="ident" id="5662838">pos</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662844">p</span><span class="op" id="5662845">.</span><span class="ident" id="5662846">next</span><span class="op" id="5662850">(</span><span class="op" id="5662851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5662855">x</span>&nbsp;<span class="op" id="5662857">:=</span>&nbsp;<span class="ident" id="5662860">p</span><span class="op" id="5662861">.</span><span class="ident" id="5662862">parseUnaryExpr</span><span class="op" id="5662876">(</span><span class="builtintype" id="5662877">false</span><span class="op" id="5662882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662886">return</span>&nbsp;<span class="op" id="5662893">&amp;</span><span class="ident" id="5662894">ast</span><span class="op" id="5662897">.</span><span class="ident" id="5662898">StarExpr</span><span class="op" id="5662906">{</span><span class="ident" id="5662907">Star</span><span class="op" id="5662911">:</span>&nbsp;<span class="ident" id="5662913">pos</span><span class="op" id="5662916">,</span>&nbsp;<span class="ident" id="5662918">X</span><span class="op" id="5662919">:</span>&nbsp;<span class="ident" id="5662921">p</span><span class="op" id="5662922">.</span><span class="ident" id="5662923">checkExprOrType</span><span class="op" id="5662938">(</span><span class="ident" id="5662939">x</span><span class="op" id="5662940">)</span><span class="op" id="5662941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5662944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5662948">return</span>&nbsp;<span class="ident" id="5662955">p</span><span class="op" id="5662956">.</span><span class="ident" id="5662957">parsePrimaryExpr</span><span class="op" id="5662973">(</span><span class="ident" id="5662974">lhs</span><span class="op" id="5662977">)</span><br>
<span class="lineno"></span><span class="op" id="5662979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5662982">func</span>&nbsp;<span class="op" id="5662987">(</span><span class="ident" id="5662988">p</span>&nbsp;<span class="op" id="5662990">*</span><span class="ident" id="5662991">parser</span><span class="op" id="5662997">)</span>&nbsp;<span class="ident" id="5662999">tokPrec</span><span class="op" id="5663006">(</span><span class="op" id="5663007">)</span>&nbsp;<span class="op" id="5663009">(</span><span class="ident" id="5663010">token</span><span class="op" id="5663015">.</span><span class="ident" id="5663016">Token</span><span class="op" id="5663021">,</span>&nbsp;<span class="builtintype" id="5663023">int</span><span class="op" id="5663026">)</span>&nbsp;<span class="op" id="5663028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663031">tok</span>&nbsp;<span class="op" id="5663035">:=</span>&nbsp;<span class="ident" id="5663038">p</span><span class="op" id="5663039">.</span><span class="ident" id="5663040">tok</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663045">if</span>&nbsp;<span class="ident" id="5663048">p</span><span class="op" id="5663049">.</span><span class="ident" id="5663050">inRhs</span>&nbsp;<span class="op" id="5663056">&amp;&amp;</span>&nbsp;<span class="ident" id="5663059">tok</span>&nbsp;<span class="op" id="5663063">==</span>&nbsp;<span class="ident" id="5663066">token</span><span class="op" id="5663071">.</span><span class="ident" id="5663072">ASSIGN</span>&nbsp;<span class="op" id="5663079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663083">tok</span>&nbsp;<span class="op" id="5663087">=</span>&nbsp;<span class="ident" id="5663089">token</span><span class="op" id="5663094">.</span><span class="ident" id="5663095">EQL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663103">return</span>&nbsp;<span class="ident" id="5663110">tok</span><span class="op" id="5663113">,</span>&nbsp;<span class="ident" id="5663115">tok</span><span class="op" id="5663118">.</span><span class="ident" id="5663119">Precedence</span><span class="op" id="5663129">(</span><span class="op" id="5663130">)</span><br>
<span class="lineno"></span><span class="op" id="5663132">}</span><br>
<span class="lineno">1565</span><br>
<span class="lineno"></span><span class="comment" id="5663135">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5663205">func</span>&nbsp;<span class="op" id="5663210">(</span><span class="ident" id="5663211">p</span>&nbsp;<span class="op" id="5663213">*</span><span class="ident" id="5663214">parser</span><span class="op" id="5663220">)</span>&nbsp;<span class="ident" id="5663222">parseBinaryExpr</span><span class="op" id="5663237">(</span><span class="ident" id="5663238">lhs</span>&nbsp;<span class="builtintype" id="5663242">bool</span><span class="op" id="5663246">,</span>&nbsp;<span class="ident" id="5663248">prec1</span>&nbsp;<span class="builtintype" id="5663254">int</span><span class="op" id="5663257">)</span>&nbsp;<span class="ident" id="5663259">ast</span><span class="op" id="5663262">.</span><span class="ident" id="5663263">Expr</span>&nbsp;<span class="op" id="5663268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663271">if</span>&nbsp;<span class="ident" id="5663274">p</span><span class="op" id="5663275">.</span><span class="ident" id="5663276">trace</span>&nbsp;<span class="op" id="5663282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663286">defer</span>&nbsp;<span class="ident" id="5663292">un</span><span class="op" id="5663294">(</span><span class="ident" id="5663295">trace</span><span class="op" id="5663300">(</span><span class="ident" id="5663301">p</span><span class="op" id="5663302">,</span>&nbsp;<span class="string" id="5663304">&#34;BinaryExpr&#34;</span><span class="op" id="5663316">)</span><span class="op" id="5663317">)</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663324">x</span>&nbsp;<span class="op" id="5663326">:=</span>&nbsp;<span class="ident" id="5663329">p</span><span class="op" id="5663330">.</span><span class="ident" id="5663331">parseUnaryExpr</span><span class="op" id="5663345">(</span><span class="ident" id="5663346">lhs</span><span class="op" id="5663349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663352">for</span>&nbsp;<span class="ident" id="5663356">_</span><span class="op" id="5663357">,</span>&nbsp;<span class="ident" id="5663359">prec</span>&nbsp;<span class="op" id="5663364">:=</span>&nbsp;<span class="ident" id="5663367">p</span><span class="op" id="5663368">.</span><span class="ident" id="5663369">tokPrec</span><span class="op" id="5663376">(</span><span class="op" id="5663377">)</span><span class="op" id="5663378">;</span>&nbsp;<span class="ident" id="5663380">prec</span>&nbsp;<span class="op" id="5663385">&gt;=</span>&nbsp;<span class="ident" id="5663388">prec1</span><span class="op" id="5663393">;</span>&nbsp;<span class="ident" id="5663395">prec</span><span class="op" id="5663399">--</span>&nbsp;<span class="op" id="5663402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663406">for</span>&nbsp;<span class="op" id="5663410">{</span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663415">op</span><span class="op" id="5663417">,</span>&nbsp;<span class="ident" id="5663419">oprec</span>&nbsp;<span class="op" id="5663425">:=</span>&nbsp;<span class="ident" id="5663428">p</span><span class="op" id="5663429">.</span><span class="ident" id="5663430">tokPrec</span><span class="op" id="5663437">(</span><span class="op" id="5663438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663443">if</span>&nbsp;<span class="ident" id="5663446">oprec</span>&nbsp;<span class="op" id="5663452">!=</span>&nbsp;<span class="ident" id="5663455">prec</span>&nbsp;<span class="op" id="5663460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663466">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663480">pos</span>&nbsp;<span class="op" id="5663484">:=</span>&nbsp;<span class="ident" id="5663487">p</span><span class="op" id="5663488">.</span><span class="ident" id="5663489">expect</span><span class="op" id="5663495">(</span><span class="ident" id="5663496">op</span><span class="op" id="5663498">)</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663503">if</span>&nbsp;<span class="ident" id="5663506">lhs</span>&nbsp;<span class="op" id="5663510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663516">p</span><span class="op" id="5663517">.</span><span class="ident" id="5663518">resolve</span><span class="op" id="5663525">(</span><span class="ident" id="5663526">x</span><span class="op" id="5663527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663533">lhs</span>&nbsp;<span class="op" id="5663537">=</span>&nbsp;<span class="builtintype" id="5663539">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663553">y</span>&nbsp;<span class="op" id="5663555">:=</span>&nbsp;<span class="ident" id="5663558">p</span><span class="op" id="5663559">.</span><span class="ident" id="5663560">parseBinaryExpr</span><span class="op" id="5663575">(</span><span class="builtintype" id="5663576">false</span><span class="op" id="5663581">,</span>&nbsp;<span class="ident" id="5663583">prec</span><span class="op" id="5663587">+</span><span class="num" id="5663588">1</span><span class="op" id="5663589">)</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5663594">x</span>&nbsp;<span class="op" id="5663596">=</span>&nbsp;<span class="op" id="5663598">&amp;</span><span class="ident" id="5663599">ast</span><span class="op" id="5663602">.</span><span class="ident" id="5663603">BinaryExpr</span><span class="op" id="5663613">{</span><span class="ident" id="5663614">X</span><span class="op" id="5663615">:</span>&nbsp;<span class="ident" id="5663617">p</span><span class="op" id="5663618">.</span><span class="ident" id="5663619">checkExpr</span><span class="op" id="5663628">(</span><span class="ident" id="5663629">x</span><span class="op" id="5663630">)</span><span class="op" id="5663631">,</span>&nbsp;<span class="ident" id="5663633">OpPos</span><span class="op" id="5663638">:</span>&nbsp;<span class="ident" id="5663640">pos</span><span class="op" id="5663643">,</span>&nbsp;<span class="ident" id="5663645">Op</span><span class="op" id="5663647">:</span>&nbsp;<span class="ident" id="5663649">op</span><span class="op" id="5663651">,</span>&nbsp;<span class="ident" id="5663653">Y</span><span class="op" id="5663654">:</span>&nbsp;<span class="ident" id="5663656">p</span><span class="op" id="5663657">.</span><span class="ident" id="5663658">checkExpr</span><span class="op" id="5663667">(</span><span class="ident" id="5663668">y</span><span class="op" id="5663669">)</span><span class="op" id="5663670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5663677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663681">return</span>&nbsp;<span class="ident" id="5663688">x</span><br>
<span class="lineno">1590</span><span class="op" id="5663690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5663693">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="comment" id="5663763">//&nbsp;The&nbsp;result&nbsp;may&nbsp;be&nbsp;a&nbsp;type&nbsp;or&nbsp;even&nbsp;a&nbsp;raw&nbsp;type&nbsp;([...]int).&nbsp;Callers&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5663835">//&nbsp;check&nbsp;the&nbsp;result&nbsp;(using&nbsp;checkExpr&nbsp;or&nbsp;checkExprOrType),&nbsp;depending&nbsp;on</span><br>
<span class="lineno">1595</span><span class="comment" id="5663906">//&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="5663918">func</span>&nbsp;<span class="op" id="5663923">(</span><span class="ident" id="5663924">p</span>&nbsp;<span class="op" id="5663926">*</span><span class="ident" id="5663927">parser</span><span class="op" id="5663933">)</span>&nbsp;<span class="ident" id="5663935">parseExpr</span><span class="op" id="5663944">(</span><span class="ident" id="5663945">lhs</span>&nbsp;<span class="builtintype" id="5663949">bool</span><span class="op" id="5663953">)</span>&nbsp;<span class="ident" id="5663955">ast</span><span class="op" id="5663958">.</span><span class="ident" id="5663959">Expr</span>&nbsp;<span class="op" id="5663964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663967">if</span>&nbsp;<span class="ident" id="5663970">p</span><span class="op" id="5663971">.</span><span class="ident" id="5663972">trace</span>&nbsp;<span class="op" id="5663978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5663982">defer</span>&nbsp;<span class="ident" id="5663988">un</span><span class="op" id="5663990">(</span><span class="ident" id="5663991">trace</span><span class="op" id="5663996">(</span><span class="ident" id="5663997">p</span><span class="op" id="5663998">,</span>&nbsp;<span class="string" id="5664000">&#34;Expression&#34;</span><span class="op" id="5664012">)</span><span class="op" id="5664013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5664016">}</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664020">return</span>&nbsp;<span class="ident" id="5664027">p</span><span class="op" id="5664028">.</span><span class="ident" id="5664029">parseBinaryExpr</span><span class="op" id="5664044">(</span><span class="ident" id="5664045">lhs</span><span class="op" id="5664048">,</span>&nbsp;<span class="ident" id="5664050">token</span><span class="op" id="5664055">.</span><span class="ident" id="5664056">LowestPrec</span><span class="op" id="5664066">+</span><span class="num" id="5664067">1</span><span class="op" id="5664068">)</span><br>
<span class="lineno"></span><span class="op" id="5664070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5664073">func</span>&nbsp;<span class="op" id="5664078">(</span><span class="ident" id="5664079">p</span>&nbsp;<span class="op" id="5664081">*</span><span class="ident" id="5664082">parser</span><span class="op" id="5664088">)</span>&nbsp;<span class="ident" id="5664090">parseRhs</span><span class="op" id="5664098">(</span><span class="op" id="5664099">)</span>&nbsp;<span class="ident" id="5664101">ast</span><span class="op" id="5664104">.</span><span class="ident" id="5664105">Expr</span>&nbsp;<span class="op" id="5664110">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664113">old</span>&nbsp;<span class="op" id="5664117">:=</span>&nbsp;<span class="ident" id="5664120">p</span><span class="op" id="5664121">.</span><span class="ident" id="5664122">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664129">p</span><span class="op" id="5664130">.</span><span class="ident" id="5664131">inRhs</span>&nbsp;<span class="op" id="5664137">=</span>&nbsp;<span class="builtintype" id="5664139">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664145">x</span>&nbsp;<span class="op" id="5664147">:=</span>&nbsp;<span class="ident" id="5664150">p</span><span class="op" id="5664151">.</span><span class="ident" id="5664152">checkExpr</span><span class="op" id="5664161">(</span><span class="ident" id="5664162">p</span><span class="op" id="5664163">.</span><span class="ident" id="5664164">parseExpr</span><span class="op" id="5664173">(</span><span class="builtintype" id="5664174">false</span><span class="op" id="5664179">)</span><span class="op" id="5664180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664183">p</span><span class="op" id="5664184">.</span><span class="ident" id="5664185">inRhs</span>&nbsp;<span class="op" id="5664191">=</span>&nbsp;<span class="ident" id="5664193">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664198">return</span>&nbsp;<span class="ident" id="5664205">x</span><br>
<span class="lineno">1610</span><span class="op" id="5664207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5664210">func</span>&nbsp;<span class="op" id="5664215">(</span><span class="ident" id="5664216">p</span>&nbsp;<span class="op" id="5664218">*</span><span class="ident" id="5664219">parser</span><span class="op" id="5664225">)</span>&nbsp;<span class="ident" id="5664227">parseRhsOrType</span><span class="op" id="5664241">(</span><span class="op" id="5664242">)</span>&nbsp;<span class="ident" id="5664244">ast</span><span class="op" id="5664247">.</span><span class="ident" id="5664248">Expr</span>&nbsp;<span class="op" id="5664253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664256">old</span>&nbsp;<span class="op" id="5664260">:=</span>&nbsp;<span class="ident" id="5664263">p</span><span class="op" id="5664264">.</span><span class="ident" id="5664265">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664272">p</span><span class="op" id="5664273">.</span><span class="ident" id="5664274">inRhs</span>&nbsp;<span class="op" id="5664280">=</span>&nbsp;<span class="builtintype" id="5664282">true</span><br>
<span class="lineno">1615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664288">x</span>&nbsp;<span class="op" id="5664290">:=</span>&nbsp;<span class="ident" id="5664293">p</span><span class="op" id="5664294">.</span><span class="ident" id="5664295">checkExprOrType</span><span class="op" id="5664310">(</span><span class="ident" id="5664311">p</span><span class="op" id="5664312">.</span><span class="ident" id="5664313">parseExpr</span><span class="op" id="5664322">(</span><span class="builtintype" id="5664323">false</span><span class="op" id="5664328">)</span><span class="op" id="5664329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664332">p</span><span class="op" id="5664333">.</span><span class="ident" id="5664334">inRhs</span>&nbsp;<span class="op" id="5664340">=</span>&nbsp;<span class="ident" id="5664342">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664347">return</span>&nbsp;<span class="ident" id="5664354">x</span><br>
<span class="lineno"></span><span class="op" id="5664356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1620</span><span class="comment" id="5664359">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5664439">//&nbsp;Statements</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5664454">//&nbsp;Parsing&nbsp;modes&nbsp;for&nbsp;parseSimpleStmt.</span><br>
<span class="lineno"></span><span class="keyword" id="5664492">const</span>&nbsp;<span class="op" id="5664498">(</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664501">basic</span>&nbsp;<span class="op" id="5664507">=</span>&nbsp;<span class="ident" id="5664509">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664515">labelOk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664524">rangeOk</span><br>
<span class="lineno"></span><span class="op" id="5664532">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1630</span><span class="comment" id="5664535">//&nbsp;parseSimpleStmt&nbsp;returns&nbsp;true&nbsp;as&nbsp;2nd&nbsp;result&nbsp;if&nbsp;it&nbsp;parsed&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span><span class="comment" id="5664609">//&nbsp;of&nbsp;a&nbsp;range&nbsp;clause&nbsp;(with&nbsp;mode&nbsp;==&nbsp;rangeOk).&nbsp;The&nbsp;returned&nbsp;statement&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5664683">//&nbsp;assignment&nbsp;with&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5664757">//&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;.&nbsp;No&nbsp;guarantees&nbsp;are&nbsp;given&nbsp;for&nbsp;the&nbsp;left-hand&nbsp;side.</span><br>
<span class="lineno"></span><span class="keyword" id="5664828">func</span>&nbsp;<span class="op" id="5664833">(</span><span class="ident" id="5664834">p</span>&nbsp;<span class="op" id="5664836">*</span><span class="ident" id="5664837">parser</span><span class="op" id="5664843">)</span>&nbsp;<span class="ident" id="5664845">parseSimpleStmt</span><span class="op" id="5664860">(</span><span class="ident" id="5664861">mode</span>&nbsp;<span class="builtintype" id="5664866">int</span><span class="op" id="5664869">)</span>&nbsp;<span class="op" id="5664871">(</span><span class="ident" id="5664872">ast</span><span class="op" id="5664875">.</span><span class="ident" id="5664876">Stmt</span><span class="op" id="5664880">,</span>&nbsp;<span class="builtintype" id="5664882">bool</span><span class="op" id="5664886">)</span>&nbsp;<span class="op" id="5664888">{</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664891">if</span>&nbsp;<span class="ident" id="5664894">p</span><span class="op" id="5664895">.</span><span class="ident" id="5664896">trace</span>&nbsp;<span class="op" id="5664902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664906">defer</span>&nbsp;<span class="ident" id="5664912">un</span><span class="op" id="5664914">(</span><span class="ident" id="5664915">trace</span><span class="op" id="5664920">(</span><span class="ident" id="5664921">p</span><span class="op" id="5664922">,</span>&nbsp;<span class="string" id="5664924">&#34;SimpleStmt&#34;</span><span class="op" id="5664936">)</span><span class="op" id="5664937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5664940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664944">x</span>&nbsp;<span class="op" id="5664946">:=</span>&nbsp;<span class="ident" id="5664949">p</span><span class="op" id="5664950">.</span><span class="ident" id="5664951">parseLhsList</span><span class="op" id="5664963">(</span><span class="op" id="5664964">)</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664968">switch</span>&nbsp;<span class="ident" id="5664975">p</span><span class="op" id="5664976">.</span><span class="ident" id="5664977">tok</span>&nbsp;<span class="op" id="5664981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5664984">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664991">token</span><span class="op" id="5664996">.</span><span class="ident" id="5664997">DEFINE</span><span class="op" id="5665003">,</span>&nbsp;<span class="ident" id="5665005">token</span><span class="op" id="5665010">.</span><span class="ident" id="5665011">ASSIGN</span><span class="op" id="5665017">,</span>&nbsp;<span class="ident" id="5665019">token</span><span class="op" id="5665024">.</span><span class="ident" id="5665025">ADD_ASSIGN</span><span class="op" id="5665035">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665039">token</span><span class="op" id="5665044">.</span><span class="ident" id="5665045">SUB_ASSIGN</span><span class="op" id="5665055">,</span>&nbsp;<span class="ident" id="5665057">token</span><span class="op" id="5665062">.</span><span class="ident" id="5665063">MUL_ASSIGN</span><span class="op" id="5665073">,</span>&nbsp;<span class="ident" id="5665075">token</span><span class="op" id="5665080">.</span><span class="ident" id="5665081">QUO_ASSIGN</span><span class="op" id="5665091">,</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665095">token</span><span class="op" id="5665100">.</span><span class="ident" id="5665101">REM_ASSIGN</span><span class="op" id="5665111">,</span>&nbsp;<span class="ident" id="5665113">token</span><span class="op" id="5665118">.</span><span class="ident" id="5665119">AND_ASSIGN</span><span class="op" id="5665129">,</span>&nbsp;<span class="ident" id="5665131">token</span><span class="op" id="5665136">.</span><span class="ident" id="5665137">OR_ASSIGN</span><span class="op" id="5665146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665150">token</span><span class="op" id="5665155">.</span><span class="ident" id="5665156">XOR_ASSIGN</span><span class="op" id="5665166">,</span>&nbsp;<span class="ident" id="5665168">token</span><span class="op" id="5665173">.</span><span class="ident" id="5665174">SHL_ASSIGN</span><span class="op" id="5665184">,</span>&nbsp;<span class="ident" id="5665186">token</span><span class="op" id="5665191">.</span><span class="ident" id="5665192">SHR_ASSIGN</span><span class="op" id="5665202">,</span>&nbsp;<span class="ident" id="5665204">token</span><span class="op" id="5665209">.</span><span class="ident" id="5665210">AND_NOT_ASSIGN</span><span class="op" id="5665224">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5665228">//&nbsp;assignment&nbsp;statement,&nbsp;possibly&nbsp;part&nbsp;of&nbsp;a&nbsp;range&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665287">pos</span><span class="op" id="5665290">,</span>&nbsp;<span class="ident" id="5665292">tok</span>&nbsp;<span class="op" id="5665296">:=</span>&nbsp;<span class="ident" id="5665299">p</span><span class="op" id="5665300">.</span><span class="ident" id="5665301">pos</span><span class="op" id="5665304">,</span>&nbsp;<span class="ident" id="5665306">p</span><span class="op" id="5665307">.</span><span class="ident" id="5665308">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665314">p</span><span class="op" id="5665315">.</span><span class="ident" id="5665316">next</span><span class="op" id="5665320">(</span><span class="op" id="5665321">)</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665325">var</span>&nbsp;<span class="ident" id="5665329">y</span>&nbsp;<span class="op" id="5665331">[</span><span class="op" id="5665332">]</span><span class="ident" id="5665333">ast</span><span class="op" id="5665336">.</span><span class="ident" id="5665337">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665344">isRange</span>&nbsp;<span class="op" id="5665352">:=</span>&nbsp;<span class="builtintype" id="5665355">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665363">if</span>&nbsp;<span class="ident" id="5665366">mode</span>&nbsp;<span class="op" id="5665371">==</span>&nbsp;<span class="ident" id="5665374">rangeOk</span>&nbsp;<span class="op" id="5665382">&amp;&amp;</span>&nbsp;<span class="ident" id="5665385">p</span><span class="op" id="5665386">.</span><span class="ident" id="5665387">tok</span>&nbsp;<span class="op" id="5665391">==</span>&nbsp;<span class="ident" id="5665394">token</span><span class="op" id="5665399">.</span><span class="ident" id="5665400">RANGE</span>&nbsp;<span class="op" id="5665406">&amp;&amp;</span>&nbsp;<span class="op" id="5665409">(</span><span class="ident" id="5665410">tok</span>&nbsp;<span class="op" id="5665414">==</span>&nbsp;<span class="ident" id="5665417">token</span><span class="op" id="5665422">.</span><span class="ident" id="5665423">DEFINE</span>&nbsp;<span class="op" id="5665430">||</span>&nbsp;<span class="ident" id="5665433">tok</span>&nbsp;<span class="op" id="5665437">==</span>&nbsp;<span class="ident" id="5665440">token</span><span class="op" id="5665445">.</span><span class="ident" id="5665446">ASSIGN</span><span class="op" id="5665452">)</span>&nbsp;<span class="op" id="5665454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665459">pos</span>&nbsp;<span class="op" id="5665463">:=</span>&nbsp;<span class="ident" id="5665466">p</span><span class="op" id="5665467">.</span><span class="ident" id="5665468">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665475">p</span><span class="op" id="5665476">.</span><span class="ident" id="5665477">next</span><span class="op" id="5665481">(</span><span class="op" id="5665482">)</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665487">y</span>&nbsp;<span class="op" id="5665489">=</span>&nbsp;<span class="op" id="5665491">[</span><span class="op" id="5665492">]</span><span class="ident" id="5665493">ast</span><span class="op" id="5665496">.</span><span class="ident" id="5665497">Expr</span><span class="op" id="5665501">{</span><span class="op" id="5665502">&amp;</span><span class="ident" id="5665503">ast</span><span class="op" id="5665506">.</span><span class="ident" id="5665507">UnaryExpr</span><span class="op" id="5665516">{</span><span class="ident" id="5665517">OpPos</span><span class="op" id="5665522">:</span>&nbsp;<span class="ident" id="5665524">pos</span><span class="op" id="5665527">,</span>&nbsp;<span class="ident" id="5665529">Op</span><span class="op" id="5665531">:</span>&nbsp;<span class="ident" id="5665533">token</span><span class="op" id="5665538">.</span><span class="ident" id="5665539">RANGE</span><span class="op" id="5665544">,</span>&nbsp;<span class="ident" id="5665546">X</span><span class="op" id="5665547">:</span>&nbsp;<span class="ident" id="5665549">p</span><span class="op" id="5665550">.</span><span class="ident" id="5665551">parseRhs</span><span class="op" id="5665559">(</span><span class="op" id="5665560">)</span><span class="op" id="5665561">}</span><span class="op" id="5665562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665567">isRange</span>&nbsp;<span class="op" id="5665575">=</span>&nbsp;<span class="builtintype" id="5665577">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665584">}</span>&nbsp;<span class="keyword" id="5665586">else</span>&nbsp;<span class="op" id="5665591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665596">y</span>&nbsp;<span class="op" id="5665598">=</span>&nbsp;<span class="ident" id="5665600">p</span><span class="op" id="5665601">.</span><span class="ident" id="5665602">parseRhsList</span><span class="op" id="5665614">(</span><span class="op" id="5665615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665619">}</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665623">as</span>&nbsp;<span class="op" id="5665626">:=</span>&nbsp;<span class="op" id="5665629">&amp;</span><span class="ident" id="5665630">ast</span><span class="op" id="5665633">.</span><span class="ident" id="5665634">AssignStmt</span><span class="op" id="5665644">{</span><span class="ident" id="5665645">Lhs</span><span class="op" id="5665648">:</span>&nbsp;<span class="ident" id="5665650">x</span><span class="op" id="5665651">,</span>&nbsp;<span class="ident" id="5665653">TokPos</span><span class="op" id="5665659">:</span>&nbsp;<span class="ident" id="5665661">pos</span><span class="op" id="5665664">,</span>&nbsp;<span class="ident" id="5665666">Tok</span><span class="op" id="5665669">:</span>&nbsp;<span class="ident" id="5665671">tok</span><span class="op" id="5665674">,</span>&nbsp;<span class="ident" id="5665676">Rhs</span><span class="op" id="5665679">:</span>&nbsp;<span class="ident" id="5665681">y</span><span class="op" id="5665682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665686">if</span>&nbsp;<span class="ident" id="5665689">tok</span>&nbsp;<span class="op" id="5665693">==</span>&nbsp;<span class="ident" id="5665696">token</span><span class="op" id="5665701">.</span><span class="ident" id="5665702">DEFINE</span>&nbsp;<span class="op" id="5665709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665714">p</span><span class="op" id="5665715">.</span><span class="ident" id="5665716">shortVarDecl</span><span class="op" id="5665728">(</span><span class="ident" id="5665729">as</span><span class="op" id="5665731">,</span>&nbsp;<span class="ident" id="5665733">x</span><span class="op" id="5665734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665742">return</span>&nbsp;<span class="ident" id="5665749">as</span><span class="op" id="5665751">,</span>&nbsp;<span class="ident" id="5665753">isRange</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665766">if</span>&nbsp;<span class="builtinfunc" id="5665769">len</span><span class="op" id="5665772">(</span><span class="ident" id="5665773">x</span><span class="op" id="5665774">)</span>&nbsp;<span class="op" id="5665776">&gt;</span>&nbsp;<span class="num" id="5665778">1</span>&nbsp;<span class="op" id="5665780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665784">p</span><span class="op" id="5665785">.</span><span class="ident" id="5665786">errorExpected</span><span class="op" id="5665799">(</span><span class="ident" id="5665800">x</span><span class="op" id="5665801">[</span><span class="num" id="5665802">0</span><span class="op" id="5665803">]</span><span class="op" id="5665804">.</span><span class="ident" id="5665805">Pos</span><span class="op" id="5665808">(</span><span class="op" id="5665809">)</span><span class="op" id="5665810">,</span>&nbsp;<span class="string" id="5665812">&#34;1&nbsp;expression&#34;</span><span class="op" id="5665826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5665830">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665869">switch</span>&nbsp;<span class="ident" id="5665876">p</span><span class="op" id="5665877">.</span><span class="ident" id="5665878">tok</span>&nbsp;<span class="op" id="5665882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665885">case</span>&nbsp;<span class="ident" id="5665890">token</span><span class="op" id="5665895">.</span><span class="ident" id="5665896">COLON</span><span class="op" id="5665901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5665905">//&nbsp;labeled&nbsp;statement</span><br>
<span class="lineno">1675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665928">colon</span>&nbsp;<span class="op" id="5665934">:=</span>&nbsp;<span class="ident" id="5665937">p</span><span class="op" id="5665938">.</span><span class="ident" id="5665939">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665945">p</span><span class="op" id="5665946">.</span><span class="ident" id="5665947">next</span><span class="op" id="5665951">(</span><span class="op" id="5665952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665956">if</span>&nbsp;<span class="ident" id="5665959">label</span><span class="op" id="5665964">,</span>&nbsp;<span class="ident" id="5665966">isIdent</span>&nbsp;<span class="op" id="5665974">:=</span>&nbsp;<span class="ident" id="5665977">x</span><span class="op" id="5665978">[</span><span class="num" id="5665979">0</span><span class="op" id="5665980">]</span><span class="op" id="5665981">.</span><span class="op" id="5665982">(</span><span class="op" id="5665983">*</span><span class="ident" id="5665984">ast</span><span class="op" id="5665987">.</span><span class="ident" id="5665988">Ident</span><span class="op" id="5665993">)</span><span class="op" id="5665994">;</span>&nbsp;<span class="ident" id="5665996">mode</span>&nbsp;<span class="op" id="5666001">==</span>&nbsp;<span class="ident" id="5666004">labelOk</span>&nbsp;<span class="op" id="5666012">&amp;&amp;</span>&nbsp;<span class="ident" id="5666015">isIdent</span>&nbsp;<span class="op" id="5666023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5666028">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;label&nbsp;is&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5666092">//&nbsp;in&nbsp;which&nbsp;it&nbsp;is&nbsp;declared&nbsp;and&nbsp;excludes&nbsp;the&nbsp;body&nbsp;of&nbsp;any&nbsp;nested</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5666158">//&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666174">stmt</span>&nbsp;<span class="op" id="5666179">:=</span>&nbsp;<span class="op" id="5666182">&amp;</span><span class="ident" id="5666183">ast</span><span class="op" id="5666186">.</span><span class="ident" id="5666187">LabeledStmt</span><span class="op" id="5666198">{</span><span class="ident" id="5666199">Label</span><span class="op" id="5666204">:</span>&nbsp;<span class="ident" id="5666206">label</span><span class="op" id="5666211">,</span>&nbsp;<span class="ident" id="5666213">Colon</span><span class="op" id="5666218">:</span>&nbsp;<span class="ident" id="5666220">colon</span><span class="op" id="5666225">,</span>&nbsp;<span class="ident" id="5666227">Stmt</span><span class="op" id="5666231">:</span>&nbsp;<span class="ident" id="5666233">p</span><span class="op" id="5666234">.</span><span class="ident" id="5666235">parseStmt</span><span class="op" id="5666244">(</span><span class="op" id="5666245">)</span><span class="op" id="5666246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666251">p</span><span class="op" id="5666252">.</span><span class="ident" id="5666253">declare</span><span class="op" id="5666260">(</span><span class="ident" id="5666261">stmt</span><span class="op" id="5666265">,</span>&nbsp;<span class="ident" id="5666267">nil</span><span class="op" id="5666270">,</span>&nbsp;<span class="ident" id="5666272">p</span><span class="op" id="5666273">.</span><span class="ident" id="5666274">labelScope</span><span class="op" id="5666284">,</span>&nbsp;<span class="ident" id="5666286">ast</span><span class="op" id="5666289">.</span><span class="ident" id="5666290">Lbl</span><span class="op" id="5666293">,</span>&nbsp;<span class="ident" id="5666295">label</span><span class="op" id="5666300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666305">return</span>&nbsp;<span class="ident" id="5666312">stmt</span><span class="op" id="5666316">,</span>&nbsp;<span class="builtintype" id="5666318">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666326">}</span><br>
<span class="lineno">1685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5666330">//&nbsp;The&nbsp;label&nbsp;declaration&nbsp;typically&nbsp;starts&nbsp;at&nbsp;x[0].Pos(),&nbsp;but&nbsp;the&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5666403">//&nbsp;declaration&nbsp;may&nbsp;be&nbsp;erroneous&nbsp;due&nbsp;to&nbsp;a&nbsp;token&nbsp;after&nbsp;that&nbsp;position&nbsp;(and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5666477">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;).&nbsp;If&nbsp;SpuriousErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;the&nbsp;(only)&nbsp;error&nbsp;re-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5666550">//&nbsp;ported&nbsp;for&nbsp;the&nbsp;line&nbsp;is&nbsp;the&nbsp;illegal&nbsp;label&nbsp;error&nbsp;instead&nbsp;of&nbsp;the&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5666623">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;&nbsp;that&nbsp;caused&nbsp;the&nbsp;problem.&nbsp;Thus,&nbsp;use&nbsp;the&nbsp;(latest)&nbsp;colon</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5666697">//&nbsp;position&nbsp;for&nbsp;error&nbsp;reporting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666732">p</span><span class="op" id="5666733">.</span><span class="builtintype" id="5666734">error</span><span class="op" id="5666739">(</span><span class="ident" id="5666740">colon</span><span class="op" id="5666745">,</span>&nbsp;<span class="string" id="5666747">&#34;illegal&nbsp;label&nbsp;declaration&#34;</span><span class="op" id="5666774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666778">return</span>&nbsp;<span class="op" id="5666785">&amp;</span><span class="ident" id="5666786">ast</span><span class="op" id="5666789">.</span><span class="ident" id="5666790">BadStmt</span><span class="op" id="5666797">{</span><span class="ident" id="5666798">From</span><span class="op" id="5666802">:</span>&nbsp;<span class="ident" id="5666804">x</span><span class="op" id="5666805">[</span><span class="num" id="5666806">0</span><span class="op" id="5666807">]</span><span class="op" id="5666808">.</span><span class="ident" id="5666809">Pos</span><span class="op" id="5666812">(</span><span class="op" id="5666813">)</span><span class="op" id="5666814">,</span>&nbsp;<span class="ident" id="5666816">To</span><span class="op" id="5666818">:</span>&nbsp;<span class="ident" id="5666820">colon</span>&nbsp;<span class="op" id="5666826">+</span>&nbsp;<span class="num" id="5666828">1</span><span class="op" id="5666829">}</span><span class="op" id="5666830">,</span>&nbsp;<span class="builtintype" id="5666832">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666840">case</span>&nbsp;<span class="ident" id="5666845">token</span><span class="op" id="5666850">.</span><span class="ident" id="5666851">ARROW</span><span class="op" id="5666856">:</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5666860">//&nbsp;send&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666880">arrow</span>&nbsp;<span class="op" id="5666886">:=</span>&nbsp;<span class="ident" id="5666889">p</span><span class="op" id="5666890">.</span><span class="ident" id="5666891">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666897">p</span><span class="op" id="5666898">.</span><span class="ident" id="5666899">next</span><span class="op" id="5666903">(</span><span class="op" id="5666904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666908">y</span>&nbsp;<span class="op" id="5666910">:=</span>&nbsp;<span class="ident" id="5666913">p</span><span class="op" id="5666914">.</span><span class="ident" id="5666915">parseRhs</span><span class="op" id="5666923">(</span><span class="op" id="5666924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666928">return</span>&nbsp;<span class="op" id="5666935">&amp;</span><span class="ident" id="5666936">ast</span><span class="op" id="5666939">.</span><span class="ident" id="5666940">SendStmt</span><span class="op" id="5666948">{</span><span class="ident" id="5666949">Chan</span><span class="op" id="5666953">:</span>&nbsp;<span class="ident" id="5666955">x</span><span class="op" id="5666956">[</span><span class="num" id="5666957">0</span><span class="op" id="5666958">]</span><span class="op" id="5666959">,</span>&nbsp;<span class="ident" id="5666961">Arrow</span><span class="op" id="5666966">:</span>&nbsp;<span class="ident" id="5666968">arrow</span><span class="op" id="5666973">,</span>&nbsp;<span class="ident" id="5666975">Value</span><span class="op" id="5666980">:</span>&nbsp;<span class="ident" id="5666982">y</span><span class="op" id="5666983">}</span><span class="op" id="5666984">,</span>&nbsp;<span class="builtintype" id="5666986">false</span><br>
<span class="lineno">1700</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666994">case</span>&nbsp;<span class="ident" id="5666999">token</span><span class="op" id="5667004">.</span><span class="ident" id="5667005">INC</span><span class="op" id="5667008">,</span>&nbsp;<span class="ident" id="5667010">token</span><span class="op" id="5667015">.</span><span class="ident" id="5667016">DEC</span><span class="op" id="5667019">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667023">//&nbsp;increment&nbsp;or&nbsp;decrement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667051">s</span>&nbsp;<span class="op" id="5667053">:=</span>&nbsp;<span class="op" id="5667056">&amp;</span><span class="ident" id="5667057">ast</span><span class="op" id="5667060">.</span><span class="ident" id="5667061">IncDecStmt</span><span class="op" id="5667071">{</span><span class="ident" id="5667072">X</span><span class="op" id="5667073">:</span>&nbsp;<span class="ident" id="5667075">x</span><span class="op" id="5667076">[</span><span class="num" id="5667077">0</span><span class="op" id="5667078">]</span><span class="op" id="5667079">,</span>&nbsp;<span class="ident" id="5667081">TokPos</span><span class="op" id="5667087">:</span>&nbsp;<span class="ident" id="5667089">p</span><span class="op" id="5667090">.</span><span class="ident" id="5667091">pos</span><span class="op" id="5667094">,</span>&nbsp;<span class="ident" id="5667096">Tok</span><span class="op" id="5667099">:</span>&nbsp;<span class="ident" id="5667101">p</span><span class="op" id="5667102">.</span><span class="ident" id="5667103">tok</span><span class="op" id="5667106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667110">p</span><span class="op" id="5667111">.</span><span class="ident" id="5667112">next</span><span class="op" id="5667116">(</span><span class="op" id="5667117">)</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667121">return</span>&nbsp;<span class="ident" id="5667128">s</span><span class="op" id="5667129">,</span>&nbsp;<span class="builtintype" id="5667131">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667142">//&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667157">return</span>&nbsp;<span class="op" id="5667164">&amp;</span><span class="ident" id="5667165">ast</span><span class="op" id="5667168">.</span><span class="ident" id="5667169">ExprStmt</span><span class="op" id="5667177">{</span><span class="ident" id="5667178">X</span><span class="op" id="5667179">:</span>&nbsp;<span class="ident" id="5667181">x</span><span class="op" id="5667182">[</span><span class="num" id="5667183">0</span><span class="op" id="5667184">]</span><span class="op" id="5667185">}</span><span class="op" id="5667186">,</span>&nbsp;<span class="builtintype" id="5667188">false</span><br>
<span class="lineno">1710</span><span class="op" id="5667194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5667197">func</span>&nbsp;<span class="op" id="5667202">(</span><span class="ident" id="5667203">p</span>&nbsp;<span class="op" id="5667205">*</span><span class="ident" id="5667206">parser</span><span class="op" id="5667212">)</span>&nbsp;<span class="ident" id="5667214">parseCallExpr</span><span class="op" id="5667227">(</span><span class="ident" id="5667228">callType</span>&nbsp;<span class="builtintype" id="5667237">string</span><span class="op" id="5667243">)</span>&nbsp;<span class="op" id="5667245">*</span><span class="ident" id="5667246">ast</span><span class="op" id="5667249">.</span><span class="ident" id="5667250">CallExpr</span>&nbsp;<span class="op" id="5667259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667262">x</span>&nbsp;<span class="op" id="5667264">:=</span>&nbsp;<span class="ident" id="5667267">p</span><span class="op" id="5667268">.</span><span class="ident" id="5667269">parseRhsOrType</span><span class="op" id="5667283">(</span><span class="op" id="5667284">)</span>&nbsp;<span class="comment" id="5667286">//&nbsp;could&nbsp;be&nbsp;a&nbsp;conversion:&nbsp;(some&nbsp;type)(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667328">if</span>&nbsp;<span class="ident" id="5667331">call</span><span class="op" id="5667335">,</span>&nbsp;<span class="ident" id="5667337">isCall</span>&nbsp;<span class="op" id="5667344">:=</span>&nbsp;<span class="ident" id="5667347">x</span><span class="op" id="5667348">.</span><span class="op" id="5667349">(</span><span class="op" id="5667350">*</span><span class="ident" id="5667351">ast</span><span class="op" id="5667354">.</span><span class="ident" id="5667355">CallExpr</span><span class="op" id="5667363">)</span><span class="op" id="5667364">;</span>&nbsp;<span class="ident" id="5667366">isCall</span>&nbsp;<span class="op" id="5667373">{</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667377">return</span>&nbsp;<span class="ident" id="5667384">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667393">if</span>&nbsp;<span class="ident" id="5667396">_</span><span class="op" id="5667397">,</span>&nbsp;<span class="ident" id="5667399">isBad</span>&nbsp;<span class="op" id="5667405">:=</span>&nbsp;<span class="ident" id="5667408">x</span><span class="op" id="5667409">.</span><span class="op" id="5667410">(</span><span class="op" id="5667411">*</span><span class="ident" id="5667412">ast</span><span class="op" id="5667415">.</span><span class="ident" id="5667416">BadExpr</span><span class="op" id="5667423">)</span><span class="op" id="5667424">;</span>&nbsp;<span class="op" id="5667426">!</span><span class="ident" id="5667427">isBad</span>&nbsp;<span class="op" id="5667433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667437">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667478">p</span><span class="op" id="5667479">.</span><span class="builtintype" id="5667480">error</span><span class="op" id="5667485">(</span><span class="ident" id="5667486">p</span><span class="op" id="5667487">.</span><span class="ident" id="5667488">safePos</span><span class="op" id="5667495">(</span><span class="ident" id="5667496">x</span><span class="op" id="5667497">.</span><span class="ident" id="5667498">End</span><span class="op" id="5667501">(</span><span class="op" id="5667502">)</span><span class="op" id="5667503">)</span><span class="op" id="5667504">,</span>&nbsp;<span class="ident" id="5667506">fmt</span><span class="op" id="5667509">.</span><span class="ident" id="5667510">Sprintf</span><span class="op" id="5667517">(</span><span class="string" id="5667518">&#34;function&nbsp;must&nbsp;be&nbsp;invoked&nbsp;in&nbsp;%s&nbsp;statement&#34;</span><span class="op" id="5667560">,</span>&nbsp;<span class="ident" id="5667562">callType</span><span class="op" id="5667570">)</span><span class="op" id="5667571">)</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667577">return</span>&nbsp;<span class="ident" id="5667584">nil</span><br>
<span class="lineno"></span><span class="op" id="5667588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5667591">func</span>&nbsp;<span class="op" id="5667596">(</span><span class="ident" id="5667597">p</span>&nbsp;<span class="op" id="5667599">*</span><span class="ident" id="5667600">parser</span><span class="op" id="5667606">)</span>&nbsp;<span class="ident" id="5667608">parseGoStmt</span><span class="op" id="5667619">(</span><span class="op" id="5667620">)</span>&nbsp;<span class="ident" id="5667622">ast</span><span class="op" id="5667625">.</span><span class="ident" id="5667626">Stmt</span>&nbsp;<span class="op" id="5667631">{</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667634">if</span>&nbsp;<span class="ident" id="5667637">p</span><span class="op" id="5667638">.</span><span class="ident" id="5667639">trace</span>&nbsp;<span class="op" id="5667645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667649">defer</span>&nbsp;<span class="ident" id="5667655">un</span><span class="op" id="5667657">(</span><span class="ident" id="5667658">trace</span><span class="op" id="5667663">(</span><span class="ident" id="5667664">p</span><span class="op" id="5667665">,</span>&nbsp;<span class="string" id="5667667">&#34;GoStmt&#34;</span><span class="op" id="5667675">)</span><span class="op" id="5667676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667683">pos</span>&nbsp;<span class="op" id="5667687">:=</span>&nbsp;<span class="ident" id="5667690">p</span><span class="op" id="5667691">.</span><span class="ident" id="5667692">expect</span><span class="op" id="5667698">(</span><span class="ident" id="5667699">token</span><span class="op" id="5667704">.</span><span class="ident" id="5667705">GO</span><span class="op" id="5667707">)</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667710">call</span>&nbsp;<span class="op" id="5667715">:=</span>&nbsp;<span class="ident" id="5667718">p</span><span class="op" id="5667719">.</span><span class="ident" id="5667720">parseCallExpr</span><span class="op" id="5667733">(</span><span class="string" id="5667734">&#34;go&#34;</span><span class="op" id="5667738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667741">p</span><span class="op" id="5667742">.</span><span class="ident" id="5667743">expectSemi</span><span class="op" id="5667753">(</span><span class="op" id="5667754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667757">if</span>&nbsp;<span class="ident" id="5667760">call</span>&nbsp;<span class="op" id="5667765">==</span>&nbsp;<span class="ident" id="5667768">nil</span>&nbsp;<span class="op" id="5667772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667776">return</span>&nbsp;<span class="op" id="5667783">&amp;</span><span class="ident" id="5667784">ast</span><span class="op" id="5667787">.</span><span class="ident" id="5667788">BadStmt</span><span class="op" id="5667795">{</span><span class="ident" id="5667796">From</span><span class="op" id="5667800">:</span>&nbsp;<span class="ident" id="5667802">pos</span><span class="op" id="5667805">,</span>&nbsp;<span class="ident" id="5667807">To</span><span class="op" id="5667809">:</span>&nbsp;<span class="ident" id="5667811">pos</span>&nbsp;<span class="op" id="5667815">+</span>&nbsp;<span class="num" id="5667817">2</span><span class="op" id="5667818">}</span>&nbsp;<span class="comment" id="5667820">//&nbsp;len(&#34;go&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667834">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667838">return</span>&nbsp;<span class="op" id="5667845">&amp;</span><span class="ident" id="5667846">ast</span><span class="op" id="5667849">.</span><span class="ident" id="5667850">GoStmt</span><span class="op" id="5667856">{</span><span class="ident" id="5667857">Go</span><span class="op" id="5667859">:</span>&nbsp;<span class="ident" id="5667861">pos</span><span class="op" id="5667864">,</span>&nbsp;<span class="ident" id="5667866">Call</span><span class="op" id="5667870">:</span>&nbsp;<span class="ident" id="5667872">call</span><span class="op" id="5667876">}</span><br>
<span class="lineno"></span><span class="op" id="5667878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5667881">func</span>&nbsp;<span class="op" id="5667886">(</span><span class="ident" id="5667887">p</span>&nbsp;<span class="op" id="5667889">*</span><span class="ident" id="5667890">parser</span><span class="op" id="5667896">)</span>&nbsp;<span class="ident" id="5667898">parseDeferStmt</span><span class="op" id="5667912">(</span><span class="op" id="5667913">)</span>&nbsp;<span class="ident" id="5667915">ast</span><span class="op" id="5667918">.</span><span class="ident" id="5667919">Stmt</span>&nbsp;<span class="op" id="5667924">{</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667927">if</span>&nbsp;<span class="ident" id="5667930">p</span><span class="op" id="5667931">.</span><span class="ident" id="5667932">trace</span>&nbsp;<span class="op" id="5667938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667942">defer</span>&nbsp;<span class="ident" id="5667948">un</span><span class="op" id="5667950">(</span><span class="ident" id="5667951">trace</span><span class="op" id="5667956">(</span><span class="ident" id="5667957">p</span><span class="op" id="5667958">,</span>&nbsp;<span class="string" id="5667960">&#34;DeferStmt&#34;</span><span class="op" id="5667971">)</span><span class="op" id="5667972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667979">pos</span>&nbsp;<span class="op" id="5667983">:=</span>&nbsp;<span class="ident" id="5667986">p</span><span class="op" id="5667987">.</span><span class="ident" id="5667988">expect</span><span class="op" id="5667994">(</span><span class="ident" id="5667995">token</span><span class="op" id="5668000">.</span><span class="ident" id="5668001">DEFER</span><span class="op" id="5668006">)</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668009">call</span>&nbsp;<span class="op" id="5668014">:=</span>&nbsp;<span class="ident" id="5668017">p</span><span class="op" id="5668018">.</span><span class="ident" id="5668019">parseCallExpr</span><span class="op" id="5668032">(</span><span class="string" id="5668033">&#34;defer&#34;</span><span class="op" id="5668040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668043">p</span><span class="op" id="5668044">.</span><span class="ident" id="5668045">expectSemi</span><span class="op" id="5668055">(</span><span class="op" id="5668056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668059">if</span>&nbsp;<span class="ident" id="5668062">call</span>&nbsp;<span class="op" id="5668067">==</span>&nbsp;<span class="ident" id="5668070">nil</span>&nbsp;<span class="op" id="5668074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668078">return</span>&nbsp;<span class="op" id="5668085">&amp;</span><span class="ident" id="5668086">ast</span><span class="op" id="5668089">.</span><span class="ident" id="5668090">BadStmt</span><span class="op" id="5668097">{</span><span class="ident" id="5668098">From</span><span class="op" id="5668102">:</span>&nbsp;<span class="ident" id="5668104">pos</span><span class="op" id="5668107">,</span>&nbsp;<span class="ident" id="5668109">To</span><span class="op" id="5668111">:</span>&nbsp;<span class="ident" id="5668113">pos</span>&nbsp;<span class="op" id="5668117">+</span>&nbsp;<span class="num" id="5668119">5</span><span class="op" id="5668120">}</span>&nbsp;<span class="comment" id="5668122">//&nbsp;len(&#34;defer&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668139">}</span><br>
<span class="lineno">1750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668143">return</span>&nbsp;<span class="op" id="5668150">&amp;</span><span class="ident" id="5668151">ast</span><span class="op" id="5668154">.</span><span class="ident" id="5668155">DeferStmt</span><span class="op" id="5668164">{</span><span class="ident" id="5668165">Defer</span><span class="op" id="5668170">:</span>&nbsp;<span class="ident" id="5668172">pos</span><span class="op" id="5668175">,</span>&nbsp;<span class="ident" id="5668177">Call</span><span class="op" id="5668181">:</span>&nbsp;<span class="ident" id="5668183">call</span><span class="op" id="5668187">}</span><br>
<span class="lineno"></span><span class="op" id="5668189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5668192">func</span>&nbsp;<span class="op" id="5668197">(</span><span class="ident" id="5668198">p</span>&nbsp;<span class="op" id="5668200">*</span><span class="ident" id="5668201">parser</span><span class="op" id="5668207">)</span>&nbsp;<span class="ident" id="5668209">parseReturnStmt</span><span class="op" id="5668224">(</span><span class="op" id="5668225">)</span>&nbsp;<span class="op" id="5668227">*</span><span class="ident" id="5668228">ast</span><span class="op" id="5668231">.</span><span class="ident" id="5668232">ReturnStmt</span>&nbsp;<span class="op" id="5668243">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668246">if</span>&nbsp;<span class="ident" id="5668249">p</span><span class="op" id="5668250">.</span><span class="ident" id="5668251">trace</span>&nbsp;<span class="op" id="5668257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668261">defer</span>&nbsp;<span class="ident" id="5668267">un</span><span class="op" id="5668269">(</span><span class="ident" id="5668270">trace</span><span class="op" id="5668275">(</span><span class="ident" id="5668276">p</span><span class="op" id="5668277">,</span>&nbsp;<span class="string" id="5668279">&#34;ReturnStmt&#34;</span><span class="op" id="5668291">)</span><span class="op" id="5668292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668299">pos</span>&nbsp;<span class="op" id="5668303">:=</span>&nbsp;<span class="ident" id="5668306">p</span><span class="op" id="5668307">.</span><span class="ident" id="5668308">pos</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668313">p</span><span class="op" id="5668314">.</span><span class="ident" id="5668315">expect</span><span class="op" id="5668321">(</span><span class="ident" id="5668322">token</span><span class="op" id="5668327">.</span><span class="ident" id="5668328">RETURN</span><span class="op" id="5668334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668337">var</span>&nbsp;<span class="ident" id="5668341">x</span>&nbsp;<span class="op" id="5668343">[</span><span class="op" id="5668344">]</span><span class="ident" id="5668345">ast</span><span class="op" id="5668348">.</span><span class="ident" id="5668349">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668355">if</span>&nbsp;<span class="ident" id="5668358">p</span><span class="op" id="5668359">.</span><span class="ident" id="5668360">tok</span>&nbsp;<span class="op" id="5668364">!=</span>&nbsp;<span class="ident" id="5668367">token</span><span class="op" id="5668372">.</span><span class="ident" id="5668373">SEMICOLON</span>&nbsp;<span class="op" id="5668383">&amp;&amp;</span>&nbsp;<span class="ident" id="5668386">p</span><span class="op" id="5668387">.</span><span class="ident" id="5668388">tok</span>&nbsp;<span class="op" id="5668392">!=</span>&nbsp;<span class="ident" id="5668395">token</span><span class="op" id="5668400">.</span><span class="ident" id="5668401">RBRACE</span>&nbsp;<span class="op" id="5668408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668412">x</span>&nbsp;<span class="op" id="5668414">=</span>&nbsp;<span class="ident" id="5668416">p</span><span class="op" id="5668417">.</span><span class="ident" id="5668418">parseRhsList</span><span class="op" id="5668430">(</span><span class="op" id="5668431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668434">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668437">p</span><span class="op" id="5668438">.</span><span class="ident" id="5668439">expectSemi</span><span class="op" id="5668449">(</span><span class="op" id="5668450">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668454">return</span>&nbsp;<span class="op" id="5668461">&amp;</span><span class="ident" id="5668462">ast</span><span class="op" id="5668465">.</span><span class="ident" id="5668466">ReturnStmt</span><span class="op" id="5668476">{</span><span class="ident" id="5668477">Return</span><span class="op" id="5668483">:</span>&nbsp;<span class="ident" id="5668485">pos</span><span class="op" id="5668488">,</span>&nbsp;<span class="ident" id="5668490">Results</span><span class="op" id="5668497">:</span>&nbsp;<span class="ident" id="5668499">x</span><span class="op" id="5668500">}</span><br>
<span class="lineno"></span><span class="op" id="5668502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1770</span><span class="keyword" id="5668505">func</span>&nbsp;<span class="op" id="5668510">(</span><span class="ident" id="5668511">p</span>&nbsp;<span class="op" id="5668513">*</span><span class="ident" id="5668514">parser</span><span class="op" id="5668520">)</span>&nbsp;<span class="ident" id="5668522">parseBranchStmt</span><span class="op" id="5668537">(</span><span class="ident" id="5668538">tok</span>&nbsp;<span class="ident" id="5668542">token</span><span class="op" id="5668547">.</span><span class="ident" id="5668548">Token</span><span class="op" id="5668553">)</span>&nbsp;<span class="op" id="5668555">*</span><span class="ident" id="5668556">ast</span><span class="op" id="5668559">.</span><span class="ident" id="5668560">BranchStmt</span>&nbsp;<span class="op" id="5668571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668574">if</span>&nbsp;<span class="ident" id="5668577">p</span><span class="op" id="5668578">.</span><span class="ident" id="5668579">trace</span>&nbsp;<span class="op" id="5668585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668589">defer</span>&nbsp;<span class="ident" id="5668595">un</span><span class="op" id="5668597">(</span><span class="ident" id="5668598">trace</span><span class="op" id="5668603">(</span><span class="ident" id="5668604">p</span><span class="op" id="5668605">,</span>&nbsp;<span class="string" id="5668607">&#34;BranchStmt&#34;</span><span class="op" id="5668619">)</span><span class="op" id="5668620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668627">pos</span>&nbsp;<span class="op" id="5668631">:=</span>&nbsp;<span class="ident" id="5668634">p</span><span class="op" id="5668635">.</span><span class="ident" id="5668636">expect</span><span class="op" id="5668642">(</span><span class="ident" id="5668643">tok</span><span class="op" id="5668646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668649">var</span>&nbsp;<span class="ident" id="5668653">label</span>&nbsp;<span class="op" id="5668659">*</span><span class="ident" id="5668660">ast</span><span class="op" id="5668663">.</span><span class="ident" id="5668664">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668671">if</span>&nbsp;<span class="ident" id="5668674">tok</span>&nbsp;<span class="op" id="5668678">!=</span>&nbsp;<span class="ident" id="5668681">token</span><span class="op" id="5668686">.</span><span class="ident" id="5668687">FALLTHROUGH</span>&nbsp;<span class="op" id="5668699">&amp;&amp;</span>&nbsp;<span class="ident" id="5668702">p</span><span class="op" id="5668703">.</span><span class="ident" id="5668704">tok</span>&nbsp;<span class="op" id="5668708">==</span>&nbsp;<span class="ident" id="5668711">token</span><span class="op" id="5668716">.</span><span class="ident" id="5668717">IDENT</span>&nbsp;<span class="op" id="5668723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668727">label</span>&nbsp;<span class="op" id="5668733">=</span>&nbsp;<span class="ident" id="5668735">p</span><span class="op" id="5668736">.</span><span class="ident" id="5668737">parseIdent</span><span class="op" id="5668747">(</span><span class="op" id="5668748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5668752">//&nbsp;add&nbsp;to&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;targets</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668791">n</span>&nbsp;<span class="op" id="5668793">:=</span>&nbsp;<span class="builtinfunc" id="5668796">len</span><span class="op" id="5668799">(</span><span class="ident" id="5668800">p</span><span class="op" id="5668801">.</span><span class="ident" id="5668802">targetStack</span><span class="op" id="5668813">)</span>&nbsp;<span class="op" id="5668815">-</span>&nbsp;<span class="num" id="5668817">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668821">p</span><span class="op" id="5668822">.</span><span class="ident" id="5668823">targetStack</span><span class="op" id="5668834">[</span><span class="ident" id="5668835">n</span><span class="op" id="5668836">]</span>&nbsp;<span class="op" id="5668838">=</span>&nbsp;<span class="builtinfunc" id="5668840">append</span><span class="op" id="5668846">(</span><span class="ident" id="5668847">p</span><span class="op" id="5668848">.</span><span class="ident" id="5668849">targetStack</span><span class="op" id="5668860">[</span><span class="ident" id="5668861">n</span><span class="op" id="5668862">]</span><span class="op" id="5668863">,</span>&nbsp;<span class="ident" id="5668865">label</span><span class="op" id="5668870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668876">p</span><span class="op" id="5668877">.</span><span class="ident" id="5668878">expectSemi</span><span class="op" id="5668888">(</span><span class="op" id="5668889">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668893">return</span>&nbsp;<span class="op" id="5668900">&amp;</span><span class="ident" id="5668901">ast</span><span class="op" id="5668904">.</span><span class="ident" id="5668905">BranchStmt</span><span class="op" id="5668915">{</span><span class="ident" id="5668916">TokPos</span><span class="op" id="5668922">:</span>&nbsp;<span class="ident" id="5668924">pos</span><span class="op" id="5668927">,</span>&nbsp;<span class="ident" id="5668929">Tok</span><span class="op" id="5668932">:</span>&nbsp;<span class="ident" id="5668934">tok</span><span class="op" id="5668937">,</span>&nbsp;<span class="ident" id="5668939">Label</span><span class="op" id="5668944">:</span>&nbsp;<span class="ident" id="5668946">label</span><span class="op" id="5668951">}</span><br>
<span class="lineno"></span><span class="op" id="5668953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5668956">func</span>&nbsp;<span class="op" id="5668961">(</span><span class="ident" id="5668962">p</span>&nbsp;<span class="op" id="5668964">*</span><span class="ident" id="5668965">parser</span><span class="op" id="5668971">)</span>&nbsp;<span class="ident" id="5668973">makeExpr</span><span class="op" id="5668981">(</span><span class="ident" id="5668982">s</span>&nbsp;<span class="ident" id="5668984">ast</span><span class="op" id="5668987">.</span><span class="ident" id="5668988">Stmt</span><span class="op" id="5668992">,</span>&nbsp;<span class="ident" id="5668994">kind</span>&nbsp;<span class="builtintype" id="5668999">string</span><span class="op" id="5669005">)</span>&nbsp;<span class="ident" id="5669007">ast</span><span class="op" id="5669010">.</span><span class="ident" id="5669011">Expr</span>&nbsp;<span class="op" id="5669016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669019">if</span>&nbsp;<span class="ident" id="5669022">s</span>&nbsp;<span class="op" id="5669024">==</span>&nbsp;<span class="ident" id="5669027">nil</span>&nbsp;<span class="op" id="5669031">{</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669035">return</span>&nbsp;<span class="ident" id="5669042">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669050">if</span>&nbsp;<span class="ident" id="5669053">es</span><span class="op" id="5669055">,</span>&nbsp;<span class="ident" id="5669057">isExpr</span>&nbsp;<span class="op" id="5669064">:=</span>&nbsp;<span class="ident" id="5669067">s</span><span class="op" id="5669068">.</span><span class="op" id="5669069">(</span><span class="op" id="5669070">*</span><span class="ident" id="5669071">ast</span><span class="op" id="5669074">.</span><span class="ident" id="5669075">ExprStmt</span><span class="op" id="5669083">)</span><span class="op" id="5669084">;</span>&nbsp;<span class="ident" id="5669086">isExpr</span>&nbsp;<span class="op" id="5669093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669097">return</span>&nbsp;<span class="ident" id="5669104">p</span><span class="op" id="5669105">.</span><span class="ident" id="5669106">checkExpr</span><span class="op" id="5669115">(</span><span class="ident" id="5669116">es</span><span class="op" id="5669118">.</span><span class="ident" id="5669119">X</span><span class="op" id="5669120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669123">}</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669126">p</span><span class="op" id="5669127">.</span><span class="builtintype" id="5669128">error</span><span class="op" id="5669133">(</span><span class="ident" id="5669134">s</span><span class="op" id="5669135">.</span><span class="ident" id="5669136">Pos</span><span class="op" id="5669139">(</span><span class="op" id="5669140">)</span><span class="op" id="5669141">,</span>&nbsp;<span class="ident" id="5669143">fmt</span><span class="op" id="5669146">.</span><span class="ident" id="5669147">Sprintf</span><span class="op" id="5669154">(</span><span class="string" id="5669155">&#34;expected&nbsp;%s,&nbsp;found&nbsp;simple&nbsp;statement&nbsp;(missing&nbsp;parentheses&nbsp;around&nbsp;composite&nbsp;literal?)&#34;</span><span class="op" id="5669240">,</span>&nbsp;<span class="ident" id="5669242">kind</span><span class="op" id="5669246">)</span><span class="op" id="5669247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669250">return</span>&nbsp;<span class="op" id="5669257">&amp;</span><span class="ident" id="5669258">ast</span><span class="op" id="5669261">.</span><span class="ident" id="5669262">BadExpr</span><span class="op" id="5669269">{</span><span class="ident" id="5669270">From</span><span class="op" id="5669274">:</span>&nbsp;<span class="ident" id="5669276">s</span><span class="op" id="5669277">.</span><span class="ident" id="5669278">Pos</span><span class="op" id="5669281">(</span><span class="op" id="5669282">)</span><span class="op" id="5669283">,</span>&nbsp;<span class="ident" id="5669285">To</span><span class="op" id="5669287">:</span>&nbsp;<span class="ident" id="5669289">p</span><span class="op" id="5669290">.</span><span class="ident" id="5669291">safePos</span><span class="op" id="5669298">(</span><span class="ident" id="5669299">s</span><span class="op" id="5669300">.</span><span class="ident" id="5669301">End</span><span class="op" id="5669304">(</span><span class="op" id="5669305">)</span><span class="op" id="5669306">)</span><span class="op" id="5669307">}</span><br>
<span class="lineno"></span><span class="op" id="5669309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5669312">func</span>&nbsp;<span class="op" id="5669317">(</span><span class="ident" id="5669318">p</span>&nbsp;<span class="op" id="5669320">*</span><span class="ident" id="5669321">parser</span><span class="op" id="5669327">)</span>&nbsp;<span class="ident" id="5669329">parseIfStmt</span><span class="op" id="5669340">(</span><span class="op" id="5669341">)</span>&nbsp;<span class="op" id="5669343">*</span><span class="ident" id="5669344">ast</span><span class="op" id="5669347">.</span><span class="ident" id="5669348">IfStmt</span>&nbsp;<span class="op" id="5669355">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669358">if</span>&nbsp;<span class="ident" id="5669361">p</span><span class="op" id="5669362">.</span><span class="ident" id="5669363">trace</span>&nbsp;<span class="op" id="5669369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669373">defer</span>&nbsp;<span class="ident" id="5669379">un</span><span class="op" id="5669381">(</span><span class="ident" id="5669382">trace</span><span class="op" id="5669387">(</span><span class="ident" id="5669388">p</span><span class="op" id="5669389">,</span>&nbsp;<span class="string" id="5669391">&#34;IfStmt&#34;</span><span class="op" id="5669399">)</span><span class="op" id="5669400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669407">pos</span>&nbsp;<span class="op" id="5669411">:=</span>&nbsp;<span class="ident" id="5669414">p</span><span class="op" id="5669415">.</span><span class="ident" id="5669416">expect</span><span class="op" id="5669422">(</span><span class="ident" id="5669423">token</span><span class="op" id="5669428">.</span><span class="ident" id="5669429">IF</span><span class="op" id="5669431">)</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669434">p</span><span class="op" id="5669435">.</span><span class="ident" id="5669436">openScope</span><span class="op" id="5669445">(</span><span class="op" id="5669446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669449">defer</span>&nbsp;<span class="ident" id="5669455">p</span><span class="op" id="5669456">.</span><span class="ident" id="5669457">closeScope</span><span class="op" id="5669467">(</span><span class="op" id="5669468">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669472">var</span>&nbsp;<span class="ident" id="5669476">s</span>&nbsp;<span class="ident" id="5669478">ast</span><span class="op" id="5669481">.</span><span class="ident" id="5669482">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669488">var</span>&nbsp;<span class="ident" id="5669492">x</span>&nbsp;<span class="ident" id="5669494">ast</span><span class="op" id="5669497">.</span><span class="ident" id="5669498">Expr</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669508">prevLev</span>&nbsp;<span class="op" id="5669516">:=</span>&nbsp;<span class="ident" id="5669519">p</span><span class="op" id="5669520">.</span><span class="ident" id="5669521">exprLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669531">p</span><span class="op" id="5669532">.</span><span class="ident" id="5669533">exprLev</span>&nbsp;<span class="op" id="5669541">=</span>&nbsp;<span class="op" id="5669543">-</span><span class="num" id="5669544">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669548">if</span>&nbsp;<span class="ident" id="5669551">p</span><span class="op" id="5669552">.</span><span class="ident" id="5669553">tok</span>&nbsp;<span class="op" id="5669557">==</span>&nbsp;<span class="ident" id="5669560">token</span><span class="op" id="5669565">.</span><span class="ident" id="5669566">SEMICOLON</span>&nbsp;<span class="op" id="5669576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669581">p</span><span class="op" id="5669582">.</span><span class="ident" id="5669583">next</span><span class="op" id="5669587">(</span><span class="op" id="5669588">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669593">x</span>&nbsp;<span class="op" id="5669595">=</span>&nbsp;<span class="ident" id="5669597">p</span><span class="op" id="5669598">.</span><span class="ident" id="5669599">parseRhs</span><span class="op" id="5669607">(</span><span class="op" id="5669608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669612">}</span>&nbsp;<span class="keyword" id="5669614">else</span>&nbsp;<span class="op" id="5669619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669624">s</span><span class="op" id="5669625">,</span>&nbsp;<span class="ident" id="5669627">_</span>&nbsp;<span class="op" id="5669629">=</span>&nbsp;<span class="ident" id="5669631">p</span><span class="op" id="5669632">.</span><span class="ident" id="5669633">parseSimpleStmt</span><span class="op" id="5669648">(</span><span class="ident" id="5669649">basic</span><span class="op" id="5669654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669659">if</span>&nbsp;<span class="ident" id="5669662">p</span><span class="op" id="5669663">.</span><span class="ident" id="5669664">tok</span>&nbsp;<span class="op" id="5669668">==</span>&nbsp;<span class="ident" id="5669671">token</span><span class="op" id="5669676">.</span><span class="ident" id="5669677">SEMICOLON</span>&nbsp;<span class="op" id="5669687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669693">p</span><span class="op" id="5669694">.</span><span class="ident" id="5669695">next</span><span class="op" id="5669699">(</span><span class="op" id="5669700">)</span><br>
<span class="lineno">1820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669706">x</span>&nbsp;<span class="op" id="5669708">=</span>&nbsp;<span class="ident" id="5669710">p</span><span class="op" id="5669711">.</span><span class="ident" id="5669712">parseRhs</span><span class="op" id="5669720">(</span><span class="op" id="5669721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669726">}</span>&nbsp;<span class="keyword" id="5669728">else</span>&nbsp;<span class="op" id="5669733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669739">x</span>&nbsp;<span class="op" id="5669741">=</span>&nbsp;<span class="ident" id="5669743">p</span><span class="op" id="5669744">.</span><span class="ident" id="5669745">makeExpr</span><span class="op" id="5669753">(</span><span class="ident" id="5669754">s</span><span class="op" id="5669755">,</span>&nbsp;<span class="string" id="5669757">&#34;boolean&nbsp;expression&#34;</span><span class="op" id="5669777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669783">s</span>&nbsp;<span class="op" id="5669785">=</span>&nbsp;<span class="ident" id="5669787">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669794">}</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669802">p</span><span class="op" id="5669803">.</span><span class="ident" id="5669804">exprLev</span>&nbsp;<span class="op" id="5669812">=</span>&nbsp;<span class="ident" id="5669814">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669827">body</span>&nbsp;<span class="op" id="5669832">:=</span>&nbsp;<span class="ident" id="5669835">p</span><span class="op" id="5669836">.</span><span class="ident" id="5669837">parseBlockStmt</span><span class="op" id="5669851">(</span><span class="op" id="5669852">)</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669855">var</span>&nbsp;<span class="ident" id="5669859">else_</span>&nbsp;<span class="ident" id="5669865">ast</span><span class="op" id="5669868">.</span><span class="ident" id="5669869">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669875">if</span>&nbsp;<span class="ident" id="5669878">p</span><span class="op" id="5669879">.</span><span class="ident" id="5669880">tok</span>&nbsp;<span class="op" id="5669884">==</span>&nbsp;<span class="ident" id="5669887">token</span><span class="op" id="5669892">.</span><span class="ident" id="5669893">ELSE</span>&nbsp;<span class="op" id="5669898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669902">p</span><span class="op" id="5669903">.</span><span class="ident" id="5669904">next</span><span class="op" id="5669908">(</span><span class="op" id="5669909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669913">else_</span>&nbsp;<span class="op" id="5669919">=</span>&nbsp;<span class="ident" id="5669921">p</span><span class="op" id="5669922">.</span><span class="ident" id="5669923">parseStmt</span><span class="op" id="5669932">(</span><span class="op" id="5669933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669936">}</span>&nbsp;<span class="keyword" id="5669938">else</span>&nbsp;<span class="op" id="5669943">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669947">p</span><span class="op" id="5669948">.</span><span class="ident" id="5669949">expectSemi</span><span class="op" id="5669959">(</span><span class="op" id="5669960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669967">return</span>&nbsp;<span class="op" id="5669974">&amp;</span><span class="ident" id="5669975">ast</span><span class="op" id="5669978">.</span><span class="ident" id="5669979">IfStmt</span><span class="op" id="5669985">{</span><span class="ident" id="5669986">If</span><span class="op" id="5669988">:</span>&nbsp;<span class="ident" id="5669990">pos</span><span class="op" id="5669993">,</span>&nbsp;<span class="ident" id="5669995">Init</span><span class="op" id="5669999">:</span>&nbsp;<span class="ident" id="5670001">s</span><span class="op" id="5670002">,</span>&nbsp;<span class="ident" id="5670004">Cond</span><span class="op" id="5670008">:</span>&nbsp;<span class="ident" id="5670010">x</span><span class="op" id="5670011">,</span>&nbsp;<span class="ident" id="5670013">Body</span><span class="op" id="5670017">:</span>&nbsp;<span class="ident" id="5670019">body</span><span class="op" id="5670023">,</span>&nbsp;<span class="ident" id="5670025">Else</span><span class="op" id="5670029">:</span>&nbsp;<span class="ident" id="5670031">else_</span><span class="op" id="5670036">}</span><br>
<span class="lineno"></span><span class="op" id="5670038">}</span><br>
<span class="lineno">1840</span><br>
<span class="lineno"></span><span class="keyword" id="5670041">func</span>&nbsp;<span class="op" id="5670046">(</span><span class="ident" id="5670047">p</span>&nbsp;<span class="op" id="5670049">*</span><span class="ident" id="5670050">parser</span><span class="op" id="5670056">)</span>&nbsp;<span class="ident" id="5670058">parseTypeList</span><span class="op" id="5670071">(</span><span class="op" id="5670072">)</span>&nbsp;<span class="op" id="5670074">(</span><span class="ident" id="5670075">list</span>&nbsp;<span class="op" id="5670080">[</span><span class="op" id="5670081">]</span><span class="ident" id="5670082">ast</span><span class="op" id="5670085">.</span><span class="ident" id="5670086">Expr</span><span class="op" id="5670090">)</span>&nbsp;<span class="op" id="5670092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670095">if</span>&nbsp;<span class="ident" id="5670098">p</span><span class="op" id="5670099">.</span><span class="ident" id="5670100">trace</span>&nbsp;<span class="op" id="5670106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670110">defer</span>&nbsp;<span class="ident" id="5670116">un</span><span class="op" id="5670118">(</span><span class="ident" id="5670119">trace</span><span class="op" id="5670124">(</span><span class="ident" id="5670125">p</span><span class="op" id="5670126">,</span>&nbsp;<span class="string" id="5670128">&#34;TypeList&#34;</span><span class="op" id="5670138">)</span><span class="op" id="5670139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670142">}</span><br>
<span class="lineno">1845</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670146">list</span>&nbsp;<span class="op" id="5670151">=</span>&nbsp;<span class="builtinfunc" id="5670153">append</span><span class="op" id="5670159">(</span><span class="ident" id="5670160">list</span><span class="op" id="5670164">,</span>&nbsp;<span class="ident" id="5670166">p</span><span class="op" id="5670167">.</span><span class="ident" id="5670168">parseType</span><span class="op" id="5670177">(</span><span class="op" id="5670178">)</span><span class="op" id="5670179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670182">for</span>&nbsp;<span class="ident" id="5670186">p</span><span class="op" id="5670187">.</span><span class="ident" id="5670188">tok</span>&nbsp;<span class="op" id="5670192">==</span>&nbsp;<span class="ident" id="5670195">token</span><span class="op" id="5670200">.</span><span class="ident" id="5670201">COMMA</span>&nbsp;<span class="op" id="5670207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670211">p</span><span class="op" id="5670212">.</span><span class="ident" id="5670213">next</span><span class="op" id="5670217">(</span><span class="op" id="5670218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670222">list</span>&nbsp;<span class="op" id="5670227">=</span>&nbsp;<span class="builtinfunc" id="5670229">append</span><span class="op" id="5670235">(</span><span class="ident" id="5670236">list</span><span class="op" id="5670240">,</span>&nbsp;<span class="ident" id="5670242">p</span><span class="op" id="5670243">.</span><span class="ident" id="5670244">parseType</span><span class="op" id="5670253">(</span><span class="op" id="5670254">)</span><span class="op" id="5670255">)</span><br>
<span class="lineno">1850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670262">return</span><br>
<span class="lineno"></span><span class="op" id="5670269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1855</span><span class="keyword" id="5670272">func</span>&nbsp;<span class="op" id="5670277">(</span><span class="ident" id="5670278">p</span>&nbsp;<span class="op" id="5670280">*</span><span class="ident" id="5670281">parser</span><span class="op" id="5670287">)</span>&nbsp;<span class="ident" id="5670289">parseCaseClause</span><span class="op" id="5670304">(</span><span class="ident" id="5670305">typeSwitch</span>&nbsp;<span class="builtintype" id="5670316">bool</span><span class="op" id="5670320">)</span>&nbsp;<span class="op" id="5670322">*</span><span class="ident" id="5670323">ast</span><span class="op" id="5670326">.</span><span class="ident" id="5670327">CaseClause</span>&nbsp;<span class="op" id="5670338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670341">if</span>&nbsp;<span class="ident" id="5670344">p</span><span class="op" id="5670345">.</span><span class="ident" id="5670346">trace</span>&nbsp;<span class="op" id="5670352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670356">defer</span>&nbsp;<span class="ident" id="5670362">un</span><span class="op" id="5670364">(</span><span class="ident" id="5670365">trace</span><span class="op" id="5670370">(</span><span class="ident" id="5670371">p</span><span class="op" id="5670372">,</span>&nbsp;<span class="string" id="5670374">&#34;CaseClause&#34;</span><span class="op" id="5670386">)</span><span class="op" id="5670387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670394">pos</span>&nbsp;<span class="op" id="5670398">:=</span>&nbsp;<span class="ident" id="5670401">p</span><span class="op" id="5670402">.</span><span class="ident" id="5670403">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670408">var</span>&nbsp;<span class="ident" id="5670412">list</span>&nbsp;<span class="op" id="5670417">[</span><span class="op" id="5670418">]</span><span class="ident" id="5670419">ast</span><span class="op" id="5670422">.</span><span class="ident" id="5670423">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670429">if</span>&nbsp;<span class="ident" id="5670432">p</span><span class="op" id="5670433">.</span><span class="ident" id="5670434">tok</span>&nbsp;<span class="op" id="5670438">==</span>&nbsp;<span class="ident" id="5670441">token</span><span class="op" id="5670446">.</span><span class="ident" id="5670447">CASE</span>&nbsp;<span class="op" id="5670452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670456">p</span><span class="op" id="5670457">.</span><span class="ident" id="5670458">next</span><span class="op" id="5670462">(</span><span class="op" id="5670463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670467">if</span>&nbsp;<span class="ident" id="5670470">typeSwitch</span>&nbsp;<span class="op" id="5670481">{</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670486">list</span>&nbsp;<span class="op" id="5670491">=</span>&nbsp;<span class="ident" id="5670493">p</span><span class="op" id="5670494">.</span><span class="ident" id="5670495">parseTypeList</span><span class="op" id="5670508">(</span><span class="op" id="5670509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670513">}</span>&nbsp;<span class="keyword" id="5670515">else</span>&nbsp;<span class="op" id="5670520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670525">list</span>&nbsp;<span class="op" id="5670530">=</span>&nbsp;<span class="ident" id="5670532">p</span><span class="op" id="5670533">.</span><span class="ident" id="5670534">parseRhsList</span><span class="op" id="5670546">(</span><span class="op" id="5670547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670554">}</span>&nbsp;<span class="keyword" id="5670556">else</span>&nbsp;<span class="op" id="5670561">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670565">p</span><span class="op" id="5670566">.</span><span class="ident" id="5670567">expect</span><span class="op" id="5670573">(</span><span class="ident" id="5670574">token</span><span class="op" id="5670579">.</span><span class="ident" id="5670580">DEFAULT</span><span class="op" id="5670587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670594">colon</span>&nbsp;<span class="op" id="5670600">:=</span>&nbsp;<span class="ident" id="5670603">p</span><span class="op" id="5670604">.</span><span class="ident" id="5670605">expect</span><span class="op" id="5670611">(</span><span class="ident" id="5670612">token</span><span class="op" id="5670617">.</span><span class="ident" id="5670618">COLON</span><span class="op" id="5670623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670626">p</span><span class="op" id="5670627">.</span><span class="ident" id="5670628">openScope</span><span class="op" id="5670637">(</span><span class="op" id="5670638">)</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670641">body</span>&nbsp;<span class="op" id="5670646">:=</span>&nbsp;<span class="ident" id="5670649">p</span><span class="op" id="5670650">.</span><span class="ident" id="5670651">parseStmtList</span><span class="op" id="5670664">(</span><span class="op" id="5670665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670668">p</span><span class="op" id="5670669">.</span><span class="ident" id="5670670">closeScope</span><span class="op" id="5670680">(</span><span class="op" id="5670681">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670685">return</span>&nbsp;<span class="op" id="5670692">&amp;</span><span class="ident" id="5670693">ast</span><span class="op" id="5670696">.</span><span class="ident" id="5670697">CaseClause</span><span class="op" id="5670707">{</span><span class="ident" id="5670708">Case</span><span class="op" id="5670712">:</span>&nbsp;<span class="ident" id="5670714">pos</span><span class="op" id="5670717">,</span>&nbsp;<span class="ident" id="5670719">List</span><span class="op" id="5670723">:</span>&nbsp;<span class="ident" id="5670725">list</span><span class="op" id="5670729">,</span>&nbsp;<span class="ident" id="5670731">Colon</span><span class="op" id="5670736">:</span>&nbsp;<span class="ident" id="5670738">colon</span><span class="op" id="5670743">,</span>&nbsp;<span class="ident" id="5670745">Body</span><span class="op" id="5670749">:</span>&nbsp;<span class="ident" id="5670751">body</span><span class="op" id="5670755">}</span><br>
<span class="lineno"></span><span class="op" id="5670757">}</span><br>
<span class="lineno">1880</span><br>
<span class="lineno"></span><span class="keyword" id="5670760">func</span>&nbsp;<span class="ident" id="5670765">isTypeSwitchAssert</span><span class="op" id="5670783">(</span><span class="ident" id="5670784">x</span>&nbsp;<span class="ident" id="5670786">ast</span><span class="op" id="5670789">.</span><span class="ident" id="5670790">Expr</span><span class="op" id="5670794">)</span>&nbsp;<span class="builtintype" id="5670796">bool</span>&nbsp;<span class="op" id="5670801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670804">a</span><span class="op" id="5670805">,</span>&nbsp;<span class="ident" id="5670807">ok</span>&nbsp;<span class="op" id="5670810">:=</span>&nbsp;<span class="ident" id="5670813">x</span><span class="op" id="5670814">.</span><span class="op" id="5670815">(</span><span class="op" id="5670816">*</span><span class="ident" id="5670817">ast</span><span class="op" id="5670820">.</span><span class="ident" id="5670821">TypeAssertExpr</span><span class="op" id="5670835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670838">return</span>&nbsp;<span class="ident" id="5670845">ok</span>&nbsp;<span class="op" id="5670848">&amp;&amp;</span>&nbsp;<span class="ident" id="5670851">a</span><span class="op" id="5670852">.</span><span class="ident" id="5670853">Type</span>&nbsp;<span class="op" id="5670858">==</span>&nbsp;<span class="ident" id="5670861">nil</span><br>
<span class="lineno"></span><span class="op" id="5670865">}</span><br>
<span class="lineno">1885</span><br>
<span class="lineno"></span><span class="keyword" id="5670868">func</span>&nbsp;<span class="ident" id="5670873">isTypeSwitchGuard</span><span class="op" id="5670890">(</span><span class="ident" id="5670891">s</span>&nbsp;<span class="ident" id="5670893">ast</span><span class="op" id="5670896">.</span><span class="ident" id="5670897">Stmt</span><span class="op" id="5670901">)</span>&nbsp;<span class="builtintype" id="5670903">bool</span>&nbsp;<span class="op" id="5670908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670911">switch</span>&nbsp;<span class="ident" id="5670918">t</span>&nbsp;<span class="op" id="5670920">:=</span>&nbsp;<span class="ident" id="5670923">s</span><span class="op" id="5670924">.</span><span class="op" id="5670925">(</span><span class="keyword" id="5670926">type</span><span class="op" id="5670930">)</span>&nbsp;<span class="op" id="5670932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670935">case</span>&nbsp;<span class="op" id="5670940">*</span><span class="ident" id="5670941">ast</span><span class="op" id="5670944">.</span><span class="ident" id="5670945">ExprStmt</span><span class="op" id="5670953">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670957">//&nbsp;x.(nil)</span><br>
<span class="lineno">1890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670970">return</span>&nbsp;<span class="ident" id="5670977">isTypeSwitchAssert</span><span class="op" id="5670995">(</span><span class="ident" id="5670996">t</span><span class="op" id="5670997">.</span><span class="ident" id="5670998">X</span><span class="op" id="5670999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671002">case</span>&nbsp;<span class="op" id="5671007">*</span><span class="ident" id="5671008">ast</span><span class="op" id="5671011">.</span><span class="ident" id="5671012">AssignStmt</span><span class="op" id="5671022">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671026">//&nbsp;v&nbsp;:=&nbsp;x.(nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671044">return</span>&nbsp;<span class="builtinfunc" id="5671051">len</span><span class="op" id="5671054">(</span><span class="ident" id="5671055">t</span><span class="op" id="5671056">.</span><span class="ident" id="5671057">Lhs</span><span class="op" id="5671060">)</span>&nbsp;<span class="op" id="5671062">==</span>&nbsp;<span class="num" id="5671065">1</span>&nbsp;<span class="op" id="5671067">&amp;&amp;</span>&nbsp;<span class="ident" id="5671070">t</span><span class="op" id="5671071">.</span><span class="ident" id="5671072">Tok</span>&nbsp;<span class="op" id="5671076">==</span>&nbsp;<span class="ident" id="5671079">token</span><span class="op" id="5671084">.</span><span class="ident" id="5671085">DEFINE</span>&nbsp;<span class="op" id="5671092">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5671095">len</span><span class="op" id="5671098">(</span><span class="ident" id="5671099">t</span><span class="op" id="5671100">.</span><span class="ident" id="5671101">Rhs</span><span class="op" id="5671104">)</span>&nbsp;<span class="op" id="5671106">==</span>&nbsp;<span class="num" id="5671109">1</span>&nbsp;<span class="op" id="5671111">&amp;&amp;</span>&nbsp;<span class="ident" id="5671114">isTypeSwitchAssert</span><span class="op" id="5671132">(</span><span class="ident" id="5671133">t</span><span class="op" id="5671134">.</span><span class="ident" id="5671135">Rhs</span><span class="op" id="5671138">[</span><span class="num" id="5671139">0</span><span class="op" id="5671140">]</span><span class="op" id="5671141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671144">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671147">return</span>&nbsp;<span class="builtintype" id="5671154">false</span><br>
<span class="lineno"></span><span class="op" id="5671160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5671163">func</span>&nbsp;<span class="op" id="5671168">(</span><span class="ident" id="5671169">p</span>&nbsp;<span class="op" id="5671171">*</span><span class="ident" id="5671172">parser</span><span class="op" id="5671178">)</span>&nbsp;<span class="ident" id="5671180">parseSwitchStmt</span><span class="op" id="5671195">(</span><span class="op" id="5671196">)</span>&nbsp;<span class="ident" id="5671198">ast</span><span class="op" id="5671201">.</span><span class="ident" id="5671202">Stmt</span>&nbsp;<span class="op" id="5671207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671210">if</span>&nbsp;<span class="ident" id="5671213">p</span><span class="op" id="5671214">.</span><span class="ident" id="5671215">trace</span>&nbsp;<span class="op" id="5671221">{</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671225">defer</span>&nbsp;<span class="ident" id="5671231">un</span><span class="op" id="5671233">(</span><span class="ident" id="5671234">trace</span><span class="op" id="5671239">(</span><span class="ident" id="5671240">p</span><span class="op" id="5671241">,</span>&nbsp;<span class="string" id="5671243">&#34;SwitchStmt&#34;</span><span class="op" id="5671255">)</span><span class="op" id="5671256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671263">pos</span>&nbsp;<span class="op" id="5671267">:=</span>&nbsp;<span class="ident" id="5671270">p</span><span class="op" id="5671271">.</span><span class="ident" id="5671272">expect</span><span class="op" id="5671278">(</span><span class="ident" id="5671279">token</span><span class="op" id="5671284">.</span><span class="ident" id="5671285">SWITCH</span><span class="op" id="5671291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671294">p</span><span class="op" id="5671295">.</span><span class="ident" id="5671296">openScope</span><span class="op" id="5671305">(</span><span class="op" id="5671306">)</span><br>
<span class="lineno">1905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671309">defer</span>&nbsp;<span class="ident" id="5671315">p</span><span class="op" id="5671316">.</span><span class="ident" id="5671317">closeScope</span><span class="op" id="5671327">(</span><span class="op" id="5671328">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671332">var</span>&nbsp;<span class="ident" id="5671336">s1</span><span class="op" id="5671338">,</span>&nbsp;<span class="ident" id="5671340">s2</span>&nbsp;<span class="ident" id="5671343">ast</span><span class="op" id="5671346">.</span><span class="ident" id="5671347">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671353">if</span>&nbsp;<span class="ident" id="5671356">p</span><span class="op" id="5671357">.</span><span class="ident" id="5671358">tok</span>&nbsp;<span class="op" id="5671362">!=</span>&nbsp;<span class="ident" id="5671365">token</span><span class="op" id="5671370">.</span><span class="ident" id="5671371">LBRACE</span>&nbsp;<span class="op" id="5671378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671382">prevLev</span>&nbsp;<span class="op" id="5671390">:=</span>&nbsp;<span class="ident" id="5671393">p</span><span class="op" id="5671394">.</span><span class="ident" id="5671395">exprLev</span><br>
<span class="lineno">1910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671405">p</span><span class="op" id="5671406">.</span><span class="ident" id="5671407">exprLev</span>&nbsp;<span class="op" id="5671415">=</span>&nbsp;<span class="op" id="5671417">-</span><span class="num" id="5671418">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671422">if</span>&nbsp;<span class="ident" id="5671425">p</span><span class="op" id="5671426">.</span><span class="ident" id="5671427">tok</span>&nbsp;<span class="op" id="5671431">!=</span>&nbsp;<span class="ident" id="5671434">token</span><span class="op" id="5671439">.</span><span class="ident" id="5671440">SEMICOLON</span>&nbsp;<span class="op" id="5671450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671455">s2</span><span class="op" id="5671457">,</span>&nbsp;<span class="ident" id="5671459">_</span>&nbsp;<span class="op" id="5671461">=</span>&nbsp;<span class="ident" id="5671463">p</span><span class="op" id="5671464">.</span><span class="ident" id="5671465">parseSimpleStmt</span><span class="op" id="5671480">(</span><span class="ident" id="5671481">basic</span><span class="op" id="5671486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671494">if</span>&nbsp;<span class="ident" id="5671497">p</span><span class="op" id="5671498">.</span><span class="ident" id="5671499">tok</span>&nbsp;<span class="op" id="5671503">==</span>&nbsp;<span class="ident" id="5671506">token</span><span class="op" id="5671511">.</span><span class="ident" id="5671512">SEMICOLON</span>&nbsp;<span class="op" id="5671522">{</span><br>
<span class="lineno">1915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671527">p</span><span class="op" id="5671528">.</span><span class="ident" id="5671529">next</span><span class="op" id="5671533">(</span><span class="op" id="5671534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671539">s1</span>&nbsp;<span class="op" id="5671542">=</span>&nbsp;<span class="ident" id="5671544">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671550">s2</span>&nbsp;<span class="op" id="5671553">=</span>&nbsp;<span class="ident" id="5671555">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671562">if</span>&nbsp;<span class="ident" id="5671565">p</span><span class="op" id="5671566">.</span><span class="ident" id="5671567">tok</span>&nbsp;<span class="op" id="5671571">!=</span>&nbsp;<span class="ident" id="5671574">token</span><span class="op" id="5671579">.</span><span class="ident" id="5671580">LBRACE</span>&nbsp;<span class="op" id="5671587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671593">//&nbsp;A&nbsp;TypeSwitchGuard&nbsp;may&nbsp;declare&nbsp;a&nbsp;variable&nbsp;in&nbsp;addition</span><br>
<span class="lineno">1920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671653">//&nbsp;to&nbsp;the&nbsp;variable&nbsp;declared&nbsp;in&nbsp;the&nbsp;initial&nbsp;SimpleStmt.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671712">//&nbsp;Introduce&nbsp;extra&nbsp;scope&nbsp;to&nbsp;avoid&nbsp;redeclaration&nbsp;errors:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671772">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671779">//&nbsp;&nbsp;&nbsp;&nbspswitch&nbsp;t&nbsp;:=&nbsp;0;&nbsp;t&nbsp;:=&nbsp;x.(T)&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671820">//</span><br>
<span class="lineno">1925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671827">//&nbsp;(this&nbsp;code&nbsp;is&nbsp;not&nbsp;valid&nbsp;Go&nbsp;because&nbsp;the&nbsp;first&nbsp;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671881">//&nbsp;cannot&nbsp;be&nbsp;accessed&nbsp;and&nbsp;thus&nbsp;is&nbsp;never&nbsp;used,&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671941">//&nbsp;scope&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;correct&nbsp;error&nbsp;message).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671996">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5672003">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;type&nbsp;switch,&nbsp;s2&nbsp;must&nbsp;be&nbsp;an&nbsp;expression.</span><br>
<span class="lineno">1930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5672068">//&nbsp;Having&nbsp;the&nbsp;extra&nbsp;nested&nbsp;but&nbsp;empty&nbsp;scope&nbsp;won&#39;t&nbsp;affect&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672132">p</span><span class="op" id="5672133">.</span><span class="ident" id="5672134">openScope</span><span class="op" id="5672143">(</span><span class="op" id="5672144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672150">defer</span>&nbsp;<span class="ident" id="5672156">p</span><span class="op" id="5672157">.</span><span class="ident" id="5672158">closeScope</span><span class="op" id="5672168">(</span><span class="op" id="5672169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672175">s2</span><span class="op" id="5672177">,</span>&nbsp;<span class="ident" id="5672179">_</span>&nbsp;<span class="op" id="5672181">=</span>&nbsp;<span class="ident" id="5672183">p</span><span class="op" id="5672184">.</span><span class="ident" id="5672185">parseSimpleStmt</span><span class="op" id="5672200">(</span><span class="ident" id="5672201">basic</span><span class="op" id="5672206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672211">}</span><br>
<span class="lineno">1935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672219">p</span><span class="op" id="5672220">.</span><span class="ident" id="5672221">exprLev</span>&nbsp;<span class="op" id="5672229">=</span>&nbsp;<span class="ident" id="5672231">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672244">typeSwitch</span>&nbsp;<span class="op" id="5672255">:=</span>&nbsp;<span class="ident" id="5672258">isTypeSwitchGuard</span><span class="op" id="5672275">(</span><span class="ident" id="5672276">s2</span><span class="op" id="5672278">)</span><br>
<span class="lineno">1940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672281">lbrace</span>&nbsp;<span class="op" id="5672288">:=</span>&nbsp;<span class="ident" id="5672291">p</span><span class="op" id="5672292">.</span><span class="ident" id="5672293">expect</span><span class="op" id="5672299">(</span><span class="ident" id="5672300">token</span><span class="op" id="5672305">.</span><span class="ident" id="5672306">LBRACE</span><span class="op" id="5672312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672315">var</span>&nbsp;<span class="ident" id="5672319">list</span>&nbsp;<span class="op" id="5672324">[</span><span class="op" id="5672325">]</span><span class="ident" id="5672326">ast</span><span class="op" id="5672329">.</span><span class="ident" id="5672330">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672336">for</span>&nbsp;<span class="ident" id="5672340">p</span><span class="op" id="5672341">.</span><span class="ident" id="5672342">tok</span>&nbsp;<span class="op" id="5672346">==</span>&nbsp;<span class="ident" id="5672349">token</span><span class="op" id="5672354">.</span><span class="ident" id="5672355">CASE</span>&nbsp;<span class="op" id="5672360">||</span>&nbsp;<span class="ident" id="5672363">p</span><span class="op" id="5672364">.</span><span class="ident" id="5672365">tok</span>&nbsp;<span class="op" id="5672369">==</span>&nbsp;<span class="ident" id="5672372">token</span><span class="op" id="5672377">.</span><span class="ident" id="5672378">DEFAULT</span>&nbsp;<span class="op" id="5672386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672390">list</span>&nbsp;<span class="op" id="5672395">=</span>&nbsp;<span class="builtinfunc" id="5672397">append</span><span class="op" id="5672403">(</span><span class="ident" id="5672404">list</span><span class="op" id="5672408">,</span>&nbsp;<span class="ident" id="5672410">p</span><span class="op" id="5672411">.</span><span class="ident" id="5672412">parseCaseClause</span><span class="op" id="5672427">(</span><span class="ident" id="5672428">typeSwitch</span><span class="op" id="5672438">)</span><span class="op" id="5672439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672442">}</span><br>
<span class="lineno">1945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672445">rbrace</span>&nbsp;<span class="op" id="5672452">:=</span>&nbsp;<span class="ident" id="5672455">p</span><span class="op" id="5672456">.</span><span class="ident" id="5672457">expect</span><span class="op" id="5672463">(</span><span class="ident" id="5672464">token</span><span class="op" id="5672469">.</span><span class="ident" id="5672470">RBRACE</span><span class="op" id="5672476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672479">p</span><span class="op" id="5672480">.</span><span class="ident" id="5672481">expectSemi</span><span class="op" id="5672491">(</span><span class="op" id="5672492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672495">body</span>&nbsp;<span class="op" id="5672500">:=</span>&nbsp;<span class="op" id="5672503">&amp;</span><span class="ident" id="5672504">ast</span><span class="op" id="5672507">.</span><span class="ident" id="5672508">BlockStmt</span><span class="op" id="5672517">{</span><span class="ident" id="5672518">Lbrace</span><span class="op" id="5672524">:</span>&nbsp;<span class="ident" id="5672526">lbrace</span><span class="op" id="5672532">,</span>&nbsp;<span class="ident" id="5672534">List</span><span class="op" id="5672538">:</span>&nbsp;<span class="ident" id="5672540">list</span><span class="op" id="5672544">,</span>&nbsp;<span class="ident" id="5672546">Rbrace</span><span class="op" id="5672552">:</span>&nbsp;<span class="ident" id="5672554">rbrace</span><span class="op" id="5672560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672564">if</span>&nbsp;<span class="ident" id="5672567">typeSwitch</span>&nbsp;<span class="op" id="5672578">{</span><br>
<span class="lineno">1950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672582">return</span>&nbsp;<span class="op" id="5672589">&amp;</span><span class="ident" id="5672590">ast</span><span class="op" id="5672593">.</span><span class="ident" id="5672594">TypeSwitchStmt</span><span class="op" id="5672608">{</span><span class="ident" id="5672609">Switch</span><span class="op" id="5672615">:</span>&nbsp;<span class="ident" id="5672617">pos</span><span class="op" id="5672620">,</span>&nbsp;<span class="ident" id="5672622">Init</span><span class="op" id="5672626">:</span>&nbsp;<span class="ident" id="5672628">s1</span><span class="op" id="5672630">,</span>&nbsp;<span class="ident" id="5672632">Assign</span><span class="op" id="5672638">:</span>&nbsp;<span class="ident" id="5672640">s2</span><span class="op" id="5672642">,</span>&nbsp;<span class="ident" id="5672644">Body</span><span class="op" id="5672648">:</span>&nbsp;<span class="ident" id="5672650">body</span><span class="op" id="5672654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672661">return</span>&nbsp;<span class="op" id="5672668">&amp;</span><span class="ident" id="5672669">ast</span><span class="op" id="5672672">.</span><span class="ident" id="5672673">SwitchStmt</span><span class="op" id="5672683">{</span><span class="ident" id="5672684">Switch</span><span class="op" id="5672690">:</span>&nbsp;<span class="ident" id="5672692">pos</span><span class="op" id="5672695">,</span>&nbsp;<span class="ident" id="5672697">Init</span><span class="op" id="5672701">:</span>&nbsp;<span class="ident" id="5672703">s1</span><span class="op" id="5672705">,</span>&nbsp;<span class="ident" id="5672707">Tag</span><span class="op" id="5672710">:</span>&nbsp;<span class="ident" id="5672712">p</span><span class="op" id="5672713">.</span><span class="ident" id="5672714">makeExpr</span><span class="op" id="5672722">(</span><span class="ident" id="5672723">s2</span><span class="op" id="5672725">,</span>&nbsp;<span class="string" id="5672727">&#34;switch&nbsp;expression&#34;</span><span class="op" id="5672746">)</span><span class="op" id="5672747">,</span>&nbsp;<span class="ident" id="5672749">Body</span><span class="op" id="5672753">:</span>&nbsp;<span class="ident" id="5672755">body</span><span class="op" id="5672759">}</span><br>
<span class="lineno"></span><span class="op" id="5672761">}</span><br>
<span class="lineno">1955</span><br>
<span class="lineno"></span><span class="keyword" id="5672764">func</span>&nbsp;<span class="op" id="5672769">(</span><span class="ident" id="5672770">p</span>&nbsp;<span class="op" id="5672772">*</span><span class="ident" id="5672773">parser</span><span class="op" id="5672779">)</span>&nbsp;<span class="ident" id="5672781">parseCommClause</span><span class="op" id="5672796">(</span><span class="op" id="5672797">)</span>&nbsp;<span class="op" id="5672799">*</span><span class="ident" id="5672800">ast</span><span class="op" id="5672803">.</span><span class="ident" id="5672804">CommClause</span>&nbsp;<span class="op" id="5672815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672818">if</span>&nbsp;<span class="ident" id="5672821">p</span><span class="op" id="5672822">.</span><span class="ident" id="5672823">trace</span>&nbsp;<span class="op" id="5672829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672833">defer</span>&nbsp;<span class="ident" id="5672839">un</span><span class="op" id="5672841">(</span><span class="ident" id="5672842">trace</span><span class="op" id="5672847">(</span><span class="ident" id="5672848">p</span><span class="op" id="5672849">,</span>&nbsp;<span class="string" id="5672851">&#34;CommClause&#34;</span><span class="op" id="5672863">)</span><span class="op" id="5672864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672867">}</span><br>
<span class="lineno">1960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672871">p</span><span class="op" id="5672872">.</span><span class="ident" id="5672873">openScope</span><span class="op" id="5672882">(</span><span class="op" id="5672883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672886">pos</span>&nbsp;<span class="op" id="5672890">:=</span>&nbsp;<span class="ident" id="5672893">p</span><span class="op" id="5672894">.</span><span class="ident" id="5672895">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672900">var</span>&nbsp;<span class="ident" id="5672904">comm</span>&nbsp;<span class="ident" id="5672909">ast</span><span class="op" id="5672912">.</span><span class="ident" id="5672913">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672919">if</span>&nbsp;<span class="ident" id="5672922">p</span><span class="op" id="5672923">.</span><span class="ident" id="5672924">tok</span>&nbsp;<span class="op" id="5672928">==</span>&nbsp;<span class="ident" id="5672931">token</span><span class="op" id="5672936">.</span><span class="ident" id="5672937">CASE</span>&nbsp;<span class="op" id="5672942">{</span><br>
<span class="lineno">1965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672946">p</span><span class="op" id="5672947">.</span><span class="ident" id="5672948">next</span><span class="op" id="5672952">(</span><span class="op" id="5672953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672957">lhs</span>&nbsp;<span class="op" id="5672961">:=</span>&nbsp;<span class="ident" id="5672964">p</span><span class="op" id="5672965">.</span><span class="ident" id="5672966">parseLhsList</span><span class="op" id="5672978">(</span><span class="op" id="5672979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672983">if</span>&nbsp;<span class="ident" id="5672986">p</span><span class="op" id="5672987">.</span><span class="ident" id="5672988">tok</span>&nbsp;<span class="op" id="5672992">==</span>&nbsp;<span class="ident" id="5672995">token</span><span class="op" id="5673000">.</span><span class="ident" id="5673001">ARROW</span>&nbsp;<span class="op" id="5673007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673012">//&nbsp;SendStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673027">if</span>&nbsp;<span class="builtinfunc" id="5673030">len</span><span class="op" id="5673033">(</span><span class="ident" id="5673034">lhs</span><span class="op" id="5673037">)</span>&nbsp;<span class="op" id="5673039">&gt;</span>&nbsp;<span class="num" id="5673041">1</span>&nbsp;<span class="op" id="5673043">{</span><br>
<span class="lineno">1970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673049">p</span><span class="op" id="5673050">.</span><span class="ident" id="5673051">errorExpected</span><span class="op" id="5673064">(</span><span class="ident" id="5673065">lhs</span><span class="op" id="5673068">[</span><span class="num" id="5673069">0</span><span class="op" id="5673070">]</span><span class="op" id="5673071">.</span><span class="ident" id="5673072">Pos</span><span class="op" id="5673075">(</span><span class="op" id="5673076">)</span><span class="op" id="5673077">,</span>&nbsp;<span class="string" id="5673079">&#34;1&nbsp;expression&#34;</span><span class="op" id="5673093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673099">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673141">arrow</span>&nbsp;<span class="op" id="5673147">:=</span>&nbsp;<span class="ident" id="5673150">p</span><span class="op" id="5673151">.</span><span class="ident" id="5673152">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673159">p</span><span class="op" id="5673160">.</span><span class="ident" id="5673161">next</span><span class="op" id="5673165">(</span><span class="op" id="5673166">)</span><br>
<span class="lineno">1975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673171">rhs</span>&nbsp;<span class="op" id="5673175">:=</span>&nbsp;<span class="ident" id="5673178">p</span><span class="op" id="5673179">.</span><span class="ident" id="5673180">parseRhs</span><span class="op" id="5673188">(</span><span class="op" id="5673189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673194">comm</span>&nbsp;<span class="op" id="5673199">=</span>&nbsp;<span class="op" id="5673201">&amp;</span><span class="ident" id="5673202">ast</span><span class="op" id="5673205">.</span><span class="ident" id="5673206">SendStmt</span><span class="op" id="5673214">{</span><span class="ident" id="5673215">Chan</span><span class="op" id="5673219">:</span>&nbsp;<span class="ident" id="5673221">lhs</span><span class="op" id="5673224">[</span><span class="num" id="5673225">0</span><span class="op" id="5673226">]</span><span class="op" id="5673227">,</span>&nbsp;<span class="ident" id="5673229">Arrow</span><span class="op" id="5673234">:</span>&nbsp;<span class="ident" id="5673236">arrow</span><span class="op" id="5673241">,</span>&nbsp;<span class="ident" id="5673243">Value</span><span class="op" id="5673248">:</span>&nbsp;<span class="ident" id="5673250">rhs</span><span class="op" id="5673253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673257">}</span>&nbsp;<span class="keyword" id="5673259">else</span>&nbsp;<span class="op" id="5673264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673269">//&nbsp;RecvStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673284">if</span>&nbsp;<span class="ident" id="5673287">tok</span>&nbsp;<span class="op" id="5673291">:=</span>&nbsp;<span class="ident" id="5673294">p</span><span class="op" id="5673295">.</span><span class="ident" id="5673296">tok</span><span class="op" id="5673299">;</span>&nbsp;<span class="ident" id="5673301">tok</span>&nbsp;<span class="op" id="5673305">==</span>&nbsp;<span class="ident" id="5673308">token</span><span class="op" id="5673313">.</span><span class="ident" id="5673314">ASSIGN</span>&nbsp;<span class="op" id="5673321">||</span>&nbsp;<span class="ident" id="5673324">tok</span>&nbsp;<span class="op" id="5673328">==</span>&nbsp;<span class="ident" id="5673331">token</span><span class="op" id="5673336">.</span><span class="ident" id="5673337">DEFINE</span>&nbsp;<span class="op" id="5673344">{</span><br>
<span class="lineno">1980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673350">//&nbsp;RecvStmt&nbsp;with&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673382">if</span>&nbsp;<span class="builtinfunc" id="5673385">len</span><span class="op" id="5673388">(</span><span class="ident" id="5673389">lhs</span><span class="op" id="5673392">)</span>&nbsp;<span class="op" id="5673394">&gt;</span>&nbsp;<span class="num" id="5673396">2</span>&nbsp;<span class="op" id="5673398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673405">p</span><span class="op" id="5673406">.</span><span class="ident" id="5673407">errorExpected</span><span class="op" id="5673420">(</span><span class="ident" id="5673421">lhs</span><span class="op" id="5673424">[</span><span class="num" id="5673425">0</span><span class="op" id="5673426">]</span><span class="op" id="5673427">.</span><span class="ident" id="5673428">Pos</span><span class="op" id="5673431">(</span><span class="op" id="5673432">)</span><span class="op" id="5673433">,</span>&nbsp;<span class="string" id="5673435">&#34;1&nbsp;or&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="5673455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673462">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;two&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673506">lhs</span>&nbsp;<span class="op" id="5673510">=</span>&nbsp;<span class="ident" id="5673512">lhs</span><span class="op" id="5673515">[</span><span class="num" id="5673516">0</span><span class="op" id="5673517">:</span><span class="num" id="5673518">2</span><span class="op" id="5673519">]</span><br>
<span class="lineno">1985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673531">pos</span>&nbsp;<span class="op" id="5673535">:=</span>&nbsp;<span class="ident" id="5673538">p</span><span class="op" id="5673539">.</span><span class="ident" id="5673540">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673548">p</span><span class="op" id="5673549">.</span><span class="ident" id="5673550">next</span><span class="op" id="5673554">(</span><span class="op" id="5673555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673561">rhs</span>&nbsp;<span class="op" id="5673565">:=</span>&nbsp;<span class="ident" id="5673568">p</span><span class="op" id="5673569">.</span><span class="ident" id="5673570">parseRhs</span><span class="op" id="5673578">(</span><span class="op" id="5673579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673585">as</span>&nbsp;<span class="op" id="5673588">:=</span>&nbsp;<span class="op" id="5673591">&amp;</span><span class="ident" id="5673592">ast</span><span class="op" id="5673595">.</span><span class="ident" id="5673596">AssignStmt</span><span class="op" id="5673606">{</span><span class="ident" id="5673607">Lhs</span><span class="op" id="5673610">:</span>&nbsp;<span class="ident" id="5673612">lhs</span><span class="op" id="5673615">,</span>&nbsp;<span class="ident" id="5673617">TokPos</span><span class="op" id="5673623">:</span>&nbsp;<span class="ident" id="5673625">pos</span><span class="op" id="5673628">,</span>&nbsp;<span class="ident" id="5673630">Tok</span><span class="op" id="5673633">:</span>&nbsp;<span class="ident" id="5673635">tok</span><span class="op" id="5673638">,</span>&nbsp;<span class="ident" id="5673640">Rhs</span><span class="op" id="5673643">:</span>&nbsp;<span class="op" id="5673645">[</span><span class="op" id="5673646">]</span><span class="ident" id="5673647">ast</span><span class="op" id="5673650">.</span><span class="ident" id="5673651">Expr</span><span class="op" id="5673655">{</span><span class="ident" id="5673656">rhs</span><span class="op" id="5673659">}</span><span class="op" id="5673660">}</span><br>
<span class="lineno">1990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673666">if</span>&nbsp;<span class="ident" id="5673669">tok</span>&nbsp;<span class="op" id="5673673">==</span>&nbsp;<span class="ident" id="5673676">token</span><span class="op" id="5673681">.</span><span class="ident" id="5673682">DEFINE</span>&nbsp;<span class="op" id="5673689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673696">p</span><span class="op" id="5673697">.</span><span class="ident" id="5673698">shortVarDecl</span><span class="op" id="5673710">(</span><span class="ident" id="5673711">as</span><span class="op" id="5673713">,</span>&nbsp;<span class="ident" id="5673715">lhs</span><span class="op" id="5673718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673730">comm</span>&nbsp;<span class="op" id="5673735">=</span>&nbsp;<span class="ident" id="5673737">as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673743">}</span>&nbsp;<span class="keyword" id="5673745">else</span>&nbsp;<span class="op" id="5673750">{</span><br>
<span class="lineno">1995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673756">//&nbsp;lhs&nbsp;must&nbsp;be&nbsp;single&nbsp;receive&nbsp;operation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673800">if</span>&nbsp;<span class="builtinfunc" id="5673803">len</span><span class="op" id="5673806">(</span><span class="ident" id="5673807">lhs</span><span class="op" id="5673810">)</span>&nbsp;<span class="op" id="5673812">&gt;</span>&nbsp;<span class="num" id="5673814">1</span>&nbsp;<span class="op" id="5673816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673823">p</span><span class="op" id="5673824">.</span><span class="ident" id="5673825">errorExpected</span><span class="op" id="5673838">(</span><span class="ident" id="5673839">lhs</span><span class="op" id="5673842">[</span><span class="num" id="5673843">0</span><span class="op" id="5673844">]</span><span class="op" id="5673845">.</span><span class="ident" id="5673846">Pos</span><span class="op" id="5673849">(</span><span class="op" id="5673850">)</span><span class="op" id="5673851">,</span>&nbsp;<span class="string" id="5673853">&#34;1&nbsp;expression&#34;</span><span class="op" id="5673867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673874">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673912">}</span><br>
<span class="lineno">2000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673918">comm</span>&nbsp;<span class="op" id="5673923">=</span>&nbsp;<span class="op" id="5673925">&amp;</span><span class="ident" id="5673926">ast</span><span class="op" id="5673929">.</span><span class="ident" id="5673930">ExprStmt</span><span class="op" id="5673938">{</span><span class="ident" id="5673939">X</span><span class="op" id="5673940">:</span>&nbsp;<span class="ident" id="5673942">lhs</span><span class="op" id="5673945">[</span><span class="num" id="5673946">0</span><span class="op" id="5673947">]</span><span class="op" id="5673948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673960">}</span>&nbsp;<span class="keyword" id="5673962">else</span>&nbsp;<span class="op" id="5673967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673971">p</span><span class="op" id="5673972">.</span><span class="ident" id="5673973">expect</span><span class="op" id="5673979">(</span><span class="ident" id="5673980">token</span><span class="op" id="5673985">.</span><span class="ident" id="5673986">DEFAULT</span><span class="op" id="5673993">)</span><br>
<span class="lineno">2005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674000">colon</span>&nbsp;<span class="op" id="5674006">:=</span>&nbsp;<span class="ident" id="5674009">p</span><span class="op" id="5674010">.</span><span class="ident" id="5674011">expect</span><span class="op" id="5674017">(</span><span class="ident" id="5674018">token</span><span class="op" id="5674023">.</span><span class="ident" id="5674024">COLON</span><span class="op" id="5674029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674032">body</span>&nbsp;<span class="op" id="5674037">:=</span>&nbsp;<span class="ident" id="5674040">p</span><span class="op" id="5674041">.</span><span class="ident" id="5674042">parseStmtList</span><span class="op" id="5674055">(</span><span class="op" id="5674056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674059">p</span><span class="op" id="5674060">.</span><span class="ident" id="5674061">closeScope</span><span class="op" id="5674071">(</span><span class="op" id="5674072">)</span><br>
<span class="lineno">2010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674076">return</span>&nbsp;<span class="op" id="5674083">&amp;</span><span class="ident" id="5674084">ast</span><span class="op" id="5674087">.</span><span class="ident" id="5674088">CommClause</span><span class="op" id="5674098">{</span><span class="ident" id="5674099">Case</span><span class="op" id="5674103">:</span>&nbsp;<span class="ident" id="5674105">pos</span><span class="op" id="5674108">,</span>&nbsp;<span class="ident" id="5674110">Comm</span><span class="op" id="5674114">:</span>&nbsp;<span class="ident" id="5674116">comm</span><span class="op" id="5674120">,</span>&nbsp;<span class="ident" id="5674122">Colon</span><span class="op" id="5674127">:</span>&nbsp;<span class="ident" id="5674129">colon</span><span class="op" id="5674134">,</span>&nbsp;<span class="ident" id="5674136">Body</span><span class="op" id="5674140">:</span>&nbsp;<span class="ident" id="5674142">body</span><span class="op" id="5674146">}</span><br>
<span class="lineno"></span><span class="op" id="5674148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5674151">func</span>&nbsp;<span class="op" id="5674156">(</span><span class="ident" id="5674157">p</span>&nbsp;<span class="op" id="5674159">*</span><span class="ident" id="5674160">parser</span><span class="op" id="5674166">)</span>&nbsp;<span class="ident" id="5674168">parseSelectStmt</span><span class="op" id="5674183">(</span><span class="op" id="5674184">)</span>&nbsp;<span class="op" id="5674186">*</span><span class="ident" id="5674187">ast</span><span class="op" id="5674190">.</span><span class="ident" id="5674191">SelectStmt</span>&nbsp;<span class="op" id="5674202">{</span><br>
<span class="lineno">2015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674205">if</span>&nbsp;<span class="ident" id="5674208">p</span><span class="op" id="5674209">.</span><span class="ident" id="5674210">trace</span>&nbsp;<span class="op" id="5674216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674220">defer</span>&nbsp;<span class="ident" id="5674226">un</span><span class="op" id="5674228">(</span><span class="ident" id="5674229">trace</span><span class="op" id="5674234">(</span><span class="ident" id="5674235">p</span><span class="op" id="5674236">,</span>&nbsp;<span class="string" id="5674238">&#34;SelectStmt&#34;</span><span class="op" id="5674250">)</span><span class="op" id="5674251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674258">pos</span>&nbsp;<span class="op" id="5674262">:=</span>&nbsp;<span class="ident" id="5674265">p</span><span class="op" id="5674266">.</span><span class="ident" id="5674267">expect</span><span class="op" id="5674273">(</span><span class="ident" id="5674274">token</span><span class="op" id="5674279">.</span><span class="ident" id="5674280">SELECT</span><span class="op" id="5674286">)</span><br>
<span class="lineno">2020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674289">lbrace</span>&nbsp;<span class="op" id="5674296">:=</span>&nbsp;<span class="ident" id="5674299">p</span><span class="op" id="5674300">.</span><span class="ident" id="5674301">expect</span><span class="op" id="5674307">(</span><span class="ident" id="5674308">token</span><span class="op" id="5674313">.</span><span class="ident" id="5674314">LBRACE</span><span class="op" id="5674320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674323">var</span>&nbsp;<span class="ident" id="5674327">list</span>&nbsp;<span class="op" id="5674332">[</span><span class="op" id="5674333">]</span><span class="ident" id="5674334">ast</span><span class="op" id="5674337">.</span><span class="ident" id="5674338">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674344">for</span>&nbsp;<span class="ident" id="5674348">p</span><span class="op" id="5674349">.</span><span class="ident" id="5674350">tok</span>&nbsp;<span class="op" id="5674354">==</span>&nbsp;<span class="ident" id="5674357">token</span><span class="op" id="5674362">.</span><span class="ident" id="5674363">CASE</span>&nbsp;<span class="op" id="5674368">||</span>&nbsp;<span class="ident" id="5674371">p</span><span class="op" id="5674372">.</span><span class="ident" id="5674373">tok</span>&nbsp;<span class="op" id="5674377">==</span>&nbsp;<span class="ident" id="5674380">token</span><span class="op" id="5674385">.</span><span class="ident" id="5674386">DEFAULT</span>&nbsp;<span class="op" id="5674394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674398">list</span>&nbsp;<span class="op" id="5674403">=</span>&nbsp;<span class="builtinfunc" id="5674405">append</span><span class="op" id="5674411">(</span><span class="ident" id="5674412">list</span><span class="op" id="5674416">,</span>&nbsp;<span class="ident" id="5674418">p</span><span class="op" id="5674419">.</span><span class="ident" id="5674420">parseCommClause</span><span class="op" id="5674435">(</span><span class="op" id="5674436">)</span><span class="op" id="5674437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674440">}</span><br>
<span class="lineno">2025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674443">rbrace</span>&nbsp;<span class="op" id="5674450">:=</span>&nbsp;<span class="ident" id="5674453">p</span><span class="op" id="5674454">.</span><span class="ident" id="5674455">expect</span><span class="op" id="5674461">(</span><span class="ident" id="5674462">token</span><span class="op" id="5674467">.</span><span class="ident" id="5674468">RBRACE</span><span class="op" id="5674474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674477">p</span><span class="op" id="5674478">.</span><span class="ident" id="5674479">expectSemi</span><span class="op" id="5674489">(</span><span class="op" id="5674490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674493">body</span>&nbsp;<span class="op" id="5674498">:=</span>&nbsp;<span class="op" id="5674501">&amp;</span><span class="ident" id="5674502">ast</span><span class="op" id="5674505">.</span><span class="ident" id="5674506">BlockStmt</span><span class="op" id="5674515">{</span><span class="ident" id="5674516">Lbrace</span><span class="op" id="5674522">:</span>&nbsp;<span class="ident" id="5674524">lbrace</span><span class="op" id="5674530">,</span>&nbsp;<span class="ident" id="5674532">List</span><span class="op" id="5674536">:</span>&nbsp;<span class="ident" id="5674538">list</span><span class="op" id="5674542">,</span>&nbsp;<span class="ident" id="5674544">Rbrace</span><span class="op" id="5674550">:</span>&nbsp;<span class="ident" id="5674552">rbrace</span><span class="op" id="5674558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674562">return</span>&nbsp;<span class="op" id="5674569">&amp;</span><span class="ident" id="5674570">ast</span><span class="op" id="5674573">.</span><span class="ident" id="5674574">SelectStmt</span><span class="op" id="5674584">{</span><span class="ident" id="5674585">Select</span><span class="op" id="5674591">:</span>&nbsp;<span class="ident" id="5674593">pos</span><span class="op" id="5674596">,</span>&nbsp;<span class="ident" id="5674598">Body</span><span class="op" id="5674602">:</span>&nbsp;<span class="ident" id="5674604">body</span><span class="op" id="5674608">}</span><br>
<span class="lineno">2030</span><span class="op" id="5674610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5674613">func</span>&nbsp;<span class="op" id="5674618">(</span><span class="ident" id="5674619">p</span>&nbsp;<span class="op" id="5674621">*</span><span class="ident" id="5674622">parser</span><span class="op" id="5674628">)</span>&nbsp;<span class="ident" id="5674630">parseForStmt</span><span class="op" id="5674642">(</span><span class="op" id="5674643">)</span>&nbsp;<span class="ident" id="5674645">ast</span><span class="op" id="5674648">.</span><span class="ident" id="5674649">Stmt</span>&nbsp;<span class="op" id="5674654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674657">if</span>&nbsp;<span class="ident" id="5674660">p</span><span class="op" id="5674661">.</span><span class="ident" id="5674662">trace</span>&nbsp;<span class="op" id="5674668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674672">defer</span>&nbsp;<span class="ident" id="5674678">un</span><span class="op" id="5674680">(</span><span class="ident" id="5674681">trace</span><span class="op" id="5674686">(</span><span class="ident" id="5674687">p</span><span class="op" id="5674688">,</span>&nbsp;<span class="string" id="5674690">&#34;ForStmt&#34;</span><span class="op" id="5674699">)</span><span class="op" id="5674700">)</span><br>
<span class="lineno">2035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674707">pos</span>&nbsp;<span class="op" id="5674711">:=</span>&nbsp;<span class="ident" id="5674714">p</span><span class="op" id="5674715">.</span><span class="ident" id="5674716">expect</span><span class="op" id="5674722">(</span><span class="ident" id="5674723">token</span><span class="op" id="5674728">.</span><span class="ident" id="5674729">FOR</span><span class="op" id="5674732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674735">p</span><span class="op" id="5674736">.</span><span class="ident" id="5674737">openScope</span><span class="op" id="5674746">(</span><span class="op" id="5674747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674750">defer</span>&nbsp;<span class="ident" id="5674756">p</span><span class="op" id="5674757">.</span><span class="ident" id="5674758">closeScope</span><span class="op" id="5674768">(</span><span class="op" id="5674769">)</span><br>
<span class="lineno">2040</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674773">var</span>&nbsp;<span class="ident" id="5674777">s1</span><span class="op" id="5674779">,</span>&nbsp;<span class="ident" id="5674781">s2</span><span class="op" id="5674783">,</span>&nbsp;<span class="ident" id="5674785">s3</span>&nbsp;<span class="ident" id="5674788">ast</span><span class="op" id="5674791">.</span><span class="ident" id="5674792">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674798">var</span>&nbsp;<span class="ident" id="5674802">isRange</span>&nbsp;<span class="builtintype" id="5674810">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674816">if</span>&nbsp;<span class="ident" id="5674819">p</span><span class="op" id="5674820">.</span><span class="ident" id="5674821">tok</span>&nbsp;<span class="op" id="5674825">!=</span>&nbsp;<span class="ident" id="5674828">token</span><span class="op" id="5674833">.</span><span class="ident" id="5674834">LBRACE</span>&nbsp;<span class="op" id="5674841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674845">prevLev</span>&nbsp;<span class="op" id="5674853">:=</span>&nbsp;<span class="ident" id="5674856">p</span><span class="op" id="5674857">.</span><span class="ident" id="5674858">exprLev</span><br>
<span class="lineno">2045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674868">p</span><span class="op" id="5674869">.</span><span class="ident" id="5674870">exprLev</span>&nbsp;<span class="op" id="5674878">=</span>&nbsp;<span class="op" id="5674880">-</span><span class="num" id="5674881">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674885">if</span>&nbsp;<span class="ident" id="5674888">p</span><span class="op" id="5674889">.</span><span class="ident" id="5674890">tok</span>&nbsp;<span class="op" id="5674894">!=</span>&nbsp;<span class="ident" id="5674897">token</span><span class="op" id="5674902">.</span><span class="ident" id="5674903">SEMICOLON</span>&nbsp;<span class="op" id="5674913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674918">if</span>&nbsp;<span class="ident" id="5674921">p</span><span class="op" id="5674922">.</span><span class="ident" id="5674923">tok</span>&nbsp;<span class="op" id="5674927">==</span>&nbsp;<span class="ident" id="5674930">token</span><span class="op" id="5674935">.</span><span class="ident" id="5674936">RANGE</span>&nbsp;<span class="op" id="5674942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5674948">//&nbsp;&#34;for&nbsp;range&nbsp;x&#34;&nbsp;(nil&nbsp;lhs&nbsp;in&nbsp;assignment)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674993">pos</span>&nbsp;<span class="op" id="5674997">:=</span>&nbsp;<span class="ident" id="5675000">p</span><span class="op" id="5675001">.</span><span class="ident" id="5675002">pos</span><br>
<span class="lineno">2050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675010">p</span><span class="op" id="5675011">.</span><span class="ident" id="5675012">next</span><span class="op" id="5675016">(</span><span class="op" id="5675017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675023">y</span>&nbsp;<span class="op" id="5675025">:=</span>&nbsp;<span class="op" id="5675028">[</span><span class="op" id="5675029">]</span><span class="ident" id="5675030">ast</span><span class="op" id="5675033">.</span><span class="ident" id="5675034">Expr</span><span class="op" id="5675038">{</span><span class="op" id="5675039">&amp;</span><span class="ident" id="5675040">ast</span><span class="op" id="5675043">.</span><span class="ident" id="5675044">UnaryExpr</span><span class="op" id="5675053">{</span><span class="ident" id="5675054">OpPos</span><span class="op" id="5675059">:</span>&nbsp;<span class="ident" id="5675061">pos</span><span class="op" id="5675064">,</span>&nbsp;<span class="ident" id="5675066">Op</span><span class="op" id="5675068">:</span>&nbsp;<span class="ident" id="5675070">token</span><span class="op" id="5675075">.</span><span class="ident" id="5675076">RANGE</span><span class="op" id="5675081">,</span>&nbsp;<span class="ident" id="5675083">X</span><span class="op" id="5675084">:</span>&nbsp;<span class="ident" id="5675086">p</span><span class="op" id="5675087">.</span><span class="ident" id="5675088">parseRhs</span><span class="op" id="5675096">(</span><span class="op" id="5675097">)</span><span class="op" id="5675098">}</span><span class="op" id="5675099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675105">s2</span>&nbsp;<span class="op" id="5675108">=</span>&nbsp;<span class="op" id="5675110">&amp;</span><span class="ident" id="5675111">ast</span><span class="op" id="5675114">.</span><span class="ident" id="5675115">AssignStmt</span><span class="op" id="5675125">{</span><span class="ident" id="5675126">Rhs</span><span class="op" id="5675129">:</span>&nbsp;<span class="ident" id="5675131">y</span><span class="op" id="5675132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675138">isRange</span>&nbsp;<span class="op" id="5675146">=</span>&nbsp;<span class="builtintype" id="5675148">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675156">}</span>&nbsp;<span class="keyword" id="5675158">else</span>&nbsp;<span class="op" id="5675163">{</span><br>
<span class="lineno">2055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675169">s2</span><span class="op" id="5675171">,</span>&nbsp;<span class="ident" id="5675173">isRange</span>&nbsp;<span class="op" id="5675181">=</span>&nbsp;<span class="ident" id="5675183">p</span><span class="op" id="5675184">.</span><span class="ident" id="5675185">parseSimpleStmt</span><span class="op" id="5675200">(</span><span class="ident" id="5675201">rangeOk</span><span class="op" id="5675208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675221">if</span>&nbsp;<span class="op" id="5675224">!</span><span class="ident" id="5675225">isRange</span>&nbsp;<span class="op" id="5675233">&amp;&amp;</span>&nbsp;<span class="ident" id="5675236">p</span><span class="op" id="5675237">.</span><span class="ident" id="5675238">tok</span>&nbsp;<span class="op" id="5675242">==</span>&nbsp;<span class="ident" id="5675245">token</span><span class="op" id="5675250">.</span><span class="ident" id="5675251">SEMICOLON</span>&nbsp;<span class="op" id="5675261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675266">p</span><span class="op" id="5675267">.</span><span class="ident" id="5675268">next</span><span class="op" id="5675272">(</span><span class="op" id="5675273">)</span><br>
<span class="lineno">2060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675278">s1</span>&nbsp;<span class="op" id="5675281">=</span>&nbsp;<span class="ident" id="5675283">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675289">s2</span>&nbsp;<span class="op" id="5675292">=</span>&nbsp;<span class="ident" id="5675294">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675301">if</span>&nbsp;<span class="ident" id="5675304">p</span><span class="op" id="5675305">.</span><span class="ident" id="5675306">tok</span>&nbsp;<span class="op" id="5675310">!=</span>&nbsp;<span class="ident" id="5675313">token</span><span class="op" id="5675318">.</span><span class="ident" id="5675319">SEMICOLON</span>&nbsp;<span class="op" id="5675329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675335">s2</span><span class="op" id="5675337">,</span>&nbsp;<span class="ident" id="5675339">_</span>&nbsp;<span class="op" id="5675341">=</span>&nbsp;<span class="ident" id="5675343">p</span><span class="op" id="5675344">.</span><span class="ident" id="5675345">parseSimpleStmt</span><span class="op" id="5675360">(</span><span class="ident" id="5675361">basic</span><span class="op" id="5675366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675371">}</span><br>
<span class="lineno">2065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675376">p</span><span class="op" id="5675377">.</span><span class="ident" id="5675378">expectSemi</span><span class="op" id="5675388">(</span><span class="op" id="5675389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675394">if</span>&nbsp;<span class="ident" id="5675397">p</span><span class="op" id="5675398">.</span><span class="ident" id="5675399">tok</span>&nbsp;<span class="op" id="5675403">!=</span>&nbsp;<span class="ident" id="5675406">token</span><span class="op" id="5675411">.</span><span class="ident" id="5675412">LBRACE</span>&nbsp;<span class="op" id="5675419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675425">s3</span><span class="op" id="5675427">,</span>&nbsp;<span class="ident" id="5675429">_</span>&nbsp;<span class="op" id="5675431">=</span>&nbsp;<span class="ident" id="5675433">p</span><span class="op" id="5675434">.</span><span class="ident" id="5675435">parseSimpleStmt</span><span class="op" id="5675450">(</span><span class="ident" id="5675451">basic</span><span class="op" id="5675456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675465">}</span><br>
<span class="lineno">2070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675469">p</span><span class="op" id="5675470">.</span><span class="ident" id="5675471">exprLev</span>&nbsp;<span class="op" id="5675479">=</span>&nbsp;<span class="ident" id="5675481">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675494">body</span>&nbsp;<span class="op" id="5675499">:=</span>&nbsp;<span class="ident" id="5675502">p</span><span class="op" id="5675503">.</span><span class="ident" id="5675504">parseBlockStmt</span><span class="op" id="5675518">(</span><span class="op" id="5675519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675522">p</span><span class="op" id="5675523">.</span><span class="ident" id="5675524">expectSemi</span><span class="op" id="5675534">(</span><span class="op" id="5675535">)</span><br>
<span class="lineno">2075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675539">if</span>&nbsp;<span class="ident" id="5675542">isRange</span>&nbsp;<span class="op" id="5675550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675554">as</span>&nbsp;<span class="op" id="5675557">:=</span>&nbsp;<span class="ident" id="5675560">s2</span><span class="op" id="5675562">.</span><span class="op" id="5675563">(</span><span class="op" id="5675564">*</span><span class="ident" id="5675565">ast</span><span class="op" id="5675568">.</span><span class="ident" id="5675569">AssignStmt</span><span class="op" id="5675579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5675583">//&nbsp;check&nbsp;lhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675598">var</span>&nbsp;<span class="ident" id="5675602">key</span><span class="op" id="5675605">,</span>&nbsp;<span class="ident" id="5675607">value</span>&nbsp;<span class="ident" id="5675613">ast</span><span class="op" id="5675616">.</span><span class="ident" id="5675617">Expr</span><br>
<span class="lineno">2080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675624">switch</span>&nbsp;<span class="builtinfunc" id="5675631">len</span><span class="op" id="5675634">(</span><span class="ident" id="5675635">as</span><span class="op" id="5675637">.</span><span class="ident" id="5675638">Lhs</span><span class="op" id="5675641">)</span>&nbsp;<span class="op" id="5675643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675647">case</span>&nbsp;<span class="num" id="5675652">0</span><span class="op" id="5675653">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5675658">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675677">case</span>&nbsp;<span class="num" id="5675682">1</span><span class="op" id="5675683">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675688">key</span>&nbsp;<span class="op" id="5675692">=</span>&nbsp;<span class="ident" id="5675694">as</span><span class="op" id="5675696">.</span><span class="ident" id="5675697">Lhs</span><span class="op" id="5675700">[</span><span class="num" id="5675701">0</span><span class="op" id="5675702">]</span><br>
<span class="lineno">2085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675706">case</span>&nbsp;<span class="num" id="5675711">2</span><span class="op" id="5675712">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675717">key</span><span class="op" id="5675720">,</span>&nbsp;<span class="ident" id="5675722">value</span>&nbsp;<span class="op" id="5675728">=</span>&nbsp;<span class="ident" id="5675730">as</span><span class="op" id="5675732">.</span><span class="ident" id="5675733">Lhs</span><span class="op" id="5675736">[</span><span class="num" id="5675737">0</span><span class="op" id="5675738">]</span><span class="op" id="5675739">,</span>&nbsp;<span class="ident" id="5675741">as</span><span class="op" id="5675743">.</span><span class="ident" id="5675744">Lhs</span><span class="op" id="5675747">[</span><span class="num" id="5675748">1</span><span class="op" id="5675749">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675753">default</span><span class="op" id="5675760">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675765">p</span><span class="op" id="5675766">.</span><span class="ident" id="5675767">errorExpected</span><span class="op" id="5675780">(</span><span class="ident" id="5675781">as</span><span class="op" id="5675783">.</span><span class="ident" id="5675784">Lhs</span><span class="op" id="5675787">[</span><span class="builtinfunc" id="5675788">len</span><span class="op" id="5675791">(</span><span class="ident" id="5675792">as</span><span class="op" id="5675794">.</span><span class="ident" id="5675795">Lhs</span><span class="op" id="5675798">)</span><span class="op" id="5675799">-</span><span class="num" id="5675800">1</span><span class="op" id="5675801">]</span><span class="op" id="5675802">.</span><span class="ident" id="5675803">Pos</span><span class="op" id="5675806">(</span><span class="op" id="5675807">)</span><span class="op" id="5675808">,</span>&nbsp;<span class="string" id="5675810">&#34;at&nbsp;most&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="5675833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675838">return</span>&nbsp;<span class="op" id="5675845">&amp;</span><span class="ident" id="5675846">ast</span><span class="op" id="5675849">.</span><span class="ident" id="5675850">BadStmt</span><span class="op" id="5675857">{</span><span class="ident" id="5675858">From</span><span class="op" id="5675862">:</span>&nbsp;<span class="ident" id="5675864">pos</span><span class="op" id="5675867">,</span>&nbsp;<span class="ident" id="5675869">To</span><span class="op" id="5675871">:</span>&nbsp;<span class="ident" id="5675873">p</span><span class="op" id="5675874">.</span><span class="ident" id="5675875">safePos</span><span class="op" id="5675882">(</span><span class="ident" id="5675883">body</span><span class="op" id="5675887">.</span><span class="ident" id="5675888">End</span><span class="op" id="5675891">(</span><span class="op" id="5675892">)</span><span class="op" id="5675893">)</span><span class="op" id="5675894">}</span><br>
<span class="lineno">2090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5675902">//&nbsp;parseSimpleStmt&nbsp;returned&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5675955">//&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676011">x</span>&nbsp;<span class="op" id="5676013">:=</span>&nbsp;<span class="ident" id="5676016">as</span><span class="op" id="5676018">.</span><span class="ident" id="5676019">Rhs</span><span class="op" id="5676022">[</span><span class="num" id="5676023">0</span><span class="op" id="5676024">]</span><span class="op" id="5676025">.</span><span class="op" id="5676026">(</span><span class="op" id="5676027">*</span><span class="ident" id="5676028">ast</span><span class="op" id="5676031">.</span><span class="ident" id="5676032">UnaryExpr</span><span class="op" id="5676041">)</span><span class="op" id="5676042">.</span><span class="ident" id="5676043">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676047">return</span>&nbsp;<span class="op" id="5676054">&amp;</span><span class="ident" id="5676055">ast</span><span class="op" id="5676058">.</span><span class="ident" id="5676059">RangeStmt</span><span class="op" id="5676068">{</span><br>
<span class="lineno">2095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676073">For</span><span class="op" id="5676076">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5676081">pos</span><span class="op" id="5676084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676089">Key</span><span class="op" id="5676092">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5676097">key</span><span class="op" id="5676100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676105">Value</span><span class="op" id="5676110">:</span>&nbsp;&nbsp;<span class="ident" id="5676113">value</span><span class="op" id="5676118">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676123">TokPos</span><span class="op" id="5676129">:</span>&nbsp;<span class="ident" id="5676131">as</span><span class="op" id="5676133">.</span><span class="ident" id="5676134">TokPos</span><span class="op" id="5676140">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676145">Tok</span><span class="op" id="5676148">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5676153">as</span><span class="op" id="5676155">.</span><span class="ident" id="5676156">Tok</span><span class="op" id="5676159">,</span><br>
<span class="lineno">2100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676164">X</span><span class="op" id="5676165">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5676172">x</span><span class="op" id="5676173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676178">Body</span><span class="op" id="5676182">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5676186">body</span><span class="op" id="5676190">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5676194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5676197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5676201">//&nbsp;regular&nbsp;for&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676227">return</span>&nbsp;<span class="op" id="5676234">&amp;</span><span class="ident" id="5676235">ast</span><span class="op" id="5676238">.</span><span class="ident" id="5676239">ForStmt</span><span class="op" id="5676246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676250">For</span><span class="op" id="5676253">:</span>&nbsp;&nbsp;<span class="ident" id="5676256">pos</span><span class="op" id="5676259">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676263">Init</span><span class="op" id="5676267">:</span>&nbsp;<span class="ident" id="5676269">s1</span><span class="op" id="5676271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676275">Cond</span><span class="op" id="5676279">:</span>&nbsp;<span class="ident" id="5676281">p</span><span class="op" id="5676282">.</span><span class="ident" id="5676283">makeExpr</span><span class="op" id="5676291">(</span><span class="ident" id="5676292">s2</span><span class="op" id="5676294">,</span>&nbsp;<span class="string" id="5676296">&#34;boolean&nbsp;or&nbsp;range&nbsp;expression&#34;</span><span class="op" id="5676325">)</span><span class="op" id="5676326">,</span><br>
<span class="lineno">2110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676330">Post</span><span class="op" id="5676334">:</span>&nbsp;<span class="ident" id="5676336">s3</span><span class="op" id="5676338">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676342">Body</span><span class="op" id="5676346">:</span>&nbsp;<span class="ident" id="5676348">body</span><span class="op" id="5676352">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5676355">}</span><br>
<span class="lineno"></span><span class="op" id="5676357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2115</span><span class="keyword" id="5676360">func</span>&nbsp;<span class="op" id="5676365">(</span><span class="ident" id="5676366">p</span>&nbsp;<span class="op" id="5676368">*</span><span class="ident" id="5676369">parser</span><span class="op" id="5676375">)</span>&nbsp;<span class="ident" id="5676377">parseStmt</span><span class="op" id="5676386">(</span><span class="op" id="5676387">)</span>&nbsp;<span class="op" id="5676389">(</span><span class="ident" id="5676390">s</span>&nbsp;<span class="ident" id="5676392">ast</span><span class="op" id="5676395">.</span><span class="ident" id="5676396">Stmt</span><span class="op" id="5676400">)</span>&nbsp;<span class="op" id="5676402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676405">if</span>&nbsp;<span class="ident" id="5676408">p</span><span class="op" id="5676409">.</span><span class="ident" id="5676410">trace</span>&nbsp;<span class="op" id="5676416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676420">defer</span>&nbsp;<span class="ident" id="5676426">un</span><span class="op" id="5676428">(</span><span class="ident" id="5676429">trace</span><span class="op" id="5676434">(</span><span class="ident" id="5676435">p</span><span class="op" id="5676436">,</span>&nbsp;<span class="string" id="5676438">&#34;Statement&#34;</span><span class="op" id="5676449">)</span><span class="op" id="5676450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5676453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676457">switch</span>&nbsp;<span class="ident" id="5676464">p</span><span class="op" id="5676465">.</span><span class="ident" id="5676466">tok</span>&nbsp;<span class="op" id="5676470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676473">case</span>&nbsp;<span class="ident" id="5676478">token</span><span class="op" id="5676483">.</span><span class="ident" id="5676484">CONST</span><span class="op" id="5676489">,</span>&nbsp;<span class="ident" id="5676491">token</span><span class="op" id="5676496">.</span><span class="ident" id="5676497">TYPE</span><span class="op" id="5676501">,</span>&nbsp;<span class="ident" id="5676503">token</span><span class="op" id="5676508">.</span><span class="ident" id="5676509">VAR</span><span class="op" id="5676512">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676516">s</span>&nbsp;<span class="op" id="5676518">=</span>&nbsp;<span class="op" id="5676520">&amp;</span><span class="ident" id="5676521">ast</span><span class="op" id="5676524">.</span><span class="ident" id="5676525">DeclStmt</span><span class="op" id="5676533">{</span><span class="ident" id="5676534">Decl</span><span class="op" id="5676538">:</span>&nbsp;<span class="ident" id="5676540">p</span><span class="op" id="5676541">.</span><span class="ident" id="5676542">parseDecl</span><span class="op" id="5676551">(</span><span class="ident" id="5676552">syncStmt</span><span class="op" id="5676560">)</span><span class="op" id="5676561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676564">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5676571">//&nbsp;tokens&nbsp;that&nbsp;may&nbsp;start&nbsp;an&nbsp;expression</span><br>
<span class="lineno">2125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676612">token</span><span class="op" id="5676617">.</span><span class="ident" id="5676618">IDENT</span><span class="op" id="5676623">,</span>&nbsp;<span class="ident" id="5676625">token</span><span class="op" id="5676630">.</span><span class="ident" id="5676631">INT</span><span class="op" id="5676634">,</span>&nbsp;<span class="ident" id="5676636">token</span><span class="op" id="5676641">.</span><span class="ident" id="5676642">FLOAT</span><span class="op" id="5676647">,</span>&nbsp;<span class="ident" id="5676649">token</span><span class="op" id="5676654">.</span><span class="ident" id="5676655">IMAG</span><span class="op" id="5676659">,</span>&nbsp;<span class="ident" id="5676661">token</span><span class="op" id="5676666">.</span><span class="ident" id="5676667">CHAR</span><span class="op" id="5676671">,</span>&nbsp;<span class="ident" id="5676673">token</span><span class="op" id="5676678">.</span><span class="ident" id="5676679">STRING</span><span class="op" id="5676685">,</span>&nbsp;<span class="ident" id="5676687">token</span><span class="op" id="5676692">.</span><span class="ident" id="5676693">FUNC</span><span class="op" id="5676697">,</span>&nbsp;<span class="ident" id="5676699">token</span><span class="op" id="5676704">.</span><span class="ident" id="5676705">LPAREN</span><span class="op" id="5676711">,</span>&nbsp;<span class="comment" id="5676713">//&nbsp;operands</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676727">token</span><span class="op" id="5676732">.</span><span class="ident" id="5676733">LBRACK</span><span class="op" id="5676739">,</span>&nbsp;<span class="ident" id="5676741">token</span><span class="op" id="5676746">.</span><span class="ident" id="5676747">STRUCT</span><span class="op" id="5676753">,</span>&nbsp;<span class="comment" id="5676755">//&nbsp;composite&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676776">token</span><span class="op" id="5676781">.</span><span class="ident" id="5676782">ADD</span><span class="op" id="5676785">,</span>&nbsp;<span class="ident" id="5676787">token</span><span class="op" id="5676792">.</span><span class="ident" id="5676793">SUB</span><span class="op" id="5676796">,</span>&nbsp;<span class="ident" id="5676798">token</span><span class="op" id="5676803">.</span><span class="ident" id="5676804">MUL</span><span class="op" id="5676807">,</span>&nbsp;<span class="ident" id="5676809">token</span><span class="op" id="5676814">.</span><span class="ident" id="5676815">AND</span><span class="op" id="5676818">,</span>&nbsp;<span class="ident" id="5676820">token</span><span class="op" id="5676825">.</span><span class="ident" id="5676826">XOR</span><span class="op" id="5676829">,</span>&nbsp;<span class="ident" id="5676831">token</span><span class="op" id="5676836">.</span><span class="ident" id="5676837">ARROW</span><span class="op" id="5676842">,</span>&nbsp;<span class="ident" id="5676844">token</span><span class="op" id="5676849">.</span><span class="ident" id="5676850">NOT</span><span class="op" id="5676853">:</span>&nbsp;<span class="comment" id="5676855">//&nbsp;unary&nbsp;operators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676876">s</span><span class="op" id="5676877">,</span>&nbsp;<span class="ident" id="5676879">_</span>&nbsp;<span class="op" id="5676881">=</span>&nbsp;<span class="ident" id="5676883">p</span><span class="op" id="5676884">.</span><span class="ident" id="5676885">parseSimpleStmt</span><span class="op" id="5676900">(</span><span class="ident" id="5676901">labelOk</span><span class="op" id="5676908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5676912">//&nbsp;because&nbsp;of&nbsp;the&nbsp;required&nbsp;look-ahead,&nbsp;labeled&nbsp;statements&nbsp;are</span><br>
<span class="lineno">2130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5676976">//&nbsp;parsed&nbsp;by&nbsp;parseSimpleStmt&nbsp;-&nbsp;don&#39;t&nbsp;expect&nbsp;a&nbsp;semicolon&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5677040">//&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677050">if</span>&nbsp;<span class="ident" id="5677053">_</span><span class="op" id="5677054">,</span>&nbsp;<span class="ident" id="5677056">isLabeledStmt</span>&nbsp;<span class="op" id="5677070">:=</span>&nbsp;<span class="ident" id="5677073">s</span><span class="op" id="5677074">.</span><span class="op" id="5677075">(</span><span class="op" id="5677076">*</span><span class="ident" id="5677077">ast</span><span class="op" id="5677080">.</span><span class="ident" id="5677081">LabeledStmt</span><span class="op" id="5677092">)</span><span class="op" id="5677093">;</span>&nbsp;<span class="op" id="5677095">!</span><span class="ident" id="5677096">isLabeledStmt</span>&nbsp;<span class="op" id="5677110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677115">p</span><span class="op" id="5677116">.</span><span class="ident" id="5677117">expectSemi</span><span class="op" id="5677127">(</span><span class="op" id="5677128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677132">}</span><br>
<span class="lineno">2135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677135">case</span>&nbsp;<span class="ident" id="5677140">token</span><span class="op" id="5677145">.</span><span class="ident" id="5677146">GO</span><span class="op" id="5677148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677152">s</span>&nbsp;<span class="op" id="5677154">=</span>&nbsp;<span class="ident" id="5677156">p</span><span class="op" id="5677157">.</span><span class="ident" id="5677158">parseGoStmt</span><span class="op" id="5677169">(</span><span class="op" id="5677170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677173">case</span>&nbsp;<span class="ident" id="5677178">token</span><span class="op" id="5677183">.</span><span class="ident" id="5677184">DEFER</span><span class="op" id="5677189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677193">s</span>&nbsp;<span class="op" id="5677195">=</span>&nbsp;<span class="ident" id="5677197">p</span><span class="op" id="5677198">.</span><span class="ident" id="5677199">parseDeferStmt</span><span class="op" id="5677213">(</span><span class="op" id="5677214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677217">case</span>&nbsp;<span class="ident" id="5677222">token</span><span class="op" id="5677227">.</span><span class="ident" id="5677228">RETURN</span><span class="op" id="5677234">:</span><br>
<span class="lineno">2140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677238">s</span>&nbsp;<span class="op" id="5677240">=</span>&nbsp;<span class="ident" id="5677242">p</span><span class="op" id="5677243">.</span><span class="ident" id="5677244">parseReturnStmt</span><span class="op" id="5677259">(</span><span class="op" id="5677260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677263">case</span>&nbsp;<span class="ident" id="5677268">token</span><span class="op" id="5677273">.</span><span class="ident" id="5677274">BREAK</span><span class="op" id="5677279">,</span>&nbsp;<span class="ident" id="5677281">token</span><span class="op" id="5677286">.</span><span class="ident" id="5677287">CONTINUE</span><span class="op" id="5677295">,</span>&nbsp;<span class="ident" id="5677297">token</span><span class="op" id="5677302">.</span><span class="ident" id="5677303">GOTO</span><span class="op" id="5677307">,</span>&nbsp;<span class="ident" id="5677309">token</span><span class="op" id="5677314">.</span><span class="ident" id="5677315">FALLTHROUGH</span><span class="op" id="5677326">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677330">s</span>&nbsp;<span class="op" id="5677332">=</span>&nbsp;<span class="ident" id="5677334">p</span><span class="op" id="5677335">.</span><span class="ident" id="5677336">parseBranchStmt</span><span class="op" id="5677351">(</span><span class="ident" id="5677352">p</span><span class="op" id="5677353">.</span><span class="ident" id="5677354">tok</span><span class="op" id="5677357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677360">case</span>&nbsp;<span class="ident" id="5677365">token</span><span class="op" id="5677370">.</span><span class="ident" id="5677371">LBRACE</span><span class="op" id="5677377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677381">s</span>&nbsp;<span class="op" id="5677383">=</span>&nbsp;<span class="ident" id="5677385">p</span><span class="op" id="5677386">.</span><span class="ident" id="5677387">parseBlockStmt</span><span class="op" id="5677401">(</span><span class="op" id="5677402">)</span><br>
<span class="lineno">2145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677406">p</span><span class="op" id="5677407">.</span><span class="ident" id="5677408">expectSemi</span><span class="op" id="5677418">(</span><span class="op" id="5677419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677422">case</span>&nbsp;<span class="ident" id="5677427">token</span><span class="op" id="5677432">.</span><span class="ident" id="5677433">IF</span><span class="op" id="5677435">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677439">s</span>&nbsp;<span class="op" id="5677441">=</span>&nbsp;<span class="ident" id="5677443">p</span><span class="op" id="5677444">.</span><span class="ident" id="5677445">parseIfStmt</span><span class="op" id="5677456">(</span><span class="op" id="5677457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677460">case</span>&nbsp;<span class="ident" id="5677465">token</span><span class="op" id="5677470">.</span><span class="ident" id="5677471">SWITCH</span><span class="op" id="5677477">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677481">s</span>&nbsp;<span class="op" id="5677483">=</span>&nbsp;<span class="ident" id="5677485">p</span><span class="op" id="5677486">.</span><span class="ident" id="5677487">parseSwitchStmt</span><span class="op" id="5677502">(</span><span class="op" id="5677503">)</span><br>
<span class="lineno">2150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677506">case</span>&nbsp;<span class="ident" id="5677511">token</span><span class="op" id="5677516">.</span><span class="ident" id="5677517">SELECT</span><span class="op" id="5677523">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677527">s</span>&nbsp;<span class="op" id="5677529">=</span>&nbsp;<span class="ident" id="5677531">p</span><span class="op" id="5677532">.</span><span class="ident" id="5677533">parseSelectStmt</span><span class="op" id="5677548">(</span><span class="op" id="5677549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677552">case</span>&nbsp;<span class="ident" id="5677557">token</span><span class="op" id="5677562">.</span><span class="ident" id="5677563">FOR</span><span class="op" id="5677566">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677570">s</span>&nbsp;<span class="op" id="5677572">=</span>&nbsp;<span class="ident" id="5677574">p</span><span class="op" id="5677575">.</span><span class="ident" id="5677576">parseForStmt</span><span class="op" id="5677588">(</span><span class="op" id="5677589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677592">case</span>&nbsp;<span class="ident" id="5677597">token</span><span class="op" id="5677602">.</span><span class="ident" id="5677603">SEMICOLON</span><span class="op" id="5677612">:</span><br>
<span class="lineno">2155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677616">s</span>&nbsp;<span class="op" id="5677618">=</span>&nbsp;<span class="op" id="5677620">&amp;</span><span class="ident" id="5677621">ast</span><span class="op" id="5677624">.</span><span class="ident" id="5677625">EmptyStmt</span><span class="op" id="5677634">{</span><span class="ident" id="5677635">Semicolon</span><span class="op" id="5677644">:</span>&nbsp;<span class="ident" id="5677646">p</span><span class="op" id="5677647">.</span><span class="ident" id="5677648">pos</span><span class="op" id="5677651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677655">p</span><span class="op" id="5677656">.</span><span class="ident" id="5677657">next</span><span class="op" id="5677661">(</span><span class="op" id="5677662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677665">case</span>&nbsp;<span class="ident" id="5677670">token</span><span class="op" id="5677675">.</span><span class="ident" id="5677676">RBRACE</span><span class="op" id="5677682">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5677686">//&nbsp;a&nbsp;semicolon&nbsp;may&nbsp;be&nbsp;omitted&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#34;}&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677739">s</span>&nbsp;<span class="op" id="5677741">=</span>&nbsp;<span class="op" id="5677743">&amp;</span><span class="ident" id="5677744">ast</span><span class="op" id="5677747">.</span><span class="ident" id="5677748">EmptyStmt</span><span class="op" id="5677757">{</span><span class="ident" id="5677758">Semicolon</span><span class="op" id="5677767">:</span>&nbsp;<span class="ident" id="5677769">p</span><span class="op" id="5677770">.</span><span class="ident" id="5677771">pos</span><span class="op" id="5677774">}</span><br>
<span class="lineno">2160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677777">default</span><span class="op" id="5677784">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5677788">//&nbsp;no&nbsp;statement&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677812">pos</span>&nbsp;<span class="op" id="5677816">:=</span>&nbsp;<span class="ident" id="5677819">p</span><span class="op" id="5677820">.</span><span class="ident" id="5677821">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677827">p</span><span class="op" id="5677828">.</span><span class="ident" id="5677829">errorExpected</span><span class="op" id="5677842">(</span><span class="ident" id="5677843">pos</span><span class="op" id="5677846">,</span>&nbsp;<span class="string" id="5677848">&#34;statement&#34;</span><span class="op" id="5677859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677863">syncStmt</span><span class="op" id="5677871">(</span><span class="ident" id="5677872">p</span><span class="op" id="5677873">)</span><br>
<span class="lineno">2165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677877">s</span>&nbsp;<span class="op" id="5677879">=</span>&nbsp;<span class="op" id="5677881">&amp;</span><span class="ident" id="5677882">ast</span><span class="op" id="5677885">.</span><span class="ident" id="5677886">BadStmt</span><span class="op" id="5677893">{</span><span class="ident" id="5677894">From</span><span class="op" id="5677898">:</span>&nbsp;<span class="ident" id="5677900">pos</span><span class="op" id="5677903">,</span>&nbsp;<span class="ident" id="5677905">To</span><span class="op" id="5677907">:</span>&nbsp;<span class="ident" id="5677909">p</span><span class="op" id="5677910">.</span><span class="ident" id="5677911">pos</span><span class="op" id="5677914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677921">return</span><br>
<span class="lineno"></span><span class="op" id="5677928">}</span><br>
<span class="lineno">2170</span><br>
<span class="lineno"></span><span class="comment" id="5677931">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5678011">//&nbsp;Declarations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5678028">type</span>&nbsp;<span class="ident" id="5678033">parseSpecFunction</span>&nbsp;<span class="keyword" id="5678051">func</span><span class="op" id="5678055">(</span><span class="ident" id="5678056">doc</span>&nbsp;<span class="op" id="5678060">*</span><span class="ident" id="5678061">ast</span><span class="op" id="5678064">.</span><span class="ident" id="5678065">CommentGroup</span><span class="op" id="5678077">,</span>&nbsp;<span class="ident" id="5678079">keyword</span>&nbsp;<span class="ident" id="5678087">token</span><span class="op" id="5678092">.</span><span class="ident" id="5678093">Token</span><span class="op" id="5678098">,</span>&nbsp;<span class="ident" id="5678100">iota</span>&nbsp;<span class="builtintype" id="5678105">int</span><span class="op" id="5678108">)</span>&nbsp;<span class="ident" id="5678110">ast</span><span class="op" id="5678113">.</span><span class="ident" id="5678114">Spec</span><br>
<span class="lineno">2175</span><br>
<span class="lineno"></span><span class="keyword" id="5678120">func</span>&nbsp;<span class="ident" id="5678125">isValidImport</span><span class="op" id="5678138">(</span><span class="ident" id="5678139">lit</span>&nbsp;<span class="builtintype" id="5678143">string</span><span class="op" id="5678149">)</span>&nbsp;<span class="builtintype" id="5678151">bool</span>&nbsp;<span class="op" id="5678156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678159">const</span>&nbsp;<span class="ident" id="5678165">illegalChars</span>&nbsp;<span class="op" id="5678178">=</span>&nbsp;<span class="string" id="5678180">`!&#34;#$%&amp;&#39;()*,:;&lt;=&gt;?[\]^{|}`</span>&nbsp;<span class="op" id="5678207">+</span>&nbsp;<span class="string" id="5678209">&#34;`\uFFFD&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678220">s</span><span class="op" id="5678221">,</span>&nbsp;<span class="ident" id="5678223">_</span>&nbsp;<span class="op" id="5678225">:=</span>&nbsp;<span class="ident" id="5678228">strconv</span><span class="op" id="5678235">.</span><span class="ident" id="5678236">Unquote</span><span class="op" id="5678243">(</span><span class="ident" id="5678244">lit</span><span class="op" id="5678247">)</span>&nbsp;<span class="comment" id="5678249">//&nbsp;go/scanner&nbsp;returns&nbsp;a&nbsp;legal&nbsp;string&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678295">for</span>&nbsp;<span class="ident" id="5678299">_</span><span class="op" id="5678300">,</span>&nbsp;<span class="ident" id="5678302">r</span>&nbsp;<span class="op" id="5678304">:=</span>&nbsp;<span class="keyword" id="5678307">range</span>&nbsp;<span class="ident" id="5678313">s</span>&nbsp;<span class="op" id="5678315">{</span><br>
<span class="lineno">2180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678319">if</span>&nbsp;<span class="op" id="5678322">!</span><span class="ident" id="5678323">unicode</span><span class="op" id="5678330">.</span><span class="ident" id="5678331">IsGraphic</span><span class="op" id="5678340">(</span><span class="ident" id="5678341">r</span><span class="op" id="5678342">)</span>&nbsp;<span class="op" id="5678344">||</span>&nbsp;<span class="ident" id="5678347">unicode</span><span class="op" id="5678354">.</span><span class="ident" id="5678355">IsSpace</span><span class="op" id="5678362">(</span><span class="ident" id="5678363">r</span><span class="op" id="5678364">)</span>&nbsp;<span class="op" id="5678366">||</span>&nbsp;<span class="ident" id="5678369">strings</span><span class="op" id="5678376">.</span><span class="ident" id="5678377">ContainsRune</span><span class="op" id="5678389">(</span><span class="ident" id="5678390">illegalChars</span><span class="op" id="5678402">,</span>&nbsp;<span class="ident" id="5678404">r</span><span class="op" id="5678405">)</span>&nbsp;<span class="op" id="5678407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678412">return</span>&nbsp;<span class="builtintype" id="5678419">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678433">return</span>&nbsp;<span class="ident" id="5678440">s</span>&nbsp;<span class="op" id="5678442">!=</span>&nbsp;<span class="string" id="5678445">&#34;&#34;</span><br>
<span class="lineno">2185</span><span class="op" id="5678448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5678451">func</span>&nbsp;<span class="op" id="5678456">(</span><span class="ident" id="5678457">p</span>&nbsp;<span class="op" id="5678459">*</span><span class="ident" id="5678460">parser</span><span class="op" id="5678466">)</span>&nbsp;<span class="ident" id="5678468">parseImportSpec</span><span class="op" id="5678483">(</span><span class="ident" id="5678484">doc</span>&nbsp;<span class="op" id="5678488">*</span><span class="ident" id="5678489">ast</span><span class="op" id="5678492">.</span><span class="ident" id="5678493">CommentGroup</span><span class="op" id="5678505">,</span>&nbsp;<span class="ident" id="5678507">_</span>&nbsp;<span class="ident" id="5678509">token</span><span class="op" id="5678514">.</span><span class="ident" id="5678515">Token</span><span class="op" id="5678520">,</span>&nbsp;<span class="ident" id="5678522">_</span>&nbsp;<span class="builtintype" id="5678524">int</span><span class="op" id="5678527">)</span>&nbsp;<span class="ident" id="5678529">ast</span><span class="op" id="5678532">.</span><span class="ident" id="5678533">Spec</span>&nbsp;<span class="op" id="5678538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678541">if</span>&nbsp;<span class="ident" id="5678544">p</span><span class="op" id="5678545">.</span><span class="ident" id="5678546">trace</span>&nbsp;<span class="op" id="5678552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678556">defer</span>&nbsp;<span class="ident" id="5678562">un</span><span class="op" id="5678564">(</span><span class="ident" id="5678565">trace</span><span class="op" id="5678570">(</span><span class="ident" id="5678571">p</span><span class="op" id="5678572">,</span>&nbsp;<span class="string" id="5678574">&#34;ImportSpec&#34;</span><span class="op" id="5678586">)</span><span class="op" id="5678587">)</span><br>
<span class="lineno">2190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678594">var</span>&nbsp;<span class="ident" id="5678598">ident</span>&nbsp;<span class="op" id="5678604">*</span><span class="ident" id="5678605">ast</span><span class="op" id="5678608">.</span><span class="ident" id="5678609">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678616">switch</span>&nbsp;<span class="ident" id="5678623">p</span><span class="op" id="5678624">.</span><span class="ident" id="5678625">tok</span>&nbsp;<span class="op" id="5678629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678632">case</span>&nbsp;<span class="ident" id="5678637">token</span><span class="op" id="5678642">.</span><span class="ident" id="5678643">PERIOD</span><span class="op" id="5678649">:</span><br>
<span class="lineno">2195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678653">ident</span>&nbsp;<span class="op" id="5678659">=</span>&nbsp;<span class="op" id="5678661">&amp;</span><span class="ident" id="5678662">ast</span><span class="op" id="5678665">.</span><span class="ident" id="5678666">Ident</span><span class="op" id="5678671">{</span><span class="ident" id="5678672">NamePos</span><span class="op" id="5678679">:</span>&nbsp;<span class="ident" id="5678681">p</span><span class="op" id="5678682">.</span><span class="ident" id="5678683">pos</span><span class="op" id="5678686">,</span>&nbsp;<span class="ident" id="5678688">Name</span><span class="op" id="5678692">:</span>&nbsp;<span class="string" id="5678694">&#34;.&#34;</span><span class="op" id="5678697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678701">p</span><span class="op" id="5678702">.</span><span class="ident" id="5678703">next</span><span class="op" id="5678707">(</span><span class="op" id="5678708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678711">case</span>&nbsp;<span class="ident" id="5678716">token</span><span class="op" id="5678721">.</span><span class="ident" id="5678722">IDENT</span><span class="op" id="5678727">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678731">ident</span>&nbsp;<span class="op" id="5678737">=</span>&nbsp;<span class="ident" id="5678739">p</span><span class="op" id="5678740">.</span><span class="ident" id="5678741">parseIdent</span><span class="op" id="5678751">(</span><span class="op" id="5678752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678755">}</span><br>
<span class="lineno">2200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678759">pos</span>&nbsp;<span class="op" id="5678763">:=</span>&nbsp;<span class="ident" id="5678766">p</span><span class="op" id="5678767">.</span><span class="ident" id="5678768">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678773">var</span>&nbsp;<span class="ident" id="5678777">path</span>&nbsp;<span class="builtintype" id="5678782">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678790">if</span>&nbsp;<span class="ident" id="5678793">p</span><span class="op" id="5678794">.</span><span class="ident" id="5678795">tok</span>&nbsp;<span class="op" id="5678799">==</span>&nbsp;<span class="ident" id="5678802">token</span><span class="op" id="5678807">.</span><span class="ident" id="5678808">STRING</span>&nbsp;<span class="op" id="5678815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678819">path</span>&nbsp;<span class="op" id="5678824">=</span>&nbsp;<span class="ident" id="5678826">p</span><span class="op" id="5678827">.</span><span class="ident" id="5678828">lit</span><br>
<span class="lineno">2205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678834">if</span>&nbsp;<span class="op" id="5678837">!</span><span class="ident" id="5678838">isValidImport</span><span class="op" id="5678851">(</span><span class="ident" id="5678852">path</span><span class="op" id="5678856">)</span>&nbsp;<span class="op" id="5678858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678863">p</span><span class="op" id="5678864">.</span><span class="builtintype" id="5678865">error</span><span class="op" id="5678870">(</span><span class="ident" id="5678871">pos</span><span class="op" id="5678874">,</span>&nbsp;<span class="string" id="5678876">&#34;invalid&nbsp;import&nbsp;path:&nbsp;&#34;</span><span class="op" id="5678899">+</span><span class="ident" id="5678900">path</span><span class="op" id="5678904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678912">p</span><span class="op" id="5678913">.</span><span class="ident" id="5678914">next</span><span class="op" id="5678918">(</span><span class="op" id="5678919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678922">}</span>&nbsp;<span class="keyword" id="5678924">else</span>&nbsp;<span class="op" id="5678929">{</span><br>
<span class="lineno">2210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678933">p</span><span class="op" id="5678934">.</span><span class="ident" id="5678935">expect</span><span class="op" id="5678941">(</span><span class="ident" id="5678942">token</span><span class="op" id="5678947">.</span><span class="ident" id="5678948">STRING</span><span class="op" id="5678954">)</span>&nbsp;<span class="comment" id="5678956">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678991">p</span><span class="op" id="5678992">.</span><span class="ident" id="5678993">expectSemi</span><span class="op" id="5679003">(</span><span class="op" id="5679004">)</span>&nbsp;<span class="comment" id="5679006">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679047">//&nbsp;collect&nbsp;imports</span><br>
<span class="lineno">2215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679067">spec</span>&nbsp;<span class="op" id="5679072">:=</span>&nbsp;<span class="op" id="5679075">&amp;</span><span class="ident" id="5679076">ast</span><span class="op" id="5679079">.</span><span class="ident" id="5679080">ImportSpec</span><span class="op" id="5679090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679094">Doc</span><span class="op" id="5679097">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5679103">doc</span><span class="op" id="5679106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679110">Name</span><span class="op" id="5679114">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5679119">ident</span><span class="op" id="5679124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679128">Path</span><span class="op" id="5679132">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5679137">&amp;</span><span class="ident" id="5679138">ast</span><span class="op" id="5679141">.</span><span class="ident" id="5679142">BasicLit</span><span class="op" id="5679150">{</span><span class="ident" id="5679151">ValuePos</span><span class="op" id="5679159">:</span>&nbsp;<span class="ident" id="5679161">pos</span><span class="op" id="5679164">,</span>&nbsp;<span class="ident" id="5679166">Kind</span><span class="op" id="5679170">:</span>&nbsp;<span class="ident" id="5679172">token</span><span class="op" id="5679177">.</span><span class="ident" id="5679178">STRING</span><span class="op" id="5679184">,</span>&nbsp;<span class="ident" id="5679186">Value</span><span class="op" id="5679191">:</span>&nbsp;<span class="ident" id="5679193">path</span><span class="op" id="5679197">}</span><span class="op" id="5679198">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679202">Comment</span><span class="op" id="5679209">:</span>&nbsp;<span class="ident" id="5679211">p</span><span class="op" id="5679212">.</span><span class="ident" id="5679213">lineComment</span><span class="op" id="5679224">,</span><br>
<span class="lineno">2220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679230">p</span><span class="op" id="5679231">.</span><span class="ident" id="5679232">imports</span>&nbsp;<span class="op" id="5679240">=</span>&nbsp;<span class="builtinfunc" id="5679242">append</span><span class="op" id="5679248">(</span><span class="ident" id="5679249">p</span><span class="op" id="5679250">.</span><span class="ident" id="5679251">imports</span><span class="op" id="5679258">,</span>&nbsp;<span class="ident" id="5679260">spec</span><span class="op" id="5679264">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679268">return</span>&nbsp;<span class="ident" id="5679275">spec</span><br>
<span class="lineno"></span><span class="op" id="5679280">}</span><br>
<span class="lineno">2225</span><br>
<span class="lineno"></span><span class="keyword" id="5679283">func</span>&nbsp;<span class="op" id="5679288">(</span><span class="ident" id="5679289">p</span>&nbsp;<span class="op" id="5679291">*</span><span class="ident" id="5679292">parser</span><span class="op" id="5679298">)</span>&nbsp;<span class="ident" id="5679300">parseValueSpec</span><span class="op" id="5679314">(</span><span class="ident" id="5679315">doc</span>&nbsp;<span class="op" id="5679319">*</span><span class="ident" id="5679320">ast</span><span class="op" id="5679323">.</span><span class="ident" id="5679324">CommentGroup</span><span class="op" id="5679336">,</span>&nbsp;<span class="ident" id="5679338">keyword</span>&nbsp;<span class="ident" id="5679346">token</span><span class="op" id="5679351">.</span><span class="ident" id="5679352">Token</span><span class="op" id="5679357">,</span>&nbsp;<span class="ident" id="5679359">iota</span>&nbsp;<span class="builtintype" id="5679364">int</span><span class="op" id="5679367">)</span>&nbsp;<span class="ident" id="5679369">ast</span><span class="op" id="5679372">.</span><span class="ident" id="5679373">Spec</span>&nbsp;<span class="op" id="5679378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679381">if</span>&nbsp;<span class="ident" id="5679384">p</span><span class="op" id="5679385">.</span><span class="ident" id="5679386">trace</span>&nbsp;<span class="op" id="5679392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679396">defer</span>&nbsp;<span class="ident" id="5679402">un</span><span class="op" id="5679404">(</span><span class="ident" id="5679405">trace</span><span class="op" id="5679410">(</span><span class="ident" id="5679411">p</span><span class="op" id="5679412">,</span>&nbsp;<span class="ident" id="5679414">keyword</span><span class="op" id="5679421">.</span><span class="ident" id="5679422">String</span><span class="op" id="5679428">(</span><span class="op" id="5679429">)</span><span class="op" id="5679430">+</span><span class="string" id="5679431">&#34;Spec&#34;</span><span class="op" id="5679437">)</span><span class="op" id="5679438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679441">}</span><br>
<span class="lineno">2230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679445">idents</span>&nbsp;<span class="op" id="5679452">:=</span>&nbsp;<span class="ident" id="5679455">p</span><span class="op" id="5679456">.</span><span class="ident" id="5679457">parseIdentList</span><span class="op" id="5679471">(</span><span class="op" id="5679472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679475">typ</span>&nbsp;<span class="op" id="5679479">:=</span>&nbsp;<span class="ident" id="5679482">p</span><span class="op" id="5679483">.</span><span class="ident" id="5679484">tryType</span><span class="op" id="5679491">(</span><span class="op" id="5679492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679495">var</span>&nbsp;<span class="ident" id="5679499">values</span>&nbsp;<span class="op" id="5679506">[</span><span class="op" id="5679507">]</span><span class="ident" id="5679508">ast</span><span class="op" id="5679511">.</span><span class="ident" id="5679512">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679518">//&nbsp;always&nbsp;permit&nbsp;optional&nbsp;initialization&nbsp;for&nbsp;more&nbsp;tolerant&nbsp;parsing</span><br>
<span class="lineno">2235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679586">if</span>&nbsp;<span class="ident" id="5679589">p</span><span class="op" id="5679590">.</span><span class="ident" id="5679591">tok</span>&nbsp;<span class="op" id="5679595">==</span>&nbsp;<span class="ident" id="5679598">token</span><span class="op" id="5679603">.</span><span class="ident" id="5679604">ASSIGN</span>&nbsp;<span class="op" id="5679611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679615">p</span><span class="op" id="5679616">.</span><span class="ident" id="5679617">next</span><span class="op" id="5679621">(</span><span class="op" id="5679622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679626">values</span>&nbsp;<span class="op" id="5679633">=</span>&nbsp;<span class="ident" id="5679635">p</span><span class="op" id="5679636">.</span><span class="ident" id="5679637">parseRhsList</span><span class="op" id="5679649">(</span><span class="op" id="5679650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679656">p</span><span class="op" id="5679657">.</span><span class="ident" id="5679658">expectSemi</span><span class="op" id="5679668">(</span><span class="op" id="5679669">)</span>&nbsp;<span class="comment" id="5679671">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno">2240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679712">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;constant&nbsp;or&nbsp;variable&nbsp;identifier&nbsp;declared&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679788">//&nbsp;a&nbsp;function&nbsp;begins&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;ConstSpec&nbsp;or&nbsp;VarSpec&nbsp;and&nbsp;ends&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679861">//&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679908">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno">2245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679981">spec</span>&nbsp;<span class="op" id="5679986">:=</span>&nbsp;<span class="op" id="5679989">&amp;</span><span class="ident" id="5679990">ast</span><span class="op" id="5679993">.</span><span class="ident" id="5679994">ValueSpec</span><span class="op" id="5680003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680007">Doc</span><span class="op" id="5680010">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680016">doc</span><span class="op" id="5680019">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680023">Names</span><span class="op" id="5680028">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5680032">idents</span><span class="op" id="5680038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680042">Type</span><span class="op" id="5680046">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5680051">typ</span><span class="op" id="5680054">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680058">Values</span><span class="op" id="5680064">:</span>&nbsp;&nbsp;<span class="ident" id="5680067">values</span><span class="op" id="5680073">,</span><br>
<span class="lineno">2250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680077">Comment</span><span class="op" id="5680084">:</span>&nbsp;<span class="ident" id="5680086">p</span><span class="op" id="5680087">.</span><span class="ident" id="5680088">lineComment</span><span class="op" id="5680099">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680105">kind</span>&nbsp;<span class="op" id="5680110">:=</span>&nbsp;<span class="ident" id="5680113">ast</span><span class="op" id="5680116">.</span><span class="ident" id="5680117">Con</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680122">if</span>&nbsp;<span class="ident" id="5680125">keyword</span>&nbsp;<span class="op" id="5680133">==</span>&nbsp;<span class="ident" id="5680136">token</span><span class="op" id="5680141">.</span><span class="ident" id="5680142">VAR</span>&nbsp;<span class="op" id="5680146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680150">kind</span>&nbsp;<span class="op" id="5680155">=</span>&nbsp;<span class="ident" id="5680157">ast</span><span class="op" id="5680160">.</span><span class="ident" id="5680161">Var</span><br>
<span class="lineno">2255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680169">p</span><span class="op" id="5680170">.</span><span class="ident" id="5680171">declare</span><span class="op" id="5680178">(</span><span class="ident" id="5680179">spec</span><span class="op" id="5680183">,</span>&nbsp;<span class="ident" id="5680185">iota</span><span class="op" id="5680189">,</span>&nbsp;<span class="ident" id="5680191">p</span><span class="op" id="5680192">.</span><span class="ident" id="5680193">topScope</span><span class="op" id="5680201">,</span>&nbsp;<span class="ident" id="5680203">kind</span><span class="op" id="5680207">,</span>&nbsp;<span class="ident" id="5680209">idents</span><span class="op" id="5680215">...</span><span class="op" id="5680218">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680222">return</span>&nbsp;<span class="ident" id="5680229">spec</span><br>
<span class="lineno"></span><span class="op" id="5680234">}</span><br>
<span class="lineno">2260</span><br>
<span class="lineno"></span><span class="keyword" id="5680237">func</span>&nbsp;<span class="op" id="5680242">(</span><span class="ident" id="5680243">p</span>&nbsp;<span class="op" id="5680245">*</span><span class="ident" id="5680246">parser</span><span class="op" id="5680252">)</span>&nbsp;<span class="ident" id="5680254">parseTypeSpec</span><span class="op" id="5680267">(</span><span class="ident" id="5680268">doc</span>&nbsp;<span class="op" id="5680272">*</span><span class="ident" id="5680273">ast</span><span class="op" id="5680276">.</span><span class="ident" id="5680277">CommentGroup</span><span class="op" id="5680289">,</span>&nbsp;<span class="ident" id="5680291">_</span>&nbsp;<span class="ident" id="5680293">token</span><span class="op" id="5680298">.</span><span class="ident" id="5680299">Token</span><span class="op" id="5680304">,</span>&nbsp;<span class="ident" id="5680306">_</span>&nbsp;<span class="builtintype" id="5680308">int</span><span class="op" id="5680311">)</span>&nbsp;<span class="ident" id="5680313">ast</span><span class="op" id="5680316">.</span><span class="ident" id="5680317">Spec</span>&nbsp;<span class="op" id="5680322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680325">if</span>&nbsp;<span class="ident" id="5680328">p</span><span class="op" id="5680329">.</span><span class="ident" id="5680330">trace</span>&nbsp;<span class="op" id="5680336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680340">defer</span>&nbsp;<span class="ident" id="5680346">un</span><span class="op" id="5680348">(</span><span class="ident" id="5680349">trace</span><span class="op" id="5680354">(</span><span class="ident" id="5680355">p</span><span class="op" id="5680356">,</span>&nbsp;<span class="string" id="5680358">&#34;TypeSpec&#34;</span><span class="op" id="5680368">)</span><span class="op" id="5680369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680372">}</span><br>
<span class="lineno">2265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680376">ident</span>&nbsp;<span class="op" id="5680382">:=</span>&nbsp;<span class="ident" id="5680385">p</span><span class="op" id="5680386">.</span><span class="ident" id="5680387">parseIdent</span><span class="op" id="5680397">(</span><span class="op" id="5680398">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680402">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;type&nbsp;identifier&nbsp;declared&nbsp;inside&nbsp;a&nbsp;function&nbsp;begins</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680480">//&nbsp;at&nbsp;the&nbsp;identifier&nbsp;in&nbsp;the&nbsp;TypeSpec&nbsp;and&nbsp;ends&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost</span><br>
<span class="lineno">2270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680555">//&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680577">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680650">spec</span>&nbsp;<span class="op" id="5680655">:=</span>&nbsp;<span class="op" id="5680658">&amp;</span><span class="ident" id="5680659">ast</span><span class="op" id="5680662">.</span><span class="ident" id="5680663">TypeSpec</span><span class="op" id="5680671">{</span><span class="ident" id="5680672">Doc</span><span class="op" id="5680675">:</span>&nbsp;<span class="ident" id="5680677">doc</span><span class="op" id="5680680">,</span>&nbsp;<span class="ident" id="5680682">Name</span><span class="op" id="5680686">:</span>&nbsp;<span class="ident" id="5680688">ident</span><span class="op" id="5680693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680696">p</span><span class="op" id="5680697">.</span><span class="ident" id="5680698">declare</span><span class="op" id="5680705">(</span><span class="ident" id="5680706">spec</span><span class="op" id="5680710">,</span>&nbsp;<span class="ident" id="5680712">nil</span><span class="op" id="5680715">,</span>&nbsp;<span class="ident" id="5680717">p</span><span class="op" id="5680718">.</span><span class="ident" id="5680719">topScope</span><span class="op" id="5680727">,</span>&nbsp;<span class="ident" id="5680729">ast</span><span class="op" id="5680732">.</span><span class="ident" id="5680733">Typ</span><span class="op" id="5680736">,</span>&nbsp;<span class="ident" id="5680738">ident</span><span class="op" id="5680743">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680747">spec</span><span class="op" id="5680751">.</span><span class="ident" id="5680752">Type</span>&nbsp;<span class="op" id="5680757">=</span>&nbsp;<span class="ident" id="5680759">p</span><span class="op" id="5680760">.</span><span class="ident" id="5680761">parseType</span><span class="op" id="5680770">(</span><span class="op" id="5680771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680774">p</span><span class="op" id="5680775">.</span><span class="ident" id="5680776">expectSemi</span><span class="op" id="5680786">(</span><span class="op" id="5680787">)</span>&nbsp;<span class="comment" id="5680789">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680829">spec</span><span class="op" id="5680833">.</span><span class="ident" id="5680834">Comment</span>&nbsp;<span class="op" id="5680842">=</span>&nbsp;<span class="ident" id="5680844">p</span><span class="op" id="5680845">.</span><span class="ident" id="5680846">lineComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680860">return</span>&nbsp;<span class="ident" id="5680867">spec</span><br>
<span class="lineno">2280</span><span class="op" id="5680872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5680875">func</span>&nbsp;<span class="op" id="5680880">(</span><span class="ident" id="5680881">p</span>&nbsp;<span class="op" id="5680883">*</span><span class="ident" id="5680884">parser</span><span class="op" id="5680890">)</span>&nbsp;<span class="ident" id="5680892">parseGenDecl</span><span class="op" id="5680904">(</span><span class="ident" id="5680905">keyword</span>&nbsp;<span class="ident" id="5680913">token</span><span class="op" id="5680918">.</span><span class="ident" id="5680919">Token</span><span class="op" id="5680924">,</span>&nbsp;<span class="ident" id="5680926">f</span>&nbsp;<span class="ident" id="5680928">parseSpecFunction</span><span class="op" id="5680945">)</span>&nbsp;<span class="op" id="5680947">*</span><span class="ident" id="5680948">ast</span><span class="op" id="5680951">.</span><span class="ident" id="5680952">GenDecl</span>&nbsp;<span class="op" id="5680960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680963">if</span>&nbsp;<span class="ident" id="5680966">p</span><span class="op" id="5680967">.</span><span class="ident" id="5680968">trace</span>&nbsp;<span class="op" id="5680974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680978">defer</span>&nbsp;<span class="ident" id="5680984">un</span><span class="op" id="5680986">(</span><span class="ident" id="5680987">trace</span><span class="op" id="5680992">(</span><span class="ident" id="5680993">p</span><span class="op" id="5680994">,</span>&nbsp;<span class="string" id="5680996">&#34;GenDecl(&#34;</span><span class="op" id="5681006">+</span><span class="ident" id="5681007">keyword</span><span class="op" id="5681014">.</span><span class="ident" id="5681015">String</span><span class="op" id="5681021">(</span><span class="op" id="5681022">)</span><span class="op" id="5681023">+</span><span class="string" id="5681024">&#34;)&#34;</span><span class="op" id="5681027">)</span><span class="op" id="5681028">)</span><br>
<span class="lineno">2285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681035">doc</span>&nbsp;<span class="op" id="5681039">:=</span>&nbsp;<span class="ident" id="5681042">p</span><span class="op" id="5681043">.</span><span class="ident" id="5681044">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681057">pos</span>&nbsp;<span class="op" id="5681061">:=</span>&nbsp;<span class="ident" id="5681064">p</span><span class="op" id="5681065">.</span><span class="ident" id="5681066">expect</span><span class="op" id="5681072">(</span><span class="ident" id="5681073">keyword</span><span class="op" id="5681080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681083">var</span>&nbsp;<span class="ident" id="5681087">lparen</span><span class="op" id="5681093">,</span>&nbsp;<span class="ident" id="5681095">rparen</span>&nbsp;<span class="ident" id="5681102">token</span><span class="op" id="5681107">.</span><span class="ident" id="5681108">Pos</span><br>
<span class="lineno">2290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681113">var</span>&nbsp;<span class="ident" id="5681117">list</span>&nbsp;<span class="op" id="5681122">[</span><span class="op" id="5681123">]</span><span class="ident" id="5681124">ast</span><span class="op" id="5681127">.</span><span class="ident" id="5681128">Spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681134">if</span>&nbsp;<span class="ident" id="5681137">p</span><span class="op" id="5681138">.</span><span class="ident" id="5681139">tok</span>&nbsp;<span class="op" id="5681143">==</span>&nbsp;<span class="ident" id="5681146">token</span><span class="op" id="5681151">.</span><span class="ident" id="5681152">LPAREN</span>&nbsp;<span class="op" id="5681159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681163">lparen</span>&nbsp;<span class="op" id="5681170">=</span>&nbsp;<span class="ident" id="5681172">p</span><span class="op" id="5681173">.</span><span class="ident" id="5681174">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681180">p</span><span class="op" id="5681181">.</span><span class="ident" id="5681182">next</span><span class="op" id="5681186">(</span><span class="op" id="5681187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681191">for</span>&nbsp;<span class="ident" id="5681195">iota</span>&nbsp;<span class="op" id="5681200">:=</span>&nbsp;<span class="num" id="5681203">0</span><span class="op" id="5681204">;</span>&nbsp;<span class="ident" id="5681206">p</span><span class="op" id="5681207">.</span><span class="ident" id="5681208">tok</span>&nbsp;<span class="op" id="5681212">!=</span>&nbsp;<span class="ident" id="5681215">token</span><span class="op" id="5681220">.</span><span class="ident" id="5681221">RPAREN</span>&nbsp;<span class="op" id="5681228">&amp;&amp;</span>&nbsp;<span class="ident" id="5681231">p</span><span class="op" id="5681232">.</span><span class="ident" id="5681233">tok</span>&nbsp;<span class="op" id="5681237">!=</span>&nbsp;<span class="ident" id="5681240">token</span><span class="op" id="5681245">.</span><span class="ident" id="5681246">EOF</span><span class="op" id="5681249">;</span>&nbsp;<span class="ident" id="5681251">iota</span><span class="op" id="5681255">++</span>&nbsp;<span class="op" id="5681258">{</span><br>
<span class="lineno">2295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681263">list</span>&nbsp;<span class="op" id="5681268">=</span>&nbsp;<span class="builtinfunc" id="5681270">append</span><span class="op" id="5681276">(</span><span class="ident" id="5681277">list</span><span class="op" id="5681281">,</span>&nbsp;<span class="ident" id="5681283">f</span><span class="op" id="5681284">(</span><span class="ident" id="5681285">p</span><span class="op" id="5681286">.</span><span class="ident" id="5681287">leadComment</span><span class="op" id="5681298">,</span>&nbsp;<span class="ident" id="5681300">keyword</span><span class="op" id="5681307">,</span>&nbsp;<span class="ident" id="5681309">iota</span><span class="op" id="5681313">)</span><span class="op" id="5681314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681322">rparen</span>&nbsp;<span class="op" id="5681329">=</span>&nbsp;<span class="ident" id="5681331">p</span><span class="op" id="5681332">.</span><span class="ident" id="5681333">expect</span><span class="op" id="5681339">(</span><span class="ident" id="5681340">token</span><span class="op" id="5681345">.</span><span class="ident" id="5681346">RPAREN</span><span class="op" id="5681352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681356">p</span><span class="op" id="5681357">.</span><span class="ident" id="5681358">expectSemi</span><span class="op" id="5681368">(</span><span class="op" id="5681369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681372">}</span>&nbsp;<span class="keyword" id="5681374">else</span>&nbsp;<span class="op" id="5681379">{</span><br>
<span class="lineno">2300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681383">list</span>&nbsp;<span class="op" id="5681388">=</span>&nbsp;<span class="builtinfunc" id="5681390">append</span><span class="op" id="5681396">(</span><span class="ident" id="5681397">list</span><span class="op" id="5681401">,</span>&nbsp;<span class="ident" id="5681403">f</span><span class="op" id="5681404">(</span><span class="ident" id="5681405">nil</span><span class="op" id="5681408">,</span>&nbsp;<span class="ident" id="5681410">keyword</span><span class="op" id="5681417">,</span>&nbsp;<span class="num" id="5681419">0</span><span class="op" id="5681420">)</span><span class="op" id="5681421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681428">return</span>&nbsp;<span class="op" id="5681435">&amp;</span><span class="ident" id="5681436">ast</span><span class="op" id="5681439">.</span><span class="ident" id="5681440">GenDecl</span><span class="op" id="5681447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681451">Doc</span><span class="op" id="5681454">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681459">doc</span><span class="op" id="5681462">,</span><br>
<span class="lineno">2305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681466">TokPos</span><span class="op" id="5681472">:</span>&nbsp;<span class="ident" id="5681474">pos</span><span class="op" id="5681477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681481">Tok</span><span class="op" id="5681484">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5681489">keyword</span><span class="op" id="5681496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681500">Lparen</span><span class="op" id="5681506">:</span>&nbsp;<span class="ident" id="5681508">lparen</span><span class="op" id="5681514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681518">Specs</span><span class="op" id="5681523">:</span>&nbsp;&nbsp;<span class="ident" id="5681526">list</span><span class="op" id="5681530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681534">Rparen</span><span class="op" id="5681540">:</span>&nbsp;<span class="ident" id="5681542">rparen</span><span class="op" id="5681548">,</span><br>
<span class="lineno">2310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681551">}</span><br>
<span class="lineno"></span><span class="op" id="5681553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5681556">func</span>&nbsp;<span class="op" id="5681561">(</span><span class="ident" id="5681562">p</span>&nbsp;<span class="op" id="5681564">*</span><span class="ident" id="5681565">parser</span><span class="op" id="5681571">)</span>&nbsp;<span class="ident" id="5681573">parseFuncDecl</span><span class="op" id="5681586">(</span><span class="op" id="5681587">)</span>&nbsp;<span class="op" id="5681589">*</span><span class="ident" id="5681590">ast</span><span class="op" id="5681593">.</span><span class="ident" id="5681594">FuncDecl</span>&nbsp;<span class="op" id="5681603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681606">if</span>&nbsp;<span class="ident" id="5681609">p</span><span class="op" id="5681610">.</span><span class="ident" id="5681611">trace</span>&nbsp;<span class="op" id="5681617">{</span><br>
<span class="lineno">2315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681621">defer</span>&nbsp;<span class="ident" id="5681627">un</span><span class="op" id="5681629">(</span><span class="ident" id="5681630">trace</span><span class="op" id="5681635">(</span><span class="ident" id="5681636">p</span><span class="op" id="5681637">,</span>&nbsp;<span class="string" id="5681639">&#34;FunctionDecl&#34;</span><span class="op" id="5681653">)</span><span class="op" id="5681654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681661">doc</span>&nbsp;<span class="op" id="5681665">:=</span>&nbsp;<span class="ident" id="5681668">p</span><span class="op" id="5681669">.</span><span class="ident" id="5681670">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681683">pos</span>&nbsp;<span class="op" id="5681687">:=</span>&nbsp;<span class="ident" id="5681690">p</span><span class="op" id="5681691">.</span><span class="ident" id="5681692">expect</span><span class="op" id="5681698">(</span><span class="ident" id="5681699">token</span><span class="op" id="5681704">.</span><span class="ident" id="5681705">FUNC</span><span class="op" id="5681709">)</span><br>
<span class="lineno">2320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681712">scope</span>&nbsp;<span class="op" id="5681718">:=</span>&nbsp;<span class="ident" id="5681721">ast</span><span class="op" id="5681724">.</span><span class="ident" id="5681725">NewScope</span><span class="op" id="5681733">(</span><span class="ident" id="5681734">p</span><span class="op" id="5681735">.</span><span class="ident" id="5681736">topScope</span><span class="op" id="5681744">)</span>&nbsp;<span class="comment" id="5681746">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681766">var</span>&nbsp;<span class="ident" id="5681770">recv</span>&nbsp;<span class="op" id="5681775">*</span><span class="ident" id="5681776">ast</span><span class="op" id="5681779">.</span><span class="ident" id="5681780">FieldList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681791">if</span>&nbsp;<span class="ident" id="5681794">p</span><span class="op" id="5681795">.</span><span class="ident" id="5681796">tok</span>&nbsp;<span class="op" id="5681800">==</span>&nbsp;<span class="ident" id="5681803">token</span><span class="op" id="5681808">.</span><span class="ident" id="5681809">LPAREN</span>&nbsp;<span class="op" id="5681816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681820">recv</span>&nbsp;<span class="op" id="5681825">=</span>&nbsp;<span class="ident" id="5681827">p</span><span class="op" id="5681828">.</span><span class="ident" id="5681829">parseParameters</span><span class="op" id="5681844">(</span><span class="ident" id="5681845">scope</span><span class="op" id="5681850">,</span>&nbsp;<span class="builtintype" id="5681852">false</span><span class="op" id="5681857">)</span><br>
<span class="lineno">2325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681864">ident</span>&nbsp;<span class="op" id="5681870">:=</span>&nbsp;<span class="ident" id="5681873">p</span><span class="op" id="5681874">.</span><span class="ident" id="5681875">parseIdent</span><span class="op" id="5681885">(</span><span class="op" id="5681886">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681890">params</span><span class="op" id="5681896">,</span>&nbsp;<span class="ident" id="5681898">results</span>&nbsp;<span class="op" id="5681906">:=</span>&nbsp;<span class="ident" id="5681909">p</span><span class="op" id="5681910">.</span><span class="ident" id="5681911">parseSignature</span><span class="op" id="5681925">(</span><span class="ident" id="5681926">scope</span><span class="op" id="5681931">)</span><br>
<span class="lineno">2330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681935">var</span>&nbsp;<span class="ident" id="5681939">body</span>&nbsp;<span class="op" id="5681944">*</span><span class="ident" id="5681945">ast</span><span class="op" id="5681948">.</span><span class="ident" id="5681949">BlockStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681960">if</span>&nbsp;<span class="ident" id="5681963">p</span><span class="op" id="5681964">.</span><span class="ident" id="5681965">tok</span>&nbsp;<span class="op" id="5681969">==</span>&nbsp;<span class="ident" id="5681972">token</span><span class="op" id="5681977">.</span><span class="ident" id="5681978">LBRACE</span>&nbsp;<span class="op" id="5681985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681989">body</span>&nbsp;<span class="op" id="5681994">=</span>&nbsp;<span class="ident" id="5681996">p</span><span class="op" id="5681997">.</span><span class="ident" id="5681998">parseBody</span><span class="op" id="5682007">(</span><span class="ident" id="5682008">scope</span><span class="op" id="5682013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682016">}</span><br>
<span class="lineno">2335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682019">p</span><span class="op" id="5682020">.</span><span class="ident" id="5682021">expectSemi</span><span class="op" id="5682031">(</span><span class="op" id="5682032">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682036">decl</span>&nbsp;<span class="op" id="5682041">:=</span>&nbsp;<span class="op" id="5682044">&amp;</span><span class="ident" id="5682045">ast</span><span class="op" id="5682048">.</span><span class="ident" id="5682049">FuncDecl</span><span class="op" id="5682057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682061">Doc</span><span class="op" id="5682064">:</span>&nbsp;&nbsp;<span class="ident" id="5682067">doc</span><span class="op" id="5682070">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682074">Recv</span><span class="op" id="5682078">:</span>&nbsp;<span class="ident" id="5682080">recv</span><span class="op" id="5682084">,</span><br>
<span class="lineno">2340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682088">Name</span><span class="op" id="5682092">:</span>&nbsp;<span class="ident" id="5682094">ident</span><span class="op" id="5682099">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682103">Type</span><span class="op" id="5682107">:</span>&nbsp;<span class="op" id="5682109">&amp;</span><span class="ident" id="5682110">ast</span><span class="op" id="5682113">.</span><span class="ident" id="5682114">FuncType</span><span class="op" id="5682122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682127">Func</span><span class="op" id="5682131">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5682136">pos</span><span class="op" id="5682139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682144">Params</span><span class="op" id="5682150">:</span>&nbsp;&nbsp;<span class="ident" id="5682153">params</span><span class="op" id="5682159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682164">Results</span><span class="op" id="5682171">:</span>&nbsp;<span class="ident" id="5682173">results</span><span class="op" id="5682180">,</span><br>
<span class="lineno">2345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682184">}</span><span class="op" id="5682185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682189">Body</span><span class="op" id="5682193">:</span>&nbsp;<span class="ident" id="5682195">body</span><span class="op" id="5682199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682205">if</span>&nbsp;<span class="ident" id="5682208">recv</span>&nbsp;<span class="op" id="5682213">==</span>&nbsp;<span class="ident" id="5682216">nil</span>&nbsp;<span class="op" id="5682220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682224">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;constant,&nbsp;type,</span><br>
<span class="lineno">2350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682292">//&nbsp;variable,&nbsp;or&nbsp;function&nbsp;(but&nbsp;not&nbsp;method)&nbsp;declared&nbsp;at&nbsp;top&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682358">//&nbsp;(outside&nbsp;any&nbsp;function)&nbsp;is&nbsp;the&nbsp;package&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682408">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682413">//&nbsp;init()&nbsp;functions&nbsp;cannot&nbsp;be&nbsp;referred&nbsp;to&nbsp;and&nbsp;there&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682471">//&nbsp;be&nbsp;more&nbsp;than&nbsp;one&nbsp;-&nbsp;don&#39;t&nbsp;put&nbsp;them&nbsp;in&nbsp;the&nbsp;pkgScope</span><br>
<span class="lineno">2355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682526">if</span>&nbsp;<span class="ident" id="5682529">ident</span><span class="op" id="5682534">.</span><span class="ident" id="5682535">Name</span>&nbsp;<span class="op" id="5682540">!=</span>&nbsp;<span class="string" id="5682543">&#34;init&#34;</span>&nbsp;<span class="op" id="5682550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682555">p</span><span class="op" id="5682556">.</span><span class="ident" id="5682557">declare</span><span class="op" id="5682564">(</span><span class="ident" id="5682565">decl</span><span class="op" id="5682569">,</span>&nbsp;<span class="ident" id="5682571">nil</span><span class="op" id="5682574">,</span>&nbsp;<span class="ident" id="5682576">p</span><span class="op" id="5682577">.</span><span class="ident" id="5682578">pkgScope</span><span class="op" id="5682586">,</span>&nbsp;<span class="ident" id="5682588">ast</span><span class="op" id="5682591">.</span><span class="ident" id="5682592">Fun</span><span class="op" id="5682595">,</span>&nbsp;<span class="ident" id="5682597">ident</span><span class="op" id="5682602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682613">return</span>&nbsp;<span class="ident" id="5682620">decl</span><br>
<span class="lineno"></span><span class="op" id="5682625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5682628">func</span>&nbsp;<span class="op" id="5682633">(</span><span class="ident" id="5682634">p</span>&nbsp;<span class="op" id="5682636">*</span><span class="ident" id="5682637">parser</span><span class="op" id="5682643">)</span>&nbsp;<span class="ident" id="5682645">parseDecl</span><span class="op" id="5682654">(</span><span class="ident" id="5682655">sync</span>&nbsp;<span class="keyword" id="5682660">func</span><span class="op" id="5682664">(</span><span class="op" id="5682665">*</span><span class="ident" id="5682666">parser</span><span class="op" id="5682672">)</span><span class="op" id="5682673">)</span>&nbsp;<span class="ident" id="5682675">ast</span><span class="op" id="5682678">.</span><span class="ident" id="5682679">Decl</span>&nbsp;<span class="op" id="5682684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682687">if</span>&nbsp;<span class="ident" id="5682690">p</span><span class="op" id="5682691">.</span><span class="ident" id="5682692">trace</span>&nbsp;<span class="op" id="5682698">{</span><br>
<span class="lineno">2365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682702">defer</span>&nbsp;<span class="ident" id="5682708">un</span><span class="op" id="5682710">(</span><span class="ident" id="5682711">trace</span><span class="op" id="5682716">(</span><span class="ident" id="5682717">p</span><span class="op" id="5682718">,</span>&nbsp;<span class="string" id="5682720">&#34;Declaration&#34;</span><span class="op" id="5682733">)</span><span class="op" id="5682734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682741">var</span>&nbsp;<span class="ident" id="5682745">f</span>&nbsp;<span class="ident" id="5682747">parseSpecFunction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682766">switch</span>&nbsp;<span class="ident" id="5682773">p</span><span class="op" id="5682774">.</span><span class="ident" id="5682775">tok</span>&nbsp;<span class="op" id="5682779">{</span><br>
<span class="lineno">2370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682782">case</span>&nbsp;<span class="ident" id="5682787">token</span><span class="op" id="5682792">.</span><span class="ident" id="5682793">CONST</span><span class="op" id="5682798">,</span>&nbsp;<span class="ident" id="5682800">token</span><span class="op" id="5682805">.</span><span class="ident" id="5682806">VAR</span><span class="op" id="5682809">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682813">f</span>&nbsp;<span class="op" id="5682815">=</span>&nbsp;<span class="ident" id="5682817">p</span><span class="op" id="5682818">.</span><span class="ident" id="5682819">parseValueSpec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682836">case</span>&nbsp;<span class="ident" id="5682841">token</span><span class="op" id="5682846">.</span><span class="ident" id="5682847">TYPE</span><span class="op" id="5682851">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682855">f</span>&nbsp;<span class="op" id="5682857">=</span>&nbsp;<span class="ident" id="5682859">p</span><span class="op" id="5682860">.</span><span class="ident" id="5682861">parseTypeSpec</span><br>
<span class="lineno">2375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682877">case</span>&nbsp;<span class="ident" id="5682882">token</span><span class="op" id="5682887">.</span><span class="ident" id="5682888">FUNC</span><span class="op" id="5682892">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682896">return</span>&nbsp;<span class="ident" id="5682903">p</span><span class="op" id="5682904">.</span><span class="ident" id="5682905">parseFuncDecl</span><span class="op" id="5682918">(</span><span class="op" id="5682919">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682923">default</span><span class="op" id="5682930">:</span><br>
<span class="lineno">2380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682934">pos</span>&nbsp;<span class="op" id="5682938">:=</span>&nbsp;<span class="ident" id="5682941">p</span><span class="op" id="5682942">.</span><span class="ident" id="5682943">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682949">p</span><span class="op" id="5682950">.</span><span class="ident" id="5682951">errorExpected</span><span class="op" id="5682964">(</span><span class="ident" id="5682965">pos</span><span class="op" id="5682968">,</span>&nbsp;<span class="string" id="5682970">&#34;declaration&#34;</span><span class="op" id="5682983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682987">sync</span><span class="op" id="5682991">(</span><span class="ident" id="5682992">p</span><span class="op" id="5682993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682997">return</span>&nbsp;<span class="op" id="5683004">&amp;</span><span class="ident" id="5683005">ast</span><span class="op" id="5683008">.</span><span class="ident" id="5683009">BadDecl</span><span class="op" id="5683016">{</span><span class="ident" id="5683017">From</span><span class="op" id="5683021">:</span>&nbsp;<span class="ident" id="5683023">pos</span><span class="op" id="5683026">,</span>&nbsp;<span class="ident" id="5683028">To</span><span class="op" id="5683030">:</span>&nbsp;<span class="ident" id="5683032">p</span><span class="op" id="5683033">.</span><span class="ident" id="5683034">pos</span><span class="op" id="5683037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683040">}</span><br>
<span class="lineno">2385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683044">return</span>&nbsp;<span class="ident" id="5683051">p</span><span class="op" id="5683052">.</span><span class="ident" id="5683053">parseGenDecl</span><span class="op" id="5683065">(</span><span class="ident" id="5683066">p</span><span class="op" id="5683067">.</span><span class="ident" id="5683068">tok</span><span class="op" id="5683071">,</span>&nbsp;<span class="ident" id="5683073">f</span><span class="op" id="5683074">)</span><br>
<span class="lineno"></span><span class="op" id="5683076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5683079">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">2390</span><span class="comment" id="5683159">//&nbsp;Source&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5683176">func</span>&nbsp;<span class="op" id="5683181">(</span><span class="ident" id="5683182">p</span>&nbsp;<span class="op" id="5683184">*</span><span class="ident" id="5683185">parser</span><span class="op" id="5683191">)</span>&nbsp;<span class="ident" id="5683193">parseFile</span><span class="op" id="5683202">(</span><span class="op" id="5683203">)</span>&nbsp;<span class="op" id="5683205">*</span><span class="ident" id="5683206">ast</span><span class="op" id="5683209">.</span><span class="ident" id="5683210">File</span>&nbsp;<span class="op" id="5683215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683218">if</span>&nbsp;<span class="ident" id="5683221">p</span><span class="op" id="5683222">.</span><span class="ident" id="5683223">trace</span>&nbsp;<span class="op" id="5683229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683233">defer</span>&nbsp;<span class="ident" id="5683239">un</span><span class="op" id="5683241">(</span><span class="ident" id="5683242">trace</span><span class="op" id="5683247">(</span><span class="ident" id="5683248">p</span><span class="op" id="5683249">,</span>&nbsp;<span class="string" id="5683251">&#34;File&#34;</span><span class="op" id="5683257">)</span><span class="op" id="5683258">)</span><br>
<span class="lineno">2395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683265">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;scanning&nbsp;the&nbsp;first&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683342">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683382">if</span>&nbsp;<span class="ident" id="5683385">p</span><span class="op" id="5683386">.</span><span class="ident" id="5683387">errors</span><span class="op" id="5683393">.</span><span class="ident" id="5683394">Len</span><span class="op" id="5683397">(</span><span class="op" id="5683398">)</span>&nbsp;<span class="op" id="5683400">!=</span>&nbsp;<span class="num" id="5683403">0</span>&nbsp;<span class="op" id="5683405">{</span><br>
<span class="lineno">2400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683409">return</span>&nbsp;<span class="ident" id="5683416">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683425">//&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683444">doc</span>&nbsp;<span class="op" id="5683448">:=</span>&nbsp;<span class="ident" id="5683451">p</span><span class="op" id="5683452">.</span><span class="ident" id="5683453">leadComment</span><br>
<span class="lineno">2405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683466">pos</span>&nbsp;<span class="op" id="5683470">:=</span>&nbsp;<span class="ident" id="5683473">p</span><span class="op" id="5683474">.</span><span class="ident" id="5683475">expect</span><span class="op" id="5683481">(</span><span class="ident" id="5683482">token</span><span class="op" id="5683487">.</span><span class="ident" id="5683488">PACKAGE</span><span class="op" id="5683495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683498">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;package&nbsp;clause&nbsp;is&nbsp;not&nbsp;a&nbsp;declaration;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683552">//&nbsp;the&nbsp;package&nbsp;name&nbsp;does&nbsp;not&nbsp;appear&nbsp;in&nbsp;any&nbsp;scope.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683603">ident</span>&nbsp;<span class="op" id="5683609">:=</span>&nbsp;<span class="ident" id="5683612">p</span><span class="op" id="5683613">.</span><span class="ident" id="5683614">parseIdent</span><span class="op" id="5683624">(</span><span class="op" id="5683625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683628">if</span>&nbsp;<span class="ident" id="5683631">ident</span><span class="op" id="5683636">.</span><span class="ident" id="5683637">Name</span>&nbsp;<span class="op" id="5683642">==</span>&nbsp;<span class="string" id="5683645">&#34;_&#34;</span>&nbsp;<span class="op" id="5683649">&amp;&amp;</span>&nbsp;<span class="ident" id="5683652">p</span><span class="op" id="5683653">.</span><span class="ident" id="5683654">mode</span><span class="op" id="5683658">&amp;</span><span class="ident" id="5683659">DeclarationErrors</span>&nbsp;<span class="op" id="5683677">!=</span>&nbsp;<span class="num" id="5683680">0</span>&nbsp;<span class="op" id="5683682">{</span><br>
<span class="lineno">2410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683686">p</span><span class="op" id="5683687">.</span><span class="builtintype" id="5683688">error</span><span class="op" id="5683693">(</span><span class="ident" id="5683694">p</span><span class="op" id="5683695">.</span><span class="ident" id="5683696">pos</span><span class="op" id="5683699">,</span>&nbsp;<span class="string" id="5683701">&#34;invalid&nbsp;package&nbsp;name&nbsp;_&#34;</span><span class="op" id="5683725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683731">p</span><span class="op" id="5683732">.</span><span class="ident" id="5683733">expectSemi</span><span class="op" id="5683743">(</span><span class="op" id="5683744">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683748">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;parsing&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno">2415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683827">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683867">if</span>&nbsp;<span class="ident" id="5683870">p</span><span class="op" id="5683871">.</span><span class="ident" id="5683872">errors</span><span class="op" id="5683878">.</span><span class="ident" id="5683879">Len</span><span class="op" id="5683882">(</span><span class="op" id="5683883">)</span>&nbsp;<span class="op" id="5683885">!=</span>&nbsp;<span class="num" id="5683888">0</span>&nbsp;<span class="op" id="5683890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683894">return</span>&nbsp;<span class="ident" id="5683901">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683910">p</span><span class="op" id="5683911">.</span><span class="ident" id="5683912">openScope</span><span class="op" id="5683921">(</span><span class="op" id="5683922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683925">p</span><span class="op" id="5683926">.</span><span class="ident" id="5683927">pkgScope</span>&nbsp;<span class="op" id="5683936">=</span>&nbsp;<span class="ident" id="5683938">p</span><span class="op" id="5683939">.</span><span class="ident" id="5683940">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683950">var</span>&nbsp;<span class="ident" id="5683954">decls</span>&nbsp;<span class="op" id="5683960">[</span><span class="op" id="5683961">]</span><span class="ident" id="5683962">ast</span><span class="op" id="5683965">.</span><span class="ident" id="5683966">Decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683972">if</span>&nbsp;<span class="ident" id="5683975">p</span><span class="op" id="5683976">.</span><span class="ident" id="5683977">mode</span><span class="op" id="5683981">&amp;</span><span class="ident" id="5683982">PackageClauseOnly</span>&nbsp;<span class="op" id="5684000">==</span>&nbsp;<span class="num" id="5684003">0</span>&nbsp;<span class="op" id="5684005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684009">//&nbsp;import&nbsp;decls</span><br>
<span class="lineno">2425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684027">for</span>&nbsp;<span class="ident" id="5684031">p</span><span class="op" id="5684032">.</span><span class="ident" id="5684033">tok</span>&nbsp;<span class="op" id="5684037">==</span>&nbsp;<span class="ident" id="5684040">token</span><span class="op" id="5684045">.</span><span class="ident" id="5684046">IMPORT</span>&nbsp;<span class="op" id="5684053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684058">decls</span>&nbsp;<span class="op" id="5684064">=</span>&nbsp;<span class="builtinfunc" id="5684066">append</span><span class="op" id="5684072">(</span><span class="ident" id="5684073">decls</span><span class="op" id="5684078">,</span>&nbsp;<span class="ident" id="5684080">p</span><span class="op" id="5684081">.</span><span class="ident" id="5684082">parseGenDecl</span><span class="op" id="5684094">(</span><span class="ident" id="5684095">token</span><span class="op" id="5684100">.</span><span class="ident" id="5684101">IMPORT</span><span class="op" id="5684107">,</span>&nbsp;<span class="ident" id="5684109">p</span><span class="op" id="5684110">.</span><span class="ident" id="5684111">parseImportSpec</span><span class="op" id="5684126">)</span><span class="op" id="5684127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684136">if</span>&nbsp;<span class="ident" id="5684139">p</span><span class="op" id="5684140">.</span><span class="ident" id="5684141">mode</span><span class="op" id="5684145">&amp;</span><span class="ident" id="5684146">ImportsOnly</span>&nbsp;<span class="op" id="5684158">==</span>&nbsp;<span class="num" id="5684161">0</span>&nbsp;<span class="op" id="5684163">{</span><br>
<span class="lineno">2430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684168">//&nbsp;rest&nbsp;of&nbsp;package&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684195">for</span>&nbsp;<span class="ident" id="5684199">p</span><span class="op" id="5684200">.</span><span class="ident" id="5684201">tok</span>&nbsp;<span class="op" id="5684205">!=</span>&nbsp;<span class="ident" id="5684208">token</span><span class="op" id="5684213">.</span><span class="ident" id="5684214">EOF</span>&nbsp;<span class="op" id="5684218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684224">decls</span>&nbsp;<span class="op" id="5684230">=</span>&nbsp;<span class="builtinfunc" id="5684232">append</span><span class="op" id="5684238">(</span><span class="ident" id="5684239">decls</span><span class="op" id="5684244">,</span>&nbsp;<span class="ident" id="5684246">p</span><span class="op" id="5684247">.</span><span class="ident" id="5684248">parseDecl</span><span class="op" id="5684257">(</span><span class="ident" id="5684258">syncDecl</span><span class="op" id="5684266">)</span><span class="op" id="5684267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684276">}</span><br>
<span class="lineno">2435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684282">p</span><span class="op" id="5684283">.</span><span class="ident" id="5684284">closeScope</span><span class="op" id="5684294">(</span><span class="op" id="5684295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684298">assert</span><span class="op" id="5684304">(</span><span class="ident" id="5684305">p</span><span class="op" id="5684306">.</span><span class="ident" id="5684307">topScope</span>&nbsp;<span class="op" id="5684316">==</span>&nbsp;<span class="ident" id="5684319">nil</span><span class="op" id="5684322">,</span>&nbsp;<span class="string" id="5684324">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="5684343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684346">assert</span><span class="op" id="5684352">(</span><span class="ident" id="5684353">p</span><span class="op" id="5684354">.</span><span class="ident" id="5684355">labelScope</span>&nbsp;<span class="op" id="5684366">==</span>&nbsp;<span class="ident" id="5684369">nil</span><span class="op" id="5684372">,</span>&nbsp;<span class="string" id="5684374">&#34;unbalanced&nbsp;label&nbsp;scopes&#34;</span><span class="op" id="5684399">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684403">//&nbsp;resolve&nbsp;global&nbsp;identifiers&nbsp;within&nbsp;the&nbsp;same&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684455">i</span>&nbsp;<span class="op" id="5684457">:=</span>&nbsp;<span class="num" id="5684460">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684463">for</span>&nbsp;<span class="ident" id="5684467">_</span><span class="op" id="5684468">,</span>&nbsp;<span class="ident" id="5684470">ident</span>&nbsp;<span class="op" id="5684476">:=</span>&nbsp;<span class="keyword" id="5684479">range</span>&nbsp;<span class="ident" id="5684485">p</span><span class="op" id="5684486">.</span><span class="ident" id="5684487">unresolved</span>&nbsp;<span class="op" id="5684498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684502">//&nbsp;i&nbsp;&lt;=&nbsp;index&nbsp;for&nbsp;current&nbsp;ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684536">assert</span><span class="op" id="5684542">(</span><span class="ident" id="5684543">ident</span><span class="op" id="5684548">.</span><span class="ident" id="5684549">Obj</span>&nbsp;<span class="op" id="5684553">==</span>&nbsp;<span class="ident" id="5684556">unresolved</span><span class="op" id="5684566">,</span>&nbsp;<span class="string" id="5684568">&#34;object&nbsp;already&nbsp;resolved&#34;</span><span class="op" id="5684593">)</span><br>
<span class="lineno">2445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684597">ident</span><span class="op" id="5684602">.</span><span class="ident" id="5684603">Obj</span>&nbsp;<span class="op" id="5684607">=</span>&nbsp;<span class="ident" id="5684609">p</span><span class="op" id="5684610">.</span><span class="ident" id="5684611">pkgScope</span><span class="op" id="5684619">.</span><span class="ident" id="5684620">Lookup</span><span class="op" id="5684626">(</span><span class="ident" id="5684627">ident</span><span class="op" id="5684632">.</span><span class="ident" id="5684633">Name</span><span class="op" id="5684637">)</span>&nbsp;<span class="comment" id="5684639">//&nbsp;also&nbsp;removes&nbsp;unresolved&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684677">if</span>&nbsp;<span class="ident" id="5684680">ident</span><span class="op" id="5684685">.</span><span class="ident" id="5684686">Obj</span>&nbsp;<span class="op" id="5684690">==</span>&nbsp;<span class="ident" id="5684693">nil</span>&nbsp;<span class="op" id="5684697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684702">p</span><span class="op" id="5684703">.</span><span class="ident" id="5684704">unresolved</span><span class="op" id="5684714">[</span><span class="ident" id="5684715">i</span><span class="op" id="5684716">]</span>&nbsp;<span class="op" id="5684718">=</span>&nbsp;<span class="ident" id="5684720">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684729">i</span><span class="op" id="5684730">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684735">}</span><br>
<span class="lineno">2450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684742">return</span>&nbsp;<span class="op" id="5684749">&amp;</span><span class="ident" id="5684750">ast</span><span class="op" id="5684753">.</span><span class="ident" id="5684754">File</span><span class="op" id="5684758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684762">Doc</span><span class="op" id="5684765">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684774">doc</span><span class="op" id="5684777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684781">Package</span><span class="op" id="5684788">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684793">pos</span><span class="op" id="5684796">,</span><br>
<span class="lineno">2455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684800">Name</span><span class="op" id="5684804">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684812">ident</span><span class="op" id="5684817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684821">Decls</span><span class="op" id="5684826">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684833">decls</span><span class="op" id="5684838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684842">Scope</span><span class="op" id="5684847">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684854">p</span><span class="op" id="5684855">.</span><span class="ident" id="5684856">pkgScope</span><span class="op" id="5684864">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684868">Imports</span><span class="op" id="5684875">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5684880">p</span><span class="op" id="5684881">.</span><span class="ident" id="5684882">imports</span><span class="op" id="5684889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684893">Unresolved</span><span class="op" id="5684903">:</span>&nbsp;<span class="ident" id="5684905">p</span><span class="op" id="5684906">.</span><span class="ident" id="5684907">unresolved</span><span class="op" id="5684917">[</span><span class="num" id="5684918">0</span><span class="op" id="5684919">:</span><span class="ident" id="5684920">i</span><span class="op" id="5684921">]</span><span class="op" id="5684922">,</span><br>
<span class="lineno">2460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684926">Comments</span><span class="op" id="5684934">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5684938">p</span><span class="op" id="5684939">.</span><span class="ident" id="5684940">comments</span><span class="op" id="5684948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684951">}</span><br>
<span class="lineno"></span><span class="op" id="5684953">}</span>
</div>
</body>
</html>
