<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/template</h2>
<ul>
<li><a href="/gostd/text/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/text/template/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/template/examplefiles_test.go.html">examplefiles_test.go</a></li>
<li><a href="/gostd/text/template/examplefunc_test.go.html">examplefunc_test.go</a></li>
<li><a href="/gostd/text/template/exec.go.html">exec.go</a></li>
<li><a href="/gostd/text/template/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/text/template/funcs.go.html">funcs.go</a></li>
<li><a href="/gostd/text/template/helper.go.html">helper.go</a></li>
<li><a href="/gostd/text/template/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/text/template/template.go.html" class="current">template.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3296044">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3296099">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3296153">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3296204">package</span>&nbsp;<span class="ident" id="3296212">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3296222">import</span>&nbsp;<span class="op" id="3296229">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3296232">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3296239">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3296250">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="3296272">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3296275">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;information&nbsp;shared&nbsp;by&nbsp;related&nbsp;templates.</span><br>
<span class="lineno"></span><span class="keyword" id="3296336">type</span>&nbsp;<span class="ident" id="3296341">common</span>&nbsp;<span class="keyword" id="3296348">struct</span>&nbsp;<span class="op" id="3296355">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296358">tmpl</span>&nbsp;<span class="keyword" id="3296363">map</span><span class="op" id="3296366">[</span><span class="builtintype" id="3296367">string</span><span class="op" id="3296373">]</span><span class="op" id="3296374">*</span><span class="ident" id="3296375">Template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3296385">//&nbsp;We&nbsp;use&nbsp;two&nbsp;maps,&nbsp;one&nbsp;for&nbsp;parsing&nbsp;and&nbsp;one&nbsp;for&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3296445">//&nbsp;This&nbsp;separation&nbsp;makes&nbsp;the&nbsp;API&nbsp;cleaner&nbsp;since&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3296504">//&nbsp;expose&nbsp;reflection&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296541">parseFuncs</span>&nbsp;<span class="ident" id="3296552">FuncMap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296561">execFuncs</span>&nbsp;&nbsp;<span class="keyword" id="3296572">map</span><span class="op" id="3296575">[</span><span class="builtintype" id="3296576">string</span><span class="op" id="3296582">]</span><span class="ident" id="3296583">reflect</span><span class="op" id="3296590">.</span><span class="ident" id="3296591">Value</span><br>
<span class="lineno"></span><span class="op" id="3296597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3296600">//&nbsp;Template&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;parsed&nbsp;template.&nbsp;The&nbsp;*parse.Tree</span><br>
<span class="lineno"></span><span class="comment" id="3296672">//&nbsp;field&nbsp;is&nbsp;exported&nbsp;only&nbsp;for&nbsp;use&nbsp;by&nbsp;html/template&nbsp;and&nbsp;should&nbsp;be&nbsp;treated</span><br>
<span class="lineno">25</span><span class="comment" id="3296745">//&nbsp;as&nbsp;unexported&nbsp;by&nbsp;all&nbsp;other&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="3296784">type</span>&nbsp;<span class="ident" id="3296789">Template</span>&nbsp;<span class="keyword" id="3296798">struct</span>&nbsp;<span class="op" id="3296805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296808">name</span>&nbsp;<span class="builtintype" id="3296813">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3296821">*</span><span class="ident" id="3296822">parse</span><span class="op" id="3296827">.</span><span class="ident" id="3296828">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3296834">*</span><span class="ident" id="3296835">common</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296843">leftDelim</span>&nbsp;&nbsp;<span class="builtintype" id="3296854">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296862">rightDelim</span>&nbsp;<span class="builtintype" id="3296873">string</span><br>
<span class="lineno"></span><span class="op" id="3296880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3296883">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno">35</span><span class="keyword" id="3296936">func</span>&nbsp;<span class="ident" id="3296941">New</span><span class="op" id="3296944">(</span><span class="ident" id="3296945">name</span>&nbsp;<span class="builtintype" id="3296950">string</span><span class="op" id="3296956">)</span>&nbsp;<span class="op" id="3296958">*</span><span class="ident" id="3296959">Template</span>&nbsp;<span class="op" id="3296968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3296971">return</span>&nbsp;<span class="op" id="3296978">&amp;</span><span class="ident" id="3296979">Template</span><span class="op" id="3296987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3296991">name</span><span class="op" id="3296995">:</span>&nbsp;<span class="ident" id="3296997">name</span><span class="op" id="3297001">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3297004">}</span><br>
<span class="lineno"></span><span class="op" id="3297006">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3297009">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="3297051">func</span>&nbsp;<span class="op" id="3297056">(</span><span class="ident" id="3297057">t</span>&nbsp;<span class="op" id="3297059">*</span><span class="ident" id="3297060">Template</span><span class="op" id="3297068">)</span>&nbsp;<span class="ident" id="3297070">Name</span><span class="op" id="3297074">(</span><span class="op" id="3297075">)</span>&nbsp;<span class="builtintype" id="3297077">string</span>&nbsp;<span class="op" id="3297084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3297087">return</span>&nbsp;<span class="ident" id="3297094">t</span><span class="op" id="3297095">.</span><span class="ident" id="3297096">name</span><br>
<span class="lineno"></span><span class="op" id="3297101">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3297104">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;one&nbsp;and&nbsp;with&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3297184">//&nbsp;delimiters.&nbsp;The&nbsp;association,&nbsp;which&nbsp;is&nbsp;transitive,&nbsp;allows&nbsp;one&nbsp;template&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3297260">//&nbsp;invoke&nbsp;another&nbsp;with&nbsp;a&nbsp;{{template}}&nbsp;action.</span><br>
<span class="lineno"></span><span class="keyword" id="3297306">func</span>&nbsp;<span class="op" id="3297311">(</span><span class="ident" id="3297312">t</span>&nbsp;<span class="op" id="3297314">*</span><span class="ident" id="3297315">Template</span><span class="op" id="3297323">)</span>&nbsp;<span class="ident" id="3297325">New</span><span class="op" id="3297328">(</span><span class="ident" id="3297329">name</span>&nbsp;<span class="builtintype" id="3297334">string</span><span class="op" id="3297340">)</span>&nbsp;<span class="op" id="3297342">*</span><span class="ident" id="3297343">Template</span>&nbsp;<span class="op" id="3297352">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3297355">t</span><span class="op" id="3297356">.</span><span class="ident" id="3297357">init</span><span class="op" id="3297361">(</span><span class="op" id="3297362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3297365">return</span>&nbsp;<span class="op" id="3297372">&amp;</span><span class="ident" id="3297373">Template</span><span class="op" id="3297381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3297385">name</span><span class="op" id="3297389">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3297397">name</span><span class="op" id="3297401">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3297405">common</span><span class="op" id="3297411">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3297417">t</span><span class="op" id="3297418">.</span><span class="ident" id="3297419">common</span><span class="op" id="3297425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3297429">leftDelim</span><span class="op" id="3297438">:</span>&nbsp;&nbsp;<span class="ident" id="3297441">t</span><span class="op" id="3297442">.</span><span class="ident" id="3297443">leftDelim</span><span class="op" id="3297452">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3297456">rightDelim</span><span class="op" id="3297466">:</span>&nbsp;<span class="ident" id="3297468">t</span><span class="op" id="3297469">.</span><span class="ident" id="3297470">rightDelim</span><span class="op" id="3297480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3297483">}</span><br>
<span class="lineno"></span><span class="op" id="3297485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3297488">func</span>&nbsp;<span class="op" id="3297493">(</span><span class="ident" id="3297494">t</span>&nbsp;<span class="op" id="3297496">*</span><span class="ident" id="3297497">Template</span><span class="op" id="3297505">)</span>&nbsp;<span class="ident" id="3297507">init</span><span class="op" id="3297511">(</span><span class="op" id="3297512">)</span>&nbsp;<span class="op" id="3297514">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3297517">if</span>&nbsp;<span class="ident" id="3297520">t</span><span class="op" id="3297521">.</span><span class="ident" id="3297522">common</span>&nbsp;<span class="op" id="3297529">==</span>&nbsp;<span class="builtintype" id="3297532">nil</span>&nbsp;<span class="op" id="3297536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3297540">t</span><span class="op" id="3297541">.</span><span class="ident" id="3297542">common</span>&nbsp;<span class="op" id="3297549">=</span>&nbsp;<span class="builtinfunc" id="3297551">new</span><span class="op" id="3297554">(</span><span class="ident" id="3297555">common</span><span class="op" id="3297561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3297565">t</span><span class="op" id="3297566">.</span><span class="ident" id="3297567">tmpl</span>&nbsp;<span class="op" id="3297572">=</span>&nbsp;<span class="builtinfunc" id="3297574">make</span><span class="op" id="3297578">(</span><span class="keyword" id="3297579">map</span><span class="op" id="3297582">[</span><span class="builtintype" id="3297583">string</span><span class="op" id="3297589">]</span><span class="op" id="3297590">*</span><span class="ident" id="3297591">Template</span><span class="op" id="3297599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3297603">t</span><span class="op" id="3297604">.</span><span class="ident" id="3297605">parseFuncs</span>&nbsp;<span class="op" id="3297616">=</span>&nbsp;<span class="builtinfunc" id="3297618">make</span><span class="op" id="3297622">(</span><span class="ident" id="3297623">FuncMap</span><span class="op" id="3297630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3297634">t</span><span class="op" id="3297635">.</span><span class="ident" id="3297636">execFuncs</span>&nbsp;<span class="op" id="3297646">=</span>&nbsp;<span class="builtinfunc" id="3297648">make</span><span class="op" id="3297652">(</span><span class="keyword" id="3297653">map</span><span class="op" id="3297656">[</span><span class="builtintype" id="3297657">string</span><span class="op" id="3297663">]</span><span class="ident" id="3297664">reflect</span><span class="op" id="3297671">.</span><span class="ident" id="3297672">Value</span><span class="op" id="3297677">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3297680">}</span><br>
<span class="lineno"></span><span class="op" id="3297682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3297685">//&nbsp;Clone&nbsp;returns&nbsp;a&nbsp;duplicate&nbsp;of&nbsp;the&nbsp;template,&nbsp;including&nbsp;all&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3297756">//&nbsp;templates.&nbsp;The&nbsp;actual&nbsp;representation&nbsp;is&nbsp;not&nbsp;copied,&nbsp;but&nbsp;the&nbsp;name&nbsp;space&nbsp;of</span><br>
<span class="lineno">70</span><span class="comment" id="3297833">//&nbsp;associated&nbsp;templates&nbsp;is,&nbsp;so&nbsp;further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add</span><br>
<span class="lineno"></span><span class="comment" id="3297908">//&nbsp;templates&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&nbsp;Clone&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;prepare</span><br>
<span class="lineno"></span><span class="comment" id="3297987">//&nbsp;common&nbsp;templates&nbsp;and&nbsp;use&nbsp;them&nbsp;with&nbsp;variant&nbsp;definitions&nbsp;for&nbsp;other&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="3298065">//&nbsp;by&nbsp;adding&nbsp;the&nbsp;variants&nbsp;after&nbsp;the&nbsp;clone&nbsp;is&nbsp;made.</span><br>
<span class="lineno"></span><span class="keyword" id="3298116">func</span>&nbsp;<span class="op" id="3298121">(</span><span class="ident" id="3298122">t</span>&nbsp;<span class="op" id="3298124">*</span><span class="ident" id="3298125">Template</span><span class="op" id="3298133">)</span>&nbsp;<span class="ident" id="3298135">Clone</span><span class="op" id="3298140">(</span><span class="op" id="3298141">)</span>&nbsp;<span class="op" id="3298143">(</span><span class="op" id="3298144">*</span><span class="ident" id="3298145">Template</span><span class="op" id="3298153">,</span>&nbsp;<span class="builtintype" id="3298155">error</span><span class="op" id="3298160">)</span>&nbsp;<span class="op" id="3298162">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298165">nt</span>&nbsp;<span class="op" id="3298168">:=</span>&nbsp;<span class="ident" id="3298171">t</span><span class="op" id="3298172">.</span><span class="builtinfunc" id="3298173">copy</span><span class="op" id="3298177">(</span><span class="builtintype" id="3298178">nil</span><span class="op" id="3298181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298184">nt</span><span class="op" id="3298186">.</span><span class="ident" id="3298187">init</span><span class="op" id="3298191">(</span><span class="op" id="3298192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298195">nt</span><span class="op" id="3298197">.</span><span class="ident" id="3298198">tmpl</span><span class="op" id="3298202">[</span><span class="ident" id="3298203">t</span><span class="op" id="3298204">.</span><span class="ident" id="3298205">name</span><span class="op" id="3298209">]</span>&nbsp;<span class="op" id="3298211">=</span>&nbsp;<span class="ident" id="3298213">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298217">for</span>&nbsp;<span class="ident" id="3298221">k</span><span class="op" id="3298222">,</span>&nbsp;<span class="ident" id="3298224">v</span>&nbsp;<span class="op" id="3298226">:=</span>&nbsp;<span class="keyword" id="3298229">range</span>&nbsp;<span class="ident" id="3298235">t</span><span class="op" id="3298236">.</span><span class="ident" id="3298237">tmpl</span>&nbsp;<span class="op" id="3298242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298246">if</span>&nbsp;<span class="ident" id="3298249">k</span>&nbsp;<span class="op" id="3298251">==</span>&nbsp;<span class="ident" id="3298254">t</span><span class="op" id="3298255">.</span><span class="ident" id="3298256">name</span>&nbsp;<span class="op" id="3298261">{</span>&nbsp;<span class="comment" id="3298263">//&nbsp;Already&nbsp;installed.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298288">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3298299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3298303">//&nbsp;The&nbsp;associated&nbsp;templates&nbsp;share&nbsp;nt&#39;s&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298362">tmpl</span>&nbsp;<span class="op" id="3298367">:=</span>&nbsp;<span class="ident" id="3298370">v</span><span class="op" id="3298371">.</span><span class="builtinfunc" id="3298372">copy</span><span class="op" id="3298376">(</span><span class="ident" id="3298377">nt</span><span class="op" id="3298379">.</span><span class="ident" id="3298380">common</span><span class="op" id="3298386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298390">nt</span><span class="op" id="3298392">.</span><span class="ident" id="3298393">tmpl</span><span class="op" id="3298397">[</span><span class="ident" id="3298398">k</span><span class="op" id="3298399">]</span>&nbsp;<span class="op" id="3298401">=</span>&nbsp;<span class="ident" id="3298403">tmpl</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3298409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298412">for</span>&nbsp;<span class="ident" id="3298416">k</span><span class="op" id="3298417">,</span>&nbsp;<span class="ident" id="3298419">v</span>&nbsp;<span class="op" id="3298421">:=</span>&nbsp;<span class="keyword" id="3298424">range</span>&nbsp;<span class="ident" id="3298430">t</span><span class="op" id="3298431">.</span><span class="ident" id="3298432">parseFuncs</span>&nbsp;<span class="op" id="3298443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298447">nt</span><span class="op" id="3298449">.</span><span class="ident" id="3298450">parseFuncs</span><span class="op" id="3298460">[</span><span class="ident" id="3298461">k</span><span class="op" id="3298462">]</span>&nbsp;<span class="op" id="3298464">=</span>&nbsp;<span class="ident" id="3298466">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3298469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298472">for</span>&nbsp;<span class="ident" id="3298476">k</span><span class="op" id="3298477">,</span>&nbsp;<span class="ident" id="3298479">v</span>&nbsp;<span class="op" id="3298481">:=</span>&nbsp;<span class="keyword" id="3298484">range</span>&nbsp;<span class="ident" id="3298490">t</span><span class="op" id="3298491">.</span><span class="ident" id="3298492">execFuncs</span>&nbsp;<span class="op" id="3298502">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298506">nt</span><span class="op" id="3298508">.</span><span class="ident" id="3298509">execFuncs</span><span class="op" id="3298518">[</span><span class="ident" id="3298519">k</span><span class="op" id="3298520">]</span>&nbsp;<span class="op" id="3298522">=</span>&nbsp;<span class="ident" id="3298524">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3298527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298530">return</span>&nbsp;<span class="ident" id="3298537">nt</span><span class="op" id="3298539">,</span>&nbsp;<span class="builtintype" id="3298541">nil</span><br>
<span class="lineno"></span><span class="op" id="3298545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3298548">//&nbsp;copy&nbsp;returns&nbsp;a&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;t,&nbsp;with&nbsp;common&nbsp;set&nbsp;to&nbsp;the&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="3298618">func</span>&nbsp;<span class="op" id="3298623">(</span><span class="ident" id="3298624">t</span>&nbsp;<span class="op" id="3298626">*</span><span class="ident" id="3298627">Template</span><span class="op" id="3298635">)</span>&nbsp;<span class="builtinfunc" id="3298637">copy</span><span class="op" id="3298641">(</span><span class="ident" id="3298642">c</span>&nbsp;<span class="op" id="3298644">*</span><span class="ident" id="3298645">common</span><span class="op" id="3298651">)</span>&nbsp;<span class="op" id="3298653">*</span><span class="ident" id="3298654">Template</span>&nbsp;<span class="op" id="3298663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298666">nt</span>&nbsp;<span class="op" id="3298669">:=</span>&nbsp;<span class="ident" id="3298672">New</span><span class="op" id="3298675">(</span><span class="ident" id="3298676">t</span><span class="op" id="3298677">.</span><span class="ident" id="3298678">name</span><span class="op" id="3298682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298685">nt</span><span class="op" id="3298687">.</span><span class="ident" id="3298688">Tree</span>&nbsp;<span class="op" id="3298693">=</span>&nbsp;<span class="ident" id="3298695">t</span><span class="op" id="3298696">.</span><span class="ident" id="3298697">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298703">nt</span><span class="op" id="3298705">.</span><span class="ident" id="3298706">common</span>&nbsp;<span class="op" id="3298713">=</span>&nbsp;<span class="ident" id="3298715">c</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298718">nt</span><span class="op" id="3298720">.</span><span class="ident" id="3298721">leftDelim</span>&nbsp;<span class="op" id="3298731">=</span>&nbsp;<span class="ident" id="3298733">t</span><span class="op" id="3298734">.</span><span class="ident" id="3298735">leftDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3298746">nt</span><span class="op" id="3298748">.</span><span class="ident" id="3298749">rightDelim</span>&nbsp;<span class="op" id="3298760">=</span>&nbsp;<span class="ident" id="3298762">t</span><span class="op" id="3298763">.</span><span class="ident" id="3298764">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298776">return</span>&nbsp;<span class="ident" id="3298783">nt</span><br>
<span class="lineno"></span><span class="op" id="3298786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3298789">//&nbsp;AddParseTree&nbsp;creates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;name&nbsp;and&nbsp;parse&nbsp;tree</span><br>
<span class="lineno"></span><span class="comment" id="3298857">//&nbsp;and&nbsp;associates&nbsp;it&nbsp;with&nbsp;t.</span><br>
<span class="lineno"></span><span class="keyword" id="3298886">func</span>&nbsp;<span class="op" id="3298891">(</span><span class="ident" id="3298892">t</span>&nbsp;<span class="op" id="3298894">*</span><span class="ident" id="3298895">Template</span><span class="op" id="3298903">)</span>&nbsp;<span class="ident" id="3298905">AddParseTree</span><span class="op" id="3298917">(</span><span class="ident" id="3298918">name</span>&nbsp;<span class="builtintype" id="3298923">string</span><span class="op" id="3298929">,</span>&nbsp;<span class="ident" id="3298931">tree</span>&nbsp;<span class="op" id="3298936">*</span><span class="ident" id="3298937">parse</span><span class="op" id="3298942">.</span><span class="ident" id="3298943">Tree</span><span class="op" id="3298947">)</span>&nbsp;<span class="op" id="3298949">(</span><span class="op" id="3298950">*</span><span class="ident" id="3298951">Template</span><span class="op" id="3298959">,</span>&nbsp;<span class="builtintype" id="3298961">error</span><span class="op" id="3298966">)</span>&nbsp;<span class="op" id="3298968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3298971">if</span>&nbsp;<span class="ident" id="3298974">t</span><span class="op" id="3298975">.</span><span class="ident" id="3298976">common</span>&nbsp;<span class="op" id="3298983">!=</span>&nbsp;<span class="builtintype" id="3298986">nil</span>&nbsp;<span class="op" id="3298990">&amp;&amp;</span>&nbsp;<span class="ident" id="3298993">t</span><span class="op" id="3298994">.</span><span class="ident" id="3298995">tmpl</span><span class="op" id="3298999">[</span><span class="ident" id="3299000">name</span><span class="op" id="3299004">]</span>&nbsp;<span class="op" id="3299006">!=</span>&nbsp;<span class="builtintype" id="3299009">nil</span>&nbsp;<span class="op" id="3299013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299017">return</span>&nbsp;<span class="builtintype" id="3299024">nil</span><span class="op" id="3299027">,</span>&nbsp;<span class="ident" id="3299029">fmt</span><span class="op" id="3299032">.</span><span class="ident" id="3299033">Errorf</span><span class="op" id="3299039">(</span><span class="string" id="3299040">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="3299079">,</span>&nbsp;<span class="ident" id="3299081">name</span><span class="op" id="3299085">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299091">nt</span>&nbsp;<span class="op" id="3299094">:=</span>&nbsp;<span class="ident" id="3299097">t</span><span class="op" id="3299098">.</span><span class="ident" id="3299099">New</span><span class="op" id="3299102">(</span><span class="ident" id="3299103">name</span><span class="op" id="3299107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299110">nt</span><span class="op" id="3299112">.</span><span class="ident" id="3299113">Tree</span>&nbsp;<span class="op" id="3299118">=</span>&nbsp;<span class="ident" id="3299120">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299126">t</span><span class="op" id="3299127">.</span><span class="ident" id="3299128">tmpl</span><span class="op" id="3299132">[</span><span class="ident" id="3299133">name</span><span class="op" id="3299137">]</span>&nbsp;<span class="op" id="3299139">=</span>&nbsp;<span class="ident" id="3299141">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299145">return</span>&nbsp;<span class="ident" id="3299152">nt</span><span class="op" id="3299154">,</span>&nbsp;<span class="builtintype" id="3299156">nil</span><br>
<span class="lineno">115</span><span class="op" id="3299160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3299163">//&nbsp;Templates&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;templates&nbsp;associated&nbsp;with&nbsp;t,&nbsp;including&nbsp;t</span><br>
<span class="lineno"></span><span class="comment" id="3299240">//&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="3299251">func</span>&nbsp;<span class="op" id="3299256">(</span><span class="ident" id="3299257">t</span>&nbsp;<span class="op" id="3299259">*</span><span class="ident" id="3299260">Template</span><span class="op" id="3299268">)</span>&nbsp;<span class="ident" id="3299270">Templates</span><span class="op" id="3299279">(</span><span class="op" id="3299280">)</span>&nbsp;<span class="op" id="3299282">[</span><span class="op" id="3299283">]</span><span class="op" id="3299284">*</span><span class="ident" id="3299285">Template</span>&nbsp;<span class="op" id="3299294">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299297">if</span>&nbsp;<span class="ident" id="3299300">t</span><span class="op" id="3299301">.</span><span class="ident" id="3299302">common</span>&nbsp;<span class="op" id="3299309">==</span>&nbsp;<span class="builtintype" id="3299312">nil</span>&nbsp;<span class="op" id="3299316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299320">return</span>&nbsp;<span class="builtintype" id="3299327">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3299335">//&nbsp;Return&nbsp;a&nbsp;slice&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;expose&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299382">m</span>&nbsp;<span class="op" id="3299384">:=</span>&nbsp;<span class="builtinfunc" id="3299387">make</span><span class="op" id="3299391">(</span><span class="op" id="3299392">[</span><span class="op" id="3299393">]</span><span class="op" id="3299394">*</span><span class="ident" id="3299395">Template</span><span class="op" id="3299403">,</span>&nbsp;<span class="num" id="3299405">0</span><span class="op" id="3299406">,</span>&nbsp;<span class="builtinfunc" id="3299408">len</span><span class="op" id="3299411">(</span><span class="ident" id="3299412">t</span><span class="op" id="3299413">.</span><span class="ident" id="3299414">tmpl</span><span class="op" id="3299418">)</span><span class="op" id="3299419">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299422">for</span>&nbsp;<span class="ident" id="3299426">_</span><span class="op" id="3299427">,</span>&nbsp;<span class="ident" id="3299429">v</span>&nbsp;<span class="op" id="3299431">:=</span>&nbsp;<span class="keyword" id="3299434">range</span>&nbsp;<span class="ident" id="3299440">t</span><span class="op" id="3299441">.</span><span class="ident" id="3299442">tmpl</span>&nbsp;<span class="op" id="3299447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299451">m</span>&nbsp;<span class="op" id="3299453">=</span>&nbsp;<span class="builtinfunc" id="3299455">append</span><span class="op" id="3299461">(</span><span class="ident" id="3299462">m</span><span class="op" id="3299463">,</span>&nbsp;<span class="ident" id="3299465">v</span><span class="op" id="3299466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3299469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299472">return</span>&nbsp;<span class="ident" id="3299479">m</span><br>
<span class="lineno"></span><span class="op" id="3299481">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="3299484">//&nbsp;Delims&nbsp;sets&nbsp;the&nbsp;action&nbsp;delimiters&nbsp;to&nbsp;the&nbsp;specified&nbsp;strings,&nbsp;to&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3299561">//&nbsp;subsequent&nbsp;calls&nbsp;to&nbsp;Parse,&nbsp;ParseFiles,&nbsp;or&nbsp;ParseGlob.&nbsp;Nested&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="3299633">//&nbsp;definitions&nbsp;will&nbsp;inherit&nbsp;the&nbsp;settings.&nbsp;An&nbsp;empty&nbsp;delimiter&nbsp;stands&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3299709">//&nbsp;corresponding&nbsp;default:&nbsp;{{&nbsp;or&nbsp;}}.</span><br>
<span class="lineno">135</span><span class="comment" id="3299745">//&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="3299807">func</span>&nbsp;<span class="op" id="3299812">(</span><span class="ident" id="3299813">t</span>&nbsp;<span class="op" id="3299815">*</span><span class="ident" id="3299816">Template</span><span class="op" id="3299824">)</span>&nbsp;<span class="ident" id="3299826">Delims</span><span class="op" id="3299832">(</span><span class="ident" id="3299833">left</span><span class="op" id="3299837">,</span>&nbsp;<span class="ident" id="3299839">right</span>&nbsp;<span class="builtintype" id="3299845">string</span><span class="op" id="3299851">)</span>&nbsp;<span class="op" id="3299853">*</span><span class="ident" id="3299854">Template</span>&nbsp;<span class="op" id="3299863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299866">t</span><span class="op" id="3299867">.</span><span class="ident" id="3299868">leftDelim</span>&nbsp;<span class="op" id="3299878">=</span>&nbsp;<span class="ident" id="3299880">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3299886">t</span><span class="op" id="3299887">.</span><span class="ident" id="3299888">rightDelim</span>&nbsp;<span class="op" id="3299899">=</span>&nbsp;<span class="ident" id="3299901">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3299908">return</span>&nbsp;<span class="ident" id="3299915">t</span><br>
<span class="lineno">140</span><span class="op" id="3299917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3299920">//&nbsp;Funcs&nbsp;adds&nbsp;the&nbsp;elements&nbsp;of&nbsp;the&nbsp;argument&nbsp;map&nbsp;to&nbsp;the&nbsp;template&#39;s&nbsp;function&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="3299999">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;a&nbsp;value&nbsp;in&nbsp;the&nbsp;map&nbsp;is&nbsp;not&nbsp;a&nbsp;function&nbsp;with&nbsp;appropriate&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="3300076">//&nbsp;type.&nbsp;However,&nbsp;it&nbsp;is&nbsp;legal&nbsp;to&nbsp;overwrite&nbsp;elements&nbsp;of&nbsp;the&nbsp;map.&nbsp;The&nbsp;return</span><br>
<span class="lineno">145</span><span class="comment" id="3300151">//&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="3300202">func</span>&nbsp;<span class="op" id="3300207">(</span><span class="ident" id="3300208">t</span>&nbsp;<span class="op" id="3300210">*</span><span class="ident" id="3300211">Template</span><span class="op" id="3300219">)</span>&nbsp;<span class="ident" id="3300221">Funcs</span><span class="op" id="3300226">(</span><span class="ident" id="3300227">funcMap</span>&nbsp;<span class="ident" id="3300235">FuncMap</span><span class="op" id="3300242">)</span>&nbsp;<span class="op" id="3300244">*</span><span class="ident" id="3300245">Template</span>&nbsp;<span class="op" id="3300254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3300257">t</span><span class="op" id="3300258">.</span><span class="ident" id="3300259">init</span><span class="op" id="3300263">(</span><span class="op" id="3300264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3300267">addValueFuncs</span><span class="op" id="3300280">(</span><span class="ident" id="3300281">t</span><span class="op" id="3300282">.</span><span class="ident" id="3300283">execFuncs</span><span class="op" id="3300292">,</span>&nbsp;<span class="ident" id="3300294">funcMap</span><span class="op" id="3300301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3300304">addFuncs</span><span class="op" id="3300312">(</span><span class="ident" id="3300313">t</span><span class="op" id="3300314">.</span><span class="ident" id="3300315">parseFuncs</span><span class="op" id="3300325">,</span>&nbsp;<span class="ident" id="3300327">funcMap</span><span class="op" id="3300334">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300337">return</span>&nbsp;<span class="ident" id="3300344">t</span><br>
<span class="lineno"></span><span class="op" id="3300346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3300349">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name&nbsp;that&nbsp;is&nbsp;associated&nbsp;with&nbsp;t,</span><br>
<span class="lineno"></span><span class="comment" id="3300427">//&nbsp;or&nbsp;nil&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;such&nbsp;template.</span><br>
<span class="lineno">155</span><span class="keyword" id="3300467">func</span>&nbsp;<span class="op" id="3300472">(</span><span class="ident" id="3300473">t</span>&nbsp;<span class="op" id="3300475">*</span><span class="ident" id="3300476">Template</span><span class="op" id="3300484">)</span>&nbsp;<span class="ident" id="3300486">Lookup</span><span class="op" id="3300492">(</span><span class="ident" id="3300493">name</span>&nbsp;<span class="builtintype" id="3300498">string</span><span class="op" id="3300504">)</span>&nbsp;<span class="op" id="3300506">*</span><span class="ident" id="3300507">Template</span>&nbsp;<span class="op" id="3300516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300519">if</span>&nbsp;<span class="ident" id="3300522">t</span><span class="op" id="3300523">.</span><span class="ident" id="3300524">common</span>&nbsp;<span class="op" id="3300531">==</span>&nbsp;<span class="builtintype" id="3300534">nil</span>&nbsp;<span class="op" id="3300538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300542">return</span>&nbsp;<span class="builtintype" id="3300549">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3300554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3300557">return</span>&nbsp;<span class="ident" id="3300564">t</span><span class="op" id="3300565">.</span><span class="ident" id="3300566">tmpl</span><span class="op" id="3300570">[</span><span class="ident" id="3300571">name</span><span class="op" id="3300575">]</span><br>
<span class="lineno">160</span><span class="op" id="3300577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3300580">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;string&nbsp;into&nbsp;a&nbsp;template.&nbsp;Nested&nbsp;template&nbsp;definitions&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3300658">//&nbsp;associated&nbsp;with&nbsp;the&nbsp;top-level&nbsp;template&nbsp;t.&nbsp;Parse&nbsp;may&nbsp;be&nbsp;called&nbsp;multiple&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="3300738">//&nbsp;to&nbsp;parse&nbsp;definitions&nbsp;of&nbsp;templates&nbsp;to&nbsp;associate&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;if&nbsp;a</span><br>
<span class="lineno">165</span><span class="comment" id="3300816">//&nbsp;resulting&nbsp;template&nbsp;is&nbsp;non-empty&nbsp;(contains&nbsp;content&nbsp;other&nbsp;than&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="3300889">//&nbsp;definitions)&nbsp;and&nbsp;would&nbsp;replace&nbsp;a&nbsp;non-empty&nbsp;template&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="3300964">//&nbsp;(In&nbsp;multiple&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;with&nbsp;the&nbsp;same&nbsp;receiver&nbsp;template,&nbsp;only&nbsp;one&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3301042">//&nbsp;can&nbsp;contain&nbsp;text&nbsp;other&nbsp;than&nbsp;space,&nbsp;comments,&nbsp;and&nbsp;template&nbsp;definitions.)</span><br>
<span class="lineno"></span><span class="keyword" id="3301117">func</span>&nbsp;<span class="op" id="3301122">(</span><span class="ident" id="3301123">t</span>&nbsp;<span class="op" id="3301125">*</span><span class="ident" id="3301126">Template</span><span class="op" id="3301134">)</span>&nbsp;<span class="ident" id="3301136">Parse</span><span class="op" id="3301141">(</span><span class="ident" id="3301142">text</span>&nbsp;<span class="builtintype" id="3301147">string</span><span class="op" id="3301153">)</span>&nbsp;<span class="op" id="3301155">(</span><span class="op" id="3301156">*</span><span class="ident" id="3301157">Template</span><span class="op" id="3301165">,</span>&nbsp;<span class="builtintype" id="3301167">error</span><span class="op" id="3301172">)</span>&nbsp;<span class="op" id="3301174">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301177">t</span><span class="op" id="3301178">.</span><span class="ident" id="3301179">init</span><span class="op" id="3301183">(</span><span class="op" id="3301184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301187">trees</span><span class="op" id="3301192">,</span>&nbsp;<span class="ident" id="3301194">err</span>&nbsp;<span class="op" id="3301198">:=</span>&nbsp;<span class="ident" id="3301201">parse</span><span class="op" id="3301206">.</span><span class="ident" id="3301207">Parse</span><span class="op" id="3301212">(</span><span class="ident" id="3301213">t</span><span class="op" id="3301214">.</span><span class="ident" id="3301215">name</span><span class="op" id="3301219">,</span>&nbsp;<span class="ident" id="3301221">text</span><span class="op" id="3301225">,</span>&nbsp;<span class="ident" id="3301227">t</span><span class="op" id="3301228">.</span><span class="ident" id="3301229">leftDelim</span><span class="op" id="3301238">,</span>&nbsp;<span class="ident" id="3301240">t</span><span class="op" id="3301241">.</span><span class="ident" id="3301242">rightDelim</span><span class="op" id="3301252">,</span>&nbsp;<span class="ident" id="3301254">t</span><span class="op" id="3301255">.</span><span class="ident" id="3301256">parseFuncs</span><span class="op" id="3301266">,</span>&nbsp;<span class="ident" id="3301268">builtins</span><span class="op" id="3301276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301279">if</span>&nbsp;<span class="ident" id="3301282">err</span>&nbsp;<span class="op" id="3301286">!=</span>&nbsp;<span class="builtintype" id="3301289">nil</span>&nbsp;<span class="op" id="3301293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301297">return</span>&nbsp;<span class="builtintype" id="3301304">nil</span><span class="op" id="3301307">,</span>&nbsp;<span class="ident" id="3301309">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301314">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3301317">//&nbsp;Add&nbsp;the&nbsp;newly&nbsp;parsed&nbsp;trees,&nbsp;including&nbsp;the&nbsp;one&nbsp;for&nbsp;t,&nbsp;into&nbsp;our&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301401">for</span>&nbsp;<span class="ident" id="3301405">name</span><span class="op" id="3301409">,</span>&nbsp;<span class="ident" id="3301411">tree</span>&nbsp;<span class="op" id="3301416">:=</span>&nbsp;<span class="keyword" id="3301419">range</span>&nbsp;<span class="ident" id="3301425">trees</span>&nbsp;<span class="op" id="3301431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3301435">//&nbsp;If&nbsp;the&nbsp;name&nbsp;we&nbsp;parsed&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;template,&nbsp;overwrite&nbsp;this&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3301517">//&nbsp;The&nbsp;associate&nbsp;method&nbsp;checks&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;redefinition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301575">tmpl</span>&nbsp;<span class="op" id="3301580">:=</span>&nbsp;<span class="ident" id="3301583">t</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301587">if</span>&nbsp;<span class="ident" id="3301590">name</span>&nbsp;<span class="op" id="3301595">!=</span>&nbsp;<span class="ident" id="3301598">t</span><span class="op" id="3301599">.</span><span class="ident" id="3301600">name</span>&nbsp;<span class="op" id="3301605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301610">tmpl</span>&nbsp;<span class="op" id="3301615">=</span>&nbsp;<span class="ident" id="3301617">t</span><span class="op" id="3301618">.</span><span class="ident" id="3301619">New</span><span class="op" id="3301622">(</span><span class="ident" id="3301623">name</span><span class="op" id="3301627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3301635">//&nbsp;Even&nbsp;if&nbsp;t&nbsp;==&nbsp;tmpl,&nbsp;we&nbsp;need&nbsp;to&nbsp;install&nbsp;it&nbsp;in&nbsp;the&nbsp;common.tmpl&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301705">if</span>&nbsp;<span class="ident" id="3301708">replace</span><span class="op" id="3301715">,</span>&nbsp;<span class="ident" id="3301717">err</span>&nbsp;<span class="op" id="3301721">:=</span>&nbsp;<span class="ident" id="3301724">t</span><span class="op" id="3301725">.</span><span class="ident" id="3301726">associate</span><span class="op" id="3301735">(</span><span class="ident" id="3301736">tmpl</span><span class="op" id="3301740">,</span>&nbsp;<span class="ident" id="3301742">tree</span><span class="op" id="3301746">)</span><span class="op" id="3301747">;</span>&nbsp;<span class="ident" id="3301749">err</span>&nbsp;<span class="op" id="3301753">!=</span>&nbsp;<span class="builtintype" id="3301756">nil</span>&nbsp;<span class="op" id="3301760">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301765">return</span>&nbsp;<span class="builtintype" id="3301772">nil</span><span class="op" id="3301775">,</span>&nbsp;<span class="ident" id="3301777">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301783">}</span>&nbsp;<span class="keyword" id="3301785">else</span>&nbsp;<span class="keyword" id="3301790">if</span>&nbsp;<span class="ident" id="3301793">replace</span>&nbsp;<span class="op" id="3301801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301806">tmpl</span><span class="op" id="3301810">.</span><span class="ident" id="3301811">Tree</span>&nbsp;<span class="op" id="3301816">=</span>&nbsp;<span class="ident" id="3301818">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301829">tmpl</span><span class="op" id="3301833">.</span><span class="ident" id="3301834">leftDelim</span>&nbsp;<span class="op" id="3301844">=</span>&nbsp;<span class="ident" id="3301846">t</span><span class="op" id="3301847">.</span><span class="ident" id="3301848">leftDelim</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3301860">tmpl</span><span class="op" id="3301864">.</span><span class="ident" id="3301865">rightDelim</span>&nbsp;<span class="op" id="3301876">=</span>&nbsp;<span class="ident" id="3301878">t</span><span class="op" id="3301879">.</span><span class="ident" id="3301880">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3301892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3301895">return</span>&nbsp;<span class="ident" id="3301902">t</span><span class="op" id="3301903">,</span>&nbsp;<span class="builtintype" id="3301905">nil</span><br>
<span class="lineno"></span><span class="op" id="3301909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="3301912">//&nbsp;associate&nbsp;installs&nbsp;the&nbsp;new&nbsp;template&nbsp;into&nbsp;the&nbsp;group&nbsp;of&nbsp;templates&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3301990">//&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;reuse&nbsp;a&nbsp;name&nbsp;except&nbsp;to&nbsp;overwrite&nbsp;an&nbsp;empty</span><br>
<span class="lineno"></span><span class="comment" id="3302061">//&nbsp;template.&nbsp;The&nbsp;two&nbsp;are&nbsp;already&nbsp;known&nbsp;to&nbsp;share&nbsp;the&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3302131">//&nbsp;The&nbsp;boolean&nbsp;return&nbsp;value&nbsp;reports&nbsp;wither&nbsp;to&nbsp;store&nbsp;this&nbsp;tree&nbsp;as&nbsp;t.Tree.</span><br>
<span class="lineno"></span><span class="keyword" id="3302204">func</span>&nbsp;<span class="op" id="3302209">(</span><span class="ident" id="3302210">t</span>&nbsp;<span class="op" id="3302212">*</span><span class="ident" id="3302213">Template</span><span class="op" id="3302221">)</span>&nbsp;<span class="ident" id="3302223">associate</span><span class="op" id="3302232">(</span><span class="builtinfunc" id="3302233">new</span>&nbsp;<span class="op" id="3302237">*</span><span class="ident" id="3302238">Template</span><span class="op" id="3302246">,</span>&nbsp;<span class="ident" id="3302248">tree</span>&nbsp;<span class="op" id="3302253">*</span><span class="ident" id="3302254">parse</span><span class="op" id="3302259">.</span><span class="ident" id="3302260">Tree</span><span class="op" id="3302264">)</span>&nbsp;<span class="op" id="3302266">(</span><span class="builtintype" id="3302267">bool</span><span class="op" id="3302271">,</span>&nbsp;<span class="builtintype" id="3302273">error</span><span class="op" id="3302278">)</span>&nbsp;<span class="op" id="3302280">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302283">if</span>&nbsp;<span class="builtinfunc" id="3302286">new</span><span class="op" id="3302289">.</span><span class="ident" id="3302290">common</span>&nbsp;<span class="op" id="3302297">!=</span>&nbsp;<span class="ident" id="3302300">t</span><span class="op" id="3302301">.</span><span class="ident" id="3302302">common</span>&nbsp;<span class="op" id="3302309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3302313">panic</span><span class="op" id="3302318">(</span><span class="string" id="3302319">&#34;internal&nbsp;error:&nbsp;associate&nbsp;not&nbsp;common&#34;</span><span class="op" id="3302357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3302360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3302363">name</span>&nbsp;<span class="op" id="3302368">:=</span>&nbsp;<span class="builtinfunc" id="3302371">new</span><span class="op" id="3302374">.</span><span class="ident" id="3302375">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302381">if</span>&nbsp;<span class="ident" id="3302384">old</span>&nbsp;<span class="op" id="3302388">:=</span>&nbsp;<span class="ident" id="3302391">t</span><span class="op" id="3302392">.</span><span class="ident" id="3302393">tmpl</span><span class="op" id="3302397">[</span><span class="ident" id="3302398">name</span><span class="op" id="3302402">]</span><span class="op" id="3302403">;</span>&nbsp;<span class="ident" id="3302405">old</span>&nbsp;<span class="op" id="3302409">!=</span>&nbsp;<span class="builtintype" id="3302412">nil</span>&nbsp;<span class="op" id="3302416">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3302420">oldIsEmpty</span>&nbsp;<span class="op" id="3302431">:=</span>&nbsp;<span class="ident" id="3302434">parse</span><span class="op" id="3302439">.</span><span class="ident" id="3302440">IsEmptyTree</span><span class="op" id="3302451">(</span><span class="ident" id="3302452">old</span><span class="op" id="3302455">.</span><span class="ident" id="3302456">Root</span><span class="op" id="3302460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3302464">newIsEmpty</span>&nbsp;<span class="op" id="3302475">:=</span>&nbsp;<span class="ident" id="3302478">parse</span><span class="op" id="3302483">.</span><span class="ident" id="3302484">IsEmptyTree</span><span class="op" id="3302495">(</span><span class="ident" id="3302496">tree</span><span class="op" id="3302500">.</span><span class="ident" id="3302501">Root</span><span class="op" id="3302505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302509">if</span>&nbsp;<span class="ident" id="3302512">newIsEmpty</span>&nbsp;<span class="op" id="3302523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3302528">//&nbsp;Whether&nbsp;old&nbsp;is&nbsp;empty&nbsp;or&nbsp;not,&nbsp;new&nbsp;is&nbsp;empty;&nbsp;no&nbsp;reason&nbsp;to&nbsp;replace&nbsp;old.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302603">return</span>&nbsp;<span class="builtintype" id="3302610">false</span><span class="op" id="3302615">,</span>&nbsp;<span class="builtintype" id="3302617">nil</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3302623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302627">if</span>&nbsp;<span class="op" id="3302630">!</span><span class="ident" id="3302631">oldIsEmpty</span>&nbsp;<span class="op" id="3302642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302647">return</span>&nbsp;<span class="builtintype" id="3302654">false</span><span class="op" id="3302659">,</span>&nbsp;<span class="ident" id="3302661">fmt</span><span class="op" id="3302664">.</span><span class="ident" id="3302665">Errorf</span><span class="op" id="3302671">(</span><span class="string" id="3302672">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="3302711">,</span>&nbsp;<span class="ident" id="3302713">name</span><span class="op" id="3302717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3302721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3302724">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3302727">t</span><span class="op" id="3302728">.</span><span class="ident" id="3302729">tmpl</span><span class="op" id="3302733">[</span><span class="ident" id="3302734">name</span><span class="op" id="3302738">]</span>&nbsp;<span class="op" id="3302740">=</span>&nbsp;<span class="builtinfunc" id="3302742">new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3302747">return</span>&nbsp;<span class="builtintype" id="3302754">true</span><span class="op" id="3302758">,</span>&nbsp;<span class="builtintype" id="3302760">nil</span><br>
<span class="lineno"></span><span class="op" id="3302764">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
