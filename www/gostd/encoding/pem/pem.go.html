<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/pem</h2>
<ul>
<li><a href="/gostd/encoding/pem/pem.go.html" class="current">pem.go</a></li>
<li><a href="/gostd/encoding/pem/pem_test.go.html">pem_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3991757">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3991812">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3991866">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3991917">//&nbsp;Package&nbsp;pem&nbsp;implements&nbsp;the&nbsp;PEM&nbsp;data&nbsp;encoding,&nbsp;which&nbsp;originated&nbsp;in&nbsp;Privacy</span><br>
<span class="lineno"></span><span class="comment" id="3991994">//&nbsp;Enhanced&nbsp;Mail.&nbsp;The&nbsp;most&nbsp;common&nbsp;use&nbsp;of&nbsp;PEM&nbsp;encoding&nbsp;today&nbsp;is&nbsp;in&nbsp;TLS&nbsp;keys&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3992073">//&nbsp;certificates.&nbsp;See&nbsp;RFC&nbsp;1421.</span><br>
<span class="lineno"></span><span class="keyword" id="3992104">package</span>&nbsp;<span class="ident" id="3992112">pem</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3992117">import</span>&nbsp;<span class="op" id="3992124">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3992127">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3992136">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3992155">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3992161">&#34;sort&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3992168">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3992171">//&nbsp;A&nbsp;Block&nbsp;represents&nbsp;a&nbsp;PEM&nbsp;encoded&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3992218">//</span><br>
<span class="lineno"></span><span class="comment" id="3992221">//&nbsp;The&nbsp;encoded&nbsp;form&nbsp;is:</span><br>
<span class="lineno">20</span><span class="comment" id="3992245">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;Type-----</span><br>
<span class="lineno"></span><span class="comment" id="3992272">//&nbsp;&nbsp;&nbsp;&nbsp;Headers</span><br>
<span class="lineno"></span><span class="comment" id="3992286">//&nbsp;&nbsp;&nbsp;&nbsp;base64-encoded&nbsp;Bytes</span><br>
<span class="lineno"></span><span class="comment" id="3992313">//&nbsp;&nbsp;&nbsp;&nbsp;-----END&nbsp;Type-----</span><br>
<span class="lineno"></span><span class="comment" id="3992338">//&nbsp;where&nbsp;Headers&nbsp;is&nbsp;a&nbsp;possibly&nbsp;empty&nbsp;sequence&nbsp;of&nbsp;Key:&nbsp;Value&nbsp;lines.</span><br>
<span class="lineno">25</span><span class="keyword" id="3992405">type</span>&nbsp;<span class="ident" id="3992410">Block</span>&nbsp;<span class="keyword" id="3992416">struct</span>&nbsp;<span class="op" id="3992423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3992426">Type</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3992434">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3992452">//&nbsp;The&nbsp;type,&nbsp;taken&nbsp;from&nbsp;the&nbsp;preamble&nbsp;(i.e.&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3992516">Headers</span>&nbsp;<span class="keyword" id="3992524">map</span><span class="op" id="3992527">[</span><span class="builtintype" id="3992528">string</span><span class="op" id="3992534">]</span><span class="builtintype" id="3992535">string</span>&nbsp;<span class="comment" id="3992542">//&nbsp;Optional&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3992564">Bytes</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3992572">[</span><span class="op" id="3992573">]</span><span class="builtintype" id="3992574">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3992590">//&nbsp;The&nbsp;decoded&nbsp;bytes&nbsp;of&nbsp;the&nbsp;contents.&nbsp;Typically&nbsp;a&nbsp;DER&nbsp;encoded&nbsp;ASN.1&nbsp;structure.</span><br>
<span class="lineno"></span><span class="op" id="3992669">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="3992672">//&nbsp;getLine&nbsp;results&nbsp;the&nbsp;first&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;delineated&nbsp;line&nbsp;from&nbsp;the&nbsp;given&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="3992748">//&nbsp;array.&nbsp;The&nbsp;line&nbsp;does&nbsp;not&nbsp;include&nbsp;trailing&nbsp;whitespace&nbsp;or&nbsp;the&nbsp;trailing&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3992824">//&nbsp;line&nbsp;bytes.&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;byte&nbsp;array&nbsp;(also&nbsp;not&nbsp;including&nbsp;the&nbsp;new&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3992904">//&nbsp;bytes)&nbsp;is&nbsp;also&nbsp;returned&nbsp;and&nbsp;this&nbsp;will&nbsp;always&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;original</span><br>
<span class="lineno">35</span><span class="comment" id="3992981">//&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="3992994">func</span>&nbsp;<span class="ident" id="3992999">getLine</span><span class="op" id="3993006">(</span><span class="ident" id="3993007">data</span>&nbsp;<span class="op" id="3993012">[</span><span class="op" id="3993013">]</span><span class="builtintype" id="3993014">byte</span><span class="op" id="3993018">)</span>&nbsp;<span class="op" id="3993020">(</span><span class="ident" id="3993021">line</span><span class="op" id="3993025">,</span>&nbsp;<span class="ident" id="3993027">rest</span>&nbsp;<span class="op" id="3993032">[</span><span class="op" id="3993033">]</span><span class="builtintype" id="3993034">byte</span><span class="op" id="3993038">)</span>&nbsp;<span class="op" id="3993040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993043">i</span>&nbsp;<span class="op" id="3993045">:=</span>&nbsp;<span class="ident" id="3993048">bytes</span><span class="op" id="3993053">.</span><span class="ident" id="3993054">Index</span><span class="op" id="3993059">(</span><span class="ident" id="3993060">data</span><span class="op" id="3993064">,</span>&nbsp;<span class="op" id="3993066">[</span><span class="op" id="3993067">]</span><span class="builtintype" id="3993068">byte</span><span class="op" id="3993072">{</span><span class="string" id="3993073">&#39;\n&#39;</span><span class="op" id="3993077">}</span><span class="op" id="3993078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993081">var</span>&nbsp;<span class="ident" id="3993085">j</span>&nbsp;<span class="builtintype" id="3993087">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993092">if</span>&nbsp;<span class="ident" id="3993095">i</span>&nbsp;<span class="op" id="3993097">&lt;</span>&nbsp;<span class="num" id="3993099">0</span>&nbsp;<span class="op" id="3993101">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993105">i</span>&nbsp;<span class="op" id="3993107">=</span>&nbsp;<span class="builtinfunc" id="3993109">len</span><span class="op" id="3993112">(</span><span class="ident" id="3993113">data</span><span class="op" id="3993117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993121">j</span>&nbsp;<span class="op" id="3993123">=</span>&nbsp;<span class="ident" id="3993125">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3993128">}</span>&nbsp;<span class="keyword" id="3993130">else</span>&nbsp;<span class="op" id="3993135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993139">j</span>&nbsp;<span class="op" id="3993141">=</span>&nbsp;<span class="ident" id="3993143">i</span>&nbsp;<span class="op" id="3993145">+</span>&nbsp;<span class="num" id="3993147">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993151">if</span>&nbsp;<span class="ident" id="3993154">i</span>&nbsp;<span class="op" id="3993156">&gt;</span>&nbsp;<span class="num" id="3993158">0</span>&nbsp;<span class="op" id="3993160">&amp;&amp;</span>&nbsp;<span class="ident" id="3993163">data</span><span class="op" id="3993167">[</span><span class="ident" id="3993168">i</span><span class="op" id="3993169">-</span><span class="num" id="3993170">1</span><span class="op" id="3993171">]</span>&nbsp;<span class="op" id="3993173">==</span>&nbsp;<span class="string" id="3993176">&#39;\r&#39;</span>&nbsp;<span class="op" id="3993181">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993186">i</span><span class="op" id="3993187">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3993192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3993195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993198">return</span>&nbsp;<span class="ident" id="3993205">bytes</span><span class="op" id="3993210">.</span><span class="ident" id="3993211">TrimRight</span><span class="op" id="3993220">(</span><span class="ident" id="3993221">data</span><span class="op" id="3993225">[</span><span class="num" id="3993226">0</span><span class="op" id="3993227">:</span><span class="ident" id="3993228">i</span><span class="op" id="3993229">]</span><span class="op" id="3993230">,</span>&nbsp;<span class="string" id="3993232">&#34;&nbsp;\t&#34;</span><span class="op" id="3993237">)</span><span class="op" id="3993238">,</span>&nbsp;<span class="ident" id="3993240">data</span><span class="op" id="3993244">[</span><span class="ident" id="3993245">j</span><span class="op" id="3993246">:</span><span class="op" id="3993247">]</span><br>
<span class="lineno"></span><span class="op" id="3993249">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="3993252">//&nbsp;removeWhitespace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;its&nbsp;input&nbsp;with&nbsp;all&nbsp;spaces,&nbsp;tab&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3993325">//&nbsp;newline&nbsp;characters&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="3993356">func</span>&nbsp;<span class="ident" id="3993361">removeWhitespace</span><span class="op" id="3993377">(</span><span class="ident" id="3993378">data</span>&nbsp;<span class="op" id="3993383">[</span><span class="op" id="3993384">]</span><span class="builtintype" id="3993385">byte</span><span class="op" id="3993389">)</span>&nbsp;<span class="op" id="3993391">[</span><span class="op" id="3993392">]</span><span class="builtintype" id="3993393">byte</span>&nbsp;<span class="op" id="3993398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993401">result</span>&nbsp;<span class="op" id="3993408">:=</span>&nbsp;<span class="builtinfunc" id="3993411">make</span><span class="op" id="3993415">(</span><span class="op" id="3993416">[</span><span class="op" id="3993417">]</span><span class="builtintype" id="3993418">byte</span><span class="op" id="3993422">,</span>&nbsp;<span class="builtinfunc" id="3993424">len</span><span class="op" id="3993427">(</span><span class="ident" id="3993428">data</span><span class="op" id="3993432">)</span><span class="op" id="3993433">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993436">n</span>&nbsp;<span class="op" id="3993438">:=</span>&nbsp;<span class="num" id="3993441">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993445">for</span>&nbsp;<span class="ident" id="3993449">_</span><span class="op" id="3993450">,</span>&nbsp;<span class="ident" id="3993452">b</span>&nbsp;<span class="op" id="3993454">:=</span>&nbsp;<span class="keyword" id="3993457">range</span>&nbsp;<span class="ident" id="3993463">data</span>&nbsp;<span class="op" id="3993468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993472">if</span>&nbsp;<span class="ident" id="3993475">b</span>&nbsp;<span class="op" id="3993477">==</span>&nbsp;<span class="string" id="3993480">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3993484">||</span>&nbsp;<span class="ident" id="3993487">b</span>&nbsp;<span class="op" id="3993489">==</span>&nbsp;<span class="string" id="3993492">&#39;\t&#39;</span>&nbsp;<span class="op" id="3993497">||</span>&nbsp;<span class="ident" id="3993500">b</span>&nbsp;<span class="op" id="3993502">==</span>&nbsp;<span class="string" id="3993505">&#39;\r&#39;</span>&nbsp;<span class="op" id="3993510">||</span>&nbsp;<span class="ident" id="3993513">b</span>&nbsp;<span class="op" id="3993515">==</span>&nbsp;<span class="string" id="3993518">&#39;\n&#39;</span>&nbsp;<span class="op" id="3993523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993528">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3993539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993543">result</span><span class="op" id="3993549">[</span><span class="ident" id="3993550">n</span><span class="op" id="3993551">]</span>&nbsp;<span class="op" id="3993553">=</span>&nbsp;<span class="ident" id="3993555">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3993559">n</span><span class="op" id="3993560">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3993564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3993568">return</span>&nbsp;<span class="ident" id="3993575">result</span><span class="op" id="3993581">[</span><span class="num" id="3993582">0</span><span class="op" id="3993583">:</span><span class="ident" id="3993584">n</span><span class="op" id="3993585">]</span><br>
<span class="lineno"></span><span class="op" id="3993587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3993590">var</span>&nbsp;<span class="ident" id="3993594">pemStart</span>&nbsp;<span class="op" id="3993603">=</span>&nbsp;<span class="op" id="3993605">[</span><span class="op" id="3993606">]</span><span class="builtintype" id="3993607">byte</span><span class="op" id="3993611">(</span><span class="string" id="3993612">&#34;\n-----BEGIN&nbsp;&#34;</span><span class="op" id="3993627">)</span><br>
<span class="lineno"></span><span class="keyword" id="3993629">var</span>&nbsp;<span class="ident" id="3993633">pemEnd</span>&nbsp;<span class="op" id="3993640">=</span>&nbsp;<span class="op" id="3993642">[</span><span class="op" id="3993643">]</span><span class="builtintype" id="3993644">byte</span><span class="op" id="3993648">(</span><span class="string" id="3993649">&#34;\n-----END&nbsp;&#34;</span><span class="op" id="3993662">)</span><br>
<span class="lineno">70</span><span class="keyword" id="3993664">var</span>&nbsp;<span class="ident" id="3993668">pemEndOfLine</span>&nbsp;<span class="op" id="3993681">=</span>&nbsp;<span class="op" id="3993683">[</span><span class="op" id="3993684">]</span><span class="builtintype" id="3993685">byte</span><span class="op" id="3993689">(</span><span class="string" id="3993690">&#34;-----&#34;</span><span class="op" id="3993697">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3993700">//&nbsp;Decode&nbsp;will&nbsp;find&nbsp;the&nbsp;next&nbsp;PEM&nbsp;formatted&nbsp;block&nbsp;(certificate,&nbsp;private&nbsp;key</span><br>
<span class="lineno"></span><span class="comment" id="3993775">//&nbsp;etc)&nbsp;in&nbsp;the&nbsp;input.&nbsp;It&nbsp;returns&nbsp;that&nbsp;block&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;input.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3993854">//&nbsp;no&nbsp;PEM&nbsp;data&nbsp;is&nbsp;found,&nbsp;p&nbsp;is&nbsp;nil&nbsp;and&nbsp;the&nbsp;whole&nbsp;of&nbsp;the&nbsp;input&nbsp;is&nbsp;returned&nbsp;in</span><br>
<span class="lineno">75</span><span class="comment" id="3993930">//&nbsp;rest.</span><br>
<span class="lineno"></span><span class="keyword" id="3993939">func</span>&nbsp;<span class="ident" id="3993944">Decode</span><span class="op" id="3993950">(</span><span class="ident" id="3993951">data</span>&nbsp;<span class="op" id="3993956">[</span><span class="op" id="3993957">]</span><span class="builtintype" id="3993958">byte</span><span class="op" id="3993962">)</span>&nbsp;<span class="op" id="3993964">(</span><span class="ident" id="3993965">p</span>&nbsp;<span class="op" id="3993967">*</span><span class="ident" id="3993968">Block</span><span class="op" id="3993973">,</span>&nbsp;<span class="ident" id="3993975">rest</span>&nbsp;<span class="op" id="3993980">[</span><span class="op" id="3993981">]</span><span class="builtintype" id="3993982">byte</span><span class="op" id="3993986">)</span>&nbsp;<span class="op" id="3993988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3993991">//&nbsp;pemStart&nbsp;begins&nbsp;with&nbsp;a&nbsp;newline.&nbsp;However,&nbsp;at&nbsp;the&nbsp;very&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3994061">//&nbsp;the&nbsp;byte&nbsp;array,&nbsp;we&#39;ll&nbsp;accept&nbsp;the&nbsp;start&nbsp;string&nbsp;without&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3994123">rest</span>&nbsp;<span class="op" id="3994128">=</span>&nbsp;<span class="ident" id="3994130">data</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994136">if</span>&nbsp;<span class="ident" id="3994139">bytes</span><span class="op" id="3994144">.</span><span class="ident" id="3994145">HasPrefix</span><span class="op" id="3994154">(</span><span class="ident" id="3994155">data</span><span class="op" id="3994159">,</span>&nbsp;<span class="ident" id="3994161">pemStart</span><span class="op" id="3994169">[</span><span class="num" id="3994170">1</span><span class="op" id="3994171">:</span><span class="op" id="3994172">]</span><span class="op" id="3994173">)</span>&nbsp;<span class="op" id="3994175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3994179">rest</span>&nbsp;<span class="op" id="3994184">=</span>&nbsp;<span class="ident" id="3994186">rest</span><span class="op" id="3994190">[</span><span class="builtinfunc" id="3994191">len</span><span class="op" id="3994194">(</span><span class="ident" id="3994195">pemStart</span><span class="op" id="3994203">)</span><span class="op" id="3994204">-</span><span class="num" id="3994205">1</span>&nbsp;<span class="op" id="3994207">:</span>&nbsp;<span class="builtinfunc" id="3994209">len</span><span class="op" id="3994212">(</span><span class="ident" id="3994213">data</span><span class="op" id="3994217">)</span><span class="op" id="3994218">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3994221">}</span>&nbsp;<span class="keyword" id="3994223">else</span>&nbsp;<span class="keyword" id="3994228">if</span>&nbsp;<span class="ident" id="3994231">i</span>&nbsp;<span class="op" id="3994233">:=</span>&nbsp;<span class="ident" id="3994236">bytes</span><span class="op" id="3994241">.</span><span class="ident" id="3994242">Index</span><span class="op" id="3994247">(</span><span class="ident" id="3994248">data</span><span class="op" id="3994252">,</span>&nbsp;<span class="ident" id="3994254">pemStart</span><span class="op" id="3994262">)</span><span class="op" id="3994263">;</span>&nbsp;<span class="ident" id="3994265">i</span>&nbsp;<span class="op" id="3994267">&gt;=</span>&nbsp;<span class="num" id="3994270">0</span>&nbsp;<span class="op" id="3994272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3994276">rest</span>&nbsp;<span class="op" id="3994281">=</span>&nbsp;<span class="ident" id="3994283">rest</span><span class="op" id="3994287">[</span><span class="ident" id="3994288">i</span><span class="op" id="3994289">+</span><span class="builtinfunc" id="3994290">len</span><span class="op" id="3994293">(</span><span class="ident" id="3994294">pemStart</span><span class="op" id="3994302">)</span>&nbsp;<span class="op" id="3994304">:</span>&nbsp;<span class="builtinfunc" id="3994306">len</span><span class="op" id="3994309">(</span><span class="ident" id="3994310">data</span><span class="op" id="3994314">)</span><span class="op" id="3994315">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3994318">}</span>&nbsp;<span class="keyword" id="3994320">else</span>&nbsp;<span class="op" id="3994325">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994329">return</span>&nbsp;<span class="builtintype" id="3994336">nil</span><span class="op" id="3994339">,</span>&nbsp;<span class="ident" id="3994341">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3994347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3994351">typeLine</span><span class="op" id="3994359">,</span>&nbsp;<span class="ident" id="3994361">rest</span>&nbsp;<span class="op" id="3994366">:=</span>&nbsp;<span class="ident" id="3994369">getLine</span><span class="op" id="3994376">(</span><span class="ident" id="3994377">rest</span><span class="op" id="3994381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994384">if</span>&nbsp;<span class="op" id="3994387">!</span><span class="ident" id="3994388">bytes</span><span class="op" id="3994393">.</span><span class="ident" id="3994394">HasSuffix</span><span class="op" id="3994403">(</span><span class="ident" id="3994404">typeLine</span><span class="op" id="3994412">,</span>&nbsp;<span class="ident" id="3994414">pemEndOfLine</span><span class="op" id="3994426">)</span>&nbsp;<span class="op" id="3994428">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994432">return</span>&nbsp;<span class="ident" id="3994439">decodeError</span><span class="op" id="3994450">(</span><span class="ident" id="3994451">data</span><span class="op" id="3994455">,</span>&nbsp;<span class="ident" id="3994457">rest</span><span class="op" id="3994461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3994464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3994467">typeLine</span>&nbsp;<span class="op" id="3994476">=</span>&nbsp;<span class="ident" id="3994478">typeLine</span><span class="op" id="3994486">[</span><span class="num" id="3994487">0</span>&nbsp;<span class="op" id="3994489">:</span>&nbsp;<span class="builtinfunc" id="3994491">len</span><span class="op" id="3994494">(</span><span class="ident" id="3994495">typeLine</span><span class="op" id="3994503">)</span><span class="op" id="3994504">-</span><span class="builtinfunc" id="3994505">len</span><span class="op" id="3994508">(</span><span class="ident" id="3994509">pemEndOfLine</span><span class="op" id="3994521">)</span><span class="op" id="3994522">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3994526">p</span>&nbsp;<span class="op" id="3994528">=</span>&nbsp;<span class="op" id="3994530">&amp;</span><span class="ident" id="3994531">Block</span><span class="op" id="3994536">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3994540">Headers</span><span class="op" id="3994547">:</span>&nbsp;<span class="builtinfunc" id="3994549">make</span><span class="op" id="3994553">(</span><span class="keyword" id="3994554">map</span><span class="op" id="3994557">[</span><span class="builtintype" id="3994558">string</span><span class="op" id="3994564">]</span><span class="builtintype" id="3994565">string</span><span class="op" id="3994571">)</span><span class="op" id="3994572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3994576">Type</span><span class="op" id="3994580">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3994585">string</span><span class="op" id="3994591">(</span><span class="ident" id="3994592">typeLine</span><span class="op" id="3994600">)</span><span class="op" id="3994601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3994604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994608">for</span>&nbsp;<span class="op" id="3994612">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3994616">//&nbsp;This&nbsp;loop&nbsp;terminates&nbsp;because&nbsp;getLine&#39;s&nbsp;second&nbsp;result&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3994677">//&nbsp;always&nbsp;smaller&nbsp;than&nbsp;its&nbsp;argument.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994716">if</span>&nbsp;<span class="builtinfunc" id="3994719">len</span><span class="op" id="3994722">(</span><span class="ident" id="3994723">rest</span><span class="op" id="3994727">)</span>&nbsp;<span class="op" id="3994729">==</span>&nbsp;<span class="num" id="3994732">0</span>&nbsp;<span class="op" id="3994734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994739">return</span>&nbsp;<span class="builtintype" id="3994746">nil</span><span class="op" id="3994749">,</span>&nbsp;<span class="ident" id="3994751">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3994758">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3994762">line</span><span class="op" id="3994766">,</span>&nbsp;<span class="ident" id="3994768">next</span>&nbsp;<span class="op" id="3994773">:=</span>&nbsp;<span class="ident" id="3994776">getLine</span><span class="op" id="3994783">(</span><span class="ident" id="3994784">rest</span><span class="op" id="3994788">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3994793">i</span>&nbsp;<span class="op" id="3994795">:=</span>&nbsp;<span class="ident" id="3994798">bytes</span><span class="op" id="3994803">.</span><span class="ident" id="3994804">Index</span><span class="op" id="3994809">(</span><span class="ident" id="3994810">line</span><span class="op" id="3994814">,</span>&nbsp;<span class="op" id="3994816">[</span><span class="op" id="3994817">]</span><span class="builtintype" id="3994818">byte</span><span class="op" id="3994822">{</span><span class="string" id="3994823">&#39;:&#39;</span><span class="op" id="3994826">}</span><span class="op" id="3994827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994831">if</span>&nbsp;<span class="ident" id="3994834">i</span>&nbsp;<span class="op" id="3994836">==</span>&nbsp;<span class="op" id="3994839">-</span><span class="num" id="3994840">1</span>&nbsp;<span class="op" id="3994842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3994847">break</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3994855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3994860">//&nbsp;TODO(agl):&nbsp;need&nbsp;to&nbsp;cope&nbsp;with&nbsp;values&nbsp;that&nbsp;spread&nbsp;across&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3994927">key</span><span class="op" id="3994930">,</span>&nbsp;<span class="ident" id="3994932">val</span>&nbsp;<span class="op" id="3994936">:=</span>&nbsp;<span class="ident" id="3994939">line</span><span class="op" id="3994943">[</span><span class="num" id="3994944">0</span><span class="op" id="3994945">:</span><span class="ident" id="3994946">i</span><span class="op" id="3994947">]</span><span class="op" id="3994948">,</span>&nbsp;<span class="ident" id="3994950">line</span><span class="op" id="3994954">[</span><span class="ident" id="3994955">i</span><span class="op" id="3994956">+</span><span class="num" id="3994957">1</span><span class="op" id="3994958">:</span><span class="op" id="3994959">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3994963">key</span>&nbsp;<span class="op" id="3994967">=</span>&nbsp;<span class="ident" id="3994969">bytes</span><span class="op" id="3994974">.</span><span class="ident" id="3994975">TrimSpace</span><span class="op" id="3994984">(</span><span class="ident" id="3994985">key</span><span class="op" id="3994988">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3994992">val</span>&nbsp;<span class="op" id="3994996">=</span>&nbsp;<span class="ident" id="3994998">bytes</span><span class="op" id="3995003">.</span><span class="ident" id="3995004">TrimSpace</span><span class="op" id="3995013">(</span><span class="ident" id="3995014">val</span><span class="op" id="3995017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995021">p</span><span class="op" id="3995022">.</span><span class="ident" id="3995023">Headers</span><span class="op" id="3995030">[</span><span class="builtintype" id="3995031">string</span><span class="op" id="3995037">(</span><span class="ident" id="3995038">key</span><span class="op" id="3995041">)</span><span class="op" id="3995042">]</span>&nbsp;<span class="op" id="3995044">=</span>&nbsp;<span class="builtintype" id="3995046">string</span><span class="op" id="3995052">(</span><span class="ident" id="3995053">val</span><span class="op" id="3995056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995060">rest</span>&nbsp;<span class="op" id="3995065">=</span>&nbsp;<span class="ident" id="3995067">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3995073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995077">i</span>&nbsp;<span class="op" id="3995079">:=</span>&nbsp;<span class="ident" id="3995082">bytes</span><span class="op" id="3995087">.</span><span class="ident" id="3995088">Index</span><span class="op" id="3995093">(</span><span class="ident" id="3995094">rest</span><span class="op" id="3995098">,</span>&nbsp;<span class="ident" id="3995100">pemEnd</span><span class="op" id="3995106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3995109">if</span>&nbsp;<span class="ident" id="3995112">i</span>&nbsp;<span class="op" id="3995114">&lt;</span>&nbsp;<span class="num" id="3995116">0</span>&nbsp;<span class="op" id="3995118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3995122">return</span>&nbsp;<span class="ident" id="3995129">decodeError</span><span class="op" id="3995140">(</span><span class="ident" id="3995141">data</span><span class="op" id="3995145">,</span>&nbsp;<span class="ident" id="3995147">rest</span><span class="op" id="3995151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3995154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995157">base64Data</span>&nbsp;<span class="op" id="3995168">:=</span>&nbsp;<span class="ident" id="3995171">removeWhitespace</span><span class="op" id="3995187">(</span><span class="ident" id="3995188">rest</span><span class="op" id="3995192">[</span><span class="num" id="3995193">0</span><span class="op" id="3995194">:</span><span class="ident" id="3995195">i</span><span class="op" id="3995196">]</span><span class="op" id="3995197">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995201">p</span><span class="op" id="3995202">.</span><span class="ident" id="3995203">Bytes</span>&nbsp;<span class="op" id="3995209">=</span>&nbsp;<span class="builtinfunc" id="3995211">make</span><span class="op" id="3995215">(</span><span class="op" id="3995216">[</span><span class="op" id="3995217">]</span><span class="builtintype" id="3995218">byte</span><span class="op" id="3995222">,</span>&nbsp;<span class="ident" id="3995224">base64</span><span class="op" id="3995230">.</span><span class="ident" id="3995231">StdEncoding</span><span class="op" id="3995242">.</span><span class="ident" id="3995243">DecodedLen</span><span class="op" id="3995253">(</span><span class="builtinfunc" id="3995254">len</span><span class="op" id="3995257">(</span><span class="ident" id="3995258">base64Data</span><span class="op" id="3995268">)</span><span class="op" id="3995269">)</span><span class="op" id="3995270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995273">n</span><span class="op" id="3995274">,</span>&nbsp;<span class="ident" id="3995276">err</span>&nbsp;<span class="op" id="3995280">:=</span>&nbsp;<span class="ident" id="3995283">base64</span><span class="op" id="3995289">.</span><span class="ident" id="3995290">StdEncoding</span><span class="op" id="3995301">.</span><span class="ident" id="3995302">Decode</span><span class="op" id="3995308">(</span><span class="ident" id="3995309">p</span><span class="op" id="3995310">.</span><span class="ident" id="3995311">Bytes</span><span class="op" id="3995316">,</span>&nbsp;<span class="ident" id="3995318">base64Data</span><span class="op" id="3995328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3995331">if</span>&nbsp;<span class="ident" id="3995334">err</span>&nbsp;<span class="op" id="3995338">!=</span>&nbsp;<span class="builtintype" id="3995341">nil</span>&nbsp;<span class="op" id="3995345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3995349">return</span>&nbsp;<span class="ident" id="3995356">decodeError</span><span class="op" id="3995367">(</span><span class="ident" id="3995368">data</span><span class="op" id="3995372">,</span>&nbsp;<span class="ident" id="3995374">rest</span><span class="op" id="3995378">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3995381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995384">p</span><span class="op" id="3995385">.</span><span class="ident" id="3995386">Bytes</span>&nbsp;<span class="op" id="3995392">=</span>&nbsp;<span class="ident" id="3995394">p</span><span class="op" id="3995395">.</span><span class="ident" id="3995396">Bytes</span><span class="op" id="3995401">[</span><span class="num" id="3995402">0</span><span class="op" id="3995403">:</span><span class="ident" id="3995404">n</span><span class="op" id="3995405">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3995409">_</span><span class="op" id="3995410">,</span>&nbsp;<span class="ident" id="3995412">rest</span>&nbsp;<span class="op" id="3995417">=</span>&nbsp;<span class="ident" id="3995419">getLine</span><span class="op" id="3995426">(</span><span class="ident" id="3995427">rest</span><span class="op" id="3995431">[</span><span class="ident" id="3995432">i</span><span class="op" id="3995433">+</span><span class="builtinfunc" id="3995434">len</span><span class="op" id="3995437">(</span><span class="ident" id="3995438">pemEnd</span><span class="op" id="3995444">)</span><span class="op" id="3995445">:</span><span class="op" id="3995446">]</span><span class="op" id="3995447">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3995451">return</span><br>
<span class="lineno"></span><span class="op" id="3995458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3995461">func</span>&nbsp;<span class="ident" id="3995466">decodeError</span><span class="op" id="3995477">(</span><span class="ident" id="3995478">data</span><span class="op" id="3995482">,</span>&nbsp;<span class="ident" id="3995484">rest</span>&nbsp;<span class="op" id="3995489">[</span><span class="op" id="3995490">]</span><span class="builtintype" id="3995491">byte</span><span class="op" id="3995495">)</span>&nbsp;<span class="op" id="3995497">(</span><span class="op" id="3995498">*</span><span class="ident" id="3995499">Block</span><span class="op" id="3995504">,</span>&nbsp;<span class="op" id="3995506">[</span><span class="op" id="3995507">]</span><span class="builtintype" id="3995508">byte</span><span class="op" id="3995512">)</span>&nbsp;<span class="op" id="3995514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3995517">//&nbsp;If&nbsp;we&nbsp;get&nbsp;here&nbsp;then&nbsp;we&nbsp;have&nbsp;rejected&nbsp;a&nbsp;likely&nbsp;looking,&nbsp;but</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3995580">//&nbsp;ultimately&nbsp;invalid&nbsp;PEM&nbsp;block.&nbsp;We&nbsp;need&nbsp;to&nbsp;start&nbsp;over&nbsp;from&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3995647">//&nbsp;position.&nbsp;&nbsp;We&nbsp;have&nbsp;consumed&nbsp;the&nbsp;preamble&nbsp;line&nbsp;and&nbsp;will&nbsp;have&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3995720">//&nbsp;any&nbsp;lines&nbsp;which&nbsp;could&nbsp;be&nbsp;header&nbsp;lines.&nbsp;However,&nbsp;a&nbsp;valid&nbsp;preamble</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3995789">//&nbsp;line&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;header&nbsp;line,&nbsp;therefore&nbsp;we&nbsp;cannot&nbsp;have&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3995860">//&nbsp;the&nbsp;preamble&nbsp;line&nbsp;for&nbsp;the&nbsp;any&nbsp;subsequent&nbsp;block.&nbsp;Thus,&nbsp;we&nbsp;will&nbsp;always</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3995933">//&nbsp;find&nbsp;any&nbsp;valid&nbsp;block,&nbsp;no&nbsp;matter&nbsp;what&nbsp;bytes&nbsp;precede&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3995992">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3995996">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;the&nbsp;input&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996029">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996033">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;MALFORMED&nbsp;BLOCK-----</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996072">//&nbsp;&nbsp;&nbsp;&nbsp;junk&nbsp;that&nbsp;may&nbsp;look&nbsp;like&nbsp;header&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996116">//&nbsp;&nbsp;&nbsp;or&nbsp;data&nbsp;lines,&nbsp;but&nbsp;no&nbsp;END&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996153">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996157">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;ACTUAL&nbsp;BLOCK-----</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996193">//&nbsp;&nbsp;&nbsp;&nbsp;realdata</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996209">//&nbsp;&nbsp;&nbsp;&nbsp;-----END&nbsp;ACTUAL&nbsp;BLOCK-----</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996243">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996247">//&nbsp;we&#39;ve&nbsp;failed&nbsp;to&nbsp;parse&nbsp;using&nbsp;the&nbsp;first&nbsp;BEGIN&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996300">//&nbsp;and&nbsp;now&nbsp;will&nbsp;try&nbsp;again,&nbsp;using&nbsp;the&nbsp;second&nbsp;BEGIN&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996357">p</span><span class="op" id="3996358">,</span>&nbsp;<span class="ident" id="3996360">rest</span>&nbsp;<span class="op" id="3996365">:=</span>&nbsp;<span class="ident" id="3996368">Decode</span><span class="op" id="3996374">(</span><span class="ident" id="3996375">rest</span><span class="op" id="3996379">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3996382">if</span>&nbsp;<span class="ident" id="3996385">p</span>&nbsp;<span class="op" id="3996387">==</span>&nbsp;<span class="builtintype" id="3996390">nil</span>&nbsp;<span class="op" id="3996394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996398">rest</span>&nbsp;<span class="op" id="3996403">=</span>&nbsp;<span class="ident" id="3996405">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3996411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3996414">return</span>&nbsp;<span class="ident" id="3996421">p</span><span class="op" id="3996422">,</span>&nbsp;<span class="ident" id="3996424">rest</span><br>
<span class="lineno"></span><span class="op" id="3996429">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="3996432">const</span>&nbsp;<span class="ident" id="3996438">pemLineLength</span>&nbsp;<span class="op" id="3996452">=</span>&nbsp;<span class="num" id="3996454">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3996458">type</span>&nbsp;<span class="ident" id="3996463">lineBreaker</span>&nbsp;<span class="keyword" id="3996475">struct</span>&nbsp;<span class="op" id="3996482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996485">line</span>&nbsp;<span class="op" id="3996490">[</span><span class="ident" id="3996491">pemLineLength</span><span class="op" id="3996504">]</span><span class="builtintype" id="3996505">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996511">used</span>&nbsp;<span class="builtintype" id="3996516">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996521">out</span>&nbsp;&nbsp;<span class="ident" id="3996526">io</span><span class="op" id="3996528">.</span><span class="ident" id="3996529">Writer</span><br>
<span class="lineno"></span><span class="op" id="3996536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3996539">func</span>&nbsp;<span class="op" id="3996544">(</span><span class="ident" id="3996545">l</span>&nbsp;<span class="op" id="3996547">*</span><span class="ident" id="3996548">lineBreaker</span><span class="op" id="3996559">)</span>&nbsp;<span class="ident" id="3996561">Write</span><span class="op" id="3996566">(</span><span class="ident" id="3996567">b</span>&nbsp;<span class="op" id="3996569">[</span><span class="op" id="3996570">]</span><span class="builtintype" id="3996571">byte</span><span class="op" id="3996575">)</span>&nbsp;<span class="op" id="3996577">(</span><span class="ident" id="3996578">n</span>&nbsp;<span class="builtintype" id="3996580">int</span><span class="op" id="3996583">,</span>&nbsp;<span class="ident" id="3996585">err</span>&nbsp;<span class="builtintype" id="3996589">error</span><span class="op" id="3996594">)</span>&nbsp;<span class="op" id="3996596">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3996599">if</span>&nbsp;<span class="ident" id="3996602">l</span><span class="op" id="3996603">.</span><span class="ident" id="3996604">used</span><span class="op" id="3996608">+</span><span class="builtinfunc" id="3996609">len</span><span class="op" id="3996612">(</span><span class="ident" id="3996613">b</span><span class="op" id="3996614">)</span>&nbsp;<span class="op" id="3996616">&lt;</span>&nbsp;<span class="ident" id="3996618">pemLineLength</span>&nbsp;<span class="op" id="3996632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3996636">copy</span><span class="op" id="3996640">(</span><span class="ident" id="3996641">l</span><span class="op" id="3996642">.</span><span class="ident" id="3996643">line</span><span class="op" id="3996647">[</span><span class="ident" id="3996648">l</span><span class="op" id="3996649">.</span><span class="ident" id="3996650">used</span><span class="op" id="3996654">:</span><span class="op" id="3996655">]</span><span class="op" id="3996656">,</span>&nbsp;<span class="ident" id="3996658">b</span><span class="op" id="3996659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996663">l</span><span class="op" id="3996664">.</span><span class="ident" id="3996665">used</span>&nbsp;<span class="op" id="3996670">+=</span>&nbsp;<span class="builtinfunc" id="3996673">len</span><span class="op" id="3996676">(</span><span class="ident" id="3996677">b</span><span class="op" id="3996678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3996682">return</span>&nbsp;<span class="builtinfunc" id="3996689">len</span><span class="op" id="3996692">(</span><span class="ident" id="3996693">b</span><span class="op" id="3996694">)</span><span class="op" id="3996695">,</span>&nbsp;<span class="builtintype" id="3996697">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3996702">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996706">n</span><span class="op" id="3996707">,</span>&nbsp;<span class="ident" id="3996709">err</span>&nbsp;<span class="op" id="3996713">=</span>&nbsp;<span class="ident" id="3996715">l</span><span class="op" id="3996716">.</span><span class="ident" id="3996717">out</span><span class="op" id="3996720">.</span><span class="ident" id="3996721">Write</span><span class="op" id="3996726">(</span><span class="ident" id="3996727">l</span><span class="op" id="3996728">.</span><span class="ident" id="3996729">line</span><span class="op" id="3996733">[</span><span class="num" id="3996734">0</span><span class="op" id="3996735">:</span><span class="ident" id="3996736">l</span><span class="op" id="3996737">.</span><span class="ident" id="3996738">used</span><span class="op" id="3996742">]</span><span class="op" id="3996743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3996746">if</span>&nbsp;<span class="ident" id="3996749">err</span>&nbsp;<span class="op" id="3996753">!=</span>&nbsp;<span class="builtintype" id="3996756">nil</span>&nbsp;<span class="op" id="3996760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3996764">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3996772">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996775">excess</span>&nbsp;<span class="op" id="3996782">:=</span>&nbsp;<span class="ident" id="3996785">pemLineLength</span>&nbsp;<span class="op" id="3996799">-</span>&nbsp;<span class="ident" id="3996801">l</span><span class="op" id="3996802">.</span><span class="ident" id="3996803">used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996809">l</span><span class="op" id="3996810">.</span><span class="ident" id="3996811">used</span>&nbsp;<span class="op" id="3996816">=</span>&nbsp;<span class="num" id="3996818">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996822">n</span><span class="op" id="3996823">,</span>&nbsp;<span class="ident" id="3996825">err</span>&nbsp;<span class="op" id="3996829">=</span>&nbsp;<span class="ident" id="3996831">l</span><span class="op" id="3996832">.</span><span class="ident" id="3996833">out</span><span class="op" id="3996836">.</span><span class="ident" id="3996837">Write</span><span class="op" id="3996842">(</span><span class="ident" id="3996843">b</span><span class="op" id="3996844">[</span><span class="num" id="3996845">0</span><span class="op" id="3996846">:</span><span class="ident" id="3996847">excess</span><span class="op" id="3996853">]</span><span class="op" id="3996854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3996857">if</span>&nbsp;<span class="ident" id="3996860">err</span>&nbsp;<span class="op" id="3996864">!=</span>&nbsp;<span class="builtintype" id="3996867">nil</span>&nbsp;<span class="op" id="3996871">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3996875">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3996883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996887">n</span><span class="op" id="3996888">,</span>&nbsp;<span class="ident" id="3996890">err</span>&nbsp;<span class="op" id="3996894">=</span>&nbsp;<span class="ident" id="3996896">l</span><span class="op" id="3996897">.</span><span class="ident" id="3996898">out</span><span class="op" id="3996901">.</span><span class="ident" id="3996902">Write</span><span class="op" id="3996907">(</span><span class="op" id="3996908">[</span><span class="op" id="3996909">]</span><span class="builtintype" id="3996910">byte</span><span class="op" id="3996914">{</span><span class="string" id="3996915">&#39;\n&#39;</span><span class="op" id="3996919">}</span><span class="op" id="3996920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3996923">if</span>&nbsp;<span class="ident" id="3996926">err</span>&nbsp;<span class="op" id="3996930">!=</span>&nbsp;<span class="builtintype" id="3996933">nil</span>&nbsp;<span class="op" id="3996937">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3996941">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3996949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3996953">return</span>&nbsp;<span class="ident" id="3996960">l</span><span class="op" id="3996961">.</span><span class="ident" id="3996962">Write</span><span class="op" id="3996967">(</span><span class="ident" id="3996968">b</span><span class="op" id="3996969">[</span><span class="ident" id="3996970">excess</span><span class="op" id="3996976">:</span><span class="op" id="3996977">]</span><span class="op" id="3996978">)</span><br>
<span class="lineno"></span><span class="op" id="3996980">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="3996983">func</span>&nbsp;<span class="op" id="3996988">(</span><span class="ident" id="3996989">l</span>&nbsp;<span class="op" id="3996991">*</span><span class="ident" id="3996992">lineBreaker</span><span class="op" id="3997003">)</span>&nbsp;<span class="ident" id="3997005">Close</span><span class="op" id="3997010">(</span><span class="op" id="3997011">)</span>&nbsp;<span class="op" id="3997013">(</span><span class="ident" id="3997014">err</span>&nbsp;<span class="builtintype" id="3997018">error</span><span class="op" id="3997023">)</span>&nbsp;<span class="op" id="3997025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997028">if</span>&nbsp;<span class="ident" id="3997031">l</span><span class="op" id="3997032">.</span><span class="ident" id="3997033">used</span>&nbsp;<span class="op" id="3997038">&gt;</span>&nbsp;<span class="num" id="3997040">0</span>&nbsp;<span class="op" id="3997042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997046">_</span><span class="op" id="3997047">,</span>&nbsp;<span class="ident" id="3997049">err</span>&nbsp;<span class="op" id="3997053">=</span>&nbsp;<span class="ident" id="3997055">l</span><span class="op" id="3997056">.</span><span class="ident" id="3997057">out</span><span class="op" id="3997060">.</span><span class="ident" id="3997061">Write</span><span class="op" id="3997066">(</span><span class="ident" id="3997067">l</span><span class="op" id="3997068">.</span><span class="ident" id="3997069">line</span><span class="op" id="3997073">[</span><span class="num" id="3997074">0</span><span class="op" id="3997075">:</span><span class="ident" id="3997076">l</span><span class="op" id="3997077">.</span><span class="ident" id="3997078">used</span><span class="op" id="3997082">]</span><span class="op" id="3997083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997087">if</span>&nbsp;<span class="ident" id="3997090">err</span>&nbsp;<span class="op" id="3997094">!=</span>&nbsp;<span class="builtintype" id="3997097">nil</span>&nbsp;<span class="op" id="3997101">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997106">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3997115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997119">_</span><span class="op" id="3997120">,</span>&nbsp;<span class="ident" id="3997122">err</span>&nbsp;<span class="op" id="3997126">=</span>&nbsp;<span class="ident" id="3997128">l</span><span class="op" id="3997129">.</span><span class="ident" id="3997130">out</span><span class="op" id="3997133">.</span><span class="ident" id="3997134">Write</span><span class="op" id="3997139">(</span><span class="op" id="3997140">[</span><span class="op" id="3997141">]</span><span class="builtintype" id="3997142">byte</span><span class="op" id="3997146">{</span><span class="string" id="3997147">&#39;\n&#39;</span><span class="op" id="3997151">}</span><span class="op" id="3997152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3997155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997159">return</span><br>
<span class="lineno"></span><span class="op" id="3997166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3997169">func</span>&nbsp;<span class="ident" id="3997174">writeHeader</span><span class="op" id="3997185">(</span><span class="ident" id="3997186">out</span>&nbsp;<span class="ident" id="3997190">io</span><span class="op" id="3997192">.</span><span class="ident" id="3997193">Writer</span><span class="op" id="3997199">,</span>&nbsp;<span class="ident" id="3997201">k</span><span class="op" id="3997202">,</span>&nbsp;<span class="ident" id="3997204">v</span>&nbsp;<span class="builtintype" id="3997206">string</span><span class="op" id="3997212">)</span>&nbsp;<span class="builtintype" id="3997214">error</span>&nbsp;<span class="op" id="3997220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997223">_</span><span class="op" id="3997224">,</span>&nbsp;<span class="ident" id="3997226">err</span>&nbsp;<span class="op" id="3997230">:=</span>&nbsp;<span class="ident" id="3997233">out</span><span class="op" id="3997236">.</span><span class="ident" id="3997237">Write</span><span class="op" id="3997242">(</span><span class="op" id="3997243">[</span><span class="op" id="3997244">]</span><span class="builtintype" id="3997245">byte</span><span class="op" id="3997249">(</span><span class="ident" id="3997250">k</span>&nbsp;<span class="op" id="3997252">+</span>&nbsp;<span class="string" id="3997254">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3997259">+</span>&nbsp;<span class="ident" id="3997261">v</span>&nbsp;<span class="op" id="3997263">+</span>&nbsp;<span class="string" id="3997265">&#34;\n&#34;</span><span class="op" id="3997269">)</span><span class="op" id="3997270">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997273">return</span>&nbsp;<span class="ident" id="3997280">err</span><br>
<span class="lineno"></span><span class="op" id="3997284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3997287">func</span>&nbsp;<span class="ident" id="3997292">Encode</span><span class="op" id="3997298">(</span><span class="ident" id="3997299">out</span>&nbsp;<span class="ident" id="3997303">io</span><span class="op" id="3997305">.</span><span class="ident" id="3997306">Writer</span><span class="op" id="3997312">,</span>&nbsp;<span class="ident" id="3997314">b</span>&nbsp;<span class="op" id="3997316">*</span><span class="ident" id="3997317">Block</span><span class="op" id="3997322">)</span>&nbsp;<span class="builtintype" id="3997324">error</span>&nbsp;<span class="op" id="3997330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997333">if</span>&nbsp;<span class="ident" id="3997336">_</span><span class="op" id="3997337">,</span>&nbsp;<span class="ident" id="3997339">err</span>&nbsp;<span class="op" id="3997343">:=</span>&nbsp;<span class="ident" id="3997346">out</span><span class="op" id="3997349">.</span><span class="ident" id="3997350">Write</span><span class="op" id="3997355">(</span><span class="ident" id="3997356">pemStart</span><span class="op" id="3997364">[</span><span class="num" id="3997365">1</span><span class="op" id="3997366">:</span><span class="op" id="3997367">]</span><span class="op" id="3997368">)</span><span class="op" id="3997369">;</span>&nbsp;<span class="ident" id="3997371">err</span>&nbsp;<span class="op" id="3997375">!=</span>&nbsp;<span class="builtintype" id="3997378">nil</span>&nbsp;<span class="op" id="3997382">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997386">return</span>&nbsp;<span class="ident" id="3997393">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3997398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997401">if</span>&nbsp;<span class="ident" id="3997404">_</span><span class="op" id="3997405">,</span>&nbsp;<span class="ident" id="3997407">err</span>&nbsp;<span class="op" id="3997411">:=</span>&nbsp;<span class="ident" id="3997414">out</span><span class="op" id="3997417">.</span><span class="ident" id="3997418">Write</span><span class="op" id="3997423">(</span><span class="op" id="3997424">[</span><span class="op" id="3997425">]</span><span class="builtintype" id="3997426">byte</span><span class="op" id="3997430">(</span><span class="ident" id="3997431">b</span><span class="op" id="3997432">.</span><span class="ident" id="3997433">Type</span>&nbsp;<span class="op" id="3997438">+</span>&nbsp;<span class="string" id="3997440">&#34;-----\n&#34;</span><span class="op" id="3997449">)</span><span class="op" id="3997450">)</span><span class="op" id="3997451">;</span>&nbsp;<span class="ident" id="3997453">err</span>&nbsp;<span class="op" id="3997457">!=</span>&nbsp;<span class="builtintype" id="3997460">nil</span>&nbsp;<span class="op" id="3997464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997468">return</span>&nbsp;<span class="ident" id="3997475">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3997480">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997484">if</span>&nbsp;<span class="builtinfunc" id="3997487">len</span><span class="op" id="3997490">(</span><span class="ident" id="3997491">b</span><span class="op" id="3997492">.</span><span class="ident" id="3997493">Headers</span><span class="op" id="3997500">)</span>&nbsp;<span class="op" id="3997502">&gt;</span>&nbsp;<span class="num" id="3997504">0</span>&nbsp;<span class="op" id="3997506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997510">const</span>&nbsp;<span class="ident" id="3997516">procType</span>&nbsp;<span class="op" id="3997525">=</span>&nbsp;<span class="string" id="3997527">&#34;Proc-Type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997541">h</span>&nbsp;<span class="op" id="3997543">:=</span>&nbsp;<span class="builtinfunc" id="3997546">make</span><span class="op" id="3997550">(</span><span class="op" id="3997551">[</span><span class="op" id="3997552">]</span><span class="builtintype" id="3997553">string</span><span class="op" id="3997559">,</span>&nbsp;<span class="num" id="3997561">0</span><span class="op" id="3997562">,</span>&nbsp;<span class="builtinfunc" id="3997564">len</span><span class="op" id="3997567">(</span><span class="ident" id="3997568">b</span><span class="op" id="3997569">.</span><span class="ident" id="3997570">Headers</span><span class="op" id="3997577">)</span><span class="op" id="3997578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997582">hasProcType</span>&nbsp;<span class="op" id="3997594">:=</span>&nbsp;<span class="builtintype" id="3997597">false</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997605">for</span>&nbsp;<span class="ident" id="3997609">k</span>&nbsp;<span class="op" id="3997611">:=</span>&nbsp;<span class="keyword" id="3997614">range</span>&nbsp;<span class="ident" id="3997620">b</span><span class="op" id="3997621">.</span><span class="ident" id="3997622">Headers</span>&nbsp;<span class="op" id="3997630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997635">if</span>&nbsp;<span class="ident" id="3997638">k</span>&nbsp;<span class="op" id="3997640">==</span>&nbsp;<span class="ident" id="3997643">procType</span>&nbsp;<span class="op" id="3997652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997658">hasProcType</span>&nbsp;<span class="op" id="3997670">=</span>&nbsp;<span class="builtintype" id="3997672">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997681">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3997693">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997698">h</span>&nbsp;<span class="op" id="3997700">=</span>&nbsp;<span class="builtinfunc" id="3997702">append</span><span class="op" id="3997708">(</span><span class="ident" id="3997709">h</span><span class="op" id="3997710">,</span>&nbsp;<span class="ident" id="3997712">k</span><span class="op" id="3997713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3997717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997721">//&nbsp;The&nbsp;Proc-Type&nbsp;header&nbsp;must&nbsp;be&nbsp;written&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997770">//&nbsp;See&nbsp;RFC&nbsp;1421,&nbsp;section&nbsp;4.6.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997805">if</span>&nbsp;<span class="ident" id="3997808">hasProcType</span>&nbsp;<span class="op" id="3997820">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997825">if</span>&nbsp;<span class="ident" id="3997828">err</span>&nbsp;<span class="op" id="3997832">:=</span>&nbsp;<span class="ident" id="3997835">writeHeader</span><span class="op" id="3997846">(</span><span class="ident" id="3997847">out</span><span class="op" id="3997850">,</span>&nbsp;<span class="ident" id="3997852">procType</span><span class="op" id="3997860">,</span>&nbsp;<span class="ident" id="3997862">b</span><span class="op" id="3997863">.</span><span class="ident" id="3997864">Headers</span><span class="op" id="3997871">[</span><span class="ident" id="3997872">procType</span><span class="op" id="3997880">]</span><span class="op" id="3997881">)</span><span class="op" id="3997882">;</span>&nbsp;<span class="ident" id="3997884">err</span>&nbsp;<span class="op" id="3997888">!=</span>&nbsp;<span class="builtintype" id="3997891">nil</span>&nbsp;<span class="op" id="3997895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997901">return</span>&nbsp;<span class="ident" id="3997908">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3997915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3997919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997923">//&nbsp;For&nbsp;consistency&nbsp;of&nbsp;output,&nbsp;write&nbsp;other&nbsp;headers&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997990">sort</span><span class="op" id="3997994">.</span><span class="ident" id="3997995">Strings</span><span class="op" id="3998002">(</span><span class="ident" id="3998003">h</span><span class="op" id="3998004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998008">for</span>&nbsp;<span class="ident" id="3998012">_</span><span class="op" id="3998013">,</span>&nbsp;<span class="ident" id="3998015">k</span>&nbsp;<span class="op" id="3998017">:=</span>&nbsp;<span class="keyword" id="3998020">range</span>&nbsp;<span class="ident" id="3998026">h</span>&nbsp;<span class="op" id="3998028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998033">if</span>&nbsp;<span class="ident" id="3998036">err</span>&nbsp;<span class="op" id="3998040">:=</span>&nbsp;<span class="ident" id="3998043">writeHeader</span><span class="op" id="3998054">(</span><span class="ident" id="3998055">out</span><span class="op" id="3998058">,</span>&nbsp;<span class="ident" id="3998060">k</span><span class="op" id="3998061">,</span>&nbsp;<span class="ident" id="3998063">b</span><span class="op" id="3998064">.</span><span class="ident" id="3998065">Headers</span><span class="op" id="3998072">[</span><span class="ident" id="3998073">k</span><span class="op" id="3998074">]</span><span class="op" id="3998075">)</span><span class="op" id="3998076">;</span>&nbsp;<span class="ident" id="3998078">err</span>&nbsp;<span class="op" id="3998082">!=</span>&nbsp;<span class="builtintype" id="3998085">nil</span>&nbsp;<span class="op" id="3998089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998095">return</span>&nbsp;<span class="ident" id="3998102">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3998109">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3998113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998117">if</span>&nbsp;<span class="ident" id="3998120">_</span><span class="op" id="3998121">,</span>&nbsp;<span class="ident" id="3998123">err</span>&nbsp;<span class="op" id="3998127">:=</span>&nbsp;<span class="ident" id="3998130">out</span><span class="op" id="3998133">.</span><span class="ident" id="3998134">Write</span><span class="op" id="3998139">(</span><span class="op" id="3998140">[</span><span class="op" id="3998141">]</span><span class="builtintype" id="3998142">byte</span><span class="op" id="3998146">{</span><span class="string" id="3998147">&#39;\n&#39;</span><span class="op" id="3998151">}</span><span class="op" id="3998152">)</span><span class="op" id="3998153">;</span>&nbsp;<span class="ident" id="3998155">err</span>&nbsp;<span class="op" id="3998159">!=</span>&nbsp;<span class="builtintype" id="3998162">nil</span>&nbsp;<span class="op" id="3998166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998171">return</span>&nbsp;<span class="ident" id="3998178">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3998184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3998187">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998191">var</span>&nbsp;<span class="ident" id="3998195">breaker</span>&nbsp;<span class="ident" id="3998203">lineBreaker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998216">breaker</span><span class="op" id="3998223">.</span><span class="ident" id="3998224">out</span>&nbsp;<span class="op" id="3998228">=</span>&nbsp;<span class="ident" id="3998230">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998236">b64</span>&nbsp;<span class="op" id="3998240">:=</span>&nbsp;<span class="ident" id="3998243">base64</span><span class="op" id="3998249">.</span><span class="ident" id="3998250">NewEncoder</span><span class="op" id="3998260">(</span><span class="ident" id="3998261">base64</span><span class="op" id="3998267">.</span><span class="ident" id="3998268">StdEncoding</span><span class="op" id="3998279">,</span>&nbsp;<span class="op" id="3998281">&amp;</span><span class="ident" id="3998282">breaker</span><span class="op" id="3998289">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998292">if</span>&nbsp;<span class="ident" id="3998295">_</span><span class="op" id="3998296">,</span>&nbsp;<span class="ident" id="3998298">err</span>&nbsp;<span class="op" id="3998302">:=</span>&nbsp;<span class="ident" id="3998305">b64</span><span class="op" id="3998308">.</span><span class="ident" id="3998309">Write</span><span class="op" id="3998314">(</span><span class="ident" id="3998315">b</span><span class="op" id="3998316">.</span><span class="ident" id="3998317">Bytes</span><span class="op" id="3998322">)</span><span class="op" id="3998323">;</span>&nbsp;<span class="ident" id="3998325">err</span>&nbsp;<span class="op" id="3998329">!=</span>&nbsp;<span class="builtintype" id="3998332">nil</span>&nbsp;<span class="op" id="3998336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998340">return</span>&nbsp;<span class="ident" id="3998347">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3998352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998355">b64</span><span class="op" id="3998358">.</span><span class="ident" id="3998359">Close</span><span class="op" id="3998364">(</span><span class="op" id="3998365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998368">breaker</span><span class="op" id="3998375">.</span><span class="ident" id="3998376">Close</span><span class="op" id="3998381">(</span><span class="op" id="3998382">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998386">if</span>&nbsp;<span class="ident" id="3998389">_</span><span class="op" id="3998390">,</span>&nbsp;<span class="ident" id="3998392">err</span>&nbsp;<span class="op" id="3998396">:=</span>&nbsp;<span class="ident" id="3998399">out</span><span class="op" id="3998402">.</span><span class="ident" id="3998403">Write</span><span class="op" id="3998408">(</span><span class="ident" id="3998409">pemEnd</span><span class="op" id="3998415">[</span><span class="num" id="3998416">1</span><span class="op" id="3998417">:</span><span class="op" id="3998418">]</span><span class="op" id="3998419">)</span><span class="op" id="3998420">;</span>&nbsp;<span class="ident" id="3998422">err</span>&nbsp;<span class="op" id="3998426">!=</span>&nbsp;<span class="builtintype" id="3998429">nil</span>&nbsp;<span class="op" id="3998433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998437">return</span>&nbsp;<span class="ident" id="3998444">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3998449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998452">_</span><span class="op" id="3998453">,</span>&nbsp;<span class="ident" id="3998455">err</span>&nbsp;<span class="op" id="3998459">:=</span>&nbsp;<span class="ident" id="3998462">out</span><span class="op" id="3998465">.</span><span class="ident" id="3998466">Write</span><span class="op" id="3998471">(</span><span class="op" id="3998472">[</span><span class="op" id="3998473">]</span><span class="builtintype" id="3998474">byte</span><span class="op" id="3998478">(</span><span class="ident" id="3998479">b</span><span class="op" id="3998480">.</span><span class="ident" id="3998481">Type</span>&nbsp;<span class="op" id="3998486">+</span>&nbsp;<span class="string" id="3998488">&#34;-----\n&#34;</span><span class="op" id="3998497">)</span><span class="op" id="3998498">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998501">return</span>&nbsp;<span class="ident" id="3998508">err</span><br>
<span class="lineno"></span><span class="op" id="3998512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3998515">func</span>&nbsp;<span class="ident" id="3998520">EncodeToMemory</span><span class="op" id="3998534">(</span><span class="ident" id="3998535">b</span>&nbsp;<span class="op" id="3998537">*</span><span class="ident" id="3998538">Block</span><span class="op" id="3998543">)</span>&nbsp;<span class="op" id="3998545">[</span><span class="op" id="3998546">]</span><span class="builtintype" id="3998547">byte</span>&nbsp;<span class="op" id="3998552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998555">var</span>&nbsp;<span class="ident" id="3998559">buf</span>&nbsp;<span class="ident" id="3998563">bytes</span><span class="op" id="3998568">.</span><span class="ident" id="3998569">Buffer</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998577">Encode</span><span class="op" id="3998583">(</span><span class="op" id="3998584">&amp;</span><span class="ident" id="3998585">buf</span><span class="op" id="3998588">,</span>&nbsp;<span class="ident" id="3998590">b</span><span class="op" id="3998591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998594">return</span>&nbsp;<span class="ident" id="3998601">buf</span><span class="op" id="3998604">.</span><span class="ident" id="3998605">Bytes</span><span class="op" id="3998610">(</span><span class="op" id="3998611">)</span><br>
<span class="lineno"></span><span class="op" id="3998613">}</span>
</div>
</body>
</html>
