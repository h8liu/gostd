<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html" class="current">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2524495">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2524550">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2524604">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2524655">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2524720">//&nbsp;Fork,&nbsp;exec,&nbsp;wait,&nbsp;etc.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2524747">package</span>&nbsp;<span class="ident" id="2524755">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2524764">import</span>&nbsp;<span class="op" id="2524771">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2524774">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2524785">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2524793">&#34;unsafe&#34;</span><br>
<span class="lineno">15</span><span class="op" id="2524802">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2524805">//&nbsp;Lock&nbsp;synchronizing&nbsp;creation&nbsp;of&nbsp;new&nbsp;file&nbsp;descriptors&nbsp;with&nbsp;fork.</span><br>
<span class="lineno"></span><span class="comment" id="2524871">//</span><br>
<span class="lineno"></span><span class="comment" id="2524874">//&nbsp;We&nbsp;want&nbsp;the&nbsp;child&nbsp;in&nbsp;a&nbsp;fork/exec&nbsp;sequence&nbsp;to&nbsp;inherit&nbsp;only&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="2524939">//&nbsp;file&nbsp;descriptors&nbsp;we&nbsp;intend.&nbsp;&nbsp;To&nbsp;do&nbsp;that,&nbsp;we&nbsp;mark&nbsp;all&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="2525000">//&nbsp;descriptors&nbsp;close-on-exec&nbsp;and&nbsp;then,&nbsp;in&nbsp;the&nbsp;child,&nbsp;explicitly</span><br>
<span class="lineno"></span><span class="comment" id="2525064">//&nbsp;unmark&nbsp;the&nbsp;ones&nbsp;we&nbsp;want&nbsp;the&nbsp;exec&#39;ed&nbsp;program&nbsp;to&nbsp;keep.</span><br>
<span class="lineno"></span><span class="comment" id="2525120">//&nbsp;Unix&nbsp;doesn&#39;t&nbsp;make&nbsp;this&nbsp;easy:&nbsp;there&nbsp;is,&nbsp;in&nbsp;general,&nbsp;no&nbsp;way&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2525184">//&nbsp;allocate&nbsp;a&nbsp;new&nbsp;file&nbsp;descriptor&nbsp;close-on-exec.&nbsp;&nbsp;Instead&nbsp;you</span><br>
<span class="lineno">25</span><span class="comment" id="2525246">//&nbsp;have&nbsp;to&nbsp;allocate&nbsp;the&nbsp;descriptor&nbsp;and&nbsp;then&nbsp;mark&nbsp;it&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="comment" id="2525313">//&nbsp;If&nbsp;a&nbsp;fork&nbsp;happens&nbsp;between&nbsp;those&nbsp;two&nbsp;events,&nbsp;the&nbsp;child&#39;s&nbsp;exec</span><br>
<span class="lineno"></span><span class="comment" id="2525377">//&nbsp;will&nbsp;inherit&nbsp;an&nbsp;unwanted&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="comment" id="2525422">//</span><br>
<span class="lineno"></span><span class="comment" id="2525425">//&nbsp;This&nbsp;lock&nbsp;solves&nbsp;that&nbsp;race:&nbsp;the&nbsp;create&nbsp;new&nbsp;fd/mark&nbsp;close-on-exec</span><br>
<span class="lineno">30</span><span class="comment" id="2525493">//&nbsp;operation&nbsp;is&nbsp;done&nbsp;holding&nbsp;ForkLock&nbsp;for&nbsp;reading,&nbsp;and&nbsp;the&nbsp;fork&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="2525564">//&nbsp;is&nbsp;done&nbsp;holding&nbsp;ForkLock&nbsp;for&nbsp;writing.&nbsp;&nbsp;At&nbsp;least,&nbsp;that&#39;s&nbsp;the&nbsp;idea.</span><br>
<span class="lineno"></span><span class="comment" id="2525633">//&nbsp;There&nbsp;are&nbsp;some&nbsp;complications.</span><br>
<span class="lineno"></span><span class="comment" id="2525666">//</span><br>
<span class="lineno"></span><span class="comment" id="2525669">//&nbsp;Some&nbsp;system&nbsp;calls&nbsp;that&nbsp;create&nbsp;new&nbsp;file&nbsp;descriptors&nbsp;can&nbsp;block</span><br>
<span class="lineno">35</span><span class="comment" id="2525733">//&nbsp;for&nbsp;arbitrarily&nbsp;long&nbsp;times:&nbsp;open&nbsp;on&nbsp;a&nbsp;hung&nbsp;NFS&nbsp;server&nbsp;or&nbsp;named</span><br>
<span class="lineno"></span><span class="comment" id="2525799">//&nbsp;pipe,&nbsp;accept&nbsp;on&nbsp;a&nbsp;socket,&nbsp;and&nbsp;so&nbsp;on.&nbsp;&nbsp;We&nbsp;can&#39;t&nbsp;reasonably&nbsp;grab</span><br>
<span class="lineno"></span><span class="comment" id="2525865">//&nbsp;the&nbsp;lock&nbsp;across&nbsp;those&nbsp;operations.</span><br>
<span class="lineno"></span><span class="comment" id="2525902">//</span><br>
<span class="lineno"></span><span class="comment" id="2525905">//&nbsp;It&nbsp;is&nbsp;worse&nbsp;to&nbsp;inherit&nbsp;some&nbsp;file&nbsp;descriptors&nbsp;than&nbsp;others.</span><br>
<span class="lineno">40</span><span class="comment" id="2525966">//&nbsp;If&nbsp;a&nbsp;non-malicious&nbsp;child&nbsp;accidentally&nbsp;inherits&nbsp;an&nbsp;open&nbsp;ordinary&nbsp;file,</span><br>
<span class="lineno"></span><span class="comment" id="2526039">//&nbsp;that&#39;s&nbsp;not&nbsp;a&nbsp;big&nbsp;deal.&nbsp;&nbsp;On&nbsp;the&nbsp;other&nbsp;hand,&nbsp;if&nbsp;a&nbsp;long-lived&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="2526107">//&nbsp;accidentally&nbsp;inherits&nbsp;the&nbsp;write&nbsp;end&nbsp;of&nbsp;a&nbsp;pipe,&nbsp;then&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="2526173">//&nbsp;of&nbsp;that&nbsp;pipe&nbsp;will&nbsp;not&nbsp;see&nbsp;EOF&nbsp;until&nbsp;that&nbsp;child&nbsp;exits,&nbsp;potentially</span><br>
<span class="lineno"></span><span class="comment" id="2526242">//&nbsp;causing&nbsp;the&nbsp;parent&nbsp;program&nbsp;to&nbsp;hang.&nbsp;&nbsp;This&nbsp;is&nbsp;a&nbsp;common&nbsp;problem</span><br>
<span class="lineno">45</span><span class="comment" id="2526307">//&nbsp;in&nbsp;threaded&nbsp;C&nbsp;programs&nbsp;that&nbsp;use&nbsp;popen.</span><br>
<span class="lineno"></span><span class="comment" id="2526349">//</span><br>
<span class="lineno"></span><span class="comment" id="2526352">//&nbsp;Luckily,&nbsp;the&nbsp;file&nbsp;descriptors&nbsp;that&nbsp;are&nbsp;most&nbsp;important&nbsp;not&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2526416">//&nbsp;inherit&nbsp;are&nbsp;not&nbsp;the&nbsp;ones&nbsp;that&nbsp;can&nbsp;take&nbsp;an&nbsp;arbitrarily&nbsp;long&nbsp;time</span><br>
<span class="lineno"></span><span class="comment" id="2526483">//&nbsp;to&nbsp;create:&nbsp;pipe&nbsp;returns&nbsp;instantly,&nbsp;and&nbsp;the&nbsp;net&nbsp;package&nbsp;uses</span><br>
<span class="lineno">50</span><span class="comment" id="2526546">//&nbsp;non-blocking&nbsp;I/O&nbsp;to&nbsp;accept&nbsp;on&nbsp;a&nbsp;listening&nbsp;socket.</span><br>
<span class="lineno"></span><span class="comment" id="2526599">//&nbsp;The&nbsp;rules&nbsp;for&nbsp;which&nbsp;file&nbsp;descriptor-creating&nbsp;operations&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2526666">//&nbsp;ForkLock&nbsp;are&nbsp;as&nbsp;follows:</span><br>
<span class="lineno"></span><span class="comment" id="2526694">//</span><br>
<span class="lineno"></span><span class="comment" id="2526697">//&nbsp;1)&nbsp;Pipe.&nbsp;&nbsp;&nbsp;&nbsp;Does&nbsp;not&nbsp;block.&nbsp;&nbsp;Use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno">55</span><span class="comment" id="2526747">//&nbsp;2)&nbsp;Socket.&nbsp;&nbsp;Does&nbsp;not&nbsp;block.&nbsp;&nbsp;Use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno"></span><span class="comment" id="2526797">//&nbsp;3)&nbsp;Accept.&nbsp;&nbsp;If&nbsp;using&nbsp;non-blocking&nbsp;mode,&nbsp;use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno"></span><span class="comment" id="2526858">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Otherwise,&nbsp;live&nbsp;with&nbsp;the&nbsp;race.</span><br>
<span class="lineno"></span><span class="comment" id="2526904">//&nbsp;4)&nbsp;Open.&nbsp;&nbsp;&nbsp;&nbsp;Can&nbsp;block.&nbsp;&nbsp;Use&nbsp;O_CLOEXEC&nbsp;if&nbsp;available&nbsp;(Linux).</span><br>
<span class="lineno"></span><span class="comment" id="2526967">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Otherwise,&nbsp;live&nbsp;with&nbsp;the&nbsp;race.</span><br>
<span class="lineno">60</span><span class="comment" id="2527013">//&nbsp;5)&nbsp;Dup.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Does&nbsp;not&nbsp;block.&nbsp;&nbsp;Use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno"></span><span class="comment" id="2527063">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;Linux,&nbsp;could&nbsp;use&nbsp;fcntl&nbsp;F_DUPFD_CLOEXEC</span><br>
<span class="lineno"></span><span class="comment" id="2527120">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instead&nbsp;of&nbsp;the&nbsp;ForkLock,&nbsp;but&nbsp;only&nbsp;for&nbsp;dup(fd,&nbsp;-1).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2527187">var</span>&nbsp;<span class="ident" id="2527191">ForkLock</span>&nbsp;<span class="ident" id="2527200">sync</span><span class="op" id="2527204">.</span><span class="ident" id="2527205">RWMutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="2527214">//&nbsp;StringSlicePtr&nbsp;is&nbsp;deprecated.&nbsp;Use&nbsp;SlicePtrFromStrings&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="2527280">//&nbsp;If&nbsp;any&nbsp;string&nbsp;contains&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;this&nbsp;function&nbsp;panics&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="2527346">//&nbsp;of&nbsp;returning&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="2527372">func</span>&nbsp;<span class="ident" id="2527377">StringSlicePtr</span><span class="op" id="2527391">(</span><span class="ident" id="2527392">ss</span>&nbsp;<span class="op" id="2527395">[</span><span class="op" id="2527396">]</span><span class="builtintype" id="2527397">string</span><span class="op" id="2527403">)</span>&nbsp;<span class="op" id="2527405">[</span><span class="op" id="2527406">]</span><span class="op" id="2527407">*</span><span class="builtintype" id="2527408">byte</span>&nbsp;<span class="op" id="2527413">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2527416">bb</span>&nbsp;<span class="op" id="2527419">:=</span>&nbsp;<span class="builtinfunc" id="2527422">make</span><span class="op" id="2527426">(</span><span class="op" id="2527427">[</span><span class="op" id="2527428">]</span><span class="op" id="2527429">*</span><span class="builtintype" id="2527430">byte</span><span class="op" id="2527434">,</span>&nbsp;<span class="builtinfunc" id="2527436">len</span><span class="op" id="2527439">(</span><span class="ident" id="2527440">ss</span><span class="op" id="2527442">)</span><span class="op" id="2527443">+</span><span class="num" id="2527444">1</span><span class="op" id="2527445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2527448">for</span>&nbsp;<span class="ident" id="2527452">i</span>&nbsp;<span class="op" id="2527454">:=</span>&nbsp;<span class="num" id="2527457">0</span><span class="op" id="2527458">;</span>&nbsp;<span class="ident" id="2527460">i</span>&nbsp;<span class="op" id="2527462">&lt;</span>&nbsp;<span class="builtinfunc" id="2527464">len</span><span class="op" id="2527467">(</span><span class="ident" id="2527468">ss</span><span class="op" id="2527470">)</span><span class="op" id="2527471">;</span>&nbsp;<span class="ident" id="2527473">i</span><span class="op" id="2527474">++</span>&nbsp;<span class="op" id="2527477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2527481">bb</span><span class="op" id="2527483">[</span><span class="ident" id="2527484">i</span><span class="op" id="2527485">]</span>&nbsp;<span class="op" id="2527487">=</span>&nbsp;<span class="ident" id="2527489">StringBytePtr</span><span class="op" id="2527502">(</span><span class="ident" id="2527503">ss</span><span class="op" id="2527505">[</span><span class="ident" id="2527506">i</span><span class="op" id="2527507">]</span><span class="op" id="2527508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2527511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2527514">bb</span><span class="op" id="2527516">[</span><span class="builtinfunc" id="2527517">len</span><span class="op" id="2527520">(</span><span class="ident" id="2527521">ss</span><span class="op" id="2527523">)</span><span class="op" id="2527524">]</span>&nbsp;<span class="op" id="2527526">=</span>&nbsp;<span class="builtintype" id="2527528">nil</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2527533">return</span>&nbsp;<span class="ident" id="2527540">bb</span><br>
<span class="lineno"></span><span class="op" id="2527543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2527546">//&nbsp;SlicePtrFromStrings&nbsp;converts&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;to&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2527611">//&nbsp;pointers&nbsp;to&nbsp;NUL-terminated&nbsp;byte&nbsp;slices.&nbsp;If&nbsp;any&nbsp;string&nbsp;contains</span><br>
<span class="lineno">80</span><span class="comment" id="2527677">//&nbsp;a&nbsp;NUL&nbsp;byte,&nbsp;it&nbsp;returns&nbsp;(nil,&nbsp;EINVAL).</span><br>
<span class="lineno"></span><span class="keyword" id="2527718">func</span>&nbsp;<span class="ident" id="2527723">SlicePtrFromStrings</span><span class="op" id="2527742">(</span><span class="ident" id="2527743">ss</span>&nbsp;<span class="op" id="2527746">[</span><span class="op" id="2527747">]</span><span class="builtintype" id="2527748">string</span><span class="op" id="2527754">)</span>&nbsp;<span class="op" id="2527756">(</span><span class="op" id="2527757">[</span><span class="op" id="2527758">]</span><span class="op" id="2527759">*</span><span class="builtintype" id="2527760">byte</span><span class="op" id="2527764">,</span>&nbsp;<span class="builtintype" id="2527766">error</span><span class="op" id="2527771">)</span>&nbsp;<span class="op" id="2527773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2527776">var</span>&nbsp;<span class="ident" id="2527780">err</span>&nbsp;<span class="builtintype" id="2527784">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2527791">bb</span>&nbsp;<span class="op" id="2527794">:=</span>&nbsp;<span class="builtinfunc" id="2527797">make</span><span class="op" id="2527801">(</span><span class="op" id="2527802">[</span><span class="op" id="2527803">]</span><span class="op" id="2527804">*</span><span class="builtintype" id="2527805">byte</span><span class="op" id="2527809">,</span>&nbsp;<span class="builtinfunc" id="2527811">len</span><span class="op" id="2527814">(</span><span class="ident" id="2527815">ss</span><span class="op" id="2527817">)</span><span class="op" id="2527818">+</span><span class="num" id="2527819">1</span><span class="op" id="2527820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2527823">for</span>&nbsp;<span class="ident" id="2527827">i</span>&nbsp;<span class="op" id="2527829">:=</span>&nbsp;<span class="num" id="2527832">0</span><span class="op" id="2527833">;</span>&nbsp;<span class="ident" id="2527835">i</span>&nbsp;<span class="op" id="2527837">&lt;</span>&nbsp;<span class="builtinfunc" id="2527839">len</span><span class="op" id="2527842">(</span><span class="ident" id="2527843">ss</span><span class="op" id="2527845">)</span><span class="op" id="2527846">;</span>&nbsp;<span class="ident" id="2527848">i</span><span class="op" id="2527849">++</span>&nbsp;<span class="op" id="2527852">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2527856">bb</span><span class="op" id="2527858">[</span><span class="ident" id="2527859">i</span><span class="op" id="2527860">]</span><span class="op" id="2527861">,</span>&nbsp;<span class="ident" id="2527863">err</span>&nbsp;<span class="op" id="2527867">=</span>&nbsp;<span class="ident" id="2527869">BytePtrFromString</span><span class="op" id="2527886">(</span><span class="ident" id="2527887">ss</span><span class="op" id="2527889">[</span><span class="ident" id="2527890">i</span><span class="op" id="2527891">]</span><span class="op" id="2527892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2527896">if</span>&nbsp;<span class="ident" id="2527899">err</span>&nbsp;<span class="op" id="2527903">!=</span>&nbsp;<span class="builtintype" id="2527906">nil</span>&nbsp;<span class="op" id="2527910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2527915">return</span>&nbsp;<span class="builtintype" id="2527922">nil</span><span class="op" id="2527925">,</span>&nbsp;<span class="ident" id="2527927">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2527933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2527936">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2527939">bb</span><span class="op" id="2527941">[</span><span class="builtinfunc" id="2527942">len</span><span class="op" id="2527945">(</span><span class="ident" id="2527946">ss</span><span class="op" id="2527948">)</span><span class="op" id="2527949">]</span>&nbsp;<span class="op" id="2527951">=</span>&nbsp;<span class="builtintype" id="2527953">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2527958">return</span>&nbsp;<span class="ident" id="2527965">bb</span><span class="op" id="2527967">,</span>&nbsp;<span class="builtintype" id="2527969">nil</span><br>
<span class="lineno"></span><span class="op" id="2527973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2527976">func</span>&nbsp;<span class="ident" id="2527981">CloseOnExec</span><span class="op" id="2527992">(</span><span class="ident" id="2527993">fd</span>&nbsp;<span class="builtintype" id="2527996">int</span><span class="op" id="2527999">)</span>&nbsp;<span class="op" id="2528001">{</span>&nbsp;<span class="ident" id="2528003">fcntl</span><span class="op" id="2528008">(</span><span class="ident" id="2528009">fd</span><span class="op" id="2528011">,</span>&nbsp;<span class="ident" id="2528013">F_SETFD</span><span class="op" id="2528020">,</span>&nbsp;<span class="ident" id="2528022">FD_CLOEXEC</span><span class="op" id="2528032">)</span>&nbsp;<span class="op" id="2528034">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="2528037">func</span>&nbsp;<span class="ident" id="2528042">SetNonblock</span><span class="op" id="2528053">(</span><span class="ident" id="2528054">fd</span>&nbsp;<span class="builtintype" id="2528057">int</span><span class="op" id="2528060">,</span>&nbsp;<span class="ident" id="2528062">nonblocking</span>&nbsp;<span class="builtintype" id="2528074">bool</span><span class="op" id="2528078">)</span>&nbsp;<span class="op" id="2528080">(</span><span class="ident" id="2528081">err</span>&nbsp;<span class="builtintype" id="2528085">error</span><span class="op" id="2528090">)</span>&nbsp;<span class="op" id="2528092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2528095">flag</span><span class="op" id="2528099">,</span>&nbsp;<span class="ident" id="2528101">err</span>&nbsp;<span class="op" id="2528105">:=</span>&nbsp;<span class="ident" id="2528108">fcntl</span><span class="op" id="2528113">(</span><span class="ident" id="2528114">fd</span><span class="op" id="2528116">,</span>&nbsp;<span class="ident" id="2528118">F_GETFL</span><span class="op" id="2528125">,</span>&nbsp;<span class="num" id="2528127">0</span><span class="op" id="2528128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2528131">if</span>&nbsp;<span class="ident" id="2528134">err</span>&nbsp;<span class="op" id="2528138">!=</span>&nbsp;<span class="builtintype" id="2528141">nil</span>&nbsp;<span class="op" id="2528145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2528149">return</span>&nbsp;<span class="ident" id="2528156">err</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2528161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2528164">if</span>&nbsp;<span class="ident" id="2528167">nonblocking</span>&nbsp;<span class="op" id="2528179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2528183">flag</span>&nbsp;<span class="op" id="2528188">|=</span>&nbsp;<span class="ident" id="2528191">O_NONBLOCK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2528203">}</span>&nbsp;<span class="keyword" id="2528205">else</span>&nbsp;<span class="op" id="2528210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2528214">flag</span>&nbsp;<span class="op" id="2528219">&amp;=</span>&nbsp;<span class="op" id="2528222">^</span><span class="ident" id="2528223">O_NONBLOCK</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2528235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2528238">_</span><span class="op" id="2528239">,</span>&nbsp;<span class="ident" id="2528241">err</span>&nbsp;<span class="op" id="2528245">=</span>&nbsp;<span class="ident" id="2528247">fcntl</span><span class="op" id="2528252">(</span><span class="ident" id="2528253">fd</span><span class="op" id="2528255">,</span>&nbsp;<span class="ident" id="2528257">F_SETFL</span><span class="op" id="2528264">,</span>&nbsp;<span class="ident" id="2528266">flag</span><span class="op" id="2528270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2528273">return</span>&nbsp;<span class="ident" id="2528280">err</span><br>
<span class="lineno"></span><span class="op" id="2528284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="2528287">//&nbsp;Credential&nbsp;holds&nbsp;user&nbsp;and&nbsp;group&nbsp;identities&nbsp;to&nbsp;be&nbsp;assumed</span><br>
<span class="lineno"></span><span class="comment" id="2528347">//&nbsp;by&nbsp;a&nbsp;child&nbsp;process&nbsp;started&nbsp;by&nbsp;StartProcess.</span><br>
<span class="lineno"></span><span class="keyword" id="2528394">type</span>&nbsp;<span class="ident" id="2528399">Credential</span>&nbsp;<span class="keyword" id="2528410">struct</span>&nbsp;<span class="op" id="2528417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2528420">Uid</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2528427">uint32</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="2528436">//&nbsp;User&nbsp;ID.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2528449">Gid</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2528456">uint32</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="2528465">//&nbsp;Group&nbsp;ID.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2528479">Groups</span>&nbsp;<span class="op" id="2528486">[</span><span class="op" id="2528487">]</span><span class="builtintype" id="2528488">uint32</span>&nbsp;<span class="comment" id="2528495">//&nbsp;Supplementary&nbsp;group&nbsp;IDs.</span><br>
<span class="lineno"></span><span class="op" id="2528523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2528526">//&nbsp;ProcAttr&nbsp;holds&nbsp;attributes&nbsp;that&nbsp;will&nbsp;be&nbsp;applied&nbsp;to&nbsp;a&nbsp;new&nbsp;process&nbsp;started</span><br>
<span class="lineno"></span><span class="comment" id="2528601">//&nbsp;by&nbsp;StartProcess.</span><br>
<span class="lineno">120</span><span class="keyword" id="2528621">type</span>&nbsp;<span class="ident" id="2528626">ProcAttr</span>&nbsp;<span class="keyword" id="2528635">struct</span>&nbsp;<span class="op" id="2528642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2528645">Dir</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2528651">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2528661">//&nbsp;Current&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2528692">Env</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2528698">[</span><span class="op" id="2528699">]</span><span class="builtintype" id="2528700">string</span>&nbsp;&nbsp;<span class="comment" id="2528708">//&nbsp;Environment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2528725">Files</span>&nbsp;<span class="op" id="2528731">[</span><span class="op" id="2528732">]</span><span class="builtintype" id="2528733">uintptr</span>&nbsp;<span class="comment" id="2528741">//&nbsp;File&nbsp;descriptors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2528763">Sys</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2528769">*</span><span class="ident" id="2528770">SysProcAttr</span><br>
<span class="lineno">125</span><span class="op" id="2528782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2528785">var</span>&nbsp;<span class="ident" id="2528789">zeroProcAttr</span>&nbsp;<span class="ident" id="2528802">ProcAttr</span><br>
<span class="lineno"></span><span class="keyword" id="2528811">var</span>&nbsp;<span class="ident" id="2528815">zeroSysProcAttr</span>&nbsp;<span class="ident" id="2528831">SysProcAttr</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2528844">func</span>&nbsp;<span class="ident" id="2528849">forkExec</span><span class="op" id="2528857">(</span><span class="ident" id="2528858">argv0</span>&nbsp;<span class="builtintype" id="2528864">string</span><span class="op" id="2528870">,</span>&nbsp;<span class="ident" id="2528872">argv</span>&nbsp;<span class="op" id="2528877">[</span><span class="op" id="2528878">]</span><span class="builtintype" id="2528879">string</span><span class="op" id="2528885">,</span>&nbsp;<span class="ident" id="2528887">attr</span>&nbsp;<span class="op" id="2528892">*</span><span class="ident" id="2528893">ProcAttr</span><span class="op" id="2528901">)</span>&nbsp;<span class="op" id="2528903">(</span><span class="ident" id="2528904">pid</span>&nbsp;<span class="builtintype" id="2528908">int</span><span class="op" id="2528911">,</span>&nbsp;<span class="ident" id="2528913">err</span>&nbsp;<span class="builtintype" id="2528917">error</span><span class="op" id="2528922">)</span>&nbsp;<span class="op" id="2528924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2528927">var</span>&nbsp;<span class="ident" id="2528931">p</span>&nbsp;<span class="op" id="2528933">[</span><span class="num" id="2528934">2</span><span class="op" id="2528935">]</span><span class="builtintype" id="2528936">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2528941">var</span>&nbsp;<span class="ident" id="2528945">n</span>&nbsp;<span class="builtintype" id="2528947">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2528952">var</span>&nbsp;<span class="ident" id="2528956">err1</span>&nbsp;<span class="ident" id="2528961">Errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2528968">var</span>&nbsp;<span class="ident" id="2528972">wstatus</span>&nbsp;<span class="ident" id="2528980">WaitStatus</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2528993">if</span>&nbsp;<span class="ident" id="2528996">attr</span>&nbsp;<span class="op" id="2529001">==</span>&nbsp;<span class="builtintype" id="2529004">nil</span>&nbsp;<span class="op" id="2529008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2529012">attr</span>&nbsp;<span class="op" id="2529017">=</span>&nbsp;<span class="op" id="2529019">&amp;</span><span class="ident" id="2529020">zeroProcAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2529034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2529037">sys</span>&nbsp;<span class="op" id="2529041">:=</span>&nbsp;<span class="ident" id="2529044">attr</span><span class="op" id="2529048">.</span><span class="ident" id="2529049">Sys</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529054">if</span>&nbsp;<span class="ident" id="2529057">sys</span>&nbsp;<span class="op" id="2529061">==</span>&nbsp;<span class="builtintype" id="2529064">nil</span>&nbsp;<span class="op" id="2529068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2529072">sys</span>&nbsp;<span class="op" id="2529076">=</span>&nbsp;<span class="op" id="2529078">&amp;</span><span class="ident" id="2529079">zeroSysProcAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2529096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2529100">p</span><span class="op" id="2529101">[</span><span class="num" id="2529102">0</span><span class="op" id="2529103">]</span>&nbsp;<span class="op" id="2529105">=</span>&nbsp;<span class="op" id="2529107">-</span><span class="num" id="2529108">1</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2529111">p</span><span class="op" id="2529112">[</span><span class="num" id="2529113">1</span><span class="op" id="2529114">]</span>&nbsp;<span class="op" id="2529116">=</span>&nbsp;<span class="op" id="2529118">-</span><span class="num" id="2529119">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2529123">//&nbsp;Convert&nbsp;args&nbsp;to&nbsp;C&nbsp;form.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2529151">argv0p</span><span class="op" id="2529157">,</span>&nbsp;<span class="ident" id="2529159">err</span>&nbsp;<span class="op" id="2529163">:=</span>&nbsp;<span class="ident" id="2529166">BytePtrFromString</span><span class="op" id="2529183">(</span><span class="ident" id="2529184">argv0</span><span class="op" id="2529189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529192">if</span>&nbsp;<span class="ident" id="2529195">err</span>&nbsp;<span class="op" id="2529199">!=</span>&nbsp;<span class="builtintype" id="2529202">nil</span>&nbsp;<span class="op" id="2529206">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529210">return</span>&nbsp;<span class="num" id="2529217">0</span><span class="op" id="2529218">,</span>&nbsp;<span class="ident" id="2529220">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2529225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2529228">argvp</span><span class="op" id="2529233">,</span>&nbsp;<span class="ident" id="2529235">err</span>&nbsp;<span class="op" id="2529239">:=</span>&nbsp;<span class="ident" id="2529242">SlicePtrFromStrings</span><span class="op" id="2529261">(</span><span class="ident" id="2529262">argv</span><span class="op" id="2529266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529269">if</span>&nbsp;<span class="ident" id="2529272">err</span>&nbsp;<span class="op" id="2529276">!=</span>&nbsp;<span class="builtintype" id="2529279">nil</span>&nbsp;<span class="op" id="2529283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529287">return</span>&nbsp;<span class="num" id="2529294">0</span><span class="op" id="2529295">,</span>&nbsp;<span class="ident" id="2529297">err</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2529302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2529305">envvp</span><span class="op" id="2529310">,</span>&nbsp;<span class="ident" id="2529312">err</span>&nbsp;<span class="op" id="2529316">:=</span>&nbsp;<span class="ident" id="2529319">SlicePtrFromStrings</span><span class="op" id="2529338">(</span><span class="ident" id="2529339">attr</span><span class="op" id="2529343">.</span><span class="ident" id="2529344">Env</span><span class="op" id="2529347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529350">if</span>&nbsp;<span class="ident" id="2529353">err</span>&nbsp;<span class="op" id="2529357">!=</span>&nbsp;<span class="builtintype" id="2529360">nil</span>&nbsp;<span class="op" id="2529364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529368">return</span>&nbsp;<span class="num" id="2529375">0</span><span class="op" id="2529376">,</span>&nbsp;<span class="ident" id="2529378">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2529383">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529387">if</span>&nbsp;<span class="op" id="2529390">(</span><span class="ident" id="2529391">runtime</span><span class="op" id="2529398">.</span><span class="ident" id="2529399">GOOS</span>&nbsp;<span class="op" id="2529404">==</span>&nbsp;<span class="string" id="2529407">&#34;freebsd&#34;</span>&nbsp;<span class="op" id="2529417">||</span>&nbsp;<span class="ident" id="2529420">runtime</span><span class="op" id="2529427">.</span><span class="ident" id="2529428">GOOS</span>&nbsp;<span class="op" id="2529433">==</span>&nbsp;<span class="string" id="2529436">&#34;dragonfly&#34;</span><span class="op" id="2529447">)</span>&nbsp;<span class="op" id="2529449">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2529452">len</span><span class="op" id="2529455">(</span><span class="ident" id="2529456">argv</span><span class="op" id="2529460">[</span><span class="num" id="2529461">0</span><span class="op" id="2529462">]</span><span class="op" id="2529463">)</span>&nbsp;<span class="op" id="2529465">&gt;</span>&nbsp;<span class="builtinfunc" id="2529467">len</span><span class="op" id="2529470">(</span><span class="ident" id="2529471">argv0</span><span class="op" id="2529476">)</span>&nbsp;<span class="op" id="2529478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2529482">argvp</span><span class="op" id="2529487">[</span><span class="num" id="2529488">0</span><span class="op" id="2529489">]</span>&nbsp;<span class="op" id="2529491">=</span>&nbsp;<span class="ident" id="2529493">argv0p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2529501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529505">var</span>&nbsp;<span class="ident" id="2529509">chroot</span>&nbsp;<span class="op" id="2529516">*</span><span class="builtintype" id="2529517">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529523">if</span>&nbsp;<span class="ident" id="2529526">sys</span><span class="op" id="2529529">.</span><span class="ident" id="2529530">Chroot</span>&nbsp;<span class="op" id="2529537">!=</span>&nbsp;<span class="string" id="2529540">&#34;&#34;</span>&nbsp;<span class="op" id="2529543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2529547">chroot</span><span class="op" id="2529553">,</span>&nbsp;<span class="ident" id="2529555">err</span>&nbsp;<span class="op" id="2529559">=</span>&nbsp;<span class="ident" id="2529561">BytePtrFromString</span><span class="op" id="2529578">(</span><span class="ident" id="2529579">sys</span><span class="op" id="2529582">.</span><span class="ident" id="2529583">Chroot</span><span class="op" id="2529589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529593">if</span>&nbsp;<span class="ident" id="2529596">err</span>&nbsp;<span class="op" id="2529600">!=</span>&nbsp;<span class="builtintype" id="2529603">nil</span>&nbsp;<span class="op" id="2529607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529612">return</span>&nbsp;<span class="num" id="2529619">0</span><span class="op" id="2529620">,</span>&nbsp;<span class="ident" id="2529622">err</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2529628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2529631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529634">var</span>&nbsp;<span class="ident" id="2529638">dir</span>&nbsp;<span class="op" id="2529642">*</span><span class="builtintype" id="2529643">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529649">if</span>&nbsp;<span class="ident" id="2529652">attr</span><span class="op" id="2529656">.</span><span class="ident" id="2529657">Dir</span>&nbsp;<span class="op" id="2529661">!=</span>&nbsp;<span class="string" id="2529664">&#34;&#34;</span>&nbsp;<span class="op" id="2529667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2529671">dir</span><span class="op" id="2529674">,</span>&nbsp;<span class="ident" id="2529676">err</span>&nbsp;<span class="op" id="2529680">=</span>&nbsp;<span class="ident" id="2529682">BytePtrFromString</span><span class="op" id="2529699">(</span><span class="ident" id="2529700">attr</span><span class="op" id="2529704">.</span><span class="ident" id="2529705">Dir</span><span class="op" id="2529708">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529712">if</span>&nbsp;<span class="ident" id="2529715">err</span>&nbsp;<span class="op" id="2529719">!=</span>&nbsp;<span class="builtintype" id="2529722">nil</span>&nbsp;<span class="op" id="2529726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529731">return</span>&nbsp;<span class="num" id="2529738">0</span><span class="op" id="2529739">,</span>&nbsp;<span class="ident" id="2529741">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2529747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2529750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2529754">//&nbsp;Acquire&nbsp;the&nbsp;fork&nbsp;lock&nbsp;so&nbsp;that&nbsp;no&nbsp;other&nbsp;threads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2529805">//&nbsp;create&nbsp;new&nbsp;fds&nbsp;that&nbsp;are&nbsp;not&nbsp;yet&nbsp;close-on-exec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2529855">//&nbsp;before&nbsp;we&nbsp;fork.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2529875">ForkLock</span><span class="op" id="2529883">.</span><span class="ident" id="2529884">Lock</span><span class="op" id="2529888">(</span><span class="op" id="2529889">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2529893">//&nbsp;Allocate&nbsp;child&nbsp;status&nbsp;pipe&nbsp;close&nbsp;on&nbsp;exec.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529939">if</span>&nbsp;<span class="ident" id="2529942">err</span>&nbsp;<span class="op" id="2529946">=</span>&nbsp;<span class="ident" id="2529948">forkExecPipe</span><span class="op" id="2529960">(</span><span class="ident" id="2529961">p</span><span class="op" id="2529962">[</span><span class="op" id="2529963">:</span><span class="op" id="2529964">]</span><span class="op" id="2529965">)</span><span class="op" id="2529966">;</span>&nbsp;<span class="ident" id="2529968">err</span>&nbsp;<span class="op" id="2529972">!=</span>&nbsp;<span class="builtintype" id="2529975">nil</span>&nbsp;<span class="op" id="2529979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2529983">goto</span>&nbsp;<span class="builtintype" id="2529988">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2529995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2529999">//&nbsp;Kick&nbsp;off&nbsp;child.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2530019">pid</span><span class="op" id="2530022">,</span>&nbsp;<span class="ident" id="2530024">err1</span>&nbsp;<span class="op" id="2530029">=</span>&nbsp;<span class="ident" id="2530031">forkAndExecInChild</span><span class="op" id="2530049">(</span><span class="ident" id="2530050">argv0p</span><span class="op" id="2530056">,</span>&nbsp;<span class="ident" id="2530058">argvp</span><span class="op" id="2530063">,</span>&nbsp;<span class="ident" id="2530065">envvp</span><span class="op" id="2530070">,</span>&nbsp;<span class="ident" id="2530072">chroot</span><span class="op" id="2530078">,</span>&nbsp;<span class="ident" id="2530080">dir</span><span class="op" id="2530083">,</span>&nbsp;<span class="ident" id="2530085">attr</span><span class="op" id="2530089">,</span>&nbsp;<span class="ident" id="2530091">sys</span><span class="op" id="2530094">,</span>&nbsp;<span class="ident" id="2530096">p</span><span class="op" id="2530097">[</span><span class="num" id="2530098">1</span><span class="op" id="2530099">]</span><span class="op" id="2530100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2530103">if</span>&nbsp;<span class="ident" id="2530106">err1</span>&nbsp;<span class="op" id="2530111">!=</span>&nbsp;<span class="num" id="2530114">0</span>&nbsp;<span class="op" id="2530116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2530120">err</span>&nbsp;<span class="op" id="2530124">=</span>&nbsp;<span class="ident" id="2530126">Errno</span><span class="op" id="2530131">(</span><span class="ident" id="2530132">err1</span><span class="op" id="2530136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2530140">goto</span>&nbsp;<span class="builtintype" id="2530145">error</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2530152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2530155">ForkLock</span><span class="op" id="2530163">.</span><span class="ident" id="2530164">Unlock</span><span class="op" id="2530170">(</span><span class="op" id="2530171">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2530175">//&nbsp;Read&nbsp;child&nbsp;error&nbsp;status&nbsp;from&nbsp;pipe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2530214">Close</span><span class="op" id="2530219">(</span><span class="ident" id="2530220">p</span><span class="op" id="2530221">[</span><span class="num" id="2530222">1</span><span class="op" id="2530223">]</span><span class="op" id="2530224">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2530227">n</span><span class="op" id="2530228">,</span>&nbsp;<span class="ident" id="2530230">err</span>&nbsp;<span class="op" id="2530234">=</span>&nbsp;<span class="ident" id="2530236">readlen</span><span class="op" id="2530243">(</span><span class="ident" id="2530244">p</span><span class="op" id="2530245">[</span><span class="num" id="2530246">0</span><span class="op" id="2530247">]</span><span class="op" id="2530248">,</span>&nbsp;<span class="op" id="2530250">(</span><span class="op" id="2530251">*</span><span class="builtintype" id="2530252">byte</span><span class="op" id="2530256">)</span><span class="op" id="2530257">(</span><span class="ident" id="2530258">unsafe</span><span class="op" id="2530264">.</span><span class="ident" id="2530265">Pointer</span><span class="op" id="2530272">(</span><span class="op" id="2530273">&amp;</span><span class="ident" id="2530274">err1</span><span class="op" id="2530278">)</span><span class="op" id="2530279">)</span><span class="op" id="2530280">,</span>&nbsp;<span class="builtintype" id="2530282">int</span><span class="op" id="2530285">(</span><span class="ident" id="2530286">unsafe</span><span class="op" id="2530292">.</span><span class="ident" id="2530293">Sizeof</span><span class="op" id="2530299">(</span><span class="ident" id="2530300">err1</span><span class="op" id="2530304">)</span><span class="op" id="2530305">)</span><span class="op" id="2530306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2530309">Close</span><span class="op" id="2530314">(</span><span class="ident" id="2530315">p</span><span class="op" id="2530316">[</span><span class="num" id="2530317">0</span><span class="op" id="2530318">]</span><span class="op" id="2530319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2530322">if</span>&nbsp;<span class="ident" id="2530325">err</span>&nbsp;<span class="op" id="2530329">!=</span>&nbsp;<span class="builtintype" id="2530332">nil</span>&nbsp;<span class="op" id="2530336">||</span>&nbsp;<span class="ident" id="2530339">n</span>&nbsp;<span class="op" id="2530341">!=</span>&nbsp;<span class="num" id="2530344">0</span>&nbsp;<span class="op" id="2530346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2530350">if</span>&nbsp;<span class="ident" id="2530353">n</span>&nbsp;<span class="op" id="2530355">==</span>&nbsp;<span class="builtintype" id="2530358">int</span><span class="op" id="2530361">(</span><span class="ident" id="2530362">unsafe</span><span class="op" id="2530368">.</span><span class="ident" id="2530369">Sizeof</span><span class="op" id="2530375">(</span><span class="ident" id="2530376">err1</span><span class="op" id="2530380">)</span><span class="op" id="2530381">)</span>&nbsp;<span class="op" id="2530383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2530388">err</span>&nbsp;<span class="op" id="2530392">=</span>&nbsp;<span class="ident" id="2530394">Errno</span><span class="op" id="2530399">(</span><span class="ident" id="2530400">err1</span><span class="op" id="2530404">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2530408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2530412">if</span>&nbsp;<span class="ident" id="2530415">err</span>&nbsp;<span class="op" id="2530419">==</span>&nbsp;<span class="builtintype" id="2530422">nil</span>&nbsp;<span class="op" id="2530426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2530431">err</span>&nbsp;<span class="op" id="2530435">=</span>&nbsp;<span class="ident" id="2530437">EPIPE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2530445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2530450">//&nbsp;Child&nbsp;failed;&nbsp;wait&nbsp;for&nbsp;it&nbsp;to&nbsp;exit,&nbsp;to&nbsp;make&nbsp;sure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2530503">//&nbsp;the&nbsp;zombies&nbsp;don&#39;t&nbsp;accumulate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2530538">_</span><span class="op" id="2530539">,</span>&nbsp;<span class="ident" id="2530541">err1</span>&nbsp;<span class="op" id="2530546">:=</span>&nbsp;<span class="ident" id="2530549">Wait4</span><span class="op" id="2530554">(</span><span class="ident" id="2530555">pid</span><span class="op" id="2530558">,</span>&nbsp;<span class="op" id="2530560">&amp;</span><span class="ident" id="2530561">wstatus</span><span class="op" id="2530568">,</span>&nbsp;<span class="num" id="2530570">0</span><span class="op" id="2530571">,</span>&nbsp;<span class="builtintype" id="2530573">nil</span><span class="op" id="2530576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2530580">for</span>&nbsp;<span class="ident" id="2530584">err1</span>&nbsp;<span class="op" id="2530589">==</span>&nbsp;<span class="ident" id="2530592">EINTR</span>&nbsp;<span class="op" id="2530598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2530603">_</span><span class="op" id="2530604">,</span>&nbsp;<span class="ident" id="2530606">err1</span>&nbsp;<span class="op" id="2530611">=</span>&nbsp;<span class="ident" id="2530613">Wait4</span><span class="op" id="2530618">(</span><span class="ident" id="2530619">pid</span><span class="op" id="2530622">,</span>&nbsp;<span class="op" id="2530624">&amp;</span><span class="ident" id="2530625">wstatus</span><span class="op" id="2530632">,</span>&nbsp;<span class="num" id="2530634">0</span><span class="op" id="2530635">,</span>&nbsp;<span class="builtintype" id="2530637">nil</span><span class="op" id="2530640">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2530644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2530648">return</span>&nbsp;<span class="num" id="2530655">0</span><span class="op" id="2530656">,</span>&nbsp;<span class="ident" id="2530658">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2530663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2530667">//&nbsp;Read&nbsp;got&nbsp;EOF,&nbsp;so&nbsp;pipe&nbsp;closed&nbsp;on&nbsp;exec,&nbsp;so&nbsp;exec&nbsp;succeeded.</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2530728">return</span>&nbsp;<span class="ident" id="2530735">pid</span><span class="op" id="2530738">,</span>&nbsp;<span class="builtintype" id="2530740">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="builtintype" id="2530745">error</span><span class="op" id="2530750">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2530753">if</span>&nbsp;<span class="ident" id="2530756">p</span><span class="op" id="2530757">[</span><span class="num" id="2530758">0</span><span class="op" id="2530759">]</span>&nbsp;<span class="op" id="2530761">&gt;=</span>&nbsp;<span class="num" id="2530764">0</span>&nbsp;<span class="op" id="2530766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2530770">Close</span><span class="op" id="2530775">(</span><span class="ident" id="2530776">p</span><span class="op" id="2530777">[</span><span class="num" id="2530778">0</span><span class="op" id="2530779">]</span><span class="op" id="2530780">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2530784">Close</span><span class="op" id="2530789">(</span><span class="ident" id="2530790">p</span><span class="op" id="2530791">[</span><span class="num" id="2530792">1</span><span class="op" id="2530793">]</span><span class="op" id="2530794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2530797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2530800">ForkLock</span><span class="op" id="2530808">.</span><span class="ident" id="2530809">Unlock</span><span class="op" id="2530815">(</span><span class="op" id="2530816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2530819">return</span>&nbsp;<span class="num" id="2530826">0</span><span class="op" id="2530827">,</span>&nbsp;<span class="ident" id="2530829">err</span><br>
<span class="lineno"></span><span class="op" id="2530833">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="2530836">//&nbsp;Combination&nbsp;of&nbsp;fork&nbsp;and&nbsp;exec,&nbsp;careful&nbsp;to&nbsp;be&nbsp;thread&nbsp;safe.</span><br>
<span class="lineno"></span><span class="keyword" id="2530896">func</span>&nbsp;<span class="ident" id="2530901">ForkExec</span><span class="op" id="2530909">(</span><span class="ident" id="2530910">argv0</span>&nbsp;<span class="builtintype" id="2530916">string</span><span class="op" id="2530922">,</span>&nbsp;<span class="ident" id="2530924">argv</span>&nbsp;<span class="op" id="2530929">[</span><span class="op" id="2530930">]</span><span class="builtintype" id="2530931">string</span><span class="op" id="2530937">,</span>&nbsp;<span class="ident" id="2530939">attr</span>&nbsp;<span class="op" id="2530944">*</span><span class="ident" id="2530945">ProcAttr</span><span class="op" id="2530953">)</span>&nbsp;<span class="op" id="2530955">(</span><span class="ident" id="2530956">pid</span>&nbsp;<span class="builtintype" id="2530960">int</span><span class="op" id="2530963">,</span>&nbsp;<span class="ident" id="2530965">err</span>&nbsp;<span class="builtintype" id="2530969">error</span><span class="op" id="2530974">)</span>&nbsp;<span class="op" id="2530976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2530979">return</span>&nbsp;<span class="ident" id="2530986">forkExec</span><span class="op" id="2530994">(</span><span class="ident" id="2530995">argv0</span><span class="op" id="2531000">,</span>&nbsp;<span class="ident" id="2531002">argv</span><span class="op" id="2531006">,</span>&nbsp;<span class="ident" id="2531008">attr</span><span class="op" id="2531012">)</span><br>
<span class="lineno"></span><span class="op" id="2531014">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="2531017">//&nbsp;StartProcess&nbsp;wraps&nbsp;ForkExec&nbsp;for&nbsp;package&nbsp;os.</span><br>
<span class="lineno"></span><span class="keyword" id="2531064">func</span>&nbsp;<span class="ident" id="2531069">StartProcess</span><span class="op" id="2531081">(</span><span class="ident" id="2531082">argv0</span>&nbsp;<span class="builtintype" id="2531088">string</span><span class="op" id="2531094">,</span>&nbsp;<span class="ident" id="2531096">argv</span>&nbsp;<span class="op" id="2531101">[</span><span class="op" id="2531102">]</span><span class="builtintype" id="2531103">string</span><span class="op" id="2531109">,</span>&nbsp;<span class="ident" id="2531111">attr</span>&nbsp;<span class="op" id="2531116">*</span><span class="ident" id="2531117">ProcAttr</span><span class="op" id="2531125">)</span>&nbsp;<span class="op" id="2531127">(</span><span class="ident" id="2531128">pid</span>&nbsp;<span class="builtintype" id="2531132">int</span><span class="op" id="2531135">,</span>&nbsp;<span class="ident" id="2531137">handle</span>&nbsp;<span class="builtintype" id="2531144">uintptr</span><span class="op" id="2531151">,</span>&nbsp;<span class="ident" id="2531153">err</span>&nbsp;<span class="builtintype" id="2531157">error</span><span class="op" id="2531162">)</span>&nbsp;<span class="op" id="2531164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2531167">pid</span><span class="op" id="2531170">,</span>&nbsp;<span class="ident" id="2531172">err</span>&nbsp;<span class="op" id="2531176">=</span>&nbsp;<span class="ident" id="2531178">forkExec</span><span class="op" id="2531186">(</span><span class="ident" id="2531187">argv0</span><span class="op" id="2531192">,</span>&nbsp;<span class="ident" id="2531194">argv</span><span class="op" id="2531198">,</span>&nbsp;<span class="ident" id="2531200">attr</span><span class="op" id="2531204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2531207">return</span>&nbsp;<span class="ident" id="2531214">pid</span><span class="op" id="2531217">,</span>&nbsp;<span class="num" id="2531219">0</span><span class="op" id="2531220">,</span>&nbsp;<span class="ident" id="2531222">err</span><br>
<span class="lineno">240</span><span class="op" id="2531226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2531229">//&nbsp;Ordinary&nbsp;exec.</span><br>
<span class="lineno"></span><span class="keyword" id="2531247">func</span>&nbsp;<span class="ident" id="2531252">Exec</span><span class="op" id="2531256">(</span><span class="ident" id="2531257">argv0</span>&nbsp;<span class="builtintype" id="2531263">string</span><span class="op" id="2531269">,</span>&nbsp;<span class="ident" id="2531271">argv</span>&nbsp;<span class="op" id="2531276">[</span><span class="op" id="2531277">]</span><span class="builtintype" id="2531278">string</span><span class="op" id="2531284">,</span>&nbsp;<span class="ident" id="2531286">envv</span>&nbsp;<span class="op" id="2531291">[</span><span class="op" id="2531292">]</span><span class="builtintype" id="2531293">string</span><span class="op" id="2531299">)</span>&nbsp;<span class="op" id="2531301">(</span><span class="ident" id="2531302">err</span>&nbsp;<span class="builtintype" id="2531306">error</span><span class="op" id="2531311">)</span>&nbsp;<span class="op" id="2531313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2531316">argv0p</span><span class="op" id="2531322">,</span>&nbsp;<span class="ident" id="2531324">err</span>&nbsp;<span class="op" id="2531328">:=</span>&nbsp;<span class="ident" id="2531331">BytePtrFromString</span><span class="op" id="2531348">(</span><span class="ident" id="2531349">argv0</span><span class="op" id="2531354">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2531357">if</span>&nbsp;<span class="ident" id="2531360">err</span>&nbsp;<span class="op" id="2531364">!=</span>&nbsp;<span class="builtintype" id="2531367">nil</span>&nbsp;<span class="op" id="2531371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2531375">return</span>&nbsp;<span class="ident" id="2531382">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2531387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2531390">argvp</span><span class="op" id="2531395">,</span>&nbsp;<span class="ident" id="2531397">err</span>&nbsp;<span class="op" id="2531401">:=</span>&nbsp;<span class="ident" id="2531404">SlicePtrFromStrings</span><span class="op" id="2531423">(</span><span class="ident" id="2531424">argv</span><span class="op" id="2531428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2531431">if</span>&nbsp;<span class="ident" id="2531434">err</span>&nbsp;<span class="op" id="2531438">!=</span>&nbsp;<span class="builtintype" id="2531441">nil</span>&nbsp;<span class="op" id="2531445">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2531449">return</span>&nbsp;<span class="ident" id="2531456">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2531461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2531464">envvp</span><span class="op" id="2531469">,</span>&nbsp;<span class="ident" id="2531471">err</span>&nbsp;<span class="op" id="2531475">:=</span>&nbsp;<span class="ident" id="2531478">SlicePtrFromStrings</span><span class="op" id="2531497">(</span><span class="ident" id="2531498">envv</span><span class="op" id="2531502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2531505">if</span>&nbsp;<span class="ident" id="2531508">err</span>&nbsp;<span class="op" id="2531512">!=</span>&nbsp;<span class="builtintype" id="2531515">nil</span>&nbsp;<span class="op" id="2531519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2531523">return</span>&nbsp;<span class="ident" id="2531530">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2531535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2531538">_</span><span class="op" id="2531539">,</span>&nbsp;<span class="ident" id="2531541">_</span><span class="op" id="2531542">,</span>&nbsp;<span class="ident" id="2531544">err1</span>&nbsp;<span class="op" id="2531549">:=</span>&nbsp;<span class="ident" id="2531552">RawSyscall</span><span class="op" id="2531562">(</span><span class="ident" id="2531563">SYS_EXECVE</span><span class="op" id="2531573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2531577">uintptr</span><span class="op" id="2531584">(</span><span class="ident" id="2531585">unsafe</span><span class="op" id="2531591">.</span><span class="ident" id="2531592">Pointer</span><span class="op" id="2531599">(</span><span class="ident" id="2531600">argv0p</span><span class="op" id="2531606">)</span><span class="op" id="2531607">)</span><span class="op" id="2531608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2531612">uintptr</span><span class="op" id="2531619">(</span><span class="ident" id="2531620">unsafe</span><span class="op" id="2531626">.</span><span class="ident" id="2531627">Pointer</span><span class="op" id="2531634">(</span><span class="op" id="2531635">&amp;</span><span class="ident" id="2531636">argvp</span><span class="op" id="2531641">[</span><span class="num" id="2531642">0</span><span class="op" id="2531643">]</span><span class="op" id="2531644">)</span><span class="op" id="2531645">)</span><span class="op" id="2531646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2531650">uintptr</span><span class="op" id="2531657">(</span><span class="ident" id="2531658">unsafe</span><span class="op" id="2531664">.</span><span class="ident" id="2531665">Pointer</span><span class="op" id="2531672">(</span><span class="op" id="2531673">&amp;</span><span class="ident" id="2531674">envvp</span><span class="op" id="2531679">[</span><span class="num" id="2531680">0</span><span class="op" id="2531681">]</span><span class="op" id="2531682">)</span><span class="op" id="2531683">)</span><span class="op" id="2531684">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2531687">return</span>&nbsp;<span class="ident" id="2531694">Errno</span><span class="op" id="2531699">(</span><span class="ident" id="2531700">err1</span><span class="op" id="2531704">)</span><br>
<span class="lineno"></span><span class="op" id="2531706">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
