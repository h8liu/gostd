<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7904806">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7904861">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7904915">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7904966">package</span>&nbsp;<span class="ident" id="7904974">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7904979">import</span>&nbsp;<span class="op" id="7904986">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7904989">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7904998">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7905014">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7905028">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7905043">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7905059">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7905066">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7905072">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7905079">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7905085">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7905096">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7905113">&#34;strconv&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7905124">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7905135">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7905142">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7905145">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno">25</span><span class="comment" id="7905220">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7905236">//&nbsp;blockingSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;blocks&nbsp;a&nbsp;Read&nbsp;call&nbsp;until&nbsp;it&#39;s&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="7905313">type</span>&nbsp;<span class="ident" id="7905318">blockingSource</span>&nbsp;<span class="keyword" id="7905333">chan</span>&nbsp;<span class="builtintype" id="7905338">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7905344">func</span>&nbsp;<span class="op" id="7905349">(</span><span class="ident" id="7905350">b</span>&nbsp;<span class="ident" id="7905352">blockingSource</span><span class="op" id="7905366">)</span>&nbsp;<span class="ident" id="7905368">Read</span><span class="op" id="7905372">(</span><span class="op" id="7905373">[</span><span class="op" id="7905374">]</span><span class="builtintype" id="7905375">byte</span><span class="op" id="7905379">)</span>&nbsp;<span class="op" id="7905381">(</span><span class="ident" id="7905382">n</span>&nbsp;<span class="builtintype" id="7905384">int</span><span class="op" id="7905387">,</span>&nbsp;<span class="ident" id="7905389">err</span>&nbsp;<span class="builtintype" id="7905393">error</span><span class="op" id="7905398">)</span>&nbsp;<span class="op" id="7905400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7905403">&lt;-</span><span class="ident" id="7905405">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7905408">return</span>&nbsp;<span class="num" id="7905415">0</span><span class="op" id="7905416">,</span>&nbsp;<span class="ident" id="7905418">io</span><span class="op" id="7905420">.</span><span class="ident" id="7905421">EOF</span><br>
<span class="lineno"></span><span class="op" id="7905425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="7905428">//&nbsp;clientTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;client&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7905508">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="7905527">type</span>&nbsp;<span class="ident" id="7905532">clientTest</span>&nbsp;<span class="keyword" id="7905543">struct</span>&nbsp;<span class="op" id="7905550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7905553">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7905626">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905667">name</span>&nbsp;<span class="builtintype" id="7905672">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7905680">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7905746">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905791">command</span>&nbsp;<span class="op" id="7905799">[</span><span class="op" id="7905800">]</span><span class="builtintype" id="7905801">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7905809">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905880">config</span>&nbsp;<span class="op" id="7905887">*</span><span class="ident" id="7905888">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7905896">//&nbsp;cert,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;DER-encoded&nbsp;certificate&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7905963">//&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7905985">cert</span>&nbsp;<span class="op" id="7905990">[</span><span class="op" id="7905991">]</span><span class="builtintype" id="7905992">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7905998">//&nbsp;key,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;either&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7906056">//&nbsp;*ecdsa.PrivateKey&nbsp;which&nbsp;is&nbsp;the&nbsp;private&nbsp;key&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906129">key</span>&nbsp;<span class="keyword" id="7906133">interface</span><span class="op" id="7906142">{</span><span class="op" id="7906143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7906146">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7906215">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;a&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7906285">//&nbsp;error&nbsp;if&nbsp;the&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906335">validate</span>&nbsp;<span class="keyword" id="7906344">func</span><span class="op" id="7906348">(</span><span class="ident" id="7906349">ConnectionState</span><span class="op" id="7906364">)</span>&nbsp;<span class="builtintype" id="7906366">error</span><br>
<span class="lineno"></span><span class="op" id="7906372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7906375">var</span>&nbsp;<span class="ident" id="7906379">defaultServerCommand</span>&nbsp;<span class="op" id="7906400">=</span>&nbsp;<span class="op" id="7906402">[</span><span class="op" id="7906403">]</span><span class="builtintype" id="7906404">string</span><span class="op" id="7906410">{</span><span class="string" id="7906411">&#34;openssl&#34;</span><span class="op" id="7906420">,</span>&nbsp;<span class="string" id="7906422">&#34;s_server&#34;</span><span class="op" id="7906432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="7906435">//&nbsp;connFromCommand&nbsp;starts&nbsp;the&nbsp;reference&nbsp;server&nbsp;process,&nbsp;connects&nbsp;to&nbsp;it&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="7906510">//&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;for&nbsp;the&nbsp;connection.&nbsp;The&nbsp;stdin&nbsp;return&nbsp;value&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="7906585">//&nbsp;blockingSource&nbsp;for&nbsp;the&nbsp;stdin&nbsp;of&nbsp;the&nbsp;child&nbsp;process.&nbsp;It&nbsp;must&nbsp;be&nbsp;closed&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="7906664">//&nbsp;Waiting&nbsp;for&nbsp;child.</span><br>
<span class="lineno"></span><span class="keyword" id="7906686">func</span>&nbsp;<span class="op" id="7906691">(</span><span class="ident" id="7906692">test</span>&nbsp;<span class="op" id="7906697">*</span><span class="ident" id="7906698">clientTest</span><span class="op" id="7906708">)</span>&nbsp;<span class="ident" id="7906710">connFromCommand</span><span class="op" id="7906725">(</span><span class="op" id="7906726">)</span>&nbsp;<span class="op" id="7906728">(</span><span class="ident" id="7906729">conn</span>&nbsp;<span class="op" id="7906734">*</span><span class="ident" id="7906735">recordingConn</span><span class="op" id="7906748">,</span>&nbsp;<span class="ident" id="7906750">child</span>&nbsp;<span class="op" id="7906756">*</span><span class="ident" id="7906757">exec</span><span class="op" id="7906761">.</span><span class="ident" id="7906762">Cmd</span><span class="op" id="7906765">,</span>&nbsp;<span class="ident" id="7906767">stdin</span>&nbsp;<span class="ident" id="7906773">blockingSource</span><span class="op" id="7906787">,</span>&nbsp;<span class="ident" id="7906789">err</span>&nbsp;<span class="builtintype" id="7906793">error</span><span class="op" id="7906798">)</span>&nbsp;<span class="op" id="7906800">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906803">cert</span>&nbsp;<span class="op" id="7906808">:=</span>&nbsp;<span class="ident" id="7906811">testRSACertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906831">if</span>&nbsp;<span class="builtinfunc" id="7906834">len</span><span class="op" id="7906837">(</span><span class="ident" id="7906838">test</span><span class="op" id="7906842">.</span><span class="ident" id="7906843">cert</span><span class="op" id="7906847">)</span>&nbsp;<span class="op" id="7906849">&gt;</span>&nbsp;<span class="num" id="7906851">0</span>&nbsp;<span class="op" id="7906853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906857">cert</span>&nbsp;<span class="op" id="7906862">=</span>&nbsp;<span class="ident" id="7906864">test</span><span class="op" id="7906868">.</span><span class="ident" id="7906869">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7906875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7906878">certPath</span>&nbsp;<span class="op" id="7906887">:=</span>&nbsp;<span class="ident" id="7906890">tempFile</span><span class="op" id="7906898">(</span><span class="builtintype" id="7906899">string</span><span class="op" id="7906905">(</span><span class="ident" id="7906906">cert</span><span class="op" id="7906910">)</span><span class="op" id="7906911">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906914">defer</span>&nbsp;<span class="ident" id="7906920">os</span><span class="op" id="7906922">.</span><span class="ident" id="7906923">Remove</span><span class="op" id="7906929">(</span><span class="ident" id="7906930">certPath</span><span class="op" id="7906938">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906942">var</span>&nbsp;<span class="ident" id="7906946">key</span>&nbsp;<span class="keyword" id="7906950">interface</span><span class="op" id="7906959">{</span><span class="op" id="7906960">}</span>&nbsp;<span class="op" id="7906962">=</span>&nbsp;<span class="ident" id="7906964">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7906983">if</span>&nbsp;<span class="ident" id="7906986">test</span><span class="op" id="7906990">.</span><span class="ident" id="7906991">key</span>&nbsp;<span class="op" id="7906995">!=</span>&nbsp;<span class="ident" id="7906998">nil</span>&nbsp;<span class="op" id="7907002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907006">key</span>&nbsp;<span class="op" id="7907010">=</span>&nbsp;<span class="ident" id="7907012">test</span><span class="op" id="7907016">.</span><span class="ident" id="7907017">key</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907025">var</span>&nbsp;<span class="ident" id="7907029">pemType</span>&nbsp;<span class="builtintype" id="7907037">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907045">var</span>&nbsp;<span class="ident" id="7907049">derBytes</span>&nbsp;<span class="op" id="7907058">[</span><span class="op" id="7907059">]</span><span class="builtintype" id="7907060">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907066">switch</span>&nbsp;<span class="ident" id="7907073">key</span>&nbsp;<span class="op" id="7907077">:=</span>&nbsp;<span class="ident" id="7907080">key</span><span class="op" id="7907083">.</span><span class="op" id="7907084">(</span><span class="keyword" id="7907085">type</span><span class="op" id="7907089">)</span>&nbsp;<span class="op" id="7907091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907094">case</span>&nbsp;<span class="op" id="7907099">*</span><span class="ident" id="7907100">rsa</span><span class="op" id="7907103">.</span><span class="ident" id="7907104">PrivateKey</span><span class="op" id="7907114">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907118">pemType</span>&nbsp;<span class="op" id="7907126">=</span>&nbsp;<span class="string" id="7907128">&#34;RSA&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907136">derBytes</span>&nbsp;<span class="op" id="7907145">=</span>&nbsp;<span class="ident" id="7907147">x509</span><span class="op" id="7907151">.</span><span class="ident" id="7907152">MarshalPKCS1PrivateKey</span><span class="op" id="7907174">(</span><span class="ident" id="7907175">key</span><span class="op" id="7907178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907181">case</span>&nbsp;<span class="op" id="7907186">*</span><span class="ident" id="7907187">ecdsa</span><span class="op" id="7907192">.</span><span class="ident" id="7907193">PrivateKey</span><span class="op" id="7907203">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907207">pemType</span>&nbsp;<span class="op" id="7907215">=</span>&nbsp;<span class="string" id="7907217">&#34;EC&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907224">var</span>&nbsp;<span class="ident" id="7907228">err</span>&nbsp;<span class="builtintype" id="7907232">error</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907240">derBytes</span><span class="op" id="7907248">,</span>&nbsp;<span class="ident" id="7907250">err</span>&nbsp;<span class="op" id="7907254">=</span>&nbsp;<span class="ident" id="7907256">x509</span><span class="op" id="7907260">.</span><span class="ident" id="7907261">MarshalECPrivateKey</span><span class="op" id="7907280">(</span><span class="ident" id="7907281">key</span><span class="op" id="7907284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907288">if</span>&nbsp;<span class="ident" id="7907291">err</span>&nbsp;<span class="op" id="7907295">!=</span>&nbsp;<span class="ident" id="7907298">nil</span>&nbsp;<span class="op" id="7907302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7907307">panic</span><span class="op" id="7907312">(</span><span class="ident" id="7907313">err</span><span class="op" id="7907316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907323">default</span><span class="op" id="7907330">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7907334">panic</span><span class="op" id="7907339">(</span><span class="string" id="7907340">&#34;unknown&nbsp;key&nbsp;type&#34;</span><span class="op" id="7907358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907365">var</span>&nbsp;<span class="ident" id="7907369">pemOut</span>&nbsp;<span class="ident" id="7907376">bytes</span><span class="op" id="7907381">.</span><span class="ident" id="7907382">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907390">pem</span><span class="op" id="7907393">.</span><span class="ident" id="7907394">Encode</span><span class="op" id="7907400">(</span><span class="op" id="7907401">&amp;</span><span class="ident" id="7907402">pemOut</span><span class="op" id="7907408">,</span>&nbsp;<span class="op" id="7907410">&amp;</span><span class="ident" id="7907411">pem</span><span class="op" id="7907414">.</span><span class="ident" id="7907415">Block</span><span class="op" id="7907420">{</span><span class="ident" id="7907421">Type</span><span class="op" id="7907425">:</span>&nbsp;<span class="ident" id="7907427">pemType</span>&nbsp;<span class="op" id="7907435">+</span>&nbsp;<span class="string" id="7907437">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="7907451">,</span>&nbsp;<span class="ident" id="7907453">Bytes</span><span class="op" id="7907458">:</span>&nbsp;<span class="ident" id="7907460">derBytes</span><span class="op" id="7907468">}</span><span class="op" id="7907469">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907473">keyPath</span>&nbsp;<span class="op" id="7907481">:=</span>&nbsp;<span class="ident" id="7907484">tempFile</span><span class="op" id="7907492">(</span><span class="builtintype" id="7907493">string</span><span class="op" id="7907499">(</span><span class="ident" id="7907500">pemOut</span><span class="op" id="7907506">.</span><span class="ident" id="7907507">Bytes</span><span class="op" id="7907512">(</span><span class="op" id="7907513">)</span><span class="op" id="7907514">)</span><span class="op" id="7907515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907518">defer</span>&nbsp;<span class="ident" id="7907524">os</span><span class="op" id="7907526">.</span><span class="ident" id="7907527">Remove</span><span class="op" id="7907533">(</span><span class="ident" id="7907534">keyPath</span><span class="op" id="7907541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907545">var</span>&nbsp;<span class="ident" id="7907549">command</span>&nbsp;<span class="op" id="7907557">[</span><span class="op" id="7907558">]</span><span class="builtintype" id="7907559">string</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7907567">if</span>&nbsp;<span class="builtinfunc" id="7907570">len</span><span class="op" id="7907573">(</span><span class="ident" id="7907574">test</span><span class="op" id="7907578">.</span><span class="ident" id="7907579">command</span><span class="op" id="7907586">)</span>&nbsp;<span class="op" id="7907588">&gt;</span>&nbsp;<span class="num" id="7907590">0</span>&nbsp;<span class="op" id="7907592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907596">command</span>&nbsp;<span class="op" id="7907604">=</span>&nbsp;<span class="builtinfunc" id="7907606">append</span><span class="op" id="7907612">(</span><span class="ident" id="7907613">command</span><span class="op" id="7907620">,</span>&nbsp;<span class="ident" id="7907622">test</span><span class="op" id="7907626">.</span><span class="ident" id="7907627">command</span><span class="op" id="7907634">...</span><span class="op" id="7907637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907640">}</span>&nbsp;<span class="keyword" id="7907642">else</span>&nbsp;<span class="op" id="7907647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907651">command</span>&nbsp;<span class="op" id="7907659">=</span>&nbsp;<span class="builtinfunc" id="7907661">append</span><span class="op" id="7907667">(</span><span class="ident" id="7907668">command</span><span class="op" id="7907675">,</span>&nbsp;<span class="ident" id="7907677">defaultServerCommand</span><span class="op" id="7907697">...</span><span class="op" id="7907700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7907703">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7907706">command</span>&nbsp;<span class="op" id="7907714">=</span>&nbsp;<span class="builtinfunc" id="7907716">append</span><span class="op" id="7907722">(</span><span class="ident" id="7907723">command</span><span class="op" id="7907730">,</span>&nbsp;<span class="string" id="7907732">&#34;-cert&#34;</span><span class="op" id="7907739">,</span>&nbsp;<span class="ident" id="7907741">certPath</span><span class="op" id="7907749">,</span>&nbsp;<span class="string" id="7907751">&#34;-certform&#34;</span><span class="op" id="7907762">,</span>&nbsp;<span class="string" id="7907764">&#34;DER&#34;</span><span class="op" id="7907769">,</span>&nbsp;<span class="string" id="7907771">&#34;-key&#34;</span><span class="op" id="7907777">,</span>&nbsp;<span class="ident" id="7907779">keyPath</span><span class="op" id="7907786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7907789">//&nbsp;serverPort&nbsp;contains&nbsp;the&nbsp;port&nbsp;that&nbsp;OpenSSL&nbsp;will&nbsp;listen&nbsp;on.&nbsp;OpenSSL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7907859">//&nbsp;can&#39;t&nbsp;take&nbsp;&#34;0&#34;&nbsp;as&nbsp;an&nbsp;argument&nbsp;here&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;pick&nbsp;a&nbsp;number&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7907930">//&nbsp;hope&nbsp;that&nbsp;it&#39;s&nbsp;not&nbsp;in&nbsp;use&nbsp;on&nbsp;the&nbsp;machine.&nbsp;Since&nbsp;this&nbsp;only&nbsp;occurs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7907999">//&nbsp;when&nbsp;-update&nbsp;is&nbsp;given&nbsp;and&nbsp;thus&nbsp;when&nbsp;there&#39;s&nbsp;a&nbsp;human&nbsp;watching&nbsp;the</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7908068">//&nbsp;test,&nbsp;this&nbsp;isn&#39;t&nbsp;too&nbsp;bad.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908098">const</span>&nbsp;<span class="ident" id="7908104">serverPort</span>&nbsp;<span class="op" id="7908115">=</span>&nbsp;<span class="num" id="7908117">24323</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908124">command</span>&nbsp;<span class="op" id="7908132">=</span>&nbsp;<span class="builtinfunc" id="7908134">append</span><span class="op" id="7908140">(</span><span class="ident" id="7908141">command</span><span class="op" id="7908148">,</span>&nbsp;<span class="string" id="7908150">&#34;-accept&#34;</span><span class="op" id="7908159">,</span>&nbsp;<span class="ident" id="7908161">strconv</span><span class="op" id="7908168">.</span><span class="ident" id="7908169">Itoa</span><span class="op" id="7908173">(</span><span class="ident" id="7908174">serverPort</span><span class="op" id="7908184">)</span><span class="op" id="7908185">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908189">cmd</span>&nbsp;<span class="op" id="7908193">:=</span>&nbsp;<span class="ident" id="7908196">exec</span><span class="op" id="7908200">.</span><span class="ident" id="7908201">Command</span><span class="op" id="7908208">(</span><span class="ident" id="7908209">command</span><span class="op" id="7908216">[</span><span class="num" id="7908217">0</span><span class="op" id="7908218">]</span><span class="op" id="7908219">,</span>&nbsp;<span class="ident" id="7908221">command</span><span class="op" id="7908228">[</span><span class="num" id="7908229">1</span><span class="op" id="7908230">:</span><span class="op" id="7908231">]</span><span class="op" id="7908232">...</span><span class="op" id="7908235">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908238">stdin</span>&nbsp;<span class="op" id="7908244">=</span>&nbsp;<span class="ident" id="7908246">blockingSource</span><span class="op" id="7908260">(</span><span class="builtinfunc" id="7908261">make</span><span class="op" id="7908265">(</span><span class="keyword" id="7908266">chan</span>&nbsp;<span class="builtintype" id="7908271">bool</span><span class="op" id="7908275">)</span><span class="op" id="7908276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908279">cmd</span><span class="op" id="7908282">.</span><span class="ident" id="7908283">Stdin</span>&nbsp;<span class="op" id="7908289">=</span>&nbsp;<span class="ident" id="7908291">stdin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908298">var</span>&nbsp;<span class="ident" id="7908302">out</span>&nbsp;<span class="ident" id="7908306">bytes</span><span class="op" id="7908311">.</span><span class="ident" id="7908312">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908320">cmd</span><span class="op" id="7908323">.</span><span class="ident" id="7908324">Stdout</span>&nbsp;<span class="op" id="7908331">=</span>&nbsp;<span class="op" id="7908333">&amp;</span><span class="ident" id="7908334">out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908339">cmd</span><span class="op" id="7908342">.</span><span class="ident" id="7908343">Stderr</span>&nbsp;<span class="op" id="7908350">=</span>&nbsp;<span class="op" id="7908352">&amp;</span><span class="ident" id="7908353">out</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908358">if</span>&nbsp;<span class="ident" id="7908361">err</span>&nbsp;<span class="op" id="7908365">:=</span>&nbsp;<span class="ident" id="7908368">cmd</span><span class="op" id="7908371">.</span><span class="ident" id="7908372">Start</span><span class="op" id="7908377">(</span><span class="op" id="7908378">)</span><span class="op" id="7908379">;</span>&nbsp;<span class="ident" id="7908381">err</span>&nbsp;<span class="op" id="7908385">!=</span>&nbsp;<span class="ident" id="7908388">nil</span>&nbsp;<span class="op" id="7908392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908396">return</span>&nbsp;<span class="ident" id="7908403">nil</span><span class="op" id="7908406">,</span>&nbsp;<span class="ident" id="7908408">nil</span><span class="op" id="7908411">,</span>&nbsp;<span class="ident" id="7908413">nil</span><span class="op" id="7908416">,</span>&nbsp;<span class="ident" id="7908418">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7908427">//&nbsp;OpenSSL&nbsp;does&nbsp;print&nbsp;an&nbsp;&#34;ACCEPT&#34;&nbsp;banner,&nbsp;but&nbsp;it&nbsp;does&nbsp;so&nbsp;*before*</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7908494">//&nbsp;opening&nbsp;the&nbsp;listening&nbsp;socket,&nbsp;so&nbsp;we&nbsp;can&#39;t&nbsp;use&nbsp;that&nbsp;to&nbsp;wait&nbsp;until&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7908566">//&nbsp;has&nbsp;started&nbsp;listening.&nbsp;Thus&nbsp;we&nbsp;are&nbsp;forced&nbsp;to&nbsp;poll&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7908635">//&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908651">var</span>&nbsp;<span class="ident" id="7908655">tcpConn</span>&nbsp;<span class="ident" id="7908663">net</span><span class="op" id="7908666">.</span><span class="ident" id="7908667">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908673">for</span>&nbsp;<span class="ident" id="7908677">i</span>&nbsp;<span class="op" id="7908679">:=</span>&nbsp;<span class="builtintype" id="7908682">uint</span><span class="op" id="7908686">(</span><span class="num" id="7908687">0</span><span class="op" id="7908688">)</span><span class="op" id="7908689">;</span>&nbsp;<span class="ident" id="7908691">i</span>&nbsp;<span class="op" id="7908693">&lt;</span>&nbsp;<span class="num" id="7908695">5</span><span class="op" id="7908696">;</span>&nbsp;<span class="ident" id="7908698">i</span><span class="op" id="7908699">++</span>&nbsp;<span class="op" id="7908702">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908706">var</span>&nbsp;<span class="ident" id="7908710">err</span>&nbsp;<span class="builtintype" id="7908714">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908722">tcpConn</span><span class="op" id="7908729">,</span>&nbsp;<span class="ident" id="7908731">err</span>&nbsp;<span class="op" id="7908735">=</span>&nbsp;<span class="ident" id="7908737">net</span><span class="op" id="7908740">.</span><span class="ident" id="7908741">DialTCP</span><span class="op" id="7908748">(</span><span class="string" id="7908749">&#34;tcp&#34;</span><span class="op" id="7908754">,</span>&nbsp;<span class="ident" id="7908756">nil</span><span class="op" id="7908759">,</span>&nbsp;<span class="op" id="7908761">&amp;</span><span class="ident" id="7908762">net</span><span class="op" id="7908765">.</span><span class="ident" id="7908766">TCPAddr</span><span class="op" id="7908773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908778">IP</span><span class="op" id="7908780">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7908784">net</span><span class="op" id="7908787">.</span><span class="ident" id="7908788">IPv4</span><span class="op" id="7908792">(</span><span class="num" id="7908793">127</span><span class="op" id="7908796">,</span>&nbsp;<span class="num" id="7908798">0</span><span class="op" id="7908799">,</span>&nbsp;<span class="num" id="7908801">0</span><span class="op" id="7908802">,</span>&nbsp;<span class="num" id="7908804">1</span><span class="op" id="7908805">)</span><span class="op" id="7908806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908811">Port</span><span class="op" id="7908815">:</span>&nbsp;<span class="ident" id="7908817">serverPort</span><span class="op" id="7908827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908831">}</span><span class="op" id="7908832">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908836">if</span>&nbsp;<span class="ident" id="7908839">err</span>&nbsp;<span class="op" id="7908843">==</span>&nbsp;<span class="ident" id="7908846">nil</span>&nbsp;<span class="op" id="7908850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908855">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908867">time</span><span class="op" id="7908871">.</span><span class="ident" id="7908872">Sleep</span><span class="op" id="7908877">(</span><span class="op" id="7908878">(</span><span class="num" id="7908879">1</span>&nbsp;<span class="op" id="7908881">&lt;&lt;</span>&nbsp;<span class="ident" id="7908884">i</span><span class="op" id="7908885">)</span>&nbsp;<span class="op" id="7908887">*</span>&nbsp;<span class="num" id="7908889">5</span>&nbsp;<span class="op" id="7908891">*</span>&nbsp;<span class="ident" id="7908893">time</span><span class="op" id="7908897">.</span><span class="ident" id="7908898">Millisecond</span><span class="op" id="7908909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7908912">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908915">if</span>&nbsp;<span class="ident" id="7908918">tcpConn</span>&nbsp;<span class="op" id="7908926">==</span>&nbsp;<span class="ident" id="7908929">nil</span>&nbsp;<span class="op" id="7908933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7908937">close</span><span class="op" id="7908942">(</span><span class="ident" id="7908943">stdin</span><span class="op" id="7908948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908952">out</span><span class="op" id="7908955">.</span><span class="ident" id="7908956">WriteTo</span><span class="op" id="7908963">(</span><span class="ident" id="7908964">os</span><span class="op" id="7908966">.</span><span class="ident" id="7908967">Stdout</span><span class="op" id="7908973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7908977">cmd</span><span class="op" id="7908980">.</span><span class="ident" id="7908981">Process</span><span class="op" id="7908988">.</span><span class="ident" id="7908989">Kill</span><span class="op" id="7908993">(</span><span class="op" id="7908994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7908998">return</span>&nbsp;<span class="ident" id="7909005">nil</span><span class="op" id="7909008">,</span>&nbsp;<span class="ident" id="7909010">nil</span><span class="op" id="7909013">,</span>&nbsp;<span class="ident" id="7909015">nil</span><span class="op" id="7909018">,</span>&nbsp;<span class="ident" id="7909020">cmd</span><span class="op" id="7909023">.</span><span class="ident" id="7909024">Wait</span><span class="op" id="7909028">(</span><span class="op" id="7909029">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909036">record</span>&nbsp;<span class="op" id="7909043">:=</span>&nbsp;<span class="op" id="7909046">&amp;</span><span class="ident" id="7909047">recordingConn</span><span class="op" id="7909060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909064">Conn</span><span class="op" id="7909068">:</span>&nbsp;<span class="ident" id="7909070">tcpConn</span><span class="op" id="7909077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909080">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909084">return</span>&nbsp;<span class="ident" id="7909091">record</span><span class="op" id="7909097">,</span>&nbsp;<span class="ident" id="7909099">cmd</span><span class="op" id="7909102">,</span>&nbsp;<span class="ident" id="7909104">stdin</span><span class="op" id="7909109">,</span>&nbsp;<span class="ident" id="7909111">nil</span><br>
<span class="lineno"></span><span class="op" id="7909115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7909118">func</span>&nbsp;<span class="op" id="7909123">(</span><span class="ident" id="7909124">test</span>&nbsp;<span class="op" id="7909129">*</span><span class="ident" id="7909130">clientTest</span><span class="op" id="7909140">)</span>&nbsp;<span class="ident" id="7909142">dataPath</span><span class="op" id="7909150">(</span><span class="op" id="7909151">)</span>&nbsp;<span class="builtintype" id="7909153">string</span>&nbsp;<span class="op" id="7909160">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909163">return</span>&nbsp;<span class="ident" id="7909170">filepath</span><span class="op" id="7909178">.</span><span class="ident" id="7909179">Join</span><span class="op" id="7909183">(</span><span class="string" id="7909184">&#34;testdata&#34;</span><span class="op" id="7909194">,</span>&nbsp;<span class="string" id="7909196">&#34;Client-&#34;</span><span class="op" id="7909205">+</span><span class="ident" id="7909206">test</span><span class="op" id="7909210">.</span><span class="ident" id="7909211">name</span><span class="op" id="7909215">)</span><br>
<span class="lineno"></span><span class="op" id="7909217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7909220">func</span>&nbsp;<span class="op" id="7909225">(</span><span class="ident" id="7909226">test</span>&nbsp;<span class="op" id="7909231">*</span><span class="ident" id="7909232">clientTest</span><span class="op" id="7909242">)</span>&nbsp;<span class="ident" id="7909244">loadData</span><span class="op" id="7909252">(</span><span class="op" id="7909253">)</span>&nbsp;<span class="op" id="7909255">(</span><span class="ident" id="7909256">flows</span>&nbsp;<span class="op" id="7909262">[</span><span class="op" id="7909263">]</span><span class="op" id="7909264">[</span><span class="op" id="7909265">]</span><span class="builtintype" id="7909266">byte</span><span class="op" id="7909270">,</span>&nbsp;<span class="ident" id="7909272">err</span>&nbsp;<span class="builtintype" id="7909276">error</span><span class="op" id="7909281">)</span>&nbsp;<span class="op" id="7909283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909286">in</span><span class="op" id="7909288">,</span>&nbsp;<span class="ident" id="7909290">err</span>&nbsp;<span class="op" id="7909294">:=</span>&nbsp;<span class="ident" id="7909297">os</span><span class="op" id="7909299">.</span><span class="ident" id="7909300">Open</span><span class="op" id="7909304">(</span><span class="ident" id="7909305">test</span><span class="op" id="7909309">.</span><span class="ident" id="7909310">dataPath</span><span class="op" id="7909318">(</span><span class="op" id="7909319">)</span><span class="op" id="7909320">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909323">if</span>&nbsp;<span class="ident" id="7909326">err</span>&nbsp;<span class="op" id="7909330">!=</span>&nbsp;<span class="ident" id="7909333">nil</span>&nbsp;<span class="op" id="7909337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909341">return</span>&nbsp;<span class="ident" id="7909348">nil</span><span class="op" id="7909351">,</span>&nbsp;<span class="ident" id="7909353">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909361">defer</span>&nbsp;<span class="ident" id="7909367">in</span><span class="op" id="7909369">.</span><span class="ident" id="7909370">Close</span><span class="op" id="7909375">(</span><span class="op" id="7909376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909379">return</span>&nbsp;<span class="ident" id="7909386">parseTestData</span><span class="op" id="7909399">(</span><span class="ident" id="7909400">in</span><span class="op" id="7909402">)</span><br>
<span class="lineno">165</span><span class="op" id="7909404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7909407">func</span>&nbsp;<span class="op" id="7909412">(</span><span class="ident" id="7909413">test</span>&nbsp;<span class="op" id="7909418">*</span><span class="ident" id="7909419">clientTest</span><span class="op" id="7909429">)</span>&nbsp;<span class="ident" id="7909431">run</span><span class="op" id="7909434">(</span><span class="ident" id="7909435">t</span>&nbsp;<span class="op" id="7909437">*</span><span class="ident" id="7909438">testing</span><span class="op" id="7909445">.</span><span class="ident" id="7909446">T</span><span class="op" id="7909447">,</span>&nbsp;<span class="ident" id="7909449">write</span>&nbsp;<span class="builtintype" id="7909455">bool</span><span class="op" id="7909459">)</span>&nbsp;<span class="op" id="7909461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909464">var</span>&nbsp;<span class="ident" id="7909468">clientConn</span><span class="op" id="7909478">,</span>&nbsp;<span class="ident" id="7909480">serverConn</span>&nbsp;<span class="ident" id="7909491">net</span><span class="op" id="7909494">.</span><span class="ident" id="7909495">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909501">var</span>&nbsp;<span class="ident" id="7909505">recordingConn</span>&nbsp;<span class="op" id="7909519">*</span><span class="ident" id="7909520">recordingConn</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909535">var</span>&nbsp;<span class="ident" id="7909539">childProcess</span>&nbsp;<span class="op" id="7909552">*</span><span class="ident" id="7909553">exec</span><span class="op" id="7909557">.</span><span class="ident" id="7909558">Cmd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909563">var</span>&nbsp;<span class="ident" id="7909567">stdin</span>&nbsp;<span class="ident" id="7909573">blockingSource</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909590">if</span>&nbsp;<span class="ident" id="7909593">write</span>&nbsp;<span class="op" id="7909599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909603">var</span>&nbsp;<span class="ident" id="7909607">err</span>&nbsp;<span class="builtintype" id="7909611">error</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909619">recordingConn</span><span class="op" id="7909632">,</span>&nbsp;<span class="ident" id="7909634">childProcess</span><span class="op" id="7909646">,</span>&nbsp;<span class="ident" id="7909648">stdin</span><span class="op" id="7909653">,</span>&nbsp;<span class="ident" id="7909655">err</span>&nbsp;<span class="op" id="7909659">=</span>&nbsp;<span class="ident" id="7909661">test</span><span class="op" id="7909665">.</span><span class="ident" id="7909666">connFromCommand</span><span class="op" id="7909681">(</span><span class="op" id="7909682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909686">if</span>&nbsp;<span class="ident" id="7909689">err</span>&nbsp;<span class="op" id="7909693">!=</span>&nbsp;<span class="ident" id="7909696">nil</span>&nbsp;<span class="op" id="7909700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909705">t</span><span class="op" id="7909706">.</span><span class="ident" id="7909707">Fatalf</span><span class="op" id="7909713">(</span><span class="string" id="7909714">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="7909746">,</span>&nbsp;<span class="ident" id="7909748">err</span><span class="op" id="7909751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909759">clientConn</span>&nbsp;<span class="op" id="7909770">=</span>&nbsp;<span class="ident" id="7909772">recordingConn</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909787">}</span>&nbsp;<span class="keyword" id="7909789">else</span>&nbsp;<span class="op" id="7909794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909798">clientConn</span><span class="op" id="7909808">,</span>&nbsp;<span class="ident" id="7909810">serverConn</span>&nbsp;<span class="op" id="7909821">=</span>&nbsp;<span class="ident" id="7909823">net</span><span class="op" id="7909826">.</span><span class="ident" id="7909827">Pipe</span><span class="op" id="7909831">(</span><span class="op" id="7909832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909839">config</span>&nbsp;<span class="op" id="7909846">:=</span>&nbsp;<span class="ident" id="7909849">test</span><span class="op" id="7909853">.</span><span class="ident" id="7909854">config</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909862">if</span>&nbsp;<span class="ident" id="7909865">config</span>&nbsp;<span class="op" id="7909872">==</span>&nbsp;<span class="ident" id="7909875">nil</span>&nbsp;<span class="op" id="7909879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909883">config</span>&nbsp;<span class="op" id="7909890">=</span>&nbsp;<span class="ident" id="7909892">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7909904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909907">client</span>&nbsp;<span class="op" id="7909914">:=</span>&nbsp;<span class="ident" id="7909917">Client</span><span class="op" id="7909923">(</span><span class="ident" id="7909924">clientConn</span><span class="op" id="7909934">,</span>&nbsp;<span class="ident" id="7909936">config</span><span class="op" id="7909942">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7909946">doneChan</span>&nbsp;<span class="op" id="7909955">:=</span>&nbsp;<span class="builtinfunc" id="7909958">make</span><span class="op" id="7909962">(</span><span class="keyword" id="7909963">chan</span>&nbsp;<span class="builtintype" id="7909968">bool</span><span class="op" id="7909972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909975">go</span>&nbsp;<span class="keyword" id="7909978">func</span><span class="op" id="7909982">(</span><span class="op" id="7909983">)</span>&nbsp;<span class="op" id="7909985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7909989">if</span>&nbsp;<span class="ident" id="7909992">_</span><span class="op" id="7909993">,</span>&nbsp;<span class="ident" id="7909995">err</span>&nbsp;<span class="op" id="7909999">:=</span>&nbsp;<span class="ident" id="7910002">client</span><span class="op" id="7910008">.</span><span class="ident" id="7910009">Write</span><span class="op" id="7910014">(</span><span class="op" id="7910015">[</span><span class="op" id="7910016">]</span><span class="builtintype" id="7910017">byte</span><span class="op" id="7910021">(</span><span class="string" id="7910022">&#34;hello\n&#34;</span><span class="op" id="7910031">)</span><span class="op" id="7910032">)</span><span class="op" id="7910033">;</span>&nbsp;<span class="ident" id="7910035">err</span>&nbsp;<span class="op" id="7910039">!=</span>&nbsp;<span class="ident" id="7910042">nil</span>&nbsp;<span class="op" id="7910046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910051">t</span><span class="op" id="7910052">.</span><span class="ident" id="7910053">Logf</span><span class="op" id="7910057">(</span><span class="string" id="7910058">&#34;Client.Write&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7910083">,</span>&nbsp;<span class="ident" id="7910085">err</span><span class="op" id="7910088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910092">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910096">if</span>&nbsp;<span class="ident" id="7910099">test</span><span class="op" id="7910103">.</span><span class="ident" id="7910104">validate</span>&nbsp;<span class="op" id="7910113">!=</span>&nbsp;<span class="ident" id="7910116">nil</span>&nbsp;<span class="op" id="7910120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910125">if</span>&nbsp;<span class="ident" id="7910128">err</span>&nbsp;<span class="op" id="7910132">:=</span>&nbsp;<span class="ident" id="7910135">test</span><span class="op" id="7910139">.</span><span class="ident" id="7910140">validate</span><span class="op" id="7910148">(</span><span class="ident" id="7910149">client</span><span class="op" id="7910155">.</span><span class="ident" id="7910156">ConnectionState</span><span class="op" id="7910171">(</span><span class="op" id="7910172">)</span><span class="op" id="7910173">)</span><span class="op" id="7910174">;</span>&nbsp;<span class="ident" id="7910176">err</span>&nbsp;<span class="op" id="7910180">!=</span>&nbsp;<span class="ident" id="7910183">nil</span>&nbsp;<span class="op" id="7910187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910193">t</span><span class="op" id="7910194">.</span><span class="ident" id="7910195">Logf</span><span class="op" id="7910199">(</span><span class="string" id="7910200">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7910238">,</span>&nbsp;<span class="ident" id="7910240">err</span><span class="op" id="7910243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910252">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910256">client</span><span class="op" id="7910262">.</span><span class="ident" id="7910263">Close</span><span class="op" id="7910268">(</span><span class="op" id="7910269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910273">clientConn</span><span class="op" id="7910283">.</span><span class="ident" id="7910284">Close</span><span class="op" id="7910289">(</span><span class="op" id="7910290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910294">doneChan</span>&nbsp;<span class="op" id="7910303">&lt;-</span>&nbsp;<span class="builtintype" id="7910306">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910312">}</span><span class="op" id="7910313">(</span><span class="op" id="7910314">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910318">if</span>&nbsp;<span class="op" id="7910321">!</span><span class="ident" id="7910322">write</span>&nbsp;<span class="op" id="7910328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910332">flows</span><span class="op" id="7910337">,</span>&nbsp;<span class="ident" id="7910339">err</span>&nbsp;<span class="op" id="7910343">:=</span>&nbsp;<span class="ident" id="7910346">test</span><span class="op" id="7910350">.</span><span class="ident" id="7910351">loadData</span><span class="op" id="7910359">(</span><span class="op" id="7910360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910364">if</span>&nbsp;<span class="ident" id="7910367">err</span>&nbsp;<span class="op" id="7910371">!=</span>&nbsp;<span class="ident" id="7910374">nil</span>&nbsp;<span class="op" id="7910378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910383">t</span><span class="op" id="7910384">.</span><span class="ident" id="7910385">Fatalf</span><span class="op" id="7910391">(</span><span class="string" id="7910392">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="7910429">,</span>&nbsp;<span class="ident" id="7910431">test</span><span class="op" id="7910435">.</span><span class="ident" id="7910436">name</span><span class="op" id="7910440">,</span>&nbsp;<span class="ident" id="7910442">test</span><span class="op" id="7910446">.</span><span class="ident" id="7910447">dataPath</span><span class="op" id="7910455">(</span><span class="op" id="7910456">)</span><span class="op" id="7910457">,</span>&nbsp;<span class="ident" id="7910459">err</span><span class="op" id="7910462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910466">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910470">for</span>&nbsp;<span class="ident" id="7910474">i</span><span class="op" id="7910475">,</span>&nbsp;<span class="ident" id="7910477">b</span>&nbsp;<span class="op" id="7910479">:=</span>&nbsp;<span class="keyword" id="7910482">range</span>&nbsp;<span class="ident" id="7910488">flows</span>&nbsp;<span class="op" id="7910494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910499">if</span>&nbsp;<span class="ident" id="7910502">i</span><span class="op" id="7910503">%</span><span class="num" id="7910504">2</span>&nbsp;<span class="op" id="7910506">==</span>&nbsp;<span class="num" id="7910509">1</span>&nbsp;<span class="op" id="7910511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910517">serverConn</span><span class="op" id="7910527">.</span><span class="ident" id="7910528">Write</span><span class="op" id="7910533">(</span><span class="ident" id="7910534">b</span><span class="op" id="7910535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910541">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910553">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910558">bb</span>&nbsp;<span class="op" id="7910561">:=</span>&nbsp;<span class="builtinfunc" id="7910564">make</span><span class="op" id="7910568">(</span><span class="op" id="7910569">[</span><span class="op" id="7910570">]</span><span class="builtintype" id="7910571">byte</span><span class="op" id="7910575">,</span>&nbsp;<span class="builtinfunc" id="7910577">len</span><span class="op" id="7910580">(</span><span class="ident" id="7910581">b</span><span class="op" id="7910582">)</span><span class="op" id="7910583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910588">_</span><span class="op" id="7910589">,</span>&nbsp;<span class="ident" id="7910591">err</span>&nbsp;<span class="op" id="7910595">:=</span>&nbsp;<span class="ident" id="7910598">io</span><span class="op" id="7910600">.</span><span class="ident" id="7910601">ReadFull</span><span class="op" id="7910609">(</span><span class="ident" id="7910610">serverConn</span><span class="op" id="7910620">,</span>&nbsp;<span class="ident" id="7910622">bb</span><span class="op" id="7910624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910629">if</span>&nbsp;<span class="ident" id="7910632">err</span>&nbsp;<span class="op" id="7910636">!=</span>&nbsp;<span class="ident" id="7910639">nil</span>&nbsp;<span class="op" id="7910643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910649">t</span><span class="op" id="7910650">.</span><span class="ident" id="7910651">Fatalf</span><span class="op" id="7910657">(</span><span class="string" id="7910658">&#34;%s&nbsp;#%d:&nbsp;%s&#34;</span><span class="op" id="7910670">,</span>&nbsp;<span class="ident" id="7910672">test</span><span class="op" id="7910676">.</span><span class="ident" id="7910677">name</span><span class="op" id="7910681">,</span>&nbsp;<span class="ident" id="7910683">i</span><span class="op" id="7910684">,</span>&nbsp;<span class="ident" id="7910686">err</span><span class="op" id="7910689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910694">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910699">if</span>&nbsp;<span class="op" id="7910702">!</span><span class="ident" id="7910703">bytes</span><span class="op" id="7910708">.</span><span class="ident" id="7910709">Equal</span><span class="op" id="7910714">(</span><span class="ident" id="7910715">b</span><span class="op" id="7910716">,</span>&nbsp;<span class="ident" id="7910718">bb</span><span class="op" id="7910720">)</span>&nbsp;<span class="op" id="7910722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910728">t</span><span class="op" id="7910729">.</span><span class="ident" id="7910730">Fatalf</span><span class="op" id="7910736">(</span><span class="string" id="7910737">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="7910779">,</span>&nbsp;<span class="ident" id="7910781">test</span><span class="op" id="7910785">.</span><span class="ident" id="7910786">name</span><span class="op" id="7910790">,</span>&nbsp;<span class="ident" id="7910792">i</span><span class="op" id="7910793">,</span>&nbsp;<span class="ident" id="7910795">bb</span><span class="op" id="7910797">,</span>&nbsp;<span class="ident" id="7910799">b</span><span class="op" id="7910800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910813">serverConn</span><span class="op" id="7910823">.</span><span class="ident" id="7910824">Close</span><span class="op" id="7910829">(</span><span class="op" id="7910830">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7910837">&lt;-</span><span class="ident" id="7910839">doneChan</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910850">if</span>&nbsp;<span class="ident" id="7910853">write</span>&nbsp;<span class="op" id="7910859">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910863">path</span>&nbsp;<span class="op" id="7910868">:=</span>&nbsp;<span class="ident" id="7910871">test</span><span class="op" id="7910875">.</span><span class="ident" id="7910876">dataPath</span><span class="op" id="7910884">(</span><span class="op" id="7910885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910889">out</span><span class="op" id="7910892">,</span>&nbsp;<span class="ident" id="7910894">err</span>&nbsp;<span class="op" id="7910898">:=</span>&nbsp;<span class="ident" id="7910901">os</span><span class="op" id="7910903">.</span><span class="ident" id="7910904">OpenFile</span><span class="op" id="7910912">(</span><span class="ident" id="7910913">path</span><span class="op" id="7910917">,</span>&nbsp;<span class="ident" id="7910919">os</span><span class="op" id="7910921">.</span><span class="ident" id="7910922">O_WRONLY</span><span class="op" id="7910930">|</span><span class="ident" id="7910931">os</span><span class="op" id="7910933">.</span><span class="ident" id="7910934">O_CREATE</span><span class="op" id="7910942">|</span><span class="ident" id="7910943">os</span><span class="op" id="7910945">.</span><span class="ident" id="7910946">O_TRUNC</span><span class="op" id="7910953">,</span>&nbsp;<span class="num" id="7910955">0644</span><span class="op" id="7910959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7910963">if</span>&nbsp;<span class="ident" id="7910966">err</span>&nbsp;<span class="op" id="7910970">!=</span>&nbsp;<span class="ident" id="7910973">nil</span>&nbsp;<span class="op" id="7910977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7910982">t</span><span class="op" id="7910983">.</span><span class="ident" id="7910984">Fatalf</span><span class="op" id="7910990">(</span><span class="string" id="7910991">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="7911025">,</span>&nbsp;<span class="ident" id="7911027">err</span><span class="op" id="7911030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911034">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911038">defer</span>&nbsp;<span class="ident" id="7911044">out</span><span class="op" id="7911047">.</span><span class="ident" id="7911048">Close</span><span class="op" id="7911053">(</span><span class="op" id="7911054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911058">recordingConn</span><span class="op" id="7911071">.</span><span class="ident" id="7911072">Close</span><span class="op" id="7911077">(</span><span class="op" id="7911078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7911082">close</span><span class="op" id="7911087">(</span><span class="ident" id="7911088">stdin</span><span class="op" id="7911093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911097">childProcess</span><span class="op" id="7911109">.</span><span class="ident" id="7911110">Process</span><span class="op" id="7911117">.</span><span class="ident" id="7911118">Kill</span><span class="op" id="7911122">(</span><span class="op" id="7911123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911127">childProcess</span><span class="op" id="7911139">.</span><span class="ident" id="7911140">Wait</span><span class="op" id="7911144">(</span><span class="op" id="7911145">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911149">if</span>&nbsp;<span class="builtinfunc" id="7911152">len</span><span class="op" id="7911155">(</span><span class="ident" id="7911156">recordingConn</span><span class="op" id="7911169">.</span><span class="ident" id="7911170">flows</span><span class="op" id="7911175">)</span>&nbsp;<span class="op" id="7911177">&lt;</span>&nbsp;<span class="num" id="7911179">3</span>&nbsp;<span class="op" id="7911181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911186">childProcess</span><span class="op" id="7911198">.</span><span class="ident" id="7911199">Stdout</span><span class="op" id="7911205">.</span><span class="op" id="7911206">(</span><span class="op" id="7911207">*</span><span class="ident" id="7911208">bytes</span><span class="op" id="7911213">.</span><span class="ident" id="7911214">Buffer</span><span class="op" id="7911220">)</span><span class="op" id="7911221">.</span><span class="ident" id="7911222">WriteTo</span><span class="op" id="7911229">(</span><span class="ident" id="7911230">os</span><span class="op" id="7911232">.</span><span class="ident" id="7911233">Stdout</span><span class="op" id="7911239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911244">t</span><span class="op" id="7911245">.</span><span class="ident" id="7911246">Fatalf</span><span class="op" id="7911252">(</span><span class="string" id="7911253">&#34;Client&nbsp;connection&nbsp;didn&#39;t&nbsp;work&#34;</span><span class="op" id="7911284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911292">recordingConn</span><span class="op" id="7911305">.</span><span class="ident" id="7911306">WriteTo</span><span class="op" id="7911313">(</span><span class="ident" id="7911314">out</span><span class="op" id="7911317">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911321">fmt</span><span class="op" id="7911324">.</span><span class="ident" id="7911325">Printf</span><span class="op" id="7911331">(</span><span class="string" id="7911332">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="7911344">,</span>&nbsp;<span class="ident" id="7911346">path</span><span class="op" id="7911350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911353">}</span><br>
<span class="lineno"></span><span class="op" id="7911355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7911358">func</span>&nbsp;<span class="ident" id="7911363">runClientTestForVersion</span><span class="op" id="7911386">(</span><span class="ident" id="7911387">t</span>&nbsp;<span class="op" id="7911389">*</span><span class="ident" id="7911390">testing</span><span class="op" id="7911397">.</span><span class="ident" id="7911398">T</span><span class="op" id="7911399">,</span>&nbsp;<span class="ident" id="7911401">template</span>&nbsp;<span class="op" id="7911410">*</span><span class="ident" id="7911411">clientTest</span><span class="op" id="7911421">,</span>&nbsp;<span class="ident" id="7911423">prefix</span><span class="op" id="7911429">,</span>&nbsp;<span class="ident" id="7911431">option</span>&nbsp;<span class="builtintype" id="7911438">string</span><span class="op" id="7911444">)</span>&nbsp;<span class="op" id="7911446">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911449">test</span>&nbsp;<span class="op" id="7911454">:=</span>&nbsp;<span class="op" id="7911457">*</span><span class="ident" id="7911458">template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911468">test</span><span class="op" id="7911472">.</span><span class="ident" id="7911473">name</span>&nbsp;<span class="op" id="7911478">=</span>&nbsp;<span class="ident" id="7911480">prefix</span>&nbsp;<span class="op" id="7911487">+</span>&nbsp;<span class="ident" id="7911489">test</span><span class="op" id="7911493">.</span><span class="ident" id="7911494">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7911500">if</span>&nbsp;<span class="builtinfunc" id="7911503">len</span><span class="op" id="7911506">(</span><span class="ident" id="7911507">test</span><span class="op" id="7911511">.</span><span class="ident" id="7911512">command</span><span class="op" id="7911519">)</span>&nbsp;<span class="op" id="7911521">==</span>&nbsp;<span class="num" id="7911524">0</span>&nbsp;<span class="op" id="7911526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911530">test</span><span class="op" id="7911534">.</span><span class="ident" id="7911535">command</span>&nbsp;<span class="op" id="7911543">=</span>&nbsp;<span class="ident" id="7911545">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7911567">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911570">test</span><span class="op" id="7911574">.</span><span class="ident" id="7911575">command</span>&nbsp;<span class="op" id="7911583">=</span>&nbsp;<span class="builtinfunc" id="7911585">append</span><span class="op" id="7911591">(</span><span class="op" id="7911592">[</span><span class="op" id="7911593">]</span><span class="builtintype" id="7911594">string</span><span class="op" id="7911600">(</span><span class="ident" id="7911601">nil</span><span class="op" id="7911604">)</span><span class="op" id="7911605">,</span>&nbsp;<span class="ident" id="7911607">test</span><span class="op" id="7911611">.</span><span class="ident" id="7911612">command</span><span class="op" id="7911619">...</span><span class="op" id="7911622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911625">test</span><span class="op" id="7911629">.</span><span class="ident" id="7911630">command</span>&nbsp;<span class="op" id="7911638">=</span>&nbsp;<span class="builtinfunc" id="7911640">append</span><span class="op" id="7911646">(</span><span class="ident" id="7911647">test</span><span class="op" id="7911651">.</span><span class="ident" id="7911652">command</span><span class="op" id="7911659">,</span>&nbsp;<span class="ident" id="7911661">option</span><span class="op" id="7911667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911670">test</span><span class="op" id="7911674">.</span><span class="ident" id="7911675">run</span><span class="op" id="7911678">(</span><span class="ident" id="7911679">t</span><span class="op" id="7911680">,</span>&nbsp;<span class="op" id="7911682">*</span><span class="ident" id="7911683">update</span><span class="op" id="7911689">)</span><br>
<span class="lineno"></span><span class="op" id="7911691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="7911694">func</span>&nbsp;<span class="ident" id="7911699">runClientTestTLS10</span><span class="op" id="7911717">(</span><span class="ident" id="7911718">t</span>&nbsp;<span class="op" id="7911720">*</span><span class="ident" id="7911721">testing</span><span class="op" id="7911728">.</span><span class="ident" id="7911729">T</span><span class="op" id="7911730">,</span>&nbsp;<span class="ident" id="7911732">template</span>&nbsp;<span class="op" id="7911741">*</span><span class="ident" id="7911742">clientTest</span><span class="op" id="7911752">)</span>&nbsp;<span class="op" id="7911754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911757">runClientTestForVersion</span><span class="op" id="7911780">(</span><span class="ident" id="7911781">t</span><span class="op" id="7911782">,</span>&nbsp;<span class="ident" id="7911784">template</span><span class="op" id="7911792">,</span>&nbsp;<span class="string" id="7911794">&#34;TLSv10-&#34;</span><span class="op" id="7911803">,</span>&nbsp;<span class="string" id="7911805">&#34;-tls1&#34;</span><span class="op" id="7911812">)</span><br>
<span class="lineno"></span><span class="op" id="7911814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7911817">func</span>&nbsp;<span class="ident" id="7911822">runClientTestTLS11</span><span class="op" id="7911840">(</span><span class="ident" id="7911841">t</span>&nbsp;<span class="op" id="7911843">*</span><span class="ident" id="7911844">testing</span><span class="op" id="7911851">.</span><span class="ident" id="7911852">T</span><span class="op" id="7911853">,</span>&nbsp;<span class="ident" id="7911855">template</span>&nbsp;<span class="op" id="7911864">*</span><span class="ident" id="7911865">clientTest</span><span class="op" id="7911875">)</span>&nbsp;<span class="op" id="7911877">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7911880">runClientTestForVersion</span><span class="op" id="7911903">(</span><span class="ident" id="7911904">t</span><span class="op" id="7911905">,</span>&nbsp;<span class="ident" id="7911907">template</span><span class="op" id="7911915">,</span>&nbsp;<span class="string" id="7911917">&#34;TLSv11-&#34;</span><span class="op" id="7911926">,</span>&nbsp;<span class="string" id="7911928">&#34;-tls1_1&#34;</span><span class="op" id="7911937">)</span><br>
<span class="lineno"></span><span class="op" id="7911939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7911942">func</span>&nbsp;<span class="ident" id="7911947">runClientTestTLS12</span><span class="op" id="7911965">(</span><span class="ident" id="7911966">t</span>&nbsp;<span class="op" id="7911968">*</span><span class="ident" id="7911969">testing</span><span class="op" id="7911976">.</span><span class="ident" id="7911977">T</span><span class="op" id="7911978">,</span>&nbsp;<span class="ident" id="7911980">template</span>&nbsp;<span class="op" id="7911989">*</span><span class="ident" id="7911990">clientTest</span><span class="op" id="7912000">)</span>&nbsp;<span class="op" id="7912002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912005">runClientTestForVersion</span><span class="op" id="7912028">(</span><span class="ident" id="7912029">t</span><span class="op" id="7912030">,</span>&nbsp;<span class="ident" id="7912032">template</span><span class="op" id="7912040">,</span>&nbsp;<span class="string" id="7912042">&#34;TLSv12-&#34;</span><span class="op" id="7912051">,</span>&nbsp;<span class="string" id="7912053">&#34;-tls1_2&#34;</span><span class="op" id="7912062">)</span><br>
<span class="lineno">270</span><span class="op" id="7912064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7912067">func</span>&nbsp;<span class="ident" id="7912072">TestHandshakeClientRSARC4</span><span class="op" id="7912097">(</span><span class="ident" id="7912098">t</span>&nbsp;<span class="op" id="7912100">*</span><span class="ident" id="7912101">testing</span><span class="op" id="7912108">.</span><span class="ident" id="7912109">T</span><span class="op" id="7912110">)</span>&nbsp;<span class="op" id="7912112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912115">test</span>&nbsp;<span class="op" id="7912120">:=</span>&nbsp;<span class="op" id="7912123">&amp;</span><span class="ident" id="7912124">clientTest</span><span class="op" id="7912134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912138">name</span><span class="op" id="7912142">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7912147">&#34;RSA-RC4&#34;</span><span class="op" id="7912156">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912160">command</span><span class="op" id="7912167">:</span>&nbsp;<span class="op" id="7912169">[</span><span class="op" id="7912170">]</span><span class="builtintype" id="7912171">string</span><span class="op" id="7912177">{</span><span class="string" id="7912178">&#34;openssl&#34;</span><span class="op" id="7912187">,</span>&nbsp;<span class="string" id="7912189">&#34;s_server&#34;</span><span class="op" id="7912199">,</span>&nbsp;<span class="string" id="7912201">&#34;-cipher&#34;</span><span class="op" id="7912210">,</span>&nbsp;<span class="string" id="7912212">&#34;RC4-SHA&#34;</span><span class="op" id="7912221">}</span><span class="op" id="7912222">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912228">runClientTestTLS10</span><span class="op" id="7912246">(</span><span class="ident" id="7912247">t</span><span class="op" id="7912248">,</span>&nbsp;<span class="ident" id="7912250">test</span><span class="op" id="7912254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912257">runClientTestTLS11</span><span class="op" id="7912275">(</span><span class="ident" id="7912276">t</span><span class="op" id="7912277">,</span>&nbsp;<span class="ident" id="7912279">test</span><span class="op" id="7912283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912286">runClientTestTLS12</span><span class="op" id="7912304">(</span><span class="ident" id="7912305">t</span><span class="op" id="7912306">,</span>&nbsp;<span class="ident" id="7912308">test</span><span class="op" id="7912312">)</span><br>
<span class="lineno">280</span><span class="op" id="7912314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7912317">func</span>&nbsp;<span class="ident" id="7912322">TestHandshakeClientECDHERSAAES</span><span class="op" id="7912352">(</span><span class="ident" id="7912353">t</span>&nbsp;<span class="op" id="7912355">*</span><span class="ident" id="7912356">testing</span><span class="op" id="7912363">.</span><span class="ident" id="7912364">T</span><span class="op" id="7912365">)</span>&nbsp;<span class="op" id="7912367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912370">test</span>&nbsp;<span class="op" id="7912375">:=</span>&nbsp;<span class="op" id="7912378">&amp;</span><span class="ident" id="7912379">clientTest</span><span class="op" id="7912389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912393">name</span><span class="op" id="7912397">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7912402">&#34;ECDHE-RSA-AES&#34;</span><span class="op" id="7912417">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912421">command</span><span class="op" id="7912428">:</span>&nbsp;<span class="op" id="7912430">[</span><span class="op" id="7912431">]</span><span class="builtintype" id="7912432">string</span><span class="op" id="7912438">{</span><span class="string" id="7912439">&#34;openssl&#34;</span><span class="op" id="7912448">,</span>&nbsp;<span class="string" id="7912450">&#34;s_server&#34;</span><span class="op" id="7912460">,</span>&nbsp;<span class="string" id="7912462">&#34;-cipher&#34;</span><span class="op" id="7912471">,</span>&nbsp;<span class="string" id="7912473">&#34;ECDHE-RSA-AES128-SHA&#34;</span><span class="op" id="7912495">}</span><span class="op" id="7912496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912502">runClientTestTLS10</span><span class="op" id="7912520">(</span><span class="ident" id="7912521">t</span><span class="op" id="7912522">,</span>&nbsp;<span class="ident" id="7912524">test</span><span class="op" id="7912528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912531">runClientTestTLS11</span><span class="op" id="7912549">(</span><span class="ident" id="7912550">t</span><span class="op" id="7912551">,</span>&nbsp;<span class="ident" id="7912553">test</span><span class="op" id="7912557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912560">runClientTestTLS12</span><span class="op" id="7912578">(</span><span class="ident" id="7912579">t</span><span class="op" id="7912580">,</span>&nbsp;<span class="ident" id="7912582">test</span><span class="op" id="7912586">)</span><br>
<span class="lineno">290</span><span class="op" id="7912588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7912591">func</span>&nbsp;<span class="ident" id="7912596">TestHandshakeClientECDHEECDSAAES</span><span class="op" id="7912628">(</span><span class="ident" id="7912629">t</span>&nbsp;<span class="op" id="7912631">*</span><span class="ident" id="7912632">testing</span><span class="op" id="7912639">.</span><span class="ident" id="7912640">T</span><span class="op" id="7912641">)</span>&nbsp;<span class="op" id="7912643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912646">test</span>&nbsp;<span class="op" id="7912651">:=</span>&nbsp;<span class="op" id="7912654">&amp;</span><span class="ident" id="7912655">clientTest</span><span class="op" id="7912665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912669">name</span><span class="op" id="7912673">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7912678">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="7912695">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912699">command</span><span class="op" id="7912706">:</span>&nbsp;<span class="op" id="7912708">[</span><span class="op" id="7912709">]</span><span class="builtintype" id="7912710">string</span><span class="op" id="7912716">{</span><span class="string" id="7912717">&#34;openssl&#34;</span><span class="op" id="7912726">,</span>&nbsp;<span class="string" id="7912728">&#34;s_server&#34;</span><span class="op" id="7912738">,</span>&nbsp;<span class="string" id="7912740">&#34;-cipher&#34;</span><span class="op" id="7912749">,</span>&nbsp;<span class="string" id="7912751">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7912775">}</span><span class="op" id="7912776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912780">cert</span><span class="op" id="7912784">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7912789">testECDSACertificate</span><span class="op" id="7912809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912813">key</span><span class="op" id="7912816">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7912822">testECDSAPrivateKey</span><span class="op" id="7912841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7912844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912847">runClientTestTLS10</span><span class="op" id="7912865">(</span><span class="ident" id="7912866">t</span><span class="op" id="7912867">,</span>&nbsp;<span class="ident" id="7912869">test</span><span class="op" id="7912873">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912876">runClientTestTLS11</span><span class="op" id="7912894">(</span><span class="ident" id="7912895">t</span><span class="op" id="7912896">,</span>&nbsp;<span class="ident" id="7912898">test</span><span class="op" id="7912902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912905">runClientTestTLS12</span><span class="op" id="7912923">(</span><span class="ident" id="7912924">t</span><span class="op" id="7912925">,</span>&nbsp;<span class="ident" id="7912927">test</span><span class="op" id="7912931">)</span><br>
<span class="lineno"></span><span class="op" id="7912933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7912936">func</span>&nbsp;<span class="ident" id="7912941">TestHandshakeClientECDHEECDSAAESGCM</span><span class="op" id="7912976">(</span><span class="ident" id="7912977">t</span>&nbsp;<span class="op" id="7912979">*</span><span class="ident" id="7912980">testing</span><span class="op" id="7912987">.</span><span class="ident" id="7912988">T</span><span class="op" id="7912989">)</span>&nbsp;<span class="op" id="7912991">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7912994">test</span>&nbsp;<span class="op" id="7912999">:=</span>&nbsp;<span class="op" id="7913002">&amp;</span><span class="ident" id="7913003">clientTest</span><span class="op" id="7913013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913017">name</span><span class="op" id="7913021">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7913026">&#34;ECDHE-ECDSA-AES-GCM&#34;</span><span class="op" id="7913047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913051">command</span><span class="op" id="7913058">:</span>&nbsp;<span class="op" id="7913060">[</span><span class="op" id="7913061">]</span><span class="builtintype" id="7913062">string</span><span class="op" id="7913068">{</span><span class="string" id="7913069">&#34;openssl&#34;</span><span class="op" id="7913078">,</span>&nbsp;<span class="string" id="7913080">&#34;s_server&#34;</span><span class="op" id="7913090">,</span>&nbsp;<span class="string" id="7913092">&#34;-cipher&#34;</span><span class="op" id="7913101">,</span>&nbsp;<span class="string" id="7913103">&#34;ECDHE-ECDSA-AES128-GCM-SHA256&#34;</span><span class="op" id="7913134">}</span><span class="op" id="7913135">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913139">cert</span><span class="op" id="7913143">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7913148">testECDSACertificate</span><span class="op" id="7913168">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913172">key</span><span class="op" id="7913175">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7913181">testECDSAPrivateKey</span><span class="op" id="7913200">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913206">runClientTestTLS12</span><span class="op" id="7913224">(</span><span class="ident" id="7913225">t</span><span class="op" id="7913226">,</span>&nbsp;<span class="ident" id="7913228">test</span><span class="op" id="7913232">)</span><br>
<span class="lineno"></span><span class="op" id="7913234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7913237">func</span>&nbsp;<span class="ident" id="7913242">TestHandshakeClientCertRSA</span><span class="op" id="7913268">(</span><span class="ident" id="7913269">t</span>&nbsp;<span class="op" id="7913271">*</span><span class="ident" id="7913272">testing</span><span class="op" id="7913279">.</span><span class="ident" id="7913280">T</span><span class="op" id="7913281">)</span>&nbsp;<span class="op" id="7913283">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913286">config</span>&nbsp;<span class="op" id="7913293">:=</span>&nbsp;<span class="op" id="7913296">*</span><span class="ident" id="7913297">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913309">cert</span><span class="op" id="7913313">,</span>&nbsp;<span class="ident" id="7913315">_</span>&nbsp;<span class="op" id="7913317">:=</span>&nbsp;<span class="ident" id="7913320">X509KeyPair</span><span class="op" id="7913331">(</span><span class="op" id="7913332">[</span><span class="op" id="7913333">]</span><span class="builtintype" id="7913334">byte</span><span class="op" id="7913338">(</span><span class="ident" id="7913339">clientCertificatePEM</span><span class="op" id="7913359">)</span><span class="op" id="7913360">,</span>&nbsp;<span class="op" id="7913362">[</span><span class="op" id="7913363">]</span><span class="builtintype" id="7913364">byte</span><span class="op" id="7913368">(</span><span class="ident" id="7913369">clientKeyPEM</span><span class="op" id="7913381">)</span><span class="op" id="7913382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913385">config</span><span class="op" id="7913391">.</span><span class="ident" id="7913392">Certificates</span>&nbsp;<span class="op" id="7913405">=</span>&nbsp;<span class="op" id="7913407">[</span><span class="op" id="7913408">]</span><span class="ident" id="7913409">Certificate</span><span class="op" id="7913420">{</span><span class="ident" id="7913421">cert</span><span class="op" id="7913425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913429">test</span>&nbsp;<span class="op" id="7913434">:=</span>&nbsp;<span class="op" id="7913437">&amp;</span><span class="ident" id="7913438">clientTest</span><span class="op" id="7913448">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913452">name</span><span class="op" id="7913456">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7913461">&#34;ClientCert-RSA-RSA&#34;</span><span class="op" id="7913481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913485">command</span><span class="op" id="7913492">:</span>&nbsp;<span class="op" id="7913494">[</span><span class="op" id="7913495">]</span><span class="builtintype" id="7913496">string</span><span class="op" id="7913502">{</span><span class="string" id="7913503">&#34;openssl&#34;</span><span class="op" id="7913512">,</span>&nbsp;<span class="string" id="7913514">&#34;s_server&#34;</span><span class="op" id="7913524">,</span>&nbsp;<span class="string" id="7913526">&#34;-cipher&#34;</span><span class="op" id="7913535">,</span>&nbsp;<span class="string" id="7913537">&#34;RC4-SHA&#34;</span><span class="op" id="7913546">,</span>&nbsp;<span class="string" id="7913548">&#34;-verify&#34;</span><span class="op" id="7913557">,</span>&nbsp;<span class="string" id="7913559">&#34;1&#34;</span><span class="op" id="7913562">}</span><span class="op" id="7913563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913567">config</span><span class="op" id="7913573">:</span>&nbsp;&nbsp;<span class="op" id="7913576">&amp;</span><span class="ident" id="7913577">config</span><span class="op" id="7913583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913590">runClientTestTLS10</span><span class="op" id="7913608">(</span><span class="ident" id="7913609">t</span><span class="op" id="7913610">,</span>&nbsp;<span class="ident" id="7913612">test</span><span class="op" id="7913616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913619">runClientTestTLS12</span><span class="op" id="7913637">(</span><span class="ident" id="7913638">t</span><span class="op" id="7913639">,</span>&nbsp;<span class="ident" id="7913641">test</span><span class="op" id="7913645">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913649">test</span>&nbsp;<span class="op" id="7913654">=</span>&nbsp;<span class="op" id="7913656">&amp;</span><span class="ident" id="7913657">clientTest</span><span class="op" id="7913667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913671">name</span><span class="op" id="7913675">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7913680">&#34;ClientCert-RSA-ECDSA&#34;</span><span class="op" id="7913702">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913706">command</span><span class="op" id="7913713">:</span>&nbsp;<span class="op" id="7913715">[</span><span class="op" id="7913716">]</span><span class="builtintype" id="7913717">string</span><span class="op" id="7913723">{</span><span class="string" id="7913724">&#34;openssl&#34;</span><span class="op" id="7913733">,</span>&nbsp;<span class="string" id="7913735">&#34;s_server&#34;</span><span class="op" id="7913745">,</span>&nbsp;<span class="string" id="7913747">&#34;-cipher&#34;</span><span class="op" id="7913756">,</span>&nbsp;<span class="string" id="7913758">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7913782">,</span>&nbsp;<span class="string" id="7913784">&#34;-verify&#34;</span><span class="op" id="7913793">,</span>&nbsp;<span class="string" id="7913795">&#34;1&#34;</span><span class="op" id="7913798">}</span><span class="op" id="7913799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913803">config</span><span class="op" id="7913809">:</span>&nbsp;&nbsp;<span class="op" id="7913812">&amp;</span><span class="ident" id="7913813">config</span><span class="op" id="7913819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913823">cert</span><span class="op" id="7913827">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7913832">testECDSACertificate</span><span class="op" id="7913852">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913856">key</span><span class="op" id="7913859">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7913865">testECDSAPrivateKey</span><span class="op" id="7913884">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7913887">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913891">runClientTestTLS10</span><span class="op" id="7913909">(</span><span class="ident" id="7913910">t</span><span class="op" id="7913911">,</span>&nbsp;<span class="ident" id="7913913">test</span><span class="op" id="7913917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7913920">runClientTestTLS12</span><span class="op" id="7913938">(</span><span class="ident" id="7913939">t</span><span class="op" id="7913940">,</span>&nbsp;<span class="ident" id="7913942">test</span><span class="op" id="7913946">)</span><br>
<span class="lineno"></span><span class="op" id="7913948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="7913951">func</span>&nbsp;<span class="ident" id="7913956">TestHandshakeClientCertECDSA</span><span class="op" id="7913984">(</span><span class="ident" id="7913985">t</span>&nbsp;<span class="op" id="7913987">*</span><span class="ident" id="7913988">testing</span><span class="op" id="7913995">.</span><span class="ident" id="7913996">T</span><span class="op" id="7913997">)</span>&nbsp;<span class="op" id="7913999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914002">config</span>&nbsp;<span class="op" id="7914009">:=</span>&nbsp;<span class="op" id="7914012">*</span><span class="ident" id="7914013">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914025">cert</span><span class="op" id="7914029">,</span>&nbsp;<span class="ident" id="7914031">_</span>&nbsp;<span class="op" id="7914033">:=</span>&nbsp;<span class="ident" id="7914036">X509KeyPair</span><span class="op" id="7914047">(</span><span class="op" id="7914048">[</span><span class="op" id="7914049">]</span><span class="builtintype" id="7914050">byte</span><span class="op" id="7914054">(</span><span class="ident" id="7914055">clientECDSACertificatePEM</span><span class="op" id="7914080">)</span><span class="op" id="7914081">,</span>&nbsp;<span class="op" id="7914083">[</span><span class="op" id="7914084">]</span><span class="builtintype" id="7914085">byte</span><span class="op" id="7914089">(</span><span class="ident" id="7914090">clientECDSAKeyPEM</span><span class="op" id="7914107">)</span><span class="op" id="7914108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914111">config</span><span class="op" id="7914117">.</span><span class="ident" id="7914118">Certificates</span>&nbsp;<span class="op" id="7914131">=</span>&nbsp;<span class="op" id="7914133">[</span><span class="op" id="7914134">]</span><span class="ident" id="7914135">Certificate</span><span class="op" id="7914146">{</span><span class="ident" id="7914147">cert</span><span class="op" id="7914151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914155">test</span>&nbsp;<span class="op" id="7914160">:=</span>&nbsp;<span class="op" id="7914163">&amp;</span><span class="ident" id="7914164">clientTest</span><span class="op" id="7914174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914178">name</span><span class="op" id="7914182">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914187">&#34;ClientCert-ECDSA-RSA&#34;</span><span class="op" id="7914209">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914213">command</span><span class="op" id="7914220">:</span>&nbsp;<span class="op" id="7914222">[</span><span class="op" id="7914223">]</span><span class="builtintype" id="7914224">string</span><span class="op" id="7914230">{</span><span class="string" id="7914231">&#34;openssl&#34;</span><span class="op" id="7914240">,</span>&nbsp;<span class="string" id="7914242">&#34;s_server&#34;</span><span class="op" id="7914252">,</span>&nbsp;<span class="string" id="7914254">&#34;-cipher&#34;</span><span class="op" id="7914263">,</span>&nbsp;<span class="string" id="7914265">&#34;RC4-SHA&#34;</span><span class="op" id="7914274">,</span>&nbsp;<span class="string" id="7914276">&#34;-verify&#34;</span><span class="op" id="7914285">,</span>&nbsp;<span class="string" id="7914287">&#34;1&#34;</span><span class="op" id="7914290">}</span><span class="op" id="7914291">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914295">config</span><span class="op" id="7914301">:</span>&nbsp;&nbsp;<span class="op" id="7914304">&amp;</span><span class="ident" id="7914305">config</span><span class="op" id="7914311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914314">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914318">runClientTestTLS10</span><span class="op" id="7914336">(</span><span class="ident" id="7914337">t</span><span class="op" id="7914338">,</span>&nbsp;<span class="ident" id="7914340">test</span><span class="op" id="7914344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914347">runClientTestTLS12</span><span class="op" id="7914365">(</span><span class="ident" id="7914366">t</span><span class="op" id="7914367">,</span>&nbsp;<span class="ident" id="7914369">test</span><span class="op" id="7914373">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914377">test</span>&nbsp;<span class="op" id="7914382">=</span>&nbsp;<span class="op" id="7914384">&amp;</span><span class="ident" id="7914385">clientTest</span><span class="op" id="7914395">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914399">name</span><span class="op" id="7914403">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7914408">&#34;ClientCert-ECDSA-ECDSA&#34;</span><span class="op" id="7914432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914436">command</span><span class="op" id="7914443">:</span>&nbsp;<span class="op" id="7914445">[</span><span class="op" id="7914446">]</span><span class="builtintype" id="7914447">string</span><span class="op" id="7914453">{</span><span class="string" id="7914454">&#34;openssl&#34;</span><span class="op" id="7914463">,</span>&nbsp;<span class="string" id="7914465">&#34;s_server&#34;</span><span class="op" id="7914475">,</span>&nbsp;<span class="string" id="7914477">&#34;-cipher&#34;</span><span class="op" id="7914486">,</span>&nbsp;<span class="string" id="7914488">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="7914512">,</span>&nbsp;<span class="string" id="7914514">&#34;-verify&#34;</span><span class="op" id="7914523">,</span>&nbsp;<span class="string" id="7914525">&#34;1&#34;</span><span class="op" id="7914528">}</span><span class="op" id="7914529">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914533">config</span><span class="op" id="7914539">:</span>&nbsp;&nbsp;<span class="op" id="7914542">&amp;</span><span class="ident" id="7914543">config</span><span class="op" id="7914549">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914553">cert</span><span class="op" id="7914557">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914562">testECDSACertificate</span><span class="op" id="7914582">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914586">key</span><span class="op" id="7914589">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7914595">testECDSAPrivateKey</span><span class="op" id="7914614">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914621">runClientTestTLS10</span><span class="op" id="7914639">(</span><span class="ident" id="7914640">t</span><span class="op" id="7914641">,</span>&nbsp;<span class="ident" id="7914643">test</span><span class="op" id="7914647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914650">runClientTestTLS12</span><span class="op" id="7914668">(</span><span class="ident" id="7914669">t</span><span class="op" id="7914670">,</span>&nbsp;<span class="ident" id="7914672">test</span><span class="op" id="7914676">)</span><br>
<span class="lineno"></span><span class="op" id="7914678">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="7914681">func</span>&nbsp;<span class="ident" id="7914686">TestClientResumption</span><span class="op" id="7914706">(</span><span class="ident" id="7914707">t</span>&nbsp;<span class="op" id="7914709">*</span><span class="ident" id="7914710">testing</span><span class="op" id="7914717">.</span><span class="ident" id="7914718">T</span><span class="op" id="7914719">)</span>&nbsp;<span class="op" id="7914721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914724">serverConfig</span>&nbsp;<span class="op" id="7914737">:=</span>&nbsp;<span class="op" id="7914740">&amp;</span><span class="ident" id="7914741">Config</span><span class="op" id="7914747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914751">CipherSuites</span><span class="op" id="7914763">:</span>&nbsp;<span class="op" id="7914765">[</span><span class="op" id="7914766">]</span><span class="builtintype" id="7914767">uint16</span><span class="op" id="7914773">{</span><span class="ident" id="7914774">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7914798">,</span>&nbsp;<span class="ident" id="7914800">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="7914830">}</span><span class="op" id="7914831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914835">Certificates</span><span class="op" id="7914847">:</span>&nbsp;<span class="ident" id="7914849">testConfig</span><span class="op" id="7914859">.</span><span class="ident" id="7914860">Certificates</span><span class="op" id="7914872">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7914875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914878">clientConfig</span>&nbsp;<span class="op" id="7914891">:=</span>&nbsp;<span class="op" id="7914894">&amp;</span><span class="ident" id="7914895">Config</span><span class="op" id="7914901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914905">CipherSuites</span><span class="op" id="7914917">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7914925">[</span><span class="op" id="7914926">]</span><span class="builtintype" id="7914927">uint16</span><span class="op" id="7914933">{</span><span class="ident" id="7914934">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7914958">}</span><span class="op" id="7914959">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914963">InsecureSkipVerify</span><span class="op" id="7914981">:</span>&nbsp;<span class="builtintype" id="7914983">true</span><span class="op" id="7914987">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7914991">ClientSessionCache</span><span class="op" id="7915009">:</span>&nbsp;<span class="ident" id="7915011">NewLRUClientSessionCache</span><span class="op" id="7915035">(</span><span class="num" id="7915036">32</span><span class="op" id="7915038">)</span><span class="op" id="7915039">,</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915046">testResumeState</span>&nbsp;<span class="op" id="7915062">:=</span>&nbsp;<span class="keyword" id="7915065">func</span><span class="op" id="7915069">(</span><span class="ident" id="7915070">test</span>&nbsp;<span class="builtintype" id="7915075">string</span><span class="op" id="7915081">,</span>&nbsp;<span class="ident" id="7915083">didResume</span>&nbsp;<span class="builtintype" id="7915093">bool</span><span class="op" id="7915097">)</span>&nbsp;<span class="op" id="7915099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915103">hs</span><span class="op" id="7915105">,</span>&nbsp;<span class="ident" id="7915107">err</span>&nbsp;<span class="op" id="7915111">:=</span>&nbsp;<span class="ident" id="7915114">testHandshake</span><span class="op" id="7915127">(</span><span class="ident" id="7915128">clientConfig</span><span class="op" id="7915140">,</span>&nbsp;<span class="ident" id="7915142">serverConfig</span><span class="op" id="7915154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915158">if</span>&nbsp;<span class="ident" id="7915161">err</span>&nbsp;<span class="op" id="7915165">!=</span>&nbsp;<span class="ident" id="7915168">nil</span>&nbsp;<span class="op" id="7915172">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915177">t</span><span class="op" id="7915178">.</span><span class="ident" id="7915179">Fatalf</span><span class="op" id="7915185">(</span><span class="string" id="7915186">&#34;%s:&nbsp;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7915212">,</span>&nbsp;<span class="ident" id="7915214">test</span><span class="op" id="7915218">,</span>&nbsp;<span class="ident" id="7915220">err</span><span class="op" id="7915223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915231">if</span>&nbsp;<span class="ident" id="7915234">hs</span><span class="op" id="7915236">.</span><span class="ident" id="7915237">DidResume</span>&nbsp;<span class="op" id="7915247">!=</span>&nbsp;<span class="ident" id="7915250">didResume</span>&nbsp;<span class="op" id="7915260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915265">t</span><span class="op" id="7915266">.</span><span class="ident" id="7915267">Fatalf</span><span class="op" id="7915273">(</span><span class="string" id="7915274">&#34;%s&nbsp;resumed:&nbsp;%v,&nbsp;expected:&nbsp;%v&#34;</span><span class="op" id="7915304">,</span>&nbsp;<span class="ident" id="7915306">test</span><span class="op" id="7915310">,</span>&nbsp;<span class="ident" id="7915312">hs</span><span class="op" id="7915314">.</span><span class="ident" id="7915315">DidResume</span><span class="op" id="7915324">,</span>&nbsp;<span class="ident" id="7915326">didResume</span><span class="op" id="7915335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915339">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915346">testResumeState</span><span class="op" id="7915361">(</span><span class="string" id="7915362">&#34;Handshake&#34;</span><span class="op" id="7915373">,</span>&nbsp;<span class="builtintype" id="7915375">false</span><span class="op" id="7915380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915383">testResumeState</span><span class="op" id="7915398">(</span><span class="string" id="7915399">&#34;Resume&#34;</span><span class="op" id="7915407">,</span>&nbsp;<span class="builtintype" id="7915409">true</span><span class="op" id="7915413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7915417">if</span>&nbsp;<span class="ident" id="7915420">_</span><span class="op" id="7915421">,</span>&nbsp;<span class="ident" id="7915423">err</span>&nbsp;<span class="op" id="7915427">:=</span>&nbsp;<span class="ident" id="7915430">io</span><span class="op" id="7915432">.</span><span class="ident" id="7915433">ReadFull</span><span class="op" id="7915441">(</span><span class="ident" id="7915442">serverConfig</span><span class="op" id="7915454">.</span><span class="ident" id="7915455">rand</span><span class="op" id="7915459">(</span><span class="op" id="7915460">)</span><span class="op" id="7915461">,</span>&nbsp;<span class="ident" id="7915463">serverConfig</span><span class="op" id="7915475">.</span><span class="ident" id="7915476">SessionTicketKey</span><span class="op" id="7915492">[</span><span class="op" id="7915493">:</span><span class="op" id="7915494">]</span><span class="op" id="7915495">)</span><span class="op" id="7915496">;</span>&nbsp;<span class="ident" id="7915498">err</span>&nbsp;<span class="op" id="7915502">!=</span>&nbsp;<span class="ident" id="7915505">nil</span>&nbsp;<span class="op" id="7915509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915513">t</span><span class="op" id="7915514">.</span><span class="ident" id="7915515">Fatalf</span><span class="op" id="7915521">(</span><span class="string" id="7915522">&#34;Failed&nbsp;to&nbsp;invalidate&nbsp;SessionTicketKey&#34;</span><span class="op" id="7915561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7915564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915567">testResumeState</span><span class="op" id="7915582">(</span><span class="string" id="7915583">&#34;InvalidSessionTicketKey&#34;</span><span class="op" id="7915608">,</span>&nbsp;<span class="builtintype" id="7915610">false</span><span class="op" id="7915615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915618">testResumeState</span><span class="op" id="7915633">(</span><span class="string" id="7915634">&#34;ResumeAfterInvalidSessionTicketKey&#34;</span><span class="op" id="7915670">,</span>&nbsp;<span class="builtintype" id="7915672">true</span><span class="op" id="7915676">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915680">clientConfig</span><span class="op" id="7915692">.</span><span class="ident" id="7915693">CipherSuites</span>&nbsp;<span class="op" id="7915706">=</span>&nbsp;<span class="op" id="7915708">[</span><span class="op" id="7915709">]</span><span class="builtintype" id="7915710">uint16</span><span class="op" id="7915716">{</span><span class="ident" id="7915717">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="7915747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915750">testResumeState</span><span class="op" id="7915765">(</span><span class="string" id="7915766">&#34;DifferentCipherSuite&#34;</span><span class="op" id="7915788">,</span>&nbsp;<span class="builtintype" id="7915790">false</span><span class="op" id="7915795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915798">testResumeState</span><span class="op" id="7915813">(</span><span class="string" id="7915814">&#34;DifferentCipherSuiteRecovers&#34;</span><span class="op" id="7915844">,</span>&nbsp;<span class="builtintype" id="7915846">true</span><span class="op" id="7915850">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915854">clientConfig</span><span class="op" id="7915866">.</span><span class="ident" id="7915867">ClientSessionCache</span>&nbsp;<span class="op" id="7915886">=</span>&nbsp;<span class="ident" id="7915888">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7915893">testResumeState</span><span class="op" id="7915908">(</span><span class="string" id="7915909">&#34;WithoutSessionCache&#34;</span><span class="op" id="7915930">,</span>&nbsp;<span class="builtintype" id="7915932">false</span><span class="op" id="7915937">)</span><br>
<span class="lineno"></span><span class="op" id="7915939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7915942">func</span>&nbsp;<span class="ident" id="7915947">TestLRUClientSessionCache</span><span class="op" id="7915972">(</span><span class="ident" id="7915973">t</span>&nbsp;<span class="op" id="7915975">*</span><span class="ident" id="7915976">testing</span><span class="op" id="7915983">.</span><span class="ident" id="7915984">T</span><span class="op" id="7915985">)</span>&nbsp;<span class="op" id="7915987">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7915990">//&nbsp;Initialize&nbsp;cache&nbsp;of&nbsp;capacity&nbsp;4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916026">cache</span>&nbsp;<span class="op" id="7916032">:=</span>&nbsp;<span class="ident" id="7916035">NewLRUClientSessionCache</span><span class="op" id="7916059">(</span><span class="num" id="7916060">4</span><span class="op" id="7916061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916064">cs</span>&nbsp;<span class="op" id="7916067">:=</span>&nbsp;<span class="builtinfunc" id="7916070">make</span><span class="op" id="7916074">(</span><span class="op" id="7916075">[</span><span class="op" id="7916076">]</span><span class="ident" id="7916077">ClientSessionState</span><span class="op" id="7916095">,</span>&nbsp;<span class="num" id="7916097">6</span><span class="op" id="7916098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916101">keys</span>&nbsp;<span class="op" id="7916106">:=</span>&nbsp;<span class="op" id="7916109">[</span><span class="op" id="7916110">]</span><span class="builtintype" id="7916111">string</span><span class="op" id="7916117">{</span><span class="string" id="7916118">&#34;0&#34;</span><span class="op" id="7916121">,</span>&nbsp;<span class="string" id="7916123">&#34;1&#34;</span><span class="op" id="7916126">,</span>&nbsp;<span class="string" id="7916128">&#34;2&#34;</span><span class="op" id="7916131">,</span>&nbsp;<span class="string" id="7916133">&#34;3&#34;</span><span class="op" id="7916136">,</span>&nbsp;<span class="string" id="7916138">&#34;4&#34;</span><span class="op" id="7916141">,</span>&nbsp;<span class="string" id="7916143">&#34;5&#34;</span><span class="op" id="7916146">,</span>&nbsp;<span class="string" id="7916148">&#34;6&#34;</span><span class="op" id="7916151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7916155">//&nbsp;Add&nbsp;4&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache&nbsp;and&nbsp;look&nbsp;them&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916204">for</span>&nbsp;<span class="ident" id="7916208">i</span>&nbsp;<span class="op" id="7916210">:=</span>&nbsp;<span class="num" id="7916213">0</span><span class="op" id="7916214">;</span>&nbsp;<span class="ident" id="7916216">i</span>&nbsp;<span class="op" id="7916218">&lt;</span>&nbsp;<span class="num" id="7916220">4</span><span class="op" id="7916221">;</span>&nbsp;<span class="ident" id="7916223">i</span><span class="op" id="7916224">++</span>&nbsp;<span class="op" id="7916227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916231">cache</span><span class="op" id="7916236">.</span><span class="ident" id="7916237">Put</span><span class="op" id="7916240">(</span><span class="ident" id="7916241">keys</span><span class="op" id="7916245">[</span><span class="ident" id="7916246">i</span><span class="op" id="7916247">]</span><span class="op" id="7916248">,</span>&nbsp;<span class="op" id="7916250">&amp;</span><span class="ident" id="7916251">cs</span><span class="op" id="7916253">[</span><span class="ident" id="7916254">i</span><span class="op" id="7916255">]</span><span class="op" id="7916256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916262">for</span>&nbsp;<span class="ident" id="7916266">i</span>&nbsp;<span class="op" id="7916268">:=</span>&nbsp;<span class="num" id="7916271">0</span><span class="op" id="7916272">;</span>&nbsp;<span class="ident" id="7916274">i</span>&nbsp;<span class="op" id="7916276">&lt;</span>&nbsp;<span class="num" id="7916278">4</span><span class="op" id="7916279">;</span>&nbsp;<span class="ident" id="7916281">i</span><span class="op" id="7916282">++</span>&nbsp;<span class="op" id="7916285">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916289">if</span>&nbsp;<span class="ident" id="7916292">s</span><span class="op" id="7916293">,</span>&nbsp;<span class="ident" id="7916295">ok</span>&nbsp;<span class="op" id="7916298">:=</span>&nbsp;<span class="ident" id="7916301">cache</span><span class="op" id="7916306">.</span><span class="ident" id="7916307">Get</span><span class="op" id="7916310">(</span><span class="ident" id="7916311">keys</span><span class="op" id="7916315">[</span><span class="ident" id="7916316">i</span><span class="op" id="7916317">]</span><span class="op" id="7916318">)</span><span class="op" id="7916319">;</span>&nbsp;<span class="op" id="7916321">!</span><span class="ident" id="7916322">ok</span>&nbsp;<span class="op" id="7916325">||</span>&nbsp;<span class="ident" id="7916328">s</span>&nbsp;<span class="op" id="7916330">!=</span>&nbsp;<span class="op" id="7916333">&amp;</span><span class="ident" id="7916334">cs</span><span class="op" id="7916336">[</span><span class="ident" id="7916337">i</span><span class="op" id="7916338">]</span>&nbsp;<span class="op" id="7916340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916345">t</span><span class="op" id="7916346">.</span><span class="ident" id="7916347">Fatalf</span><span class="op" id="7916353">(</span><span class="string" id="7916354">&#34;session&nbsp;cache&nbsp;failed&nbsp;lookup&nbsp;for&nbsp;added&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7916401">,</span>&nbsp;<span class="ident" id="7916403">keys</span><span class="op" id="7916407">[</span><span class="ident" id="7916408">i</span><span class="op" id="7916409">]</span><span class="op" id="7916410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7916421">//&nbsp;Add&nbsp;2&nbsp;more&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache.&nbsp;First&nbsp;2&nbsp;should&nbsp;be&nbsp;evicted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916485">for</span>&nbsp;<span class="ident" id="7916489">i</span>&nbsp;<span class="op" id="7916491">:=</span>&nbsp;<span class="num" id="7916494">4</span><span class="op" id="7916495">;</span>&nbsp;<span class="ident" id="7916497">i</span>&nbsp;<span class="op" id="7916499">&lt;</span>&nbsp;<span class="num" id="7916501">6</span><span class="op" id="7916502">;</span>&nbsp;<span class="ident" id="7916504">i</span><span class="op" id="7916505">++</span>&nbsp;<span class="op" id="7916508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916512">cache</span><span class="op" id="7916517">.</span><span class="ident" id="7916518">Put</span><span class="op" id="7916521">(</span><span class="ident" id="7916522">keys</span><span class="op" id="7916526">[</span><span class="ident" id="7916527">i</span><span class="op" id="7916528">]</span><span class="op" id="7916529">,</span>&nbsp;<span class="op" id="7916531">&amp;</span><span class="ident" id="7916532">cs</span><span class="op" id="7916534">[</span><span class="ident" id="7916535">i</span><span class="op" id="7916536">]</span><span class="op" id="7916537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916543">for</span>&nbsp;<span class="ident" id="7916547">i</span>&nbsp;<span class="op" id="7916549">:=</span>&nbsp;<span class="num" id="7916552">0</span><span class="op" id="7916553">;</span>&nbsp;<span class="ident" id="7916555">i</span>&nbsp;<span class="op" id="7916557">&lt;</span>&nbsp;<span class="num" id="7916559">2</span><span class="op" id="7916560">;</span>&nbsp;<span class="ident" id="7916562">i</span><span class="op" id="7916563">++</span>&nbsp;<span class="op" id="7916566">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916570">if</span>&nbsp;<span class="ident" id="7916573">s</span><span class="op" id="7916574">,</span>&nbsp;<span class="ident" id="7916576">ok</span>&nbsp;<span class="op" id="7916579">:=</span>&nbsp;<span class="ident" id="7916582">cache</span><span class="op" id="7916587">.</span><span class="ident" id="7916588">Get</span><span class="op" id="7916591">(</span><span class="ident" id="7916592">keys</span><span class="op" id="7916596">[</span><span class="ident" id="7916597">i</span><span class="op" id="7916598">]</span><span class="op" id="7916599">)</span><span class="op" id="7916600">;</span>&nbsp;<span class="ident" id="7916602">ok</span>&nbsp;<span class="op" id="7916605">||</span>&nbsp;<span class="ident" id="7916608">s</span>&nbsp;<span class="op" id="7916610">!=</span>&nbsp;<span class="ident" id="7916613">nil</span>&nbsp;<span class="op" id="7916617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916622">t</span><span class="op" id="7916623">.</span><span class="ident" id="7916624">Fatalf</span><span class="op" id="7916630">(</span><span class="string" id="7916631">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7916674">,</span>&nbsp;<span class="ident" id="7916676">keys</span><span class="op" id="7916680">[</span><span class="ident" id="7916681">i</span><span class="op" id="7916682">]</span><span class="op" id="7916683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7916694">//&nbsp;Touch&nbsp;entry&nbsp;2.&nbsp;LRU&nbsp;should&nbsp;evict&nbsp;3&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916738">cache</span><span class="op" id="7916743">.</span><span class="ident" id="7916744">Get</span><span class="op" id="7916747">(</span><span class="ident" id="7916748">keys</span><span class="op" id="7916752">[</span><span class="num" id="7916753">2</span><span class="op" id="7916754">]</span><span class="op" id="7916755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916758">cache</span><span class="op" id="7916763">.</span><span class="ident" id="7916764">Put</span><span class="op" id="7916767">(</span><span class="ident" id="7916768">keys</span><span class="op" id="7916772">[</span><span class="num" id="7916773">0</span><span class="op" id="7916774">]</span><span class="op" id="7916775">,</span>&nbsp;<span class="op" id="7916777">&amp;</span><span class="ident" id="7916778">cs</span><span class="op" id="7916780">[</span><span class="num" id="7916781">0</span><span class="op" id="7916782">]</span><span class="op" id="7916783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916786">if</span>&nbsp;<span class="ident" id="7916789">s</span><span class="op" id="7916790">,</span>&nbsp;<span class="ident" id="7916792">ok</span>&nbsp;<span class="op" id="7916795">:=</span>&nbsp;<span class="ident" id="7916798">cache</span><span class="op" id="7916803">.</span><span class="ident" id="7916804">Get</span><span class="op" id="7916807">(</span><span class="ident" id="7916808">keys</span><span class="op" id="7916812">[</span><span class="num" id="7916813">3</span><span class="op" id="7916814">]</span><span class="op" id="7916815">)</span><span class="op" id="7916816">;</span>&nbsp;<span class="ident" id="7916818">ok</span>&nbsp;<span class="op" id="7916821">||</span>&nbsp;<span class="ident" id="7916824">s</span>&nbsp;<span class="op" id="7916826">!=</span>&nbsp;<span class="ident" id="7916829">nil</span>&nbsp;<span class="op" id="7916833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916837">t</span><span class="op" id="7916838">.</span><span class="ident" id="7916839">Fatalf</span><span class="op" id="7916845">(</span><span class="string" id="7916846">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key&nbsp;3&#34;</span><span class="op" id="7916887">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7916894">//&nbsp;Update&nbsp;entry&nbsp;0&nbsp;in&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916923">cache</span><span class="op" id="7916928">.</span><span class="ident" id="7916929">Put</span><span class="op" id="7916932">(</span><span class="ident" id="7916933">keys</span><span class="op" id="7916937">[</span><span class="num" id="7916938">0</span><span class="op" id="7916939">]</span><span class="op" id="7916940">,</span>&nbsp;<span class="op" id="7916942">&amp;</span><span class="ident" id="7916943">cs</span><span class="op" id="7916945">[</span><span class="num" id="7916946">3</span><span class="op" id="7916947">]</span><span class="op" id="7916948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916951">if</span>&nbsp;<span class="ident" id="7916954">s</span><span class="op" id="7916955">,</span>&nbsp;<span class="ident" id="7916957">ok</span>&nbsp;<span class="op" id="7916960">:=</span>&nbsp;<span class="ident" id="7916963">cache</span><span class="op" id="7916968">.</span><span class="ident" id="7916969">Get</span><span class="op" id="7916972">(</span><span class="ident" id="7916973">keys</span><span class="op" id="7916977">[</span><span class="num" id="7916978">0</span><span class="op" id="7916979">]</span><span class="op" id="7916980">)</span><span class="op" id="7916981">;</span>&nbsp;<span class="op" id="7916983">!</span><span class="ident" id="7916984">ok</span>&nbsp;<span class="op" id="7916987">||</span>&nbsp;<span class="ident" id="7916990">s</span>&nbsp;<span class="op" id="7916992">!=</span>&nbsp;<span class="op" id="7916995">&amp;</span><span class="ident" id="7916996">cs</span><span class="op" id="7916998">[</span><span class="num" id="7916999">3</span><span class="op" id="7917000">]</span>&nbsp;<span class="op" id="7917002">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917006">t</span><span class="op" id="7917007">.</span><span class="ident" id="7917008">Fatalf</span><span class="op" id="7917014">(</span><span class="string" id="7917015">&#34;session&nbsp;cache&nbsp;failed&nbsp;update&nbsp;for&nbsp;key&nbsp;0&#34;</span><span class="op" id="7917054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7917061">//&nbsp;Adding&nbsp;a&nbsp;nil&nbsp;entry&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917094">cache</span><span class="op" id="7917099">.</span><span class="ident" id="7917100">Put</span><span class="op" id="7917103">(</span><span class="ident" id="7917104">keys</span><span class="op" id="7917108">[</span><span class="num" id="7917109">0</span><span class="op" id="7917110">]</span><span class="op" id="7917111">,</span>&nbsp;<span class="ident" id="7917113">nil</span><span class="op" id="7917116">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917119">if</span>&nbsp;<span class="ident" id="7917122">s</span><span class="op" id="7917123">,</span>&nbsp;<span class="ident" id="7917125">ok</span>&nbsp;<span class="op" id="7917128">:=</span>&nbsp;<span class="ident" id="7917131">cache</span><span class="op" id="7917136">.</span><span class="ident" id="7917137">Get</span><span class="op" id="7917140">(</span><span class="ident" id="7917141">keys</span><span class="op" id="7917145">[</span><span class="num" id="7917146">0</span><span class="op" id="7917147">]</span><span class="op" id="7917148">)</span><span class="op" id="7917149">;</span>&nbsp;<span class="op" id="7917151">!</span><span class="ident" id="7917152">ok</span>&nbsp;<span class="op" id="7917155">||</span>&nbsp;<span class="ident" id="7917158">s</span>&nbsp;<span class="op" id="7917160">!=</span>&nbsp;<span class="ident" id="7917163">nil</span>&nbsp;<span class="op" id="7917167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917171">t</span><span class="op" id="7917172">.</span><span class="ident" id="7917173">Fatalf</span><span class="op" id="7917179">(</span><span class="string" id="7917180">&#34;failed&nbsp;to&nbsp;add&nbsp;nil&nbsp;entry&nbsp;to&nbsp;cache&#34;</span><span class="op" id="7917214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917217">}</span><br>
<span class="lineno"></span><span class="op" id="7917219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="7917222">func</span>&nbsp;<span class="ident" id="7917227">TestHandshakeClientALPNMatch</span><span class="op" id="7917255">(</span><span class="ident" id="7917256">t</span>&nbsp;<span class="op" id="7917258">*</span><span class="ident" id="7917259">testing</span><span class="op" id="7917266">.</span><span class="ident" id="7917267">T</span><span class="op" id="7917268">)</span>&nbsp;<span class="op" id="7917270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917273">config</span>&nbsp;<span class="op" id="7917280">:=</span>&nbsp;<span class="op" id="7917283">*</span><span class="ident" id="7917284">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917296">config</span><span class="op" id="7917302">.</span><span class="ident" id="7917303">NextProtos</span>&nbsp;<span class="op" id="7917314">=</span>&nbsp;<span class="op" id="7917316">[</span><span class="op" id="7917317">]</span><span class="builtintype" id="7917318">string</span><span class="op" id="7917324">{</span><span class="string" id="7917325">&#34;proto2&#34;</span><span class="op" id="7917333">,</span>&nbsp;<span class="string" id="7917335">&#34;proto1&#34;</span><span class="op" id="7917343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917347">test</span>&nbsp;<span class="op" id="7917352">:=</span>&nbsp;<span class="op" id="7917355">&amp;</span><span class="ident" id="7917356">clientTest</span><span class="op" id="7917366">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917370">name</span><span class="op" id="7917374">:</span>&nbsp;<span class="string" id="7917376">&#34;ALPN&#34;</span><span class="op" id="7917382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7917386">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7917452">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917495">command</span><span class="op" id="7917502">:</span>&nbsp;<span class="op" id="7917504">[</span><span class="op" id="7917505">]</span><span class="builtintype" id="7917506">string</span><span class="op" id="7917512">{</span><span class="string" id="7917513">&#34;openssl&#34;</span><span class="op" id="7917522">,</span>&nbsp;<span class="string" id="7917524">&#34;s_server&#34;</span><span class="op" id="7917534">,</span>&nbsp;<span class="string" id="7917536">&#34;-alpn&#34;</span><span class="op" id="7917543">,</span>&nbsp;<span class="string" id="7917545">&#34;proto1,proto2&#34;</span><span class="op" id="7917560">}</span><span class="op" id="7917561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917565">config</span><span class="op" id="7917571">:</span>&nbsp;&nbsp;<span class="op" id="7917574">&amp;</span><span class="ident" id="7917575">config</span><span class="op" id="7917581">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917585">validate</span><span class="op" id="7917593">:</span>&nbsp;<span class="keyword" id="7917595">func</span><span class="op" id="7917599">(</span><span class="ident" id="7917600">state</span>&nbsp;<span class="ident" id="7917606">ConnectionState</span><span class="op" id="7917621">)</span>&nbsp;<span class="builtintype" id="7917623">error</span>&nbsp;<span class="op" id="7917629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7917634">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917693">if</span>&nbsp;<span class="ident" id="7917696">state</span><span class="op" id="7917701">.</span><span class="ident" id="7917702">NegotiatedProtocol</span>&nbsp;<span class="op" id="7917721">!=</span>&nbsp;<span class="string" id="7917724">&#34;proto1&#34;</span>&nbsp;<span class="op" id="7917733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917739">return</span>&nbsp;<span class="ident" id="7917746">fmt</span><span class="op" id="7917749">.</span><span class="ident" id="7917750">Errorf</span><span class="op" id="7917756">(</span><span class="string" id="7917757">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="7917789">,</span>&nbsp;<span class="ident" id="7917791">state</span><span class="op" id="7917796">.</span><span class="ident" id="7917797">NegotiatedProtocol</span><span class="op" id="7917815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917820">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917825">return</span>&nbsp;<span class="ident" id="7917832">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917838">}</span><span class="op" id="7917839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917845">runClientTestTLS12</span><span class="op" id="7917863">(</span><span class="ident" id="7917864">t</span><span class="op" id="7917865">,</span>&nbsp;<span class="ident" id="7917867">test</span><span class="op" id="7917871">)</span><br>
<span class="lineno"></span><span class="op" id="7917873">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="7917876">func</span>&nbsp;<span class="ident" id="7917881">TestHandshakeClientALPNNoMatch</span><span class="op" id="7917911">(</span><span class="ident" id="7917912">t</span>&nbsp;<span class="op" id="7917914">*</span><span class="ident" id="7917915">testing</span><span class="op" id="7917922">.</span><span class="ident" id="7917923">T</span><span class="op" id="7917924">)</span>&nbsp;<span class="op" id="7917926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917929">config</span>&nbsp;<span class="op" id="7917936">:=</span>&nbsp;<span class="op" id="7917939">*</span><span class="ident" id="7917940">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917952">config</span><span class="op" id="7917958">.</span><span class="ident" id="7917959">NextProtos</span>&nbsp;<span class="op" id="7917970">=</span>&nbsp;<span class="op" id="7917972">[</span><span class="op" id="7917973">]</span><span class="builtintype" id="7917974">string</span><span class="op" id="7917980">{</span><span class="string" id="7917981">&#34;proto3&#34;</span><span class="op" id="7917989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917993">test</span>&nbsp;<span class="op" id="7917998">:=</span>&nbsp;<span class="op" id="7918001">&amp;</span><span class="ident" id="7918002">clientTest</span><span class="op" id="7918012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918016">name</span><span class="op" id="7918020">:</span>&nbsp;<span class="string" id="7918022">&#34;ALPN-NoMatch&#34;</span><span class="op" id="7918036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7918040">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7918106">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918149">command</span><span class="op" id="7918156">:</span>&nbsp;<span class="op" id="7918158">[</span><span class="op" id="7918159">]</span><span class="builtintype" id="7918160">string</span><span class="op" id="7918166">{</span><span class="string" id="7918167">&#34;openssl&#34;</span><span class="op" id="7918176">,</span>&nbsp;<span class="string" id="7918178">&#34;s_server&#34;</span><span class="op" id="7918188">,</span>&nbsp;<span class="string" id="7918190">&#34;-alpn&#34;</span><span class="op" id="7918197">,</span>&nbsp;<span class="string" id="7918199">&#34;proto1,proto2&#34;</span><span class="op" id="7918214">}</span><span class="op" id="7918215">,</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918219">config</span><span class="op" id="7918225">:</span>&nbsp;&nbsp;<span class="op" id="7918228">&amp;</span><span class="ident" id="7918229">config</span><span class="op" id="7918235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918239">validate</span><span class="op" id="7918247">:</span>&nbsp;<span class="keyword" id="7918249">func</span><span class="op" id="7918253">(</span><span class="ident" id="7918254">state</span>&nbsp;<span class="ident" id="7918260">ConnectionState</span><span class="op" id="7918275">)</span>&nbsp;<span class="builtintype" id="7918277">error</span>&nbsp;<span class="op" id="7918283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7918288">//&nbsp;There&#39;s&nbsp;no&nbsp;overlap&nbsp;so&nbsp;OpenSSL&nbsp;will&nbsp;not&nbsp;select&nbsp;a&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918352">if</span>&nbsp;<span class="ident" id="7918355">state</span><span class="op" id="7918360">.</span><span class="ident" id="7918361">NegotiatedProtocol</span>&nbsp;<span class="op" id="7918380">!=</span>&nbsp;<span class="string" id="7918383">&#34;&#34;</span>&nbsp;<span class="op" id="7918386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918392">return</span>&nbsp;<span class="ident" id="7918399">fmt</span><span class="op" id="7918402">.</span><span class="ident" id="7918403">Errorf</span><span class="op" id="7918409">(</span><span class="string" id="7918410">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="7918438">,</span>&nbsp;<span class="ident" id="7918440">state</span><span class="op" id="7918445">.</span><span class="ident" id="7918446">NegotiatedProtocol</span><span class="op" id="7918464">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918474">return</span>&nbsp;<span class="ident" id="7918481">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918487">}</span><span class="op" id="7918488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918494">runClientTestTLS12</span><span class="op" id="7918512">(</span><span class="ident" id="7918513">t</span><span class="op" id="7918514">,</span>&nbsp;<span class="ident" id="7918516">test</span><span class="op" id="7918520">)</span><br>
<span class="lineno">490</span><span class="op" id="7918522">}</span>
</div>
</body>
</html>
