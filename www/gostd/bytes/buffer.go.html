<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bytes</h2>
<ul>
<li><a href="/gostd/bytes/buffer.go.html" class="current">buffer.go</a></li>
<li><a href="/gostd/bytes/buffer_test.go.html">buffer_test.go</a></li>
<li><a href="/gostd/bytes/bytes.go.html">bytes.go</a></li>
<li><a href="/gostd/bytes/bytes_decl.go.html">bytes_decl.go</a></li>
<li><a href="/gostd/bytes/bytes_test.go.html">bytes_test.go</a></li>
<li><a href="/gostd/bytes/compare_test.go.html">compare_test.go</a></li>
<li><a href="/gostd/bytes/equal_test.go.html">equal_test.go</a></li>
<li><a href="/gostd/bytes/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bytes/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bytes/reader.go.html">reader.go</a></li>
<li><a href="/gostd/bytes/reader_test.go.html">reader_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1848350">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1848405">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1848459">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1848510">package</span>&nbsp;<span class="ident" id="1848518">bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1848525">//&nbsp;Simple&nbsp;byte&nbsp;buffer&nbsp;for&nbsp;marshaling&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1848569">import</span>&nbsp;<span class="op" id="1848576">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1848579">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1848589">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1848595">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="1848610">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1848613">//&nbsp;A&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;variable-sized&nbsp;buffer&nbsp;of&nbsp;bytes&nbsp;with&nbsp;Read&nbsp;and&nbsp;Write&nbsp;methods.</span><br>
<span class="lineno"></span><span class="comment" id="1848690">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Buffer&nbsp;is&nbsp;an&nbsp;empty&nbsp;buffer&nbsp;ready&nbsp;to&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="1848752">type</span>&nbsp;<span class="ident" id="1848757">Buffer</span>&nbsp;<span class="keyword" id="1848764">struct</span>&nbsp;<span class="op" id="1848771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1848774">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1848784">[</span><span class="op" id="1848785">]</span><span class="builtintype" id="1848786">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1848802">//&nbsp;contents&nbsp;are&nbsp;the&nbsp;bytes&nbsp;buf[off&nbsp;:&nbsp;len(buf)]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1848849">off</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1848859">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1848877">//&nbsp;read&nbsp;at&nbsp;&amp;buf[off],&nbsp;write&nbsp;at&nbsp;&amp;buf[len(buf)]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1848924">runeBytes</span>&nbsp;<span class="op" id="1848934">[</span><span class="ident" id="1848935">utf8</span><span class="op" id="1848939">.</span><span class="ident" id="1848940">UTFMax</span><span class="op" id="1848946">]</span><span class="builtintype" id="1848947">byte</span>&nbsp;<span class="comment" id="1848952">//&nbsp;avoid&nbsp;allocation&nbsp;of&nbsp;slice&nbsp;on&nbsp;each&nbsp;WriteByte&nbsp;or&nbsp;Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1849008">bootstrap</span>&nbsp;<span class="op" id="1849018">[</span><span class="num" id="1849019">64</span><span class="op" id="1849021">]</span><span class="builtintype" id="1849022">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1849036">//&nbsp;memory&nbsp;to&nbsp;hold&nbsp;first&nbsp;slice;&nbsp;helps&nbsp;small&nbsp;buffers&nbsp;(Printf)&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1849115">lastRead</span>&nbsp;&nbsp;<span class="ident" id="1849125">readOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1849143">//&nbsp;last&nbsp;read&nbsp;operation,&nbsp;so&nbsp;that&nbsp;Unread*&nbsp;can&nbsp;work&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="op" id="1849203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1849206">//&nbsp;The&nbsp;readOp&nbsp;constants&nbsp;describe&nbsp;the&nbsp;last&nbsp;action&nbsp;performed&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="1849268">//&nbsp;the&nbsp;buffer,&nbsp;so&nbsp;that&nbsp;UnreadRune&nbsp;and&nbsp;UnreadByte&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="1849321">//&nbsp;check&nbsp;for&nbsp;invalid&nbsp;usage.</span><br>
<span class="lineno"></span><span class="keyword" id="1849349">type</span>&nbsp;<span class="ident" id="1849354">readOp</span>&nbsp;<span class="builtintype" id="1849361">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="1849366">const</span>&nbsp;<span class="op" id="1849372">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1849375">opInvalid</span>&nbsp;&nbsp;<span class="ident" id="1849386">readOp</span>&nbsp;<span class="op" id="1849393">=</span>&nbsp;<span class="ident" id="1849395">iota</span>&nbsp;<span class="comment" id="1849400">//&nbsp;Non-read&nbsp;operation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1849424">opReadRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1849449">//&nbsp;Read&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1849464">opRead</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1849489">//&nbsp;Any&nbsp;other&nbsp;read&nbsp;operation.</span><br>
<span class="lineno"></span><span class="op" id="1849518">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1849521">//&nbsp;ErrTooLarge&nbsp;is&nbsp;passed&nbsp;to&nbsp;panic&nbsp;if&nbsp;memory&nbsp;cannot&nbsp;be&nbsp;allocated&nbsp;to&nbsp;store&nbsp;data&nbsp;in&nbsp;a&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1849612">var</span>&nbsp;<span class="ident" id="1849616">ErrTooLarge</span>&nbsp;<span class="op" id="1849628">=</span>&nbsp;<span class="ident" id="1849630">errors</span><span class="op" id="1849636">.</span><span class="ident" id="1849637">New</span><span class="op" id="1849640">(</span><span class="string" id="1849641">&#34;bytes.Buffer:&nbsp;too&nbsp;large&#34;</span><span class="op" id="1849666">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1849669">//&nbsp;Bytes&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno">40</span><span class="comment" id="1849747">//&nbsp;len(b.Bytes())&nbsp;==&nbsp;b.Len().&nbsp;&nbsp;If&nbsp;the&nbsp;caller&nbsp;changes&nbsp;the&nbsp;contents&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1849820">//&nbsp;returned&nbsp;slice,&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;buffer&nbsp;will&nbsp;change&nbsp;provided&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="1849893">//&nbsp;are&nbsp;no&nbsp;intervening&nbsp;method&nbsp;calls&nbsp;on&nbsp;the&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1849943">func</span>&nbsp;<span class="op" id="1849948">(</span><span class="ident" id="1849949">b</span>&nbsp;<span class="op" id="1849951">*</span><span class="ident" id="1849952">Buffer</span><span class="op" id="1849958">)</span>&nbsp;<span class="ident" id="1849960">Bytes</span><span class="op" id="1849965">(</span><span class="op" id="1849966">)</span>&nbsp;<span class="op" id="1849968">[</span><span class="op" id="1849969">]</span><span class="builtintype" id="1849970">byte</span>&nbsp;<span class="op" id="1849975">{</span>&nbsp;<span class="keyword" id="1849977">return</span>&nbsp;<span class="ident" id="1849984">b</span><span class="op" id="1849985">.</span><span class="ident" id="1849986">buf</span><span class="op" id="1849989">[</span><span class="ident" id="1849990">b</span><span class="op" id="1849991">.</span><span class="ident" id="1849992">off</span><span class="op" id="1849995">:</span><span class="op" id="1849996">]</span>&nbsp;<span class="op" id="1849998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="1850001">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="1850068">//&nbsp;as&nbsp;a&nbsp;string.&nbsp;&nbsp;If&nbsp;the&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;it&nbsp;returns&nbsp;&#34;&lt;nil&gt;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="1850137">func</span>&nbsp;<span class="op" id="1850142">(</span><span class="ident" id="1850143">b</span>&nbsp;<span class="op" id="1850145">*</span><span class="ident" id="1850146">Buffer</span><span class="op" id="1850152">)</span>&nbsp;<span class="ident" id="1850154">String</span><span class="op" id="1850160">(</span><span class="op" id="1850161">)</span>&nbsp;<span class="builtintype" id="1850163">string</span>&nbsp;<span class="op" id="1850170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1850173">if</span>&nbsp;<span class="ident" id="1850176">b</span>&nbsp;<span class="op" id="1850178">==</span>&nbsp;<span class="builtintype" id="1850181">nil</span>&nbsp;<span class="op" id="1850185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1850189">//&nbsp;Special&nbsp;case,&nbsp;useful&nbsp;in&nbsp;debugging.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1850229">return</span>&nbsp;<span class="string" id="1850236">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1850245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1850248">return</span>&nbsp;<span class="builtintype" id="1850255">string</span><span class="op" id="1850261">(</span><span class="ident" id="1850262">b</span><span class="op" id="1850263">.</span><span class="ident" id="1850264">buf</span><span class="op" id="1850267">[</span><span class="ident" id="1850268">b</span><span class="op" id="1850269">.</span><span class="ident" id="1850270">off</span><span class="op" id="1850273">:</span><span class="op" id="1850274">]</span><span class="op" id="1850275">)</span><br>
<span class="lineno"></span><span class="op" id="1850277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1850280">//&nbsp;Len&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno"></span><span class="comment" id="1850352">//&nbsp;b.Len()&nbsp;==&nbsp;len(b.Bytes()).</span><br>
<span class="lineno"></span><span class="keyword" id="1850382">func</span>&nbsp;<span class="op" id="1850387">(</span><span class="ident" id="1850388">b</span>&nbsp;<span class="op" id="1850390">*</span><span class="ident" id="1850391">Buffer</span><span class="op" id="1850397">)</span>&nbsp;<span class="ident" id="1850399">Len</span><span class="op" id="1850402">(</span><span class="op" id="1850403">)</span>&nbsp;<span class="builtintype" id="1850405">int</span>&nbsp;<span class="op" id="1850409">{</span>&nbsp;<span class="keyword" id="1850411">return</span>&nbsp;<span class="builtinfunc" id="1850418">len</span><span class="op" id="1850421">(</span><span class="ident" id="1850422">b</span><span class="op" id="1850423">.</span><span class="ident" id="1850424">buf</span><span class="op" id="1850427">)</span>&nbsp;<span class="op" id="1850429">-</span>&nbsp;<span class="ident" id="1850431">b</span><span class="op" id="1850432">.</span><span class="ident" id="1850433">off</span>&nbsp;<span class="op" id="1850437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1850440">//&nbsp;Truncate&nbsp;discards&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;n&nbsp;unread&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">60</span><span class="comment" id="1850511">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;n&nbsp;is&nbsp;negative&nbsp;or&nbsp;greater&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1850583">func</span>&nbsp;<span class="op" id="1850588">(</span><span class="ident" id="1850589">b</span>&nbsp;<span class="op" id="1850591">*</span><span class="ident" id="1850592">Buffer</span><span class="op" id="1850598">)</span>&nbsp;<span class="ident" id="1850600">Truncate</span><span class="op" id="1850608">(</span><span class="ident" id="1850609">n</span>&nbsp;<span class="builtintype" id="1850611">int</span><span class="op" id="1850614">)</span>&nbsp;<span class="op" id="1850616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1850619">b</span><span class="op" id="1850620">.</span><span class="ident" id="1850621">lastRead</span>&nbsp;<span class="op" id="1850630">=</span>&nbsp;<span class="ident" id="1850632">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1850643">switch</span>&nbsp;<span class="op" id="1850650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1850653">case</span>&nbsp;<span class="ident" id="1850658">n</span>&nbsp;<span class="op" id="1850660">&lt;</span>&nbsp;<span class="num" id="1850662">0</span>&nbsp;<span class="op" id="1850664">||</span>&nbsp;<span class="ident" id="1850667">n</span>&nbsp;<span class="op" id="1850669">&gt;</span>&nbsp;<span class="ident" id="1850671">b</span><span class="op" id="1850672">.</span><span class="ident" id="1850673">Len</span><span class="op" id="1850676">(</span><span class="op" id="1850677">)</span><span class="op" id="1850678">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1850682">panic</span><span class="op" id="1850687">(</span><span class="string" id="1850688">&#34;bytes.Buffer:&nbsp;truncation&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1850727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1850730">case</span>&nbsp;<span class="ident" id="1850735">n</span>&nbsp;<span class="op" id="1850737">==</span>&nbsp;<span class="num" id="1850740">0</span><span class="op" id="1850741">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1850745">//&nbsp;Reuse&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1850770">b</span><span class="op" id="1850771">.</span><span class="ident" id="1850772">off</span>&nbsp;<span class="op" id="1850776">=</span>&nbsp;<span class="num" id="1850778">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1850781">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1850784">b</span><span class="op" id="1850785">.</span><span class="ident" id="1850786">buf</span>&nbsp;<span class="op" id="1850790">=</span>&nbsp;<span class="ident" id="1850792">b</span><span class="op" id="1850793">.</span><span class="ident" id="1850794">buf</span><span class="op" id="1850797">[</span><span class="num" id="1850798">0</span>&nbsp;<span class="op" id="1850800">:</span>&nbsp;<span class="ident" id="1850802">b</span><span class="op" id="1850803">.</span><span class="ident" id="1850804">off</span><span class="op" id="1850807">+</span><span class="ident" id="1850808">n</span><span class="op" id="1850809">]</span><br>
<span class="lineno"></span><span class="op" id="1850811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1850814">//&nbsp;Reset&nbsp;resets&nbsp;the&nbsp;buffer&nbsp;so&nbsp;it&nbsp;has&nbsp;no&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="1850863">//&nbsp;b.Reset()&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;b.Truncate(0).</span><br>
<span class="lineno">75</span><span class="keyword" id="1850906">func</span>&nbsp;<span class="op" id="1850911">(</span><span class="ident" id="1850912">b</span>&nbsp;<span class="op" id="1850914">*</span><span class="ident" id="1850915">Buffer</span><span class="op" id="1850921">)</span>&nbsp;<span class="ident" id="1850923">Reset</span><span class="op" id="1850928">(</span><span class="op" id="1850929">)</span>&nbsp;<span class="op" id="1850931">{</span>&nbsp;<span class="ident" id="1850933">b</span><span class="op" id="1850934">.</span><span class="ident" id="1850935">Truncate</span><span class="op" id="1850943">(</span><span class="num" id="1850944">0</span><span class="op" id="1850945">)</span>&nbsp;<span class="op" id="1850947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1850950">//&nbsp;grow&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for&nbsp;n&nbsp;more&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1851012">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;where&nbsp;bytes&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="1851067">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">80</span><span class="keyword" id="1851127">func</span>&nbsp;<span class="op" id="1851132">(</span><span class="ident" id="1851133">b</span>&nbsp;<span class="op" id="1851135">*</span><span class="ident" id="1851136">Buffer</span><span class="op" id="1851142">)</span>&nbsp;<span class="ident" id="1851144">grow</span><span class="op" id="1851148">(</span><span class="ident" id="1851149">n</span>&nbsp;<span class="builtintype" id="1851151">int</span><span class="op" id="1851154">)</span>&nbsp;<span class="builtintype" id="1851156">int</span>&nbsp;<span class="op" id="1851160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1851163">m</span>&nbsp;<span class="op" id="1851165">:=</span>&nbsp;<span class="ident" id="1851168">b</span><span class="op" id="1851169">.</span><span class="ident" id="1851170">Len</span><span class="op" id="1851173">(</span><span class="op" id="1851174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1851177">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1851225">if</span>&nbsp;<span class="ident" id="1851228">m</span>&nbsp;<span class="op" id="1851230">==</span>&nbsp;<span class="num" id="1851233">0</span>&nbsp;<span class="op" id="1851235">&amp;&amp;</span>&nbsp;<span class="ident" id="1851238">b</span><span class="op" id="1851239">.</span><span class="ident" id="1851240">off</span>&nbsp;<span class="op" id="1851244">!=</span>&nbsp;<span class="num" id="1851247">0</span>&nbsp;<span class="op" id="1851249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1851253">b</span><span class="op" id="1851254">.</span><span class="ident" id="1851255">Truncate</span><span class="op" id="1851263">(</span><span class="num" id="1851264">0</span><span class="op" id="1851265">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1851268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1851271">if</span>&nbsp;<span class="builtinfunc" id="1851274">len</span><span class="op" id="1851277">(</span><span class="ident" id="1851278">b</span><span class="op" id="1851279">.</span><span class="ident" id="1851280">buf</span><span class="op" id="1851283">)</span><span class="op" id="1851284">+</span><span class="ident" id="1851285">n</span>&nbsp;<span class="op" id="1851287">&gt;</span>&nbsp;<span class="builtinfunc" id="1851289">cap</span><span class="op" id="1851292">(</span><span class="ident" id="1851293">b</span><span class="op" id="1851294">.</span><span class="ident" id="1851295">buf</span><span class="op" id="1851298">)</span>&nbsp;<span class="op" id="1851300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1851304">var</span>&nbsp;<span class="ident" id="1851308">buf</span>&nbsp;<span class="op" id="1851312">[</span><span class="op" id="1851313">]</span><span class="builtintype" id="1851314">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1851321">if</span>&nbsp;<span class="ident" id="1851324">b</span><span class="op" id="1851325">.</span><span class="ident" id="1851326">buf</span>&nbsp;<span class="op" id="1851330">==</span>&nbsp;<span class="builtintype" id="1851333">nil</span>&nbsp;<span class="op" id="1851337">&amp;&amp;</span>&nbsp;<span class="ident" id="1851340">n</span>&nbsp;<span class="op" id="1851342">&lt;=</span>&nbsp;<span class="builtinfunc" id="1851345">len</span><span class="op" id="1851348">(</span><span class="ident" id="1851349">b</span><span class="op" id="1851350">.</span><span class="ident" id="1851351">bootstrap</span><span class="op" id="1851360">)</span>&nbsp;<span class="op" id="1851362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1851367">buf</span>&nbsp;<span class="op" id="1851371">=</span>&nbsp;<span class="ident" id="1851373">b</span><span class="op" id="1851374">.</span><span class="ident" id="1851375">bootstrap</span><span class="op" id="1851384">[</span><span class="num" id="1851385">0</span><span class="op" id="1851386">:</span><span class="op" id="1851387">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1851391">}</span>&nbsp;<span class="keyword" id="1851393">else</span>&nbsp;<span class="keyword" id="1851398">if</span>&nbsp;<span class="ident" id="1851401">m</span><span class="op" id="1851402">+</span><span class="ident" id="1851403">n</span>&nbsp;<span class="op" id="1851405">&lt;=</span>&nbsp;<span class="builtinfunc" id="1851408">cap</span><span class="op" id="1851411">(</span><span class="ident" id="1851412">b</span><span class="op" id="1851413">.</span><span class="ident" id="1851414">buf</span><span class="op" id="1851417">)</span><span class="op" id="1851418">/</span><span class="num" id="1851419">2</span>&nbsp;<span class="op" id="1851421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1851426">//&nbsp;We&nbsp;can&nbsp;slide&nbsp;things&nbsp;down&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1851485">//&nbsp;slice.&nbsp;We&nbsp;only&nbsp;need&nbsp;m+n&nbsp;&lt;=&nbsp;cap(b.buf)&nbsp;to&nbsp;slide,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1851543">//&nbsp;we&nbsp;instead&nbsp;let&nbsp;capacity&nbsp;get&nbsp;twice&nbsp;as&nbsp;large&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1851598">//&nbsp;don&#39;t&nbsp;spend&nbsp;all&nbsp;our&nbsp;time&nbsp;copying.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1851638">copy</span><span class="op" id="1851642">(</span><span class="ident" id="1851643">b</span><span class="op" id="1851644">.</span><span class="ident" id="1851645">buf</span><span class="op" id="1851648">[</span><span class="op" id="1851649">:</span><span class="op" id="1851650">]</span><span class="op" id="1851651">,</span>&nbsp;<span class="ident" id="1851653">b</span><span class="op" id="1851654">.</span><span class="ident" id="1851655">buf</span><span class="op" id="1851658">[</span><span class="ident" id="1851659">b</span><span class="op" id="1851660">.</span><span class="ident" id="1851661">off</span><span class="op" id="1851664">:</span><span class="op" id="1851665">]</span><span class="op" id="1851666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1851671">buf</span>&nbsp;<span class="op" id="1851675">=</span>&nbsp;<span class="ident" id="1851677">b</span><span class="op" id="1851678">.</span><span class="ident" id="1851679">buf</span><span class="op" id="1851682">[</span><span class="op" id="1851683">:</span><span class="ident" id="1851684">m</span><span class="op" id="1851685">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1851689">}</span>&nbsp;<span class="keyword" id="1851691">else</span>&nbsp;<span class="op" id="1851696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1851701">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;anywhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1851733">buf</span>&nbsp;<span class="op" id="1851737">=</span>&nbsp;<span class="ident" id="1851739">makeSlice</span><span class="op" id="1851748">(</span><span class="num" id="1851749">2</span><span class="op" id="1851750">*</span><span class="builtinfunc" id="1851751">cap</span><span class="op" id="1851754">(</span><span class="ident" id="1851755">b</span><span class="op" id="1851756">.</span><span class="ident" id="1851757">buf</span><span class="op" id="1851760">)</span>&nbsp;<span class="op" id="1851762">+</span>&nbsp;<span class="ident" id="1851764">n</span><span class="op" id="1851765">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1851770">copy</span><span class="op" id="1851774">(</span><span class="ident" id="1851775">buf</span><span class="op" id="1851778">,</span>&nbsp;<span class="ident" id="1851780">b</span><span class="op" id="1851781">.</span><span class="ident" id="1851782">buf</span><span class="op" id="1851785">[</span><span class="ident" id="1851786">b</span><span class="op" id="1851787">.</span><span class="ident" id="1851788">off</span><span class="op" id="1851791">:</span><span class="op" id="1851792">]</span><span class="op" id="1851793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1851797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1851801">b</span><span class="op" id="1851802">.</span><span class="ident" id="1851803">buf</span>&nbsp;<span class="op" id="1851807">=</span>&nbsp;<span class="ident" id="1851809">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1851815">b</span><span class="op" id="1851816">.</span><span class="ident" id="1851817">off</span>&nbsp;<span class="op" id="1851821">=</span>&nbsp;<span class="num" id="1851823">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1851826">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1851829">b</span><span class="op" id="1851830">.</span><span class="ident" id="1851831">buf</span>&nbsp;<span class="op" id="1851835">=</span>&nbsp;<span class="ident" id="1851837">b</span><span class="op" id="1851838">.</span><span class="ident" id="1851839">buf</span><span class="op" id="1851842">[</span><span class="num" id="1851843">0</span>&nbsp;<span class="op" id="1851845">:</span>&nbsp;<span class="ident" id="1851847">b</span><span class="op" id="1851848">.</span><span class="ident" id="1851849">off</span><span class="op" id="1851852">+</span><span class="ident" id="1851853">m</span><span class="op" id="1851854">+</span><span class="ident" id="1851855">n</span><span class="op" id="1851856">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1851859">return</span>&nbsp;<span class="ident" id="1851866">b</span><span class="op" id="1851867">.</span><span class="ident" id="1851868">off</span>&nbsp;<span class="op" id="1851872">+</span>&nbsp;<span class="ident" id="1851874">m</span><br>
<span class="lineno"></span><span class="op" id="1851876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1851879">//&nbsp;Grow&nbsp;grows&nbsp;the&nbsp;buffer&#39;s&nbsp;capacity,&nbsp;if&nbsp;necessary,&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for</span><br>
<span class="lineno">110</span><span class="comment" id="1851953">//&nbsp;another&nbsp;n&nbsp;bytes.&nbsp;After&nbsp;Grow(n),&nbsp;at&nbsp;least&nbsp;n&nbsp;bytes&nbsp;can&nbsp;be&nbsp;written&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1852027">//&nbsp;buffer&nbsp;without&nbsp;another&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="1852065">//&nbsp;If&nbsp;n&nbsp;is&nbsp;negative,&nbsp;Grow&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="comment" id="1852103">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1852163">func</span>&nbsp;<span class="op" id="1852168">(</span><span class="ident" id="1852169">b</span>&nbsp;<span class="op" id="1852171">*</span><span class="ident" id="1852172">Buffer</span><span class="op" id="1852178">)</span>&nbsp;<span class="ident" id="1852180">Grow</span><span class="op" id="1852184">(</span><span class="ident" id="1852185">n</span>&nbsp;<span class="builtintype" id="1852187">int</span><span class="op" id="1852190">)</span>&nbsp;<span class="op" id="1852192">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1852195">if</span>&nbsp;<span class="ident" id="1852198">n</span>&nbsp;<span class="op" id="1852200">&lt;</span>&nbsp;<span class="num" id="1852202">0</span>&nbsp;<span class="op" id="1852204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1852208">panic</span><span class="op" id="1852213">(</span><span class="string" id="1852214">&#34;bytes.Buffer.Grow:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="1852249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1852252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1852255">m</span>&nbsp;<span class="op" id="1852257">:=</span>&nbsp;<span class="ident" id="1852260">b</span><span class="op" id="1852261">.</span><span class="ident" id="1852262">grow</span><span class="op" id="1852266">(</span><span class="ident" id="1852267">n</span><span class="op" id="1852268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1852271">b</span><span class="op" id="1852272">.</span><span class="ident" id="1852273">buf</span>&nbsp;<span class="op" id="1852277">=</span>&nbsp;<span class="ident" id="1852279">b</span><span class="op" id="1852280">.</span><span class="ident" id="1852281">buf</span><span class="op" id="1852284">[</span><span class="num" id="1852285">0</span><span class="op" id="1852286">:</span><span class="ident" id="1852287">m</span><span class="op" id="1852288">]</span><br>
<span class="lineno">120</span><span class="op" id="1852290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1852293">//&nbsp;Write&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1852365">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;p;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1852441">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;Write&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">125</span><span class="keyword" id="1852505">func</span>&nbsp;<span class="op" id="1852510">(</span><span class="ident" id="1852511">b</span>&nbsp;<span class="op" id="1852513">*</span><span class="ident" id="1852514">Buffer</span><span class="op" id="1852520">)</span>&nbsp;<span class="ident" id="1852522">Write</span><span class="op" id="1852527">(</span><span class="ident" id="1852528">p</span>&nbsp;<span class="op" id="1852530">[</span><span class="op" id="1852531">]</span><span class="builtintype" id="1852532">byte</span><span class="op" id="1852536">)</span>&nbsp;<span class="op" id="1852538">(</span><span class="ident" id="1852539">n</span>&nbsp;<span class="builtintype" id="1852541">int</span><span class="op" id="1852544">,</span>&nbsp;<span class="ident" id="1852546">err</span>&nbsp;<span class="builtintype" id="1852550">error</span><span class="op" id="1852555">)</span>&nbsp;<span class="op" id="1852557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1852560">b</span><span class="op" id="1852561">.</span><span class="ident" id="1852562">lastRead</span>&nbsp;<span class="op" id="1852571">=</span>&nbsp;<span class="ident" id="1852573">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1852584">m</span>&nbsp;<span class="op" id="1852586">:=</span>&nbsp;<span class="ident" id="1852589">b</span><span class="op" id="1852590">.</span><span class="ident" id="1852591">grow</span><span class="op" id="1852595">(</span><span class="builtinfunc" id="1852596">len</span><span class="op" id="1852599">(</span><span class="ident" id="1852600">p</span><span class="op" id="1852601">)</span><span class="op" id="1852602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1852605">return</span>&nbsp;<span class="builtinfunc" id="1852612">copy</span><span class="op" id="1852616">(</span><span class="ident" id="1852617">b</span><span class="op" id="1852618">.</span><span class="ident" id="1852619">buf</span><span class="op" id="1852622">[</span><span class="ident" id="1852623">m</span><span class="op" id="1852624">:</span><span class="op" id="1852625">]</span><span class="op" id="1852626">,</span>&nbsp;<span class="ident" id="1852628">p</span><span class="op" id="1852629">)</span><span class="op" id="1852630">,</span>&nbsp;<span class="builtintype" id="1852632">nil</span><br>
<span class="lineno"></span><span class="op" id="1852636">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1852639">//&nbsp;WriteString&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;s&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1852717">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;s;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1852793">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteString&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1852863">func</span>&nbsp;<span class="op" id="1852868">(</span><span class="ident" id="1852869">b</span>&nbsp;<span class="op" id="1852871">*</span><span class="ident" id="1852872">Buffer</span><span class="op" id="1852878">)</span>&nbsp;<span class="ident" id="1852880">WriteString</span><span class="op" id="1852891">(</span><span class="ident" id="1852892">s</span>&nbsp;<span class="builtintype" id="1852894">string</span><span class="op" id="1852900">)</span>&nbsp;<span class="op" id="1852902">(</span><span class="ident" id="1852903">n</span>&nbsp;<span class="builtintype" id="1852905">int</span><span class="op" id="1852908">,</span>&nbsp;<span class="ident" id="1852910">err</span>&nbsp;<span class="builtintype" id="1852914">error</span><span class="op" id="1852919">)</span>&nbsp;<span class="op" id="1852921">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1852924">b</span><span class="op" id="1852925">.</span><span class="ident" id="1852926">lastRead</span>&nbsp;<span class="op" id="1852935">=</span>&nbsp;<span class="ident" id="1852937">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1852948">m</span>&nbsp;<span class="op" id="1852950">:=</span>&nbsp;<span class="ident" id="1852953">b</span><span class="op" id="1852954">.</span><span class="ident" id="1852955">grow</span><span class="op" id="1852959">(</span><span class="builtinfunc" id="1852960">len</span><span class="op" id="1852963">(</span><span class="ident" id="1852964">s</span><span class="op" id="1852965">)</span><span class="op" id="1852966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1852969">return</span>&nbsp;<span class="builtinfunc" id="1852976">copy</span><span class="op" id="1852980">(</span><span class="ident" id="1852981">b</span><span class="op" id="1852982">.</span><span class="ident" id="1852983">buf</span><span class="op" id="1852986">[</span><span class="ident" id="1852987">m</span><span class="op" id="1852988">:</span><span class="op" id="1852989">]</span><span class="op" id="1852990">,</span>&nbsp;<span class="ident" id="1852992">s</span><span class="op" id="1852993">)</span><span class="op" id="1852994">,</span>&nbsp;<span class="builtintype" id="1852996">nil</span><br>
<span class="lineno"></span><span class="op" id="1853000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1853003">//&nbsp;MinRead&nbsp;is&nbsp;the&nbsp;minimum&nbsp;slice&nbsp;size&nbsp;passed&nbsp;to&nbsp;a&nbsp;Read&nbsp;call&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1853065">//&nbsp;Buffer.ReadFrom.&nbsp;&nbsp;As&nbsp;long&nbsp;as&nbsp;the&nbsp;Buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;MinRead&nbsp;bytes&nbsp;beyond</span><br>
<span class="lineno"></span><span class="comment" id="1853142">//&nbsp;what&nbsp;is&nbsp;required&nbsp;to&nbsp;hold&nbsp;the&nbsp;contents&nbsp;of&nbsp;r,&nbsp;ReadFrom&nbsp;will&nbsp;not&nbsp;grow&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1853216">//&nbsp;underlying&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1853238">const</span>&nbsp;<span class="ident" id="1853244">MinRead</span>&nbsp;<span class="op" id="1853252">=</span>&nbsp;<span class="num" id="1853254">512</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1853259">//&nbsp;ReadFrom&nbsp;reads&nbsp;data&nbsp;from&nbsp;r&nbsp;until&nbsp;EOF&nbsp;and&nbsp;appends&nbsp;it&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing</span><br>
<span class="lineno"></span><span class="comment" id="1853337">//&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="1853414">//&nbsp;error&nbsp;except&nbsp;io.EOF&nbsp;encountered&nbsp;during&nbsp;the&nbsp;read&nbsp;is&nbsp;also&nbsp;returned.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1853490">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;ReadFrom&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">150</span><span class="keyword" id="1853557">func</span>&nbsp;<span class="op" id="1853562">(</span><span class="ident" id="1853563">b</span>&nbsp;<span class="op" id="1853565">*</span><span class="ident" id="1853566">Buffer</span><span class="op" id="1853572">)</span>&nbsp;<span class="ident" id="1853574">ReadFrom</span><span class="op" id="1853582">(</span><span class="ident" id="1853583">r</span>&nbsp;<span class="ident" id="1853585">io</span><span class="op" id="1853587">.</span><span class="ident" id="1853588">Reader</span><span class="op" id="1853594">)</span>&nbsp;<span class="op" id="1853596">(</span><span class="ident" id="1853597">n</span>&nbsp;<span class="builtintype" id="1853599">int64</span><span class="op" id="1853604">,</span>&nbsp;<span class="ident" id="1853606">err</span>&nbsp;<span class="builtintype" id="1853610">error</span><span class="op" id="1853615">)</span>&nbsp;<span class="op" id="1853617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1853620">b</span><span class="op" id="1853621">.</span><span class="ident" id="1853622">lastRead</span>&nbsp;<span class="op" id="1853631">=</span>&nbsp;<span class="ident" id="1853633">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1853644">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1853692">if</span>&nbsp;<span class="ident" id="1853695">b</span><span class="op" id="1853696">.</span><span class="ident" id="1853697">off</span>&nbsp;<span class="op" id="1853701">&gt;=</span>&nbsp;<span class="builtinfunc" id="1853704">len</span><span class="op" id="1853707">(</span><span class="ident" id="1853708">b</span><span class="op" id="1853709">.</span><span class="ident" id="1853710">buf</span><span class="op" id="1853713">)</span>&nbsp;<span class="op" id="1853715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1853719">b</span><span class="op" id="1853720">.</span><span class="ident" id="1853721">Truncate</span><span class="op" id="1853729">(</span><span class="num" id="1853730">0</span><span class="op" id="1853731">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1853734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1853737">for</span>&nbsp;<span class="op" id="1853741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1853745">if</span>&nbsp;<span class="ident" id="1853748">free</span>&nbsp;<span class="op" id="1853753">:=</span>&nbsp;<span class="builtinfunc" id="1853756">cap</span><span class="op" id="1853759">(</span><span class="ident" id="1853760">b</span><span class="op" id="1853761">.</span><span class="ident" id="1853762">buf</span><span class="op" id="1853765">)</span>&nbsp;<span class="op" id="1853767">-</span>&nbsp;<span class="builtinfunc" id="1853769">len</span><span class="op" id="1853772">(</span><span class="ident" id="1853773">b</span><span class="op" id="1853774">.</span><span class="ident" id="1853775">buf</span><span class="op" id="1853778">)</span><span class="op" id="1853779">;</span>&nbsp;<span class="ident" id="1853781">free</span>&nbsp;<span class="op" id="1853786">&lt;</span>&nbsp;<span class="ident" id="1853788">MinRead</span>&nbsp;<span class="op" id="1853796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1853801">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;at&nbsp;end</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1853831">newBuf</span>&nbsp;<span class="op" id="1853838">:=</span>&nbsp;<span class="ident" id="1853841">b</span><span class="op" id="1853842">.</span><span class="ident" id="1853843">buf</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1853850">if</span>&nbsp;<span class="ident" id="1853853">b</span><span class="op" id="1853854">.</span><span class="ident" id="1853855">off</span><span class="op" id="1853858">+</span><span class="ident" id="1853859">free</span>&nbsp;<span class="op" id="1853864">&lt;</span>&nbsp;<span class="ident" id="1853866">MinRead</span>&nbsp;<span class="op" id="1853874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1853880">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;using&nbsp;beginning&nbsp;of&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1853931">//&nbsp;double&nbsp;buffer&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1853961">newBuf</span>&nbsp;<span class="op" id="1853968">=</span>&nbsp;<span class="ident" id="1853970">makeSlice</span><span class="op" id="1853979">(</span><span class="num" id="1853980">2</span><span class="op" id="1853981">*</span><span class="builtinfunc" id="1853982">cap</span><span class="op" id="1853985">(</span><span class="ident" id="1853986">b</span><span class="op" id="1853987">.</span><span class="ident" id="1853988">buf</span><span class="op" id="1853991">)</span>&nbsp;<span class="op" id="1853993">+</span>&nbsp;<span class="ident" id="1853995">MinRead</span><span class="op" id="1854002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1854007">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1854012">copy</span><span class="op" id="1854016">(</span><span class="ident" id="1854017">newBuf</span><span class="op" id="1854023">,</span>&nbsp;<span class="ident" id="1854025">b</span><span class="op" id="1854026">.</span><span class="ident" id="1854027">buf</span><span class="op" id="1854030">[</span><span class="ident" id="1854031">b</span><span class="op" id="1854032">.</span><span class="ident" id="1854033">off</span><span class="op" id="1854036">:</span><span class="op" id="1854037">]</span><span class="op" id="1854038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1854043">b</span><span class="op" id="1854044">.</span><span class="ident" id="1854045">buf</span>&nbsp;<span class="op" id="1854049">=</span>&nbsp;<span class="ident" id="1854051">newBuf</span><span class="op" id="1854057">[</span><span class="op" id="1854058">:</span><span class="builtinfunc" id="1854059">len</span><span class="op" id="1854062">(</span><span class="ident" id="1854063">b</span><span class="op" id="1854064">.</span><span class="ident" id="1854065">buf</span><span class="op" id="1854068">)</span><span class="op" id="1854069">-</span><span class="ident" id="1854070">b</span><span class="op" id="1854071">.</span><span class="ident" id="1854072">off</span><span class="op" id="1854075">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1854080">b</span><span class="op" id="1854081">.</span><span class="ident" id="1854082">off</span>&nbsp;<span class="op" id="1854086">=</span>&nbsp;<span class="num" id="1854088">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1854092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1854096">m</span><span class="op" id="1854097">,</span>&nbsp;<span class="ident" id="1854099">e</span>&nbsp;<span class="op" id="1854101">:=</span>&nbsp;<span class="ident" id="1854104">r</span><span class="op" id="1854105">.</span><span class="ident" id="1854106">Read</span><span class="op" id="1854110">(</span><span class="ident" id="1854111">b</span><span class="op" id="1854112">.</span><span class="ident" id="1854113">buf</span><span class="op" id="1854116">[</span><span class="builtinfunc" id="1854117">len</span><span class="op" id="1854120">(</span><span class="ident" id="1854121">b</span><span class="op" id="1854122">.</span><span class="ident" id="1854123">buf</span><span class="op" id="1854126">)</span><span class="op" id="1854127">:</span><span class="builtinfunc" id="1854128">cap</span><span class="op" id="1854131">(</span><span class="ident" id="1854132">b</span><span class="op" id="1854133">.</span><span class="ident" id="1854134">buf</span><span class="op" id="1854137">)</span><span class="op" id="1854138">]</span><span class="op" id="1854139">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1854143">b</span><span class="op" id="1854144">.</span><span class="ident" id="1854145">buf</span>&nbsp;<span class="op" id="1854149">=</span>&nbsp;<span class="ident" id="1854151">b</span><span class="op" id="1854152">.</span><span class="ident" id="1854153">buf</span><span class="op" id="1854156">[</span><span class="num" id="1854157">0</span>&nbsp;<span class="op" id="1854159">:</span>&nbsp;<span class="builtinfunc" id="1854161">len</span><span class="op" id="1854164">(</span><span class="ident" id="1854165">b</span><span class="op" id="1854166">.</span><span class="ident" id="1854167">buf</span><span class="op" id="1854170">)</span><span class="op" id="1854171">+</span><span class="ident" id="1854172">m</span><span class="op" id="1854173">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1854177">n</span>&nbsp;<span class="op" id="1854179">+=</span>&nbsp;<span class="builtintype" id="1854182">int64</span><span class="op" id="1854187">(</span><span class="ident" id="1854188">m</span><span class="op" id="1854189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1854193">if</span>&nbsp;<span class="ident" id="1854196">e</span>&nbsp;<span class="op" id="1854198">==</span>&nbsp;<span class="ident" id="1854201">io</span><span class="op" id="1854203">.</span><span class="ident" id="1854204">EOF</span>&nbsp;<span class="op" id="1854208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1854213">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1854221">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1854225">if</span>&nbsp;<span class="ident" id="1854228">e</span>&nbsp;<span class="op" id="1854230">!=</span>&nbsp;<span class="builtintype" id="1854233">nil</span>&nbsp;<span class="op" id="1854237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1854242">return</span>&nbsp;<span class="ident" id="1854249">n</span><span class="op" id="1854250">,</span>&nbsp;<span class="ident" id="1854252">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1854256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1854259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1854262">return</span>&nbsp;<span class="ident" id="1854269">n</span><span class="op" id="1854270">,</span>&nbsp;<span class="builtintype" id="1854272">nil</span>&nbsp;<span class="comment" id="1854276">//&nbsp;err&nbsp;is&nbsp;EOF,&nbsp;so&nbsp;return&nbsp;nil&nbsp;explicitly</span><br>
<span class="lineno">180</span><span class="op" id="1854316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1854319">//&nbsp;makeSlice&nbsp;allocates&nbsp;a&nbsp;slice&nbsp;of&nbsp;size&nbsp;n.&nbsp;If&nbsp;the&nbsp;allocation&nbsp;fails,&nbsp;it&nbsp;panics</span><br>
<span class="lineno"></span><span class="comment" id="1854396">//&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1854417">func</span>&nbsp;<span class="ident" id="1854422">makeSlice</span><span class="op" id="1854431">(</span><span class="ident" id="1854432">n</span>&nbsp;<span class="builtintype" id="1854434">int</span><span class="op" id="1854437">)</span>&nbsp;<span class="op" id="1854439">[</span><span class="op" id="1854440">]</span><span class="builtintype" id="1854441">byte</span>&nbsp;<span class="op" id="1854446">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1854449">//&nbsp;If&nbsp;the&nbsp;make&nbsp;fails,&nbsp;give&nbsp;a&nbsp;known&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1854492">defer</span>&nbsp;<span class="keyword" id="1854498">func</span><span class="op" id="1854502">(</span><span class="op" id="1854503">)</span>&nbsp;<span class="op" id="1854505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1854509">if</span>&nbsp;<span class="builtinfunc" id="1854512">recover</span><span class="op" id="1854519">(</span><span class="op" id="1854520">)</span>&nbsp;<span class="op" id="1854522">!=</span>&nbsp;<span class="builtintype" id="1854525">nil</span>&nbsp;<span class="op" id="1854529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1854534">panic</span><span class="op" id="1854539">(</span><span class="ident" id="1854540">ErrTooLarge</span><span class="op" id="1854551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1854555">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1854558">}</span><span class="op" id="1854559">(</span><span class="op" id="1854560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1854563">return</span>&nbsp;<span class="builtinfunc" id="1854570">make</span><span class="op" id="1854574">(</span><span class="op" id="1854575">[</span><span class="op" id="1854576">]</span><span class="builtintype" id="1854577">byte</span><span class="op" id="1854581">,</span>&nbsp;<span class="ident" id="1854583">n</span><span class="op" id="1854584">)</span><br>
<span class="lineno"></span><span class="op" id="1854586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1854589">//&nbsp;WriteTo&nbsp;writes&nbsp;data&nbsp;to&nbsp;w&nbsp;until&nbsp;the&nbsp;buffer&nbsp;is&nbsp;drained&nbsp;or&nbsp;an&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno">195</span><span class="comment" id="1854665">//&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written;&nbsp;it&nbsp;always&nbsp;fits&nbsp;into&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="1854742">//&nbsp;int,&nbsp;but&nbsp;it&nbsp;is&nbsp;int64&nbsp;to&nbsp;match&nbsp;the&nbsp;io.WriterTo&nbsp;interface.&nbsp;Any&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="1854812">//&nbsp;encountered&nbsp;during&nbsp;the&nbsp;write&nbsp;is&nbsp;also&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="1854862">func</span>&nbsp;<span class="op" id="1854867">(</span><span class="ident" id="1854868">b</span>&nbsp;<span class="op" id="1854870">*</span><span class="ident" id="1854871">Buffer</span><span class="op" id="1854877">)</span>&nbsp;<span class="ident" id="1854879">WriteTo</span><span class="op" id="1854886">(</span><span class="ident" id="1854887">w</span>&nbsp;<span class="ident" id="1854889">io</span><span class="op" id="1854891">.</span><span class="ident" id="1854892">Writer</span><span class="op" id="1854898">)</span>&nbsp;<span class="op" id="1854900">(</span><span class="ident" id="1854901">n</span>&nbsp;<span class="builtintype" id="1854903">int64</span><span class="op" id="1854908">,</span>&nbsp;<span class="ident" id="1854910">err</span>&nbsp;<span class="builtintype" id="1854914">error</span><span class="op" id="1854919">)</span>&nbsp;<span class="op" id="1854921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1854924">b</span><span class="op" id="1854925">.</span><span class="ident" id="1854926">lastRead</span>&nbsp;<span class="op" id="1854935">=</span>&nbsp;<span class="ident" id="1854937">opInvalid</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1854948">if</span>&nbsp;<span class="ident" id="1854951">b</span><span class="op" id="1854952">.</span><span class="ident" id="1854953">off</span>&nbsp;<span class="op" id="1854957">&lt;</span>&nbsp;<span class="builtinfunc" id="1854959">len</span><span class="op" id="1854962">(</span><span class="ident" id="1854963">b</span><span class="op" id="1854964">.</span><span class="ident" id="1854965">buf</span><span class="op" id="1854968">)</span>&nbsp;<span class="op" id="1854970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1854974">nBytes</span>&nbsp;<span class="op" id="1854981">:=</span>&nbsp;<span class="ident" id="1854984">b</span><span class="op" id="1854985">.</span><span class="ident" id="1854986">Len</span><span class="op" id="1854989">(</span><span class="op" id="1854990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1854994">m</span><span class="op" id="1854995">,</span>&nbsp;<span class="ident" id="1854997">e</span>&nbsp;<span class="op" id="1854999">:=</span>&nbsp;<span class="ident" id="1855002">w</span><span class="op" id="1855003">.</span><span class="ident" id="1855004">Write</span><span class="op" id="1855009">(</span><span class="ident" id="1855010">b</span><span class="op" id="1855011">.</span><span class="ident" id="1855012">buf</span><span class="op" id="1855015">[</span><span class="ident" id="1855016">b</span><span class="op" id="1855017">.</span><span class="ident" id="1855018">off</span><span class="op" id="1855021">:</span><span class="op" id="1855022">]</span><span class="op" id="1855023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1855027">if</span>&nbsp;<span class="ident" id="1855030">m</span>&nbsp;<span class="op" id="1855032">&gt;</span>&nbsp;<span class="ident" id="1855034">nBytes</span>&nbsp;<span class="op" id="1855041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1855046">panic</span><span class="op" id="1855051">(</span><span class="string" id="1855052">&#34;bytes.Buffer.WriteTo:&nbsp;invalid&nbsp;Write&nbsp;count&#34;</span><span class="op" id="1855095">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1855099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1855103">b</span><span class="op" id="1855104">.</span><span class="ident" id="1855105">off</span>&nbsp;<span class="op" id="1855109">+=</span>&nbsp;<span class="ident" id="1855112">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1855116">n</span>&nbsp;<span class="op" id="1855118">=</span>&nbsp;<span class="builtintype" id="1855120">int64</span><span class="op" id="1855125">(</span><span class="ident" id="1855126">m</span><span class="op" id="1855127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1855131">if</span>&nbsp;<span class="ident" id="1855134">e</span>&nbsp;<span class="op" id="1855136">!=</span>&nbsp;<span class="builtintype" id="1855139">nil</span>&nbsp;<span class="op" id="1855143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1855148">return</span>&nbsp;<span class="ident" id="1855155">n</span><span class="op" id="1855156">,</span>&nbsp;<span class="ident" id="1855158">e</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1855162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1855166">//&nbsp;all&nbsp;bytes&nbsp;should&nbsp;have&nbsp;been&nbsp;written,&nbsp;by&nbsp;definition&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1855224">//&nbsp;Write&nbsp;method&nbsp;in&nbsp;io.Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1855255">if</span>&nbsp;<span class="ident" id="1855258">m</span>&nbsp;<span class="op" id="1855260">!=</span>&nbsp;<span class="ident" id="1855263">nBytes</span>&nbsp;<span class="op" id="1855270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1855275">return</span>&nbsp;<span class="ident" id="1855282">n</span><span class="op" id="1855283">,</span>&nbsp;<span class="ident" id="1855285">io</span><span class="op" id="1855287">.</span><span class="ident" id="1855288">ErrShortWrite</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1855304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1855307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1855310">//&nbsp;Buffer&nbsp;is&nbsp;now&nbsp;empty;&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1855342">b</span><span class="op" id="1855343">.</span><span class="ident" id="1855344">Truncate</span><span class="op" id="1855352">(</span><span class="num" id="1855353">0</span><span class="op" id="1855354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1855357">return</span><br>
<span class="lineno">220</span><span class="op" id="1855364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1855367">//&nbsp;WriteByte&nbsp;appends&nbsp;the&nbsp;byte&nbsp;c&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="comment" id="1855444">//&nbsp;The&nbsp;returned&nbsp;error&nbsp;is&nbsp;always&nbsp;nil,&nbsp;but&nbsp;is&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1855521">//&nbsp;WriteByte.&nbsp;If&nbsp;the&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteByte&nbsp;will&nbsp;panic&nbsp;with</span><br>
<span class="lineno">225</span><span class="comment" id="1855594">//&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1855610">func</span>&nbsp;<span class="op" id="1855615">(</span><span class="ident" id="1855616">b</span>&nbsp;<span class="op" id="1855618">*</span><span class="ident" id="1855619">Buffer</span><span class="op" id="1855625">)</span>&nbsp;<span class="ident" id="1855627">WriteByte</span><span class="op" id="1855636">(</span><span class="ident" id="1855637">c</span>&nbsp;<span class="builtintype" id="1855639">byte</span><span class="op" id="1855643">)</span>&nbsp;<span class="builtintype" id="1855645">error</span>&nbsp;<span class="op" id="1855651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1855654">b</span><span class="op" id="1855655">.</span><span class="ident" id="1855656">lastRead</span>&nbsp;<span class="op" id="1855665">=</span>&nbsp;<span class="ident" id="1855667">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1855678">m</span>&nbsp;<span class="op" id="1855680">:=</span>&nbsp;<span class="ident" id="1855683">b</span><span class="op" id="1855684">.</span><span class="ident" id="1855685">grow</span><span class="op" id="1855689">(</span><span class="num" id="1855690">1</span><span class="op" id="1855691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1855694">b</span><span class="op" id="1855695">.</span><span class="ident" id="1855696">buf</span><span class="op" id="1855699">[</span><span class="ident" id="1855700">m</span><span class="op" id="1855701">]</span>&nbsp;<span class="op" id="1855703">=</span>&nbsp;<span class="ident" id="1855705">c</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1855708">return</span>&nbsp;<span class="builtintype" id="1855715">nil</span><br>
<span class="lineno"></span><span class="op" id="1855719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1855722">//&nbsp;WriteRune&nbsp;appends&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1855793">//&nbsp;buffer,&nbsp;returning&nbsp;its&nbsp;length&nbsp;and&nbsp;an&nbsp;error,&nbsp;which&nbsp;is&nbsp;always&nbsp;nil&nbsp;but&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="1855866">//&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s&nbsp;WriteRune.&nbsp;The&nbsp;buffer&nbsp;is&nbsp;grown&nbsp;as&nbsp;needed;</span><br>
<span class="lineno"></span><span class="comment" id="1855944">//&nbsp;if&nbsp;it&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteRune&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="1856011">func</span>&nbsp;<span class="op" id="1856016">(</span><span class="ident" id="1856017">b</span>&nbsp;<span class="op" id="1856019">*</span><span class="ident" id="1856020">Buffer</span><span class="op" id="1856026">)</span>&nbsp;<span class="ident" id="1856028">WriteRune</span><span class="op" id="1856037">(</span><span class="ident" id="1856038">r</span>&nbsp;<span class="builtintype" id="1856040">rune</span><span class="op" id="1856044">)</span>&nbsp;<span class="op" id="1856046">(</span><span class="ident" id="1856047">n</span>&nbsp;<span class="builtintype" id="1856049">int</span><span class="op" id="1856052">,</span>&nbsp;<span class="ident" id="1856054">err</span>&nbsp;<span class="builtintype" id="1856058">error</span><span class="op" id="1856063">)</span>&nbsp;<span class="op" id="1856065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1856068">if</span>&nbsp;<span class="ident" id="1856071">r</span>&nbsp;<span class="op" id="1856073">&lt;</span>&nbsp;<span class="ident" id="1856075">utf8</span><span class="op" id="1856079">.</span><span class="ident" id="1856080">RuneSelf</span>&nbsp;<span class="op" id="1856089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1856093">b</span><span class="op" id="1856094">.</span><span class="ident" id="1856095">WriteByte</span><span class="op" id="1856104">(</span><span class="builtintype" id="1856105">byte</span><span class="op" id="1856109">(</span><span class="ident" id="1856110">r</span><span class="op" id="1856111">)</span><span class="op" id="1856112">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1856116">return</span>&nbsp;<span class="num" id="1856123">1</span><span class="op" id="1856124">,</span>&nbsp;<span class="builtintype" id="1856126">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1856131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1856134">n</span>&nbsp;<span class="op" id="1856136">=</span>&nbsp;<span class="ident" id="1856138">utf8</span><span class="op" id="1856142">.</span><span class="ident" id="1856143">EncodeRune</span><span class="op" id="1856153">(</span><span class="ident" id="1856154">b</span><span class="op" id="1856155">.</span><span class="ident" id="1856156">runeBytes</span><span class="op" id="1856165">[</span><span class="num" id="1856166">0</span><span class="op" id="1856167">:</span><span class="op" id="1856168">]</span><span class="op" id="1856169">,</span>&nbsp;<span class="ident" id="1856171">r</span><span class="op" id="1856172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1856175">b</span><span class="op" id="1856176">.</span><span class="ident" id="1856177">Write</span><span class="op" id="1856182">(</span><span class="ident" id="1856183">b</span><span class="op" id="1856184">.</span><span class="ident" id="1856185">runeBytes</span><span class="op" id="1856194">[</span><span class="num" id="1856195">0</span><span class="op" id="1856196">:</span><span class="ident" id="1856197">n</span><span class="op" id="1856198">]</span><span class="op" id="1856199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1856202">return</span>&nbsp;<span class="ident" id="1856209">n</span><span class="op" id="1856210">,</span>&nbsp;<span class="builtintype" id="1856212">nil</span><br>
<span class="lineno">245</span><span class="op" id="1856216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1856219">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;next&nbsp;len(p)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer&nbsp;or&nbsp;until&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="1856291">//&nbsp;is&nbsp;drained.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1856363">//&nbsp;buffer&nbsp;has&nbsp;no&nbsp;data&nbsp;to&nbsp;return,&nbsp;err&nbsp;is&nbsp;io.EOF&nbsp;(unless&nbsp;len(p)&nbsp;is&nbsp;zero);</span><br>
<span class="lineno">250</span><span class="comment" id="1856435">//&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="1856459">func</span>&nbsp;<span class="op" id="1856464">(</span><span class="ident" id="1856465">b</span>&nbsp;<span class="op" id="1856467">*</span><span class="ident" id="1856468">Buffer</span><span class="op" id="1856474">)</span>&nbsp;<span class="ident" id="1856476">Read</span><span class="op" id="1856480">(</span><span class="ident" id="1856481">p</span>&nbsp;<span class="op" id="1856483">[</span><span class="op" id="1856484">]</span><span class="builtintype" id="1856485">byte</span><span class="op" id="1856489">)</span>&nbsp;<span class="op" id="1856491">(</span><span class="ident" id="1856492">n</span>&nbsp;<span class="builtintype" id="1856494">int</span><span class="op" id="1856497">,</span>&nbsp;<span class="ident" id="1856499">err</span>&nbsp;<span class="builtintype" id="1856503">error</span><span class="op" id="1856508">)</span>&nbsp;<span class="op" id="1856510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1856513">b</span><span class="op" id="1856514">.</span><span class="ident" id="1856515">lastRead</span>&nbsp;<span class="op" id="1856524">=</span>&nbsp;<span class="ident" id="1856526">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1856537">if</span>&nbsp;<span class="ident" id="1856540">b</span><span class="op" id="1856541">.</span><span class="ident" id="1856542">off</span>&nbsp;<span class="op" id="1856546">&gt;=</span>&nbsp;<span class="builtinfunc" id="1856549">len</span><span class="op" id="1856552">(</span><span class="ident" id="1856553">b</span><span class="op" id="1856554">.</span><span class="ident" id="1856555">buf</span><span class="op" id="1856558">)</span>&nbsp;<span class="op" id="1856560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1856564">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1856610">b</span><span class="op" id="1856611">.</span><span class="ident" id="1856612">Truncate</span><span class="op" id="1856620">(</span><span class="num" id="1856621">0</span><span class="op" id="1856622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1856626">if</span>&nbsp;<span class="builtinfunc" id="1856629">len</span><span class="op" id="1856632">(</span><span class="ident" id="1856633">p</span><span class="op" id="1856634">)</span>&nbsp;<span class="op" id="1856636">==</span>&nbsp;<span class="num" id="1856639">0</span>&nbsp;<span class="op" id="1856641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1856646">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1856655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1856659">return</span>&nbsp;<span class="num" id="1856666">0</span><span class="op" id="1856667">,</span>&nbsp;<span class="ident" id="1856669">io</span><span class="op" id="1856671">.</span><span class="ident" id="1856672">EOF</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1856677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1856680">n</span>&nbsp;<span class="op" id="1856682">=</span>&nbsp;<span class="builtinfunc" id="1856684">copy</span><span class="op" id="1856688">(</span><span class="ident" id="1856689">p</span><span class="op" id="1856690">,</span>&nbsp;<span class="ident" id="1856692">b</span><span class="op" id="1856693">.</span><span class="ident" id="1856694">buf</span><span class="op" id="1856697">[</span><span class="ident" id="1856698">b</span><span class="op" id="1856699">.</span><span class="ident" id="1856700">off</span><span class="op" id="1856703">:</span><span class="op" id="1856704">]</span><span class="op" id="1856705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1856708">b</span><span class="op" id="1856709">.</span><span class="ident" id="1856710">off</span>&nbsp;<span class="op" id="1856714">+=</span>&nbsp;<span class="ident" id="1856717">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1856720">if</span>&nbsp;<span class="ident" id="1856723">n</span>&nbsp;<span class="op" id="1856725">&gt;</span>&nbsp;<span class="num" id="1856727">0</span>&nbsp;<span class="op" id="1856729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1856733">b</span><span class="op" id="1856734">.</span><span class="ident" id="1856735">lastRead</span>&nbsp;<span class="op" id="1856744">=</span>&nbsp;<span class="ident" id="1856746">opRead</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1856754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1856757">return</span><br>
<span class="lineno"></span><span class="op" id="1856764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1856767">//&nbsp;Next&nbsp;returns&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer,</span><br>
<span class="lineno">270</span><span class="comment" id="1856836">//&nbsp;advancing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;if&nbsp;the&nbsp;bytes&nbsp;had&nbsp;been&nbsp;returned&nbsp;by&nbsp;Read.</span><br>
<span class="lineno"></span><span class="comment" id="1856903">//&nbsp;If&nbsp;there&nbsp;are&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;Next&nbsp;returns&nbsp;the&nbsp;entire&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1856985">//&nbsp;The&nbsp;slice&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;read&nbsp;or&nbsp;write&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="1857059">func</span>&nbsp;<span class="op" id="1857064">(</span><span class="ident" id="1857065">b</span>&nbsp;<span class="op" id="1857067">*</span><span class="ident" id="1857068">Buffer</span><span class="op" id="1857074">)</span>&nbsp;<span class="ident" id="1857076">Next</span><span class="op" id="1857080">(</span><span class="ident" id="1857081">n</span>&nbsp;<span class="builtintype" id="1857083">int</span><span class="op" id="1857086">)</span>&nbsp;<span class="op" id="1857088">[</span><span class="op" id="1857089">]</span><span class="builtintype" id="1857090">byte</span>&nbsp;<span class="op" id="1857095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1857098">b</span><span class="op" id="1857099">.</span><span class="ident" id="1857100">lastRead</span>&nbsp;<span class="op" id="1857109">=</span>&nbsp;<span class="ident" id="1857111">opInvalid</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1857122">m</span>&nbsp;<span class="op" id="1857124">:=</span>&nbsp;<span class="ident" id="1857127">b</span><span class="op" id="1857128">.</span><span class="ident" id="1857129">Len</span><span class="op" id="1857132">(</span><span class="op" id="1857133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1857136">if</span>&nbsp;<span class="ident" id="1857139">n</span>&nbsp;<span class="op" id="1857141">&gt;</span>&nbsp;<span class="ident" id="1857143">m</span>&nbsp;<span class="op" id="1857145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1857149">n</span>&nbsp;<span class="op" id="1857151">=</span>&nbsp;<span class="ident" id="1857153">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1857156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1857159">data</span>&nbsp;<span class="op" id="1857164">:=</span>&nbsp;<span class="ident" id="1857167">b</span><span class="op" id="1857168">.</span><span class="ident" id="1857169">buf</span><span class="op" id="1857172">[</span><span class="ident" id="1857173">b</span><span class="op" id="1857174">.</span><span class="ident" id="1857175">off</span>&nbsp;<span class="op" id="1857179">:</span>&nbsp;<span class="ident" id="1857181">b</span><span class="op" id="1857182">.</span><span class="ident" id="1857183">off</span><span class="op" id="1857186">+</span><span class="ident" id="1857187">n</span><span class="op" id="1857188">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1857191">b</span><span class="op" id="1857192">.</span><span class="ident" id="1857193">off</span>&nbsp;<span class="op" id="1857197">+=</span>&nbsp;<span class="ident" id="1857200">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1857203">if</span>&nbsp;<span class="ident" id="1857206">n</span>&nbsp;<span class="op" id="1857208">&gt;</span>&nbsp;<span class="num" id="1857210">0</span>&nbsp;<span class="op" id="1857212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1857216">b</span><span class="op" id="1857217">.</span><span class="ident" id="1857218">lastRead</span>&nbsp;<span class="op" id="1857227">=</span>&nbsp;<span class="ident" id="1857229">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1857237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1857240">return</span>&nbsp;<span class="ident" id="1857247">data</span><br>
<span class="lineno">285</span><span class="op" id="1857252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1857255">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1857316">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;it&nbsp;returns&nbsp;error&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="1857369">func</span>&nbsp;<span class="op" id="1857374">(</span><span class="ident" id="1857375">b</span>&nbsp;<span class="op" id="1857377">*</span><span class="ident" id="1857378">Buffer</span><span class="op" id="1857384">)</span>&nbsp;<span class="ident" id="1857386">ReadByte</span><span class="op" id="1857394">(</span><span class="op" id="1857395">)</span>&nbsp;<span class="op" id="1857397">(</span><span class="ident" id="1857398">c</span>&nbsp;<span class="builtintype" id="1857400">byte</span><span class="op" id="1857404">,</span>&nbsp;<span class="ident" id="1857406">err</span>&nbsp;<span class="builtintype" id="1857410">error</span><span class="op" id="1857415">)</span>&nbsp;<span class="op" id="1857417">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1857420">b</span><span class="op" id="1857421">.</span><span class="ident" id="1857422">lastRead</span>&nbsp;<span class="op" id="1857431">=</span>&nbsp;<span class="ident" id="1857433">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1857444">if</span>&nbsp;<span class="ident" id="1857447">b</span><span class="op" id="1857448">.</span><span class="ident" id="1857449">off</span>&nbsp;<span class="op" id="1857453">&gt;=</span>&nbsp;<span class="builtinfunc" id="1857456">len</span><span class="op" id="1857459">(</span><span class="ident" id="1857460">b</span><span class="op" id="1857461">.</span><span class="ident" id="1857462">buf</span><span class="op" id="1857465">)</span>&nbsp;<span class="op" id="1857467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1857471">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1857517">b</span><span class="op" id="1857518">.</span><span class="ident" id="1857519">Truncate</span><span class="op" id="1857527">(</span><span class="num" id="1857528">0</span><span class="op" id="1857529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1857533">return</span>&nbsp;<span class="num" id="1857540">0</span><span class="op" id="1857541">,</span>&nbsp;<span class="ident" id="1857543">io</span><span class="op" id="1857545">.</span><span class="ident" id="1857546">EOF</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1857551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1857554">c</span>&nbsp;<span class="op" id="1857556">=</span>&nbsp;<span class="ident" id="1857558">b</span><span class="op" id="1857559">.</span><span class="ident" id="1857560">buf</span><span class="op" id="1857563">[</span><span class="ident" id="1857564">b</span><span class="op" id="1857565">.</span><span class="ident" id="1857566">off</span><span class="op" id="1857569">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1857572">b</span><span class="op" id="1857573">.</span><span class="ident" id="1857574">off</span><span class="op" id="1857577">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1857581">b</span><span class="op" id="1857582">.</span><span class="ident" id="1857583">lastRead</span>&nbsp;<span class="op" id="1857592">=</span>&nbsp;<span class="ident" id="1857594">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1857602">return</span>&nbsp;<span class="ident" id="1857609">c</span><span class="op" id="1857610">,</span>&nbsp;<span class="builtintype" id="1857612">nil</span><br>
<span class="lineno">300</span><span class="op" id="1857616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1857619">//&nbsp;ReadRune&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;UTF-8-encoded</span><br>
<span class="lineno"></span><span class="comment" id="1857672">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="1857711">//&nbsp;If&nbsp;no&nbsp;bytes&nbsp;are&nbsp;available,&nbsp;the&nbsp;error&nbsp;returned&nbsp;is&nbsp;io.EOF.</span><br>
<span class="lineno">305</span><span class="comment" id="1857771">//&nbsp;If&nbsp;the&nbsp;bytes&nbsp;are&nbsp;an&nbsp;erroneous&nbsp;UTF-8&nbsp;encoding,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1857823">//&nbsp;consumes&nbsp;one&nbsp;byte&nbsp;and&nbsp;returns&nbsp;U+FFFD,&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="1857867">func</span>&nbsp;<span class="op" id="1857872">(</span><span class="ident" id="1857873">b</span>&nbsp;<span class="op" id="1857875">*</span><span class="ident" id="1857876">Buffer</span><span class="op" id="1857882">)</span>&nbsp;<span class="ident" id="1857884">ReadRune</span><span class="op" id="1857892">(</span><span class="op" id="1857893">)</span>&nbsp;<span class="op" id="1857895">(</span><span class="ident" id="1857896">r</span>&nbsp;<span class="builtintype" id="1857898">rune</span><span class="op" id="1857902">,</span>&nbsp;<span class="ident" id="1857904">size</span>&nbsp;<span class="builtintype" id="1857909">int</span><span class="op" id="1857912">,</span>&nbsp;<span class="ident" id="1857914">err</span>&nbsp;<span class="builtintype" id="1857918">error</span><span class="op" id="1857923">)</span>&nbsp;<span class="op" id="1857925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1857928">b</span><span class="op" id="1857929">.</span><span class="ident" id="1857930">lastRead</span>&nbsp;<span class="op" id="1857939">=</span>&nbsp;<span class="ident" id="1857941">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1857952">if</span>&nbsp;<span class="ident" id="1857955">b</span><span class="op" id="1857956">.</span><span class="ident" id="1857957">off</span>&nbsp;<span class="op" id="1857961">&gt;=</span>&nbsp;<span class="builtinfunc" id="1857964">len</span><span class="op" id="1857967">(</span><span class="ident" id="1857968">b</span><span class="op" id="1857969">.</span><span class="ident" id="1857970">buf</span><span class="op" id="1857973">)</span>&nbsp;<span class="op" id="1857975">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1857979">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1858025">b</span><span class="op" id="1858026">.</span><span class="ident" id="1858027">Truncate</span><span class="op" id="1858035">(</span><span class="num" id="1858036">0</span><span class="op" id="1858037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1858041">return</span>&nbsp;<span class="num" id="1858048">0</span><span class="op" id="1858049">,</span>&nbsp;<span class="num" id="1858051">0</span><span class="op" id="1858052">,</span>&nbsp;<span class="ident" id="1858054">io</span><span class="op" id="1858056">.</span><span class="ident" id="1858057">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1858062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1858065">b</span><span class="op" id="1858066">.</span><span class="ident" id="1858067">lastRead</span>&nbsp;<span class="op" id="1858076">=</span>&nbsp;<span class="ident" id="1858078">opReadRune</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1858090">c</span>&nbsp;<span class="op" id="1858092">:=</span>&nbsp;<span class="ident" id="1858095">b</span><span class="op" id="1858096">.</span><span class="ident" id="1858097">buf</span><span class="op" id="1858100">[</span><span class="ident" id="1858101">b</span><span class="op" id="1858102">.</span><span class="ident" id="1858103">off</span><span class="op" id="1858106">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1858109">if</span>&nbsp;<span class="ident" id="1858112">c</span>&nbsp;<span class="op" id="1858114">&lt;</span>&nbsp;<span class="ident" id="1858116">utf8</span><span class="op" id="1858120">.</span><span class="ident" id="1858121">RuneSelf</span>&nbsp;<span class="op" id="1858130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1858134">b</span><span class="op" id="1858135">.</span><span class="ident" id="1858136">off</span><span class="op" id="1858139">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1858144">return</span>&nbsp;<span class="builtintype" id="1858151">rune</span><span class="op" id="1858155">(</span><span class="ident" id="1858156">c</span><span class="op" id="1858157">)</span><span class="op" id="1858158">,</span>&nbsp;<span class="num" id="1858160">1</span><span class="op" id="1858161">,</span>&nbsp;<span class="builtintype" id="1858163">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1858168">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1858171">r</span><span class="op" id="1858172">,</span>&nbsp;<span class="ident" id="1858174">n</span>&nbsp;<span class="op" id="1858176">:=</span>&nbsp;<span class="ident" id="1858179">utf8</span><span class="op" id="1858183">.</span><span class="ident" id="1858184">DecodeRune</span><span class="op" id="1858194">(</span><span class="ident" id="1858195">b</span><span class="op" id="1858196">.</span><span class="ident" id="1858197">buf</span><span class="op" id="1858200">[</span><span class="ident" id="1858201">b</span><span class="op" id="1858202">.</span><span class="ident" id="1858203">off</span><span class="op" id="1858206">:</span><span class="op" id="1858207">]</span><span class="op" id="1858208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1858211">b</span><span class="op" id="1858212">.</span><span class="ident" id="1858213">off</span>&nbsp;<span class="op" id="1858217">+=</span>&nbsp;<span class="ident" id="1858220">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1858223">return</span>&nbsp;<span class="ident" id="1858230">r</span><span class="op" id="1858231">,</span>&nbsp;<span class="ident" id="1858233">n</span><span class="op" id="1858234">,</span>&nbsp;<span class="builtintype" id="1858236">nil</span><br>
<span class="lineno"></span><span class="op" id="1858240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="comment" id="1858243">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune&nbsp;returned&nbsp;by&nbsp;ReadRune.</span><br>
<span class="lineno"></span><span class="comment" id="1858301">//&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;or&nbsp;write&nbsp;operation&nbsp;on&nbsp;the&nbsp;buffer&nbsp;was</span><br>
<span class="lineno"></span><span class="comment" id="1858365">//&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this&nbsp;regard</span><br>
<span class="lineno"></span><span class="comment" id="1858430">//&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="1858497">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno">330</span><span class="keyword" id="1858526">func</span>&nbsp;<span class="op" id="1858531">(</span><span class="ident" id="1858532">b</span>&nbsp;<span class="op" id="1858534">*</span><span class="ident" id="1858535">Buffer</span><span class="op" id="1858541">)</span>&nbsp;<span class="ident" id="1858543">UnreadRune</span><span class="op" id="1858553">(</span><span class="op" id="1858554">)</span>&nbsp;<span class="builtintype" id="1858556">error</span>&nbsp;<span class="op" id="1858562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1858565">if</span>&nbsp;<span class="ident" id="1858568">b</span><span class="op" id="1858569">.</span><span class="ident" id="1858570">lastRead</span>&nbsp;<span class="op" id="1858579">!=</span>&nbsp;<span class="ident" id="1858582">opReadRune</span>&nbsp;<span class="op" id="1858593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1858597">return</span>&nbsp;<span class="ident" id="1858604">errors</span><span class="op" id="1858610">.</span><span class="ident" id="1858611">New</span><span class="op" id="1858614">(</span><span class="string" id="1858615">&#34;bytes.Buffer:&nbsp;UnreadRune:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;ReadRune&#34;</span><span class="op" id="1858678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1858681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1858684">b</span><span class="op" id="1858685">.</span><span class="ident" id="1858686">lastRead</span>&nbsp;<span class="op" id="1858695">=</span>&nbsp;<span class="ident" id="1858697">opInvalid</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1858708">if</span>&nbsp;<span class="ident" id="1858711">b</span><span class="op" id="1858712">.</span><span class="ident" id="1858713">off</span>&nbsp;<span class="op" id="1858717">&gt;</span>&nbsp;<span class="num" id="1858719">0</span>&nbsp;<span class="op" id="1858721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1858725">_</span><span class="op" id="1858726">,</span>&nbsp;<span class="ident" id="1858728">n</span>&nbsp;<span class="op" id="1858730">:=</span>&nbsp;<span class="ident" id="1858733">utf8</span><span class="op" id="1858737">.</span><span class="ident" id="1858738">DecodeLastRune</span><span class="op" id="1858752">(</span><span class="ident" id="1858753">b</span><span class="op" id="1858754">.</span><span class="ident" id="1858755">buf</span><span class="op" id="1858758">[</span><span class="num" id="1858759">0</span><span class="op" id="1858760">:</span><span class="ident" id="1858761">b</span><span class="op" id="1858762">.</span><span class="ident" id="1858763">off</span><span class="op" id="1858766">]</span><span class="op" id="1858767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1858771">b</span><span class="op" id="1858772">.</span><span class="ident" id="1858773">off</span>&nbsp;<span class="op" id="1858777">-=</span>&nbsp;<span class="ident" id="1858780">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1858783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1858786">return</span>&nbsp;<span class="builtintype" id="1858793">nil</span><br>
<span class="lineno">340</span><span class="op" id="1858797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1858800">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte&nbsp;returned&nbsp;by&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span><span class="comment" id="1858864">//&nbsp;read&nbsp;operation.&nbsp;&nbsp;If&nbsp;write&nbsp;has&nbsp;happened&nbsp;since&nbsp;the&nbsp;last&nbsp;read,&nbsp;UnreadByte</span><br>
<span class="lineno"></span><span class="comment" id="1858938">//&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">345</span><span class="keyword" id="1858959">func</span>&nbsp;<span class="op" id="1858964">(</span><span class="ident" id="1858965">b</span>&nbsp;<span class="op" id="1858967">*</span><span class="ident" id="1858968">Buffer</span><span class="op" id="1858974">)</span>&nbsp;<span class="ident" id="1858976">UnreadByte</span><span class="op" id="1858986">(</span><span class="op" id="1858987">)</span>&nbsp;<span class="builtintype" id="1858989">error</span>&nbsp;<span class="op" id="1858995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1858998">if</span>&nbsp;<span class="ident" id="1859001">b</span><span class="op" id="1859002">.</span><span class="ident" id="1859003">lastRead</span>&nbsp;<span class="op" id="1859012">!=</span>&nbsp;<span class="ident" id="1859015">opReadRune</span>&nbsp;<span class="op" id="1859026">&amp;&amp;</span>&nbsp;<span class="ident" id="1859029">b</span><span class="op" id="1859030">.</span><span class="ident" id="1859031">lastRead</span>&nbsp;<span class="op" id="1859040">!=</span>&nbsp;<span class="ident" id="1859043">opRead</span>&nbsp;<span class="op" id="1859050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1859054">return</span>&nbsp;<span class="ident" id="1859061">errors</span><span class="op" id="1859067">.</span><span class="ident" id="1859068">New</span><span class="op" id="1859071">(</span><span class="string" id="1859072">&#34;bytes.Buffer:&nbsp;UnreadByte:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;a&nbsp;read&#34;</span><span class="op" id="1859133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1859136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1859139">b</span><span class="op" id="1859140">.</span><span class="ident" id="1859141">lastRead</span>&nbsp;<span class="op" id="1859150">=</span>&nbsp;<span class="ident" id="1859152">opInvalid</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1859163">if</span>&nbsp;<span class="ident" id="1859166">b</span><span class="op" id="1859167">.</span><span class="ident" id="1859168">off</span>&nbsp;<span class="op" id="1859172">&gt;</span>&nbsp;<span class="num" id="1859174">0</span>&nbsp;<span class="op" id="1859176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1859180">b</span><span class="op" id="1859181">.</span><span class="ident" id="1859182">off</span><span class="op" id="1859185">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1859189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1859192">return</span>&nbsp;<span class="builtintype" id="1859199">nil</span><br>
<span class="lineno"></span><span class="op" id="1859203">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="1859206">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="1859275">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="1859351">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1859415">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">360</span><span class="comment" id="1859497">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1859578">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="keyword" id="1859588">func</span>&nbsp;<span class="op" id="1859593">(</span><span class="ident" id="1859594">b</span>&nbsp;<span class="op" id="1859596">*</span><span class="ident" id="1859597">Buffer</span><span class="op" id="1859603">)</span>&nbsp;<span class="ident" id="1859605">ReadBytes</span><span class="op" id="1859614">(</span><span class="ident" id="1859615">delim</span>&nbsp;<span class="builtintype" id="1859621">byte</span><span class="op" id="1859625">)</span>&nbsp;<span class="op" id="1859627">(</span><span class="ident" id="1859628">line</span>&nbsp;<span class="op" id="1859633">[</span><span class="op" id="1859634">]</span><span class="builtintype" id="1859635">byte</span><span class="op" id="1859639">,</span>&nbsp;<span class="ident" id="1859641">err</span>&nbsp;<span class="builtintype" id="1859645">error</span><span class="op" id="1859650">)</span>&nbsp;<span class="op" id="1859652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1859655">slice</span><span class="op" id="1859660">,</span>&nbsp;<span class="ident" id="1859662">err</span>&nbsp;<span class="op" id="1859666">:=</span>&nbsp;<span class="ident" id="1859669">b</span><span class="op" id="1859670">.</span><span class="ident" id="1859671">readSlice</span><span class="op" id="1859680">(</span><span class="ident" id="1859681">delim</span><span class="op" id="1859686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1859689">//&nbsp;return&nbsp;a&nbsp;copy&nbsp;of&nbsp;slice.&nbsp;The&nbsp;buffer&#39;s&nbsp;backing&nbsp;array&nbsp;may</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1859748">//&nbsp;be&nbsp;overwritten&nbsp;by&nbsp;later&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1859783">line</span>&nbsp;<span class="op" id="1859788">=</span>&nbsp;<span class="builtinfunc" id="1859790">append</span><span class="op" id="1859796">(</span><span class="ident" id="1859797">line</span><span class="op" id="1859801">,</span>&nbsp;<span class="ident" id="1859803">slice</span><span class="op" id="1859808">...</span><span class="op" id="1859811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1859814">return</span><br>
<span class="lineno"></span><span class="op" id="1859821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="comment" id="1859824">//&nbsp;readSlice&nbsp;is&nbsp;like&nbsp;ReadBytes&nbsp;but&nbsp;returns&nbsp;a&nbsp;reference&nbsp;to&nbsp;internal&nbsp;buffer&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="1859904">func</span>&nbsp;<span class="op" id="1859909">(</span><span class="ident" id="1859910">b</span>&nbsp;<span class="op" id="1859912">*</span><span class="ident" id="1859913">Buffer</span><span class="op" id="1859919">)</span>&nbsp;<span class="ident" id="1859921">readSlice</span><span class="op" id="1859930">(</span><span class="ident" id="1859931">delim</span>&nbsp;<span class="builtintype" id="1859937">byte</span><span class="op" id="1859941">)</span>&nbsp;<span class="op" id="1859943">(</span><span class="ident" id="1859944">line</span>&nbsp;<span class="op" id="1859949">[</span><span class="op" id="1859950">]</span><span class="builtintype" id="1859951">byte</span><span class="op" id="1859955">,</span>&nbsp;<span class="ident" id="1859957">err</span>&nbsp;<span class="builtintype" id="1859961">error</span><span class="op" id="1859966">)</span>&nbsp;<span class="op" id="1859968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1859971">i</span>&nbsp;<span class="op" id="1859973">:=</span>&nbsp;<span class="ident" id="1859976">IndexByte</span><span class="op" id="1859985">(</span><span class="ident" id="1859986">b</span><span class="op" id="1859987">.</span><span class="ident" id="1859988">buf</span><span class="op" id="1859991">[</span><span class="ident" id="1859992">b</span><span class="op" id="1859993">.</span><span class="ident" id="1859994">off</span><span class="op" id="1859997">:</span><span class="op" id="1859998">]</span><span class="op" id="1859999">,</span>&nbsp;<span class="ident" id="1860001">delim</span><span class="op" id="1860006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1860009">end</span>&nbsp;<span class="op" id="1860013">:=</span>&nbsp;<span class="ident" id="1860016">b</span><span class="op" id="1860017">.</span><span class="ident" id="1860018">off</span>&nbsp;<span class="op" id="1860022">+</span>&nbsp;<span class="ident" id="1860024">i</span>&nbsp;<span class="op" id="1860026">+</span>&nbsp;<span class="num" id="1860028">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1860031">if</span>&nbsp;<span class="ident" id="1860034">i</span>&nbsp;<span class="op" id="1860036">&lt;</span>&nbsp;<span class="num" id="1860038">0</span>&nbsp;<span class="op" id="1860040">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1860044">end</span>&nbsp;<span class="op" id="1860048">=</span>&nbsp;<span class="builtinfunc" id="1860050">len</span><span class="op" id="1860053">(</span><span class="ident" id="1860054">b</span><span class="op" id="1860055">.</span><span class="ident" id="1860056">buf</span><span class="op" id="1860059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1860063">err</span>&nbsp;<span class="op" id="1860067">=</span>&nbsp;<span class="ident" id="1860069">io</span><span class="op" id="1860071">.</span><span class="ident" id="1860072">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1860077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1860080">line</span>&nbsp;<span class="op" id="1860085">=</span>&nbsp;<span class="ident" id="1860087">b</span><span class="op" id="1860088">.</span><span class="ident" id="1860089">buf</span><span class="op" id="1860092">[</span><span class="ident" id="1860093">b</span><span class="op" id="1860094">.</span><span class="ident" id="1860095">off</span><span class="op" id="1860098">:</span><span class="ident" id="1860099">end</span><span class="op" id="1860102">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1860105">b</span><span class="op" id="1860106">.</span><span class="ident" id="1860107">off</span>&nbsp;<span class="op" id="1860111">=</span>&nbsp;<span class="ident" id="1860113">end</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1860118">b</span><span class="op" id="1860119">.</span><span class="ident" id="1860120">lastRead</span>&nbsp;<span class="op" id="1860129">=</span>&nbsp;<span class="ident" id="1860131">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1860139">return</span>&nbsp;<span class="ident" id="1860146">line</span><span class="op" id="1860150">,</span>&nbsp;<span class="ident" id="1860152">err</span><br>
<span class="lineno"></span><span class="op" id="1860156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1860159">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno">385</span><span class="comment" id="1860229">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="1860306">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="1860371">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="1860453">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="1860532">//&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">390</span><span class="keyword" id="1860545">func</span>&nbsp;<span class="op" id="1860550">(</span><span class="ident" id="1860551">b</span>&nbsp;<span class="op" id="1860553">*</span><span class="ident" id="1860554">Buffer</span><span class="op" id="1860560">)</span>&nbsp;<span class="ident" id="1860562">ReadString</span><span class="op" id="1860572">(</span><span class="ident" id="1860573">delim</span>&nbsp;<span class="builtintype" id="1860579">byte</span><span class="op" id="1860583">)</span>&nbsp;<span class="op" id="1860585">(</span><span class="ident" id="1860586">line</span>&nbsp;<span class="builtintype" id="1860591">string</span><span class="op" id="1860597">,</span>&nbsp;<span class="ident" id="1860599">err</span>&nbsp;<span class="builtintype" id="1860603">error</span><span class="op" id="1860608">)</span>&nbsp;<span class="op" id="1860610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1860613">slice</span><span class="op" id="1860618">,</span>&nbsp;<span class="ident" id="1860620">err</span>&nbsp;<span class="op" id="1860624">:=</span>&nbsp;<span class="ident" id="1860627">b</span><span class="op" id="1860628">.</span><span class="ident" id="1860629">readSlice</span><span class="op" id="1860638">(</span><span class="ident" id="1860639">delim</span><span class="op" id="1860644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1860647">return</span>&nbsp;<span class="builtintype" id="1860654">string</span><span class="op" id="1860660">(</span><span class="ident" id="1860661">slice</span><span class="op" id="1860666">)</span><span class="op" id="1860667">,</span>&nbsp;<span class="ident" id="1860669">err</span><br>
<span class="lineno"></span><span class="op" id="1860673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span><span class="comment" id="1860676">//&nbsp;NewBuffer&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;buf&nbsp;as&nbsp;its&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="1860751">//&nbsp;contents.&nbsp;&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;Buffer&nbsp;to&nbsp;read&nbsp;existing&nbsp;data.&nbsp;&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="1860827">//&nbsp;can&nbsp;also&nbsp;be&nbsp;used&nbsp;to&nbsp;size&nbsp;the&nbsp;internal&nbsp;buffer&nbsp;for&nbsp;writing.&nbsp;To&nbsp;do&nbsp;that,</span><br>
<span class="lineno"></span><span class="comment" id="1860900">//&nbsp;buf&nbsp;should&nbsp;have&nbsp;the&nbsp;desired&nbsp;capacity&nbsp;but&nbsp;a&nbsp;length&nbsp;of&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="1860962">//</span><br>
<span class="lineno">400</span><span class="comment" id="1860965">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1861036">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1861074">func</span>&nbsp;<span class="ident" id="1861079">NewBuffer</span><span class="op" id="1861088">(</span><span class="ident" id="1861089">buf</span>&nbsp;<span class="op" id="1861093">[</span><span class="op" id="1861094">]</span><span class="builtintype" id="1861095">byte</span><span class="op" id="1861099">)</span>&nbsp;<span class="op" id="1861101">*</span><span class="ident" id="1861102">Buffer</span>&nbsp;<span class="op" id="1861109">{</span>&nbsp;<span class="keyword" id="1861111">return</span>&nbsp;<span class="op" id="1861118">&amp;</span><span class="ident" id="1861119">Buffer</span><span class="op" id="1861125">{</span><span class="ident" id="1861126">buf</span><span class="op" id="1861129">:</span>&nbsp;<span class="ident" id="1861131">buf</span><span class="op" id="1861134">}</span>&nbsp;<span class="op" id="1861136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1861139">//&nbsp;NewBufferString&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;string&nbsp;s&nbsp;as&nbsp;its</span><br>
<span class="lineno">405</span><span class="comment" id="1861217">//&nbsp;initial&nbsp;contents.&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;buffer&nbsp;to&nbsp;read&nbsp;an&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="1861293">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="1861304">//</span><br>
<span class="lineno"></span><span class="comment" id="1861307">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1861378">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno">410</span><span class="keyword" id="1861416">func</span>&nbsp;<span class="ident" id="1861421">NewBufferString</span><span class="op" id="1861436">(</span><span class="ident" id="1861437">s</span>&nbsp;<span class="builtintype" id="1861439">string</span><span class="op" id="1861445">)</span>&nbsp;<span class="op" id="1861447">*</span><span class="ident" id="1861448">Buffer</span>&nbsp;<span class="op" id="1861455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1861458">return</span>&nbsp;<span class="op" id="1861465">&amp;</span><span class="ident" id="1861466">Buffer</span><span class="op" id="1861472">{</span><span class="ident" id="1861473">buf</span><span class="op" id="1861476">:</span>&nbsp;<span class="op" id="1861478">[</span><span class="op" id="1861479">]</span><span class="builtintype" id="1861480">byte</span><span class="op" id="1861484">(</span><span class="ident" id="1861485">s</span><span class="op" id="1861486">)</span><span class="op" id="1861487">}</span><br>
<span class="lineno"></span><span class="op" id="1861489">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
