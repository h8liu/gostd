<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2241995">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2242050">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2242104">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2242155">package</span>&nbsp;<span class="ident" id="2242163">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2242167">import</span>&nbsp;<span class="op" id="2242174">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2242177">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2242188">&#34;time&#34;</span><br>
<span class="lineno">10</span><span class="op" id="2242195">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2242198">func</span>&nbsp;<span class="ident" id="2242203">sameFile</span><span class="op" id="2242211">(</span><span class="ident" id="2242212">fs1</span><span class="op" id="2242215">,</span>&nbsp;<span class="ident" id="2242217">fs2</span>&nbsp;<span class="op" id="2242221">*</span><span class="ident" id="2242222">fileStat</span><span class="op" id="2242230">)</span>&nbsp;<span class="builtintype" id="2242232">bool</span>&nbsp;<span class="op" id="2242237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242240">stat1</span>&nbsp;<span class="op" id="2242246">:=</span>&nbsp;<span class="ident" id="2242249">fs1</span><span class="op" id="2242252">.</span><span class="ident" id="2242253">sys</span><span class="op" id="2242256">.</span><span class="op" id="2242257">(</span><span class="op" id="2242258">*</span><span class="ident" id="2242259">syscall</span><span class="op" id="2242266">.</span><span class="ident" id="2242267">Stat_t</span><span class="op" id="2242273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242276">stat2</span>&nbsp;<span class="op" id="2242282">:=</span>&nbsp;<span class="ident" id="2242285">fs2</span><span class="op" id="2242288">.</span><span class="ident" id="2242289">sys</span><span class="op" id="2242292">.</span><span class="op" id="2242293">(</span><span class="op" id="2242294">*</span><span class="ident" id="2242295">syscall</span><span class="op" id="2242302">.</span><span class="ident" id="2242303">Stat_t</span><span class="op" id="2242309">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242312">return</span>&nbsp;<span class="ident" id="2242319">stat1</span><span class="op" id="2242324">.</span><span class="ident" id="2242325">Dev</span>&nbsp;<span class="op" id="2242329">==</span>&nbsp;<span class="ident" id="2242332">stat2</span><span class="op" id="2242337">.</span><span class="ident" id="2242338">Dev</span>&nbsp;<span class="op" id="2242342">&amp;&amp;</span>&nbsp;<span class="ident" id="2242345">stat1</span><span class="op" id="2242350">.</span><span class="ident" id="2242351">Ino</span>&nbsp;<span class="op" id="2242355">==</span>&nbsp;<span class="ident" id="2242358">stat2</span><span class="op" id="2242363">.</span><span class="ident" id="2242364">Ino</span><br>
<span class="lineno"></span><span class="op" id="2242368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2242371">func</span>&nbsp;<span class="ident" id="2242376">fileInfoFromStat</span><span class="op" id="2242392">(</span><span class="ident" id="2242393">st</span>&nbsp;<span class="op" id="2242396">*</span><span class="ident" id="2242397">syscall</span><span class="op" id="2242404">.</span><span class="ident" id="2242405">Stat_t</span><span class="op" id="2242411">,</span>&nbsp;<span class="ident" id="2242413">name</span>&nbsp;<span class="builtintype" id="2242418">string</span><span class="op" id="2242424">)</span>&nbsp;<span class="ident" id="2242426">FileInfo</span>&nbsp;<span class="op" id="2242435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242438">fs</span>&nbsp;<span class="op" id="2242441">:=</span>&nbsp;<span class="op" id="2242444">&amp;</span><span class="ident" id="2242445">fileStat</span><span class="op" id="2242453">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242457">name</span><span class="op" id="2242461">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2242466">basename</span><span class="op" id="2242474">(</span><span class="ident" id="2242475">name</span><span class="op" id="2242479">)</span><span class="op" id="2242480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242484">size</span><span class="op" id="2242488">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2242493">int64</span><span class="op" id="2242498">(</span><span class="ident" id="2242499">st</span><span class="op" id="2242501">.</span><span class="ident" id="2242502">Size</span><span class="op" id="2242506">)</span><span class="op" id="2242507">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242511">modTime</span><span class="op" id="2242518">:</span>&nbsp;<span class="ident" id="2242520">timespecToTime</span><span class="op" id="2242534">(</span><span class="ident" id="2242535">st</span><span class="op" id="2242537">.</span><span class="ident" id="2242538">Mtim</span><span class="op" id="2242542">)</span><span class="op" id="2242543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242547">sys</span><span class="op" id="2242550">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2242556">st</span><span class="op" id="2242558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2242561">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242564">fs</span><span class="op" id="2242566">.</span><span class="ident" id="2242567">mode</span>&nbsp;<span class="op" id="2242572">=</span>&nbsp;<span class="ident" id="2242574">FileMode</span><span class="op" id="2242582">(</span><span class="ident" id="2242583">st</span><span class="op" id="2242585">.</span><span class="ident" id="2242586">Mode</span>&nbsp;<span class="op" id="2242591">&amp;</span>&nbsp;<span class="num" id="2242593">0777</span><span class="op" id="2242597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242600">switch</span>&nbsp;<span class="ident" id="2242607">st</span><span class="op" id="2242609">.</span><span class="ident" id="2242610">Mode</span>&nbsp;<span class="op" id="2242615">&amp;</span>&nbsp;<span class="ident" id="2242617">syscall</span><span class="op" id="2242624">.</span><span class="ident" id="2242625">S_IFMT</span>&nbsp;<span class="op" id="2242632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242635">case</span>&nbsp;<span class="ident" id="2242640">syscall</span><span class="op" id="2242647">.</span><span class="ident" id="2242648">S_IFBLK</span><span class="op" id="2242655">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242659">fs</span><span class="op" id="2242661">.</span><span class="ident" id="2242662">mode</span>&nbsp;<span class="op" id="2242667">|=</span>&nbsp;<span class="ident" id="2242670">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242682">case</span>&nbsp;<span class="ident" id="2242687">syscall</span><span class="op" id="2242694">.</span><span class="ident" id="2242695">S_IFCHR</span><span class="op" id="2242702">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242706">fs</span><span class="op" id="2242708">.</span><span class="ident" id="2242709">mode</span>&nbsp;<span class="op" id="2242714">|=</span>&nbsp;<span class="ident" id="2242717">ModeDevice</span>&nbsp;<span class="op" id="2242728">|</span>&nbsp;<span class="ident" id="2242730">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242746">case</span>&nbsp;<span class="ident" id="2242751">syscall</span><span class="op" id="2242758">.</span><span class="ident" id="2242759">S_IFDIR</span><span class="op" id="2242766">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242770">fs</span><span class="op" id="2242772">.</span><span class="ident" id="2242773">mode</span>&nbsp;<span class="op" id="2242778">|=</span>&nbsp;<span class="ident" id="2242781">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242790">case</span>&nbsp;<span class="ident" id="2242795">syscall</span><span class="op" id="2242802">.</span><span class="ident" id="2242803">S_IFIFO</span><span class="op" id="2242810">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242814">fs</span><span class="op" id="2242816">.</span><span class="ident" id="2242817">mode</span>&nbsp;<span class="op" id="2242822">|=</span>&nbsp;<span class="ident" id="2242825">ModeNamedPipe</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242840">case</span>&nbsp;<span class="ident" id="2242845">syscall</span><span class="op" id="2242852">.</span><span class="ident" id="2242853">S_IFLNK</span><span class="op" id="2242860">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242864">fs</span><span class="op" id="2242866">.</span><span class="ident" id="2242867">mode</span>&nbsp;<span class="op" id="2242872">|=</span>&nbsp;<span class="ident" id="2242875">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242888">case</span>&nbsp;<span class="ident" id="2242893">syscall</span><span class="op" id="2242900">.</span><span class="ident" id="2242901">S_IFREG</span><span class="op" id="2242908">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2242912">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242930">case</span>&nbsp;<span class="ident" id="2242935">syscall</span><span class="op" id="2242942">.</span><span class="ident" id="2242943">S_IFSOCK</span><span class="op" id="2242951">:</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242955">fs</span><span class="op" id="2242957">.</span><span class="ident" id="2242958">mode</span>&nbsp;<span class="op" id="2242963">|=</span>&nbsp;<span class="ident" id="2242966">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2242978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242981">if</span>&nbsp;<span class="ident" id="2242984">st</span><span class="op" id="2242986">.</span><span class="ident" id="2242987">Mode</span><span class="op" id="2242991">&amp;</span><span class="ident" id="2242992">syscall</span><span class="op" id="2242999">.</span><span class="ident" id="2243000">S_ISGID</span>&nbsp;<span class="op" id="2243008">!=</span>&nbsp;<span class="num" id="2243011">0</span>&nbsp;<span class="op" id="2243013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2243017">fs</span><span class="op" id="2243019">.</span><span class="ident" id="2243020">mode</span>&nbsp;<span class="op" id="2243025">|=</span>&nbsp;<span class="ident" id="2243028">ModeSetgid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2243040">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2243043">if</span>&nbsp;<span class="ident" id="2243046">st</span><span class="op" id="2243048">.</span><span class="ident" id="2243049">Mode</span><span class="op" id="2243053">&amp;</span><span class="ident" id="2243054">syscall</span><span class="op" id="2243061">.</span><span class="ident" id="2243062">S_ISUID</span>&nbsp;<span class="op" id="2243070">!=</span>&nbsp;<span class="num" id="2243073">0</span>&nbsp;<span class="op" id="2243075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2243079">fs</span><span class="op" id="2243081">.</span><span class="ident" id="2243082">mode</span>&nbsp;<span class="op" id="2243087">|=</span>&nbsp;<span class="ident" id="2243090">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2243102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2243105">if</span>&nbsp;<span class="ident" id="2243108">st</span><span class="op" id="2243110">.</span><span class="ident" id="2243111">Mode</span><span class="op" id="2243115">&amp;</span><span class="ident" id="2243116">syscall</span><span class="op" id="2243123">.</span><span class="ident" id="2243124">S_ISVTX</span>&nbsp;<span class="op" id="2243132">!=</span>&nbsp;<span class="num" id="2243135">0</span>&nbsp;<span class="op" id="2243137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2243141">fs</span><span class="op" id="2243143">.</span><span class="ident" id="2243144">mode</span>&nbsp;<span class="op" id="2243149">|=</span>&nbsp;<span class="ident" id="2243152">ModeSticky</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2243164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2243167">return</span>&nbsp;<span class="ident" id="2243174">fs</span><br>
<span class="lineno"></span><span class="op" id="2243177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2243180">func</span>&nbsp;<span class="ident" id="2243185">timespecToTime</span><span class="op" id="2243199">(</span><span class="ident" id="2243200">ts</span>&nbsp;<span class="ident" id="2243203">syscall</span><span class="op" id="2243210">.</span><span class="ident" id="2243211">Timespec</span><span class="op" id="2243219">)</span>&nbsp;<span class="ident" id="2243221">time</span><span class="op" id="2243225">.</span><span class="ident" id="2243226">Time</span>&nbsp;<span class="op" id="2243231">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2243234">return</span>&nbsp;<span class="ident" id="2243241">time</span><span class="op" id="2243245">.</span><span class="ident" id="2243246">Unix</span><span class="op" id="2243250">(</span><span class="ident" id="2243251">int64</span><span class="op" id="2243256">(</span><span class="ident" id="2243257">ts</span><span class="op" id="2243259">.</span><span class="ident" id="2243260">Sec</span><span class="op" id="2243263">)</span><span class="op" id="2243264">,</span>&nbsp;<span class="ident" id="2243266">int64</span><span class="op" id="2243271">(</span><span class="ident" id="2243272">ts</span><span class="op" id="2243274">.</span><span class="ident" id="2243275">Nsec</span><span class="op" id="2243279">)</span><span class="op" id="2243280">)</span><br>
<span class="lineno"></span><span class="op" id="2243282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2243285">//&nbsp;For&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="2243301">func</span>&nbsp;<span class="ident" id="2243306">atime</span><span class="op" id="2243311">(</span><span class="ident" id="2243312">fi</span>&nbsp;<span class="ident" id="2243315">FileInfo</span><span class="op" id="2243323">)</span>&nbsp;<span class="ident" id="2243325">time</span><span class="op" id="2243329">.</span><span class="ident" id="2243330">Time</span>&nbsp;<span class="op" id="2243335">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2243338">return</span>&nbsp;<span class="ident" id="2243345">timespecToTime</span><span class="op" id="2243359">(</span><span class="ident" id="2243360">fi</span><span class="op" id="2243362">.</span><span class="ident" id="2243363">Sys</span><span class="op" id="2243366">(</span><span class="op" id="2243367">)</span><span class="op" id="2243368">.</span><span class="op" id="2243369">(</span><span class="op" id="2243370">*</span><span class="ident" id="2243371">syscall</span><span class="op" id="2243378">.</span><span class="ident" id="2243379">Stat_t</span><span class="op" id="2243385">)</span><span class="op" id="2243386">.</span><span class="ident" id="2243387">Atim</span><span class="op" id="2243391">)</span><br>
<span class="lineno"></span><span class="op" id="2243393">}</span>
</div>
</body>
</html>
