<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4448229">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4448284">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4448338">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4448389">package</span>&nbsp;<span class="ident" id="4448397">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4448407">import</span>&nbsp;<span class="op" id="4448414">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4448417">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4448426">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4448433">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4448444">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4448459">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4448462">//&nbsp;htmlNospaceEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;unquoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno">15</span><span class="keyword" id="4448536">func</span>&nbsp;<span class="ident" id="4448541">htmlNospaceEscaper</span><span class="op" id="4448559">(</span><span class="ident" id="4448560">args</span>&nbsp;<span class="op" id="4448565">...</span><span class="keyword" id="4448568">interface</span><span class="op" id="4448577">{</span><span class="op" id="4448578">}</span><span class="op" id="4448579">)</span>&nbsp;<span class="builtintype" id="4448581">string</span>&nbsp;<span class="op" id="4448588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448591">s</span><span class="op" id="4448592">,</span>&nbsp;<span class="ident" id="4448594">t</span>&nbsp;<span class="op" id="4448596">:=</span>&nbsp;<span class="ident" id="4448599"><a href="/html/template/content.go.html#4391261">stringify</a></span><span class="op" id="4448608">(</span><span class="ident" id="4448609"><a href="/html/template/html.go.html#4448560">args</a></span><span class="op" id="4448613">...</span><span class="op" id="4448616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448619">if</span>&nbsp;<span class="ident" id="4448622"><a href="/html/template/html.go.html#4448594">t</a></span>&nbsp;<span class="op" id="4448624">==</span>&nbsp;<span class="ident" id="4448627"><a href="/html/template/content.go.html#4389793">contentTypeHTML</a></span>&nbsp;<span class="op" id="4448643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448647">return</span>&nbsp;<span class="ident" id="4448654"><a href="/html/template/html.go.html#4452159">htmlReplacer</a></span><span class="op" id="4448666">(</span><span class="ident" id="4448667"><a href="/html/template/html.go.html#4453047">stripTags</a></span><span class="op" id="4448676">(</span><span class="ident" id="4448677"><a href="/html/template/html.go.html#4448591">s</a></span><span class="op" id="4448678">)</span><span class="op" id="4448679">,</span>&nbsp;<span class="ident" id="4448681"><a href="/html/template/html.go.html#4451596">htmlNospaceNormReplacementTable</a></span><span class="op" id="4448712">,</span>&nbsp;<span class="builtintype" id="4448714">false</span><span class="op" id="4448719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4448722">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448725">return</span>&nbsp;<span class="ident" id="4448732"><a href="/html/template/html.go.html#4452159">htmlReplacer</a></span><span class="op" id="4448744">(</span><span class="ident" id="4448745"><a href="/html/template/html.go.html#4448591">s</a></span><span class="op" id="4448746">,</span>&nbsp;<span class="ident" id="4448748"><a href="/html/template/html.go.html#4451045">htmlNospaceReplacementTable</a></span><span class="op" id="4448775">,</span>&nbsp;<span class="builtintype" id="4448777">false</span><span class="op" id="4448782">)</span><br>
<span class="lineno"></span><span class="op" id="4448784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4448787">//&nbsp;attrEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;quoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4448852">func</span>&nbsp;<span class="ident" id="4448857">attrEscaper</span><span class="op" id="4448868">(</span><span class="ident" id="4448869">args</span>&nbsp;<span class="op" id="4448874">...</span><span class="keyword" id="4448877">interface</span><span class="op" id="4448886">{</span><span class="op" id="4448887">}</span><span class="op" id="4448888">)</span>&nbsp;<span class="builtintype" id="4448890">string</span>&nbsp;<span class="op" id="4448897">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448900">s</span><span class="op" id="4448901">,</span>&nbsp;<span class="ident" id="4448903">t</span>&nbsp;<span class="op" id="4448905">:=</span>&nbsp;<span class="ident" id="4448908"><a href="/html/template/content.go.html#4391261">stringify</a></span><span class="op" id="4448917">(</span><span class="ident" id="4448918"><a href="/html/template/html.go.html#4448869">args</a></span><span class="op" id="4448922">...</span><span class="op" id="4448925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448928">if</span>&nbsp;<span class="ident" id="4448931"><a href="/html/template/html.go.html#4448903">t</a></span>&nbsp;<span class="op" id="4448933">==</span>&nbsp;<span class="ident" id="4448936"><a href="/html/template/content.go.html#4389793">contentTypeHTML</a></span>&nbsp;<span class="op" id="4448952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448956">return</span>&nbsp;<span class="ident" id="4448963"><a href="/html/template/html.go.html#4452159">htmlReplacer</a></span><span class="op" id="4448975">(</span><span class="ident" id="4448976"><a href="/html/template/html.go.html#4453047">stripTags</a></span><span class="op" id="4448985">(</span><span class="ident" id="4448986"><a href="/html/template/html.go.html#4448900">s</a></span><span class="op" id="4448987">)</span><span class="op" id="4448988">,</span>&nbsp;<span class="ident" id="4448990"><a href="/html/template/html.go.html#4450268">htmlNormReplacementTable</a></span><span class="op" id="4449014">,</span>&nbsp;<span class="builtintype" id="4449016">true</span><span class="op" id="4449020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449026">return</span>&nbsp;<span class="ident" id="4449033"><a href="/html/template/html.go.html#4452159">htmlReplacer</a></span><span class="op" id="4449045">(</span><span class="ident" id="4449046"><a href="/html/template/html.go.html#4448900">s</a></span><span class="op" id="4449047">,</span>&nbsp;<span class="ident" id="4449049"><a href="/html/template/html.go.html#4449712">htmlReplacementTable</a></span><span class="op" id="4449069">,</span>&nbsp;<span class="builtintype" id="4449071">true</span><span class="op" id="4449075">)</span><br>
<span class="lineno">30</span><span class="op" id="4449077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4449080">//&nbsp;rcdataEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;RCDATA&nbsp;element&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="4449146">func</span>&nbsp;<span class="ident" id="4449151">rcdataEscaper</span><span class="op" id="4449164">(</span><span class="ident" id="4449165">args</span>&nbsp;<span class="op" id="4449170">...</span><span class="keyword" id="4449173">interface</span><span class="op" id="4449182">{</span><span class="op" id="4449183">}</span><span class="op" id="4449184">)</span>&nbsp;<span class="builtintype" id="4449186">string</span>&nbsp;<span class="op" id="4449193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449196">s</span><span class="op" id="4449197">,</span>&nbsp;<span class="ident" id="4449199">t</span>&nbsp;<span class="op" id="4449201">:=</span>&nbsp;<span class="ident" id="4449204"><a href="/html/template/content.go.html#4391261">stringify</a></span><span class="op" id="4449213">(</span><span class="ident" id="4449214"><a href="/html/template/html.go.html#4449165">args</a></span><span class="op" id="4449218">...</span><span class="op" id="4449221">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449224">if</span>&nbsp;<span class="ident" id="4449227"><a href="/html/template/html.go.html#4449199">t</a></span>&nbsp;<span class="op" id="4449229">==</span>&nbsp;<span class="ident" id="4449232"><a href="/html/template/content.go.html#4389793">contentTypeHTML</a></span>&nbsp;<span class="op" id="4449248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449252">return</span>&nbsp;<span class="ident" id="4449259"><a href="/html/template/html.go.html#4452159">htmlReplacer</a></span><span class="op" id="4449271">(</span><span class="ident" id="4449272"><a href="/html/template/html.go.html#4449196">s</a></span><span class="op" id="4449273">,</span>&nbsp;<span class="ident" id="4449275"><a href="/html/template/html.go.html#4450268">htmlNormReplacementTable</a></span><span class="op" id="4449299">,</span>&nbsp;<span class="builtintype" id="4449301">true</span><span class="op" id="4449305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449311">return</span>&nbsp;<span class="ident" id="4449318"><a href="/html/template/html.go.html#4452159">htmlReplacer</a></span><span class="op" id="4449330">(</span><span class="ident" id="4449331"><a href="/html/template/html.go.html#4449196">s</a></span><span class="op" id="4449332">,</span>&nbsp;<span class="ident" id="4449334"><a href="/html/template/html.go.html#4449712">htmlReplacementTable</a></span><span class="op" id="4449354">,</span>&nbsp;<span class="builtintype" id="4449356">true</span><span class="op" id="4449360">)</span><br>
<span class="lineno"></span><span class="op" id="4449362">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="4449365">//&nbsp;htmlEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="4449416">func</span>&nbsp;<span class="ident" id="4449421">htmlEscaper</span><span class="op" id="4449432">(</span><span class="ident" id="4449433">args</span>&nbsp;<span class="op" id="4449438">...</span><span class="keyword" id="4449441">interface</span><span class="op" id="4449450">{</span><span class="op" id="4449451">}</span><span class="op" id="4449452">)</span>&nbsp;<span class="builtintype" id="4449454">string</span>&nbsp;<span class="op" id="4449461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449464">s</span><span class="op" id="4449465">,</span>&nbsp;<span class="ident" id="4449467">t</span>&nbsp;<span class="op" id="4449469">:=</span>&nbsp;<span class="ident" id="4449472"><a href="/html/template/content.go.html#4391261">stringify</a></span><span class="op" id="4449481">(</span><span class="ident" id="4449482"><a href="/html/template/html.go.html#4449433">args</a></span><span class="op" id="4449486">...</span><span class="op" id="4449489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449492">if</span>&nbsp;<span class="ident" id="4449495"><a href="/html/template/html.go.html#4449467">t</a></span>&nbsp;<span class="op" id="4449497">==</span>&nbsp;<span class="ident" id="4449500"><a href="/html/template/content.go.html#4389793">contentTypeHTML</a></span>&nbsp;<span class="op" id="4449516">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449520">return</span>&nbsp;<span class="ident" id="4449527"><a href="/html/template/html.go.html#4449464">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449533">return</span>&nbsp;<span class="ident" id="4449540"><a href="/html/template/html.go.html#4452159">htmlReplacer</a></span><span class="op" id="4449552">(</span><span class="ident" id="4449553"><a href="/html/template/html.go.html#4449464">s</a></span><span class="op" id="4449554">,</span>&nbsp;<span class="ident" id="4449556"><a href="/html/template/html.go.html#4449712">htmlReplacementTable</a></span><span class="op" id="4449576">,</span>&nbsp;<span class="builtintype" id="4449578">true</span><span class="op" id="4449582">)</span><br>
<span class="lineno"></span><span class="op" id="4449584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4449587">//&nbsp;htmlReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno"></span><span class="comment" id="4449654">//&nbsp;inside&nbsp;a&nbsp;quoted&nbsp;attribute&nbsp;value&nbsp;or&nbsp;in&nbsp;a&nbsp;text&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4449708">var</span>&nbsp;<span class="ident" id="4449712">htmlReplacementTable</span>&nbsp;<span class="op" id="4449733">=</span>&nbsp;<span class="op" id="4449735">[</span><span class="op" id="4449736">]</span><span class="builtintype" id="4449737">string</span><span class="op" id="4449743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4449746">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4449822">//&nbsp;U+0000&nbsp;NULL&nbsp;Parse&nbsp;error.&nbsp;Append&nbsp;a&nbsp;U+FFFD&nbsp;REPLACEMENT</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4449879">//&nbsp;CHARACTER&nbsp;character&nbsp;to&nbsp;the&nbsp;current&nbsp;attribute&#39;s&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4449937">//&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4449943">//&nbsp;and&nbsp;similarly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4449961">//&nbsp;http://www.w3.org/TR/html5/syntax.html#before-attribute-value-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4450033">0</span><span class="op" id="4450034">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4450039">&#34;\uFFFD&#34;</span><span class="op" id="4450047">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4450050">&#39;&#34;&#39;</span><span class="op" id="4450053">:</span>&nbsp;&nbsp;<span class="string" id="4450056">&#34;&amp;#34;&#34;</span><span class="op" id="4450063">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4450066">&#39;&amp;&#39;</span><span class="op" id="4450069">:</span>&nbsp;&nbsp;<span class="string" id="4450072">&#34;&amp;amp;&#34;</span><span class="op" id="4450079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4450082">&#39;\&#39;&#39;</span><span class="op" id="4450086">:</span>&nbsp;<span class="string" id="4450088">&#34;&amp;#39;&#34;</span><span class="op" id="4450095">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4450098">&#39;+&#39;</span><span class="op" id="4450101">:</span>&nbsp;&nbsp;<span class="string" id="4450104">&#34;&amp;#43;&#34;</span><span class="op" id="4450111">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4450114">&#39;&lt;&#39;</span><span class="op" id="4450117">:</span>&nbsp;&nbsp;<span class="string" id="4450120">&#34;&amp;lt;&#34;</span><span class="op" id="4450126">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4450129">&#39;&gt;&#39;</span><span class="op" id="4450132">:</span>&nbsp;&nbsp;<span class="string" id="4450135">&#34;&amp;gt;&#34;</span><span class="op" id="4450141">,</span><br>
<span class="lineno"></span><span class="op" id="4450143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4450146">//&nbsp;htmlNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlReplacementTable&nbsp;but&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4450222">//&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno">70</span><span class="keyword" id="4450264">var</span>&nbsp;<span class="ident" id="4450268">htmlNormReplacementTable</span>&nbsp;<span class="op" id="4450293">=</span>&nbsp;<span class="op" id="4450295">[</span><span class="op" id="4450296">]</span><span class="builtintype" id="4450297">string</span><span class="op" id="4450303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4450306">0</span><span class="op" id="4450307">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4450312">&#34;\uFFFD&#34;</span><span class="op" id="4450320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4450323">&#39;&#34;&#39;</span><span class="op" id="4450326">:</span>&nbsp;&nbsp;<span class="string" id="4450329">&#34;&amp;#34;&#34;</span><span class="op" id="4450336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4450339">&#39;\&#39;&#39;</span><span class="op" id="4450343">:</span>&nbsp;<span class="string" id="4450345">&#34;&amp;#39;&#34;</span><span class="op" id="4450352">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4450355">&#39;+&#39;</span><span class="op" id="4450358">:</span>&nbsp;&nbsp;<span class="string" id="4450361">&#34;&amp;#43;&#34;</span><span class="op" id="4450368">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4450371">&#39;&lt;&#39;</span><span class="op" id="4450374">:</span>&nbsp;&nbsp;<span class="string" id="4450377">&#34;&amp;lt;&#34;</span><span class="op" id="4450383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4450386">&#39;&gt;&#39;</span><span class="op" id="4450389">:</span>&nbsp;&nbsp;<span class="string" id="4450392">&#34;&amp;gt;&#34;</span><span class="op" id="4450398">,</span><br>
<span class="lineno"></span><span class="op" id="4450400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4450403">//&nbsp;htmlNospaceReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno">80</span><span class="comment" id="4450477">//&nbsp;inside&nbsp;an&nbsp;unquoted&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4450516">//&nbsp;The&nbsp;set&nbsp;of&nbsp;runes&nbsp;escaped&nbsp;is&nbsp;the&nbsp;union&nbsp;of&nbsp;the&nbsp;HTML&nbsp;specials&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4450582">//&nbsp;those&nbsp;determined&nbsp;by&nbsp;running&nbsp;the&nbsp;JS&nbsp;below&nbsp;in&nbsp;browsers:</span><br>
<span class="lineno"></span><span class="comment" id="4450639">//&nbsp;&lt;div&nbsp;id=d&gt;&lt;/div&gt;</span><br>
<span class="lineno"></span><span class="comment" id="4450659">//&nbsp;&lt;script&gt;(function&nbsp;()&nbsp;{</span><br>
<span class="lineno">85</span><span class="comment" id="4450685">//&nbsp;var&nbsp;a&nbsp;=&nbsp;[],&nbsp;d&nbsp;=&nbsp;document.getElementById(&#34;d&#34;),&nbsp;i,&nbsp;c,&nbsp;s;</span><br>
<span class="lineno"></span><span class="comment" id="4450743">//&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="4450778">//&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;String.fromCharCode(i);</span><br>
<span class="lineno"></span><span class="comment" id="4450811">//&nbsp;&nbsp;&nbsp;d.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;&gt;&lt;/span&gt;&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4450873">//&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;d.getElementsByTagName(&#34;SPAN&#34;)[0];</span><br>
<span class="lineno">90</span><span class="comment" id="4450917">//&nbsp;&nbsp;&nbsp;if&nbsp;(!s&nbsp;||&nbsp;s.title&nbsp;!==&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c)&nbsp;{&nbsp;a.push(i.toString(16));&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="4450986">//&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="4450991">//&nbsp;document.write(a.join(&#34;,&nbsp;&#34;));</span><br>
<span class="lineno"></span><span class="comment" id="4451024">//&nbsp;})()&lt;/script&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="4451041">var</span>&nbsp;<span class="ident" id="4451045">htmlNospaceReplacementTable</span>&nbsp;<span class="op" id="4451073">=</span>&nbsp;<span class="op" id="4451075">[</span><span class="op" id="4451076">]</span><span class="builtintype" id="4451077">string</span><span class="op" id="4451083">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4451086">0</span><span class="op" id="4451087">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4451092">&#34;&amp;#xfffd;&#34;</span><span class="op" id="4451102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451105">&#39;\t&#39;</span><span class="op" id="4451109">:</span>&nbsp;<span class="string" id="4451111">&#34;&amp;#9;&#34;</span><span class="op" id="4451117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451120">&#39;\n&#39;</span><span class="op" id="4451124">:</span>&nbsp;<span class="string" id="4451126">&#34;&amp;#10;&#34;</span><span class="op" id="4451133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451136">&#39;\v&#39;</span><span class="op" id="4451140">:</span>&nbsp;<span class="string" id="4451142">&#34;&amp;#11;&#34;</span><span class="op" id="4451149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451152">&#39;\f&#39;</span><span class="op" id="4451156">:</span>&nbsp;<span class="string" id="4451158">&#34;&amp;#12;&#34;</span><span class="op" id="4451165">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451168">&#39;\r&#39;</span><span class="op" id="4451172">:</span>&nbsp;<span class="string" id="4451174">&#34;&amp;#13;&#34;</span><span class="op" id="4451181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451184">&#39;&nbsp;&#39;</span><span class="op" id="4451187">:</span>&nbsp;&nbsp;<span class="string" id="4451190">&#34;&amp;#32;&#34;</span><span class="op" id="4451197">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451200">&#39;&#34;&#39;</span><span class="op" id="4451203">:</span>&nbsp;&nbsp;<span class="string" id="4451206">&#34;&amp;#34;&#34;</span><span class="op" id="4451213">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451216">&#39;&amp;&#39;</span><span class="op" id="4451219">:</span>&nbsp;&nbsp;<span class="string" id="4451222">&#34;&amp;amp;&#34;</span><span class="op" id="4451229">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451232">&#39;\&#39;&#39;</span><span class="op" id="4451236">:</span>&nbsp;<span class="string" id="4451238">&#34;&amp;#39;&#34;</span><span class="op" id="4451245">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451248">&#39;+&#39;</span><span class="op" id="4451251">:</span>&nbsp;&nbsp;<span class="string" id="4451254">&#34;&amp;#43;&#34;</span><span class="op" id="4451261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451264">&#39;&lt;&#39;</span><span class="op" id="4451267">:</span>&nbsp;&nbsp;<span class="string" id="4451270">&#34;&amp;lt;&#34;</span><span class="op" id="4451276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451279">&#39;=&#39;</span><span class="op" id="4451282">:</span>&nbsp;&nbsp;<span class="string" id="4451285">&#34;&amp;#61;&#34;</span><span class="op" id="4451292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451295">&#39;&gt;&#39;</span><span class="op" id="4451298">:</span>&nbsp;&nbsp;<span class="string" id="4451301">&#34;&amp;gt;&#34;</span><span class="op" id="4451307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4451310">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4451366">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4451401">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451443">&#39;`&#39;</span><span class="op" id="4451446">:</span>&nbsp;<span class="string" id="4451448">&#34;&amp;#96;&#34;</span><span class="op" id="4451455">,</span><br>
<span class="lineno"></span><span class="op" id="4451457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="4451460">//&nbsp;htmlNospaceNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlNospaceReplacementTable&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="4451535">//&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno"></span><span class="keyword" id="4451592">var</span>&nbsp;<span class="ident" id="4451596">htmlNospaceNormReplacementTable</span>&nbsp;<span class="op" id="4451628">=</span>&nbsp;<span class="op" id="4451630">[</span><span class="op" id="4451631">]</span><span class="builtintype" id="4451632">string</span><span class="op" id="4451638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4451641">0</span><span class="op" id="4451642">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4451647">&#34;&amp;#xfffd;&#34;</span><span class="op" id="4451657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451660">&#39;\t&#39;</span><span class="op" id="4451664">:</span>&nbsp;<span class="string" id="4451666">&#34;&amp;#9;&#34;</span><span class="op" id="4451672">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451675">&#39;\n&#39;</span><span class="op" id="4451679">:</span>&nbsp;<span class="string" id="4451681">&#34;&amp;#10;&#34;</span><span class="op" id="4451688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451691">&#39;\v&#39;</span><span class="op" id="4451695">:</span>&nbsp;<span class="string" id="4451697">&#34;&amp;#11;&#34;</span><span class="op" id="4451704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451707">&#39;\f&#39;</span><span class="op" id="4451711">:</span>&nbsp;<span class="string" id="4451713">&#34;&amp;#12;&#34;</span><span class="op" id="4451720">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451723">&#39;\r&#39;</span><span class="op" id="4451727">:</span>&nbsp;<span class="string" id="4451729">&#34;&amp;#13;&#34;</span><span class="op" id="4451736">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451739">&#39;&nbsp;&#39;</span><span class="op" id="4451742">:</span>&nbsp;&nbsp;<span class="string" id="4451745">&#34;&amp;#32;&#34;</span><span class="op" id="4451752">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451755">&#39;&#34;&#39;</span><span class="op" id="4451758">:</span>&nbsp;&nbsp;<span class="string" id="4451761">&#34;&amp;#34;&#34;</span><span class="op" id="4451768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451771">&#39;\&#39;&#39;</span><span class="op" id="4451775">:</span>&nbsp;<span class="string" id="4451777">&#34;&amp;#39;&#34;</span><span class="op" id="4451784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451787">&#39;+&#39;</span><span class="op" id="4451790">:</span>&nbsp;&nbsp;<span class="string" id="4451793">&#34;&amp;#43;&#34;</span><span class="op" id="4451800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451803">&#39;&lt;&#39;</span><span class="op" id="4451806">:</span>&nbsp;&nbsp;<span class="string" id="4451809">&#34;&amp;lt;&#34;</span><span class="op" id="4451815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451818">&#39;=&#39;</span><span class="op" id="4451821">:</span>&nbsp;&nbsp;<span class="string" id="4451824">&#34;&amp;#61;&#34;</span><span class="op" id="4451831">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451834">&#39;&gt;&#39;</span><span class="op" id="4451837">:</span>&nbsp;&nbsp;<span class="string" id="4451840">&#34;&amp;gt;&#34;</span><span class="op" id="4451846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4451849">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4451905">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4451940">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451982">&#39;`&#39;</span><span class="op" id="4451985">:</span>&nbsp;<span class="string" id="4451987">&#34;&amp;#96;&#34;</span><span class="op" id="4451994">,</span><br>
<span class="lineno">135</span><span class="op" id="4451996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4451999">//&nbsp;htmlReplacer&nbsp;returns&nbsp;s&nbsp;with&nbsp;runes&nbsp;replaced&nbsp;according&nbsp;to&nbsp;replacementTable</span><br>
<span class="lineno"></span><span class="comment" id="4452075">//&nbsp;and&nbsp;when&nbsp;badRunes&nbsp;is&nbsp;true,&nbsp;certain&nbsp;bad&nbsp;runes&nbsp;are&nbsp;allowed&nbsp;through&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="4452154">func</span>&nbsp;<span class="ident" id="4452159">htmlReplacer</span><span class="op" id="4452171">(</span><span class="ident" id="4452172">s</span>&nbsp;<span class="builtintype" id="4452174">string</span><span class="op" id="4452180">,</span>&nbsp;<span class="ident" id="4452182">replacementTable</span>&nbsp;<span class="op" id="4452199">[</span><span class="op" id="4452200">]</span><span class="builtintype" id="4452201">string</span><span class="op" id="4452207">,</span>&nbsp;<span class="ident" id="4452209">badRunes</span>&nbsp;<span class="builtintype" id="4452218">bool</span><span class="op" id="4452222">)</span>&nbsp;<span class="builtintype" id="4452224">string</span>&nbsp;<span class="op" id="4452231">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452234">written</span><span class="op" id="4452241">,</span>&nbsp;<span class="ident" id="4452243">b</span>&nbsp;<span class="op" id="4452245">:=</span>&nbsp;<span class="num" id="4452248">0</span><span class="op" id="4452249">,</span>&nbsp;<span class="builtinfunc" id="4452251">new</span><span class="op" id="4452254">(</span><span class="ident" id="4452255"><a href="/html/template/html.go.html#4448417">bytes</a></span><span class="op" id="4452260">.</span><span class="ident" id="4452261">Buffer</span><span class="op" id="4452267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452270">for</span>&nbsp;<span class="ident" id="4452274">i</span><span class="op" id="4452275">,</span>&nbsp;<span class="ident" id="4452277">r</span>&nbsp;<span class="op" id="4452279">:=</span>&nbsp;<span class="keyword" id="4452282">range</span>&nbsp;<span class="ident" id="4452288"><a href="/html/template/html.go.html#4452172">s</a></span>&nbsp;<span class="op" id="4452290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452294">if</span>&nbsp;<span class="builtintype" id="4452297">int</span><span class="op" id="4452300">(</span><span class="ident" id="4452301"><a href="/html/template/html.go.html#4452277">r</a></span><span class="op" id="4452302">)</span>&nbsp;<span class="op" id="4452304">&lt;</span>&nbsp;<span class="builtinfunc" id="4452306">len</span><span class="op" id="4452309">(</span><span class="ident" id="4452310"><a href="/html/template/html.go.html#4452182">replacementTable</a></span><span class="op" id="4452326">)</span>&nbsp;<span class="op" id="4452328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452333">if</span>&nbsp;<span class="ident" id="4452336">repl</span>&nbsp;<span class="op" id="4452341">:=</span>&nbsp;<span class="ident" id="4452344"><a href="/html/template/html.go.html#4452182">replacementTable</a></span><span class="op" id="4452360">[</span><span class="ident" id="4452361"><a href="/html/template/html.go.html#4452277">r</a></span><span class="op" id="4452362">]</span><span class="op" id="4452363">;</span>&nbsp;<span class="builtinfunc" id="4452365">len</span><span class="op" id="4452368">(</span><span class="ident" id="4452369"><a href="/html/template/html.go.html#4452336">repl</a></span><span class="op" id="4452373">)</span>&nbsp;<span class="op" id="4452375">!=</span>&nbsp;<span class="num" id="4452378">0</span>&nbsp;<span class="op" id="4452380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452386"><a href="/html/template/html.go.html#4452243">b</a></span><span class="op" id="4452387">.</span><span class="ident" id="4452388">WriteString</span><span class="op" id="4452399">(</span><span class="ident" id="4452400"><a href="/html/template/html.go.html#4452172">s</a></span><span class="op" id="4452401">[</span><span class="ident" id="4452402"><a href="/html/template/html.go.html#4452234">written</a></span><span class="op" id="4452409">:</span><span class="ident" id="4452410"><a href="/html/template/html.go.html#4452274">i</a></span><span class="op" id="4452411">]</span><span class="op" id="4452412">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452418"><a href="/html/template/html.go.html#4452243">b</a></span><span class="op" id="4452419">.</span><span class="ident" id="4452420">WriteString</span><span class="op" id="4452431">(</span><span class="ident" id="4452432"><a href="/html/template/html.go.html#4452336">repl</a></span><span class="op" id="4452436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4452442">//&nbsp;Valid&nbsp;as&nbsp;long&nbsp;as&nbsp;replacementTable&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4452491">//&nbsp;include&nbsp;anything&nbsp;above&nbsp;0x7f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452527"><a href="/html/template/html.go.html#4452234">written</a></span>&nbsp;<span class="op" id="4452535">=</span>&nbsp;<span class="ident" id="4452537"><a href="/html/template/html.go.html#4452274">i</a></span>&nbsp;<span class="op" id="4452539">+</span>&nbsp;<span class="ident" id="4452541"><a href="/html/template/html.go.html#4448444">utf8</a></span><span class="op" id="4452545">.</span><span class="ident" id="4452546">RuneLen</span><span class="op" id="4452553">(</span><span class="ident" id="4452554"><a href="/html/template/html.go.html#4452277">r</a></span><span class="op" id="4452555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452560">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452564">}</span>&nbsp;<span class="keyword" id="4452566">else</span>&nbsp;<span class="keyword" id="4452571">if</span>&nbsp;<span class="ident" id="4452574"><a href="/html/template/html.go.html#4452209">badRunes</a></span>&nbsp;<span class="op" id="4452583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4452588">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4452601">//&nbsp;IE&nbsp;does&nbsp;not&nbsp;allow&nbsp;these&nbsp;ranges&nbsp;in&nbsp;unquoted&nbsp;attrs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452656">}</span>&nbsp;<span class="keyword" id="4452658">else</span>&nbsp;<span class="keyword" id="4452663">if</span>&nbsp;<span class="num" id="4452666">0xfdd0</span>&nbsp;<span class="op" id="4452673">&lt;=</span>&nbsp;<span class="ident" id="4452676"><a href="/html/template/html.go.html#4452277">r</a></span>&nbsp;<span class="op" id="4452678">&amp;&amp;</span>&nbsp;<span class="ident" id="4452681"><a href="/html/template/html.go.html#4452277">r</a></span>&nbsp;<span class="op" id="4452683">&lt;=</span>&nbsp;<span class="num" id="4452686">0xfdef</span>&nbsp;<span class="op" id="4452693">||</span>&nbsp;<span class="num" id="4452696">0xfff0</span>&nbsp;<span class="op" id="4452703">&lt;=</span>&nbsp;<span class="ident" id="4452706"><a href="/html/template/html.go.html#4452277">r</a></span>&nbsp;<span class="op" id="4452708">&amp;&amp;</span>&nbsp;<span class="ident" id="4452711"><a href="/html/template/html.go.html#4452277">r</a></span>&nbsp;<span class="op" id="4452713">&lt;=</span>&nbsp;<span class="num" id="4452716">0xffff</span>&nbsp;<span class="op" id="4452723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452728"><a href="/html/template/html.go.html#4448426">fmt</a></span><span class="op" id="4452731">.</span><span class="ident" id="4452732">Fprintf</span><span class="op" id="4452739">(</span><span class="ident" id="4452740"><a href="/html/template/html.go.html#4452243">b</a></span><span class="op" id="4452741">,</span>&nbsp;<span class="string" id="4452743">&#34;%s&amp;#x%x;&#34;</span><span class="op" id="4452753">,</span>&nbsp;<span class="ident" id="4452755"><a href="/html/template/html.go.html#4452172">s</a></span><span class="op" id="4452756">[</span><span class="ident" id="4452757"><a href="/html/template/html.go.html#4452234">written</a></span><span class="op" id="4452764">:</span><span class="ident" id="4452765"><a href="/html/template/html.go.html#4452274">i</a></span><span class="op" id="4452766">]</span><span class="op" id="4452767">,</span>&nbsp;<span class="ident" id="4452769"><a href="/html/template/html.go.html#4452277">r</a></span><span class="op" id="4452770">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452775"><a href="/html/template/html.go.html#4452234">written</a></span>&nbsp;<span class="op" id="4452783">=</span>&nbsp;<span class="ident" id="4452785"><a href="/html/template/html.go.html#4452274">i</a></span>&nbsp;<span class="op" id="4452787">+</span>&nbsp;<span class="ident" id="4452789"><a href="/html/template/html.go.html#4448444">utf8</a></span><span class="op" id="4452793">.</span><span class="ident" id="4452794">RuneLen</span><span class="op" id="4452801">(</span><span class="ident" id="4452802"><a href="/html/template/html.go.html#4452277">r</a></span><span class="op" id="4452803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452813">if</span>&nbsp;<span class="ident" id="4452816"><a href="/html/template/html.go.html#4452234">written</a></span>&nbsp;<span class="op" id="4452824">==</span>&nbsp;<span class="num" id="4452827">0</span>&nbsp;<span class="op" id="4452829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452833">return</span>&nbsp;<span class="ident" id="4452840"><a href="/html/template/html.go.html#4452172">s</a></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4452843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4452846"><a href="/html/template/html.go.html#4452243">b</a></span><span class="op" id="4452847">.</span><span class="ident" id="4452848">WriteString</span><span class="op" id="4452859">(</span><span class="ident" id="4452860"><a href="/html/template/html.go.html#4452172">s</a></span><span class="op" id="4452861">[</span><span class="ident" id="4452862"><a href="/html/template/html.go.html#4452234">written</a></span><span class="op" id="4452869">:</span><span class="op" id="4452870">]</span><span class="op" id="4452871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452874">return</span>&nbsp;<span class="ident" id="4452881"><a href="/html/template/html.go.html#4452243">b</a></span><span class="op" id="4452882">.</span><span class="ident" id="4452883">String</span><span class="op" id="4452889">(</span><span class="op" id="4452890">)</span><br>
<span class="lineno"></span><span class="op" id="4452892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="4452895">//&nbsp;stripTags&nbsp;takes&nbsp;a&nbsp;snippet&nbsp;of&nbsp;HTML&nbsp;and&nbsp;returns&nbsp;only&nbsp;the&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="4452967">//&nbsp;For&nbsp;example,&nbsp;`&lt;b&gt;&amp;iexcl;Hi!&lt;/b&gt;&nbsp;&lt;script&gt;...&lt;/script&gt;`&nbsp;-&gt;&nbsp;`&amp;iexcl;Hi!&nbsp;`.</span><br>
<span class="lineno"></span><span class="keyword" id="4453042">func</span>&nbsp;<span class="ident" id="4453047">stripTags</span><span class="op" id="4453056">(</span><span class="ident" id="4453057">html</span>&nbsp;<span class="builtintype" id="4453062">string</span><span class="op" id="4453068">)</span>&nbsp;<span class="builtintype" id="4453070">string</span>&nbsp;<span class="op" id="4453077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453080">var</span>&nbsp;<span class="ident" id="4453084">b</span>&nbsp;<span class="ident" id="4453086"><a href="/html/template/html.go.html#4448417">bytes</a></span><span class="op" id="4453091">.</span><span class="ident" id="4453092">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453100">s</span><span class="op" id="4453101">,</span>&nbsp;<span class="ident" id="4453103">c</span><span class="op" id="4453104">,</span>&nbsp;<span class="ident" id="4453106">i</span><span class="op" id="4453107">,</span>&nbsp;<span class="ident" id="4453109">allText</span>&nbsp;<span class="op" id="4453117">:=</span>&nbsp;<span class="op" id="4453120">[</span><span class="op" id="4453121">]</span><span class="builtintype" id="4453122">byte</span><span class="op" id="4453126">(</span><span class="ident" id="4453127"><a href="/html/template/html.go.html#4453057">html</a></span><span class="op" id="4453131">)</span><span class="op" id="4453132">,</span>&nbsp;<span class="ident" id="4453134"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4453141">{</span><span class="op" id="4453142">}</span><span class="op" id="4453143">,</span>&nbsp;<span class="num" id="4453145">0</span><span class="op" id="4453146">,</span>&nbsp;<span class="builtintype" id="4453148">true</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4453154">//&nbsp;Using&nbsp;the&nbsp;transition&nbsp;funcs&nbsp;helps&nbsp;us&nbsp;avoid&nbsp;mangling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4453209">//&nbsp;`&lt;div&nbsp;title=&#34;1&gt;2&#34;&gt;`&nbsp;or&nbsp;`I&nbsp;&lt;3&nbsp;Ponies!`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453252">for</span>&nbsp;<span class="ident" id="4453256"><a href="/html/template/html.go.html#4453106">i</a></span>&nbsp;<span class="op" id="4453258">!=</span>&nbsp;<span class="builtinfunc" id="4453261">len</span><span class="op" id="4453264">(</span><span class="ident" id="4453265"><a href="/html/template/html.go.html#4453100">s</a></span><span class="op" id="4453266">)</span>&nbsp;<span class="op" id="4453268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453272">if</span>&nbsp;<span class="ident" id="4453275"><a href="/html/template/html.go.html#4453103">c</a></span><span class="op" id="4453276">.</span><span class="ident" id="4453277">delim</span>&nbsp;<span class="op" id="4453283">==</span>&nbsp;<span class="ident" id="4453286"><a href="/html/template/context.go.html#4398044">delimNone</a></span>&nbsp;<span class="op" id="4453296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453301">st</span>&nbsp;<span class="op" id="4453304">:=</span>&nbsp;<span class="ident" id="4453307"><a href="/html/template/html.go.html#4453103">c</a></span><span class="op" id="4453308">.</span><span class="ident" id="4453309">state</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4453318">//&nbsp;Use&nbsp;RCDATA&nbsp;instead&nbsp;of&nbsp;parsing&nbsp;into&nbsp;JS&nbsp;or&nbsp;CSS&nbsp;styles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453377">if</span>&nbsp;<span class="ident" id="4453380"><a href="/html/template/html.go.html#4453103">c</a></span><span class="op" id="4453381">.</span><span class="ident" id="4453382">element</span>&nbsp;<span class="op" id="4453390">!=</span>&nbsp;<span class="ident" id="4453393"><a href="/html/template/context.go.html#4400738">elementNone</a></span>&nbsp;<span class="op" id="4453405">&amp;&amp;</span>&nbsp;<span class="op" id="4453408">!</span><span class="ident" id="4453409"><a href="/html/template/context.go.html#4397759">isInTag</a></span><span class="op" id="4453416">(</span><span class="ident" id="4453417"><a href="/html/template/html.go.html#4453301">st</a></span><span class="op" id="4453419">)</span>&nbsp;<span class="op" id="4453421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453427"><a href="/html/template/html.go.html#4453301">st</a></span>&nbsp;<span class="op" id="4453430">=</span>&nbsp;<span class="ident" id="4453432"><a href="/html/template/context.go.html#4395032">stateRCDATA</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4453447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453452">d</span><span class="op" id="4453453">,</span>&nbsp;<span class="ident" id="4453455">nread</span>&nbsp;<span class="op" id="4453461">:=</span>&nbsp;<span class="ident" id="4453464"><a href="/html/template/transition.go.html#4478703">transitionFunc</a></span><span class="op" id="4453478">[</span><span class="ident" id="4453479"><a href="/html/template/html.go.html#4453301">st</a></span><span class="op" id="4453481">]</span><span class="op" id="4453482">(</span><span class="ident" id="4453483"><a href="/html/template/html.go.html#4453103">c</a></span><span class="op" id="4453484">,</span>&nbsp;<span class="ident" id="4453486"><a href="/html/template/html.go.html#4453100">s</a></span><span class="op" id="4453487">[</span><span class="ident" id="4453488"><a href="/html/template/html.go.html#4453106">i</a></span><span class="op" id="4453489">:</span><span class="op" id="4453490">]</span><span class="op" id="4453491">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453496">i1</span>&nbsp;<span class="op" id="4453499">:=</span>&nbsp;<span class="ident" id="4453502"><a href="/html/template/html.go.html#4453106">i</a></span>&nbsp;<span class="op" id="4453504">+</span>&nbsp;<span class="ident" id="4453506"><a href="/html/template/html.go.html#4453455">nread</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453515">if</span>&nbsp;<span class="ident" id="4453518"><a href="/html/template/html.go.html#4453103">c</a></span><span class="op" id="4453519">.</span><span class="ident" id="4453520">state</span>&nbsp;<span class="op" id="4453526">==</span>&nbsp;<span class="ident" id="4453529"><a href="/html/template/context.go.html#4394308">stateText</a></span>&nbsp;<span class="op" id="4453539">||</span>&nbsp;<span class="ident" id="4453542"><a href="/html/template/html.go.html#4453103">c</a></span><span class="op" id="4453543">.</span><span class="ident" id="4453544">state</span>&nbsp;<span class="op" id="4453550">==</span>&nbsp;<span class="ident" id="4453553"><a href="/html/template/context.go.html#4395032">stateRCDATA</a></span>&nbsp;<span class="op" id="4453565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4453571">//&nbsp;Emit&nbsp;text&nbsp;up&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;tag&nbsp;or&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453627">j</span>&nbsp;<span class="op" id="4453629">:=</span>&nbsp;<span class="ident" id="4453632"><a href="/html/template/html.go.html#4453496">i1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453639">if</span>&nbsp;<span class="ident" id="4453642"><a href="/html/template/html.go.html#4453452">d</a></span><span class="op" id="4453643">.</span><span class="ident" id="4453644">state</span>&nbsp;<span class="op" id="4453650">!=</span>&nbsp;<span class="ident" id="4453653"><a href="/html/template/html.go.html#4453103">c</a></span><span class="op" id="4453654">.</span><span class="ident" id="4453655">state</span>&nbsp;<span class="op" id="4453661">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453668">for</span>&nbsp;<span class="ident" id="4453672">j1</span>&nbsp;<span class="op" id="4453675">:=</span>&nbsp;<span class="ident" id="4453678"><a href="/html/template/html.go.html#4453627">j</a></span>&nbsp;<span class="op" id="4453680">-</span>&nbsp;<span class="num" id="4453682">1</span><span class="op" id="4453683">;</span>&nbsp;<span class="ident" id="4453685"><a href="/html/template/html.go.html#4453672">j1</a></span>&nbsp;<span class="op" id="4453688">&gt;=</span>&nbsp;<span class="ident" id="4453691"><a href="/html/template/html.go.html#4453106">i</a></span><span class="op" id="4453692">;</span>&nbsp;<span class="ident" id="4453694"><a href="/html/template/html.go.html#4453672">j1</a></span><span class="op" id="4453696">--</span>&nbsp;<span class="op" id="4453699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453707">if</span>&nbsp;<span class="ident" id="4453710"><a href="/html/template/html.go.html#4453100">s</a></span><span class="op" id="4453711">[</span><span class="ident" id="4453712"><a href="/html/template/html.go.html#4453672">j1</a></span><span class="op" id="4453714">]</span>&nbsp;<span class="op" id="4453716">==</span>&nbsp;<span class="string" id="4453719">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4453723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453732"><a href="/html/template/html.go.html#4453627">j</a></span>&nbsp;<span class="op" id="4453734">=</span>&nbsp;<span class="ident" id="4453736"><a href="/html/template/html.go.html#4453672">j1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453746">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4453758">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4453765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4453771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453777"><a href="/html/template/html.go.html#4453084">b</a></span><span class="op" id="4453778">.</span><span class="ident" id="4453779">Write</span><span class="op" id="4453784">(</span><span class="ident" id="4453785"><a href="/html/template/html.go.html#4453100">s</a></span><span class="op" id="4453786">[</span><span class="ident" id="4453787"><a href="/html/template/html.go.html#4453106">i</a></span><span class="op" id="4453788">:</span><span class="ident" id="4453789"><a href="/html/template/html.go.html#4453627">j</a></span><span class="op" id="4453790">]</span><span class="op" id="4453791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4453796">}</span>&nbsp;<span class="keyword" id="4453798">else</span>&nbsp;<span class="op" id="4453803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453809"><a href="/html/template/html.go.html#4453109">allText</a></span>&nbsp;<span class="op" id="4453817">=</span>&nbsp;<span class="builtintype" id="4453819">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4453828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453833"><a href="/html/template/html.go.html#4453103">c</a></span><span class="op" id="4453834">,</span>&nbsp;<span class="ident" id="4453836"><a href="/html/template/html.go.html#4453106">i</a></span>&nbsp;<span class="op" id="4453838">=</span>&nbsp;<span class="ident" id="4453840"><a href="/html/template/html.go.html#4453452">d</a></span><span class="op" id="4453841">,</span>&nbsp;<span class="ident" id="4453843"><a href="/html/template/html.go.html#4453496">i1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453849">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4453860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453864">i1</span>&nbsp;<span class="op" id="4453867">:=</span>&nbsp;<span class="ident" id="4453870"><a href="/html/template/html.go.html#4453106">i</a></span>&nbsp;<span class="op" id="4453872">+</span>&nbsp;<span class="ident" id="4453874"><a href="/html/template/html.go.html#4448417">bytes</a></span><span class="op" id="4453879">.</span><span class="ident" id="4453880">IndexAny</span><span class="op" id="4453888">(</span><span class="ident" id="4453889"><a href="/html/template/html.go.html#4453100">s</a></span><span class="op" id="4453890">[</span><span class="ident" id="4453891"><a href="/html/template/html.go.html#4453106">i</a></span><span class="op" id="4453892">:</span><span class="op" id="4453893">]</span><span class="op" id="4453894">,</span>&nbsp;<span class="ident" id="4453896"><a href="/html/template/escape.go.html#4441025">delimEnds</a></span><span class="op" id="4453905">[</span><span class="ident" id="4453906"><a href="/html/template/html.go.html#4453103">c</a></span><span class="op" id="4453907">.</span><span class="ident" id="4453908">delim</span><span class="op" id="4453913">]</span><span class="op" id="4453914">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453918">if</span>&nbsp;<span class="ident" id="4453921"><a href="/html/template/html.go.html#4453864">i1</a></span>&nbsp;<span class="op" id="4453924">&lt;</span>&nbsp;<span class="ident" id="4453926"><a href="/html/template/html.go.html#4453106">i</a></span>&nbsp;<span class="op" id="4453928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453933">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4453941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453945">if</span>&nbsp;<span class="ident" id="4453948"><a href="/html/template/html.go.html#4453103">c</a></span><span class="op" id="4453949">.</span><span class="ident" id="4453950">delim</span>&nbsp;<span class="op" id="4453956">!=</span>&nbsp;<span class="ident" id="4453959"><a href="/html/template/context.go.html#4398348">delimSpaceOrTagEnd</a></span>&nbsp;<span class="op" id="4453978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4453983">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454008"><a href="/html/template/html.go.html#4453864">i1</a></span><span class="op" id="4454010">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454019"><a href="/html/template/html.go.html#4453103">c</a></span><span class="op" id="4454020">,</span>&nbsp;<span class="ident" id="4454022"><a href="/html/template/html.go.html#4453106">i</a></span>&nbsp;<span class="op" id="4454024">=</span>&nbsp;<span class="ident" id="4454026"><a href="/html/template/context.go.html#4392413">context</a></span><span class="op" id="4454033">{</span><span class="ident" id="4454034">state</span><span class="op" id="4454039">:</span>&nbsp;<span class="ident" id="4454041"><a href="/html/template/context.go.html#4394398">stateTag</a></span><span class="op" id="4454049">,</span>&nbsp;<span class="ident" id="4454051">element</span><span class="op" id="4454058">:</span>&nbsp;<span class="ident" id="4454060"><a href="/html/template/html.go.html#4453103">c</a></span><span class="op" id="4454061">.</span><span class="ident" id="4454062">element</span><span class="op" id="4454069">}</span><span class="op" id="4454070">,</span>&nbsp;<span class="ident" id="4454072"><a href="/html/template/html.go.html#4453864">i1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454079">if</span>&nbsp;<span class="ident" id="4454082"><a href="/html/template/html.go.html#4453109">allText</a></span>&nbsp;<span class="op" id="4454090">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454094">return</span>&nbsp;<span class="ident" id="4454101"><a href="/html/template/html.go.html#4453057">html</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454107">}</span>&nbsp;<span class="keyword" id="4454109">else</span>&nbsp;<span class="keyword" id="4454114">if</span>&nbsp;<span class="ident" id="4454117"><a href="/html/template/html.go.html#4453103">c</a></span><span class="op" id="4454118">.</span><span class="ident" id="4454119">state</span>&nbsp;<span class="op" id="4454125">==</span>&nbsp;<span class="ident" id="4454128"><a href="/html/template/context.go.html#4394308">stateText</a></span>&nbsp;<span class="op" id="4454138">||</span>&nbsp;<span class="ident" id="4454141"><a href="/html/template/html.go.html#4453103">c</a></span><span class="op" id="4454142">.</span><span class="ident" id="4454143">state</span>&nbsp;<span class="op" id="4454149">==</span>&nbsp;<span class="ident" id="4454152"><a href="/html/template/context.go.html#4395032">stateRCDATA</a></span>&nbsp;<span class="op" id="4454164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454168"><a href="/html/template/html.go.html#4453084">b</a></span><span class="op" id="4454169">.</span><span class="ident" id="4454170">Write</span><span class="op" id="4454175">(</span><span class="ident" id="4454176"><a href="/html/template/html.go.html#4453100">s</a></span><span class="op" id="4454177">[</span><span class="ident" id="4454178"><a href="/html/template/html.go.html#4453106">i</a></span><span class="op" id="4454179">:</span><span class="op" id="4454180">]</span><span class="op" id="4454181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454187">return</span>&nbsp;<span class="ident" id="4454194"><a href="/html/template/html.go.html#4453084">b</a></span><span class="op" id="4454195">.</span><span class="ident" id="4454196">String</span><span class="op" id="4454202">(</span><span class="op" id="4454203">)</span><br>
<span class="lineno">215</span><span class="op" id="4454205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4454208">//&nbsp;htmlNameFilter&nbsp;accepts&nbsp;valid&nbsp;parts&nbsp;of&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;or&nbsp;tag&nbsp;name&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4454282">//&nbsp;a&nbsp;known-safe&nbsp;HTML&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="4454314">func</span>&nbsp;<span class="ident" id="4454319">htmlNameFilter</span><span class="op" id="4454333">(</span><span class="ident" id="4454334">args</span>&nbsp;<span class="op" id="4454339">...</span><span class="keyword" id="4454342">interface</span><span class="op" id="4454351">{</span><span class="op" id="4454352">}</span><span class="op" id="4454353">)</span>&nbsp;<span class="builtintype" id="4454355">string</span>&nbsp;<span class="op" id="4454362">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454365">s</span><span class="op" id="4454366">,</span>&nbsp;<span class="ident" id="4454368">t</span>&nbsp;<span class="op" id="4454370">:=</span>&nbsp;<span class="ident" id="4454373"><a href="/html/template/content.go.html#4391261">stringify</a></span><span class="op" id="4454382">(</span><span class="ident" id="4454383"><a href="/html/template/html.go.html#4454334">args</a></span><span class="op" id="4454387">...</span><span class="op" id="4454390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454393">if</span>&nbsp;<span class="ident" id="4454396"><a href="/html/template/html.go.html#4454368">t</a></span>&nbsp;<span class="op" id="4454398">==</span>&nbsp;<span class="ident" id="4454401"><a href="/html/template/content.go.html#4389810">contentTypeHTMLAttr</a></span>&nbsp;<span class="op" id="4454421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454425">return</span>&nbsp;<span class="ident" id="4454432"><a href="/html/template/html.go.html#4454365">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454438">if</span>&nbsp;<span class="builtinfunc" id="4454441">len</span><span class="op" id="4454444">(</span><span class="ident" id="4454445"><a href="/html/template/html.go.html#4454365">s</a></span><span class="op" id="4454446">)</span>&nbsp;<span class="op" id="4454448">==</span>&nbsp;<span class="num" id="4454451">0</span>&nbsp;<span class="op" id="4454453">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4454457">//&nbsp;Avoid&nbsp;violation&nbsp;of&nbsp;structure&nbsp;preservation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4454505">//&nbsp;&lt;input&nbsp;checked&nbsp;{{.K}}={{.V}}&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4454541">//&nbsp;Without&nbsp;this,&nbsp;if&nbsp;.K&nbsp;is&nbsp;empty&nbsp;then&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4454599">//&nbsp;checked,&nbsp;but&nbsp;otherwise&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;attribute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4454660">//&nbsp;named&nbsp;.K.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454675">return</span>&nbsp;<span class="ident" id="4454682"><a href="/html/template/escape.go.html#4427036">filterFailsafe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454701"><a href="/html/template/html.go.html#4454365">s</a></span>&nbsp;<span class="op" id="4454703">=</span>&nbsp;<span class="ident" id="4454705"><a href="/html/template/html.go.html#4448433">strings</a></span><span class="op" id="4454712">.</span><span class="ident" id="4454713">ToLower</span><span class="op" id="4454720">(</span><span class="ident" id="4454721"><a href="/html/template/html.go.html#4454365">s</a></span><span class="op" id="4454722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454725">if</span>&nbsp;<span class="ident" id="4454728">t</span>&nbsp;<span class="op" id="4454730">:=</span>&nbsp;<span class="ident" id="4454733"><a href="/html/template/attr.go.html#4386124">attrType</a></span><span class="op" id="4454741">(</span><span class="ident" id="4454742"><a href="/html/template/html.go.html#4454365">s</a></span><span class="op" id="4454743">)</span><span class="op" id="4454744">;</span>&nbsp;<span class="ident" id="4454746"><a href="/html/template/html.go.html#4454728">t</a></span>&nbsp;<span class="op" id="4454748">!=</span>&nbsp;<span class="ident" id="4454751"><a href="/html/template/content.go.html#4389740">contentTypePlain</a></span>&nbsp;<span class="op" id="4454768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4454772">//&nbsp;TODO:&nbsp;Split&nbsp;attr&nbsp;and&nbsp;element&nbsp;name&nbsp;part&nbsp;filters&nbsp;so&nbsp;we&nbsp;can&nbsp;whitelist</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4454844">//&nbsp;attributes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454861">return</span>&nbsp;<span class="ident" id="4454868"><a href="/html/template/escape.go.html#4427036">filterFailsafe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454887">for</span>&nbsp;<span class="ident" id="4454891">_</span><span class="op" id="4454892">,</span>&nbsp;<span class="ident" id="4454894">r</span>&nbsp;<span class="op" id="4454896">:=</span>&nbsp;<span class="keyword" id="4454899">range</span>&nbsp;<span class="ident" id="4454905"><a href="/html/template/html.go.html#4454365">s</a></span>&nbsp;<span class="op" id="4454907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454911">switch</span>&nbsp;<span class="op" id="4454918">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454922">case</span>&nbsp;<span class="string" id="4454927">&#39;0&#39;</span>&nbsp;<span class="op" id="4454931">&lt;=</span>&nbsp;<span class="ident" id="4454934"><a href="/html/template/html.go.html#4454894">r</a></span>&nbsp;<span class="op" id="4454936">&amp;&amp;</span>&nbsp;<span class="ident" id="4454939"><a href="/html/template/html.go.html#4454894">r</a></span>&nbsp;<span class="op" id="4454941">&lt;=</span>&nbsp;<span class="string" id="4454944">&#39;9&#39;</span><span class="op" id="4454947">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454951">case</span>&nbsp;<span class="string" id="4454956">&#39;a&#39;</span>&nbsp;<span class="op" id="4454960">&lt;=</span>&nbsp;<span class="ident" id="4454963"><a href="/html/template/html.go.html#4454894">r</a></span>&nbsp;<span class="op" id="4454965">&amp;&amp;</span>&nbsp;<span class="ident" id="4454968"><a href="/html/template/html.go.html#4454894">r</a></span>&nbsp;<span class="op" id="4454970">&lt;=</span>&nbsp;<span class="string" id="4454973">&#39;z&#39;</span><span class="op" id="4454976">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454980">default</span><span class="op" id="4454987">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454992">return</span>&nbsp;<span class="ident" id="4454999"><a href="/html/template/escape.go.html#4427036">filterFailsafe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4455016">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4455019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4455022">return</span>&nbsp;<span class="ident" id="4455029"><a href="/html/template/html.go.html#4454365">s</a></span><br>
<span class="lineno"></span><span class="op" id="4455031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4455034">//&nbsp;commentEscaper&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string&nbsp;regardless&nbsp;of&nbsp;input.</span><br>
<span class="lineno">250</span><span class="comment" id="4455098">//&nbsp;Comment&nbsp;content&nbsp;does&nbsp;not&nbsp;correspond&nbsp;to&nbsp;any&nbsp;parsed&nbsp;structure&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4455164">//&nbsp;human-readable&nbsp;content,&nbsp;so&nbsp;the&nbsp;simplest&nbsp;and&nbsp;most&nbsp;secure&nbsp;policy&nbsp;is&nbsp;to&nbsp;drop</span><br>
<span class="lineno"></span><span class="comment" id="4455241">//&nbsp;content&nbsp;interpolated&nbsp;into&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="4455280">//&nbsp;This&nbsp;approach&nbsp;is&nbsp;equally&nbsp;valid&nbsp;whether&nbsp;or&nbsp;not&nbsp;static&nbsp;comment&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4455355">//&nbsp;removed&nbsp;from&nbsp;the&nbsp;template.</span><br>
<span class="lineno">255</span><span class="keyword" id="4455385">func</span>&nbsp;<span class="ident" id="4455390">commentEscaper</span><span class="op" id="4455404">(</span><span class="ident" id="4455405">args</span>&nbsp;<span class="op" id="4455410">...</span><span class="keyword" id="4455413">interface</span><span class="op" id="4455422">{</span><span class="op" id="4455423">}</span><span class="op" id="4455424">)</span>&nbsp;<span class="builtintype" id="4455426">string</span>&nbsp;<span class="op" id="4455433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4455436">return</span>&nbsp;<span class="string" id="4455443">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="4455446">}</span>
</div>
</body>
</html>
