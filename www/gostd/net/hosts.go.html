<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3017157">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3017212">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3017266">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3017317">//&nbsp;Read&nbsp;static&nbsp;host/IP&nbsp;entries&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3017366">package</span>&nbsp;<span class="ident" id="3017374">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3017379">import</span>&nbsp;<span class="op" id="3017386">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3017389">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3017397">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3017404">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3017407">const</span>&nbsp;<span class="ident" id="3017413">cacheMaxAge</span>&nbsp;<span class="op" id="3017425">=</span>&nbsp;<span class="num" id="3017427">5</span>&nbsp;<span class="op" id="3017429">*</span>&nbsp;<span class="ident" id="3017431">time</span><span class="op" id="3017435">.</span><span class="ident" id="3017436">Minute</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3017444">//&nbsp;hostsPath&nbsp;points&nbsp;to&nbsp;the&nbsp;file&nbsp;with&nbsp;static&nbsp;IP/address&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="3017508">var</span>&nbsp;<span class="ident" id="3017512">hostsPath</span>&nbsp;<span class="op" id="3017522">=</span>&nbsp;<span class="string" id="3017524">&#34;/etc/hosts&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3017538">//&nbsp;Simple&nbsp;cache.</span><br>
<span class="lineno">20</span><span class="keyword" id="3017555">var</span>&nbsp;<span class="ident" id="3017559">hosts</span>&nbsp;<span class="keyword" id="3017565">struct</span>&nbsp;<span class="op" id="3017572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3017575">sync</span><span class="op" id="3017579">.</span><span class="ident" id="3017580">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3017587">byName</span>&nbsp;<span class="keyword" id="3017594">map</span><span class="op" id="3017597">[</span><span class="builtintype" id="3017598">string</span><span class="op" id="3017604">]</span><span class="op" id="3017605">[</span><span class="op" id="3017606">]</span><span class="builtintype" id="3017607">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3017615">byAddr</span>&nbsp;<span class="keyword" id="3017622">map</span><span class="op" id="3017625">[</span><span class="builtintype" id="3017626">string</span><span class="op" id="3017632">]</span><span class="op" id="3017633">[</span><span class="op" id="3017634">]</span><span class="builtintype" id="3017635">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3017643">expire</span>&nbsp;<span class="ident" id="3017650">time</span><span class="op" id="3017654">.</span><span class="ident" id="3017655">Time</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3017661">path</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3017668">string</span><br>
<span class="lineno"></span><span class="op" id="3017675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3017678">func</span>&nbsp;<span class="ident" id="3017683">readHosts</span><span class="op" id="3017692">(</span><span class="op" id="3017693">)</span>&nbsp;<span class="op" id="3017695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3017698">now</span>&nbsp;<span class="op" id="3017702">:=</span>&nbsp;<span class="ident" id="3017705">time</span><span class="op" id="3017709">.</span><span class="ident" id="3017710">Now</span><span class="op" id="3017713">(</span><span class="op" id="3017714">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3017717">hp</span>&nbsp;<span class="op" id="3017720">:=</span>&nbsp;<span class="ident" id="3017723">hostsPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3017734">if</span>&nbsp;<span class="builtinfunc" id="3017737">len</span><span class="op" id="3017740">(</span><span class="ident" id="3017741">hosts</span><span class="op" id="3017746">.</span><span class="ident" id="3017747">byName</span><span class="op" id="3017753">)</span>&nbsp;<span class="op" id="3017755">==</span>&nbsp;<span class="num" id="3017758">0</span>&nbsp;<span class="op" id="3017760">||</span>&nbsp;<span class="ident" id="3017763">now</span><span class="op" id="3017766">.</span><span class="ident" id="3017767">After</span><span class="op" id="3017772">(</span><span class="ident" id="3017773">hosts</span><span class="op" id="3017778">.</span><span class="ident" id="3017779">expire</span><span class="op" id="3017785">)</span>&nbsp;<span class="op" id="3017787">||</span>&nbsp;<span class="ident" id="3017790">hosts</span><span class="op" id="3017795">.</span><span class="ident" id="3017796">path</span>&nbsp;<span class="op" id="3017801">!=</span>&nbsp;<span class="ident" id="3017804">hp</span>&nbsp;<span class="op" id="3017807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3017811">hs</span>&nbsp;<span class="op" id="3017814">:=</span>&nbsp;<span class="builtinfunc" id="3017817">make</span><span class="op" id="3017821">(</span><span class="keyword" id="3017822">map</span><span class="op" id="3017825">[</span><span class="builtintype" id="3017826">string</span><span class="op" id="3017832">]</span><span class="op" id="3017833">[</span><span class="op" id="3017834">]</span><span class="builtintype" id="3017835">string</span><span class="op" id="3017841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3017845">is</span>&nbsp;<span class="op" id="3017848">:=</span>&nbsp;<span class="builtinfunc" id="3017851">make</span><span class="op" id="3017855">(</span><span class="keyword" id="3017856">map</span><span class="op" id="3017859">[</span><span class="builtintype" id="3017860">string</span><span class="op" id="3017866">]</span><span class="op" id="3017867">[</span><span class="op" id="3017868">]</span><span class="builtintype" id="3017869">string</span><span class="op" id="3017875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3017879">var</span>&nbsp;<span class="ident" id="3017883">file</span>&nbsp;<span class="op" id="3017888">*</span><span class="ident" id="3017889">file</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3017896">if</span>&nbsp;<span class="ident" id="3017899">file</span><span class="op" id="3017903">,</span>&nbsp;<span class="ident" id="3017905">_</span>&nbsp;<span class="op" id="3017907">=</span>&nbsp;<span class="ident" id="3017909">open</span><span class="op" id="3017913">(</span><span class="ident" id="3017914">hp</span><span class="op" id="3017916">)</span><span class="op" id="3017917">;</span>&nbsp;<span class="ident" id="3017919">file</span>&nbsp;<span class="op" id="3017924">==</span>&nbsp;<span class="ident" id="3017927">nil</span>&nbsp;<span class="op" id="3017931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3017936">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3017945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3017949">for</span>&nbsp;<span class="ident" id="3017953">line</span><span class="op" id="3017957">,</span>&nbsp;<span class="ident" id="3017959">ok</span>&nbsp;<span class="op" id="3017962">:=</span>&nbsp;<span class="ident" id="3017965">file</span><span class="op" id="3017969">.</span><span class="ident" id="3017970">readLine</span><span class="op" id="3017978">(</span><span class="op" id="3017979">)</span><span class="op" id="3017980">;</span>&nbsp;<span class="ident" id="3017982">ok</span><span class="op" id="3017984">;</span>&nbsp;<span class="ident" id="3017986">line</span><span class="op" id="3017990">,</span>&nbsp;<span class="ident" id="3017992">ok</span>&nbsp;<span class="op" id="3017995">=</span>&nbsp;<span class="ident" id="3017997">file</span><span class="op" id="3018001">.</span><span class="ident" id="3018002">readLine</span><span class="op" id="3018010">(</span><span class="op" id="3018011">)</span>&nbsp;<span class="op" id="3018013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018018">if</span>&nbsp;<span class="ident" id="3018021">i</span>&nbsp;<span class="op" id="3018023">:=</span>&nbsp;<span class="ident" id="3018026">byteIndex</span><span class="op" id="3018035">(</span><span class="ident" id="3018036">line</span><span class="op" id="3018040">,</span>&nbsp;<span class="string" id="3018042">&#39;#&#39;</span><span class="op" id="3018045">)</span><span class="op" id="3018046">;</span>&nbsp;<span class="ident" id="3018048">i</span>&nbsp;<span class="op" id="3018050">&gt;=</span>&nbsp;<span class="num" id="3018053">0</span>&nbsp;<span class="op" id="3018055">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3018061">//&nbsp;Discard&nbsp;comments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018086">line</span>&nbsp;<span class="op" id="3018091">=</span>&nbsp;<span class="ident" id="3018093">line</span><span class="op" id="3018097">[</span><span class="num" id="3018098">0</span><span class="op" id="3018099">:</span><span class="ident" id="3018100">i</span><span class="op" id="3018101">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3018106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018111">f</span>&nbsp;<span class="op" id="3018113">:=</span>&nbsp;<span class="ident" id="3018116">getFields</span><span class="op" id="3018125">(</span><span class="ident" id="3018126">line</span><span class="op" id="3018130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018135">if</span>&nbsp;<span class="builtinfunc" id="3018138">len</span><span class="op" id="3018141">(</span><span class="ident" id="3018142">f</span><span class="op" id="3018143">)</span>&nbsp;<span class="op" id="3018145">&lt;</span>&nbsp;<span class="num" id="3018147">2</span>&nbsp;<span class="op" id="3018149">||</span>&nbsp;<span class="ident" id="3018152">ParseIP</span><span class="op" id="3018159">(</span><span class="ident" id="3018160">f</span><span class="op" id="3018161">[</span><span class="num" id="3018162">0</span><span class="op" id="3018163">]</span><span class="op" id="3018164">)</span>&nbsp;<span class="op" id="3018166">==</span>&nbsp;<span class="ident" id="3018169">nil</span>&nbsp;<span class="op" id="3018173">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018179">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3018191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018196">for</span>&nbsp;<span class="ident" id="3018200">i</span>&nbsp;<span class="op" id="3018202">:=</span>&nbsp;<span class="num" id="3018205">1</span><span class="op" id="3018206">;</span>&nbsp;<span class="ident" id="3018208">i</span>&nbsp;<span class="op" id="3018210">&lt;</span>&nbsp;<span class="builtinfunc" id="3018212">len</span><span class="op" id="3018215">(</span><span class="ident" id="3018216">f</span><span class="op" id="3018217">)</span><span class="op" id="3018218">;</span>&nbsp;<span class="ident" id="3018220">i</span><span class="op" id="3018221">++</span>&nbsp;<span class="op" id="3018224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018230">h</span>&nbsp;<span class="op" id="3018232">:=</span>&nbsp;<span class="ident" id="3018235">f</span><span class="op" id="3018236">[</span><span class="ident" id="3018237">i</span><span class="op" id="3018238">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018244">hs</span><span class="op" id="3018246">[</span><span class="ident" id="3018247">h</span><span class="op" id="3018248">]</span>&nbsp;<span class="op" id="3018250">=</span>&nbsp;<span class="builtinfunc" id="3018252">append</span><span class="op" id="3018258">(</span><span class="ident" id="3018259">hs</span><span class="op" id="3018261">[</span><span class="ident" id="3018262">h</span><span class="op" id="3018263">]</span><span class="op" id="3018264">,</span>&nbsp;<span class="ident" id="3018266">f</span><span class="op" id="3018267">[</span><span class="num" id="3018268">0</span><span class="op" id="3018269">]</span><span class="op" id="3018270">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018276">is</span><span class="op" id="3018278">[</span><span class="ident" id="3018279">f</span><span class="op" id="3018280">[</span><span class="num" id="3018281">0</span><span class="op" id="3018282">]</span><span class="op" id="3018283">]</span>&nbsp;<span class="op" id="3018285">=</span>&nbsp;<span class="builtinfunc" id="3018287">append</span><span class="op" id="3018293">(</span><span class="ident" id="3018294">is</span><span class="op" id="3018296">[</span><span class="ident" id="3018297">f</span><span class="op" id="3018298">[</span><span class="num" id="3018299">0</span><span class="op" id="3018300">]</span><span class="op" id="3018301">]</span><span class="op" id="3018302">,</span>&nbsp;<span class="ident" id="3018304">h</span><span class="op" id="3018305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3018310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3018314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3018318">//&nbsp;Update&nbsp;the&nbsp;data&nbsp;cache.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018346">hosts</span><span class="op" id="3018351">.</span><span class="ident" id="3018352">expire</span>&nbsp;<span class="op" id="3018359">=</span>&nbsp;<span class="ident" id="3018361">now</span><span class="op" id="3018364">.</span><span class="ident" id="3018365">Add</span><span class="op" id="3018368">(</span><span class="ident" id="3018369">cacheMaxAge</span><span class="op" id="3018380">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018384">hosts</span><span class="op" id="3018389">.</span><span class="ident" id="3018390">path</span>&nbsp;<span class="op" id="3018395">=</span>&nbsp;<span class="ident" id="3018397">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018402">hosts</span><span class="op" id="3018407">.</span><span class="ident" id="3018408">byName</span>&nbsp;<span class="op" id="3018415">=</span>&nbsp;<span class="ident" id="3018417">hs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018422">hosts</span><span class="op" id="3018427">.</span><span class="ident" id="3018428">byAddr</span>&nbsp;<span class="op" id="3018435">=</span>&nbsp;<span class="ident" id="3018437">is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018442">file</span><span class="op" id="3018446">.</span><span class="builtinfunc" id="3018447">close</span><span class="op" id="3018452">(</span><span class="op" id="3018453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3018456">}</span><br>
<span class="lineno">60</span><span class="op" id="3018458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3018461">//&nbsp;lookupStaticHost&nbsp;looks&nbsp;up&nbsp;the&nbsp;addresses&nbsp;for&nbsp;the&nbsp;given&nbsp;host&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3018540">func</span>&nbsp;<span class="ident" id="3018545">lookupStaticHost</span><span class="op" id="3018561">(</span><span class="ident" id="3018562">host</span>&nbsp;<span class="builtintype" id="3018567">string</span><span class="op" id="3018573">)</span>&nbsp;<span class="op" id="3018575">[</span><span class="op" id="3018576">]</span><span class="builtintype" id="3018577">string</span>&nbsp;<span class="op" id="3018584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018587">hosts</span><span class="op" id="3018592">.</span><span class="ident" id="3018593">Lock</span><span class="op" id="3018597">(</span><span class="op" id="3018598">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018601">defer</span>&nbsp;<span class="ident" id="3018607">hosts</span><span class="op" id="3018612">.</span><span class="ident" id="3018613">Unlock</span><span class="op" id="3018619">(</span><span class="op" id="3018620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018623">readHosts</span><span class="op" id="3018632">(</span><span class="op" id="3018633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018636">if</span>&nbsp;<span class="builtinfunc" id="3018639">len</span><span class="op" id="3018642">(</span><span class="ident" id="3018643">hosts</span><span class="op" id="3018648">.</span><span class="ident" id="3018649">byName</span><span class="op" id="3018655">)</span>&nbsp;<span class="op" id="3018657">!=</span>&nbsp;<span class="num" id="3018660">0</span>&nbsp;<span class="op" id="3018662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018666">if</span>&nbsp;<span class="ident" id="3018669">ips</span><span class="op" id="3018672">,</span>&nbsp;<span class="ident" id="3018674">ok</span>&nbsp;<span class="op" id="3018677">:=</span>&nbsp;<span class="ident" id="3018680">hosts</span><span class="op" id="3018685">.</span><span class="ident" id="3018686">byName</span><span class="op" id="3018692">[</span><span class="ident" id="3018693">host</span><span class="op" id="3018697">]</span><span class="op" id="3018698">;</span>&nbsp;<span class="ident" id="3018700">ok</span>&nbsp;<span class="op" id="3018703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018708">return</span>&nbsp;<span class="ident" id="3018715">ips</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3018721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3018724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018727">return</span>&nbsp;<span class="ident" id="3018734">nil</span><br>
<span class="lineno"></span><span class="op" id="3018738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="3018741">//&nbsp;lookupStaticAddr&nbsp;looks&nbsp;up&nbsp;the&nbsp;hosts&nbsp;for&nbsp;the&nbsp;given&nbsp;address&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3018819">func</span>&nbsp;<span class="ident" id="3018824">lookupStaticAddr</span><span class="op" id="3018840">(</span><span class="ident" id="3018841">addr</span>&nbsp;<span class="builtintype" id="3018846">string</span><span class="op" id="3018852">)</span>&nbsp;<span class="op" id="3018854">[</span><span class="op" id="3018855">]</span><span class="builtintype" id="3018856">string</span>&nbsp;<span class="op" id="3018863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018866">hosts</span><span class="op" id="3018871">.</span><span class="ident" id="3018872">Lock</span><span class="op" id="3018876">(</span><span class="op" id="3018877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018880">defer</span>&nbsp;<span class="ident" id="3018886">hosts</span><span class="op" id="3018891">.</span><span class="ident" id="3018892">Unlock</span><span class="op" id="3018898">(</span><span class="op" id="3018899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3018902">readHosts</span><span class="op" id="3018911">(</span><span class="op" id="3018912">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018915">if</span>&nbsp;<span class="builtinfunc" id="3018918">len</span><span class="op" id="3018921">(</span><span class="ident" id="3018922">hosts</span><span class="op" id="3018927">.</span><span class="ident" id="3018928">byAddr</span><span class="op" id="3018934">)</span>&nbsp;<span class="op" id="3018936">!=</span>&nbsp;<span class="num" id="3018939">0</span>&nbsp;<span class="op" id="3018941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018945">if</span>&nbsp;<span class="ident" id="3018948">hosts</span><span class="op" id="3018953">,</span>&nbsp;<span class="ident" id="3018955">ok</span>&nbsp;<span class="op" id="3018958">:=</span>&nbsp;<span class="ident" id="3018961">hosts</span><span class="op" id="3018966">.</span><span class="ident" id="3018967">byAddr</span><span class="op" id="3018973">[</span><span class="ident" id="3018974">addr</span><span class="op" id="3018978">]</span><span class="op" id="3018979">;</span>&nbsp;<span class="ident" id="3018981">ok</span>&nbsp;<span class="op" id="3018984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3018989">return</span>&nbsp;<span class="ident" id="3018996">hosts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3019004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3019007">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3019010">return</span>&nbsp;<span class="ident" id="3019017">nil</span><br>
<span class="lineno"></span><span class="op" id="3019021">}</span>
</div>
</body>
</html>
