<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6538004">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6538059">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6538113">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6538164">package</span>&nbsp;<span class="ident" id="6538172">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6538177">import</span>&nbsp;<span class="op" id="6538184">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6538187">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6538196">&#34;image&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6538205">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538220">_</span>&nbsp;<span class="string" id="6538222">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6538235">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6538248">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6538261">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6538267">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6538277">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6538280">func</span>&nbsp;<span class="ident" id="6538285">readImg</span><span class="op" id="6538292">(</span><span class="ident" id="6538293">filename</span>&nbsp;<span class="builtintype" id="6538302">string</span><span class="op" id="6538308">)</span>&nbsp;<span class="op" id="6538310">(</span><span class="ident" id="6538311">image</span><span class="op" id="6538316">.</span><span class="ident" id="6538317">Image</span><span class="op" id="6538322">,</span>&nbsp;<span class="builtintype" id="6538324">error</span><span class="op" id="6538329">)</span>&nbsp;<span class="op" id="6538331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538334">f</span><span class="op" id="6538335">,</span>&nbsp;<span class="ident" id="6538337">err</span>&nbsp;<span class="op" id="6538341">:=</span>&nbsp;<span class="ident" id="6538344">os</span><span class="op" id="6538346">.</span><span class="ident" id="6538347">Open</span><span class="op" id="6538351">(</span><span class="ident" id="6538352">filename</span><span class="op" id="6538360">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538363">if</span>&nbsp;<span class="ident" id="6538366">err</span>&nbsp;<span class="op" id="6538370">!=</span>&nbsp;<span class="ident" id="6538373">nil</span>&nbsp;<span class="op" id="6538377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538381">return</span>&nbsp;<span class="ident" id="6538388">nil</span><span class="op" id="6538391">,</span>&nbsp;<span class="ident" id="6538393">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538401">defer</span>&nbsp;<span class="ident" id="6538407">f</span><span class="op" id="6538408">.</span><span class="ident" id="6538409">Close</span><span class="op" id="6538414">(</span><span class="op" id="6538415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538418">m</span><span class="op" id="6538419">,</span>&nbsp;<span class="ident" id="6538421">_</span><span class="op" id="6538422">,</span>&nbsp;<span class="ident" id="6538424">err</span>&nbsp;<span class="op" id="6538428">:=</span>&nbsp;<span class="ident" id="6538431">image</span><span class="op" id="6538436">.</span><span class="ident" id="6538437">Decode</span><span class="op" id="6538443">(</span><span class="ident" id="6538444">f</span><span class="op" id="6538445">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538448">return</span>&nbsp;<span class="ident" id="6538455">m</span><span class="op" id="6538456">,</span>&nbsp;<span class="ident" id="6538458">err</span><br>
<span class="lineno"></span><span class="op" id="6538462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6538465">func</span>&nbsp;<span class="ident" id="6538470">readGIF</span><span class="op" id="6538477">(</span><span class="ident" id="6538478">filename</span>&nbsp;<span class="builtintype" id="6538487">string</span><span class="op" id="6538493">)</span>&nbsp;<span class="op" id="6538495">(</span><span class="op" id="6538496">*</span><span class="ident" id="6538497">GIF</span><span class="op" id="6538500">,</span>&nbsp;<span class="builtintype" id="6538502">error</span><span class="op" id="6538507">)</span>&nbsp;<span class="op" id="6538509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538512">f</span><span class="op" id="6538513">,</span>&nbsp;<span class="ident" id="6538515">err</span>&nbsp;<span class="op" id="6538519">:=</span>&nbsp;<span class="ident" id="6538522">os</span><span class="op" id="6538524">.</span><span class="ident" id="6538525">Open</span><span class="op" id="6538529">(</span><span class="ident" id="6538530">filename</span><span class="op" id="6538538">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538541">if</span>&nbsp;<span class="ident" id="6538544">err</span>&nbsp;<span class="op" id="6538548">!=</span>&nbsp;<span class="ident" id="6538551">nil</span>&nbsp;<span class="op" id="6538555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538559">return</span>&nbsp;<span class="ident" id="6538566">nil</span><span class="op" id="6538569">,</span>&nbsp;<span class="ident" id="6538571">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538579">defer</span>&nbsp;<span class="ident" id="6538585">f</span><span class="op" id="6538586">.</span><span class="ident" id="6538587">Close</span><span class="op" id="6538592">(</span><span class="op" id="6538593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538596">return</span>&nbsp;<span class="ident" id="6538603">DecodeAll</span><span class="op" id="6538612">(</span><span class="ident" id="6538613">f</span><span class="op" id="6538614">)</span><br>
<span class="lineno">35</span><span class="op" id="6538616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6538619">func</span>&nbsp;<span class="ident" id="6538624">delta</span><span class="op" id="6538629">(</span><span class="ident" id="6538630">u0</span><span class="op" id="6538632">,</span>&nbsp;<span class="ident" id="6538634">u1</span>&nbsp;<span class="builtintype" id="6538637">uint32</span><span class="op" id="6538643">)</span>&nbsp;<span class="ident" id="6538645">int64</span>&nbsp;<span class="op" id="6538651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538654">d</span>&nbsp;<span class="op" id="6538656">:=</span>&nbsp;<span class="ident" id="6538659">int64</span><span class="op" id="6538664">(</span><span class="ident" id="6538665">u0</span><span class="op" id="6538667">)</span>&nbsp;<span class="op" id="6538669">-</span>&nbsp;<span class="ident" id="6538671">int64</span><span class="op" id="6538676">(</span><span class="ident" id="6538677">u1</span><span class="op" id="6538679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538682">if</span>&nbsp;<span class="ident" id="6538685">d</span>&nbsp;<span class="op" id="6538687">&lt;</span>&nbsp;<span class="num" id="6538689">0</span>&nbsp;<span class="op" id="6538691">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538695">return</span>&nbsp;<span class="op" id="6538702">-</span><span class="ident" id="6538703">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538709">return</span>&nbsp;<span class="ident" id="6538716">d</span><br>
<span class="lineno"></span><span class="op" id="6538718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="6538721">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="6538797">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="6538822">func</span>&nbsp;<span class="ident" id="6538827">averageDelta</span><span class="op" id="6538839">(</span><span class="ident" id="6538840">m0</span><span class="op" id="6538842">,</span>&nbsp;<span class="ident" id="6538844">m1</span>&nbsp;<span class="ident" id="6538847">image</span><span class="op" id="6538852">.</span><span class="ident" id="6538853">Image</span><span class="op" id="6538858">)</span>&nbsp;<span class="ident" id="6538860">int64</span>&nbsp;<span class="op" id="6538866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538869">b</span>&nbsp;<span class="op" id="6538871">:=</span>&nbsp;<span class="ident" id="6538874">m0</span><span class="op" id="6538876">.</span><span class="ident" id="6538877">Bounds</span><span class="op" id="6538883">(</span><span class="op" id="6538884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538887">var</span>&nbsp;<span class="ident" id="6538891">sum</span><span class="op" id="6538894">,</span>&nbsp;<span class="ident" id="6538896">n</span>&nbsp;<span class="ident" id="6538898">int64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538905">for</span>&nbsp;<span class="ident" id="6538909">y</span>&nbsp;<span class="op" id="6538911">:=</span>&nbsp;<span class="ident" id="6538914">b</span><span class="op" id="6538915">.</span><span class="ident" id="6538916">Min</span><span class="op" id="6538919">.</span><span class="ident" id="6538920">Y</span><span class="op" id="6538921">;</span>&nbsp;<span class="ident" id="6538923">y</span>&nbsp;<span class="op" id="6538925">&lt;</span>&nbsp;<span class="ident" id="6538927">b</span><span class="op" id="6538928">.</span><span class="ident" id="6538929">Max</span><span class="op" id="6538932">.</span><span class="ident" id="6538933">Y</span><span class="op" id="6538934">;</span>&nbsp;<span class="ident" id="6538936">y</span><span class="op" id="6538937">++</span>&nbsp;<span class="op" id="6538940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538944">for</span>&nbsp;<span class="ident" id="6538948">x</span>&nbsp;<span class="op" id="6538950">:=</span>&nbsp;<span class="ident" id="6538953">b</span><span class="op" id="6538954">.</span><span class="ident" id="6538955">Min</span><span class="op" id="6538958">.</span><span class="ident" id="6538959">X</span><span class="op" id="6538960">;</span>&nbsp;<span class="ident" id="6538962">x</span>&nbsp;<span class="op" id="6538964">&lt;</span>&nbsp;<span class="ident" id="6538966">b</span><span class="op" id="6538967">.</span><span class="ident" id="6538968">Max</span><span class="op" id="6538971">.</span><span class="ident" id="6538972">X</span><span class="op" id="6538973">;</span>&nbsp;<span class="ident" id="6538975">x</span><span class="op" id="6538976">++</span>&nbsp;<span class="op" id="6538979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538984">c0</span>&nbsp;<span class="op" id="6538987">:=</span>&nbsp;<span class="ident" id="6538990">m0</span><span class="op" id="6538992">.</span><span class="ident" id="6538993">At</span><span class="op" id="6538995">(</span><span class="ident" id="6538996">x</span><span class="op" id="6538997">,</span>&nbsp;<span class="ident" id="6538999">y</span><span class="op" id="6539000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539005">c1</span>&nbsp;<span class="op" id="6539008">:=</span>&nbsp;<span class="ident" id="6539011">m1</span><span class="op" id="6539013">.</span><span class="ident" id="6539014">At</span><span class="op" id="6539016">(</span><span class="ident" id="6539017">x</span><span class="op" id="6539018">,</span>&nbsp;<span class="ident" id="6539020">y</span><span class="op" id="6539021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539026">r0</span><span class="op" id="6539028">,</span>&nbsp;<span class="ident" id="6539030">g0</span><span class="op" id="6539032">,</span>&nbsp;<span class="ident" id="6539034">b0</span><span class="op" id="6539036">,</span>&nbsp;<span class="ident" id="6539038">_</span>&nbsp;<span class="op" id="6539040">:=</span>&nbsp;<span class="ident" id="6539043">c0</span><span class="op" id="6539045">.</span><span class="ident" id="6539046">RGBA</span><span class="op" id="6539050">(</span><span class="op" id="6539051">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539056">r1</span><span class="op" id="6539058">,</span>&nbsp;<span class="ident" id="6539060">g1</span><span class="op" id="6539062">,</span>&nbsp;<span class="ident" id="6539064">b1</span><span class="op" id="6539066">,</span>&nbsp;<span class="ident" id="6539068">_</span>&nbsp;<span class="op" id="6539070">:=</span>&nbsp;<span class="ident" id="6539073">c1</span><span class="op" id="6539075">.</span><span class="ident" id="6539076">RGBA</span><span class="op" id="6539080">(</span><span class="op" id="6539081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539086">sum</span>&nbsp;<span class="op" id="6539090">+=</span>&nbsp;<span class="ident" id="6539093">delta</span><span class="op" id="6539098">(</span><span class="ident" id="6539099">r0</span><span class="op" id="6539101">,</span>&nbsp;<span class="ident" id="6539103">r1</span><span class="op" id="6539105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539110">sum</span>&nbsp;<span class="op" id="6539114">+=</span>&nbsp;<span class="ident" id="6539117">delta</span><span class="op" id="6539122">(</span><span class="ident" id="6539123">g0</span><span class="op" id="6539125">,</span>&nbsp;<span class="ident" id="6539127">g1</span><span class="op" id="6539129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539134">sum</span>&nbsp;<span class="op" id="6539138">+=</span>&nbsp;<span class="ident" id="6539141">delta</span><span class="op" id="6539146">(</span><span class="ident" id="6539147">b0</span><span class="op" id="6539149">,</span>&nbsp;<span class="ident" id="6539151">b1</span><span class="op" id="6539153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539158">n</span>&nbsp;<span class="op" id="6539160">+=</span>&nbsp;<span class="num" id="6539163">3</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539173">return</span>&nbsp;<span class="ident" id="6539180">sum</span>&nbsp;<span class="op" id="6539184">/</span>&nbsp;<span class="ident" id="6539186">n</span><br>
<span class="lineno"></span><span class="op" id="6539188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="6539191">var</span>&nbsp;<span class="ident" id="6539195">testCase</span>&nbsp;<span class="op" id="6539204">=</span>&nbsp;<span class="op" id="6539206">[</span><span class="op" id="6539207">]</span><span class="keyword" id="6539208">struct</span>&nbsp;<span class="op" id="6539215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539218">filename</span>&nbsp;&nbsp;<span class="builtintype" id="6539228">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539236">tolerance</span>&nbsp;<span class="ident" id="6539246">int64</span><br>
<span class="lineno"></span><span class="op" id="6539252">}</span><span class="op" id="6539253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539256">{</span><span class="string" id="6539257">&#34;../testdata/video-001.png&#34;</span><span class="op" id="6539284">,</span>&nbsp;<span class="num" id="6539286">1</span>&nbsp;<span class="op" id="6539288">&lt;&lt;</span>&nbsp;<span class="num" id="6539291">12</span><span class="op" id="6539293">}</span><span class="op" id="6539294">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539297">{</span><span class="string" id="6539298">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="6539325">,</span>&nbsp;<span class="num" id="6539327">0</span><span class="op" id="6539328">}</span><span class="op" id="6539329">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539332">{</span><span class="string" id="6539333">&#34;../testdata/video-001.interlaced.gif&#34;</span><span class="op" id="6539371">,</span>&nbsp;<span class="num" id="6539373">0</span><span class="op" id="6539374">}</span><span class="op" id="6539375">,</span><br>
<span class="lineno"></span><span class="op" id="6539377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6539380">func</span>&nbsp;<span class="ident" id="6539385">TestWriter</span><span class="op" id="6539395">(</span><span class="ident" id="6539396">t</span>&nbsp;<span class="op" id="6539398">*</span><span class="ident" id="6539399">testing</span><span class="op" id="6539406">.</span><span class="ident" id="6539407">T</span><span class="op" id="6539408">)</span>&nbsp;<span class="op" id="6539410">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539413">for</span>&nbsp;<span class="ident" id="6539417">_</span><span class="op" id="6539418">,</span>&nbsp;<span class="ident" id="6539420">tc</span>&nbsp;<span class="op" id="6539423">:=</span>&nbsp;<span class="keyword" id="6539426">range</span>&nbsp;<span class="ident" id="6539432">testCase</span>&nbsp;<span class="op" id="6539441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539445">m0</span><span class="op" id="6539447">,</span>&nbsp;<span class="ident" id="6539449">err</span>&nbsp;<span class="op" id="6539453">:=</span>&nbsp;<span class="ident" id="6539456">readImg</span><span class="op" id="6539463">(</span><span class="ident" id="6539464">tc</span><span class="op" id="6539466">.</span><span class="ident" id="6539467">filename</span><span class="op" id="6539475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539479">if</span>&nbsp;<span class="ident" id="6539482">err</span>&nbsp;<span class="op" id="6539486">!=</span>&nbsp;<span class="ident" id="6539489">nil</span>&nbsp;<span class="op" id="6539493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539498">t</span><span class="op" id="6539499">.</span><span class="ident" id="6539500">Error</span><span class="op" id="6539505">(</span><span class="ident" id="6539506">tc</span><span class="op" id="6539508">.</span><span class="ident" id="6539509">filename</span><span class="op" id="6539517">,</span>&nbsp;<span class="ident" id="6539519">err</span><span class="op" id="6539522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539527">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539542">var</span>&nbsp;<span class="ident" id="6539546">buf</span>&nbsp;<span class="ident" id="6539550">bytes</span><span class="op" id="6539555">.</span><span class="ident" id="6539556">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539565">err</span>&nbsp;<span class="op" id="6539569">=</span>&nbsp;<span class="ident" id="6539571">Encode</span><span class="op" id="6539577">(</span><span class="op" id="6539578">&amp;</span><span class="ident" id="6539579">buf</span><span class="op" id="6539582">,</span>&nbsp;<span class="ident" id="6539584">m0</span><span class="op" id="6539586">,</span>&nbsp;<span class="ident" id="6539588">nil</span><span class="op" id="6539591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539595">if</span>&nbsp;<span class="ident" id="6539598">err</span>&nbsp;<span class="op" id="6539602">!=</span>&nbsp;<span class="ident" id="6539605">nil</span>&nbsp;<span class="op" id="6539609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539614">t</span><span class="op" id="6539615">.</span><span class="ident" id="6539616">Error</span><span class="op" id="6539621">(</span><span class="ident" id="6539622">tc</span><span class="op" id="6539624">.</span><span class="ident" id="6539625">filename</span><span class="op" id="6539633">,</span>&nbsp;<span class="ident" id="6539635">err</span><span class="op" id="6539638">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539643">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539658">m1</span><span class="op" id="6539660">,</span>&nbsp;<span class="ident" id="6539662">err</span>&nbsp;<span class="op" id="6539666">:=</span>&nbsp;<span class="ident" id="6539669">Decode</span><span class="op" id="6539675">(</span><span class="op" id="6539676">&amp;</span><span class="ident" id="6539677">buf</span><span class="op" id="6539680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539684">if</span>&nbsp;<span class="ident" id="6539687">err</span>&nbsp;<span class="op" id="6539691">!=</span>&nbsp;<span class="ident" id="6539694">nil</span>&nbsp;<span class="op" id="6539698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539703">t</span><span class="op" id="6539704">.</span><span class="ident" id="6539705">Error</span><span class="op" id="6539710">(</span><span class="ident" id="6539711">tc</span><span class="op" id="6539713">.</span><span class="ident" id="6539714">filename</span><span class="op" id="6539722">,</span>&nbsp;<span class="ident" id="6539724">err</span><span class="op" id="6539727">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539732">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539747">if</span>&nbsp;<span class="ident" id="6539750">m0</span><span class="op" id="6539752">.</span><span class="ident" id="6539753">Bounds</span><span class="op" id="6539759">(</span><span class="op" id="6539760">)</span>&nbsp;<span class="op" id="6539762">!=</span>&nbsp;<span class="ident" id="6539765">m1</span><span class="op" id="6539767">.</span><span class="ident" id="6539768">Bounds</span><span class="op" id="6539774">(</span><span class="op" id="6539775">)</span>&nbsp;<span class="op" id="6539777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539782">t</span><span class="op" id="6539783">.</span><span class="ident" id="6539784">Errorf</span><span class="op" id="6539790">(</span><span class="string" id="6539791">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="6539821">,</span>&nbsp;<span class="ident" id="6539823">tc</span><span class="op" id="6539825">.</span><span class="ident" id="6539826">filename</span><span class="op" id="6539834">,</span>&nbsp;<span class="ident" id="6539836">m0</span><span class="op" id="6539838">.</span><span class="ident" id="6539839">Bounds</span><span class="op" id="6539845">(</span><span class="op" id="6539846">)</span><span class="op" id="6539847">,</span>&nbsp;<span class="ident" id="6539849">m1</span><span class="op" id="6539851">.</span><span class="ident" id="6539852">Bounds</span><span class="op" id="6539858">(</span><span class="op" id="6539859">)</span><span class="op" id="6539860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539865">continue</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6539880">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539935">avgDelta</span>&nbsp;<span class="op" id="6539944">:=</span>&nbsp;<span class="ident" id="6539947">averageDelta</span><span class="op" id="6539959">(</span><span class="ident" id="6539960">m0</span><span class="op" id="6539962">,</span>&nbsp;<span class="ident" id="6539964">m1</span><span class="op" id="6539966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539970">if</span>&nbsp;<span class="ident" id="6539973">avgDelta</span>&nbsp;<span class="op" id="6539982">&gt;</span>&nbsp;<span class="ident" id="6539984">tc</span><span class="op" id="6539986">.</span><span class="ident" id="6539987">tolerance</span>&nbsp;<span class="op" id="6539997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540002">t</span><span class="op" id="6540003">.</span><span class="ident" id="6540004">Errorf</span><span class="op" id="6540010">(</span><span class="string" id="6540011">&#34;%s:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high.&nbsp;expected:&nbsp;%d,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6540064">,</span>&nbsp;<span class="ident" id="6540066">tc</span><span class="op" id="6540068">.</span><span class="ident" id="6540069">filename</span><span class="op" id="6540077">,</span>&nbsp;<span class="ident" id="6540079">tc</span><span class="op" id="6540081">.</span><span class="ident" id="6540082">tolerance</span><span class="op" id="6540091">,</span>&nbsp;<span class="ident" id="6540093">avgDelta</span><span class="op" id="6540101">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540106">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540120">}</span><br>
<span class="lineno"></span><span class="op" id="6540122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6540125">func</span>&nbsp;<span class="ident" id="6540130">TestSubImage</span><span class="op" id="6540142">(</span><span class="ident" id="6540143">t</span>&nbsp;<span class="op" id="6540145">*</span><span class="ident" id="6540146">testing</span><span class="op" id="6540153">.</span><span class="ident" id="6540154">T</span><span class="op" id="6540155">)</span>&nbsp;<span class="op" id="6540157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540160">m0</span><span class="op" id="6540162">,</span>&nbsp;<span class="ident" id="6540164">err</span>&nbsp;<span class="op" id="6540168">:=</span>&nbsp;<span class="ident" id="6540171">readImg</span><span class="op" id="6540178">(</span><span class="string" id="6540179">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="6540206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540209">if</span>&nbsp;<span class="ident" id="6540212">err</span>&nbsp;<span class="op" id="6540216">!=</span>&nbsp;<span class="ident" id="6540219">nil</span>&nbsp;<span class="op" id="6540223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540227">t</span><span class="op" id="6540228">.</span><span class="ident" id="6540229">Fatalf</span><span class="op" id="6540235">(</span><span class="string" id="6540236">&#34;readImg:&nbsp;%v&#34;</span><span class="op" id="6540249">,</span>&nbsp;<span class="ident" id="6540251">err</span><span class="op" id="6540254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540257">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540260">m0</span>&nbsp;<span class="op" id="6540263">=</span>&nbsp;<span class="ident" id="6540265">m0</span><span class="op" id="6540267">.</span><span class="op" id="6540268">(</span><span class="op" id="6540269">*</span><span class="ident" id="6540270">image</span><span class="op" id="6540275">.</span><span class="ident" id="6540276">Paletted</span><span class="op" id="6540284">)</span><span class="op" id="6540285">.</span><span class="ident" id="6540286">SubImage</span><span class="op" id="6540294">(</span><span class="ident" id="6540295">image</span><span class="op" id="6540300">.</span><span class="ident" id="6540301">Rect</span><span class="op" id="6540305">(</span><span class="num" id="6540306">0</span><span class="op" id="6540307">,</span>&nbsp;<span class="num" id="6540309">0</span><span class="op" id="6540310">,</span>&nbsp;<span class="num" id="6540312">50</span><span class="op" id="6540314">,</span>&nbsp;<span class="num" id="6540316">30</span><span class="op" id="6540318">)</span><span class="op" id="6540319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540322">var</span>&nbsp;<span class="ident" id="6540326">buf</span>&nbsp;<span class="ident" id="6540330">bytes</span><span class="op" id="6540335">.</span><span class="ident" id="6540336">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540344">err</span>&nbsp;<span class="op" id="6540348">=</span>&nbsp;<span class="ident" id="6540350">Encode</span><span class="op" id="6540356">(</span><span class="op" id="6540357">&amp;</span><span class="ident" id="6540358">buf</span><span class="op" id="6540361">,</span>&nbsp;<span class="ident" id="6540363">m0</span><span class="op" id="6540365">,</span>&nbsp;<span class="ident" id="6540367">nil</span><span class="op" id="6540370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540373">if</span>&nbsp;<span class="ident" id="6540376">err</span>&nbsp;<span class="op" id="6540380">!=</span>&nbsp;<span class="ident" id="6540383">nil</span>&nbsp;<span class="op" id="6540387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540391">t</span><span class="op" id="6540392">.</span><span class="ident" id="6540393">Fatalf</span><span class="op" id="6540399">(</span><span class="string" id="6540400">&#34;Encode:&nbsp;%v&#34;</span><span class="op" id="6540412">,</span>&nbsp;<span class="ident" id="6540414">err</span><span class="op" id="6540417">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540423">m1</span><span class="op" id="6540425">,</span>&nbsp;<span class="ident" id="6540427">err</span>&nbsp;<span class="op" id="6540431">:=</span>&nbsp;<span class="ident" id="6540434">Decode</span><span class="op" id="6540440">(</span><span class="op" id="6540441">&amp;</span><span class="ident" id="6540442">buf</span><span class="op" id="6540445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540448">if</span>&nbsp;<span class="ident" id="6540451">err</span>&nbsp;<span class="op" id="6540455">!=</span>&nbsp;<span class="ident" id="6540458">nil</span>&nbsp;<span class="op" id="6540462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540466">t</span><span class="op" id="6540467">.</span><span class="ident" id="6540468">Fatalf</span><span class="op" id="6540474">(</span><span class="string" id="6540475">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="6540487">,</span>&nbsp;<span class="ident" id="6540489">err</span><span class="op" id="6540492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540495">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540498">if</span>&nbsp;<span class="ident" id="6540501">m0</span><span class="op" id="6540503">.</span><span class="ident" id="6540504">Bounds</span><span class="op" id="6540510">(</span><span class="op" id="6540511">)</span>&nbsp;<span class="op" id="6540513">!=</span>&nbsp;<span class="ident" id="6540516">m1</span><span class="op" id="6540518">.</span><span class="ident" id="6540519">Bounds</span><span class="op" id="6540525">(</span><span class="op" id="6540526">)</span>&nbsp;<span class="op" id="6540528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540532">t</span><span class="op" id="6540533">.</span><span class="ident" id="6540534">Fatalf</span><span class="op" id="6540540">(</span><span class="string" id="6540541">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="6540567">,</span>&nbsp;<span class="ident" id="6540569">m0</span><span class="op" id="6540571">.</span><span class="ident" id="6540572">Bounds</span><span class="op" id="6540578">(</span><span class="op" id="6540579">)</span><span class="op" id="6540580">,</span>&nbsp;<span class="ident" id="6540582">m1</span><span class="op" id="6540584">.</span><span class="ident" id="6540585">Bounds</span><span class="op" id="6540591">(</span><span class="op" id="6540592">)</span><span class="op" id="6540593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540599">if</span>&nbsp;<span class="ident" id="6540602">averageDelta</span><span class="op" id="6540614">(</span><span class="ident" id="6540615">m0</span><span class="op" id="6540617">,</span>&nbsp;<span class="ident" id="6540619">m1</span><span class="op" id="6540621">)</span>&nbsp;<span class="op" id="6540623">!=</span>&nbsp;<span class="num" id="6540626">0</span>&nbsp;<span class="op" id="6540628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540632">t</span><span class="op" id="6540633">.</span><span class="ident" id="6540634">Fatalf</span><span class="op" id="6540640">(</span><span class="string" id="6540641">&#34;images&nbsp;differ&#34;</span><span class="op" id="6540656">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540659">}</span><br>
<span class="lineno"></span><span class="op" id="6540661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6540664">var</span>&nbsp;<span class="ident" id="6540668">frames</span>&nbsp;<span class="op" id="6540675">=</span>&nbsp;<span class="op" id="6540677">[</span><span class="op" id="6540678">]</span><span class="builtintype" id="6540679">string</span><span class="op" id="6540685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6540688">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="6540715">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6540718">&#34;../testdata/video-005.gray.gif&#34;</span><span class="op" id="6540750">,</span><br>
<span class="lineno"></span><span class="op" id="6540752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6540755">func</span>&nbsp;<span class="ident" id="6540760">TestEncodeAll</span><span class="op" id="6540773">(</span><span class="ident" id="6540774">t</span>&nbsp;<span class="op" id="6540776">*</span><span class="ident" id="6540777">testing</span><span class="op" id="6540784">.</span><span class="ident" id="6540785">T</span><span class="op" id="6540786">)</span>&nbsp;<span class="op" id="6540788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540791">g0</span>&nbsp;<span class="op" id="6540794">:=</span>&nbsp;<span class="op" id="6540797">&amp;</span><span class="ident" id="6540798">GIF</span><span class="op" id="6540801">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540805">Image</span><span class="op" id="6540810">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6540816">make</span><span class="op" id="6540820">(</span><span class="op" id="6540821">[</span><span class="op" id="6540822">]</span><span class="op" id="6540823">*</span><span class="ident" id="6540824">image</span><span class="op" id="6540829">.</span><span class="ident" id="6540830">Paletted</span><span class="op" id="6540838">,</span>&nbsp;<span class="builtinfunc" id="6540840">len</span><span class="op" id="6540843">(</span><span class="ident" id="6540844">frames</span><span class="op" id="6540850">)</span><span class="op" id="6540851">)</span><span class="op" id="6540852">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540856">Delay</span><span class="op" id="6540861">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6540867">make</span><span class="op" id="6540871">(</span><span class="op" id="6540872">[</span><span class="op" id="6540873">]</span><span class="builtintype" id="6540874">int</span><span class="op" id="6540877">,</span>&nbsp;<span class="builtinfunc" id="6540879">len</span><span class="op" id="6540882">(</span><span class="ident" id="6540883">frames</span><span class="op" id="6540889">)</span><span class="op" id="6540890">)</span><span class="op" id="6540891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540895">LoopCount</span><span class="op" id="6540904">:</span>&nbsp;<span class="num" id="6540906">5</span><span class="op" id="6540907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540913">for</span>&nbsp;<span class="ident" id="6540917">i</span><span class="op" id="6540918">,</span>&nbsp;<span class="ident" id="6540920">f</span>&nbsp;<span class="op" id="6540922">:=</span>&nbsp;<span class="keyword" id="6540925">range</span>&nbsp;<span class="ident" id="6540931">frames</span>&nbsp;<span class="op" id="6540938">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540942">m</span><span class="op" id="6540943">,</span>&nbsp;<span class="ident" id="6540945">err</span>&nbsp;<span class="op" id="6540949">:=</span>&nbsp;<span class="ident" id="6540952">readGIF</span><span class="op" id="6540959">(</span><span class="ident" id="6540960">f</span><span class="op" id="6540961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540965">if</span>&nbsp;<span class="ident" id="6540968">err</span>&nbsp;<span class="op" id="6540972">!=</span>&nbsp;<span class="ident" id="6540975">nil</span>&nbsp;<span class="op" id="6540979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540984">t</span><span class="op" id="6540985">.</span><span class="ident" id="6540986">Fatal</span><span class="op" id="6540991">(</span><span class="ident" id="6540992">f</span><span class="op" id="6540993">,</span>&nbsp;<span class="ident" id="6540995">err</span><span class="op" id="6540998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541006">g0</span><span class="op" id="6541008">.</span><span class="ident" id="6541009">Image</span><span class="op" id="6541014">[</span><span class="ident" id="6541015">i</span><span class="op" id="6541016">]</span>&nbsp;<span class="op" id="6541018">=</span>&nbsp;<span class="ident" id="6541020">m</span><span class="op" id="6541021">.</span><span class="ident" id="6541022">Image</span><span class="op" id="6541027">[</span><span class="num" id="6541028">0</span><span class="op" id="6541029">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541035">var</span>&nbsp;<span class="ident" id="6541039">buf</span>&nbsp;<span class="ident" id="6541043">bytes</span><span class="op" id="6541048">.</span><span class="ident" id="6541049">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541057">if</span>&nbsp;<span class="ident" id="6541060">err</span>&nbsp;<span class="op" id="6541064">:=</span>&nbsp;<span class="ident" id="6541067">EncodeAll</span><span class="op" id="6541076">(</span><span class="op" id="6541077">&amp;</span><span class="ident" id="6541078">buf</span><span class="op" id="6541081">,</span>&nbsp;<span class="ident" id="6541083">g0</span><span class="op" id="6541085">)</span><span class="op" id="6541086">;</span>&nbsp;<span class="ident" id="6541088">err</span>&nbsp;<span class="op" id="6541092">!=</span>&nbsp;<span class="ident" id="6541095">nil</span>&nbsp;<span class="op" id="6541099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541103">t</span><span class="op" id="6541104">.</span><span class="ident" id="6541105">Fatal</span><span class="op" id="6541110">(</span><span class="string" id="6541111">&#34;EncodeAll:&#34;</span><span class="op" id="6541123">,</span>&nbsp;<span class="ident" id="6541125">err</span><span class="op" id="6541128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541131">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541134">g1</span><span class="op" id="6541136">,</span>&nbsp;<span class="ident" id="6541138">err</span>&nbsp;<span class="op" id="6541142">:=</span>&nbsp;<span class="ident" id="6541145">DecodeAll</span><span class="op" id="6541154">(</span><span class="op" id="6541155">&amp;</span><span class="ident" id="6541156">buf</span><span class="op" id="6541159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541162">if</span>&nbsp;<span class="ident" id="6541165">err</span>&nbsp;<span class="op" id="6541169">!=</span>&nbsp;<span class="ident" id="6541172">nil</span>&nbsp;<span class="op" id="6541176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541180">t</span><span class="op" id="6541181">.</span><span class="ident" id="6541182">Fatal</span><span class="op" id="6541187">(</span><span class="string" id="6541188">&#34;DecodeAll:&#34;</span><span class="op" id="6541200">,</span>&nbsp;<span class="ident" id="6541202">err</span><span class="op" id="6541205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541211">if</span>&nbsp;<span class="ident" id="6541214">g0</span><span class="op" id="6541216">.</span><span class="ident" id="6541217">LoopCount</span>&nbsp;<span class="op" id="6541227">!=</span>&nbsp;<span class="ident" id="6541230">g1</span><span class="op" id="6541232">.</span><span class="ident" id="6541233">LoopCount</span>&nbsp;<span class="op" id="6541243">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541247">t</span><span class="op" id="6541248">.</span><span class="ident" id="6541249">Errorf</span><span class="op" id="6541255">(</span><span class="string" id="6541256">&#34;loop&nbsp;counts&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="6541287">,</span>&nbsp;<span class="ident" id="6541289">g0</span><span class="op" id="6541291">.</span><span class="ident" id="6541292">LoopCount</span><span class="op" id="6541301">,</span>&nbsp;<span class="ident" id="6541303">g1</span><span class="op" id="6541305">.</span><span class="ident" id="6541306">LoopCount</span><span class="op" id="6541315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541321">for</span>&nbsp;<span class="ident" id="6541325">i</span>&nbsp;<span class="op" id="6541327">:=</span>&nbsp;<span class="keyword" id="6541330">range</span>&nbsp;<span class="ident" id="6541336">g0</span><span class="op" id="6541338">.</span><span class="ident" id="6541339">Image</span>&nbsp;<span class="op" id="6541345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541349">m0</span><span class="op" id="6541351">,</span>&nbsp;<span class="ident" id="6541353">m1</span>&nbsp;<span class="op" id="6541356">:=</span>&nbsp;<span class="ident" id="6541359">g0</span><span class="op" id="6541361">.</span><span class="ident" id="6541362">Image</span><span class="op" id="6541367">[</span><span class="ident" id="6541368">i</span><span class="op" id="6541369">]</span><span class="op" id="6541370">,</span>&nbsp;<span class="ident" id="6541372">g1</span><span class="op" id="6541374">.</span><span class="ident" id="6541375">Image</span><span class="op" id="6541380">[</span><span class="ident" id="6541381">i</span><span class="op" id="6541382">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541386">if</span>&nbsp;<span class="ident" id="6541389">m0</span><span class="op" id="6541391">.</span><span class="ident" id="6541392">Bounds</span><span class="op" id="6541398">(</span><span class="op" id="6541399">)</span>&nbsp;<span class="op" id="6541401">!=</span>&nbsp;<span class="ident" id="6541404">m1</span><span class="op" id="6541406">.</span><span class="ident" id="6541407">Bounds</span><span class="op" id="6541413">(</span><span class="op" id="6541414">)</span>&nbsp;<span class="op" id="6541416">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541421">t</span><span class="op" id="6541422">.</span><span class="ident" id="6541423">Errorf</span><span class="op" id="6541429">(</span><span class="string" id="6541430">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="6541460">,</span>&nbsp;<span class="ident" id="6541462">frames</span><span class="op" id="6541468">[</span><span class="ident" id="6541469">i</span><span class="op" id="6541470">]</span><span class="op" id="6541471">,</span>&nbsp;<span class="ident" id="6541473">m0</span><span class="op" id="6541475">.</span><span class="ident" id="6541476">Bounds</span><span class="op" id="6541482">(</span><span class="op" id="6541483">)</span><span class="op" id="6541484">,</span>&nbsp;<span class="ident" id="6541486">m1</span><span class="op" id="6541488">.</span><span class="ident" id="6541489">Bounds</span><span class="op" id="6541495">(</span><span class="op" id="6541496">)</span><span class="op" id="6541497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541505">d0</span><span class="op" id="6541507">,</span>&nbsp;<span class="ident" id="6541509">d1</span>&nbsp;<span class="op" id="6541512">:=</span>&nbsp;<span class="ident" id="6541515">g0</span><span class="op" id="6541517">.</span><span class="ident" id="6541518">Delay</span><span class="op" id="6541523">[</span><span class="ident" id="6541524">i</span><span class="op" id="6541525">]</span><span class="op" id="6541526">,</span>&nbsp;<span class="ident" id="6541528">g1</span><span class="op" id="6541530">.</span><span class="ident" id="6541531">Delay</span><span class="op" id="6541536">[</span><span class="ident" id="6541537">i</span><span class="op" id="6541538">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541542">if</span>&nbsp;<span class="ident" id="6541545">d0</span>&nbsp;<span class="op" id="6541548">!=</span>&nbsp;<span class="ident" id="6541551">d1</span>&nbsp;<span class="op" id="6541554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541559">t</span><span class="op" id="6541560">.</span><span class="ident" id="6541561">Errorf</span><span class="op" id="6541567">(</span><span class="string" id="6541568">&#34;%s:&nbsp;delay&nbsp;values&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="6541604">,</span>&nbsp;<span class="ident" id="6541606">frames</span><span class="op" id="6541612">[</span><span class="ident" id="6541613">i</span><span class="op" id="6541614">]</span><span class="op" id="6541615">,</span>&nbsp;<span class="ident" id="6541617">d0</span><span class="op" id="6541619">,</span>&nbsp;<span class="ident" id="6541621">d1</span><span class="op" id="6541623">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541634">g1</span><span class="op" id="6541636">.</span><span class="ident" id="6541637">Delay</span>&nbsp;<span class="op" id="6541643">=</span>&nbsp;<span class="builtinfunc" id="6541645">make</span><span class="op" id="6541649">(</span><span class="op" id="6541650">[</span><span class="op" id="6541651">]</span><span class="builtintype" id="6541652">int</span><span class="op" id="6541655">,</span>&nbsp;<span class="num" id="6541657">1</span><span class="op" id="6541658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541661">if</span>&nbsp;<span class="ident" id="6541664">err</span>&nbsp;<span class="op" id="6541668">:=</span>&nbsp;<span class="ident" id="6541671">EncodeAll</span><span class="op" id="6541680">(</span><span class="ident" id="6541681">ioutil</span><span class="op" id="6541687">.</span><span class="ident" id="6541688">Discard</span><span class="op" id="6541695">,</span>&nbsp;<span class="ident" id="6541697">g1</span><span class="op" id="6541699">)</span><span class="op" id="6541700">;</span>&nbsp;<span class="ident" id="6541702">err</span>&nbsp;<span class="op" id="6541706">==</span>&nbsp;<span class="ident" id="6541709">nil</span>&nbsp;<span class="op" id="6541713">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541717">t</span><span class="op" id="6541718">.</span><span class="ident" id="6541719">Error</span><span class="op" id="6541724">(</span><span class="string" id="6541725">&#34;expected&nbsp;error&nbsp;from&nbsp;mismatched&nbsp;delay&nbsp;and&nbsp;image&nbsp;slice&nbsp;lengths&#34;</span><span class="op" id="6541787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541793">if</span>&nbsp;<span class="ident" id="6541796">err</span>&nbsp;<span class="op" id="6541800">:=</span>&nbsp;<span class="ident" id="6541803">EncodeAll</span><span class="op" id="6541812">(</span><span class="ident" id="6541813">ioutil</span><span class="op" id="6541819">.</span><span class="ident" id="6541820">Discard</span><span class="op" id="6541827">,</span>&nbsp;<span class="op" id="6541829">&amp;</span><span class="ident" id="6541830">GIF</span><span class="op" id="6541833">{</span><span class="op" id="6541834">}</span><span class="op" id="6541835">)</span><span class="op" id="6541836">;</span>&nbsp;<span class="ident" id="6541838">err</span>&nbsp;<span class="op" id="6541842">==</span>&nbsp;<span class="ident" id="6541845">nil</span>&nbsp;<span class="op" id="6541849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541853">t</span><span class="op" id="6541854">.</span><span class="ident" id="6541855">Error</span><span class="op" id="6541860">(</span><span class="string" id="6541861">&#34;expected&nbsp;error&nbsp;from&nbsp;providing&nbsp;empty&nbsp;gif&#34;</span><span class="op" id="6541902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541905">}</span><br>
<span class="lineno">175</span><span class="op" id="6541907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6541910">func</span>&nbsp;<span class="ident" id="6541915">BenchmarkEncode</span><span class="op" id="6541930">(</span><span class="ident" id="6541931">b</span>&nbsp;<span class="op" id="6541933">*</span><span class="ident" id="6541934">testing</span><span class="op" id="6541941">.</span><span class="ident" id="6541942">B</span><span class="op" id="6541943">)</span>&nbsp;<span class="op" id="6541945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541948">b</span><span class="op" id="6541949">.</span><span class="ident" id="6541950">StopTimer</span><span class="op" id="6541959">(</span><span class="op" id="6541960">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541964">bo</span>&nbsp;<span class="op" id="6541967">:=</span>&nbsp;<span class="ident" id="6541970">image</span><span class="op" id="6541975">.</span><span class="ident" id="6541976">Rect</span><span class="op" id="6541980">(</span><span class="num" id="6541981">0</span><span class="op" id="6541982">,</span>&nbsp;<span class="num" id="6541984">0</span><span class="op" id="6541985">,</span>&nbsp;<span class="num" id="6541987">640</span><span class="op" id="6541990">,</span>&nbsp;<span class="num" id="6541992">480</span><span class="op" id="6541995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541998">rnd</span>&nbsp;<span class="op" id="6542002">:=</span>&nbsp;<span class="ident" id="6542005">rand</span><span class="op" id="6542009">.</span><span class="ident" id="6542010">New</span><span class="op" id="6542013">(</span><span class="ident" id="6542014">rand</span><span class="op" id="6542018">.</span><span class="ident" id="6542019">NewSource</span><span class="op" id="6542028">(</span><span class="num" id="6542029">123</span><span class="op" id="6542032">)</span><span class="op" id="6542033">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6542037">//&nbsp;Restrict&nbsp;to&nbsp;a&nbsp;256-color&nbsp;paletted&nbsp;image&nbsp;to&nbsp;avoid&nbsp;quantization&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542108">palette</span>&nbsp;<span class="op" id="6542116">:=</span>&nbsp;<span class="builtinfunc" id="6542119">make</span><span class="op" id="6542123">(</span><span class="ident" id="6542124">color</span><span class="op" id="6542129">.</span><span class="ident" id="6542130">Palette</span><span class="op" id="6542137">,</span>&nbsp;<span class="num" id="6542139">256</span><span class="op" id="6542142">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6542145">for</span>&nbsp;<span class="ident" id="6542149">i</span>&nbsp;<span class="op" id="6542151">:=</span>&nbsp;<span class="keyword" id="6542154">range</span>&nbsp;<span class="ident" id="6542160">palette</span>&nbsp;<span class="op" id="6542168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542172">palette</span><span class="op" id="6542179">[</span><span class="ident" id="6542180">i</span><span class="op" id="6542181">]</span>&nbsp;<span class="op" id="6542183">=</span>&nbsp;<span class="ident" id="6542185">color</span><span class="op" id="6542190">.</span><span class="ident" id="6542191">RGBA</span><span class="op" id="6542195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6542200">uint8</span><span class="op" id="6542205">(</span><span class="ident" id="6542206">rnd</span><span class="op" id="6542209">.</span><span class="ident" id="6542210">Intn</span><span class="op" id="6542214">(</span><span class="num" id="6542215">256</span><span class="op" id="6542218">)</span><span class="op" id="6542219">)</span><span class="op" id="6542220">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6542225">uint8</span><span class="op" id="6542230">(</span><span class="ident" id="6542231">rnd</span><span class="op" id="6542234">.</span><span class="ident" id="6542235">Intn</span><span class="op" id="6542239">(</span><span class="num" id="6542240">256</span><span class="op" id="6542243">)</span><span class="op" id="6542244">)</span><span class="op" id="6542245">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6542250">uint8</span><span class="op" id="6542255">(</span><span class="ident" id="6542256">rnd</span><span class="op" id="6542259">.</span><span class="ident" id="6542260">Intn</span><span class="op" id="6542264">(</span><span class="num" id="6542265">256</span><span class="op" id="6542268">)</span><span class="op" id="6542269">)</span><span class="op" id="6542270">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6542275">255</span><span class="op" id="6542278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6542282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6542285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542288">img</span>&nbsp;<span class="op" id="6542292">:=</span>&nbsp;<span class="ident" id="6542295">image</span><span class="op" id="6542300">.</span><span class="ident" id="6542301">NewPaletted</span><span class="op" id="6542312">(</span><span class="ident" id="6542313">image</span><span class="op" id="6542318">.</span><span class="ident" id="6542319">Rect</span><span class="op" id="6542323">(</span><span class="num" id="6542324">0</span><span class="op" id="6542325">,</span>&nbsp;<span class="num" id="6542327">0</span><span class="op" id="6542328">,</span>&nbsp;<span class="num" id="6542330">640</span><span class="op" id="6542333">,</span>&nbsp;<span class="num" id="6542335">480</span><span class="op" id="6542338">)</span><span class="op" id="6542339">,</span>&nbsp;<span class="ident" id="6542341">palette</span><span class="op" id="6542348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6542351">for</span>&nbsp;<span class="ident" id="6542355">y</span>&nbsp;<span class="op" id="6542357">:=</span>&nbsp;<span class="ident" id="6542360">bo</span><span class="op" id="6542362">.</span><span class="ident" id="6542363">Min</span><span class="op" id="6542366">.</span><span class="ident" id="6542367">Y</span><span class="op" id="6542368">;</span>&nbsp;<span class="ident" id="6542370">y</span>&nbsp;<span class="op" id="6542372">&lt;</span>&nbsp;<span class="ident" id="6542374">bo</span><span class="op" id="6542376">.</span><span class="ident" id="6542377">Max</span><span class="op" id="6542380">.</span><span class="ident" id="6542381">Y</span><span class="op" id="6542382">;</span>&nbsp;<span class="ident" id="6542384">y</span><span class="op" id="6542385">++</span>&nbsp;<span class="op" id="6542388">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6542392">for</span>&nbsp;<span class="ident" id="6542396">x</span>&nbsp;<span class="op" id="6542398">:=</span>&nbsp;<span class="ident" id="6542401">bo</span><span class="op" id="6542403">.</span><span class="ident" id="6542404">Min</span><span class="op" id="6542407">.</span><span class="ident" id="6542408">X</span><span class="op" id="6542409">;</span>&nbsp;<span class="ident" id="6542411">x</span>&nbsp;<span class="op" id="6542413">&lt;</span>&nbsp;<span class="ident" id="6542415">bo</span><span class="op" id="6542417">.</span><span class="ident" id="6542418">Max</span><span class="op" id="6542421">.</span><span class="ident" id="6542422">X</span><span class="op" id="6542423">;</span>&nbsp;<span class="ident" id="6542425">x</span><span class="op" id="6542426">++</span>&nbsp;<span class="op" id="6542429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542434">img</span><span class="op" id="6542437">.</span><span class="ident" id="6542438">Set</span><span class="op" id="6542441">(</span><span class="ident" id="6542442">x</span><span class="op" id="6542443">,</span>&nbsp;<span class="ident" id="6542445">y</span><span class="op" id="6542446">,</span>&nbsp;<span class="ident" id="6542448">palette</span><span class="op" id="6542455">[</span><span class="ident" id="6542456">rnd</span><span class="op" id="6542459">.</span><span class="ident" id="6542460">Intn</span><span class="op" id="6542464">(</span><span class="num" id="6542465">256</span><span class="op" id="6542468">)</span><span class="op" id="6542469">]</span><span class="op" id="6542470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6542474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6542477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542481">b</span><span class="op" id="6542482">.</span><span class="ident" id="6542483">SetBytes</span><span class="op" id="6542491">(</span><span class="num" id="6542492">640</span>&nbsp;<span class="op" id="6542496">*</span>&nbsp;<span class="num" id="6542498">480</span>&nbsp;<span class="op" id="6542502">*</span>&nbsp;<span class="num" id="6542504">4</span><span class="op" id="6542505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542508">b</span><span class="op" id="6542509">.</span><span class="ident" id="6542510">StartTimer</span><span class="op" id="6542520">(</span><span class="op" id="6542521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6542524">for</span>&nbsp;<span class="ident" id="6542528">i</span>&nbsp;<span class="op" id="6542530">:=</span>&nbsp;<span class="num" id="6542533">0</span><span class="op" id="6542534">;</span>&nbsp;<span class="ident" id="6542536">i</span>&nbsp;<span class="op" id="6542538">&lt;</span>&nbsp;<span class="ident" id="6542540">b</span><span class="op" id="6542541">.</span><span class="ident" id="6542542">N</span><span class="op" id="6542543">;</span>&nbsp;<span class="ident" id="6542545">i</span><span class="op" id="6542546">++</span>&nbsp;<span class="op" id="6542549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542553">Encode</span><span class="op" id="6542559">(</span><span class="ident" id="6542560">ioutil</span><span class="op" id="6542566">.</span><span class="ident" id="6542567">Discard</span><span class="op" id="6542574">,</span>&nbsp;<span class="ident" id="6542576">img</span><span class="op" id="6542579">,</span>&nbsp;<span class="ident" id="6542581">nil</span><span class="op" id="6542584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6542587">}</span><br>
<span class="lineno">205</span><span class="op" id="6542589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6542592">func</span>&nbsp;<span class="ident" id="6542597">BenchmarkQuantizedEncode</span><span class="op" id="6542621">(</span><span class="ident" id="6542622">b</span>&nbsp;<span class="op" id="6542624">*</span><span class="ident" id="6542625">testing</span><span class="op" id="6542632">.</span><span class="ident" id="6542633">B</span><span class="op" id="6542634">)</span>&nbsp;<span class="op" id="6542636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542639">b</span><span class="op" id="6542640">.</span><span class="ident" id="6542641">StopTimer</span><span class="op" id="6542650">(</span><span class="op" id="6542651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542654">img</span>&nbsp;<span class="op" id="6542658">:=</span>&nbsp;<span class="ident" id="6542661">image</span><span class="op" id="6542666">.</span><span class="ident" id="6542667">NewRGBA</span><span class="op" id="6542674">(</span><span class="ident" id="6542675">image</span><span class="op" id="6542680">.</span><span class="ident" id="6542681">Rect</span><span class="op" id="6542685">(</span><span class="num" id="6542686">0</span><span class="op" id="6542687">,</span>&nbsp;<span class="num" id="6542689">0</span><span class="op" id="6542690">,</span>&nbsp;<span class="num" id="6542692">640</span><span class="op" id="6542695">,</span>&nbsp;<span class="num" id="6542697">480</span><span class="op" id="6542700">)</span><span class="op" id="6542701">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542704">bo</span>&nbsp;<span class="op" id="6542707">:=</span>&nbsp;<span class="ident" id="6542710">img</span><span class="op" id="6542713">.</span><span class="ident" id="6542714">Bounds</span><span class="op" id="6542720">(</span><span class="op" id="6542721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542724">rnd</span>&nbsp;<span class="op" id="6542728">:=</span>&nbsp;<span class="ident" id="6542731">rand</span><span class="op" id="6542735">.</span><span class="ident" id="6542736">New</span><span class="op" id="6542739">(</span><span class="ident" id="6542740">rand</span><span class="op" id="6542744">.</span><span class="ident" id="6542745">NewSource</span><span class="op" id="6542754">(</span><span class="num" id="6542755">123</span><span class="op" id="6542758">)</span><span class="op" id="6542759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6542762">for</span>&nbsp;<span class="ident" id="6542766">y</span>&nbsp;<span class="op" id="6542768">:=</span>&nbsp;<span class="ident" id="6542771">bo</span><span class="op" id="6542773">.</span><span class="ident" id="6542774">Min</span><span class="op" id="6542777">.</span><span class="ident" id="6542778">Y</span><span class="op" id="6542779">;</span>&nbsp;<span class="ident" id="6542781">y</span>&nbsp;<span class="op" id="6542783">&lt;</span>&nbsp;<span class="ident" id="6542785">bo</span><span class="op" id="6542787">.</span><span class="ident" id="6542788">Max</span><span class="op" id="6542791">.</span><span class="ident" id="6542792">Y</span><span class="op" id="6542793">;</span>&nbsp;<span class="ident" id="6542795">y</span><span class="op" id="6542796">++</span>&nbsp;<span class="op" id="6542799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6542803">for</span>&nbsp;<span class="ident" id="6542807">x</span>&nbsp;<span class="op" id="6542809">:=</span>&nbsp;<span class="ident" id="6542812">bo</span><span class="op" id="6542814">.</span><span class="ident" id="6542815">Min</span><span class="op" id="6542818">.</span><span class="ident" id="6542819">X</span><span class="op" id="6542820">;</span>&nbsp;<span class="ident" id="6542822">x</span>&nbsp;<span class="op" id="6542824">&lt;</span>&nbsp;<span class="ident" id="6542826">bo</span><span class="op" id="6542828">.</span><span class="ident" id="6542829">Max</span><span class="op" id="6542832">.</span><span class="ident" id="6542833">X</span><span class="op" id="6542834">;</span>&nbsp;<span class="ident" id="6542836">x</span><span class="op" id="6542837">++</span>&nbsp;<span class="op" id="6542840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542845">img</span><span class="op" id="6542848">.</span><span class="ident" id="6542849">SetRGBA</span><span class="op" id="6542856">(</span><span class="ident" id="6542857">x</span><span class="op" id="6542858">,</span>&nbsp;<span class="ident" id="6542860">y</span><span class="op" id="6542861">,</span>&nbsp;<span class="ident" id="6542863">color</span><span class="op" id="6542868">.</span><span class="ident" id="6542869">RGBA</span><span class="op" id="6542873">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6542879">uint8</span><span class="op" id="6542884">(</span><span class="ident" id="6542885">rnd</span><span class="op" id="6542888">.</span><span class="ident" id="6542889">Intn</span><span class="op" id="6542893">(</span><span class="num" id="6542894">256</span><span class="op" id="6542897">)</span><span class="op" id="6542898">)</span><span class="op" id="6542899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6542905">uint8</span><span class="op" id="6542910">(</span><span class="ident" id="6542911">rnd</span><span class="op" id="6542914">.</span><span class="ident" id="6542915">Intn</span><span class="op" id="6542919">(</span><span class="num" id="6542920">256</span><span class="op" id="6542923">)</span><span class="op" id="6542924">)</span><span class="op" id="6542925">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6542931">uint8</span><span class="op" id="6542936">(</span><span class="ident" id="6542937">rnd</span><span class="op" id="6542940">.</span><span class="ident" id="6542941">Intn</span><span class="op" id="6542945">(</span><span class="num" id="6542946">256</span><span class="op" id="6542949">)</span><span class="op" id="6542950">)</span><span class="op" id="6542951">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6542957">255</span><span class="op" id="6542960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6542965">}</span><span class="op" id="6542966">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6542970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6542973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542976">b</span><span class="op" id="6542977">.</span><span class="ident" id="6542978">SetBytes</span><span class="op" id="6542986">(</span><span class="num" id="6542987">640</span>&nbsp;<span class="op" id="6542991">*</span>&nbsp;<span class="num" id="6542993">480</span>&nbsp;<span class="op" id="6542997">*</span>&nbsp;<span class="num" id="6542999">4</span><span class="op" id="6543000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543003">b</span><span class="op" id="6543004">.</span><span class="ident" id="6543005">StartTimer</span><span class="op" id="6543015">(</span><span class="op" id="6543016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6543019">for</span>&nbsp;<span class="ident" id="6543023">i</span>&nbsp;<span class="op" id="6543025">:=</span>&nbsp;<span class="num" id="6543028">0</span><span class="op" id="6543029">;</span>&nbsp;<span class="ident" id="6543031">i</span>&nbsp;<span class="op" id="6543033">&lt;</span>&nbsp;<span class="ident" id="6543035">b</span><span class="op" id="6543036">.</span><span class="ident" id="6543037">N</span><span class="op" id="6543038">;</span>&nbsp;<span class="ident" id="6543040">i</span><span class="op" id="6543041">++</span>&nbsp;<span class="op" id="6543044">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543048">Encode</span><span class="op" id="6543054">(</span><span class="ident" id="6543055">ioutil</span><span class="op" id="6543061">.</span><span class="ident" id="6543062">Discard</span><span class="op" id="6543069">,</span>&nbsp;<span class="ident" id="6543071">img</span><span class="op" id="6543074">,</span>&nbsp;<span class="ident" id="6543076">nil</span><span class="op" id="6543079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6543082">}</span><br>
<span class="lineno"></span><span class="op" id="6543084">}</span>
</div>
</body>
</html>
