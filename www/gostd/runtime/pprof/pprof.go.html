<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/pprof</h2>
<ul>
<li><a href="/gostd/runtime/pprof/mprof_test.go.html">mprof_test.go</a></li>
<li><a href="/gostd/runtime/pprof/pprof.go.html" class="current">pprof.go</a></li>
<li><a href="/gostd/runtime/pprof/pprof_test.go.html">pprof_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4729229">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4729285">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4729339">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4729390">//&nbsp;Package&nbsp;pprof&nbsp;writes&nbsp;runtime&nbsp;profiling&nbsp;data&nbsp;in&nbsp;the&nbsp;format&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="4729460">//&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="4729496">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="4729537">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="keyword" id="4729584">package</span>&nbsp;<span class="ident" id="4729592">pprof</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4729599">import</span>&nbsp;<span class="op" id="4729606">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4729609">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4729618">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4729627">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4729634">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4729640">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4729651">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4729659">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4729670">&#34;sync&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4729678">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span><span class="op" id="4729695">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4729698">//&nbsp;BUG(rsc):&nbsp;Profiles&nbsp;are&nbsp;incomplete&nbsp;and&nbsp;inaccurate&nbsp;on&nbsp;NetBSD&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span><span class="comment" id="4729770">//&nbsp;See&nbsp;http://golang.org/issue/6047&nbsp;for&nbsp;details.</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4729820">//&nbsp;A&nbsp;Profile&nbsp;is&nbsp;a&nbsp;collection&nbsp;of&nbsp;stack&nbsp;traces&nbsp;showing&nbsp;the&nbsp;call&nbsp;sequences</span><br>
<span class="lineno"></span><span class="comment" id="4729892">//&nbsp;that&nbsp;led&nbsp;to&nbsp;instances&nbsp;of&nbsp;a&nbsp;particular&nbsp;event,&nbsp;such&nbsp;as&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="4729960">//&nbsp;Packages&nbsp;can&nbsp;create&nbsp;and&nbsp;maintain&nbsp;their&nbsp;own&nbsp;profiles;&nbsp;the&nbsp;most&nbsp;common</span><br>
<span class="lineno"></span><span class="comment" id="4730032">//&nbsp;use&nbsp;is&nbsp;for&nbsp;tracking&nbsp;resources&nbsp;that&nbsp;must&nbsp;be&nbsp;explicitly&nbsp;closed,&nbsp;such&nbsp;as&nbsp;files</span><br>
<span class="lineno">30</span><span class="comment" id="4730111">//&nbsp;or&nbsp;network&nbsp;connections.</span><br>
<span class="lineno"></span><span class="comment" id="4730138">//</span><br>
<span class="lineno"></span><span class="comment" id="4730141">//&nbsp;A&nbsp;Profile&#39;s&nbsp;methods&nbsp;can&nbsp;be&nbsp;called&nbsp;from&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="comment" id="4730219">//</span><br>
<span class="lineno"></span><span class="comment" id="4730222">//&nbsp;Each&nbsp;Profile&nbsp;has&nbsp;a&nbsp;unique&nbsp;name.&nbsp;&nbsp;A&nbsp;few&nbsp;profiles&nbsp;are&nbsp;predefined:</span><br>
<span class="lineno">35</span><span class="comment" id="4730289">//</span><br>
<span class="lineno"></span><span class="comment" id="4730292">//&nbsp;&nbsp;&nbsp;&nbsp;goroutine&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;stack&nbsp;traces&nbsp;of&nbsp;all&nbsp;current&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="4730349">//&nbsp;&nbsp;&nbsp;&nbsp;heap&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;sampling&nbsp;of&nbsp;all&nbsp;heap&nbsp;allocations</span><br>
<span class="lineno"></span><span class="comment" id="4730402">//&nbsp;&nbsp;&nbsp;&nbsp;threadcreate&nbsp;-&nbsp;stack&nbsp;traces&nbsp;that&nbsp;led&nbsp;to&nbsp;the&nbsp;creation&nbsp;of&nbsp;new&nbsp;OS&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="4730476">//&nbsp;&nbsp;&nbsp;&nbsp;block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;stack&nbsp;traces&nbsp;that&nbsp;led&nbsp;to&nbsp;blocking&nbsp;on&nbsp;synchronization&nbsp;primitives</span><br>
<span class="lineno">40</span><span class="comment" id="4730558">//</span><br>
<span class="lineno"></span><span class="comment" id="4730561">//&nbsp;These&nbsp;predefined&nbsp;profiles&nbsp;maintain&nbsp;themselves&nbsp;and&nbsp;panic&nbsp;on&nbsp;an&nbsp;explicit</span><br>
<span class="lineno"></span><span class="comment" id="4730635">//&nbsp;Add&nbsp;or&nbsp;Remove&nbsp;method&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="4730665">//</span><br>
<span class="lineno"></span><span class="comment" id="4730668">//&nbsp;The&nbsp;CPU&nbsp;profile&nbsp;is&nbsp;not&nbsp;available&nbsp;as&nbsp;a&nbsp;Profile.&nbsp;&nbsp;It&nbsp;has&nbsp;a&nbsp;special&nbsp;API,</span><br>
<span class="lineno">45</span><span class="comment" id="4730741">//&nbsp;the&nbsp;StartCPUProfile&nbsp;and&nbsp;StopCPUProfile&nbsp;functions,&nbsp;because&nbsp;it&nbsp;streams</span><br>
<span class="lineno"></span><span class="comment" id="4730813">//&nbsp;output&nbsp;to&nbsp;a&nbsp;writer&nbsp;during&nbsp;profiling.</span><br>
<span class="lineno"></span><span class="comment" id="4730853">//</span><br>
<span class="lineno"></span><span class="keyword" id="4730856">type</span>&nbsp;<span class="ident" id="4730861">Profile</span>&nbsp;<span class="keyword" id="4730869">struct</span>&nbsp;<span class="op" id="4730876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4730879">name</span>&nbsp;&nbsp;<span class="builtintype" id="4730885">string</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4730893">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4730899">sync</span><span class="op" id="4730903">.</span><span class="ident" id="4730904">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4730911">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4730917">map</span><span class="op" id="4730920">[</span><span class="keyword" id="4730921">interface</span><span class="op" id="4730930">{</span><span class="op" id="4730931">}</span><span class="op" id="4730932">]</span><span class="op" id="4730933">[</span><span class="op" id="4730934">]</span><span class="builtintype" id="4730935">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4730944">count</span>&nbsp;<span class="keyword" id="4730950">func</span><span class="op" id="4730954">(</span><span class="op" id="4730955">)</span>&nbsp;<span class="builtintype" id="4730957">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4730962">write</span>&nbsp;<span class="keyword" id="4730968">func</span><span class="op" id="4730972">(</span><span class="ident" id="4730973">io</span><span class="op" id="4730975">.</span><span class="ident" id="4730976">Writer</span><span class="op" id="4730982">,</span>&nbsp;<span class="builtintype" id="4730984">int</span><span class="op" id="4730987">)</span>&nbsp;<span class="builtintype" id="4730989">error</span><br>
<span class="lineno"></span><span class="op" id="4730995">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4730998">//&nbsp;profiles&nbsp;records&nbsp;all&nbsp;registered&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="4731043">var</span>&nbsp;<span class="ident" id="4731047">profiles</span>&nbsp;<span class="keyword" id="4731056">struct</span>&nbsp;<span class="op" id="4731063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731066">mu</span>&nbsp;<span class="ident" id="4731069">sync</span><span class="op" id="4731073">.</span><span class="ident" id="4731074">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731081">m</span>&nbsp;&nbsp;<span class="keyword" id="4731084">map</span><span class="op" id="4731087">[</span><span class="builtintype" id="4731088">string</span><span class="op" id="4731094">]</span><span class="op" id="4731095">*</span><span class="ident" id="4731096">Profile</span><br>
<span class="lineno">60</span><span class="op" id="4731104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4731107">var</span>&nbsp;<span class="ident" id="4731111">goroutineProfile</span>&nbsp;<span class="op" id="4731128">=</span>&nbsp;<span class="op" id="4731130">&amp;</span><span class="ident" id="4731131">Profile</span><span class="op" id="4731138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731141">name</span><span class="op" id="4731145">:</span>&nbsp;&nbsp;<span class="string" id="4731148">&#34;goroutine&#34;</span><span class="op" id="4731159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731162">count</span><span class="op" id="4731167">:</span>&nbsp;<span class="ident" id="4731169">countGoroutine</span><span class="op" id="4731183">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731186">write</span><span class="op" id="4731191">:</span>&nbsp;<span class="ident" id="4731193">writeGoroutine</span><span class="op" id="4731207">,</span><br>
<span class="lineno"></span><span class="op" id="4731209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4731212">var</span>&nbsp;<span class="ident" id="4731216">threadcreateProfile</span>&nbsp;<span class="op" id="4731236">=</span>&nbsp;<span class="op" id="4731238">&amp;</span><span class="ident" id="4731239">Profile</span><span class="op" id="4731246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731249">name</span><span class="op" id="4731253">:</span>&nbsp;&nbsp;<span class="string" id="4731256">&#34;threadcreate&#34;</span><span class="op" id="4731270">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731273">count</span><span class="op" id="4731278">:</span>&nbsp;<span class="ident" id="4731280">countThreadCreate</span><span class="op" id="4731297">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731300">write</span><span class="op" id="4731305">:</span>&nbsp;<span class="ident" id="4731307">writeThreadCreate</span><span class="op" id="4731324">,</span><br>
<span class="lineno"></span><span class="op" id="4731326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4731329">var</span>&nbsp;<span class="ident" id="4731333">heapProfile</span>&nbsp;<span class="op" id="4731345">=</span>&nbsp;<span class="op" id="4731347">&amp;</span><span class="ident" id="4731348">Profile</span><span class="op" id="4731355">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731358">name</span><span class="op" id="4731362">:</span>&nbsp;&nbsp;<span class="string" id="4731365">&#34;heap&#34;</span><span class="op" id="4731371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731374">count</span><span class="op" id="4731379">:</span>&nbsp;<span class="ident" id="4731381">countHeap</span><span class="op" id="4731390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731393">write</span><span class="op" id="4731398">:</span>&nbsp;<span class="ident" id="4731400">writeHeap</span><span class="op" id="4731409">,</span><br>
<span class="lineno"></span><span class="op" id="4731411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4731414">var</span>&nbsp;<span class="ident" id="4731418">blockProfile</span>&nbsp;<span class="op" id="4731431">=</span>&nbsp;<span class="op" id="4731433">&amp;</span><span class="ident" id="4731434">Profile</span><span class="op" id="4731441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731444">name</span><span class="op" id="4731448">:</span>&nbsp;&nbsp;<span class="string" id="4731451">&#34;block&#34;</span><span class="op" id="4731458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731461">count</span><span class="op" id="4731466">:</span>&nbsp;<span class="ident" id="4731468">countBlock</span><span class="op" id="4731478">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731481">write</span><span class="op" id="4731486">:</span>&nbsp;<span class="ident" id="4731488">writeBlock</span><span class="op" id="4731498">,</span><br>
<span class="lineno"></span><span class="op" id="4731500">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="4731503">func</span>&nbsp;<span class="ident" id="4731508">lockProfiles</span><span class="op" id="4731520">(</span><span class="op" id="4731521">)</span>&nbsp;<span class="op" id="4731523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731526">profiles</span><span class="op" id="4731534">.</span><span class="ident" id="4731535">mu</span><span class="op" id="4731537">.</span><span class="ident" id="4731538">Lock</span><span class="op" id="4731542">(</span><span class="op" id="4731543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4731546">if</span>&nbsp;<span class="ident" id="4731549">profiles</span><span class="op" id="4731557">.</span><span class="ident" id="4731558">m</span>&nbsp;<span class="op" id="4731560">==</span>&nbsp;<span class="builtintype" id="4731563">nil</span>&nbsp;<span class="op" id="4731567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4731571">//&nbsp;Initial&nbsp;built-in&nbsp;profiles.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731603">profiles</span><span class="op" id="4731611">.</span><span class="ident" id="4731612">m</span>&nbsp;<span class="op" id="4731614">=</span>&nbsp;<span class="keyword" id="4731616">map</span><span class="op" id="4731619">[</span><span class="builtintype" id="4731620">string</span><span class="op" id="4731626">]</span><span class="op" id="4731627">*</span><span class="ident" id="4731628">Profile</span><span class="op" id="4731635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4731640">&#34;goroutine&#34;</span><span class="op" id="4731651">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731656">goroutineProfile</span><span class="op" id="4731672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4731677">&#34;threadcreate&#34;</span><span class="op" id="4731691">:</span>&nbsp;<span class="ident" id="4731693">threadcreateProfile</span><span class="op" id="4731712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4731717">&#34;heap&#34;</span><span class="op" id="4731723">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731733">heapProfile</span><span class="op" id="4731744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4731749">&#34;block&#34;</span><span class="op" id="4731756">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731765">blockProfile</span><span class="op" id="4731777">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4731781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4731784">}</span><br>
<span class="lineno"></span><span class="op" id="4731786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4731789">func</span>&nbsp;<span class="ident" id="4731794">unlockProfiles</span><span class="op" id="4731808">(</span><span class="op" id="4731809">)</span>&nbsp;<span class="op" id="4731811">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731814">profiles</span><span class="op" id="4731822">.</span><span class="ident" id="4731823">mu</span><span class="op" id="4731825">.</span><span class="ident" id="4731826">Unlock</span><span class="op" id="4731832">(</span><span class="op" id="4731833">)</span><br>
<span class="lineno"></span><span class="op" id="4731835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4731838">//&nbsp;NewProfile&nbsp;creates&nbsp;a&nbsp;new&nbsp;profile&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="4731895">//&nbsp;If&nbsp;a&nbsp;profile&nbsp;with&nbsp;that&nbsp;name&nbsp;already&nbsp;exists,&nbsp;NewProfile&nbsp;panics.</span><br>
<span class="lineno">105</span><span class="comment" id="4731961">//&nbsp;The&nbsp;convention&nbsp;is&nbsp;to&nbsp;use&nbsp;a&nbsp;&#39;import/path.&#39;&nbsp;prefix&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="4732023">//&nbsp;separate&nbsp;name&nbsp;spaces&nbsp;for&nbsp;each&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="4732065">func</span>&nbsp;<span class="ident" id="4732070">NewProfile</span><span class="op" id="4732080">(</span><span class="ident" id="4732081">name</span>&nbsp;<span class="builtintype" id="4732086">string</span><span class="op" id="4732092">)</span>&nbsp;<span class="op" id="4732094">*</span><span class="ident" id="4732095">Profile</span>&nbsp;<span class="op" id="4732103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732106">lockProfiles</span><span class="op" id="4732118">(</span><span class="op" id="4732119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4732122">defer</span>&nbsp;<span class="ident" id="4732128">unlockProfiles</span><span class="op" id="4732142">(</span><span class="op" id="4732143">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4732146">if</span>&nbsp;<span class="ident" id="4732149">name</span>&nbsp;<span class="op" id="4732154">==</span>&nbsp;<span class="string" id="4732157">&#34;&#34;</span>&nbsp;<span class="op" id="4732160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4732164">panic</span><span class="op" id="4732169">(</span><span class="string" id="4732170">&#34;pprof:&nbsp;NewProfile&nbsp;with&nbsp;empty&nbsp;name&#34;</span><span class="op" id="4732205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4732208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4732211">if</span>&nbsp;<span class="ident" id="4732214">profiles</span><span class="op" id="4732222">.</span><span class="ident" id="4732223">m</span><span class="op" id="4732224">[</span><span class="ident" id="4732225">name</span><span class="op" id="4732229">]</span>&nbsp;<span class="op" id="4732231">!=</span>&nbsp;<span class="builtintype" id="4732234">nil</span>&nbsp;<span class="op" id="4732238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4732242">panic</span><span class="op" id="4732247">(</span><span class="string" id="4732248">&#34;pprof:&nbsp;NewProfile&nbsp;name&nbsp;already&nbsp;in&nbsp;use:&nbsp;&#34;</span>&nbsp;<span class="op" id="4732290">+</span>&nbsp;<span class="ident" id="4732292">name</span><span class="op" id="4732296">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4732299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732302">p</span>&nbsp;<span class="op" id="4732304">:=</span>&nbsp;<span class="op" id="4732307">&amp;</span><span class="ident" id="4732308">Profile</span><span class="op" id="4732315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732319">name</span><span class="op" id="4732323">:</span>&nbsp;<span class="ident" id="4732325">name</span><span class="op" id="4732329">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732333">m</span><span class="op" id="4732334">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4732339">map</span><span class="op" id="4732342">[</span><span class="keyword" id="4732343">interface</span><span class="op" id="4732352">{</span><span class="op" id="4732353">}</span><span class="op" id="4732354">]</span><span class="op" id="4732355">[</span><span class="op" id="4732356">]</span><span class="builtintype" id="4732357">uintptr</span><span class="op" id="4732364">{</span><span class="op" id="4732365">}</span><span class="op" id="4732366">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4732369">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732372">profiles</span><span class="op" id="4732380">.</span><span class="ident" id="4732381">m</span><span class="op" id="4732382">[</span><span class="ident" id="4732383">name</span><span class="op" id="4732387">]</span>&nbsp;<span class="op" id="4732389">=</span>&nbsp;<span class="ident" id="4732391">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4732394">return</span>&nbsp;<span class="ident" id="4732401">p</span><br>
<span class="lineno"></span><span class="op" id="4732403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4732406">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;profile&nbsp;with&nbsp;the&nbsp;given&nbsp;name,&nbsp;or&nbsp;nil&nbsp;if&nbsp;no&nbsp;such&nbsp;profile&nbsp;exists.</span><br>
<span class="lineno">125</span><span class="keyword" id="4732491">func</span>&nbsp;<span class="ident" id="4732496">Lookup</span><span class="op" id="4732502">(</span><span class="ident" id="4732503">name</span>&nbsp;<span class="builtintype" id="4732508">string</span><span class="op" id="4732514">)</span>&nbsp;<span class="op" id="4732516">*</span><span class="ident" id="4732517">Profile</span>&nbsp;<span class="op" id="4732525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732528">lockProfiles</span><span class="op" id="4732540">(</span><span class="op" id="4732541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4732544">defer</span>&nbsp;<span class="ident" id="4732550">unlockProfiles</span><span class="op" id="4732564">(</span><span class="op" id="4732565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4732568">return</span>&nbsp;<span class="ident" id="4732575">profiles</span><span class="op" id="4732583">.</span><span class="ident" id="4732584">m</span><span class="op" id="4732585">[</span><span class="ident" id="4732586">name</span><span class="op" id="4732590">]</span><br>
<span class="lineno"></span><span class="op" id="4732592">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4732595">//&nbsp;Profiles&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;the&nbsp;known&nbsp;profiles,&nbsp;sorted&nbsp;by&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4732666">func</span>&nbsp;<span class="ident" id="4732671">Profiles</span><span class="op" id="4732679">(</span><span class="op" id="4732680">)</span>&nbsp;<span class="op" id="4732682">[</span><span class="op" id="4732683">]</span><span class="op" id="4732684">*</span><span class="ident" id="4732685">Profile</span>&nbsp;<span class="op" id="4732693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732696">lockProfiles</span><span class="op" id="4732708">(</span><span class="op" id="4732709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4732712">defer</span>&nbsp;<span class="ident" id="4732718">unlockProfiles</span><span class="op" id="4732732">(</span><span class="op" id="4732733">)</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4732737">var</span>&nbsp;<span class="ident" id="4732741">all</span>&nbsp;<span class="op" id="4732745">[</span><span class="op" id="4732746">]</span><span class="op" id="4732747">*</span><span class="ident" id="4732748">Profile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4732757">for</span>&nbsp;<span class="ident" id="4732761">_</span><span class="op" id="4732762">,</span>&nbsp;<span class="ident" id="4732764">p</span>&nbsp;<span class="op" id="4732766">:=</span>&nbsp;<span class="keyword" id="4732769">range</span>&nbsp;<span class="ident" id="4732775">profiles</span><span class="op" id="4732783">.</span><span class="ident" id="4732784">m</span>&nbsp;<span class="op" id="4732786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732790">all</span>&nbsp;<span class="op" id="4732794">=</span>&nbsp;<span class="builtinfunc" id="4732796">append</span><span class="op" id="4732802">(</span><span class="ident" id="4732803">all</span><span class="op" id="4732806">,</span>&nbsp;<span class="ident" id="4732808">p</span><span class="op" id="4732809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4732812">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732816">sort</span><span class="op" id="4732820">.</span><span class="ident" id="4732821">Sort</span><span class="op" id="4732825">(</span><span class="ident" id="4732826">byName</span><span class="op" id="4732832">(</span><span class="ident" id="4732833">all</span><span class="op" id="4732836">)</span><span class="op" id="4732837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4732840">return</span>&nbsp;<span class="ident" id="4732847">all</span><br>
<span class="lineno"></span><span class="op" id="4732851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="4732854">type</span>&nbsp;<span class="ident" id="4732859">byName</span>&nbsp;<span class="op" id="4732866">[</span><span class="op" id="4732867">]</span><span class="op" id="4732868">*</span><span class="ident" id="4732869">Profile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4732878">func</span>&nbsp;<span class="op" id="4732883">(</span><span class="ident" id="4732884">x</span>&nbsp;<span class="ident" id="4732886">byName</span><span class="op" id="4732892">)</span>&nbsp;<span class="ident" id="4732894">Len</span><span class="op" id="4732897">(</span><span class="op" id="4732898">)</span>&nbsp;<span class="builtintype" id="4732900">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4732914">{</span>&nbsp;<span class="keyword" id="4732916">return</span>&nbsp;<span class="builtinfunc" id="4732923">len</span><span class="op" id="4732926">(</span><span class="ident" id="4732927">x</span><span class="op" id="4732928">)</span>&nbsp;<span class="op" id="4732930">}</span><br>
<span class="lineno"></span><span class="keyword" id="4732932">func</span>&nbsp;<span class="op" id="4732937">(</span><span class="ident" id="4732938">x</span>&nbsp;<span class="ident" id="4732940">byName</span><span class="op" id="4732946">)</span>&nbsp;<span class="ident" id="4732948">Swap</span><span class="op" id="4732952">(</span><span class="ident" id="4732953">i</span><span class="op" id="4732954">,</span>&nbsp;<span class="ident" id="4732956">j</span>&nbsp;<span class="builtintype" id="4732958">int</span><span class="op" id="4732961">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4732968">{</span>&nbsp;<span class="ident" id="4732970">x</span><span class="op" id="4732971">[</span><span class="ident" id="4732972">i</span><span class="op" id="4732973">]</span><span class="op" id="4732974">,</span>&nbsp;<span class="ident" id="4732976">x</span><span class="op" id="4732977">[</span><span class="ident" id="4732978">j</span><span class="op" id="4732979">]</span>&nbsp;<span class="op" id="4732981">=</span>&nbsp;<span class="ident" id="4732983">x</span><span class="op" id="4732984">[</span><span class="ident" id="4732985">j</span><span class="op" id="4732986">]</span><span class="op" id="4732987">,</span>&nbsp;<span class="ident" id="4732989">x</span><span class="op" id="4732990">[</span><span class="ident" id="4732991">i</span><span class="op" id="4732992">]</span>&nbsp;<span class="op" id="4732994">}</span><br>
<span class="lineno"></span><span class="keyword" id="4732996">func</span>&nbsp;<span class="op" id="4733001">(</span><span class="ident" id="4733002">x</span>&nbsp;<span class="ident" id="4733004">byName</span><span class="op" id="4733010">)</span>&nbsp;<span class="ident" id="4733012">Less</span><span class="op" id="4733016">(</span><span class="ident" id="4733017">i</span><span class="op" id="4733018">,</span>&nbsp;<span class="ident" id="4733020">j</span>&nbsp;<span class="builtintype" id="4733022">int</span><span class="op" id="4733025">)</span>&nbsp;<span class="builtintype" id="4733027">bool</span>&nbsp;<span class="op" id="4733032">{</span>&nbsp;<span class="keyword" id="4733034">return</span>&nbsp;<span class="ident" id="4733041">x</span><span class="op" id="4733042">[</span><span class="ident" id="4733043">i</span><span class="op" id="4733044">]</span><span class="op" id="4733045">.</span><span class="ident" id="4733046">name</span>&nbsp;<span class="op" id="4733051">&lt;</span>&nbsp;<span class="ident" id="4733053">x</span><span class="op" id="4733054">[</span><span class="ident" id="4733055">j</span><span class="op" id="4733056">]</span><span class="op" id="4733057">.</span><span class="ident" id="4733058">name</span>&nbsp;<span class="op" id="4733063">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="4733066">//&nbsp;Name&nbsp;returns&nbsp;this&nbsp;profile&#39;s&nbsp;name,&nbsp;which&nbsp;can&nbsp;be&nbsp;passed&nbsp;to&nbsp;Lookup&nbsp;to&nbsp;reobtain&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="4733158">func</span>&nbsp;<span class="op" id="4733163">(</span><span class="ident" id="4733164">p</span>&nbsp;<span class="op" id="4733166">*</span><span class="ident" id="4733167">Profile</span><span class="op" id="4733174">)</span>&nbsp;<span class="ident" id="4733176">Name</span><span class="op" id="4733180">(</span><span class="op" id="4733181">)</span>&nbsp;<span class="builtintype" id="4733183">string</span>&nbsp;<span class="op" id="4733190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4733193">return</span>&nbsp;<span class="ident" id="4733200">p</span><span class="op" id="4733201">.</span><span class="ident" id="4733202">name</span><br>
<span class="lineno"></span><span class="op" id="4733207">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="4733210">//&nbsp;Count&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;execution&nbsp;stacks&nbsp;currently&nbsp;in&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="4733284">func</span>&nbsp;<span class="op" id="4733289">(</span><span class="ident" id="4733290">p</span>&nbsp;<span class="op" id="4733292">*</span><span class="ident" id="4733293">Profile</span><span class="op" id="4733300">)</span>&nbsp;<span class="ident" id="4733302">Count</span><span class="op" id="4733307">(</span><span class="op" id="4733308">)</span>&nbsp;<span class="builtintype" id="4733310">int</span>&nbsp;<span class="op" id="4733314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4733317">p</span><span class="op" id="4733318">.</span><span class="ident" id="4733319">mu</span><span class="op" id="4733321">.</span><span class="ident" id="4733322">Lock</span><span class="op" id="4733326">(</span><span class="op" id="4733327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4733330">defer</span>&nbsp;<span class="ident" id="4733336">p</span><span class="op" id="4733337">.</span><span class="ident" id="4733338">mu</span><span class="op" id="4733340">.</span><span class="ident" id="4733341">Unlock</span><span class="op" id="4733347">(</span><span class="op" id="4733348">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4733351">if</span>&nbsp;<span class="ident" id="4733354">p</span><span class="op" id="4733355">.</span><span class="ident" id="4733356">count</span>&nbsp;<span class="op" id="4733362">!=</span>&nbsp;<span class="builtintype" id="4733365">nil</span>&nbsp;<span class="op" id="4733369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4733373">return</span>&nbsp;<span class="ident" id="4733380">p</span><span class="op" id="4733381">.</span><span class="ident" id="4733382">count</span><span class="op" id="4733387">(</span><span class="op" id="4733388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4733391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4733394">return</span>&nbsp;<span class="builtinfunc" id="4733401">len</span><span class="op" id="4733404">(</span><span class="ident" id="4733405">p</span><span class="op" id="4733406">.</span><span class="ident" id="4733407">m</span><span class="op" id="4733408">)</span><br>
<span class="lineno"></span><span class="op" id="4733410">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="4733413">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;current&nbsp;execution&nbsp;stack&nbsp;to&nbsp;the&nbsp;profile,&nbsp;associated&nbsp;with&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4733492">//&nbsp;Add&nbsp;stores&nbsp;value&nbsp;in&nbsp;an&nbsp;internal&nbsp;map,&nbsp;so&nbsp;value&nbsp;must&nbsp;be&nbsp;suitable&nbsp;for&nbsp;use&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4733569">//&nbsp;a&nbsp;map&nbsp;key&nbsp;and&nbsp;will&nbsp;not&nbsp;be&nbsp;garbage&nbsp;collected&nbsp;until&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="4733640">//&nbsp;call&nbsp;to&nbsp;Remove.&nbsp;&nbsp;Add&nbsp;panics&nbsp;if&nbsp;the&nbsp;profile&nbsp;already&nbsp;contains&nbsp;a&nbsp;stack&nbsp;for&nbsp;value.</span><br>
<span class="lineno">170</span><span class="comment" id="4733722">//</span><br>
<span class="lineno"></span><span class="comment" id="4733725">//&nbsp;The&nbsp;skip&nbsp;parameter&nbsp;has&nbsp;the&nbsp;same&nbsp;meaning&nbsp;as&nbsp;runtime.Caller&#39;s&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="4733793">//&nbsp;and&nbsp;controls&nbsp;where&nbsp;the&nbsp;stack&nbsp;trace&nbsp;begins.&nbsp;&nbsp;Passing&nbsp;skip=0&nbsp;begins&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4733866">//&nbsp;trace&nbsp;in&nbsp;the&nbsp;function&nbsp;calling&nbsp;Add.&nbsp;&nbsp;For&nbsp;example,&nbsp;given&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="4733929">//&nbsp;execution&nbsp;stack:</span><br>
<span class="lineno">175</span><span class="comment" id="4733949">//</span><br>
<span class="lineno"></span><span class="comment" id="4733952">//&nbsp;&nbsp;&nbsp;&nbsp;Add</span><br>
<span class="lineno"></span><span class="comment" id="4733959">//&nbsp;&nbsp;&nbsp;&nbsp;called&nbsp;from&nbsp;rpc.NewClient</span><br>
<span class="lineno"></span><span class="comment" id="4733988">//&nbsp;&nbsp;&nbsp;&nbsp;called&nbsp;from&nbsp;mypkg.Run</span><br>
<span class="lineno"></span><span class="comment" id="4734013">//&nbsp;&nbsp;&nbsp;&nbsp;called&nbsp;from&nbsp;main.main</span><br>
<span class="lineno">180</span><span class="comment" id="4734038">//</span><br>
<span class="lineno"></span><span class="comment" id="4734041">//&nbsp;Passing&nbsp;skip=0&nbsp;begins&nbsp;the&nbsp;stack&nbsp;trace&nbsp;at&nbsp;the&nbsp;call&nbsp;to&nbsp;Add&nbsp;inside&nbsp;rpc.NewClient.</span><br>
<span class="lineno"></span><span class="comment" id="4734123">//&nbsp;Passing&nbsp;skip=1&nbsp;begins&nbsp;the&nbsp;stack&nbsp;trace&nbsp;at&nbsp;the&nbsp;call&nbsp;to&nbsp;NewClient&nbsp;inside&nbsp;mypkg.Run.</span><br>
<span class="lineno"></span><span class="comment" id="4734207">//</span><br>
<span class="lineno"></span><span class="keyword" id="4734210">func</span>&nbsp;<span class="op" id="4734215">(</span><span class="ident" id="4734216">p</span>&nbsp;<span class="op" id="4734218">*</span><span class="ident" id="4734219">Profile</span><span class="op" id="4734226">)</span>&nbsp;<span class="ident" id="4734228">Add</span><span class="op" id="4734231">(</span><span class="ident" id="4734232">value</span>&nbsp;<span class="keyword" id="4734238">interface</span><span class="op" id="4734247">{</span><span class="op" id="4734248">}</span><span class="op" id="4734249">,</span>&nbsp;<span class="ident" id="4734251">skip</span>&nbsp;<span class="builtintype" id="4734256">int</span><span class="op" id="4734259">)</span>&nbsp;<span class="op" id="4734261">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4734264">if</span>&nbsp;<span class="ident" id="4734267">p</span><span class="op" id="4734268">.</span><span class="ident" id="4734269">name</span>&nbsp;<span class="op" id="4734274">==</span>&nbsp;<span class="string" id="4734277">&#34;&#34;</span>&nbsp;<span class="op" id="4734280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4734284">panic</span><span class="op" id="4734289">(</span><span class="string" id="4734290">&#34;pprof:&nbsp;use&nbsp;of&nbsp;uninitialized&nbsp;Profile&#34;</span><span class="op" id="4734327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4734330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4734333">if</span>&nbsp;<span class="ident" id="4734336">p</span><span class="op" id="4734337">.</span><span class="ident" id="4734338">write</span>&nbsp;<span class="op" id="4734344">!=</span>&nbsp;<span class="builtintype" id="4734347">nil</span>&nbsp;<span class="op" id="4734351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4734355">panic</span><span class="op" id="4734360">(</span><span class="string" id="4734361">&#34;pprof:&nbsp;Add&nbsp;called&nbsp;on&nbsp;built-in&nbsp;Profile&nbsp;&#34;</span>&nbsp;<span class="op" id="4734402">+</span>&nbsp;<span class="ident" id="4734404">p</span><span class="op" id="4734405">.</span><span class="ident" id="4734406">name</span><span class="op" id="4734410">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4734413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4734417">stk</span>&nbsp;<span class="op" id="4734421">:=</span>&nbsp;<span class="builtinfunc" id="4734424">make</span><span class="op" id="4734428">(</span><span class="op" id="4734429">[</span><span class="op" id="4734430">]</span><span class="builtintype" id="4734431">uintptr</span><span class="op" id="4734438">,</span>&nbsp;<span class="num" id="4734440">32</span><span class="op" id="4734442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4734445">n</span>&nbsp;<span class="op" id="4734447">:=</span>&nbsp;<span class="ident" id="4734450">runtime</span><span class="op" id="4734457">.</span><span class="ident" id="4734458">Callers</span><span class="op" id="4734465">(</span><span class="ident" id="4734466">skip</span><span class="op" id="4734470">+</span><span class="num" id="4734471">1</span><span class="op" id="4734472">,</span>&nbsp;<span class="ident" id="4734474">stk</span><span class="op" id="4734477">[</span><span class="op" id="4734478">:</span><span class="op" id="4734479">]</span><span class="op" id="4734480">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4734484">p</span><span class="op" id="4734485">.</span><span class="ident" id="4734486">mu</span><span class="op" id="4734488">.</span><span class="ident" id="4734489">Lock</span><span class="op" id="4734493">(</span><span class="op" id="4734494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4734497">defer</span>&nbsp;<span class="ident" id="4734503">p</span><span class="op" id="4734504">.</span><span class="ident" id="4734505">mu</span><span class="op" id="4734507">.</span><span class="ident" id="4734508">Unlock</span><span class="op" id="4734514">(</span><span class="op" id="4734515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4734518">if</span>&nbsp;<span class="ident" id="4734521">p</span><span class="op" id="4734522">.</span><span class="ident" id="4734523">m</span><span class="op" id="4734524">[</span><span class="ident" id="4734525">value</span><span class="op" id="4734530">]</span>&nbsp;<span class="op" id="4734532">!=</span>&nbsp;<span class="builtintype" id="4734535">nil</span>&nbsp;<span class="op" id="4734539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4734543">panic</span><span class="op" id="4734548">(</span><span class="string" id="4734549">&#34;pprof:&nbsp;Profile.Add&nbsp;of&nbsp;duplicate&nbsp;value&#34;</span><span class="op" id="4734588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4734591">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4734594">p</span><span class="op" id="4734595">.</span><span class="ident" id="4734596">m</span><span class="op" id="4734597">[</span><span class="ident" id="4734598">value</span><span class="op" id="4734603">]</span>&nbsp;<span class="op" id="4734605">=</span>&nbsp;<span class="ident" id="4734607">stk</span><span class="op" id="4734610">[</span><span class="op" id="4734611">:</span><span class="ident" id="4734612">n</span><span class="op" id="4734613">]</span><br>
<span class="lineno"></span><span class="op" id="4734615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4734618">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;execution&nbsp;stack&nbsp;associated&nbsp;with&nbsp;value&nbsp;from&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="4734696">//&nbsp;It&nbsp;is&nbsp;a&nbsp;no-op&nbsp;if&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;profile.</span><br>
<span class="lineno">205</span><span class="keyword" id="4734749">func</span>&nbsp;<span class="op" id="4734754">(</span><span class="ident" id="4734755">p</span>&nbsp;<span class="op" id="4734757">*</span><span class="ident" id="4734758">Profile</span><span class="op" id="4734765">)</span>&nbsp;<span class="ident" id="4734767">Remove</span><span class="op" id="4734773">(</span><span class="ident" id="4734774">value</span>&nbsp;<span class="keyword" id="4734780">interface</span><span class="op" id="4734789">{</span><span class="op" id="4734790">}</span><span class="op" id="4734791">)</span>&nbsp;<span class="op" id="4734793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4734796">p</span><span class="op" id="4734797">.</span><span class="ident" id="4734798">mu</span><span class="op" id="4734800">.</span><span class="ident" id="4734801">Lock</span><span class="op" id="4734805">(</span><span class="op" id="4734806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4734809">defer</span>&nbsp;<span class="ident" id="4734815">p</span><span class="op" id="4734816">.</span><span class="ident" id="4734817">mu</span><span class="op" id="4734819">.</span><span class="ident" id="4734820">Unlock</span><span class="op" id="4734826">(</span><span class="op" id="4734827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4734830">delete</span><span class="op" id="4734836">(</span><span class="ident" id="4734837">p</span><span class="op" id="4734838">.</span><span class="ident" id="4734839">m</span><span class="op" id="4734840">,</span>&nbsp;<span class="ident" id="4734842">value</span><span class="op" id="4734847">)</span><br>
<span class="lineno"></span><span class="op" id="4734849">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="comment" id="4734852">//&nbsp;WriteTo&nbsp;writes&nbsp;a&nbsp;pprof-formatted&nbsp;snapshot&nbsp;of&nbsp;the&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4734918">//&nbsp;If&nbsp;a&nbsp;write&nbsp;to&nbsp;w&nbsp;returns&nbsp;an&nbsp;error,&nbsp;WriteTo&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4734983">//&nbsp;Otherwise,&nbsp;WriteTo&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="4735018">//</span><br>
<span class="lineno">215</span><span class="comment" id="4735021">//&nbsp;The&nbsp;debug&nbsp;parameter&nbsp;enables&nbsp;additional&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="4735071">//&nbsp;Passing&nbsp;debug=0&nbsp;prints&nbsp;only&nbsp;the&nbsp;hexadecimal&nbsp;addresses&nbsp;that&nbsp;pprof&nbsp;needs.</span><br>
<span class="lineno"></span><span class="comment" id="4735146">//&nbsp;Passing&nbsp;debug=1&nbsp;adds&nbsp;comments&nbsp;translating&nbsp;addresses&nbsp;to&nbsp;function&nbsp;names</span><br>
<span class="lineno"></span><span class="comment" id="4735219">//&nbsp;and&nbsp;line&nbsp;numbers,&nbsp;so&nbsp;that&nbsp;a&nbsp;programmer&nbsp;can&nbsp;read&nbsp;the&nbsp;profile&nbsp;without&nbsp;tools.</span><br>
<span class="lineno"></span><span class="comment" id="4735297">//</span><br>
<span class="lineno">220</span><span class="comment" id="4735300">//&nbsp;The&nbsp;predefined&nbsp;profiles&nbsp;may&nbsp;assign&nbsp;meaning&nbsp;to&nbsp;other&nbsp;debug&nbsp;values;</span><br>
<span class="lineno"></span><span class="comment" id="4735369">//&nbsp;for&nbsp;example,&nbsp;when&nbsp;printing&nbsp;the&nbsp;&#34;goroutine&#34;&nbsp;profile,&nbsp;debug=2&nbsp;means&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4735441">//&nbsp;print&nbsp;the&nbsp;goroutine&nbsp;stacks&nbsp;in&nbsp;the&nbsp;same&nbsp;form&nbsp;that&nbsp;a&nbsp;Go&nbsp;program&nbsp;uses</span><br>
<span class="lineno"></span><span class="comment" id="4735511">//&nbsp;when&nbsp;dying&nbsp;due&nbsp;to&nbsp;an&nbsp;unrecovered&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="4735554">func</span>&nbsp;<span class="op" id="4735559">(</span><span class="ident" id="4735560">p</span>&nbsp;<span class="op" id="4735562">*</span><span class="ident" id="4735563">Profile</span><span class="op" id="4735570">)</span>&nbsp;<span class="ident" id="4735572">WriteTo</span><span class="op" id="4735579">(</span><span class="ident" id="4735580">w</span>&nbsp;<span class="ident" id="4735582">io</span><span class="op" id="4735584">.</span><span class="ident" id="4735585">Writer</span><span class="op" id="4735591">,</span>&nbsp;<span class="ident" id="4735593">debug</span>&nbsp;<span class="builtintype" id="4735599">int</span><span class="op" id="4735602">)</span>&nbsp;<span class="builtintype" id="4735604">error</span>&nbsp;<span class="op" id="4735610">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4735613">if</span>&nbsp;<span class="ident" id="4735616">p</span><span class="op" id="4735617">.</span><span class="ident" id="4735618">name</span>&nbsp;<span class="op" id="4735623">==</span>&nbsp;<span class="string" id="4735626">&#34;&#34;</span>&nbsp;<span class="op" id="4735629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4735633">panic</span><span class="op" id="4735638">(</span><span class="string" id="4735639">&#34;pprof:&nbsp;use&nbsp;of&nbsp;zero&nbsp;Profile&#34;</span><span class="op" id="4735667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4735670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4735673">if</span>&nbsp;<span class="ident" id="4735676">p</span><span class="op" id="4735677">.</span><span class="ident" id="4735678">write</span>&nbsp;<span class="op" id="4735684">!=</span>&nbsp;<span class="builtintype" id="4735687">nil</span>&nbsp;<span class="op" id="4735691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4735695">return</span>&nbsp;<span class="ident" id="4735702">p</span><span class="op" id="4735703">.</span><span class="ident" id="4735704">write</span><span class="op" id="4735709">(</span><span class="ident" id="4735710">w</span><span class="op" id="4735711">,</span>&nbsp;<span class="ident" id="4735713">debug</span><span class="op" id="4735718">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4735721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4735725">//&nbsp;Obtain&nbsp;consistent&nbsp;snapshot&nbsp;under&nbsp;lock;&nbsp;then&nbsp;process&nbsp;without&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4735795">var</span>&nbsp;<span class="ident" id="4735799">all</span>&nbsp;<span class="op" id="4735803">[</span><span class="op" id="4735804">]</span><span class="op" id="4735805">[</span><span class="op" id="4735806">]</span><span class="builtintype" id="4735807">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4735816">p</span><span class="op" id="4735817">.</span><span class="ident" id="4735818">mu</span><span class="op" id="4735820">.</span><span class="ident" id="4735821">Lock</span><span class="op" id="4735825">(</span><span class="op" id="4735826">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4735829">for</span>&nbsp;<span class="ident" id="4735833">_</span><span class="op" id="4735834">,</span>&nbsp;<span class="ident" id="4735836">stk</span>&nbsp;<span class="op" id="4735840">:=</span>&nbsp;<span class="keyword" id="4735843">range</span>&nbsp;<span class="ident" id="4735849">p</span><span class="op" id="4735850">.</span><span class="ident" id="4735851">m</span>&nbsp;<span class="op" id="4735853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4735857">all</span>&nbsp;<span class="op" id="4735861">=</span>&nbsp;<span class="builtinfunc" id="4735863">append</span><span class="op" id="4735869">(</span><span class="ident" id="4735870">all</span><span class="op" id="4735873">,</span>&nbsp;<span class="ident" id="4735875">stk</span><span class="op" id="4735878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4735881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4735884">p</span><span class="op" id="4735885">.</span><span class="ident" id="4735886">mu</span><span class="op" id="4735888">.</span><span class="ident" id="4735889">Unlock</span><span class="op" id="4735895">(</span><span class="op" id="4735896">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4735900">//&nbsp;Map&nbsp;order&nbsp;is&nbsp;non-deterministic;&nbsp;make&nbsp;output&nbsp;deterministic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4735963">sort</span><span class="op" id="4735967">.</span><span class="ident" id="4735968">Sort</span><span class="op" id="4735972">(</span><span class="ident" id="4735973">stackProfile</span><span class="op" id="4735985">(</span><span class="ident" id="4735986">all</span><span class="op" id="4735989">)</span><span class="op" id="4735990">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4735994">return</span>&nbsp;<span class="ident" id="4736001">printCountProfile</span><span class="op" id="4736018">(</span><span class="ident" id="4736019">w</span><span class="op" id="4736020">,</span>&nbsp;<span class="ident" id="4736022">debug</span><span class="op" id="4736027">,</span>&nbsp;<span class="ident" id="4736029">p</span><span class="op" id="4736030">.</span><span class="ident" id="4736031">name</span><span class="op" id="4736035">,</span>&nbsp;<span class="ident" id="4736037">stackProfile</span><span class="op" id="4736049">(</span><span class="ident" id="4736050">all</span><span class="op" id="4736053">)</span><span class="op" id="4736054">)</span><br>
<span class="lineno"></span><span class="op" id="4736056">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="4736059">type</span>&nbsp;<span class="ident" id="4736064">stackProfile</span>&nbsp;<span class="op" id="4736077">[</span><span class="op" id="4736078">]</span><span class="op" id="4736079">[</span><span class="op" id="4736080">]</span><span class="builtintype" id="4736081">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4736090">func</span>&nbsp;<span class="op" id="4736095">(</span><span class="ident" id="4736096">x</span>&nbsp;<span class="ident" id="4736098">stackProfile</span><span class="op" id="4736110">)</span>&nbsp;<span class="ident" id="4736112">Len</span><span class="op" id="4736115">(</span><span class="op" id="4736116">)</span>&nbsp;<span class="builtintype" id="4736118">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4736135">{</span>&nbsp;<span class="keyword" id="4736137">return</span>&nbsp;<span class="builtinfunc" id="4736144">len</span><span class="op" id="4736147">(</span><span class="ident" id="4736148">x</span><span class="op" id="4736149">)</span>&nbsp;<span class="op" id="4736151">}</span><br>
<span class="lineno"></span><span class="keyword" id="4736153">func</span>&nbsp;<span class="op" id="4736158">(</span><span class="ident" id="4736159">x</span>&nbsp;<span class="ident" id="4736161">stackProfile</span><span class="op" id="4736173">)</span>&nbsp;<span class="ident" id="4736175">Stack</span><span class="op" id="4736180">(</span><span class="ident" id="4736181">i</span>&nbsp;<span class="builtintype" id="4736183">int</span><span class="op" id="4736186">)</span>&nbsp;<span class="op" id="4736188">[</span><span class="op" id="4736189">]</span><span class="builtintype" id="4736190">uintptr</span>&nbsp;<span class="op" id="4736198">{</span>&nbsp;<span class="keyword" id="4736200">return</span>&nbsp;<span class="ident" id="4736207">x</span><span class="op" id="4736208">[</span><span class="ident" id="4736209">i</span><span class="op" id="4736210">]</span>&nbsp;<span class="op" id="4736212">}</span><br>
<span class="lineno">250</span><span class="keyword" id="4736214">func</span>&nbsp;<span class="op" id="4736219">(</span><span class="ident" id="4736220">x</span>&nbsp;<span class="ident" id="4736222">stackProfile</span><span class="op" id="4736234">)</span>&nbsp;<span class="ident" id="4736236">Swap</span><span class="op" id="4736240">(</span><span class="ident" id="4736241">i</span><span class="op" id="4736242">,</span>&nbsp;<span class="ident" id="4736244">j</span>&nbsp;<span class="builtintype" id="4736246">int</span><span class="op" id="4736249">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4736259">{</span>&nbsp;<span class="ident" id="4736261">x</span><span class="op" id="4736262">[</span><span class="ident" id="4736263">i</span><span class="op" id="4736264">]</span><span class="op" id="4736265">,</span>&nbsp;<span class="ident" id="4736267">x</span><span class="op" id="4736268">[</span><span class="ident" id="4736269">j</span><span class="op" id="4736270">]</span>&nbsp;<span class="op" id="4736272">=</span>&nbsp;<span class="ident" id="4736274">x</span><span class="op" id="4736275">[</span><span class="ident" id="4736276">j</span><span class="op" id="4736277">]</span><span class="op" id="4736278">,</span>&nbsp;<span class="ident" id="4736280">x</span><span class="op" id="4736281">[</span><span class="ident" id="4736282">i</span><span class="op" id="4736283">]</span>&nbsp;<span class="op" id="4736285">}</span><br>
<span class="lineno"></span><span class="keyword" id="4736287">func</span>&nbsp;<span class="op" id="4736292">(</span><span class="ident" id="4736293">x</span>&nbsp;<span class="ident" id="4736295">stackProfile</span><span class="op" id="4736307">)</span>&nbsp;<span class="ident" id="4736309">Less</span><span class="op" id="4736313">(</span><span class="ident" id="4736314">i</span><span class="op" id="4736315">,</span>&nbsp;<span class="ident" id="4736317">j</span>&nbsp;<span class="builtintype" id="4736319">int</span><span class="op" id="4736322">)</span>&nbsp;<span class="builtintype" id="4736324">bool</span>&nbsp;<span class="op" id="4736329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736332">t</span><span class="op" id="4736333">,</span>&nbsp;<span class="ident" id="4736335">u</span>&nbsp;<span class="op" id="4736337">:=</span>&nbsp;<span class="ident" id="4736340">x</span><span class="op" id="4736341">[</span><span class="ident" id="4736342">i</span><span class="op" id="4736343">]</span><span class="op" id="4736344">,</span>&nbsp;<span class="ident" id="4736346">x</span><span class="op" id="4736347">[</span><span class="ident" id="4736348">j</span><span class="op" id="4736349">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736352">for</span>&nbsp;<span class="ident" id="4736356">k</span>&nbsp;<span class="op" id="4736358">:=</span>&nbsp;<span class="num" id="4736361">0</span><span class="op" id="4736362">;</span>&nbsp;<span class="ident" id="4736364">k</span>&nbsp;<span class="op" id="4736366">&lt;</span>&nbsp;<span class="builtinfunc" id="4736368">len</span><span class="op" id="4736371">(</span><span class="ident" id="4736372">t</span><span class="op" id="4736373">)</span>&nbsp;<span class="op" id="4736375">&amp;&amp;</span>&nbsp;<span class="ident" id="4736378">k</span>&nbsp;<span class="op" id="4736380">&lt;</span>&nbsp;<span class="builtinfunc" id="4736382">len</span><span class="op" id="4736385">(</span><span class="ident" id="4736386">u</span><span class="op" id="4736387">)</span><span class="op" id="4736388">;</span>&nbsp;<span class="ident" id="4736390">k</span><span class="op" id="4736391">++</span>&nbsp;<span class="op" id="4736394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736398">if</span>&nbsp;<span class="ident" id="4736401">t</span><span class="op" id="4736402">[</span><span class="ident" id="4736403">k</span><span class="op" id="4736404">]</span>&nbsp;<span class="op" id="4736406">!=</span>&nbsp;<span class="ident" id="4736409">u</span><span class="op" id="4736410">[</span><span class="ident" id="4736411">k</span><span class="op" id="4736412">]</span>&nbsp;<span class="op" id="4736414">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736419">return</span>&nbsp;<span class="ident" id="4736426">t</span><span class="op" id="4736427">[</span><span class="ident" id="4736428">k</span><span class="op" id="4736429">]</span>&nbsp;<span class="op" id="4736431">&lt;</span>&nbsp;<span class="ident" id="4736433">u</span><span class="op" id="4736434">[</span><span class="ident" id="4736435">k</span><span class="op" id="4736436">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4736440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4736443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736446">return</span>&nbsp;<span class="builtinfunc" id="4736453">len</span><span class="op" id="4736456">(</span><span class="ident" id="4736457">t</span><span class="op" id="4736458">)</span>&nbsp;<span class="op" id="4736460">&lt;</span>&nbsp;<span class="builtinfunc" id="4736462">len</span><span class="op" id="4736465">(</span><span class="ident" id="4736466">u</span><span class="op" id="4736467">)</span><br>
<span class="lineno"></span><span class="op" id="4736469">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="4736472">//&nbsp;A&nbsp;countProfile&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;stack&nbsp;traces&nbsp;to&nbsp;be&nbsp;printed&nbsp;as&nbsp;counts</span><br>
<span class="lineno"></span><span class="comment" id="4736539">//&nbsp;grouped&nbsp;by&nbsp;stack&nbsp;trace.&nbsp;&nbsp;There&nbsp;are&nbsp;multiple&nbsp;implementations:</span><br>
<span class="lineno"></span><span class="comment" id="4736603">//&nbsp;all&nbsp;that&nbsp;matters&nbsp;is&nbsp;that&nbsp;we&nbsp;can&nbsp;find&nbsp;out&nbsp;how&nbsp;many&nbsp;traces&nbsp;there&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4736673">//&nbsp;and&nbsp;obtain&nbsp;each&nbsp;trace&nbsp;in&nbsp;turn.</span><br>
<span class="lineno">265</span><span class="keyword" id="4736707">type</span>&nbsp;<span class="ident" id="4736712">countProfile</span>&nbsp;<span class="keyword" id="4736725">interface</span>&nbsp;<span class="op" id="4736735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736738">Len</span><span class="op" id="4736741">(</span><span class="op" id="4736742">)</span>&nbsp;<span class="builtintype" id="4736744">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736749">Stack</span><span class="op" id="4736754">(</span><span class="ident" id="4736755">i</span>&nbsp;<span class="builtintype" id="4736757">int</span><span class="op" id="4736760">)</span>&nbsp;<span class="op" id="4736762">[</span><span class="op" id="4736763">]</span><span class="builtintype" id="4736764">uintptr</span><br>
<span class="lineno"></span><span class="op" id="4736772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="4736775">//&nbsp;printCountProfile&nbsp;prints&nbsp;a&nbsp;countProfile&nbsp;at&nbsp;the&nbsp;specified&nbsp;debug&nbsp;level.</span><br>
<span class="lineno"></span><span class="keyword" id="4736848">func</span>&nbsp;<span class="ident" id="4736853">printCountProfile</span><span class="op" id="4736870">(</span><span class="ident" id="4736871">w</span>&nbsp;<span class="ident" id="4736873">io</span><span class="op" id="4736875">.</span><span class="ident" id="4736876">Writer</span><span class="op" id="4736882">,</span>&nbsp;<span class="ident" id="4736884">debug</span>&nbsp;<span class="builtintype" id="4736890">int</span><span class="op" id="4736893">,</span>&nbsp;<span class="ident" id="4736895">name</span>&nbsp;<span class="builtintype" id="4736900">string</span><span class="op" id="4736906">,</span>&nbsp;<span class="ident" id="4736908">p</span>&nbsp;<span class="ident" id="4736910">countProfile</span><span class="op" id="4736922">)</span>&nbsp;<span class="builtintype" id="4736924">error</span>&nbsp;<span class="op" id="4736930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736933">b</span>&nbsp;<span class="op" id="4736935">:=</span>&nbsp;<span class="ident" id="4736938">bufio</span><span class="op" id="4736943">.</span><span class="ident" id="4736944">NewWriter</span><span class="op" id="4736953">(</span><span class="ident" id="4736954">w</span><span class="op" id="4736955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736958">var</span>&nbsp;<span class="ident" id="4736962">tw</span>&nbsp;<span class="op" id="4736965">*</span><span class="ident" id="4736966">tabwriter</span><span class="op" id="4736975">.</span><span class="ident" id="4736976">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4736984">w</span>&nbsp;<span class="op" id="4736986">=</span>&nbsp;<span class="ident" id="4736988">b</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4736991">if</span>&nbsp;<span class="ident" id="4736994">debug</span>&nbsp;<span class="op" id="4737000">&gt;</span>&nbsp;<span class="num" id="4737002">0</span>&nbsp;<span class="op" id="4737004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737008">tw</span>&nbsp;<span class="op" id="4737011">=</span>&nbsp;<span class="ident" id="4737013">tabwriter</span><span class="op" id="4737022">.</span><span class="ident" id="4737023">NewWriter</span><span class="op" id="4737032">(</span><span class="ident" id="4737033">w</span><span class="op" id="4737034">,</span>&nbsp;<span class="num" id="4737036">1</span><span class="op" id="4737037">,</span>&nbsp;<span class="num" id="4737039">8</span><span class="op" id="4737040">,</span>&nbsp;<span class="num" id="4737042">1</span><span class="op" id="4737043">,</span>&nbsp;<span class="string" id="4737045">&#39;\t&#39;</span><span class="op" id="4737049">,</span>&nbsp;<span class="num" id="4737051">0</span><span class="op" id="4737052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737056">w</span>&nbsp;<span class="op" id="4737058">=</span>&nbsp;<span class="ident" id="4737060">tw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4737064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737068">fmt</span><span class="op" id="4737071">.</span><span class="ident" id="4737072">Fprintf</span><span class="op" id="4737079">(</span><span class="ident" id="4737080">w</span><span class="op" id="4737081">,</span>&nbsp;<span class="string" id="4737083">&#34;%s&nbsp;profile:&nbsp;total&nbsp;%d\n&#34;</span><span class="op" id="4737107">,</span>&nbsp;<span class="ident" id="4737109">name</span><span class="op" id="4737113">,</span>&nbsp;<span class="ident" id="4737115">p</span><span class="op" id="4737116">.</span><span class="ident" id="4737117">Len</span><span class="op" id="4737120">(</span><span class="op" id="4737121">)</span><span class="op" id="4737122">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4737126">//&nbsp;Build&nbsp;count&nbsp;of&nbsp;each&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737157">var</span>&nbsp;<span class="ident" id="4737161">buf</span>&nbsp;<span class="ident" id="4737165">bytes</span><span class="op" id="4737170">.</span><span class="ident" id="4737171">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737179">key</span>&nbsp;<span class="op" id="4737183">:=</span>&nbsp;<span class="keyword" id="4737186">func</span><span class="op" id="4737190">(</span><span class="ident" id="4737191">stk</span>&nbsp;<span class="op" id="4737195">[</span><span class="op" id="4737196">]</span><span class="builtintype" id="4737197">uintptr</span><span class="op" id="4737204">)</span>&nbsp;<span class="builtintype" id="4737206">string</span>&nbsp;<span class="op" id="4737213">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737217">buf</span><span class="op" id="4737220">.</span><span class="ident" id="4737221">Reset</span><span class="op" id="4737226">(</span><span class="op" id="4737227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737231">fmt</span><span class="op" id="4737234">.</span><span class="ident" id="4737235">Fprintf</span><span class="op" id="4737242">(</span><span class="op" id="4737243">&amp;</span><span class="ident" id="4737244">buf</span><span class="op" id="4737247">,</span>&nbsp;<span class="string" id="4737249">&#34;@&#34;</span><span class="op" id="4737252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737256">for</span>&nbsp;<span class="ident" id="4737260">_</span><span class="op" id="4737261">,</span>&nbsp;<span class="ident" id="4737263">pc</span>&nbsp;<span class="op" id="4737266">:=</span>&nbsp;<span class="keyword" id="4737269">range</span>&nbsp;<span class="ident" id="4737275">stk</span>&nbsp;<span class="op" id="4737279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737284">fmt</span><span class="op" id="4737287">.</span><span class="ident" id="4737288">Fprintf</span><span class="op" id="4737295">(</span><span class="op" id="4737296">&amp;</span><span class="ident" id="4737297">buf</span><span class="op" id="4737300">,</span>&nbsp;<span class="string" id="4737302">&#34;&nbsp;%#x&#34;</span><span class="op" id="4737308">,</span>&nbsp;<span class="ident" id="4737310">pc</span><span class="op" id="4737312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4737316">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737320">return</span>&nbsp;<span class="ident" id="4737327">buf</span><span class="op" id="4737330">.</span><span class="ident" id="4737331">String</span><span class="op" id="4737337">(</span><span class="op" id="4737338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4737341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737344">m</span>&nbsp;<span class="op" id="4737346">:=</span>&nbsp;<span class="keyword" id="4737349">map</span><span class="op" id="4737352">[</span><span class="builtintype" id="4737353">string</span><span class="op" id="4737359">]</span><span class="builtintype" id="4737360">int</span><span class="op" id="4737363">{</span><span class="op" id="4737364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737367">n</span>&nbsp;<span class="op" id="4737369">:=</span>&nbsp;<span class="ident" id="4737372">p</span><span class="op" id="4737373">.</span><span class="ident" id="4737374">Len</span><span class="op" id="4737377">(</span><span class="op" id="4737378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737381">for</span>&nbsp;<span class="ident" id="4737385">i</span>&nbsp;<span class="op" id="4737387">:=</span>&nbsp;<span class="num" id="4737390">0</span><span class="op" id="4737391">;</span>&nbsp;<span class="ident" id="4737393">i</span>&nbsp;<span class="op" id="4737395">&lt;</span>&nbsp;<span class="ident" id="4737397">n</span><span class="op" id="4737398">;</span>&nbsp;<span class="ident" id="4737400">i</span><span class="op" id="4737401">++</span>&nbsp;<span class="op" id="4737404">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737408">m</span><span class="op" id="4737409">[</span><span class="ident" id="4737410">key</span><span class="op" id="4737413">(</span><span class="ident" id="4737414">p</span><span class="op" id="4737415">.</span><span class="ident" id="4737416">Stack</span><span class="op" id="4737421">(</span><span class="ident" id="4737422">i</span><span class="op" id="4737423">)</span><span class="op" id="4737424">)</span><span class="op" id="4737425">]</span><span class="op" id="4737426">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4737430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4737434">//&nbsp;Print&nbsp;stacks,&nbsp;listing&nbsp;count&nbsp;on&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;a&nbsp;unique&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737505">for</span>&nbsp;<span class="ident" id="4737509">i</span>&nbsp;<span class="op" id="4737511">:=</span>&nbsp;<span class="num" id="4737514">0</span><span class="op" id="4737515">;</span>&nbsp;<span class="ident" id="4737517">i</span>&nbsp;<span class="op" id="4737519">&lt;</span>&nbsp;<span class="ident" id="4737521">n</span><span class="op" id="4737522">;</span>&nbsp;<span class="ident" id="4737524">i</span><span class="op" id="4737525">++</span>&nbsp;<span class="op" id="4737528">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737532">stk</span>&nbsp;<span class="op" id="4737536">:=</span>&nbsp;<span class="ident" id="4737539">p</span><span class="op" id="4737540">.</span><span class="ident" id="4737541">Stack</span><span class="op" id="4737546">(</span><span class="ident" id="4737547">i</span><span class="op" id="4737548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737552">s</span>&nbsp;<span class="op" id="4737554">:=</span>&nbsp;<span class="ident" id="4737557">key</span><span class="op" id="4737560">(</span><span class="ident" id="4737561">stk</span><span class="op" id="4737564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737568">if</span>&nbsp;<span class="ident" id="4737571">count</span>&nbsp;<span class="op" id="4737577">:=</span>&nbsp;<span class="ident" id="4737580">m</span><span class="op" id="4737581">[</span><span class="ident" id="4737582">s</span><span class="op" id="4737583">]</span><span class="op" id="4737584">;</span>&nbsp;<span class="ident" id="4737586">count</span>&nbsp;<span class="op" id="4737592">!=</span>&nbsp;<span class="num" id="4737595">0</span>&nbsp;<span class="op" id="4737597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737602">fmt</span><span class="op" id="4737605">.</span><span class="ident" id="4737606">Fprintf</span><span class="op" id="4737613">(</span><span class="ident" id="4737614">w</span><span class="op" id="4737615">,</span>&nbsp;<span class="string" id="4737617">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="4737626">,</span>&nbsp;<span class="ident" id="4737628">count</span><span class="op" id="4737633">,</span>&nbsp;<span class="ident" id="4737635">s</span><span class="op" id="4737636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737641">if</span>&nbsp;<span class="ident" id="4737644">debug</span>&nbsp;<span class="op" id="4737650">&gt;</span>&nbsp;<span class="num" id="4737652">0</span>&nbsp;<span class="op" id="4737654">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737660">printStackRecord</span><span class="op" id="4737676">(</span><span class="ident" id="4737677">w</span><span class="op" id="4737678">,</span>&nbsp;<span class="ident" id="4737680">stk</span><span class="op" id="4737683">,</span>&nbsp;<span class="builtintype" id="4737685">false</span><span class="op" id="4737690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4737695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4737700">delete</span><span class="op" id="4737706">(</span><span class="ident" id="4737707">m</span><span class="op" id="4737708">,</span>&nbsp;<span class="ident" id="4737710">s</span><span class="op" id="4737711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4737715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4737718">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737722">if</span>&nbsp;<span class="ident" id="4737725">tw</span>&nbsp;<span class="op" id="4737728">!=</span>&nbsp;<span class="builtintype" id="4737731">nil</span>&nbsp;<span class="op" id="4737735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737739">tw</span><span class="op" id="4737741">.</span><span class="ident" id="4737742">Flush</span><span class="op" id="4737747">(</span><span class="op" id="4737748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4737751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737754">return</span>&nbsp;<span class="ident" id="4737761">b</span><span class="op" id="4737762">.</span><span class="ident" id="4737763">Flush</span><span class="op" id="4737768">(</span><span class="op" id="4737769">)</span><br>
<span class="lineno">315</span><span class="op" id="4737771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4737774">//&nbsp;printStackRecord&nbsp;prints&nbsp;the&nbsp;function&nbsp;+&nbsp;source&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="4737840">//&nbsp;for&nbsp;a&nbsp;single&nbsp;stack&nbsp;trace.</span><br>
<span class="lineno"></span><span class="keyword" id="4737869">func</span>&nbsp;<span class="ident" id="4737874">printStackRecord</span><span class="op" id="4737890">(</span><span class="ident" id="4737891">w</span>&nbsp;<span class="ident" id="4737893">io</span><span class="op" id="4737895">.</span><span class="ident" id="4737896">Writer</span><span class="op" id="4737902">,</span>&nbsp;<span class="ident" id="4737904">stk</span>&nbsp;<span class="op" id="4737908">[</span><span class="op" id="4737909">]</span><span class="builtintype" id="4737910">uintptr</span><span class="op" id="4737917">,</span>&nbsp;<span class="ident" id="4737919">allFrames</span>&nbsp;<span class="builtintype" id="4737929">bool</span><span class="op" id="4737933">)</span>&nbsp;<span class="op" id="4737935">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737938">show</span>&nbsp;<span class="op" id="4737943">:=</span>&nbsp;<span class="ident" id="4737946">allFrames</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4737957">wasPanic</span>&nbsp;<span class="op" id="4737966">:=</span>&nbsp;<span class="builtintype" id="4737969">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4737976">for</span>&nbsp;<span class="ident" id="4737980">i</span><span class="op" id="4737981">,</span>&nbsp;<span class="ident" id="4737983">pc</span>&nbsp;<span class="op" id="4737986">:=</span>&nbsp;<span class="keyword" id="4737989">range</span>&nbsp;<span class="ident" id="4737995">stk</span>&nbsp;<span class="op" id="4737999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738003">f</span>&nbsp;<span class="op" id="4738005">:=</span>&nbsp;<span class="ident" id="4738008">runtime</span><span class="op" id="4738015">.</span><span class="ident" id="4738016">FuncForPC</span><span class="op" id="4738025">(</span><span class="ident" id="4738026">pc</span><span class="op" id="4738028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4738032">if</span>&nbsp;<span class="ident" id="4738035">f</span>&nbsp;<span class="op" id="4738037">==</span>&nbsp;<span class="builtintype" id="4738040">nil</span>&nbsp;<span class="op" id="4738044">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738049">show</span>&nbsp;<span class="op" id="4738054">=</span>&nbsp;<span class="builtintype" id="4738056">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738064">fmt</span><span class="op" id="4738067">.</span><span class="ident" id="4738068">Fprintf</span><span class="op" id="4738075">(</span><span class="ident" id="4738076">w</span><span class="op" id="4738077">,</span>&nbsp;<span class="string" id="4738079">&#34;#\t%#x\n&#34;</span><span class="op" id="4738089">,</span>&nbsp;<span class="ident" id="4738091">pc</span><span class="op" id="4738093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738098">wasPanic</span>&nbsp;<span class="op" id="4738107">=</span>&nbsp;<span class="builtintype" id="4738109">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4738117">}</span>&nbsp;<span class="keyword" id="4738119">else</span>&nbsp;<span class="op" id="4738124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738129">tracepc</span>&nbsp;<span class="op" id="4738137">:=</span>&nbsp;<span class="ident" id="4738140">pc</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4738146">//&nbsp;Back&nbsp;up&nbsp;to&nbsp;call&nbsp;instruction.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4738181">if</span>&nbsp;<span class="ident" id="4738184">i</span>&nbsp;<span class="op" id="4738186">&gt;</span>&nbsp;<span class="num" id="4738188">0</span>&nbsp;<span class="op" id="4738190">&amp;&amp;</span>&nbsp;<span class="ident" id="4738193">pc</span>&nbsp;<span class="op" id="4738196">&gt;</span>&nbsp;<span class="ident" id="4738198">f</span><span class="op" id="4738199">.</span><span class="ident" id="4738200">Entry</span><span class="op" id="4738205">(</span><span class="op" id="4738206">)</span>&nbsp;<span class="op" id="4738208">&amp;&amp;</span>&nbsp;<span class="op" id="4738211">!</span><span class="ident" id="4738212">wasPanic</span>&nbsp;<span class="op" id="4738221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4738227">if</span>&nbsp;<span class="ident" id="4738230">runtime</span><span class="op" id="4738237">.</span><span class="ident" id="4738238">GOARCH</span>&nbsp;<span class="op" id="4738245">==</span>&nbsp;<span class="string" id="4738248">&#34;386&#34;</span>&nbsp;<span class="op" id="4738254">||</span>&nbsp;<span class="ident" id="4738257">runtime</span><span class="op" id="4738264">.</span><span class="ident" id="4738265">GOARCH</span>&nbsp;<span class="op" id="4738272">==</span>&nbsp;<span class="string" id="4738275">&#34;amd64&#34;</span>&nbsp;<span class="op" id="4738283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738290">tracepc</span><span class="op" id="4738297">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4738304">}</span>&nbsp;<span class="keyword" id="4738306">else</span>&nbsp;<span class="op" id="4738311">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738318">tracepc</span>&nbsp;<span class="op" id="4738326">-=</span>&nbsp;<span class="num" id="4738329">4</span>&nbsp;<span class="comment" id="4738331">//&nbsp;arm,&nbsp;etc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4738347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4738352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738357">file</span><span class="op" id="4738361">,</span>&nbsp;<span class="ident" id="4738363">line</span>&nbsp;<span class="op" id="4738368">:=</span>&nbsp;<span class="ident" id="4738371">f</span><span class="op" id="4738372">.</span><span class="ident" id="4738373">FileLine</span><span class="op" id="4738381">(</span><span class="ident" id="4738382">tracepc</span><span class="op" id="4738389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738394">name</span>&nbsp;<span class="op" id="4738399">:=</span>&nbsp;<span class="ident" id="4738402">f</span><span class="op" id="4738403">.</span><span class="ident" id="4738404">Name</span><span class="op" id="4738408">(</span><span class="op" id="4738409">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4738414">//&nbsp;Hide&nbsp;runtime.goexit&nbsp;and&nbsp;any&nbsp;runtime&nbsp;functions&nbsp;at&nbsp;the&nbsp;beginning.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4738484">//&nbsp;This&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;for&nbsp;allocation&nbsp;traces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738535">wasPanic</span>&nbsp;<span class="op" id="4738544">=</span>&nbsp;<span class="ident" id="4738546">name</span>&nbsp;<span class="op" id="4738551">==</span>&nbsp;<span class="string" id="4738554">&#34;runtime.panic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4738573">if</span>&nbsp;<span class="ident" id="4738576">name</span>&nbsp;<span class="op" id="4738581">==</span>&nbsp;<span class="string" id="4738584">&#34;runtime.goexit&#34;</span>&nbsp;<span class="op" id="4738601">||</span>&nbsp;<span class="op" id="4738604">!</span><span class="ident" id="4738605">show</span>&nbsp;<span class="op" id="4738610">&amp;&amp;</span>&nbsp;<span class="ident" id="4738613">strings</span><span class="op" id="4738620">.</span><span class="ident" id="4738621">HasPrefix</span><span class="op" id="4738630">(</span><span class="ident" id="4738631">name</span><span class="op" id="4738635">,</span>&nbsp;<span class="string" id="4738637">&#34;runtime.&#34;</span><span class="op" id="4738647">)</span>&nbsp;<span class="op" id="4738649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4738655">continue</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4738667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738672">show</span>&nbsp;<span class="op" id="4738677">=</span>&nbsp;<span class="builtintype" id="4738679">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738687">fmt</span><span class="op" id="4738690">.</span><span class="ident" id="4738691">Fprintf</span><span class="op" id="4738698">(</span><span class="ident" id="4738699">w</span><span class="op" id="4738700">,</span>&nbsp;<span class="string" id="4738702">&#34;#\t%#x\t%s+%#x\t%s:%d\n&#34;</span><span class="op" id="4738727">,</span>&nbsp;<span class="ident" id="4738729">pc</span><span class="op" id="4738731">,</span>&nbsp;<span class="ident" id="4738733">name</span><span class="op" id="4738737">,</span>&nbsp;<span class="ident" id="4738739">pc</span><span class="op" id="4738741">-</span><span class="ident" id="4738742">f</span><span class="op" id="4738743">.</span><span class="ident" id="4738744">Entry</span><span class="op" id="4738749">(</span><span class="op" id="4738750">)</span><span class="op" id="4738751">,</span>&nbsp;<span class="ident" id="4738753">file</span><span class="op" id="4738757">,</span>&nbsp;<span class="ident" id="4738759">line</span><span class="op" id="4738763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4738767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4738770">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4738773">if</span>&nbsp;<span class="op" id="4738776">!</span><span class="ident" id="4738777">show</span>&nbsp;<span class="op" id="4738782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4738786">//&nbsp;We&nbsp;didn&#39;t&nbsp;print&nbsp;anything;&nbsp;do&nbsp;it&nbsp;again,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4738830">//&nbsp;and&nbsp;this&nbsp;time&nbsp;include&nbsp;runtime&nbsp;functions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738876">printStackRecord</span><span class="op" id="4738892">(</span><span class="ident" id="4738893">w</span><span class="op" id="4738894">,</span>&nbsp;<span class="ident" id="4738896">stk</span><span class="op" id="4738899">,</span>&nbsp;<span class="builtintype" id="4738901">true</span><span class="op" id="4738905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4738909">return</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4738917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4738920">fmt</span><span class="op" id="4738923">.</span><span class="ident" id="4738924">Fprintf</span><span class="op" id="4738931">(</span><span class="ident" id="4738932">w</span><span class="op" id="4738933">,</span>&nbsp;<span class="string" id="4738935">&#34;\n&#34;</span><span class="op" id="4738939">)</span><br>
<span class="lineno"></span><span class="op" id="4738941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4738944">//&nbsp;Interface&nbsp;to&nbsp;system&nbsp;profiles.</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="4738978">type</span>&nbsp;<span class="ident" id="4738983">byInUseBytes</span>&nbsp;<span class="op" id="4738996">[</span><span class="op" id="4738997">]</span><span class="ident" id="4738998">runtime</span><span class="op" id="4739005">.</span><span class="ident" id="4739006">MemProfileRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4739024">func</span>&nbsp;<span class="op" id="4739029">(</span><span class="ident" id="4739030">x</span>&nbsp;<span class="ident" id="4739032">byInUseBytes</span><span class="op" id="4739044">)</span>&nbsp;<span class="ident" id="4739046">Len</span><span class="op" id="4739049">(</span><span class="op" id="4739050">)</span>&nbsp;<span class="builtintype" id="4739052">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4739066">{</span>&nbsp;<span class="keyword" id="4739068">return</span>&nbsp;<span class="builtinfunc" id="4739075">len</span><span class="op" id="4739078">(</span><span class="ident" id="4739079">x</span><span class="op" id="4739080">)</span>&nbsp;<span class="op" id="4739082">}</span><br>
<span class="lineno"></span><span class="keyword" id="4739084">func</span>&nbsp;<span class="op" id="4739089">(</span><span class="ident" id="4739090">x</span>&nbsp;<span class="ident" id="4739092">byInUseBytes</span><span class="op" id="4739104">)</span>&nbsp;<span class="ident" id="4739106">Swap</span><span class="op" id="4739110">(</span><span class="ident" id="4739111">i</span><span class="op" id="4739112">,</span>&nbsp;<span class="ident" id="4739114">j</span>&nbsp;<span class="builtintype" id="4739116">int</span><span class="op" id="4739119">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4739126">{</span>&nbsp;<span class="ident" id="4739128">x</span><span class="op" id="4739129">[</span><span class="ident" id="4739130">i</span><span class="op" id="4739131">]</span><span class="op" id="4739132">,</span>&nbsp;<span class="ident" id="4739134">x</span><span class="op" id="4739135">[</span><span class="ident" id="4739136">j</span><span class="op" id="4739137">]</span>&nbsp;<span class="op" id="4739139">=</span>&nbsp;<span class="ident" id="4739141">x</span><span class="op" id="4739142">[</span><span class="ident" id="4739143">j</span><span class="op" id="4739144">]</span><span class="op" id="4739145">,</span>&nbsp;<span class="ident" id="4739147">x</span><span class="op" id="4739148">[</span><span class="ident" id="4739149">i</span><span class="op" id="4739150">]</span>&nbsp;<span class="op" id="4739152">}</span><br>
<span class="lineno">365</span><span class="keyword" id="4739154">func</span>&nbsp;<span class="op" id="4739159">(</span><span class="ident" id="4739160">x</span>&nbsp;<span class="ident" id="4739162">byInUseBytes</span><span class="op" id="4739174">)</span>&nbsp;<span class="ident" id="4739176">Less</span><span class="op" id="4739180">(</span><span class="ident" id="4739181">i</span><span class="op" id="4739182">,</span>&nbsp;<span class="ident" id="4739184">j</span>&nbsp;<span class="builtintype" id="4739186">int</span><span class="op" id="4739189">)</span>&nbsp;<span class="builtintype" id="4739191">bool</span>&nbsp;<span class="op" id="4739196">{</span>&nbsp;<span class="keyword" id="4739198">return</span>&nbsp;<span class="ident" id="4739205">x</span><span class="op" id="4739206">[</span><span class="ident" id="4739207">i</span><span class="op" id="4739208">]</span><span class="op" id="4739209">.</span><span class="ident" id="4739210">InUseBytes</span><span class="op" id="4739220">(</span><span class="op" id="4739221">)</span>&nbsp;<span class="op" id="4739223">&gt;</span>&nbsp;<span class="ident" id="4739225">x</span><span class="op" id="4739226">[</span><span class="ident" id="4739227">j</span><span class="op" id="4739228">]</span><span class="op" id="4739229">.</span><span class="ident" id="4739230">InUseBytes</span><span class="op" id="4739240">(</span><span class="op" id="4739241">)</span>&nbsp;<span class="op" id="4739243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4739246">//&nbsp;WriteHeapProfile&nbsp;is&nbsp;shorthand&nbsp;for&nbsp;Lookup(&#34;heap&#34;).WriteTo(w,&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="4739313">//&nbsp;It&nbsp;is&nbsp;preserved&nbsp;for&nbsp;backwards&nbsp;compatibility.</span><br>
<span class="lineno"></span><span class="keyword" id="4739361">func</span>&nbsp;<span class="ident" id="4739366">WriteHeapProfile</span><span class="op" id="4739382">(</span><span class="ident" id="4739383">w</span>&nbsp;<span class="ident" id="4739385">io</span><span class="op" id="4739387">.</span><span class="ident" id="4739388">Writer</span><span class="op" id="4739394">)</span>&nbsp;<span class="builtintype" id="4739396">error</span>&nbsp;<span class="op" id="4739402">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4739405">return</span>&nbsp;<span class="ident" id="4739412">writeHeap</span><span class="op" id="4739421">(</span><span class="ident" id="4739422">w</span><span class="op" id="4739423">,</span>&nbsp;<span class="num" id="4739425">0</span><span class="op" id="4739426">)</span><br>
<span class="lineno"></span><span class="op" id="4739428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4739431">//&nbsp;countHeap&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;heap&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="4739495">func</span>&nbsp;<span class="ident" id="4739500">countHeap</span><span class="op" id="4739509">(</span><span class="op" id="4739510">)</span>&nbsp;<span class="builtintype" id="4739512">int</span>&nbsp;<span class="op" id="4739516">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4739519">n</span><span class="op" id="4739520">,</span>&nbsp;<span class="ident" id="4739522">_</span>&nbsp;<span class="op" id="4739524">:=</span>&nbsp;<span class="ident" id="4739527">runtime</span><span class="op" id="4739534">.</span><span class="ident" id="4739535">MemProfile</span><span class="op" id="4739545">(</span><span class="builtintype" id="4739546">nil</span><span class="op" id="4739549">,</span>&nbsp;<span class="builtintype" id="4739551">true</span><span class="op" id="4739555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4739558">return</span>&nbsp;<span class="ident" id="4739565">n</span><br>
<span class="lineno"></span><span class="op" id="4739567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4739570">//&nbsp;writeHeap&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;heap&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno">380</span><span class="keyword" id="4739629">func</span>&nbsp;<span class="ident" id="4739634">writeHeap</span><span class="op" id="4739643">(</span><span class="ident" id="4739644">w</span>&nbsp;<span class="ident" id="4739646">io</span><span class="op" id="4739648">.</span><span class="ident" id="4739649">Writer</span><span class="op" id="4739655">,</span>&nbsp;<span class="ident" id="4739657">debug</span>&nbsp;<span class="builtintype" id="4739663">int</span><span class="op" id="4739666">)</span>&nbsp;<span class="builtintype" id="4739668">error</span>&nbsp;<span class="op" id="4739674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4739677">//&nbsp;Find&nbsp;out&nbsp;how&nbsp;many&nbsp;records&nbsp;there&nbsp;are&nbsp;(MemProfile(nil,&nbsp;true)),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4739742">//&nbsp;allocate&nbsp;that&nbsp;many&nbsp;records,&nbsp;and&nbsp;get&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4739792">//&nbsp;There&#39;s&nbsp;a&nbsp;race—more&nbsp;records&nbsp;might&nbsp;be&nbsp;added&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4739849">//&nbsp;the&nbsp;two&nbsp;calls—so&nbsp;allocate&nbsp;a&nbsp;few&nbsp;extra&nbsp;records&nbsp;for&nbsp;safety</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4739912">//&nbsp;and&nbsp;also&nbsp;try&nbsp;again&nbsp;if&nbsp;we&#39;re&nbsp;very&nbsp;unlucky.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4739958">//&nbsp;The&nbsp;loop&nbsp;should&nbsp;only&nbsp;execute&nbsp;one&nbsp;iteration&nbsp;in&nbsp;the&nbsp;common&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4740025">var</span>&nbsp;<span class="ident" id="4740029">p</span>&nbsp;<span class="op" id="4740031">[</span><span class="op" id="4740032">]</span><span class="ident" id="4740033">runtime</span><span class="op" id="4740040">.</span><span class="ident" id="4740041">MemProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740059">n</span><span class="op" id="4740060">,</span>&nbsp;<span class="ident" id="4740062">ok</span>&nbsp;<span class="op" id="4740065">:=</span>&nbsp;<span class="ident" id="4740068">runtime</span><span class="op" id="4740075">.</span><span class="ident" id="4740076">MemProfile</span><span class="op" id="4740086">(</span><span class="builtintype" id="4740087">nil</span><span class="op" id="4740090">,</span>&nbsp;<span class="builtintype" id="4740092">true</span><span class="op" id="4740096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4740099">for</span>&nbsp;<span class="op" id="4740103">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4740107">//&nbsp;Allocate&nbsp;room&nbsp;for&nbsp;a&nbsp;slightly&nbsp;bigger&nbsp;profile,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4740157">//&nbsp;in&nbsp;case&nbsp;a&nbsp;few&nbsp;more&nbsp;entries&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4740205">//&nbsp;since&nbsp;the&nbsp;call&nbsp;to&nbsp;MemProfile.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740240">p</span>&nbsp;<span class="op" id="4740242">=</span>&nbsp;<span class="builtinfunc" id="4740244">make</span><span class="op" id="4740248">(</span><span class="op" id="4740249">[</span><span class="op" id="4740250">]</span><span class="ident" id="4740251">runtime</span><span class="op" id="4740258">.</span><span class="ident" id="4740259">MemProfileRecord</span><span class="op" id="4740275">,</span>&nbsp;<span class="ident" id="4740277">n</span><span class="op" id="4740278">+</span><span class="num" id="4740279">50</span><span class="op" id="4740281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740285">n</span><span class="op" id="4740286">,</span>&nbsp;<span class="ident" id="4740288">ok</span>&nbsp;<span class="op" id="4740291">=</span>&nbsp;<span class="ident" id="4740293">runtime</span><span class="op" id="4740300">.</span><span class="ident" id="4740301">MemProfile</span><span class="op" id="4740311">(</span><span class="ident" id="4740312">p</span><span class="op" id="4740313">,</span>&nbsp;<span class="builtintype" id="4740315">true</span><span class="op" id="4740319">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4740323">if</span>&nbsp;<span class="ident" id="4740326">ok</span>&nbsp;<span class="op" id="4740329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740334">p</span>&nbsp;<span class="op" id="4740336">=</span>&nbsp;<span class="ident" id="4740338">p</span><span class="op" id="4740339">[</span><span class="num" id="4740340">0</span><span class="op" id="4740341">:</span><span class="ident" id="4740342">n</span><span class="op" id="4740343">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4740348">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4740356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4740360">//&nbsp;Profile&nbsp;grew;&nbsp;try&nbsp;again.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4740389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740393">sort</span><span class="op" id="4740397">.</span><span class="ident" id="4740398">Sort</span><span class="op" id="4740402">(</span><span class="ident" id="4740403">byInUseBytes</span><span class="op" id="4740415">(</span><span class="ident" id="4740416">p</span><span class="op" id="4740417">)</span><span class="op" id="4740418">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740422">b</span>&nbsp;<span class="op" id="4740424">:=</span>&nbsp;<span class="ident" id="4740427">bufio</span><span class="op" id="4740432">.</span><span class="ident" id="4740433">NewWriter</span><span class="op" id="4740442">(</span><span class="ident" id="4740443">w</span><span class="op" id="4740444">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4740447">var</span>&nbsp;<span class="ident" id="4740451">tw</span>&nbsp;<span class="op" id="4740454">*</span><span class="ident" id="4740455">tabwriter</span><span class="op" id="4740464">.</span><span class="ident" id="4740465">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740473">w</span>&nbsp;<span class="op" id="4740475">=</span>&nbsp;<span class="ident" id="4740477">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4740480">if</span>&nbsp;<span class="ident" id="4740483">debug</span>&nbsp;<span class="op" id="4740489">&gt;</span>&nbsp;<span class="num" id="4740491">0</span>&nbsp;<span class="op" id="4740493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740497">tw</span>&nbsp;<span class="op" id="4740500">=</span>&nbsp;<span class="ident" id="4740502">tabwriter</span><span class="op" id="4740511">.</span><span class="ident" id="4740512">NewWriter</span><span class="op" id="4740521">(</span><span class="ident" id="4740522">w</span><span class="op" id="4740523">,</span>&nbsp;<span class="num" id="4740525">1</span><span class="op" id="4740526">,</span>&nbsp;<span class="num" id="4740528">8</span><span class="op" id="4740529">,</span>&nbsp;<span class="num" id="4740531">1</span><span class="op" id="4740532">,</span>&nbsp;<span class="string" id="4740534">&#39;\t&#39;</span><span class="op" id="4740538">,</span>&nbsp;<span class="num" id="4740540">0</span><span class="op" id="4740541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740545">w</span>&nbsp;<span class="op" id="4740547">=</span>&nbsp;<span class="ident" id="4740549">tw</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4740553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4740557">var</span>&nbsp;<span class="ident" id="4740561">total</span>&nbsp;<span class="ident" id="4740567">runtime</span><span class="op" id="4740574">.</span><span class="ident" id="4740575">MemProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4740593">for</span>&nbsp;<span class="ident" id="4740597">i</span>&nbsp;<span class="op" id="4740599">:=</span>&nbsp;<span class="keyword" id="4740602">range</span>&nbsp;<span class="ident" id="4740608">p</span>&nbsp;<span class="op" id="4740610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740614">r</span>&nbsp;<span class="op" id="4740616">:=</span>&nbsp;<span class="op" id="4740619">&amp;</span><span class="ident" id="4740620">p</span><span class="op" id="4740621">[</span><span class="ident" id="4740622">i</span><span class="op" id="4740623">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740627">total</span><span class="op" id="4740632">.</span><span class="ident" id="4740633">AllocBytes</span>&nbsp;<span class="op" id="4740644">+=</span>&nbsp;<span class="ident" id="4740647">r</span><span class="op" id="4740648">.</span><span class="ident" id="4740649">AllocBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740662">total</span><span class="op" id="4740667">.</span><span class="ident" id="4740668">AllocObjects</span>&nbsp;<span class="op" id="4740681">+=</span>&nbsp;<span class="ident" id="4740684">r</span><span class="op" id="4740685">.</span><span class="ident" id="4740686">AllocObjects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740701">total</span><span class="op" id="4740706">.</span><span class="ident" id="4740707">FreeBytes</span>&nbsp;<span class="op" id="4740717">+=</span>&nbsp;<span class="ident" id="4740720">r</span><span class="op" id="4740721">.</span><span class="ident" id="4740722">FreeBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740734">total</span><span class="op" id="4740739">.</span><span class="ident" id="4740740">FreeObjects</span>&nbsp;<span class="op" id="4740752">+=</span>&nbsp;<span class="ident" id="4740755">r</span><span class="op" id="4740756">.</span><span class="ident" id="4740757">FreeObjects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4740770">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4740774">//&nbsp;Technically&nbsp;the&nbsp;rate&nbsp;is&nbsp;MemProfileRate&nbsp;not&nbsp;2*MemProfileRate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4740839">//&nbsp;but&nbsp;early&nbsp;versions&nbsp;of&nbsp;the&nbsp;C++&nbsp;heap&nbsp;profiler&nbsp;reported&nbsp;2*MemProfileRate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4740914">//&nbsp;so&nbsp;that&#39;s&nbsp;what&nbsp;pprof&nbsp;has&nbsp;come&nbsp;to&nbsp;expect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4740959">fmt</span><span class="op" id="4740962">.</span><span class="ident" id="4740963">Fprintf</span><span class="op" id="4740970">(</span><span class="ident" id="4740971">w</span><span class="op" id="4740972">,</span>&nbsp;<span class="string" id="4740974">&#34;heap&nbsp;profile:&nbsp;%d:&nbsp;%d&nbsp;[%d:&nbsp;%d]&nbsp;@&nbsp;heap/%d\n&#34;</span><span class="op" id="4741017">,</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741021">total</span><span class="op" id="4741026">.</span><span class="ident" id="4741027">InUseObjects</span><span class="op" id="4741039">(</span><span class="op" id="4741040">)</span><span class="op" id="4741041">,</span>&nbsp;<span class="ident" id="4741043">total</span><span class="op" id="4741048">.</span><span class="ident" id="4741049">InUseBytes</span><span class="op" id="4741059">(</span><span class="op" id="4741060">)</span><span class="op" id="4741061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741065">total</span><span class="op" id="4741070">.</span><span class="ident" id="4741071">AllocObjects</span><span class="op" id="4741083">,</span>&nbsp;<span class="ident" id="4741085">total</span><span class="op" id="4741090">.</span><span class="ident" id="4741091">AllocBytes</span><span class="op" id="4741101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4741105">2</span><span class="op" id="4741106">*</span><span class="ident" id="4741107">runtime</span><span class="op" id="4741114">.</span><span class="ident" id="4741115">MemProfileRate</span><span class="op" id="4741129">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4741133">for</span>&nbsp;<span class="ident" id="4741137">i</span>&nbsp;<span class="op" id="4741139">:=</span>&nbsp;<span class="keyword" id="4741142">range</span>&nbsp;<span class="ident" id="4741148">p</span>&nbsp;<span class="op" id="4741150">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741154">r</span>&nbsp;<span class="op" id="4741156">:=</span>&nbsp;<span class="op" id="4741159">&amp;</span><span class="ident" id="4741160">p</span><span class="op" id="4741161">[</span><span class="ident" id="4741162">i</span><span class="op" id="4741163">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741167">fmt</span><span class="op" id="4741170">.</span><span class="ident" id="4741171">Fprintf</span><span class="op" id="4741178">(</span><span class="ident" id="4741179">w</span><span class="op" id="4741180">,</span>&nbsp;<span class="string" id="4741182">&#34;%d:&nbsp;%d&nbsp;[%d:&nbsp;%d]&nbsp;@&#34;</span><span class="op" id="4741201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741206">r</span><span class="op" id="4741207">.</span><span class="ident" id="4741208">InUseObjects</span><span class="op" id="4741220">(</span><span class="op" id="4741221">)</span><span class="op" id="4741222">,</span>&nbsp;<span class="ident" id="4741224">r</span><span class="op" id="4741225">.</span><span class="ident" id="4741226">InUseBytes</span><span class="op" id="4741236">(</span><span class="op" id="4741237">)</span><span class="op" id="4741238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741243">r</span><span class="op" id="4741244">.</span><span class="ident" id="4741245">AllocObjects</span><span class="op" id="4741257">,</span>&nbsp;<span class="ident" id="4741259">r</span><span class="op" id="4741260">.</span><span class="ident" id="4741261">AllocBytes</span><span class="op" id="4741271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4741275">for</span>&nbsp;<span class="ident" id="4741279">_</span><span class="op" id="4741280">,</span>&nbsp;<span class="ident" id="4741282">pc</span>&nbsp;<span class="op" id="4741285">:=</span>&nbsp;<span class="keyword" id="4741288">range</span>&nbsp;<span class="ident" id="4741294">r</span><span class="op" id="4741295">.</span><span class="ident" id="4741296">Stack</span><span class="op" id="4741301">(</span><span class="op" id="4741302">)</span>&nbsp;<span class="op" id="4741304">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741309">fmt</span><span class="op" id="4741312">.</span><span class="ident" id="4741313">Fprintf</span><span class="op" id="4741320">(</span><span class="ident" id="4741321">w</span><span class="op" id="4741322">,</span>&nbsp;<span class="string" id="4741324">&#34;&nbsp;%#x&#34;</span><span class="op" id="4741330">,</span>&nbsp;<span class="ident" id="4741332">pc</span><span class="op" id="4741334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4741338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741342">fmt</span><span class="op" id="4741345">.</span><span class="ident" id="4741346">Fprintf</span><span class="op" id="4741353">(</span><span class="ident" id="4741354">w</span><span class="op" id="4741355">,</span>&nbsp;<span class="string" id="4741357">&#34;\n&#34;</span><span class="op" id="4741361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4741365">if</span>&nbsp;<span class="ident" id="4741368">debug</span>&nbsp;<span class="op" id="4741374">&gt;</span>&nbsp;<span class="num" id="4741376">0</span>&nbsp;<span class="op" id="4741378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741383">printStackRecord</span><span class="op" id="4741399">(</span><span class="ident" id="4741400">w</span><span class="op" id="4741401">,</span>&nbsp;<span class="ident" id="4741403">r</span><span class="op" id="4741404">.</span><span class="ident" id="4741405">Stack</span><span class="op" id="4741410">(</span><span class="op" id="4741411">)</span><span class="op" id="4741412">,</span>&nbsp;<span class="builtintype" id="4741414">false</span><span class="op" id="4741419">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4741423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4741426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4741430">//&nbsp;Print&nbsp;memstats&nbsp;information&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4741466">//&nbsp;Pprof&nbsp;will&nbsp;ignore,&nbsp;but&nbsp;useful&nbsp;for&nbsp;people</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4741511">if</span>&nbsp;<span class="ident" id="4741514">debug</span>&nbsp;<span class="op" id="4741520">&gt;</span>&nbsp;<span class="num" id="4741522">0</span>&nbsp;<span class="op" id="4741524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741528">s</span>&nbsp;<span class="op" id="4741530">:=</span>&nbsp;<span class="builtinfunc" id="4741533">new</span><span class="op" id="4741536">(</span><span class="ident" id="4741537">runtime</span><span class="op" id="4741544">.</span><span class="ident" id="4741545">MemStats</span><span class="op" id="4741553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741557">runtime</span><span class="op" id="4741564">.</span><span class="ident" id="4741565">ReadMemStats</span><span class="op" id="4741577">(</span><span class="ident" id="4741578">s</span><span class="op" id="4741579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741583">fmt</span><span class="op" id="4741586">.</span><span class="ident" id="4741587">Fprintf</span><span class="op" id="4741594">(</span><span class="ident" id="4741595">w</span><span class="op" id="4741596">,</span>&nbsp;<span class="string" id="4741598">&#34;\n#&nbsp;runtime.MemStats\n&#34;</span><span class="op" id="4741622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741626">fmt</span><span class="op" id="4741629">.</span><span class="ident" id="4741630">Fprintf</span><span class="op" id="4741637">(</span><span class="ident" id="4741638">w</span><span class="op" id="4741639">,</span>&nbsp;<span class="string" id="4741641">&#34;#&nbsp;Alloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4741657">,</span>&nbsp;<span class="ident" id="4741659">s</span><span class="op" id="4741660">.</span><span class="ident" id="4741661">Alloc</span><span class="op" id="4741666">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741670">fmt</span><span class="op" id="4741673">.</span><span class="ident" id="4741674">Fprintf</span><span class="op" id="4741681">(</span><span class="ident" id="4741682">w</span><span class="op" id="4741683">,</span>&nbsp;<span class="string" id="4741685">&#34;#&nbsp;TotalAlloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4741706">,</span>&nbsp;<span class="ident" id="4741708">s</span><span class="op" id="4741709">.</span><span class="ident" id="4741710">TotalAlloc</span><span class="op" id="4741720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741724">fmt</span><span class="op" id="4741727">.</span><span class="ident" id="4741728">Fprintf</span><span class="op" id="4741735">(</span><span class="ident" id="4741736">w</span><span class="op" id="4741737">,</span>&nbsp;<span class="string" id="4741739">&#34;#&nbsp;Sys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4741753">,</span>&nbsp;<span class="ident" id="4741755">s</span><span class="op" id="4741756">.</span><span class="ident" id="4741757">Sys</span><span class="op" id="4741760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741764">fmt</span><span class="op" id="4741767">.</span><span class="ident" id="4741768">Fprintf</span><span class="op" id="4741775">(</span><span class="ident" id="4741776">w</span><span class="op" id="4741777">,</span>&nbsp;<span class="string" id="4741779">&#34;#&nbsp;Lookups&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4741797">,</span>&nbsp;<span class="ident" id="4741799">s</span><span class="op" id="4741800">.</span><span class="ident" id="4741801">Lookups</span><span class="op" id="4741808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741812">fmt</span><span class="op" id="4741815">.</span><span class="ident" id="4741816">Fprintf</span><span class="op" id="4741823">(</span><span class="ident" id="4741824">w</span><span class="op" id="4741825">,</span>&nbsp;<span class="string" id="4741827">&#34;#&nbsp;Mallocs&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4741845">,</span>&nbsp;<span class="ident" id="4741847">s</span><span class="op" id="4741848">.</span><span class="ident" id="4741849">Mallocs</span><span class="op" id="4741856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741860">fmt</span><span class="op" id="4741863">.</span><span class="ident" id="4741864">Fprintf</span><span class="op" id="4741871">(</span><span class="ident" id="4741872">w</span><span class="op" id="4741873">,</span>&nbsp;<span class="string" id="4741875">&#34;#&nbsp;Frees&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4741891">,</span>&nbsp;<span class="ident" id="4741893">s</span><span class="op" id="4741894">.</span><span class="ident" id="4741895">Frees</span><span class="op" id="4741900">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741905">fmt</span><span class="op" id="4741908">.</span><span class="ident" id="4741909">Fprintf</span><span class="op" id="4741916">(</span><span class="ident" id="4741917">w</span><span class="op" id="4741918">,</span>&nbsp;<span class="string" id="4741920">&#34;#&nbsp;HeapAlloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4741940">,</span>&nbsp;<span class="ident" id="4741942">s</span><span class="op" id="4741943">.</span><span class="ident" id="4741944">HeapAlloc</span><span class="op" id="4741953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4741957">fmt</span><span class="op" id="4741960">.</span><span class="ident" id="4741961">Fprintf</span><span class="op" id="4741968">(</span><span class="ident" id="4741969">w</span><span class="op" id="4741970">,</span>&nbsp;<span class="string" id="4741972">&#34;#&nbsp;HeapSys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4741990">,</span>&nbsp;<span class="ident" id="4741992">s</span><span class="op" id="4741993">.</span><span class="ident" id="4741994">HeapSys</span><span class="op" id="4742001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4742005">fmt</span><span class="op" id="4742008">.</span><span class="ident" id="4742009">Fprintf</span><span class="op" id="4742016">(</span><span class="ident" id="4742017">w</span><span class="op" id="4742018">,</span>&nbsp;<span class="string" id="4742020">&#34;#&nbsp;HeapIdle&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4742039">,</span>&nbsp;<span class="ident" id="4742041">s</span><span class="op" id="4742042">.</span><span class="ident" id="4742043">HeapIdle</span><span class="op" id="4742051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4742055">fmt</span><span class="op" id="4742058">.</span><span class="ident" id="4742059">Fprintf</span><span class="op" id="4742066">(</span><span class="ident" id="4742067">w</span><span class="op" id="4742068">,</span>&nbsp;<span class="string" id="4742070">&#34;#&nbsp;HeapInuse&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4742090">,</span>&nbsp;<span class="ident" id="4742092">s</span><span class="op" id="4742093">.</span><span class="ident" id="4742094">HeapInuse</span><span class="op" id="4742103">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4742107">fmt</span><span class="op" id="4742110">.</span><span class="ident" id="4742111">Fprintf</span><span class="op" id="4742118">(</span><span class="ident" id="4742119">w</span><span class="op" id="4742120">,</span>&nbsp;<span class="string" id="4742122">&#34;#&nbsp;HeapReleased&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4742145">,</span>&nbsp;<span class="ident" id="4742147">s</span><span class="op" id="4742148">.</span><span class="ident" id="4742149">HeapReleased</span><span class="op" id="4742161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4742165">fmt</span><span class="op" id="4742168">.</span><span class="ident" id="4742169">Fprintf</span><span class="op" id="4742176">(</span><span class="ident" id="4742177">w</span><span class="op" id="4742178">,</span>&nbsp;<span class="string" id="4742180">&#34;#&nbsp;HeapObjects&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4742202">,</span>&nbsp;<span class="ident" id="4742204">s</span><span class="op" id="4742205">.</span><span class="ident" id="4742206">HeapObjects</span><span class="op" id="4742217">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4742222">fmt</span><span class="op" id="4742225">.</span><span class="ident" id="4742226">Fprintf</span><span class="op" id="4742233">(</span><span class="ident" id="4742234">w</span><span class="op" id="4742235">,</span>&nbsp;<span class="string" id="4742237">&#34;#&nbsp;Stack&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="4742258">,</span>&nbsp;<span class="ident" id="4742260">s</span><span class="op" id="4742261">.</span><span class="ident" id="4742262">StackInuse</span><span class="op" id="4742272">,</span>&nbsp;<span class="ident" id="4742274">s</span><span class="op" id="4742275">.</span><span class="ident" id="4742276">StackSys</span><span class="op" id="4742284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4742288">fmt</span><span class="op" id="4742291">.</span><span class="ident" id="4742292">Fprintf</span><span class="op" id="4742299">(</span><span class="ident" id="4742300">w</span><span class="op" id="4742301">,</span>&nbsp;<span class="string" id="4742303">&#34;#&nbsp;MSpan&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="4742324">,</span>&nbsp;<span class="ident" id="4742326">s</span><span class="op" id="4742327">.</span><span class="ident" id="4742328">MSpanInuse</span><span class="op" id="4742338">,</span>&nbsp;<span class="ident" id="4742340">s</span><span class="op" id="4742341">.</span><span class="ident" id="4742342">MSpanSys</span><span class="op" id="4742350">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4742354">fmt</span><span class="op" id="4742357">.</span><span class="ident" id="4742358">Fprintf</span><span class="op" id="4742365">(</span><span class="ident" id="4742366">w</span><span class="op" id="4742367">,</span>&nbsp;<span class="string" id="4742369">&#34;#&nbsp;MCache&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="4742391">,</span>&nbsp;<span class="ident" id="4742393">s</span><span class="op" id="4742394">.</span><span class="ident" id="4742395">MCacheInuse</span><span class="op" id="4742406">,</span>&nbsp;<span class="ident" id="4742408">s</span><span class="op" id="4742409">.</span><span class="ident" id="4742410">MCacheSys</span><span class="op" id="4742419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4742423">fmt</span><span class="op" id="4742426">.</span><span class="ident" id="4742427">Fprintf</span><span class="op" id="4742434">(</span><span class="ident" id="4742435">w</span><span class="op" id="4742436">,</span>&nbsp;<span class="string" id="4742438">&#34;#&nbsp;BuckHashSys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4742460">,</span>&nbsp;<span class="ident" id="4742462">s</span><span class="op" id="4742463">.</span><span class="ident" id="4742464">BuckHashSys</span><span class="op" id="4742475">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4742480">fmt</span><span class="op" id="4742483">.</span><span class="ident" id="4742484">Fprintf</span><span class="op" id="4742491">(</span><span class="ident" id="4742492">w</span><span class="op" id="4742493">,</span>&nbsp;<span class="string" id="4742495">&#34;#&nbsp;NextGC&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4742512">,</span>&nbsp;<span class="ident" id="4742514">s</span><span class="op" id="4742515">.</span><span class="ident" id="4742516">NextGC</span><span class="op" id="4742522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4742526">fmt</span><span class="op" id="4742529">.</span><span class="ident" id="4742530">Fprintf</span><span class="op" id="4742537">(</span><span class="ident" id="4742538">w</span><span class="op" id="4742539">,</span>&nbsp;<span class="string" id="4742541">&#34;#&nbsp;PauseNs&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4742559">,</span>&nbsp;<span class="ident" id="4742561">s</span><span class="op" id="4742562">.</span><span class="ident" id="4742563">PauseNs</span><span class="op" id="4742570">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4742574">fmt</span><span class="op" id="4742577">.</span><span class="ident" id="4742578">Fprintf</span><span class="op" id="4742585">(</span><span class="ident" id="4742586">w</span><span class="op" id="4742587">,</span>&nbsp;<span class="string" id="4742589">&#34;#&nbsp;NumGC&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4742605">,</span>&nbsp;<span class="ident" id="4742607">s</span><span class="op" id="4742608">.</span><span class="ident" id="4742609">NumGC</span><span class="op" id="4742614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4742618">fmt</span><span class="op" id="4742621">.</span><span class="ident" id="4742622">Fprintf</span><span class="op" id="4742629">(</span><span class="ident" id="4742630">w</span><span class="op" id="4742631">,</span>&nbsp;<span class="string" id="4742633">&#34;#&nbsp;EnableGC&nbsp;=&nbsp;%v\n&#34;</span><span class="op" id="4742652">,</span>&nbsp;<span class="ident" id="4742654">s</span><span class="op" id="4742655">.</span><span class="ident" id="4742656">EnableGC</span><span class="op" id="4742664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4742668">fmt</span><span class="op" id="4742671">.</span><span class="ident" id="4742672">Fprintf</span><span class="op" id="4742679">(</span><span class="ident" id="4742680">w</span><span class="op" id="4742681">,</span>&nbsp;<span class="string" id="4742683">&#34;#&nbsp;DebugGC&nbsp;=&nbsp;%v\n&#34;</span><span class="op" id="4742701">,</span>&nbsp;<span class="ident" id="4742703">s</span><span class="op" id="4742704">.</span><span class="ident" id="4742705">DebugGC</span><span class="op" id="4742712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4742715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4742719">if</span>&nbsp;<span class="ident" id="4742722">tw</span>&nbsp;<span class="op" id="4742725">!=</span>&nbsp;<span class="builtintype" id="4742728">nil</span>&nbsp;<span class="op" id="4742732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4742736">tw</span><span class="op" id="4742738">.</span><span class="ident" id="4742739">Flush</span><span class="op" id="4742744">(</span><span class="op" id="4742745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4742748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4742751">return</span>&nbsp;<span class="ident" id="4742758">b</span><span class="op" id="4742759">.</span><span class="ident" id="4742760">Flush</span><span class="op" id="4742765">(</span><span class="op" id="4742766">)</span><br>
<span class="lineno"></span><span class="op" id="4742768">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="4742771">//&nbsp;countThreadCreate&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;current&nbsp;ThreadCreateProfile.</span><br>
<span class="lineno"></span><span class="keyword" id="4742845">func</span>&nbsp;<span class="ident" id="4742850">countThreadCreate</span><span class="op" id="4742867">(</span><span class="op" id="4742868">)</span>&nbsp;<span class="builtintype" id="4742870">int</span>&nbsp;<span class="op" id="4742874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4742877">n</span><span class="op" id="4742878">,</span>&nbsp;<span class="ident" id="4742880">_</span>&nbsp;<span class="op" id="4742882">:=</span>&nbsp;<span class="ident" id="4742885">runtime</span><span class="op" id="4742892">.</span><span class="ident" id="4742893">ThreadCreateProfile</span><span class="op" id="4742912">(</span><span class="builtintype" id="4742913">nil</span><span class="op" id="4742916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4742919">return</span>&nbsp;<span class="ident" id="4742926">n</span><br>
<span class="lineno">485</span><span class="op" id="4742928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4742931">//&nbsp;writeThreadCreate&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;ThreadCreateProfile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4743005">func</span>&nbsp;<span class="ident" id="4743010">writeThreadCreate</span><span class="op" id="4743027">(</span><span class="ident" id="4743028">w</span>&nbsp;<span class="ident" id="4743030">io</span><span class="op" id="4743032">.</span><span class="ident" id="4743033">Writer</span><span class="op" id="4743039">,</span>&nbsp;<span class="ident" id="4743041">debug</span>&nbsp;<span class="builtintype" id="4743047">int</span><span class="op" id="4743050">)</span>&nbsp;<span class="builtintype" id="4743052">error</span>&nbsp;<span class="op" id="4743058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4743061">return</span>&nbsp;<span class="ident" id="4743068">writeRuntimeProfile</span><span class="op" id="4743087">(</span><span class="ident" id="4743088">w</span><span class="op" id="4743089">,</span>&nbsp;<span class="ident" id="4743091">debug</span><span class="op" id="4743096">,</span>&nbsp;<span class="string" id="4743098">&#34;threadcreate&#34;</span><span class="op" id="4743112">,</span>&nbsp;<span class="ident" id="4743114">runtime</span><span class="op" id="4743121">.</span><span class="ident" id="4743122">ThreadCreateProfile</span><span class="op" id="4743141">)</span><br>
<span class="lineno">490</span><span class="op" id="4743143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4743146">//&nbsp;countGoroutine&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="4743198">func</span>&nbsp;<span class="ident" id="4743203">countGoroutine</span><span class="op" id="4743217">(</span><span class="op" id="4743218">)</span>&nbsp;<span class="builtintype" id="4743220">int</span>&nbsp;<span class="op" id="4743224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4743227">return</span>&nbsp;<span class="ident" id="4743234">runtime</span><span class="op" id="4743241">.</span><span class="ident" id="4743242">NumGoroutine</span><span class="op" id="4743254">(</span><span class="op" id="4743255">)</span><br>
<span class="lineno">495</span><span class="op" id="4743257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4743260">//&nbsp;writeGoroutine&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;GoroutineProfile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4743328">func</span>&nbsp;<span class="ident" id="4743333">writeGoroutine</span><span class="op" id="4743347">(</span><span class="ident" id="4743348">w</span>&nbsp;<span class="ident" id="4743350">io</span><span class="op" id="4743352">.</span><span class="ident" id="4743353">Writer</span><span class="op" id="4743359">,</span>&nbsp;<span class="ident" id="4743361">debug</span>&nbsp;<span class="builtintype" id="4743367">int</span><span class="op" id="4743370">)</span>&nbsp;<span class="builtintype" id="4743372">error</span>&nbsp;<span class="op" id="4743378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4743381">if</span>&nbsp;<span class="ident" id="4743384">debug</span>&nbsp;<span class="op" id="4743390">&gt;=</span>&nbsp;<span class="num" id="4743393">2</span>&nbsp;<span class="op" id="4743395">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4743399">return</span>&nbsp;<span class="ident" id="4743406">writeGoroutineStacks</span><span class="op" id="4743426">(</span><span class="ident" id="4743427">w</span><span class="op" id="4743428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4743431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4743434">return</span>&nbsp;<span class="ident" id="4743441">writeRuntimeProfile</span><span class="op" id="4743460">(</span><span class="ident" id="4743461">w</span><span class="op" id="4743462">,</span>&nbsp;<span class="ident" id="4743464">debug</span><span class="op" id="4743469">,</span>&nbsp;<span class="string" id="4743471">&#34;goroutine&#34;</span><span class="op" id="4743482">,</span>&nbsp;<span class="ident" id="4743484">runtime</span><span class="op" id="4743491">.</span><span class="ident" id="4743492">GoroutineProfile</span><span class="op" id="4743508">)</span><br>
<span class="lineno"></span><span class="op" id="4743510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="4743513">func</span>&nbsp;<span class="ident" id="4743518">writeGoroutineStacks</span><span class="op" id="4743538">(</span><span class="ident" id="4743539">w</span>&nbsp;<span class="ident" id="4743541">io</span><span class="op" id="4743543">.</span><span class="ident" id="4743544">Writer</span><span class="op" id="4743550">)</span>&nbsp;<span class="builtintype" id="4743552">error</span>&nbsp;<span class="op" id="4743558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4743561">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;big&nbsp;the&nbsp;buffer&nbsp;needs&nbsp;to&nbsp;be&nbsp;to&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4743621">//&nbsp;all&nbsp;the&nbsp;goroutines.&nbsp;&nbsp;Start&nbsp;with&nbsp;1&nbsp;MB&nbsp;and&nbsp;try&nbsp;a&nbsp;few&nbsp;times,&nbsp;doubling&nbsp;each&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4743703">//&nbsp;Give&nbsp;up&nbsp;and&nbsp;use&nbsp;a&nbsp;truncated&nbsp;trace&nbsp;if&nbsp;64&nbsp;MB&nbsp;is&nbsp;not&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4743765">buf</span>&nbsp;<span class="op" id="4743769">:=</span>&nbsp;<span class="builtinfunc" id="4743772">make</span><span class="op" id="4743776">(</span><span class="op" id="4743777">[</span><span class="op" id="4743778">]</span><span class="builtintype" id="4743779">byte</span><span class="op" id="4743783">,</span>&nbsp;<span class="num" id="4743785">1</span><span class="op" id="4743786">&lt;&lt;</span><span class="num" id="4743788">20</span><span class="op" id="4743790">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4743793">for</span>&nbsp;<span class="ident" id="4743797">i</span>&nbsp;<span class="op" id="4743799">:=</span>&nbsp;<span class="num" id="4743802">0</span><span class="op" id="4743803">;</span>&nbsp;<span class="op" id="4743805">;</span>&nbsp;<span class="ident" id="4743807">i</span><span class="op" id="4743808">++</span>&nbsp;<span class="op" id="4743811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4743815">n</span>&nbsp;<span class="op" id="4743817">:=</span>&nbsp;<span class="ident" id="4743820">runtime</span><span class="op" id="4743827">.</span><span class="ident" id="4743828">Stack</span><span class="op" id="4743833">(</span><span class="ident" id="4743834">buf</span><span class="op" id="4743837">,</span>&nbsp;<span class="builtintype" id="4743839">true</span><span class="op" id="4743843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4743847">if</span>&nbsp;<span class="ident" id="4743850">n</span>&nbsp;<span class="op" id="4743852">&lt;</span>&nbsp;<span class="builtinfunc" id="4743854">len</span><span class="op" id="4743857">(</span><span class="ident" id="4743858">buf</span><span class="op" id="4743861">)</span>&nbsp;<span class="op" id="4743863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4743868">buf</span>&nbsp;<span class="op" id="4743872">=</span>&nbsp;<span class="ident" id="4743874">buf</span><span class="op" id="4743877">[</span><span class="op" id="4743878">:</span><span class="ident" id="4743879">n</span><span class="op" id="4743880">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4743885">break</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4743893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4743897">if</span>&nbsp;<span class="builtinfunc" id="4743900">len</span><span class="op" id="4743903">(</span><span class="ident" id="4743904">buf</span><span class="op" id="4743907">)</span>&nbsp;<span class="op" id="4743909">&gt;=</span>&nbsp;<span class="num" id="4743912">64</span><span class="op" id="4743914">&lt;&lt;</span><span class="num" id="4743916">20</span>&nbsp;<span class="op" id="4743919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4743924">//&nbsp;Filled&nbsp;64&nbsp;MB&nbsp;-&nbsp;stop&nbsp;there.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4743957">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4743965">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4743969">buf</span>&nbsp;<span class="op" id="4743973">=</span>&nbsp;<span class="builtinfunc" id="4743975">make</span><span class="op" id="4743979">(</span><span class="op" id="4743980">[</span><span class="op" id="4743981">]</span><span class="builtintype" id="4743982">byte</span><span class="op" id="4743986">,</span>&nbsp;<span class="num" id="4743988">2</span><span class="op" id="4743989">*</span><span class="builtinfunc" id="4743990">len</span><span class="op" id="4743993">(</span><span class="ident" id="4743994">buf</span><span class="op" id="4743997">)</span><span class="op" id="4743998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4744001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4744004">_</span><span class="op" id="4744005">,</span>&nbsp;<span class="ident" id="4744007">err</span>&nbsp;<span class="op" id="4744011">:=</span>&nbsp;<span class="ident" id="4744014">w</span><span class="op" id="4744015">.</span><span class="ident" id="4744016">Write</span><span class="op" id="4744021">(</span><span class="ident" id="4744022">buf</span><span class="op" id="4744025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4744028">return</span>&nbsp;<span class="ident" id="4744035">err</span><br>
<span class="lineno"></span><span class="op" id="4744039">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span><span class="keyword" id="4744042">func</span>&nbsp;<span class="ident" id="4744047">writeRuntimeProfile</span><span class="op" id="4744066">(</span><span class="ident" id="4744067">w</span>&nbsp;<span class="ident" id="4744069">io</span><span class="op" id="4744071">.</span><span class="ident" id="4744072">Writer</span><span class="op" id="4744078">,</span>&nbsp;<span class="ident" id="4744080">debug</span>&nbsp;<span class="builtintype" id="4744086">int</span><span class="op" id="4744089">,</span>&nbsp;<span class="ident" id="4744091">name</span>&nbsp;<span class="builtintype" id="4744096">string</span><span class="op" id="4744102">,</span>&nbsp;<span class="ident" id="4744104">fetch</span>&nbsp;<span class="keyword" id="4744110">func</span><span class="op" id="4744114">(</span><span class="op" id="4744115">[</span><span class="op" id="4744116">]</span><span class="ident" id="4744117">runtime</span><span class="op" id="4744124">.</span><span class="ident" id="4744125">StackRecord</span><span class="op" id="4744136">)</span>&nbsp;<span class="op" id="4744138">(</span><span class="builtintype" id="4744139">int</span><span class="op" id="4744142">,</span>&nbsp;<span class="builtintype" id="4744144">bool</span><span class="op" id="4744148">)</span><span class="op" id="4744149">)</span>&nbsp;<span class="builtintype" id="4744151">error</span>&nbsp;<span class="op" id="4744157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4744160">//&nbsp;Find&nbsp;out&nbsp;how&nbsp;many&nbsp;records&nbsp;there&nbsp;are&nbsp;(fetch(nil)),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4744214">//&nbsp;allocate&nbsp;that&nbsp;many&nbsp;records,&nbsp;and&nbsp;get&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4744264">//&nbsp;There&#39;s&nbsp;a&nbsp;race—more&nbsp;records&nbsp;might&nbsp;be&nbsp;added&nbsp;between</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4744321">//&nbsp;the&nbsp;two&nbsp;calls—so&nbsp;allocate&nbsp;a&nbsp;few&nbsp;extra&nbsp;records&nbsp;for&nbsp;safety</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4744384">//&nbsp;and&nbsp;also&nbsp;try&nbsp;again&nbsp;if&nbsp;we&#39;re&nbsp;very&nbsp;unlucky.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4744430">//&nbsp;The&nbsp;loop&nbsp;should&nbsp;only&nbsp;execute&nbsp;one&nbsp;iteration&nbsp;in&nbsp;the&nbsp;common&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4744497">var</span>&nbsp;<span class="ident" id="4744501">p</span>&nbsp;<span class="op" id="4744503">[</span><span class="op" id="4744504">]</span><span class="ident" id="4744505">runtime</span><span class="op" id="4744512">.</span><span class="ident" id="4744513">StackRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4744526">n</span><span class="op" id="4744527">,</span>&nbsp;<span class="ident" id="4744529">ok</span>&nbsp;<span class="op" id="4744532">:=</span>&nbsp;<span class="ident" id="4744535">fetch</span><span class="op" id="4744540">(</span><span class="builtintype" id="4744541">nil</span><span class="op" id="4744544">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4744547">for</span>&nbsp;<span class="op" id="4744551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4744555">//&nbsp;Allocate&nbsp;room&nbsp;for&nbsp;a&nbsp;slightly&nbsp;bigger&nbsp;profile,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4744605">//&nbsp;in&nbsp;case&nbsp;a&nbsp;few&nbsp;more&nbsp;entries&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4744653">//&nbsp;since&nbsp;the&nbsp;call&nbsp;to&nbsp;ThreadProfile.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4744691">p</span>&nbsp;<span class="op" id="4744693">=</span>&nbsp;<span class="builtinfunc" id="4744695">make</span><span class="op" id="4744699">(</span><span class="op" id="4744700">[</span><span class="op" id="4744701">]</span><span class="ident" id="4744702">runtime</span><span class="op" id="4744709">.</span><span class="ident" id="4744710">StackRecord</span><span class="op" id="4744721">,</span>&nbsp;<span class="ident" id="4744723">n</span><span class="op" id="4744724">+</span><span class="num" id="4744725">10</span><span class="op" id="4744727">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4744731">n</span><span class="op" id="4744732">,</span>&nbsp;<span class="ident" id="4744734">ok</span>&nbsp;<span class="op" id="4744737">=</span>&nbsp;<span class="ident" id="4744739">fetch</span><span class="op" id="4744744">(</span><span class="ident" id="4744745">p</span><span class="op" id="4744746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4744750">if</span>&nbsp;<span class="ident" id="4744753">ok</span>&nbsp;<span class="op" id="4744756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4744761">p</span>&nbsp;<span class="op" id="4744763">=</span>&nbsp;<span class="ident" id="4744765">p</span><span class="op" id="4744766">[</span><span class="num" id="4744767">0</span><span class="op" id="4744768">:</span><span class="ident" id="4744769">n</span><span class="op" id="4744770">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4744775">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4744783">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4744787">//&nbsp;Profile&nbsp;grew;&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4744816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4744820">return</span>&nbsp;<span class="ident" id="4744827">printCountProfile</span><span class="op" id="4744844">(</span><span class="ident" id="4744845">w</span><span class="op" id="4744846">,</span>&nbsp;<span class="ident" id="4744848">debug</span><span class="op" id="4744853">,</span>&nbsp;<span class="ident" id="4744855">name</span><span class="op" id="4744859">,</span>&nbsp;<span class="ident" id="4744861">runtimeProfile</span><span class="op" id="4744875">(</span><span class="ident" id="4744876">p</span><span class="op" id="4744877">)</span><span class="op" id="4744878">)</span><br>
<span class="lineno"></span><span class="op" id="4744880">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="keyword" id="4744883">type</span>&nbsp;<span class="ident" id="4744888">runtimeProfile</span>&nbsp;<span class="op" id="4744903">[</span><span class="op" id="4744904">]</span><span class="ident" id="4744905">runtime</span><span class="op" id="4744912">.</span><span class="ident" id="4744913">StackRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4744926">func</span>&nbsp;<span class="op" id="4744931">(</span><span class="ident" id="4744932">p</span>&nbsp;<span class="ident" id="4744934">runtimeProfile</span><span class="op" id="4744948">)</span>&nbsp;<span class="ident" id="4744950">Len</span><span class="op" id="4744953">(</span><span class="op" id="4744954">)</span>&nbsp;<span class="builtintype" id="4744956">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4744973">{</span>&nbsp;<span class="keyword" id="4744975">return</span>&nbsp;<span class="builtinfunc" id="4744982">len</span><span class="op" id="4744985">(</span><span class="ident" id="4744986">p</span><span class="op" id="4744987">)</span>&nbsp;<span class="op" id="4744989">}</span><br>
<span class="lineno"></span><span class="keyword" id="4744991">func</span>&nbsp;<span class="op" id="4744996">(</span><span class="ident" id="4744997">p</span>&nbsp;<span class="ident" id="4744999">runtimeProfile</span><span class="op" id="4745013">)</span>&nbsp;<span class="ident" id="4745015">Stack</span><span class="op" id="4745020">(</span><span class="ident" id="4745021">i</span>&nbsp;<span class="builtintype" id="4745023">int</span><span class="op" id="4745026">)</span>&nbsp;<span class="op" id="4745028">[</span><span class="op" id="4745029">]</span><span class="builtintype" id="4745030">uintptr</span>&nbsp;<span class="op" id="4745038">{</span>&nbsp;<span class="keyword" id="4745040">return</span>&nbsp;<span class="ident" id="4745047">p</span><span class="op" id="4745048">[</span><span class="ident" id="4745049">i</span><span class="op" id="4745050">]</span><span class="op" id="4745051">.</span><span class="ident" id="4745052">Stack</span><span class="op" id="4745057">(</span><span class="op" id="4745058">)</span>&nbsp;<span class="op" id="4745060">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="4745063">var</span>&nbsp;<span class="ident" id="4745067">cpu</span>&nbsp;<span class="keyword" id="4745071">struct</span>&nbsp;<span class="op" id="4745078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4745081">sync</span><span class="op" id="4745085">.</span><span class="ident" id="4745086">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4745093">profiling</span>&nbsp;<span class="builtintype" id="4745103">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4745109">done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4745119">chan</span>&nbsp;<span class="builtintype" id="4745124">bool</span><br>
<span class="lineno">560</span><span class="op" id="4745129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4745132">//&nbsp;StartCPUProfile&nbsp;enables&nbsp;CPU&nbsp;profiling&nbsp;for&nbsp;the&nbsp;current&nbsp;process.</span><br>
<span class="lineno"></span><span class="comment" id="4745198">//&nbsp;While&nbsp;profiling,&nbsp;the&nbsp;profile&nbsp;will&nbsp;be&nbsp;buffered&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4745265">//&nbsp;StartCPUProfile&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;profiling&nbsp;is&nbsp;already&nbsp;enabled.</span><br>
<span class="lineno">565</span><span class="keyword" id="4745334">func</span>&nbsp;<span class="ident" id="4745339">StartCPUProfile</span><span class="op" id="4745354">(</span><span class="ident" id="4745355">w</span>&nbsp;<span class="ident" id="4745357">io</span><span class="op" id="4745359">.</span><span class="ident" id="4745360">Writer</span><span class="op" id="4745366">)</span>&nbsp;<span class="builtintype" id="4745368">error</span>&nbsp;<span class="op" id="4745374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4745377">//&nbsp;The&nbsp;runtime&nbsp;routines&nbsp;allow&nbsp;a&nbsp;variable&nbsp;profiling&nbsp;rate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4745435">//&nbsp;but&nbsp;in&nbsp;practice&nbsp;operating&nbsp;systems&nbsp;cannot&nbsp;trigger&nbsp;signals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4745496">//&nbsp;at&nbsp;more&nbsp;than&nbsp;about&nbsp;500&nbsp;Hz,&nbsp;and&nbsp;our&nbsp;processing&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4745553">//&nbsp;signal&nbsp;is&nbsp;not&nbsp;cheap&nbsp;(mostly&nbsp;getting&nbsp;the&nbsp;stack&nbsp;trace).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4745611">//&nbsp;100&nbsp;Hz&nbsp;is&nbsp;a&nbsp;reasonable&nbsp;choice:&nbsp;it&nbsp;is&nbsp;frequent&nbsp;enough&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4745671">//&nbsp;produce&nbsp;useful&nbsp;data,&nbsp;rare&nbsp;enough&nbsp;not&nbsp;to&nbsp;bog&nbsp;down&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4745728">//&nbsp;system,&nbsp;and&nbsp;a&nbsp;nice&nbsp;round&nbsp;number&nbsp;to&nbsp;make&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4745783">//&nbsp;convert&nbsp;sample&nbsp;counts&nbsp;to&nbsp;seconds.&nbsp;&nbsp;Instead&nbsp;of&nbsp;requiring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4745843">//&nbsp;each&nbsp;client&nbsp;to&nbsp;specify&nbsp;the&nbsp;frequency,&nbsp;we&nbsp;hard&nbsp;code&nbsp;it.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4745902">const</span>&nbsp;<span class="ident" id="4745908">hz</span>&nbsp;<span class="op" id="4745911">=</span>&nbsp;<span class="num" id="4745913">100</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4745919">cpu</span><span class="op" id="4745922">.</span><span class="ident" id="4745923">Lock</span><span class="op" id="4745927">(</span><span class="op" id="4745928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4745931">defer</span>&nbsp;<span class="ident" id="4745937">cpu</span><span class="op" id="4745940">.</span><span class="ident" id="4745941">Unlock</span><span class="op" id="4745947">(</span><span class="op" id="4745948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4745951">if</span>&nbsp;<span class="ident" id="4745954">cpu</span><span class="op" id="4745957">.</span><span class="ident" id="4745958">done</span>&nbsp;<span class="op" id="4745963">==</span>&nbsp;<span class="builtintype" id="4745966">nil</span>&nbsp;<span class="op" id="4745970">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4745974">cpu</span><span class="op" id="4745977">.</span><span class="ident" id="4745978">done</span>&nbsp;<span class="op" id="4745983">=</span>&nbsp;<span class="builtinfunc" id="4745985">make</span><span class="op" id="4745989">(</span><span class="keyword" id="4745990">chan</span>&nbsp;<span class="builtintype" id="4745995">bool</span><span class="op" id="4745999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4746002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4746005">//&nbsp;Double-check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4746023">if</span>&nbsp;<span class="ident" id="4746026">cpu</span><span class="op" id="4746029">.</span><span class="ident" id="4746030">profiling</span>&nbsp;<span class="op" id="4746040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4746044">return</span>&nbsp;<span class="ident" id="4746051">fmt</span><span class="op" id="4746054">.</span><span class="ident" id="4746055">Errorf</span><span class="op" id="4746061">(</span><span class="string" id="4746062">&#34;cpu&nbsp;profiling&nbsp;already&nbsp;in&nbsp;use&#34;</span><span class="op" id="4746092">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4746095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4746098">cpu</span><span class="op" id="4746101">.</span><span class="ident" id="4746102">profiling</span>&nbsp;<span class="op" id="4746112">=</span>&nbsp;<span class="builtintype" id="4746114">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4746120">runtime</span><span class="op" id="4746127">.</span><span class="ident" id="4746128">SetCPUProfileRate</span><span class="op" id="4746145">(</span><span class="ident" id="4746146">hz</span><span class="op" id="4746148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4746151">go</span>&nbsp;<span class="ident" id="4746154">profileWriter</span><span class="op" id="4746167">(</span><span class="ident" id="4746168">w</span><span class="op" id="4746169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4746172">return</span>&nbsp;<span class="builtintype" id="4746179">nil</span><br>
<span class="lineno">590</span><span class="op" id="4746183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4746186">func</span>&nbsp;<span class="ident" id="4746191">profileWriter</span><span class="op" id="4746204">(</span><span class="ident" id="4746205">w</span>&nbsp;<span class="ident" id="4746207">io</span><span class="op" id="4746209">.</span><span class="ident" id="4746210">Writer</span><span class="op" id="4746216">)</span>&nbsp;<span class="op" id="4746218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4746221">for</span>&nbsp;<span class="op" id="4746225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4746229">data</span>&nbsp;<span class="op" id="4746234">:=</span>&nbsp;<span class="ident" id="4746237">runtime</span><span class="op" id="4746244">.</span><span class="ident" id="4746245">CPUProfile</span><span class="op" id="4746255">(</span><span class="op" id="4746256">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4746260">if</span>&nbsp;<span class="ident" id="4746263">data</span>&nbsp;<span class="op" id="4746268">==</span>&nbsp;<span class="builtintype" id="4746271">nil</span>&nbsp;<span class="op" id="4746275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4746280">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4746288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4746292">w</span><span class="op" id="4746293">.</span><span class="ident" id="4746294">Write</span><span class="op" id="4746299">(</span><span class="ident" id="4746300">data</span><span class="op" id="4746304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4746307">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4746310">cpu</span><span class="op" id="4746313">.</span><span class="ident" id="4746314">done</span>&nbsp;<span class="op" id="4746319">&lt;-</span>&nbsp;<span class="builtintype" id="4746322">true</span><br>
<span class="lineno"></span><span class="op" id="4746327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4746330">//&nbsp;StopCPUProfile&nbsp;stops&nbsp;the&nbsp;current&nbsp;CPU&nbsp;profile,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="4746387">//&nbsp;StopCPUProfile&nbsp;only&nbsp;returns&nbsp;after&nbsp;all&nbsp;the&nbsp;writes&nbsp;for&nbsp;the</span><br>
<span class="lineno">605</span><span class="comment" id="4746447">//&nbsp;profile&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span><span class="keyword" id="4746474">func</span>&nbsp;<span class="ident" id="4746479">StopCPUProfile</span><span class="op" id="4746493">(</span><span class="op" id="4746494">)</span>&nbsp;<span class="op" id="4746496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4746499">cpu</span><span class="op" id="4746502">.</span><span class="ident" id="4746503">Lock</span><span class="op" id="4746507">(</span><span class="op" id="4746508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4746511">defer</span>&nbsp;<span class="ident" id="4746517">cpu</span><span class="op" id="4746520">.</span><span class="ident" id="4746521">Unlock</span><span class="op" id="4746527">(</span><span class="op" id="4746528">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4746532">if</span>&nbsp;<span class="op" id="4746535">!</span><span class="ident" id="4746536">cpu</span><span class="op" id="4746539">.</span><span class="ident" id="4746540">profiling</span>&nbsp;<span class="op" id="4746550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4746554">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4746562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4746565">cpu</span><span class="op" id="4746568">.</span><span class="ident" id="4746569">profiling</span>&nbsp;<span class="op" id="4746579">=</span>&nbsp;<span class="builtintype" id="4746581">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4746588">runtime</span><span class="op" id="4746595">.</span><span class="ident" id="4746596">SetCPUProfileRate</span><span class="op" id="4746613">(</span><span class="num" id="4746614">0</span><span class="op" id="4746615">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4746618">&lt;-</span><span class="ident" id="4746620">cpu</span><span class="op" id="4746623">.</span><span class="ident" id="4746624">done</span><br>
<span class="lineno"></span><span class="op" id="4746629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4746632">type</span>&nbsp;<span class="ident" id="4746637">byCycles</span>&nbsp;<span class="op" id="4746646">[</span><span class="op" id="4746647">]</span><span class="ident" id="4746648">runtime</span><span class="op" id="4746655">.</span><span class="ident" id="4746656">BlockProfileRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno">620</span><span class="keyword" id="4746676">func</span>&nbsp;<span class="op" id="4746681">(</span><span class="ident" id="4746682">x</span>&nbsp;<span class="ident" id="4746684">byCycles</span><span class="op" id="4746692">)</span>&nbsp;<span class="ident" id="4746694">Len</span><span class="op" id="4746697">(</span><span class="op" id="4746698">)</span>&nbsp;<span class="builtintype" id="4746700">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4746714">{</span>&nbsp;<span class="keyword" id="4746716">return</span>&nbsp;<span class="builtinfunc" id="4746723">len</span><span class="op" id="4746726">(</span><span class="ident" id="4746727">x</span><span class="op" id="4746728">)</span>&nbsp;<span class="op" id="4746730">}</span><br>
<span class="lineno"></span><span class="keyword" id="4746732">func</span>&nbsp;<span class="op" id="4746737">(</span><span class="ident" id="4746738">x</span>&nbsp;<span class="ident" id="4746740">byCycles</span><span class="op" id="4746748">)</span>&nbsp;<span class="ident" id="4746750">Swap</span><span class="op" id="4746754">(</span><span class="ident" id="4746755">i</span><span class="op" id="4746756">,</span>&nbsp;<span class="ident" id="4746758">j</span>&nbsp;<span class="builtintype" id="4746760">int</span><span class="op" id="4746763">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4746770">{</span>&nbsp;<span class="ident" id="4746772">x</span><span class="op" id="4746773">[</span><span class="ident" id="4746774">i</span><span class="op" id="4746775">]</span><span class="op" id="4746776">,</span>&nbsp;<span class="ident" id="4746778">x</span><span class="op" id="4746779">[</span><span class="ident" id="4746780">j</span><span class="op" id="4746781">]</span>&nbsp;<span class="op" id="4746783">=</span>&nbsp;<span class="ident" id="4746785">x</span><span class="op" id="4746786">[</span><span class="ident" id="4746787">j</span><span class="op" id="4746788">]</span><span class="op" id="4746789">,</span>&nbsp;<span class="ident" id="4746791">x</span><span class="op" id="4746792">[</span><span class="ident" id="4746793">i</span><span class="op" id="4746794">]</span>&nbsp;<span class="op" id="4746796">}</span><br>
<span class="lineno"></span><span class="keyword" id="4746798">func</span>&nbsp;<span class="op" id="4746803">(</span><span class="ident" id="4746804">x</span>&nbsp;<span class="ident" id="4746806">byCycles</span><span class="op" id="4746814">)</span>&nbsp;<span class="ident" id="4746816">Less</span><span class="op" id="4746820">(</span><span class="ident" id="4746821">i</span><span class="op" id="4746822">,</span>&nbsp;<span class="ident" id="4746824">j</span>&nbsp;<span class="builtintype" id="4746826">int</span><span class="op" id="4746829">)</span>&nbsp;<span class="builtintype" id="4746831">bool</span>&nbsp;<span class="op" id="4746836">{</span>&nbsp;<span class="keyword" id="4746838">return</span>&nbsp;<span class="ident" id="4746845">x</span><span class="op" id="4746846">[</span><span class="ident" id="4746847">i</span><span class="op" id="4746848">]</span><span class="op" id="4746849">.</span><span class="ident" id="4746850">Cycles</span>&nbsp;<span class="op" id="4746857">&gt;</span>&nbsp;<span class="ident" id="4746859">x</span><span class="op" id="4746860">[</span><span class="ident" id="4746861">j</span><span class="op" id="4746862">]</span><span class="op" id="4746863">.</span><span class="ident" id="4746864">Cycles</span>&nbsp;<span class="op" id="4746871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4746874">//&nbsp;countBlock&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;blocking&nbsp;profile.</span><br>
<span class="lineno">625</span><span class="keyword" id="4746943">func</span>&nbsp;<span class="ident" id="4746948">countBlock</span><span class="op" id="4746958">(</span><span class="op" id="4746959">)</span>&nbsp;<span class="builtintype" id="4746961">int</span>&nbsp;<span class="op" id="4746965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4746968">n</span><span class="op" id="4746969">,</span>&nbsp;<span class="ident" id="4746971">_</span>&nbsp;<span class="op" id="4746973">:=</span>&nbsp;<span class="ident" id="4746976">runtime</span><span class="op" id="4746983">.</span><span class="ident" id="4746984">BlockProfile</span><span class="op" id="4746996">(</span><span class="builtintype" id="4746997">nil</span><span class="op" id="4747000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4747003">return</span>&nbsp;<span class="ident" id="4747010">n</span><br>
<span class="lineno"></span><span class="op" id="4747012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="comment" id="4747015">//&nbsp;writeBlock&nbsp;writes&nbsp;the&nbsp;current&nbsp;blocking&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4747071">func</span>&nbsp;<span class="ident" id="4747076">writeBlock</span><span class="op" id="4747086">(</span><span class="ident" id="4747087">w</span>&nbsp;<span class="ident" id="4747089">io</span><span class="op" id="4747091">.</span><span class="ident" id="4747092">Writer</span><span class="op" id="4747098">,</span>&nbsp;<span class="ident" id="4747100">debug</span>&nbsp;<span class="builtintype" id="4747106">int</span><span class="op" id="4747109">)</span>&nbsp;<span class="builtintype" id="4747111">error</span>&nbsp;<span class="op" id="4747117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4747120">var</span>&nbsp;<span class="ident" id="4747124">p</span>&nbsp;<span class="op" id="4747126">[</span><span class="op" id="4747127">]</span><span class="ident" id="4747128">runtime</span><span class="op" id="4747135">.</span><span class="ident" id="4747136">BlockProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4747156">n</span><span class="op" id="4747157">,</span>&nbsp;<span class="ident" id="4747159">ok</span>&nbsp;<span class="op" id="4747162">:=</span>&nbsp;<span class="ident" id="4747165">runtime</span><span class="op" id="4747172">.</span><span class="ident" id="4747173">BlockProfile</span><span class="op" id="4747185">(</span><span class="builtintype" id="4747186">nil</span><span class="op" id="4747189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4747192">for</span>&nbsp;<span class="op" id="4747196">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4747200">p</span>&nbsp;<span class="op" id="4747202">=</span>&nbsp;<span class="builtinfunc" id="4747204">make</span><span class="op" id="4747208">(</span><span class="op" id="4747209">[</span><span class="op" id="4747210">]</span><span class="ident" id="4747211">runtime</span><span class="op" id="4747218">.</span><span class="ident" id="4747219">BlockProfileRecord</span><span class="op" id="4747237">,</span>&nbsp;<span class="ident" id="4747239">n</span><span class="op" id="4747240">+</span><span class="num" id="4747241">50</span><span class="op" id="4747243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4747247">n</span><span class="op" id="4747248">,</span>&nbsp;<span class="ident" id="4747250">ok</span>&nbsp;<span class="op" id="4747253">=</span>&nbsp;<span class="ident" id="4747255">runtime</span><span class="op" id="4747262">.</span><span class="ident" id="4747263">BlockProfile</span><span class="op" id="4747275">(</span><span class="ident" id="4747276">p</span><span class="op" id="4747277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4747281">if</span>&nbsp;<span class="ident" id="4747284">ok</span>&nbsp;<span class="op" id="4747287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4747292">p</span>&nbsp;<span class="op" id="4747294">=</span>&nbsp;<span class="ident" id="4747296">p</span><span class="op" id="4747297">[</span><span class="op" id="4747298">:</span><span class="ident" id="4747299">n</span><span class="op" id="4747300">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4747305">break</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4747313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4747316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4747320">sort</span><span class="op" id="4747324">.</span><span class="ident" id="4747325">Sort</span><span class="op" id="4747329">(</span><span class="ident" id="4747330">byCycles</span><span class="op" id="4747338">(</span><span class="ident" id="4747339">p</span><span class="op" id="4747340">)</span><span class="op" id="4747341">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4747345">b</span>&nbsp;<span class="op" id="4747347">:=</span>&nbsp;<span class="ident" id="4747350">bufio</span><span class="op" id="4747355">.</span><span class="ident" id="4747356">NewWriter</span><span class="op" id="4747365">(</span><span class="ident" id="4747366">w</span><span class="op" id="4747367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4747370">var</span>&nbsp;<span class="ident" id="4747374">tw</span>&nbsp;<span class="op" id="4747377">*</span><span class="ident" id="4747378">tabwriter</span><span class="op" id="4747387">.</span><span class="ident" id="4747388">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4747396">w</span>&nbsp;<span class="op" id="4747398">=</span>&nbsp;<span class="ident" id="4747400">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4747403">if</span>&nbsp;<span class="ident" id="4747406">debug</span>&nbsp;<span class="op" id="4747412">&gt;</span>&nbsp;<span class="num" id="4747414">0</span>&nbsp;<span class="op" id="4747416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4747420">tw</span>&nbsp;<span class="op" id="4747423">=</span>&nbsp;<span class="ident" id="4747425">tabwriter</span><span class="op" id="4747434">.</span><span class="ident" id="4747435">NewWriter</span><span class="op" id="4747444">(</span><span class="ident" id="4747445">w</span><span class="op" id="4747446">,</span>&nbsp;<span class="num" id="4747448">1</span><span class="op" id="4747449">,</span>&nbsp;<span class="num" id="4747451">8</span><span class="op" id="4747452">,</span>&nbsp;<span class="num" id="4747454">1</span><span class="op" id="4747455">,</span>&nbsp;<span class="string" id="4747457">&#39;\t&#39;</span><span class="op" id="4747461">,</span>&nbsp;<span class="num" id="4747463">0</span><span class="op" id="4747464">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4747468">w</span>&nbsp;<span class="op" id="4747470">=</span>&nbsp;<span class="ident" id="4747472">tw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4747476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4747480">fmt</span><span class="op" id="4747483">.</span><span class="ident" id="4747484">Fprintf</span><span class="op" id="4747491">(</span><span class="ident" id="4747492">w</span><span class="op" id="4747493">,</span>&nbsp;<span class="string" id="4747495">&#34;---&nbsp;contention:\n&#34;</span><span class="op" id="4747514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4747517">fmt</span><span class="op" id="4747520">.</span><span class="ident" id="4747521">Fprintf</span><span class="op" id="4747528">(</span><span class="ident" id="4747529">w</span><span class="op" id="4747530">,</span>&nbsp;<span class="string" id="4747532">&#34;cycles/second=%v\n&#34;</span><span class="op" id="4747552">,</span>&nbsp;<span class="ident" id="4747554">runtime_cyclesPerSecond</span><span class="op" id="4747577">(</span><span class="op" id="4747578">)</span><span class="op" id="4747579">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4747582">for</span>&nbsp;<span class="ident" id="4747586">i</span>&nbsp;<span class="op" id="4747588">:=</span>&nbsp;<span class="keyword" id="4747591">range</span>&nbsp;<span class="ident" id="4747597">p</span>&nbsp;<span class="op" id="4747599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4747603">r</span>&nbsp;<span class="op" id="4747605">:=</span>&nbsp;<span class="op" id="4747608">&amp;</span><span class="ident" id="4747609">p</span><span class="op" id="4747610">[</span><span class="ident" id="4747611">i</span><span class="op" id="4747612">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4747616">fmt</span><span class="op" id="4747619">.</span><span class="ident" id="4747620">Fprintf</span><span class="op" id="4747627">(</span><span class="ident" id="4747628">w</span><span class="op" id="4747629">,</span>&nbsp;<span class="string" id="4747631">&#34;%v&nbsp;%v&nbsp;@&#34;</span><span class="op" id="4747640">,</span>&nbsp;<span class="ident" id="4747642">r</span><span class="op" id="4747643">.</span><span class="ident" id="4747644">Cycles</span><span class="op" id="4747650">,</span>&nbsp;<span class="ident" id="4747652">r</span><span class="op" id="4747653">.</span><span class="ident" id="4747654">Count</span><span class="op" id="4747659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4747663">for</span>&nbsp;<span class="ident" id="4747667">_</span><span class="op" id="4747668">,</span>&nbsp;<span class="ident" id="4747670">pc</span>&nbsp;<span class="op" id="4747673">:=</span>&nbsp;<span class="keyword" id="4747676">range</span>&nbsp;<span class="ident" id="4747682">r</span><span class="op" id="4747683">.</span><span class="ident" id="4747684">Stack</span><span class="op" id="4747689">(</span><span class="op" id="4747690">)</span>&nbsp;<span class="op" id="4747692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4747697">fmt</span><span class="op" id="4747700">.</span><span class="ident" id="4747701">Fprintf</span><span class="op" id="4747708">(</span><span class="ident" id="4747709">w</span><span class="op" id="4747710">,</span>&nbsp;<span class="string" id="4747712">&#34;&nbsp;%#x&#34;</span><span class="op" id="4747718">,</span>&nbsp;<span class="ident" id="4747720">pc</span><span class="op" id="4747722">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4747726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4747730">fmt</span><span class="op" id="4747733">.</span><span class="ident" id="4747734">Fprint</span><span class="op" id="4747740">(</span><span class="ident" id="4747741">w</span><span class="op" id="4747742">,</span>&nbsp;<span class="string" id="4747744">&#34;\n&#34;</span><span class="op" id="4747748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4747752">if</span>&nbsp;<span class="ident" id="4747755">debug</span>&nbsp;<span class="op" id="4747761">&gt;</span>&nbsp;<span class="num" id="4747763">0</span>&nbsp;<span class="op" id="4747765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4747770">printStackRecord</span><span class="op" id="4747786">(</span><span class="ident" id="4747787">w</span><span class="op" id="4747788">,</span>&nbsp;<span class="ident" id="4747790">r</span><span class="op" id="4747791">.</span><span class="ident" id="4747792">Stack</span><span class="op" id="4747797">(</span><span class="op" id="4747798">)</span><span class="op" id="4747799">,</span>&nbsp;<span class="builtintype" id="4747801">true</span><span class="op" id="4747805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4747809">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4747812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4747816">if</span>&nbsp;<span class="ident" id="4747819">tw</span>&nbsp;<span class="op" id="4747822">!=</span>&nbsp;<span class="builtintype" id="4747825">nil</span>&nbsp;<span class="op" id="4747829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4747833">tw</span><span class="op" id="4747835">.</span><span class="ident" id="4747836">Flush</span><span class="op" id="4747841">(</span><span class="op" id="4747842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4747845">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4747848">return</span>&nbsp;<span class="ident" id="4747855">b</span><span class="op" id="4747856">.</span><span class="ident" id="4747857">Flush</span><span class="op" id="4747862">(</span><span class="op" id="4747863">)</span><br>
<span class="lineno"></span><span class="op" id="4747865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4747868">func</span>&nbsp;<span class="ident" id="4747873">runtime_cyclesPerSecond</span><span class="op" id="4747896">(</span><span class="op" id="4747897">)</span>&nbsp;<span class="builtintype" id="4747899">int64</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
