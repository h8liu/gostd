<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4466489">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4466545">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4466599">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4466650">package</span>&nbsp;<span class="ident" id="4466658">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4466666">import</span>&nbsp;<span class="op" id="4466673">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4466676">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4466684">&#34;strings&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4466695">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4466706">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4466721">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4466724">//&nbsp;An&nbsp;Error&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">15</span><span class="comment" id="4466786">//&nbsp;and&nbsp;gives&nbsp;the&nbsp;offending&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="4466825">type</span>&nbsp;<span class="ident" id="4466830">Error</span>&nbsp;<span class="keyword" id="4466836">struct</span>&nbsp;<span class="op" id="4466843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466846">Code</span>&nbsp;<span class="ident" id="4466851">ErrorCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4466862">Expr</span>&nbsp;<span class="builtintype" id="4466867">string</span><br>
<span class="lineno"></span><span class="op" id="4466874">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="4466877">func</span>&nbsp;<span class="op" id="4466882">(</span><span class="ident" id="4466883">e</span>&nbsp;<span class="op" id="4466885">*</span><span class="ident" id="4466886">Error</span><span class="op" id="4466891">)</span>&nbsp;<span class="ident" id="4466893">Error</span><span class="op" id="4466898">(</span><span class="op" id="4466899">)</span>&nbsp;<span class="builtintype" id="4466901">string</span>&nbsp;<span class="op" id="4466908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4466911">return</span>&nbsp;<span class="string" id="4466918">&#34;error&nbsp;parsing&nbsp;regexp:&nbsp;&#34;</span>&nbsp;<span class="op" id="4466943">+</span>&nbsp;<span class="ident" id="4466945">e</span><span class="op" id="4466946">.</span><span class="ident" id="4466947">Code</span><span class="op" id="4466951">.</span><span class="ident" id="4466952">String</span><span class="op" id="4466958">(</span><span class="op" id="4466959">)</span>&nbsp;<span class="op" id="4466961">+</span>&nbsp;<span class="string" id="4466963">&#34;:&nbsp;`&#34;</span>&nbsp;<span class="op" id="4466969">+</span>&nbsp;<span class="ident" id="4466971">e</span><span class="op" id="4466972">.</span><span class="ident" id="4466973">Expr</span>&nbsp;<span class="op" id="4466978">+</span>&nbsp;<span class="string" id="4466980">&#34;`&#34;</span><br>
<span class="lineno"></span><span class="op" id="4466984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4466987">//&nbsp;An&nbsp;ErrorCode&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="4467054">type</span>&nbsp;<span class="ident" id="4467059">ErrorCode</span>&nbsp;<span class="builtintype" id="4467069">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4467077">const</span>&nbsp;<span class="op" id="4467083">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4467086">//&nbsp;Unexpected&nbsp;error</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467107">ErrInternalError</span>&nbsp;<span class="ident" id="4467124">ErrorCode</span>&nbsp;<span class="op" id="4467134">=</span>&nbsp;<span class="string" id="4467136">&#34;regexp/syntax:&nbsp;internal&nbsp;error&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4467170">//&nbsp;Parse&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467187">ErrInvalidCharClass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467212">ErrorCode</span>&nbsp;<span class="op" id="4467222">=</span>&nbsp;<span class="string" id="4467224">&#34;invalid&nbsp;character&nbsp;class&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467251">ErrInvalidCharRange</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467276">ErrorCode</span>&nbsp;<span class="op" id="4467286">=</span>&nbsp;<span class="string" id="4467288">&#34;invalid&nbsp;character&nbsp;class&nbsp;range&#34;</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467321">ErrInvalidEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467346">ErrorCode</span>&nbsp;<span class="op" id="4467356">=</span>&nbsp;<span class="string" id="4467358">&#34;invalid&nbsp;escape&nbsp;sequence&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467385">ErrInvalidNamedCapture</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4467410">ErrorCode</span>&nbsp;<span class="op" id="4467420">=</span>&nbsp;<span class="string" id="4467422">&#34;invalid&nbsp;named&nbsp;capture&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467447">ErrInvalidPerlOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467472">ErrorCode</span>&nbsp;<span class="op" id="4467482">=</span>&nbsp;<span class="string" id="4467484">&#34;invalid&nbsp;or&nbsp;unsupported&nbsp;Perl&nbsp;syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467522">ErrInvalidRepeatOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467547">ErrorCode</span>&nbsp;<span class="op" id="4467557">=</span>&nbsp;<span class="string" id="4467559">&#34;invalid&nbsp;nested&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467597">ErrInvalidRepeatSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467622">ErrorCode</span>&nbsp;<span class="op" id="4467632">=</span>&nbsp;<span class="string" id="4467634">&#34;invalid&nbsp;repeat&nbsp;count&#34;</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467658">ErrInvalidUTF8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467683">ErrorCode</span>&nbsp;<span class="op" id="4467693">=</span>&nbsp;<span class="string" id="4467695">&#34;invalid&nbsp;UTF-8&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467712">ErrMissingBracket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467737">ErrorCode</span>&nbsp;<span class="op" id="4467747">=</span>&nbsp;<span class="string" id="4467749">&#34;missing&nbsp;closing&nbsp;]&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467770">ErrMissingParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467795">ErrorCode</span>&nbsp;<span class="op" id="4467805">=</span>&nbsp;<span class="string" id="4467807">&#34;missing&nbsp;closing&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467828">ErrMissingRepeatArgument</span>&nbsp;<span class="ident" id="4467853">ErrorCode</span>&nbsp;<span class="op" id="4467863">=</span>&nbsp;<span class="string" id="4467865">&#34;missing&nbsp;argument&nbsp;to&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467908">ErrTrailingBackslash</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4467933">ErrorCode</span>&nbsp;<span class="op" id="4467943">=</span>&nbsp;<span class="string" id="4467945">&#34;trailing&nbsp;backslash&nbsp;at&nbsp;end&nbsp;of&nbsp;expression&#34;</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4467988">ErrUnexpectedParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4468013">ErrorCode</span>&nbsp;<span class="op" id="4468023">=</span>&nbsp;<span class="string" id="4468025">&#34;unexpected&nbsp;)&#34;</span><br>
<span class="lineno"></span><span class="op" id="4468040">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4468043">func</span>&nbsp;<span class="op" id="4468048">(</span><span class="ident" id="4468049">e</span>&nbsp;<span class="ident" id="4468051">ErrorCode</span><span class="op" id="4468060">)</span>&nbsp;<span class="ident" id="4468062">String</span><span class="op" id="4468068">(</span><span class="op" id="4468069">)</span>&nbsp;<span class="builtintype" id="4468071">string</span>&nbsp;<span class="op" id="4468078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4468081">return</span>&nbsp;<span class="builtintype" id="4468088">string</span><span class="op" id="4468094">(</span><span class="ident" id="4468095">e</span><span class="op" id="4468096">)</span><br>
<span class="lineno">50</span><span class="op" id="4468098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4468101">//&nbsp;Flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;the&nbsp;parser&nbsp;and&nbsp;record&nbsp;information&nbsp;about&nbsp;regexp&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="4468190">type</span>&nbsp;<span class="ident" id="4468195">Flags</span>&nbsp;<span class="builtintype" id="4468201">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4468209">const</span>&nbsp;<span class="op" id="4468215">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468218">FoldCase</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4468232">Flags</span>&nbsp;<span class="op" id="4468238">=</span>&nbsp;<span class="num" id="4468240">1</span>&nbsp;<span class="op" id="4468242">&lt;&lt;</span>&nbsp;<span class="ident" id="4468245">iota</span>&nbsp;<span class="comment" id="4468250">//&nbsp;case-insensitive&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468277">Literal</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4468309">//&nbsp;treat&nbsp;pattern&nbsp;as&nbsp;literal&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468345">ClassNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4468377">//&nbsp;allow&nbsp;character&nbsp;classes&nbsp;like&nbsp;[^a-z]&nbsp;and&nbsp;[[:space:]]&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468450">DotNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4468482">//&nbsp;allow&nbsp;.&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468511">OneLine</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4468543">//&nbsp;treat&nbsp;^&nbsp;and&nbsp;$&nbsp;as&nbsp;only&nbsp;matching&nbsp;at&nbsp;beginning&nbsp;and&nbsp;end&nbsp;of&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468607">NonGreedy</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4468639">//&nbsp;make&nbsp;repetition&nbsp;operators&nbsp;default&nbsp;to&nbsp;non-greedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468691">PerlX</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4468723">//&nbsp;allow&nbsp;Perl&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468749">UnicodeGroups</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4468781">//&nbsp;allow&nbsp;\p{Han},&nbsp;\P{Han}&nbsp;for&nbsp;Unicode&nbsp;group&nbsp;and&nbsp;negation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468839">WasDollar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4468871">//&nbsp;regexp&nbsp;OpEndText&nbsp;was&nbsp;$,&nbsp;not&nbsp;\z</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468906">Simple</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4468938">//&nbsp;regexp&nbsp;contains&nbsp;no&nbsp;counted&nbsp;repetition</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4468981">MatchNL</span>&nbsp;<span class="op" id="4468989">=</span>&nbsp;<span class="ident" id="4468991">ClassNL</span>&nbsp;<span class="op" id="4468999">|</span>&nbsp;<span class="ident" id="4469001">DotNL</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469009">Perl</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4469021">=</span>&nbsp;<span class="ident" id="4469023">ClassNL</span>&nbsp;<span class="op" id="4469031">|</span>&nbsp;<span class="ident" id="4469033">OneLine</span>&nbsp;<span class="op" id="4469041">|</span>&nbsp;<span class="ident" id="4469043">PerlX</span>&nbsp;<span class="op" id="4469049">|</span>&nbsp;<span class="ident" id="4469051">UnicodeGroups</span>&nbsp;<span class="comment" id="4469065">//&nbsp;as&nbsp;close&nbsp;to&nbsp;Perl&nbsp;as&nbsp;possible</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469098">POSIX</span>&nbsp;<span class="ident" id="4469104">Flags</span>&nbsp;<span class="op" id="4469110">=</span>&nbsp;<span class="num" id="4469112">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469154">//&nbsp;POSIX&nbsp;syntax</span><br>
<span class="lineno"></span><span class="op" id="4469170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4469173">//&nbsp;Pseudo-ops&nbsp;for&nbsp;parsing&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="4469206">const</span>&nbsp;<span class="op" id="4469212">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469215">opLeftParen</span>&nbsp;<span class="op" id="4469227">=</span>&nbsp;<span class="ident" id="4469229">opPseudo</span>&nbsp;<span class="op" id="4469238">+</span>&nbsp;<span class="ident" id="4469240">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469246">opVerticalBar</span><br>
<span class="lineno"></span><span class="op" id="4469260">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4469263">type</span>&nbsp;<span class="ident" id="4469268">parser</span>&nbsp;<span class="keyword" id="4469275">struct</span>&nbsp;<span class="op" id="4469282">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469285">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469297">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469307">//&nbsp;parse&nbsp;mode&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469328">stack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4469340">[</span><span class="op" id="4469341">]</span><span class="op" id="4469342">*</span><span class="ident" id="4469343">Regexp</span>&nbsp;<span class="comment" id="4469350">//&nbsp;stack&nbsp;of&nbsp;parsed&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469382">free</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4469394">*</span><span class="ident" id="4469395">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469403">numCap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4469415">int</span>&nbsp;<span class="comment" id="4469419">//&nbsp;number&nbsp;of&nbsp;capturing&nbsp;groups&nbsp;seen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469455">wholeRegexp</span>&nbsp;<span class="builtintype" id="4469467">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469475">tmpClass</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4469487">[</span><span class="op" id="4469488">]</span><span class="builtintype" id="4469489">rune</span>&nbsp;<span class="comment" id="4469494">//&nbsp;temporary&nbsp;char&nbsp;class&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="4469529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4469532">func</span>&nbsp;<span class="op" id="4469537">(</span><span class="ident" id="4469538">p</span>&nbsp;<span class="op" id="4469540">*</span><span class="ident" id="4469541">parser</span><span class="op" id="4469547">)</span>&nbsp;<span class="ident" id="4469549">newRegexp</span><span class="op" id="4469558">(</span><span class="ident" id="4469559">op</span>&nbsp;<span class="ident" id="4469562">Op</span><span class="op" id="4469564">)</span>&nbsp;<span class="op" id="4469566">*</span><span class="ident" id="4469567">Regexp</span>&nbsp;<span class="op" id="4469574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469577">re</span>&nbsp;<span class="op" id="4469580">:=</span>&nbsp;<span class="ident" id="4469583">p</span><span class="op" id="4469584">.</span><span class="ident" id="4469585">free</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469591">if</span>&nbsp;<span class="ident" id="4469594">re</span>&nbsp;<span class="op" id="4469597">!=</span>&nbsp;<span class="ident" id="4469600">nil</span>&nbsp;<span class="op" id="4469604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469608">p</span><span class="op" id="4469609">.</span><span class="ident" id="4469610">free</span>&nbsp;<span class="op" id="4469615">=</span>&nbsp;<span class="ident" id="4469617">re</span><span class="op" id="4469619">.</span><span class="ident" id="4469620">Sub0</span><span class="op" id="4469624">[</span><span class="num" id="4469625">0</span><span class="op" id="4469626">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469630">*</span><span class="ident" id="4469631">re</span>&nbsp;<span class="op" id="4469634">=</span>&nbsp;<span class="ident" id="4469636">Regexp</span><span class="op" id="4469642">{</span><span class="op" id="4469643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469646">}</span>&nbsp;<span class="keyword" id="4469648">else</span>&nbsp;<span class="op" id="4469653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469657">re</span>&nbsp;<span class="op" id="4469660">=</span>&nbsp;<span class="builtinfunc" id="4469662">new</span><span class="op" id="4469665">(</span><span class="ident" id="4469666">Regexp</span><span class="op" id="4469672">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4469675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469678">re</span><span class="op" id="4469680">.</span><span class="ident" id="4469681">Op</span>&nbsp;<span class="op" id="4469684">=</span>&nbsp;<span class="ident" id="4469686">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469690">return</span>&nbsp;<span class="ident" id="4469697">re</span><br>
<span class="lineno"></span><span class="op" id="4469700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="4469703">func</span>&nbsp;<span class="op" id="4469708">(</span><span class="ident" id="4469709">p</span>&nbsp;<span class="op" id="4469711">*</span><span class="ident" id="4469712">parser</span><span class="op" id="4469718">)</span>&nbsp;<span class="ident" id="4469720">reuse</span><span class="op" id="4469725">(</span><span class="ident" id="4469726">re</span>&nbsp;<span class="op" id="4469729">*</span><span class="ident" id="4469730">Regexp</span><span class="op" id="4469736">)</span>&nbsp;<span class="op" id="4469738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469741">re</span><span class="op" id="4469743">.</span><span class="ident" id="4469744">Sub0</span><span class="op" id="4469748">[</span><span class="num" id="4469749">0</span><span class="op" id="4469750">]</span>&nbsp;<span class="op" id="4469752">=</span>&nbsp;<span class="ident" id="4469754">p</span><span class="op" id="4469755">.</span><span class="ident" id="4469756">free</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4469762">p</span><span class="op" id="4469763">.</span><span class="ident" id="4469764">free</span>&nbsp;<span class="op" id="4469769">=</span>&nbsp;<span class="ident" id="4469771">re</span><br>
<span class="lineno"></span><span class="op" id="4469774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="4469777">//&nbsp;Parse&nbsp;stack&nbsp;manipulation.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4469807">//&nbsp;push&nbsp;pushes&nbsp;the&nbsp;regexp&nbsp;re&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack&nbsp;and&nbsp;returns&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="4469881">func</span>&nbsp;<span class="op" id="4469886">(</span><span class="ident" id="4469887">p</span>&nbsp;<span class="op" id="4469889">*</span><span class="ident" id="4469890">parser</span><span class="op" id="4469896">)</span>&nbsp;<span class="ident" id="4469898">push</span><span class="op" id="4469902">(</span><span class="ident" id="4469903">re</span>&nbsp;<span class="op" id="4469906">*</span><span class="ident" id="4469907">Regexp</span><span class="op" id="4469913">)</span>&nbsp;<span class="op" id="4469915">*</span><span class="ident" id="4469916">Regexp</span>&nbsp;<span class="op" id="4469923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4469926">if</span>&nbsp;<span class="ident" id="4469929">re</span><span class="op" id="4469931">.</span><span class="ident" id="4469932">Op</span>&nbsp;<span class="op" id="4469935">==</span>&nbsp;<span class="ident" id="4469938">OpCharClass</span>&nbsp;<span class="op" id="4469950">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4469953">len</span><span class="op" id="4469956">(</span><span class="ident" id="4469957">re</span><span class="op" id="4469959">.</span><span class="ident" id="4469960">Rune</span><span class="op" id="4469964">)</span>&nbsp;<span class="op" id="4469966">==</span>&nbsp;<span class="num" id="4469969">2</span>&nbsp;<span class="op" id="4469971">&amp;&amp;</span>&nbsp;<span class="ident" id="4469974">re</span><span class="op" id="4469976">.</span><span class="ident" id="4469977">Rune</span><span class="op" id="4469981">[</span><span class="num" id="4469982">0</span><span class="op" id="4469983">]</span>&nbsp;<span class="op" id="4469985">==</span>&nbsp;<span class="ident" id="4469988">re</span><span class="op" id="4469990">.</span><span class="ident" id="4469991">Rune</span><span class="op" id="4469995">[</span><span class="num" id="4469996">1</span><span class="op" id="4469997">]</span>&nbsp;<span class="op" id="4469999">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470003">//&nbsp;Single&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470021">if</span>&nbsp;<span class="ident" id="4470024">p</span><span class="op" id="4470025">.</span><span class="ident" id="4470026">maybeConcat</span><span class="op" id="4470037">(</span><span class="ident" id="4470038">re</span><span class="op" id="4470040">.</span><span class="ident" id="4470041">Rune</span><span class="op" id="4470045">[</span><span class="num" id="4470046">0</span><span class="op" id="4470047">]</span><span class="op" id="4470048">,</span>&nbsp;<span class="ident" id="4470050">p</span><span class="op" id="4470051">.</span><span class="ident" id="4470052">flags</span><span class="op" id="4470057">&amp;^</span><span class="ident" id="4470059">FoldCase</span><span class="op" id="4470067">)</span>&nbsp;<span class="op" id="4470069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470074">return</span>&nbsp;<span class="ident" id="4470081">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4470087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470091">re</span><span class="op" id="4470093">.</span><span class="ident" id="4470094">Op</span>&nbsp;<span class="op" id="4470097">=</span>&nbsp;<span class="ident" id="4470099">OpLiteral</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470111">re</span><span class="op" id="4470113">.</span><span class="ident" id="4470114">Rune</span>&nbsp;<span class="op" id="4470119">=</span>&nbsp;<span class="ident" id="4470121">re</span><span class="op" id="4470123">.</span><span class="ident" id="4470124">Rune</span><span class="op" id="4470128">[</span><span class="op" id="4470129">:</span><span class="num" id="4470130">1</span><span class="op" id="4470131">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470135">re</span><span class="op" id="4470137">.</span><span class="ident" id="4470138">Flags</span>&nbsp;<span class="op" id="4470144">=</span>&nbsp;<span class="ident" id="4470146">p</span><span class="op" id="4470147">.</span><span class="ident" id="4470148">flags</span>&nbsp;<span class="op" id="4470154">&amp;^</span>&nbsp;<span class="ident" id="4470157">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4470167">}</span>&nbsp;<span class="keyword" id="4470169">else</span>&nbsp;<span class="keyword" id="4470174">if</span>&nbsp;<span class="ident" id="4470177">re</span><span class="op" id="4470179">.</span><span class="ident" id="4470180">Op</span>&nbsp;<span class="op" id="4470183">==</span>&nbsp;<span class="ident" id="4470186">OpCharClass</span>&nbsp;<span class="op" id="4470198">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4470201">len</span><span class="op" id="4470204">(</span><span class="ident" id="4470205">re</span><span class="op" id="4470207">.</span><span class="ident" id="4470208">Rune</span><span class="op" id="4470212">)</span>&nbsp;<span class="op" id="4470214">==</span>&nbsp;<span class="num" id="4470217">4</span>&nbsp;<span class="op" id="4470219">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470224">re</span><span class="op" id="4470226">.</span><span class="ident" id="4470227">Rune</span><span class="op" id="4470231">[</span><span class="num" id="4470232">0</span><span class="op" id="4470233">]</span>&nbsp;<span class="op" id="4470235">==</span>&nbsp;<span class="ident" id="4470238">re</span><span class="op" id="4470240">.</span><span class="ident" id="4470241">Rune</span><span class="op" id="4470245">[</span><span class="num" id="4470246">1</span><span class="op" id="4470247">]</span>&nbsp;<span class="op" id="4470249">&amp;&amp;</span>&nbsp;<span class="ident" id="4470252">re</span><span class="op" id="4470254">.</span><span class="ident" id="4470255">Rune</span><span class="op" id="4470259">[</span><span class="num" id="4470260">2</span><span class="op" id="4470261">]</span>&nbsp;<span class="op" id="4470263">==</span>&nbsp;<span class="ident" id="4470266">re</span><span class="op" id="4470268">.</span><span class="ident" id="4470269">Rune</span><span class="op" id="4470273">[</span><span class="num" id="4470274">3</span><span class="op" id="4470275">]</span>&nbsp;<span class="op" id="4470277">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470282">unicode</span><span class="op" id="4470289">.</span><span class="ident" id="4470290">SimpleFold</span><span class="op" id="4470300">(</span><span class="ident" id="4470301">re</span><span class="op" id="4470303">.</span><span class="ident" id="4470304">Rune</span><span class="op" id="4470308">[</span><span class="num" id="4470309">0</span><span class="op" id="4470310">]</span><span class="op" id="4470311">)</span>&nbsp;<span class="op" id="4470313">==</span>&nbsp;<span class="ident" id="4470316">re</span><span class="op" id="4470318">.</span><span class="ident" id="4470319">Rune</span><span class="op" id="4470323">[</span><span class="num" id="4470324">2</span><span class="op" id="4470325">]</span>&nbsp;<span class="op" id="4470327">&amp;&amp;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470332">unicode</span><span class="op" id="4470339">.</span><span class="ident" id="4470340">SimpleFold</span><span class="op" id="4470350">(</span><span class="ident" id="4470351">re</span><span class="op" id="4470353">.</span><span class="ident" id="4470354">Rune</span><span class="op" id="4470358">[</span><span class="num" id="4470359">2</span><span class="op" id="4470360">]</span><span class="op" id="4470361">)</span>&nbsp;<span class="op" id="4470363">==</span>&nbsp;<span class="ident" id="4470366">re</span><span class="op" id="4470368">.</span><span class="ident" id="4470369">Rune</span><span class="op" id="4470373">[</span><span class="num" id="4470374">0</span><span class="op" id="4470375">]</span>&nbsp;<span class="op" id="4470377">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470382">re</span><span class="op" id="4470384">.</span><span class="ident" id="4470385">Op</span>&nbsp;<span class="op" id="4470388">==</span>&nbsp;<span class="ident" id="4470391">OpCharClass</span>&nbsp;<span class="op" id="4470403">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4470406">len</span><span class="op" id="4470409">(</span><span class="ident" id="4470410">re</span><span class="op" id="4470412">.</span><span class="ident" id="4470413">Rune</span><span class="op" id="4470417">)</span>&nbsp;<span class="op" id="4470419">==</span>&nbsp;<span class="num" id="4470422">2</span>&nbsp;<span class="op" id="4470424">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470430">re</span><span class="op" id="4470432">.</span><span class="ident" id="4470433">Rune</span><span class="op" id="4470437">[</span><span class="num" id="4470438">0</span><span class="op" id="4470439">]</span><span class="op" id="4470440">+</span><span class="num" id="4470441">1</span>&nbsp;<span class="op" id="4470443">==</span>&nbsp;<span class="ident" id="4470446">re</span><span class="op" id="4470448">.</span><span class="ident" id="4470449">Rune</span><span class="op" id="4470453">[</span><span class="num" id="4470454">1</span><span class="op" id="4470455">]</span>&nbsp;<span class="op" id="4470457">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470463">unicode</span><span class="op" id="4470470">.</span><span class="ident" id="4470471">SimpleFold</span><span class="op" id="4470481">(</span><span class="ident" id="4470482">re</span><span class="op" id="4470484">.</span><span class="ident" id="4470485">Rune</span><span class="op" id="4470489">[</span><span class="num" id="4470490">0</span><span class="op" id="4470491">]</span><span class="op" id="4470492">)</span>&nbsp;<span class="op" id="4470494">==</span>&nbsp;<span class="ident" id="4470497">re</span><span class="op" id="4470499">.</span><span class="ident" id="4470500">Rune</span><span class="op" id="4470504">[</span><span class="num" id="4470505">1</span><span class="op" id="4470506">]</span>&nbsp;<span class="op" id="4470508">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470514">unicode</span><span class="op" id="4470521">.</span><span class="ident" id="4470522">SimpleFold</span><span class="op" id="4470532">(</span><span class="ident" id="4470533">re</span><span class="op" id="4470535">.</span><span class="ident" id="4470536">Rune</span><span class="op" id="4470540">[</span><span class="num" id="4470541">1</span><span class="op" id="4470542">]</span><span class="op" id="4470543">)</span>&nbsp;<span class="op" id="4470545">==</span>&nbsp;<span class="ident" id="4470548">re</span><span class="op" id="4470550">.</span><span class="ident" id="4470551">Rune</span><span class="op" id="4470555">[</span><span class="num" id="4470556">0</span><span class="op" id="4470557">]</span>&nbsp;<span class="op" id="4470559">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470563">//&nbsp;Case-insensitive&nbsp;rune&nbsp;like&nbsp;[Aa]&nbsp;or&nbsp;[Δδ].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470611">if</span>&nbsp;<span class="ident" id="4470614">p</span><span class="op" id="4470615">.</span><span class="ident" id="4470616">maybeConcat</span><span class="op" id="4470627">(</span><span class="ident" id="4470628">re</span><span class="op" id="4470630">.</span><span class="ident" id="4470631">Rune</span><span class="op" id="4470635">[</span><span class="num" id="4470636">0</span><span class="op" id="4470637">]</span><span class="op" id="4470638">,</span>&nbsp;<span class="ident" id="4470640">p</span><span class="op" id="4470641">.</span><span class="ident" id="4470642">flags</span><span class="op" id="4470647">|</span><span class="ident" id="4470648">FoldCase</span><span class="op" id="4470656">)</span>&nbsp;<span class="op" id="4470658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470663">return</span>&nbsp;<span class="ident" id="4470670">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4470676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470681">//&nbsp;Rewrite&nbsp;as&nbsp;(case-insensitive)&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470725">re</span><span class="op" id="4470727">.</span><span class="ident" id="4470728">Op</span>&nbsp;<span class="op" id="4470731">=</span>&nbsp;<span class="ident" id="4470733">OpLiteral</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470745">re</span><span class="op" id="4470747">.</span><span class="ident" id="4470748">Rune</span>&nbsp;<span class="op" id="4470753">=</span>&nbsp;<span class="ident" id="4470755">re</span><span class="op" id="4470757">.</span><span class="ident" id="4470758">Rune</span><span class="op" id="4470762">[</span><span class="op" id="4470763">:</span><span class="num" id="4470764">1</span><span class="op" id="4470765">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470769">re</span><span class="op" id="4470771">.</span><span class="ident" id="4470772">Flags</span>&nbsp;<span class="op" id="4470778">=</span>&nbsp;<span class="ident" id="4470780">p</span><span class="op" id="4470781">.</span><span class="ident" id="4470782">flags</span>&nbsp;<span class="op" id="4470788">|</span>&nbsp;<span class="ident" id="4470790">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4470800">}</span>&nbsp;<span class="keyword" id="4470802">else</span>&nbsp;<span class="op" id="4470807">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4470811">//&nbsp;Incremental&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470843">p</span><span class="op" id="4470844">.</span><span class="ident" id="4470845">maybeConcat</span><span class="op" id="4470856">(</span><span class="op" id="4470857">-</span><span class="num" id="4470858">1</span><span class="op" id="4470859">,</span>&nbsp;<span class="num" id="4470861">0</span><span class="op" id="4470862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4470865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4470869">p</span><span class="op" id="4470870">.</span><span class="ident" id="4470871">stack</span>&nbsp;<span class="op" id="4470877">=</span>&nbsp;<span class="builtinfunc" id="4470879">append</span><span class="op" id="4470885">(</span><span class="ident" id="4470886">p</span><span class="op" id="4470887">.</span><span class="ident" id="4470888">stack</span><span class="op" id="4470893">,</span>&nbsp;<span class="ident" id="4470895">re</span><span class="op" id="4470897">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4470900">return</span>&nbsp;<span class="ident" id="4470907">re</span><br>
<span class="lineno"></span><span class="op" id="4470910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4470913">//&nbsp;maybeConcat&nbsp;implements&nbsp;incremental&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="4470965">//&nbsp;of&nbsp;literal&nbsp;runes&nbsp;into&nbsp;string&nbsp;nodes.&nbsp;&nbsp;The&nbsp;parser&nbsp;calls&nbsp;this</span><br>
<span class="lineno">145</span><span class="comment" id="4471027">//&nbsp;before&nbsp;each&nbsp;push,&nbsp;so&nbsp;only&nbsp;the&nbsp;top&nbsp;fragment&nbsp;of&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="4471086">//&nbsp;might&nbsp;need&nbsp;processing.&nbsp;&nbsp;Since&nbsp;this&nbsp;is&nbsp;called&nbsp;before&nbsp;a&nbsp;push,</span><br>
<span class="lineno"></span><span class="comment" id="4471149">//&nbsp;the&nbsp;topmost&nbsp;literal&nbsp;is&nbsp;no&nbsp;longer&nbsp;subject&nbsp;to&nbsp;operators&nbsp;like&nbsp;*</span><br>
<span class="lineno"></span><span class="comment" id="4471213">//&nbsp;(Otherwise&nbsp;ab*&nbsp;would&nbsp;turn&nbsp;into&nbsp;(ab)*.)</span><br>
<span class="lineno"></span><span class="comment" id="4471255">//&nbsp;If&nbsp;r&nbsp;&gt;=&nbsp;0&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;node&nbsp;left&nbsp;over,&nbsp;maybeConcat&nbsp;uses&nbsp;it</span><br>
<span class="lineno">150</span><span class="comment" id="4471318">//&nbsp;to&nbsp;push&nbsp;r&nbsp;with&nbsp;the&nbsp;given&nbsp;flags.</span><br>
<span class="lineno"></span><span class="comment" id="4471353">//&nbsp;maybeConcat&nbsp;reports&nbsp;whether&nbsp;r&nbsp;was&nbsp;pushed.</span><br>
<span class="lineno"></span><span class="keyword" id="4471398">func</span>&nbsp;<span class="op" id="4471403">(</span><span class="ident" id="4471404">p</span>&nbsp;<span class="op" id="4471406">*</span><span class="ident" id="4471407">parser</span><span class="op" id="4471413">)</span>&nbsp;<span class="ident" id="4471415">maybeConcat</span><span class="op" id="4471426">(</span><span class="ident" id="4471427">r</span>&nbsp;<span class="builtintype" id="4471429">rune</span><span class="op" id="4471433">,</span>&nbsp;<span class="ident" id="4471435">flags</span>&nbsp;<span class="ident" id="4471441">Flags</span><span class="op" id="4471446">)</span>&nbsp;<span class="builtintype" id="4471448">bool</span>&nbsp;<span class="op" id="4471453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471456">n</span>&nbsp;<span class="op" id="4471458">:=</span>&nbsp;<span class="builtinfunc" id="4471461">len</span><span class="op" id="4471464">(</span><span class="ident" id="4471465">p</span><span class="op" id="4471466">.</span><span class="ident" id="4471467">stack</span><span class="op" id="4471472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471475">if</span>&nbsp;<span class="ident" id="4471478">n</span>&nbsp;<span class="op" id="4471480">&lt;</span>&nbsp;<span class="num" id="4471482">2</span>&nbsp;<span class="op" id="4471484">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471488">return</span>&nbsp;<span class="builtintype" id="4471495">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4471502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471506">re1</span>&nbsp;<span class="op" id="4471510">:=</span>&nbsp;<span class="ident" id="4471513">p</span><span class="op" id="4471514">.</span><span class="ident" id="4471515">stack</span><span class="op" id="4471520">[</span><span class="ident" id="4471521">n</span><span class="op" id="4471522">-</span><span class="num" id="4471523">1</span><span class="op" id="4471524">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471527">re2</span>&nbsp;<span class="op" id="4471531">:=</span>&nbsp;<span class="ident" id="4471534">p</span><span class="op" id="4471535">.</span><span class="ident" id="4471536">stack</span><span class="op" id="4471541">[</span><span class="ident" id="4471542">n</span><span class="op" id="4471543">-</span><span class="num" id="4471544">2</span><span class="op" id="4471545">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471548">if</span>&nbsp;<span class="ident" id="4471551">re1</span><span class="op" id="4471554">.</span><span class="ident" id="4471555">Op</span>&nbsp;<span class="op" id="4471558">!=</span>&nbsp;<span class="ident" id="4471561">OpLiteral</span>&nbsp;<span class="op" id="4471571">||</span>&nbsp;<span class="ident" id="4471574">re2</span><span class="op" id="4471577">.</span><span class="ident" id="4471578">Op</span>&nbsp;<span class="op" id="4471581">!=</span>&nbsp;<span class="ident" id="4471584">OpLiteral</span>&nbsp;<span class="op" id="4471594">||</span>&nbsp;<span class="ident" id="4471597">re1</span><span class="op" id="4471600">.</span><span class="ident" id="4471601">Flags</span><span class="op" id="4471606">&amp;</span><span class="ident" id="4471607">FoldCase</span>&nbsp;<span class="op" id="4471616">!=</span>&nbsp;<span class="ident" id="4471619">re2</span><span class="op" id="4471622">.</span><span class="ident" id="4471623">Flags</span><span class="op" id="4471628">&amp;</span><span class="ident" id="4471629">FoldCase</span>&nbsp;<span class="op" id="4471638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471642">return</span>&nbsp;<span class="builtintype" id="4471649">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4471656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4471660">//&nbsp;Push&nbsp;re1&nbsp;into&nbsp;re2.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471683">re2</span><span class="op" id="4471686">.</span><span class="ident" id="4471687">Rune</span>&nbsp;<span class="op" id="4471692">=</span>&nbsp;<span class="builtinfunc" id="4471694">append</span><span class="op" id="4471700">(</span><span class="ident" id="4471701">re2</span><span class="op" id="4471704">.</span><span class="ident" id="4471705">Rune</span><span class="op" id="4471709">,</span>&nbsp;<span class="ident" id="4471711">re1</span><span class="op" id="4471714">.</span><span class="ident" id="4471715">Rune</span><span class="op" id="4471719">...</span><span class="op" id="4471722">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4471726">//&nbsp;Reuse&nbsp;re1&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471753">if</span>&nbsp;<span class="ident" id="4471756">r</span>&nbsp;<span class="op" id="4471758">&gt;=</span>&nbsp;<span class="num" id="4471761">0</span>&nbsp;<span class="op" id="4471763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471767">re1</span><span class="op" id="4471770">.</span><span class="ident" id="4471771">Rune</span>&nbsp;<span class="op" id="4471776">=</span>&nbsp;<span class="ident" id="4471778">re1</span><span class="op" id="4471781">.</span><span class="ident" id="4471782">Rune0</span><span class="op" id="4471787">[</span><span class="op" id="4471788">:</span><span class="num" id="4471789">1</span><span class="op" id="4471790">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471794">re1</span><span class="op" id="4471797">.</span><span class="ident" id="4471798">Rune</span><span class="op" id="4471802">[</span><span class="num" id="4471803">0</span><span class="op" id="4471804">]</span>&nbsp;<span class="op" id="4471806">=</span>&nbsp;<span class="ident" id="4471808">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471812">re1</span><span class="op" id="4471815">.</span><span class="ident" id="4471816">Flags</span>&nbsp;<span class="op" id="4471822">=</span>&nbsp;<span class="ident" id="4471824">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471832">return</span>&nbsp;<span class="builtintype" id="4471839">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4471845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471849">p</span><span class="op" id="4471850">.</span><span class="ident" id="4471851">stack</span>&nbsp;<span class="op" id="4471857">=</span>&nbsp;<span class="ident" id="4471859">p</span><span class="op" id="4471860">.</span><span class="ident" id="4471861">stack</span><span class="op" id="4471866">[</span><span class="op" id="4471867">:</span><span class="ident" id="4471868">n</span><span class="op" id="4471869">-</span><span class="num" id="4471870">1</span><span class="op" id="4471871">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4471874">p</span><span class="op" id="4471875">.</span><span class="ident" id="4471876">reuse</span><span class="op" id="4471881">(</span><span class="ident" id="4471882">re1</span><span class="op" id="4471885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4471888">return</span>&nbsp;<span class="builtintype" id="4471895">false</span>&nbsp;<span class="comment" id="4471901">//&nbsp;did&nbsp;not&nbsp;push&nbsp;r</span><br>
<span class="lineno"></span><span class="op" id="4471919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="4471922">//&nbsp;newLiteral&nbsp;returns&nbsp;a&nbsp;new&nbsp;OpLiteral&nbsp;Regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;flags</span><br>
<span class="lineno"></span><span class="keyword" id="4471988">func</span>&nbsp;<span class="op" id="4471993">(</span><span class="ident" id="4471994">p</span>&nbsp;<span class="op" id="4471996">*</span><span class="ident" id="4471997">parser</span><span class="op" id="4472003">)</span>&nbsp;<span class="ident" id="4472005">newLiteral</span><span class="op" id="4472015">(</span><span class="ident" id="4472016">r</span>&nbsp;<span class="builtintype" id="4472018">rune</span><span class="op" id="4472022">,</span>&nbsp;<span class="ident" id="4472024">flags</span>&nbsp;<span class="ident" id="4472030">Flags</span><span class="op" id="4472035">)</span>&nbsp;<span class="op" id="4472037">*</span><span class="ident" id="4472038">Regexp</span>&nbsp;<span class="op" id="4472045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472048">re</span>&nbsp;<span class="op" id="4472051">:=</span>&nbsp;<span class="ident" id="4472054">p</span><span class="op" id="4472055">.</span><span class="ident" id="4472056">newRegexp</span><span class="op" id="4472065">(</span><span class="ident" id="4472066">OpLiteral</span><span class="op" id="4472075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472078">re</span><span class="op" id="4472080">.</span><span class="ident" id="4472081">Flags</span>&nbsp;<span class="op" id="4472087">=</span>&nbsp;<span class="ident" id="4472089">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472096">if</span>&nbsp;<span class="ident" id="4472099">flags</span><span class="op" id="4472104">&amp;</span><span class="ident" id="4472105">FoldCase</span>&nbsp;<span class="op" id="4472114">!=</span>&nbsp;<span class="num" id="4472117">0</span>&nbsp;<span class="op" id="4472119">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472123">r</span>&nbsp;<span class="op" id="4472125">=</span>&nbsp;<span class="ident" id="4472127">minFoldRune</span><span class="op" id="4472138">(</span><span class="ident" id="4472139">r</span><span class="op" id="4472140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4472143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472146">re</span><span class="op" id="4472148">.</span><span class="ident" id="4472149">Rune0</span><span class="op" id="4472154">[</span><span class="num" id="4472155">0</span><span class="op" id="4472156">]</span>&nbsp;<span class="op" id="4472158">=</span>&nbsp;<span class="ident" id="4472160">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472163">re</span><span class="op" id="4472165">.</span><span class="ident" id="4472166">Rune</span>&nbsp;<span class="op" id="4472171">=</span>&nbsp;<span class="ident" id="4472173">re</span><span class="op" id="4472175">.</span><span class="ident" id="4472176">Rune0</span><span class="op" id="4472181">[</span><span class="op" id="4472182">:</span><span class="num" id="4472183">1</span><span class="op" id="4472184">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472187">return</span>&nbsp;<span class="ident" id="4472194">re</span><br>
<span class="lineno">190</span><span class="op" id="4472197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4472200">//&nbsp;minFoldRune&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;rune&nbsp;fold-equivalent&nbsp;to&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="4472262">func</span>&nbsp;<span class="ident" id="4472267">minFoldRune</span><span class="op" id="4472278">(</span><span class="ident" id="4472279">r</span>&nbsp;<span class="builtintype" id="4472281">rune</span><span class="op" id="4472285">)</span>&nbsp;<span class="builtintype" id="4472287">rune</span>&nbsp;<span class="op" id="4472292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472295">if</span>&nbsp;<span class="ident" id="4472298">r</span>&nbsp;<span class="op" id="4472300">&lt;</span>&nbsp;<span class="ident" id="4472302">minFold</span>&nbsp;<span class="op" id="4472310">||</span>&nbsp;<span class="ident" id="4472313">r</span>&nbsp;<span class="op" id="4472315">&gt;</span>&nbsp;<span class="ident" id="4472317">maxFold</span>&nbsp;<span class="op" id="4472325">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472329">return</span>&nbsp;<span class="ident" id="4472336">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4472339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472342">min</span>&nbsp;<span class="op" id="4472346">:=</span>&nbsp;<span class="ident" id="4472349">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472352">r0</span>&nbsp;<span class="op" id="4472355">:=</span>&nbsp;<span class="ident" id="4472358">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472361">for</span>&nbsp;<span class="ident" id="4472365">r</span>&nbsp;<span class="op" id="4472367">=</span>&nbsp;<span class="ident" id="4472369">unicode</span><span class="op" id="4472376">.</span><span class="ident" id="4472377">SimpleFold</span><span class="op" id="4472387">(</span><span class="ident" id="4472388">r</span><span class="op" id="4472389">)</span><span class="op" id="4472390">;</span>&nbsp;<span class="ident" id="4472392">r</span>&nbsp;<span class="op" id="4472394">!=</span>&nbsp;<span class="ident" id="4472397">r0</span><span class="op" id="4472399">;</span>&nbsp;<span class="ident" id="4472401">r</span>&nbsp;<span class="op" id="4472403">=</span>&nbsp;<span class="ident" id="4472405">unicode</span><span class="op" id="4472412">.</span><span class="ident" id="4472413">SimpleFold</span><span class="op" id="4472423">(</span><span class="ident" id="4472424">r</span><span class="op" id="4472425">)</span>&nbsp;<span class="op" id="4472427">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472431">if</span>&nbsp;<span class="ident" id="4472434">min</span>&nbsp;<span class="op" id="4472438">&gt;</span>&nbsp;<span class="ident" id="4472440">r</span>&nbsp;<span class="op" id="4472442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472447">min</span>&nbsp;<span class="op" id="4472451">=</span>&nbsp;<span class="ident" id="4472453">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4472457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4472460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472463">return</span>&nbsp;<span class="ident" id="4472470">min</span><br>
<span class="lineno">205</span><span class="op" id="4472474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4472477">//&nbsp;literal&nbsp;pushes&nbsp;a&nbsp;literal&nbsp;regexp&nbsp;for&nbsp;the&nbsp;rune&nbsp;r&nbsp;on&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="4472540">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="4472568">func</span>&nbsp;<span class="op" id="4472573">(</span><span class="ident" id="4472574">p</span>&nbsp;<span class="op" id="4472576">*</span><span class="ident" id="4472577">parser</span><span class="op" id="4472583">)</span>&nbsp;<span class="ident" id="4472585">literal</span><span class="op" id="4472592">(</span><span class="ident" id="4472593">r</span>&nbsp;<span class="builtintype" id="4472595">rune</span><span class="op" id="4472599">)</span>&nbsp;<span class="op" id="4472601">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472604">p</span><span class="op" id="4472605">.</span><span class="ident" id="4472606">push</span><span class="op" id="4472610">(</span><span class="ident" id="4472611">p</span><span class="op" id="4472612">.</span><span class="ident" id="4472613">newLiteral</span><span class="op" id="4472623">(</span><span class="ident" id="4472624">r</span><span class="op" id="4472625">,</span>&nbsp;<span class="ident" id="4472627">p</span><span class="op" id="4472628">.</span><span class="ident" id="4472629">flags</span><span class="op" id="4472634">)</span><span class="op" id="4472635">)</span><br>
<span class="lineno"></span><span class="op" id="4472637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4472640">//&nbsp;op&nbsp;pushes&nbsp;a&nbsp;regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;op&nbsp;onto&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="4472695">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno">215</span><span class="keyword" id="4472723">func</span>&nbsp;<span class="op" id="4472728">(</span><span class="ident" id="4472729">p</span>&nbsp;<span class="op" id="4472731">*</span><span class="ident" id="4472732">parser</span><span class="op" id="4472738">)</span>&nbsp;<span class="ident" id="4472740">op</span><span class="op" id="4472742">(</span><span class="ident" id="4472743">op</span>&nbsp;<span class="ident" id="4472746">Op</span><span class="op" id="4472748">)</span>&nbsp;<span class="op" id="4472750">*</span><span class="ident" id="4472751">Regexp</span>&nbsp;<span class="op" id="4472758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472761">re</span>&nbsp;<span class="op" id="4472764">:=</span>&nbsp;<span class="ident" id="4472767">p</span><span class="op" id="4472768">.</span><span class="ident" id="4472769">newRegexp</span><span class="op" id="4472778">(</span><span class="ident" id="4472779">op</span><span class="op" id="4472781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4472784">re</span><span class="op" id="4472786">.</span><span class="ident" id="4472787">Flags</span>&nbsp;<span class="op" id="4472793">=</span>&nbsp;<span class="ident" id="4472795">p</span><span class="op" id="4472796">.</span><span class="ident" id="4472797">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4472804">return</span>&nbsp;<span class="ident" id="4472811">p</span><span class="op" id="4472812">.</span><span class="ident" id="4472813">push</span><span class="op" id="4472817">(</span><span class="ident" id="4472818">re</span><span class="op" id="4472820">)</span><br>
<span class="lineno"></span><span class="op" id="4472822">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="4472825">//&nbsp;repeat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;stack&nbsp;element&nbsp;with&nbsp;itself&nbsp;repeated&nbsp;according&nbsp;to&nbsp;op,&nbsp;min,&nbsp;max.</span><br>
<span class="lineno"></span><span class="comment" id="4472914">//&nbsp;before&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;starting&nbsp;at&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="4472982">//&nbsp;after&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;following&nbsp;after&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="4473053">//&nbsp;repeat&nbsp;returns&nbsp;an&nbsp;updated&nbsp;&#39;after&#39;&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">225</span><span class="keyword" id="4473112">func</span>&nbsp;<span class="op" id="4473117">(</span><span class="ident" id="4473118">p</span>&nbsp;<span class="op" id="4473120">*</span><span class="ident" id="4473121">parser</span><span class="op" id="4473127">)</span>&nbsp;<span class="ident" id="4473129">repeat</span><span class="op" id="4473135">(</span><span class="ident" id="4473136">op</span>&nbsp;<span class="ident" id="4473139">Op</span><span class="op" id="4473141">,</span>&nbsp;<span class="ident" id="4473143">min</span><span class="op" id="4473146">,</span>&nbsp;<span class="ident" id="4473148">max</span>&nbsp;<span class="builtintype" id="4473152">int</span><span class="op" id="4473155">,</span>&nbsp;<span class="ident" id="4473157">before</span><span class="op" id="4473163">,</span>&nbsp;<span class="ident" id="4473165">after</span><span class="op" id="4473170">,</span>&nbsp;<span class="ident" id="4473172">lastRepeat</span>&nbsp;<span class="builtintype" id="4473183">string</span><span class="op" id="4473189">)</span>&nbsp;<span class="op" id="4473191">(</span><span class="builtintype" id="4473192">string</span><span class="op" id="4473198">,</span>&nbsp;<span class="builtintype" id="4473200">error</span><span class="op" id="4473205">)</span>&nbsp;<span class="op" id="4473207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473210">flags</span>&nbsp;<span class="op" id="4473216">:=</span>&nbsp;<span class="ident" id="4473219">p</span><span class="op" id="4473220">.</span><span class="ident" id="4473221">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473228">if</span>&nbsp;<span class="ident" id="4473231">p</span><span class="op" id="4473232">.</span><span class="ident" id="4473233">flags</span><span class="op" id="4473238">&amp;</span><span class="ident" id="4473239">PerlX</span>&nbsp;<span class="op" id="4473245">!=</span>&nbsp;<span class="num" id="4473248">0</span>&nbsp;<span class="op" id="4473250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473254">if</span>&nbsp;<span class="builtinfunc" id="4473257">len</span><span class="op" id="4473260">(</span><span class="ident" id="4473261">after</span><span class="op" id="4473266">)</span>&nbsp;<span class="op" id="4473268">&gt;</span>&nbsp;<span class="num" id="4473270">0</span>&nbsp;<span class="op" id="4473272">&amp;&amp;</span>&nbsp;<span class="ident" id="4473275">after</span><span class="op" id="4473280">[</span><span class="num" id="4473281">0</span><span class="op" id="4473282">]</span>&nbsp;<span class="op" id="4473284">==</span>&nbsp;<span class="string" id="4473287">&#39;?&#39;</span>&nbsp;<span class="op" id="4473291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473296">after</span>&nbsp;<span class="op" id="4473302">=</span>&nbsp;<span class="ident" id="4473304">after</span><span class="op" id="4473309">[</span><span class="num" id="4473310">1</span><span class="op" id="4473311">:</span><span class="op" id="4473312">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473317">flags</span>&nbsp;<span class="op" id="4473323">^=</span>&nbsp;<span class="ident" id="4473326">NonGreedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4473338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473342">if</span>&nbsp;<span class="ident" id="4473345">lastRepeat</span>&nbsp;<span class="op" id="4473356">!=</span>&nbsp;<span class="string" id="4473359">&#34;&#34;</span>&nbsp;<span class="op" id="4473362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473367">//&nbsp;In&nbsp;Perl&nbsp;it&nbsp;is&nbsp;not&nbsp;allowed&nbsp;to&nbsp;stack&nbsp;repetition&nbsp;operators:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473430">//&nbsp;a**&nbsp;is&nbsp;a&nbsp;syntax&nbsp;error,&nbsp;not&nbsp;a&nbsp;doubled&nbsp;star,&nbsp;and&nbsp;a++&nbsp;means</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4473493">//&nbsp;something&nbsp;else&nbsp;entirely,&nbsp;which&nbsp;we&nbsp;don&#39;t&nbsp;support!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473548">return</span>&nbsp;<span class="string" id="4473555">&#34;&#34;</span><span class="op" id="4473557">,</span>&nbsp;<span class="op" id="4473559">&amp;</span><span class="ident" id="4473560">Error</span><span class="op" id="4473565">{</span><span class="ident" id="4473566">ErrInvalidRepeatOp</span><span class="op" id="4473584">,</span>&nbsp;<span class="ident" id="4473586">lastRepeat</span><span class="op" id="4473596">[</span><span class="op" id="4473597">:</span><span class="builtinfunc" id="4473598">len</span><span class="op" id="4473601">(</span><span class="ident" id="4473602">lastRepeat</span><span class="op" id="4473612">)</span><span class="op" id="4473613">-</span><span class="builtinfunc" id="4473614">len</span><span class="op" id="4473617">(</span><span class="ident" id="4473618">after</span><span class="op" id="4473623">)</span><span class="op" id="4473624">]</span><span class="op" id="4473625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4473629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4473632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473635">n</span>&nbsp;<span class="op" id="4473637">:=</span>&nbsp;<span class="builtinfunc" id="4473640">len</span><span class="op" id="4473643">(</span><span class="ident" id="4473644">p</span><span class="op" id="4473645">.</span><span class="ident" id="4473646">stack</span><span class="op" id="4473651">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473654">if</span>&nbsp;<span class="ident" id="4473657">n</span>&nbsp;<span class="op" id="4473659">==</span>&nbsp;<span class="num" id="4473662">0</span>&nbsp;<span class="op" id="4473664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473668">return</span>&nbsp;<span class="string" id="4473675">&#34;&#34;</span><span class="op" id="4473677">,</span>&nbsp;<span class="op" id="4473679">&amp;</span><span class="ident" id="4473680">Error</span><span class="op" id="4473685">{</span><span class="ident" id="4473686">ErrMissingRepeatArgument</span><span class="op" id="4473710">,</span>&nbsp;<span class="ident" id="4473712">before</span><span class="op" id="4473718">[</span><span class="op" id="4473719">:</span><span class="builtinfunc" id="4473720">len</span><span class="op" id="4473723">(</span><span class="ident" id="4473724">before</span><span class="op" id="4473730">)</span><span class="op" id="4473731">-</span><span class="builtinfunc" id="4473732">len</span><span class="op" id="4473735">(</span><span class="ident" id="4473736">after</span><span class="op" id="4473741">)</span><span class="op" id="4473742">]</span><span class="op" id="4473743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4473746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473749">sub</span>&nbsp;<span class="op" id="4473753">:=</span>&nbsp;<span class="ident" id="4473756">p</span><span class="op" id="4473757">.</span><span class="ident" id="4473758">stack</span><span class="op" id="4473763">[</span><span class="ident" id="4473764">n</span><span class="op" id="4473765">-</span><span class="num" id="4473766">1</span><span class="op" id="4473767">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473770">if</span>&nbsp;<span class="ident" id="4473773">sub</span><span class="op" id="4473776">.</span><span class="ident" id="4473777">Op</span>&nbsp;<span class="op" id="4473780">&gt;=</span>&nbsp;<span class="ident" id="4473783">opPseudo</span>&nbsp;<span class="op" id="4473792">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4473796">return</span>&nbsp;<span class="string" id="4473803">&#34;&#34;</span><span class="op" id="4473805">,</span>&nbsp;<span class="op" id="4473807">&amp;</span><span class="ident" id="4473808">Error</span><span class="op" id="4473813">{</span><span class="ident" id="4473814">ErrMissingRepeatArgument</span><span class="op" id="4473838">,</span>&nbsp;<span class="ident" id="4473840">before</span><span class="op" id="4473846">[</span><span class="op" id="4473847">:</span><span class="builtinfunc" id="4473848">len</span><span class="op" id="4473851">(</span><span class="ident" id="4473852">before</span><span class="op" id="4473858">)</span><span class="op" id="4473859">-</span><span class="builtinfunc" id="4473860">len</span><span class="op" id="4473863">(</span><span class="ident" id="4473864">after</span><span class="op" id="4473869">)</span><span class="op" id="4473870">]</span><span class="op" id="4473871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4473874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473878">re</span>&nbsp;<span class="op" id="4473881">:=</span>&nbsp;<span class="ident" id="4473884">p</span><span class="op" id="4473885">.</span><span class="ident" id="4473886">newRegexp</span><span class="op" id="4473895">(</span><span class="ident" id="4473896">op</span><span class="op" id="4473898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473901">re</span><span class="op" id="4473903">.</span><span class="ident" id="4473904">Min</span>&nbsp;<span class="op" id="4473908">=</span>&nbsp;<span class="ident" id="4473910">min</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473915">re</span><span class="op" id="4473917">.</span><span class="ident" id="4473918">Max</span>&nbsp;<span class="op" id="4473922">=</span>&nbsp;<span class="ident" id="4473924">max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473929">re</span><span class="op" id="4473931">.</span><span class="ident" id="4473932">Flags</span>&nbsp;<span class="op" id="4473938">=</span>&nbsp;<span class="ident" id="4473940">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473947">re</span><span class="op" id="4473949">.</span><span class="ident" id="4473950">Sub</span>&nbsp;<span class="op" id="4473954">=</span>&nbsp;<span class="ident" id="4473956">re</span><span class="op" id="4473958">.</span><span class="ident" id="4473959">Sub0</span><span class="op" id="4473963">[</span><span class="op" id="4473964">:</span><span class="num" id="4473965">1</span><span class="op" id="4473966">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473969">re</span><span class="op" id="4473971">.</span><span class="ident" id="4473972">Sub</span><span class="op" id="4473975">[</span><span class="num" id="4473976">0</span><span class="op" id="4473977">]</span>&nbsp;<span class="op" id="4473979">=</span>&nbsp;<span class="ident" id="4473981">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4473986">p</span><span class="op" id="4473987">.</span><span class="ident" id="4473988">stack</span><span class="op" id="4473993">[</span><span class="ident" id="4473994">n</span><span class="op" id="4473995">-</span><span class="num" id="4473996">1</span><span class="op" id="4473997">]</span>&nbsp;<span class="op" id="4473999">=</span>&nbsp;<span class="ident" id="4474001">re</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474006">if</span>&nbsp;<span class="ident" id="4474009">op</span>&nbsp;<span class="op" id="4474012">==</span>&nbsp;<span class="ident" id="4474015">OpRepeat</span>&nbsp;<span class="op" id="4474024">&amp;&amp;</span>&nbsp;<span class="op" id="4474027">(</span><span class="ident" id="4474028">min</span>&nbsp;<span class="op" id="4474032">&gt;=</span>&nbsp;<span class="num" id="4474035">2</span>&nbsp;<span class="op" id="4474037">||</span>&nbsp;<span class="ident" id="4474040">max</span>&nbsp;<span class="op" id="4474044">&gt;=</span>&nbsp;<span class="num" id="4474047">2</span><span class="op" id="4474048">)</span>&nbsp;<span class="op" id="4474050">&amp;&amp;</span>&nbsp;<span class="op" id="4474053">!</span><span class="ident" id="4474054">repeatIsValid</span><span class="op" id="4474067">(</span><span class="ident" id="4474068">re</span><span class="op" id="4474070">,</span>&nbsp;<span class="num" id="4474072">1000</span><span class="op" id="4474076">)</span>&nbsp;<span class="op" id="4474078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474082">return</span>&nbsp;<span class="string" id="4474089">&#34;&#34;</span><span class="op" id="4474091">,</span>&nbsp;<span class="op" id="4474093">&amp;</span><span class="ident" id="4474094">Error</span><span class="op" id="4474099">{</span><span class="ident" id="4474100">ErrInvalidRepeatSize</span><span class="op" id="4474120">,</span>&nbsp;<span class="ident" id="4474122">before</span><span class="op" id="4474128">[</span><span class="op" id="4474129">:</span><span class="builtinfunc" id="4474130">len</span><span class="op" id="4474133">(</span><span class="ident" id="4474134">before</span><span class="op" id="4474140">)</span><span class="op" id="4474141">-</span><span class="builtinfunc" id="4474142">len</span><span class="op" id="4474145">(</span><span class="ident" id="4474146">after</span><span class="op" id="4474151">)</span><span class="op" id="4474152">]</span><span class="op" id="4474153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4474156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474160">return</span>&nbsp;<span class="ident" id="4474167">after</span><span class="op" id="4474172">,</span>&nbsp;<span class="ident" id="4474174">nil</span><br>
<span class="lineno"></span><span class="op" id="4474178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4474181">//&nbsp;repeatIsValid&nbsp;reports&nbsp;whether&nbsp;the&nbsp;repetition&nbsp;re&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="comment" id="4474242">//&nbsp;Valid&nbsp;means&nbsp;that&nbsp;the&nbsp;combination&nbsp;of&nbsp;the&nbsp;top-level&nbsp;repetition</span><br>
<span class="lineno">265</span><span class="comment" id="4474306">//&nbsp;and&nbsp;any&nbsp;inner&nbsp;repetitions&nbsp;does&nbsp;not&nbsp;exceed&nbsp;n&nbsp;copies&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4474367">//&nbsp;innermost&nbsp;thing.</span><br>
<span class="lineno"></span><span class="comment" id="4474387">//&nbsp;This&nbsp;function&nbsp;rewalks&nbsp;the&nbsp;regexp&nbsp;tree&nbsp;and&nbsp;is&nbsp;called&nbsp;for&nbsp;every&nbsp;repetition,</span><br>
<span class="lineno"></span><span class="comment" id="4474464">//&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;worry&nbsp;about&nbsp;inducing&nbsp;quadratic&nbsp;behavior&nbsp;in&nbsp;the&nbsp;parser.</span><br>
<span class="lineno"></span><span class="comment" id="4474536">//&nbsp;We&nbsp;avoid&nbsp;this&nbsp;by&nbsp;only&nbsp;calling&nbsp;repeatIsValid&nbsp;when&nbsp;min&nbsp;or&nbsp;max&nbsp;&gt;=&nbsp;2.</span><br>
<span class="lineno">270</span><span class="comment" id="4474605">//&nbsp;In&nbsp;that&nbsp;case&nbsp;the&nbsp;depth&nbsp;of&nbsp;any&nbsp;&gt;=&nbsp;2&nbsp;nesting&nbsp;can&nbsp;only&nbsp;get&nbsp;to&nbsp;9&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="4474677">//&nbsp;triggering&nbsp;a&nbsp;parse&nbsp;error,&nbsp;so&nbsp;each&nbsp;subtree&nbsp;can&nbsp;only&nbsp;be&nbsp;rewalked&nbsp;9&nbsp;times.</span><br>
<span class="lineno"></span><span class="keyword" id="4474752">func</span>&nbsp;<span class="ident" id="4474757">repeatIsValid</span><span class="op" id="4474770">(</span><span class="ident" id="4474771">re</span>&nbsp;<span class="op" id="4474774">*</span><span class="ident" id="4474775">Regexp</span><span class="op" id="4474781">,</span>&nbsp;<span class="ident" id="4474783">n</span>&nbsp;<span class="builtintype" id="4474785">int</span><span class="op" id="4474788">)</span>&nbsp;<span class="builtintype" id="4474790">bool</span>&nbsp;<span class="op" id="4474795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474798">if</span>&nbsp;<span class="ident" id="4474801">re</span><span class="op" id="4474803">.</span><span class="ident" id="4474804">Op</span>&nbsp;<span class="op" id="4474807">==</span>&nbsp;<span class="ident" id="4474810">OpRepeat</span>&nbsp;<span class="op" id="4474819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4474823">m</span>&nbsp;<span class="op" id="4474825">:=</span>&nbsp;<span class="ident" id="4474828">re</span><span class="op" id="4474830">.</span><span class="ident" id="4474831">Max</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474837">if</span>&nbsp;<span class="ident" id="4474840">m</span>&nbsp;<span class="op" id="4474842">==</span>&nbsp;<span class="num" id="4474845">0</span>&nbsp;<span class="op" id="4474847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474852">return</span>&nbsp;<span class="builtintype" id="4474859">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4474866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474870">if</span>&nbsp;<span class="ident" id="4474873">m</span>&nbsp;<span class="op" id="4474875">&lt;</span>&nbsp;<span class="num" id="4474877">0</span>&nbsp;<span class="op" id="4474879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4474884">m</span>&nbsp;<span class="op" id="4474886">=</span>&nbsp;<span class="ident" id="4474888">re</span><span class="op" id="4474890">.</span><span class="ident" id="4474891">Min</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4474897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474901">if</span>&nbsp;<span class="ident" id="4474904">m</span>&nbsp;<span class="op" id="4474906">&gt;</span>&nbsp;<span class="ident" id="4474908">n</span>&nbsp;<span class="op" id="4474910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474915">return</span>&nbsp;<span class="builtintype" id="4474922">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4474930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474934">if</span>&nbsp;<span class="ident" id="4474937">m</span>&nbsp;<span class="op" id="4474939">&gt;</span>&nbsp;<span class="num" id="4474941">0</span>&nbsp;<span class="op" id="4474943">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4474948">n</span>&nbsp;<span class="op" id="4474950">/=</span>&nbsp;<span class="ident" id="4474953">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4474957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4474960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474963">for</span>&nbsp;<span class="ident" id="4474967">_</span><span class="op" id="4474968">,</span>&nbsp;<span class="ident" id="4474970">sub</span>&nbsp;<span class="op" id="4474974">:=</span>&nbsp;<span class="keyword" id="4474977">range</span>&nbsp;<span class="ident" id="4474983">re</span><span class="op" id="4474985">.</span><span class="ident" id="4474986">Sub</span>&nbsp;<span class="op" id="4474990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4474994">if</span>&nbsp;<span class="op" id="4474997">!</span><span class="ident" id="4474998">repeatIsValid</span><span class="op" id="4475011">(</span><span class="ident" id="4475012">sub</span><span class="op" id="4475015">,</span>&nbsp;<span class="ident" id="4475017">n</span><span class="op" id="4475018">)</span>&nbsp;<span class="op" id="4475020">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4475025">return</span>&nbsp;<span class="builtintype" id="4475032">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4475040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4475043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4475046">return</span>&nbsp;<span class="builtintype" id="4475053">true</span><br>
<span class="lineno"></span><span class="op" id="4475058">}</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span><span class="comment" id="4475061">//&nbsp;concat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;|&#39;&nbsp;or&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;concatenation.</span><br>
<span class="lineno"></span><span class="keyword" id="4475156">func</span>&nbsp;<span class="op" id="4475161">(</span><span class="ident" id="4475162">p</span>&nbsp;<span class="op" id="4475164">*</span><span class="ident" id="4475165">parser</span><span class="op" id="4475171">)</span>&nbsp;<span class="ident" id="4475173">concat</span><span class="op" id="4475179">(</span><span class="op" id="4475180">)</span>&nbsp;<span class="op" id="4475182">*</span><span class="ident" id="4475183">Regexp</span>&nbsp;<span class="op" id="4475190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475193">p</span><span class="op" id="4475194">.</span><span class="ident" id="4475195">maybeConcat</span><span class="op" id="4475206">(</span><span class="op" id="4475207">-</span><span class="num" id="4475208">1</span><span class="op" id="4475209">,</span>&nbsp;<span class="num" id="4475211">0</span><span class="op" id="4475212">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475216">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;|&nbsp;or&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475262">i</span>&nbsp;<span class="op" id="4475264">:=</span>&nbsp;<span class="builtinfunc" id="4475267">len</span><span class="op" id="4475270">(</span><span class="ident" id="4475271">p</span><span class="op" id="4475272">.</span><span class="ident" id="4475273">stack</span><span class="op" id="4475278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4475281">for</span>&nbsp;<span class="ident" id="4475285">i</span>&nbsp;<span class="op" id="4475287">&gt;</span>&nbsp;<span class="num" id="4475289">0</span>&nbsp;<span class="op" id="4475291">&amp;&amp;</span>&nbsp;<span class="ident" id="4475294">p</span><span class="op" id="4475295">.</span><span class="ident" id="4475296">stack</span><span class="op" id="4475301">[</span><span class="ident" id="4475302">i</span><span class="op" id="4475303">-</span><span class="num" id="4475304">1</span><span class="op" id="4475305">]</span><span class="op" id="4475306">.</span><span class="ident" id="4475307">Op</span>&nbsp;<span class="op" id="4475310">&lt;</span>&nbsp;<span class="ident" id="4475312">opPseudo</span>&nbsp;<span class="op" id="4475321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475325">i</span><span class="op" id="4475326">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4475330">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475333">subs</span>&nbsp;<span class="op" id="4475338">:=</span>&nbsp;<span class="ident" id="4475341">p</span><span class="op" id="4475342">.</span><span class="ident" id="4475343">stack</span><span class="op" id="4475348">[</span><span class="ident" id="4475349">i</span><span class="op" id="4475350">:</span><span class="op" id="4475351">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475354">p</span><span class="op" id="4475355">.</span><span class="ident" id="4475356">stack</span>&nbsp;<span class="op" id="4475362">=</span>&nbsp;<span class="ident" id="4475364">p</span><span class="op" id="4475365">.</span><span class="ident" id="4475366">stack</span><span class="op" id="4475371">[</span><span class="op" id="4475372">:</span><span class="ident" id="4475373">i</span><span class="op" id="4475374">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475378">//&nbsp;Empty&nbsp;concatenation&nbsp;is&nbsp;special&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4475419">if</span>&nbsp;<span class="builtinfunc" id="4475422">len</span><span class="op" id="4475425">(</span><span class="ident" id="4475426">subs</span><span class="op" id="4475430">)</span>&nbsp;<span class="op" id="4475432">==</span>&nbsp;<span class="num" id="4475435">0</span>&nbsp;<span class="op" id="4475437">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4475441">return</span>&nbsp;<span class="ident" id="4475448">p</span><span class="op" id="4475449">.</span><span class="ident" id="4475450">push</span><span class="op" id="4475454">(</span><span class="ident" id="4475455">p</span><span class="op" id="4475456">.</span><span class="ident" id="4475457">newRegexp</span><span class="op" id="4475466">(</span><span class="ident" id="4475467">OpEmptyMatch</span><span class="op" id="4475479">)</span><span class="op" id="4475480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4475483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4475487">return</span>&nbsp;<span class="ident" id="4475494">p</span><span class="op" id="4475495">.</span><span class="ident" id="4475496">push</span><span class="op" id="4475500">(</span><span class="ident" id="4475501">p</span><span class="op" id="4475502">.</span><span class="ident" id="4475503">collapse</span><span class="op" id="4475511">(</span><span class="ident" id="4475512">subs</span><span class="op" id="4475516">,</span>&nbsp;<span class="ident" id="4475518">OpConcat</span><span class="op" id="4475526">)</span><span class="op" id="4475527">)</span><br>
<span class="lineno"></span><span class="op" id="4475529">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="4475532">//&nbsp;alternate&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="4475621">func</span>&nbsp;<span class="op" id="4475626">(</span><span class="ident" id="4475627">p</span>&nbsp;<span class="op" id="4475629">*</span><span class="ident" id="4475630">parser</span><span class="op" id="4475636">)</span>&nbsp;<span class="ident" id="4475638">alternate</span><span class="op" id="4475647">(</span><span class="op" id="4475648">)</span>&nbsp;<span class="op" id="4475650">*</span><span class="ident" id="4475651">Regexp</span>&nbsp;<span class="op" id="4475658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475661">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475702">//&nbsp;There&nbsp;are&nbsp;no&nbsp;|&nbsp;above&nbsp;(.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475730">i</span>&nbsp;<span class="op" id="4475732">:=</span>&nbsp;<span class="builtinfunc" id="4475735">len</span><span class="op" id="4475738">(</span><span class="ident" id="4475739">p</span><span class="op" id="4475740">.</span><span class="ident" id="4475741">stack</span><span class="op" id="4475746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4475749">for</span>&nbsp;<span class="ident" id="4475753">i</span>&nbsp;<span class="op" id="4475755">&gt;</span>&nbsp;<span class="num" id="4475757">0</span>&nbsp;<span class="op" id="4475759">&amp;&amp;</span>&nbsp;<span class="ident" id="4475762">p</span><span class="op" id="4475763">.</span><span class="ident" id="4475764">stack</span><span class="op" id="4475769">[</span><span class="ident" id="4475770">i</span><span class="op" id="4475771">-</span><span class="num" id="4475772">1</span><span class="op" id="4475773">]</span><span class="op" id="4475774">.</span><span class="ident" id="4475775">Op</span>&nbsp;<span class="op" id="4475778">&lt;</span>&nbsp;<span class="ident" id="4475780">opPseudo</span>&nbsp;<span class="op" id="4475789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475793">i</span><span class="op" id="4475794">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4475798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475801">subs</span>&nbsp;<span class="op" id="4475806">:=</span>&nbsp;<span class="ident" id="4475809">p</span><span class="op" id="4475810">.</span><span class="ident" id="4475811">stack</span><span class="op" id="4475816">[</span><span class="ident" id="4475817">i</span><span class="op" id="4475818">:</span><span class="op" id="4475819">]</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475822">p</span><span class="op" id="4475823">.</span><span class="ident" id="4475824">stack</span>&nbsp;<span class="op" id="4475830">=</span>&nbsp;<span class="ident" id="4475832">p</span><span class="op" id="4475833">.</span><span class="ident" id="4475834">stack</span><span class="op" id="4475839">[</span><span class="op" id="4475840">:</span><span class="ident" id="4475841">i</span><span class="op" id="4475842">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475846">//&nbsp;Make&nbsp;sure&nbsp;top&nbsp;class&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475880">//&nbsp;All&nbsp;the&nbsp;others&nbsp;already&nbsp;are&nbsp;(see&nbsp;swapVerticalBar).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4475934">if</span>&nbsp;<span class="builtinfunc" id="4475937">len</span><span class="op" id="4475940">(</span><span class="ident" id="4475941">subs</span><span class="op" id="4475945">)</span>&nbsp;<span class="op" id="4475947">&gt;</span>&nbsp;<span class="num" id="4475949">0</span>&nbsp;<span class="op" id="4475951">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4475955">cleanAlt</span><span class="op" id="4475963">(</span><span class="ident" id="4475964">subs</span><span class="op" id="4475968">[</span><span class="builtinfunc" id="4475969">len</span><span class="op" id="4475972">(</span><span class="ident" id="4475973">subs</span><span class="op" id="4475977">)</span><span class="op" id="4475978">-</span><span class="num" id="4475979">1</span><span class="op" id="4475980">]</span><span class="op" id="4475981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4475984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4475988">//&nbsp;Empty&nbsp;alternate&nbsp;is&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476024">//&nbsp;(shouldn&#39;t&nbsp;happen&nbsp;but&nbsp;easy&nbsp;to&nbsp;handle).</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476067">if</span>&nbsp;<span class="builtinfunc" id="4476070">len</span><span class="op" id="4476073">(</span><span class="ident" id="4476074">subs</span><span class="op" id="4476078">)</span>&nbsp;<span class="op" id="4476080">==</span>&nbsp;<span class="num" id="4476083">0</span>&nbsp;<span class="op" id="4476085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476089">return</span>&nbsp;<span class="ident" id="4476096">p</span><span class="op" id="4476097">.</span><span class="ident" id="4476098">push</span><span class="op" id="4476102">(</span><span class="ident" id="4476103">p</span><span class="op" id="4476104">.</span><span class="ident" id="4476105">newRegexp</span><span class="op" id="4476114">(</span><span class="ident" id="4476115">OpNoMatch</span><span class="op" id="4476124">)</span><span class="op" id="4476125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4476128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476132">return</span>&nbsp;<span class="ident" id="4476139">p</span><span class="op" id="4476140">.</span><span class="ident" id="4476141">push</span><span class="op" id="4476145">(</span><span class="ident" id="4476146">p</span><span class="op" id="4476147">.</span><span class="ident" id="4476148">collapse</span><span class="op" id="4476156">(</span><span class="ident" id="4476157">subs</span><span class="op" id="4476161">,</span>&nbsp;<span class="ident" id="4476163">OpAlternate</span><span class="op" id="4476174">)</span><span class="op" id="4476175">)</span><br>
<span class="lineno">340</span><span class="op" id="4476177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4476180">//&nbsp;cleanAlt&nbsp;cleans&nbsp;re&nbsp;for&nbsp;eventual&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="4476244">func</span>&nbsp;<span class="ident" id="4476249">cleanAlt</span><span class="op" id="4476257">(</span><span class="ident" id="4476258">re</span>&nbsp;<span class="op" id="4476261">*</span><span class="ident" id="4476262">Regexp</span><span class="op" id="4476268">)</span>&nbsp;<span class="op" id="4476270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476273">switch</span>&nbsp;<span class="ident" id="4476280">re</span><span class="op" id="4476282">.</span><span class="ident" id="4476283">Op</span>&nbsp;<span class="op" id="4476286">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476289">case</span>&nbsp;<span class="ident" id="4476294">OpCharClass</span><span class="op" id="4476305">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476309">re</span><span class="op" id="4476311">.</span><span class="ident" id="4476312">Rune</span>&nbsp;<span class="op" id="4476317">=</span>&nbsp;<span class="ident" id="4476319">cleanClass</span><span class="op" id="4476329">(</span><span class="op" id="4476330">&amp;</span><span class="ident" id="4476331">re</span><span class="op" id="4476333">.</span><span class="ident" id="4476334">Rune</span><span class="op" id="4476338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476342">if</span>&nbsp;<span class="builtinfunc" id="4476345">len</span><span class="op" id="4476348">(</span><span class="ident" id="4476349">re</span><span class="op" id="4476351">.</span><span class="ident" id="4476352">Rune</span><span class="op" id="4476356">)</span>&nbsp;<span class="op" id="4476358">==</span>&nbsp;<span class="num" id="4476361">2</span>&nbsp;<span class="op" id="4476363">&amp;&amp;</span>&nbsp;<span class="ident" id="4476366">re</span><span class="op" id="4476368">.</span><span class="ident" id="4476369">Rune</span><span class="op" id="4476373">[</span><span class="num" id="4476374">0</span><span class="op" id="4476375">]</span>&nbsp;<span class="op" id="4476377">==</span>&nbsp;<span class="num" id="4476380">0</span>&nbsp;<span class="op" id="4476382">&amp;&amp;</span>&nbsp;<span class="ident" id="4476385">re</span><span class="op" id="4476387">.</span><span class="ident" id="4476388">Rune</span><span class="op" id="4476392">[</span><span class="num" id="4476393">1</span><span class="op" id="4476394">]</span>&nbsp;<span class="op" id="4476396">==</span>&nbsp;<span class="ident" id="4476399">unicode</span><span class="op" id="4476406">.</span><span class="ident" id="4476407">MaxRune</span>&nbsp;<span class="op" id="4476415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476420">re</span><span class="op" id="4476422">.</span><span class="ident" id="4476423">Rune</span>&nbsp;<span class="op" id="4476428">=</span>&nbsp;<span class="ident" id="4476430">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476437">re</span><span class="op" id="4476439">.</span><span class="ident" id="4476440">Op</span>&nbsp;<span class="op" id="4476443">=</span>&nbsp;<span class="ident" id="4476445">OpAnyChar</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476458">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4476467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476471">if</span>&nbsp;<span class="builtinfunc" id="4476474">len</span><span class="op" id="4476477">(</span><span class="ident" id="4476478">re</span><span class="op" id="4476480">.</span><span class="ident" id="4476481">Rune</span><span class="op" id="4476485">)</span>&nbsp;<span class="op" id="4476487">==</span>&nbsp;<span class="num" id="4476490">4</span>&nbsp;<span class="op" id="4476492">&amp;&amp;</span>&nbsp;<span class="ident" id="4476495">re</span><span class="op" id="4476497">.</span><span class="ident" id="4476498">Rune</span><span class="op" id="4476502">[</span><span class="num" id="4476503">0</span><span class="op" id="4476504">]</span>&nbsp;<span class="op" id="4476506">==</span>&nbsp;<span class="num" id="4476509">0</span>&nbsp;<span class="op" id="4476511">&amp;&amp;</span>&nbsp;<span class="ident" id="4476514">re</span><span class="op" id="4476516">.</span><span class="ident" id="4476517">Rune</span><span class="op" id="4476521">[</span><span class="num" id="4476522">1</span><span class="op" id="4476523">]</span>&nbsp;<span class="op" id="4476525">==</span>&nbsp;<span class="string" id="4476528">&#39;\n&#39;</span><span class="op" id="4476532">-</span><span class="num" id="4476533">1</span>&nbsp;<span class="op" id="4476535">&amp;&amp;</span>&nbsp;<span class="ident" id="4476538">re</span><span class="op" id="4476540">.</span><span class="ident" id="4476541">Rune</span><span class="op" id="4476545">[</span><span class="num" id="4476546">2</span><span class="op" id="4476547">]</span>&nbsp;<span class="op" id="4476549">==</span>&nbsp;<span class="string" id="4476552">&#39;\n&#39;</span><span class="op" id="4476556">+</span><span class="num" id="4476557">1</span>&nbsp;<span class="op" id="4476559">&amp;&amp;</span>&nbsp;<span class="ident" id="4476562">re</span><span class="op" id="4476564">.</span><span class="ident" id="4476565">Rune</span><span class="op" id="4476569">[</span><span class="num" id="4476570">3</span><span class="op" id="4476571">]</span>&nbsp;<span class="op" id="4476573">==</span>&nbsp;<span class="ident" id="4476576">unicode</span><span class="op" id="4476583">.</span><span class="ident" id="4476584">MaxRune</span>&nbsp;<span class="op" id="4476592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476597">re</span><span class="op" id="4476599">.</span><span class="ident" id="4476600">Rune</span>&nbsp;<span class="op" id="4476605">=</span>&nbsp;<span class="ident" id="4476607">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476614">re</span><span class="op" id="4476616">.</span><span class="ident" id="4476617">Op</span>&nbsp;<span class="op" id="4476620">=</span>&nbsp;<span class="ident" id="4476622">OpAnyCharNotNL</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476640">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4476649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4476653">if</span>&nbsp;<span class="builtinfunc" id="4476656">cap</span><span class="op" id="4476659">(</span><span class="ident" id="4476660">re</span><span class="op" id="4476662">.</span><span class="ident" id="4476663">Rune</span><span class="op" id="4476667">)</span><span class="op" id="4476668">-</span><span class="builtinfunc" id="4476669">len</span><span class="op" id="4476672">(</span><span class="ident" id="4476673">re</span><span class="op" id="4476675">.</span><span class="ident" id="4476676">Rune</span><span class="op" id="4476680">)</span>&nbsp;<span class="op" id="4476682">&gt;</span>&nbsp;<span class="num" id="4476684">100</span>&nbsp;<span class="op" id="4476688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476693">//&nbsp;re.Rune&nbsp;will&nbsp;not&nbsp;grow&nbsp;any&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4476731">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;or&nbsp;inline&nbsp;to&nbsp;reclaim&nbsp;storage.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4476779">re</span><span class="op" id="4476781">.</span><span class="ident" id="4476782">Rune</span>&nbsp;<span class="op" id="4476787">=</span>&nbsp;<span class="builtinfunc" id="4476789">append</span><span class="op" id="4476795">(</span><span class="ident" id="4476796">re</span><span class="op" id="4476798">.</span><span class="ident" id="4476799">Rune0</span><span class="op" id="4476804">[</span><span class="op" id="4476805">:</span><span class="num" id="4476806">0</span><span class="op" id="4476807">]</span><span class="op" id="4476808">,</span>&nbsp;<span class="ident" id="4476810">re</span><span class="op" id="4476812">.</span><span class="ident" id="4476813">Rune</span><span class="op" id="4476817">...</span><span class="op" id="4476820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4476824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4476827">}</span><br>
<span class="lineno"></span><span class="op" id="4476829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="4476832">//&nbsp;collapse&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;applying&nbsp;op&nbsp;to&nbsp;sub.</span><br>
<span class="lineno"></span><span class="comment" id="4476886">//&nbsp;If&nbsp;sub&nbsp;contains&nbsp;op&nbsp;nodes,&nbsp;they&nbsp;all&nbsp;get&nbsp;hoisted&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="4476939">//&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;never&nbsp;a&nbsp;concat&nbsp;of&nbsp;a&nbsp;concat&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="4476992">//&nbsp;alternate&nbsp;of&nbsp;an&nbsp;alternate.</span><br>
<span class="lineno"></span><span class="keyword" id="4477022">func</span>&nbsp;<span class="op" id="4477027">(</span><span class="ident" id="4477028">p</span>&nbsp;<span class="op" id="4477030">*</span><span class="ident" id="4477031">parser</span><span class="op" id="4477037">)</span>&nbsp;<span class="ident" id="4477039">collapse</span><span class="op" id="4477047">(</span><span class="ident" id="4477048">subs</span>&nbsp;<span class="op" id="4477053">[</span><span class="op" id="4477054">]</span><span class="op" id="4477055">*</span><span class="ident" id="4477056">Regexp</span><span class="op" id="4477062">,</span>&nbsp;<span class="ident" id="4477064">op</span>&nbsp;<span class="ident" id="4477067">Op</span><span class="op" id="4477069">)</span>&nbsp;<span class="op" id="4477071">*</span><span class="ident" id="4477072">Regexp</span>&nbsp;<span class="op" id="4477079">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477082">if</span>&nbsp;<span class="builtinfunc" id="4477085">len</span><span class="op" id="4477088">(</span><span class="ident" id="4477089">subs</span><span class="op" id="4477093">)</span>&nbsp;<span class="op" id="4477095">==</span>&nbsp;<span class="num" id="4477098">1</span>&nbsp;<span class="op" id="4477100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477104">return</span>&nbsp;<span class="ident" id="4477111">subs</span><span class="op" id="4477115">[</span><span class="num" id="4477116">0</span><span class="op" id="4477117">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477123">re</span>&nbsp;<span class="op" id="4477126">:=</span>&nbsp;<span class="ident" id="4477129">p</span><span class="op" id="4477130">.</span><span class="ident" id="4477131">newRegexp</span><span class="op" id="4477140">(</span><span class="ident" id="4477141">op</span><span class="op" id="4477143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477146">re</span><span class="op" id="4477148">.</span><span class="ident" id="4477149">Sub</span>&nbsp;<span class="op" id="4477153">=</span>&nbsp;<span class="ident" id="4477155">re</span><span class="op" id="4477157">.</span><span class="ident" id="4477158">Sub0</span><span class="op" id="4477162">[</span><span class="op" id="4477163">:</span><span class="num" id="4477164">0</span><span class="op" id="4477165">]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477168">for</span>&nbsp;<span class="ident" id="4477172">_</span><span class="op" id="4477173">,</span>&nbsp;<span class="ident" id="4477175">sub</span>&nbsp;<span class="op" id="4477179">:=</span>&nbsp;<span class="keyword" id="4477182">range</span>&nbsp;<span class="ident" id="4477188">subs</span>&nbsp;<span class="op" id="4477193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477197">if</span>&nbsp;<span class="ident" id="4477200">sub</span><span class="op" id="4477203">.</span><span class="ident" id="4477204">Op</span>&nbsp;<span class="op" id="4477207">==</span>&nbsp;<span class="ident" id="4477210">op</span>&nbsp;<span class="op" id="4477213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477218">re</span><span class="op" id="4477220">.</span><span class="ident" id="4477221">Sub</span>&nbsp;<span class="op" id="4477225">=</span>&nbsp;<span class="builtinfunc" id="4477227">append</span><span class="op" id="4477233">(</span><span class="ident" id="4477234">re</span><span class="op" id="4477236">.</span><span class="ident" id="4477237">Sub</span><span class="op" id="4477240">,</span>&nbsp;<span class="ident" id="4477242">sub</span><span class="op" id="4477245">.</span><span class="ident" id="4477246">Sub</span><span class="op" id="4477249">...</span><span class="op" id="4477252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477257">p</span><span class="op" id="4477258">.</span><span class="ident" id="4477259">reuse</span><span class="op" id="4477264">(</span><span class="ident" id="4477265">sub</span><span class="op" id="4477268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477272">}</span>&nbsp;<span class="keyword" id="4477274">else</span>&nbsp;<span class="op" id="4477279">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477284">re</span><span class="op" id="4477286">.</span><span class="ident" id="4477287">Sub</span>&nbsp;<span class="op" id="4477291">=</span>&nbsp;<span class="builtinfunc" id="4477293">append</span><span class="op" id="4477299">(</span><span class="ident" id="4477300">re</span><span class="op" id="4477302">.</span><span class="ident" id="4477303">Sub</span><span class="op" id="4477306">,</span>&nbsp;<span class="ident" id="4477308">sub</span><span class="op" id="4477311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477321">if</span>&nbsp;<span class="ident" id="4477324">op</span>&nbsp;<span class="op" id="4477327">==</span>&nbsp;<span class="ident" id="4477330">OpAlternate</span>&nbsp;<span class="op" id="4477342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477346">re</span><span class="op" id="4477348">.</span><span class="ident" id="4477349">Sub</span>&nbsp;<span class="op" id="4477353">=</span>&nbsp;<span class="ident" id="4477355">p</span><span class="op" id="4477356">.</span><span class="ident" id="4477357">factor</span><span class="op" id="4477363">(</span><span class="ident" id="4477364">re</span><span class="op" id="4477366">.</span><span class="ident" id="4477367">Sub</span><span class="op" id="4477370">,</span>&nbsp;<span class="ident" id="4477372">re</span><span class="op" id="4477374">.</span><span class="ident" id="4477375">Flags</span><span class="op" id="4477380">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477384">if</span>&nbsp;<span class="builtinfunc" id="4477387">len</span><span class="op" id="4477390">(</span><span class="ident" id="4477391">re</span><span class="op" id="4477393">.</span><span class="ident" id="4477394">Sub</span><span class="op" id="4477397">)</span>&nbsp;<span class="op" id="4477399">==</span>&nbsp;<span class="num" id="4477402">1</span>&nbsp;<span class="op" id="4477404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477409">old</span>&nbsp;<span class="op" id="4477413">:=</span>&nbsp;<span class="ident" id="4477416">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477422">re</span>&nbsp;<span class="op" id="4477425">=</span>&nbsp;<span class="ident" id="4477427">re</span><span class="op" id="4477429">.</span><span class="ident" id="4477430">Sub</span><span class="op" id="4477433">[</span><span class="num" id="4477434">0</span><span class="op" id="4477435">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4477440">p</span><span class="op" id="4477441">.</span><span class="ident" id="4477442">reuse</span><span class="op" id="4477447">(</span><span class="ident" id="4477448">old</span><span class="op" id="4477451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477455">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477461">return</span>&nbsp;<span class="ident" id="4477468">re</span><br>
<span class="lineno"></span><span class="op" id="4477471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4477474">//&nbsp;factor&nbsp;factors&nbsp;common&nbsp;prefixes&nbsp;from&nbsp;the&nbsp;alternation&nbsp;list&nbsp;sub.</span><br>
<span class="lineno">395</span><span class="comment" id="4477539">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;replacement&nbsp;list&nbsp;that&nbsp;reuses&nbsp;the&nbsp;same&nbsp;storage&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4477605">//&nbsp;frees&nbsp;(passes&nbsp;to&nbsp;p.reuse)&nbsp;any&nbsp;removed&nbsp;*Regexps.</span><br>
<span class="lineno"></span><span class="comment" id="4477656">//</span><br>
<span class="lineno"></span><span class="comment" id="4477659">//&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="4477675">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ABC|ABD|AEF|BCX|BCY</span><br>
<span class="lineno">400</span><span class="comment" id="4477702">//&nbsp;simplifies&nbsp;by&nbsp;literal&nbsp;prefix&nbsp;extraction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4477748">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B(C|D)|EF)|BC(X|Y)</span><br>
<span class="lineno"></span><span class="comment" id="4477776">//&nbsp;which&nbsp;simplifies&nbsp;by&nbsp;character&nbsp;class&nbsp;introduction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4477831">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B[CD]|EF)|BC[XY]</span><br>
<span class="lineno"></span><span class="comment" id="4477857">//</span><br>
<span class="lineno">405</span><span class="keyword" id="4477860">func</span>&nbsp;<span class="op" id="4477865">(</span><span class="ident" id="4477866">p</span>&nbsp;<span class="op" id="4477868">*</span><span class="ident" id="4477869">parser</span><span class="op" id="4477875">)</span>&nbsp;<span class="ident" id="4477877">factor</span><span class="op" id="4477883">(</span><span class="ident" id="4477884">sub</span>&nbsp;<span class="op" id="4477888">[</span><span class="op" id="4477889">]</span><span class="op" id="4477890">*</span><span class="ident" id="4477891">Regexp</span><span class="op" id="4477897">,</span>&nbsp;<span class="ident" id="4477899">flags</span>&nbsp;<span class="ident" id="4477905">Flags</span><span class="op" id="4477910">)</span>&nbsp;<span class="op" id="4477912">[</span><span class="op" id="4477913">]</span><span class="op" id="4477914">*</span><span class="ident" id="4477915">Regexp</span>&nbsp;<span class="op" id="4477922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477925">if</span>&nbsp;<span class="builtinfunc" id="4477928">len</span><span class="op" id="4477931">(</span><span class="ident" id="4477932">sub</span><span class="op" id="4477935">)</span>&nbsp;<span class="op" id="4477937">&lt;</span>&nbsp;<span class="num" id="4477939">2</span>&nbsp;<span class="op" id="4477941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4477945">return</span>&nbsp;<span class="ident" id="4477952">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4477957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4477961">//&nbsp;Round&nbsp;1:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;literal&nbsp;prefixes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478010">var</span>&nbsp;<span class="ident" id="4478014">str</span>&nbsp;<span class="op" id="4478018">[</span><span class="op" id="4478019">]</span><span class="builtintype" id="4478020">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478026">var</span>&nbsp;<span class="ident" id="4478030">strflags</span>&nbsp;<span class="ident" id="4478039">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4478046">start</span>&nbsp;<span class="op" id="4478052">:=</span>&nbsp;<span class="num" id="4478055">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4478058">out</span>&nbsp;<span class="op" id="4478062">:=</span>&nbsp;<span class="ident" id="4478065">sub</span><span class="op" id="4478068">[</span><span class="op" id="4478069">:</span><span class="num" id="4478070">0</span><span class="op" id="4478071">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478074">for</span>&nbsp;<span class="ident" id="4478078">i</span>&nbsp;<span class="op" id="4478080">:=</span>&nbsp;<span class="num" id="4478083">0</span><span class="op" id="4478084">;</span>&nbsp;<span class="ident" id="4478086">i</span>&nbsp;<span class="op" id="4478088">&lt;=</span>&nbsp;<span class="builtinfunc" id="4478091">len</span><span class="op" id="4478094">(</span><span class="ident" id="4478095">sub</span><span class="op" id="4478098">)</span><span class="op" id="4478099">;</span>&nbsp;<span class="ident" id="4478101">i</span><span class="op" id="4478102">++</span>&nbsp;<span class="op" id="4478105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478109">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478173">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478240">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478274">//</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478279">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478343">//&nbsp;with&nbsp;str&nbsp;as&nbsp;modified&nbsp;by&nbsp;strflags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478382">var</span>&nbsp;<span class="ident" id="4478386">istr</span>&nbsp;<span class="op" id="4478391">[</span><span class="op" id="4478392">]</span><span class="builtintype" id="4478393">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478400">var</span>&nbsp;<span class="ident" id="4478404">iflags</span>&nbsp;<span class="ident" id="4478411">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478419">if</span>&nbsp;<span class="ident" id="4478422">i</span>&nbsp;<span class="op" id="4478424">&lt;</span>&nbsp;<span class="builtinfunc" id="4478426">len</span><span class="op" id="4478429">(</span><span class="ident" id="4478430">sub</span><span class="op" id="4478433">)</span>&nbsp;<span class="op" id="4478435">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4478440">istr</span><span class="op" id="4478444">,</span>&nbsp;<span class="ident" id="4478446">iflags</span>&nbsp;<span class="op" id="4478453">=</span>&nbsp;<span class="ident" id="4478455">p</span><span class="op" id="4478456">.</span><span class="ident" id="4478457">leadingString</span><span class="op" id="4478470">(</span><span class="ident" id="4478471">sub</span><span class="op" id="4478474">[</span><span class="ident" id="4478475">i</span><span class="op" id="4478476">]</span><span class="op" id="4478477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478482">if</span>&nbsp;<span class="ident" id="4478485">iflags</span>&nbsp;<span class="op" id="4478492">==</span>&nbsp;<span class="ident" id="4478495">strflags</span>&nbsp;<span class="op" id="4478504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4478510">same</span>&nbsp;<span class="op" id="4478515">:=</span>&nbsp;<span class="num" id="4478518">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478524">for</span>&nbsp;<span class="ident" id="4478528">same</span>&nbsp;<span class="op" id="4478533">&lt;</span>&nbsp;<span class="builtinfunc" id="4478535">len</span><span class="op" id="4478538">(</span><span class="ident" id="4478539">str</span><span class="op" id="4478542">)</span>&nbsp;<span class="op" id="4478544">&amp;&amp;</span>&nbsp;<span class="ident" id="4478547">same</span>&nbsp;<span class="op" id="4478552">&lt;</span>&nbsp;<span class="builtinfunc" id="4478554">len</span><span class="op" id="4478557">(</span><span class="ident" id="4478558">istr</span><span class="op" id="4478562">)</span>&nbsp;<span class="op" id="4478564">&amp;&amp;</span>&nbsp;<span class="ident" id="4478567">str</span><span class="op" id="4478570">[</span><span class="ident" id="4478571">same</span><span class="op" id="4478575">]</span>&nbsp;<span class="op" id="4478577">==</span>&nbsp;<span class="ident" id="4478580">istr</span><span class="op" id="4478584">[</span><span class="ident" id="4478585">same</span><span class="op" id="4478589">]</span>&nbsp;<span class="op" id="4478591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4478598">same</span><span class="op" id="4478602">++</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4478609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478615">if</span>&nbsp;<span class="ident" id="4478618">same</span>&nbsp;<span class="op" id="4478623">&gt;</span>&nbsp;<span class="num" id="4478625">0</span>&nbsp;<span class="op" id="4478627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478634">//&nbsp;Matches&nbsp;at&nbsp;least&nbsp;one&nbsp;rune&nbsp;in&nbsp;current&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478686">//&nbsp;Keep&nbsp;going&nbsp;around.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4478713">str</span>&nbsp;<span class="op" id="4478717">=</span>&nbsp;<span class="ident" id="4478719">str</span><span class="op" id="4478722">[</span><span class="op" id="4478723">:</span><span class="ident" id="4478724">same</span><span class="op" id="4478728">]</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478735">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4478748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4478753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4478757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478762">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;literal&nbsp;string:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478822">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;str[0:len(str)],&nbsp;but&nbsp;sub[i]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478883">//&nbsp;does&nbsp;not&nbsp;even&nbsp;begin&nbsp;with&nbsp;str[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478921">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4478926">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;string&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4478995">if</span>&nbsp;<span class="ident" id="4478998">i</span>&nbsp;<span class="op" id="4479000">==</span>&nbsp;<span class="ident" id="4479003">start</span>&nbsp;<span class="op" id="4479009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4479014">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4479052">}</span>&nbsp;<span class="keyword" id="4479054">else</span>&nbsp;<span class="keyword" id="4479059">if</span>&nbsp;<span class="ident" id="4479062">i</span>&nbsp;<span class="op" id="4479064">==</span>&nbsp;<span class="ident" id="4479067">start</span><span class="op" id="4479072">+</span><span class="num" id="4479073">1</span>&nbsp;<span class="op" id="4479075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4479080">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479120">out</span>&nbsp;<span class="op" id="4479124">=</span>&nbsp;<span class="builtinfunc" id="4479126">append</span><span class="op" id="4479132">(</span><span class="ident" id="4479133">out</span><span class="op" id="4479136">,</span>&nbsp;<span class="ident" id="4479138">sub</span><span class="op" id="4479141">[</span><span class="ident" id="4479142">start</span><span class="op" id="4479147">]</span><span class="op" id="4479148">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4479152">}</span>&nbsp;<span class="keyword" id="4479154">else</span>&nbsp;<span class="op" id="4479159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4479164">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479223">prefix</span>&nbsp;<span class="op" id="4479230">:=</span>&nbsp;<span class="ident" id="4479233">p</span><span class="op" id="4479234">.</span><span class="ident" id="4479235">newRegexp</span><span class="op" id="4479244">(</span><span class="ident" id="4479245">OpLiteral</span><span class="op" id="4479254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479259">prefix</span><span class="op" id="4479265">.</span><span class="ident" id="4479266">Flags</span>&nbsp;<span class="op" id="4479272">=</span>&nbsp;<span class="ident" id="4479274">strflags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479286">prefix</span><span class="op" id="4479292">.</span><span class="ident" id="4479293">Rune</span>&nbsp;<span class="op" id="4479298">=</span>&nbsp;<span class="builtinfunc" id="4479300">append</span><span class="op" id="4479306">(</span><span class="ident" id="4479307">prefix</span><span class="op" id="4479313">.</span><span class="ident" id="4479314">Rune</span><span class="op" id="4479318">[</span><span class="op" id="4479319">:</span><span class="num" id="4479320">0</span><span class="op" id="4479321">]</span><span class="op" id="4479322">,</span>&nbsp;<span class="ident" id="4479324">str</span><span class="op" id="4479327">...</span><span class="op" id="4479330">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479336">for</span>&nbsp;<span class="ident" id="4479340">j</span>&nbsp;<span class="op" id="4479342">:=</span>&nbsp;<span class="ident" id="4479345">start</span><span class="op" id="4479350">;</span>&nbsp;<span class="ident" id="4479352">j</span>&nbsp;<span class="op" id="4479354">&lt;</span>&nbsp;<span class="ident" id="4479356">i</span><span class="op" id="4479357">;</span>&nbsp;<span class="ident" id="4479359">j</span><span class="op" id="4479360">++</span>&nbsp;<span class="op" id="4479363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479369">sub</span><span class="op" id="4479372">[</span><span class="ident" id="4479373">j</span><span class="op" id="4479374">]</span>&nbsp;<span class="op" id="4479376">=</span>&nbsp;<span class="ident" id="4479378">p</span><span class="op" id="4479379">.</span><span class="ident" id="4479380">removeLeadingString</span><span class="op" id="4479399">(</span><span class="ident" id="4479400">sub</span><span class="op" id="4479403">[</span><span class="ident" id="4479404">j</span><span class="op" id="4479405">]</span><span class="op" id="4479406">,</span>&nbsp;<span class="builtinfunc" id="4479408">len</span><span class="op" id="4479411">(</span><span class="ident" id="4479412">str</span><span class="op" id="4479415">)</span><span class="op" id="4479416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4479421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479426">suffix</span>&nbsp;<span class="op" id="4479433">:=</span>&nbsp;<span class="ident" id="4479436">p</span><span class="op" id="4479437">.</span><span class="ident" id="4479438">collapse</span><span class="op" id="4479446">(</span><span class="ident" id="4479447">sub</span><span class="op" id="4479450">[</span><span class="ident" id="4479451">start</span><span class="op" id="4479456">:</span><span class="ident" id="4479457">i</span><span class="op" id="4479458">]</span><span class="op" id="4479459">,</span>&nbsp;<span class="ident" id="4479461">OpAlternate</span><span class="op" id="4479472">)</span>&nbsp;<span class="comment" id="4479474">//&nbsp;recurse</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479489">re</span>&nbsp;<span class="op" id="4479492">:=</span>&nbsp;<span class="ident" id="4479495">p</span><span class="op" id="4479496">.</span><span class="ident" id="4479497">newRegexp</span><span class="op" id="4479506">(</span><span class="ident" id="4479507">OpConcat</span><span class="op" id="4479515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479520">re</span><span class="op" id="4479522">.</span><span class="ident" id="4479523">Sub</span>&nbsp;<span class="op" id="4479527">=</span>&nbsp;<span class="builtinfunc" id="4479529">append</span><span class="op" id="4479535">(</span><span class="ident" id="4479536">re</span><span class="op" id="4479538">.</span><span class="ident" id="4479539">Sub</span><span class="op" id="4479542">[</span><span class="op" id="4479543">:</span><span class="num" id="4479544">0</span><span class="op" id="4479545">]</span><span class="op" id="4479546">,</span>&nbsp;<span class="ident" id="4479548">prefix</span><span class="op" id="4479554">,</span>&nbsp;<span class="ident" id="4479556">suffix</span><span class="op" id="4479562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479567">out</span>&nbsp;<span class="op" id="4479571">=</span>&nbsp;<span class="builtinfunc" id="4479573">append</span><span class="op" id="4479579">(</span><span class="ident" id="4479580">out</span><span class="op" id="4479583">,</span>&nbsp;<span class="ident" id="4479585">re</span><span class="op" id="4479587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4479591">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4479596">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479629">start</span>&nbsp;<span class="op" id="4479635">=</span>&nbsp;<span class="ident" id="4479637">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479641">str</span>&nbsp;<span class="op" id="4479645">=</span>&nbsp;<span class="ident" id="4479647">istr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479654">strflags</span>&nbsp;<span class="op" id="4479663">=</span>&nbsp;<span class="ident" id="4479665">iflags</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4479673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479676">sub</span>&nbsp;<span class="op" id="4479680">=</span>&nbsp;<span class="ident" id="4479682">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4479688">//&nbsp;Round&nbsp;2:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;complex&nbsp;prefixes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4479737">//&nbsp;just&nbsp;the&nbsp;first&nbsp;piece&nbsp;of&nbsp;each&nbsp;concatenation,</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4479785">//&nbsp;whatever&nbsp;it&nbsp;is.&nbsp;&nbsp;This&nbsp;is&nbsp;good&nbsp;enough&nbsp;a&nbsp;lot&nbsp;of&nbsp;the&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479845">start</span>&nbsp;<span class="op" id="4479851">=</span>&nbsp;<span class="num" id="4479853">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4479856">out</span>&nbsp;<span class="op" id="4479860">=</span>&nbsp;<span class="ident" id="4479862">sub</span><span class="op" id="4479865">[</span><span class="op" id="4479866">:</span><span class="num" id="4479867">0</span><span class="op" id="4479868">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479871">var</span>&nbsp;<span class="ident" id="4479875">first</span>&nbsp;<span class="op" id="4479881">*</span><span class="ident" id="4479882">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4479890">for</span>&nbsp;<span class="ident" id="4479894">i</span>&nbsp;<span class="op" id="4479896">:=</span>&nbsp;<span class="num" id="4479899">0</span><span class="op" id="4479900">;</span>&nbsp;<span class="ident" id="4479902">i</span>&nbsp;<span class="op" id="4479904">&lt;=</span>&nbsp;<span class="builtinfunc" id="4479907">len</span><span class="op" id="4479910">(</span><span class="ident" id="4479911">sub</span><span class="op" id="4479914">)</span><span class="op" id="4479915">;</span>&nbsp;<span class="ident" id="4479917">i</span><span class="op" id="4479918">++</span>&nbsp;<span class="op" id="4479921">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4479925">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4479989">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4480056">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4480090">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4480095">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin&nbsp;with&nbsp;ifirst.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480172">var</span>&nbsp;<span class="ident" id="4480176">ifirst</span>&nbsp;<span class="op" id="4480183">*</span><span class="ident" id="4480184">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480193">if</span>&nbsp;<span class="ident" id="4480196">i</span>&nbsp;<span class="op" id="4480198">&lt;</span>&nbsp;<span class="builtinfunc" id="4480200">len</span><span class="op" id="4480203">(</span><span class="ident" id="4480204">sub</span><span class="op" id="4480207">)</span>&nbsp;<span class="op" id="4480209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4480214">ifirst</span>&nbsp;<span class="op" id="4480221">=</span>&nbsp;<span class="ident" id="4480223">p</span><span class="op" id="4480224">.</span><span class="ident" id="4480225">leadingRegexp</span><span class="op" id="4480238">(</span><span class="ident" id="4480239">sub</span><span class="op" id="4480242">[</span><span class="ident" id="4480243">i</span><span class="op" id="4480244">]</span><span class="op" id="4480245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480250">if</span>&nbsp;<span class="ident" id="4480253">first</span>&nbsp;<span class="op" id="4480259">!=</span>&nbsp;<span class="ident" id="4480262">nil</span>&nbsp;<span class="op" id="4480266">&amp;&amp;</span>&nbsp;<span class="ident" id="4480269">first</span><span class="op" id="4480274">.</span><span class="ident" id="4480275">Equal</span><span class="op" id="4480280">(</span><span class="ident" id="4480281">ifirst</span><span class="op" id="4480287">)</span>&nbsp;<span class="op" id="4480289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480295">continue</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4480307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4480311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4480316">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;regexp:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4480368">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;first&nbsp;but&nbsp;sub[i]&nbsp;does&nbsp;not.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4480428">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4480433">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;regexp&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480502">if</span>&nbsp;<span class="ident" id="4480505">i</span>&nbsp;<span class="op" id="4480507">==</span>&nbsp;<span class="ident" id="4480510">start</span>&nbsp;<span class="op" id="4480516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4480521">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4480559">}</span>&nbsp;<span class="keyword" id="4480561">else</span>&nbsp;<span class="keyword" id="4480566">if</span>&nbsp;<span class="ident" id="4480569">i</span>&nbsp;<span class="op" id="4480571">==</span>&nbsp;<span class="ident" id="4480574">start</span><span class="op" id="4480579">+</span><span class="num" id="4480580">1</span>&nbsp;<span class="op" id="4480582">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4480587">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4480627">out</span>&nbsp;<span class="op" id="4480631">=</span>&nbsp;<span class="builtinfunc" id="4480633">append</span><span class="op" id="4480639">(</span><span class="ident" id="4480640">out</span><span class="op" id="4480643">,</span>&nbsp;<span class="ident" id="4480645">sub</span><span class="op" id="4480648">[</span><span class="ident" id="4480649">start</span><span class="op" id="4480654">]</span><span class="op" id="4480655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4480659">}</span>&nbsp;<span class="keyword" id="4480661">else</span>&nbsp;<span class="op" id="4480666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4480671">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4480730">prefix</span>&nbsp;<span class="op" id="4480737">:=</span>&nbsp;<span class="ident" id="4480740">first</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4480749">for</span>&nbsp;<span class="ident" id="4480753">j</span>&nbsp;<span class="op" id="4480755">:=</span>&nbsp;<span class="ident" id="4480758">start</span><span class="op" id="4480763">;</span>&nbsp;<span class="ident" id="4480765">j</span>&nbsp;<span class="op" id="4480767">&lt;</span>&nbsp;<span class="ident" id="4480769">i</span><span class="op" id="4480770">;</span>&nbsp;<span class="ident" id="4480772">j</span><span class="op" id="4480773">++</span>&nbsp;<span class="op" id="4480776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4480782">reuse</span>&nbsp;<span class="op" id="4480788">:=</span>&nbsp;<span class="ident" id="4480791">j</span>&nbsp;<span class="op" id="4480793">!=</span>&nbsp;<span class="ident" id="4480796">start</span>&nbsp;<span class="comment" id="4480802">//&nbsp;prefix&nbsp;came&nbsp;from&nbsp;sub[start]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4480837">sub</span><span class="op" id="4480840">[</span><span class="ident" id="4480841">j</span><span class="op" id="4480842">]</span>&nbsp;<span class="op" id="4480844">=</span>&nbsp;<span class="ident" id="4480846">p</span><span class="op" id="4480847">.</span><span class="ident" id="4480848">removeLeadingRegexp</span><span class="op" id="4480867">(</span><span class="ident" id="4480868">sub</span><span class="op" id="4480871">[</span><span class="ident" id="4480872">j</span><span class="op" id="4480873">]</span><span class="op" id="4480874">,</span>&nbsp;<span class="ident" id="4480876">reuse</span><span class="op" id="4480881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4480886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4480891">suffix</span>&nbsp;<span class="op" id="4480898">:=</span>&nbsp;<span class="ident" id="4480901">p</span><span class="op" id="4480902">.</span><span class="ident" id="4480903">collapse</span><span class="op" id="4480911">(</span><span class="ident" id="4480912">sub</span><span class="op" id="4480915">[</span><span class="ident" id="4480916">start</span><span class="op" id="4480921">:</span><span class="ident" id="4480922">i</span><span class="op" id="4480923">]</span><span class="op" id="4480924">,</span>&nbsp;<span class="ident" id="4480926">OpAlternate</span><span class="op" id="4480937">)</span>&nbsp;<span class="comment" id="4480939">//&nbsp;recurse</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4480954">re</span>&nbsp;<span class="op" id="4480957">:=</span>&nbsp;<span class="ident" id="4480960">p</span><span class="op" id="4480961">.</span><span class="ident" id="4480962">newRegexp</span><span class="op" id="4480971">(</span><span class="ident" id="4480972">OpConcat</span><span class="op" id="4480980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4480985">re</span><span class="op" id="4480987">.</span><span class="ident" id="4480988">Sub</span>&nbsp;<span class="op" id="4480992">=</span>&nbsp;<span class="builtinfunc" id="4480994">append</span><span class="op" id="4481000">(</span><span class="ident" id="4481001">re</span><span class="op" id="4481003">.</span><span class="ident" id="4481004">Sub</span><span class="op" id="4481007">[</span><span class="op" id="4481008">:</span><span class="num" id="4481009">0</span><span class="op" id="4481010">]</span><span class="op" id="4481011">,</span>&nbsp;<span class="ident" id="4481013">prefix</span><span class="op" id="4481019">,</span>&nbsp;<span class="ident" id="4481021">suffix</span><span class="op" id="4481027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481032">out</span>&nbsp;<span class="op" id="4481036">=</span>&nbsp;<span class="builtinfunc" id="4481038">append</span><span class="op" id="4481044">(</span><span class="ident" id="4481045">out</span><span class="op" id="4481048">,</span>&nbsp;<span class="ident" id="4481050">re</span><span class="op" id="4481052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4481056">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481061">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481094">start</span>&nbsp;<span class="op" id="4481100">=</span>&nbsp;<span class="ident" id="4481102">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481106">first</span>&nbsp;<span class="op" id="4481112">=</span>&nbsp;<span class="ident" id="4481114">ifirst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4481122">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481125">sub</span>&nbsp;<span class="op" id="4481129">=</span>&nbsp;<span class="ident" id="4481131">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481137">//&nbsp;Round&nbsp;3:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;single&nbsp;literals&nbsp;into&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481207">start</span>&nbsp;<span class="op" id="4481213">=</span>&nbsp;<span class="num" id="4481215">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481218">out</span>&nbsp;<span class="op" id="4481222">=</span>&nbsp;<span class="ident" id="4481224">sub</span><span class="op" id="4481227">[</span><span class="op" id="4481228">:</span><span class="num" id="4481229">0</span><span class="op" id="4481230">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4481233">for</span>&nbsp;<span class="ident" id="4481237">i</span>&nbsp;<span class="op" id="4481239">:=</span>&nbsp;<span class="num" id="4481242">0</span><span class="op" id="4481243">;</span>&nbsp;<span class="ident" id="4481245">i</span>&nbsp;<span class="op" id="4481247">&lt;=</span>&nbsp;<span class="builtinfunc" id="4481250">len</span><span class="op" id="4481253">(</span><span class="ident" id="4481254">sub</span><span class="op" id="4481257">)</span><span class="op" id="4481258">;</span>&nbsp;<span class="ident" id="4481260">i</span><span class="op" id="4481261">++</span>&nbsp;<span class="op" id="4481264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481268">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481332">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481399">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481433">//</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481438">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;are&nbsp;either</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481503">//&nbsp;literal&nbsp;runes&nbsp;or&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4481544">if</span>&nbsp;<span class="ident" id="4481547">i</span>&nbsp;<span class="op" id="4481549">&lt;</span>&nbsp;<span class="builtinfunc" id="4481551">len</span><span class="op" id="4481554">(</span><span class="ident" id="4481555">sub</span><span class="op" id="4481558">)</span>&nbsp;<span class="op" id="4481560">&amp;&amp;</span>&nbsp;<span class="ident" id="4481563">isCharClass</span><span class="op" id="4481574">(</span><span class="ident" id="4481575">sub</span><span class="op" id="4481578">[</span><span class="ident" id="4481579">i</span><span class="op" id="4481580">]</span><span class="op" id="4481581">)</span>&nbsp;<span class="op" id="4481583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4481588">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4481599">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481604">//&nbsp;sub[i]&nbsp;is&nbsp;not&nbsp;a&nbsp;char&nbsp;or&nbsp;char&nbsp;class;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481645">//&nbsp;emit&nbsp;char&nbsp;class&nbsp;for&nbsp;sub[start:i]...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4481686">if</span>&nbsp;<span class="ident" id="4481689">i</span>&nbsp;<span class="op" id="4481691">==</span>&nbsp;<span class="ident" id="4481694">start</span>&nbsp;<span class="op" id="4481700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481705">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4481743">}</span>&nbsp;<span class="keyword" id="4481745">else</span>&nbsp;<span class="keyword" id="4481750">if</span>&nbsp;<span class="ident" id="4481753">i</span>&nbsp;<span class="op" id="4481755">==</span>&nbsp;<span class="ident" id="4481758">start</span><span class="op" id="4481763">+</span><span class="num" id="4481764">1</span>&nbsp;<span class="op" id="4481766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481771">out</span>&nbsp;<span class="op" id="4481775">=</span>&nbsp;<span class="builtinfunc" id="4481777">append</span><span class="op" id="4481783">(</span><span class="ident" id="4481784">out</span><span class="op" id="4481787">,</span>&nbsp;<span class="ident" id="4481789">sub</span><span class="op" id="4481792">[</span><span class="ident" id="4481793">start</span><span class="op" id="4481798">]</span><span class="op" id="4481799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4481803">}</span>&nbsp;<span class="keyword" id="4481805">else</span>&nbsp;<span class="op" id="4481810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481815">//&nbsp;Make&nbsp;new&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4481842">//&nbsp;Start&nbsp;with&nbsp;most&nbsp;complex&nbsp;regexp&nbsp;in&nbsp;sub[start].</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4481894">max</span>&nbsp;<span class="op" id="4481898">:=</span>&nbsp;<span class="ident" id="4481901">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4481910">for</span>&nbsp;<span class="ident" id="4481914">j</span>&nbsp;<span class="op" id="4481916">:=</span>&nbsp;<span class="ident" id="4481919">start</span>&nbsp;<span class="op" id="4481925">+</span>&nbsp;<span class="num" id="4481927">1</span><span class="op" id="4481928">;</span>&nbsp;<span class="ident" id="4481930">j</span>&nbsp;<span class="op" id="4481932">&lt;</span>&nbsp;<span class="ident" id="4481934">i</span><span class="op" id="4481935">;</span>&nbsp;<span class="ident" id="4481937">j</span><span class="op" id="4481938">++</span>&nbsp;<span class="op" id="4481941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4481947">if</span>&nbsp;<span class="ident" id="4481950">sub</span><span class="op" id="4481953">[</span><span class="ident" id="4481954">max</span><span class="op" id="4481957">]</span><span class="op" id="4481958">.</span><span class="ident" id="4481959">Op</span>&nbsp;<span class="op" id="4481962">&lt;</span>&nbsp;<span class="ident" id="4481964">sub</span><span class="op" id="4481967">[</span><span class="ident" id="4481968">j</span><span class="op" id="4481969">]</span><span class="op" id="4481970">.</span><span class="ident" id="4481971">Op</span>&nbsp;<span class="op" id="4481974">||</span>&nbsp;<span class="ident" id="4481977">sub</span><span class="op" id="4481980">[</span><span class="ident" id="4481981">max</span><span class="op" id="4481984">]</span><span class="op" id="4481985">.</span><span class="ident" id="4481986">Op</span>&nbsp;<span class="op" id="4481989">==</span>&nbsp;<span class="ident" id="4481992">sub</span><span class="op" id="4481995">[</span><span class="ident" id="4481996">j</span><span class="op" id="4481997">]</span><span class="op" id="4481998">.</span><span class="ident" id="4481999">Op</span>&nbsp;<span class="op" id="4482002">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4482005">len</span><span class="op" id="4482008">(</span><span class="ident" id="4482009">sub</span><span class="op" id="4482012">[</span><span class="ident" id="4482013">max</span><span class="op" id="4482016">]</span><span class="op" id="4482017">.</span><span class="ident" id="4482018">Rune</span><span class="op" id="4482022">)</span>&nbsp;<span class="op" id="4482024">&lt;</span>&nbsp;<span class="builtinfunc" id="4482026">len</span><span class="op" id="4482029">(</span><span class="ident" id="4482030">sub</span><span class="op" id="4482033">[</span><span class="ident" id="4482034">j</span><span class="op" id="4482035">]</span><span class="op" id="4482036">.</span><span class="ident" id="4482037">Rune</span><span class="op" id="4482041">)</span>&nbsp;<span class="op" id="4482043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482050">max</span>&nbsp;<span class="op" id="4482054">=</span>&nbsp;<span class="ident" id="4482056">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4482062">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4482067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482072">sub</span><span class="op" id="4482075">[</span><span class="ident" id="4482076">start</span><span class="op" id="4482081">]</span><span class="op" id="4482082">,</span>&nbsp;<span class="ident" id="4482084">sub</span><span class="op" id="4482087">[</span><span class="ident" id="4482088">max</span><span class="op" id="4482091">]</span>&nbsp;<span class="op" id="4482093">=</span>&nbsp;<span class="ident" id="4482095">sub</span><span class="op" id="4482098">[</span><span class="ident" id="4482099">max</span><span class="op" id="4482102">]</span><span class="op" id="4482103">,</span>&nbsp;<span class="ident" id="4482105">sub</span><span class="op" id="4482108">[</span><span class="ident" id="4482109">start</span><span class="op" id="4482114">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482120">for</span>&nbsp;<span class="ident" id="4482124">j</span>&nbsp;<span class="op" id="4482126">:=</span>&nbsp;<span class="ident" id="4482129">start</span>&nbsp;<span class="op" id="4482135">+</span>&nbsp;<span class="num" id="4482137">1</span><span class="op" id="4482138">;</span>&nbsp;<span class="ident" id="4482140">j</span>&nbsp;<span class="op" id="4482142">&lt;</span>&nbsp;<span class="ident" id="4482144">i</span><span class="op" id="4482145">;</span>&nbsp;<span class="ident" id="4482147">j</span><span class="op" id="4482148">++</span>&nbsp;<span class="op" id="4482151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482157">mergeCharClass</span><span class="op" id="4482171">(</span><span class="ident" id="4482172">sub</span><span class="op" id="4482175">[</span><span class="ident" id="4482176">start</span><span class="op" id="4482181">]</span><span class="op" id="4482182">,</span>&nbsp;<span class="ident" id="4482184">sub</span><span class="op" id="4482187">[</span><span class="ident" id="4482188">j</span><span class="op" id="4482189">]</span><span class="op" id="4482190">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482196">p</span><span class="op" id="4482197">.</span><span class="ident" id="4482198">reuse</span><span class="op" id="4482203">(</span><span class="ident" id="4482204">sub</span><span class="op" id="4482207">[</span><span class="ident" id="4482208">j</span><span class="op" id="4482209">]</span><span class="op" id="4482210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4482215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482220">cleanAlt</span><span class="op" id="4482228">(</span><span class="ident" id="4482229">sub</span><span class="op" id="4482232">[</span><span class="ident" id="4482233">start</span><span class="op" id="4482238">]</span><span class="op" id="4482239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482244">out</span>&nbsp;<span class="op" id="4482248">=</span>&nbsp;<span class="builtinfunc" id="4482250">append</span><span class="op" id="4482256">(</span><span class="ident" id="4482257">out</span><span class="op" id="4482260">,</span>&nbsp;<span class="ident" id="4482262">sub</span><span class="op" id="4482265">[</span><span class="ident" id="4482266">start</span><span class="op" id="4482271">]</span><span class="op" id="4482272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4482276">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482281">//&nbsp;...&nbsp;and&nbsp;then&nbsp;emit&nbsp;sub[i].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482312">if</span>&nbsp;<span class="ident" id="4482315">i</span>&nbsp;<span class="op" id="4482317">&lt;</span>&nbsp;<span class="builtinfunc" id="4482319">len</span><span class="op" id="4482322">(</span><span class="ident" id="4482323">sub</span><span class="op" id="4482326">)</span>&nbsp;<span class="op" id="4482328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482333">out</span>&nbsp;<span class="op" id="4482337">=</span>&nbsp;<span class="builtinfunc" id="4482339">append</span><span class="op" id="4482345">(</span><span class="ident" id="4482346">out</span><span class="op" id="4482349">,</span>&nbsp;<span class="ident" id="4482351">sub</span><span class="op" id="4482354">[</span><span class="ident" id="4482355">i</span><span class="op" id="4482356">]</span><span class="op" id="4482357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4482361">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482365">start</span>&nbsp;<span class="op" id="4482371">=</span>&nbsp;<span class="ident" id="4482373">i</span>&nbsp;<span class="op" id="4482375">+</span>&nbsp;<span class="num" id="4482377">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4482380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482383">sub</span>&nbsp;<span class="op" id="4482387">=</span>&nbsp;<span class="ident" id="4482389">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4482395">//&nbsp;Round&nbsp;4:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;empty&nbsp;matches&nbsp;into&nbsp;a&nbsp;single&nbsp;empty&nbsp;match.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482466">start</span>&nbsp;<span class="op" id="4482472">=</span>&nbsp;<span class="num" id="4482474">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482477">out</span>&nbsp;<span class="op" id="4482481">=</span>&nbsp;<span class="ident" id="4482483">sub</span><span class="op" id="4482486">[</span><span class="op" id="4482487">:</span><span class="num" id="4482488">0</span><span class="op" id="4482489">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482492">for</span>&nbsp;<span class="ident" id="4482496">i</span>&nbsp;<span class="op" id="4482498">:=</span>&nbsp;<span class="keyword" id="4482501">range</span>&nbsp;<span class="ident" id="4482507">sub</span>&nbsp;<span class="op" id="4482511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482515">if</span>&nbsp;<span class="ident" id="4482518">i</span><span class="op" id="4482519">+</span><span class="num" id="4482520">1</span>&nbsp;<span class="op" id="4482522">&lt;</span>&nbsp;<span class="builtinfunc" id="4482524">len</span><span class="op" id="4482527">(</span><span class="ident" id="4482528">sub</span><span class="op" id="4482531">)</span>&nbsp;<span class="op" id="4482533">&amp;&amp;</span>&nbsp;<span class="ident" id="4482536">sub</span><span class="op" id="4482539">[</span><span class="ident" id="4482540">i</span><span class="op" id="4482541">]</span><span class="op" id="4482542">.</span><span class="ident" id="4482543">Op</span>&nbsp;<span class="op" id="4482546">==</span>&nbsp;<span class="ident" id="4482549">OpEmptyMatch</span>&nbsp;<span class="op" id="4482562">&amp;&amp;</span>&nbsp;<span class="ident" id="4482565">sub</span><span class="op" id="4482568">[</span><span class="ident" id="4482569">i</span><span class="op" id="4482570">+</span><span class="num" id="4482571">1</span><span class="op" id="4482572">]</span><span class="op" id="4482573">.</span><span class="ident" id="4482574">Op</span>&nbsp;<span class="op" id="4482577">==</span>&nbsp;<span class="ident" id="4482580">OpEmptyMatch</span>&nbsp;<span class="op" id="4482593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482598">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4482609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482613">out</span>&nbsp;<span class="op" id="4482617">=</span>&nbsp;<span class="builtinfunc" id="4482619">append</span><span class="op" id="4482625">(</span><span class="ident" id="4482626">out</span><span class="op" id="4482629">,</span>&nbsp;<span class="ident" id="4482631">sub</span><span class="op" id="4482634">[</span><span class="ident" id="4482635">i</span><span class="op" id="4482636">]</span><span class="op" id="4482637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4482640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482643">sub</span>&nbsp;<span class="op" id="4482647">=</span>&nbsp;<span class="ident" id="4482649">out</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482655">return</span>&nbsp;<span class="ident" id="4482662">sub</span><br>
<span class="lineno"></span><span class="op" id="4482666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4482669">//&nbsp;leadingString&nbsp;returns&nbsp;the&nbsp;leading&nbsp;literal&nbsp;string&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="4482742">//&nbsp;The&nbsp;string&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno">585</span><span class="keyword" id="4482797">func</span>&nbsp;<span class="op" id="4482802">(</span><span class="ident" id="4482803">p</span>&nbsp;<span class="op" id="4482805">*</span><span class="ident" id="4482806">parser</span><span class="op" id="4482812">)</span>&nbsp;<span class="ident" id="4482814">leadingString</span><span class="op" id="4482827">(</span><span class="ident" id="4482828">re</span>&nbsp;<span class="op" id="4482831">*</span><span class="ident" id="4482832">Regexp</span><span class="op" id="4482838">)</span>&nbsp;<span class="op" id="4482840">(</span><span class="op" id="4482841">[</span><span class="op" id="4482842">]</span><span class="builtintype" id="4482843">rune</span><span class="op" id="4482847">,</span>&nbsp;<span class="ident" id="4482849">Flags</span><span class="op" id="4482854">)</span>&nbsp;<span class="op" id="4482856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482859">if</span>&nbsp;<span class="ident" id="4482862">re</span><span class="op" id="4482864">.</span><span class="ident" id="4482865">Op</span>&nbsp;<span class="op" id="4482868">==</span>&nbsp;<span class="ident" id="4482871">OpConcat</span>&nbsp;<span class="op" id="4482880">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4482883">len</span><span class="op" id="4482886">(</span><span class="ident" id="4482887">re</span><span class="op" id="4482889">.</span><span class="ident" id="4482890">Sub</span><span class="op" id="4482893">)</span>&nbsp;<span class="op" id="4482895">&gt;</span>&nbsp;<span class="num" id="4482897">0</span>&nbsp;<span class="op" id="4482899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4482903">re</span>&nbsp;<span class="op" id="4482906">=</span>&nbsp;<span class="ident" id="4482908">re</span><span class="op" id="4482910">.</span><span class="ident" id="4482911">Sub</span><span class="op" id="4482914">[</span><span class="num" id="4482915">0</span><span class="op" id="4482916">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4482919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482922">if</span>&nbsp;<span class="ident" id="4482925">re</span><span class="op" id="4482927">.</span><span class="ident" id="4482928">Op</span>&nbsp;<span class="op" id="4482931">!=</span>&nbsp;<span class="ident" id="4482934">OpLiteral</span>&nbsp;<span class="op" id="4482944">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482948">return</span>&nbsp;<span class="ident" id="4482955">nil</span><span class="op" id="4482958">,</span>&nbsp;<span class="num" id="4482960">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4482963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4482966">return</span>&nbsp;<span class="ident" id="4482973">re</span><span class="op" id="4482975">.</span><span class="ident" id="4482976">Rune</span><span class="op" id="4482980">,</span>&nbsp;<span class="ident" id="4482982">re</span><span class="op" id="4482984">.</span><span class="ident" id="4482985">Flags</span>&nbsp;<span class="op" id="4482991">&amp;</span>&nbsp;<span class="ident" id="4482993">FoldCase</span><br>
<span class="lineno"></span><span class="op" id="4483002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="4483005">//&nbsp;removeLeadingString&nbsp;removes&nbsp;the&nbsp;first&nbsp;n&nbsp;leading&nbsp;runes</span><br>
<span class="lineno"></span><span class="comment" id="4483062">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno"></span><span class="keyword" id="4483127">func</span>&nbsp;<span class="op" id="4483132">(</span><span class="ident" id="4483133">p</span>&nbsp;<span class="op" id="4483135">*</span><span class="ident" id="4483136">parser</span><span class="op" id="4483142">)</span>&nbsp;<span class="ident" id="4483144">removeLeadingString</span><span class="op" id="4483163">(</span><span class="ident" id="4483164">re</span>&nbsp;<span class="op" id="4483167">*</span><span class="ident" id="4483168">Regexp</span><span class="op" id="4483174">,</span>&nbsp;<span class="ident" id="4483176">n</span>&nbsp;<span class="builtintype" id="4483178">int</span><span class="op" id="4483181">)</span>&nbsp;<span class="op" id="4483183">*</span><span class="ident" id="4483184">Regexp</span>&nbsp;<span class="op" id="4483191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483194">if</span>&nbsp;<span class="ident" id="4483197">re</span><span class="op" id="4483199">.</span><span class="ident" id="4483200">Op</span>&nbsp;<span class="op" id="4483203">==</span>&nbsp;<span class="ident" id="4483206">OpConcat</span>&nbsp;<span class="op" id="4483215">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4483218">len</span><span class="op" id="4483221">(</span><span class="ident" id="4483222">re</span><span class="op" id="4483224">.</span><span class="ident" id="4483225">Sub</span><span class="op" id="4483228">)</span>&nbsp;<span class="op" id="4483230">&gt;</span>&nbsp;<span class="num" id="4483232">0</span>&nbsp;<span class="op" id="4483234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4483238">//&nbsp;Removing&nbsp;a&nbsp;leading&nbsp;string&nbsp;in&nbsp;a&nbsp;concatenation</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4483288">//&nbsp;might&nbsp;simplify&nbsp;the&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483327">sub</span>&nbsp;<span class="op" id="4483331">:=</span>&nbsp;<span class="ident" id="4483334">re</span><span class="op" id="4483336">.</span><span class="ident" id="4483337">Sub</span><span class="op" id="4483340">[</span><span class="num" id="4483341">0</span><span class="op" id="4483342">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483346">sub</span>&nbsp;<span class="op" id="4483350">=</span>&nbsp;<span class="ident" id="4483352">p</span><span class="op" id="4483353">.</span><span class="ident" id="4483354">removeLeadingString</span><span class="op" id="4483373">(</span><span class="ident" id="4483374">sub</span><span class="op" id="4483377">,</span>&nbsp;<span class="ident" id="4483379">n</span><span class="op" id="4483380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483384">re</span><span class="op" id="4483386">.</span><span class="ident" id="4483387">Sub</span><span class="op" id="4483390">[</span><span class="num" id="4483391">0</span><span class="op" id="4483392">]</span>&nbsp;<span class="op" id="4483394">=</span>&nbsp;<span class="ident" id="4483396">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483402">if</span>&nbsp;<span class="ident" id="4483405">sub</span><span class="op" id="4483408">.</span><span class="ident" id="4483409">Op</span>&nbsp;<span class="op" id="4483412">==</span>&nbsp;<span class="ident" id="4483415">OpEmptyMatch</span>&nbsp;<span class="op" id="4483428">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483433">p</span><span class="op" id="4483434">.</span><span class="ident" id="4483435">reuse</span><span class="op" id="4483440">(</span><span class="ident" id="4483441">sub</span><span class="op" id="4483444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483449">switch</span>&nbsp;<span class="builtinfunc" id="4483456">len</span><span class="op" id="4483459">(</span><span class="ident" id="4483460">re</span><span class="op" id="4483462">.</span><span class="ident" id="4483463">Sub</span><span class="op" id="4483466">)</span>&nbsp;<span class="op" id="4483468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483473">case</span>&nbsp;<span class="num" id="4483478">0</span><span class="op" id="4483479">,</span>&nbsp;<span class="num" id="4483481">1</span><span class="op" id="4483482">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4483488">//&nbsp;Impossible&nbsp;but&nbsp;handle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483518">re</span><span class="op" id="4483520">.</span><span class="ident" id="4483521">Op</span>&nbsp;<span class="op" id="4483524">=</span>&nbsp;<span class="ident" id="4483526">OpEmptyMatch</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483543">re</span><span class="op" id="4483545">.</span><span class="ident" id="4483546">Sub</span>&nbsp;<span class="op" id="4483550">=</span>&nbsp;<span class="ident" id="4483552">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483559">case</span>&nbsp;<span class="num" id="4483564">2</span><span class="op" id="4483565">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483571">old</span>&nbsp;<span class="op" id="4483575">:=</span>&nbsp;<span class="ident" id="4483578">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483585">re</span>&nbsp;<span class="op" id="4483588">=</span>&nbsp;<span class="ident" id="4483590">re</span><span class="op" id="4483592">.</span><span class="ident" id="4483593">Sub</span><span class="op" id="4483596">[</span><span class="num" id="4483597">1</span><span class="op" id="4483598">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483604">p</span><span class="op" id="4483605">.</span><span class="ident" id="4483606">reuse</span><span class="op" id="4483611">(</span><span class="ident" id="4483612">old</span><span class="op" id="4483615">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483620">default</span><span class="op" id="4483627">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4483633">copy</span><span class="op" id="4483637">(</span><span class="ident" id="4483638">re</span><span class="op" id="4483640">.</span><span class="ident" id="4483641">Sub</span><span class="op" id="4483644">,</span>&nbsp;<span class="ident" id="4483646">re</span><span class="op" id="4483648">.</span><span class="ident" id="4483649">Sub</span><span class="op" id="4483652">[</span><span class="num" id="4483653">1</span><span class="op" id="4483654">:</span><span class="op" id="4483655">]</span><span class="op" id="4483656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483662">re</span><span class="op" id="4483664">.</span><span class="ident" id="4483665">Sub</span>&nbsp;<span class="op" id="4483669">=</span>&nbsp;<span class="ident" id="4483671">re</span><span class="op" id="4483673">.</span><span class="ident" id="4483674">Sub</span><span class="op" id="4483677">[</span><span class="op" id="4483678">:</span><span class="builtinfunc" id="4483679">len</span><span class="op" id="4483682">(</span><span class="ident" id="4483683">re</span><span class="op" id="4483685">.</span><span class="ident" id="4483686">Sub</span><span class="op" id="4483689">)</span><span class="op" id="4483690">-</span><span class="num" id="4483691">1</span><span class="op" id="4483692">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4483697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4483701">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483705">return</span>&nbsp;<span class="ident" id="4483712">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4483716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483720">if</span>&nbsp;<span class="ident" id="4483723">re</span><span class="op" id="4483725">.</span><span class="ident" id="4483726">Op</span>&nbsp;<span class="op" id="4483729">==</span>&nbsp;<span class="ident" id="4483732">OpLiteral</span>&nbsp;<span class="op" id="4483742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483746">re</span><span class="op" id="4483748">.</span><span class="ident" id="4483749">Rune</span>&nbsp;<span class="op" id="4483754">=</span>&nbsp;<span class="ident" id="4483756">re</span><span class="op" id="4483758">.</span><span class="ident" id="4483759">Rune</span><span class="op" id="4483763">[</span><span class="op" id="4483764">:</span><span class="builtinfunc" id="4483765">copy</span><span class="op" id="4483769">(</span><span class="ident" id="4483770">re</span><span class="op" id="4483772">.</span><span class="ident" id="4483773">Rune</span><span class="op" id="4483777">,</span>&nbsp;<span class="ident" id="4483779">re</span><span class="op" id="4483781">.</span><span class="ident" id="4483782">Rune</span><span class="op" id="4483786">[</span><span class="ident" id="4483787">n</span><span class="op" id="4483788">:</span><span class="op" id="4483789">]</span><span class="op" id="4483790">)</span><span class="op" id="4483791">]</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483795">if</span>&nbsp;<span class="builtinfunc" id="4483798">len</span><span class="op" id="4483801">(</span><span class="ident" id="4483802">re</span><span class="op" id="4483804">.</span><span class="ident" id="4483805">Rune</span><span class="op" id="4483809">)</span>&nbsp;<span class="op" id="4483811">==</span>&nbsp;<span class="num" id="4483814">0</span>&nbsp;<span class="op" id="4483816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4483821">re</span><span class="op" id="4483823">.</span><span class="ident" id="4483824">Op</span>&nbsp;<span class="op" id="4483827">=</span>&nbsp;<span class="ident" id="4483829">OpEmptyMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4483844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4483847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4483850">return</span>&nbsp;<span class="ident" id="4483857">re</span><br>
<span class="lineno">630</span><span class="op" id="4483860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4483863">//&nbsp;leadingRegexp&nbsp;returns&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="4483928">//&nbsp;The&nbsp;regexp&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno"></span><span class="keyword" id="4483983">func</span>&nbsp;<span class="op" id="4483988">(</span><span class="ident" id="4483989">p</span>&nbsp;<span class="op" id="4483991">*</span><span class="ident" id="4483992">parser</span><span class="op" id="4483998">)</span>&nbsp;<span class="ident" id="4484000">leadingRegexp</span><span class="op" id="4484013">(</span><span class="ident" id="4484014">re</span>&nbsp;<span class="op" id="4484017">*</span><span class="ident" id="4484018">Regexp</span><span class="op" id="4484024">)</span>&nbsp;<span class="op" id="4484026">*</span><span class="ident" id="4484027">Regexp</span>&nbsp;<span class="op" id="4484034">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484037">if</span>&nbsp;<span class="ident" id="4484040">re</span><span class="op" id="4484042">.</span><span class="ident" id="4484043">Op</span>&nbsp;<span class="op" id="4484046">==</span>&nbsp;<span class="ident" id="4484049">OpEmptyMatch</span>&nbsp;<span class="op" id="4484062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484066">return</span>&nbsp;<span class="ident" id="4484073">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4484078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484081">if</span>&nbsp;<span class="ident" id="4484084">re</span><span class="op" id="4484086">.</span><span class="ident" id="4484087">Op</span>&nbsp;<span class="op" id="4484090">==</span>&nbsp;<span class="ident" id="4484093">OpConcat</span>&nbsp;<span class="op" id="4484102">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4484105">len</span><span class="op" id="4484108">(</span><span class="ident" id="4484109">re</span><span class="op" id="4484111">.</span><span class="ident" id="4484112">Sub</span><span class="op" id="4484115">)</span>&nbsp;<span class="op" id="4484117">&gt;</span>&nbsp;<span class="num" id="4484119">0</span>&nbsp;<span class="op" id="4484121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4484125">sub</span>&nbsp;<span class="op" id="4484129">:=</span>&nbsp;<span class="ident" id="4484132">re</span><span class="op" id="4484134">.</span><span class="ident" id="4484135">Sub</span><span class="op" id="4484138">[</span><span class="num" id="4484139">0</span><span class="op" id="4484140">]</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484144">if</span>&nbsp;<span class="ident" id="4484147">sub</span><span class="op" id="4484150">.</span><span class="ident" id="4484151">Op</span>&nbsp;<span class="op" id="4484154">==</span>&nbsp;<span class="ident" id="4484157">OpEmptyMatch</span>&nbsp;<span class="op" id="4484170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484175">return</span>&nbsp;<span class="ident" id="4484182">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4484188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484192">return</span>&nbsp;<span class="ident" id="4484199">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4484204">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484207">return</span>&nbsp;<span class="ident" id="4484214">re</span><br>
<span class="lineno"></span><span class="op" id="4484217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4484220">//&nbsp;removeLeadingRegexp&nbsp;removes&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;in&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="4484277">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno">650</span><span class="comment" id="4484315">//&nbsp;If&nbsp;reuse&nbsp;is&nbsp;true,&nbsp;it&nbsp;passes&nbsp;the&nbsp;removed&nbsp;regexp&nbsp;(if&nbsp;no&nbsp;longer&nbsp;needed)&nbsp;to&nbsp;p.reuse.</span><br>
<span class="lineno"></span><span class="keyword" id="4484399">func</span>&nbsp;<span class="op" id="4484404">(</span><span class="ident" id="4484405">p</span>&nbsp;<span class="op" id="4484407">*</span><span class="ident" id="4484408">parser</span><span class="op" id="4484414">)</span>&nbsp;<span class="ident" id="4484416">removeLeadingRegexp</span><span class="op" id="4484435">(</span><span class="ident" id="4484436">re</span>&nbsp;<span class="op" id="4484439">*</span><span class="ident" id="4484440">Regexp</span><span class="op" id="4484446">,</span>&nbsp;<span class="ident" id="4484448">reuse</span>&nbsp;<span class="builtintype" id="4484454">bool</span><span class="op" id="4484458">)</span>&nbsp;<span class="op" id="4484460">*</span><span class="ident" id="4484461">Regexp</span>&nbsp;<span class="op" id="4484468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484471">if</span>&nbsp;<span class="ident" id="4484474">re</span><span class="op" id="4484476">.</span><span class="ident" id="4484477">Op</span>&nbsp;<span class="op" id="4484480">==</span>&nbsp;<span class="ident" id="4484483">OpConcat</span>&nbsp;<span class="op" id="4484492">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4484495">len</span><span class="op" id="4484498">(</span><span class="ident" id="4484499">re</span><span class="op" id="4484501">.</span><span class="ident" id="4484502">Sub</span><span class="op" id="4484505">)</span>&nbsp;<span class="op" id="4484507">&gt;</span>&nbsp;<span class="num" id="4484509">0</span>&nbsp;<span class="op" id="4484511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484515">if</span>&nbsp;<span class="ident" id="4484518">reuse</span>&nbsp;<span class="op" id="4484524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4484529">p</span><span class="op" id="4484530">.</span><span class="ident" id="4484531">reuse</span><span class="op" id="4484536">(</span><span class="ident" id="4484537">re</span><span class="op" id="4484539">.</span><span class="ident" id="4484540">Sub</span><span class="op" id="4484543">[</span><span class="num" id="4484544">0</span><span class="op" id="4484545">]</span><span class="op" id="4484546">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4484550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4484554">re</span><span class="op" id="4484556">.</span><span class="ident" id="4484557">Sub</span>&nbsp;<span class="op" id="4484561">=</span>&nbsp;<span class="ident" id="4484563">re</span><span class="op" id="4484565">.</span><span class="ident" id="4484566">Sub</span><span class="op" id="4484569">[</span><span class="op" id="4484570">:</span><span class="builtinfunc" id="4484571">copy</span><span class="op" id="4484575">(</span><span class="ident" id="4484576">re</span><span class="op" id="4484578">.</span><span class="ident" id="4484579">Sub</span><span class="op" id="4484582">,</span>&nbsp;<span class="ident" id="4484584">re</span><span class="op" id="4484586">.</span><span class="ident" id="4484587">Sub</span><span class="op" id="4484590">[</span><span class="num" id="4484591">1</span><span class="op" id="4484592">:</span><span class="op" id="4484593">]</span><span class="op" id="4484594">)</span><span class="op" id="4484595">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484599">switch</span>&nbsp;<span class="builtinfunc" id="4484606">len</span><span class="op" id="4484609">(</span><span class="ident" id="4484610">re</span><span class="op" id="4484612">.</span><span class="ident" id="4484613">Sub</span><span class="op" id="4484616">)</span>&nbsp;<span class="op" id="4484618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484622">case</span>&nbsp;<span class="num" id="4484627">0</span><span class="op" id="4484628">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4484633">re</span><span class="op" id="4484635">.</span><span class="ident" id="4484636">Op</span>&nbsp;<span class="op" id="4484639">=</span>&nbsp;<span class="ident" id="4484641">OpEmptyMatch</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4484657">re</span><span class="op" id="4484659">.</span><span class="ident" id="4484660">Sub</span>&nbsp;<span class="op" id="4484664">=</span>&nbsp;<span class="ident" id="4484666">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484672">case</span>&nbsp;<span class="num" id="4484677">1</span><span class="op" id="4484678">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4484683">old</span>&nbsp;<span class="op" id="4484687">:=</span>&nbsp;<span class="ident" id="4484690">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4484696">re</span>&nbsp;<span class="op" id="4484699">=</span>&nbsp;<span class="ident" id="4484701">re</span><span class="op" id="4484703">.</span><span class="ident" id="4484704">Sub</span><span class="op" id="4484707">[</span><span class="num" id="4484708">0</span><span class="op" id="4484709">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4484714">p</span><span class="op" id="4484715">.</span><span class="ident" id="4484716">reuse</span><span class="op" id="4484721">(</span><span class="ident" id="4484722">old</span><span class="op" id="4484725">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4484729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484733">return</span>&nbsp;<span class="ident" id="4484740">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4484744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484747">if</span>&nbsp;<span class="ident" id="4484750">reuse</span>&nbsp;<span class="op" id="4484756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4484760">p</span><span class="op" id="4484761">.</span><span class="ident" id="4484762">reuse</span><span class="op" id="4484767">(</span><span class="ident" id="4484768">re</span><span class="op" id="4484770">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4484773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484776">return</span>&nbsp;<span class="ident" id="4484783">p</span><span class="op" id="4484784">.</span><span class="ident" id="4484785">newRegexp</span><span class="op" id="4484794">(</span><span class="ident" id="4484795">OpEmptyMatch</span><span class="op" id="4484807">)</span><br>
<span class="lineno"></span><span class="op" id="4484809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4484812">func</span>&nbsp;<span class="ident" id="4484817">literalRegexp</span><span class="op" id="4484830">(</span><span class="ident" id="4484831">s</span>&nbsp;<span class="builtintype" id="4484833">string</span><span class="op" id="4484839">,</span>&nbsp;<span class="ident" id="4484841">flags</span>&nbsp;<span class="ident" id="4484847">Flags</span><span class="op" id="4484852">)</span>&nbsp;<span class="op" id="4484854">*</span><span class="ident" id="4484855">Regexp</span>&nbsp;<span class="op" id="4484862">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4484865">re</span>&nbsp;<span class="op" id="4484868">:=</span>&nbsp;<span class="op" id="4484871">&amp;</span><span class="ident" id="4484872">Regexp</span><span class="op" id="4484878">{</span><span class="ident" id="4484879">Op</span><span class="op" id="4484881">:</span>&nbsp;<span class="ident" id="4484883">OpLiteral</span><span class="op" id="4484892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4484895">re</span><span class="op" id="4484897">.</span><span class="ident" id="4484898">Flags</span>&nbsp;<span class="op" id="4484904">=</span>&nbsp;<span class="ident" id="4484906">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4484913">re</span><span class="op" id="4484915">.</span><span class="ident" id="4484916">Rune</span>&nbsp;<span class="op" id="4484921">=</span>&nbsp;<span class="ident" id="4484923">re</span><span class="op" id="4484925">.</span><span class="ident" id="4484926">Rune0</span><span class="op" id="4484931">[</span><span class="op" id="4484932">:</span><span class="num" id="4484933">0</span><span class="op" id="4484934">]</span>&nbsp;<span class="comment" id="4484936">//&nbsp;use&nbsp;local&nbsp;storage&nbsp;for&nbsp;small&nbsp;strings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4484976">for</span>&nbsp;<span class="ident" id="4484980">_</span><span class="op" id="4484981">,</span>&nbsp;<span class="ident" id="4484983">c</span>&nbsp;<span class="op" id="4484985">:=</span>&nbsp;<span class="keyword" id="4484988">range</span>&nbsp;<span class="ident" id="4484994">s</span>&nbsp;<span class="op" id="4484996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485000">if</span>&nbsp;<span class="builtinfunc" id="4485003">len</span><span class="op" id="4485006">(</span><span class="ident" id="4485007">re</span><span class="op" id="4485009">.</span><span class="ident" id="4485010">Rune</span><span class="op" id="4485014">)</span>&nbsp;<span class="op" id="4485016">&gt;=</span>&nbsp;<span class="builtinfunc" id="4485019">cap</span><span class="op" id="4485022">(</span><span class="ident" id="4485023">re</span><span class="op" id="4485025">.</span><span class="ident" id="4485026">Rune</span><span class="op" id="4485030">)</span>&nbsp;<span class="op" id="4485032">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4485037">//&nbsp;string&nbsp;is&nbsp;too&nbsp;long&nbsp;to&nbsp;fit&nbsp;in&nbsp;Rune0.&nbsp;&nbsp;let&nbsp;Go&nbsp;handle&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485097">re</span><span class="op" id="4485099">.</span><span class="ident" id="4485100">Rune</span>&nbsp;<span class="op" id="4485105">=</span>&nbsp;<span class="op" id="4485107">[</span><span class="op" id="4485108">]</span><span class="builtintype" id="4485109">rune</span><span class="op" id="4485113">(</span><span class="ident" id="4485114">s</span><span class="op" id="4485115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485120">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4485128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485132">re</span><span class="op" id="4485134">.</span><span class="ident" id="4485135">Rune</span>&nbsp;<span class="op" id="4485140">=</span>&nbsp;<span class="builtinfunc" id="4485142">append</span><span class="op" id="4485148">(</span><span class="ident" id="4485149">re</span><span class="op" id="4485151">.</span><span class="ident" id="4485152">Rune</span><span class="op" id="4485156">,</span>&nbsp;<span class="ident" id="4485158">c</span><span class="op" id="4485159">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4485162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485165">return</span>&nbsp;<span class="ident" id="4485172">re</span><br>
<span class="lineno"></span><span class="op" id="4485175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4485178">//&nbsp;Parsing.</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="comment" id="4485191">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;string&nbsp;s,&nbsp;controlled&nbsp;by&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="4485266">//&nbsp;Flags,&nbsp;and&nbsp;returns&nbsp;a&nbsp;regular&nbsp;expression&nbsp;parse&nbsp;tree.&nbsp;The&nbsp;syntax&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4485335">//&nbsp;described&nbsp;in&nbsp;the&nbsp;top-level&nbsp;comment.</span><br>
<span class="lineno"></span><span class="keyword" id="4485374">func</span>&nbsp;<span class="ident" id="4485379">Parse</span><span class="op" id="4485384">(</span><span class="ident" id="4485385">s</span>&nbsp;<span class="builtintype" id="4485387">string</span><span class="op" id="4485393">,</span>&nbsp;<span class="ident" id="4485395">flags</span>&nbsp;<span class="ident" id="4485401">Flags</span><span class="op" id="4485406">)</span>&nbsp;<span class="op" id="4485408">(</span><span class="op" id="4485409">*</span><span class="ident" id="4485410">Regexp</span><span class="op" id="4485416">,</span>&nbsp;<span class="builtintype" id="4485418">error</span><span class="op" id="4485423">)</span>&nbsp;<span class="op" id="4485425">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485428">if</span>&nbsp;<span class="ident" id="4485431">flags</span><span class="op" id="4485436">&amp;</span><span class="ident" id="4485437">Literal</span>&nbsp;<span class="op" id="4485445">!=</span>&nbsp;<span class="num" id="4485448">0</span>&nbsp;<span class="op" id="4485450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4485454">//&nbsp;Trivial&nbsp;parser&nbsp;for&nbsp;literal&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485494">if</span>&nbsp;<span class="ident" id="4485497">err</span>&nbsp;<span class="op" id="4485501">:=</span>&nbsp;<span class="ident" id="4485504">checkUTF8</span><span class="op" id="4485513">(</span><span class="ident" id="4485514">s</span><span class="op" id="4485515">)</span><span class="op" id="4485516">;</span>&nbsp;<span class="ident" id="4485518">err</span>&nbsp;<span class="op" id="4485522">!=</span>&nbsp;<span class="ident" id="4485525">nil</span>&nbsp;<span class="op" id="4485529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485534">return</span>&nbsp;<span class="ident" id="4485541">nil</span><span class="op" id="4485544">,</span>&nbsp;<span class="ident" id="4485546">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4485552">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485556">return</span>&nbsp;<span class="ident" id="4485563">literalRegexp</span><span class="op" id="4485576">(</span><span class="ident" id="4485577">s</span><span class="op" id="4485578">,</span>&nbsp;<span class="ident" id="4485580">flags</span><span class="op" id="4485585">)</span><span class="op" id="4485586">,</span>&nbsp;<span class="ident" id="4485588">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4485593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4485597">//&nbsp;Otherwise,&nbsp;must&nbsp;do&nbsp;real&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485631">var</span>&nbsp;<span class="op" id="4485635">(</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485639">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485650">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485659">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4485670">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485678">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4485689">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485696">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4485707">Op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485712">lastRepeat</span>&nbsp;<span class="builtintype" id="4485723">string</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4485731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485734">p</span><span class="op" id="4485735">.</span><span class="ident" id="4485736">flags</span>&nbsp;<span class="op" id="4485742">=</span>&nbsp;<span class="ident" id="4485744">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485751">p</span><span class="op" id="4485752">.</span><span class="ident" id="4485753">wholeRegexp</span>&nbsp;<span class="op" id="4485765">=</span>&nbsp;<span class="ident" id="4485767">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485770">t</span>&nbsp;<span class="op" id="4485772">:=</span>&nbsp;<span class="ident" id="4485775">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485778">for</span>&nbsp;<span class="ident" id="4485782">t</span>&nbsp;<span class="op" id="4485784">!=</span>&nbsp;<span class="string" id="4485787">&#34;&#34;</span>&nbsp;<span class="op" id="4485790">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485794">repeat</span>&nbsp;<span class="op" id="4485801">:=</span>&nbsp;<span class="string" id="4485804">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485808">BigSwitch</span><span class="op" id="4485817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485821">switch</span>&nbsp;<span class="ident" id="4485828">t</span><span class="op" id="4485829">[</span><span class="num" id="4485830">0</span><span class="op" id="4485831">]</span>&nbsp;<span class="op" id="4485833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485837">default</span><span class="op" id="4485844">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485849">if</span>&nbsp;<span class="ident" id="4485852">c</span><span class="op" id="4485853">,</span>&nbsp;<span class="ident" id="4485855">t</span><span class="op" id="4485856">,</span>&nbsp;<span class="ident" id="4485858">err</span>&nbsp;<span class="op" id="4485862">=</span>&nbsp;<span class="ident" id="4485864">nextRune</span><span class="op" id="4485872">(</span><span class="ident" id="4485873">t</span><span class="op" id="4485874">)</span><span class="op" id="4485875">;</span>&nbsp;<span class="ident" id="4485877">err</span>&nbsp;<span class="op" id="4485881">!=</span>&nbsp;<span class="ident" id="4485884">nil</span>&nbsp;<span class="op" id="4485888">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485894">return</span>&nbsp;<span class="ident" id="4485901">nil</span><span class="op" id="4485904">,</span>&nbsp;<span class="ident" id="4485906">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4485913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4485918">p</span><span class="op" id="4485919">.</span><span class="ident" id="4485920">literal</span><span class="op" id="4485927">(</span><span class="ident" id="4485928">c</span><span class="op" id="4485929">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485934">case</span>&nbsp;<span class="string" id="4485939">&#39;(&#39;</span><span class="op" id="4485942">:</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4485947">if</span>&nbsp;<span class="ident" id="4485950">p</span><span class="op" id="4485951">.</span><span class="ident" id="4485952">flags</span><span class="op" id="4485957">&amp;</span><span class="ident" id="4485958">PerlX</span>&nbsp;<span class="op" id="4485964">!=</span>&nbsp;<span class="num" id="4485967">0</span>&nbsp;<span class="op" id="4485969">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4485972">len</span><span class="op" id="4485975">(</span><span class="ident" id="4485976">t</span><span class="op" id="4485977">)</span>&nbsp;<span class="op" id="4485979">&gt;=</span>&nbsp;<span class="num" id="4485982">2</span>&nbsp;<span class="op" id="4485984">&amp;&amp;</span>&nbsp;<span class="ident" id="4485987">t</span><span class="op" id="4485988">[</span><span class="num" id="4485989">1</span><span class="op" id="4485990">]</span>&nbsp;<span class="op" id="4485992">==</span>&nbsp;<span class="string" id="4485995">&#39;?&#39;</span>&nbsp;<span class="op" id="4485999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4486005">//&nbsp;Flag&nbsp;changes&nbsp;and&nbsp;non-capturing&nbsp;groups.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486051">if</span>&nbsp;<span class="ident" id="4486054">t</span><span class="op" id="4486055">,</span>&nbsp;<span class="ident" id="4486057">err</span>&nbsp;<span class="op" id="4486061">=</span>&nbsp;<span class="ident" id="4486063">p</span><span class="op" id="4486064">.</span><span class="ident" id="4486065">parsePerlFlags</span><span class="op" id="4486079">(</span><span class="ident" id="4486080">t</span><span class="op" id="4486081">)</span><span class="op" id="4486082">;</span>&nbsp;<span class="ident" id="4486084">err</span>&nbsp;<span class="op" id="4486088">!=</span>&nbsp;<span class="ident" id="4486091">nil</span>&nbsp;<span class="op" id="4486095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486102">return</span>&nbsp;<span class="ident" id="4486109">nil</span><span class="op" id="4486112">,</span>&nbsp;<span class="ident" id="4486114">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4486122">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486128">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4486137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486142">p</span><span class="op" id="4486143">.</span><span class="ident" id="4486144">numCap</span><span class="op" id="4486150">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486156">p</span><span class="op" id="4486157">.</span><span class="ident" id="4486158">op</span><span class="op" id="4486160">(</span><span class="ident" id="4486161">opLeftParen</span><span class="op" id="4486172">)</span><span class="op" id="4486173">.</span><span class="ident" id="4486174">Cap</span>&nbsp;<span class="op" id="4486178">=</span>&nbsp;<span class="ident" id="4486180">p</span><span class="op" id="4486181">.</span><span class="ident" id="4486182">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486192">t</span>&nbsp;<span class="op" id="4486194">=</span>&nbsp;<span class="ident" id="4486196">t</span><span class="op" id="4486197">[</span><span class="num" id="4486198">1</span><span class="op" id="4486199">:</span><span class="op" id="4486200">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486204">case</span>&nbsp;<span class="string" id="4486209">&#39;|&#39;</span><span class="op" id="4486212">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486217">if</span>&nbsp;<span class="ident" id="4486220">err</span>&nbsp;<span class="op" id="4486224">=</span>&nbsp;<span class="ident" id="4486226">p</span><span class="op" id="4486227">.</span><span class="ident" id="4486228">parseVerticalBar</span><span class="op" id="4486244">(</span><span class="op" id="4486245">)</span><span class="op" id="4486246">;</span>&nbsp;<span class="ident" id="4486248">err</span>&nbsp;<span class="op" id="4486252">!=</span>&nbsp;<span class="ident" id="4486255">nil</span>&nbsp;<span class="op" id="4486259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486265">return</span>&nbsp;<span class="ident" id="4486272">nil</span><span class="op" id="4486275">,</span>&nbsp;<span class="ident" id="4486277">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4486284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486289">t</span>&nbsp;<span class="op" id="4486291">=</span>&nbsp;<span class="ident" id="4486293">t</span><span class="op" id="4486294">[</span><span class="num" id="4486295">1</span><span class="op" id="4486296">:</span><span class="op" id="4486297">]</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486301">case</span>&nbsp;<span class="string" id="4486306">&#39;)&#39;</span><span class="op" id="4486309">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486314">if</span>&nbsp;<span class="ident" id="4486317">err</span>&nbsp;<span class="op" id="4486321">=</span>&nbsp;<span class="ident" id="4486323">p</span><span class="op" id="4486324">.</span><span class="ident" id="4486325">parseRightParen</span><span class="op" id="4486340">(</span><span class="op" id="4486341">)</span><span class="op" id="4486342">;</span>&nbsp;<span class="ident" id="4486344">err</span>&nbsp;<span class="op" id="4486348">!=</span>&nbsp;<span class="ident" id="4486351">nil</span>&nbsp;<span class="op" id="4486355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486361">return</span>&nbsp;<span class="ident" id="4486368">nil</span><span class="op" id="4486371">,</span>&nbsp;<span class="ident" id="4486373">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4486380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486385">t</span>&nbsp;<span class="op" id="4486387">=</span>&nbsp;<span class="ident" id="4486389">t</span><span class="op" id="4486390">[</span><span class="num" id="4486391">1</span><span class="op" id="4486392">:</span><span class="op" id="4486393">]</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486397">case</span>&nbsp;<span class="string" id="4486402">&#39;^&#39;</span><span class="op" id="4486405">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486410">if</span>&nbsp;<span class="ident" id="4486413">p</span><span class="op" id="4486414">.</span><span class="ident" id="4486415">flags</span><span class="op" id="4486420">&amp;</span><span class="ident" id="4486421">OneLine</span>&nbsp;<span class="op" id="4486429">!=</span>&nbsp;<span class="num" id="4486432">0</span>&nbsp;<span class="op" id="4486434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486440">p</span><span class="op" id="4486441">.</span><span class="ident" id="4486442">op</span><span class="op" id="4486444">(</span><span class="ident" id="4486445">OpBeginText</span><span class="op" id="4486456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4486461">}</span>&nbsp;<span class="keyword" id="4486463">else</span>&nbsp;<span class="op" id="4486468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486474">p</span><span class="op" id="4486475">.</span><span class="ident" id="4486476">op</span><span class="op" id="4486478">(</span><span class="ident" id="4486479">OpBeginLine</span><span class="op" id="4486490">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4486495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486500">t</span>&nbsp;<span class="op" id="4486502">=</span>&nbsp;<span class="ident" id="4486504">t</span><span class="op" id="4486505">[</span><span class="num" id="4486506">1</span><span class="op" id="4486507">:</span><span class="op" id="4486508">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486512">case</span>&nbsp;<span class="string" id="4486517">&#39;$&#39;</span><span class="op" id="4486520">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486525">if</span>&nbsp;<span class="ident" id="4486528">p</span><span class="op" id="4486529">.</span><span class="ident" id="4486530">flags</span><span class="op" id="4486535">&amp;</span><span class="ident" id="4486536">OneLine</span>&nbsp;<span class="op" id="4486544">!=</span>&nbsp;<span class="num" id="4486547">0</span>&nbsp;<span class="op" id="4486549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486555">p</span><span class="op" id="4486556">.</span><span class="ident" id="4486557">op</span><span class="op" id="4486559">(</span><span class="ident" id="4486560">OpEndText</span><span class="op" id="4486569">)</span><span class="op" id="4486570">.</span><span class="ident" id="4486571">Flags</span>&nbsp;<span class="op" id="4486577">|=</span>&nbsp;<span class="ident" id="4486580">WasDollar</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4486593">}</span>&nbsp;<span class="keyword" id="4486595">else</span>&nbsp;<span class="op" id="4486600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486606">p</span><span class="op" id="4486607">.</span><span class="ident" id="4486608">op</span><span class="op" id="4486610">(</span><span class="ident" id="4486611">OpEndLine</span><span class="op" id="4486620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4486625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486630">t</span>&nbsp;<span class="op" id="4486632">=</span>&nbsp;<span class="ident" id="4486634">t</span><span class="op" id="4486635">[</span><span class="num" id="4486636">1</span><span class="op" id="4486637">:</span><span class="op" id="4486638">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486642">case</span>&nbsp;<span class="string" id="4486647">&#39;.&#39;</span><span class="op" id="4486650">:</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486655">if</span>&nbsp;<span class="ident" id="4486658">p</span><span class="op" id="4486659">.</span><span class="ident" id="4486660">flags</span><span class="op" id="4486665">&amp;</span><span class="ident" id="4486666">DotNL</span>&nbsp;<span class="op" id="4486672">!=</span>&nbsp;<span class="num" id="4486675">0</span>&nbsp;<span class="op" id="4486677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486683">p</span><span class="op" id="4486684">.</span><span class="ident" id="4486685">op</span><span class="op" id="4486687">(</span><span class="ident" id="4486688">OpAnyChar</span><span class="op" id="4486697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4486702">}</span>&nbsp;<span class="keyword" id="4486704">else</span>&nbsp;<span class="op" id="4486709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486715">p</span><span class="op" id="4486716">.</span><span class="ident" id="4486717">op</span><span class="op" id="4486719">(</span><span class="ident" id="4486720">OpAnyCharNotNL</span><span class="op" id="4486734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4486739">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486744">t</span>&nbsp;<span class="op" id="4486746">=</span>&nbsp;<span class="ident" id="4486748">t</span><span class="op" id="4486749">[</span><span class="num" id="4486750">1</span><span class="op" id="4486751">:</span><span class="op" id="4486752">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486756">case</span>&nbsp;<span class="string" id="4486761">&#39;[&#39;</span><span class="op" id="4486764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486769">if</span>&nbsp;<span class="ident" id="4486772">t</span><span class="op" id="4486773">,</span>&nbsp;<span class="ident" id="4486775">err</span>&nbsp;<span class="op" id="4486779">=</span>&nbsp;<span class="ident" id="4486781">p</span><span class="op" id="4486782">.</span><span class="ident" id="4486783">parseClass</span><span class="op" id="4486793">(</span><span class="ident" id="4486794">t</span><span class="op" id="4486795">)</span><span class="op" id="4486796">;</span>&nbsp;<span class="ident" id="4486798">err</span>&nbsp;<span class="op" id="4486802">!=</span>&nbsp;<span class="ident" id="4486805">nil</span>&nbsp;<span class="op" id="4486809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486815">return</span>&nbsp;<span class="ident" id="4486822">nil</span><span class="op" id="4486825">,</span>&nbsp;<span class="ident" id="4486827">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4486834">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486838">case</span>&nbsp;<span class="string" id="4486843">&#39;*&#39;</span><span class="op" id="4486846">,</span>&nbsp;<span class="string" id="4486848">&#39;+&#39;</span><span class="op" id="4486851">,</span>&nbsp;<span class="string" id="4486853">&#39;?&#39;</span><span class="op" id="4486856">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486861">before</span>&nbsp;<span class="op" id="4486868">:=</span>&nbsp;<span class="ident" id="4486871">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486876">switch</span>&nbsp;<span class="ident" id="4486883">t</span><span class="op" id="4486884">[</span><span class="num" id="4486885">0</span><span class="op" id="4486886">]</span>&nbsp;<span class="op" id="4486888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486893">case</span>&nbsp;<span class="string" id="4486898">&#39;*&#39;</span><span class="op" id="4486901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486907">op</span>&nbsp;<span class="op" id="4486910">=</span>&nbsp;<span class="ident" id="4486912">OpStar</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486922">case</span>&nbsp;<span class="string" id="4486927">&#39;+&#39;</span><span class="op" id="4486930">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486936">op</span>&nbsp;<span class="op" id="4486939">=</span>&nbsp;<span class="ident" id="4486941">OpPlus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4486951">case</span>&nbsp;<span class="string" id="4486956">&#39;?&#39;</span><span class="op" id="4486959">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486965">op</span>&nbsp;<span class="op" id="4486968">=</span>&nbsp;<span class="ident" id="4486970">OpQuest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4486981">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4486986">after</span>&nbsp;<span class="op" id="4486992">:=</span>&nbsp;<span class="ident" id="4486995">t</span><span class="op" id="4486996">[</span><span class="num" id="4486997">1</span><span class="op" id="4486998">:</span><span class="op" id="4486999">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487004">if</span>&nbsp;<span class="ident" id="4487007">after</span><span class="op" id="4487012">,</span>&nbsp;<span class="ident" id="4487014">err</span>&nbsp;<span class="op" id="4487018">=</span>&nbsp;<span class="ident" id="4487020">p</span><span class="op" id="4487021">.</span><span class="ident" id="4487022">repeat</span><span class="op" id="4487028">(</span><span class="ident" id="4487029">op</span><span class="op" id="4487031">,</span>&nbsp;<span class="num" id="4487033">0</span><span class="op" id="4487034">,</span>&nbsp;<span class="num" id="4487036">0</span><span class="op" id="4487037">,</span>&nbsp;<span class="ident" id="4487039">before</span><span class="op" id="4487045">,</span>&nbsp;<span class="ident" id="4487047">after</span><span class="op" id="4487052">,</span>&nbsp;<span class="ident" id="4487054">lastRepeat</span><span class="op" id="4487064">)</span><span class="op" id="4487065">;</span>&nbsp;<span class="ident" id="4487067">err</span>&nbsp;<span class="op" id="4487071">!=</span>&nbsp;<span class="ident" id="4487074">nil</span>&nbsp;<span class="op" id="4487078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487084">return</span>&nbsp;<span class="ident" id="4487091">nil</span><span class="op" id="4487094">,</span>&nbsp;<span class="ident" id="4487096">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4487103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487108">repeat</span>&nbsp;<span class="op" id="4487115">=</span>&nbsp;<span class="ident" id="4487117">before</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487127">t</span>&nbsp;<span class="op" id="4487129">=</span>&nbsp;<span class="ident" id="4487131">after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487139">case</span>&nbsp;<span class="string" id="4487144">&#39;{&#39;</span><span class="op" id="4487147">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487152">op</span>&nbsp;<span class="op" id="4487155">=</span>&nbsp;<span class="ident" id="4487157">OpRepeat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487169">before</span>&nbsp;<span class="op" id="4487176">:=</span>&nbsp;<span class="ident" id="4487179">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487184">min</span><span class="op" id="4487187">,</span>&nbsp;<span class="ident" id="4487189">max</span><span class="op" id="4487192">,</span>&nbsp;<span class="ident" id="4487194">after</span><span class="op" id="4487199">,</span>&nbsp;<span class="ident" id="4487201">ok</span>&nbsp;<span class="op" id="4487204">:=</span>&nbsp;<span class="ident" id="4487207">p</span><span class="op" id="4487208">.</span><span class="ident" id="4487209">parseRepeat</span><span class="op" id="4487220">(</span><span class="ident" id="4487221">t</span><span class="op" id="4487222">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487227">if</span>&nbsp;<span class="op" id="4487230">!</span><span class="ident" id="4487231">ok</span>&nbsp;<span class="op" id="4487234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4487240">//&nbsp;If&nbsp;the&nbsp;repeat&nbsp;cannot&nbsp;be&nbsp;parsed,&nbsp;{&nbsp;is&nbsp;a&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487295">p</span><span class="op" id="4487296">.</span><span class="ident" id="4487297">literal</span><span class="op" id="4487304">(</span><span class="string" id="4487305">&#39;{&#39;</span><span class="op" id="4487308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487314">t</span>&nbsp;<span class="op" id="4487316">=</span>&nbsp;<span class="ident" id="4487318">t</span><span class="op" id="4487319">[</span><span class="num" id="4487320">1</span><span class="op" id="4487321">:</span><span class="op" id="4487322">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487328">break</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4487337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487342">if</span>&nbsp;<span class="ident" id="4487345">min</span>&nbsp;<span class="op" id="4487349">&lt;</span>&nbsp;<span class="num" id="4487351">0</span>&nbsp;<span class="op" id="4487353">||</span>&nbsp;<span class="ident" id="4487356">min</span>&nbsp;<span class="op" id="4487360">&gt;</span>&nbsp;<span class="num" id="4487362">1000</span>&nbsp;<span class="op" id="4487367">||</span>&nbsp;<span class="ident" id="4487370">max</span>&nbsp;<span class="op" id="4487374">&gt;</span>&nbsp;<span class="num" id="4487376">1000</span>&nbsp;<span class="op" id="4487381">||</span>&nbsp;<span class="ident" id="4487384">max</span>&nbsp;<span class="op" id="4487388">&gt;=</span>&nbsp;<span class="num" id="4487391">0</span>&nbsp;<span class="op" id="4487393">&amp;&amp;</span>&nbsp;<span class="ident" id="4487396">min</span>&nbsp;<span class="op" id="4487400">&gt;</span>&nbsp;<span class="ident" id="4487402">max</span>&nbsp;<span class="op" id="4487406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4487412">//&nbsp;Numbers&nbsp;were&nbsp;too&nbsp;big,&nbsp;or&nbsp;max&nbsp;is&nbsp;present&nbsp;and&nbsp;min&nbsp;&gt;&nbsp;max.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487474">return</span>&nbsp;<span class="ident" id="4487481">nil</span><span class="op" id="4487484">,</span>&nbsp;<span class="op" id="4487486">&amp;</span><span class="ident" id="4487487">Error</span><span class="op" id="4487492">{</span><span class="ident" id="4487493">ErrInvalidRepeatSize</span><span class="op" id="4487513">,</span>&nbsp;<span class="ident" id="4487515">before</span><span class="op" id="4487521">[</span><span class="op" id="4487522">:</span><span class="builtinfunc" id="4487523">len</span><span class="op" id="4487526">(</span><span class="ident" id="4487527">before</span><span class="op" id="4487533">)</span><span class="op" id="4487534">-</span><span class="builtinfunc" id="4487535">len</span><span class="op" id="4487538">(</span><span class="ident" id="4487539">after</span><span class="op" id="4487544">)</span><span class="op" id="4487545">]</span><span class="op" id="4487546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4487551">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487556">if</span>&nbsp;<span class="ident" id="4487559">after</span><span class="op" id="4487564">,</span>&nbsp;<span class="ident" id="4487566">err</span>&nbsp;<span class="op" id="4487570">=</span>&nbsp;<span class="ident" id="4487572">p</span><span class="op" id="4487573">.</span><span class="ident" id="4487574">repeat</span><span class="op" id="4487580">(</span><span class="ident" id="4487581">op</span><span class="op" id="4487583">,</span>&nbsp;<span class="ident" id="4487585">min</span><span class="op" id="4487588">,</span>&nbsp;<span class="ident" id="4487590">max</span><span class="op" id="4487593">,</span>&nbsp;<span class="ident" id="4487595">before</span><span class="op" id="4487601">,</span>&nbsp;<span class="ident" id="4487603">after</span><span class="op" id="4487608">,</span>&nbsp;<span class="ident" id="4487610">lastRepeat</span><span class="op" id="4487620">)</span><span class="op" id="4487621">;</span>&nbsp;<span class="ident" id="4487623">err</span>&nbsp;<span class="op" id="4487627">!=</span>&nbsp;<span class="ident" id="4487630">nil</span>&nbsp;<span class="op" id="4487634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487640">return</span>&nbsp;<span class="ident" id="4487647">nil</span><span class="op" id="4487650">,</span>&nbsp;<span class="ident" id="4487652">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4487659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487664">repeat</span>&nbsp;<span class="op" id="4487671">=</span>&nbsp;<span class="ident" id="4487673">before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487683">t</span>&nbsp;<span class="op" id="4487685">=</span>&nbsp;<span class="ident" id="4487687">after</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487695">case</span>&nbsp;<span class="string" id="4487700">&#39;\\&#39;</span><span class="op" id="4487704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487709">if</span>&nbsp;<span class="ident" id="4487712">p</span><span class="op" id="4487713">.</span><span class="ident" id="4487714">flags</span><span class="op" id="4487719">&amp;</span><span class="ident" id="4487720">PerlX</span>&nbsp;<span class="op" id="4487726">!=</span>&nbsp;<span class="num" id="4487729">0</span>&nbsp;<span class="op" id="4487731">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4487734">len</span><span class="op" id="4487737">(</span><span class="ident" id="4487738">t</span><span class="op" id="4487739">)</span>&nbsp;<span class="op" id="4487741">&gt;=</span>&nbsp;<span class="num" id="4487744">2</span>&nbsp;<span class="op" id="4487746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487752">switch</span>&nbsp;<span class="ident" id="4487759">t</span><span class="op" id="4487760">[</span><span class="num" id="4487761">1</span><span class="op" id="4487762">]</span>&nbsp;<span class="op" id="4487764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487770">case</span>&nbsp;<span class="string" id="4487775">&#39;A&#39;</span><span class="op" id="4487778">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487785">p</span><span class="op" id="4487786">.</span><span class="ident" id="4487787">op</span><span class="op" id="4487789">(</span><span class="ident" id="4487790">OpBeginText</span><span class="op" id="4487801">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487808">t</span>&nbsp;<span class="op" id="4487810">=</span>&nbsp;<span class="ident" id="4487812">t</span><span class="op" id="4487813">[</span><span class="num" id="4487814">2</span><span class="op" id="4487815">:</span><span class="op" id="4487816">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487823">break</span>&nbsp;<span class="ident" id="4487829">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487843">case</span>&nbsp;<span class="string" id="4487848">&#39;b&#39;</span><span class="op" id="4487851">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487858">p</span><span class="op" id="4487859">.</span><span class="ident" id="4487860">op</span><span class="op" id="4487862">(</span><span class="ident" id="4487863">OpWordBoundary</span><span class="op" id="4487877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487884">t</span>&nbsp;<span class="op" id="4487886">=</span>&nbsp;<span class="ident" id="4487888">t</span><span class="op" id="4487889">[</span><span class="num" id="4487890">2</span><span class="op" id="4487891">:</span><span class="op" id="4487892">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487899">break</span>&nbsp;<span class="ident" id="4487905">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487919">case</span>&nbsp;<span class="string" id="4487924">&#39;B&#39;</span><span class="op" id="4487927">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487934">p</span><span class="op" id="4487935">.</span><span class="ident" id="4487936">op</span><span class="op" id="4487938">(</span><span class="ident" id="4487939">OpNoWordBoundary</span><span class="op" id="4487955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487962">t</span>&nbsp;<span class="op" id="4487964">=</span>&nbsp;<span class="ident" id="4487966">t</span><span class="op" id="4487967">[</span><span class="num" id="4487968">2</span><span class="op" id="4487969">:</span><span class="op" id="4487970">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487977">break</span>&nbsp;<span class="ident" id="4487983">BigSwitch</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487997">case</span>&nbsp;<span class="string" id="4488002">&#39;C&#39;</span><span class="op" id="4488005">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4488012">//&nbsp;any&nbsp;byte;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488044">return</span>&nbsp;<span class="ident" id="4488051">nil</span><span class="op" id="4488054">,</span>&nbsp;<span class="op" id="4488056">&amp;</span><span class="ident" id="4488057">Error</span><span class="op" id="4488062">{</span><span class="ident" id="4488063">ErrInvalidEscape</span><span class="op" id="4488079">,</span>&nbsp;<span class="ident" id="4488081">t</span><span class="op" id="4488082">[</span><span class="op" id="4488083">:</span><span class="num" id="4488084">2</span><span class="op" id="4488085">]</span><span class="op" id="4488086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488092">case</span>&nbsp;<span class="string" id="4488097">&#39;Q&#39;</span><span class="op" id="4488100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4488107">//&nbsp;\Q&nbsp;...&nbsp;\E:&nbsp;the&nbsp;...&nbsp;is&nbsp;always&nbsp;literals</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488153">var</span>&nbsp;<span class="ident" id="4488157">lit</span>&nbsp;<span class="builtintype" id="4488161">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488173">if</span>&nbsp;<span class="ident" id="4488176">i</span>&nbsp;<span class="op" id="4488178">:=</span>&nbsp;<span class="ident" id="4488181">strings</span><span class="op" id="4488188">.</span><span class="ident" id="4488189">Index</span><span class="op" id="4488194">(</span><span class="ident" id="4488195">t</span><span class="op" id="4488196">,</span>&nbsp;<span class="string" id="4488198">`\E`</span><span class="op" id="4488202">)</span><span class="op" id="4488203">;</span>&nbsp;<span class="ident" id="4488205">i</span>&nbsp;<span class="op" id="4488207">&lt;</span>&nbsp;<span class="num" id="4488209">0</span>&nbsp;<span class="op" id="4488211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488219">lit</span>&nbsp;<span class="op" id="4488223">=</span>&nbsp;<span class="ident" id="4488225">t</span><span class="op" id="4488226">[</span><span class="num" id="4488227">2</span><span class="op" id="4488228">:</span><span class="op" id="4488229">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488237">t</span>&nbsp;<span class="op" id="4488239">=</span>&nbsp;<span class="string" id="4488241">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4488249">}</span>&nbsp;<span class="keyword" id="4488251">else</span>&nbsp;<span class="op" id="4488256">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488264">lit</span>&nbsp;<span class="op" id="4488268">=</span>&nbsp;<span class="ident" id="4488270">t</span><span class="op" id="4488271">[</span><span class="num" id="4488272">2</span><span class="op" id="4488273">:</span><span class="ident" id="4488274">i</span><span class="op" id="4488275">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488283">t</span>&nbsp;<span class="op" id="4488285">=</span>&nbsp;<span class="ident" id="4488287">t</span><span class="op" id="4488288">[</span><span class="ident" id="4488289">i</span><span class="op" id="4488290">+</span><span class="num" id="4488291">2</span><span class="op" id="4488292">:</span><span class="op" id="4488293">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4488300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488307">p</span><span class="op" id="4488308">.</span><span class="ident" id="4488309">push</span><span class="op" id="4488313">(</span><span class="ident" id="4488314">literalRegexp</span><span class="op" id="4488327">(</span><span class="ident" id="4488328">lit</span><span class="op" id="4488331">,</span>&nbsp;<span class="ident" id="4488333">p</span><span class="op" id="4488334">.</span><span class="ident" id="4488335">flags</span><span class="op" id="4488340">)</span><span class="op" id="4488341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488348">break</span>&nbsp;<span class="ident" id="4488354">BigSwitch</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488368">case</span>&nbsp;<span class="string" id="4488373">&#39;z&#39;</span><span class="op" id="4488376">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488383">p</span><span class="op" id="4488384">.</span><span class="ident" id="4488385">op</span><span class="op" id="4488387">(</span><span class="ident" id="4488388">OpEndText</span><span class="op" id="4488397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488404">t</span>&nbsp;<span class="op" id="4488406">=</span>&nbsp;<span class="ident" id="4488408">t</span><span class="op" id="4488409">[</span><span class="num" id="4488410">2</span><span class="op" id="4488411">:</span><span class="op" id="4488412">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488419">break</span>&nbsp;<span class="ident" id="4488425">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4488439">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4488444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488450">re</span>&nbsp;<span class="op" id="4488453">:=</span>&nbsp;<span class="ident" id="4488456">p</span><span class="op" id="4488457">.</span><span class="ident" id="4488458">newRegexp</span><span class="op" id="4488467">(</span><span class="ident" id="4488468">OpCharClass</span><span class="op" id="4488479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488484">re</span><span class="op" id="4488486">.</span><span class="ident" id="4488487">Flags</span>&nbsp;<span class="op" id="4488493">=</span>&nbsp;<span class="ident" id="4488495">p</span><span class="op" id="4488496">.</span><span class="ident" id="4488497">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4488507">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488559">if</span>&nbsp;<span class="builtinfunc" id="4488562">len</span><span class="op" id="4488565">(</span><span class="ident" id="4488566">t</span><span class="op" id="4488567">)</span>&nbsp;<span class="op" id="4488569">&gt;=</span>&nbsp;<span class="num" id="4488572">2</span>&nbsp;<span class="op" id="4488574">&amp;&amp;</span>&nbsp;<span class="op" id="4488577">(</span><span class="ident" id="4488578">t</span><span class="op" id="4488579">[</span><span class="num" id="4488580">1</span><span class="op" id="4488581">]</span>&nbsp;<span class="op" id="4488583">==</span>&nbsp;<span class="string" id="4488586">&#39;p&#39;</span>&nbsp;<span class="op" id="4488590">||</span>&nbsp;<span class="ident" id="4488593">t</span><span class="op" id="4488594">[</span><span class="num" id="4488595">1</span><span class="op" id="4488596">]</span>&nbsp;<span class="op" id="4488598">==</span>&nbsp;<span class="string" id="4488601">&#39;P&#39;</span><span class="op" id="4488604">)</span>&nbsp;<span class="op" id="4488606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488612">r</span><span class="op" id="4488613">,</span>&nbsp;<span class="ident" id="4488615">rest</span><span class="op" id="4488619">,</span>&nbsp;<span class="ident" id="4488621">err</span>&nbsp;<span class="op" id="4488625">:=</span>&nbsp;<span class="ident" id="4488628">p</span><span class="op" id="4488629">.</span><span class="ident" id="4488630">parseUnicodeClass</span><span class="op" id="4488647">(</span><span class="ident" id="4488648">t</span><span class="op" id="4488649">,</span>&nbsp;<span class="ident" id="4488651">re</span><span class="op" id="4488653">.</span><span class="ident" id="4488654">Rune0</span><span class="op" id="4488659">[</span><span class="op" id="4488660">:</span><span class="num" id="4488661">0</span><span class="op" id="4488662">]</span><span class="op" id="4488663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488669">if</span>&nbsp;<span class="ident" id="4488672">err</span>&nbsp;<span class="op" id="4488676">!=</span>&nbsp;<span class="ident" id="4488679">nil</span>&nbsp;<span class="op" id="4488683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488690">return</span>&nbsp;<span class="ident" id="4488697">nil</span><span class="op" id="4488700">,</span>&nbsp;<span class="ident" id="4488702">err</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4488710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488716">if</span>&nbsp;<span class="ident" id="4488719">r</span>&nbsp;<span class="op" id="4488721">!=</span>&nbsp;<span class="ident" id="4488724">nil</span>&nbsp;<span class="op" id="4488728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488735">re</span><span class="op" id="4488737">.</span><span class="ident" id="4488738">Rune</span>&nbsp;<span class="op" id="4488743">=</span>&nbsp;<span class="ident" id="4488745">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488752">t</span>&nbsp;<span class="op" id="4488754">=</span>&nbsp;<span class="ident" id="4488756">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488766">p</span><span class="op" id="4488767">.</span><span class="ident" id="4488768">push</span><span class="op" id="4488772">(</span><span class="ident" id="4488773">re</span><span class="op" id="4488775">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488782">break</span>&nbsp;<span class="ident" id="4488788">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4488802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4488807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4488813">//&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488848">if</span>&nbsp;<span class="ident" id="4488851">r</span><span class="op" id="4488852">,</span>&nbsp;<span class="ident" id="4488854">rest</span>&nbsp;<span class="op" id="4488859">:=</span>&nbsp;<span class="ident" id="4488862">p</span><span class="op" id="4488863">.</span><span class="ident" id="4488864">parsePerlClassEscape</span><span class="op" id="4488884">(</span><span class="ident" id="4488885">t</span><span class="op" id="4488886">,</span>&nbsp;<span class="ident" id="4488888">re</span><span class="op" id="4488890">.</span><span class="ident" id="4488891">Rune0</span><span class="op" id="4488896">[</span><span class="op" id="4488897">:</span><span class="num" id="4488898">0</span><span class="op" id="4488899">]</span><span class="op" id="4488900">)</span><span class="op" id="4488901">;</span>&nbsp;<span class="ident" id="4488903">r</span>&nbsp;<span class="op" id="4488905">!=</span>&nbsp;<span class="ident" id="4488908">nil</span>&nbsp;<span class="op" id="4488912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488918">re</span><span class="op" id="4488920">.</span><span class="ident" id="4488921">Rune</span>&nbsp;<span class="op" id="4488926">=</span>&nbsp;<span class="ident" id="4488928">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488934">t</span>&nbsp;<span class="op" id="4488936">=</span>&nbsp;<span class="ident" id="4488938">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488947">p</span><span class="op" id="4488948">.</span><span class="ident" id="4488949">push</span><span class="op" id="4488953">(</span><span class="ident" id="4488954">re</span><span class="op" id="4488956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488962">break</span>&nbsp;<span class="ident" id="4488968">BigSwitch</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4488981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488986">p</span><span class="op" id="4488987">.</span><span class="ident" id="4488988">reuse</span><span class="op" id="4488993">(</span><span class="ident" id="4488994">re</span><span class="op" id="4488996">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4489002">//&nbsp;Ordinary&nbsp;single-character&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489042">if</span>&nbsp;<span class="ident" id="4489045">c</span><span class="op" id="4489046">,</span>&nbsp;<span class="ident" id="4489048">t</span><span class="op" id="4489049">,</span>&nbsp;<span class="ident" id="4489051">err</span>&nbsp;<span class="op" id="4489055">=</span>&nbsp;<span class="ident" id="4489057">p</span><span class="op" id="4489058">.</span><span class="ident" id="4489059">parseEscape</span><span class="op" id="4489070">(</span><span class="ident" id="4489071">t</span><span class="op" id="4489072">)</span><span class="op" id="4489073">;</span>&nbsp;<span class="ident" id="4489075">err</span>&nbsp;<span class="op" id="4489079">!=</span>&nbsp;<span class="ident" id="4489082">nil</span>&nbsp;<span class="op" id="4489086">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489092">return</span>&nbsp;<span class="ident" id="4489099">nil</span><span class="op" id="4489102">,</span>&nbsp;<span class="ident" id="4489104">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489116">p</span><span class="op" id="4489117">.</span><span class="ident" id="4489118">literal</span><span class="op" id="4489125">(</span><span class="ident" id="4489126">c</span><span class="op" id="4489127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489135">lastRepeat</span>&nbsp;<span class="op" id="4489146">=</span>&nbsp;<span class="ident" id="4489148">repeat</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489160">p</span><span class="op" id="4489161">.</span><span class="ident" id="4489162">concat</span><span class="op" id="4489168">(</span><span class="op" id="4489169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489172">if</span>&nbsp;<span class="ident" id="4489175">p</span><span class="op" id="4489176">.</span><span class="ident" id="4489177">swapVerticalBar</span><span class="op" id="4489192">(</span><span class="op" id="4489193">)</span>&nbsp;<span class="op" id="4489195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4489199">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489221">p</span><span class="op" id="4489222">.</span><span class="ident" id="4489223">stack</span>&nbsp;<span class="op" id="4489229">=</span>&nbsp;<span class="ident" id="4489231">p</span><span class="op" id="4489232">.</span><span class="ident" id="4489233">stack</span><span class="op" id="4489238">[</span><span class="op" id="4489239">:</span><span class="builtinfunc" id="4489240">len</span><span class="op" id="4489243">(</span><span class="ident" id="4489244">p</span><span class="op" id="4489245">.</span><span class="ident" id="4489246">stack</span><span class="op" id="4489251">)</span><span class="op" id="4489252">-</span><span class="num" id="4489253">1</span><span class="op" id="4489254">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489260">p</span><span class="op" id="4489261">.</span><span class="ident" id="4489262">alternate</span><span class="op" id="4489271">(</span><span class="op" id="4489272">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489276">n</span>&nbsp;<span class="op" id="4489278">:=</span>&nbsp;<span class="builtinfunc" id="4489281">len</span><span class="op" id="4489284">(</span><span class="ident" id="4489285">p</span><span class="op" id="4489286">.</span><span class="ident" id="4489287">stack</span><span class="op" id="4489292">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489295">if</span>&nbsp;<span class="ident" id="4489298">n</span>&nbsp;<span class="op" id="4489300">!=</span>&nbsp;<span class="num" id="4489303">1</span>&nbsp;<span class="op" id="4489305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489309">return</span>&nbsp;<span class="ident" id="4489316">nil</span><span class="op" id="4489319">,</span>&nbsp;<span class="op" id="4489321">&amp;</span><span class="ident" id="4489322">Error</span><span class="op" id="4489327">{</span><span class="ident" id="4489328">ErrMissingParen</span><span class="op" id="4489343">,</span>&nbsp;<span class="ident" id="4489345">s</span><span class="op" id="4489346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489352">return</span>&nbsp;<span class="ident" id="4489359">p</span><span class="op" id="4489360">.</span><span class="ident" id="4489361">stack</span><span class="op" id="4489366">[</span><span class="num" id="4489367">0</span><span class="op" id="4489368">]</span><span class="op" id="4489369">,</span>&nbsp;<span class="ident" id="4489371">nil</span><br>
<span class="lineno"></span><span class="op" id="4489375">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span><span class="comment" id="4489378">//&nbsp;parseRepeat&nbsp;parses&nbsp;{min}&nbsp;(max=min)&nbsp;or&nbsp;{min,}&nbsp;(max=-1)&nbsp;or&nbsp;{min,max}.</span><br>
<span class="lineno"></span><span class="comment" id="4489449">//&nbsp;If&nbsp;s&nbsp;is&nbsp;not&nbsp;of&nbsp;that&nbsp;form,&nbsp;it&nbsp;returns&nbsp;ok&nbsp;==&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="4489502">//&nbsp;If&nbsp;s&nbsp;has&nbsp;the&nbsp;right&nbsp;form&nbsp;but&nbsp;the&nbsp;values&nbsp;are&nbsp;too&nbsp;big,&nbsp;it&nbsp;returns&nbsp;min&nbsp;==&nbsp;-1,&nbsp;ok&nbsp;==&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="4489591">func</span>&nbsp;<span class="op" id="4489596">(</span><span class="ident" id="4489597">p</span>&nbsp;<span class="op" id="4489599">*</span><span class="ident" id="4489600">parser</span><span class="op" id="4489606">)</span>&nbsp;<span class="ident" id="4489608">parseRepeat</span><span class="op" id="4489619">(</span><span class="ident" id="4489620">s</span>&nbsp;<span class="builtintype" id="4489622">string</span><span class="op" id="4489628">)</span>&nbsp;<span class="op" id="4489630">(</span><span class="ident" id="4489631">min</span><span class="op" id="4489634">,</span>&nbsp;<span class="ident" id="4489636">max</span>&nbsp;<span class="builtintype" id="4489640">int</span><span class="op" id="4489643">,</span>&nbsp;<span class="ident" id="4489645">rest</span>&nbsp;<span class="builtintype" id="4489650">string</span><span class="op" id="4489656">,</span>&nbsp;<span class="ident" id="4489658">ok</span>&nbsp;<span class="builtintype" id="4489661">bool</span><span class="op" id="4489665">)</span>&nbsp;<span class="op" id="4489667">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489670">if</span>&nbsp;<span class="ident" id="4489673">s</span>&nbsp;<span class="op" id="4489675">==</span>&nbsp;<span class="string" id="4489678">&#34;&#34;</span>&nbsp;<span class="op" id="4489681">||</span>&nbsp;<span class="ident" id="4489684">s</span><span class="op" id="4489685">[</span><span class="num" id="4489686">0</span><span class="op" id="4489687">]</span>&nbsp;<span class="op" id="4489689">!=</span>&nbsp;<span class="string" id="4489692">&#39;{&#39;</span>&nbsp;<span class="op" id="4489696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489700">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489711">s</span>&nbsp;<span class="op" id="4489713">=</span>&nbsp;<span class="ident" id="4489715">s</span><span class="op" id="4489716">[</span><span class="num" id="4489717">1</span><span class="op" id="4489718">:</span><span class="op" id="4489719">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489722">var</span>&nbsp;<span class="ident" id="4489726">ok1</span>&nbsp;<span class="builtintype" id="4489730">bool</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489736">if</span>&nbsp;<span class="ident" id="4489739">min</span><span class="op" id="4489742">,</span>&nbsp;<span class="ident" id="4489744">s</span><span class="op" id="4489745">,</span>&nbsp;<span class="ident" id="4489747">ok1</span>&nbsp;<span class="op" id="4489751">=</span>&nbsp;<span class="ident" id="4489753">p</span><span class="op" id="4489754">.</span><span class="ident" id="4489755">parseInt</span><span class="op" id="4489763">(</span><span class="ident" id="4489764">s</span><span class="op" id="4489765">)</span><span class="op" id="4489766">;</span>&nbsp;<span class="op" id="4489768">!</span><span class="ident" id="4489769">ok1</span>&nbsp;<span class="op" id="4489773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489777">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489788">if</span>&nbsp;<span class="ident" id="4489791">s</span>&nbsp;<span class="op" id="4489793">==</span>&nbsp;<span class="string" id="4489796">&#34;&#34;</span>&nbsp;<span class="op" id="4489799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489803">return</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489814">if</span>&nbsp;<span class="ident" id="4489817">s</span><span class="op" id="4489818">[</span><span class="num" id="4489819">0</span><span class="op" id="4489820">]</span>&nbsp;<span class="op" id="4489822">!=</span>&nbsp;<span class="string" id="4489825">&#39;,&#39;</span>&nbsp;<span class="op" id="4489829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489833">max</span>&nbsp;<span class="op" id="4489837">=</span>&nbsp;<span class="ident" id="4489839">min</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489844">}</span>&nbsp;<span class="keyword" id="4489846">else</span>&nbsp;<span class="op" id="4489851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489855">s</span>&nbsp;<span class="op" id="4489857">=</span>&nbsp;<span class="ident" id="4489859">s</span><span class="op" id="4489860">[</span><span class="num" id="4489861">1</span><span class="op" id="4489862">:</span><span class="op" id="4489863">]</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489867">if</span>&nbsp;<span class="ident" id="4489870">s</span>&nbsp;<span class="op" id="4489872">==</span>&nbsp;<span class="string" id="4489875">&#34;&#34;</span>&nbsp;<span class="op" id="4489878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489883">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489896">if</span>&nbsp;<span class="ident" id="4489899">s</span><span class="op" id="4489900">[</span><span class="num" id="4489901">0</span><span class="op" id="4489902">]</span>&nbsp;<span class="op" id="4489904">==</span>&nbsp;<span class="string" id="4489907">&#39;}&#39;</span>&nbsp;<span class="op" id="4489911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489916">max</span>&nbsp;<span class="op" id="4489920">=</span>&nbsp;<span class="op" id="4489922">-</span><span class="num" id="4489923">1</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489927">}</span>&nbsp;<span class="keyword" id="4489929">else</span>&nbsp;<span class="keyword" id="4489934">if</span>&nbsp;<span class="ident" id="4489937">max</span><span class="op" id="4489940">,</span>&nbsp;<span class="ident" id="4489942">s</span><span class="op" id="4489943">,</span>&nbsp;<span class="ident" id="4489945">ok1</span>&nbsp;<span class="op" id="4489949">=</span>&nbsp;<span class="ident" id="4489951">p</span><span class="op" id="4489952">.</span><span class="ident" id="4489953">parseInt</span><span class="op" id="4489961">(</span><span class="ident" id="4489962">s</span><span class="op" id="4489963">)</span><span class="op" id="4489964">;</span>&nbsp;<span class="op" id="4489966">!</span><span class="ident" id="4489967">ok1</span>&nbsp;<span class="op" id="4489971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489976">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489985">}</span>&nbsp;<span class="keyword" id="4489987">else</span>&nbsp;<span class="keyword" id="4489992">if</span>&nbsp;<span class="ident" id="4489995">max</span>&nbsp;<span class="op" id="4489999">&lt;</span>&nbsp;<span class="num" id="4490001">0</span>&nbsp;<span class="op" id="4490003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4490008">//&nbsp;parseInt&nbsp;found&nbsp;too&nbsp;big&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4490046">min</span>&nbsp;<span class="op" id="4490050">=</span>&nbsp;<span class="op" id="4490052">-</span><span class="num" id="4490053">1</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4490057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4490060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4490063">if</span>&nbsp;<span class="ident" id="4490066">s</span>&nbsp;<span class="op" id="4490068">==</span>&nbsp;<span class="string" id="4490071">&#34;&#34;</span>&nbsp;<span class="op" id="4490074">||</span>&nbsp;<span class="ident" id="4490077">s</span><span class="op" id="4490078">[</span><span class="num" id="4490079">0</span><span class="op" id="4490080">]</span>&nbsp;<span class="op" id="4490082">!=</span>&nbsp;<span class="string" id="4490085">&#39;}&#39;</span>&nbsp;<span class="op" id="4490089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4490093">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4490101">}</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4490104">rest</span>&nbsp;<span class="op" id="4490109">=</span>&nbsp;<span class="ident" id="4490111">s</span><span class="op" id="4490112">[</span><span class="num" id="4490113">1</span><span class="op" id="4490114">:</span><span class="op" id="4490115">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4490118">ok</span>&nbsp;<span class="op" id="4490121">=</span>&nbsp;<span class="builtintype" id="4490123">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4490129">return</span><br>
<span class="lineno"></span><span class="op" id="4490136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span><span class="comment" id="4490139">//&nbsp;parsePerlFlags&nbsp;parses&nbsp;a&nbsp;Perl&nbsp;flag&nbsp;setting&nbsp;or&nbsp;non-capturing&nbsp;group&nbsp;or&nbsp;both,</span><br>
<span class="lineno"></span><span class="comment" id="4490216">//&nbsp;like&nbsp;(?i)&nbsp;or&nbsp;(?:&nbsp;or&nbsp;(?i:.&nbsp;&nbsp;It&nbsp;removes&nbsp;the&nbsp;prefix&nbsp;from&nbsp;s&nbsp;and&nbsp;updates&nbsp;the&nbsp;parse&nbsp;state.</span><br>
<span class="lineno"></span><span class="comment" id="4490304">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;have&nbsp;ensured&nbsp;that&nbsp;s&nbsp;begins&nbsp;with&nbsp;&#34;(?&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4490361">func</span>&nbsp;<span class="op" id="4490366">(</span><span class="ident" id="4490367">p</span>&nbsp;<span class="op" id="4490369">*</span><span class="ident" id="4490370">parser</span><span class="op" id="4490376">)</span>&nbsp;<span class="ident" id="4490378">parsePerlFlags</span><span class="op" id="4490392">(</span><span class="ident" id="4490393">s</span>&nbsp;<span class="builtintype" id="4490395">string</span><span class="op" id="4490401">)</span>&nbsp;<span class="op" id="4490403">(</span><span class="ident" id="4490404">rest</span>&nbsp;<span class="builtintype" id="4490409">string</span><span class="op" id="4490415">,</span>&nbsp;<span class="ident" id="4490417">err</span>&nbsp;<span class="builtintype" id="4490421">error</span><span class="op" id="4490426">)</span>&nbsp;<span class="op" id="4490428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4490431">t</span>&nbsp;<span class="op" id="4490433">:=</span>&nbsp;<span class="ident" id="4490436">s</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4490440">//&nbsp;Check&nbsp;for&nbsp;named&nbsp;captures,&nbsp;first&nbsp;introduced&nbsp;in&nbsp;Python&#39;s&nbsp;regexp&nbsp;library.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4490515">//&nbsp;As&nbsp;usual,&nbsp;there&nbsp;are&nbsp;three&nbsp;slightly&nbsp;different&nbsp;syntaxes:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4490574">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4490578">//&nbsp;&nbsp;&nbsp;(?P&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;the&nbsp;original,&nbsp;introduced&nbsp;by&nbsp;Python</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4490636">//&nbsp;&nbsp;&nbsp;(?&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4490701">//&nbsp;&nbsp;&nbsp;(?&#39;name&#39;expr)&nbsp;&nbsp;&nbsp;&nbsp;another&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4490770">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4490774">//&nbsp;Perl&nbsp;5.10&nbsp;gave&nbsp;in&nbsp;and&nbsp;implemented&nbsp;the&nbsp;Python&nbsp;version&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4490836">//&nbsp;but&nbsp;they&nbsp;claim&nbsp;that&nbsp;the&nbsp;last&nbsp;two&nbsp;are&nbsp;the&nbsp;preferred&nbsp;forms.</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4490898">//&nbsp;PCRE&nbsp;and&nbsp;languages&nbsp;based&nbsp;on&nbsp;it&nbsp;(specifically,&nbsp;PHP&nbsp;and&nbsp;Ruby)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4490962">//&nbsp;support&nbsp;all&nbsp;three&nbsp;as&nbsp;well.&nbsp;&nbsp;EcmaScript&nbsp;4&nbsp;uses&nbsp;only&nbsp;the&nbsp;Python&nbsp;form.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4491034">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4491038">//&nbsp;In&nbsp;both&nbsp;the&nbsp;open&nbsp;source&nbsp;world&nbsp;(via&nbsp;Code&nbsp;Search)&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4491098">//&nbsp;Google&nbsp;source&nbsp;tree,&nbsp;(?P&lt;expr&gt;name)&nbsp;is&nbsp;the&nbsp;dominant&nbsp;form,</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4491159">//&nbsp;so&nbsp;that&#39;s&nbsp;the&nbsp;one&nbsp;we&nbsp;implement.&nbsp;&nbsp;One&nbsp;is&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4491211">if</span>&nbsp;<span class="builtinfunc" id="4491214">len</span><span class="op" id="4491217">(</span><span class="ident" id="4491218">t</span><span class="op" id="4491219">)</span>&nbsp;<span class="op" id="4491221">&gt;</span>&nbsp;<span class="num" id="4491223">4</span>&nbsp;<span class="op" id="4491225">&amp;&amp;</span>&nbsp;<span class="ident" id="4491228">t</span><span class="op" id="4491229">[</span><span class="num" id="4491230">2</span><span class="op" id="4491231">]</span>&nbsp;<span class="op" id="4491233">==</span>&nbsp;<span class="string" id="4491236">&#39;P&#39;</span>&nbsp;<span class="op" id="4491240">&amp;&amp;</span>&nbsp;<span class="ident" id="4491243">t</span><span class="op" id="4491244">[</span><span class="num" id="4491245">3</span><span class="op" id="4491246">]</span>&nbsp;<span class="op" id="4491248">==</span>&nbsp;<span class="string" id="4491251">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4491255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4491259">//&nbsp;Pull&nbsp;out&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491279">end</span>&nbsp;<span class="op" id="4491283">:=</span>&nbsp;<span class="ident" id="4491286">strings</span><span class="op" id="4491293">.</span><span class="ident" id="4491294">IndexRune</span><span class="op" id="4491303">(</span><span class="ident" id="4491304">t</span><span class="op" id="4491305">,</span>&nbsp;<span class="string" id="4491307">&#39;&gt;&#39;</span><span class="op" id="4491310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4491314">if</span>&nbsp;<span class="ident" id="4491317">end</span>&nbsp;<span class="op" id="4491321">&lt;</span>&nbsp;<span class="num" id="4491323">0</span>&nbsp;<span class="op" id="4491325">{</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4491330">if</span>&nbsp;<span class="ident" id="4491333">err</span>&nbsp;<span class="op" id="4491337">=</span>&nbsp;<span class="ident" id="4491339">checkUTF8</span><span class="op" id="4491348">(</span><span class="ident" id="4491349">t</span><span class="op" id="4491350">)</span><span class="op" id="4491351">;</span>&nbsp;<span class="ident" id="4491353">err</span>&nbsp;<span class="op" id="4491357">!=</span>&nbsp;<span class="ident" id="4491360">nil</span>&nbsp;<span class="op" id="4491364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4491370">return</span>&nbsp;<span class="string" id="4491377">&#34;&#34;</span><span class="op" id="4491379">,</span>&nbsp;<span class="ident" id="4491381">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4491388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4491393">return</span>&nbsp;<span class="string" id="4491400">&#34;&#34;</span><span class="op" id="4491402">,</span>&nbsp;<span class="op" id="4491404">&amp;</span><span class="ident" id="4491405">Error</span><span class="op" id="4491410">{</span><span class="ident" id="4491411">ErrInvalidNamedCapture</span><span class="op" id="4491433">,</span>&nbsp;<span class="ident" id="4491435">s</span><span class="op" id="4491436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4491440">}</span><br>
<span class="lineno">960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491445">capture</span>&nbsp;<span class="op" id="4491453">:=</span>&nbsp;<span class="ident" id="4491456">t</span><span class="op" id="4491457">[</span><span class="op" id="4491458">:</span><span class="ident" id="4491459">end</span><span class="op" id="4491462">+</span><span class="num" id="4491463">1</span><span class="op" id="4491464">]</span>&nbsp;<span class="comment" id="4491466">//&nbsp;&#34;(?P&lt;name&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491483">name</span>&nbsp;<span class="op" id="4491488">:=</span>&nbsp;<span class="ident" id="4491491">t</span><span class="op" id="4491492">[</span><span class="num" id="4491493">4</span><span class="op" id="4491494">:</span><span class="ident" id="4491495">end</span><span class="op" id="4491498">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4491504">//&nbsp;&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4491516">if</span>&nbsp;<span class="ident" id="4491519">err</span>&nbsp;<span class="op" id="4491523">=</span>&nbsp;<span class="ident" id="4491525">checkUTF8</span><span class="op" id="4491534">(</span><span class="ident" id="4491535">name</span><span class="op" id="4491539">)</span><span class="op" id="4491540">;</span>&nbsp;<span class="ident" id="4491542">err</span>&nbsp;<span class="op" id="4491546">!=</span>&nbsp;<span class="ident" id="4491549">nil</span>&nbsp;<span class="op" id="4491553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4491558">return</span>&nbsp;<span class="string" id="4491565">&#34;&#34;</span><span class="op" id="4491567">,</span>&nbsp;<span class="ident" id="4491569">err</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4491575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4491579">if</span>&nbsp;<span class="op" id="4491582">!</span><span class="ident" id="4491583">isValidCaptureName</span><span class="op" id="4491601">(</span><span class="ident" id="4491602">name</span><span class="op" id="4491606">)</span>&nbsp;<span class="op" id="4491608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4491613">return</span>&nbsp;<span class="string" id="4491620">&#34;&#34;</span><span class="op" id="4491622">,</span>&nbsp;<span class="op" id="4491624">&amp;</span><span class="ident" id="4491625">Error</span><span class="op" id="4491630">{</span><span class="ident" id="4491631">ErrInvalidNamedCapture</span><span class="op" id="4491653">,</span>&nbsp;<span class="ident" id="4491655">capture</span><span class="op" id="4491662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4491666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4491671">//&nbsp;Like&nbsp;ordinary&nbsp;capture,&nbsp;but&nbsp;named.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491710">p</span><span class="op" id="4491711">.</span><span class="ident" id="4491712">numCap</span><span class="op" id="4491718">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491723">re</span>&nbsp;<span class="op" id="4491726">:=</span>&nbsp;<span class="ident" id="4491729">p</span><span class="op" id="4491730">.</span><span class="ident" id="4491731">op</span><span class="op" id="4491733">(</span><span class="ident" id="4491734">opLeftParen</span><span class="op" id="4491745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491749">re</span><span class="op" id="4491751">.</span><span class="ident" id="4491752">Cap</span>&nbsp;<span class="op" id="4491756">=</span>&nbsp;<span class="ident" id="4491758">p</span><span class="op" id="4491759">.</span><span class="ident" id="4491760">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491769">re</span><span class="op" id="4491771">.</span><span class="ident" id="4491772">Name</span>&nbsp;<span class="op" id="4491777">=</span>&nbsp;<span class="ident" id="4491779">name</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4491786">return</span>&nbsp;<span class="ident" id="4491793">t</span><span class="op" id="4491794">[</span><span class="ident" id="4491795">end</span><span class="op" id="4491798">+</span><span class="num" id="4491799">1</span><span class="op" id="4491800">:</span><span class="op" id="4491801">]</span><span class="op" id="4491802">,</span>&nbsp;<span class="ident" id="4491804">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4491809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4491813">//&nbsp;Non-capturing&nbsp;group.&nbsp;&nbsp;Might&nbsp;also&nbsp;twiddle&nbsp;Perl&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4491870">var</span>&nbsp;<span class="ident" id="4491874">c</span>&nbsp;<span class="builtintype" id="4491876">rune</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491882">t</span>&nbsp;<span class="op" id="4491884">=</span>&nbsp;<span class="ident" id="4491886">t</span><span class="op" id="4491887">[</span><span class="num" id="4491888">2</span><span class="op" id="4491889">:</span><span class="op" id="4491890">]</span>&nbsp;<span class="comment" id="4491892">//&nbsp;skip&nbsp;(?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491904">flags</span>&nbsp;<span class="op" id="4491910">:=</span>&nbsp;<span class="ident" id="4491913">p</span><span class="op" id="4491914">.</span><span class="ident" id="4491915">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491922">sign</span>&nbsp;<span class="op" id="4491927">:=</span>&nbsp;<span class="op" id="4491930">+</span><span class="num" id="4491931">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4491934">sawFlag</span>&nbsp;<span class="op" id="4491942">:=</span>&nbsp;<span class="builtintype" id="4491945">false</span><br>
<span class="lineno"></span><span class="ident" id="4491951">Loop</span><span class="op" id="4491955">:</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4491958">for</span>&nbsp;<span class="ident" id="4491962">t</span>&nbsp;<span class="op" id="4491964">!=</span>&nbsp;<span class="string" id="4491967">&#34;&#34;</span>&nbsp;<span class="op" id="4491970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4491974">if</span>&nbsp;<span class="ident" id="4491977">c</span><span class="op" id="4491978">,</span>&nbsp;<span class="ident" id="4491980">t</span><span class="op" id="4491981">,</span>&nbsp;<span class="ident" id="4491983">err</span>&nbsp;<span class="op" id="4491987">=</span>&nbsp;<span class="ident" id="4491989">nextRune</span><span class="op" id="4491997">(</span><span class="ident" id="4491998">t</span><span class="op" id="4491999">)</span><span class="op" id="4492000">;</span>&nbsp;<span class="ident" id="4492002">err</span>&nbsp;<span class="op" id="4492006">!=</span>&nbsp;<span class="ident" id="4492009">nil</span>&nbsp;<span class="op" id="4492013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492018">return</span>&nbsp;<span class="string" id="4492025">&#34;&#34;</span><span class="op" id="4492027">,</span>&nbsp;<span class="ident" id="4492029">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4492035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492039">switch</span>&nbsp;<span class="ident" id="4492046">c</span>&nbsp;<span class="op" id="4492048">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492052">default</span><span class="op" id="4492059">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492064">break</span>&nbsp;<span class="ident" id="4492070">Loop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4492078">//&nbsp;Flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492090">case</span>&nbsp;<span class="string" id="4492095">&#39;i&#39;</span><span class="op" id="4492098">:</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492103">flags</span>&nbsp;<span class="op" id="4492109">|=</span>&nbsp;<span class="ident" id="4492112">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492124">sawFlag</span>&nbsp;<span class="op" id="4492132">=</span>&nbsp;<span class="builtintype" id="4492134">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492141">case</span>&nbsp;<span class="string" id="4492146">&#39;m&#39;</span><span class="op" id="4492149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492154">flags</span>&nbsp;<span class="op" id="4492160">&amp;^=</span>&nbsp;<span class="ident" id="4492164">OneLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492175">sawFlag</span>&nbsp;<span class="op" id="4492183">=</span>&nbsp;<span class="builtintype" id="4492185">true</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492192">case</span>&nbsp;<span class="string" id="4492197">&#39;s&#39;</span><span class="op" id="4492200">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492205">flags</span>&nbsp;<span class="op" id="4492211">|=</span>&nbsp;<span class="ident" id="4492214">DotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492223">sawFlag</span>&nbsp;<span class="op" id="4492231">=</span>&nbsp;<span class="builtintype" id="4492233">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492240">case</span>&nbsp;<span class="string" id="4492245">&#39;U&#39;</span><span class="op" id="4492248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492253">flags</span>&nbsp;<span class="op" id="4492259">|=</span>&nbsp;<span class="ident" id="4492262">NonGreedy</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492275">sawFlag</span>&nbsp;<span class="op" id="4492283">=</span>&nbsp;<span class="builtintype" id="4492285">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4492293">//&nbsp;Switch&nbsp;to&nbsp;negation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492318">case</span>&nbsp;<span class="string" id="4492323">&#39;-&#39;</span><span class="op" id="4492326">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492331">if</span>&nbsp;<span class="ident" id="4492334">sign</span>&nbsp;<span class="op" id="4492339">&lt;</span>&nbsp;<span class="num" id="4492341">0</span>&nbsp;<span class="op" id="4492343">{</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492349">break</span>&nbsp;<span class="ident" id="4492355">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4492363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492368">sign</span>&nbsp;<span class="op" id="4492373">=</span>&nbsp;<span class="op" id="4492375">-</span><span class="num" id="4492376">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4492381">//&nbsp;Invert&nbsp;flags&nbsp;so&nbsp;that&nbsp;|&nbsp;above&nbsp;turn&nbsp;into&nbsp;&amp;^&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4492445">//&nbsp;We&#39;ll&nbsp;invert&nbsp;flags&nbsp;again&nbsp;before&nbsp;using&nbsp;it&nbsp;below.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492499">flags</span>&nbsp;<span class="op" id="4492505">=</span>&nbsp;<span class="op" id="4492507">^</span><span class="ident" id="4492508">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492517">sawFlag</span>&nbsp;<span class="op" id="4492525">=</span>&nbsp;<span class="builtintype" id="4492527">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4492536">//&nbsp;End&nbsp;of&nbsp;flags,&nbsp;starting&nbsp;group&nbsp;or&nbsp;not.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492578">case</span>&nbsp;<span class="string" id="4492583">&#39;:&#39;</span><span class="op" id="4492586">,</span>&nbsp;<span class="string" id="4492588">&#39;)&#39;</span><span class="op" id="4492591">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492596">if</span>&nbsp;<span class="ident" id="4492599">sign</span>&nbsp;<span class="op" id="4492604">&lt;</span>&nbsp;<span class="num" id="4492606">0</span>&nbsp;<span class="op" id="4492608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492614">if</span>&nbsp;<span class="op" id="4492617">!</span><span class="ident" id="4492618">sawFlag</span>&nbsp;<span class="op" id="4492626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492633">break</span>&nbsp;<span class="ident" id="4492639">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4492648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492654">flags</span>&nbsp;<span class="op" id="4492660">=</span>&nbsp;<span class="op" id="4492662">^</span><span class="ident" id="4492663">flags</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4492672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492677">if</span>&nbsp;<span class="ident" id="4492680">c</span>&nbsp;<span class="op" id="4492682">==</span>&nbsp;<span class="string" id="4492685">&#39;:&#39;</span>&nbsp;<span class="op" id="4492689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4492695">//&nbsp;Open&nbsp;new&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492717">p</span><span class="op" id="4492718">.</span><span class="ident" id="4492719">op</span><span class="op" id="4492721">(</span><span class="ident" id="4492722">opLeftParen</span><span class="op" id="4492733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4492738">}</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4492743">p</span><span class="op" id="4492744">.</span><span class="ident" id="4492745">flags</span>&nbsp;<span class="op" id="4492751">=</span>&nbsp;<span class="ident" id="4492753">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492762">return</span>&nbsp;<span class="ident" id="4492769">t</span><span class="op" id="4492770">,</span>&nbsp;<span class="ident" id="4492772">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4492778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4492781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4492785">return</span>&nbsp;<span class="string" id="4492792">&#34;&#34;</span><span class="op" id="4492794">,</span>&nbsp;<span class="op" id="4492796">&amp;</span><span class="ident" id="4492797">Error</span><span class="op" id="4492802">{</span><span class="ident" id="4492803">ErrInvalidPerlOp</span><span class="op" id="4492819">,</span>&nbsp;<span class="ident" id="4492821">s</span><span class="op" id="4492822">[</span><span class="op" id="4492823">:</span><span class="builtinfunc" id="4492824">len</span><span class="op" id="4492827">(</span><span class="ident" id="4492828">s</span><span class="op" id="4492829">)</span><span class="op" id="4492830">-</span><span class="builtinfunc" id="4492831">len</span><span class="op" id="4492834">(</span><span class="ident" id="4492835">t</span><span class="op" id="4492836">)</span><span class="op" id="4492837">]</span><span class="op" id="4492838">}</span><br>
<span class="lineno"></span><span class="op" id="4492840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4492843">//&nbsp;isValidCaptureName&nbsp;reports&nbsp;whether&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="4492886">//&nbsp;is&nbsp;a&nbsp;valid&nbsp;capture&nbsp;name:&nbsp;[A-Za-z0-9_]+.</span><br>
<span class="lineno">1040</span><span class="comment" id="4492929">//&nbsp;PCRE&nbsp;limits&nbsp;names&nbsp;to&nbsp;32&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="4492963">//&nbsp;Python&nbsp;rejects&nbsp;names&nbsp;starting&nbsp;with&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="4493009">//&nbsp;We&nbsp;don&#39;t&nbsp;enforce&nbsp;either&nbsp;of&nbsp;those.</span><br>
<span class="lineno"></span><span class="keyword" id="4493046">func</span>&nbsp;<span class="ident" id="4493051">isValidCaptureName</span><span class="op" id="4493069">(</span><span class="ident" id="4493070">name</span>&nbsp;<span class="builtintype" id="4493075">string</span><span class="op" id="4493081">)</span>&nbsp;<span class="builtintype" id="4493083">bool</span>&nbsp;<span class="op" id="4493088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493091">if</span>&nbsp;<span class="ident" id="4493094">name</span>&nbsp;<span class="op" id="4493099">==</span>&nbsp;<span class="string" id="4493102">&#34;&#34;</span>&nbsp;<span class="op" id="4493105">{</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493109">return</span>&nbsp;<span class="builtintype" id="4493116">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4493123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493126">for</span>&nbsp;<span class="ident" id="4493130">_</span><span class="op" id="4493131">,</span>&nbsp;<span class="ident" id="4493133">c</span>&nbsp;<span class="op" id="4493135">:=</span>&nbsp;<span class="keyword" id="4493138">range</span>&nbsp;<span class="ident" id="4493144">name</span>&nbsp;<span class="op" id="4493149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493153">if</span>&nbsp;<span class="ident" id="4493156">c</span>&nbsp;<span class="op" id="4493158">!=</span>&nbsp;<span class="string" id="4493161">&#39;_&#39;</span>&nbsp;<span class="op" id="4493165">&amp;&amp;</span>&nbsp;<span class="op" id="4493168">!</span><span class="ident" id="4493169">isalnum</span><span class="op" id="4493176">(</span><span class="ident" id="4493177">c</span><span class="op" id="4493178">)</span>&nbsp;<span class="op" id="4493180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493185">return</span>&nbsp;<span class="builtintype" id="4493192">false</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4493200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4493203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493206">return</span>&nbsp;<span class="builtintype" id="4493213">true</span><br>
<span class="lineno"></span><span class="op" id="4493218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1055</span><span class="comment" id="4493221">//&nbsp;parseInt&nbsp;parses&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="4493259">func</span>&nbsp;<span class="op" id="4493264">(</span><span class="ident" id="4493265">p</span>&nbsp;<span class="op" id="4493267">*</span><span class="ident" id="4493268">parser</span><span class="op" id="4493274">)</span>&nbsp;<span class="ident" id="4493276">parseInt</span><span class="op" id="4493284">(</span><span class="ident" id="4493285">s</span>&nbsp;<span class="builtintype" id="4493287">string</span><span class="op" id="4493293">)</span>&nbsp;<span class="op" id="4493295">(</span><span class="ident" id="4493296">n</span>&nbsp;<span class="builtintype" id="4493298">int</span><span class="op" id="4493301">,</span>&nbsp;<span class="ident" id="4493303">rest</span>&nbsp;<span class="builtintype" id="4493308">string</span><span class="op" id="4493314">,</span>&nbsp;<span class="ident" id="4493316">ok</span>&nbsp;<span class="builtintype" id="4493319">bool</span><span class="op" id="4493323">)</span>&nbsp;<span class="op" id="4493325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493328">if</span>&nbsp;<span class="ident" id="4493331">s</span>&nbsp;<span class="op" id="4493333">==</span>&nbsp;<span class="string" id="4493336">&#34;&#34;</span>&nbsp;<span class="op" id="4493339">||</span>&nbsp;<span class="ident" id="4493342">s</span><span class="op" id="4493343">[</span><span class="num" id="4493344">0</span><span class="op" id="4493345">]</span>&nbsp;<span class="op" id="4493347">&lt;</span>&nbsp;<span class="string" id="4493349">&#39;0&#39;</span>&nbsp;<span class="op" id="4493353">||</span>&nbsp;<span class="string" id="4493356">&#39;9&#39;</span>&nbsp;<span class="op" id="4493360">&lt;</span>&nbsp;<span class="ident" id="4493362">s</span><span class="op" id="4493363">[</span><span class="num" id="4493364">0</span><span class="op" id="4493365">]</span>&nbsp;<span class="op" id="4493367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493371">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4493379">}</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4493382">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493410">if</span>&nbsp;<span class="builtinfunc" id="4493413">len</span><span class="op" id="4493416">(</span><span class="ident" id="4493417">s</span><span class="op" id="4493418">)</span>&nbsp;<span class="op" id="4493420">&gt;=</span>&nbsp;<span class="num" id="4493423">2</span>&nbsp;<span class="op" id="4493425">&amp;&amp;</span>&nbsp;<span class="ident" id="4493428">s</span><span class="op" id="4493429">[</span><span class="num" id="4493430">0</span><span class="op" id="4493431">]</span>&nbsp;<span class="op" id="4493433">==</span>&nbsp;<span class="string" id="4493436">&#39;0&#39;</span>&nbsp;<span class="op" id="4493440">&amp;&amp;</span>&nbsp;<span class="string" id="4493443">&#39;0&#39;</span>&nbsp;<span class="op" id="4493447">&lt;=</span>&nbsp;<span class="ident" id="4493450">s</span><span class="op" id="4493451">[</span><span class="num" id="4493452">1</span><span class="op" id="4493453">]</span>&nbsp;<span class="op" id="4493455">&amp;&amp;</span>&nbsp;<span class="ident" id="4493458">s</span><span class="op" id="4493459">[</span><span class="num" id="4493460">1</span><span class="op" id="4493461">]</span>&nbsp;<span class="op" id="4493463">&lt;=</span>&nbsp;<span class="string" id="4493466">&#39;9&#39;</span>&nbsp;<span class="op" id="4493470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493474">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4493482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493485">t</span>&nbsp;<span class="op" id="4493487">:=</span>&nbsp;<span class="ident" id="4493490">s</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493493">for</span>&nbsp;<span class="ident" id="4493497">s</span>&nbsp;<span class="op" id="4493499">!=</span>&nbsp;<span class="string" id="4493502">&#34;&#34;</span>&nbsp;<span class="op" id="4493505">&amp;&amp;</span>&nbsp;<span class="string" id="4493508">&#39;0&#39;</span>&nbsp;<span class="op" id="4493512">&lt;=</span>&nbsp;<span class="ident" id="4493515">s</span><span class="op" id="4493516">[</span><span class="num" id="4493517">0</span><span class="op" id="4493518">]</span>&nbsp;<span class="op" id="4493520">&amp;&amp;</span>&nbsp;<span class="ident" id="4493523">s</span><span class="op" id="4493524">[</span><span class="num" id="4493525">0</span><span class="op" id="4493526">]</span>&nbsp;<span class="op" id="4493528">&lt;=</span>&nbsp;<span class="string" id="4493531">&#39;9&#39;</span>&nbsp;<span class="op" id="4493535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493539">s</span>&nbsp;<span class="op" id="4493541">=</span>&nbsp;<span class="ident" id="4493543">s</span><span class="op" id="4493544">[</span><span class="num" id="4493545">1</span><span class="op" id="4493546">:</span><span class="op" id="4493547">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4493550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493553">rest</span>&nbsp;<span class="op" id="4493558">=</span>&nbsp;<span class="ident" id="4493560">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493563">ok</span>&nbsp;<span class="op" id="4493566">=</span>&nbsp;<span class="builtintype" id="4493568">true</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4493574">//&nbsp;Have&nbsp;digits,&nbsp;compute&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493606">t</span>&nbsp;<span class="op" id="4493608">=</span>&nbsp;<span class="ident" id="4493610">t</span><span class="op" id="4493611">[</span><span class="op" id="4493612">:</span><span class="builtinfunc" id="4493613">len</span><span class="op" id="4493616">(</span><span class="ident" id="4493617">t</span><span class="op" id="4493618">)</span><span class="op" id="4493619">-</span><span class="builtinfunc" id="4493620">len</span><span class="op" id="4493623">(</span><span class="ident" id="4493624">s</span><span class="op" id="4493625">)</span><span class="op" id="4493626">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493629">for</span>&nbsp;<span class="ident" id="4493633">i</span>&nbsp;<span class="op" id="4493635">:=</span>&nbsp;<span class="num" id="4493638">0</span><span class="op" id="4493639">;</span>&nbsp;<span class="ident" id="4493641">i</span>&nbsp;<span class="op" id="4493643">&lt;</span>&nbsp;<span class="builtinfunc" id="4493645">len</span><span class="op" id="4493648">(</span><span class="ident" id="4493649">t</span><span class="op" id="4493650">)</span><span class="op" id="4493651">;</span>&nbsp;<span class="ident" id="4493653">i</span><span class="op" id="4493654">++</span>&nbsp;<span class="op" id="4493657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4493661">//&nbsp;Avoid&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493682">if</span>&nbsp;<span class="ident" id="4493685">n</span>&nbsp;<span class="op" id="4493687">&gt;=</span>&nbsp;<span class="num" id="4493690">1e8</span>&nbsp;<span class="op" id="4493694">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493699">n</span>&nbsp;<span class="op" id="4493701">=</span>&nbsp;<span class="op" id="4493703">-</span><span class="num" id="4493704">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493709">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4493717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493721">n</span>&nbsp;<span class="op" id="4493723">=</span>&nbsp;<span class="ident" id="4493725">n</span><span class="op" id="4493726">*</span><span class="num" id="4493727">10</span>&nbsp;<span class="op" id="4493730">+</span>&nbsp;<span class="builtintype" id="4493732">int</span><span class="op" id="4493735">(</span><span class="ident" id="4493736">t</span><span class="op" id="4493737">[</span><span class="ident" id="4493738">i</span><span class="op" id="4493739">]</span><span class="op" id="4493740">)</span>&nbsp;<span class="op" id="4493742">-</span>&nbsp;<span class="string" id="4493744">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4493749">}</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493752">return</span><br>
<span class="lineno"></span><span class="op" id="4493759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4493762">//&nbsp;can&nbsp;this&nbsp;be&nbsp;represented&nbsp;as&nbsp;a&nbsp;character&nbsp;class?</span><br>
<span class="lineno"></span><span class="comment" id="4493811">//&nbsp;single-rune&nbsp;literal&nbsp;string,&nbsp;char&nbsp;class,&nbsp;.,&nbsp;and&nbsp;.|\n.</span><br>
<span class="lineno">1085</span><span class="keyword" id="4493867">func</span>&nbsp;<span class="ident" id="4493872">isCharClass</span><span class="op" id="4493883">(</span><span class="ident" id="4493884">re</span>&nbsp;<span class="op" id="4493887">*</span><span class="ident" id="4493888">Regexp</span><span class="op" id="4493894">)</span>&nbsp;<span class="builtintype" id="4493896">bool</span>&nbsp;<span class="op" id="4493901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4493904">return</span>&nbsp;<span class="ident" id="4493911">re</span><span class="op" id="4493913">.</span><span class="ident" id="4493914">Op</span>&nbsp;<span class="op" id="4493917">==</span>&nbsp;<span class="ident" id="4493920">OpLiteral</span>&nbsp;<span class="op" id="4493930">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4493933">len</span><span class="op" id="4493936">(</span><span class="ident" id="4493937">re</span><span class="op" id="4493939">.</span><span class="ident" id="4493940">Rune</span><span class="op" id="4493944">)</span>&nbsp;<span class="op" id="4493946">==</span>&nbsp;<span class="num" id="4493949">1</span>&nbsp;<span class="op" id="4493951">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493956">re</span><span class="op" id="4493958">.</span><span class="ident" id="4493959">Op</span>&nbsp;<span class="op" id="4493962">==</span>&nbsp;<span class="ident" id="4493965">OpCharClass</span>&nbsp;<span class="op" id="4493977">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4493982">re</span><span class="op" id="4493984">.</span><span class="ident" id="4493985">Op</span>&nbsp;<span class="op" id="4493988">==</span>&nbsp;<span class="ident" id="4493991">OpAnyCharNotNL</span>&nbsp;<span class="op" id="4494006">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4494011">re</span><span class="op" id="4494013">.</span><span class="ident" id="4494014">Op</span>&nbsp;<span class="op" id="4494017">==</span>&nbsp;<span class="ident" id="4494020">OpAnyChar</span><br>
<span class="lineno">1090</span><span class="op" id="4494030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4494033">//&nbsp;does&nbsp;re&nbsp;match&nbsp;r?</span><br>
<span class="lineno"></span><span class="keyword" id="4494053">func</span>&nbsp;<span class="ident" id="4494058">matchRune</span><span class="op" id="4494067">(</span><span class="ident" id="4494068">re</span>&nbsp;<span class="op" id="4494071">*</span><span class="ident" id="4494072">Regexp</span><span class="op" id="4494078">,</span>&nbsp;<span class="ident" id="4494080">r</span>&nbsp;<span class="builtintype" id="4494082">rune</span><span class="op" id="4494086">)</span>&nbsp;<span class="builtintype" id="4494088">bool</span>&nbsp;<span class="op" id="4494093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494096">switch</span>&nbsp;<span class="ident" id="4494103">re</span><span class="op" id="4494105">.</span><span class="ident" id="4494106">Op</span>&nbsp;<span class="op" id="4494109">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494112">case</span>&nbsp;<span class="ident" id="4494117">OpLiteral</span><span class="op" id="4494126">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494130">return</span>&nbsp;<span class="builtinfunc" id="4494137">len</span><span class="op" id="4494140">(</span><span class="ident" id="4494141">re</span><span class="op" id="4494143">.</span><span class="ident" id="4494144">Rune</span><span class="op" id="4494148">)</span>&nbsp;<span class="op" id="4494150">==</span>&nbsp;<span class="num" id="4494153">1</span>&nbsp;<span class="op" id="4494155">&amp;&amp;</span>&nbsp;<span class="ident" id="4494158">re</span><span class="op" id="4494160">.</span><span class="ident" id="4494161">Rune</span><span class="op" id="4494165">[</span><span class="num" id="4494166">0</span><span class="op" id="4494167">]</span>&nbsp;<span class="op" id="4494169">==</span>&nbsp;<span class="ident" id="4494172">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494175">case</span>&nbsp;<span class="ident" id="4494180">OpCharClass</span><span class="op" id="4494191">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494195">for</span>&nbsp;<span class="ident" id="4494199">i</span>&nbsp;<span class="op" id="4494201">:=</span>&nbsp;<span class="num" id="4494204">0</span><span class="op" id="4494205">;</span>&nbsp;<span class="ident" id="4494207">i</span>&nbsp;<span class="op" id="4494209">&lt;</span>&nbsp;<span class="builtinfunc" id="4494211">len</span><span class="op" id="4494214">(</span><span class="ident" id="4494215">re</span><span class="op" id="4494217">.</span><span class="ident" id="4494218">Rune</span><span class="op" id="4494222">)</span><span class="op" id="4494223">;</span>&nbsp;<span class="ident" id="4494225">i</span>&nbsp;<span class="op" id="4494227">+=</span>&nbsp;<span class="num" id="4494230">2</span>&nbsp;<span class="op" id="4494232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494237">if</span>&nbsp;<span class="ident" id="4494240">re</span><span class="op" id="4494242">.</span><span class="ident" id="4494243">Rune</span><span class="op" id="4494247">[</span><span class="ident" id="4494248">i</span><span class="op" id="4494249">]</span>&nbsp;<span class="op" id="4494251">&lt;=</span>&nbsp;<span class="ident" id="4494254">r</span>&nbsp;<span class="op" id="4494256">&amp;&amp;</span>&nbsp;<span class="ident" id="4494259">r</span>&nbsp;<span class="op" id="4494261">&lt;=</span>&nbsp;<span class="ident" id="4494264">re</span><span class="op" id="4494266">.</span><span class="ident" id="4494267">Rune</span><span class="op" id="4494271">[</span><span class="ident" id="4494272">i</span><span class="op" id="4494273">+</span><span class="num" id="4494274">1</span><span class="op" id="4494275">]</span>&nbsp;<span class="op" id="4494277">{</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494283">return</span>&nbsp;<span class="builtintype" id="4494290">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4494298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4494302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494306">return</span>&nbsp;<span class="builtintype" id="4494313">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494320">case</span>&nbsp;<span class="ident" id="4494325">OpAnyCharNotNL</span><span class="op" id="4494339">:</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494343">return</span>&nbsp;<span class="ident" id="4494350">r</span>&nbsp;<span class="op" id="4494352">!=</span>&nbsp;<span class="string" id="4494355">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494361">case</span>&nbsp;<span class="ident" id="4494366">OpAnyChar</span><span class="op" id="4494375">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494379">return</span>&nbsp;<span class="builtintype" id="4494386">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4494392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494395">return</span>&nbsp;<span class="builtintype" id="4494402">false</span><br>
<span class="lineno">1110</span><span class="op" id="4494408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4494411">//&nbsp;parseVerticalBar&nbsp;handles&nbsp;a&nbsp;|&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="4494457">func</span>&nbsp;<span class="op" id="4494462">(</span><span class="ident" id="4494463">p</span>&nbsp;<span class="op" id="4494465">*</span><span class="ident" id="4494466">parser</span><span class="op" id="4494472">)</span>&nbsp;<span class="ident" id="4494474">parseVerticalBar</span><span class="op" id="4494490">(</span><span class="op" id="4494491">)</span>&nbsp;<span class="builtintype" id="4494493">error</span>&nbsp;<span class="op" id="4494499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4494502">p</span><span class="op" id="4494503">.</span><span class="ident" id="4494504">concat</span><span class="op" id="4494510">(</span><span class="op" id="4494511">)</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494515">//&nbsp;The&nbsp;concatenation&nbsp;we&nbsp;just&nbsp;parsed&nbsp;is&nbsp;on&nbsp;top&nbsp;of&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494576">//&nbsp;If&nbsp;it&nbsp;sits&nbsp;above&nbsp;an&nbsp;opVerticalBar,&nbsp;swap&nbsp;it&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494629">//&nbsp;(things&nbsp;below&nbsp;an&nbsp;opVerticalBar&nbsp;become&nbsp;an&nbsp;alternation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494688">//&nbsp;Otherwise,&nbsp;push&nbsp;a&nbsp;new&nbsp;vertical&nbsp;bar.</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494728">if</span>&nbsp;<span class="op" id="4494731">!</span><span class="ident" id="4494732">p</span><span class="op" id="4494733">.</span><span class="ident" id="4494734">swapVerticalBar</span><span class="op" id="4494749">(</span><span class="op" id="4494750">)</span>&nbsp;<span class="op" id="4494752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4494756">p</span><span class="op" id="4494757">.</span><span class="ident" id="4494758">op</span><span class="op" id="4494760">(</span><span class="ident" id="4494761">opVerticalBar</span><span class="op" id="4494774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4494777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494781">return</span>&nbsp;<span class="ident" id="4494788">nil</span><br>
<span class="lineno">1125</span><span class="op" id="4494792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4494795">//&nbsp;mergeCharClass&nbsp;makes&nbsp;dst&nbsp;=&nbsp;dst|src.</span><br>
<span class="lineno"></span><span class="comment" id="4494834">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;ensure&nbsp;that&nbsp;dst.Op&nbsp;&gt;=&nbsp;src.Op,</span><br>
<span class="lineno"></span><span class="comment" id="4494883">//&nbsp;to&nbsp;reduce&nbsp;the&nbsp;amount&nbsp;of&nbsp;copying.</span><br>
<span class="lineno">1130</span><span class="keyword" id="4494919">func</span>&nbsp;<span class="ident" id="4494924">mergeCharClass</span><span class="op" id="4494938">(</span><span class="ident" id="4494939">dst</span><span class="op" id="4494942">,</span>&nbsp;<span class="ident" id="4494944">src</span>&nbsp;<span class="op" id="4494948">*</span><span class="ident" id="4494949">Regexp</span><span class="op" id="4494955">)</span>&nbsp;<span class="op" id="4494957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494960">switch</span>&nbsp;<span class="ident" id="4494967">dst</span><span class="op" id="4494970">.</span><span class="ident" id="4494971">Op</span>&nbsp;<span class="op" id="4494974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4494977">case</span>&nbsp;<span class="ident" id="4494982">OpAnyChar</span><span class="op" id="4494991">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4494995">//&nbsp;src&nbsp;doesn&#39;t&nbsp;add&nbsp;anything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495025">case</span>&nbsp;<span class="ident" id="4495030">OpAnyCharNotNL</span><span class="op" id="4495044">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4495048">//&nbsp;src&nbsp;might&nbsp;add&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495070">if</span>&nbsp;<span class="ident" id="4495073">matchRune</span><span class="op" id="4495082">(</span><span class="ident" id="4495083">src</span><span class="op" id="4495086">,</span>&nbsp;<span class="string" id="4495088">&#39;\n&#39;</span><span class="op" id="4495092">)</span>&nbsp;<span class="op" id="4495094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4495099">dst</span><span class="op" id="4495102">.</span><span class="ident" id="4495103">Op</span>&nbsp;<span class="op" id="4495106">=</span>&nbsp;<span class="ident" id="4495108">OpAnyChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4495120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495123">case</span>&nbsp;<span class="ident" id="4495128">OpCharClass</span><span class="op" id="4495139">:</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4495143">//&nbsp;src&nbsp;is&nbsp;simpler,&nbsp;so&nbsp;either&nbsp;literal&nbsp;or&nbsp;char&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495196">if</span>&nbsp;<span class="ident" id="4495199">src</span><span class="op" id="4495202">.</span><span class="ident" id="4495203">Op</span>&nbsp;<span class="op" id="4495206">==</span>&nbsp;<span class="ident" id="4495209">OpLiteral</span>&nbsp;<span class="op" id="4495219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4495224">dst</span><span class="op" id="4495227">.</span><span class="ident" id="4495228">Rune</span>&nbsp;<span class="op" id="4495233">=</span>&nbsp;<span class="ident" id="4495235">appendLiteral</span><span class="op" id="4495248">(</span><span class="ident" id="4495249">dst</span><span class="op" id="4495252">.</span><span class="ident" id="4495253">Rune</span><span class="op" id="4495257">,</span>&nbsp;<span class="ident" id="4495259">src</span><span class="op" id="4495262">.</span><span class="ident" id="4495263">Rune</span><span class="op" id="4495267">[</span><span class="num" id="4495268">0</span><span class="op" id="4495269">]</span><span class="op" id="4495270">,</span>&nbsp;<span class="ident" id="4495272">src</span><span class="op" id="4495275">.</span><span class="ident" id="4495276">Flags</span><span class="op" id="4495281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4495285">}</span>&nbsp;<span class="keyword" id="4495287">else</span>&nbsp;<span class="op" id="4495292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4495297">dst</span><span class="op" id="4495300">.</span><span class="ident" id="4495301">Rune</span>&nbsp;<span class="op" id="4495306">=</span>&nbsp;<span class="ident" id="4495308">appendClass</span><span class="op" id="4495319">(</span><span class="ident" id="4495320">dst</span><span class="op" id="4495323">.</span><span class="ident" id="4495324">Rune</span><span class="op" id="4495328">,</span>&nbsp;<span class="ident" id="4495330">src</span><span class="op" id="4495333">.</span><span class="ident" id="4495334">Rune</span><span class="op" id="4495338">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4495342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495345">case</span>&nbsp;<span class="ident" id="4495350">OpLiteral</span><span class="op" id="4495359">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4495363">//&nbsp;both&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495381">if</span>&nbsp;<span class="ident" id="4495384">src</span><span class="op" id="4495387">.</span><span class="ident" id="4495388">Rune</span><span class="op" id="4495392">[</span><span class="num" id="4495393">0</span><span class="op" id="4495394">]</span>&nbsp;<span class="op" id="4495396">==</span>&nbsp;<span class="ident" id="4495399">dst</span><span class="op" id="4495402">.</span><span class="ident" id="4495403">Rune</span><span class="op" id="4495407">[</span><span class="num" id="4495408">0</span><span class="op" id="4495409">]</span>&nbsp;<span class="op" id="4495411">&amp;&amp;</span>&nbsp;<span class="ident" id="4495414">src</span><span class="op" id="4495417">.</span><span class="ident" id="4495418">Flags</span>&nbsp;<span class="op" id="4495424">==</span>&nbsp;<span class="ident" id="4495427">dst</span><span class="op" id="4495430">.</span><span class="ident" id="4495431">Flags</span>&nbsp;<span class="op" id="4495437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495442">break</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4495450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4495454">dst</span><span class="op" id="4495457">.</span><span class="ident" id="4495458">Op</span>&nbsp;<span class="op" id="4495461">=</span>&nbsp;<span class="ident" id="4495463">OpCharClass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4495477">dst</span><span class="op" id="4495480">.</span><span class="ident" id="4495481">Rune</span>&nbsp;<span class="op" id="4495486">=</span>&nbsp;<span class="ident" id="4495488">appendLiteral</span><span class="op" id="4495501">(</span><span class="ident" id="4495502">dst</span><span class="op" id="4495505">.</span><span class="ident" id="4495506">Rune</span><span class="op" id="4495510">[</span><span class="op" id="4495511">:</span><span class="num" id="4495512">0</span><span class="op" id="4495513">]</span><span class="op" id="4495514">,</span>&nbsp;<span class="ident" id="4495516">dst</span><span class="op" id="4495519">.</span><span class="ident" id="4495520">Rune</span><span class="op" id="4495524">[</span><span class="num" id="4495525">0</span><span class="op" id="4495526">]</span><span class="op" id="4495527">,</span>&nbsp;<span class="ident" id="4495529">dst</span><span class="op" id="4495532">.</span><span class="ident" id="4495533">Flags</span><span class="op" id="4495538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4495542">dst</span><span class="op" id="4495545">.</span><span class="ident" id="4495546">Rune</span>&nbsp;<span class="op" id="4495551">=</span>&nbsp;<span class="ident" id="4495553">appendLiteral</span><span class="op" id="4495566">(</span><span class="ident" id="4495567">dst</span><span class="op" id="4495570">.</span><span class="ident" id="4495571">Rune</span><span class="op" id="4495575">,</span>&nbsp;<span class="ident" id="4495577">src</span><span class="op" id="4495580">.</span><span class="ident" id="4495581">Rune</span><span class="op" id="4495585">[</span><span class="num" id="4495586">0</span><span class="op" id="4495587">]</span><span class="op" id="4495588">,</span>&nbsp;<span class="ident" id="4495590">src</span><span class="op" id="4495593">.</span><span class="ident" id="4495594">Flags</span><span class="op" id="4495599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4495602">}</span><br>
<span class="lineno">1155</span><span class="op" id="4495604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4495607">//&nbsp;If&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;is&nbsp;an&nbsp;element&nbsp;followed&nbsp;by&nbsp;an&nbsp;opVerticalBar</span><br>
<span class="lineno"></span><span class="comment" id="4495677">//&nbsp;swapVerticalBar&nbsp;swaps&nbsp;the&nbsp;two&nbsp;and&nbsp;returns&nbsp;true.</span><br>
<span class="lineno"></span><span class="comment" id="4495728">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;false.</span><br>
<span class="lineno">1160</span><span class="keyword" id="4495759">func</span>&nbsp;<span class="op" id="4495764">(</span><span class="ident" id="4495765">p</span>&nbsp;<span class="op" id="4495767">*</span><span class="ident" id="4495768">parser</span><span class="op" id="4495774">)</span>&nbsp;<span class="ident" id="4495776">swapVerticalBar</span><span class="op" id="4495791">(</span><span class="op" id="4495792">)</span>&nbsp;<span class="builtintype" id="4495794">bool</span>&nbsp;<span class="op" id="4495799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4495802">//&nbsp;If&nbsp;above&nbsp;and&nbsp;below&nbsp;vertical&nbsp;bar&nbsp;are&nbsp;literal&nbsp;or&nbsp;char&nbsp;class,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4495865">//&nbsp;can&nbsp;merge&nbsp;into&nbsp;a&nbsp;single&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4495905">n</span>&nbsp;<span class="op" id="4495907">:=</span>&nbsp;<span class="builtinfunc" id="4495910">len</span><span class="op" id="4495913">(</span><span class="ident" id="4495914">p</span><span class="op" id="4495915">.</span><span class="ident" id="4495916">stack</span><span class="op" id="4495921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4495924">if</span>&nbsp;<span class="ident" id="4495927">n</span>&nbsp;<span class="op" id="4495929">&gt;=</span>&nbsp;<span class="num" id="4495932">3</span>&nbsp;<span class="op" id="4495934">&amp;&amp;</span>&nbsp;<span class="ident" id="4495937">p</span><span class="op" id="4495938">.</span><span class="ident" id="4495939">stack</span><span class="op" id="4495944">[</span><span class="ident" id="4495945">n</span><span class="op" id="4495946">-</span><span class="num" id="4495947">2</span><span class="op" id="4495948">]</span><span class="op" id="4495949">.</span><span class="ident" id="4495950">Op</span>&nbsp;<span class="op" id="4495953">==</span>&nbsp;<span class="ident" id="4495956">opVerticalBar</span>&nbsp;<span class="op" id="4495970">&amp;&amp;</span>&nbsp;<span class="ident" id="4495973">isCharClass</span><span class="op" id="4495984">(</span><span class="ident" id="4495985">p</span><span class="op" id="4495986">.</span><span class="ident" id="4495987">stack</span><span class="op" id="4495992">[</span><span class="ident" id="4495993">n</span><span class="op" id="4495994">-</span><span class="num" id="4495995">1</span><span class="op" id="4495996">]</span><span class="op" id="4495997">)</span>&nbsp;<span class="op" id="4495999">&amp;&amp;</span>&nbsp;<span class="ident" id="4496002">isCharClass</span><span class="op" id="4496013">(</span><span class="ident" id="4496014">p</span><span class="op" id="4496015">.</span><span class="ident" id="4496016">stack</span><span class="op" id="4496021">[</span><span class="ident" id="4496022">n</span><span class="op" id="4496023">-</span><span class="num" id="4496024">3</span><span class="op" id="4496025">]</span><span class="op" id="4496026">)</span>&nbsp;<span class="op" id="4496028">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496032">re1</span>&nbsp;<span class="op" id="4496036">:=</span>&nbsp;<span class="ident" id="4496039">p</span><span class="op" id="4496040">.</span><span class="ident" id="4496041">stack</span><span class="op" id="4496046">[</span><span class="ident" id="4496047">n</span><span class="op" id="4496048">-</span><span class="num" id="4496049">1</span><span class="op" id="4496050">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496054">re3</span>&nbsp;<span class="op" id="4496058">:=</span>&nbsp;<span class="ident" id="4496061">p</span><span class="op" id="4496062">.</span><span class="ident" id="4496063">stack</span><span class="op" id="4496068">[</span><span class="ident" id="4496069">n</span><span class="op" id="4496070">-</span><span class="num" id="4496071">3</span><span class="op" id="4496072">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4496076">//&nbsp;Make&nbsp;re3&nbsp;the&nbsp;more&nbsp;complex&nbsp;of&nbsp;the&nbsp;two.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4496119">if</span>&nbsp;<span class="ident" id="4496122">re1</span><span class="op" id="4496125">.</span><span class="ident" id="4496126">Op</span>&nbsp;<span class="op" id="4496129">&gt;</span>&nbsp;<span class="ident" id="4496131">re3</span><span class="op" id="4496134">.</span><span class="ident" id="4496135">Op</span>&nbsp;<span class="op" id="4496138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496143">re1</span><span class="op" id="4496146">,</span>&nbsp;<span class="ident" id="4496148">re3</span>&nbsp;<span class="op" id="4496152">=</span>&nbsp;<span class="ident" id="4496154">re3</span><span class="op" id="4496157">,</span>&nbsp;<span class="ident" id="4496159">re1</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496166">p</span><span class="op" id="4496167">.</span><span class="ident" id="4496168">stack</span><span class="op" id="4496173">[</span><span class="ident" id="4496174">n</span><span class="op" id="4496175">-</span><span class="num" id="4496176">3</span><span class="op" id="4496177">]</span>&nbsp;<span class="op" id="4496179">=</span>&nbsp;<span class="ident" id="4496181">re3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4496187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496191">mergeCharClass</span><span class="op" id="4496205">(</span><span class="ident" id="4496206">re3</span><span class="op" id="4496209">,</span>&nbsp;<span class="ident" id="4496211">re1</span><span class="op" id="4496214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496218">p</span><span class="op" id="4496219">.</span><span class="ident" id="4496220">reuse</span><span class="op" id="4496225">(</span><span class="ident" id="4496226">re1</span><span class="op" id="4496229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496233">p</span><span class="op" id="4496234">.</span><span class="ident" id="4496235">stack</span>&nbsp;<span class="op" id="4496241">=</span>&nbsp;<span class="ident" id="4496243">p</span><span class="op" id="4496244">.</span><span class="ident" id="4496245">stack</span><span class="op" id="4496250">[</span><span class="op" id="4496251">:</span><span class="ident" id="4496252">n</span><span class="op" id="4496253">-</span><span class="num" id="4496254">1</span><span class="op" id="4496255">]</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4496259">return</span>&nbsp;<span class="builtintype" id="4496266">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4496272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4496276">if</span>&nbsp;<span class="ident" id="4496279">n</span>&nbsp;<span class="op" id="4496281">&gt;=</span>&nbsp;<span class="num" id="4496284">2</span>&nbsp;<span class="op" id="4496286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496290">re1</span>&nbsp;<span class="op" id="4496294">:=</span>&nbsp;<span class="ident" id="4496297">p</span><span class="op" id="4496298">.</span><span class="ident" id="4496299">stack</span><span class="op" id="4496304">[</span><span class="ident" id="4496305">n</span><span class="op" id="4496306">-</span><span class="num" id="4496307">1</span><span class="op" id="4496308">]</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496312">re2</span>&nbsp;<span class="op" id="4496316">:=</span>&nbsp;<span class="ident" id="4496319">p</span><span class="op" id="4496320">.</span><span class="ident" id="4496321">stack</span><span class="op" id="4496326">[</span><span class="ident" id="4496327">n</span><span class="op" id="4496328">-</span><span class="num" id="4496329">2</span><span class="op" id="4496330">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4496334">if</span>&nbsp;<span class="ident" id="4496337">re2</span><span class="op" id="4496340">.</span><span class="ident" id="4496341">Op</span>&nbsp;<span class="op" id="4496344">==</span>&nbsp;<span class="ident" id="4496347">opVerticalBar</span>&nbsp;<span class="op" id="4496361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4496366">if</span>&nbsp;<span class="ident" id="4496369">n</span>&nbsp;<span class="op" id="4496371">&gt;=</span>&nbsp;<span class="num" id="4496374">3</span>&nbsp;<span class="op" id="4496376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4496382">//&nbsp;Now&nbsp;out&nbsp;of&nbsp;reach.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4496407">//&nbsp;Clean&nbsp;opportunistically.</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496439">cleanAlt</span><span class="op" id="4496447">(</span><span class="ident" id="4496448">p</span><span class="op" id="4496449">.</span><span class="ident" id="4496450">stack</span><span class="op" id="4496455">[</span><span class="ident" id="4496456">n</span><span class="op" id="4496457">-</span><span class="num" id="4496458">3</span><span class="op" id="4496459">]</span><span class="op" id="4496460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4496465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496470">p</span><span class="op" id="4496471">.</span><span class="ident" id="4496472">stack</span><span class="op" id="4496477">[</span><span class="ident" id="4496478">n</span><span class="op" id="4496479">-</span><span class="num" id="4496480">2</span><span class="op" id="4496481">]</span>&nbsp;<span class="op" id="4496483">=</span>&nbsp;<span class="ident" id="4496485">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496492">p</span><span class="op" id="4496493">.</span><span class="ident" id="4496494">stack</span><span class="op" id="4496499">[</span><span class="ident" id="4496500">n</span><span class="op" id="4496501">-</span><span class="num" id="4496502">1</span><span class="op" id="4496503">]</span>&nbsp;<span class="op" id="4496505">=</span>&nbsp;<span class="ident" id="4496507">re2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4496514">return</span>&nbsp;<span class="builtintype" id="4496521">true</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4496528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4496531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4496534">return</span>&nbsp;<span class="builtintype" id="4496541">false</span><br>
<span class="lineno"></span><span class="op" id="4496547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1195</span><span class="comment" id="4496550">//&nbsp;parseRightParen&nbsp;handles&nbsp;a&nbsp;)&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="4496595">func</span>&nbsp;<span class="op" id="4496600">(</span><span class="ident" id="4496601">p</span>&nbsp;<span class="op" id="4496603">*</span><span class="ident" id="4496604">parser</span><span class="op" id="4496610">)</span>&nbsp;<span class="ident" id="4496612">parseRightParen</span><span class="op" id="4496627">(</span><span class="op" id="4496628">)</span>&nbsp;<span class="builtintype" id="4496630">error</span>&nbsp;<span class="op" id="4496636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496639">p</span><span class="op" id="4496640">.</span><span class="ident" id="4496641">concat</span><span class="op" id="4496647">(</span><span class="op" id="4496648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4496651">if</span>&nbsp;<span class="ident" id="4496654">p</span><span class="op" id="4496655">.</span><span class="ident" id="4496656">swapVerticalBar</span><span class="op" id="4496671">(</span><span class="op" id="4496672">)</span>&nbsp;<span class="op" id="4496674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4496678">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496700">p</span><span class="op" id="4496701">.</span><span class="ident" id="4496702">stack</span>&nbsp;<span class="op" id="4496708">=</span>&nbsp;<span class="ident" id="4496710">p</span><span class="op" id="4496711">.</span><span class="ident" id="4496712">stack</span><span class="op" id="4496717">[</span><span class="op" id="4496718">:</span><span class="builtinfunc" id="4496719">len</span><span class="op" id="4496722">(</span><span class="ident" id="4496723">p</span><span class="op" id="4496724">.</span><span class="ident" id="4496725">stack</span><span class="op" id="4496730">)</span><span class="op" id="4496731">-</span><span class="num" id="4496732">1</span><span class="op" id="4496733">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4496736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496739">p</span><span class="op" id="4496740">.</span><span class="ident" id="4496741">alternate</span><span class="op" id="4496750">(</span><span class="op" id="4496751">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496755">n</span>&nbsp;<span class="op" id="4496757">:=</span>&nbsp;<span class="builtinfunc" id="4496760">len</span><span class="op" id="4496763">(</span><span class="ident" id="4496764">p</span><span class="op" id="4496765">.</span><span class="ident" id="4496766">stack</span><span class="op" id="4496771">)</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4496774">if</span>&nbsp;<span class="ident" id="4496777">n</span>&nbsp;<span class="op" id="4496779">&lt;</span>&nbsp;<span class="num" id="4496781">2</span>&nbsp;<span class="op" id="4496783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4496787">return</span>&nbsp;<span class="op" id="4496794">&amp;</span><span class="ident" id="4496795">Error</span><span class="op" id="4496800">{</span><span class="ident" id="4496801">ErrUnexpectedParen</span><span class="op" id="4496819">,</span>&nbsp;<span class="ident" id="4496821">p</span><span class="op" id="4496822">.</span><span class="ident" id="4496823">wholeRegexp</span><span class="op" id="4496834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4496837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496840">re1</span>&nbsp;<span class="op" id="4496844">:=</span>&nbsp;<span class="ident" id="4496847">p</span><span class="op" id="4496848">.</span><span class="ident" id="4496849">stack</span><span class="op" id="4496854">[</span><span class="ident" id="4496855">n</span><span class="op" id="4496856">-</span><span class="num" id="4496857">1</span><span class="op" id="4496858">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496861">re2</span>&nbsp;<span class="op" id="4496865">:=</span>&nbsp;<span class="ident" id="4496868">p</span><span class="op" id="4496869">.</span><span class="ident" id="4496870">stack</span><span class="op" id="4496875">[</span><span class="ident" id="4496876">n</span><span class="op" id="4496877">-</span><span class="num" id="4496878">2</span><span class="op" id="4496879">]</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4496882">p</span><span class="op" id="4496883">.</span><span class="ident" id="4496884">stack</span>&nbsp;<span class="op" id="4496890">=</span>&nbsp;<span class="ident" id="4496892">p</span><span class="op" id="4496893">.</span><span class="ident" id="4496894">stack</span><span class="op" id="4496899">[</span><span class="op" id="4496900">:</span><span class="ident" id="4496901">n</span><span class="op" id="4496902">-</span><span class="num" id="4496903">2</span><span class="op" id="4496904">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4496907">if</span>&nbsp;<span class="ident" id="4496910">re2</span><span class="op" id="4496913">.</span><span class="ident" id="4496914">Op</span>&nbsp;<span class="op" id="4496917">!=</span>&nbsp;<span class="ident" id="4496920">opLeftParen</span>&nbsp;<span class="op" id="4496932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4496936">return</span>&nbsp;<span class="op" id="4496943">&amp;</span><span class="ident" id="4496944">Error</span><span class="op" id="4496949">{</span><span class="ident" id="4496950">ErrUnexpectedParen</span><span class="op" id="4496968">,</span>&nbsp;<span class="ident" id="4496970">p</span><span class="op" id="4496971">.</span><span class="ident" id="4496972">wholeRegexp</span><span class="op" id="4496983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4496986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4496989">//&nbsp;Restore&nbsp;flags&nbsp;at&nbsp;time&nbsp;of&nbsp;paren.</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4497025">p</span><span class="op" id="4497026">.</span><span class="ident" id="4497027">flags</span>&nbsp;<span class="op" id="4497033">=</span>&nbsp;<span class="ident" id="4497035">re2</span><span class="op" id="4497038">.</span><span class="ident" id="4497039">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4497046">if</span>&nbsp;<span class="ident" id="4497049">re2</span><span class="op" id="4497052">.</span><span class="ident" id="4497053">Cap</span>&nbsp;<span class="op" id="4497057">==</span>&nbsp;<span class="num" id="4497060">0</span>&nbsp;<span class="op" id="4497062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4497066">//&nbsp;Just&nbsp;for&nbsp;grouping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4497090">p</span><span class="op" id="4497091">.</span><span class="ident" id="4497092">push</span><span class="op" id="4497096">(</span><span class="ident" id="4497097">re1</span><span class="op" id="4497100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4497103">}</span>&nbsp;<span class="keyword" id="4497105">else</span>&nbsp;<span class="op" id="4497110">{</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4497114">re2</span><span class="op" id="4497117">.</span><span class="ident" id="4497118">Op</span>&nbsp;<span class="op" id="4497121">=</span>&nbsp;<span class="ident" id="4497123">OpCapture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4497135">re2</span><span class="op" id="4497138">.</span><span class="ident" id="4497139">Sub</span>&nbsp;<span class="op" id="4497143">=</span>&nbsp;<span class="ident" id="4497145">re2</span><span class="op" id="4497148">.</span><span class="ident" id="4497149">Sub0</span><span class="op" id="4497153">[</span><span class="op" id="4497154">:</span><span class="num" id="4497155">1</span><span class="op" id="4497156">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4497160">re2</span><span class="op" id="4497163">.</span><span class="ident" id="4497164">Sub</span><span class="op" id="4497167">[</span><span class="num" id="4497168">0</span><span class="op" id="4497169">]</span>&nbsp;<span class="op" id="4497171">=</span>&nbsp;<span class="ident" id="4497173">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4497179">p</span><span class="op" id="4497180">.</span><span class="ident" id="4497181">push</span><span class="op" id="4497185">(</span><span class="ident" id="4497186">re2</span><span class="op" id="4497189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4497192">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4497195">return</span>&nbsp;<span class="ident" id="4497202">nil</span><br>
<span class="lineno"></span><span class="op" id="4497206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4497209">//&nbsp;parseEscape&nbsp;parses&nbsp;an&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="4497272">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune.</span><br>
<span class="lineno">1230</span><span class="keyword" id="4497297">func</span>&nbsp;<span class="op" id="4497302">(</span><span class="ident" id="4497303">p</span>&nbsp;<span class="op" id="4497305">*</span><span class="ident" id="4497306">parser</span><span class="op" id="4497312">)</span>&nbsp;<span class="ident" id="4497314">parseEscape</span><span class="op" id="4497325">(</span><span class="ident" id="4497326">s</span>&nbsp;<span class="builtintype" id="4497328">string</span><span class="op" id="4497334">)</span>&nbsp;<span class="op" id="4497336">(</span><span class="ident" id="4497337">r</span>&nbsp;<span class="builtintype" id="4497339">rune</span><span class="op" id="4497343">,</span>&nbsp;<span class="ident" id="4497345">rest</span>&nbsp;<span class="builtintype" id="4497350">string</span><span class="op" id="4497356">,</span>&nbsp;<span class="ident" id="4497358">err</span>&nbsp;<span class="builtintype" id="4497362">error</span><span class="op" id="4497367">)</span>&nbsp;<span class="op" id="4497369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4497372">t</span>&nbsp;<span class="op" id="4497374">:=</span>&nbsp;<span class="ident" id="4497377">s</span><span class="op" id="4497378">[</span><span class="num" id="4497379">1</span><span class="op" id="4497380">:</span><span class="op" id="4497381">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4497384">if</span>&nbsp;<span class="ident" id="4497387">t</span>&nbsp;<span class="op" id="4497389">==</span>&nbsp;<span class="string" id="4497392">&#34;&#34;</span>&nbsp;<span class="op" id="4497395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4497399">return</span>&nbsp;<span class="num" id="4497406">0</span><span class="op" id="4497407">,</span>&nbsp;<span class="string" id="4497409">&#34;&#34;</span><span class="op" id="4497411">,</span>&nbsp;<span class="op" id="4497413">&amp;</span><span class="ident" id="4497414">Error</span><span class="op" id="4497419">{</span><span class="ident" id="4497420">ErrTrailingBackslash</span><span class="op" id="4497440">,</span>&nbsp;<span class="string" id="4497442">&#34;&#34;</span><span class="op" id="4497444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4497447">}</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4497450">c</span><span class="op" id="4497451">,</span>&nbsp;<span class="ident" id="4497453">t</span><span class="op" id="4497454">,</span>&nbsp;<span class="ident" id="4497456">err</span>&nbsp;<span class="op" id="4497460">:=</span>&nbsp;<span class="ident" id="4497463">nextRune</span><span class="op" id="4497471">(</span><span class="ident" id="4497472">t</span><span class="op" id="4497473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4497476">if</span>&nbsp;<span class="ident" id="4497479">err</span>&nbsp;<span class="op" id="4497483">!=</span>&nbsp;<span class="ident" id="4497486">nil</span>&nbsp;<span class="op" id="4497490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4497494">return</span>&nbsp;<span class="num" id="4497501">0</span><span class="op" id="4497502">,</span>&nbsp;<span class="string" id="4497504">&#34;&#34;</span><span class="op" id="4497506">,</span>&nbsp;<span class="ident" id="4497508">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4497513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1240</span><span class="ident" id="4497516">Switch</span><span class="op" id="4497522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4497525">switch</span>&nbsp;<span class="ident" id="4497532">c</span>&nbsp;<span class="op" id="4497534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4497537">default</span><span class="op" id="4497544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4497548">if</span>&nbsp;<span class="ident" id="4497551">c</span>&nbsp;<span class="op" id="4497553">&lt;</span>&nbsp;<span class="ident" id="4497555">utf8</span><span class="op" id="4497559">.</span><span class="ident" id="4497560">RuneSelf</span>&nbsp;<span class="op" id="4497569">&amp;&amp;</span>&nbsp;<span class="op" id="4497572">!</span><span class="ident" id="4497573">isalnum</span><span class="op" id="4497580">(</span><span class="ident" id="4497581">c</span><span class="op" id="4497582">)</span>&nbsp;<span class="op" id="4497584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4497589">//&nbsp;Escaped&nbsp;non-word&nbsp;characters&nbsp;are&nbsp;always&nbsp;themselves.</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4497646">//&nbsp;PCRE&nbsp;is&nbsp;not&nbsp;quite&nbsp;so&nbsp;rigorous:&nbsp;it&nbsp;accepts&nbsp;things&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4497706">//&nbsp;\q,&nbsp;but&nbsp;we&nbsp;don&#39;t.&nbsp;&nbsp;We&nbsp;once&nbsp;rejected&nbsp;\_,&nbsp;but&nbsp;too&nbsp;many</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4497765">//&nbsp;programs&nbsp;and&nbsp;people&nbsp;insist&nbsp;on&nbsp;using&nbsp;it,&nbsp;so&nbsp;allow&nbsp;\_.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4497824">return</span>&nbsp;<span class="ident" id="4497831">c</span><span class="op" id="4497832">,</span>&nbsp;<span class="ident" id="4497834">t</span><span class="op" id="4497835">,</span>&nbsp;<span class="ident" id="4497837">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4497843">}</span><br>
<span class="lineno">1250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4497847">//&nbsp;Octal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4497866">case</span>&nbsp;<span class="string" id="4497871">&#39;1&#39;</span><span class="op" id="4497874">,</span>&nbsp;<span class="string" id="4497876">&#39;2&#39;</span><span class="op" id="4497879">,</span>&nbsp;<span class="string" id="4497881">&#39;3&#39;</span><span class="op" id="4497884">,</span>&nbsp;<span class="string" id="4497886">&#39;4&#39;</span><span class="op" id="4497889">,</span>&nbsp;<span class="string" id="4497891">&#39;5&#39;</span><span class="op" id="4497894">,</span>&nbsp;<span class="string" id="4497896">&#39;6&#39;</span><span class="op" id="4497899">,</span>&nbsp;<span class="string" id="4497901">&#39;7&#39;</span><span class="op" id="4497904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4497908">//&nbsp;Single&nbsp;non-zero&nbsp;digit&nbsp;is&nbsp;a&nbsp;backreference;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4497969">if</span>&nbsp;<span class="ident" id="4497972">t</span>&nbsp;<span class="op" id="4497974">==</span>&nbsp;<span class="string" id="4497977">&#34;&#34;</span>&nbsp;<span class="op" id="4497980">||</span>&nbsp;<span class="ident" id="4497983">t</span><span class="op" id="4497984">[</span><span class="num" id="4497985">0</span><span class="op" id="4497986">]</span>&nbsp;<span class="op" id="4497988">&lt;</span>&nbsp;<span class="string" id="4497990">&#39;0&#39;</span>&nbsp;<span class="op" id="4497994">||</span>&nbsp;<span class="ident" id="4497997">t</span><span class="op" id="4497998">[</span><span class="num" id="4497999">0</span><span class="op" id="4498000">]</span>&nbsp;<span class="op" id="4498002">&gt;</span>&nbsp;<span class="string" id="4498004">&#39;7&#39;</span>&nbsp;<span class="op" id="4498008">{</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498013">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4498021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498025">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498038">case</span>&nbsp;<span class="string" id="4498043">&#39;0&#39;</span><span class="op" id="4498046">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4498050">//&nbsp;Consume&nbsp;up&nbsp;to&nbsp;three&nbsp;octal&nbsp;digits;&nbsp;already&nbsp;have&nbsp;one.</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4498107">r</span>&nbsp;<span class="op" id="4498109">=</span>&nbsp;<span class="ident" id="4498111">c</span>&nbsp;<span class="op" id="4498113">-</span>&nbsp;<span class="string" id="4498115">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498121">for</span>&nbsp;<span class="ident" id="4498125">i</span>&nbsp;<span class="op" id="4498127">:=</span>&nbsp;<span class="num" id="4498130">1</span><span class="op" id="4498131">;</span>&nbsp;<span class="ident" id="4498133">i</span>&nbsp;<span class="op" id="4498135">&lt;</span>&nbsp;<span class="num" id="4498137">3</span><span class="op" id="4498138">;</span>&nbsp;<span class="ident" id="4498140">i</span><span class="op" id="4498141">++</span>&nbsp;<span class="op" id="4498144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498149">if</span>&nbsp;<span class="ident" id="4498152">t</span>&nbsp;<span class="op" id="4498154">==</span>&nbsp;<span class="string" id="4498157">&#34;&#34;</span>&nbsp;<span class="op" id="4498160">||</span>&nbsp;<span class="ident" id="4498163">t</span><span class="op" id="4498164">[</span><span class="num" id="4498165">0</span><span class="op" id="4498166">]</span>&nbsp;<span class="op" id="4498168">&lt;</span>&nbsp;<span class="string" id="4498170">&#39;0&#39;</span>&nbsp;<span class="op" id="4498174">||</span>&nbsp;<span class="ident" id="4498177">t</span><span class="op" id="4498178">[</span><span class="num" id="4498179">0</span><span class="op" id="4498180">]</span>&nbsp;<span class="op" id="4498182">&gt;</span>&nbsp;<span class="string" id="4498184">&#39;7&#39;</span>&nbsp;<span class="op" id="4498188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498194">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4498203">}</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4498208">r</span>&nbsp;<span class="op" id="4498210">=</span>&nbsp;<span class="ident" id="4498212">r</span><span class="op" id="4498213">*</span><span class="num" id="4498214">8</span>&nbsp;<span class="op" id="4498216">+</span>&nbsp;<span class="builtintype" id="4498218">rune</span><span class="op" id="4498222">(</span><span class="ident" id="4498223">t</span><span class="op" id="4498224">[</span><span class="num" id="4498225">0</span><span class="op" id="4498226">]</span><span class="op" id="4498227">)</span>&nbsp;<span class="op" id="4498229">-</span>&nbsp;<span class="string" id="4498231">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4498238">t</span>&nbsp;<span class="op" id="4498240">=</span>&nbsp;<span class="ident" id="4498242">t</span><span class="op" id="4498243">[</span><span class="num" id="4498244">1</span><span class="op" id="4498245">:</span><span class="op" id="4498246">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4498250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498254">return</span>&nbsp;<span class="ident" id="4498261">r</span><span class="op" id="4498262">,</span>&nbsp;<span class="ident" id="4498264">t</span><span class="op" id="4498265">,</span>&nbsp;<span class="ident" id="4498267">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4498273">//&nbsp;Hexadecimal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498298">case</span>&nbsp;<span class="string" id="4498303">&#39;x&#39;</span><span class="op" id="4498306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498310">if</span>&nbsp;<span class="ident" id="4498313">t</span>&nbsp;<span class="op" id="4498315">==</span>&nbsp;<span class="string" id="4498318">&#34;&#34;</span>&nbsp;<span class="op" id="4498321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498326">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4498334">}</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498338">if</span>&nbsp;<span class="ident" id="4498341">c</span><span class="op" id="4498342">,</span>&nbsp;<span class="ident" id="4498344">t</span><span class="op" id="4498345">,</span>&nbsp;<span class="ident" id="4498347">err</span>&nbsp;<span class="op" id="4498351">=</span>&nbsp;<span class="ident" id="4498353">nextRune</span><span class="op" id="4498361">(</span><span class="ident" id="4498362">t</span><span class="op" id="4498363">)</span><span class="op" id="4498364">;</span>&nbsp;<span class="ident" id="4498366">err</span>&nbsp;<span class="op" id="4498370">!=</span>&nbsp;<span class="ident" id="4498373">nil</span>&nbsp;<span class="op" id="4498377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498382">return</span>&nbsp;<span class="num" id="4498389">0</span><span class="op" id="4498390">,</span>&nbsp;<span class="string" id="4498392">&#34;&#34;</span><span class="op" id="4498394">,</span>&nbsp;<span class="ident" id="4498396">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4498402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498406">if</span>&nbsp;<span class="ident" id="4498409">c</span>&nbsp;<span class="op" id="4498411">==</span>&nbsp;<span class="string" id="4498414">&#39;{&#39;</span>&nbsp;<span class="op" id="4498418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4498423">//&nbsp;Any&nbsp;number&nbsp;of&nbsp;digits&nbsp;in&nbsp;braces.</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4498461">//&nbsp;Perl&nbsp;accepts&nbsp;any&nbsp;text&nbsp;at&nbsp;all;&nbsp;it&nbsp;ignores&nbsp;all&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4498517">//&nbsp;after&nbsp;the&nbsp;first&nbsp;non-hex&nbsp;digit.&nbsp;&nbsp;We&nbsp;require&nbsp;only&nbsp;hex&nbsp;digits,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4498583">//&nbsp;and&nbsp;at&nbsp;least&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4498607">nhex</span>&nbsp;<span class="op" id="4498612">:=</span>&nbsp;<span class="num" id="4498615">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4498620">r</span>&nbsp;<span class="op" id="4498622">=</span>&nbsp;<span class="num" id="4498624">0</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498629">for</span>&nbsp;<span class="op" id="4498633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498639">if</span>&nbsp;<span class="ident" id="4498642">t</span>&nbsp;<span class="op" id="4498644">==</span>&nbsp;<span class="string" id="4498647">&#34;&#34;</span>&nbsp;<span class="op" id="4498650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498657">break</span>&nbsp;<span class="ident" id="4498663">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4498674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498680">if</span>&nbsp;<span class="ident" id="4498683">c</span><span class="op" id="4498684">,</span>&nbsp;<span class="ident" id="4498686">t</span><span class="op" id="4498687">,</span>&nbsp;<span class="ident" id="4498689">err</span>&nbsp;<span class="op" id="4498693">=</span>&nbsp;<span class="ident" id="4498695">nextRune</span><span class="op" id="4498703">(</span><span class="ident" id="4498704">t</span><span class="op" id="4498705">)</span><span class="op" id="4498706">;</span>&nbsp;<span class="ident" id="4498708">err</span>&nbsp;<span class="op" id="4498712">!=</span>&nbsp;<span class="ident" id="4498715">nil</span>&nbsp;<span class="op" id="4498719">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498726">return</span>&nbsp;<span class="num" id="4498733">0</span><span class="op" id="4498734">,</span>&nbsp;<span class="string" id="4498736">&#34;&#34;</span><span class="op" id="4498738">,</span>&nbsp;<span class="ident" id="4498740">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4498748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498754">if</span>&nbsp;<span class="ident" id="4498757">c</span>&nbsp;<span class="op" id="4498759">==</span>&nbsp;<span class="string" id="4498762">&#39;}&#39;</span>&nbsp;<span class="op" id="4498766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498773">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4498783">}</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4498789">v</span>&nbsp;<span class="op" id="4498791">:=</span>&nbsp;<span class="ident" id="4498794">unhex</span><span class="op" id="4498799">(</span><span class="ident" id="4498800">c</span><span class="op" id="4498801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498807">if</span>&nbsp;<span class="ident" id="4498810">v</span>&nbsp;<span class="op" id="4498812">&lt;</span>&nbsp;<span class="num" id="4498814">0</span>&nbsp;<span class="op" id="4498816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498823">break</span>&nbsp;<span class="ident" id="4498829">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4498840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4498846">r</span>&nbsp;<span class="op" id="4498848">=</span>&nbsp;<span class="ident" id="4498850">r</span><span class="op" id="4498851">*</span><span class="num" id="4498852">16</span>&nbsp;<span class="op" id="4498855">+</span>&nbsp;<span class="ident" id="4498857">v</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498863">if</span>&nbsp;<span class="ident" id="4498866">r</span>&nbsp;<span class="op" id="4498868">&gt;</span>&nbsp;<span class="ident" id="4498870">unicode</span><span class="op" id="4498877">.</span><span class="ident" id="4498878">MaxRune</span>&nbsp;<span class="op" id="4498886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498893">break</span>&nbsp;<span class="ident" id="4498899">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4498910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4498916">nhex</span><span class="op" id="4498920">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4498926">}</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498931">if</span>&nbsp;<span class="ident" id="4498934">nhex</span>&nbsp;<span class="op" id="4498939">==</span>&nbsp;<span class="num" id="4498942">0</span>&nbsp;<span class="op" id="4498944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498950">break</span>&nbsp;<span class="ident" id="4498956">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4498966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4498971">return</span>&nbsp;<span class="ident" id="4498978">r</span><span class="op" id="4498979">,</span>&nbsp;<span class="ident" id="4498981">t</span><span class="op" id="4498982">,</span>&nbsp;<span class="ident" id="4498984">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4498990">}</span><br>
<span class="lineno">1310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4498995">//&nbsp;Easy&nbsp;case:&nbsp;two&nbsp;hex&nbsp;digits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4499027">x</span>&nbsp;<span class="op" id="4499029">:=</span>&nbsp;<span class="ident" id="4499032">unhex</span><span class="op" id="4499037">(</span><span class="ident" id="4499038">c</span><span class="op" id="4499039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499043">if</span>&nbsp;<span class="ident" id="4499046">c</span><span class="op" id="4499047">,</span>&nbsp;<span class="ident" id="4499049">t</span><span class="op" id="4499050">,</span>&nbsp;<span class="ident" id="4499052">err</span>&nbsp;<span class="op" id="4499056">=</span>&nbsp;<span class="ident" id="4499058">nextRune</span><span class="op" id="4499066">(</span><span class="ident" id="4499067">t</span><span class="op" id="4499068">)</span><span class="op" id="4499069">;</span>&nbsp;<span class="ident" id="4499071">err</span>&nbsp;<span class="op" id="4499075">!=</span>&nbsp;<span class="ident" id="4499078">nil</span>&nbsp;<span class="op" id="4499082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499087">return</span>&nbsp;<span class="num" id="4499094">0</span><span class="op" id="4499095">,</span>&nbsp;<span class="string" id="4499097">&#34;&#34;</span><span class="op" id="4499099">,</span>&nbsp;<span class="ident" id="4499101">err</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4499107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4499111">y</span>&nbsp;<span class="op" id="4499113">:=</span>&nbsp;<span class="ident" id="4499116">unhex</span><span class="op" id="4499121">(</span><span class="ident" id="4499122">c</span><span class="op" id="4499123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499127">if</span>&nbsp;<span class="ident" id="4499130">x</span>&nbsp;<span class="op" id="4499132">&lt;</span>&nbsp;<span class="num" id="4499134">0</span>&nbsp;<span class="op" id="4499136">||</span>&nbsp;<span class="ident" id="4499139">y</span>&nbsp;<span class="op" id="4499141">&lt;</span>&nbsp;<span class="num" id="4499143">0</span>&nbsp;<span class="op" id="4499145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499150">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4499158">}</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499162">return</span>&nbsp;<span class="ident" id="4499169">x</span><span class="op" id="4499170">*</span><span class="num" id="4499171">16</span>&nbsp;<span class="op" id="4499174">+</span>&nbsp;<span class="ident" id="4499176">y</span><span class="op" id="4499177">,</span>&nbsp;<span class="ident" id="4499179">t</span><span class="op" id="4499180">,</span>&nbsp;<span class="ident" id="4499182">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4499188">//&nbsp;C&nbsp;escapes.&nbsp;&nbsp;There&nbsp;is&nbsp;no&nbsp;case&nbsp;&#39;b&#39;,&nbsp;to&nbsp;avoid&nbsp;misparsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4499246">//&nbsp;the&nbsp;Perl&nbsp;word-boundary&nbsp;\b&nbsp;as&nbsp;the&nbsp;C&nbsp;backspace&nbsp;\b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4499298">//&nbsp;when&nbsp;in&nbsp;POSIX&nbsp;mode.&nbsp;&nbsp;In&nbsp;Perl,&nbsp;/\b/&nbsp;means&nbsp;word-boundary</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4499357">//&nbsp;but&nbsp;/[\b]/&nbsp;means&nbsp;backspace.&nbsp;&nbsp;We&nbsp;don&#39;t&nbsp;support&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4499413">//&nbsp;If&nbsp;you&nbsp;want&nbsp;a&nbsp;backspace,&nbsp;embed&nbsp;a&nbsp;literal&nbsp;backspace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4499468">//&nbsp;character&nbsp;or&nbsp;use&nbsp;\x08.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499495">case</span>&nbsp;<span class="string" id="4499500">&#39;a&#39;</span><span class="op" id="4499503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499507">return</span>&nbsp;<span class="string" id="4499514">&#39;\a&#39;</span><span class="op" id="4499518">,</span>&nbsp;<span class="ident" id="4499520">t</span><span class="op" id="4499521">,</span>&nbsp;<span class="ident" id="4499523">err</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499528">case</span>&nbsp;<span class="string" id="4499533">&#39;f&#39;</span><span class="op" id="4499536">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499540">return</span>&nbsp;<span class="string" id="4499547">&#39;\f&#39;</span><span class="op" id="4499551">,</span>&nbsp;<span class="ident" id="4499553">t</span><span class="op" id="4499554">,</span>&nbsp;<span class="ident" id="4499556">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499561">case</span>&nbsp;<span class="string" id="4499566">&#39;n&#39;</span><span class="op" id="4499569">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499573">return</span>&nbsp;<span class="string" id="4499580">&#39;\n&#39;</span><span class="op" id="4499584">,</span>&nbsp;<span class="ident" id="4499586">t</span><span class="op" id="4499587">,</span>&nbsp;<span class="ident" id="4499589">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499594">case</span>&nbsp;<span class="string" id="4499599">&#39;r&#39;</span><span class="op" id="4499602">:</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499606">return</span>&nbsp;<span class="string" id="4499613">&#39;\r&#39;</span><span class="op" id="4499617">,</span>&nbsp;<span class="ident" id="4499619">t</span><span class="op" id="4499620">,</span>&nbsp;<span class="ident" id="4499622">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499627">case</span>&nbsp;<span class="string" id="4499632">&#39;t&#39;</span><span class="op" id="4499635">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499639">return</span>&nbsp;<span class="string" id="4499646">&#39;\t&#39;</span><span class="op" id="4499650">,</span>&nbsp;<span class="ident" id="4499652">t</span><span class="op" id="4499653">,</span>&nbsp;<span class="ident" id="4499655">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499660">case</span>&nbsp;<span class="string" id="4499665">&#39;v&#39;</span><span class="op" id="4499668">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499672">return</span>&nbsp;<span class="string" id="4499679">&#39;\v&#39;</span><span class="op" id="4499683">,</span>&nbsp;<span class="ident" id="4499685">t</span><span class="op" id="4499686">,</span>&nbsp;<span class="ident" id="4499688">err</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4499693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499696">return</span>&nbsp;<span class="num" id="4499703">0</span><span class="op" id="4499704">,</span>&nbsp;<span class="string" id="4499706">&#34;&#34;</span><span class="op" id="4499708">,</span>&nbsp;<span class="op" id="4499710">&amp;</span><span class="ident" id="4499711">Error</span><span class="op" id="4499716">{</span><span class="ident" id="4499717">ErrInvalidEscape</span><span class="op" id="4499733">,</span>&nbsp;<span class="ident" id="4499735">s</span><span class="op" id="4499736">[</span><span class="op" id="4499737">:</span><span class="builtinfunc" id="4499738">len</span><span class="op" id="4499741">(</span><span class="ident" id="4499742">s</span><span class="op" id="4499743">)</span><span class="op" id="4499744">-</span><span class="builtinfunc" id="4499745">len</span><span class="op" id="4499748">(</span><span class="ident" id="4499749">t</span><span class="op" id="4499750">)</span><span class="op" id="4499751">]</span><span class="op" id="4499752">}</span><br>
<span class="lineno"></span><span class="op" id="4499754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4499757">//&nbsp;parseClassChar&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;character&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno">1345</span><span class="comment" id="4499832">//&nbsp;and&nbsp;returns&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4499851">func</span>&nbsp;<span class="op" id="4499856">(</span><span class="ident" id="4499857">p</span>&nbsp;<span class="op" id="4499859">*</span><span class="ident" id="4499860">parser</span><span class="op" id="4499866">)</span>&nbsp;<span class="ident" id="4499868">parseClassChar</span><span class="op" id="4499882">(</span><span class="ident" id="4499883">s</span><span class="op" id="4499884">,</span>&nbsp;<span class="ident" id="4499886">wholeClass</span>&nbsp;<span class="builtintype" id="4499897">string</span><span class="op" id="4499903">)</span>&nbsp;<span class="op" id="4499905">(</span><span class="ident" id="4499906">r</span>&nbsp;<span class="builtintype" id="4499908">rune</span><span class="op" id="4499912">,</span>&nbsp;<span class="ident" id="4499914">rest</span>&nbsp;<span class="builtintype" id="4499919">string</span><span class="op" id="4499925">,</span>&nbsp;<span class="ident" id="4499927">err</span>&nbsp;<span class="builtintype" id="4499931">error</span><span class="op" id="4499936">)</span>&nbsp;<span class="op" id="4499938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499941">if</span>&nbsp;<span class="ident" id="4499944">s</span>&nbsp;<span class="op" id="4499946">==</span>&nbsp;<span class="string" id="4499949">&#34;&#34;</span>&nbsp;<span class="op" id="4499952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4499956">return</span>&nbsp;<span class="num" id="4499963">0</span><span class="op" id="4499964">,</span>&nbsp;<span class="string" id="4499966">&#34;&#34;</span><span class="op" id="4499968">,</span>&nbsp;<span class="op" id="4499970">&amp;</span><span class="ident" id="4499971">Error</span><span class="op" id="4499976">{</span><span class="ident" id="4499977">Code</span><span class="op" id="4499981">:</span>&nbsp;<span class="ident" id="4499983">ErrMissingBracket</span><span class="op" id="4500000">,</span>&nbsp;<span class="ident" id="4500002">Expr</span><span class="op" id="4500006">:</span>&nbsp;<span class="ident" id="4500008">wholeClass</span><span class="op" id="4500018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4500021">}</span><br>
<span class="lineno">1350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4500025">//&nbsp;Allow&nbsp;regular&nbsp;escape&nbsp;sequences&nbsp;even&nbsp;though</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4500072">//&nbsp;many&nbsp;need&nbsp;not&nbsp;be&nbsp;escaped&nbsp;in&nbsp;this&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4500118">if</span>&nbsp;<span class="ident" id="4500121">s</span><span class="op" id="4500122">[</span><span class="num" id="4500123">0</span><span class="op" id="4500124">]</span>&nbsp;<span class="op" id="4500126">==</span>&nbsp;<span class="string" id="4500129">&#39;\\&#39;</span>&nbsp;<span class="op" id="4500134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4500138">return</span>&nbsp;<span class="ident" id="4500145">p</span><span class="op" id="4500146">.</span><span class="ident" id="4500147">parseEscape</span><span class="op" id="4500158">(</span><span class="ident" id="4500159">s</span><span class="op" id="4500160">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4500163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4500167">return</span>&nbsp;<span class="ident" id="4500174">nextRune</span><span class="op" id="4500182">(</span><span class="ident" id="4500183">s</span><span class="op" id="4500184">)</span><br>
<span class="lineno"></span><span class="op" id="4500186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1360</span><span class="keyword" id="4500189">type</span>&nbsp;<span class="ident" id="4500194">charGroup</span>&nbsp;<span class="keyword" id="4500204">struct</span>&nbsp;<span class="op" id="4500211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4500214">sign</span>&nbsp;&nbsp;<span class="builtintype" id="4500220">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4500225">class</span>&nbsp;<span class="op" id="4500231">[</span><span class="op" id="4500232">]</span><span class="builtintype" id="4500233">rune</span><br>
<span class="lineno"></span><span class="op" id="4500238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1365</span><span class="comment" id="4500241">//&nbsp;parsePerlClassEscape&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape&nbsp;like&nbsp;\d</span><br>
<span class="lineno"></span><span class="comment" id="4500318">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="4500397">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4500461">func</span>&nbsp;<span class="op" id="4500466">(</span><span class="ident" id="4500467">p</span>&nbsp;<span class="op" id="4500469">*</span><span class="ident" id="4500470">parser</span><span class="op" id="4500476">)</span>&nbsp;<span class="ident" id="4500478">parsePerlClassEscape</span><span class="op" id="4500498">(</span><span class="ident" id="4500499">s</span>&nbsp;<span class="builtintype" id="4500501">string</span><span class="op" id="4500507">,</span>&nbsp;<span class="ident" id="4500509">r</span>&nbsp;<span class="op" id="4500511">[</span><span class="op" id="4500512">]</span><span class="builtintype" id="4500513">rune</span><span class="op" id="4500517">)</span>&nbsp;<span class="op" id="4500519">(</span><span class="ident" id="4500520">out</span>&nbsp;<span class="op" id="4500524">[</span><span class="op" id="4500525">]</span><span class="builtintype" id="4500526">rune</span><span class="op" id="4500530">,</span>&nbsp;<span class="ident" id="4500532">rest</span>&nbsp;<span class="builtintype" id="4500537">string</span><span class="op" id="4500543">)</span>&nbsp;<span class="op" id="4500545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4500548">if</span>&nbsp;<span class="ident" id="4500551">p</span><span class="op" id="4500552">.</span><span class="ident" id="4500553">flags</span><span class="op" id="4500558">&amp;</span><span class="ident" id="4500559">PerlX</span>&nbsp;<span class="op" id="4500565">==</span>&nbsp;<span class="num" id="4500568">0</span>&nbsp;<span class="op" id="4500570">||</span>&nbsp;<span class="builtinfunc" id="4500573">len</span><span class="op" id="4500576">(</span><span class="ident" id="4500577">s</span><span class="op" id="4500578">)</span>&nbsp;<span class="op" id="4500580">&lt;</span>&nbsp;<span class="num" id="4500582">2</span>&nbsp;<span class="op" id="4500584">||</span>&nbsp;<span class="ident" id="4500587">s</span><span class="op" id="4500588">[</span><span class="num" id="4500589">0</span><span class="op" id="4500590">]</span>&nbsp;<span class="op" id="4500592">!=</span>&nbsp;<span class="string" id="4500595">&#39;\\&#39;</span>&nbsp;<span class="op" id="4500600">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4500604">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4500612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4500615">g</span>&nbsp;<span class="op" id="4500617">:=</span>&nbsp;<span class="ident" id="4500620">perlGroup</span><span class="op" id="4500629">[</span><span class="ident" id="4500630">s</span><span class="op" id="4500631">[</span><span class="num" id="4500632">0</span><span class="op" id="4500633">:</span><span class="num" id="4500634">2</span><span class="op" id="4500635">]</span><span class="op" id="4500636">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4500639">if</span>&nbsp;<span class="ident" id="4500642">g</span><span class="op" id="4500643">.</span><span class="ident" id="4500644">sign</span>&nbsp;<span class="op" id="4500649">==</span>&nbsp;<span class="num" id="4500652">0</span>&nbsp;<span class="op" id="4500654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4500658">return</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4500666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4500669">return</span>&nbsp;<span class="ident" id="4500676">p</span><span class="op" id="4500677">.</span><span class="ident" id="4500678">appendGroup</span><span class="op" id="4500689">(</span><span class="ident" id="4500690">r</span><span class="op" id="4500691">,</span>&nbsp;<span class="ident" id="4500693">g</span><span class="op" id="4500694">)</span><span class="op" id="4500695">,</span>&nbsp;<span class="ident" id="4500697">s</span><span class="op" id="4500698">[</span><span class="num" id="4500699">2</span><span class="op" id="4500700">:</span><span class="op" id="4500701">]</span><br>
<span class="lineno"></span><span class="op" id="4500703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4500706">//&nbsp;parseNamedClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;POSIX&nbsp;named&nbsp;character&nbsp;class&nbsp;like&nbsp;[:alnum:]</span><br>
<span class="lineno">1380</span><span class="comment" id="4500785">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="4500864">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4500928">func</span>&nbsp;<span class="op" id="4500933">(</span><span class="ident" id="4500934">p</span>&nbsp;<span class="op" id="4500936">*</span><span class="ident" id="4500937">parser</span><span class="op" id="4500943">)</span>&nbsp;<span class="ident" id="4500945">parseNamedClass</span><span class="op" id="4500960">(</span><span class="ident" id="4500961">s</span>&nbsp;<span class="builtintype" id="4500963">string</span><span class="op" id="4500969">,</span>&nbsp;<span class="ident" id="4500971">r</span>&nbsp;<span class="op" id="4500973">[</span><span class="op" id="4500974">]</span><span class="builtintype" id="4500975">rune</span><span class="op" id="4500979">)</span>&nbsp;<span class="op" id="4500981">(</span><span class="ident" id="4500982">out</span>&nbsp;<span class="op" id="4500986">[</span><span class="op" id="4500987">]</span><span class="builtintype" id="4500988">rune</span><span class="op" id="4500992">,</span>&nbsp;<span class="ident" id="4500994">rest</span>&nbsp;<span class="builtintype" id="4500999">string</span><span class="op" id="4501005">,</span>&nbsp;<span class="ident" id="4501007">err</span>&nbsp;<span class="builtintype" id="4501011">error</span><span class="op" id="4501016">)</span>&nbsp;<span class="op" id="4501018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4501021">if</span>&nbsp;<span class="builtinfunc" id="4501024">len</span><span class="op" id="4501027">(</span><span class="ident" id="4501028">s</span><span class="op" id="4501029">)</span>&nbsp;<span class="op" id="4501031">&lt;</span>&nbsp;<span class="num" id="4501033">2</span>&nbsp;<span class="op" id="4501035">||</span>&nbsp;<span class="ident" id="4501038">s</span><span class="op" id="4501039">[</span><span class="num" id="4501040">0</span><span class="op" id="4501041">]</span>&nbsp;<span class="op" id="4501043">!=</span>&nbsp;<span class="string" id="4501046">&#39;[&#39;</span>&nbsp;<span class="op" id="4501050">||</span>&nbsp;<span class="ident" id="4501053">s</span><span class="op" id="4501054">[</span><span class="num" id="4501055">1</span><span class="op" id="4501056">]</span>&nbsp;<span class="op" id="4501058">!=</span>&nbsp;<span class="string" id="4501061">&#39;:&#39;</span>&nbsp;<span class="op" id="4501065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4501069">return</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4501077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4501081">i</span>&nbsp;<span class="op" id="4501083">:=</span>&nbsp;<span class="ident" id="4501086">strings</span><span class="op" id="4501093">.</span><span class="ident" id="4501094">Index</span><span class="op" id="4501099">(</span><span class="ident" id="4501100">s</span><span class="op" id="4501101">[</span><span class="num" id="4501102">2</span><span class="op" id="4501103">:</span><span class="op" id="4501104">]</span><span class="op" id="4501105">,</span>&nbsp;<span class="string" id="4501107">&#34;:]&#34;</span><span class="op" id="4501111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4501114">if</span>&nbsp;<span class="ident" id="4501117">i</span>&nbsp;<span class="op" id="4501119">&lt;</span>&nbsp;<span class="num" id="4501121">0</span>&nbsp;<span class="op" id="4501123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4501127">return</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4501135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4501138">i</span>&nbsp;<span class="op" id="4501140">+=</span>&nbsp;<span class="num" id="4501143">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4501146">name</span><span class="op" id="4501150">,</span>&nbsp;<span class="ident" id="4501152">s</span>&nbsp;<span class="op" id="4501154">:=</span>&nbsp;<span class="ident" id="4501157">s</span><span class="op" id="4501158">[</span><span class="num" id="4501159">0</span><span class="op" id="4501160">:</span><span class="ident" id="4501161">i</span><span class="op" id="4501162">+</span><span class="num" id="4501163">2</span><span class="op" id="4501164">]</span><span class="op" id="4501165">,</span>&nbsp;<span class="ident" id="4501167">s</span><span class="op" id="4501168">[</span><span class="ident" id="4501169">i</span><span class="op" id="4501170">+</span><span class="num" id="4501171">2</span><span class="op" id="4501172">:</span><span class="op" id="4501173">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4501176">g</span>&nbsp;<span class="op" id="4501178">:=</span>&nbsp;<span class="ident" id="4501181">posixGroup</span><span class="op" id="4501191">[</span><span class="ident" id="4501192">name</span><span class="op" id="4501196">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4501199">if</span>&nbsp;<span class="ident" id="4501202">g</span><span class="op" id="4501203">.</span><span class="ident" id="4501204">sign</span>&nbsp;<span class="op" id="4501209">==</span>&nbsp;<span class="num" id="4501212">0</span>&nbsp;<span class="op" id="4501214">{</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4501218">return</span>&nbsp;<span class="ident" id="4501225">nil</span><span class="op" id="4501228">,</span>&nbsp;<span class="string" id="4501230">&#34;&#34;</span><span class="op" id="4501232">,</span>&nbsp;<span class="op" id="4501234">&amp;</span><span class="ident" id="4501235">Error</span><span class="op" id="4501240">{</span><span class="ident" id="4501241">ErrInvalidCharRange</span><span class="op" id="4501260">,</span>&nbsp;<span class="ident" id="4501262">name</span><span class="op" id="4501266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4501269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4501272">return</span>&nbsp;<span class="ident" id="4501279">p</span><span class="op" id="4501280">.</span><span class="ident" id="4501281">appendGroup</span><span class="op" id="4501292">(</span><span class="ident" id="4501293">r</span><span class="op" id="4501294">,</span>&nbsp;<span class="ident" id="4501296">g</span><span class="op" id="4501297">)</span><span class="op" id="4501298">,</span>&nbsp;<span class="ident" id="4501300">s</span><span class="op" id="4501301">,</span>&nbsp;<span class="ident" id="4501303">nil</span><br>
<span class="lineno"></span><span class="op" id="4501307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1400</span><span class="keyword" id="4501310">func</span>&nbsp;<span class="op" id="4501315">(</span><span class="ident" id="4501316">p</span>&nbsp;<span class="op" id="4501318">*</span><span class="ident" id="4501319">parser</span><span class="op" id="4501325">)</span>&nbsp;<span class="ident" id="4501327">appendGroup</span><span class="op" id="4501338">(</span><span class="ident" id="4501339">r</span>&nbsp;<span class="op" id="4501341">[</span><span class="op" id="4501342">]</span><span class="builtintype" id="4501343">rune</span><span class="op" id="4501347">,</span>&nbsp;<span class="ident" id="4501349">g</span>&nbsp;<span class="ident" id="4501351">charGroup</span><span class="op" id="4501360">)</span>&nbsp;<span class="op" id="4501362">[</span><span class="op" id="4501363">]</span><span class="builtintype" id="4501364">rune</span>&nbsp;<span class="op" id="4501369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4501372">if</span>&nbsp;<span class="ident" id="4501375">p</span><span class="op" id="4501376">.</span><span class="ident" id="4501377">flags</span><span class="op" id="4501382">&amp;</span><span class="ident" id="4501383">FoldCase</span>&nbsp;<span class="op" id="4501392">==</span>&nbsp;<span class="num" id="4501395">0</span>&nbsp;<span class="op" id="4501397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4501401">if</span>&nbsp;<span class="ident" id="4501404">g</span><span class="op" id="4501405">.</span><span class="ident" id="4501406">sign</span>&nbsp;<span class="op" id="4501411">&lt;</span>&nbsp;<span class="num" id="4501413">0</span>&nbsp;<span class="op" id="4501415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4501420">r</span>&nbsp;<span class="op" id="4501422">=</span>&nbsp;<span class="ident" id="4501424">appendNegatedClass</span><span class="op" id="4501442">(</span><span class="ident" id="4501443">r</span><span class="op" id="4501444">,</span>&nbsp;<span class="ident" id="4501446">g</span><span class="op" id="4501447">.</span><span class="ident" id="4501448">class</span><span class="op" id="4501453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4501457">}</span>&nbsp;<span class="keyword" id="4501459">else</span>&nbsp;<span class="op" id="4501464">{</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4501469">r</span>&nbsp;<span class="op" id="4501471">=</span>&nbsp;<span class="ident" id="4501473">appendClass</span><span class="op" id="4501484">(</span><span class="ident" id="4501485">r</span><span class="op" id="4501486">,</span>&nbsp;<span class="ident" id="4501488">g</span><span class="op" id="4501489">.</span><span class="ident" id="4501490">class</span><span class="op" id="4501495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4501499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4501502">}</span>&nbsp;<span class="keyword" id="4501504">else</span>&nbsp;<span class="op" id="4501509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4501513">tmp</span>&nbsp;<span class="op" id="4501517">:=</span>&nbsp;<span class="ident" id="4501520">p</span><span class="op" id="4501521">.</span><span class="ident" id="4501522">tmpClass</span><span class="op" id="4501530">[</span><span class="op" id="4501531">:</span><span class="num" id="4501532">0</span><span class="op" id="4501533">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4501537">tmp</span>&nbsp;<span class="op" id="4501541">=</span>&nbsp;<span class="ident" id="4501543">appendFoldedClass</span><span class="op" id="4501560">(</span><span class="ident" id="4501561">tmp</span><span class="op" id="4501564">,</span>&nbsp;<span class="ident" id="4501566">g</span><span class="op" id="4501567">.</span><span class="ident" id="4501568">class</span><span class="op" id="4501573">)</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4501577">p</span><span class="op" id="4501578">.</span><span class="ident" id="4501579">tmpClass</span>&nbsp;<span class="op" id="4501588">=</span>&nbsp;<span class="ident" id="4501590">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4501596">tmp</span>&nbsp;<span class="op" id="4501600">=</span>&nbsp;<span class="ident" id="4501602">cleanClass</span><span class="op" id="4501612">(</span><span class="op" id="4501613">&amp;</span><span class="ident" id="4501614">p</span><span class="op" id="4501615">.</span><span class="ident" id="4501616">tmpClass</span><span class="op" id="4501624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4501628">if</span>&nbsp;<span class="ident" id="4501631">g</span><span class="op" id="4501632">.</span><span class="ident" id="4501633">sign</span>&nbsp;<span class="op" id="4501638">&lt;</span>&nbsp;<span class="num" id="4501640">0</span>&nbsp;<span class="op" id="4501642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4501647">r</span>&nbsp;<span class="op" id="4501649">=</span>&nbsp;<span class="ident" id="4501651">appendNegatedClass</span><span class="op" id="4501669">(</span><span class="ident" id="4501670">r</span><span class="op" id="4501671">,</span>&nbsp;<span class="ident" id="4501673">tmp</span><span class="op" id="4501676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4501680">}</span>&nbsp;<span class="keyword" id="4501682">else</span>&nbsp;<span class="op" id="4501687">{</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4501692">r</span>&nbsp;<span class="op" id="4501694">=</span>&nbsp;<span class="ident" id="4501696">appendClass</span><span class="op" id="4501707">(</span><span class="ident" id="4501708">r</span><span class="op" id="4501709">,</span>&nbsp;<span class="ident" id="4501711">tmp</span><span class="op" id="4501714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4501718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4501721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4501724">return</span>&nbsp;<span class="ident" id="4501731">r</span><br>
<span class="lineno"></span><span class="op" id="4501733">}</span><br>
<span class="lineno">1420</span><br>
<span class="lineno"></span><span class="keyword" id="4501736">var</span>&nbsp;<span class="ident" id="4501740">anyTable</span>&nbsp;<span class="op" id="4501749">=</span>&nbsp;<span class="op" id="4501751">&amp;</span><span class="ident" id="4501752">unicode</span><span class="op" id="4501759">.</span><span class="ident" id="4501760">RangeTable</span><span class="op" id="4501770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4501773">R16</span><span class="op" id="4501776">:</span>&nbsp;<span class="op" id="4501778">[</span><span class="op" id="4501779">]</span><span class="ident" id="4501780">unicode</span><span class="op" id="4501787">.</span><span class="ident" id="4501788">Range16</span><span class="op" id="4501795">{</span><span class="op" id="4501796">{</span><span class="ident" id="4501797">Lo</span><span class="op" id="4501799">:</span>&nbsp;<span class="num" id="4501801">0</span><span class="op" id="4501802">,</span>&nbsp;<span class="ident" id="4501804">Hi</span><span class="op" id="4501806">:</span>&nbsp;<span class="num" id="4501808">1</span><span class="op" id="4501809">&lt;&lt;</span><span class="num" id="4501811">16</span>&nbsp;<span class="op" id="4501814">-</span>&nbsp;<span class="num" id="4501816">1</span><span class="op" id="4501817">,</span>&nbsp;<span class="ident" id="4501819">Stride</span><span class="op" id="4501825">:</span>&nbsp;<span class="num" id="4501827">1</span><span class="op" id="4501828">}</span><span class="op" id="4501829">}</span><span class="op" id="4501830">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4501833">R32</span><span class="op" id="4501836">:</span>&nbsp;<span class="op" id="4501838">[</span><span class="op" id="4501839">]</span><span class="ident" id="4501840">unicode</span><span class="op" id="4501847">.</span><span class="ident" id="4501848">Range32</span><span class="op" id="4501855">{</span><span class="op" id="4501856">{</span><span class="ident" id="4501857">Lo</span><span class="op" id="4501859">:</span>&nbsp;<span class="num" id="4501861">1</span>&nbsp;<span class="op" id="4501863">&lt;&lt;</span>&nbsp;<span class="num" id="4501866">16</span><span class="op" id="4501868">,</span>&nbsp;<span class="ident" id="4501870">Hi</span><span class="op" id="4501872">:</span>&nbsp;<span class="ident" id="4501874">unicode</span><span class="op" id="4501881">.</span><span class="ident" id="4501882">MaxRune</span><span class="op" id="4501889">,</span>&nbsp;<span class="ident" id="4501891">Stride</span><span class="op" id="4501897">:</span>&nbsp;<span class="num" id="4501899">1</span><span class="op" id="4501900">}</span><span class="op" id="4501901">}</span><span class="op" id="4501902">,</span><br>
<span class="lineno"></span><span class="op" id="4501904">}</span><br>
<span class="lineno">1425</span><br>
<span class="lineno"></span><span class="comment" id="4501907">//&nbsp;unicodeTable&nbsp;returns&nbsp;the&nbsp;unicode.RangeTable&nbsp;identified&nbsp;by&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="4501973">//&nbsp;and&nbsp;the&nbsp;table&nbsp;of&nbsp;additional&nbsp;fold-equivalent&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword" id="4502033">func</span>&nbsp;<span class="ident" id="4502038">unicodeTable</span><span class="op" id="4502050">(</span><span class="ident" id="4502051">name</span>&nbsp;<span class="builtintype" id="4502056">string</span><span class="op" id="4502062">)</span>&nbsp;<span class="op" id="4502064">(</span><span class="op" id="4502065">*</span><span class="ident" id="4502066">unicode</span><span class="op" id="4502073">.</span><span class="ident" id="4502074">RangeTable</span><span class="op" id="4502084">,</span>&nbsp;<span class="op" id="4502086">*</span><span class="ident" id="4502087">unicode</span><span class="op" id="4502094">.</span><span class="ident" id="4502095">RangeTable</span><span class="op" id="4502105">)</span>&nbsp;<span class="op" id="4502107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4502110">//&nbsp;Special&nbsp;case:&nbsp;&#34;Any&#34;&nbsp;means&nbsp;any.</span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4502145">if</span>&nbsp;<span class="ident" id="4502148">name</span>&nbsp;<span class="op" id="4502153">==</span>&nbsp;<span class="string" id="4502156">&#34;Any&#34;</span>&nbsp;<span class="op" id="4502162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4502166">return</span>&nbsp;<span class="ident" id="4502173">anyTable</span><span class="op" id="4502181">,</span>&nbsp;<span class="ident" id="4502183">anyTable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4502193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4502196">if</span>&nbsp;<span class="ident" id="4502199">t</span>&nbsp;<span class="op" id="4502201">:=</span>&nbsp;<span class="ident" id="4502204">unicode</span><span class="op" id="4502211">.</span><span class="ident" id="4502212">Categories</span><span class="op" id="4502222">[</span><span class="ident" id="4502223">name</span><span class="op" id="4502227">]</span><span class="op" id="4502228">;</span>&nbsp;<span class="ident" id="4502230">t</span>&nbsp;<span class="op" id="4502232">!=</span>&nbsp;<span class="ident" id="4502235">nil</span>&nbsp;<span class="op" id="4502239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4502243">return</span>&nbsp;<span class="ident" id="4502250">t</span><span class="op" id="4502251">,</span>&nbsp;<span class="ident" id="4502253">unicode</span><span class="op" id="4502260">.</span><span class="ident" id="4502261">FoldCategory</span><span class="op" id="4502273">[</span><span class="ident" id="4502274">name</span><span class="op" id="4502278">]</span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4502281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4502284">if</span>&nbsp;<span class="ident" id="4502287">t</span>&nbsp;<span class="op" id="4502289">:=</span>&nbsp;<span class="ident" id="4502292">unicode</span><span class="op" id="4502299">.</span><span class="ident" id="4502300">Scripts</span><span class="op" id="4502307">[</span><span class="ident" id="4502308">name</span><span class="op" id="4502312">]</span><span class="op" id="4502313">;</span>&nbsp;<span class="ident" id="4502315">t</span>&nbsp;<span class="op" id="4502317">!=</span>&nbsp;<span class="ident" id="4502320">nil</span>&nbsp;<span class="op" id="4502324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4502328">return</span>&nbsp;<span class="ident" id="4502335">t</span><span class="op" id="4502336">,</span>&nbsp;<span class="ident" id="4502338">unicode</span><span class="op" id="4502345">.</span><span class="ident" id="4502346">FoldScript</span><span class="op" id="4502356">[</span><span class="ident" id="4502357">name</span><span class="op" id="4502361">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4502364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4502367">return</span>&nbsp;<span class="ident" id="4502374">nil</span><span class="op" id="4502377">,</span>&nbsp;<span class="ident" id="4502379">nil</span><br>
<span class="lineno">1440</span><span class="op" id="4502383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4502386">//&nbsp;parseUnicodeClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Unicode&nbsp;character&nbsp;class&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span><span class="comment" id="4502461">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="4502540">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno">1445</span><span class="keyword" id="4502604">func</span>&nbsp;<span class="op" id="4502609">(</span><span class="ident" id="4502610">p</span>&nbsp;<span class="op" id="4502612">*</span><span class="ident" id="4502613">parser</span><span class="op" id="4502619">)</span>&nbsp;<span class="ident" id="4502621">parseUnicodeClass</span><span class="op" id="4502638">(</span><span class="ident" id="4502639">s</span>&nbsp;<span class="builtintype" id="4502641">string</span><span class="op" id="4502647">,</span>&nbsp;<span class="ident" id="4502649">r</span>&nbsp;<span class="op" id="4502651">[</span><span class="op" id="4502652">]</span><span class="builtintype" id="4502653">rune</span><span class="op" id="4502657">)</span>&nbsp;<span class="op" id="4502659">(</span><span class="ident" id="4502660">out</span>&nbsp;<span class="op" id="4502664">[</span><span class="op" id="4502665">]</span><span class="builtintype" id="4502666">rune</span><span class="op" id="4502670">,</span>&nbsp;<span class="ident" id="4502672">rest</span>&nbsp;<span class="builtintype" id="4502677">string</span><span class="op" id="4502683">,</span>&nbsp;<span class="ident" id="4502685">err</span>&nbsp;<span class="builtintype" id="4502689">error</span><span class="op" id="4502694">)</span>&nbsp;<span class="op" id="4502696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4502699">if</span>&nbsp;<span class="ident" id="4502702">p</span><span class="op" id="4502703">.</span><span class="ident" id="4502704">flags</span><span class="op" id="4502709">&amp;</span><span class="ident" id="4502710">UnicodeGroups</span>&nbsp;<span class="op" id="4502724">==</span>&nbsp;<span class="num" id="4502727">0</span>&nbsp;<span class="op" id="4502729">||</span>&nbsp;<span class="builtinfunc" id="4502732">len</span><span class="op" id="4502735">(</span><span class="ident" id="4502736">s</span><span class="op" id="4502737">)</span>&nbsp;<span class="op" id="4502739">&lt;</span>&nbsp;<span class="num" id="4502741">2</span>&nbsp;<span class="op" id="4502743">||</span>&nbsp;<span class="ident" id="4502746">s</span><span class="op" id="4502747">[</span><span class="num" id="4502748">0</span><span class="op" id="4502749">]</span>&nbsp;<span class="op" id="4502751">!=</span>&nbsp;<span class="string" id="4502754">&#39;\\&#39;</span>&nbsp;<span class="op" id="4502759">||</span>&nbsp;<span class="ident" id="4502762">s</span><span class="op" id="4502763">[</span><span class="num" id="4502764">1</span><span class="op" id="4502765">]</span>&nbsp;<span class="op" id="4502767">!=</span>&nbsp;<span class="string" id="4502770">&#39;p&#39;</span>&nbsp;<span class="op" id="4502774">&amp;&amp;</span>&nbsp;<span class="ident" id="4502777">s</span><span class="op" id="4502778">[</span><span class="num" id="4502779">1</span><span class="op" id="4502780">]</span>&nbsp;<span class="op" id="4502782">!=</span>&nbsp;<span class="string" id="4502785">&#39;P&#39;</span>&nbsp;<span class="op" id="4502789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4502793">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4502801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4502805">//&nbsp;Committed&nbsp;to&nbsp;parse&nbsp;or&nbsp;return&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502845">sign</span>&nbsp;<span class="op" id="4502850">:=</span>&nbsp;<span class="op" id="4502853">+</span><span class="num" id="4502854">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4502857">if</span>&nbsp;<span class="ident" id="4502860">s</span><span class="op" id="4502861">[</span><span class="num" id="4502862">1</span><span class="op" id="4502863">]</span>&nbsp;<span class="op" id="4502865">==</span>&nbsp;<span class="string" id="4502868">&#39;P&#39;</span>&nbsp;<span class="op" id="4502872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502876">sign</span>&nbsp;<span class="op" id="4502881">=</span>&nbsp;<span class="op" id="4502883">-</span><span class="num" id="4502884">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4502887">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502890">t</span>&nbsp;<span class="op" id="4502892">:=</span>&nbsp;<span class="ident" id="4502895">s</span><span class="op" id="4502896">[</span><span class="num" id="4502897">2</span><span class="op" id="4502898">:</span><span class="op" id="4502899">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502902">c</span><span class="op" id="4502903">,</span>&nbsp;<span class="ident" id="4502905">t</span><span class="op" id="4502906">,</span>&nbsp;<span class="ident" id="4502908">err</span>&nbsp;<span class="op" id="4502912">:=</span>&nbsp;<span class="ident" id="4502915">nextRune</span><span class="op" id="4502923">(</span><span class="ident" id="4502924">t</span><span class="op" id="4502925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4502928">if</span>&nbsp;<span class="ident" id="4502931">err</span>&nbsp;<span class="op" id="4502935">!=</span>&nbsp;<span class="ident" id="4502938">nil</span>&nbsp;<span class="op" id="4502942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4502946">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4502954">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4502957">var</span>&nbsp;<span class="ident" id="4502961">seq</span><span class="op" id="4502964">,</span>&nbsp;<span class="ident" id="4502966">name</span>&nbsp;<span class="builtintype" id="4502971">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4502979">if</span>&nbsp;<span class="ident" id="4502982">c</span>&nbsp;<span class="op" id="4502984">!=</span>&nbsp;<span class="string" id="4502987">&#39;{&#39;</span>&nbsp;<span class="op" id="4502991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4502995">//&nbsp;Single-letter&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503020">seq</span>&nbsp;<span class="op" id="4503024">=</span>&nbsp;<span class="ident" id="4503026">s</span><span class="op" id="4503027">[</span><span class="op" id="4503028">:</span><span class="builtinfunc" id="4503029">len</span><span class="op" id="4503032">(</span><span class="ident" id="4503033">s</span><span class="op" id="4503034">)</span><span class="op" id="4503035">-</span><span class="builtinfunc" id="4503036">len</span><span class="op" id="4503039">(</span><span class="ident" id="4503040">t</span><span class="op" id="4503041">)</span><span class="op" id="4503042">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503046">name</span>&nbsp;<span class="op" id="4503051">=</span>&nbsp;<span class="ident" id="4503053">seq</span><span class="op" id="4503056">[</span><span class="num" id="4503057">2</span><span class="op" id="4503058">:</span><span class="op" id="4503059">]</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4503062">}</span>&nbsp;<span class="keyword" id="4503064">else</span>&nbsp;<span class="op" id="4503069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4503073">//&nbsp;Name&nbsp;is&nbsp;in&nbsp;braces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503097">end</span>&nbsp;<span class="op" id="4503101">:=</span>&nbsp;<span class="ident" id="4503104">strings</span><span class="op" id="4503111">.</span><span class="ident" id="4503112">IndexRune</span><span class="op" id="4503121">(</span><span class="ident" id="4503122">s</span><span class="op" id="4503123">,</span>&nbsp;<span class="string" id="4503125">&#39;}&#39;</span><span class="op" id="4503128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503132">if</span>&nbsp;<span class="ident" id="4503135">end</span>&nbsp;<span class="op" id="4503139">&lt;</span>&nbsp;<span class="num" id="4503141">0</span>&nbsp;<span class="op" id="4503143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503148">if</span>&nbsp;<span class="ident" id="4503151">err</span>&nbsp;<span class="op" id="4503155">=</span>&nbsp;<span class="ident" id="4503157">checkUTF8</span><span class="op" id="4503166">(</span><span class="ident" id="4503167">s</span><span class="op" id="4503168">)</span><span class="op" id="4503169">;</span>&nbsp;<span class="ident" id="4503171">err</span>&nbsp;<span class="op" id="4503175">!=</span>&nbsp;<span class="ident" id="4503178">nil</span>&nbsp;<span class="op" id="4503182">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503188">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4503198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503203">return</span>&nbsp;<span class="ident" id="4503210">nil</span><span class="op" id="4503213">,</span>&nbsp;<span class="string" id="4503215">&#34;&#34;</span><span class="op" id="4503217">,</span>&nbsp;<span class="op" id="4503219">&amp;</span><span class="ident" id="4503220">Error</span><span class="op" id="4503225">{</span><span class="ident" id="4503226">ErrInvalidCharRange</span><span class="op" id="4503245">,</span>&nbsp;<span class="ident" id="4503247">s</span><span class="op" id="4503248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4503252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503256">seq</span><span class="op" id="4503259">,</span>&nbsp;<span class="ident" id="4503261">t</span>&nbsp;<span class="op" id="4503263">=</span>&nbsp;<span class="ident" id="4503265">s</span><span class="op" id="4503266">[</span><span class="op" id="4503267">:</span><span class="ident" id="4503268">end</span><span class="op" id="4503271">+</span><span class="num" id="4503272">1</span><span class="op" id="4503273">]</span><span class="op" id="4503274">,</span>&nbsp;<span class="ident" id="4503276">s</span><span class="op" id="4503277">[</span><span class="ident" id="4503278">end</span><span class="op" id="4503281">+</span><span class="num" id="4503282">1</span><span class="op" id="4503283">:</span><span class="op" id="4503284">]</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503288">name</span>&nbsp;<span class="op" id="4503293">=</span>&nbsp;<span class="ident" id="4503295">s</span><span class="op" id="4503296">[</span><span class="num" id="4503297">3</span><span class="op" id="4503298">:</span><span class="ident" id="4503299">end</span><span class="op" id="4503302">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503306">if</span>&nbsp;<span class="ident" id="4503309">err</span>&nbsp;<span class="op" id="4503313">=</span>&nbsp;<span class="ident" id="4503315">checkUTF8</span><span class="op" id="4503324">(</span><span class="ident" id="4503325">name</span><span class="op" id="4503329">)</span><span class="op" id="4503330">;</span>&nbsp;<span class="ident" id="4503332">err</span>&nbsp;<span class="op" id="4503336">!=</span>&nbsp;<span class="ident" id="4503339">nil</span>&nbsp;<span class="op" id="4503343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503348">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4503357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4503360">}</span><br>
<span class="lineno">1480</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4503364">//&nbsp;Group&nbsp;can&nbsp;have&nbsp;leading&nbsp;negation&nbsp;too.&nbsp;&nbsp;\p{^Han}&nbsp;==&nbsp;\P{Han},&nbsp;\P{^Han}&nbsp;==&nbsp;\p{Han}.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503448">if</span>&nbsp;<span class="ident" id="4503451">name</span>&nbsp;<span class="op" id="4503456">!=</span>&nbsp;<span class="string" id="4503459">&#34;&#34;</span>&nbsp;<span class="op" id="4503462">&amp;&amp;</span>&nbsp;<span class="ident" id="4503465">name</span><span class="op" id="4503469">[</span><span class="num" id="4503470">0</span><span class="op" id="4503471">]</span>&nbsp;<span class="op" id="4503473">==</span>&nbsp;<span class="string" id="4503476">&#39;^&#39;</span>&nbsp;<span class="op" id="4503480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503484">sign</span>&nbsp;<span class="op" id="4503489">=</span>&nbsp;<span class="op" id="4503491">-</span><span class="ident" id="4503492">sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503499">name</span>&nbsp;<span class="op" id="4503504">=</span>&nbsp;<span class="ident" id="4503506">name</span><span class="op" id="4503510">[</span><span class="num" id="4503511">1</span><span class="op" id="4503512">:</span><span class="op" id="4503513">]</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4503516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503520">tab</span><span class="op" id="4503523">,</span>&nbsp;<span class="ident" id="4503525">fold</span>&nbsp;<span class="op" id="4503530">:=</span>&nbsp;<span class="ident" id="4503533">unicodeTable</span><span class="op" id="4503545">(</span><span class="ident" id="4503546">name</span><span class="op" id="4503550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503553">if</span>&nbsp;<span class="ident" id="4503556">tab</span>&nbsp;<span class="op" id="4503560">==</span>&nbsp;<span class="ident" id="4503563">nil</span>&nbsp;<span class="op" id="4503567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503571">return</span>&nbsp;<span class="ident" id="4503578">nil</span><span class="op" id="4503581">,</span>&nbsp;<span class="string" id="4503583">&#34;&#34;</span><span class="op" id="4503585">,</span>&nbsp;<span class="op" id="4503587">&amp;</span><span class="ident" id="4503588">Error</span><span class="op" id="4503593">{</span><span class="ident" id="4503594">ErrInvalidCharRange</span><span class="op" id="4503613">,</span>&nbsp;<span class="ident" id="4503615">seq</span><span class="op" id="4503618">}</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4503621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503625">if</span>&nbsp;<span class="ident" id="4503628">p</span><span class="op" id="4503629">.</span><span class="ident" id="4503630">flags</span><span class="op" id="4503635">&amp;</span><span class="ident" id="4503636">FoldCase</span>&nbsp;<span class="op" id="4503645">==</span>&nbsp;<span class="num" id="4503648">0</span>&nbsp;<span class="op" id="4503650">||</span>&nbsp;<span class="ident" id="4503653">fold</span>&nbsp;<span class="op" id="4503658">==</span>&nbsp;<span class="ident" id="4503661">nil</span>&nbsp;<span class="op" id="4503665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503669">if</span>&nbsp;<span class="ident" id="4503672">sign</span>&nbsp;<span class="op" id="4503677">&gt;</span>&nbsp;<span class="num" id="4503679">0</span>&nbsp;<span class="op" id="4503681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503686">r</span>&nbsp;<span class="op" id="4503688">=</span>&nbsp;<span class="ident" id="4503690">appendTable</span><span class="op" id="4503701">(</span><span class="ident" id="4503702">r</span><span class="op" id="4503703">,</span>&nbsp;<span class="ident" id="4503705">tab</span><span class="op" id="4503708">)</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4503712">}</span>&nbsp;<span class="keyword" id="4503714">else</span>&nbsp;<span class="op" id="4503719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503724">r</span>&nbsp;<span class="op" id="4503726">=</span>&nbsp;<span class="ident" id="4503728">appendNegatedTable</span><span class="op" id="4503746">(</span><span class="ident" id="4503747">r</span><span class="op" id="4503748">,</span>&nbsp;<span class="ident" id="4503750">tab</span><span class="op" id="4503753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4503757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4503760">}</span>&nbsp;<span class="keyword" id="4503762">else</span>&nbsp;<span class="op" id="4503767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4503771">//&nbsp;Merge&nbsp;and&nbsp;clean&nbsp;tab&nbsp;and&nbsp;fold&nbsp;in&nbsp;a&nbsp;temporary&nbsp;buffer.</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4503828">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;for&nbsp;the&nbsp;negative&nbsp;case&nbsp;and&nbsp;just&nbsp;tidy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4503887">//&nbsp;for&nbsp;the&nbsp;positive&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503915">tmp</span>&nbsp;<span class="op" id="4503919">:=</span>&nbsp;<span class="ident" id="4503922">p</span><span class="op" id="4503923">.</span><span class="ident" id="4503924">tmpClass</span><span class="op" id="4503932">[</span><span class="op" id="4503933">:</span><span class="num" id="4503934">0</span><span class="op" id="4503935">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503939">tmp</span>&nbsp;<span class="op" id="4503943">=</span>&nbsp;<span class="ident" id="4503945">appendTable</span><span class="op" id="4503956">(</span><span class="ident" id="4503957">tmp</span><span class="op" id="4503960">,</span>&nbsp;<span class="ident" id="4503962">tab</span><span class="op" id="4503965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503969">tmp</span>&nbsp;<span class="op" id="4503973">=</span>&nbsp;<span class="ident" id="4503975">appendTable</span><span class="op" id="4503986">(</span><span class="ident" id="4503987">tmp</span><span class="op" id="4503990">,</span>&nbsp;<span class="ident" id="4503992">fold</span><span class="op" id="4503996">)</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504000">p</span><span class="op" id="4504001">.</span><span class="ident" id="4504002">tmpClass</span>&nbsp;<span class="op" id="4504011">=</span>&nbsp;<span class="ident" id="4504013">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504019">tmp</span>&nbsp;<span class="op" id="4504023">=</span>&nbsp;<span class="ident" id="4504025">cleanClass</span><span class="op" id="4504035">(</span><span class="op" id="4504036">&amp;</span><span class="ident" id="4504037">p</span><span class="op" id="4504038">.</span><span class="ident" id="4504039">tmpClass</span><span class="op" id="4504047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504051">if</span>&nbsp;<span class="ident" id="4504054">sign</span>&nbsp;<span class="op" id="4504059">&gt;</span>&nbsp;<span class="num" id="4504061">0</span>&nbsp;<span class="op" id="4504063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504068">r</span>&nbsp;<span class="op" id="4504070">=</span>&nbsp;<span class="ident" id="4504072">appendClass</span><span class="op" id="4504083">(</span><span class="ident" id="4504084">r</span><span class="op" id="4504085">,</span>&nbsp;<span class="ident" id="4504087">tmp</span><span class="op" id="4504090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4504094">}</span>&nbsp;<span class="keyword" id="4504096">else</span>&nbsp;<span class="op" id="4504101">{</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504106">r</span>&nbsp;<span class="op" id="4504108">=</span>&nbsp;<span class="ident" id="4504110">appendNegatedClass</span><span class="op" id="4504128">(</span><span class="ident" id="4504129">r</span><span class="op" id="4504130">,</span>&nbsp;<span class="ident" id="4504132">tmp</span><span class="op" id="4504135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4504139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4504142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504145">return</span>&nbsp;<span class="ident" id="4504152">r</span><span class="op" id="4504153">,</span>&nbsp;<span class="ident" id="4504155">t</span><span class="op" id="4504156">,</span>&nbsp;<span class="ident" id="4504158">nil</span><br>
<span class="lineno"></span><span class="op" id="4504162">}</span><br>
<span class="lineno">1515</span><br>
<span class="lineno"></span><span class="comment" id="4504165">//&nbsp;parseClass&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="4504226">//&nbsp;and&nbsp;pushes&nbsp;it&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="4504265">func</span>&nbsp;<span class="op" id="4504270">(</span><span class="ident" id="4504271">p</span>&nbsp;<span class="op" id="4504273">*</span><span class="ident" id="4504274">parser</span><span class="op" id="4504280">)</span>&nbsp;<span class="ident" id="4504282">parseClass</span><span class="op" id="4504292">(</span><span class="ident" id="4504293">s</span>&nbsp;<span class="builtintype" id="4504295">string</span><span class="op" id="4504301">)</span>&nbsp;<span class="op" id="4504303">(</span><span class="ident" id="4504304">rest</span>&nbsp;<span class="builtintype" id="4504309">string</span><span class="op" id="4504315">,</span>&nbsp;<span class="ident" id="4504317">err</span>&nbsp;<span class="builtintype" id="4504321">error</span><span class="op" id="4504326">)</span>&nbsp;<span class="op" id="4504328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504331">t</span>&nbsp;<span class="op" id="4504333">:=</span>&nbsp;<span class="ident" id="4504336">s</span><span class="op" id="4504337">[</span><span class="num" id="4504338">1</span><span class="op" id="4504339">:</span><span class="op" id="4504340">]</span>&nbsp;<span class="comment" id="4504342">//&nbsp;chop&nbsp;[</span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504353">re</span>&nbsp;<span class="op" id="4504356">:=</span>&nbsp;<span class="ident" id="4504359">p</span><span class="op" id="4504360">.</span><span class="ident" id="4504361">newRegexp</span><span class="op" id="4504370">(</span><span class="ident" id="4504371">OpCharClass</span><span class="op" id="4504382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504385">re</span><span class="op" id="4504387">.</span><span class="ident" id="4504388">Flags</span>&nbsp;<span class="op" id="4504394">=</span>&nbsp;<span class="ident" id="4504396">p</span><span class="op" id="4504397">.</span><span class="ident" id="4504398">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504405">re</span><span class="op" id="4504407">.</span><span class="ident" id="4504408">Rune</span>&nbsp;<span class="op" id="4504413">=</span>&nbsp;<span class="ident" id="4504415">re</span><span class="op" id="4504417">.</span><span class="ident" id="4504418">Rune0</span><span class="op" id="4504423">[</span><span class="op" id="4504424">:</span><span class="num" id="4504425">0</span><span class="op" id="4504426">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504430">sign</span>&nbsp;<span class="op" id="4504435">:=</span>&nbsp;<span class="op" id="4504438">+</span><span class="num" id="4504439">1</span><br>
<span class="lineno">1525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504442">if</span>&nbsp;<span class="ident" id="4504445">t</span>&nbsp;<span class="op" id="4504447">!=</span>&nbsp;<span class="string" id="4504450">&#34;&#34;</span>&nbsp;<span class="op" id="4504453">&amp;&amp;</span>&nbsp;<span class="ident" id="4504456">t</span><span class="op" id="4504457">[</span><span class="num" id="4504458">0</span><span class="op" id="4504459">]</span>&nbsp;<span class="op" id="4504461">==</span>&nbsp;<span class="string" id="4504464">&#39;^&#39;</span>&nbsp;<span class="op" id="4504468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504472">sign</span>&nbsp;<span class="op" id="4504477">=</span>&nbsp;<span class="op" id="4504479">-</span><span class="num" id="4504480">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504484">t</span>&nbsp;<span class="op" id="4504486">=</span>&nbsp;<span class="ident" id="4504488">t</span><span class="op" id="4504489">[</span><span class="num" id="4504490">1</span><span class="op" id="4504491">:</span><span class="op" id="4504492">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4504497">//&nbsp;If&nbsp;character&nbsp;class&nbsp;does&nbsp;not&nbsp;match&nbsp;\n,&nbsp;add&nbsp;it&nbsp;here,</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4504553">//&nbsp;so&nbsp;that&nbsp;negation&nbsp;later&nbsp;will&nbsp;do&nbsp;the&nbsp;right&nbsp;thing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504606">if</span>&nbsp;<span class="ident" id="4504609">p</span><span class="op" id="4504610">.</span><span class="ident" id="4504611">flags</span><span class="op" id="4504616">&amp;</span><span class="ident" id="4504617">ClassNL</span>&nbsp;<span class="op" id="4504625">==</span>&nbsp;<span class="num" id="4504628">0</span>&nbsp;<span class="op" id="4504630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504635">re</span><span class="op" id="4504637">.</span><span class="ident" id="4504638">Rune</span>&nbsp;<span class="op" id="4504643">=</span>&nbsp;<span class="builtinfunc" id="4504645">append</span><span class="op" id="4504651">(</span><span class="ident" id="4504652">re</span><span class="op" id="4504654">.</span><span class="ident" id="4504655">Rune</span><span class="op" id="4504659">,</span>&nbsp;<span class="string" id="4504661">&#39;\n&#39;</span><span class="op" id="4504665">,</span>&nbsp;<span class="string" id="4504667">&#39;\n&#39;</span><span class="op" id="4504671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4504675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4504678">}</span><br>
<span class="lineno">1535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504682">class</span>&nbsp;<span class="op" id="4504688">:=</span>&nbsp;<span class="ident" id="4504691">re</span><span class="op" id="4504693">.</span><span class="ident" id="4504694">Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504700">first</span>&nbsp;<span class="op" id="4504706">:=</span>&nbsp;<span class="builtintype" id="4504709">true</span>&nbsp;<span class="comment" id="4504714">//&nbsp;]&nbsp;and&nbsp;-&nbsp;are&nbsp;okay&nbsp;as&nbsp;first&nbsp;char&nbsp;in&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504758">for</span>&nbsp;<span class="ident" id="4504762">t</span>&nbsp;<span class="op" id="4504764">==</span>&nbsp;<span class="string" id="4504767">&#34;&#34;</span>&nbsp;<span class="op" id="4504770">||</span>&nbsp;<span class="ident" id="4504773">t</span><span class="op" id="4504774">[</span><span class="num" id="4504775">0</span><span class="op" id="4504776">]</span>&nbsp;<span class="op" id="4504778">!=</span>&nbsp;<span class="string" id="4504781">&#39;]&#39;</span>&nbsp;<span class="op" id="4504785">||</span>&nbsp;<span class="ident" id="4504788">first</span>&nbsp;<span class="op" id="4504794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4504798">//&nbsp;POSIX:&nbsp;-&nbsp;is&nbsp;only&nbsp;okay&nbsp;unescaped&nbsp;as&nbsp;first&nbsp;or&nbsp;last&nbsp;in&nbsp;class.</span><br>
<span class="lineno">1540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4504862">//&nbsp;Perl:&nbsp;-&nbsp;is&nbsp;okay&nbsp;anywhere.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504893">if</span>&nbsp;<span class="ident" id="4504896">t</span>&nbsp;<span class="op" id="4504898">!=</span>&nbsp;<span class="string" id="4504901">&#34;&#34;</span>&nbsp;<span class="op" id="4504904">&amp;&amp;</span>&nbsp;<span class="ident" id="4504907">t</span><span class="op" id="4504908">[</span><span class="num" id="4504909">0</span><span class="op" id="4504910">]</span>&nbsp;<span class="op" id="4504912">==</span>&nbsp;<span class="string" id="4504915">&#39;-&#39;</span>&nbsp;<span class="op" id="4504919">&amp;&amp;</span>&nbsp;<span class="ident" id="4504922">p</span><span class="op" id="4504923">.</span><span class="ident" id="4504924">flags</span><span class="op" id="4504929">&amp;</span><span class="ident" id="4504930">PerlX</span>&nbsp;<span class="op" id="4504936">==</span>&nbsp;<span class="num" id="4504939">0</span>&nbsp;<span class="op" id="4504941">&amp;&amp;</span>&nbsp;<span class="op" id="4504944">!</span><span class="ident" id="4504945">first</span>&nbsp;<span class="op" id="4504951">&amp;&amp;</span>&nbsp;<span class="op" id="4504954">(</span><span class="builtinfunc" id="4504955">len</span><span class="op" id="4504958">(</span><span class="ident" id="4504959">t</span><span class="op" id="4504960">)</span>&nbsp;<span class="op" id="4504962">==</span>&nbsp;<span class="num" id="4504965">1</span>&nbsp;<span class="op" id="4504967">||</span>&nbsp;<span class="ident" id="4504970">t</span><span class="op" id="4504971">[</span><span class="num" id="4504972">1</span><span class="op" id="4504973">]</span>&nbsp;<span class="op" id="4504975">!=</span>&nbsp;<span class="string" id="4504978">&#39;]&#39;</span><span class="op" id="4504981">)</span>&nbsp;<span class="op" id="4504983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504988">_</span><span class="op" id="4504989">,</span>&nbsp;<span class="ident" id="4504991">size</span>&nbsp;<span class="op" id="4504996">:=</span>&nbsp;<span class="ident" id="4504999">utf8</span><span class="op" id="4505003">.</span><span class="ident" id="4505004">DecodeRuneInString</span><span class="op" id="4505022">(</span><span class="ident" id="4505023">t</span><span class="op" id="4505024">[</span><span class="num" id="4505025">1</span><span class="op" id="4505026">:</span><span class="op" id="4505027">]</span><span class="op" id="4505028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505033">return</span>&nbsp;<span class="string" id="4505040">&#34;&#34;</span><span class="op" id="4505042">,</span>&nbsp;<span class="op" id="4505044">&amp;</span><span class="ident" id="4505045">Error</span><span class="op" id="4505050">{</span><span class="ident" id="4505051">Code</span><span class="op" id="4505055">:</span>&nbsp;<span class="ident" id="4505057">ErrInvalidCharRange</span><span class="op" id="4505076">,</span>&nbsp;<span class="ident" id="4505078">Expr</span><span class="op" id="4505082">:</span>&nbsp;<span class="ident" id="4505084">t</span><span class="op" id="4505085">[</span><span class="op" id="4505086">:</span><span class="num" id="4505087">1</span><span class="op" id="4505088">+</span><span class="ident" id="4505089">size</span><span class="op" id="4505093">]</span><span class="op" id="4505094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4505098">}</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505102">first</span>&nbsp;<span class="op" id="4505108">=</span>&nbsp;<span class="builtintype" id="4505110">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4505119">//&nbsp;Look&nbsp;for&nbsp;POSIX&nbsp;[:alnum:]&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505154">if</span>&nbsp;<span class="builtinfunc" id="4505157">len</span><span class="op" id="4505160">(</span><span class="ident" id="4505161">t</span><span class="op" id="4505162">)</span>&nbsp;<span class="op" id="4505164">&gt;</span>&nbsp;<span class="num" id="4505166">2</span>&nbsp;<span class="op" id="4505168">&amp;&amp;</span>&nbsp;<span class="ident" id="4505171">t</span><span class="op" id="4505172">[</span><span class="num" id="4505173">0</span><span class="op" id="4505174">]</span>&nbsp;<span class="op" id="4505176">==</span>&nbsp;<span class="string" id="4505179">&#39;[&#39;</span>&nbsp;<span class="op" id="4505183">&amp;&amp;</span>&nbsp;<span class="ident" id="4505186">t</span><span class="op" id="4505187">[</span><span class="num" id="4505188">1</span><span class="op" id="4505189">]</span>&nbsp;<span class="op" id="4505191">==</span>&nbsp;<span class="string" id="4505194">&#39;:&#39;</span>&nbsp;<span class="op" id="4505198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505203">nclass</span><span class="op" id="4505209">,</span>&nbsp;<span class="ident" id="4505211">nt</span><span class="op" id="4505213">,</span>&nbsp;<span class="ident" id="4505215">err</span>&nbsp;<span class="op" id="4505219">:=</span>&nbsp;<span class="ident" id="4505222">p</span><span class="op" id="4505223">.</span><span class="ident" id="4505224">parseNamedClass</span><span class="op" id="4505239">(</span><span class="ident" id="4505240">t</span><span class="op" id="4505241">,</span>&nbsp;<span class="ident" id="4505243">class</span><span class="op" id="4505248">)</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505253">if</span>&nbsp;<span class="ident" id="4505256">err</span>&nbsp;<span class="op" id="4505260">!=</span>&nbsp;<span class="ident" id="4505263">nil</span>&nbsp;<span class="op" id="4505267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505273">return</span>&nbsp;<span class="string" id="4505280">&#34;&#34;</span><span class="op" id="4505282">,</span>&nbsp;<span class="ident" id="4505284">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4505291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505296">if</span>&nbsp;<span class="ident" id="4505299">nclass</span>&nbsp;<span class="op" id="4505306">!=</span>&nbsp;<span class="ident" id="4505309">nil</span>&nbsp;<span class="op" id="4505313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505319">class</span><span class="op" id="4505324">,</span>&nbsp;<span class="ident" id="4505326">t</span>&nbsp;<span class="op" id="4505328">=</span>&nbsp;<span class="ident" id="4505330">nclass</span><span class="op" id="4505336">,</span>&nbsp;<span class="ident" id="4505338">nt</span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505345">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4505357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4505361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4505366">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}.</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505418">nclass</span><span class="op" id="4505424">,</span>&nbsp;<span class="ident" id="4505426">nt</span><span class="op" id="4505428">,</span>&nbsp;<span class="ident" id="4505430">err</span>&nbsp;<span class="op" id="4505434">:=</span>&nbsp;<span class="ident" id="4505437">p</span><span class="op" id="4505438">.</span><span class="ident" id="4505439">parseUnicodeClass</span><span class="op" id="4505456">(</span><span class="ident" id="4505457">t</span><span class="op" id="4505458">,</span>&nbsp;<span class="ident" id="4505460">class</span><span class="op" id="4505465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505469">if</span>&nbsp;<span class="ident" id="4505472">err</span>&nbsp;<span class="op" id="4505476">!=</span>&nbsp;<span class="ident" id="4505479">nil</span>&nbsp;<span class="op" id="4505483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505488">return</span>&nbsp;<span class="string" id="4505495">&#34;&#34;</span><span class="op" id="4505497">,</span>&nbsp;<span class="ident" id="4505499">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4505505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505509">if</span>&nbsp;<span class="ident" id="4505512">nclass</span>&nbsp;<span class="op" id="4505519">!=</span>&nbsp;<span class="ident" id="4505522">nil</span>&nbsp;<span class="op" id="4505526">{</span><br>
<span class="lineno">1565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505531">class</span><span class="op" id="4505536">,</span>&nbsp;<span class="ident" id="4505538">t</span>&nbsp;<span class="op" id="4505540">=</span>&nbsp;<span class="ident" id="4505542">nclass</span><span class="op" id="4505548">,</span>&nbsp;<span class="ident" id="4505550">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505556">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4505567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4505572">//&nbsp;Look&nbsp;for&nbsp;Perl&nbsp;character&nbsp;class&nbsp;symbols&nbsp;(extension).</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505628">if</span>&nbsp;<span class="ident" id="4505631">nclass</span><span class="op" id="4505637">,</span>&nbsp;<span class="ident" id="4505639">nt</span>&nbsp;<span class="op" id="4505642">:=</span>&nbsp;<span class="ident" id="4505645">p</span><span class="op" id="4505646">.</span><span class="ident" id="4505647">parsePerlClassEscape</span><span class="op" id="4505667">(</span><span class="ident" id="4505668">t</span><span class="op" id="4505669">,</span>&nbsp;<span class="ident" id="4505671">class</span><span class="op" id="4505676">)</span><span class="op" id="4505677">;</span>&nbsp;<span class="ident" id="4505679">nclass</span>&nbsp;<span class="op" id="4505686">!=</span>&nbsp;<span class="ident" id="4505689">nil</span>&nbsp;<span class="op" id="4505693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505698">class</span><span class="op" id="4505703">,</span>&nbsp;<span class="ident" id="4505705">t</span>&nbsp;<span class="op" id="4505707">=</span>&nbsp;<span class="ident" id="4505709">nclass</span><span class="op" id="4505715">,</span>&nbsp;<span class="ident" id="4505717">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505723">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4505734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4505739">//&nbsp;Single&nbsp;character&nbsp;or&nbsp;simple&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505778">rng</span>&nbsp;<span class="op" id="4505782">:=</span>&nbsp;<span class="ident" id="4505785">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505789">var</span>&nbsp;<span class="ident" id="4505793">lo</span><span class="op" id="4505795">,</span>&nbsp;<span class="ident" id="4505797">hi</span>&nbsp;<span class="builtintype" id="4505800">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505807">if</span>&nbsp;<span class="ident" id="4505810">lo</span><span class="op" id="4505812">,</span>&nbsp;<span class="ident" id="4505814">t</span><span class="op" id="4505815">,</span>&nbsp;<span class="ident" id="4505817">err</span>&nbsp;<span class="op" id="4505821">=</span>&nbsp;<span class="ident" id="4505823">p</span><span class="op" id="4505824">.</span><span class="ident" id="4505825">parseClassChar</span><span class="op" id="4505839">(</span><span class="ident" id="4505840">t</span><span class="op" id="4505841">,</span>&nbsp;<span class="ident" id="4505843">s</span><span class="op" id="4505844">)</span><span class="op" id="4505845">;</span>&nbsp;<span class="ident" id="4505847">err</span>&nbsp;<span class="op" id="4505851">!=</span>&nbsp;<span class="ident" id="4505854">nil</span>&nbsp;<span class="op" id="4505858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505863">return</span>&nbsp;<span class="string" id="4505870">&#34;&#34;</span><span class="op" id="4505872">,</span>&nbsp;<span class="ident" id="4505874">err</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4505880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505884">hi</span>&nbsp;<span class="op" id="4505887">=</span>&nbsp;<span class="ident" id="4505889">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4505894">//&nbsp;[a-]&nbsp;means&nbsp;(a|-)&nbsp;so&nbsp;check&nbsp;for&nbsp;final&nbsp;].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505938">if</span>&nbsp;<span class="builtinfunc" id="4505941">len</span><span class="op" id="4505944">(</span><span class="ident" id="4505945">t</span><span class="op" id="4505946">)</span>&nbsp;<span class="op" id="4505948">&gt;=</span>&nbsp;<span class="num" id="4505951">2</span>&nbsp;<span class="op" id="4505953">&amp;&amp;</span>&nbsp;<span class="ident" id="4505956">t</span><span class="op" id="4505957">[</span><span class="num" id="4505958">0</span><span class="op" id="4505959">]</span>&nbsp;<span class="op" id="4505961">==</span>&nbsp;<span class="string" id="4505964">&#39;-&#39;</span>&nbsp;<span class="op" id="4505968">&amp;&amp;</span>&nbsp;<span class="ident" id="4505971">t</span><span class="op" id="4505972">[</span><span class="num" id="4505973">1</span><span class="op" id="4505974">]</span>&nbsp;<span class="op" id="4505976">!=</span>&nbsp;<span class="string" id="4505979">&#39;]&#39;</span>&nbsp;<span class="op" id="4505983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505988">t</span>&nbsp;<span class="op" id="4505990">=</span>&nbsp;<span class="ident" id="4505992">t</span><span class="op" id="4505993">[</span><span class="num" id="4505994">1</span><span class="op" id="4505995">:</span><span class="op" id="4505996">]</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506001">if</span>&nbsp;<span class="ident" id="4506004">hi</span><span class="op" id="4506006">,</span>&nbsp;<span class="ident" id="4506008">t</span><span class="op" id="4506009">,</span>&nbsp;<span class="ident" id="4506011">err</span>&nbsp;<span class="op" id="4506015">=</span>&nbsp;<span class="ident" id="4506017">p</span><span class="op" id="4506018">.</span><span class="ident" id="4506019">parseClassChar</span><span class="op" id="4506033">(</span><span class="ident" id="4506034">t</span><span class="op" id="4506035">,</span>&nbsp;<span class="ident" id="4506037">s</span><span class="op" id="4506038">)</span><span class="op" id="4506039">;</span>&nbsp;<span class="ident" id="4506041">err</span>&nbsp;<span class="op" id="4506045">!=</span>&nbsp;<span class="ident" id="4506048">nil</span>&nbsp;<span class="op" id="4506052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506058">return</span>&nbsp;<span class="string" id="4506065">&#34;&#34;</span><span class="op" id="4506067">,</span>&nbsp;<span class="ident" id="4506069">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506081">if</span>&nbsp;<span class="ident" id="4506084">hi</span>&nbsp;<span class="op" id="4506087">&lt;</span>&nbsp;<span class="ident" id="4506089">lo</span>&nbsp;<span class="op" id="4506092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506098">rng</span>&nbsp;<span class="op" id="4506102">=</span>&nbsp;<span class="ident" id="4506104">rng</span><span class="op" id="4506107">[</span><span class="op" id="4506108">:</span><span class="builtinfunc" id="4506109">len</span><span class="op" id="4506112">(</span><span class="ident" id="4506113">rng</span><span class="op" id="4506116">)</span><span class="op" id="4506117">-</span><span class="builtinfunc" id="4506118">len</span><span class="op" id="4506121">(</span><span class="ident" id="4506122">t</span><span class="op" id="4506123">)</span><span class="op" id="4506124">]</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506130">return</span>&nbsp;<span class="string" id="4506137">&#34;&#34;</span><span class="op" id="4506139">,</span>&nbsp;<span class="op" id="4506141">&amp;</span><span class="ident" id="4506142">Error</span><span class="op" id="4506147">{</span><span class="ident" id="4506148">Code</span><span class="op" id="4506152">:</span>&nbsp;<span class="ident" id="4506154">ErrInvalidCharRange</span><span class="op" id="4506173">,</span>&nbsp;<span class="ident" id="4506175">Expr</span><span class="op" id="4506179">:</span>&nbsp;<span class="ident" id="4506181">rng</span><span class="op" id="4506184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506197">if</span>&nbsp;<span class="ident" id="4506200">p</span><span class="op" id="4506201">.</span><span class="ident" id="4506202">flags</span><span class="op" id="4506207">&amp;</span><span class="ident" id="4506208">FoldCase</span>&nbsp;<span class="op" id="4506217">==</span>&nbsp;<span class="num" id="4506220">0</span>&nbsp;<span class="op" id="4506222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506227">class</span>&nbsp;<span class="op" id="4506233">=</span>&nbsp;<span class="ident" id="4506235">appendRange</span><span class="op" id="4506246">(</span><span class="ident" id="4506247">class</span><span class="op" id="4506252">,</span>&nbsp;<span class="ident" id="4506254">lo</span><span class="op" id="4506256">,</span>&nbsp;<span class="ident" id="4506258">hi</span><span class="op" id="4506260">)</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506264">}</span>&nbsp;<span class="keyword" id="4506266">else</span>&nbsp;<span class="op" id="4506271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506276">class</span>&nbsp;<span class="op" id="4506282">=</span>&nbsp;<span class="ident" id="4506284">appendFoldedRange</span><span class="op" id="4506301">(</span><span class="ident" id="4506302">class</span><span class="op" id="4506307">,</span>&nbsp;<span class="ident" id="4506309">lo</span><span class="op" id="4506311">,</span>&nbsp;<span class="ident" id="4506313">hi</span><span class="op" id="4506315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506325">t</span>&nbsp;<span class="op" id="4506327">=</span>&nbsp;<span class="ident" id="4506329">t</span><span class="op" id="4506330">[</span><span class="num" id="4506331">1</span><span class="op" id="4506332">:</span><span class="op" id="4506333">]</span>&nbsp;<span class="comment" id="4506335">//&nbsp;chop&nbsp;]</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4506347">//&nbsp;Use&nbsp;&amp;re.Rune&nbsp;instead&nbsp;of&nbsp;&amp;class&nbsp;to&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506403">re</span><span class="op" id="4506405">.</span><span class="ident" id="4506406">Rune</span>&nbsp;<span class="op" id="4506411">=</span>&nbsp;<span class="ident" id="4506413">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506420">class</span>&nbsp;<span class="op" id="4506426">=</span>&nbsp;<span class="ident" id="4506428">cleanClass</span><span class="op" id="4506438">(</span><span class="op" id="4506439">&amp;</span><span class="ident" id="4506440">re</span><span class="op" id="4506442">.</span><span class="ident" id="4506443">Rune</span><span class="op" id="4506447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506450">if</span>&nbsp;<span class="ident" id="4506453">sign</span>&nbsp;<span class="op" id="4506458">&lt;</span>&nbsp;<span class="num" id="4506460">0</span>&nbsp;<span class="op" id="4506462">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506466">class</span>&nbsp;<span class="op" id="4506472">=</span>&nbsp;<span class="ident" id="4506474">negateClass</span><span class="op" id="4506485">(</span><span class="ident" id="4506486">class</span><span class="op" id="4506491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506497">re</span><span class="op" id="4506499">.</span><span class="ident" id="4506500">Rune</span>&nbsp;<span class="op" id="4506505">=</span>&nbsp;<span class="ident" id="4506507">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506514">p</span><span class="op" id="4506515">.</span><span class="ident" id="4506516">push</span><span class="op" id="4506520">(</span><span class="ident" id="4506521">re</span><span class="op" id="4506523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506526">return</span>&nbsp;<span class="ident" id="4506533">t</span><span class="op" id="4506534">,</span>&nbsp;<span class="ident" id="4506536">nil</span><br>
<span class="lineno">1610</span><span class="op" id="4506540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4506543">//&nbsp;cleanClass&nbsp;sorts&nbsp;the&nbsp;ranges&nbsp;(pairs&nbsp;of&nbsp;elements&nbsp;of&nbsp;r),</span><br>
<span class="lineno"></span><span class="comment" id="4506600">//&nbsp;merges&nbsp;them,&nbsp;and&nbsp;eliminates&nbsp;duplicates.</span><br>
<span class="lineno"></span><span class="keyword" id="4506643">func</span>&nbsp;<span class="ident" id="4506648">cleanClass</span><span class="op" id="4506658">(</span><span class="ident" id="4506659">rp</span>&nbsp;<span class="op" id="4506662">*</span><span class="op" id="4506663">[</span><span class="op" id="4506664">]</span><span class="builtintype" id="4506665">rune</span><span class="op" id="4506669">)</span>&nbsp;<span class="op" id="4506671">[</span><span class="op" id="4506672">]</span><span class="builtintype" id="4506673">rune</span>&nbsp;<span class="op" id="4506678">{</span><br>
<span class="lineno">1615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4506682">//&nbsp;Sort&nbsp;by&nbsp;lo&nbsp;increasing,&nbsp;hi&nbsp;decreasing&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506738">sort</span><span class="op" id="4506742">.</span><span class="ident" id="4506743">Sort</span><span class="op" id="4506747">(</span><span class="ident" id="4506748">ranges</span><span class="op" id="4506754">{</span><span class="ident" id="4506755">rp</span><span class="op" id="4506757">}</span><span class="op" id="4506758">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506762">r</span>&nbsp;<span class="op" id="4506764">:=</span>&nbsp;<span class="op" id="4506767">*</span><span class="ident" id="4506768">rp</span><br>
<span class="lineno">1620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506772">if</span>&nbsp;<span class="builtinfunc" id="4506775">len</span><span class="op" id="4506778">(</span><span class="ident" id="4506779">r</span><span class="op" id="4506780">)</span>&nbsp;<span class="op" id="4506782">&lt;</span>&nbsp;<span class="num" id="4506784">2</span>&nbsp;<span class="op" id="4506786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506790">return</span>&nbsp;<span class="ident" id="4506797">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4506804">//&nbsp;Merge&nbsp;abutting,&nbsp;overlapping.</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506837">w</span>&nbsp;<span class="op" id="4506839">:=</span>&nbsp;<span class="num" id="4506842">2</span>&nbsp;<span class="comment" id="4506844">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506860">for</span>&nbsp;<span class="ident" id="4506864">i</span>&nbsp;<span class="op" id="4506866">:=</span>&nbsp;<span class="num" id="4506869">2</span><span class="op" id="4506870">;</span>&nbsp;<span class="ident" id="4506872">i</span>&nbsp;<span class="op" id="4506874">&lt;</span>&nbsp;<span class="builtinfunc" id="4506876">len</span><span class="op" id="4506879">(</span><span class="ident" id="4506880">r</span><span class="op" id="4506881">)</span><span class="op" id="4506882">;</span>&nbsp;<span class="ident" id="4506884">i</span>&nbsp;<span class="op" id="4506886">+=</span>&nbsp;<span class="num" id="4506889">2</span>&nbsp;<span class="op" id="4506891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506895">lo</span><span class="op" id="4506897">,</span>&nbsp;<span class="ident" id="4506899">hi</span>&nbsp;<span class="op" id="4506902">:=</span>&nbsp;<span class="ident" id="4506905">r</span><span class="op" id="4506906">[</span><span class="ident" id="4506907">i</span><span class="op" id="4506908">]</span><span class="op" id="4506909">,</span>&nbsp;<span class="ident" id="4506911">r</span><span class="op" id="4506912">[</span><span class="ident" id="4506913">i</span><span class="op" id="4506914">+</span><span class="num" id="4506915">1</span><span class="op" id="4506916">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506920">if</span>&nbsp;<span class="ident" id="4506923">lo</span>&nbsp;<span class="op" id="4506926">&lt;=</span>&nbsp;<span class="ident" id="4506929">r</span><span class="op" id="4506930">[</span><span class="ident" id="4506931">w</span><span class="op" id="4506932">-</span><span class="num" id="4506933">1</span><span class="op" id="4506934">]</span><span class="op" id="4506935">+</span><span class="num" id="4506936">1</span>&nbsp;<span class="op" id="4506938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4506943">//&nbsp;merge&nbsp;with&nbsp;previous&nbsp;range</span><br>
<span class="lineno">1630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506975">if</span>&nbsp;<span class="ident" id="4506978">hi</span>&nbsp;<span class="op" id="4506981">&gt;</span>&nbsp;<span class="ident" id="4506983">r</span><span class="op" id="4506984">[</span><span class="ident" id="4506985">w</span><span class="op" id="4506986">-</span><span class="num" id="4506987">1</span><span class="op" id="4506988">]</span>&nbsp;<span class="op" id="4506990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506996">r</span><span class="op" id="4506997">[</span><span class="ident" id="4506998">w</span><span class="op" id="4506999">-</span><span class="num" id="4507000">1</span><span class="op" id="4507001">]</span>&nbsp;<span class="op" id="4507003">=</span>&nbsp;<span class="ident" id="4507005">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4507011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507016">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4507027">}</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507031">//&nbsp;new&nbsp;disjoint&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507055">r</span><span class="op" id="4507056">[</span><span class="ident" id="4507057">w</span><span class="op" id="4507058">]</span>&nbsp;<span class="op" id="4507060">=</span>&nbsp;<span class="ident" id="4507062">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507067">r</span><span class="op" id="4507068">[</span><span class="ident" id="4507069">w</span><span class="op" id="4507070">+</span><span class="num" id="4507071">1</span><span class="op" id="4507072">]</span>&nbsp;<span class="op" id="4507074">=</span>&nbsp;<span class="ident" id="4507076">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507081">w</span>&nbsp;<span class="op" id="4507083">+=</span>&nbsp;<span class="num" id="4507086">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4507089">}</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507093">return</span>&nbsp;<span class="ident" id="4507100">r</span><span class="op" id="4507101">[</span><span class="op" id="4507102">:</span><span class="ident" id="4507103">w</span><span class="op" id="4507104">]</span><br>
<span class="lineno"></span><span class="op" id="4507106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4507109">//&nbsp;appendLiteral&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;literal&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1645</span><span class="keyword" id="4507188">func</span>&nbsp;<span class="ident" id="4507193">appendLiteral</span><span class="op" id="4507206">(</span><span class="ident" id="4507207">r</span>&nbsp;<span class="op" id="4507209">[</span><span class="op" id="4507210">]</span><span class="builtintype" id="4507211">rune</span><span class="op" id="4507215">,</span>&nbsp;<span class="ident" id="4507217">x</span>&nbsp;<span class="builtintype" id="4507219">rune</span><span class="op" id="4507223">,</span>&nbsp;<span class="ident" id="4507225">flags</span>&nbsp;<span class="ident" id="4507231">Flags</span><span class="op" id="4507236">)</span>&nbsp;<span class="op" id="4507238">[</span><span class="op" id="4507239">]</span><span class="builtintype" id="4507240">rune</span>&nbsp;<span class="op" id="4507245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507248">if</span>&nbsp;<span class="ident" id="4507251">flags</span><span class="op" id="4507256">&amp;</span><span class="ident" id="4507257">FoldCase</span>&nbsp;<span class="op" id="4507266">!=</span>&nbsp;<span class="num" id="4507269">0</span>&nbsp;<span class="op" id="4507271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507275">return</span>&nbsp;<span class="ident" id="4507282">appendFoldedRange</span><span class="op" id="4507299">(</span><span class="ident" id="4507300">r</span><span class="op" id="4507301">,</span>&nbsp;<span class="ident" id="4507303">x</span><span class="op" id="4507304">,</span>&nbsp;<span class="ident" id="4507306">x</span><span class="op" id="4507307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4507310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507313">return</span>&nbsp;<span class="ident" id="4507320">appendRange</span><span class="op" id="4507331">(</span><span class="ident" id="4507332">r</span><span class="op" id="4507333">,</span>&nbsp;<span class="ident" id="4507335">x</span><span class="op" id="4507336">,</span>&nbsp;<span class="ident" id="4507338">x</span><span class="op" id="4507339">)</span><br>
<span class="lineno">1650</span><span class="op" id="4507341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4507344">//&nbsp;appendRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="4507423">func</span>&nbsp;<span class="ident" id="4507428">appendRange</span><span class="op" id="4507439">(</span><span class="ident" id="4507440">r</span>&nbsp;<span class="op" id="4507442">[</span><span class="op" id="4507443">]</span><span class="builtintype" id="4507444">rune</span><span class="op" id="4507448">,</span>&nbsp;<span class="ident" id="4507450">lo</span><span class="op" id="4507452">,</span>&nbsp;<span class="ident" id="4507454">hi</span>&nbsp;<span class="builtintype" id="4507457">rune</span><span class="op" id="4507461">)</span>&nbsp;<span class="op" id="4507463">[</span><span class="op" id="4507464">]</span><span class="builtintype" id="4507465">rune</span>&nbsp;<span class="op" id="4507470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507473">//&nbsp;Expand&nbsp;last&nbsp;range&nbsp;or&nbsp;next&nbsp;to&nbsp;last&nbsp;range&nbsp;if&nbsp;it&nbsp;overlaps&nbsp;or&nbsp;abuts.</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507542">//&nbsp;Checking&nbsp;two&nbsp;ranges&nbsp;helps&nbsp;when&nbsp;appending&nbsp;case-folded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507599">//&nbsp;alphabets,&nbsp;so&nbsp;that&nbsp;one&nbsp;range&nbsp;can&nbsp;be&nbsp;expanding&nbsp;A-Z&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507661">//&nbsp;other&nbsp;expanding&nbsp;a-z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507686">n</span>&nbsp;<span class="op" id="4507688">:=</span>&nbsp;<span class="builtinfunc" id="4507691">len</span><span class="op" id="4507694">(</span><span class="ident" id="4507695">r</span><span class="op" id="4507696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507699">for</span>&nbsp;<span class="ident" id="4507703">i</span>&nbsp;<span class="op" id="4507705">:=</span>&nbsp;<span class="num" id="4507708">2</span><span class="op" id="4507709">;</span>&nbsp;<span class="ident" id="4507711">i</span>&nbsp;<span class="op" id="4507713">&lt;=</span>&nbsp;<span class="num" id="4507716">4</span><span class="op" id="4507717">;</span>&nbsp;<span class="ident" id="4507719">i</span>&nbsp;<span class="op" id="4507721">+=</span>&nbsp;<span class="num" id="4507724">2</span>&nbsp;<span class="op" id="4507726">{</span>&nbsp;<span class="comment" id="4507728">//&nbsp;twice,&nbsp;using&nbsp;i=2,&nbsp;i=4</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507755">if</span>&nbsp;<span class="ident" id="4507758">n</span>&nbsp;<span class="op" id="4507760">&gt;=</span>&nbsp;<span class="ident" id="4507763">i</span>&nbsp;<span class="op" id="4507765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507770">rlo</span><span class="op" id="4507773">,</span>&nbsp;<span class="ident" id="4507775">rhi</span>&nbsp;<span class="op" id="4507779">:=</span>&nbsp;<span class="ident" id="4507782">r</span><span class="op" id="4507783">[</span><span class="ident" id="4507784">n</span><span class="op" id="4507785">-</span><span class="ident" id="4507786">i</span><span class="op" id="4507787">]</span><span class="op" id="4507788">,</span>&nbsp;<span class="ident" id="4507790">r</span><span class="op" id="4507791">[</span><span class="ident" id="4507792">n</span><span class="op" id="4507793">-</span><span class="ident" id="4507794">i</span><span class="op" id="4507795">+</span><span class="num" id="4507796">1</span><span class="op" id="4507797">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507802">if</span>&nbsp;<span class="ident" id="4507805">lo</span>&nbsp;<span class="op" id="4507808">&lt;=</span>&nbsp;<span class="ident" id="4507811">rhi</span><span class="op" id="4507814">+</span><span class="num" id="4507815">1</span>&nbsp;<span class="op" id="4507817">&amp;&amp;</span>&nbsp;<span class="ident" id="4507820">rlo</span>&nbsp;<span class="op" id="4507824">&lt;=</span>&nbsp;<span class="ident" id="4507827">hi</span><span class="op" id="4507829">+</span><span class="num" id="4507830">1</span>&nbsp;<span class="op" id="4507832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507838">if</span>&nbsp;<span class="ident" id="4507841">lo</span>&nbsp;<span class="op" id="4507844">&lt;</span>&nbsp;<span class="ident" id="4507846">rlo</span>&nbsp;<span class="op" id="4507850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507857">r</span><span class="op" id="4507858">[</span><span class="ident" id="4507859">n</span><span class="op" id="4507860">-</span><span class="ident" id="4507861">i</span><span class="op" id="4507862">]</span>&nbsp;<span class="op" id="4507864">=</span>&nbsp;<span class="ident" id="4507866">lo</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4507873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507879">if</span>&nbsp;<span class="ident" id="4507882">hi</span>&nbsp;<span class="op" id="4507885">&gt;</span>&nbsp;<span class="ident" id="4507887">rhi</span>&nbsp;<span class="op" id="4507891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507898">r</span><span class="op" id="4507899">[</span><span class="ident" id="4507900">n</span><span class="op" id="4507901">-</span><span class="ident" id="4507902">i</span><span class="op" id="4507903">+</span><span class="num" id="4507904">1</span><span class="op" id="4507905">]</span>&nbsp;<span class="op" id="4507907">=</span>&nbsp;<span class="ident" id="4507909">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4507916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507922">return</span>&nbsp;<span class="ident" id="4507929">r</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4507934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4507938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4507941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507945">return</span>&nbsp;<span class="builtinfunc" id="4507952">append</span><span class="op" id="4507958">(</span><span class="ident" id="4507959">r</span><span class="op" id="4507960">,</span>&nbsp;<span class="ident" id="4507962">lo</span><span class="op" id="4507964">,</span>&nbsp;<span class="ident" id="4507966">hi</span><span class="op" id="4507968">)</span><br>
<span class="lineno">1675</span><span class="op" id="4507970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4507973">const</span>&nbsp;<span class="op" id="4507979">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507982">//&nbsp;minimum&nbsp;and&nbsp;maximum&nbsp;runes&nbsp;involved&nbsp;in&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4508033">//&nbsp;checked&nbsp;during&nbsp;test.</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508058">minFold</span>&nbsp;<span class="op" id="4508066">=</span>&nbsp;<span class="num" id="4508068">0x0041</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508076">maxFold</span>&nbsp;<span class="op" id="4508084">=</span>&nbsp;<span class="num" id="4508086">0x118df</span><br>
<span class="lineno"></span><span class="op" id="4508094">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4508097">//&nbsp;appendFoldedRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi</span><br>
<span class="lineno">1685</span><span class="comment" id="4508166">//&nbsp;and&nbsp;its&nbsp;case&nbsp;folding-equivalent&nbsp;runes&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="4508223">func</span>&nbsp;<span class="ident" id="4508228">appendFoldedRange</span><span class="op" id="4508245">(</span><span class="ident" id="4508246">r</span>&nbsp;<span class="op" id="4508248">[</span><span class="op" id="4508249">]</span><span class="builtintype" id="4508250">rune</span><span class="op" id="4508254">,</span>&nbsp;<span class="ident" id="4508256">lo</span><span class="op" id="4508258">,</span>&nbsp;<span class="ident" id="4508260">hi</span>&nbsp;<span class="builtintype" id="4508263">rune</span><span class="op" id="4508267">)</span>&nbsp;<span class="op" id="4508269">[</span><span class="op" id="4508270">]</span><span class="builtintype" id="4508271">rune</span>&nbsp;<span class="op" id="4508276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4508279">//&nbsp;Optimizations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508298">if</span>&nbsp;<span class="ident" id="4508301">lo</span>&nbsp;<span class="op" id="4508304">&lt;=</span>&nbsp;<span class="ident" id="4508307">minFold</span>&nbsp;<span class="op" id="4508315">&amp;&amp;</span>&nbsp;<span class="ident" id="4508318">hi</span>&nbsp;<span class="op" id="4508321">&gt;=</span>&nbsp;<span class="ident" id="4508324">maxFold</span>&nbsp;<span class="op" id="4508332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4508336">//&nbsp;Range&nbsp;is&nbsp;full:&nbsp;folding&nbsp;can&#39;t&nbsp;add&nbsp;more.</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508380">return</span>&nbsp;<span class="ident" id="4508387">appendRange</span><span class="op" id="4508398">(</span><span class="ident" id="4508399">r</span><span class="op" id="4508400">,</span>&nbsp;<span class="ident" id="4508402">lo</span><span class="op" id="4508404">,</span>&nbsp;<span class="ident" id="4508406">hi</span><span class="op" id="4508408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4508411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508414">if</span>&nbsp;<span class="ident" id="4508417">hi</span>&nbsp;<span class="op" id="4508420">&lt;</span>&nbsp;<span class="ident" id="4508422">minFold</span>&nbsp;<span class="op" id="4508430">||</span>&nbsp;<span class="ident" id="4508433">lo</span>&nbsp;<span class="op" id="4508436">&gt;</span>&nbsp;<span class="ident" id="4508438">maxFold</span>&nbsp;<span class="op" id="4508446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4508450">//&nbsp;Range&nbsp;is&nbsp;outside&nbsp;folding&nbsp;possibilities.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508495">return</span>&nbsp;<span class="ident" id="4508502">appendRange</span><span class="op" id="4508513">(</span><span class="ident" id="4508514">r</span><span class="op" id="4508515">,</span>&nbsp;<span class="ident" id="4508517">lo</span><span class="op" id="4508519">,</span>&nbsp;<span class="ident" id="4508521">hi</span><span class="op" id="4508523">)</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4508526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508529">if</span>&nbsp;<span class="ident" id="4508532">lo</span>&nbsp;<span class="op" id="4508535">&lt;</span>&nbsp;<span class="ident" id="4508537">minFold</span>&nbsp;<span class="op" id="4508545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4508549">//&nbsp;[lo,&nbsp;minFold-1]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508588">r</span>&nbsp;<span class="op" id="4508590">=</span>&nbsp;<span class="ident" id="4508592">appendRange</span><span class="op" id="4508603">(</span><span class="ident" id="4508604">r</span><span class="op" id="4508605">,</span>&nbsp;<span class="ident" id="4508607">lo</span><span class="op" id="4508609">,</span>&nbsp;<span class="ident" id="4508611">minFold</span><span class="op" id="4508618">-</span><span class="num" id="4508619">1</span><span class="op" id="4508620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508624">lo</span>&nbsp;<span class="op" id="4508627">=</span>&nbsp;<span class="ident" id="4508629">minFold</span><br>
<span class="lineno">1700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4508638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508641">if</span>&nbsp;<span class="ident" id="4508644">hi</span>&nbsp;<span class="op" id="4508647">&gt;</span>&nbsp;<span class="ident" id="4508649">maxFold</span>&nbsp;<span class="op" id="4508657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4508661">//&nbsp;[maxFold+1,&nbsp;hi]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508700">r</span>&nbsp;<span class="op" id="4508702">=</span>&nbsp;<span class="ident" id="4508704">appendRange</span><span class="op" id="4508715">(</span><span class="ident" id="4508716">r</span><span class="op" id="4508717">,</span>&nbsp;<span class="ident" id="4508719">maxFold</span><span class="op" id="4508726">+</span><span class="num" id="4508727">1</span><span class="op" id="4508728">,</span>&nbsp;<span class="ident" id="4508730">hi</span><span class="op" id="4508732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508736">hi</span>&nbsp;<span class="op" id="4508739">=</span>&nbsp;<span class="ident" id="4508741">maxFold</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4508750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4508754">//&nbsp;Brute&nbsp;force.&nbsp;&nbsp;Depend&nbsp;on&nbsp;appendRange&nbsp;to&nbsp;coalesce&nbsp;ranges&nbsp;on&nbsp;the&nbsp;fly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508825">for</span>&nbsp;<span class="ident" id="4508829">c</span>&nbsp;<span class="op" id="4508831">:=</span>&nbsp;<span class="ident" id="4508834">lo</span><span class="op" id="4508836">;</span>&nbsp;<span class="ident" id="4508838">c</span>&nbsp;<span class="op" id="4508840">&lt;=</span>&nbsp;<span class="ident" id="4508843">hi</span><span class="op" id="4508845">;</span>&nbsp;<span class="ident" id="4508847">c</span><span class="op" id="4508848">++</span>&nbsp;<span class="op" id="4508851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508855">r</span>&nbsp;<span class="op" id="4508857">=</span>&nbsp;<span class="ident" id="4508859">appendRange</span><span class="op" id="4508870">(</span><span class="ident" id="4508871">r</span><span class="op" id="4508872">,</span>&nbsp;<span class="ident" id="4508874">c</span><span class="op" id="4508875">,</span>&nbsp;<span class="ident" id="4508877">c</span><span class="op" id="4508878">)</span><br>
<span class="lineno">1710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508882">f</span>&nbsp;<span class="op" id="4508884">:=</span>&nbsp;<span class="ident" id="4508887">unicode</span><span class="op" id="4508894">.</span><span class="ident" id="4508895">SimpleFold</span><span class="op" id="4508905">(</span><span class="ident" id="4508906">c</span><span class="op" id="4508907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508911">for</span>&nbsp;<span class="ident" id="4508915">f</span>&nbsp;<span class="op" id="4508917">!=</span>&nbsp;<span class="ident" id="4508920">c</span>&nbsp;<span class="op" id="4508922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508927">r</span>&nbsp;<span class="op" id="4508929">=</span>&nbsp;<span class="ident" id="4508931">appendRange</span><span class="op" id="4508942">(</span><span class="ident" id="4508943">r</span><span class="op" id="4508944">,</span>&nbsp;<span class="ident" id="4508946">f</span><span class="op" id="4508947">,</span>&nbsp;<span class="ident" id="4508949">f</span><span class="op" id="4508950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508955">f</span>&nbsp;<span class="op" id="4508957">=</span>&nbsp;<span class="ident" id="4508959">unicode</span><span class="op" id="4508966">.</span><span class="ident" id="4508967">SimpleFold</span><span class="op" id="4508977">(</span><span class="ident" id="4508978">f</span><span class="op" id="4508979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4508983">}</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4508986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508989">return</span>&nbsp;<span class="ident" id="4508996">r</span><br>
<span class="lineno"></span><span class="op" id="4508998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4509001">//&nbsp;appendClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1720</span><span class="comment" id="4509076">//&nbsp;It&nbsp;assume&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="4509101">func</span>&nbsp;<span class="ident" id="4509106">appendClass</span><span class="op" id="4509117">(</span><span class="ident" id="4509118">r</span>&nbsp;<span class="op" id="4509120">[</span><span class="op" id="4509121">]</span><span class="builtintype" id="4509122">rune</span><span class="op" id="4509126">,</span>&nbsp;<span class="ident" id="4509128">x</span>&nbsp;<span class="op" id="4509130">[</span><span class="op" id="4509131">]</span><span class="builtintype" id="4509132">rune</span><span class="op" id="4509136">)</span>&nbsp;<span class="op" id="4509138">[</span><span class="op" id="4509139">]</span><span class="builtintype" id="4509140">rune</span>&nbsp;<span class="op" id="4509145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509148">for</span>&nbsp;<span class="ident" id="4509152">i</span>&nbsp;<span class="op" id="4509154">:=</span>&nbsp;<span class="num" id="4509157">0</span><span class="op" id="4509158">;</span>&nbsp;<span class="ident" id="4509160">i</span>&nbsp;<span class="op" id="4509162">&lt;</span>&nbsp;<span class="builtinfunc" id="4509164">len</span><span class="op" id="4509167">(</span><span class="ident" id="4509168">x</span><span class="op" id="4509169">)</span><span class="op" id="4509170">;</span>&nbsp;<span class="ident" id="4509172">i</span>&nbsp;<span class="op" id="4509174">+=</span>&nbsp;<span class="num" id="4509177">2</span>&nbsp;<span class="op" id="4509179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509183">r</span>&nbsp;<span class="op" id="4509185">=</span>&nbsp;<span class="ident" id="4509187">appendRange</span><span class="op" id="4509198">(</span><span class="ident" id="4509199">r</span><span class="op" id="4509200">,</span>&nbsp;<span class="ident" id="4509202">x</span><span class="op" id="4509203">[</span><span class="ident" id="4509204">i</span><span class="op" id="4509205">]</span><span class="op" id="4509206">,</span>&nbsp;<span class="ident" id="4509208">x</span><span class="op" id="4509209">[</span><span class="ident" id="4509210">i</span><span class="op" id="4509211">+</span><span class="num" id="4509212">1</span><span class="op" id="4509213">]</span><span class="op" id="4509214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4509217">}</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509220">return</span>&nbsp;<span class="ident" id="4509227">r</span><br>
<span class="lineno"></span><span class="op" id="4509229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4509232">//&nbsp;appendFolded&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;case&nbsp;folding&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="4509328">func</span>&nbsp;<span class="ident" id="4509333">appendFoldedClass</span><span class="op" id="4509350">(</span><span class="ident" id="4509351">r</span>&nbsp;<span class="op" id="4509353">[</span><span class="op" id="4509354">]</span><span class="builtintype" id="4509355">rune</span><span class="op" id="4509359">,</span>&nbsp;<span class="ident" id="4509361">x</span>&nbsp;<span class="op" id="4509363">[</span><span class="op" id="4509364">]</span><span class="builtintype" id="4509365">rune</span><span class="op" id="4509369">)</span>&nbsp;<span class="op" id="4509371">[</span><span class="op" id="4509372">]</span><span class="builtintype" id="4509373">rune</span>&nbsp;<span class="op" id="4509378">{</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509381">for</span>&nbsp;<span class="ident" id="4509385">i</span>&nbsp;<span class="op" id="4509387">:=</span>&nbsp;<span class="num" id="4509390">0</span><span class="op" id="4509391">;</span>&nbsp;<span class="ident" id="4509393">i</span>&nbsp;<span class="op" id="4509395">&lt;</span>&nbsp;<span class="builtinfunc" id="4509397">len</span><span class="op" id="4509400">(</span><span class="ident" id="4509401">x</span><span class="op" id="4509402">)</span><span class="op" id="4509403">;</span>&nbsp;<span class="ident" id="4509405">i</span>&nbsp;<span class="op" id="4509407">+=</span>&nbsp;<span class="num" id="4509410">2</span>&nbsp;<span class="op" id="4509412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509416">r</span>&nbsp;<span class="op" id="4509418">=</span>&nbsp;<span class="ident" id="4509420">appendFoldedRange</span><span class="op" id="4509437">(</span><span class="ident" id="4509438">r</span><span class="op" id="4509439">,</span>&nbsp;<span class="ident" id="4509441">x</span><span class="op" id="4509442">[</span><span class="ident" id="4509443">i</span><span class="op" id="4509444">]</span><span class="op" id="4509445">,</span>&nbsp;<span class="ident" id="4509447">x</span><span class="op" id="4509448">[</span><span class="ident" id="4509449">i</span><span class="op" id="4509450">+</span><span class="num" id="4509451">1</span><span class="op" id="4509452">]</span><span class="op" id="4509453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4509456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509459">return</span>&nbsp;<span class="ident" id="4509466">r</span><br>
<span class="lineno"></span><span class="op" id="4509468">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span><span class="comment" id="4509471">//&nbsp;appendNegatedClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4509569">//&nbsp;It&nbsp;assumes&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="4509595">func</span>&nbsp;<span class="ident" id="4509600">appendNegatedClass</span><span class="op" id="4509618">(</span><span class="ident" id="4509619">r</span>&nbsp;<span class="op" id="4509621">[</span><span class="op" id="4509622">]</span><span class="builtintype" id="4509623">rune</span><span class="op" id="4509627">,</span>&nbsp;<span class="ident" id="4509629">x</span>&nbsp;<span class="op" id="4509631">[</span><span class="op" id="4509632">]</span><span class="builtintype" id="4509633">rune</span><span class="op" id="4509637">)</span>&nbsp;<span class="op" id="4509639">[</span><span class="op" id="4509640">]</span><span class="builtintype" id="4509641">rune</span>&nbsp;<span class="op" id="4509646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509649">nextLo</span>&nbsp;<span class="op" id="4509656">:=</span>&nbsp;<span class="string" id="4509659">&#39;\u0000&#39;</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509669">for</span>&nbsp;<span class="ident" id="4509673">i</span>&nbsp;<span class="op" id="4509675">:=</span>&nbsp;<span class="num" id="4509678">0</span><span class="op" id="4509679">;</span>&nbsp;<span class="ident" id="4509681">i</span>&nbsp;<span class="op" id="4509683">&lt;</span>&nbsp;<span class="builtinfunc" id="4509685">len</span><span class="op" id="4509688">(</span><span class="ident" id="4509689">x</span><span class="op" id="4509690">)</span><span class="op" id="4509691">;</span>&nbsp;<span class="ident" id="4509693">i</span>&nbsp;<span class="op" id="4509695">+=</span>&nbsp;<span class="num" id="4509698">2</span>&nbsp;<span class="op" id="4509700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509704">lo</span><span class="op" id="4509706">,</span>&nbsp;<span class="ident" id="4509708">hi</span>&nbsp;<span class="op" id="4509711">:=</span>&nbsp;<span class="ident" id="4509714">x</span><span class="op" id="4509715">[</span><span class="ident" id="4509716">i</span><span class="op" id="4509717">]</span><span class="op" id="4509718">,</span>&nbsp;<span class="ident" id="4509720">x</span><span class="op" id="4509721">[</span><span class="ident" id="4509722">i</span><span class="op" id="4509723">+</span><span class="num" id="4509724">1</span><span class="op" id="4509725">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509729">if</span>&nbsp;<span class="ident" id="4509732">nextLo</span>&nbsp;<span class="op" id="4509739">&lt;=</span>&nbsp;<span class="ident" id="4509742">lo</span><span class="op" id="4509744">-</span><span class="num" id="4509745">1</span>&nbsp;<span class="op" id="4509747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509752">r</span>&nbsp;<span class="op" id="4509754">=</span>&nbsp;<span class="ident" id="4509756">appendRange</span><span class="op" id="4509767">(</span><span class="ident" id="4509768">r</span><span class="op" id="4509769">,</span>&nbsp;<span class="ident" id="4509771">nextLo</span><span class="op" id="4509777">,</span>&nbsp;<span class="ident" id="4509779">lo</span><span class="op" id="4509781">-</span><span class="num" id="4509782">1</span><span class="op" id="4509783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4509787">}</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509791">nextLo</span>&nbsp;<span class="op" id="4509798">=</span>&nbsp;<span class="ident" id="4509800">hi</span>&nbsp;<span class="op" id="4509803">+</span>&nbsp;<span class="num" id="4509805">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4509808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509811">if</span>&nbsp;<span class="ident" id="4509814">nextLo</span>&nbsp;<span class="op" id="4509821">&lt;=</span>&nbsp;<span class="ident" id="4509824">unicode</span><span class="op" id="4509831">.</span><span class="ident" id="4509832">MaxRune</span>&nbsp;<span class="op" id="4509840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509844">r</span>&nbsp;<span class="op" id="4509846">=</span>&nbsp;<span class="ident" id="4509848">appendRange</span><span class="op" id="4509859">(</span><span class="ident" id="4509860">r</span><span class="op" id="4509861">,</span>&nbsp;<span class="ident" id="4509863">nextLo</span><span class="op" id="4509869">,</span>&nbsp;<span class="ident" id="4509871">unicode</span><span class="op" id="4509878">.</span><span class="ident" id="4509879">MaxRune</span><span class="op" id="4509886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4509889">}</span><br>
<span class="lineno">1750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509892">return</span>&nbsp;<span class="ident" id="4509899">r</span><br>
<span class="lineno"></span><span class="op" id="4509901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4509904">//&nbsp;appendTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="4509969">func</span>&nbsp;<span class="ident" id="4509974">appendTable</span><span class="op" id="4509985">(</span><span class="ident" id="4509986">r</span>&nbsp;<span class="op" id="4509988">[</span><span class="op" id="4509989">]</span><span class="builtintype" id="4509990">rune</span><span class="op" id="4509994">,</span>&nbsp;<span class="ident" id="4509996">x</span>&nbsp;<span class="op" id="4509998">*</span><span class="ident" id="4509999">unicode</span><span class="op" id="4510006">.</span><span class="ident" id="4510007">RangeTable</span><span class="op" id="4510017">)</span>&nbsp;<span class="op" id="4510019">[</span><span class="op" id="4510020">]</span><span class="builtintype" id="4510021">rune</span>&nbsp;<span class="op" id="4510026">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510029">for</span>&nbsp;<span class="ident" id="4510033">_</span><span class="op" id="4510034">,</span>&nbsp;<span class="ident" id="4510036">xr</span>&nbsp;<span class="op" id="4510039">:=</span>&nbsp;<span class="keyword" id="4510042">range</span>&nbsp;<span class="ident" id="4510048">x</span><span class="op" id="4510049">.</span><span class="ident" id="4510050">R16</span>&nbsp;<span class="op" id="4510054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510058">lo</span><span class="op" id="4510060">,</span>&nbsp;<span class="ident" id="4510062">hi</span><span class="op" id="4510064">,</span>&nbsp;<span class="ident" id="4510066">stride</span>&nbsp;<span class="op" id="4510073">:=</span>&nbsp;<span class="builtintype" id="4510076">rune</span><span class="op" id="4510080">(</span><span class="ident" id="4510081">xr</span><span class="op" id="4510083">.</span><span class="ident" id="4510084">Lo</span><span class="op" id="4510086">)</span><span class="op" id="4510087">,</span>&nbsp;<span class="builtintype" id="4510089">rune</span><span class="op" id="4510093">(</span><span class="ident" id="4510094">xr</span><span class="op" id="4510096">.</span><span class="ident" id="4510097">Hi</span><span class="op" id="4510099">)</span><span class="op" id="4510100">,</span>&nbsp;<span class="builtintype" id="4510102">rune</span><span class="op" id="4510106">(</span><span class="ident" id="4510107">xr</span><span class="op" id="4510109">.</span><span class="ident" id="4510110">Stride</span><span class="op" id="4510116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510120">if</span>&nbsp;<span class="ident" id="4510123">stride</span>&nbsp;<span class="op" id="4510130">==</span>&nbsp;<span class="num" id="4510133">1</span>&nbsp;<span class="op" id="4510135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510140">r</span>&nbsp;<span class="op" id="4510142">=</span>&nbsp;<span class="ident" id="4510144">appendRange</span><span class="op" id="4510155">(</span><span class="ident" id="4510156">r</span><span class="op" id="4510157">,</span>&nbsp;<span class="ident" id="4510159">lo</span><span class="op" id="4510161">,</span>&nbsp;<span class="ident" id="4510163">hi</span><span class="op" id="4510165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510170">continue</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510185">for</span>&nbsp;<span class="ident" id="4510189">c</span>&nbsp;<span class="op" id="4510191">:=</span>&nbsp;<span class="ident" id="4510194">lo</span><span class="op" id="4510196">;</span>&nbsp;<span class="ident" id="4510198">c</span>&nbsp;<span class="op" id="4510200">&lt;=</span>&nbsp;<span class="ident" id="4510203">hi</span><span class="op" id="4510205">;</span>&nbsp;<span class="ident" id="4510207">c</span>&nbsp;<span class="op" id="4510209">+=</span>&nbsp;<span class="ident" id="4510212">stride</span>&nbsp;<span class="op" id="4510219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510224">r</span>&nbsp;<span class="op" id="4510226">=</span>&nbsp;<span class="ident" id="4510228">appendRange</span><span class="op" id="4510239">(</span><span class="ident" id="4510240">r</span><span class="op" id="4510241">,</span>&nbsp;<span class="ident" id="4510243">c</span><span class="op" id="4510244">,</span>&nbsp;<span class="ident" id="4510246">c</span><span class="op" id="4510247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510254">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510257">for</span>&nbsp;<span class="ident" id="4510261">_</span><span class="op" id="4510262">,</span>&nbsp;<span class="ident" id="4510264">xr</span>&nbsp;<span class="op" id="4510267">:=</span>&nbsp;<span class="keyword" id="4510270">range</span>&nbsp;<span class="ident" id="4510276">x</span><span class="op" id="4510277">.</span><span class="ident" id="4510278">R32</span>&nbsp;<span class="op" id="4510282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510286">lo</span><span class="op" id="4510288">,</span>&nbsp;<span class="ident" id="4510290">hi</span><span class="op" id="4510292">,</span>&nbsp;<span class="ident" id="4510294">stride</span>&nbsp;<span class="op" id="4510301">:=</span>&nbsp;<span class="builtintype" id="4510304">rune</span><span class="op" id="4510308">(</span><span class="ident" id="4510309">xr</span><span class="op" id="4510311">.</span><span class="ident" id="4510312">Lo</span><span class="op" id="4510314">)</span><span class="op" id="4510315">,</span>&nbsp;<span class="builtintype" id="4510317">rune</span><span class="op" id="4510321">(</span><span class="ident" id="4510322">xr</span><span class="op" id="4510324">.</span><span class="ident" id="4510325">Hi</span><span class="op" id="4510327">)</span><span class="op" id="4510328">,</span>&nbsp;<span class="builtintype" id="4510330">rune</span><span class="op" id="4510334">(</span><span class="ident" id="4510335">xr</span><span class="op" id="4510337">.</span><span class="ident" id="4510338">Stride</span><span class="op" id="4510344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510348">if</span>&nbsp;<span class="ident" id="4510351">stride</span>&nbsp;<span class="op" id="4510358">==</span>&nbsp;<span class="num" id="4510361">1</span>&nbsp;<span class="op" id="4510363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510368">r</span>&nbsp;<span class="op" id="4510370">=</span>&nbsp;<span class="ident" id="4510372">appendRange</span><span class="op" id="4510383">(</span><span class="ident" id="4510384">r</span><span class="op" id="4510385">,</span>&nbsp;<span class="ident" id="4510387">lo</span><span class="op" id="4510389">,</span>&nbsp;<span class="ident" id="4510391">hi</span><span class="op" id="4510393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510398">continue</span><br>
<span class="lineno">1770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510413">for</span>&nbsp;<span class="ident" id="4510417">c</span>&nbsp;<span class="op" id="4510419">:=</span>&nbsp;<span class="ident" id="4510422">lo</span><span class="op" id="4510424">;</span>&nbsp;<span class="ident" id="4510426">c</span>&nbsp;<span class="op" id="4510428">&lt;=</span>&nbsp;<span class="ident" id="4510431">hi</span><span class="op" id="4510433">;</span>&nbsp;<span class="ident" id="4510435">c</span>&nbsp;<span class="op" id="4510437">+=</span>&nbsp;<span class="ident" id="4510440">stride</span>&nbsp;<span class="op" id="4510447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510452">r</span>&nbsp;<span class="op" id="4510454">=</span>&nbsp;<span class="ident" id="4510456">appendRange</span><span class="op" id="4510467">(</span><span class="ident" id="4510468">r</span><span class="op" id="4510469">,</span>&nbsp;<span class="ident" id="4510471">c</span><span class="op" id="4510472">,</span>&nbsp;<span class="ident" id="4510474">c</span><span class="op" id="4510475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510482">}</span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510485">return</span>&nbsp;<span class="ident" id="4510492">r</span><br>
<span class="lineno"></span><span class="op" id="4510494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4510497">//&nbsp;appendNegatedTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="4510585">func</span>&nbsp;<span class="ident" id="4510590">appendNegatedTable</span><span class="op" id="4510608">(</span><span class="ident" id="4510609">r</span>&nbsp;<span class="op" id="4510611">[</span><span class="op" id="4510612">]</span><span class="builtintype" id="4510613">rune</span><span class="op" id="4510617">,</span>&nbsp;<span class="ident" id="4510619">x</span>&nbsp;<span class="op" id="4510621">*</span><span class="ident" id="4510622">unicode</span><span class="op" id="4510629">.</span><span class="ident" id="4510630">RangeTable</span><span class="op" id="4510640">)</span>&nbsp;<span class="op" id="4510642">[</span><span class="op" id="4510643">]</span><span class="builtintype" id="4510644">rune</span>&nbsp;<span class="op" id="4510649">{</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510652">nextLo</span>&nbsp;<span class="op" id="4510659">:=</span>&nbsp;<span class="string" id="4510662">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="4510671">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510703">for</span>&nbsp;<span class="ident" id="4510707">_</span><span class="op" id="4510708">,</span>&nbsp;<span class="ident" id="4510710">xr</span>&nbsp;<span class="op" id="4510713">:=</span>&nbsp;<span class="keyword" id="4510716">range</span>&nbsp;<span class="ident" id="4510722">x</span><span class="op" id="4510723">.</span><span class="ident" id="4510724">R16</span>&nbsp;<span class="op" id="4510728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510732">lo</span><span class="op" id="4510734">,</span>&nbsp;<span class="ident" id="4510736">hi</span><span class="op" id="4510738">,</span>&nbsp;<span class="ident" id="4510740">stride</span>&nbsp;<span class="op" id="4510747">:=</span>&nbsp;<span class="builtintype" id="4510750">rune</span><span class="op" id="4510754">(</span><span class="ident" id="4510755">xr</span><span class="op" id="4510757">.</span><span class="ident" id="4510758">Lo</span><span class="op" id="4510760">)</span><span class="op" id="4510761">,</span>&nbsp;<span class="builtintype" id="4510763">rune</span><span class="op" id="4510767">(</span><span class="ident" id="4510768">xr</span><span class="op" id="4510770">.</span><span class="ident" id="4510771">Hi</span><span class="op" id="4510773">)</span><span class="op" id="4510774">,</span>&nbsp;<span class="builtintype" id="4510776">rune</span><span class="op" id="4510780">(</span><span class="ident" id="4510781">xr</span><span class="op" id="4510783">.</span><span class="ident" id="4510784">Stride</span><span class="op" id="4510790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510794">if</span>&nbsp;<span class="ident" id="4510797">stride</span>&nbsp;<span class="op" id="4510804">==</span>&nbsp;<span class="num" id="4510807">1</span>&nbsp;<span class="op" id="4510809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510814">if</span>&nbsp;<span class="ident" id="4510817">nextLo</span>&nbsp;<span class="op" id="4510824">&lt;=</span>&nbsp;<span class="ident" id="4510827">lo</span><span class="op" id="4510829">-</span><span class="num" id="4510830">1</span>&nbsp;<span class="op" id="4510832">{</span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510838">r</span>&nbsp;<span class="op" id="4510840">=</span>&nbsp;<span class="ident" id="4510842">appendRange</span><span class="op" id="4510853">(</span><span class="ident" id="4510854">r</span><span class="op" id="4510855">,</span>&nbsp;<span class="ident" id="4510857">nextLo</span><span class="op" id="4510863">,</span>&nbsp;<span class="ident" id="4510865">lo</span><span class="op" id="4510867">-</span><span class="num" id="4510868">1</span><span class="op" id="4510869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510879">nextLo</span>&nbsp;<span class="op" id="4510886">=</span>&nbsp;<span class="ident" id="4510888">hi</span>&nbsp;<span class="op" id="4510891">+</span>&nbsp;<span class="num" id="4510893">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510898">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510909">}</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510913">for</span>&nbsp;<span class="ident" id="4510917">c</span>&nbsp;<span class="op" id="4510919">:=</span>&nbsp;<span class="ident" id="4510922">lo</span><span class="op" id="4510924">;</span>&nbsp;<span class="ident" id="4510926">c</span>&nbsp;<span class="op" id="4510928">&lt;=</span>&nbsp;<span class="ident" id="4510931">hi</span><span class="op" id="4510933">;</span>&nbsp;<span class="ident" id="4510935">c</span>&nbsp;<span class="op" id="4510937">+=</span>&nbsp;<span class="ident" id="4510940">stride</span>&nbsp;<span class="op" id="4510947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510952">if</span>&nbsp;<span class="ident" id="4510955">nextLo</span>&nbsp;<span class="op" id="4510962">&lt;=</span>&nbsp;<span class="ident" id="4510965">c</span><span class="op" id="4510966">-</span><span class="num" id="4510967">1</span>&nbsp;<span class="op" id="4510969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510975">r</span>&nbsp;<span class="op" id="4510977">=</span>&nbsp;<span class="ident" id="4510979">appendRange</span><span class="op" id="4510990">(</span><span class="ident" id="4510991">r</span><span class="op" id="4510992">,</span>&nbsp;<span class="ident" id="4510994">nextLo</span><span class="op" id="4511000">,</span>&nbsp;<span class="ident" id="4511002">c</span><span class="op" id="4511003">-</span><span class="num" id="4511004">1</span><span class="op" id="4511005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511015">nextLo</span>&nbsp;<span class="op" id="4511022">=</span>&nbsp;<span class="ident" id="4511024">c</span>&nbsp;<span class="op" id="4511026">+</span>&nbsp;<span class="num" id="4511028">1</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511038">for</span>&nbsp;<span class="ident" id="4511042">_</span><span class="op" id="4511043">,</span>&nbsp;<span class="ident" id="4511045">xr</span>&nbsp;<span class="op" id="4511048">:=</span>&nbsp;<span class="keyword" id="4511051">range</span>&nbsp;<span class="ident" id="4511057">x</span><span class="op" id="4511058">.</span><span class="ident" id="4511059">R32</span>&nbsp;<span class="op" id="4511063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511067">lo</span><span class="op" id="4511069">,</span>&nbsp;<span class="ident" id="4511071">hi</span><span class="op" id="4511073">,</span>&nbsp;<span class="ident" id="4511075">stride</span>&nbsp;<span class="op" id="4511082">:=</span>&nbsp;<span class="builtintype" id="4511085">rune</span><span class="op" id="4511089">(</span><span class="ident" id="4511090">xr</span><span class="op" id="4511092">.</span><span class="ident" id="4511093">Lo</span><span class="op" id="4511095">)</span><span class="op" id="4511096">,</span>&nbsp;<span class="builtintype" id="4511098">rune</span><span class="op" id="4511102">(</span><span class="ident" id="4511103">xr</span><span class="op" id="4511105">.</span><span class="ident" id="4511106">Hi</span><span class="op" id="4511108">)</span><span class="op" id="4511109">,</span>&nbsp;<span class="builtintype" id="4511111">rune</span><span class="op" id="4511115">(</span><span class="ident" id="4511116">xr</span><span class="op" id="4511118">.</span><span class="ident" id="4511119">Stride</span><span class="op" id="4511125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511129">if</span>&nbsp;<span class="ident" id="4511132">stride</span>&nbsp;<span class="op" id="4511139">==</span>&nbsp;<span class="num" id="4511142">1</span>&nbsp;<span class="op" id="4511144">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511149">if</span>&nbsp;<span class="ident" id="4511152">nextLo</span>&nbsp;<span class="op" id="4511159">&lt;=</span>&nbsp;<span class="ident" id="4511162">lo</span><span class="op" id="4511164">-</span><span class="num" id="4511165">1</span>&nbsp;<span class="op" id="4511167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511173">r</span>&nbsp;<span class="op" id="4511175">=</span>&nbsp;<span class="ident" id="4511177">appendRange</span><span class="op" id="4511188">(</span><span class="ident" id="4511189">r</span><span class="op" id="4511190">,</span>&nbsp;<span class="ident" id="4511192">nextLo</span><span class="op" id="4511198">,</span>&nbsp;<span class="ident" id="4511200">lo</span><span class="op" id="4511202">-</span><span class="num" id="4511203">1</span><span class="op" id="4511204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511214">nextLo</span>&nbsp;<span class="op" id="4511221">=</span>&nbsp;<span class="ident" id="4511223">hi</span>&nbsp;<span class="op" id="4511226">+</span>&nbsp;<span class="num" id="4511228">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511233">continue</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511248">for</span>&nbsp;<span class="ident" id="4511252">c</span>&nbsp;<span class="op" id="4511254">:=</span>&nbsp;<span class="ident" id="4511257">lo</span><span class="op" id="4511259">;</span>&nbsp;<span class="ident" id="4511261">c</span>&nbsp;<span class="op" id="4511263">&lt;=</span>&nbsp;<span class="ident" id="4511266">hi</span><span class="op" id="4511268">;</span>&nbsp;<span class="ident" id="4511270">c</span>&nbsp;<span class="op" id="4511272">+=</span>&nbsp;<span class="ident" id="4511275">stride</span>&nbsp;<span class="op" id="4511282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511287">if</span>&nbsp;<span class="ident" id="4511290">nextLo</span>&nbsp;<span class="op" id="4511297">&lt;=</span>&nbsp;<span class="ident" id="4511300">c</span><span class="op" id="4511301">-</span><span class="num" id="4511302">1</span>&nbsp;<span class="op" id="4511304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511310">r</span>&nbsp;<span class="op" id="4511312">=</span>&nbsp;<span class="ident" id="4511314">appendRange</span><span class="op" id="4511325">(</span><span class="ident" id="4511326">r</span><span class="op" id="4511327">,</span>&nbsp;<span class="ident" id="4511329">nextLo</span><span class="op" id="4511335">,</span>&nbsp;<span class="ident" id="4511337">c</span><span class="op" id="4511338">-</span><span class="num" id="4511339">1</span><span class="op" id="4511340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511345">}</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511350">nextLo</span>&nbsp;<span class="op" id="4511357">=</span>&nbsp;<span class="ident" id="4511359">c</span>&nbsp;<span class="op" id="4511361">+</span>&nbsp;<span class="num" id="4511363">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511373">if</span>&nbsp;<span class="ident" id="4511376">nextLo</span>&nbsp;<span class="op" id="4511383">&lt;=</span>&nbsp;<span class="ident" id="4511386">unicode</span><span class="op" id="4511393">.</span><span class="ident" id="4511394">MaxRune</span>&nbsp;<span class="op" id="4511402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511406">r</span>&nbsp;<span class="op" id="4511408">=</span>&nbsp;<span class="ident" id="4511410">appendRange</span><span class="op" id="4511421">(</span><span class="ident" id="4511422">r</span><span class="op" id="4511423">,</span>&nbsp;<span class="ident" id="4511425">nextLo</span><span class="op" id="4511431">,</span>&nbsp;<span class="ident" id="4511433">unicode</span><span class="op" id="4511440">.</span><span class="ident" id="4511441">MaxRune</span><span class="op" id="4511448">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511454">return</span>&nbsp;<span class="ident" id="4511461">r</span><br>
<span class="lineno"></span><span class="op" id="4511463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4511466">//&nbsp;negateClass&nbsp;overwrites&nbsp;r&nbsp;and&nbsp;returns&nbsp;r&#39;s&nbsp;negation.</span><br>
<span class="lineno">1820</span><span class="comment" id="4511520">//&nbsp;It&nbsp;assumes&nbsp;the&nbsp;class&nbsp;r&nbsp;is&nbsp;already&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="4511564">func</span>&nbsp;<span class="ident" id="4511569">negateClass</span><span class="op" id="4511580">(</span><span class="ident" id="4511581">r</span>&nbsp;<span class="op" id="4511583">[</span><span class="op" id="4511584">]</span><span class="builtintype" id="4511585">rune</span><span class="op" id="4511589">)</span>&nbsp;<span class="op" id="4511591">[</span><span class="op" id="4511592">]</span><span class="builtintype" id="4511593">rune</span>&nbsp;<span class="op" id="4511598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511601">nextLo</span>&nbsp;<span class="op" id="4511608">:=</span>&nbsp;<span class="string" id="4511611">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="4511620">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511652">w</span>&nbsp;<span class="op" id="4511654">:=</span>&nbsp;<span class="num" id="4511657">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4511671">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511687">for</span>&nbsp;<span class="ident" id="4511691">i</span>&nbsp;<span class="op" id="4511693">:=</span>&nbsp;<span class="num" id="4511696">0</span><span class="op" id="4511697">;</span>&nbsp;<span class="ident" id="4511699">i</span>&nbsp;<span class="op" id="4511701">&lt;</span>&nbsp;<span class="builtinfunc" id="4511703">len</span><span class="op" id="4511706">(</span><span class="ident" id="4511707">r</span><span class="op" id="4511708">)</span><span class="op" id="4511709">;</span>&nbsp;<span class="ident" id="4511711">i</span>&nbsp;<span class="op" id="4511713">+=</span>&nbsp;<span class="num" id="4511716">2</span>&nbsp;<span class="op" id="4511718">{</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511722">lo</span><span class="op" id="4511724">,</span>&nbsp;<span class="ident" id="4511726">hi</span>&nbsp;<span class="op" id="4511729">:=</span>&nbsp;<span class="ident" id="4511732">r</span><span class="op" id="4511733">[</span><span class="ident" id="4511734">i</span><span class="op" id="4511735">]</span><span class="op" id="4511736">,</span>&nbsp;<span class="ident" id="4511738">r</span><span class="op" id="4511739">[</span><span class="ident" id="4511740">i</span><span class="op" id="4511741">+</span><span class="num" id="4511742">1</span><span class="op" id="4511743">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511747">if</span>&nbsp;<span class="ident" id="4511750">nextLo</span>&nbsp;<span class="op" id="4511757">&lt;=</span>&nbsp;<span class="ident" id="4511760">lo</span><span class="op" id="4511762">-</span><span class="num" id="4511763">1</span>&nbsp;<span class="op" id="4511765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511770">r</span><span class="op" id="4511771">[</span><span class="ident" id="4511772">w</span><span class="op" id="4511773">]</span>&nbsp;<span class="op" id="4511775">=</span>&nbsp;<span class="ident" id="4511777">nextLo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511787">r</span><span class="op" id="4511788">[</span><span class="ident" id="4511789">w</span><span class="op" id="4511790">+</span><span class="num" id="4511791">1</span><span class="op" id="4511792">]</span>&nbsp;<span class="op" id="4511794">=</span>&nbsp;<span class="ident" id="4511796">lo</span>&nbsp;<span class="op" id="4511799">-</span>&nbsp;<span class="num" id="4511801">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511806">w</span>&nbsp;<span class="op" id="4511808">+=</span>&nbsp;<span class="num" id="4511811">2</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511819">nextLo</span>&nbsp;<span class="op" id="4511826">=</span>&nbsp;<span class="ident" id="4511828">hi</span>&nbsp;<span class="op" id="4511831">+</span>&nbsp;<span class="num" id="4511833">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511839">r</span>&nbsp;<span class="op" id="4511841">=</span>&nbsp;<span class="ident" id="4511843">r</span><span class="op" id="4511844">[</span><span class="op" id="4511845">:</span><span class="ident" id="4511846">w</span><span class="op" id="4511847">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511850">if</span>&nbsp;<span class="ident" id="4511853">nextLo</span>&nbsp;<span class="op" id="4511860">&lt;=</span>&nbsp;<span class="ident" id="4511863">unicode</span><span class="op" id="4511870">.</span><span class="ident" id="4511871">MaxRune</span>&nbsp;<span class="op" id="4511879">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511883">//&nbsp;It&#39;s&nbsp;possible&nbsp;for&nbsp;the&nbsp;negation&nbsp;to&nbsp;have&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511936">//&nbsp;range&nbsp;-&nbsp;this&nbsp;one&nbsp;-&nbsp;than&nbsp;the&nbsp;original&nbsp;class,&nbsp;so&nbsp;use&nbsp;append.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512000">r</span>&nbsp;<span class="op" id="4512002">=</span>&nbsp;<span class="builtinfunc" id="4512004">append</span><span class="op" id="4512010">(</span><span class="ident" id="4512011">r</span><span class="op" id="4512012">,</span>&nbsp;<span class="ident" id="4512014">nextLo</span><span class="op" id="4512020">,</span>&nbsp;<span class="ident" id="4512022">unicode</span><span class="op" id="4512029">.</span><span class="ident" id="4512030">MaxRune</span><span class="op" id="4512037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4512040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512043">return</span>&nbsp;<span class="ident" id="4512050">r</span><br>
<span class="lineno">1840</span><span class="op" id="4512052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4512055">//&nbsp;ranges&nbsp;implements&nbsp;sort.Interface&nbsp;on&nbsp;a&nbsp;[]rune.</span><br>
<span class="lineno"></span><span class="comment" id="4512104">//&nbsp;The&nbsp;choice&nbsp;of&nbsp;receiver&nbsp;type&nbsp;definition&nbsp;is&nbsp;strange</span><br>
<span class="lineno"></span><span class="comment" id="4512157">//&nbsp;but&nbsp;avoids&nbsp;an&nbsp;allocation&nbsp;since&nbsp;we&nbsp;already&nbsp;have</span><br>
<span class="lineno">1845</span><span class="comment" id="4512207">//&nbsp;a&nbsp;*[]rune.</span><br>
<span class="lineno"></span><span class="keyword" id="4512221">type</span>&nbsp;<span class="ident" id="4512226">ranges</span>&nbsp;<span class="keyword" id="4512233">struct</span>&nbsp;<span class="op" id="4512240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512243">p</span>&nbsp;<span class="op" id="4512245">*</span><span class="op" id="4512246">[</span><span class="op" id="4512247">]</span><span class="builtintype" id="4512248">rune</span><br>
<span class="lineno"></span><span class="op" id="4512253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1850</span><span class="keyword" id="4512256">func</span>&nbsp;<span class="op" id="4512261">(</span><span class="ident" id="4512262">ra</span>&nbsp;<span class="ident" id="4512265">ranges</span><span class="op" id="4512271">)</span>&nbsp;<span class="ident" id="4512273">Less</span><span class="op" id="4512277">(</span><span class="ident" id="4512278">i</span><span class="op" id="4512279">,</span>&nbsp;<span class="ident" id="4512281">j</span>&nbsp;<span class="builtintype" id="4512283">int</span><span class="op" id="4512286">)</span>&nbsp;<span class="builtintype" id="4512288">bool</span>&nbsp;<span class="op" id="4512293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512296">p</span>&nbsp;<span class="op" id="4512298">:=</span>&nbsp;<span class="op" id="4512301">*</span><span class="ident" id="4512302">ra</span><span class="op" id="4512304">.</span><span class="ident" id="4512305">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512308">i</span>&nbsp;<span class="op" id="4512310">*=</span>&nbsp;<span class="num" id="4512313">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512316">j</span>&nbsp;<span class="op" id="4512318">*=</span>&nbsp;<span class="num" id="4512321">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512324">return</span>&nbsp;<span class="ident" id="4512331">p</span><span class="op" id="4512332">[</span><span class="ident" id="4512333">i</span><span class="op" id="4512334">]</span>&nbsp;<span class="op" id="4512336">&lt;</span>&nbsp;<span class="ident" id="4512338">p</span><span class="op" id="4512339">[</span><span class="ident" id="4512340">j</span><span class="op" id="4512341">]</span>&nbsp;<span class="op" id="4512343">||</span>&nbsp;<span class="ident" id="4512346">p</span><span class="op" id="4512347">[</span><span class="ident" id="4512348">i</span><span class="op" id="4512349">]</span>&nbsp;<span class="op" id="4512351">==</span>&nbsp;<span class="ident" id="4512354">p</span><span class="op" id="4512355">[</span><span class="ident" id="4512356">j</span><span class="op" id="4512357">]</span>&nbsp;<span class="op" id="4512359">&amp;&amp;</span>&nbsp;<span class="ident" id="4512362">p</span><span class="op" id="4512363">[</span><span class="ident" id="4512364">i</span><span class="op" id="4512365">+</span><span class="num" id="4512366">1</span><span class="op" id="4512367">]</span>&nbsp;<span class="op" id="4512369">&gt;</span>&nbsp;<span class="ident" id="4512371">p</span><span class="op" id="4512372">[</span><span class="ident" id="4512373">j</span><span class="op" id="4512374">+</span><span class="num" id="4512375">1</span><span class="op" id="4512376">]</span><br>
<span class="lineno">1855</span><span class="op" id="4512378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4512381">func</span>&nbsp;<span class="op" id="4512386">(</span><span class="ident" id="4512387">ra</span>&nbsp;<span class="ident" id="4512390">ranges</span><span class="op" id="4512396">)</span>&nbsp;<span class="ident" id="4512398">Len</span><span class="op" id="4512401">(</span><span class="op" id="4512402">)</span>&nbsp;<span class="builtintype" id="4512404">int</span>&nbsp;<span class="op" id="4512408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512411">return</span>&nbsp;<span class="builtinfunc" id="4512418">len</span><span class="op" id="4512421">(</span><span class="op" id="4512422">*</span><span class="ident" id="4512423">ra</span><span class="op" id="4512425">.</span><span class="ident" id="4512426">p</span><span class="op" id="4512427">)</span>&nbsp;<span class="op" id="4512429">/</span>&nbsp;<span class="num" id="4512431">2</span><br>
<span class="lineno"></span><span class="op" id="4512433">}</span><br>
<span class="lineno">1860</span><br>
<span class="lineno"></span><span class="keyword" id="4512436">func</span>&nbsp;<span class="op" id="4512441">(</span><span class="ident" id="4512442">ra</span>&nbsp;<span class="ident" id="4512445">ranges</span><span class="op" id="4512451">)</span>&nbsp;<span class="ident" id="4512453">Swap</span><span class="op" id="4512457">(</span><span class="ident" id="4512458">i</span><span class="op" id="4512459">,</span>&nbsp;<span class="ident" id="4512461">j</span>&nbsp;<span class="builtintype" id="4512463">int</span><span class="op" id="4512466">)</span>&nbsp;<span class="op" id="4512468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512471">p</span>&nbsp;<span class="op" id="4512473">:=</span>&nbsp;<span class="op" id="4512476">*</span><span class="ident" id="4512477">ra</span><span class="op" id="4512479">.</span><span class="ident" id="4512480">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512483">i</span>&nbsp;<span class="op" id="4512485">*=</span>&nbsp;<span class="num" id="4512488">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512491">j</span>&nbsp;<span class="op" id="4512493">*=</span>&nbsp;<span class="num" id="4512496">2</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512499">p</span><span class="op" id="4512500">[</span><span class="ident" id="4512501">i</span><span class="op" id="4512502">]</span><span class="op" id="4512503">,</span>&nbsp;<span class="ident" id="4512505">p</span><span class="op" id="4512506">[</span><span class="ident" id="4512507">i</span><span class="op" id="4512508">+</span><span class="num" id="4512509">1</span><span class="op" id="4512510">]</span><span class="op" id="4512511">,</span>&nbsp;<span class="ident" id="4512513">p</span><span class="op" id="4512514">[</span><span class="ident" id="4512515">j</span><span class="op" id="4512516">]</span><span class="op" id="4512517">,</span>&nbsp;<span class="ident" id="4512519">p</span><span class="op" id="4512520">[</span><span class="ident" id="4512521">j</span><span class="op" id="4512522">+</span><span class="num" id="4512523">1</span><span class="op" id="4512524">]</span>&nbsp;<span class="op" id="4512526">=</span>&nbsp;<span class="ident" id="4512528">p</span><span class="op" id="4512529">[</span><span class="ident" id="4512530">j</span><span class="op" id="4512531">]</span><span class="op" id="4512532">,</span>&nbsp;<span class="ident" id="4512534">p</span><span class="op" id="4512535">[</span><span class="ident" id="4512536">j</span><span class="op" id="4512537">+</span><span class="num" id="4512538">1</span><span class="op" id="4512539">]</span><span class="op" id="4512540">,</span>&nbsp;<span class="ident" id="4512542">p</span><span class="op" id="4512543">[</span><span class="ident" id="4512544">i</span><span class="op" id="4512545">]</span><span class="op" id="4512546">,</span>&nbsp;<span class="ident" id="4512548">p</span><span class="op" id="4512549">[</span><span class="ident" id="4512550">i</span><span class="op" id="4512551">+</span><span class="num" id="4512552">1</span><span class="op" id="4512553">]</span><br>
<span class="lineno"></span><span class="op" id="4512555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4512558">func</span>&nbsp;<span class="ident" id="4512563">checkUTF8</span><span class="op" id="4512572">(</span><span class="ident" id="4512573">s</span>&nbsp;<span class="builtintype" id="4512575">string</span><span class="op" id="4512581">)</span>&nbsp;<span class="builtintype" id="4512583">error</span>&nbsp;<span class="op" id="4512589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512592">for</span>&nbsp;<span class="ident" id="4512596">s</span>&nbsp;<span class="op" id="4512598">!=</span>&nbsp;<span class="string" id="4512601">&#34;&#34;</span>&nbsp;<span class="op" id="4512604">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4512608">rune</span><span class="op" id="4512612">,</span>&nbsp;<span class="ident" id="4512614">size</span>&nbsp;<span class="op" id="4512619">:=</span>&nbsp;<span class="ident" id="4512622">utf8</span><span class="op" id="4512626">.</span><span class="ident" id="4512627">DecodeRuneInString</span><span class="op" id="4512645">(</span><span class="ident" id="4512646">s</span><span class="op" id="4512647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512651">if</span>&nbsp;<span class="builtintype" id="4512654">rune</span>&nbsp;<span class="op" id="4512659">==</span>&nbsp;<span class="ident" id="4512662">utf8</span><span class="op" id="4512666">.</span><span class="ident" id="4512667">RuneError</span>&nbsp;<span class="op" id="4512677">&amp;&amp;</span>&nbsp;<span class="ident" id="4512680">size</span>&nbsp;<span class="op" id="4512685">==</span>&nbsp;<span class="num" id="4512688">1</span>&nbsp;<span class="op" id="4512690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512695">return</span>&nbsp;<span class="op" id="4512702">&amp;</span><span class="ident" id="4512703">Error</span><span class="op" id="4512708">{</span><span class="ident" id="4512709">Code</span><span class="op" id="4512713">:</span>&nbsp;<span class="ident" id="4512715">ErrInvalidUTF8</span><span class="op" id="4512729">,</span>&nbsp;<span class="ident" id="4512731">Expr</span><span class="op" id="4512735">:</span>&nbsp;<span class="ident" id="4512737">s</span><span class="op" id="4512738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4512742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512746">s</span>&nbsp;<span class="op" id="4512748">=</span>&nbsp;<span class="ident" id="4512750">s</span><span class="op" id="4512751">[</span><span class="ident" id="4512752">size</span><span class="op" id="4512756">:</span><span class="op" id="4512757">]</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4512760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512763">return</span>&nbsp;<span class="ident" id="4512770">nil</span><br>
<span class="lineno"></span><span class="op" id="4512774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4512777">func</span>&nbsp;<span class="ident" id="4512782">nextRune</span><span class="op" id="4512790">(</span><span class="ident" id="4512791">s</span>&nbsp;<span class="builtintype" id="4512793">string</span><span class="op" id="4512799">)</span>&nbsp;<span class="op" id="4512801">(</span><span class="ident" id="4512802">c</span>&nbsp;<span class="builtintype" id="4512804">rune</span><span class="op" id="4512808">,</span>&nbsp;<span class="ident" id="4512810">t</span>&nbsp;<span class="builtintype" id="4512812">string</span><span class="op" id="4512818">,</span>&nbsp;<span class="ident" id="4512820">err</span>&nbsp;<span class="builtintype" id="4512824">error</span><span class="op" id="4512829">)</span>&nbsp;<span class="op" id="4512831">{</span><br>
<span class="lineno">1880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512834">c</span><span class="op" id="4512835">,</span>&nbsp;<span class="ident" id="4512837">size</span>&nbsp;<span class="op" id="4512842">:=</span>&nbsp;<span class="ident" id="4512845">utf8</span><span class="op" id="4512849">.</span><span class="ident" id="4512850">DecodeRuneInString</span><span class="op" id="4512868">(</span><span class="ident" id="4512869">s</span><span class="op" id="4512870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512873">if</span>&nbsp;<span class="ident" id="4512876">c</span>&nbsp;<span class="op" id="4512878">==</span>&nbsp;<span class="ident" id="4512881">utf8</span><span class="op" id="4512885">.</span><span class="ident" id="4512886">RuneError</span>&nbsp;<span class="op" id="4512896">&amp;&amp;</span>&nbsp;<span class="ident" id="4512899">size</span>&nbsp;<span class="op" id="4512904">==</span>&nbsp;<span class="num" id="4512907">1</span>&nbsp;<span class="op" id="4512909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512913">return</span>&nbsp;<span class="num" id="4512920">0</span><span class="op" id="4512921">,</span>&nbsp;<span class="string" id="4512923">&#34;&#34;</span><span class="op" id="4512925">,</span>&nbsp;<span class="op" id="4512927">&amp;</span><span class="ident" id="4512928">Error</span><span class="op" id="4512933">{</span><span class="ident" id="4512934">Code</span><span class="op" id="4512938">:</span>&nbsp;<span class="ident" id="4512940">ErrInvalidUTF8</span><span class="op" id="4512954">,</span>&nbsp;<span class="ident" id="4512956">Expr</span><span class="op" id="4512960">:</span>&nbsp;<span class="ident" id="4512962">s</span><span class="op" id="4512963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4512966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512969">return</span>&nbsp;<span class="ident" id="4512976">c</span><span class="op" id="4512977">,</span>&nbsp;<span class="ident" id="4512979">s</span><span class="op" id="4512980">[</span><span class="ident" id="4512981">size</span><span class="op" id="4512985">:</span><span class="op" id="4512986">]</span><span class="op" id="4512987">,</span>&nbsp;<span class="ident" id="4512989">nil</span><br>
<span class="lineno">1885</span><span class="op" id="4512993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4512996">func</span>&nbsp;<span class="ident" id="4513001">isalnum</span><span class="op" id="4513008">(</span><span class="ident" id="4513009">c</span>&nbsp;<span class="builtintype" id="4513011">rune</span><span class="op" id="4513015">)</span>&nbsp;<span class="builtintype" id="4513017">bool</span>&nbsp;<span class="op" id="4513022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513025">return</span>&nbsp;<span class="string" id="4513032">&#39;0&#39;</span>&nbsp;<span class="op" id="4513036">&lt;=</span>&nbsp;<span class="ident" id="4513039">c</span>&nbsp;<span class="op" id="4513041">&amp;&amp;</span>&nbsp;<span class="ident" id="4513044">c</span>&nbsp;<span class="op" id="4513046">&lt;=</span>&nbsp;<span class="string" id="4513049">&#39;9&#39;</span>&nbsp;<span class="op" id="4513053">||</span>&nbsp;<span class="string" id="4513056">&#39;A&#39;</span>&nbsp;<span class="op" id="4513060">&lt;=</span>&nbsp;<span class="ident" id="4513063">c</span>&nbsp;<span class="op" id="4513065">&amp;&amp;</span>&nbsp;<span class="ident" id="4513068">c</span>&nbsp;<span class="op" id="4513070">&lt;=</span>&nbsp;<span class="string" id="4513073">&#39;Z&#39;</span>&nbsp;<span class="op" id="4513077">||</span>&nbsp;<span class="string" id="4513080">&#39;a&#39;</span>&nbsp;<span class="op" id="4513084">&lt;=</span>&nbsp;<span class="ident" id="4513087">c</span>&nbsp;<span class="op" id="4513089">&amp;&amp;</span>&nbsp;<span class="ident" id="4513092">c</span>&nbsp;<span class="op" id="4513094">&lt;=</span>&nbsp;<span class="string" id="4513097">&#39;z&#39;</span><br>
<span class="lineno"></span><span class="op" id="4513101">}</span><br>
<span class="lineno">1890</span><br>
<span class="lineno"></span><span class="keyword" id="4513104">func</span>&nbsp;<span class="ident" id="4513109">unhex</span><span class="op" id="4513114">(</span><span class="ident" id="4513115">c</span>&nbsp;<span class="builtintype" id="4513117">rune</span><span class="op" id="4513121">)</span>&nbsp;<span class="builtintype" id="4513123">rune</span>&nbsp;<span class="op" id="4513128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513131">if</span>&nbsp;<span class="string" id="4513134">&#39;0&#39;</span>&nbsp;<span class="op" id="4513138">&lt;=</span>&nbsp;<span class="ident" id="4513141">c</span>&nbsp;<span class="op" id="4513143">&amp;&amp;</span>&nbsp;<span class="ident" id="4513146">c</span>&nbsp;<span class="op" id="4513148">&lt;=</span>&nbsp;<span class="string" id="4513151">&#39;9&#39;</span>&nbsp;<span class="op" id="4513155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513159">return</span>&nbsp;<span class="ident" id="4513166">c</span>&nbsp;<span class="op" id="4513168">-</span>&nbsp;<span class="string" id="4513170">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4513175">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513178">if</span>&nbsp;<span class="string" id="4513181">&#39;a&#39;</span>&nbsp;<span class="op" id="4513185">&lt;=</span>&nbsp;<span class="ident" id="4513188">c</span>&nbsp;<span class="op" id="4513190">&amp;&amp;</span>&nbsp;<span class="ident" id="4513193">c</span>&nbsp;<span class="op" id="4513195">&lt;=</span>&nbsp;<span class="string" id="4513198">&#39;f&#39;</span>&nbsp;<span class="op" id="4513202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513206">return</span>&nbsp;<span class="ident" id="4513213">c</span>&nbsp;<span class="op" id="4513215">-</span>&nbsp;<span class="string" id="4513217">&#39;a&#39;</span>&nbsp;<span class="op" id="4513221">+</span>&nbsp;<span class="num" id="4513223">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4513227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513230">if</span>&nbsp;<span class="string" id="4513233">&#39;A&#39;</span>&nbsp;<span class="op" id="4513237">&lt;=</span>&nbsp;<span class="ident" id="4513240">c</span>&nbsp;<span class="op" id="4513242">&amp;&amp;</span>&nbsp;<span class="ident" id="4513245">c</span>&nbsp;<span class="op" id="4513247">&lt;=</span>&nbsp;<span class="string" id="4513250">&#39;F&#39;</span>&nbsp;<span class="op" id="4513254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513258">return</span>&nbsp;<span class="ident" id="4513265">c</span>&nbsp;<span class="op" id="4513267">-</span>&nbsp;<span class="string" id="4513269">&#39;A&#39;</span>&nbsp;<span class="op" id="4513273">+</span>&nbsp;<span class="num" id="4513275">10</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4513279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4513282">return</span>&nbsp;<span class="op" id="4513289">-</span><span class="num" id="4513290">1</span><br>
<span class="lineno"></span><span class="op" id="4513292">}</span>
</div>
</body>
</html>
