<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>log/syslog</h2>
<ul>
<li><a href="/gostd/log/syslog/syslog.go.html" class="current">syslog.go</a></li>
<li><a href="/gostd/log/syslog/syslog_test.go.html">syslog_test.go</a></li>
<li><a href="/gostd/log/syslog/syslog_unix.go.html">syslog_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6253292">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6253347">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6253401">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6253452">//&nbsp;+build&nbsp;!windows,!nacl,!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6253485">//&nbsp;Package&nbsp;syslog&nbsp;provides&nbsp;a&nbsp;simple&nbsp;interface&nbsp;to&nbsp;the&nbsp;system&nbsp;log</span><br>
<span class="lineno"></span><span class="comment" id="6253549">//&nbsp;service.&nbsp;It&nbsp;can&nbsp;send&nbsp;messages&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon&nbsp;using&nbsp;UNIX</span><br>
<span class="lineno"></span><span class="comment" id="6253614">//&nbsp;domain&nbsp;sockets,&nbsp;UDP&nbsp;or&nbsp;TCP.</span><br>
<span class="lineno">10</span><span class="comment" id="6253645">//</span><br>
<span class="lineno"></span><span class="comment" id="6253648">//&nbsp;Only&nbsp;one&nbsp;call&nbsp;to&nbsp;Dial&nbsp;is&nbsp;necessary.&nbsp;On&nbsp;write&nbsp;failures,</span><br>
<span class="lineno"></span><span class="comment" id="6253706">//&nbsp;the&nbsp;syslog&nbsp;client&nbsp;will&nbsp;attempt&nbsp;to&nbsp;reconnect&nbsp;to&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="6253767">//&nbsp;and&nbsp;write&nbsp;again.</span><br>
<span class="lineno"></span><span class="keyword" id="6253787">package</span>&nbsp;<span class="ident" id="6253795">syslog</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6253803">import</span>&nbsp;<span class="op" id="6253810">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6253813">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6253823">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6253830">&#34;log&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6253837">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6253844">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6253850">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6253861">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6253869">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6253876">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6253879">//&nbsp;The&nbsp;Priority&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;the&nbsp;syslog&nbsp;facility&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6253939">//&nbsp;severity.&nbsp;For&nbsp;example,&nbsp;LOG_ALERT&nbsp;|&nbsp;LOG_FTP&nbsp;sends&nbsp;an&nbsp;alert&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6254009">//&nbsp;message&nbsp;from&nbsp;the&nbsp;FTP&nbsp;facility.&nbsp;The&nbsp;default&nbsp;severity&nbsp;is&nbsp;LOG_EMERG;</span><br>
<span class="lineno">30</span><span class="comment" id="6254078">//&nbsp;the&nbsp;default&nbsp;facility&nbsp;is&nbsp;LOG_KERN.</span><br>
<span class="lineno"></span><span class="keyword" id="6254115">type</span>&nbsp;<span class="ident" id="6254120">Priority</span>&nbsp;<span class="builtintype" id="6254129">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6254134">const</span>&nbsp;<span class="ident" id="6254140">severityMask</span>&nbsp;<span class="op" id="6254153">=</span>&nbsp;<span class="num" id="6254155">0x07</span><br>
<span class="lineno"></span><span class="keyword" id="6254160">const</span>&nbsp;<span class="ident" id="6254166">facilityMask</span>&nbsp;<span class="op" id="6254179">=</span>&nbsp;<span class="num" id="6254181">0xf8</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="6254187">const</span>&nbsp;<span class="op" id="6254193">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6254196">//&nbsp;Severity.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6254211">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6254247">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254295">LOG_EMERG</span>&nbsp;<span class="ident" id="6254305">Priority</span>&nbsp;<span class="op" id="6254314">=</span>&nbsp;<span class="ident" id="6254316">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254322">LOG_ALERT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254333">LOG_CRIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254343">LOG_ERR</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254352">LOG_WARNING</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254365">LOG_NOTICE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254377">LOG_INFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254387">LOG_DEBUG</span><br>
<span class="lineno"></span><span class="op" id="6254397">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6254400">const</span>&nbsp;<span class="op" id="6254406">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6254409">//&nbsp;Facility.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6254424">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6254460">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;up&nbsp;to&nbsp;LOG_FTP&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254522">LOG_KERN</span>&nbsp;<span class="ident" id="6254531">Priority</span>&nbsp;<span class="op" id="6254540">=</span>&nbsp;<span class="ident" id="6254542">iota</span>&nbsp;<span class="op" id="6254547">&lt;&lt;</span>&nbsp;<span class="num" id="6254550">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254553">LOG_USER</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254563">LOG_MAIL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254573">LOG_DAEMON</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254585">LOG_AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254595">LOG_SYSLOG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254607">LOG_LPR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254616">LOG_NEWS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254626">LOG_UUCP</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254636">LOG_CRON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254646">LOG_AUTHPRIV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254660">LOG_FTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254669">_</span>&nbsp;<span class="comment" id="6254671">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254682">_</span>&nbsp;<span class="comment" id="6254684">//&nbsp;unused</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254695">_</span>&nbsp;<span class="comment" id="6254697">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254708">_</span>&nbsp;<span class="comment" id="6254710">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254721">LOG_LOCAL0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254733">LOG_LOCAL1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254745">LOG_LOCAL2</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254757">LOG_LOCAL3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254769">LOG_LOCAL4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254781">LOG_LOCAL5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254793">LOG_LOCAL6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254805">LOG_LOCAL7</span><br>
<span class="lineno">80</span><span class="op" id="6254816">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6254819">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6254867">type</span>&nbsp;<span class="ident" id="6254872">Writer</span>&nbsp;<span class="keyword" id="6254879">struct</span>&nbsp;<span class="op" id="6254886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254889">priority</span>&nbsp;<span class="ident" id="6254898">Priority</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254908">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6254917">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254925">hostname</span>&nbsp;<span class="builtintype" id="6254934">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254942">network</span>&nbsp;&nbsp;<span class="builtintype" id="6254951">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254959">raddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6254968">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6254977">mu</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6254982">sync</span><span class="op" id="6254986">.</span><span class="ident" id="6254987">Mutex</span>&nbsp;<span class="comment" id="6254993">//&nbsp;guards&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255009">conn</span>&nbsp;<span class="ident" id="6255014">serverConn</span><br>
<span class="lineno"></span><span class="op" id="6255025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6255028">//&nbsp;This&nbsp;interface&nbsp;and&nbsp;the&nbsp;separate&nbsp;syslog_unix.go&nbsp;file&nbsp;exist&nbsp;for</span><br>
<span class="lineno">95</span><span class="comment" id="6255093">//&nbsp;Solaris&nbsp;support&nbsp;as&nbsp;implemented&nbsp;by&nbsp;gccgo.&nbsp;&nbsp;On&nbsp;Solaris&nbsp;you&nbsp;can&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="6255161">//&nbsp;simply&nbsp;open&nbsp;a&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.&nbsp;&nbsp;The&nbsp;gccgo</span><br>
<span class="lineno"></span><span class="comment" id="6255226">//&nbsp;sources&nbsp;have&nbsp;a&nbsp;syslog_solaris.go&nbsp;file&nbsp;that&nbsp;implements&nbsp;unixSyslog&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6255297">//&nbsp;return&nbsp;a&nbsp;type&nbsp;that&nbsp;satisfies&nbsp;this&nbsp;interface&nbsp;and&nbsp;simply&nbsp;calls&nbsp;the&nbsp;C</span><br>
<span class="lineno"></span><span class="comment" id="6255367">//&nbsp;library&nbsp;syslog&nbsp;function.</span><br>
<span class="lineno">100</span><span class="keyword" id="6255395">type</span>&nbsp;<span class="ident" id="6255400">serverConn</span>&nbsp;<span class="keyword" id="6255411">interface</span>&nbsp;<span class="op" id="6255421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255424">writeString</span><span class="op" id="6255435">(</span><span class="ident" id="6255436">p</span>&nbsp;<span class="ident" id="6255438">Priority</span><span class="op" id="6255446">,</span>&nbsp;<span class="ident" id="6255448">hostname</span><span class="op" id="6255456">,</span>&nbsp;<span class="ident" id="6255458">tag</span><span class="op" id="6255461">,</span>&nbsp;<span class="ident" id="6255463">s</span><span class="op" id="6255464">,</span>&nbsp;<span class="ident" id="6255466">nl</span>&nbsp;<span class="builtintype" id="6255469">string</span><span class="op" id="6255475">)</span>&nbsp;<span class="builtintype" id="6255477">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6255484">close</span><span class="op" id="6255489">(</span><span class="op" id="6255490">)</span>&nbsp;<span class="builtintype" id="6255492">error</span><br>
<span class="lineno"></span><span class="op" id="6255498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6255501">type</span>&nbsp;<span class="ident" id="6255506">netConn</span>&nbsp;<span class="keyword" id="6255514">struct</span>&nbsp;<span class="op" id="6255521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255524">local</span>&nbsp;<span class="builtintype" id="6255530">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6255536">conn</span>&nbsp;&nbsp;<span class="ident" id="6255542">net</span><span class="op" id="6255545">.</span><span class="ident" id="6255546">Conn</span><br>
<span class="lineno"></span><span class="op" id="6255551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6255554">//&nbsp;New&nbsp;establishes&nbsp;a&nbsp;new&nbsp;connection&nbsp;to&nbsp;the&nbsp;system&nbsp;log&nbsp;daemon.&nbsp;&nbsp;Each</span><br>
<span class="lineno"></span><span class="comment" id="6255622">//&nbsp;write&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6255689">//&nbsp;priority&nbsp;and&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6255713">func</span>&nbsp;<span class="ident" id="6255718">New</span><span class="op" id="6255721">(</span><span class="ident" id="6255722">priority</span>&nbsp;<span class="ident" id="6255731">Priority</span><span class="op" id="6255739">,</span>&nbsp;<span class="ident" id="6255741">tag</span>&nbsp;<span class="builtintype" id="6255745">string</span><span class="op" id="6255751">)</span>&nbsp;<span class="op" id="6255753">(</span><span class="ident" id="6255754">w</span>&nbsp;<span class="op" id="6255756">*</span><span class="ident" id="6255757">Writer</span><span class="op" id="6255763">,</span>&nbsp;<span class="ident" id="6255765">err</span>&nbsp;<span class="builtintype" id="6255769">error</span><span class="op" id="6255774">)</span>&nbsp;<span class="op" id="6255776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6255779">return</span>&nbsp;<span class="ident" id="6255786">Dial</span><span class="op" id="6255790">(</span><span class="string" id="6255791">&#34;&#34;</span><span class="op" id="6255793">,</span>&nbsp;<span class="string" id="6255795">&#34;&#34;</span><span class="op" id="6255797">,</span>&nbsp;<span class="ident" id="6255799">priority</span><span class="op" id="6255807">,</span>&nbsp;<span class="ident" id="6255809">tag</span><span class="op" id="6255812">)</span><br>
<span class="lineno">115</span><span class="op" id="6255814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6255817">//&nbsp;Dial&nbsp;establishes&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;log&nbsp;daemon&nbsp;by&nbsp;connecting&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6255883">//&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;specified&nbsp;network.&nbsp;&nbsp;Each&nbsp;write&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="6255954">//&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given&nbsp;facility,&nbsp;severity&nbsp;and</span><br>
<span class="lineno">120</span><span class="comment" id="6256022">//&nbsp;tag.</span><br>
<span class="lineno"></span><span class="comment" id="6256030">//&nbsp;If&nbsp;network&nbsp;is&nbsp;empty,&nbsp;Dial&nbsp;will&nbsp;connect&nbsp;to&nbsp;the&nbsp;local&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6256100">func</span>&nbsp;<span class="ident" id="6256105">Dial</span><span class="op" id="6256109">(</span><span class="ident" id="6256110">network</span><span class="op" id="6256117">,</span>&nbsp;<span class="ident" id="6256119">raddr</span>&nbsp;<span class="builtintype" id="6256125">string</span><span class="op" id="6256131">,</span>&nbsp;<span class="ident" id="6256133">priority</span>&nbsp;<span class="ident" id="6256142">Priority</span><span class="op" id="6256150">,</span>&nbsp;<span class="ident" id="6256152">tag</span>&nbsp;<span class="builtintype" id="6256156">string</span><span class="op" id="6256162">)</span>&nbsp;<span class="op" id="6256164">(</span><span class="op" id="6256165">*</span><span class="ident" id="6256166">Writer</span><span class="op" id="6256172">,</span>&nbsp;<span class="builtintype" id="6256174">error</span><span class="op" id="6256179">)</span>&nbsp;<span class="op" id="6256181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256184">if</span>&nbsp;<span class="ident" id="6256187">priority</span>&nbsp;<span class="op" id="6256196">&lt;</span>&nbsp;<span class="num" id="6256198">0</span>&nbsp;<span class="op" id="6256200">||</span>&nbsp;<span class="ident" id="6256203">priority</span>&nbsp;<span class="op" id="6256212">&gt;</span>&nbsp;<span class="ident" id="6256214">LOG_LOCAL7</span><span class="op" id="6256224">|</span><span class="ident" id="6256225">LOG_DEBUG</span>&nbsp;<span class="op" id="6256235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256239">return</span>&nbsp;<span class="ident" id="6256246">nil</span><span class="op" id="6256249">,</span>&nbsp;<span class="ident" id="6256251">errors</span><span class="op" id="6256257">.</span><span class="ident" id="6256258">New</span><span class="op" id="6256261">(</span><span class="string" id="6256262">&#34;log/syslog:&nbsp;invalid&nbsp;priority&#34;</span><span class="op" id="6256292">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256299">if</span>&nbsp;<span class="ident" id="6256302">tag</span>&nbsp;<span class="op" id="6256306">==</span>&nbsp;<span class="string" id="6256309">&#34;&#34;</span>&nbsp;<span class="op" id="6256312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256316">tag</span>&nbsp;<span class="op" id="6256320">=</span>&nbsp;<span class="ident" id="6256322">os</span><span class="op" id="6256324">.</span><span class="ident" id="6256325">Args</span><span class="op" id="6256329">[</span><span class="num" id="6256330">0</span><span class="op" id="6256331">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256334">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256337">hostname</span><span class="op" id="6256345">,</span>&nbsp;<span class="ident" id="6256347">_</span>&nbsp;<span class="op" id="6256349">:=</span>&nbsp;<span class="ident" id="6256352">os</span><span class="op" id="6256354">.</span><span class="ident" id="6256355">Hostname</span><span class="op" id="6256363">(</span><span class="op" id="6256364">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256368">w</span>&nbsp;<span class="op" id="6256370">:=</span>&nbsp;<span class="op" id="6256373">&amp;</span><span class="ident" id="6256374">Writer</span><span class="op" id="6256380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256384">priority</span><span class="op" id="6256392">:</span>&nbsp;<span class="ident" id="6256394">priority</span><span class="op" id="6256402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256406">tag</span><span class="op" id="6256409">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6256416">tag</span><span class="op" id="6256419">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256423">hostname</span><span class="op" id="6256431">:</span>&nbsp;<span class="ident" id="6256433">hostname</span><span class="op" id="6256441">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256445">network</span><span class="op" id="6256452">:</span>&nbsp;&nbsp;<span class="ident" id="6256455">network</span><span class="op" id="6256462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256466">raddr</span><span class="op" id="6256471">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6256476">raddr</span><span class="op" id="6256481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256488">w</span><span class="op" id="6256489">.</span><span class="ident" id="6256490">mu</span><span class="op" id="6256492">.</span><span class="ident" id="6256493">Lock</span><span class="op" id="6256497">(</span><span class="op" id="6256498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256501">defer</span>&nbsp;<span class="ident" id="6256507">w</span><span class="op" id="6256508">.</span><span class="ident" id="6256509">mu</span><span class="op" id="6256511">.</span><span class="ident" id="6256512">Unlock</span><span class="op" id="6256518">(</span><span class="op" id="6256519">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256523">err</span>&nbsp;<span class="op" id="6256527">:=</span>&nbsp;<span class="ident" id="6256530">w</span><span class="op" id="6256531">.</span><span class="ident" id="6256532">connect</span><span class="op" id="6256539">(</span><span class="op" id="6256540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256543">if</span>&nbsp;<span class="ident" id="6256546">err</span>&nbsp;<span class="op" id="6256550">!=</span>&nbsp;<span class="ident" id="6256553">nil</span>&nbsp;<span class="op" id="6256557">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256561">return</span>&nbsp;<span class="ident" id="6256568">nil</span><span class="op" id="6256571">,</span>&nbsp;<span class="ident" id="6256573">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256581">return</span>&nbsp;<span class="ident" id="6256588">w</span><span class="op" id="6256589">,</span>&nbsp;<span class="ident" id="6256591">err</span><br>
<span class="lineno"></span><span class="op" id="6256595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="6256598">//&nbsp;connect&nbsp;makes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6256650">//&nbsp;It&nbsp;must&nbsp;be&nbsp;called&nbsp;with&nbsp;w.mu&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="6256687">func</span>&nbsp;<span class="op" id="6256692">(</span><span class="ident" id="6256693">w</span>&nbsp;<span class="op" id="6256695">*</span><span class="ident" id="6256696">Writer</span><span class="op" id="6256702">)</span>&nbsp;<span class="ident" id="6256704">connect</span><span class="op" id="6256711">(</span><span class="op" id="6256712">)</span>&nbsp;<span class="op" id="6256714">(</span><span class="ident" id="6256715">err</span>&nbsp;<span class="builtintype" id="6256719">error</span><span class="op" id="6256724">)</span>&nbsp;<span class="op" id="6256726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256729">if</span>&nbsp;<span class="ident" id="6256732">w</span><span class="op" id="6256733">.</span><span class="ident" id="6256734">conn</span>&nbsp;<span class="op" id="6256739">!=</span>&nbsp;<span class="ident" id="6256742">nil</span>&nbsp;<span class="op" id="6256746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6256750">//&nbsp;ignore&nbsp;err&nbsp;from&nbsp;close,&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;continue&nbsp;anyway</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256812">w</span><span class="op" id="6256813">.</span><span class="ident" id="6256814">conn</span><span class="op" id="6256818">.</span><span class="builtinfunc" id="6256819">close</span><span class="op" id="6256824">(</span><span class="op" id="6256825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256829">w</span><span class="op" id="6256830">.</span><span class="ident" id="6256831">conn</span>&nbsp;<span class="op" id="6256836">=</span>&nbsp;<span class="ident" id="6256838">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256847">if</span>&nbsp;<span class="ident" id="6256850">w</span><span class="op" id="6256851">.</span><span class="ident" id="6256852">network</span>&nbsp;<span class="op" id="6256860">==</span>&nbsp;<span class="string" id="6256863">&#34;&#34;</span>&nbsp;<span class="op" id="6256866">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256870">w</span><span class="op" id="6256871">.</span><span class="ident" id="6256872">conn</span><span class="op" id="6256876">,</span>&nbsp;<span class="ident" id="6256878">err</span>&nbsp;<span class="op" id="6256882">=</span>&nbsp;<span class="ident" id="6256884">unixSyslog</span><span class="op" id="6256894">(</span><span class="op" id="6256895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256899">if</span>&nbsp;<span class="ident" id="6256902">w</span><span class="op" id="6256903">.</span><span class="ident" id="6256904">hostname</span>&nbsp;<span class="op" id="6256913">==</span>&nbsp;<span class="string" id="6256916">&#34;&#34;</span>&nbsp;<span class="op" id="6256919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256924">w</span><span class="op" id="6256925">.</span><span class="ident" id="6256926">hostname</span>&nbsp;<span class="op" id="6256935">=</span>&nbsp;<span class="string" id="6256937">&#34;localhost&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6256954">}</span>&nbsp;<span class="keyword" id="6256956">else</span>&nbsp;<span class="op" id="6256961">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6256965">var</span>&nbsp;<span class="ident" id="6256969">c</span>&nbsp;<span class="ident" id="6256971">net</span><span class="op" id="6256974">.</span><span class="ident" id="6256975">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6256982">c</span><span class="op" id="6256983">,</span>&nbsp;<span class="ident" id="6256985">err</span>&nbsp;<span class="op" id="6256989">=</span>&nbsp;<span class="ident" id="6256991">net</span><span class="op" id="6256994">.</span><span class="ident" id="6256995">Dial</span><span class="op" id="6256999">(</span><span class="ident" id="6257000">w</span><span class="op" id="6257001">.</span><span class="ident" id="6257002">network</span><span class="op" id="6257009">,</span>&nbsp;<span class="ident" id="6257011">w</span><span class="op" id="6257012">.</span><span class="ident" id="6257013">raddr</span><span class="op" id="6257018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257022">if</span>&nbsp;<span class="ident" id="6257025">err</span>&nbsp;<span class="op" id="6257029">==</span>&nbsp;<span class="ident" id="6257032">nil</span>&nbsp;<span class="op" id="6257036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257041">w</span><span class="op" id="6257042">.</span><span class="ident" id="6257043">conn</span>&nbsp;<span class="op" id="6257048">=</span>&nbsp;<span class="op" id="6257050">&amp;</span><span class="ident" id="6257051">netConn</span><span class="op" id="6257058">{</span><span class="ident" id="6257059">conn</span><span class="op" id="6257063">:</span>&nbsp;<span class="ident" id="6257065">c</span><span class="op" id="6257066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257071">if</span>&nbsp;<span class="ident" id="6257074">w</span><span class="op" id="6257075">.</span><span class="ident" id="6257076">hostname</span>&nbsp;<span class="op" id="6257085">==</span>&nbsp;<span class="string" id="6257088">&#34;&#34;</span>&nbsp;<span class="op" id="6257091">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257097">w</span><span class="op" id="6257098">.</span><span class="ident" id="6257099">hostname</span>&nbsp;<span class="op" id="6257108">=</span>&nbsp;<span class="ident" id="6257110">c</span><span class="op" id="6257111">.</span><span class="ident" id="6257112">LocalAddr</span><span class="op" id="6257121">(</span><span class="op" id="6257122">)</span><span class="op" id="6257123">.</span><span class="ident" id="6257124">String</span><span class="op" id="6257130">(</span><span class="op" id="6257131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6257136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6257140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6257143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257146">return</span><br>
<span class="lineno">175</span><span class="op" id="6257153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6257156">//&nbsp;Write&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6257207">func</span>&nbsp;<span class="op" id="6257212">(</span><span class="ident" id="6257213">w</span>&nbsp;<span class="op" id="6257215">*</span><span class="ident" id="6257216">Writer</span><span class="op" id="6257222">)</span>&nbsp;<span class="ident" id="6257224">Write</span><span class="op" id="6257229">(</span><span class="ident" id="6257230">b</span>&nbsp;<span class="op" id="6257232">[</span><span class="op" id="6257233">]</span><span class="builtintype" id="6257234">byte</span><span class="op" id="6257238">)</span>&nbsp;<span class="op" id="6257240">(</span><span class="builtintype" id="6257241">int</span><span class="op" id="6257244">,</span>&nbsp;<span class="builtintype" id="6257246">error</span><span class="op" id="6257251">)</span>&nbsp;<span class="op" id="6257253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257256">return</span>&nbsp;<span class="ident" id="6257263">w</span><span class="op" id="6257264">.</span><span class="ident" id="6257265">writeAndRetry</span><span class="op" id="6257278">(</span><span class="ident" id="6257279">w</span><span class="op" id="6257280">.</span><span class="ident" id="6257281">priority</span><span class="op" id="6257289">,</span>&nbsp;<span class="builtintype" id="6257291">string</span><span class="op" id="6257297">(</span><span class="ident" id="6257298">b</span><span class="op" id="6257299">)</span><span class="op" id="6257300">)</span><br>
<span class="lineno">180</span><span class="op" id="6257302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6257305">//&nbsp;Close&nbsp;closes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6257356">func</span>&nbsp;<span class="op" id="6257361">(</span><span class="ident" id="6257362">w</span>&nbsp;<span class="op" id="6257364">*</span><span class="ident" id="6257365">Writer</span><span class="op" id="6257371">)</span>&nbsp;<span class="ident" id="6257373">Close</span><span class="op" id="6257378">(</span><span class="op" id="6257379">)</span>&nbsp;<span class="builtintype" id="6257381">error</span>&nbsp;<span class="op" id="6257387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257390">w</span><span class="op" id="6257391">.</span><span class="ident" id="6257392">mu</span><span class="op" id="6257394">.</span><span class="ident" id="6257395">Lock</span><span class="op" id="6257399">(</span><span class="op" id="6257400">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257403">defer</span>&nbsp;<span class="ident" id="6257409">w</span><span class="op" id="6257410">.</span><span class="ident" id="6257411">mu</span><span class="op" id="6257413">.</span><span class="ident" id="6257414">Unlock</span><span class="op" id="6257420">(</span><span class="op" id="6257421">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257425">if</span>&nbsp;<span class="ident" id="6257428">w</span><span class="op" id="6257429">.</span><span class="ident" id="6257430">conn</span>&nbsp;<span class="op" id="6257435">!=</span>&nbsp;<span class="ident" id="6257438">nil</span>&nbsp;<span class="op" id="6257442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257446">err</span>&nbsp;<span class="op" id="6257450">:=</span>&nbsp;<span class="ident" id="6257453">w</span><span class="op" id="6257454">.</span><span class="ident" id="6257455">conn</span><span class="op" id="6257459">.</span><span class="builtinfunc" id="6257460">close</span><span class="op" id="6257465">(</span><span class="op" id="6257466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257470">w</span><span class="op" id="6257471">.</span><span class="ident" id="6257472">conn</span>&nbsp;<span class="op" id="6257477">=</span>&nbsp;<span class="ident" id="6257479">nil</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257485">return</span>&nbsp;<span class="ident" id="6257492">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6257497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257500">return</span>&nbsp;<span class="ident" id="6257507">nil</span><br>
<span class="lineno"></span><span class="op" id="6257511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="6257514">//&nbsp;Emerg&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_EMERG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6257585">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6257603">func</span>&nbsp;<span class="op" id="6257608">(</span><span class="ident" id="6257609">w</span>&nbsp;<span class="op" id="6257611">*</span><span class="ident" id="6257612">Writer</span><span class="op" id="6257618">)</span>&nbsp;<span class="ident" id="6257620">Emerg</span><span class="op" id="6257625">(</span><span class="ident" id="6257626">m</span>&nbsp;<span class="builtintype" id="6257628">string</span><span class="op" id="6257634">)</span>&nbsp;<span class="op" id="6257636">(</span><span class="ident" id="6257637">err</span>&nbsp;<span class="builtintype" id="6257641">error</span><span class="op" id="6257646">)</span>&nbsp;<span class="op" id="6257648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257651">_</span><span class="op" id="6257652">,</span>&nbsp;<span class="ident" id="6257654">err</span>&nbsp;<span class="op" id="6257658">=</span>&nbsp;<span class="ident" id="6257660">w</span><span class="op" id="6257661">.</span><span class="ident" id="6257662">writeAndRetry</span><span class="op" id="6257675">(</span><span class="ident" id="6257676">LOG_EMERG</span><span class="op" id="6257685">,</span>&nbsp;<span class="ident" id="6257687">m</span><span class="op" id="6257688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257691">return</span>&nbsp;<span class="ident" id="6257698">err</span><br>
<span class="lineno">200</span><span class="op" id="6257702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6257705">//&nbsp;Alert&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ALERT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6257776">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6257794">func</span>&nbsp;<span class="op" id="6257799">(</span><span class="ident" id="6257800">w</span>&nbsp;<span class="op" id="6257802">*</span><span class="ident" id="6257803">Writer</span><span class="op" id="6257809">)</span>&nbsp;<span class="ident" id="6257811">Alert</span><span class="op" id="6257816">(</span><span class="ident" id="6257817">m</span>&nbsp;<span class="builtintype" id="6257819">string</span><span class="op" id="6257825">)</span>&nbsp;<span class="op" id="6257827">(</span><span class="ident" id="6257828">err</span>&nbsp;<span class="builtintype" id="6257832">error</span><span class="op" id="6257837">)</span>&nbsp;<span class="op" id="6257839">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6257842">_</span><span class="op" id="6257843">,</span>&nbsp;<span class="ident" id="6257845">err</span>&nbsp;<span class="op" id="6257849">=</span>&nbsp;<span class="ident" id="6257851">w</span><span class="op" id="6257852">.</span><span class="ident" id="6257853">writeAndRetry</span><span class="op" id="6257866">(</span><span class="ident" id="6257867">LOG_ALERT</span><span class="op" id="6257876">,</span>&nbsp;<span class="ident" id="6257878">m</span><span class="op" id="6257879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6257882">return</span>&nbsp;<span class="ident" id="6257889">err</span><br>
<span class="lineno"></span><span class="op" id="6257893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6257896">//&nbsp;Crit&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_CRIT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">210</span><span class="comment" id="6257965">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6257983">func</span>&nbsp;<span class="op" id="6257988">(</span><span class="ident" id="6257989">w</span>&nbsp;<span class="op" id="6257991">*</span><span class="ident" id="6257992">Writer</span><span class="op" id="6257998">)</span>&nbsp;<span class="ident" id="6258000">Crit</span><span class="op" id="6258004">(</span><span class="ident" id="6258005">m</span>&nbsp;<span class="builtintype" id="6258007">string</span><span class="op" id="6258013">)</span>&nbsp;<span class="op" id="6258015">(</span><span class="ident" id="6258016">err</span>&nbsp;<span class="builtintype" id="6258020">error</span><span class="op" id="6258025">)</span>&nbsp;<span class="op" id="6258027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258030">_</span><span class="op" id="6258031">,</span>&nbsp;<span class="ident" id="6258033">err</span>&nbsp;<span class="op" id="6258037">=</span>&nbsp;<span class="ident" id="6258039">w</span><span class="op" id="6258040">.</span><span class="ident" id="6258041">writeAndRetry</span><span class="op" id="6258054">(</span><span class="ident" id="6258055">LOG_CRIT</span><span class="op" id="6258063">,</span>&nbsp;<span class="ident" id="6258065">m</span><span class="op" id="6258066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258069">return</span>&nbsp;<span class="ident" id="6258076">err</span><br>
<span class="lineno"></span><span class="op" id="6258080">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="6258083">//&nbsp;Err&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ERR,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6258150">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6258168">func</span>&nbsp;<span class="op" id="6258173">(</span><span class="ident" id="6258174">w</span>&nbsp;<span class="op" id="6258176">*</span><span class="ident" id="6258177">Writer</span><span class="op" id="6258183">)</span>&nbsp;<span class="ident" id="6258185">Err</span><span class="op" id="6258188">(</span><span class="ident" id="6258189">m</span>&nbsp;<span class="builtintype" id="6258191">string</span><span class="op" id="6258197">)</span>&nbsp;<span class="op" id="6258199">(</span><span class="ident" id="6258200">err</span>&nbsp;<span class="builtintype" id="6258204">error</span><span class="op" id="6258209">)</span>&nbsp;<span class="op" id="6258211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258214">_</span><span class="op" id="6258215">,</span>&nbsp;<span class="ident" id="6258217">err</span>&nbsp;<span class="op" id="6258221">=</span>&nbsp;<span class="ident" id="6258223">w</span><span class="op" id="6258224">.</span><span class="ident" id="6258225">writeAndRetry</span><span class="op" id="6258238">(</span><span class="ident" id="6258239">LOG_ERR</span><span class="op" id="6258246">,</span>&nbsp;<span class="ident" id="6258248">m</span><span class="op" id="6258249">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258252">return</span>&nbsp;<span class="ident" id="6258259">err</span><br>
<span class="lineno"></span><span class="op" id="6258263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6258266">//&nbsp;Warning&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_WARNING,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6258332">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno">225</span><span class="keyword" id="6258359">func</span>&nbsp;<span class="op" id="6258364">(</span><span class="ident" id="6258365">w</span>&nbsp;<span class="op" id="6258367">*</span><span class="ident" id="6258368">Writer</span><span class="op" id="6258374">)</span>&nbsp;<span class="ident" id="6258376">Warning</span><span class="op" id="6258383">(</span><span class="ident" id="6258384">m</span>&nbsp;<span class="builtintype" id="6258386">string</span><span class="op" id="6258392">)</span>&nbsp;<span class="op" id="6258394">(</span><span class="ident" id="6258395">err</span>&nbsp;<span class="builtintype" id="6258399">error</span><span class="op" id="6258404">)</span>&nbsp;<span class="op" id="6258406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258409">_</span><span class="op" id="6258410">,</span>&nbsp;<span class="ident" id="6258412">err</span>&nbsp;<span class="op" id="6258416">=</span>&nbsp;<span class="ident" id="6258418">w</span><span class="op" id="6258419">.</span><span class="ident" id="6258420">writeAndRetry</span><span class="op" id="6258433">(</span><span class="ident" id="6258434">LOG_WARNING</span><span class="op" id="6258445">,</span>&nbsp;<span class="ident" id="6258447">m</span><span class="op" id="6258448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258451">return</span>&nbsp;<span class="ident" id="6258458">err</span><br>
<span class="lineno"></span><span class="op" id="6258462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="6258465">//&nbsp;Notice&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_NOTICE,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6258529">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6258556">func</span>&nbsp;<span class="op" id="6258561">(</span><span class="ident" id="6258562">w</span>&nbsp;<span class="op" id="6258564">*</span><span class="ident" id="6258565">Writer</span><span class="op" id="6258571">)</span>&nbsp;<span class="ident" id="6258573">Notice</span><span class="op" id="6258579">(</span><span class="ident" id="6258580">m</span>&nbsp;<span class="builtintype" id="6258582">string</span><span class="op" id="6258588">)</span>&nbsp;<span class="op" id="6258590">(</span><span class="ident" id="6258591">err</span>&nbsp;<span class="builtintype" id="6258595">error</span><span class="op" id="6258600">)</span>&nbsp;<span class="op" id="6258602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258605">_</span><span class="op" id="6258606">,</span>&nbsp;<span class="ident" id="6258608">err</span>&nbsp;<span class="op" id="6258612">=</span>&nbsp;<span class="ident" id="6258614">w</span><span class="op" id="6258615">.</span><span class="ident" id="6258616">writeAndRetry</span><span class="op" id="6258629">(</span><span class="ident" id="6258630">LOG_NOTICE</span><span class="op" id="6258640">,</span>&nbsp;<span class="ident" id="6258642">m</span><span class="op" id="6258643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258646">return</span>&nbsp;<span class="ident" id="6258653">err</span><br>
<span class="lineno">235</span><span class="op" id="6258657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6258660">//&nbsp;Info&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_INFO,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6258729">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6258747">func</span>&nbsp;<span class="op" id="6258752">(</span><span class="ident" id="6258753">w</span>&nbsp;<span class="op" id="6258755">*</span><span class="ident" id="6258756">Writer</span><span class="op" id="6258762">)</span>&nbsp;<span class="ident" id="6258764">Info</span><span class="op" id="6258768">(</span><span class="ident" id="6258769">m</span>&nbsp;<span class="builtintype" id="6258771">string</span><span class="op" id="6258777">)</span>&nbsp;<span class="op" id="6258779">(</span><span class="ident" id="6258780">err</span>&nbsp;<span class="builtintype" id="6258784">error</span><span class="op" id="6258789">)</span>&nbsp;<span class="op" id="6258791">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258794">_</span><span class="op" id="6258795">,</span>&nbsp;<span class="ident" id="6258797">err</span>&nbsp;<span class="op" id="6258801">=</span>&nbsp;<span class="ident" id="6258803">w</span><span class="op" id="6258804">.</span><span class="ident" id="6258805">writeAndRetry</span><span class="op" id="6258818">(</span><span class="ident" id="6258819">LOG_INFO</span><span class="op" id="6258827">,</span>&nbsp;<span class="ident" id="6258829">m</span><span class="op" id="6258830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6258833">return</span>&nbsp;<span class="ident" id="6258840">err</span><br>
<span class="lineno"></span><span class="op" id="6258844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6258847">//&nbsp;Debug&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_DEBUG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">245</span><span class="comment" id="6258918">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6258936">func</span>&nbsp;<span class="op" id="6258941">(</span><span class="ident" id="6258942">w</span>&nbsp;<span class="op" id="6258944">*</span><span class="ident" id="6258945">Writer</span><span class="op" id="6258951">)</span>&nbsp;<span class="ident" id="6258953">Debug</span><span class="op" id="6258958">(</span><span class="ident" id="6258959">m</span>&nbsp;<span class="builtintype" id="6258961">string</span><span class="op" id="6258967">)</span>&nbsp;<span class="op" id="6258969">(</span><span class="ident" id="6258970">err</span>&nbsp;<span class="builtintype" id="6258974">error</span><span class="op" id="6258979">)</span>&nbsp;<span class="op" id="6258981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6258984">_</span><span class="op" id="6258985">,</span>&nbsp;<span class="ident" id="6258987">err</span>&nbsp;<span class="op" id="6258991">=</span>&nbsp;<span class="ident" id="6258993">w</span><span class="op" id="6258994">.</span><span class="ident" id="6258995">writeAndRetry</span><span class="op" id="6259008">(</span><span class="ident" id="6259009">LOG_DEBUG</span><span class="op" id="6259018">,</span>&nbsp;<span class="ident" id="6259020">m</span><span class="op" id="6259021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259024">return</span>&nbsp;<span class="ident" id="6259031">err</span><br>
<span class="lineno"></span><span class="op" id="6259035">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6259038">func</span>&nbsp;<span class="op" id="6259043">(</span><span class="ident" id="6259044">w</span>&nbsp;<span class="op" id="6259046">*</span><span class="ident" id="6259047">Writer</span><span class="op" id="6259053">)</span>&nbsp;<span class="ident" id="6259055">writeAndRetry</span><span class="op" id="6259068">(</span><span class="ident" id="6259069">p</span>&nbsp;<span class="ident" id="6259071">Priority</span><span class="op" id="6259079">,</span>&nbsp;<span class="ident" id="6259081">s</span>&nbsp;<span class="builtintype" id="6259083">string</span><span class="op" id="6259089">)</span>&nbsp;<span class="op" id="6259091">(</span><span class="builtintype" id="6259092">int</span><span class="op" id="6259095">,</span>&nbsp;<span class="builtintype" id="6259097">error</span><span class="op" id="6259102">)</span>&nbsp;<span class="op" id="6259104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259107">pr</span>&nbsp;<span class="op" id="6259110">:=</span>&nbsp;<span class="op" id="6259113">(</span><span class="ident" id="6259114">w</span><span class="op" id="6259115">.</span><span class="ident" id="6259116">priority</span>&nbsp;<span class="op" id="6259125">&amp;</span>&nbsp;<span class="ident" id="6259127">facilityMask</span><span class="op" id="6259139">)</span>&nbsp;<span class="op" id="6259141">|</span>&nbsp;<span class="op" id="6259143">(</span><span class="ident" id="6259144">p</span>&nbsp;<span class="op" id="6259146">&amp;</span>&nbsp;<span class="ident" id="6259148">severityMask</span><span class="op" id="6259160">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259164">w</span><span class="op" id="6259165">.</span><span class="ident" id="6259166">mu</span><span class="op" id="6259168">.</span><span class="ident" id="6259169">Lock</span><span class="op" id="6259173">(</span><span class="op" id="6259174">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259177">defer</span>&nbsp;<span class="ident" id="6259183">w</span><span class="op" id="6259184">.</span><span class="ident" id="6259185">mu</span><span class="op" id="6259187">.</span><span class="ident" id="6259188">Unlock</span><span class="op" id="6259194">(</span><span class="op" id="6259195">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259199">if</span>&nbsp;<span class="ident" id="6259202">w</span><span class="op" id="6259203">.</span><span class="ident" id="6259204">conn</span>&nbsp;<span class="op" id="6259209">!=</span>&nbsp;<span class="ident" id="6259212">nil</span>&nbsp;<span class="op" id="6259216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259220">if</span>&nbsp;<span class="ident" id="6259223">n</span><span class="op" id="6259224">,</span>&nbsp;<span class="ident" id="6259226">err</span>&nbsp;<span class="op" id="6259230">:=</span>&nbsp;<span class="ident" id="6259233">w</span><span class="op" id="6259234">.</span><span class="ident" id="6259235">write</span><span class="op" id="6259240">(</span><span class="ident" id="6259241">pr</span><span class="op" id="6259243">,</span>&nbsp;<span class="ident" id="6259245">s</span><span class="op" id="6259246">)</span><span class="op" id="6259247">;</span>&nbsp;<span class="ident" id="6259249">err</span>&nbsp;<span class="op" id="6259253">==</span>&nbsp;<span class="ident" id="6259256">nil</span>&nbsp;<span class="op" id="6259260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259265">return</span>&nbsp;<span class="ident" id="6259272">n</span><span class="op" id="6259273">,</span>&nbsp;<span class="ident" id="6259275">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6259281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6259284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259287">if</span>&nbsp;<span class="ident" id="6259290">err</span>&nbsp;<span class="op" id="6259294">:=</span>&nbsp;<span class="ident" id="6259297">w</span><span class="op" id="6259298">.</span><span class="ident" id="6259299">connect</span><span class="op" id="6259306">(</span><span class="op" id="6259307">)</span><span class="op" id="6259308">;</span>&nbsp;<span class="ident" id="6259310">err</span>&nbsp;<span class="op" id="6259314">!=</span>&nbsp;<span class="ident" id="6259317">nil</span>&nbsp;<span class="op" id="6259321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259325">return</span>&nbsp;<span class="num" id="6259332">0</span><span class="op" id="6259333">,</span>&nbsp;<span class="ident" id="6259335">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6259340">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259343">return</span>&nbsp;<span class="ident" id="6259350">w</span><span class="op" id="6259351">.</span><span class="ident" id="6259352">write</span><span class="op" id="6259357">(</span><span class="ident" id="6259358">pr</span><span class="op" id="6259360">,</span>&nbsp;<span class="ident" id="6259362">s</span><span class="op" id="6259363">)</span><br>
<span class="lineno"></span><span class="op" id="6259365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6259368">//&nbsp;write&nbsp;generates&nbsp;and&nbsp;writes&nbsp;a&nbsp;syslog&nbsp;formatted&nbsp;string.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="6259429">//&nbsp;format&nbsp;is&nbsp;as&nbsp;follows:&nbsp;&lt;PRI&gt;TIMESTAMP&nbsp;HOSTNAME&nbsp;TAG[PID]:&nbsp;MSG</span><br>
<span class="lineno">270</span><span class="keyword" id="6259492">func</span>&nbsp;<span class="op" id="6259497">(</span><span class="ident" id="6259498">w</span>&nbsp;<span class="op" id="6259500">*</span><span class="ident" id="6259501">Writer</span><span class="op" id="6259507">)</span>&nbsp;<span class="ident" id="6259509">write</span><span class="op" id="6259514">(</span><span class="ident" id="6259515">p</span>&nbsp;<span class="ident" id="6259517">Priority</span><span class="op" id="6259525">,</span>&nbsp;<span class="ident" id="6259527">msg</span>&nbsp;<span class="builtintype" id="6259531">string</span><span class="op" id="6259537">)</span>&nbsp;<span class="op" id="6259539">(</span><span class="builtintype" id="6259540">int</span><span class="op" id="6259543">,</span>&nbsp;<span class="builtintype" id="6259545">error</span><span class="op" id="6259550">)</span>&nbsp;<span class="op" id="6259552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6259555">//&nbsp;ensure&nbsp;it&nbsp;ends&nbsp;in&nbsp;a&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259582">nl</span>&nbsp;<span class="op" id="6259585">:=</span>&nbsp;<span class="string" id="6259588">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259592">if</span>&nbsp;<span class="op" id="6259595">!</span><span class="ident" id="6259596">strings</span><span class="op" id="6259603">.</span><span class="ident" id="6259604">HasSuffix</span><span class="op" id="6259613">(</span><span class="ident" id="6259614">msg</span><span class="op" id="6259617">,</span>&nbsp;<span class="string" id="6259619">&#34;\n&#34;</span><span class="op" id="6259623">)</span>&nbsp;<span class="op" id="6259625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259629">nl</span>&nbsp;<span class="op" id="6259632">=</span>&nbsp;<span class="string" id="6259634">&#34;\n&#34;</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6259640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6259644">err</span>&nbsp;<span class="op" id="6259648">:=</span>&nbsp;<span class="ident" id="6259651">w</span><span class="op" id="6259652">.</span><span class="ident" id="6259653">conn</span><span class="op" id="6259657">.</span><span class="ident" id="6259658">writeString</span><span class="op" id="6259669">(</span><span class="ident" id="6259670">p</span><span class="op" id="6259671">,</span>&nbsp;<span class="ident" id="6259673">w</span><span class="op" id="6259674">.</span><span class="ident" id="6259675">hostname</span><span class="op" id="6259683">,</span>&nbsp;<span class="ident" id="6259685">w</span><span class="op" id="6259686">.</span><span class="ident" id="6259687">tag</span><span class="op" id="6259690">,</span>&nbsp;<span class="ident" id="6259692">msg</span><span class="op" id="6259695">,</span>&nbsp;<span class="ident" id="6259697">nl</span><span class="op" id="6259699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259702">if</span>&nbsp;<span class="ident" id="6259705">err</span>&nbsp;<span class="op" id="6259709">!=</span>&nbsp;<span class="ident" id="6259712">nil</span>&nbsp;<span class="op" id="6259716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259720">return</span>&nbsp;<span class="num" id="6259727">0</span><span class="op" id="6259728">,</span>&nbsp;<span class="ident" id="6259730">err</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6259735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6259738">//&nbsp;Note:&nbsp;return&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input,&nbsp;not&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6259798">//&nbsp;bytes&nbsp;printed&nbsp;by&nbsp;Fprintf,&nbsp;because&nbsp;this&nbsp;must&nbsp;behave&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6259858">//&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259876">return</span>&nbsp;<span class="builtinfunc" id="6259883">len</span><span class="op" id="6259886">(</span><span class="ident" id="6259887">msg</span><span class="op" id="6259890">)</span><span class="op" id="6259891">,</span>&nbsp;<span class="ident" id="6259893">nil</span><br>
<span class="lineno">285</span><span class="op" id="6259897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6259900">func</span>&nbsp;<span class="op" id="6259905">(</span><span class="ident" id="6259906">n</span>&nbsp;<span class="op" id="6259908">*</span><span class="ident" id="6259909">netConn</span><span class="op" id="6259916">)</span>&nbsp;<span class="ident" id="6259918">writeString</span><span class="op" id="6259929">(</span><span class="ident" id="6259930">p</span>&nbsp;<span class="ident" id="6259932">Priority</span><span class="op" id="6259940">,</span>&nbsp;<span class="ident" id="6259942">hostname</span><span class="op" id="6259950">,</span>&nbsp;<span class="ident" id="6259952">tag</span><span class="op" id="6259955">,</span>&nbsp;<span class="ident" id="6259957">msg</span><span class="op" id="6259960">,</span>&nbsp;<span class="ident" id="6259962">nl</span>&nbsp;<span class="builtintype" id="6259965">string</span><span class="op" id="6259971">)</span>&nbsp;<span class="builtintype" id="6259973">error</span>&nbsp;<span class="op" id="6259979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6259982">if</span>&nbsp;<span class="ident" id="6259985">n</span><span class="op" id="6259986">.</span><span class="ident" id="6259987">local</span>&nbsp;<span class="op" id="6259993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6259997">//&nbsp;Compared&nbsp;to&nbsp;the&nbsp;network&nbsp;form&nbsp;below,&nbsp;the&nbsp;changes&nbsp;are:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6260055">//&nbsp;&nbsp;&nbsp;&nbsp1.&nbsp;Use&nbsp;time.Stamp&nbsp;instead&nbsp;of&nbsp;time.RFC3339.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6260103">//&nbsp;&nbsp;&nbsp;&nbsp2.&nbsp;Drop&nbsp;the&nbsp;hostname&nbsp;field&nbsp;from&nbsp;the&nbsp;Fprintf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260153">timestamp</span>&nbsp;<span class="op" id="6260163">:=</span>&nbsp;<span class="ident" id="6260166">time</span><span class="op" id="6260170">.</span><span class="ident" id="6260171">Now</span><span class="op" id="6260174">(</span><span class="op" id="6260175">)</span><span class="op" id="6260176">.</span><span class="ident" id="6260177">Format</span><span class="op" id="6260183">(</span><span class="ident" id="6260184">time</span><span class="op" id="6260188">.</span><span class="ident" id="6260189">Stamp</span><span class="op" id="6260194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260198">_</span><span class="op" id="6260199">,</span>&nbsp;<span class="ident" id="6260201">err</span>&nbsp;<span class="op" id="6260205">:=</span>&nbsp;<span class="ident" id="6260208">fmt</span><span class="op" id="6260211">.</span><span class="ident" id="6260212">Fprintf</span><span class="op" id="6260219">(</span><span class="ident" id="6260220">n</span><span class="op" id="6260221">.</span><span class="ident" id="6260222">conn</span><span class="op" id="6260226">,</span>&nbsp;<span class="string" id="6260228">&#34;&lt;%d&gt;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6260249">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260254">p</span><span class="op" id="6260255">,</span>&nbsp;<span class="ident" id="6260257">timestamp</span><span class="op" id="6260266">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260271">tag</span><span class="op" id="6260274">,</span>&nbsp;<span class="ident" id="6260276">os</span><span class="op" id="6260278">.</span><span class="ident" id="6260279">Getpid</span><span class="op" id="6260285">(</span><span class="op" id="6260286">)</span><span class="op" id="6260287">,</span>&nbsp;<span class="ident" id="6260289">msg</span><span class="op" id="6260292">,</span>&nbsp;<span class="ident" id="6260294">nl</span><span class="op" id="6260296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260300">return</span>&nbsp;<span class="ident" id="6260307">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260315">timestamp</span>&nbsp;<span class="op" id="6260325">:=</span>&nbsp;<span class="ident" id="6260328">time</span><span class="op" id="6260332">.</span><span class="ident" id="6260333">Now</span><span class="op" id="6260336">(</span><span class="op" id="6260337">)</span><span class="op" id="6260338">.</span><span class="ident" id="6260339">Format</span><span class="op" id="6260345">(</span><span class="ident" id="6260346">time</span><span class="op" id="6260350">.</span><span class="ident" id="6260351">RFC3339</span><span class="op" id="6260358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260361">_</span><span class="op" id="6260362">,</span>&nbsp;<span class="ident" id="6260364">err</span>&nbsp;<span class="op" id="6260368">:=</span>&nbsp;<span class="ident" id="6260371">fmt</span><span class="op" id="6260374">.</span><span class="ident" id="6260375">Fprintf</span><span class="op" id="6260382">(</span><span class="ident" id="6260383">n</span><span class="op" id="6260384">.</span><span class="ident" id="6260385">conn</span><span class="op" id="6260389">,</span>&nbsp;<span class="string" id="6260391">&#34;&lt;%d&gt;%s&nbsp;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6260415">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260419">p</span><span class="op" id="6260420">,</span>&nbsp;<span class="ident" id="6260422">timestamp</span><span class="op" id="6260431">,</span>&nbsp;<span class="ident" id="6260433">hostname</span><span class="op" id="6260441">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260445">tag</span><span class="op" id="6260448">,</span>&nbsp;<span class="ident" id="6260450">os</span><span class="op" id="6260452">.</span><span class="ident" id="6260453">Getpid</span><span class="op" id="6260459">(</span><span class="op" id="6260460">)</span><span class="op" id="6260461">,</span>&nbsp;<span class="ident" id="6260463">msg</span><span class="op" id="6260466">,</span>&nbsp;<span class="ident" id="6260468">nl</span><span class="op" id="6260470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260473">return</span>&nbsp;<span class="ident" id="6260480">err</span><br>
<span class="lineno"></span><span class="op" id="6260484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="6260487">func</span>&nbsp;<span class="op" id="6260492">(</span><span class="ident" id="6260493">n</span>&nbsp;<span class="op" id="6260495">*</span><span class="ident" id="6260496">netConn</span><span class="op" id="6260503">)</span>&nbsp;<span class="builtinfunc" id="6260505">close</span><span class="op" id="6260510">(</span><span class="op" id="6260511">)</span>&nbsp;<span class="builtintype" id="6260513">error</span>&nbsp;<span class="op" id="6260519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260522">return</span>&nbsp;<span class="ident" id="6260529">n</span><span class="op" id="6260530">.</span><span class="ident" id="6260531">conn</span><span class="op" id="6260535">.</span><span class="ident" id="6260536">Close</span><span class="op" id="6260541">(</span><span class="op" id="6260542">)</span><br>
<span class="lineno"></span><span class="op" id="6260544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6260547">//&nbsp;NewLogger&nbsp;creates&nbsp;a&nbsp;log.Logger&nbsp;whose&nbsp;output&nbsp;is&nbsp;written&nbsp;to</span><br>
<span class="lineno">310</span><span class="comment" id="6260608">//&nbsp;the&nbsp;system&nbsp;log&nbsp;service&nbsp;with&nbsp;the&nbsp;specified&nbsp;priority.&nbsp;The&nbsp;logFlag</span><br>
<span class="lineno"></span><span class="comment" id="6260675">//&nbsp;argument&nbsp;is&nbsp;the&nbsp;flag&nbsp;set&nbsp;passed&nbsp;through&nbsp;to&nbsp;log.New&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="6260739">//&nbsp;the&nbsp;Logger.</span><br>
<span class="lineno"></span><span class="keyword" id="6260754">func</span>&nbsp;<span class="ident" id="6260759">NewLogger</span><span class="op" id="6260768">(</span><span class="ident" id="6260769">p</span>&nbsp;<span class="ident" id="6260771">Priority</span><span class="op" id="6260779">,</span>&nbsp;<span class="ident" id="6260781">logFlag</span>&nbsp;<span class="builtintype" id="6260789">int</span><span class="op" id="6260792">)</span>&nbsp;<span class="op" id="6260794">(</span><span class="op" id="6260795">*</span><span class="ident" id="6260796">log</span><span class="op" id="6260799">.</span><span class="ident" id="6260800">Logger</span><span class="op" id="6260806">,</span>&nbsp;<span class="builtintype" id="6260808">error</span><span class="op" id="6260813">)</span>&nbsp;<span class="op" id="6260815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6260818">s</span><span class="op" id="6260819">,</span>&nbsp;<span class="ident" id="6260821">err</span>&nbsp;<span class="op" id="6260825">:=</span>&nbsp;<span class="ident" id="6260828">New</span><span class="op" id="6260831">(</span><span class="ident" id="6260832">p</span><span class="op" id="6260833">,</span>&nbsp;<span class="string" id="6260835">&#34;&#34;</span><span class="op" id="6260837">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260840">if</span>&nbsp;<span class="ident" id="6260843">err</span>&nbsp;<span class="op" id="6260847">!=</span>&nbsp;<span class="ident" id="6260850">nil</span>&nbsp;<span class="op" id="6260854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260858">return</span>&nbsp;<span class="ident" id="6260865">nil</span><span class="op" id="6260868">,</span>&nbsp;<span class="ident" id="6260870">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6260875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6260878">return</span>&nbsp;<span class="ident" id="6260885">log</span><span class="op" id="6260888">.</span><span class="ident" id="6260889">New</span><span class="op" id="6260892">(</span><span class="ident" id="6260893">s</span><span class="op" id="6260894">,</span>&nbsp;<span class="string" id="6260896">&#34;&#34;</span><span class="op" id="6260898">,</span>&nbsp;<span class="ident" id="6260900">logFlag</span><span class="op" id="6260907">)</span><span class="op" id="6260908">,</span>&nbsp;<span class="ident" id="6260910">nil</span><br>
<span class="lineno"></span><span class="op" id="6260914">}</span>
</div>
</body>
</html>
