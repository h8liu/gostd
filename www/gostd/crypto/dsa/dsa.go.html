<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/dsa</h2>
<ul>
<li><a href="/gostd/crypto/dsa/dsa.go.html">dsa.go</a></li>
<li><a href="/gostd/crypto/dsa/dsa_test.go.html">dsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4198220">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4198275">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4198329">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4198380">//&nbsp;Package&nbsp;dsa&nbsp;implements&nbsp;the&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4198465">package</span>&nbsp;<span class="ident" id="4198473">dsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4198478">import</span>&nbsp;<span class="op" id="4198485">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4198488">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4198498">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4198504">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4198515">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4198518">//&nbsp;Parameters&nbsp;represents&nbsp;the&nbsp;domain&nbsp;parameters&nbsp;for&nbsp;a&nbsp;key.&nbsp;These&nbsp;parameters&nbsp;can</span><br>
<span class="lineno">15</span><span class="comment" id="4198597">//&nbsp;be&nbsp;shared&nbsp;across&nbsp;many&nbsp;keys.&nbsp;The&nbsp;bit&nbsp;length&nbsp;of&nbsp;Q&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="4198673">type</span>&nbsp;<span class="ident" id="4198678">Parameters</span>&nbsp;<span class="keyword" id="4198689">struct</span>&nbsp;<span class="op" id="4198696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198699">P</span><span class="op" id="4198700">,</span>&nbsp;<span class="ident" id="4198702">Q</span><span class="op" id="4198703">,</span>&nbsp;<span class="ident" id="4198705">G</span>&nbsp;<span class="op" id="4198707">*</span><span class="ident" id="4198708">big</span><span class="op" id="4198711">.</span><span class="ident" id="4198712">Int</span><br>
<span class="lineno"></span><span class="op" id="4198716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4198719">//&nbsp;PublicKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4198761">type</span>&nbsp;<span class="ident" id="4198766">PublicKey</span>&nbsp;<span class="keyword" id="4198776">struct</span>&nbsp;<span class="op" id="4198783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198786">Parameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198798">Y</span>&nbsp;<span class="op" id="4198800">*</span><span class="ident" id="4198801">big</span><span class="op" id="4198804">.</span><span class="ident" id="4198805">Int</span><br>
<span class="lineno"></span><span class="op" id="4198809">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4198812">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4198856">type</span>&nbsp;<span class="ident" id="4198861">PrivateKey</span>&nbsp;<span class="keyword" id="4198872">struct</span>&nbsp;<span class="op" id="4198879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198882">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4198893">X</span>&nbsp;<span class="op" id="4198895">*</span><span class="ident" id="4198896">big</span><span class="op" id="4198899">.</span><span class="ident" id="4198900">Int</span><br>
<span class="lineno">30</span><span class="op" id="4198904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4198907">//&nbsp;ErrInvalidPublicKey&nbsp;results&nbsp;when&nbsp;a&nbsp;public&nbsp;key&nbsp;is&nbsp;not&nbsp;usable&nbsp;by&nbsp;this&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4198984">//&nbsp;FIPS&nbsp;is&nbsp;quite&nbsp;strict&nbsp;about&nbsp;the&nbsp;format&nbsp;of&nbsp;DSA&nbsp;keys,&nbsp;but&nbsp;other&nbsp;code&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4199060">//&nbsp;less&nbsp;so.&nbsp;Thus,&nbsp;when&nbsp;using&nbsp;keys&nbsp;which&nbsp;may&nbsp;have&nbsp;been&nbsp;generated&nbsp;by&nbsp;other&nbsp;code,</span><br>
<span class="lineno">35</span><span class="comment" id="4199139">//&nbsp;this&nbsp;error&nbsp;must&nbsp;be&nbsp;handled.</span><br>
<span class="lineno"></span><span class="keyword" id="4199170">var</span>&nbsp;<span class="ident" id="4199174">ErrInvalidPublicKey</span>&nbsp;<span class="op" id="4199194">=</span>&nbsp;<span class="ident" id="4199196">errors</span><span class="op" id="4199202">.</span><span class="ident" id="4199203">New</span><span class="op" id="4199206">(</span><span class="string" id="4199207">&#34;crypto/dsa:&nbsp;invalid&nbsp;public&nbsp;key&#34;</span><span class="op" id="4199239">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4199242">//&nbsp;ParameterSizes&nbsp;is&nbsp;a&nbsp;enumeration&nbsp;of&nbsp;the&nbsp;acceptable&nbsp;bit&nbsp;lengths&nbsp;of&nbsp;the&nbsp;primes</span><br>
<span class="lineno"></span><span class="comment" id="4199321">//&nbsp;in&nbsp;a&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters.&nbsp;See&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.2.</span><br>
<span class="lineno">40</span><span class="keyword" id="4199381">type</span>&nbsp;<span class="ident" id="4199386">ParameterSizes</span>&nbsp;<span class="builtintype" id="4199401">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4199406">const</span>&nbsp;<span class="op" id="4199412">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199415">L1024N160</span>&nbsp;<span class="ident" id="4199425">ParameterSizes</span>&nbsp;<span class="op" id="4199440">=</span>&nbsp;<span class="ident" id="4199442">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199448">L2048N224</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199459">L2048N256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4199470">L3072N256</span><br>
<span class="lineno"></span><span class="op" id="4199480">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4199483">//&nbsp;numMRTests&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;Miller-Rabin&nbsp;primality&nbsp;tests&nbsp;that&nbsp;we&nbsp;perform.&nbsp;We</span><br>
<span class="lineno">50</span><span class="comment" id="4199563">//&nbsp;pick&nbsp;the&nbsp;largest&nbsp;recommended&nbsp;number&nbsp;from&nbsp;table&nbsp;C.1&nbsp;of&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4199632">const</span>&nbsp;<span class="ident" id="4199638">numMRTests</span>&nbsp;<span class="op" id="4199649">=</span>&nbsp;<span class="num" id="4199651">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4199655">//&nbsp;GenerateParameters&nbsp;puts&nbsp;a&nbsp;random,&nbsp;valid&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters&nbsp;into&nbsp;params.</span><br>
<span class="lineno"></span><span class="comment" id="4199733">//&nbsp;This&nbsp;function&nbsp;takes&nbsp;many&nbsp;seconds,&nbsp;even&nbsp;on&nbsp;fast&nbsp;machines.</span><br>
<span class="lineno">55</span><span class="keyword" id="4199793">func</span>&nbsp;<span class="ident" id="4199798">GenerateParameters</span><span class="op" id="4199816">(</span><span class="ident" id="4199817">params</span>&nbsp;<span class="op" id="4199824">*</span><span class="ident" id="4199825">Parameters</span><span class="op" id="4199835">,</span>&nbsp;<span class="ident" id="4199837">rand</span>&nbsp;<span class="ident" id="4199842">io</span><span class="op" id="4199844">.</span><span class="ident" id="4199845">Reader</span><span class="op" id="4199851">,</span>&nbsp;<span class="ident" id="4199853">sizes</span>&nbsp;<span class="ident" id="4199859">ParameterSizes</span><span class="op" id="4199873">)</span>&nbsp;<span class="op" id="4199875">(</span><span class="ident" id="4199876">err</span>&nbsp;<span class="builtintype" id="4199880">error</span><span class="op" id="4199885">)</span>&nbsp;<span class="op" id="4199887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4199890">//&nbsp;This&nbsp;function&nbsp;doesn&#39;t&nbsp;follow&nbsp;FIPS&nbsp;186-3&nbsp;exactly&nbsp;in&nbsp;that&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4199961">//&nbsp;use&nbsp;a&nbsp;verification&nbsp;seed&nbsp;to&nbsp;generate&nbsp;the&nbsp;primes.&nbsp;The&nbsp;verification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4200030">//&nbsp;seed&nbsp;doesn&#39;t&nbsp;appear&nbsp;to&nbsp;be&nbsp;exported&nbsp;or&nbsp;used&nbsp;by&nbsp;other&nbsp;code&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4200095">//&nbsp;omitting&nbsp;it&nbsp;makes&nbsp;the&nbsp;code&nbsp;cleaner.</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200136">var</span>&nbsp;<span class="ident" id="4200140">L</span><span class="op" id="4200141">,</span>&nbsp;<span class="ident" id="4200143">N</span>&nbsp;<span class="builtintype" id="4200145">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200150">switch</span>&nbsp;<span class="ident" id="4200157">sizes</span>&nbsp;<span class="op" id="4200163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200166">case</span>&nbsp;<span class="ident" id="4200171">L1024N160</span><span class="op" id="4200180">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200184">L</span>&nbsp;<span class="op" id="4200186">=</span>&nbsp;<span class="num" id="4200188">1024</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200195">N</span>&nbsp;<span class="op" id="4200197">=</span>&nbsp;<span class="num" id="4200199">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200204">case</span>&nbsp;<span class="ident" id="4200209">L2048N224</span><span class="op" id="4200218">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200222">L</span>&nbsp;<span class="op" id="4200224">=</span>&nbsp;<span class="num" id="4200226">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200233">N</span>&nbsp;<span class="op" id="4200235">=</span>&nbsp;<span class="num" id="4200237">224</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200242">case</span>&nbsp;<span class="ident" id="4200247">L2048N256</span><span class="op" id="4200256">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200260">L</span>&nbsp;<span class="op" id="4200262">=</span>&nbsp;<span class="num" id="4200264">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200271">N</span>&nbsp;<span class="op" id="4200273">=</span>&nbsp;<span class="num" id="4200275">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200280">case</span>&nbsp;<span class="ident" id="4200285">L3072N256</span><span class="op" id="4200294">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200298">L</span>&nbsp;<span class="op" id="4200300">=</span>&nbsp;<span class="num" id="4200302">3072</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200309">N</span>&nbsp;<span class="op" id="4200311">=</span>&nbsp;<span class="num" id="4200313">256</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200318">default</span><span class="op" id="4200325">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200329">return</span>&nbsp;<span class="ident" id="4200336">errors</span><span class="op" id="4200342">.</span><span class="ident" id="4200343">New</span><span class="op" id="4200346">(</span><span class="string" id="4200347">&#34;crypto/dsa:&nbsp;invalid&nbsp;ParameterSizes&#34;</span><span class="op" id="4200383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200390">qBytes</span>&nbsp;<span class="op" id="4200397">:=</span>&nbsp;<span class="builtinfunc" id="4200400">make</span><span class="op" id="4200404">(</span><span class="op" id="4200405">[</span><span class="op" id="4200406">]</span><span class="builtintype" id="4200407">byte</span><span class="op" id="4200411">,</span>&nbsp;<span class="ident" id="4200413">N</span><span class="op" id="4200414">/</span><span class="num" id="4200415">8</span><span class="op" id="4200416">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200419">pBytes</span>&nbsp;<span class="op" id="4200426">:=</span>&nbsp;<span class="builtinfunc" id="4200429">make</span><span class="op" id="4200433">(</span><span class="op" id="4200434">[</span><span class="op" id="4200435">]</span><span class="builtintype" id="4200436">byte</span><span class="op" id="4200440">,</span>&nbsp;<span class="ident" id="4200442">L</span><span class="op" id="4200443">/</span><span class="num" id="4200444">8</span><span class="op" id="4200445">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200449">q</span>&nbsp;<span class="op" id="4200451">:=</span>&nbsp;<span class="builtinfunc" id="4200454">new</span><span class="op" id="4200457">(</span><span class="ident" id="4200458">big</span><span class="op" id="4200461">.</span><span class="ident" id="4200462">Int</span><span class="op" id="4200465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200468">p</span>&nbsp;<span class="op" id="4200470">:=</span>&nbsp;<span class="builtinfunc" id="4200473">new</span><span class="op" id="4200476">(</span><span class="ident" id="4200477">big</span><span class="op" id="4200480">.</span><span class="ident" id="4200481">Int</span><span class="op" id="4200484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200487">rem</span>&nbsp;<span class="op" id="4200491">:=</span>&nbsp;<span class="builtinfunc" id="4200494">new</span><span class="op" id="4200497">(</span><span class="ident" id="4200498">big</span><span class="op" id="4200501">.</span><span class="ident" id="4200502">Int</span><span class="op" id="4200505">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200508">one</span>&nbsp;<span class="op" id="4200512">:=</span>&nbsp;<span class="builtinfunc" id="4200515">new</span><span class="op" id="4200518">(</span><span class="ident" id="4200519">big</span><span class="op" id="4200522">.</span><span class="ident" id="4200523">Int</span><span class="op" id="4200526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200529">one</span><span class="op" id="4200532">.</span><span class="ident" id="4200533">SetInt64</span><span class="op" id="4200541">(</span><span class="num" id="4200542">1</span><span class="op" id="4200543">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4200546">GeneratePrimes</span><span class="op" id="4200560">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200563">for</span>&nbsp;<span class="op" id="4200567">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200571">_</span><span class="op" id="4200572">,</span>&nbsp;<span class="ident" id="4200574">err</span>&nbsp;<span class="op" id="4200578">=</span>&nbsp;<span class="ident" id="4200580">io</span><span class="op" id="4200582">.</span><span class="ident" id="4200583">ReadFull</span><span class="op" id="4200591">(</span><span class="ident" id="4200592">rand</span><span class="op" id="4200596">,</span>&nbsp;<span class="ident" id="4200598">qBytes</span><span class="op" id="4200604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200608">if</span>&nbsp;<span class="ident" id="4200611">err</span>&nbsp;<span class="op" id="4200615">!=</span>&nbsp;<span class="ident" id="4200618">nil</span>&nbsp;<span class="op" id="4200622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200627">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200641">qBytes</span><span class="op" id="4200647">[</span><span class="builtinfunc" id="4200648">len</span><span class="op" id="4200651">(</span><span class="ident" id="4200652">qBytes</span><span class="op" id="4200658">)</span><span class="op" id="4200659">-</span><span class="num" id="4200660">1</span><span class="op" id="4200661">]</span>&nbsp;<span class="op" id="4200663">|=</span>&nbsp;<span class="num" id="4200666">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200670">qBytes</span><span class="op" id="4200676">[</span><span class="num" id="4200677">0</span><span class="op" id="4200678">]</span>&nbsp;<span class="op" id="4200680">|=</span>&nbsp;<span class="num" id="4200683">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200690">q</span><span class="op" id="4200691">.</span><span class="ident" id="4200692">SetBytes</span><span class="op" id="4200700">(</span><span class="ident" id="4200701">qBytes</span><span class="op" id="4200707">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200712">if</span>&nbsp;<span class="op" id="4200715">!</span><span class="ident" id="4200716">q</span><span class="op" id="4200717">.</span><span class="ident" id="4200718">ProbablyPrime</span><span class="op" id="4200731">(</span><span class="ident" id="4200732">numMRTests</span><span class="op" id="4200742">)</span>&nbsp;<span class="op" id="4200744">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200749">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200765">for</span>&nbsp;<span class="ident" id="4200769">i</span>&nbsp;<span class="op" id="4200771">:=</span>&nbsp;<span class="num" id="4200774">0</span><span class="op" id="4200775">;</span>&nbsp;<span class="ident" id="4200777">i</span>&nbsp;<span class="op" id="4200779">&lt;</span>&nbsp;<span class="num" id="4200781">4</span><span class="op" id="4200782">*</span><span class="ident" id="4200783">L</span><span class="op" id="4200784">;</span>&nbsp;<span class="ident" id="4200786">i</span><span class="op" id="4200787">++</span>&nbsp;<span class="op" id="4200790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200795">_</span><span class="op" id="4200796">,</span>&nbsp;<span class="ident" id="4200798">err</span>&nbsp;<span class="op" id="4200802">=</span>&nbsp;<span class="ident" id="4200804">io</span><span class="op" id="4200806">.</span><span class="ident" id="4200807">ReadFull</span><span class="op" id="4200815">(</span><span class="ident" id="4200816">rand</span><span class="op" id="4200820">,</span>&nbsp;<span class="ident" id="4200822">pBytes</span><span class="op" id="4200828">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200833">if</span>&nbsp;<span class="ident" id="4200836">err</span>&nbsp;<span class="op" id="4200840">!=</span>&nbsp;<span class="ident" id="4200843">nil</span>&nbsp;<span class="op" id="4200847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200853">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4200863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200869">pBytes</span><span class="op" id="4200875">[</span><span class="builtinfunc" id="4200876">len</span><span class="op" id="4200879">(</span><span class="ident" id="4200880">pBytes</span><span class="op" id="4200886">)</span><span class="op" id="4200887">-</span><span class="num" id="4200888">1</span><span class="op" id="4200889">]</span>&nbsp;<span class="op" id="4200891">|=</span>&nbsp;<span class="num" id="4200894">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200899">pBytes</span><span class="op" id="4200905">[</span><span class="num" id="4200906">0</span><span class="op" id="4200907">]</span>&nbsp;<span class="op" id="4200909">|=</span>&nbsp;<span class="num" id="4200912">0x80</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200921">p</span><span class="op" id="4200922">.</span><span class="ident" id="4200923">SetBytes</span><span class="op" id="4200931">(</span><span class="ident" id="4200932">pBytes</span><span class="op" id="4200938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200943">rem</span><span class="op" id="4200946">.</span><span class="ident" id="4200947">Mod</span><span class="op" id="4200950">(</span><span class="ident" id="4200951">p</span><span class="op" id="4200952">,</span>&nbsp;<span class="ident" id="4200954">q</span><span class="op" id="4200955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200960">rem</span><span class="op" id="4200963">.</span><span class="ident" id="4200964">Sub</span><span class="op" id="4200967">(</span><span class="ident" id="4200968">rem</span><span class="op" id="4200971">,</span>&nbsp;<span class="ident" id="4200973">one</span><span class="op" id="4200976">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4200981">p</span><span class="op" id="4200982">.</span><span class="ident" id="4200983">Sub</span><span class="op" id="4200986">(</span><span class="ident" id="4200987">p</span><span class="op" id="4200988">,</span>&nbsp;<span class="ident" id="4200990">rem</span><span class="op" id="4200993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4200998">if</span>&nbsp;<span class="ident" id="4201001">p</span><span class="op" id="4201002">.</span><span class="ident" id="4201003">BitLen</span><span class="op" id="4201009">(</span><span class="op" id="4201010">)</span>&nbsp;<span class="op" id="4201012">&lt;</span>&nbsp;<span class="ident" id="4201014">L</span>&nbsp;<span class="op" id="4201016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201022">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201040">if</span>&nbsp;<span class="op" id="4201043">!</span><span class="ident" id="4201044">p</span><span class="op" id="4201045">.</span><span class="ident" id="4201046">ProbablyPrime</span><span class="op" id="4201059">(</span><span class="ident" id="4201060">numMRTests</span><span class="op" id="4201070">)</span>&nbsp;<span class="op" id="4201072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201078">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201096">params</span><span class="op" id="4201102">.</span><span class="ident" id="4201103">P</span>&nbsp;<span class="op" id="4201105">=</span>&nbsp;<span class="ident" id="4201107">p</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201112">params</span><span class="op" id="4201118">.</span><span class="ident" id="4201119">Q</span>&nbsp;<span class="op" id="4201121">=</span>&nbsp;<span class="ident" id="4201123">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201128">break</span>&nbsp;<span class="ident" id="4201134">GeneratePrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201158">h</span>&nbsp;<span class="op" id="4201160">:=</span>&nbsp;<span class="builtinfunc" id="4201163">new</span><span class="op" id="4201166">(</span><span class="ident" id="4201167">big</span><span class="op" id="4201170">.</span><span class="ident" id="4201171">Int</span><span class="op" id="4201174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201177">h</span><span class="op" id="4201178">.</span><span class="ident" id="4201179">SetInt64</span><span class="op" id="4201187">(</span><span class="num" id="4201188">2</span><span class="op" id="4201189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201192">g</span>&nbsp;<span class="op" id="4201194">:=</span>&nbsp;<span class="builtinfunc" id="4201197">new</span><span class="op" id="4201200">(</span><span class="ident" id="4201201">big</span><span class="op" id="4201204">.</span><span class="ident" id="4201205">Int</span><span class="op" id="4201208">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201212">pm1</span>&nbsp;<span class="op" id="4201216">:=</span>&nbsp;<span class="builtinfunc" id="4201219">new</span><span class="op" id="4201222">(</span><span class="ident" id="4201223">big</span><span class="op" id="4201226">.</span><span class="ident" id="4201227">Int</span><span class="op" id="4201230">)</span><span class="op" id="4201231">.</span><span class="ident" id="4201232">Sub</span><span class="op" id="4201235">(</span><span class="ident" id="4201236">p</span><span class="op" id="4201237">,</span>&nbsp;<span class="ident" id="4201239">one</span><span class="op" id="4201242">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201245">e</span>&nbsp;<span class="op" id="4201247">:=</span>&nbsp;<span class="builtinfunc" id="4201250">new</span><span class="op" id="4201253">(</span><span class="ident" id="4201254">big</span><span class="op" id="4201257">.</span><span class="ident" id="4201258">Int</span><span class="op" id="4201261">)</span><span class="op" id="4201262">.</span><span class="ident" id="4201263">Div</span><span class="op" id="4201266">(</span><span class="ident" id="4201267">pm1</span><span class="op" id="4201270">,</span>&nbsp;<span class="ident" id="4201272">q</span><span class="op" id="4201273">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201277">for</span>&nbsp;<span class="op" id="4201281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201285">g</span><span class="op" id="4201286">.</span><span class="ident" id="4201287">Exp</span><span class="op" id="4201290">(</span><span class="ident" id="4201291">h</span><span class="op" id="4201292">,</span>&nbsp;<span class="ident" id="4201294">e</span><span class="op" id="4201295">,</span>&nbsp;<span class="ident" id="4201297">p</span><span class="op" id="4201298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201302">if</span>&nbsp;<span class="ident" id="4201305">g</span><span class="op" id="4201306">.</span><span class="ident" id="4201307">Cmp</span><span class="op" id="4201310">(</span><span class="ident" id="4201311">one</span><span class="op" id="4201314">)</span>&nbsp;<span class="op" id="4201316">==</span>&nbsp;<span class="num" id="4201319">0</span>&nbsp;<span class="op" id="4201321">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201326">h</span><span class="op" id="4201327">.</span><span class="ident" id="4201328">Add</span><span class="op" id="4201331">(</span><span class="ident" id="4201332">h</span><span class="op" id="4201333">,</span>&nbsp;<span class="ident" id="4201335">one</span><span class="op" id="4201338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201343">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201359">params</span><span class="op" id="4201365">.</span><span class="ident" id="4201366">G</span>&nbsp;<span class="op" id="4201368">=</span>&nbsp;<span class="ident" id="4201370">g</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201374">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201382">}</span><br>
<span class="lineno"></span><span class="op" id="4201384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4201387">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&amp;private&nbsp;key&nbsp;pair.&nbsp;The&nbsp;Parameters&nbsp;of&nbsp;the</span><br>
<span class="lineno">150</span><span class="comment" id="4201461">//&nbsp;PrivateKey&nbsp;must&nbsp;already&nbsp;be&nbsp;valid&nbsp;(see&nbsp;GenerateParameters).</span><br>
<span class="lineno"></span><span class="keyword" id="4201523">func</span>&nbsp;<span class="ident" id="4201528">GenerateKey</span><span class="op" id="4201539">(</span><span class="ident" id="4201540">priv</span>&nbsp;<span class="op" id="4201545">*</span><span class="ident" id="4201546">PrivateKey</span><span class="op" id="4201556">,</span>&nbsp;<span class="ident" id="4201558">rand</span>&nbsp;<span class="ident" id="4201563">io</span><span class="op" id="4201565">.</span><span class="ident" id="4201566">Reader</span><span class="op" id="4201572">)</span>&nbsp;<span class="builtintype" id="4201574">error</span>&nbsp;<span class="op" id="4201580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201583">if</span>&nbsp;<span class="ident" id="4201586">priv</span><span class="op" id="4201590">.</span><span class="ident" id="4201591">P</span>&nbsp;<span class="op" id="4201593">==</span>&nbsp;<span class="ident" id="4201596">nil</span>&nbsp;<span class="op" id="4201600">||</span>&nbsp;<span class="ident" id="4201603">priv</span><span class="op" id="4201607">.</span><span class="ident" id="4201608">Q</span>&nbsp;<span class="op" id="4201610">==</span>&nbsp;<span class="ident" id="4201613">nil</span>&nbsp;<span class="op" id="4201617">||</span>&nbsp;<span class="ident" id="4201620">priv</span><span class="op" id="4201624">.</span><span class="ident" id="4201625">G</span>&nbsp;<span class="op" id="4201627">==</span>&nbsp;<span class="ident" id="4201630">nil</span>&nbsp;<span class="op" id="4201634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201638">return</span>&nbsp;<span class="ident" id="4201645">errors</span><span class="op" id="4201651">.</span><span class="ident" id="4201652">New</span><span class="op" id="4201655">(</span><span class="string" id="4201656">&#34;crypto/dsa:&nbsp;parameters&nbsp;not&nbsp;set&nbsp;up&nbsp;before&nbsp;generating&nbsp;key&#34;</span><span class="op" id="4201713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201716">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201720">x</span>&nbsp;<span class="op" id="4201722">:=</span>&nbsp;<span class="builtinfunc" id="4201725">new</span><span class="op" id="4201728">(</span><span class="ident" id="4201729">big</span><span class="op" id="4201732">.</span><span class="ident" id="4201733">Int</span><span class="op" id="4201736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201739">xBytes</span>&nbsp;<span class="op" id="4201746">:=</span>&nbsp;<span class="builtinfunc" id="4201749">make</span><span class="op" id="4201753">(</span><span class="op" id="4201754">[</span><span class="op" id="4201755">]</span><span class="builtintype" id="4201756">byte</span><span class="op" id="4201760">,</span>&nbsp;<span class="ident" id="4201762">priv</span><span class="op" id="4201766">.</span><span class="ident" id="4201767">Q</span><span class="op" id="4201768">.</span><span class="ident" id="4201769">BitLen</span><span class="op" id="4201775">(</span><span class="op" id="4201776">)</span><span class="op" id="4201777">/</span><span class="num" id="4201778">8</span><span class="op" id="4201779">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201783">for</span>&nbsp;<span class="op" id="4201787">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201791">_</span><span class="op" id="4201792">,</span>&nbsp;<span class="ident" id="4201794">err</span>&nbsp;<span class="op" id="4201798">:=</span>&nbsp;<span class="ident" id="4201801">io</span><span class="op" id="4201803">.</span><span class="ident" id="4201804">ReadFull</span><span class="op" id="4201812">(</span><span class="ident" id="4201813">rand</span><span class="op" id="4201817">,</span>&nbsp;<span class="ident" id="4201819">xBytes</span><span class="op" id="4201825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201829">if</span>&nbsp;<span class="ident" id="4201832">err</span>&nbsp;<span class="op" id="4201836">!=</span>&nbsp;<span class="ident" id="4201839">nil</span>&nbsp;<span class="op" id="4201843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201848">return</span>&nbsp;<span class="ident" id="4201855">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201865">x</span><span class="op" id="4201866">.</span><span class="ident" id="4201867">SetBytes</span><span class="op" id="4201875">(</span><span class="ident" id="4201876">xBytes</span><span class="op" id="4201882">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201886">if</span>&nbsp;<span class="ident" id="4201889">x</span><span class="op" id="4201890">.</span><span class="ident" id="4201891">Sign</span><span class="op" id="4201895">(</span><span class="op" id="4201896">)</span>&nbsp;<span class="op" id="4201898">!=</span>&nbsp;<span class="num" id="4201901">0</span>&nbsp;<span class="op" id="4201903">&amp;&amp;</span>&nbsp;<span class="ident" id="4201906">x</span><span class="op" id="4201907">.</span><span class="ident" id="4201908">Cmp</span><span class="op" id="4201911">(</span><span class="ident" id="4201912">priv</span><span class="op" id="4201916">.</span><span class="ident" id="4201917">Q</span><span class="op" id="4201918">)</span>&nbsp;<span class="op" id="4201920">&lt;</span>&nbsp;<span class="num" id="4201922">0</span>&nbsp;<span class="op" id="4201924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4201929">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4201940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201944">priv</span><span class="op" id="4201948">.</span><span class="ident" id="4201949">X</span>&nbsp;<span class="op" id="4201951">=</span>&nbsp;<span class="ident" id="4201953">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201956">priv</span><span class="op" id="4201960">.</span><span class="ident" id="4201961">Y</span>&nbsp;<span class="op" id="4201963">=</span>&nbsp;<span class="builtinfunc" id="4201965">new</span><span class="op" id="4201968">(</span><span class="ident" id="4201969">big</span><span class="op" id="4201972">.</span><span class="ident" id="4201973">Int</span><span class="op" id="4201976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4201979">priv</span><span class="op" id="4201983">.</span><span class="ident" id="4201984">Y</span><span class="op" id="4201985">.</span><span class="ident" id="4201986">Exp</span><span class="op" id="4201989">(</span><span class="ident" id="4201990">priv</span><span class="op" id="4201994">.</span><span class="ident" id="4201995">G</span><span class="op" id="4201996">,</span>&nbsp;<span class="ident" id="4201998">x</span><span class="op" id="4201999">,</span>&nbsp;<span class="ident" id="4202001">priv</span><span class="op" id="4202005">.</span><span class="ident" id="4202006">P</span><span class="op" id="4202007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202010">return</span>&nbsp;<span class="ident" id="4202017">nil</span><br>
<span class="lineno"></span><span class="op" id="4202021">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4202024">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4202101">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4202179">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4202250">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">180</span><span class="keyword" id="4202288">func</span>&nbsp;<span class="ident" id="4202293">fermatInverse</span><span class="op" id="4202306">(</span><span class="ident" id="4202307">k</span><span class="op" id="4202308">,</span>&nbsp;<span class="ident" id="4202310">P</span>&nbsp;<span class="op" id="4202312">*</span><span class="ident" id="4202313">big</span><span class="op" id="4202316">.</span><span class="ident" id="4202317">Int</span><span class="op" id="4202320">)</span>&nbsp;<span class="op" id="4202322">*</span><span class="ident" id="4202323">big</span><span class="op" id="4202326">.</span><span class="ident" id="4202327">Int</span>&nbsp;<span class="op" id="4202331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202334">two</span>&nbsp;<span class="op" id="4202338">:=</span>&nbsp;<span class="ident" id="4202341">big</span><span class="op" id="4202344">.</span><span class="ident" id="4202345">NewInt</span><span class="op" id="4202351">(</span><span class="num" id="4202352">2</span><span class="op" id="4202353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202356">pMinus2</span>&nbsp;<span class="op" id="4202364">:=</span>&nbsp;<span class="builtinfunc" id="4202367">new</span><span class="op" id="4202370">(</span><span class="ident" id="4202371">big</span><span class="op" id="4202374">.</span><span class="ident" id="4202375">Int</span><span class="op" id="4202378">)</span><span class="op" id="4202379">.</span><span class="ident" id="4202380">Sub</span><span class="op" id="4202383">(</span><span class="ident" id="4202384">P</span><span class="op" id="4202385">,</span>&nbsp;<span class="ident" id="4202387">two</span><span class="op" id="4202390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202393">return</span>&nbsp;<span class="builtinfunc" id="4202400">new</span><span class="op" id="4202403">(</span><span class="ident" id="4202404">big</span><span class="op" id="4202407">.</span><span class="ident" id="4202408">Int</span><span class="op" id="4202411">)</span><span class="op" id="4202412">.</span><span class="ident" id="4202413">Exp</span><span class="op" id="4202416">(</span><span class="ident" id="4202417">k</span><span class="op" id="4202418">,</span>&nbsp;<span class="ident" id="4202420">pMinus2</span><span class="op" id="4202427">,</span>&nbsp;<span class="ident" id="4202429">P</span><span class="op" id="4202430">)</span><br>
<span class="lineno"></span><span class="op" id="4202432">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="4202435">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4202515">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4202593">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4202672">//&nbsp;rand.</span><br>
<span class="lineno">190</span><span class="comment" id="4202681">//</span><br>
<span class="lineno"></span><span class="comment" id="4202684">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4202764">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4202839">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4202861">func</span>&nbsp;<span class="ident" id="4202866">Sign</span><span class="op" id="4202870">(</span><span class="ident" id="4202871">rand</span>&nbsp;<span class="ident" id="4202876">io</span><span class="op" id="4202878">.</span><span class="ident" id="4202879">Reader</span><span class="op" id="4202885">,</span>&nbsp;<span class="ident" id="4202887">priv</span>&nbsp;<span class="op" id="4202892">*</span><span class="ident" id="4202893">PrivateKey</span><span class="op" id="4202903">,</span>&nbsp;<span class="ident" id="4202905">hash</span>&nbsp;<span class="op" id="4202910">[</span><span class="op" id="4202911">]</span><span class="builtintype" id="4202912">byte</span><span class="op" id="4202916">)</span>&nbsp;<span class="op" id="4202918">(</span><span class="ident" id="4202919">r</span><span class="op" id="4202920">,</span>&nbsp;<span class="ident" id="4202922">s</span>&nbsp;<span class="op" id="4202924">*</span><span class="ident" id="4202925">big</span><span class="op" id="4202928">.</span><span class="ident" id="4202929">Int</span><span class="op" id="4202932">,</span>&nbsp;<span class="ident" id="4202934">err</span>&nbsp;<span class="builtintype" id="4202938">error</span><span class="op" id="4202943">)</span>&nbsp;<span class="op" id="4202945">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4202948">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4202977">n</span>&nbsp;<span class="op" id="4202979">:=</span>&nbsp;<span class="ident" id="4202982">priv</span><span class="op" id="4202986">.</span><span class="ident" id="4202987">Q</span><span class="op" id="4202988">.</span><span class="ident" id="4202989">BitLen</span><span class="op" id="4202995">(</span><span class="op" id="4202996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4202999">if</span>&nbsp;<span class="ident" id="4203002">n</span><span class="op" id="4203003">&amp;</span><span class="num" id="4203004">7</span>&nbsp;<span class="op" id="4203006">!=</span>&nbsp;<span class="num" id="4203009">0</span>&nbsp;<span class="op" id="4203011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203015">err</span>&nbsp;<span class="op" id="4203019">=</span>&nbsp;<span class="ident" id="4203021">ErrInvalidPublicKey</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203043">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4203051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203054">n</span>&nbsp;<span class="op" id="4203056">&gt;&gt;=</span>&nbsp;<span class="num" id="4203060">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203064">for</span>&nbsp;<span class="op" id="4203068">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203072">k</span>&nbsp;<span class="op" id="4203074">:=</span>&nbsp;<span class="builtinfunc" id="4203077">new</span><span class="op" id="4203080">(</span><span class="ident" id="4203081">big</span><span class="op" id="4203084">.</span><span class="ident" id="4203085">Int</span><span class="op" id="4203088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203092">buf</span>&nbsp;<span class="op" id="4203096">:=</span>&nbsp;<span class="builtinfunc" id="4203099">make</span><span class="op" id="4203103">(</span><span class="op" id="4203104">[</span><span class="op" id="4203105">]</span><span class="builtintype" id="4203106">byte</span><span class="op" id="4203110">,</span>&nbsp;<span class="ident" id="4203112">n</span><span class="op" id="4203113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203117">for</span>&nbsp;<span class="op" id="4203121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203126">_</span><span class="op" id="4203127">,</span>&nbsp;<span class="ident" id="4203129">err</span>&nbsp;<span class="op" id="4203133">=</span>&nbsp;<span class="ident" id="4203135">io</span><span class="op" id="4203137">.</span><span class="ident" id="4203138">ReadFull</span><span class="op" id="4203146">(</span><span class="ident" id="4203147">rand</span><span class="op" id="4203151">,</span>&nbsp;<span class="ident" id="4203153">buf</span><span class="op" id="4203156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203161">if</span>&nbsp;<span class="ident" id="4203164">err</span>&nbsp;<span class="op" id="4203168">!=</span>&nbsp;<span class="ident" id="4203171">nil</span>&nbsp;<span class="op" id="4203175">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203181">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4203191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203196">k</span><span class="op" id="4203197">.</span><span class="ident" id="4203198">SetBytes</span><span class="op" id="4203206">(</span><span class="ident" id="4203207">buf</span><span class="op" id="4203210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203215">if</span>&nbsp;<span class="ident" id="4203218">k</span><span class="op" id="4203219">.</span><span class="ident" id="4203220">Sign</span><span class="op" id="4203224">(</span><span class="op" id="4203225">)</span>&nbsp;<span class="op" id="4203227">&gt;</span>&nbsp;<span class="num" id="4203229">0</span>&nbsp;<span class="op" id="4203231">&amp;&amp;</span>&nbsp;<span class="ident" id="4203234">k</span><span class="op" id="4203235">.</span><span class="ident" id="4203236">Cmp</span><span class="op" id="4203239">(</span><span class="ident" id="4203240">priv</span><span class="op" id="4203244">.</span><span class="ident" id="4203245">Q</span><span class="op" id="4203246">)</span>&nbsp;<span class="op" id="4203248">&lt;</span>&nbsp;<span class="num" id="4203250">0</span>&nbsp;<span class="op" id="4203252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203258">break</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4203267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4203271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203276">kInv</span>&nbsp;<span class="op" id="4203281">:=</span>&nbsp;<span class="ident" id="4203284">fermatInverse</span><span class="op" id="4203297">(</span><span class="ident" id="4203298">k</span><span class="op" id="4203299">,</span>&nbsp;<span class="ident" id="4203301">priv</span><span class="op" id="4203305">.</span><span class="ident" id="4203306">Q</span><span class="op" id="4203307">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203312">r</span>&nbsp;<span class="op" id="4203314">=</span>&nbsp;<span class="builtinfunc" id="4203316">new</span><span class="op" id="4203319">(</span><span class="ident" id="4203320">big</span><span class="op" id="4203323">.</span><span class="ident" id="4203324">Int</span><span class="op" id="4203327">)</span><span class="op" id="4203328">.</span><span class="ident" id="4203329">Exp</span><span class="op" id="4203332">(</span><span class="ident" id="4203333">priv</span><span class="op" id="4203337">.</span><span class="ident" id="4203338">G</span><span class="op" id="4203339">,</span>&nbsp;<span class="ident" id="4203341">k</span><span class="op" id="4203342">,</span>&nbsp;<span class="ident" id="4203344">priv</span><span class="op" id="4203348">.</span><span class="ident" id="4203349">P</span><span class="op" id="4203350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203354">r</span><span class="op" id="4203355">.</span><span class="ident" id="4203356">Mod</span><span class="op" id="4203359">(</span><span class="ident" id="4203360">r</span><span class="op" id="4203361">,</span>&nbsp;<span class="ident" id="4203363">priv</span><span class="op" id="4203367">.</span><span class="ident" id="4203368">Q</span><span class="op" id="4203369">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203374">if</span>&nbsp;<span class="ident" id="4203377">r</span><span class="op" id="4203378">.</span><span class="ident" id="4203379">Sign</span><span class="op" id="4203383">(</span><span class="op" id="4203384">)</span>&nbsp;<span class="op" id="4203386">==</span>&nbsp;<span class="num" id="4203389">0</span>&nbsp;<span class="op" id="4203391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203396">continue</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4203407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203412">z</span>&nbsp;<span class="op" id="4203414">:=</span>&nbsp;<span class="ident" id="4203417">k</span><span class="op" id="4203418">.</span><span class="ident" id="4203419">SetBytes</span><span class="op" id="4203427">(</span><span class="ident" id="4203428">hash</span><span class="op" id="4203432">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203437">s</span>&nbsp;<span class="op" id="4203439">=</span>&nbsp;<span class="builtinfunc" id="4203441">new</span><span class="op" id="4203444">(</span><span class="ident" id="4203445">big</span><span class="op" id="4203448">.</span><span class="ident" id="4203449">Int</span><span class="op" id="4203452">)</span><span class="op" id="4203453">.</span><span class="ident" id="4203454">Mul</span><span class="op" id="4203457">(</span><span class="ident" id="4203458">priv</span><span class="op" id="4203462">.</span><span class="ident" id="4203463">X</span><span class="op" id="4203464">,</span>&nbsp;<span class="ident" id="4203466">r</span><span class="op" id="4203467">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203471">s</span><span class="op" id="4203472">.</span><span class="ident" id="4203473">Add</span><span class="op" id="4203476">(</span><span class="ident" id="4203477">s</span><span class="op" id="4203478">,</span>&nbsp;<span class="ident" id="4203480">z</span><span class="op" id="4203481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203485">s</span><span class="op" id="4203486">.</span><span class="ident" id="4203487">Mod</span><span class="op" id="4203490">(</span><span class="ident" id="4203491">s</span><span class="op" id="4203492">,</span>&nbsp;<span class="ident" id="4203494">priv</span><span class="op" id="4203498">.</span><span class="ident" id="4203499">Q</span><span class="op" id="4203500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203504">s</span><span class="op" id="4203505">.</span><span class="ident" id="4203506">Mul</span><span class="op" id="4203509">(</span><span class="ident" id="4203510">s</span><span class="op" id="4203511">,</span>&nbsp;<span class="ident" id="4203513">kInv</span><span class="op" id="4203517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4203521">s</span><span class="op" id="4203522">.</span><span class="ident" id="4203523">Mod</span><span class="op" id="4203526">(</span><span class="ident" id="4203527">s</span><span class="op" id="4203528">,</span>&nbsp;<span class="ident" id="4203530">priv</span><span class="op" id="4203534">.</span><span class="ident" id="4203535">Q</span><span class="op" id="4203536">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203541">if</span>&nbsp;<span class="ident" id="4203544">s</span><span class="op" id="4203545">.</span><span class="ident" id="4203546">Sign</span><span class="op" id="4203550">(</span><span class="op" id="4203551">)</span>&nbsp;<span class="op" id="4203553">!=</span>&nbsp;<span class="num" id="4203556">0</span>&nbsp;<span class="op" id="4203558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203563">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4203571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4203574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203578">return</span><br>
<span class="lineno"></span><span class="op" id="4203585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4203588">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4203667">//&nbsp;reports&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno">245</span><span class="comment" id="4203710">//</span><br>
<span class="lineno"></span><span class="comment" id="4203713">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4203793">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4203868">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4203890">func</span>&nbsp;<span class="ident" id="4203895">Verify</span><span class="op" id="4203901">(</span><span class="ident" id="4203902">pub</span>&nbsp;<span class="op" id="4203906">*</span><span class="ident" id="4203907">PublicKey</span><span class="op" id="4203916">,</span>&nbsp;<span class="ident" id="4203918">hash</span>&nbsp;<span class="op" id="4203923">[</span><span class="op" id="4203924">]</span><span class="builtintype" id="4203925">byte</span><span class="op" id="4203929">,</span>&nbsp;<span class="ident" id="4203931">r</span><span class="op" id="4203932">,</span>&nbsp;<span class="ident" id="4203934">s</span>&nbsp;<span class="op" id="4203936">*</span><span class="ident" id="4203937">big</span><span class="op" id="4203940">.</span><span class="ident" id="4203941">Int</span><span class="op" id="4203944">)</span>&nbsp;<span class="builtintype" id="4203946">bool</span>&nbsp;<span class="op" id="4203951">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4203954">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4203983">if</span>&nbsp;<span class="ident" id="4203986">r</span><span class="op" id="4203987">.</span><span class="ident" id="4203988">Sign</span><span class="op" id="4203992">(</span><span class="op" id="4203993">)</span>&nbsp;<span class="op" id="4203995">&lt;</span>&nbsp;<span class="num" id="4203997">1</span>&nbsp;<span class="op" id="4203999">||</span>&nbsp;<span class="ident" id="4204002">r</span><span class="op" id="4204003">.</span><span class="ident" id="4204004">Cmp</span><span class="op" id="4204007">(</span><span class="ident" id="4204008">pub</span><span class="op" id="4204011">.</span><span class="ident" id="4204012">Q</span><span class="op" id="4204013">)</span>&nbsp;<span class="op" id="4204015">&gt;=</span>&nbsp;<span class="num" id="4204018">0</span>&nbsp;<span class="op" id="4204020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204024">return</span>&nbsp;<span class="builtintype" id="4204031">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4204038">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204041">if</span>&nbsp;<span class="ident" id="4204044">s</span><span class="op" id="4204045">.</span><span class="ident" id="4204046">Sign</span><span class="op" id="4204050">(</span><span class="op" id="4204051">)</span>&nbsp;<span class="op" id="4204053">&lt;</span>&nbsp;<span class="num" id="4204055">1</span>&nbsp;<span class="op" id="4204057">||</span>&nbsp;<span class="ident" id="4204060">s</span><span class="op" id="4204061">.</span><span class="ident" id="4204062">Cmp</span><span class="op" id="4204065">(</span><span class="ident" id="4204066">pub</span><span class="op" id="4204069">.</span><span class="ident" id="4204070">Q</span><span class="op" id="4204071">)</span>&nbsp;<span class="op" id="4204073">&gt;=</span>&nbsp;<span class="num" id="4204076">0</span>&nbsp;<span class="op" id="4204078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204082">return</span>&nbsp;<span class="builtintype" id="4204089">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4204096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204100">w</span>&nbsp;<span class="op" id="4204102">:=</span>&nbsp;<span class="builtinfunc" id="4204105">new</span><span class="op" id="4204108">(</span><span class="ident" id="4204109">big</span><span class="op" id="4204112">.</span><span class="ident" id="4204113">Int</span><span class="op" id="4204116">)</span><span class="op" id="4204117">.</span><span class="ident" id="4204118">ModInverse</span><span class="op" id="4204128">(</span><span class="ident" id="4204129">s</span><span class="op" id="4204130">,</span>&nbsp;<span class="ident" id="4204132">pub</span><span class="op" id="4204135">.</span><span class="ident" id="4204136">Q</span><span class="op" id="4204137">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204141">n</span>&nbsp;<span class="op" id="4204143">:=</span>&nbsp;<span class="ident" id="4204146">pub</span><span class="op" id="4204149">.</span><span class="ident" id="4204150">Q</span><span class="op" id="4204151">.</span><span class="ident" id="4204152">BitLen</span><span class="op" id="4204158">(</span><span class="op" id="4204159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204162">if</span>&nbsp;<span class="ident" id="4204165">n</span><span class="op" id="4204166">&amp;</span><span class="num" id="4204167">7</span>&nbsp;<span class="op" id="4204169">!=</span>&nbsp;<span class="num" id="4204172">0</span>&nbsp;<span class="op" id="4204174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204178">return</span>&nbsp;<span class="builtintype" id="4204185">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4204192">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204195">z</span>&nbsp;<span class="op" id="4204197">:=</span>&nbsp;<span class="builtinfunc" id="4204200">new</span><span class="op" id="4204203">(</span><span class="ident" id="4204204">big</span><span class="op" id="4204207">.</span><span class="ident" id="4204208">Int</span><span class="op" id="4204211">)</span><span class="op" id="4204212">.</span><span class="ident" id="4204213">SetBytes</span><span class="op" id="4204221">(</span><span class="ident" id="4204222">hash</span><span class="op" id="4204226">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204230">u1</span>&nbsp;<span class="op" id="4204233">:=</span>&nbsp;<span class="builtinfunc" id="4204236">new</span><span class="op" id="4204239">(</span><span class="ident" id="4204240">big</span><span class="op" id="4204243">.</span><span class="ident" id="4204244">Int</span><span class="op" id="4204247">)</span><span class="op" id="4204248">.</span><span class="ident" id="4204249">Mul</span><span class="op" id="4204252">(</span><span class="ident" id="4204253">z</span><span class="op" id="4204254">,</span>&nbsp;<span class="ident" id="4204256">w</span><span class="op" id="4204257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204260">u1</span><span class="op" id="4204262">.</span><span class="ident" id="4204263">Mod</span><span class="op" id="4204266">(</span><span class="ident" id="4204267">u1</span><span class="op" id="4204269">,</span>&nbsp;<span class="ident" id="4204271">pub</span><span class="op" id="4204274">.</span><span class="ident" id="4204275">Q</span><span class="op" id="4204276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204279">u2</span>&nbsp;<span class="op" id="4204282">:=</span>&nbsp;<span class="ident" id="4204285">w</span><span class="op" id="4204286">.</span><span class="ident" id="4204287">Mul</span><span class="op" id="4204290">(</span><span class="ident" id="4204291">r</span><span class="op" id="4204292">,</span>&nbsp;<span class="ident" id="4204294">w</span><span class="op" id="4204295">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204298">u2</span><span class="op" id="4204300">.</span><span class="ident" id="4204301">Mod</span><span class="op" id="4204304">(</span><span class="ident" id="4204305">u2</span><span class="op" id="4204307">,</span>&nbsp;<span class="ident" id="4204309">pub</span><span class="op" id="4204312">.</span><span class="ident" id="4204313">Q</span><span class="op" id="4204314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204317">v</span>&nbsp;<span class="op" id="4204319">:=</span>&nbsp;<span class="ident" id="4204322">u1</span><span class="op" id="4204324">.</span><span class="ident" id="4204325">Exp</span><span class="op" id="4204328">(</span><span class="ident" id="4204329">pub</span><span class="op" id="4204332">.</span><span class="ident" id="4204333">G</span><span class="op" id="4204334">,</span>&nbsp;<span class="ident" id="4204336">u1</span><span class="op" id="4204338">,</span>&nbsp;<span class="ident" id="4204340">pub</span><span class="op" id="4204343">.</span><span class="ident" id="4204344">P</span><span class="op" id="4204345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204348">u2</span><span class="op" id="4204350">.</span><span class="ident" id="4204351">Exp</span><span class="op" id="4204354">(</span><span class="ident" id="4204355">pub</span><span class="op" id="4204358">.</span><span class="ident" id="4204359">Y</span><span class="op" id="4204360">,</span>&nbsp;<span class="ident" id="4204362">u2</span><span class="op" id="4204364">,</span>&nbsp;<span class="ident" id="4204366">pub</span><span class="op" id="4204369">.</span><span class="ident" id="4204370">P</span><span class="op" id="4204371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204374">v</span><span class="op" id="4204375">.</span><span class="ident" id="4204376">Mul</span><span class="op" id="4204379">(</span><span class="ident" id="4204380">v</span><span class="op" id="4204381">,</span>&nbsp;<span class="ident" id="4204383">u2</span><span class="op" id="4204385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204388">v</span><span class="op" id="4204389">.</span><span class="ident" id="4204390">Mod</span><span class="op" id="4204393">(</span><span class="ident" id="4204394">v</span><span class="op" id="4204395">,</span>&nbsp;<span class="ident" id="4204397">pub</span><span class="op" id="4204400">.</span><span class="ident" id="4204401">P</span><span class="op" id="4204402">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4204405">v</span><span class="op" id="4204406">.</span><span class="ident" id="4204407">Mod</span><span class="op" id="4204410">(</span><span class="ident" id="4204411">v</span><span class="op" id="4204412">,</span>&nbsp;<span class="ident" id="4204414">pub</span><span class="op" id="4204417">.</span><span class="ident" id="4204418">Q</span><span class="op" id="4204419">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4204423">return</span>&nbsp;<span class="ident" id="4204430">v</span><span class="op" id="4204431">.</span><span class="ident" id="4204432">Cmp</span><span class="op" id="4204435">(</span><span class="ident" id="4204436">r</span><span class="op" id="4204437">)</span>&nbsp;<span class="op" id="4204439">==</span>&nbsp;<span class="num" id="4204442">0</span><br>
<span class="lineno"></span><span class="op" id="4204444">}</span>
</div>
</body>
</html>
