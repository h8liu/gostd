<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment">//&nbsp;Package&nbsp;time&nbsp;provides&nbsp;functionality&nbsp;for&nbsp;measuring&nbsp;and&nbsp;displaying&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;calendrical&nbsp;calculations&nbsp;always&nbsp;assume&nbsp;a&nbsp;Gregorian&nbsp;calendar.</span><br>
<span class="lineno"></span><span class="keyword">package</span>&nbsp;<span class="ident">time</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword">import</span>&nbsp;<span class="string">&#34;errors&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;A&nbsp;Time&nbsp;represents&nbsp;an&nbsp;instant&nbsp;in&nbsp;time&nbsp;with&nbsp;nanosecond&nbsp;precision.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Programs&nbsp;using&nbsp;times&nbsp;should&nbsp;typically&nbsp;store&nbsp;and&nbsp;pass&nbsp;them&nbsp;as&nbsp;values,</span><br>
<span class="lineno">15</span><span class="comment">//&nbsp;not&nbsp;pointers.&nbsp;&nbsp;That&nbsp;is,&nbsp;time&nbsp;variables&nbsp;and&nbsp;struct&nbsp;fields&nbsp;should&nbsp;be&nbsp;of</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;type&nbsp;time.Time,&nbsp;not&nbsp;*time.Time.&nbsp;&nbsp;A&nbsp;Time&nbsp;value&nbsp;can&nbsp;be&nbsp;used&nbsp;by</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Time&nbsp;instants&nbsp;can&nbsp;be&nbsp;compared&nbsp;using&nbsp;the&nbsp;Before,&nbsp;After,&nbsp;and&nbsp;Equal&nbsp;methods.</span><br>
<span class="lineno">20</span><span class="comment">//&nbsp;The&nbsp;Sub&nbsp;method&nbsp;subtracts&nbsp;two&nbsp;instants,&nbsp;producing&nbsp;a&nbsp;Duration.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;Add&nbsp;method&nbsp;adds&nbsp;a&nbsp;Time&nbsp;and&nbsp;a&nbsp;Duration,&nbsp;producing&nbsp;a&nbsp;Time.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;of&nbsp;type&nbsp;Time&nbsp;is&nbsp;January&nbsp;1,&nbsp;year&nbsp;1,&nbsp;00:00:00.000000000&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;As&nbsp;this&nbsp;time&nbsp;is&nbsp;unlikely&nbsp;to&nbsp;come&nbsp;up&nbsp;in&nbsp;practice,&nbsp;the&nbsp;IsZero&nbsp;method&nbsp;gives</span><br>
<span class="lineno">25</span><span class="comment">//&nbsp;a&nbsp;simple&nbsp;way&nbsp;of&nbsp;detecting&nbsp;a&nbsp;time&nbsp;that&nbsp;has&nbsp;not&nbsp;been&nbsp;initialized&nbsp;explicitly.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Each&nbsp;Time&nbsp;has&nbsp;associated&nbsp;with&nbsp;it&nbsp;a&nbsp;Location,&nbsp;consulted&nbsp;when&nbsp;computing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;presentation&nbsp;form&nbsp;of&nbsp;the&nbsp;time,&nbsp;such&nbsp;as&nbsp;in&nbsp;the&nbsp;Format,&nbsp;Hour,&nbsp;and&nbsp;Year&nbsp;methods.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;methods&nbsp;Local,&nbsp;UTC,&nbsp;and&nbsp;In&nbsp;return&nbsp;a&nbsp;Time&nbsp;with&nbsp;a&nbsp;specific&nbsp;location.</span><br>
<span class="lineno">30</span><span class="comment">//&nbsp;Changing&nbsp;the&nbsp;location&nbsp;in&nbsp;this&nbsp;way&nbsp;changes&nbsp;only&nbsp;the&nbsp;presentation;&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;change&nbsp;the&nbsp;instant&nbsp;in&nbsp;time&nbsp;being&nbsp;denoted&nbsp;and&nbsp;therefore&nbsp;does&nbsp;not&nbsp;affect&nbsp;the</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;computations&nbsp;described&nbsp;in&nbsp;earlier&nbsp;paragraphs.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;Go&nbsp;==&nbsp;operator&nbsp;compares&nbsp;not&nbsp;just&nbsp;the&nbsp;time&nbsp;instant&nbsp;but&nbsp;also&nbsp;the</span><br>
<span class="lineno">35</span><span class="comment">//&nbsp;Location.&nbsp;Therefore,&nbsp;Time&nbsp;values&nbsp;should&nbsp;not&nbsp;be&nbsp;used&nbsp;as&nbsp;map&nbsp;or&nbsp;database&nbsp;keys</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;without&nbsp;first&nbsp;guaranteeing&nbsp;that&nbsp;the&nbsp;identical&nbsp;Location&nbsp;has&nbsp;been&nbsp;set&nbsp;for&nbsp;all</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;values,&nbsp;which&nbsp;can&nbsp;be&nbsp;achieved&nbsp;through&nbsp;use&nbsp;of&nbsp;the&nbsp;UTC&nbsp;or&nbsp;Local&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">Time</span>&nbsp;<span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;sec&nbsp;gives&nbsp;the&nbsp;number&nbsp;of&nbsp;seconds&nbsp;elapsed&nbsp;since</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;January&nbsp;1,&nbsp;year&nbsp;1&nbsp;00:00:00&nbsp;UTC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sec</span>&nbsp;<span class="ident">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;nsec&nbsp;specifies&nbsp;a&nbsp;non-negative&nbsp;nanosecond</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;offset&nbsp;within&nbsp;the&nbsp;second&nbsp;named&nbsp;by&nbsp;Seconds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;It&nbsp;must&nbsp;be&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;999999999].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nsec</span>&nbsp;<span class="builtintype">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;loc&nbsp;specifies&nbsp;the&nbsp;Location&nbsp;that&nbsp;should&nbsp;be&nbsp;used&nbsp;to</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;determine&nbsp;the&nbsp;minute,&nbsp;hour,&nbsp;month,&nbsp;day,&nbsp;and&nbsp;year</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;that&nbsp;correspond&nbsp;to&nbsp;this&nbsp;Time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Only&nbsp;the&nbsp;zero&nbsp;Time&nbsp;has&nbsp;a&nbsp;nil&nbsp;Location.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;In&nbsp;that&nbsp;case&nbsp;it&nbsp;is&nbsp;interpreted&nbsp;to&nbsp;mean&nbsp;UTC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">loc</span>&nbsp;<span class="op">*</span><span class="ident">Location</span><br>
<span class="lineno">55</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;After&nbsp;reports&nbsp;whether&nbsp;the&nbsp;time&nbsp;instant&nbsp;t&nbsp;is&nbsp;after&nbsp;u.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">After</span><span class="op">(</span><span class="ident">u</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">u</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">u</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">nsec</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">u</span><span class="op">.</span><span class="ident">nsec</span><br>
<span class="lineno">60</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Before&nbsp;reports&nbsp;whether&nbsp;the&nbsp;time&nbsp;instant&nbsp;t&nbsp;is&nbsp;before&nbsp;u.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Before</span><span class="op">(</span><span class="ident">u</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">u</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">u</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">nsec</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">u</span><span class="op">.</span><span class="ident">nsec</span><br>
<span class="lineno">65</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Equal&nbsp;reports&nbsp;whether&nbsp;t&nbsp;and&nbsp;u&nbsp;represent&nbsp;the&nbsp;same&nbsp;time&nbsp;instant.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Two&nbsp;times&nbsp;can&nbsp;be&nbsp;equal&nbsp;even&nbsp;if&nbsp;they&nbsp;are&nbsp;in&nbsp;different&nbsp;locations.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;For&nbsp;example,&nbsp;6:00&nbsp;+0200&nbsp;CEST&nbsp;and&nbsp;4:00&nbsp;UTC&nbsp;are&nbsp;Equal.</span><br>
<span class="lineno">70</span><span class="comment">//&nbsp;This&nbsp;comparison&nbsp;is&nbsp;different&nbsp;from&nbsp;using&nbsp;t&nbsp;==&nbsp;u,&nbsp;which&nbsp;also&nbsp;compares</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;the&nbsp;locations.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Equal</span><span class="op">(</span><span class="ident">u</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">u</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">nsec</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">u</span><span class="op">.</span><span class="ident">nsec</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;A&nbsp;Month&nbsp;specifies&nbsp;a&nbsp;month&nbsp;of&nbsp;the&nbsp;year&nbsp;(January&nbsp;=&nbsp;1,&nbsp;...).</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">Month</span>&nbsp;<span class="builtintype">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="op">(</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">January</span>&nbsp;<span class="ident">Month</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">February</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">March</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">April</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">May</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">June</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">July</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">August</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">September</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">October</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">November</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">December</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">months</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="op">...</span><span class="op">]</span><span class="builtintype">string</span><span class="op">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;January&#34;</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;February&#34;</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;March&#34;</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;April&#34;</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;May&#34;</span><span class="op">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;June&#34;</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;July&#34;</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;August&#34;</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;September&#34;</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;October&#34;</span><span class="op">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;November&#34;</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;December&#34;</span><span class="op">,</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;English&nbsp;name&nbsp;of&nbsp;the&nbsp;month&nbsp;(&#34;January&#34;,&nbsp;&#34;February&#34;,&nbsp;...).</span><br>
<span class="lineno">110</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">m</span>&nbsp;<span class="ident">Month</span><span class="op">)</span>&nbsp;<span class="ident">String</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">string</span>&nbsp;<span class="op">{</span>&nbsp;<span class="keyword">return</span>&nbsp;<span class="ident">months</span><span class="op">[</span><span class="ident">m</span><span class="op">-</span><span class="num">1</span><span class="op">]</span>&nbsp;<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;A&nbsp;Weekday&nbsp;specifies&nbsp;a&nbsp;day&nbsp;of&nbsp;the&nbsp;week&nbsp;(Sunday&nbsp;=&nbsp;0,&nbsp;...).</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">Weekday</span>&nbsp;<span class="builtintype">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword">const</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Sunday</span>&nbsp;<span class="ident">Weekday</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Monday</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Tuesday</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Wednesday</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Thursday</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Friday</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Saturday</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword">var</span>&nbsp;<span class="ident">days</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="op">...</span><span class="op">]</span><span class="builtintype">string</span><span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;Sunday&#34;</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;Monday&#34;</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;Tuesday&#34;</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;Wednesday&#34;</span><span class="op">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;Thursday&#34;</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;Friday&#34;</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;Saturday&#34;</span><span class="op">,</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;English&nbsp;name&nbsp;of&nbsp;the&nbsp;day&nbsp;(&#34;Sunday&#34;,&nbsp;&#34;Monday&#34;,&nbsp;...).</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">d</span>&nbsp;<span class="ident">Weekday</span><span class="op">)</span>&nbsp;<span class="ident">String</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">string</span>&nbsp;<span class="op">{</span>&nbsp;<span class="keyword">return</span>&nbsp;<span class="ident">days</span><span class="op">[</span><span class="ident">d</span><span class="op">]</span>&nbsp;<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Computations&nbsp;on&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno">140</span><span class="comment">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Time&nbsp;is&nbsp;defined&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbspJanuary&nbsp;1,&nbsp;year&nbsp;1,&nbsp;00:00:00.000000000&nbsp;UTC</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;which&nbsp;(1)&nbsp;looks&nbsp;like&nbsp;a&nbsp;zero,&nbsp;or&nbsp;as&nbsp;close&nbsp;as&nbsp;you&nbsp;can&nbsp;get&nbsp;in&nbsp;a&nbsp;date</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;(1-1-1&nbsp;00:00:00&nbsp;UTC),&nbsp;(2)&nbsp;is&nbsp;unlikely&nbsp;enough&nbsp;to&nbsp;arise&nbsp;in&nbsp;practice&nbsp;to</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;be&nbsp;a&nbsp;suitable&nbsp;&#34;not&nbsp;set&#34;&nbsp;sentinel,&nbsp;unlike&nbsp;Jan&nbsp;1&nbsp;1970,&nbsp;and&nbsp;(3)&nbsp;has&nbsp;a</span><br>
<span class="lineno">145</span><span class="comment">//&nbsp;non-negative&nbsp;year&nbsp;even&nbsp;in&nbsp;time&nbsp;zones&nbsp;west&nbsp;of&nbsp;UTC,&nbsp;unlike&nbsp;1-1-0</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;00:00:00&nbsp;UTC,&nbsp;which&nbsp;would&nbsp;be&nbsp;12-31-(-1)&nbsp;19:00:00&nbsp;in&nbsp;New&nbsp;York.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;zero&nbsp;Time&nbsp;value&nbsp;does&nbsp;not&nbsp;force&nbsp;a&nbsp;specific&nbsp;epoch&nbsp;for&nbsp;the&nbsp;time</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;representation.&nbsp;&nbsp;For&nbsp;example,&nbsp;to&nbsp;use&nbsp;the&nbsp;Unix&nbsp;epoch&nbsp;internally,&nbsp;we</span><br>
<span class="lineno">150</span><span class="comment">//&nbsp;could&nbsp;define&nbsp;that&nbsp;to&nbsp;distinguish&nbsp;a&nbsp;zero&nbsp;value&nbsp;from&nbsp;Jan&nbsp;1&nbsp;1970,&nbsp;that</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;time&nbsp;would&nbsp;be&nbsp;represented&nbsp;by&nbsp;sec=-1,&nbsp;nsec=1e9.&nbsp;&nbsp;However,&nbsp;it&nbsp;does</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;suggest&nbsp;a&nbsp;representation,&nbsp;namely&nbsp;using&nbsp;1-1-1&nbsp;00:00:00&nbsp;UTC&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;epoch,&nbsp;and&nbsp;that&#39;s&nbsp;what&nbsp;we&nbsp;do.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno">155</span><span class="comment">//&nbsp;The&nbsp;Add&nbsp;and&nbsp;Sub&nbsp;computations&nbsp;are&nbsp;oblivious&nbsp;to&nbsp;the&nbsp;choice&nbsp;of&nbsp;epoch.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;presentation&nbsp;computations&nbsp;-&nbsp;year,&nbsp;month,&nbsp;minute,&nbsp;and&nbsp;so&nbsp;on&nbsp;-&nbsp;all</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;rely&nbsp;heavily&nbsp;on&nbsp;division&nbsp;and&nbsp;modulus&nbsp;by&nbsp;positive&nbsp;constants.&nbsp;&nbsp;For</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;calendrical&nbsp;calculations&nbsp;we&nbsp;want&nbsp;these&nbsp;divisions&nbsp;to&nbsp;round&nbsp;down,&nbsp;even</span><br>
<span class="lineno">160</span><span class="comment">//&nbsp;for&nbsp;negative&nbsp;values,&nbsp;so&nbsp;that&nbsp;the&nbsp;remainder&nbsp;is&nbsp;always&nbsp;positive,&nbsp;but</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Go&#39;s&nbsp;division&nbsp;(like&nbsp;most&nbsp;hardware&nbsp;division&nbsp;instructions)&nbsp;rounds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;zero.&nbsp;&nbsp;We&nbsp;can&nbsp;still&nbsp;do&nbsp;those&nbsp;computations&nbsp;and&nbsp;then&nbsp;adjust&nbsp;the&nbsp;result</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;for&nbsp;a&nbsp;negative&nbsp;numerator,&nbsp;but&nbsp;it&#39;s&nbsp;annoying&nbsp;to&nbsp;write&nbsp;the&nbsp;adjustment</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;over&nbsp;and&nbsp;over.&nbsp;&nbsp;Instead,&nbsp;we&nbsp;can&nbsp;change&nbsp;to&nbsp;a&nbsp;different&nbsp;epoch&nbsp;so&nbsp;long</span><br>
<span class="lineno">165</span><span class="comment">//&nbsp;ago&nbsp;that&nbsp;all&nbsp;the&nbsp;times&nbsp;we&nbsp;care&nbsp;about&nbsp;will&nbsp;be&nbsp;positive,&nbsp;and&nbsp;then&nbsp;round</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;to&nbsp;zero&nbsp;and&nbsp;round&nbsp;down&nbsp;coincide.&nbsp;&nbsp;These&nbsp;presentation&nbsp;routines&nbsp;already</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;have&nbsp;to&nbsp;add&nbsp;the&nbsp;zone&nbsp;offset,&nbsp;so&nbsp;adding&nbsp;the&nbsp;translation&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;alternate&nbsp;epoch&nbsp;is&nbsp;cheap.&nbsp;&nbsp;For&nbsp;example,&nbsp;having&nbsp;a&nbsp;non-negative&nbsp;time&nbsp;t</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;means&nbsp;that&nbsp;we&nbsp;can&nbsp;write</span><br>
<span class="lineno">170</span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbspsec&nbsp;=&nbsp;t&nbsp;%&nbsp;60</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno">175</span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbspsec&nbsp;=&nbsp;t&nbsp;%&nbsp;60</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;sec&nbsp;&lt;&nbsp;0&nbsp;{</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspsec&nbsp;+=&nbsp;60</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno">180</span><span class="comment">//&nbsp;everywhere.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;calendar&nbsp;runs&nbsp;on&nbsp;an&nbsp;exact&nbsp;400&nbsp;year&nbsp;cycle:&nbsp;a&nbsp;400-year&nbsp;calendar</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;printed&nbsp;for&nbsp;1970-2469&nbsp;will&nbsp;apply&nbsp;as&nbsp;well&nbsp;to&nbsp;2470-2869.&nbsp;&nbsp;Even&nbsp;the&nbsp;days</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;of&nbsp;the&nbsp;week&nbsp;match&nbsp;up.&nbsp;&nbsp;It&nbsp;simplifies&nbsp;the&nbsp;computations&nbsp;to&nbsp;choose&nbsp;the</span><br>
<span class="lineno">185</span><span class="comment">//&nbsp;cycle&nbsp;boundaries&nbsp;so&nbsp;that&nbsp;the&nbsp;exceptional&nbsp;years&nbsp;are&nbsp;always&nbsp;delayed&nbsp;as</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;long&nbsp;as&nbsp;possible.&nbsp;&nbsp;That&nbsp;means&nbsp;choosing&nbsp;a&nbsp;year&nbsp;equal&nbsp;to&nbsp;1&nbsp;mod&nbsp;400,&nbsp;so</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;that&nbsp;the&nbsp;first&nbsp;leap&nbsp;year&nbsp;is&nbsp;the&nbsp;4th&nbsp;year,&nbsp;the&nbsp;first&nbsp;missed&nbsp;leap&nbsp;year</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;is&nbsp;the&nbsp;100th&nbsp;year,&nbsp;and&nbsp;the&nbsp;missed&nbsp;missed&nbsp;leap&nbsp;year&nbsp;is&nbsp;the&nbsp;400th&nbsp;year.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;So&nbsp;we&#39;d&nbsp;prefer&nbsp;instead&nbsp;to&nbsp;print&nbsp;a&nbsp;calendar&nbsp;for&nbsp;2001-2400&nbsp;and&nbsp;reuse&nbsp;it</span><br>
<span class="lineno">190</span><span class="comment">//&nbsp;for&nbsp;2401-2800.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Finally,&nbsp;it&#39;s&nbsp;convenient&nbsp;if&nbsp;the&nbsp;delta&nbsp;between&nbsp;the&nbsp;Unix&nbsp;epoch&nbsp;and</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;long-ago&nbsp;epoch&nbsp;is&nbsp;representable&nbsp;by&nbsp;an&nbsp;int64&nbsp;constant.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno">195</span><span class="comment">//&nbsp;These&nbsp;three&nbsp;considerations—choose&nbsp;an&nbsp;epoch&nbsp;as&nbsp;early&nbsp;as&nbsp;possible,&nbsp;that</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;uses&nbsp;a&nbsp;year&nbsp;equal&nbsp;to&nbsp;1&nbsp;mod&nbsp;400,&nbsp;and&nbsp;that&nbsp;is&nbsp;no&nbsp;more&nbsp;than&nbsp;2⁶³&nbsp;seconds</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;earlier&nbsp;than&nbsp;1970—bring&nbsp;us&nbsp;to&nbsp;the&nbsp;year&nbsp;-292277022399.&nbsp;&nbsp;We&nbsp;refer&nbsp;to</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;this&nbsp;year&nbsp;as&nbsp;the&nbsp;absolute&nbsp;zero&nbsp;year,&nbsp;and&nbsp;to&nbsp;times&nbsp;measured&nbsp;as&nbsp;a&nbsp;uint64</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;seconds&nbsp;since&nbsp;this&nbsp;year&nbsp;as&nbsp;absolute&nbsp;times.</span><br>
<span class="lineno">200</span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Times&nbsp;measured&nbsp;as&nbsp;an&nbsp;int64&nbsp;seconds&nbsp;since&nbsp;the&nbsp;year&nbsp;1—the&nbsp;representation</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;used&nbsp;for&nbsp;Time&#39;s&nbsp;sec&nbsp;field—are&nbsp;called&nbsp;internal&nbsp;times.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Times&nbsp;measured&nbsp;as&nbsp;an&nbsp;int64&nbsp;seconds&nbsp;since&nbsp;the&nbsp;year&nbsp;1970&nbsp;are&nbsp;called&nbsp;Unix</span><br>
<span class="lineno">205</span><span class="comment">//&nbsp;times.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;It&nbsp;is&nbsp;tempting&nbsp;to&nbsp;just&nbsp;use&nbsp;the&nbsp;year&nbsp;1&nbsp;as&nbsp;the&nbsp;absolute&nbsp;epoch,&nbsp;defining</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;that&nbsp;the&nbsp;routines&nbsp;are&nbsp;only&nbsp;valid&nbsp;for&nbsp;years&nbsp;&gt;=&nbsp;1.&nbsp;&nbsp;However,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;routines&nbsp;would&nbsp;then&nbsp;be&nbsp;invalid&nbsp;when&nbsp;displaying&nbsp;the&nbsp;epoch&nbsp;in&nbsp;time&nbsp;zones</span><br>
<span class="lineno">210</span><span class="comment">//&nbsp;west&nbsp;of&nbsp;UTC,&nbsp;since&nbsp;it&nbsp;is&nbsp;year&nbsp;0.&nbsp;&nbsp;It&nbsp;doesn&#39;t&nbsp;seem&nbsp;tenable&nbsp;to&nbsp;say&nbsp;that</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;printing&nbsp;the&nbsp;zero&nbsp;time&nbsp;correctly&nbsp;isn&#39;t&nbsp;supported&nbsp;in&nbsp;half&nbsp;the&nbsp;time</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;zones.&nbsp;&nbsp;By&nbsp;comparison,&nbsp;it&#39;s&nbsp;reasonable&nbsp;to&nbsp;mishandle&nbsp;some&nbsp;times&nbsp;in</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;the&nbsp;year&nbsp;-292277022399.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno">215</span><span class="comment">//&nbsp;All&nbsp;this&nbsp;is&nbsp;opaque&nbsp;to&nbsp;clients&nbsp;of&nbsp;the&nbsp;API&nbsp;and&nbsp;can&nbsp;be&nbsp;changed&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;better&nbsp;implementation&nbsp;presents&nbsp;itself.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;unsigned&nbsp;zero&nbsp;year&nbsp;for&nbsp;internal&nbsp;calculations.</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Must&nbsp;be&nbsp;1&nbsp;mod&nbsp;400,&nbsp;and&nbsp;times&nbsp;before&nbsp;it&nbsp;will&nbsp;not&nbsp;compute&nbsp;correctly,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;but&nbsp;otherwise&nbsp;can&nbsp;be&nbsp;changed&nbsp;at&nbsp;will.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">absoluteZeroYear</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="num">292277022399</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;year&nbsp;of&nbsp;the&nbsp;zero&nbsp;Time.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Assumed&nbsp;by&nbsp;the&nbsp;unixToInternal&nbsp;computation&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">internalYear</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;year&nbsp;of&nbsp;the&nbsp;zero&nbsp;Unix&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">unixYear</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1970</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Offsets&nbsp;to&nbsp;convert&nbsp;between&nbsp;internal&nbsp;and&nbsp;absolute&nbsp;or&nbsp;Unix&nbsp;times.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">absoluteToInternal</span>&nbsp;<span class="ident">int64</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">(</span><span class="ident">absoluteZeroYear</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">internalYear</span><span class="op">)</span>&nbsp;<span class="op">*</span>&nbsp;<span class="num">365.2425</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">secondsPerDay</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">internalToAbsolute</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="ident">absoluteToInternal</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">unixToInternal</span>&nbsp;<span class="ident">int64</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">(</span><span class="num">1969</span><span class="op">*</span><span class="num">365</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1969</span><span class="op">/</span><span class="num">4</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1969</span><span class="op">/</span><span class="num">100</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1969</span><span class="op">/</span><span class="num">400</span><span class="op">)</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">secondsPerDay</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">internalToUnix</span>&nbsp;<span class="ident">int64</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="ident">unixToInternal</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;IsZero&nbsp;reports&nbsp;whether&nbsp;t&nbsp;represents&nbsp;the&nbsp;zero&nbsp;time&nbsp;instant,</span><br>
<span class="lineno">240</span><span class="comment">//&nbsp;January&nbsp;1,&nbsp;year&nbsp;1,&nbsp;00:00:00&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">IsZero</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">nsec</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment">//&nbsp;abs&nbsp;returns&nbsp;the&nbsp;time&nbsp;t&nbsp;as&nbsp;an&nbsp;absolute&nbsp;time,&nbsp;adjusted&nbsp;by&nbsp;the&nbsp;zone&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;It&nbsp;is&nbsp;called&nbsp;when&nbsp;computing&nbsp;a&nbsp;presentation&nbsp;property&nbsp;like&nbsp;Month&nbsp;or&nbsp;Hour.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">abs</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="ident">uint64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">l</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">loc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Avoid&nbsp;function&nbsp;calls&nbsp;when&nbsp;possible.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">l</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">l</span>&nbsp;<span class="op">==</span>&nbsp;<span class="op">&amp;</span><span class="ident">localLoc</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">l</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">l</span><span class="op">.</span><span class="ident">get</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sec</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">internalToUnix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">l</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="op">&amp;</span><span class="ident">utcLoc</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">l</span><span class="op">.</span><span class="ident">cacheZone</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">l</span><span class="op">.</span><span class="ident">cacheStart</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">sec</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">sec</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">l</span><span class="op">.</span><span class="ident">cacheEnd</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sec</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">l</span><span class="op">.</span><span class="ident">cacheZone</span><span class="op">.</span><span class="ident">offset</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">offset</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">l</span><span class="op">.</span><span class="ident">lookup</span><span class="op">(</span><span class="ident">sec</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sec</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">offset</span><span class="op">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">sec</span>&nbsp;<span class="op">+</span>&nbsp;<span class="op">(</span><span class="ident">unixToInternal</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">internalToAbsolute</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="comment">//&nbsp;locabs&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;the&nbsp;Zone&nbsp;and&nbsp;abs&nbsp;methods,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;extracting&nbsp;both&nbsp;return&nbsp;values&nbsp;from&nbsp;a&nbsp;single&nbsp;zone&nbsp;lookup.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">locabs</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">name</span>&nbsp;<span class="builtintype">string</span><span class="op">,</span>&nbsp;<span class="ident">offset</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">abs</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">l</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">loc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">l</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">l</span>&nbsp;<span class="op">==</span>&nbsp;<span class="op">&amp;</span><span class="ident">localLoc</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">l</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">l</span><span class="op">.</span><span class="ident">get</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Avoid&nbsp;function&nbsp;call&nbsp;if&nbsp;we&nbsp;hit&nbsp;the&nbsp;local&nbsp;time&nbsp;cache.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sec</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">internalToUnix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">l</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="op">&amp;</span><span class="ident">utcLoc</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">l</span><span class="op">.</span><span class="ident">cacheZone</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">l</span><span class="op">.</span><span class="ident">cacheStart</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">sec</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">sec</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">l</span><span class="op">.</span><span class="ident">cacheEnd</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">name</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">l</span><span class="op">.</span><span class="ident">cacheZone</span><span class="op">.</span><span class="ident">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">offset</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">l</span><span class="op">.</span><span class="ident">cacheZone</span><span class="op">.</span><span class="ident">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">name</span><span class="op">,</span>&nbsp;<span class="ident">offset</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">l</span><span class="op">.</span><span class="ident">lookup</span><span class="op">(</span><span class="ident">sec</span><span class="op">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sec</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">offset</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">name</span>&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#34;UTC&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">abs</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">sec</span>&nbsp;<span class="op">+</span>&nbsp;<span class="op">(</span><span class="ident">unixToInternal</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">internalToAbsolute</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Date&nbsp;returns&nbsp;the&nbsp;year,&nbsp;month,&nbsp;and&nbsp;day&nbsp;in&nbsp;which&nbsp;t&nbsp;occurs.</span><br>
<span class="lineno">290</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Date</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">year</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">month</span>&nbsp;<span class="ident">Month</span><span class="op">,</span>&nbsp;<span class="ident">day</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">year</span><span class="op">,</span>&nbsp;<span class="ident">month</span><span class="op">,</span>&nbsp;<span class="ident">day</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">date</span><span class="op">(</span><span class="ident">true</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment">//&nbsp;Year&nbsp;returns&nbsp;the&nbsp;year&nbsp;in&nbsp;which&nbsp;t&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Year</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">int</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">year</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">date</span><span class="op">(</span><span class="ident">false</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">year</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Month&nbsp;returns&nbsp;the&nbsp;month&nbsp;of&nbsp;the&nbsp;year&nbsp;specified&nbsp;by&nbsp;t.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Month</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="ident">Month</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">month</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">date</span><span class="op">(</span><span class="ident">true</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">month</span><br>
<span class="lineno">305</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Day&nbsp;returns&nbsp;the&nbsp;day&nbsp;of&nbsp;the&nbsp;month&nbsp;specified&nbsp;by&nbsp;t.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Day</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">int</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">day</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">date</span><span class="op">(</span><span class="ident">true</span><span class="op">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">day</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Weekday&nbsp;returns&nbsp;the&nbsp;day&nbsp;of&nbsp;the&nbsp;week&nbsp;specified&nbsp;by&nbsp;t.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Weekday</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="ident">Weekday</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">absWeekday</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">abs</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;absWeekday&nbsp;is&nbsp;like&nbsp;Weekday&nbsp;but&nbsp;operates&nbsp;on&nbsp;an&nbsp;absolute&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">absWeekday</span><span class="op">(</span><span class="ident">abs</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="ident">Weekday</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;January&nbsp;1&nbsp;of&nbsp;the&nbsp;absolute&nbsp;year,&nbsp;like&nbsp;January&nbsp;1&nbsp;of&nbsp;2001,&nbsp;was&nbsp;a&nbsp;Monday.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sec</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="ident">abs</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">Monday</span><span class="op">)</span><span class="op">*</span><span class="ident">secondsPerDay</span><span class="op">)</span>&nbsp;<span class="op">%</span>&nbsp;<span class="ident">secondsPerWeek</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">Weekday</span><span class="op">(</span><span class="builtintype">int</span><span class="op">(</span><span class="ident">sec</span><span class="op">)</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">secondsPerDay</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="comment">//&nbsp;ISOWeek&nbsp;returns&nbsp;the&nbsp;ISO&nbsp;8601&nbsp;year&nbsp;and&nbsp;week&nbsp;number&nbsp;in&nbsp;which&nbsp;t&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Week&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;53.&nbsp;Jan&nbsp;01&nbsp;to&nbsp;Jan&nbsp;03&nbsp;of&nbsp;year&nbsp;n&nbsp;might&nbsp;belong&nbsp;to</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;week&nbsp;52&nbsp;or&nbsp;53&nbsp;of&nbsp;year&nbsp;n-1,&nbsp;and&nbsp;Dec&nbsp;29&nbsp;to&nbsp;Dec&nbsp;31&nbsp;might&nbsp;belong&nbsp;to&nbsp;week&nbsp;1</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;of&nbsp;year&nbsp;n+1.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">ISOWeek</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">year</span><span class="op">,</span>&nbsp;<span class="ident">week</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">year</span><span class="op">,</span>&nbsp;<span class="ident">month</span><span class="op">,</span>&nbsp;<span class="ident">day</span><span class="op">,</span>&nbsp;<span class="ident">yday</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">date</span><span class="op">(</span><span class="ident">true</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">wday</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">Weekday</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="num">6</span><span class="op">)</span>&nbsp;<span class="op">%</span>&nbsp;<span class="num">7</span>&nbsp;<span class="comment">//&nbsp;weekday&nbsp;but&nbsp;Monday&nbsp;=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">const</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Mon</span>&nbsp;<span class="builtintype">int</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Tue</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Wed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Thu</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Fri</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Sat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Sun</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Calculate&nbsp;week&nbsp;as&nbsp;number&nbsp;of&nbsp;Mondays&nbsp;in&nbsp;year&nbsp;up&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;and&nbsp;including&nbsp;today,&nbsp;plus&nbsp;1&nbsp;because&nbsp;the&nbsp;first&nbsp;week&nbsp;is&nbsp;week&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Putting&nbsp;the&nbsp;+&nbsp;1&nbsp;inside&nbsp;the&nbsp;numerator&nbsp;as&nbsp;a&nbsp;+&nbsp;7&nbsp;keeps&nbsp;the</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;numerator&nbsp;from&nbsp;being&nbsp;negative,&nbsp;which&nbsp;would&nbsp;cause&nbsp;it&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;round&nbsp;incorrectly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">week</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">(</span><span class="ident">yday</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">wday</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">7</span><span class="op">)</span>&nbsp;<span class="op">/</span>&nbsp;<span class="num">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;week&nbsp;number&nbsp;is&nbsp;now&nbsp;correct&nbsp;under&nbsp;the&nbsp;assumption</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;that&nbsp;the&nbsp;first&nbsp;Monday&nbsp;of&nbsp;the&nbsp;year&nbsp;is&nbsp;in&nbsp;week&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;If&nbsp;Jan&nbsp;1&nbsp;is&nbsp;a&nbsp;Tuesday,&nbsp;Wednesday,&nbsp;or&nbsp;Thursday,&nbsp;the&nbsp;first&nbsp;Monday</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;is&nbsp;actually&nbsp;in&nbsp;week&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">jan1wday</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="ident">wday</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">yday</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">7</span><span class="op">*</span><span class="num">53</span><span class="op">)</span>&nbsp;<span class="op">%</span>&nbsp;<span class="num">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">Tue</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">jan1wday</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">jan1wday</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">Thu</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">week</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;If&nbsp;the&nbsp;week&nbsp;number&nbsp;is&nbsp;still&nbsp;0,&nbsp;we&#39;re&nbsp;in&nbsp;early&nbsp;January&nbsp;but&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;the&nbsp;last&nbsp;week&nbsp;of&nbsp;last&nbsp;year.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">week</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">year</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">week</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;A&nbsp;year&nbsp;has&nbsp;53&nbsp;weeks&nbsp;when&nbsp;Jan&nbsp;1&nbsp;or&nbsp;Dec&nbsp;31&nbsp;is&nbsp;a&nbsp;Thursday,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;meaning&nbsp;Jan&nbsp;1&nbsp;of&nbsp;the&nbsp;next&nbsp;year&nbsp;is&nbsp;a&nbsp;Friday</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;or&nbsp;it&nbsp;was&nbsp;a&nbsp;leap&nbsp;year&nbsp;and&nbsp;Jan&nbsp;1&nbsp;of&nbsp;the&nbsp;next&nbsp;year&nbsp;is&nbsp;a&nbsp;Saturday.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">jan1wday</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">Fri</span>&nbsp;<span class="op">||</span>&nbsp;<span class="op">(</span><span class="ident">jan1wday</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">Sat</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">isLeap</span><span class="op">(</span><span class="ident">year</span><span class="op">)</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">week</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;December&nbsp;29&nbsp;to&nbsp;31&nbsp;are&nbsp;in&nbsp;week&nbsp;1&nbsp;of&nbsp;next&nbsp;year&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;they&nbsp;are&nbsp;after&nbsp;the&nbsp;last&nbsp;Thursday&nbsp;of&nbsp;the&nbsp;year&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;December&nbsp;31&nbsp;is&nbsp;a&nbsp;Monday,&nbsp;Tuesday,&nbsp;or&nbsp;Wednesday.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">month</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">December</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">day</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="num">29</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">wday</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">Thu</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">dec31wday</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="ident">wday</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">day</span><span class="op">)</span>&nbsp;<span class="op">%</span>&nbsp;<span class="num">7</span><span class="op">;</span>&nbsp;<span class="ident">Mon</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">dec31wday</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">dec31wday</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">Wed</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">year</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">week</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Clock&nbsp;returns&nbsp;the&nbsp;hour,&nbsp;minute,&nbsp;and&nbsp;second&nbsp;within&nbsp;the&nbsp;day&nbsp;specified&nbsp;by&nbsp;t.</span><br>
<span class="lineno">385</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Clock</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">hour</span><span class="op">,</span>&nbsp;<span class="ident">min</span><span class="op">,</span>&nbsp;<span class="ident">sec</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">absClock</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">abs</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;absClock&nbsp;is&nbsp;like&nbsp;clock&nbsp;but&nbsp;operates&nbsp;on&nbsp;an&nbsp;absolute&nbsp;time.</span><br>
<span class="lineno">390</span><span class="keyword">func</span>&nbsp;<span class="ident">absClock</span><span class="op">(</span><span class="ident">abs</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">hour</span><span class="op">,</span>&nbsp;<span class="ident">min</span><span class="op">,</span>&nbsp;<span class="ident">sec</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sec</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">abs</span>&nbsp;<span class="op">%</span>&nbsp;<span class="ident">secondsPerDay</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hour</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">sec</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">secondsPerHour</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sec</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">hour</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">secondsPerHour</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">min</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">sec</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">secondsPerMinute</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sec</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">min</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">secondsPerMinute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Hour&nbsp;returns&nbsp;the&nbsp;hour&nbsp;within&nbsp;the&nbsp;day&nbsp;specified&nbsp;by&nbsp;t,&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;23].</span><br>
<span class="lineno">400</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Hour</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">int</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">abs</span><span class="op">(</span><span class="op">)</span><span class="op">%</span><span class="ident">secondsPerDay</span><span class="op">)</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">secondsPerHour</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Minute&nbsp;returns&nbsp;the&nbsp;minute&nbsp;offset&nbsp;within&nbsp;the&nbsp;hour&nbsp;specified&nbsp;by&nbsp;t,&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;59].</span><br>
<span class="lineno">405</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Minute</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">int</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">abs</span><span class="op">(</span><span class="op">)</span><span class="op">%</span><span class="ident">secondsPerHour</span><span class="op">)</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">secondsPerMinute</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Second&nbsp;returns&nbsp;the&nbsp;second&nbsp;offset&nbsp;within&nbsp;the&nbsp;minute&nbsp;specified&nbsp;by&nbsp;t,&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;59].</span><br>
<span class="lineno">410</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Second</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">int</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">abs</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">%</span>&nbsp;<span class="ident">secondsPerMinute</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Nanosecond&nbsp;returns&nbsp;the&nbsp;nanosecond&nbsp;offset&nbsp;within&nbsp;the&nbsp;second&nbsp;specified&nbsp;by&nbsp;t,</span><br>
<span class="lineno">415</span><span class="comment">//&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;999999999].</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Nanosecond</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">int</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">nsec</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment">//&nbsp;YearDay&nbsp;returns&nbsp;the&nbsp;day&nbsp;of&nbsp;the&nbsp;year&nbsp;specified&nbsp;by&nbsp;t,&nbsp;in&nbsp;the&nbsp;range&nbsp;[1,365]&nbsp;for&nbsp;non-leap&nbsp;years,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;and&nbsp;[1,366]&nbsp;in&nbsp;leap&nbsp;years.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">YearDay</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">int</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">yday</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">date</span><span class="op">(</span><span class="ident">false</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">yday</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">425</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;A&nbsp;Duration&nbsp;represents&nbsp;the&nbsp;elapsed&nbsp;time&nbsp;between&nbsp;two&nbsp;instants</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;as&nbsp;an&nbsp;int64&nbsp;nanosecond&nbsp;count.&nbsp;&nbsp;The&nbsp;representation&nbsp;limits&nbsp;the</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;largest&nbsp;representable&nbsp;duration&nbsp;to&nbsp;approximately&nbsp;290&nbsp;years.</span><br>
<span class="lineno">430</span><span class="keyword">type</span>&nbsp;<span class="ident">Duration</span>&nbsp;<span class="ident">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">minDuration</span>&nbsp;<span class="ident">Duration</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">63</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">maxDuration</span>&nbsp;<span class="ident">Duration</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">63</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">435</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Common&nbsp;durations.&nbsp;&nbsp;There&nbsp;is&nbsp;no&nbsp;definition&nbsp;for&nbsp;units&nbsp;of&nbsp;Day&nbsp;or&nbsp;larger</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;to&nbsp;avoid&nbsp;confusion&nbsp;across&nbsp;daylight&nbsp;savings&nbsp;time&nbsp;zone&nbsp;transitions.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno">440</span><span class="comment">//&nbsp;To&nbsp;count&nbsp;the&nbsp;number&nbsp;of&nbsp;units&nbsp;in&nbsp;a&nbsp;Duration,&nbsp;divide:</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbspsecond&nbsp;:=&nbsp;time.Second</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbspfmt.Print(int64(second/time.Millisecond))&nbsp;//&nbsp;prints&nbsp;1000</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;To&nbsp;convert&nbsp;an&nbsp;integer&nbsp;number&nbsp;of&nbsp;units&nbsp;to&nbsp;a&nbsp;Duration,&nbsp;multiply:</span><br>
<span class="lineno">445</span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbspseconds&nbsp;:=&nbsp;10</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbspfmt.Print(time.Duration(seconds)*time.Second)&nbsp;//&nbsp;prints&nbsp;10s</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Nanosecond</span>&nbsp;&nbsp;<span class="ident">Duration</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Microsecond</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">1000</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">Nanosecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Millisecond</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">1000</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">Microsecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Second</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">1000</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Minute</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">60</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Hour</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">60</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">Minute</span><br>
<span class="lineno">455</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;representing&nbsp;the&nbsp;duration&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;72h3m0.5s&#34;.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Leading&nbsp;zero&nbsp;units&nbsp;are&nbsp;omitted.&nbsp;&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;durations&nbsp;less&nbsp;than&nbsp;one</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;second&nbsp;format&nbsp;use&nbsp;a&nbsp;smaller&nbsp;unit&nbsp;(milli-,&nbsp;micro-,&nbsp;or&nbsp;nanoseconds)&nbsp;to&nbsp;ensure</span><br>
<span class="lineno">460</span><span class="comment">//&nbsp;that&nbsp;the&nbsp;leading&nbsp;digit&nbsp;is&nbsp;non-zero.&nbsp;&nbsp;The&nbsp;zero&nbsp;duration&nbsp;formats&nbsp;as&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;with&nbsp;no&nbsp;unit.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">d</span>&nbsp;<span class="ident">Duration</span><span class="op">)</span>&nbsp;<span class="ident">String</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">string</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Largest&nbsp;time&nbsp;is&nbsp;2540400h10m10.000000000s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">buf</span>&nbsp;<span class="op">[</span><span class="num">32</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">buf</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">u</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">d</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">neg</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">neg</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">u</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="ident">u</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">u</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">Second</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Special&nbsp;case:&nbsp;if&nbsp;duration&nbsp;is&nbsp;smaller&nbsp;than&nbsp;a&nbsp;second,</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;use&nbsp;smaller&nbsp;units,&nbsp;like&nbsp;1.2ms</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">prec</span>&nbsp;<span class="builtintype">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="ident">w</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#39;s&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span><span class="op">--</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">switch</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">u</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="string">&#34;0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">u</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">Microsecond</span><span class="op">)</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;print&nbsp;nanoseconds</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">prec</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="ident">w</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#39;n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">u</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">Millisecond</span><span class="op">)</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;print&nbsp;microseconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">prec</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">3</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;U+00B5&nbsp;&#39;µ&#39;&nbsp;micro&nbsp;sign&nbsp;==&nbsp;0xC2&nbsp;0xB5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span><span class="op">--</span>&nbsp;<span class="comment">//&nbsp;Need&nbsp;room&nbsp;for&nbsp;two&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="ident">w</span><span class="op">:</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="string">&#34;µ&#34;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">default</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;print&nbsp;milliseconds</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">prec</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="ident">w</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#39;m&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span><span class="op">,</span>&nbsp;<span class="ident">u</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">fmtFrac</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="op">:</span><span class="ident">w</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">u</span><span class="op">,</span>&nbsp;<span class="ident">prec</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">fmtInt</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="op">:</span><span class="ident">w</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">u</span><span class="op">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="ident">w</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#39;s&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span><span class="op">,</span>&nbsp;<span class="ident">u</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">fmtFrac</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="op">:</span><span class="ident">w</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">u</span><span class="op">,</span>&nbsp;<span class="num">9</span><span class="op">)</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;u&nbsp;is&nbsp;now&nbsp;integer&nbsp;seconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">fmtInt</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="op">:</span><span class="ident">w</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">u</span><span class="op">%</span><span class="num">60</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">u</span>&nbsp;<span class="op">/=</span>&nbsp;<span class="num">60</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;u&nbsp;is&nbsp;now&nbsp;integer&nbsp;minutes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">u</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="ident">w</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#39;m&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">fmtInt</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="op">:</span><span class="ident">w</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">u</span><span class="op">%</span><span class="num">60</span><span class="op">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">u</span>&nbsp;<span class="op">/=</span>&nbsp;<span class="num">60</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;u&nbsp;is&nbsp;now&nbsp;integer&nbsp;hours</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Stop&nbsp;at&nbsp;hours&nbsp;because&nbsp;days&nbsp;can&nbsp;be&nbsp;different&nbsp;lengths.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">u</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="ident">w</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#39;h&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">fmtInt</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="op">:</span><span class="ident">w</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">u</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">neg</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="ident">w</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#39;-&#39;</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="builtintype">string</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="ident">w</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment">//&nbsp;fmtFrac&nbsp;formats&nbsp;the&nbsp;fraction&nbsp;of&nbsp;v/10**prec&nbsp;(e.g.,&nbsp;&#34;.12345&#34;)&nbsp;into&nbsp;the</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;tail&nbsp;of&nbsp;buf,&nbsp;omitting&nbsp;trailing&nbsp;zeros.&nbsp;&nbsp;it&nbsp;omits&nbsp;the&nbsp;decimal</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;point&nbsp;too&nbsp;when&nbsp;the&nbsp;fraction&nbsp;is&nbsp;0.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;where&nbsp;the</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;output&nbsp;bytes&nbsp;begin&nbsp;and&nbsp;the&nbsp;value&nbsp;v/10**prec.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">fmtFrac</span><span class="op">(</span><span class="ident">buf</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">prec</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">nw</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">nv</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Omit&nbsp;trailing&nbsp;zeros&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">buf</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">print</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">prec</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">digit</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="op">%</span>&nbsp;<span class="num">10</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">print</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtinfunc">print</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">digit</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtinfunc">print</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="ident">w</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">digit</span><span class="op">)</span>&nbsp;<span class="op">+</span>&nbsp;<span class="string">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">v</span>&nbsp;<span class="op">/=</span>&nbsp;<span class="num">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtinfunc">print</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="ident">w</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#39;.&#39;</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">w</span><span class="op">,</span>&nbsp;<span class="ident">v</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;fmtInt&nbsp;formats&nbsp;v&nbsp;into&nbsp;the&nbsp;tail&nbsp;of&nbsp;buf.</span><br>
<span class="lineno">560</span><span class="comment">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;where&nbsp;the&nbsp;output&nbsp;begins.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">fmtInt</span><span class="op">(</span><span class="ident">buf</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="builtintype">int</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">buf</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span><span class="op">--</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="ident">w</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">w</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="ident">w</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">v</span><span class="op">%</span><span class="num">10</span><span class="op">)</span>&nbsp;<span class="op">+</span>&nbsp;<span class="string">&#39;0&#39;</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">v</span>&nbsp;<span class="op">/=</span>&nbsp;<span class="num">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">w</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Nanoseconds&nbsp;returns&nbsp;the&nbsp;duration&nbsp;as&nbsp;an&nbsp;integer&nbsp;nanosecond&nbsp;count.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">d</span>&nbsp;<span class="ident">Duration</span><span class="op">)</span>&nbsp;<span class="ident">Nanoseconds</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="ident">int64</span>&nbsp;<span class="op">{</span>&nbsp;<span class="keyword">return</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">d</span><span class="op">)</span>&nbsp;<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;These&nbsp;methods&nbsp;return&nbsp;float64&nbsp;because&nbsp;the&nbsp;dominant</span><br>
<span class="lineno">580</span><span class="comment">//&nbsp;use&nbsp;case&nbsp;is&nbsp;for&nbsp;printing&nbsp;a&nbsp;floating&nbsp;point&nbsp;number&nbsp;like&nbsp;1.5s,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;a&nbsp;truncation&nbsp;to&nbsp;integer&nbsp;would&nbsp;make&nbsp;them&nbsp;not&nbsp;useful&nbsp;in&nbsp;those&nbsp;cases.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Splitting&nbsp;the&nbsp;integer&nbsp;and&nbsp;fraction&nbsp;ourselves&nbsp;guarantees&nbsp;that</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;converting&nbsp;the&nbsp;returned&nbsp;float64&nbsp;to&nbsp;an&nbsp;integer&nbsp;rounds&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;way&nbsp;that&nbsp;a&nbsp;pure&nbsp;integer&nbsp;conversion&nbsp;would&nbsp;have,&nbsp;even&nbsp;in&nbsp;cases</span><br>
<span class="lineno">585</span><span class="comment">//&nbsp;where,&nbsp;say,&nbsp;float64(d.Nanoseconds())/1e9&nbsp;would&nbsp;have&nbsp;rounded</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;differently.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Seconds&nbsp;returns&nbsp;the&nbsp;duration&nbsp;as&nbsp;a&nbsp;floating&nbsp;point&nbsp;number&nbsp;of&nbsp;seconds.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">d</span>&nbsp;<span class="ident">Duration</span><span class="op">)</span>&nbsp;<span class="ident">Seconds</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">float64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sec</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nsec</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">%</span>&nbsp;<span class="ident">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="builtintype">float64</span><span class="op">(</span><span class="ident">sec</span><span class="op">)</span>&nbsp;<span class="op">+</span>&nbsp;<span class="builtintype">float64</span><span class="op">(</span><span class="ident">nsec</span><span class="op">)</span><span class="op">*</span><span class="num">1e-9</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment">//&nbsp;Minutes&nbsp;returns&nbsp;the&nbsp;duration&nbsp;as&nbsp;a&nbsp;floating&nbsp;point&nbsp;number&nbsp;of&nbsp;minutes.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">d</span>&nbsp;<span class="ident">Duration</span><span class="op">)</span>&nbsp;<span class="ident">Minutes</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">float64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">min</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">Minute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nsec</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">%</span>&nbsp;<span class="ident">Minute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="builtintype">float64</span><span class="op">(</span><span class="ident">min</span><span class="op">)</span>&nbsp;<span class="op">+</span>&nbsp;<span class="builtintype">float64</span><span class="op">(</span><span class="ident">nsec</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="num">1e-9</span><span class="op">/</span><span class="num">60</span><span class="op">)</span><br>
<span class="lineno">600</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Hours&nbsp;returns&nbsp;the&nbsp;duration&nbsp;as&nbsp;a&nbsp;floating&nbsp;point&nbsp;number&nbsp;of&nbsp;hours.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">d</span>&nbsp;<span class="ident">Duration</span><span class="op">)</span>&nbsp;<span class="ident">Hours</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">float64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hour</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">Hour</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nsec</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">%</span>&nbsp;<span class="ident">Hour</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="builtintype">float64</span><span class="op">(</span><span class="ident">hour</span><span class="op">)</span>&nbsp;<span class="op">+</span>&nbsp;<span class="builtintype">float64</span><span class="op">(</span><span class="ident">nsec</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="num">1e-9</span><span class="op">/</span><span class="num">60</span><span class="op">/</span><span class="num">60</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Add&nbsp;returns&nbsp;the&nbsp;time&nbsp;t+d.</span><br>
<span class="lineno">610</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Add</span><span class="op">(</span><span class="ident">d</span>&nbsp;<span class="ident">Duration</span><span class="op">)</span>&nbsp;<span class="ident">Time</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">d</span>&nbsp;<span class="op">/</span>&nbsp;<span class="num">1e9</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nsec</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">nsec</span><span class="op">)</span>&nbsp;<span class="op">+</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="ident">d</span><span class="op">%</span><span class="num">1e9</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">nsec</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="num">1e9</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">sec</span><span class="op">++</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nsec</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">if</span>&nbsp;<span class="ident">nsec</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">sec</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nsec</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="num">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">nsec</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">nsec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Sub&nbsp;returns&nbsp;the&nbsp;duration&nbsp;t-u.&nbsp;If&nbsp;the&nbsp;result&nbsp;exceeds&nbsp;the&nbsp;maximum&nbsp;(or&nbsp;minimum)</span><br>
<span class="lineno">625</span><span class="comment">//&nbsp;value&nbsp;that&nbsp;can&nbsp;be&nbsp;stored&nbsp;in&nbsp;a&nbsp;Duration,&nbsp;the&nbsp;maximum&nbsp;(or&nbsp;minimum)&nbsp;duration</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;will&nbsp;be&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;To&nbsp;compute&nbsp;t-d&nbsp;for&nbsp;a&nbsp;duration&nbsp;d,&nbsp;use&nbsp;t.Add(-d).</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Sub</span><span class="op">(</span><span class="ident">u</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Duration</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">Duration</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">sec</span><span class="op">-</span><span class="ident">u</span><span class="op">.</span><span class="ident">sec</span><span class="op">)</span><span class="op">*</span><span class="ident">Second</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">Duration</span><span class="op">(</span><span class="builtintype">int32</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">nsec</span><span class="op">)</span><span class="op">-</span><span class="builtintype">int32</span><span class="op">(</span><span class="ident">u</span><span class="op">.</span><span class="ident">nsec</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Check&nbsp;for&nbsp;overflow&nbsp;or&nbsp;underflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">switch</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">u</span><span class="op">.</span><span class="ident">Add</span><span class="op">(</span><span class="ident">d</span><span class="op">)</span><span class="op">.</span><span class="ident">Equal</span><span class="op">(</span><span class="ident">t</span><span class="op">)</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="comment">//&nbsp;d&nbsp;is&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Before</span><span class="op">(</span><span class="ident">u</span><span class="op">)</span><span class="op">:</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">minDuration</span>&nbsp;<span class="comment">//&nbsp;t&nbsp;-&nbsp;u&nbsp;is&nbsp;negative&nbsp;out&nbsp;of&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">default</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">maxDuration</span>&nbsp;<span class="comment">//&nbsp;t&nbsp;-&nbsp;u&nbsp;is&nbsp;positive&nbsp;out&nbsp;of&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">640</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Since&nbsp;returns&nbsp;the&nbsp;time&nbsp;elapsed&nbsp;since&nbsp;t.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;It&nbsp;is&nbsp;shorthand&nbsp;for&nbsp;time.Now().Sub(t).</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">Since</span><span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Duration</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">Now</span><span class="op">(</span><span class="op">)</span><span class="op">.</span><span class="ident">Sub</span><span class="op">(</span><span class="ident">t</span><span class="op">)</span><br>
<span class="lineno">645</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;AddDate&nbsp;returns&nbsp;the&nbsp;time&nbsp;corresponding&nbsp;to&nbsp;adding&nbsp;the</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;given&nbsp;number&nbsp;of&nbsp;years,&nbsp;months,&nbsp;and&nbsp;days&nbsp;to&nbsp;t.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;For&nbsp;example,&nbsp;AddDate(-1,&nbsp;2,&nbsp;3)&nbsp;applied&nbsp;to&nbsp;January&nbsp;1,&nbsp;2011</span><br>
<span class="lineno">650</span><span class="comment">//&nbsp;returns&nbsp;March&nbsp;4,&nbsp;2010.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;AddDate&nbsp;normalizes&nbsp;its&nbsp;result&nbsp;in&nbsp;the&nbsp;same&nbsp;way&nbsp;that&nbsp;Date&nbsp;does,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;so,&nbsp;for&nbsp;example,&nbsp;adding&nbsp;one&nbsp;month&nbsp;to&nbsp;October&nbsp;31&nbsp;yields</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;December&nbsp;1,&nbsp;the&nbsp;normalized&nbsp;form&nbsp;for&nbsp;November&nbsp;31.</span><br>
<span class="lineno">655</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">AddDate</span><span class="op">(</span><span class="ident">years</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">months</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">days</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="ident">Time</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">year</span><span class="op">,</span>&nbsp;<span class="ident">month</span><span class="op">,</span>&nbsp;<span class="ident">day</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Date</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hour</span><span class="op">,</span>&nbsp;<span class="ident">min</span><span class="op">,</span>&nbsp;<span class="ident">sec</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Clock</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">Date</span><span class="op">(</span><span class="ident">year</span><span class="op">+</span><span class="ident">years</span><span class="op">,</span>&nbsp;<span class="ident">month</span><span class="op">+</span><span class="ident">Month</span><span class="op">(</span><span class="ident">months</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">day</span><span class="op">+</span><span class="ident">days</span><span class="op">,</span>&nbsp;<span class="ident">hour</span><span class="op">,</span>&nbsp;<span class="ident">min</span><span class="op">,</span>&nbsp;<span class="ident">sec</span><span class="op">,</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">nsec</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">loc</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">secondsPerMinute</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">secondsPerHour</span>&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">60</span>&nbsp;<span class="op">*</span>&nbsp;<span class="num">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">secondsPerDay</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">24</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">secondsPerHour</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">secondsPerWeek</span>&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">7</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">secondsPerDay</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">daysPer400Years</span>&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">365</span><span class="op">*</span><span class="num">400</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">97</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">daysPer100Years</span>&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">365</span><span class="op">*</span><span class="num">100</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">daysPer4Years</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">=</span>&nbsp;<span class="num">365</span><span class="op">*</span><span class="num">4</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;date&nbsp;computes&nbsp;the&nbsp;year,&nbsp;day&nbsp;of&nbsp;year,&nbsp;and&nbsp;when&nbsp;full=true,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;the&nbsp;month&nbsp;and&nbsp;day&nbsp;in&nbsp;which&nbsp;t&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">date</span><span class="op">(</span><span class="ident">full</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">year</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">month</span>&nbsp;<span class="ident">Month</span><span class="op">,</span>&nbsp;<span class="ident">day</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">yday</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">absDate</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">abs</span><span class="op">(</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">full</span><span class="op">)</span><br>
<span class="lineno">675</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;absDate&nbsp;is&nbsp;like&nbsp;date&nbsp;but&nbsp;operates&nbsp;on&nbsp;an&nbsp;absolute&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">absDate</span><span class="op">(</span><span class="ident">abs</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">full</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">year</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">month</span>&nbsp;<span class="ident">Month</span><span class="op">,</span>&nbsp;<span class="ident">day</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">yday</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Split&nbsp;into&nbsp;time&nbsp;and&nbsp;day.</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">abs</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">secondsPerDay</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Account&nbsp;for&nbsp;400&nbsp;year&nbsp;cycles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">daysPer400Years</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">y</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">400</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">daysPer400Years</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Cut&nbsp;off&nbsp;100-year&nbsp;cycles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;last&nbsp;cycle&nbsp;has&nbsp;one&nbsp;extra&nbsp;leap&nbsp;year,&nbsp;so&nbsp;on&nbsp;the&nbsp;last&nbsp;day</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;of&nbsp;that&nbsp;year,&nbsp;day&nbsp;/&nbsp;daysPer100Years&nbsp;will&nbsp;be&nbsp;4&nbsp;instead&nbsp;of&nbsp;3.</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Cut&nbsp;it&nbsp;back&nbsp;down&nbsp;to&nbsp;3&nbsp;by&nbsp;subtracting&nbsp;n&gt;&gt;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">daysPer100Years</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">n</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">y</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="num">100</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">daysPer100Years</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Cut&nbsp;off&nbsp;4-year&nbsp;cycles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;last&nbsp;cycle&nbsp;has&nbsp;a&nbsp;missing&nbsp;leap&nbsp;year,&nbsp;which&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;affect&nbsp;the&nbsp;computation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">daysPer4Years</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">y</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="num">4</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">daysPer4Years</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Cut&nbsp;off&nbsp;years&nbsp;within&nbsp;a&nbsp;4-year&nbsp;cycle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;last&nbsp;year&nbsp;is&nbsp;a&nbsp;leap&nbsp;year,&nbsp;so&nbsp;on&nbsp;the&nbsp;last&nbsp;day&nbsp;of&nbsp;that&nbsp;year,</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;day&nbsp;/&nbsp;365&nbsp;will&nbsp;be&nbsp;4&nbsp;instead&nbsp;of&nbsp;3.&nbsp;&nbsp;Cut&nbsp;it&nbsp;back&nbsp;down&nbsp;to&nbsp;3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;by&nbsp;subtracting&nbsp;n&gt;&gt;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">/</span>&nbsp;<span class="num">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">n</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">y</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">365</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">year</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">int64</span><span class="op">(</span><span class="ident">y</span><span class="op">)</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">absoluteZeroYear</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">yday</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">d</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="op">!</span><span class="ident">full</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">day</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">yday</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">isLeap</span><span class="op">(</span><span class="ident">year</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Leap&nbsp;year</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">switch</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">day</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">31</span><span class="op">+</span><span class="num">29</span><span class="op">-</span><span class="num">1</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;After&nbsp;leap&nbsp;day;&nbsp;pretend&nbsp;it&nbsp;wasn&#39;t&nbsp;there.</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">day</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">day</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">31</span><span class="op">+</span><span class="num">29</span><span class="op">-</span><span class="num">1</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Leap&nbsp;day.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">month</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">February</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">day</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">29</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Estimate&nbsp;month&nbsp;on&nbsp;assumption&nbsp;that&nbsp;every&nbsp;month&nbsp;has&nbsp;31&nbsp;days.</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;estimate&nbsp;may&nbsp;be&nbsp;too&nbsp;low&nbsp;by&nbsp;at&nbsp;most&nbsp;one&nbsp;month,&nbsp;so&nbsp;adjust.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">month</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">Month</span><span class="op">(</span><span class="ident">day</span>&nbsp;<span class="op">/</span>&nbsp;<span class="num">31</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">end</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">daysBefore</span><span class="op">[</span><span class="ident">month</span><span class="op">+</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">begin</span>&nbsp;<span class="builtintype">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">day</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="ident">end</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">month</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">begin</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">end</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">begin</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">daysBefore</span><span class="op">[</span><span class="ident">month</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">745</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">month</span><span class="op">++</span>&nbsp;<span class="comment">//&nbsp;because&nbsp;January&nbsp;is&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">day</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">day</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">begin</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">750</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;daysBefore[m]&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;days&nbsp;in&nbsp;a&nbsp;non-leap&nbsp;year</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;before&nbsp;month&nbsp;m&nbsp;begins.&nbsp;&nbsp;There&nbsp;is&nbsp;an&nbsp;entry&nbsp;for&nbsp;m=12,&nbsp;counting</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;the&nbsp;number&nbsp;of&nbsp;days&nbsp;before&nbsp;January&nbsp;of&nbsp;next&nbsp;year&nbsp;(365).</span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">daysBefore</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="op">...</span><span class="op">]</span><span class="builtintype">int32</span><span class="op">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">0</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">31</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">28</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">28</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">28</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span><span class="op">,</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">28</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">28</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">28</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">28</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">28</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span><span class="op">,</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">28</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">28</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">28</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">30</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">31</span><span class="op">,</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">770</span><span class="keyword">func</span>&nbsp;<span class="ident">daysIn</span><span class="op">(</span><span class="ident">m</span>&nbsp;<span class="ident">Month</span><span class="op">,</span>&nbsp;<span class="ident">year</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="builtintype">int</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">m</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">February</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">isLeap</span><span class="op">(</span><span class="ident">year</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="num">29</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">daysBefore</span><span class="op">[</span><span class="ident">m</span><span class="op">]</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">daysBefore</span><span class="op">[</span><span class="ident">m</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">775</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Provided&nbsp;by&nbsp;package&nbsp;runtime.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">now</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">sec</span>&nbsp;<span class="ident">int64</span><span class="op">,</span>&nbsp;<span class="ident">nsec</span>&nbsp;<span class="builtintype">int32</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">780</span><span class="comment">//&nbsp;Now&nbsp;returns&nbsp;the&nbsp;current&nbsp;local&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">Now</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="ident">Time</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sec</span><span class="op">,</span>&nbsp;<span class="ident">nsec</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">now</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">Time</span><span class="op">{</span><span class="ident">sec</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">unixToInternal</span><span class="op">,</span>&nbsp;<span class="ident">nsec</span><span class="op">,</span>&nbsp;<span class="ident">Local</span><span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">785</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;UTC&nbsp;returns&nbsp;t&nbsp;with&nbsp;the&nbsp;location&nbsp;set&nbsp;to&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">UTC</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="ident">Time</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">loc</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">UTC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><br>
<span class="lineno">790</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Local&nbsp;returns&nbsp;t&nbsp;with&nbsp;the&nbsp;location&nbsp;set&nbsp;to&nbsp;local&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Local</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="ident">Time</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">loc</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">Local</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;In&nbsp;returns&nbsp;t&nbsp;with&nbsp;the&nbsp;location&nbsp;information&nbsp;set&nbsp;to&nbsp;loc.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno">800</span><span class="comment">//&nbsp;In&nbsp;panics&nbsp;if&nbsp;loc&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">In</span><span class="op">(</span><span class="ident">loc</span>&nbsp;<span class="op">*</span><span class="ident">Location</span><span class="op">)</span>&nbsp;<span class="ident">Time</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">loc</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">panic</span><span class="op">(</span><span class="string">&#34;time:&nbsp;missing&nbsp;Location&nbsp;in&nbsp;call&nbsp;to&nbsp;Time.In&#34;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">loc</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">loc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Location&nbsp;returns&nbsp;the&nbsp;time&nbsp;zone&nbsp;information&nbsp;associated&nbsp;with&nbsp;t.</span><br>
<span class="lineno">810</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Location</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">*</span><span class="ident">Location</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">l</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">loc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">l</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">l</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">UTC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">l</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Zone&nbsp;computes&nbsp;the&nbsp;time&nbsp;zone&nbsp;in&nbsp;effect&nbsp;at&nbsp;time&nbsp;t,&nbsp;returning&nbsp;the&nbsp;abbreviated</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;name&nbsp;of&nbsp;the&nbsp;zone&nbsp;(such&nbsp;as&nbsp;&#34;CET&#34;)&nbsp;and&nbsp;its&nbsp;offset&nbsp;in&nbsp;seconds&nbsp;east&nbsp;of&nbsp;UTC.</span><br>
<span class="lineno">820</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Zone</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">name</span>&nbsp;<span class="builtintype">string</span><span class="op">,</span>&nbsp;<span class="ident">offset</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">name</span><span class="op">,</span>&nbsp;<span class="ident">offset</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">loc</span><span class="op">.</span><span class="ident">lookup</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">internalToUnix</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">825</span><span class="comment">//&nbsp;Unix&nbsp;returns&nbsp;t&nbsp;as&nbsp;a&nbsp;Unix&nbsp;time,&nbsp;the&nbsp;number&nbsp;of&nbsp;seconds&nbsp;elapsed</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;since&nbsp;January&nbsp;1,&nbsp;1970&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Unix</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="ident">int64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">internalToUnix</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">830</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;UnixNano&nbsp;returns&nbsp;t&nbsp;as&nbsp;a&nbsp;Unix&nbsp;time,&nbsp;the&nbsp;number&nbsp;of&nbsp;nanoseconds&nbsp;elapsed</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;since&nbsp;January&nbsp;1,&nbsp;1970&nbsp;UTC.&nbsp;The&nbsp;result&nbsp;is&nbsp;undefined&nbsp;if&nbsp;the&nbsp;Unix&nbsp;time</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;in&nbsp;nanoseconds&nbsp;cannot&nbsp;be&nbsp;represented&nbsp;by&nbsp;an&nbsp;int64.&nbsp;Note&nbsp;that&nbsp;this</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;means&nbsp;the&nbsp;result&nbsp;of&nbsp;calling&nbsp;UnixNano&nbsp;on&nbsp;the&nbsp;zero&nbsp;Time&nbsp;is&nbsp;undefined.</span><br>
<span class="lineno">835</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">UnixNano</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="ident">int64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">sec</span><span class="op">+</span><span class="ident">internalToUnix</span><span class="op">)</span><span class="op">*</span><span class="num">1e9</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">nsec</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="ident">timeBinaryVersion</span>&nbsp;<span class="builtintype">byte</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">840</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;MarshalBinary&nbsp;implements&nbsp;the&nbsp;encoding.BinaryMarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">MarshalBinary</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="builtintype">error</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">offsetMin</span>&nbsp;<span class="builtintype">int16</span>&nbsp;<span class="comment">//&nbsp;minutes&nbsp;east&nbsp;of&nbsp;UTC.&nbsp;-1&nbsp;is&nbsp;UTC.</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Location</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">==</span>&nbsp;<span class="op">&amp;</span><span class="ident">utcLoc</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">offsetMin</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">offset</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Zone</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">offset</span><span class="op">%</span><span class="num">60</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><span class="op">,</span>&nbsp;<span class="ident">errors</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="string">&#34;Time.MarshalBinary:&nbsp;zone&nbsp;offset&nbsp;has&nbsp;fractional&nbsp;minute&#34;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">offset</span>&nbsp;<span class="op">/=</span>&nbsp;<span class="num">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">offset</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="op">-</span><span class="num">32768</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">offset</span>&nbsp;<span class="op">==</span>&nbsp;<span class="op">-</span><span class="num">1</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">offset</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">32767</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><span class="op">,</span>&nbsp;<span class="ident">errors</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="string">&#34;Time.MarshalBinary:&nbsp;unexpected&nbsp;zone&nbsp;offset&#34;</span><span class="op">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">offsetMin</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">int16</span><span class="op">(</span><span class="ident">offset</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">enc</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">timeBinaryVersion</span><span class="op">,</span>&nbsp;<span class="comment">//&nbsp;byte&nbsp;0&nbsp;:&nbsp;version</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype">byte</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">56</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="comment">//&nbsp;bytes&nbsp;1-8:&nbsp;seconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype">byte</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">48</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype">byte</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">40</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype">byte</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">32</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype">byte</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">24</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype">byte</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">16</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype">byte</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">8</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype">byte</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">sec</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype">byte</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">nsec</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">24</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="comment">//&nbsp;bytes&nbsp;9-12:&nbsp;nanoseconds</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype">byte</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">nsec</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">16</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype">byte</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">nsec</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">8</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype">byte</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">nsec</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype">byte</span><span class="op">(</span><span class="ident">offsetMin</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">8</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="comment">//&nbsp;bytes&nbsp;13-14:&nbsp;zone&nbsp;offset&nbsp;in&nbsp;minutes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype">byte</span><span class="op">(</span><span class="ident">offsetMin</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">enc</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">880</span><span class="comment">//&nbsp;UnmarshalBinary&nbsp;implements&nbsp;the&nbsp;encoding.BinaryUnmarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">UnmarshalBinary</span><span class="op">(</span><span class="ident">data</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="builtintype">error</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">buf</span><span class="op">)</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">errors</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="string">&#34;Time.UnmarshalBinary:&nbsp;no&nbsp;data&#34;</span><span class="op">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">buf</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">timeBinaryVersion</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">errors</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="string">&#34;Time.UnmarshalBinary:&nbsp;unsupported&nbsp;version&#34;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">buf</span><span class="op">)</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="comment">/*version*/</span>&nbsp;<span class="num">1</span><span class="op">+</span>&nbsp;<span class="comment">/*sec*/</span>&nbsp;<span class="num">8</span><span class="op">+</span>&nbsp;<span class="comment">/*nsec*/</span>&nbsp;<span class="num">4</span><span class="op">+</span>&nbsp;<span class="comment">/*zone&nbsp;offset*/</span>&nbsp;<span class="num">2</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">errors</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="string">&#34;Time.UnmarshalBinary:&nbsp;invalid&nbsp;length&#34;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">buf</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="num">7</span><span class="op">]</span><span class="op">)</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="num">6</span><span class="op">]</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="num">8</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="num">5</span><span class="op">]</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="num">16</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="num">4</span><span class="op">]</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="num">24</span>&nbsp;<span class="op">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">int64</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="num">3</span><span class="op">]</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="num">32</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="num">40</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="num">48</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="num">56</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">buf</span><span class="op">[</span><span class="num">8</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">nsec</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="num">3</span><span class="op">]</span><span class="op">)</span>&nbsp;<span class="op">|</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="num">8</span>&nbsp;<span class="op">|</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="num">16</span>&nbsp;<span class="op">|</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="num">24</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">buf</span><span class="op">[</span><span class="num">4</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">offset</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="builtintype">int16</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">|</span><span class="builtintype">int16</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">&lt;&lt;</span><span class="num">8</span><span class="op">)</span>&nbsp;<span class="op">*</span>&nbsp;<span class="num">60</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">offset</span>&nbsp;<span class="op">==</span>&nbsp;<span class="op">-</span><span class="num">1</span><span class="op">*</span><span class="num">60</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">loc</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">&amp;</span><span class="ident">utcLoc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">if</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">localoff</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">Local</span><span class="op">.</span><span class="ident">lookup</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">internalToUnix</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="ident">offset</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">localoff</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">loc</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">Local</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">loc</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">FixedZone</span><span class="op">(</span><span class="string">&#34;&#34;</span><span class="op">,</span>&nbsp;<span class="ident">offset</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">915</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;TODO(rsc):&nbsp;Remove&nbsp;GobEncoder,&nbsp;GobDecoder,&nbsp;MarshalJSON,&nbsp;UnmarshalJSON&nbsp;in&nbsp;Go&nbsp;2.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;same&nbsp;semantics&nbsp;will&nbsp;be&nbsp;provided&nbsp;by&nbsp;the&nbsp;generic&nbsp;MarshalBinary,&nbsp;MarshalText,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;UnmarshalBinary,&nbsp;UnmarshalText.</span><br>
<span class="lineno"></span><br>
<span class="lineno">920</span><span class="comment">//&nbsp;GobEncode&nbsp;implements&nbsp;the&nbsp;gob.GobEncoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">GobEncode</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="builtintype">error</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">MarshalBinary</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">925</span><span class="comment">//&nbsp;GobDecode&nbsp;implements&nbsp;the&nbsp;gob.GobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">GobDecode</span><span class="op">(</span><span class="ident">data</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="builtintype">error</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">UnmarshalBinary</span><span class="op">(</span><span class="ident">data</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span><span class="comment">//&nbsp;MarshalJSON&nbsp;implements&nbsp;the&nbsp;json.Marshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;time&nbsp;is&nbsp;a&nbsp;quoted&nbsp;string&nbsp;in&nbsp;RFC&nbsp;3339&nbsp;format,&nbsp;with&nbsp;sub-second&nbsp;precision&nbsp;added&nbsp;if&nbsp;present.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">MarshalJSON</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="builtintype">error</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Year</span><span class="op">(</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="num">10000</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;RFC&nbsp;3339&nbsp;is&nbsp;clear&nbsp;that&nbsp;years&nbsp;are&nbsp;4&nbsp;digits&nbsp;exactly.</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;See&nbsp;golang.org/issue/4556#c15&nbsp;for&nbsp;more&nbsp;discussion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><span class="op">,</span>&nbsp;<span class="ident">errors</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="string">&#34;Time.MarshalJSON:&nbsp;year&nbsp;outside&nbsp;of&nbsp;range&nbsp;[0,9999]&#34;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">Format</span><span class="op">(</span><span class="string">`&#34;`</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">RFC3339Nano</span>&nbsp;<span class="op">+</span>&nbsp;<span class="string">`&#34;`</span><span class="op">)</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">940</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;UnmarshalJSON&nbsp;implements&nbsp;the&nbsp;json.Unmarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;time&nbsp;is&nbsp;expected&nbsp;to&nbsp;be&nbsp;a&nbsp;quoted&nbsp;string&nbsp;in&nbsp;RFC&nbsp;3339&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">UnmarshalJSON</span><span class="op">(</span><span class="ident">data</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">err</span>&nbsp;<span class="builtintype">error</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Fractional&nbsp;seconds&nbsp;are&nbsp;handled&nbsp;implicitly&nbsp;by&nbsp;Parse.</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">*</span><span class="ident">t</span><span class="op">,</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">Parse</span><span class="op">(</span><span class="string">`&#34;`</span><span class="op">+</span><span class="ident">RFC3339</span><span class="op">+</span><span class="string">`&#34;`</span><span class="op">,</span>&nbsp;<span class="builtintype">string</span><span class="op">(</span><span class="ident">data</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;MarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextMarshaler&nbsp;interface.</span><br>
<span class="lineno">950</span><span class="comment">//&nbsp;The&nbsp;time&nbsp;is&nbsp;formatted&nbsp;in&nbsp;RFC&nbsp;3339&nbsp;format,&nbsp;with&nbsp;sub-second&nbsp;precision&nbsp;added&nbsp;if&nbsp;present.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">MarshalText</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="builtintype">error</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Year</span><span class="op">(</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="num">10000</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><span class="op">,</span>&nbsp;<span class="ident">errors</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="string">&#34;Time.MarshalText:&nbsp;year&nbsp;outside&nbsp;of&nbsp;range&nbsp;[0,9999]&#34;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">Format</span><span class="op">(</span><span class="ident">RFC3339Nano</span><span class="op">)</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;UnmarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextUnmarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;time&nbsp;is&nbsp;expected&nbsp;to&nbsp;be&nbsp;in&nbsp;RFC&nbsp;3339&nbsp;format.</span><br>
<span class="lineno">960</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">UnmarshalText</span><span class="op">(</span><span class="ident">data</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">err</span>&nbsp;<span class="builtintype">error</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Fractional&nbsp;seconds&nbsp;are&nbsp;handled&nbsp;implicitly&nbsp;by&nbsp;Parse.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">*</span><span class="ident">t</span><span class="op">,</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">Parse</span><span class="op">(</span><span class="ident">RFC3339</span><span class="op">,</span>&nbsp;<span class="builtintype">string</span><span class="op">(</span><span class="ident">data</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">965</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Unix&nbsp;returns&nbsp;the&nbsp;local&nbsp;Time&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;given&nbsp;Unix&nbsp;time,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;sec&nbsp;seconds&nbsp;and&nbsp;nsec&nbsp;nanoseconds&nbsp;since&nbsp;January&nbsp;1,&nbsp;1970&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;It&nbsp;is&nbsp;valid&nbsp;to&nbsp;pass&nbsp;nsec&nbsp;outside&nbsp;the&nbsp;range&nbsp;[0,&nbsp;999999999].</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">Unix</span><span class="op">(</span><span class="ident">sec</span>&nbsp;<span class="ident">int64</span><span class="op">,</span>&nbsp;<span class="ident">nsec</span>&nbsp;<span class="ident">int64</span><span class="op">)</span>&nbsp;<span class="ident">Time</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">nsec</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">nsec</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="num">1e9</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">nsec</span>&nbsp;<span class="op">/</span>&nbsp;<span class="num">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sec</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nsec</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">n</span>&nbsp;<span class="op">*</span>&nbsp;<span class="num">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">nsec</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nsec</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="num">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sec</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">Time</span><span class="op">{</span><span class="ident">sec</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">unixToInternal</span><span class="op">,</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="ident">nsec</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">Local</span><span class="op">}</span><br>
<span class="lineno">980</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">isLeap</span><span class="op">(</span><span class="ident">year</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">year</span><span class="op">%</span><span class="num">4</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="op">(</span><span class="ident">year</span><span class="op">%</span><span class="num">100</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">year</span><span class="op">%</span><span class="num">400</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">985</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;norm&nbsp;returns&nbsp;nhi,&nbsp;nlo&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbsphi&nbsp;*&nbsp;base&nbsp;+&nbsp;lo&nbsp;==&nbsp;nhi&nbsp;*&nbsp;base&nbsp;+&nbsp;nlo</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;&lt;=&nbsp;nlo&nbsp;&lt;&nbsp;base</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">norm</span><span class="op">(</span><span class="ident">hi</span><span class="op">,</span>&nbsp;<span class="ident">lo</span><span class="op">,</span>&nbsp;<span class="ident">base</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">nhi</span><span class="op">,</span>&nbsp;<span class="ident">nlo</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">lo</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="op">-</span><span class="ident">lo</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="op">/</span><span class="ident">base</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hi</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lo</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">n</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">lo</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="ident">base</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">lo</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hi</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lo</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">n</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">hi</span><span class="op">,</span>&nbsp;<span class="ident">lo</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Date&nbsp;returns&nbsp;the&nbsp;Time&nbsp;corresponding&nbsp;to</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;&nbsp;&nbsp;&nbspyyyy-mm-dd&nbsp;hh:mm:ss&nbsp;+&nbsp;nsec&nbsp;nanoseconds</span><br>
<span class="lineno">1005</span><span class="comment">//&nbsp;in&nbsp;the&nbsp;appropriate&nbsp;zone&nbsp;for&nbsp;that&nbsp;time&nbsp;in&nbsp;the&nbsp;given&nbsp;location.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;month,&nbsp;day,&nbsp;hour,&nbsp;min,&nbsp;sec,&nbsp;and&nbsp;nsec&nbsp;values&nbsp;may&nbsp;be&nbsp;outside</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;their&nbsp;usual&nbsp;ranges&nbsp;and&nbsp;will&nbsp;be&nbsp;normalized&nbsp;during&nbsp;the&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;For&nbsp;example,&nbsp;October&nbsp;32&nbsp;converts&nbsp;to&nbsp;November&nbsp;1.</span><br>
<span class="lineno">1010</span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;A&nbsp;daylight&nbsp;savings&nbsp;time&nbsp;transition&nbsp;skips&nbsp;or&nbsp;repeats&nbsp;times.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;For&nbsp;example,&nbsp;in&nbsp;the&nbsp;United&nbsp;States,&nbsp;March&nbsp;13,&nbsp;2011&nbsp;2:15am&nbsp;never&nbsp;occurred,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;while&nbsp;November&nbsp;6,&nbsp;2011&nbsp;1:15am&nbsp;occurred&nbsp;twice.&nbsp;&nbsp;In&nbsp;such&nbsp;cases,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;choice&nbsp;of&nbsp;time&nbsp;zone,&nbsp;and&nbsp;therefore&nbsp;the&nbsp;time,&nbsp;is&nbsp;not&nbsp;well-defined.</span><br>
<span class="lineno">1015</span><span class="comment">//&nbsp;Date&nbsp;returns&nbsp;a&nbsp;time&nbsp;that&nbsp;is&nbsp;correct&nbsp;in&nbsp;one&nbsp;of&nbsp;the&nbsp;two&nbsp;zones&nbsp;involved</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;in&nbsp;the&nbsp;transition,&nbsp;but&nbsp;it&nbsp;does&nbsp;not&nbsp;guarantee&nbsp;which.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Date&nbsp;panics&nbsp;if&nbsp;loc&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">Date</span><span class="op">(</span><span class="ident">year</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">month</span>&nbsp;<span class="ident">Month</span><span class="op">,</span>&nbsp;<span class="ident">day</span><span class="op">,</span>&nbsp;<span class="ident">hour</span><span class="op">,</span>&nbsp;<span class="ident">min</span><span class="op">,</span>&nbsp;<span class="ident">sec</span><span class="op">,</span>&nbsp;<span class="ident">nsec</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">loc</span>&nbsp;<span class="op">*</span><span class="ident">Location</span><span class="op">)</span>&nbsp;<span class="ident">Time</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">loc</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">panic</span><span class="op">(</span><span class="string">&#34;time:&nbsp;missing&nbsp;Location&nbsp;in&nbsp;call&nbsp;to&nbsp;Date&#34;</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Normalize&nbsp;month,&nbsp;overflowing&nbsp;into&nbsp;year.</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">m</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">month</span><span class="op">)</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">year</span><span class="op">,</span>&nbsp;<span class="ident">m</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">norm</span><span class="op">(</span><span class="ident">year</span><span class="op">,</span>&nbsp;<span class="ident">m</span><span class="op">,</span>&nbsp;<span class="num">12</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">month</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">Month</span><span class="op">(</span><span class="ident">m</span><span class="op">)</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Normalize&nbsp;nsec,&nbsp;sec,&nbsp;min,&nbsp;hour,&nbsp;overflowing&nbsp;into&nbsp;day.</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sec</span><span class="op">,</span>&nbsp;<span class="ident">nsec</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">norm</span><span class="op">(</span><span class="ident">sec</span><span class="op">,</span>&nbsp;<span class="ident">nsec</span><span class="op">,</span>&nbsp;<span class="num">1e9</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">min</span><span class="op">,</span>&nbsp;<span class="ident">sec</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">norm</span><span class="op">(</span><span class="ident">min</span><span class="op">,</span>&nbsp;<span class="ident">sec</span><span class="op">,</span>&nbsp;<span class="num">60</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">hour</span><span class="op">,</span>&nbsp;<span class="ident">min</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">norm</span><span class="op">(</span><span class="ident">hour</span><span class="op">,</span>&nbsp;<span class="ident">min</span><span class="op">,</span>&nbsp;<span class="num">60</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">day</span><span class="op">,</span>&nbsp;<span class="ident">hour</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">norm</span><span class="op">(</span><span class="ident">day</span><span class="op">,</span>&nbsp;<span class="ident">hour</span><span class="op">,</span>&nbsp;<span class="num">24</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">y</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">int64</span><span class="op">(</span><span class="ident">year</span><span class="op">)</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">absoluteZeroYear</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Compute&nbsp;days&nbsp;since&nbsp;the&nbsp;absolute&nbsp;epoch.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Add&nbsp;in&nbsp;days&nbsp;from&nbsp;400-year&nbsp;cycles.</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">/</span>&nbsp;<span class="num">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">y</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">400</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">daysPer400Years</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Add&nbsp;in&nbsp;100-year&nbsp;cycles.</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">/</span>&nbsp;<span class="num">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">y</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">100</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">daysPer100Years</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Add&nbsp;in&nbsp;4-year&nbsp;cycles.</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">/</span>&nbsp;<span class="num">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">y</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">4</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">daysPer4Years</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Add&nbsp;in&nbsp;non-leap&nbsp;years.</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="num">365</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Add&nbsp;in&nbsp;days&nbsp;before&nbsp;this&nbsp;month.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">daysBefore</span><span class="op">[</span><span class="ident">month</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">isLeap</span><span class="op">(</span><span class="ident">year</span><span class="op">)</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">month</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="ident">March</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">++</span>&nbsp;<span class="comment">//&nbsp;February&nbsp;29</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Add&nbsp;in&nbsp;days&nbsp;before&nbsp;today.</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">day</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Add&nbsp;in&nbsp;time&nbsp;elapsed&nbsp;today.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">abs</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">secondsPerDay</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">abs</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">hour</span><span class="op">*</span><span class="ident">secondsPerHour</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">min</span><span class="op">*</span><span class="ident">secondsPerMinute</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">sec</span><span class="op">)</span><br>
<span class="lineno">1070</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">unix</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">abs</span><span class="op">)</span>&nbsp;<span class="op">+</span>&nbsp;<span class="op">(</span><span class="ident">absoluteToInternal</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">internalToUnix</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Look&nbsp;for&nbsp;zone&nbsp;offset&nbsp;for&nbsp;t,&nbsp;so&nbsp;we&nbsp;can&nbsp;adjust&nbsp;to&nbsp;UTC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;lookup&nbsp;function&nbsp;expects&nbsp;UTC,&nbsp;so&nbsp;we&nbsp;pass&nbsp;t&nbsp;in&nbsp;the</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;hope&nbsp;that&nbsp;it&nbsp;will&nbsp;not&nbsp;be&nbsp;too&nbsp;close&nbsp;to&nbsp;a&nbsp;zone&nbsp;transition,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;and&nbsp;then&nbsp;adjust&nbsp;if&nbsp;it&nbsp;is.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">offset</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">start</span><span class="op">,</span>&nbsp;<span class="ident">end</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">loc</span><span class="op">.</span><span class="ident">lookup</span><span class="op">(</span><span class="ident">unix</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">offset</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">switch</span>&nbsp;<span class="ident">utc</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">unix</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">offset</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">utc</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">start</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">offset</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">loc</span><span class="op">.</span><span class="ident">lookup</span><span class="op">(</span><span class="ident">start</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">utc</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="ident">end</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">offset</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">loc</span><span class="op">.</span><span class="ident">lookup</span><span class="op">(</span><span class="ident">end</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">unix</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">offset</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">Time</span><span class="op">{</span><span class="ident">unix</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">unixToInternal</span><span class="op">,</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="ident">nsec</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">loc</span><span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">1090</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Truncate&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;t&nbsp;down&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;d&nbsp;(since&nbsp;the&nbsp;zero&nbsp;time).</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;If&nbsp;d&nbsp;&lt;=&nbsp;0,&nbsp;Truncate&nbsp;returns&nbsp;t&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Truncate</span><span class="op">(</span><span class="ident">d</span>&nbsp;<span class="ident">Duration</span><span class="op">)</span>&nbsp;<span class="ident">Time</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">div</span><span class="op">(</span><span class="ident">t</span><span class="op">,</span>&nbsp;<span class="ident">d</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Add</span><span class="op">(</span><span class="op">-</span><span class="ident">r</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Round&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;t&nbsp;to&nbsp;the&nbsp;nearest&nbsp;multiple&nbsp;of&nbsp;d&nbsp;(since&nbsp;the&nbsp;zero&nbsp;time).</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;rounding&nbsp;behavior&nbsp;for&nbsp;halfway&nbsp;values&nbsp;is&nbsp;to&nbsp;round&nbsp;up.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;If&nbsp;d&nbsp;&lt;=&nbsp;0,&nbsp;Round&nbsp;returns&nbsp;t&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">)</span>&nbsp;<span class="ident">Round</span><span class="op">(</span><span class="ident">d</span>&nbsp;<span class="ident">Duration</span><span class="op">)</span>&nbsp;<span class="ident">Time</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">div</span><span class="op">(</span><span class="ident">t</span><span class="op">,</span>&nbsp;<span class="ident">d</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">r</span><span class="op">+</span><span class="ident">r</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Add</span><span class="op">(</span><span class="op">-</span><span class="ident">r</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Add</span><span class="op">(</span><span class="ident">d</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">r</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1115</span><span class="comment">//&nbsp;div&nbsp;divides&nbsp;t&nbsp;by&nbsp;d&nbsp;and&nbsp;returns&nbsp;the&nbsp;quotient&nbsp;parity&nbsp;and&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;We&nbsp;don&#39;t&nbsp;use&nbsp;the&nbsp;quotient&nbsp;parity&nbsp;anymore&nbsp;(round&nbsp;half&nbsp;up&nbsp;instead&nbsp;of&nbsp;round&nbsp;to&nbsp;even)</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;but&nbsp;it&#39;s&nbsp;still&nbsp;here&nbsp;in&nbsp;case&nbsp;we&nbsp;change&nbsp;our&nbsp;minds.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">div</span><span class="op">(</span><span class="ident">t</span>&nbsp;<span class="ident">Time</span><span class="op">,</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="ident">Duration</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">qmod2</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="ident">Duration</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">neg</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nsec</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">nsec</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Operate&nbsp;on&nbsp;absolute&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">neg</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">sec</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="ident">t</span><span class="op">.</span><span class="ident">sec</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nsec</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="ident">nsec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">nsec</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nsec</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="num">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">sec</span><span class="op">--</span>&nbsp;<span class="comment">//&nbsp;t.sec&nbsp;&gt;=&nbsp;1&nbsp;before&nbsp;the&nbsp;--&nbsp;so&nbsp;safe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">switch</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Special&nbsp;case:&nbsp;2d&nbsp;divides&nbsp;1&nbsp;second.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">Second</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">Second</span><span class="op">%</span><span class="op">(</span><span class="ident">d</span><span class="op">+</span><span class="ident">d</span><span class="op">)</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><span class="op">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">qmod2</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">nsec</span><span class="op">/</span><span class="builtintype">int32</span><span class="op">(</span><span class="ident">d</span><span class="op">)</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">Duration</span><span class="op">(</span><span class="ident">nsec</span>&nbsp;<span class="op">%</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="ident">d</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Special&nbsp;case:&nbsp;d&nbsp;is&nbsp;a&nbsp;multiple&nbsp;of&nbsp;1&nbsp;second.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">d</span><span class="op">%</span><span class="ident">Second</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><span class="op">:</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">int64</span><span class="op">(</span><span class="ident">d</span>&nbsp;<span class="op">/</span>&nbsp;<span class="ident">Second</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">qmod2</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">sec</span><span class="op">/</span><span class="ident">d1</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">Duration</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">sec</span><span class="op">%</span><span class="ident">d1</span><span class="op">)</span><span class="op">*</span><span class="ident">Second</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">Duration</span><span class="op">(</span><span class="ident">nsec</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;General&nbsp;case.</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;This&nbsp;could&nbsp;be&nbsp;faster&nbsp;if&nbsp;more&nbsp;cleverness&nbsp;were&nbsp;applied,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;but&nbsp;it&#39;s&nbsp;really&nbsp;only&nbsp;here&nbsp;to&nbsp;avoid&nbsp;special&nbsp;case&nbsp;restrictions&nbsp;in&nbsp;the&nbsp;API.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;No&nbsp;one&nbsp;will&nbsp;care&nbsp;about&nbsp;these&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">default</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Compute&nbsp;nanoseconds&nbsp;as&nbsp;128-bit&nbsp;number.</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sec</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">sec</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">tmp</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">(</span><span class="ident">sec</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">32</span><span class="op">)</span>&nbsp;<span class="op">*</span>&nbsp;<span class="num">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">u1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">tmp</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">u0</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">tmp</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">tmp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">sec</span><span class="op">&amp;</span><span class="num">0xFFFFFFFF</span><span class="op">)</span>&nbsp;<span class="op">*</span>&nbsp;<span class="num">1e9</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">u0x</span><span class="op">,</span>&nbsp;<span class="ident">u0</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">u0</span><span class="op">,</span>&nbsp;<span class="ident">u0</span><span class="op">+</span><span class="ident">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">u0</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">u0x</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">u1</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">u0x</span><span class="op">,</span>&nbsp;<span class="ident">u0</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">u0</span><span class="op">,</span>&nbsp;<span class="ident">u0</span><span class="op">+</span><span class="ident">uint64</span><span class="op">(</span><span class="ident">nsec</span><span class="op">)</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">u0</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">u0x</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">u1</span><span class="op">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Compute&nbsp;remainder&nbsp;by&nbsp;subtracting&nbsp;r&lt;&lt;k&nbsp;for&nbsp;decreasing&nbsp;k.</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Quotient&nbsp;parity&nbsp;is&nbsp;whether&nbsp;we&nbsp;subtract&nbsp;on&nbsp;last&nbsp;round.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">d</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">d1</span><span class="op">&gt;&gt;</span><span class="num">63</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d1</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d0</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="num">0</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">qmod2</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">u1</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">d1</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">u1</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">d1</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">u0</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="ident">d0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;subtract</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">qmod2</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">u0x</span><span class="op">,</span>&nbsp;<span class="ident">u0</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">u0</span><span class="op">,</span>&nbsp;<span class="ident">u0</span><span class="op">-</span><span class="ident">d0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">u0</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="ident">u0x</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">u1</span><span class="op">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">u1</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">d1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">d1</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">d0</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">d</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d0</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d0</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="op">(</span><span class="ident">d1</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">1</span><span class="op">)</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">63</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d1</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">Duration</span><span class="op">(</span><span class="ident">u0</span><span class="op">)</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">neg</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;If&nbsp;input&nbsp;was&nbsp;negative&nbsp;and&nbsp;not&nbsp;an&nbsp;exact&nbsp;multiple&nbsp;of&nbsp;d,&nbsp;we&nbsp;computed&nbsp;q,&nbsp;r&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbspq*d&nbsp;+&nbsp;r&nbsp;=&nbsp;-t</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;But&nbsp;the&nbsp;right&nbsp;answers&nbsp;are&nbsp;given&nbsp;by&nbsp;-(q-1),&nbsp;d-r:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbspq*d&nbsp;+&nbsp;r&nbsp;=&nbsp;-t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp-q*d&nbsp;-&nbsp;r&nbsp;=&nbsp;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp-(q-1)*d&nbsp;+&nbsp;(d&nbsp;-&nbsp;r)&nbsp;=&nbsp;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">qmod2</span>&nbsp;<span class="op">^=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">d</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span><span class="op">}</span>
</div>
</body>
</html>
