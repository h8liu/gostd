<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html" class="current">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7556793">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7556849">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7556903">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7556954">package</span>&nbsp;<span class="ident" id="7556962">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7556967">import</span>&nbsp;<span class="op" id="7556974">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7556977">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7556986">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7556993">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7556999">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7557010">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7557021">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7557032">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7557039">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7557042">type</span>&nbsp;<span class="ident" id="7557047">resolveIPAddrTest</span>&nbsp;<span class="keyword" id="7557065">struct</span>&nbsp;<span class="op" id="7557072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557075">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7557089">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557097">litAddrOrName</span>&nbsp;<span class="builtintype" id="7557111">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557119">addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7557133">*</span><span class="ident" id="7557134">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7557142">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7557156">error</span><br>
<span class="lineno"></span><span class="op" id="7557162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7557165">var</span>&nbsp;<span class="ident" id="7557169">resolveIPAddrTests</span>&nbsp;<span class="op" id="7557188">=</span>&nbsp;<span class="op" id="7557190">[</span><span class="op" id="7557191">]</span><span class="ident" id="7557192">resolveIPAddrTest</span><span class="op" id="7557209">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557212">{</span><span class="string" id="7557213">&#34;ip&#34;</span><span class="op" id="7557217">,</span>&nbsp;<span class="string" id="7557219">&#34;127.0.0.1&#34;</span><span class="op" id="7557230">,</span>&nbsp;<span class="op" id="7557232">&amp;</span><span class="ident" id="7557233">IPAddr</span><span class="op" id="7557239">{</span><span class="ident" id="7557240">IP</span><span class="op" id="7557242">:</span>&nbsp;<span class="ident" id="7557244">IPv4</span><span class="op" id="7557248">(</span><span class="num" id="7557249">127</span><span class="op" id="7557252">,</span>&nbsp;<span class="num" id="7557254">0</span><span class="op" id="7557255">,</span>&nbsp;<span class="num" id="7557257">0</span><span class="op" id="7557258">,</span>&nbsp;<span class="num" id="7557260">1</span><span class="op" id="7557261">)</span><span class="op" id="7557262">}</span><span class="op" id="7557263">,</span>&nbsp;<span class="ident" id="7557265">nil</span><span class="op" id="7557268">}</span><span class="op" id="7557269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557272">{</span><span class="string" id="7557273">&#34;ip4&#34;</span><span class="op" id="7557278">,</span>&nbsp;<span class="string" id="7557280">&#34;127.0.0.1&#34;</span><span class="op" id="7557291">,</span>&nbsp;<span class="op" id="7557293">&amp;</span><span class="ident" id="7557294">IPAddr</span><span class="op" id="7557300">{</span><span class="ident" id="7557301">IP</span><span class="op" id="7557303">:</span>&nbsp;<span class="ident" id="7557305">IPv4</span><span class="op" id="7557309">(</span><span class="num" id="7557310">127</span><span class="op" id="7557313">,</span>&nbsp;<span class="num" id="7557315">0</span><span class="op" id="7557316">,</span>&nbsp;<span class="num" id="7557318">0</span><span class="op" id="7557319">,</span>&nbsp;<span class="num" id="7557321">1</span><span class="op" id="7557322">)</span><span class="op" id="7557323">}</span><span class="op" id="7557324">,</span>&nbsp;<span class="ident" id="7557326">nil</span><span class="op" id="7557329">}</span><span class="op" id="7557330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557333">{</span><span class="string" id="7557334">&#34;ip4:icmp&#34;</span><span class="op" id="7557344">,</span>&nbsp;<span class="string" id="7557346">&#34;127.0.0.1&#34;</span><span class="op" id="7557357">,</span>&nbsp;<span class="op" id="7557359">&amp;</span><span class="ident" id="7557360">IPAddr</span><span class="op" id="7557366">{</span><span class="ident" id="7557367">IP</span><span class="op" id="7557369">:</span>&nbsp;<span class="ident" id="7557371">IPv4</span><span class="op" id="7557375">(</span><span class="num" id="7557376">127</span><span class="op" id="7557379">,</span>&nbsp;<span class="num" id="7557381">0</span><span class="op" id="7557382">,</span>&nbsp;<span class="num" id="7557384">0</span><span class="op" id="7557385">,</span>&nbsp;<span class="num" id="7557387">1</span><span class="op" id="7557388">)</span><span class="op" id="7557389">}</span><span class="op" id="7557390">,</span>&nbsp;<span class="ident" id="7557392">nil</span><span class="op" id="7557395">}</span><span class="op" id="7557396">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557400">{</span><span class="string" id="7557401">&#34;ip&#34;</span><span class="op" id="7557405">,</span>&nbsp;<span class="string" id="7557407">&#34;::1&#34;</span><span class="op" id="7557412">,</span>&nbsp;<span class="op" id="7557414">&amp;</span><span class="ident" id="7557415">IPAddr</span><span class="op" id="7557421">{</span><span class="ident" id="7557422">IP</span><span class="op" id="7557424">:</span>&nbsp;<span class="ident" id="7557426">ParseIP</span><span class="op" id="7557433">(</span><span class="string" id="7557434">&#34;::1&#34;</span><span class="op" id="7557439">)</span><span class="op" id="7557440">}</span><span class="op" id="7557441">,</span>&nbsp;<span class="ident" id="7557443">nil</span><span class="op" id="7557446">}</span><span class="op" id="7557447">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557450">{</span><span class="string" id="7557451">&#34;ip6&#34;</span><span class="op" id="7557456">,</span>&nbsp;<span class="string" id="7557458">&#34;::1&#34;</span><span class="op" id="7557463">,</span>&nbsp;<span class="op" id="7557465">&amp;</span><span class="ident" id="7557466">IPAddr</span><span class="op" id="7557472">{</span><span class="ident" id="7557473">IP</span><span class="op" id="7557475">:</span>&nbsp;<span class="ident" id="7557477">ParseIP</span><span class="op" id="7557484">(</span><span class="string" id="7557485">&#34;::1&#34;</span><span class="op" id="7557490">)</span><span class="op" id="7557491">}</span><span class="op" id="7557492">,</span>&nbsp;<span class="ident" id="7557494">nil</span><span class="op" id="7557497">}</span><span class="op" id="7557498">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557501">{</span><span class="string" id="7557502">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="7557517">,</span>&nbsp;<span class="string" id="7557519">&#34;::1&#34;</span><span class="op" id="7557524">,</span>&nbsp;<span class="op" id="7557526">&amp;</span><span class="ident" id="7557527">IPAddr</span><span class="op" id="7557533">{</span><span class="ident" id="7557534">IP</span><span class="op" id="7557536">:</span>&nbsp;<span class="ident" id="7557538">ParseIP</span><span class="op" id="7557545">(</span><span class="string" id="7557546">&#34;::1&#34;</span><span class="op" id="7557551">)</span><span class="op" id="7557552">}</span><span class="op" id="7557553">,</span>&nbsp;<span class="ident" id="7557555">nil</span><span class="op" id="7557558">}</span><span class="op" id="7557559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557562">{</span><span class="string" id="7557563">&#34;ip6:IPv6-ICMP&#34;</span><span class="op" id="7557578">,</span>&nbsp;<span class="string" id="7557580">&#34;::1&#34;</span><span class="op" id="7557585">,</span>&nbsp;<span class="op" id="7557587">&amp;</span><span class="ident" id="7557588">IPAddr</span><span class="op" id="7557594">{</span><span class="ident" id="7557595">IP</span><span class="op" id="7557597">:</span>&nbsp;<span class="ident" id="7557599">ParseIP</span><span class="op" id="7557606">(</span><span class="string" id="7557607">&#34;::1&#34;</span><span class="op" id="7557612">)</span><span class="op" id="7557613">}</span><span class="op" id="7557614">,</span>&nbsp;<span class="ident" id="7557616">nil</span><span class="op" id="7557619">}</span><span class="op" id="7557620">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557624">{</span><span class="string" id="7557625">&#34;ip&#34;</span><span class="op" id="7557629">,</span>&nbsp;<span class="string" id="7557631">&#34;::1%en0&#34;</span><span class="op" id="7557640">,</span>&nbsp;<span class="op" id="7557642">&amp;</span><span class="ident" id="7557643">IPAddr</span><span class="op" id="7557649">{</span><span class="ident" id="7557650">IP</span><span class="op" id="7557652">:</span>&nbsp;<span class="ident" id="7557654">ParseIP</span><span class="op" id="7557661">(</span><span class="string" id="7557662">&#34;::1&#34;</span><span class="op" id="7557667">)</span><span class="op" id="7557668">,</span>&nbsp;<span class="ident" id="7557670">Zone</span><span class="op" id="7557674">:</span>&nbsp;<span class="string" id="7557676">&#34;en0&#34;</span><span class="op" id="7557681">}</span><span class="op" id="7557682">,</span>&nbsp;<span class="ident" id="7557684">nil</span><span class="op" id="7557687">}</span><span class="op" id="7557688">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557691">{</span><span class="string" id="7557692">&#34;ip6&#34;</span><span class="op" id="7557697">,</span>&nbsp;<span class="string" id="7557699">&#34;::1%911&#34;</span><span class="op" id="7557708">,</span>&nbsp;<span class="op" id="7557710">&amp;</span><span class="ident" id="7557711">IPAddr</span><span class="op" id="7557717">{</span><span class="ident" id="7557718">IP</span><span class="op" id="7557720">:</span>&nbsp;<span class="ident" id="7557722">ParseIP</span><span class="op" id="7557729">(</span><span class="string" id="7557730">&#34;::1&#34;</span><span class="op" id="7557735">)</span><span class="op" id="7557736">,</span>&nbsp;<span class="ident" id="7557738">Zone</span><span class="op" id="7557742">:</span>&nbsp;<span class="string" id="7557744">&#34;911&#34;</span><span class="op" id="7557749">}</span><span class="op" id="7557750">,</span>&nbsp;<span class="ident" id="7557752">nil</span><span class="op" id="7557755">}</span><span class="op" id="7557756">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557760">{</span><span class="string" id="7557761">&#34;&#34;</span><span class="op" id="7557763">,</span>&nbsp;<span class="string" id="7557765">&#34;127.0.0.1&#34;</span><span class="op" id="7557776">,</span>&nbsp;<span class="op" id="7557778">&amp;</span><span class="ident" id="7557779">IPAddr</span><span class="op" id="7557785">{</span><span class="ident" id="7557786">IP</span><span class="op" id="7557788">:</span>&nbsp;<span class="ident" id="7557790">IPv4</span><span class="op" id="7557794">(</span><span class="num" id="7557795">127</span><span class="op" id="7557798">,</span>&nbsp;<span class="num" id="7557800">0</span><span class="op" id="7557801">,</span>&nbsp;<span class="num" id="7557803">0</span><span class="op" id="7557804">,</span>&nbsp;<span class="num" id="7557806">1</span><span class="op" id="7557807">)</span><span class="op" id="7557808">}</span><span class="op" id="7557809">,</span>&nbsp;<span class="ident" id="7557811">nil</span><span class="op" id="7557814">}</span><span class="op" id="7557815">,</span>&nbsp;<span class="comment" id="7557817">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557837">{</span><span class="string" id="7557838">&#34;&#34;</span><span class="op" id="7557840">,</span>&nbsp;<span class="string" id="7557842">&#34;::1&#34;</span><span class="op" id="7557847">,</span>&nbsp;<span class="op" id="7557849">&amp;</span><span class="ident" id="7557850">IPAddr</span><span class="op" id="7557856">{</span><span class="ident" id="7557857">IP</span><span class="op" id="7557859">:</span>&nbsp;<span class="ident" id="7557861">ParseIP</span><span class="op" id="7557868">(</span><span class="string" id="7557869">&#34;::1&#34;</span><span class="op" id="7557874">)</span><span class="op" id="7557875">}</span><span class="op" id="7557876">,</span>&nbsp;<span class="ident" id="7557878">nil</span><span class="op" id="7557881">}</span><span class="op" id="7557882">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7557894">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557915">{</span><span class="string" id="7557916">&#34;l2tp&#34;</span><span class="op" id="7557922">,</span>&nbsp;<span class="string" id="7557924">&#34;127.0.0.1&#34;</span><span class="op" id="7557935">,</span>&nbsp;<span class="ident" id="7557937">nil</span><span class="op" id="7557940">,</span>&nbsp;<span class="ident" id="7557942">UnknownNetworkError</span><span class="op" id="7557961">(</span><span class="string" id="7557962">&#34;l2tp&#34;</span><span class="op" id="7557968">)</span><span class="op" id="7557969">}</span><span class="op" id="7557970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7557973">{</span><span class="string" id="7557974">&#34;l2tp:gre&#34;</span><span class="op" id="7557984">,</span>&nbsp;<span class="string" id="7557986">&#34;127.0.0.1&#34;</span><span class="op" id="7557997">,</span>&nbsp;<span class="ident" id="7557999">nil</span><span class="op" id="7558002">,</span>&nbsp;<span class="ident" id="7558004">UnknownNetworkError</span><span class="op" id="7558023">(</span><span class="string" id="7558024">&#34;l2tp:gre&#34;</span><span class="op" id="7558034">)</span><span class="op" id="7558035">}</span><span class="op" id="7558036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558039">{</span><span class="string" id="7558040">&#34;tcp&#34;</span><span class="op" id="7558045">,</span>&nbsp;<span class="string" id="7558047">&#34;1.2.3.4:123&#34;</span><span class="op" id="7558060">,</span>&nbsp;<span class="ident" id="7558062">nil</span><span class="op" id="7558065">,</span>&nbsp;<span class="ident" id="7558067">UnknownNetworkError</span><span class="op" id="7558086">(</span><span class="string" id="7558087">&#34;tcp&#34;</span><span class="op" id="7558092">)</span><span class="op" id="7558093">}</span><span class="op" id="7558094">,</span><br>
<span class="lineno"></span><span class="op" id="7558096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="7558099">func</span>&nbsp;<span class="ident" id="7558104">init</span><span class="op" id="7558108">(</span><span class="op" id="7558109">)</span>&nbsp;<span class="op" id="7558111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558114">if</span>&nbsp;<span class="ident" id="7558117">ifi</span>&nbsp;<span class="op" id="7558121">:=</span>&nbsp;<span class="ident" id="7558124">loopbackInterface</span><span class="op" id="7558141">(</span><span class="op" id="7558142">)</span><span class="op" id="7558143">;</span>&nbsp;<span class="ident" id="7558145">ifi</span>&nbsp;<span class="op" id="7558149">!=</span>&nbsp;<span class="ident" id="7558152">nil</span>&nbsp;<span class="op" id="7558156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558160">index</span>&nbsp;<span class="op" id="7558166">:=</span>&nbsp;<span class="ident" id="7558169">fmt</span><span class="op" id="7558172">.</span><span class="ident" id="7558173">Sprintf</span><span class="op" id="7558180">(</span><span class="string" id="7558181">&#34;%v&#34;</span><span class="op" id="7558185">,</span>&nbsp;<span class="ident" id="7558187">ifi</span><span class="op" id="7558190">.</span><span class="ident" id="7558191">Index</span><span class="op" id="7558196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558200">resolveIPAddrTests</span>&nbsp;<span class="op" id="7558219">=</span>&nbsp;<span class="builtinfunc" id="7558221">append</span><span class="op" id="7558227">(</span><span class="ident" id="7558228">resolveIPAddrTests</span><span class="op" id="7558246">,</span>&nbsp;<span class="op" id="7558248">[</span><span class="op" id="7558249">]</span><span class="ident" id="7558250">resolveIPAddrTest</span><span class="op" id="7558267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558272">{</span><span class="string" id="7558273">&#34;ip6&#34;</span><span class="op" id="7558278">,</span>&nbsp;<span class="string" id="7558280">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="7558291">+</span>&nbsp;<span class="ident" id="7558293">ifi</span><span class="op" id="7558296">.</span><span class="ident" id="7558297">Name</span><span class="op" id="7558301">,</span>&nbsp;<span class="op" id="7558303">&amp;</span><span class="ident" id="7558304">IPAddr</span><span class="op" id="7558310">{</span><span class="ident" id="7558311">IP</span><span class="op" id="7558313">:</span>&nbsp;<span class="ident" id="7558315">ParseIP</span><span class="op" id="7558322">(</span><span class="string" id="7558323">&#34;fe80::1&#34;</span><span class="op" id="7558332">)</span><span class="op" id="7558333">,</span>&nbsp;<span class="ident" id="7558335">Zone</span><span class="op" id="7558339">:</span>&nbsp;<span class="ident" id="7558341">zoneToString</span><span class="op" id="7558353">(</span><span class="ident" id="7558354">ifi</span><span class="op" id="7558357">.</span><span class="ident" id="7558358">Index</span><span class="op" id="7558363">)</span><span class="op" id="7558364">}</span><span class="op" id="7558365">,</span>&nbsp;<span class="ident" id="7558367">nil</span><span class="op" id="7558370">}</span><span class="op" id="7558371">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558376">{</span><span class="string" id="7558377">&#34;ip6&#34;</span><span class="op" id="7558382">,</span>&nbsp;<span class="string" id="7558384">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="7558395">+</span>&nbsp;<span class="ident" id="7558397">index</span><span class="op" id="7558402">,</span>&nbsp;<span class="op" id="7558404">&amp;</span><span class="ident" id="7558405">IPAddr</span><span class="op" id="7558411">{</span><span class="ident" id="7558412">IP</span><span class="op" id="7558414">:</span>&nbsp;<span class="ident" id="7558416">ParseIP</span><span class="op" id="7558423">(</span><span class="string" id="7558424">&#34;fe80::1&#34;</span><span class="op" id="7558433">)</span><span class="op" id="7558434">,</span>&nbsp;<span class="ident" id="7558436">Zone</span><span class="op" id="7558440">:</span>&nbsp;<span class="ident" id="7558442">index</span><span class="op" id="7558447">}</span><span class="op" id="7558448">,</span>&nbsp;<span class="ident" id="7558450">nil</span><span class="op" id="7558453">}</span><span class="op" id="7558454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558458">}</span><span class="op" id="7558459">...</span><span class="op" id="7558462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558468">if</span>&nbsp;<span class="ident" id="7558471">ips</span><span class="op" id="7558474">,</span>&nbsp;<span class="ident" id="7558476">err</span>&nbsp;<span class="op" id="7558480">:=</span>&nbsp;<span class="ident" id="7558483">LookupIP</span><span class="op" id="7558491">(</span><span class="string" id="7558492">&#34;localhost&#34;</span><span class="op" id="7558503">)</span><span class="op" id="7558504">;</span>&nbsp;<span class="ident" id="7558506">err</span>&nbsp;<span class="op" id="7558510">==</span>&nbsp;<span class="ident" id="7558513">nil</span>&nbsp;<span class="op" id="7558517">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="7558520">len</span><span class="op" id="7558523">(</span><span class="ident" id="7558524">ips</span><span class="op" id="7558527">)</span>&nbsp;<span class="op" id="7558529">&gt;</span>&nbsp;<span class="num" id="7558531">1</span>&nbsp;<span class="op" id="7558533">&amp;&amp;</span>&nbsp;<span class="ident" id="7558536">supportsIPv4</span>&nbsp;<span class="op" id="7558549">&amp;&amp;</span>&nbsp;<span class="ident" id="7558552">supportsIPv6</span>&nbsp;<span class="op" id="7558565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558569">resolveIPAddrTests</span>&nbsp;<span class="op" id="7558588">=</span>&nbsp;<span class="builtinfunc" id="7558590">append</span><span class="op" id="7558596">(</span><span class="ident" id="7558597">resolveIPAddrTests</span><span class="op" id="7558615">,</span>&nbsp;<span class="op" id="7558617">[</span><span class="op" id="7558618">]</span><span class="ident" id="7558619">resolveIPAddrTest</span><span class="op" id="7558636">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558641">{</span><span class="string" id="7558642">&#34;ip&#34;</span><span class="op" id="7558646">,</span>&nbsp;<span class="string" id="7558648">&#34;localhost&#34;</span><span class="op" id="7558659">,</span>&nbsp;<span class="op" id="7558661">&amp;</span><span class="ident" id="7558662">IPAddr</span><span class="op" id="7558668">{</span><span class="ident" id="7558669">IP</span><span class="op" id="7558671">:</span>&nbsp;<span class="ident" id="7558673">IPv4</span><span class="op" id="7558677">(</span><span class="num" id="7558678">127</span><span class="op" id="7558681">,</span>&nbsp;<span class="num" id="7558683">0</span><span class="op" id="7558684">,</span>&nbsp;<span class="num" id="7558686">0</span><span class="op" id="7558687">,</span>&nbsp;<span class="num" id="7558689">1</span><span class="op" id="7558690">)</span><span class="op" id="7558691">}</span><span class="op" id="7558692">,</span>&nbsp;<span class="ident" id="7558694">nil</span><span class="op" id="7558697">}</span><span class="op" id="7558698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558703">{</span><span class="string" id="7558704">&#34;ip4&#34;</span><span class="op" id="7558709">,</span>&nbsp;<span class="string" id="7558711">&#34;localhost&#34;</span><span class="op" id="7558722">,</span>&nbsp;<span class="op" id="7558724">&amp;</span><span class="ident" id="7558725">IPAddr</span><span class="op" id="7558731">{</span><span class="ident" id="7558732">IP</span><span class="op" id="7558734">:</span>&nbsp;<span class="ident" id="7558736">IPv4</span><span class="op" id="7558740">(</span><span class="num" id="7558741">127</span><span class="op" id="7558744">,</span>&nbsp;<span class="num" id="7558746">0</span><span class="op" id="7558747">,</span>&nbsp;<span class="num" id="7558749">0</span><span class="op" id="7558750">,</span>&nbsp;<span class="num" id="7558752">1</span><span class="op" id="7558753">)</span><span class="op" id="7558754">}</span><span class="op" id="7558755">,</span>&nbsp;<span class="ident" id="7558757">nil</span><span class="op" id="7558760">}</span><span class="op" id="7558761">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558766">{</span><span class="string" id="7558767">&#34;ip6&#34;</span><span class="op" id="7558772">,</span>&nbsp;<span class="string" id="7558774">&#34;localhost&#34;</span><span class="op" id="7558785">,</span>&nbsp;<span class="op" id="7558787">&amp;</span><span class="ident" id="7558788">IPAddr</span><span class="op" id="7558794">{</span><span class="ident" id="7558795">IP</span><span class="op" id="7558797">:</span>&nbsp;<span class="ident" id="7558799">IPv6loopback</span><span class="op" id="7558811">}</span><span class="op" id="7558812">,</span>&nbsp;<span class="ident" id="7558814">nil</span><span class="op" id="7558817">}</span><span class="op" id="7558818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558822">}</span><span class="op" id="7558823">...</span><span class="op" id="7558826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558829">}</span><br>
<span class="lineno">60</span><span class="op" id="7558831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7558834">func</span>&nbsp;<span class="ident" id="7558839">skipRawSocketTest</span><span class="op" id="7558856">(</span><span class="ident" id="7558857">t</span>&nbsp;<span class="op" id="7558859">*</span><span class="ident" id="7558860">testing</span><span class="op" id="7558867">.</span><span class="ident" id="7558868">T</span><span class="op" id="7558869">)</span>&nbsp;<span class="op" id="7558871">(</span><span class="ident" id="7558872">skip</span>&nbsp;<span class="builtintype" id="7558877">bool</span><span class="op" id="7558881">,</span>&nbsp;<span class="ident" id="7558883">skipmsg</span>&nbsp;<span class="builtintype" id="7558891">string</span><span class="op" id="7558897">)</span>&nbsp;<span class="op" id="7558899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558902">skip</span><span class="op" id="7558906">,</span>&nbsp;<span class="ident" id="7558908">skipmsg</span><span class="op" id="7558915">,</span>&nbsp;<span class="ident" id="7558917">err</span>&nbsp;<span class="op" id="7558921">:=</span>&nbsp;<span class="ident" id="7558924">skipRawSocketTests</span><span class="op" id="7558942">(</span><span class="op" id="7558943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558946">if</span>&nbsp;<span class="ident" id="7558949">err</span>&nbsp;<span class="op" id="7558953">!=</span>&nbsp;<span class="ident" id="7558956">nil</span>&nbsp;<span class="op" id="7558960">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7558964">t</span><span class="op" id="7558965">.</span><span class="ident" id="7558966">Fatal</span><span class="op" id="7558971">(</span><span class="ident" id="7558972">err</span><span class="op" id="7558975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7558978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7558981">return</span>&nbsp;<span class="ident" id="7558988">skip</span><span class="op" id="7558992">,</span>&nbsp;<span class="ident" id="7558994">skipmsg</span><br>
<span class="lineno"></span><span class="op" id="7559002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7559005">func</span>&nbsp;<span class="ident" id="7559010">TestResolveIPAddr</span><span class="op" id="7559027">(</span><span class="ident" id="7559028">t</span>&nbsp;<span class="op" id="7559030">*</span><span class="ident" id="7559031">testing</span><span class="op" id="7559038">.</span><span class="ident" id="7559039">T</span><span class="op" id="7559040">)</span>&nbsp;<span class="op" id="7559042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559045">switch</span>&nbsp;<span class="ident" id="7559052">runtime</span><span class="op" id="7559059">.</span><span class="ident" id="7559060">GOOS</span>&nbsp;<span class="op" id="7559065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559068">case</span>&nbsp;<span class="string" id="7559073">&#34;nacl&#34;</span><span class="op" id="7559079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559083">t</span><span class="op" id="7559084">.</span><span class="ident" id="7559085">Skipf</span><span class="op" id="7559090">(</span><span class="string" id="7559091">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7559112">,</span>&nbsp;<span class="ident" id="7559114">runtime</span><span class="op" id="7559121">.</span><span class="ident" id="7559122">GOOS</span><span class="op" id="7559126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559129">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559133">for</span>&nbsp;<span class="ident" id="7559137">_</span><span class="op" id="7559138">,</span>&nbsp;<span class="ident" id="7559140">tt</span>&nbsp;<span class="op" id="7559143">:=</span>&nbsp;<span class="keyword" id="7559146">range</span>&nbsp;<span class="ident" id="7559152">resolveIPAddrTests</span>&nbsp;<span class="op" id="7559171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559175">addr</span><span class="op" id="7559179">,</span>&nbsp;<span class="ident" id="7559181">err</span>&nbsp;<span class="op" id="7559185">:=</span>&nbsp;<span class="ident" id="7559188">ResolveIPAddr</span><span class="op" id="7559201">(</span><span class="ident" id="7559202">tt</span><span class="op" id="7559204">.</span><span class="ident" id="7559205">net</span><span class="op" id="7559208">,</span>&nbsp;<span class="ident" id="7559210">tt</span><span class="op" id="7559212">.</span><span class="ident" id="7559213">litAddrOrName</span><span class="op" id="7559226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559230">if</span>&nbsp;<span class="ident" id="7559233">err</span>&nbsp;<span class="op" id="7559237">!=</span>&nbsp;<span class="ident" id="7559240">tt</span><span class="op" id="7559242">.</span><span class="ident" id="7559243">err</span>&nbsp;<span class="op" id="7559247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559252">t</span><span class="op" id="7559253">.</span><span class="ident" id="7559254">Fatalf</span><span class="op" id="7559260">(</span><span class="string" id="7559261">&#34;ResolveIPAddr(%v,&nbsp;%v)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7559295">,</span>&nbsp;<span class="ident" id="7559297">tt</span><span class="op" id="7559299">.</span><span class="ident" id="7559300">net</span><span class="op" id="7559303">,</span>&nbsp;<span class="ident" id="7559305">tt</span><span class="op" id="7559307">.</span><span class="ident" id="7559308">litAddrOrName</span><span class="op" id="7559321">,</span>&nbsp;<span class="ident" id="7559323">err</span><span class="op" id="7559326">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559330">}</span>&nbsp;<span class="keyword" id="7559332">else</span>&nbsp;<span class="keyword" id="7559337">if</span>&nbsp;<span class="op" id="7559340">!</span><span class="ident" id="7559341">reflect</span><span class="op" id="7559348">.</span><span class="ident" id="7559349">DeepEqual</span><span class="op" id="7559358">(</span><span class="ident" id="7559359">addr</span><span class="op" id="7559363">,</span>&nbsp;<span class="ident" id="7559365">tt</span><span class="op" id="7559367">.</span><span class="ident" id="7559368">addr</span><span class="op" id="7559372">)</span>&nbsp;<span class="op" id="7559374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559379">t</span><span class="op" id="7559380">.</span><span class="ident" id="7559381">Fatalf</span><span class="op" id="7559387">(</span><span class="string" id="7559388">&#34;got&nbsp;%#v;&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="7559411">,</span>&nbsp;<span class="ident" id="7559413">addr</span><span class="op" id="7559417">,</span>&nbsp;<span class="ident" id="7559419">tt</span><span class="op" id="7559421">.</span><span class="ident" id="7559422">addr</span><span class="op" id="7559426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559433">}</span><br>
<span class="lineno"></span><span class="op" id="7559435">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="7559438">var</span>&nbsp;<span class="ident" id="7559442">icmpEchoTests</span>&nbsp;<span class="op" id="7559456">=</span>&nbsp;<span class="op" id="7559458">[</span><span class="op" id="7559459">]</span><span class="keyword" id="7559460">struct</span>&nbsp;<span class="op" id="7559467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559470">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7559476">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559484">laddr</span>&nbsp;<span class="builtintype" id="7559490">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559498">raddr</span>&nbsp;<span class="builtintype" id="7559504">string</span><br>
<span class="lineno">90</span><span class="op" id="7559511">}</span><span class="op" id="7559512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559515">{</span><span class="string" id="7559516">&#34;ip4:icmp&#34;</span><span class="op" id="7559526">,</span>&nbsp;<span class="string" id="7559528">&#34;0.0.0.0&#34;</span><span class="op" id="7559537">,</span>&nbsp;<span class="string" id="7559539">&#34;127.0.0.1&#34;</span><span class="op" id="7559550">}</span><span class="op" id="7559551">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559554">{</span><span class="string" id="7559555">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="7559570">,</span>&nbsp;<span class="string" id="7559572">&#34;::&#34;</span><span class="op" id="7559576">,</span>&nbsp;<span class="string" id="7559578">&#34;::1&#34;</span><span class="op" id="7559583">}</span><span class="op" id="7559584">,</span><br>
<span class="lineno"></span><span class="op" id="7559586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7559589">func</span>&nbsp;<span class="ident" id="7559594">TestConnICMPEcho</span><span class="op" id="7559610">(</span><span class="ident" id="7559611">t</span>&nbsp;<span class="op" id="7559613">*</span><span class="ident" id="7559614">testing</span><span class="op" id="7559621">.</span><span class="ident" id="7559622">T</span><span class="op" id="7559623">)</span>&nbsp;<span class="op" id="7559625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559628">if</span>&nbsp;<span class="ident" id="7559631">skip</span><span class="op" id="7559635">,</span>&nbsp;<span class="ident" id="7559637">skipmsg</span>&nbsp;<span class="op" id="7559645">:=</span>&nbsp;<span class="ident" id="7559648">skipRawSocketTest</span><span class="op" id="7559665">(</span><span class="ident" id="7559666">t</span><span class="op" id="7559667">)</span><span class="op" id="7559668">;</span>&nbsp;<span class="ident" id="7559670">skip</span>&nbsp;<span class="op" id="7559675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559679">t</span><span class="op" id="7559680">.</span><span class="ident" id="7559681">Skip</span><span class="op" id="7559685">(</span><span class="ident" id="7559686">skipmsg</span><span class="op" id="7559693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559700">for</span>&nbsp;<span class="ident" id="7559704">i</span><span class="op" id="7559705">,</span>&nbsp;<span class="ident" id="7559707">tt</span>&nbsp;<span class="op" id="7559710">:=</span>&nbsp;<span class="keyword" id="7559713">range</span>&nbsp;<span class="ident" id="7559719">icmpEchoTests</span>&nbsp;<span class="op" id="7559733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559737">net</span><span class="op" id="7559740">,</span>&nbsp;<span class="ident" id="7559742">_</span><span class="op" id="7559743">,</span>&nbsp;<span class="ident" id="7559745">err</span>&nbsp;<span class="op" id="7559749">:=</span>&nbsp;<span class="ident" id="7559752">parseNetwork</span><span class="op" id="7559764">(</span><span class="ident" id="7559765">tt</span><span class="op" id="7559767">.</span><span class="ident" id="7559768">net</span><span class="op" id="7559771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559775">if</span>&nbsp;<span class="ident" id="7559778">err</span>&nbsp;<span class="op" id="7559782">!=</span>&nbsp;<span class="ident" id="7559785">nil</span>&nbsp;<span class="op" id="7559789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559794">t</span><span class="op" id="7559795">.</span><span class="ident" id="7559796">Fatalf</span><span class="op" id="7559802">(</span><span class="string" id="7559803">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7559828">,</span>&nbsp;<span class="ident" id="7559830">err</span><span class="op" id="7559833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559837">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559841">if</span>&nbsp;<span class="ident" id="7559844">net</span>&nbsp;<span class="op" id="7559848">==</span>&nbsp;<span class="string" id="7559851">&#34;ip6&#34;</span>&nbsp;<span class="op" id="7559857">&amp;&amp;</span>&nbsp;<span class="op" id="7559860">!</span><span class="ident" id="7559861">supportsIPv6</span>&nbsp;<span class="op" id="7559874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559879">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559895">c</span><span class="op" id="7559896">,</span>&nbsp;<span class="ident" id="7559898">err</span>&nbsp;<span class="op" id="7559902">:=</span>&nbsp;<span class="ident" id="7559905">Dial</span><span class="op" id="7559909">(</span><span class="ident" id="7559910">tt</span><span class="op" id="7559912">.</span><span class="ident" id="7559913">net</span><span class="op" id="7559916">,</span>&nbsp;<span class="ident" id="7559918">tt</span><span class="op" id="7559920">.</span><span class="ident" id="7559921">raddr</span><span class="op" id="7559926">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7559930">if</span>&nbsp;<span class="ident" id="7559933">err</span>&nbsp;<span class="op" id="7559937">!=</span>&nbsp;<span class="ident" id="7559940">nil</span>&nbsp;<span class="op" id="7559944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559949">t</span><span class="op" id="7559950">.</span><span class="ident" id="7559951">Fatalf</span><span class="op" id="7559957">(</span><span class="string" id="7559958">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7559975">,</span>&nbsp;<span class="ident" id="7559977">err</span><span class="op" id="7559980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7559984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7559988">c</span><span class="op" id="7559989">.</span><span class="ident" id="7559990">SetDeadline</span><span class="op" id="7560001">(</span><span class="ident" id="7560002">time</span><span class="op" id="7560006">.</span><span class="ident" id="7560007">Now</span><span class="op" id="7560010">(</span><span class="op" id="7560011">)</span><span class="op" id="7560012">.</span><span class="ident" id="7560013">Add</span><span class="op" id="7560016">(</span><span class="num" id="7560017">100</span>&nbsp;<span class="op" id="7560021">*</span>&nbsp;<span class="ident" id="7560023">time</span><span class="op" id="7560027">.</span><span class="ident" id="7560028">Millisecond</span><span class="op" id="7560039">)</span><span class="op" id="7560040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560044">defer</span>&nbsp;<span class="ident" id="7560050">c</span><span class="op" id="7560051">.</span><span class="ident" id="7560052">Close</span><span class="op" id="7560057">(</span><span class="op" id="7560058">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560063">typ</span>&nbsp;<span class="op" id="7560067">:=</span>&nbsp;<span class="ident" id="7560070">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560090">if</span>&nbsp;<span class="ident" id="7560093">net</span>&nbsp;<span class="op" id="7560097">==</span>&nbsp;<span class="string" id="7560100">&#34;ip6&#34;</span>&nbsp;<span class="op" id="7560106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560111">typ</span>&nbsp;<span class="op" id="7560115">=</span>&nbsp;<span class="ident" id="7560117">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560137">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560141">xid</span><span class="op" id="7560144">,</span>&nbsp;<span class="ident" id="7560146">xseq</span>&nbsp;<span class="op" id="7560151">:=</span>&nbsp;<span class="ident" id="7560154">os</span><span class="op" id="7560156">.</span><span class="ident" id="7560157">Getpid</span><span class="op" id="7560163">(</span><span class="op" id="7560164">)</span><span class="op" id="7560165">&amp;</span><span class="num" id="7560166">0xffff</span><span class="op" id="7560172">,</span>&nbsp;<span class="ident" id="7560174">i</span><span class="op" id="7560175">+</span><span class="num" id="7560176">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560180">wb</span><span class="op" id="7560182">,</span>&nbsp;<span class="ident" id="7560184">err</span>&nbsp;<span class="op" id="7560188">:=</span>&nbsp;<span class="op" id="7560191">(</span><span class="op" id="7560192">&amp;</span><span class="ident" id="7560193">icmpMessage</span><span class="op" id="7560204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560209">Type</span><span class="op" id="7560213">:</span>&nbsp;<span class="ident" id="7560215">typ</span><span class="op" id="7560218">,</span>&nbsp;<span class="ident" id="7560220">Code</span><span class="op" id="7560224">:</span>&nbsp;<span class="num" id="7560226">0</span><span class="op" id="7560227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560232">Body</span><span class="op" id="7560236">:</span>&nbsp;<span class="op" id="7560238">&amp;</span><span class="ident" id="7560239">icmpEcho</span><span class="op" id="7560247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560253">ID</span><span class="op" id="7560255">:</span>&nbsp;<span class="ident" id="7560257">xid</span><span class="op" id="7560260">,</span>&nbsp;<span class="ident" id="7560262">Seq</span><span class="op" id="7560265">:</span>&nbsp;<span class="ident" id="7560267">xseq</span><span class="op" id="7560271">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560277">Data</span><span class="op" id="7560281">:</span>&nbsp;<span class="ident" id="7560283">bytes</span><span class="op" id="7560288">.</span><span class="ident" id="7560289">Repeat</span><span class="op" id="7560295">(</span><span class="op" id="7560296">[</span><span class="op" id="7560297">]</span><span class="builtintype" id="7560298">byte</span><span class="op" id="7560302">(</span><span class="string" id="7560303">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="7560325">)</span><span class="op" id="7560326">,</span>&nbsp;<span class="num" id="7560328">3</span><span class="op" id="7560329">)</span><span class="op" id="7560330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560335">}</span><span class="op" id="7560336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560340">}</span><span class="op" id="7560341">)</span><span class="op" id="7560342">.</span><span class="ident" id="7560343">Marshal</span><span class="op" id="7560350">(</span><span class="op" id="7560351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560355">if</span>&nbsp;<span class="ident" id="7560358">err</span>&nbsp;<span class="op" id="7560362">!=</span>&nbsp;<span class="ident" id="7560365">nil</span>&nbsp;<span class="op" id="7560369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560374">t</span><span class="op" id="7560375">.</span><span class="ident" id="7560376">Fatalf</span><span class="op" id="7560382">(</span><span class="string" id="7560383">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7560415">,</span>&nbsp;<span class="ident" id="7560417">err</span><span class="op" id="7560420">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560428">if</span>&nbsp;<span class="ident" id="7560431">_</span><span class="op" id="7560432">,</span>&nbsp;<span class="ident" id="7560434">err</span>&nbsp;<span class="op" id="7560438">:=</span>&nbsp;<span class="ident" id="7560441">c</span><span class="op" id="7560442">.</span><span class="ident" id="7560443">Write</span><span class="op" id="7560448">(</span><span class="ident" id="7560449">wb</span><span class="op" id="7560451">)</span><span class="op" id="7560452">;</span>&nbsp;<span class="ident" id="7560454">err</span>&nbsp;<span class="op" id="7560458">!=</span>&nbsp;<span class="ident" id="7560461">nil</span>&nbsp;<span class="op" id="7560465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560470">t</span><span class="op" id="7560471">.</span><span class="ident" id="7560472">Fatalf</span><span class="op" id="7560478">(</span><span class="string" id="7560479">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7560502">,</span>&nbsp;<span class="ident" id="7560504">err</span><span class="op" id="7560507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560515">var</span>&nbsp;<span class="ident" id="7560519">m</span>&nbsp;<span class="op" id="7560521">*</span><span class="ident" id="7560522">icmpMessage</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560536">rb</span>&nbsp;<span class="op" id="7560539">:=</span>&nbsp;<span class="builtinfunc" id="7560542">make</span><span class="op" id="7560546">(</span><span class="op" id="7560547">[</span><span class="op" id="7560548">]</span><span class="builtintype" id="7560549">byte</span><span class="op" id="7560553">,</span>&nbsp;<span class="num" id="7560555">20</span><span class="op" id="7560557">+</span><span class="builtinfunc" id="7560558">len</span><span class="op" id="7560561">(</span><span class="ident" id="7560562">wb</span><span class="op" id="7560564">)</span><span class="op" id="7560565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560569">for</span>&nbsp;<span class="op" id="7560573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560578">if</span>&nbsp;<span class="ident" id="7560581">_</span><span class="op" id="7560582">,</span>&nbsp;<span class="ident" id="7560584">err</span>&nbsp;<span class="op" id="7560588">:=</span>&nbsp;<span class="ident" id="7560591">c</span><span class="op" id="7560592">.</span><span class="ident" id="7560593">Read</span><span class="op" id="7560597">(</span><span class="ident" id="7560598">rb</span><span class="op" id="7560600">)</span><span class="op" id="7560601">;</span>&nbsp;<span class="ident" id="7560603">err</span>&nbsp;<span class="op" id="7560607">!=</span>&nbsp;<span class="ident" id="7560610">nil</span>&nbsp;<span class="op" id="7560614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560620">t</span><span class="op" id="7560621">.</span><span class="ident" id="7560622">Fatalf</span><span class="op" id="7560628">(</span><span class="string" id="7560629">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7560651">,</span>&nbsp;<span class="ident" id="7560653">err</span><span class="op" id="7560656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560661">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560666">if</span>&nbsp;<span class="ident" id="7560669">net</span>&nbsp;<span class="op" id="7560673">==</span>&nbsp;<span class="string" id="7560676">&#34;ip4&#34;</span>&nbsp;<span class="op" id="7560682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560688">rb</span>&nbsp;<span class="op" id="7560691">=</span>&nbsp;<span class="ident" id="7560693">ipv4Payload</span><span class="op" id="7560704">(</span><span class="ident" id="7560705">rb</span><span class="op" id="7560707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560717">if</span>&nbsp;<span class="ident" id="7560720">m</span><span class="op" id="7560721">,</span>&nbsp;<span class="ident" id="7560723">err</span>&nbsp;<span class="op" id="7560727">=</span>&nbsp;<span class="ident" id="7560729">parseICMPMessage</span><span class="op" id="7560745">(</span><span class="ident" id="7560746">rb</span><span class="op" id="7560748">)</span><span class="op" id="7560749">;</span>&nbsp;<span class="ident" id="7560751">err</span>&nbsp;<span class="op" id="7560755">!=</span>&nbsp;<span class="ident" id="7560758">nil</span>&nbsp;<span class="op" id="7560762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560768">t</span><span class="op" id="7560769">.</span><span class="ident" id="7560770">Fatalf</span><span class="op" id="7560776">(</span><span class="string" id="7560777">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7560806">,</span>&nbsp;<span class="ident" id="7560808">err</span><span class="op" id="7560811">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560821">switch</span>&nbsp;<span class="ident" id="7560828">m</span><span class="op" id="7560829">.</span><span class="ident" id="7560830">Type</span>&nbsp;<span class="op" id="7560835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560840">case</span>&nbsp;<span class="ident" id="7560845">icmpv4EchoRequest</span><span class="op" id="7560862">,</span>&nbsp;<span class="ident" id="7560864">icmpv6EchoRequest</span><span class="op" id="7560881">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560887">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560899">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560904">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560916">switch</span>&nbsp;<span class="ident" id="7560923">p</span>&nbsp;<span class="op" id="7560925">:=</span>&nbsp;<span class="ident" id="7560928">m</span><span class="op" id="7560929">.</span><span class="ident" id="7560930">Body</span><span class="op" id="7560934">.</span><span class="op" id="7560935">(</span><span class="keyword" id="7560936">type</span><span class="op" id="7560940">)</span>&nbsp;<span class="op" id="7560942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560946">case</span>&nbsp;<span class="op" id="7560951">*</span><span class="ident" id="7560952">icmpEcho</span><span class="op" id="7560960">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560965">if</span>&nbsp;<span class="ident" id="7560968">p</span><span class="op" id="7560969">.</span><span class="ident" id="7560970">ID</span>&nbsp;<span class="op" id="7560973">!=</span>&nbsp;<span class="ident" id="7560976">xid</span>&nbsp;<span class="op" id="7560980">||</span>&nbsp;<span class="ident" id="7560983">p</span><span class="op" id="7560984">.</span><span class="ident" id="7560985">Seq</span>&nbsp;<span class="op" id="7560989">!=</span>&nbsp;<span class="ident" id="7560992">xseq</span>&nbsp;<span class="op" id="7560997">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561003">t</span><span class="op" id="7561004">.</span><span class="ident" id="7561005">Fatalf</span><span class="op" id="7561011">(</span><span class="string" id="7561012">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="7561061">,</span>&nbsp;<span class="ident" id="7561063">p</span><span class="op" id="7561064">.</span><span class="ident" id="7561065">ID</span><span class="op" id="7561067">,</span>&nbsp;<span class="ident" id="7561069">p</span><span class="op" id="7561070">.</span><span class="ident" id="7561071">Seq</span><span class="op" id="7561074">,</span>&nbsp;<span class="ident" id="7561076">xid</span><span class="op" id="7561079">,</span>&nbsp;<span class="ident" id="7561081">xseq</span><span class="op" id="7561085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561094">default</span><span class="op" id="7561101">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561106">t</span><span class="op" id="7561107">.</span><span class="ident" id="7561108">Fatalf</span><span class="op" id="7561114">(</span><span class="string" id="7561115">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="7561164">,</span>&nbsp;<span class="ident" id="7561166">m</span><span class="op" id="7561167">.</span><span class="ident" id="7561168">Type</span><span class="op" id="7561172">,</span>&nbsp;<span class="ident" id="7561174">m</span><span class="op" id="7561175">.</span><span class="ident" id="7561176">Code</span><span class="op" id="7561180">,</span>&nbsp;<span class="ident" id="7561182">typ</span><span class="op" id="7561185">,</span>&nbsp;<span class="num" id="7561187">0</span><span class="op" id="7561188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561192">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561195">}</span><br>
<span class="lineno"></span><span class="op" id="7561197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7561200">func</span>&nbsp;<span class="ident" id="7561205">TestPacketConnICMPEcho</span><span class="op" id="7561227">(</span><span class="ident" id="7561228">t</span>&nbsp;<span class="op" id="7561230">*</span><span class="ident" id="7561231">testing</span><span class="op" id="7561238">.</span><span class="ident" id="7561239">T</span><span class="op" id="7561240">)</span>&nbsp;<span class="op" id="7561242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561245">if</span>&nbsp;<span class="ident" id="7561248">skip</span><span class="op" id="7561252">,</span>&nbsp;<span class="ident" id="7561254">skipmsg</span>&nbsp;<span class="op" id="7561262">:=</span>&nbsp;<span class="ident" id="7561265">skipRawSocketTest</span><span class="op" id="7561282">(</span><span class="ident" id="7561283">t</span><span class="op" id="7561284">)</span><span class="op" id="7561285">;</span>&nbsp;<span class="ident" id="7561287">skip</span>&nbsp;<span class="op" id="7561292">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561296">t</span><span class="op" id="7561297">.</span><span class="ident" id="7561298">Skip</span><span class="op" id="7561302">(</span><span class="ident" id="7561303">skipmsg</span><span class="op" id="7561310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561317">for</span>&nbsp;<span class="ident" id="7561321">i</span><span class="op" id="7561322">,</span>&nbsp;<span class="ident" id="7561324">tt</span>&nbsp;<span class="op" id="7561327">:=</span>&nbsp;<span class="keyword" id="7561330">range</span>&nbsp;<span class="ident" id="7561336">icmpEchoTests</span>&nbsp;<span class="op" id="7561350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561354">net</span><span class="op" id="7561357">,</span>&nbsp;<span class="ident" id="7561359">_</span><span class="op" id="7561360">,</span>&nbsp;<span class="ident" id="7561362">err</span>&nbsp;<span class="op" id="7561366">:=</span>&nbsp;<span class="ident" id="7561369">parseNetwork</span><span class="op" id="7561381">(</span><span class="ident" id="7561382">tt</span><span class="op" id="7561384">.</span><span class="ident" id="7561385">net</span><span class="op" id="7561388">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561392">if</span>&nbsp;<span class="ident" id="7561395">err</span>&nbsp;<span class="op" id="7561399">!=</span>&nbsp;<span class="ident" id="7561402">nil</span>&nbsp;<span class="op" id="7561406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561411">t</span><span class="op" id="7561412">.</span><span class="ident" id="7561413">Fatalf</span><span class="op" id="7561419">(</span><span class="string" id="7561420">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7561445">,</span>&nbsp;<span class="ident" id="7561447">err</span><span class="op" id="7561450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561458">if</span>&nbsp;<span class="ident" id="7561461">net</span>&nbsp;<span class="op" id="7561465">==</span>&nbsp;<span class="string" id="7561468">&#34;ip6&#34;</span>&nbsp;<span class="op" id="7561474">&amp;&amp;</span>&nbsp;<span class="op" id="7561477">!</span><span class="ident" id="7561478">supportsIPv6</span>&nbsp;<span class="op" id="7561491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561496">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561512">c</span><span class="op" id="7561513">,</span>&nbsp;<span class="ident" id="7561515">err</span>&nbsp;<span class="op" id="7561519">:=</span>&nbsp;<span class="ident" id="7561522">ListenPacket</span><span class="op" id="7561534">(</span><span class="ident" id="7561535">tt</span><span class="op" id="7561537">.</span><span class="ident" id="7561538">net</span><span class="op" id="7561541">,</span>&nbsp;<span class="ident" id="7561543">tt</span><span class="op" id="7561545">.</span><span class="ident" id="7561546">laddr</span><span class="op" id="7561551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561555">if</span>&nbsp;<span class="ident" id="7561558">err</span>&nbsp;<span class="op" id="7561562">!=</span>&nbsp;<span class="ident" id="7561565">nil</span>&nbsp;<span class="op" id="7561569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561574">t</span><span class="op" id="7561575">.</span><span class="ident" id="7561576">Fatalf</span><span class="op" id="7561582">(</span><span class="string" id="7561583">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7561608">,</span>&nbsp;<span class="ident" id="7561610">err</span><span class="op" id="7561613">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561621">c</span><span class="op" id="7561622">.</span><span class="ident" id="7561623">SetDeadline</span><span class="op" id="7561634">(</span><span class="ident" id="7561635">time</span><span class="op" id="7561639">.</span><span class="ident" id="7561640">Now</span><span class="op" id="7561643">(</span><span class="op" id="7561644">)</span><span class="op" id="7561645">.</span><span class="ident" id="7561646">Add</span><span class="op" id="7561649">(</span><span class="num" id="7561650">100</span>&nbsp;<span class="op" id="7561654">*</span>&nbsp;<span class="ident" id="7561656">time</span><span class="op" id="7561660">.</span><span class="ident" id="7561661">Millisecond</span><span class="op" id="7561672">)</span><span class="op" id="7561673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561677">defer</span>&nbsp;<span class="ident" id="7561683">c</span><span class="op" id="7561684">.</span><span class="ident" id="7561685">Close</span><span class="op" id="7561690">(</span><span class="op" id="7561691">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561696">ra</span><span class="op" id="7561698">,</span>&nbsp;<span class="ident" id="7561700">err</span>&nbsp;<span class="op" id="7561704">:=</span>&nbsp;<span class="ident" id="7561707">ResolveIPAddr</span><span class="op" id="7561720">(</span><span class="ident" id="7561721">tt</span><span class="op" id="7561723">.</span><span class="ident" id="7561724">net</span><span class="op" id="7561727">,</span>&nbsp;<span class="ident" id="7561729">tt</span><span class="op" id="7561731">.</span><span class="ident" id="7561732">raddr</span><span class="op" id="7561737">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561741">if</span>&nbsp;<span class="ident" id="7561744">err</span>&nbsp;<span class="op" id="7561748">!=</span>&nbsp;<span class="ident" id="7561751">nil</span>&nbsp;<span class="op" id="7561755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561760">t</span><span class="op" id="7561761">.</span><span class="ident" id="7561762">Fatalf</span><span class="op" id="7561768">(</span><span class="string" id="7561769">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7561795">,</span>&nbsp;<span class="ident" id="7561797">err</span><span class="op" id="7561800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561808">typ</span>&nbsp;<span class="op" id="7561812">:=</span>&nbsp;<span class="ident" id="7561815">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561835">if</span>&nbsp;<span class="ident" id="7561838">net</span>&nbsp;<span class="op" id="7561842">==</span>&nbsp;<span class="string" id="7561845">&#34;ip6&#34;</span>&nbsp;<span class="op" id="7561851">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561856">typ</span>&nbsp;<span class="op" id="7561860">=</span>&nbsp;<span class="ident" id="7561862">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561886">xid</span><span class="op" id="7561889">,</span>&nbsp;<span class="ident" id="7561891">xseq</span>&nbsp;<span class="op" id="7561896">:=</span>&nbsp;<span class="ident" id="7561899">os</span><span class="op" id="7561901">.</span><span class="ident" id="7561902">Getpid</span><span class="op" id="7561908">(</span><span class="op" id="7561909">)</span><span class="op" id="7561910">&amp;</span><span class="num" id="7561911">0xffff</span><span class="op" id="7561917">,</span>&nbsp;<span class="ident" id="7561919">i</span><span class="op" id="7561920">+</span><span class="num" id="7561921">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561925">wb</span><span class="op" id="7561927">,</span>&nbsp;<span class="ident" id="7561929">err</span>&nbsp;<span class="op" id="7561933">:=</span>&nbsp;<span class="op" id="7561936">(</span><span class="op" id="7561937">&amp;</span><span class="ident" id="7561938">icmpMessage</span><span class="op" id="7561949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561954">Type</span><span class="op" id="7561958">:</span>&nbsp;<span class="ident" id="7561960">typ</span><span class="op" id="7561963">,</span>&nbsp;<span class="ident" id="7561965">Code</span><span class="op" id="7561969">:</span>&nbsp;<span class="num" id="7561971">0</span><span class="op" id="7561972">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561977">Body</span><span class="op" id="7561981">:</span>&nbsp;<span class="op" id="7561983">&amp;</span><span class="ident" id="7561984">icmpEcho</span><span class="op" id="7561992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561998">ID</span><span class="op" id="7562000">:</span>&nbsp;<span class="ident" id="7562002">xid</span><span class="op" id="7562005">,</span>&nbsp;<span class="ident" id="7562007">Seq</span><span class="op" id="7562010">:</span>&nbsp;<span class="ident" id="7562012">xseq</span><span class="op" id="7562016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562022">Data</span><span class="op" id="7562026">:</span>&nbsp;<span class="ident" id="7562028">bytes</span><span class="op" id="7562033">.</span><span class="ident" id="7562034">Repeat</span><span class="op" id="7562040">(</span><span class="op" id="7562041">[</span><span class="op" id="7562042">]</span><span class="builtintype" id="7562043">byte</span><span class="op" id="7562047">(</span><span class="string" id="7562048">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="7562070">)</span><span class="op" id="7562071">,</span>&nbsp;<span class="num" id="7562073">3</span><span class="op" id="7562074">)</span><span class="op" id="7562075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7562080">}</span><span class="op" id="7562081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7562085">}</span><span class="op" id="7562086">)</span><span class="op" id="7562087">.</span><span class="ident" id="7562088">Marshal</span><span class="op" id="7562095">(</span><span class="op" id="7562096">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562100">if</span>&nbsp;<span class="ident" id="7562103">err</span>&nbsp;<span class="op" id="7562107">!=</span>&nbsp;<span class="ident" id="7562110">nil</span>&nbsp;<span class="op" id="7562114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562119">t</span><span class="op" id="7562120">.</span><span class="ident" id="7562121">Fatalf</span><span class="op" id="7562127">(</span><span class="string" id="7562128">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7562160">,</span>&nbsp;<span class="ident" id="7562162">err</span><span class="op" id="7562165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7562169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562173">if</span>&nbsp;<span class="ident" id="7562176">_</span><span class="op" id="7562177">,</span>&nbsp;<span class="ident" id="7562179">err</span>&nbsp;<span class="op" id="7562183">:=</span>&nbsp;<span class="ident" id="7562186">c</span><span class="op" id="7562187">.</span><span class="ident" id="7562188">WriteTo</span><span class="op" id="7562195">(</span><span class="ident" id="7562196">wb</span><span class="op" id="7562198">,</span>&nbsp;<span class="ident" id="7562200">ra</span><span class="op" id="7562202">)</span><span class="op" id="7562203">;</span>&nbsp;<span class="ident" id="7562205">err</span>&nbsp;<span class="op" id="7562209">!=</span>&nbsp;<span class="ident" id="7562212">nil</span>&nbsp;<span class="op" id="7562216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562221">t</span><span class="op" id="7562222">.</span><span class="ident" id="7562223">Fatalf</span><span class="op" id="7562229">(</span><span class="string" id="7562230">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7562261">,</span>&nbsp;<span class="ident" id="7562263">err</span><span class="op" id="7562266">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7562270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562274">var</span>&nbsp;<span class="ident" id="7562278">m</span>&nbsp;<span class="op" id="7562280">*</span><span class="ident" id="7562281">icmpMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562295">rb</span>&nbsp;<span class="op" id="7562298">:=</span>&nbsp;<span class="builtinfunc" id="7562301">make</span><span class="op" id="7562305">(</span><span class="op" id="7562306">[</span><span class="op" id="7562307">]</span><span class="builtintype" id="7562308">byte</span><span class="op" id="7562312">,</span>&nbsp;<span class="num" id="7562314">20</span><span class="op" id="7562316">+</span><span class="builtinfunc" id="7562317">len</span><span class="op" id="7562320">(</span><span class="ident" id="7562321">wb</span><span class="op" id="7562323">)</span><span class="op" id="7562324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562328">for</span>&nbsp;<span class="op" id="7562332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562337">if</span>&nbsp;<span class="ident" id="7562340">_</span><span class="op" id="7562341">,</span>&nbsp;<span class="ident" id="7562343">_</span><span class="op" id="7562344">,</span>&nbsp;<span class="ident" id="7562346">err</span>&nbsp;<span class="op" id="7562350">:=</span>&nbsp;<span class="ident" id="7562353">c</span><span class="op" id="7562354">.</span><span class="ident" id="7562355">ReadFrom</span><span class="op" id="7562363">(</span><span class="ident" id="7562364">rb</span><span class="op" id="7562366">)</span><span class="op" id="7562367">;</span>&nbsp;<span class="ident" id="7562369">err</span>&nbsp;<span class="op" id="7562373">!=</span>&nbsp;<span class="ident" id="7562376">nil</span>&nbsp;<span class="op" id="7562380">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562386">t</span><span class="op" id="7562387">.</span><span class="ident" id="7562388">Fatalf</span><span class="op" id="7562394">(</span><span class="string" id="7562395">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7562427">,</span>&nbsp;<span class="ident" id="7562429">err</span><span class="op" id="7562432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7562437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7562442">//&nbsp;See&nbsp;BUG&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7562465">//if&nbsp;net&nbsp;==&nbsp;&#34;ip4&#34;&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7562488">//&nbsp;&nbsp;&nbsp;&nbsprb&nbsp;=&nbsp;ipv4Payload(rb)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7562515">//}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562522">if</span>&nbsp;<span class="ident" id="7562525">m</span><span class="op" id="7562526">,</span>&nbsp;<span class="ident" id="7562528">err</span>&nbsp;<span class="op" id="7562532">=</span>&nbsp;<span class="ident" id="7562534">parseICMPMessage</span><span class="op" id="7562550">(</span><span class="ident" id="7562551">rb</span><span class="op" id="7562553">)</span><span class="op" id="7562554">;</span>&nbsp;<span class="ident" id="7562556">err</span>&nbsp;<span class="op" id="7562560">!=</span>&nbsp;<span class="ident" id="7562563">nil</span>&nbsp;<span class="op" id="7562567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562573">t</span><span class="op" id="7562574">.</span><span class="ident" id="7562575">Fatalf</span><span class="op" id="7562581">(</span><span class="string" id="7562582">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7562611">,</span>&nbsp;<span class="ident" id="7562613">err</span><span class="op" id="7562616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7562621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562626">switch</span>&nbsp;<span class="ident" id="7562633">m</span><span class="op" id="7562634">.</span><span class="ident" id="7562635">Type</span>&nbsp;<span class="op" id="7562640">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562645">case</span>&nbsp;<span class="ident" id="7562650">icmpv4EchoRequest</span><span class="op" id="7562667">,</span>&nbsp;<span class="ident" id="7562669">icmpv6EchoRequest</span><span class="op" id="7562686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562692">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7562704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562709">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7562717">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562721">switch</span>&nbsp;<span class="ident" id="7562728">p</span>&nbsp;<span class="op" id="7562730">:=</span>&nbsp;<span class="ident" id="7562733">m</span><span class="op" id="7562734">.</span><span class="ident" id="7562735">Body</span><span class="op" id="7562739">.</span><span class="op" id="7562740">(</span><span class="keyword" id="7562741">type</span><span class="op" id="7562745">)</span>&nbsp;<span class="op" id="7562747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562751">case</span>&nbsp;<span class="op" id="7562756">*</span><span class="ident" id="7562757">icmpEcho</span><span class="op" id="7562765">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562770">if</span>&nbsp;<span class="ident" id="7562773">p</span><span class="op" id="7562774">.</span><span class="ident" id="7562775">ID</span>&nbsp;<span class="op" id="7562778">!=</span>&nbsp;<span class="ident" id="7562781">xid</span>&nbsp;<span class="op" id="7562785">||</span>&nbsp;<span class="ident" id="7562788">p</span><span class="op" id="7562789">.</span><span class="ident" id="7562790">Seq</span>&nbsp;<span class="op" id="7562794">!=</span>&nbsp;<span class="ident" id="7562797">xseq</span>&nbsp;<span class="op" id="7562802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562808">t</span><span class="op" id="7562809">.</span><span class="ident" id="7562810">Fatalf</span><span class="op" id="7562816">(</span><span class="string" id="7562817">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="7562866">,</span>&nbsp;<span class="ident" id="7562868">p</span><span class="op" id="7562869">.</span><span class="ident" id="7562870">ID</span><span class="op" id="7562872">,</span>&nbsp;<span class="ident" id="7562874">p</span><span class="op" id="7562875">.</span><span class="ident" id="7562876">Seq</span><span class="op" id="7562879">,</span>&nbsp;<span class="ident" id="7562881">xid</span><span class="op" id="7562884">,</span>&nbsp;<span class="ident" id="7562886">xseq</span><span class="op" id="7562890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7562895">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562899">default</span><span class="op" id="7562906">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562911">t</span><span class="op" id="7562912">.</span><span class="ident" id="7562913">Fatalf</span><span class="op" id="7562919">(</span><span class="string" id="7562920">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="7562969">,</span>&nbsp;<span class="ident" id="7562971">m</span><span class="op" id="7562972">.</span><span class="ident" id="7562973">Type</span><span class="op" id="7562977">,</span>&nbsp;<span class="ident" id="7562979">m</span><span class="op" id="7562980">.</span><span class="ident" id="7562981">Code</span><span class="op" id="7562985">,</span>&nbsp;<span class="ident" id="7562987">typ</span><span class="op" id="7562990">,</span>&nbsp;<span class="num" id="7562992">0</span><span class="op" id="7562993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7562997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563000">}</span><br>
<span class="lineno"></span><span class="op" id="7563002">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="7563005">func</span>&nbsp;<span class="ident" id="7563010">ipv4Payload</span><span class="op" id="7563021">(</span><span class="ident" id="7563022">b</span>&nbsp;<span class="op" id="7563024">[</span><span class="op" id="7563025">]</span><span class="builtintype" id="7563026">byte</span><span class="op" id="7563030">)</span>&nbsp;<span class="op" id="7563032">[</span><span class="op" id="7563033">]</span><span class="builtintype" id="7563034">byte</span>&nbsp;<span class="op" id="7563039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563042">if</span>&nbsp;<span class="builtinfunc" id="7563045">len</span><span class="op" id="7563048">(</span><span class="ident" id="7563049">b</span><span class="op" id="7563050">)</span>&nbsp;<span class="op" id="7563052">&lt;</span>&nbsp;<span class="num" id="7563054">20</span>&nbsp;<span class="op" id="7563057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563061">return</span>&nbsp;<span class="ident" id="7563068">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563071">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563074">hdrlen</span>&nbsp;<span class="op" id="7563081">:=</span>&nbsp;<span class="builtintype" id="7563084">int</span><span class="op" id="7563087">(</span><span class="ident" id="7563088">b</span><span class="op" id="7563089">[</span><span class="num" id="7563090">0</span><span class="op" id="7563091">]</span><span class="op" id="7563092">&amp;</span><span class="num" id="7563093">0x0f</span><span class="op" id="7563097">)</span>&nbsp;<span class="op" id="7563099">&lt;&lt;</span>&nbsp;<span class="num" id="7563102">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563105">return</span>&nbsp;<span class="ident" id="7563112">b</span><span class="op" id="7563113">[</span><span class="ident" id="7563114">hdrlen</span><span class="op" id="7563120">:</span><span class="op" id="7563121">]</span><br>
<span class="lineno"></span><span class="op" id="7563123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7563126">var</span>&nbsp;<span class="ident" id="7563130">ipConnLocalNameTests</span>&nbsp;<span class="op" id="7563151">=</span>&nbsp;<span class="op" id="7563153">[</span><span class="op" id="7563154">]</span><span class="keyword" id="7563155">struct</span>&nbsp;<span class="op" id="7563162">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563165">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7563171">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563179">laddr</span>&nbsp;<span class="op" id="7563185">*</span><span class="ident" id="7563186">IPAddr</span><br>
<span class="lineno"></span><span class="op" id="7563193">}</span><span class="op" id="7563194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563197">{</span><span class="string" id="7563198">&#34;ip4:icmp&#34;</span><span class="op" id="7563208">,</span>&nbsp;<span class="op" id="7563210">&amp;</span><span class="ident" id="7563211">IPAddr</span><span class="op" id="7563217">{</span><span class="ident" id="7563218">IP</span><span class="op" id="7563220">:</span>&nbsp;<span class="ident" id="7563222">IPv4</span><span class="op" id="7563226">(</span><span class="num" id="7563227">127</span><span class="op" id="7563230">,</span>&nbsp;<span class="num" id="7563232">0</span><span class="op" id="7563233">,</span>&nbsp;<span class="num" id="7563235">0</span><span class="op" id="7563236">,</span>&nbsp;<span class="num" id="7563238">1</span><span class="op" id="7563239">)</span><span class="op" id="7563240">}</span><span class="op" id="7563241">}</span><span class="op" id="7563242">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563245">{</span><span class="string" id="7563246">&#34;ip4:icmp&#34;</span><span class="op" id="7563256">,</span>&nbsp;<span class="op" id="7563258">&amp;</span><span class="ident" id="7563259">IPAddr</span><span class="op" id="7563265">{</span><span class="op" id="7563266">}</span><span class="op" id="7563267">}</span><span class="op" id="7563268">,</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563271">{</span><span class="string" id="7563272">&#34;ip4:icmp&#34;</span><span class="op" id="7563282">,</span>&nbsp;<span class="ident" id="7563284">nil</span><span class="op" id="7563287">}</span><span class="op" id="7563288">,</span><br>
<span class="lineno"></span><span class="op" id="7563290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7563293">func</span>&nbsp;<span class="ident" id="7563298">TestIPConnLocalName</span><span class="op" id="7563317">(</span><span class="ident" id="7563318">t</span>&nbsp;<span class="op" id="7563320">*</span><span class="ident" id="7563321">testing</span><span class="op" id="7563328">.</span><span class="ident" id="7563329">T</span><span class="op" id="7563330">)</span>&nbsp;<span class="op" id="7563332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563335">switch</span>&nbsp;<span class="ident" id="7563342">runtime</span><span class="op" id="7563349">.</span><span class="ident" id="7563350">GOOS</span>&nbsp;<span class="op" id="7563355">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563358">case</span>&nbsp;<span class="string" id="7563363">&#34;nacl&#34;</span><span class="op" id="7563369">,</span>&nbsp;<span class="string" id="7563371">&#34;plan9&#34;</span><span class="op" id="7563378">,</span>&nbsp;<span class="string" id="7563380">&#34;windows&#34;</span><span class="op" id="7563389">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563393">t</span><span class="op" id="7563394">.</span><span class="ident" id="7563395">Skipf</span><span class="op" id="7563400">(</span><span class="string" id="7563401">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7563422">,</span>&nbsp;<span class="ident" id="7563424">runtime</span><span class="op" id="7563431">.</span><span class="ident" id="7563432">GOOS</span><span class="op" id="7563436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563439">default</span><span class="op" id="7563446">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563450">if</span>&nbsp;<span class="ident" id="7563453">os</span><span class="op" id="7563455">.</span><span class="ident" id="7563456">Getuid</span><span class="op" id="7563462">(</span><span class="op" id="7563463">)</span>&nbsp;<span class="op" id="7563465">!=</span>&nbsp;<span class="num" id="7563468">0</span>&nbsp;<span class="op" id="7563470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563475">t</span><span class="op" id="7563476">.</span><span class="ident" id="7563477">Skip</span><span class="op" id="7563481">(</span><span class="string" id="7563482">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="7563511">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563522">for</span>&nbsp;<span class="ident" id="7563526">_</span><span class="op" id="7563527">,</span>&nbsp;<span class="ident" id="7563529">tt</span>&nbsp;<span class="op" id="7563532">:=</span>&nbsp;<span class="keyword" id="7563535">range</span>&nbsp;<span class="ident" id="7563541">ipConnLocalNameTests</span>&nbsp;<span class="op" id="7563562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563566">c</span><span class="op" id="7563567">,</span>&nbsp;<span class="ident" id="7563569">err</span>&nbsp;<span class="op" id="7563573">:=</span>&nbsp;<span class="ident" id="7563576">ListenIP</span><span class="op" id="7563584">(</span><span class="ident" id="7563585">tt</span><span class="op" id="7563587">.</span><span class="ident" id="7563588">net</span><span class="op" id="7563591">,</span>&nbsp;<span class="ident" id="7563593">tt</span><span class="op" id="7563595">.</span><span class="ident" id="7563596">laddr</span><span class="op" id="7563601">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563605">if</span>&nbsp;<span class="ident" id="7563608">err</span>&nbsp;<span class="op" id="7563612">!=</span>&nbsp;<span class="ident" id="7563615">nil</span>&nbsp;<span class="op" id="7563619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563624">t</span><span class="op" id="7563625">.</span><span class="ident" id="7563626">Fatalf</span><span class="op" id="7563632">(</span><span class="string" id="7563633">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7563654">,</span>&nbsp;<span class="ident" id="7563656">err</span><span class="op" id="7563659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563667">defer</span>&nbsp;<span class="ident" id="7563673">c</span><span class="op" id="7563674">.</span><span class="ident" id="7563675">Close</span><span class="op" id="7563680">(</span><span class="op" id="7563681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563685">if</span>&nbsp;<span class="ident" id="7563688">la</span>&nbsp;<span class="op" id="7563691">:=</span>&nbsp;<span class="ident" id="7563694">c</span><span class="op" id="7563695">.</span><span class="ident" id="7563696">LocalAddr</span><span class="op" id="7563705">(</span><span class="op" id="7563706">)</span><span class="op" id="7563707">;</span>&nbsp;<span class="ident" id="7563709">la</span>&nbsp;<span class="op" id="7563712">==</span>&nbsp;<span class="ident" id="7563715">nil</span>&nbsp;<span class="op" id="7563719">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563724">t</span><span class="op" id="7563725">.</span><span class="ident" id="7563726">Fatal</span><span class="op" id="7563731">(</span><span class="string" id="7563732">&#34;IPConn.LocalAddr&nbsp;failed&#34;</span><span class="op" id="7563757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563764">}</span><br>
<span class="lineno"></span><span class="op" id="7563766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="7563769">func</span>&nbsp;<span class="ident" id="7563774">TestIPConnRemoteName</span><span class="op" id="7563794">(</span><span class="ident" id="7563795">t</span>&nbsp;<span class="op" id="7563797">*</span><span class="ident" id="7563798">testing</span><span class="op" id="7563805">.</span><span class="ident" id="7563806">T</span><span class="op" id="7563807">)</span>&nbsp;<span class="op" id="7563809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563812">switch</span>&nbsp;<span class="ident" id="7563819">runtime</span><span class="op" id="7563826">.</span><span class="ident" id="7563827">GOOS</span>&nbsp;<span class="op" id="7563832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563835">case</span>&nbsp;<span class="string" id="7563840">&#34;plan9&#34;</span><span class="op" id="7563847">,</span>&nbsp;<span class="string" id="7563849">&#34;windows&#34;</span><span class="op" id="7563858">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563862">t</span><span class="op" id="7563863">.</span><span class="ident" id="7563864">Skipf</span><span class="op" id="7563869">(</span><span class="string" id="7563870">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7563891">,</span>&nbsp;<span class="ident" id="7563893">runtime</span><span class="op" id="7563900">.</span><span class="ident" id="7563901">GOOS</span><span class="op" id="7563905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563908">default</span><span class="op" id="7563915">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563919">if</span>&nbsp;<span class="ident" id="7563922">os</span><span class="op" id="7563924">.</span><span class="ident" id="7563925">Getuid</span><span class="op" id="7563931">(</span><span class="op" id="7563932">)</span>&nbsp;<span class="op" id="7563934">!=</span>&nbsp;<span class="num" id="7563937">0</span>&nbsp;<span class="op" id="7563939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563944">t</span><span class="op" id="7563945">.</span><span class="ident" id="7563946">Skip</span><span class="op" id="7563950">(</span><span class="string" id="7563951">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="7563980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563991">raddr</span>&nbsp;<span class="op" id="7563997">:=</span>&nbsp;<span class="op" id="7564000">&amp;</span><span class="ident" id="7564001">IPAddr</span><span class="op" id="7564007">{</span><span class="ident" id="7564008">IP</span><span class="op" id="7564010">:</span>&nbsp;<span class="ident" id="7564012">IPv4</span><span class="op" id="7564016">(</span><span class="num" id="7564017">127</span><span class="op" id="7564020">,</span>&nbsp;<span class="num" id="7564022">0</span><span class="op" id="7564023">,</span>&nbsp;<span class="num" id="7564025">0</span><span class="op" id="7564026">,</span>&nbsp;<span class="num" id="7564028">1</span><span class="op" id="7564029">)</span><span class="op" id="7564030">.</span><span class="ident" id="7564031">To4</span><span class="op" id="7564034">(</span><span class="op" id="7564035">)</span><span class="op" id="7564036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564039">c</span><span class="op" id="7564040">,</span>&nbsp;<span class="ident" id="7564042">err</span>&nbsp;<span class="op" id="7564046">:=</span>&nbsp;<span class="ident" id="7564049">DialIP</span><span class="op" id="7564055">(</span><span class="string" id="7564056">&#34;ip:tcp&#34;</span><span class="op" id="7564064">,</span>&nbsp;<span class="op" id="7564066">&amp;</span><span class="ident" id="7564067">IPAddr</span><span class="op" id="7564073">{</span><span class="ident" id="7564074">IP</span><span class="op" id="7564076">:</span>&nbsp;<span class="ident" id="7564078">IPv4</span><span class="op" id="7564082">(</span><span class="num" id="7564083">127</span><span class="op" id="7564086">,</span>&nbsp;<span class="num" id="7564088">0</span><span class="op" id="7564089">,</span>&nbsp;<span class="num" id="7564091">0</span><span class="op" id="7564092">,</span>&nbsp;<span class="num" id="7564094">1</span><span class="op" id="7564095">)</span><span class="op" id="7564096">}</span><span class="op" id="7564097">,</span>&nbsp;<span class="ident" id="7564099">raddr</span><span class="op" id="7564104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7564107">if</span>&nbsp;<span class="ident" id="7564110">err</span>&nbsp;<span class="op" id="7564114">!=</span>&nbsp;<span class="ident" id="7564117">nil</span>&nbsp;<span class="op" id="7564121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564125">t</span><span class="op" id="7564126">.</span><span class="ident" id="7564127">Fatalf</span><span class="op" id="7564133">(</span><span class="string" id="7564134">&#34;DialIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7564153">,</span>&nbsp;<span class="ident" id="7564155">err</span><span class="op" id="7564158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7564161">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7564164">defer</span>&nbsp;<span class="ident" id="7564170">c</span><span class="op" id="7564171">.</span><span class="ident" id="7564172">Close</span><span class="op" id="7564177">(</span><span class="op" id="7564178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7564181">if</span>&nbsp;<span class="op" id="7564184">!</span><span class="ident" id="7564185">reflect</span><span class="op" id="7564192">.</span><span class="ident" id="7564193">DeepEqual</span><span class="op" id="7564202">(</span><span class="ident" id="7564203">raddr</span><span class="op" id="7564208">,</span>&nbsp;<span class="ident" id="7564210">c</span><span class="op" id="7564211">.</span><span class="ident" id="7564212">RemoteAddr</span><span class="op" id="7564222">(</span><span class="op" id="7564223">)</span><span class="op" id="7564224">)</span>&nbsp;<span class="op" id="7564226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564230">t</span><span class="op" id="7564231">.</span><span class="ident" id="7564232">Fatalf</span><span class="op" id="7564238">(</span><span class="string" id="7564239">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="7564262">,</span>&nbsp;<span class="ident" id="7564264">c</span><span class="op" id="7564265">.</span><span class="ident" id="7564266">RemoteAddr</span><span class="op" id="7564276">(</span><span class="op" id="7564277">)</span><span class="op" id="7564278">,</span>&nbsp;<span class="ident" id="7564280">raddr</span><span class="op" id="7564285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7564288">}</span><br>
<span class="lineno"></span><span class="op" id="7564290">}</span>
</div>
</body>
</html>
