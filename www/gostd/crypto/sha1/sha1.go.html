<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3930170">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3930225">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3930279">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3930330">//&nbsp;Package&nbsp;sha1&nbsp;implements&nbsp;the&nbsp;SHA1&nbsp;hash&nbsp;algorithm&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;3174.</span><br>
<span class="lineno"></span><span class="keyword" id="3930405">package</span>&nbsp;<span class="ident" id="3930413">sha1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3930419">import</span>&nbsp;<span class="op" id="3930426">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3930429">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3930439">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="3930446">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3930449">func</span>&nbsp;<span class="ident" id="3930454">init</span><span class="op" id="3930458">(</span><span class="op" id="3930459">)</span>&nbsp;<span class="op" id="3930461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930464">crypto</span><span class="op" id="3930470">.</span><span class="ident" id="3930471">RegisterHash</span><span class="op" id="3930483">(</span><span class="ident" id="3930484">crypto</span><span class="op" id="3930490">.</span><span class="ident" id="3930491">SHA1</span><span class="op" id="3930495">,</span>&nbsp;<span class="ident" id="3930497">New</span><span class="op" id="3930500">)</span><br>
<span class="lineno">15</span><span class="op" id="3930502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3930505">//&nbsp;The&nbsp;size&nbsp;of&nbsp;a&nbsp;SHA1&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3930546">const</span>&nbsp;<span class="ident" id="3930552">Size</span>&nbsp;<span class="op" id="3930557">=</span>&nbsp;<span class="num" id="3930559">20</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3930563">//&nbsp;The&nbsp;blocksize&nbsp;of&nbsp;SHA1&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3930598">const</span>&nbsp;<span class="ident" id="3930604">BlockSize</span>&nbsp;<span class="op" id="3930614">=</span>&nbsp;<span class="num" id="3930616">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3930620">const</span>&nbsp;<span class="op" id="3930626">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930629">chunk</span>&nbsp;<span class="op" id="3930635">=</span>&nbsp;<span class="num" id="3930637">64</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930641">init0</span>&nbsp;<span class="op" id="3930647">=</span>&nbsp;<span class="num" id="3930649">0x67452301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930661">init1</span>&nbsp;<span class="op" id="3930667">=</span>&nbsp;<span class="num" id="3930669">0xEFCDAB89</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930681">init2</span>&nbsp;<span class="op" id="3930687">=</span>&nbsp;<span class="num" id="3930689">0x98BADCFE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930701">init3</span>&nbsp;<span class="op" id="3930707">=</span>&nbsp;<span class="num" id="3930709">0x10325476</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930721">init4</span>&nbsp;<span class="op" id="3930727">=</span>&nbsp;<span class="num" id="3930729">0xC3D2E1F0</span><br>
<span class="lineno">30</span><span class="op" id="3930740">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3930743">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="3930802">type</span>&nbsp;<span class="ident" id="3930807">digest</span>&nbsp;<span class="keyword" id="3930814">struct</span>&nbsp;<span class="op" id="3930821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930824">h</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3930828">[</span><span class="num" id="3930829">5</span><span class="op" id="3930830">]</span><span class="builtintype" id="3930831">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930839">x</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3930843">[</span><span class="ident" id="3930844">chunk</span><span class="op" id="3930849">]</span><span class="builtintype" id="3930850">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930856">nx</span>&nbsp;&nbsp;<span class="builtintype" id="3930860">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3930865">len</span>&nbsp;<span class="ident" id="3930869">uint64</span><br>
<span class="lineno"></span><span class="op" id="3930876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="3930879">func</span>&nbsp;<span class="op" id="3930884">(</span><span class="ident" id="3930885">d</span>&nbsp;<span class="op" id="3930887">*</span><span class="ident" id="3930888">digest</span><span class="op" id="3930894">)</span>&nbsp;<span class="ident" id="3930896">Reset</span><span class="op" id="3930901">(</span><span class="op" id="3930902">)</span>&nbsp;<span class="op" id="3930904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930907">d</span><span class="op" id="3930908">.</span><span class="ident" id="3930909">h</span><span class="op" id="3930910">[</span><span class="num" id="3930911">0</span><span class="op" id="3930912">]</span>&nbsp;<span class="op" id="3930914">=</span>&nbsp;<span class="ident" id="3930916">init0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930923">d</span><span class="op" id="3930924">.</span><span class="ident" id="3930925">h</span><span class="op" id="3930926">[</span><span class="num" id="3930927">1</span><span class="op" id="3930928">]</span>&nbsp;<span class="op" id="3930930">=</span>&nbsp;<span class="ident" id="3930932">init1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930939">d</span><span class="op" id="3930940">.</span><span class="ident" id="3930941">h</span><span class="op" id="3930942">[</span><span class="num" id="3930943">2</span><span class="op" id="3930944">]</span>&nbsp;<span class="op" id="3930946">=</span>&nbsp;<span class="ident" id="3930948">init2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930955">d</span><span class="op" id="3930956">.</span><span class="ident" id="3930957">h</span><span class="op" id="3930958">[</span><span class="num" id="3930959">3</span><span class="op" id="3930960">]</span>&nbsp;<span class="op" id="3930962">=</span>&nbsp;<span class="ident" id="3930964">init3</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930971">d</span><span class="op" id="3930972">.</span><span class="ident" id="3930973">h</span><span class="op" id="3930974">[</span><span class="num" id="3930975">4</span><span class="op" id="3930976">]</span>&nbsp;<span class="op" id="3930978">=</span>&nbsp;<span class="ident" id="3930980">init4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930987">d</span><span class="op" id="3930988">.</span><span class="ident" id="3930989">nx</span>&nbsp;<span class="op" id="3930992">=</span>&nbsp;<span class="num" id="3930994">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930997">d</span><span class="op" id="3930998">.</span><span class="builtinfunc" id="3930999">len</span>&nbsp;<span class="op" id="3931003">=</span>&nbsp;<span class="num" id="3931005">0</span><br>
<span class="lineno"></span><span class="op" id="3931007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3931010">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash&nbsp;computing&nbsp;the&nbsp;SHA1&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="3931070">func</span>&nbsp;<span class="ident" id="3931075">New</span><span class="op" id="3931078">(</span><span class="op" id="3931079">)</span>&nbsp;<span class="ident" id="3931081">hash</span><span class="op" id="3931085">.</span><span class="ident" id="3931086">Hash</span>&nbsp;<span class="op" id="3931091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931094">d</span>&nbsp;<span class="op" id="3931096">:=</span>&nbsp;<span class="builtinfunc" id="3931099">new</span><span class="op" id="3931102">(</span><span class="ident" id="3931103">digest</span><span class="op" id="3931109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931112">d</span><span class="op" id="3931113">.</span><span class="ident" id="3931114">Reset</span><span class="op" id="3931119">(</span><span class="op" id="3931120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931123">return</span>&nbsp;<span class="ident" id="3931130">d</span><br>
<span class="lineno">55</span><span class="op" id="3931132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3931135">func</span>&nbsp;<span class="op" id="3931140">(</span><span class="ident" id="3931141">d</span>&nbsp;<span class="op" id="3931143">*</span><span class="ident" id="3931144">digest</span><span class="op" id="3931150">)</span>&nbsp;<span class="ident" id="3931152">Size</span><span class="op" id="3931156">(</span><span class="op" id="3931157">)</span>&nbsp;<span class="builtintype" id="3931159">int</span>&nbsp;<span class="op" id="3931163">{</span>&nbsp;<span class="keyword" id="3931165">return</span>&nbsp;<span class="ident" id="3931172">Size</span>&nbsp;<span class="op" id="3931177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3931180">func</span>&nbsp;<span class="op" id="3931185">(</span><span class="ident" id="3931186">d</span>&nbsp;<span class="op" id="3931188">*</span><span class="ident" id="3931189">digest</span><span class="op" id="3931195">)</span>&nbsp;<span class="ident" id="3931197">BlockSize</span><span class="op" id="3931206">(</span><span class="op" id="3931207">)</span>&nbsp;<span class="builtintype" id="3931209">int</span>&nbsp;<span class="op" id="3931213">{</span>&nbsp;<span class="keyword" id="3931215">return</span>&nbsp;<span class="ident" id="3931222">BlockSize</span>&nbsp;<span class="op" id="3931232">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3931235">func</span>&nbsp;<span class="op" id="3931240">(</span><span class="ident" id="3931241">d</span>&nbsp;<span class="op" id="3931243">*</span><span class="ident" id="3931244">digest</span><span class="op" id="3931250">)</span>&nbsp;<span class="ident" id="3931252">Write</span><span class="op" id="3931257">(</span><span class="ident" id="3931258">p</span>&nbsp;<span class="op" id="3931260">[</span><span class="op" id="3931261">]</span><span class="builtintype" id="3931262">byte</span><span class="op" id="3931266">)</span>&nbsp;<span class="op" id="3931268">(</span><span class="ident" id="3931269">nn</span>&nbsp;<span class="builtintype" id="3931272">int</span><span class="op" id="3931275">,</span>&nbsp;<span class="ident" id="3931277">err</span>&nbsp;<span class="builtintype" id="3931281">error</span><span class="op" id="3931286">)</span>&nbsp;<span class="op" id="3931288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931291">nn</span>&nbsp;<span class="op" id="3931294">=</span>&nbsp;<span class="builtinfunc" id="3931296">len</span><span class="op" id="3931299">(</span><span class="ident" id="3931300">p</span><span class="op" id="3931301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931304">d</span><span class="op" id="3931305">.</span><span class="builtinfunc" id="3931306">len</span>&nbsp;<span class="op" id="3931310">+=</span>&nbsp;<span class="ident" id="3931313">uint64</span><span class="op" id="3931319">(</span><span class="ident" id="3931320">nn</span><span class="op" id="3931322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931325">if</span>&nbsp;<span class="ident" id="3931328">d</span><span class="op" id="3931329">.</span><span class="ident" id="3931330">nx</span>&nbsp;<span class="op" id="3931333">&gt;</span>&nbsp;<span class="num" id="3931335">0</span>&nbsp;<span class="op" id="3931337">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931341">n</span>&nbsp;<span class="op" id="3931343">:=</span>&nbsp;<span class="builtinfunc" id="3931346">copy</span><span class="op" id="3931350">(</span><span class="ident" id="3931351">d</span><span class="op" id="3931352">.</span><span class="ident" id="3931353">x</span><span class="op" id="3931354">[</span><span class="ident" id="3931355">d</span><span class="op" id="3931356">.</span><span class="ident" id="3931357">nx</span><span class="op" id="3931359">:</span><span class="op" id="3931360">]</span><span class="op" id="3931361">,</span>&nbsp;<span class="ident" id="3931363">p</span><span class="op" id="3931364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931368">d</span><span class="op" id="3931369">.</span><span class="ident" id="3931370">nx</span>&nbsp;<span class="op" id="3931373">+=</span>&nbsp;<span class="ident" id="3931376">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931380">if</span>&nbsp;<span class="ident" id="3931383">d</span><span class="op" id="3931384">.</span><span class="ident" id="3931385">nx</span>&nbsp;<span class="op" id="3931388">==</span>&nbsp;<span class="ident" id="3931391">chunk</span>&nbsp;<span class="op" id="3931397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931402">block</span><span class="op" id="3931407">(</span><span class="ident" id="3931408">d</span><span class="op" id="3931409">,</span>&nbsp;<span class="ident" id="3931411">d</span><span class="op" id="3931412">.</span><span class="ident" id="3931413">x</span><span class="op" id="3931414">[</span><span class="op" id="3931415">:</span><span class="op" id="3931416">]</span><span class="op" id="3931417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931422">d</span><span class="op" id="3931423">.</span><span class="ident" id="3931424">nx</span>&nbsp;<span class="op" id="3931427">=</span>&nbsp;<span class="num" id="3931429">0</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931437">p</span>&nbsp;<span class="op" id="3931439">=</span>&nbsp;<span class="ident" id="3931441">p</span><span class="op" id="3931442">[</span><span class="ident" id="3931443">n</span><span class="op" id="3931444">:</span><span class="op" id="3931445">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931451">if</span>&nbsp;<span class="builtinfunc" id="3931454">len</span><span class="op" id="3931457">(</span><span class="ident" id="3931458">p</span><span class="op" id="3931459">)</span>&nbsp;<span class="op" id="3931461">&gt;=</span>&nbsp;<span class="ident" id="3931464">chunk</span>&nbsp;<span class="op" id="3931470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931474">n</span>&nbsp;<span class="op" id="3931476">:=</span>&nbsp;<span class="builtinfunc" id="3931479">len</span><span class="op" id="3931482">(</span><span class="ident" id="3931483">p</span><span class="op" id="3931484">)</span>&nbsp;<span class="op" id="3931486">&amp;^</span>&nbsp;<span class="op" id="3931489">(</span><span class="ident" id="3931490">chunk</span>&nbsp;<span class="op" id="3931496">-</span>&nbsp;<span class="num" id="3931498">1</span><span class="op" id="3931499">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931503">block</span><span class="op" id="3931508">(</span><span class="ident" id="3931509">d</span><span class="op" id="3931510">,</span>&nbsp;<span class="ident" id="3931512">p</span><span class="op" id="3931513">[</span><span class="op" id="3931514">:</span><span class="ident" id="3931515">n</span><span class="op" id="3931516">]</span><span class="op" id="3931517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931521">p</span>&nbsp;<span class="op" id="3931523">=</span>&nbsp;<span class="ident" id="3931525">p</span><span class="op" id="3931526">[</span><span class="ident" id="3931527">n</span><span class="op" id="3931528">:</span><span class="op" id="3931529">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931535">if</span>&nbsp;<span class="builtinfunc" id="3931538">len</span><span class="op" id="3931541">(</span><span class="ident" id="3931542">p</span><span class="op" id="3931543">)</span>&nbsp;<span class="op" id="3931545">&gt;</span>&nbsp;<span class="num" id="3931547">0</span>&nbsp;<span class="op" id="3931549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931553">d</span><span class="op" id="3931554">.</span><span class="ident" id="3931555">nx</span>&nbsp;<span class="op" id="3931558">=</span>&nbsp;<span class="builtinfunc" id="3931560">copy</span><span class="op" id="3931564">(</span><span class="ident" id="3931565">d</span><span class="op" id="3931566">.</span><span class="ident" id="3931567">x</span><span class="op" id="3931568">[</span><span class="op" id="3931569">:</span><span class="op" id="3931570">]</span><span class="op" id="3931571">,</span>&nbsp;<span class="ident" id="3931573">p</span><span class="op" id="3931574">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931580">return</span><br>
<span class="lineno"></span><span class="op" id="3931587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3931590">func</span>&nbsp;<span class="op" id="3931595">(</span><span class="ident" id="3931596">d0</span>&nbsp;<span class="op" id="3931599">*</span><span class="ident" id="3931600">digest</span><span class="op" id="3931606">)</span>&nbsp;<span class="ident" id="3931608">Sum</span><span class="op" id="3931611">(</span><span class="ident" id="3931612">in</span>&nbsp;<span class="op" id="3931615">[</span><span class="op" id="3931616">]</span><span class="builtintype" id="3931617">byte</span><span class="op" id="3931621">)</span>&nbsp;<span class="op" id="3931623">[</span><span class="op" id="3931624">]</span><span class="builtintype" id="3931625">byte</span>&nbsp;<span class="op" id="3931630">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3931633">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;d0&nbsp;so&nbsp;that&nbsp;caller&nbsp;can&nbsp;keep&nbsp;writing&nbsp;and&nbsp;summing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931700">d</span>&nbsp;<span class="op" id="3931702">:=</span>&nbsp;<span class="op" id="3931705">*</span><span class="ident" id="3931706">d0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931710">hash</span>&nbsp;<span class="op" id="3931715">:=</span>&nbsp;<span class="ident" id="3931718">d</span><span class="op" id="3931719">.</span><span class="ident" id="3931720">checkSum</span><span class="op" id="3931728">(</span><span class="op" id="3931729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931732">return</span>&nbsp;<span class="builtinfunc" id="3931739">append</span><span class="op" id="3931745">(</span><span class="ident" id="3931746">in</span><span class="op" id="3931748">,</span>&nbsp;<span class="ident" id="3931750">hash</span><span class="op" id="3931754">[</span><span class="op" id="3931755">:</span><span class="op" id="3931756">]</span><span class="op" id="3931757">...</span><span class="op" id="3931760">)</span><br>
<span class="lineno"></span><span class="op" id="3931762">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="3931765">func</span>&nbsp;<span class="op" id="3931770">(</span><span class="ident" id="3931771">d</span>&nbsp;<span class="op" id="3931773">*</span><span class="ident" id="3931774">digest</span><span class="op" id="3931780">)</span>&nbsp;<span class="ident" id="3931782">checkSum</span><span class="op" id="3931790">(</span><span class="op" id="3931791">)</span>&nbsp;<span class="op" id="3931793">[</span><span class="ident" id="3931794">Size</span><span class="op" id="3931798">]</span><span class="builtintype" id="3931799">byte</span>&nbsp;<span class="op" id="3931804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3931807">len</span>&nbsp;<span class="op" id="3931811">:=</span>&nbsp;<span class="ident" id="3931814">d</span><span class="op" id="3931815">.</span><span class="builtinfunc" id="3931816">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3931821">//&nbsp;Padding.&nbsp;&nbsp;Add&nbsp;a&nbsp;1&nbsp;bit&nbsp;and&nbsp;0&nbsp;bits&nbsp;until&nbsp;56&nbsp;bytes&nbsp;mod&nbsp;64.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931881">var</span>&nbsp;<span class="ident" id="3931885">tmp</span>&nbsp;<span class="op" id="3931889">[</span><span class="num" id="3931890">64</span><span class="op" id="3931892">]</span><span class="builtintype" id="3931893">byte</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931899">tmp</span><span class="op" id="3931902">[</span><span class="num" id="3931903">0</span><span class="op" id="3931904">]</span>&nbsp;<span class="op" id="3931906">=</span>&nbsp;<span class="num" id="3931908">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931914">if</span>&nbsp;<span class="builtinfunc" id="3931917">len</span><span class="op" id="3931920">%</span><span class="num" id="3931921">64</span>&nbsp;<span class="op" id="3931924">&lt;</span>&nbsp;<span class="num" id="3931926">56</span>&nbsp;<span class="op" id="3931929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931933">d</span><span class="op" id="3931934">.</span><span class="ident" id="3931935">Write</span><span class="op" id="3931940">(</span><span class="ident" id="3931941">tmp</span><span class="op" id="3931944">[</span><span class="num" id="3931945">0</span>&nbsp;<span class="op" id="3931947">:</span>&nbsp;<span class="num" id="3931949">56</span><span class="op" id="3931951">-</span><span class="builtinfunc" id="3931952">len</span><span class="op" id="3931955">%</span><span class="num" id="3931956">64</span><span class="op" id="3931958">]</span><span class="op" id="3931959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931962">}</span>&nbsp;<span class="keyword" id="3931964">else</span>&nbsp;<span class="op" id="3931969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931973">d</span><span class="op" id="3931974">.</span><span class="ident" id="3931975">Write</span><span class="op" id="3931980">(</span><span class="ident" id="3931981">tmp</span><span class="op" id="3931984">[</span><span class="num" id="3931985">0</span>&nbsp;<span class="op" id="3931987">:</span>&nbsp;<span class="num" id="3931989">64</span><span class="op" id="3931991">+</span><span class="num" id="3931992">56</span><span class="op" id="3931994">-</span><span class="builtinfunc" id="3931995">len</span><span class="op" id="3931998">%</span><span class="num" id="3931999">64</span><span class="op" id="3932001">]</span><span class="op" id="3932002">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3932005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3932009">//&nbsp;Length&nbsp;in&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3932029">len</span>&nbsp;<span class="op" id="3932033">&lt;&lt;=</span>&nbsp;<span class="num" id="3932037">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932040">for</span>&nbsp;<span class="ident" id="3932044">i</span>&nbsp;<span class="op" id="3932046">:=</span>&nbsp;<span class="builtintype" id="3932049">uint</span><span class="op" id="3932053">(</span><span class="num" id="3932054">0</span><span class="op" id="3932055">)</span><span class="op" id="3932056">;</span>&nbsp;<span class="ident" id="3932058">i</span>&nbsp;<span class="op" id="3932060">&lt;</span>&nbsp;<span class="num" id="3932062">8</span><span class="op" id="3932063">;</span>&nbsp;<span class="ident" id="3932065">i</span><span class="op" id="3932066">++</span>&nbsp;<span class="op" id="3932069">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932073">tmp</span><span class="op" id="3932076">[</span><span class="ident" id="3932077">i</span><span class="op" id="3932078">]</span>&nbsp;<span class="op" id="3932080">=</span>&nbsp;<span class="builtintype" id="3932082">byte</span><span class="op" id="3932086">(</span><span class="builtinfunc" id="3932087">len</span>&nbsp;<span class="op" id="3932091">&gt;&gt;</span>&nbsp;<span class="op" id="3932094">(</span><span class="num" id="3932095">56</span>&nbsp;<span class="op" id="3932098">-</span>&nbsp;<span class="num" id="3932100">8</span><span class="op" id="3932101">*</span><span class="ident" id="3932102">i</span><span class="op" id="3932103">)</span><span class="op" id="3932104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3932107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932110">d</span><span class="op" id="3932111">.</span><span class="ident" id="3932112">Write</span><span class="op" id="3932117">(</span><span class="ident" id="3932118">tmp</span><span class="op" id="3932121">[</span><span class="num" id="3932122">0</span><span class="op" id="3932123">:</span><span class="num" id="3932124">8</span><span class="op" id="3932125">]</span><span class="op" id="3932126">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932130">if</span>&nbsp;<span class="ident" id="3932133">d</span><span class="op" id="3932134">.</span><span class="ident" id="3932135">nx</span>&nbsp;<span class="op" id="3932138">!=</span>&nbsp;<span class="num" id="3932141">0</span>&nbsp;<span class="op" id="3932143">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3932147">panic</span><span class="op" id="3932152">(</span><span class="string" id="3932153">&#34;d.nx&nbsp;!=&nbsp;0&#34;</span><span class="op" id="3932164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3932167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932171">var</span>&nbsp;<span class="ident" id="3932175">digest</span>&nbsp;<span class="op" id="3932182">[</span><span class="ident" id="3932183">Size</span><span class="op" id="3932187">]</span><span class="builtintype" id="3932188">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932194">for</span>&nbsp;<span class="ident" id="3932198">i</span><span class="op" id="3932199">,</span>&nbsp;<span class="ident" id="3932201">s</span>&nbsp;<span class="op" id="3932203">:=</span>&nbsp;<span class="keyword" id="3932206">range</span>&nbsp;<span class="ident" id="3932212">d</span><span class="op" id="3932213">.</span><span class="ident" id="3932214">h</span>&nbsp;<span class="op" id="3932216">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932220">digest</span><span class="op" id="3932226">[</span><span class="ident" id="3932227">i</span><span class="op" id="3932228">*</span><span class="num" id="3932229">4</span><span class="op" id="3932230">]</span>&nbsp;<span class="op" id="3932232">=</span>&nbsp;<span class="builtintype" id="3932234">byte</span><span class="op" id="3932238">(</span><span class="ident" id="3932239">s</span>&nbsp;<span class="op" id="3932241">&gt;&gt;</span>&nbsp;<span class="num" id="3932244">24</span><span class="op" id="3932246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932250">digest</span><span class="op" id="3932256">[</span><span class="ident" id="3932257">i</span><span class="op" id="3932258">*</span><span class="num" id="3932259">4</span><span class="op" id="3932260">+</span><span class="num" id="3932261">1</span><span class="op" id="3932262">]</span>&nbsp;<span class="op" id="3932264">=</span>&nbsp;<span class="builtintype" id="3932266">byte</span><span class="op" id="3932270">(</span><span class="ident" id="3932271">s</span>&nbsp;<span class="op" id="3932273">&gt;&gt;</span>&nbsp;<span class="num" id="3932276">16</span><span class="op" id="3932278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932282">digest</span><span class="op" id="3932288">[</span><span class="ident" id="3932289">i</span><span class="op" id="3932290">*</span><span class="num" id="3932291">4</span><span class="op" id="3932292">+</span><span class="num" id="3932293">2</span><span class="op" id="3932294">]</span>&nbsp;<span class="op" id="3932296">=</span>&nbsp;<span class="builtintype" id="3932298">byte</span><span class="op" id="3932302">(</span><span class="ident" id="3932303">s</span>&nbsp;<span class="op" id="3932305">&gt;&gt;</span>&nbsp;<span class="num" id="3932308">8</span><span class="op" id="3932309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932313">digest</span><span class="op" id="3932319">[</span><span class="ident" id="3932320">i</span><span class="op" id="3932321">*</span><span class="num" id="3932322">4</span><span class="op" id="3932323">+</span><span class="num" id="3932324">3</span><span class="op" id="3932325">]</span>&nbsp;<span class="op" id="3932327">=</span>&nbsp;<span class="builtintype" id="3932329">byte</span><span class="op" id="3932333">(</span><span class="ident" id="3932334">s</span><span class="op" id="3932335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3932338">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932342">return</span>&nbsp;<span class="ident" id="3932349">digest</span><br>
<span class="lineno"></span><span class="op" id="3932356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3932359">//&nbsp;Sum&nbsp;returns&nbsp;the&nbsp;SHA1&nbsp;checksum&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno">125</span><span class="keyword" id="3932405">func</span>&nbsp;<span class="ident" id="3932410">Sum</span><span class="op" id="3932413">(</span><span class="ident" id="3932414">data</span>&nbsp;<span class="op" id="3932419">[</span><span class="op" id="3932420">]</span><span class="builtintype" id="3932421">byte</span><span class="op" id="3932425">)</span>&nbsp;<span class="op" id="3932427">[</span><span class="ident" id="3932428">Size</span><span class="op" id="3932432">]</span><span class="builtintype" id="3932433">byte</span>&nbsp;<span class="op" id="3932438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932441">var</span>&nbsp;<span class="ident" id="3932445">d</span>&nbsp;<span class="ident" id="3932447">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932455">d</span><span class="op" id="3932456">.</span><span class="ident" id="3932457">Reset</span><span class="op" id="3932462">(</span><span class="op" id="3932463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932466">d</span><span class="op" id="3932467">.</span><span class="ident" id="3932468">Write</span><span class="op" id="3932473">(</span><span class="ident" id="3932474">data</span><span class="op" id="3932478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932481">return</span>&nbsp;<span class="ident" id="3932488">d</span><span class="op" id="3932489">.</span><span class="ident" id="3932490">checkSum</span><span class="op" id="3932498">(</span><span class="op" id="3932499">)</span><br>
<span class="lineno">130</span><span class="op" id="3932501">}</span>
</div>
</body>
</html>
