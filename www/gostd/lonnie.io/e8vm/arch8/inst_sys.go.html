<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/arch8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/arch8/console.go.html">console.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu.go.html">cpu.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu_test.go.html">cpu_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/device.go.html">device.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/exception.go.html">exception.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br_test.go.html">inst_br_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm_test.go.html">inst_imm_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg_test.go.html">inst_reg_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/int_bus.go.html">int_bus.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt.go.html">interrupt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt_test.go.html">interrupt_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/machine.go.html">machine.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/multi_core.go.html">multi_core.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page.go.html">page.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table.go.html">page_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table_test.go.html">page_table_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_test.go.html">page_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory.go.html">phy_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory_test.go.html">phy_memory_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs.go.html">regs.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs_test.go.html">regs_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/run_image.go.html">run_image.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/serial.go.html">serial.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/ticker.go.html">ticker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory.go.html">virt_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory_test.go.html">virt_memory_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="3573580">package</span>&nbsp;<span class="ident" id="3573588">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3573595">//&nbsp;InstSys&nbsp;exectues&nbsp;a&nbsp;system&nbsp;instruction</span><br>
<span class="lineno"></span><span class="keyword" id="3573636">type</span>&nbsp;<span class="ident" id="3573641">instSys</span>&nbsp;<span class="keyword" id="3573649">struct</span><span class="op" id="3573655">{</span><span class="op" id="3573656">}</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span><span class="comment" id="3573659">//&nbsp;I&nbsp;executes&nbsp;the&nbsp;system&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="3573697">//&nbsp;Returns&nbsp;any&nbsp;exception&nbsp;encountered.</span><br>
<span class="lineno"></span><span class="keyword" id="3573735">func</span>&nbsp;<span class="op" id="3573740">(</span><span class="ident" id="3573741">i</span>&nbsp;<span class="op" id="3573743">*</span><span class="ident" id="3573744">instSys</span><span class="op" id="3573751">)</span>&nbsp;<span class="ident" id="3573753">I</span><span class="op" id="3573754">(</span><span class="ident" id="3573755">cpu</span>&nbsp;<span class="op" id="3573759">*</span><span class="ident" id="3573760">cpu</span><span class="op" id="3573763">,</span>&nbsp;<span class="ident" id="3573765">in</span>&nbsp;<span class="builtintype" id="3573768">uint32</span><span class="op" id="3573774">)</span>&nbsp;<span class="op" id="3573776">*</span><span class="ident" id="3573777">Excep</span>&nbsp;<span class="op" id="3573783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573786">op</span>&nbsp;<span class="op" id="3573789">:=</span>&nbsp;<span class="op" id="3573792">(</span><span class="ident" id="3573793">in</span>&nbsp;<span class="op" id="3573796">&gt;&gt;</span>&nbsp;<span class="num" id="3573799">24</span><span class="op" id="3573801">)</span>&nbsp;<span class="op" id="3573803">&amp;</span>&nbsp;<span class="num" id="3573805">0xff</span>&nbsp;<span class="comment" id="3573810">//&nbsp;(32:24]</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573822">src</span>&nbsp;<span class="op" id="3573826">:=</span>&nbsp;<span class="op" id="3573829">(</span><span class="ident" id="3573830">in</span>&nbsp;<span class="op" id="3573833">&gt;&gt;</span>&nbsp;<span class="num" id="3573836">21</span><span class="op" id="3573838">)</span>&nbsp;<span class="op" id="3573840">&amp;</span>&nbsp;<span class="num" id="3573842">0x7</span>&nbsp;<span class="comment" id="3573846">//&nbsp;(24:21]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573858">s</span>&nbsp;<span class="op" id="3573860">:=</span>&nbsp;<span class="ident" id="3573863">cpu</span><span class="op" id="3573866">.</span><span class="ident" id="3573867">regs</span><span class="op" id="3573871">[</span><span class="ident" id="3573872">src</span><span class="op" id="3573875">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573879">switch</span>&nbsp;<span class="ident" id="3573886">op</span>&nbsp;<span class="op" id="3573889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573892">case</span>&nbsp;<span class="num" id="3573897">64</span><span class="op" id="3573899">:</span>&nbsp;<span class="comment" id="3573901">//&nbsp;halt</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573911">return</span>&nbsp;<span class="ident" id="3573918">errHalt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573927">case</span>&nbsp;<span class="num" id="3573932">65</span><span class="op" id="3573934">:</span>&nbsp;<span class="comment" id="3573936">//&nbsp;syscall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573949">if</span>&nbsp;<span class="op" id="3573952">!</span><span class="ident" id="3573953">cpu</span><span class="op" id="3573956">.</span><span class="ident" id="3573957">UserMode</span><span class="op" id="3573965">(</span><span class="op" id="3573966">)</span>&nbsp;<span class="op" id="3573968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573973">return</span>&nbsp;<span class="ident" id="3573980">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3573997">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574001">return</span>&nbsp;<span class="ident" id="3574008">cpu</span><span class="op" id="3574011">.</span><span class="ident" id="3574012">Syscall</span><span class="op" id="3574019">(</span><span class="op" id="3574020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574023">case</span>&nbsp;<span class="num" id="3574028">66</span><span class="op" id="3574030">:</span>&nbsp;<span class="comment" id="3574032">//&nbsp;usermod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574045">cpu</span><span class="op" id="3574048">.</span><span class="ident" id="3574049">ring</span>&nbsp;<span class="op" id="3574054">=</span>&nbsp;<span class="num" id="3574056">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574059">case</span>&nbsp;<span class="num" id="3574064">67</span><span class="op" id="3574066">:</span>&nbsp;<span class="comment" id="3574068">//&nbsp;vtable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574080">if</span>&nbsp;<span class="ident" id="3574083">cpu</span><span class="op" id="3574086">.</span><span class="ident" id="3574087">UserMode</span><span class="op" id="3574095">(</span><span class="op" id="3574096">)</span>&nbsp;<span class="op" id="3574098">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574103">return</span>&nbsp;<span class="ident" id="3574110">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3574127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574131">cpu</span><span class="op" id="3574134">.</span><span class="ident" id="3574135">virtMem</span><span class="op" id="3574142">.</span><span class="ident" id="3574143">SetTable</span><span class="op" id="3574151">(</span><span class="ident" id="3574152">s</span><span class="op" id="3574153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574156">case</span>&nbsp;<span class="num" id="3574161">68</span><span class="op" id="3574163">:</span>&nbsp;<span class="comment" id="3574165">//&nbsp;iret</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574175">if</span>&nbsp;<span class="ident" id="3574178">cpu</span><span class="op" id="3574181">.</span><span class="ident" id="3574182">UserMode</span><span class="op" id="3574190">(</span><span class="op" id="3574191">)</span>&nbsp;<span class="op" id="3574193">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574198">return</span>&nbsp;<span class="ident" id="3574205">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3574222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574226">return</span>&nbsp;<span class="ident" id="3574233">cpu</span><span class="op" id="3574236">.</span><span class="ident" id="3574237">Iret</span><span class="op" id="3574241">(</span><span class="op" id="3574242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574245">case</span>&nbsp;<span class="num" id="3574250">69</span><span class="op" id="3574252">:</span>&nbsp;<span class="comment" id="3574254">//&nbsp;cpuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574265">s</span>&nbsp;<span class="op" id="3574267">=</span>&nbsp;<span class="builtintype" id="3574269">uint32</span><span class="op" id="3574275">(</span><span class="ident" id="3574276">cpu</span><span class="op" id="3574279">.</span><span class="ident" id="3574280">index</span><span class="op" id="3574285">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574288">default</span><span class="op" id="3574295">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574299">return</span>&nbsp;<span class="ident" id="3574306">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3574322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3574326">cpu</span><span class="op" id="3574329">.</span><span class="ident" id="3574330">regs</span><span class="op" id="3574334">[</span><span class="ident" id="3574335">src</span><span class="op" id="3574338">]</span>&nbsp;<span class="op" id="3574340">=</span>&nbsp;<span class="ident" id="3574342">s</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574346">return</span>&nbsp;<span class="ident" id="3574353">nil</span><br>
<span class="lineno"></span><span class="op" id="3574357">}</span>
</div>
</body>
</html>
