<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5809224">package</span>&nbsp;<span class="ident" id="5809232">asm8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5809238">import</span>&nbsp;<span class="op" id="5809245">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5809248">&#34;lonnie.io/e8vm/lex8&#34;</span><br>
<span class="lineno">5</span><span class="op" id="5809270">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5809273">var</span>&nbsp;<span class="op" id="5809277">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5809280">//&nbsp;op&nbsp;reg&nbsp;reg&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809301">opBrMap</span>&nbsp;<span class="op" id="5809309">=</span>&nbsp;<span class="keyword" id="5809311">map</span><span class="op" id="5809314">[</span><span class="builtintype" id="5809315">string</span><span class="op" id="5809321">]</span><span class="builtintype" id="5809322">uint32</span><span class="op" id="5809328">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5809332">&#34;bne&#34;</span><span class="op" id="5809337">:</span>&nbsp;<span class="num" id="5809339">32</span><span class="op" id="5809341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5809345">&#34;beq&#34;</span><span class="op" id="5809350">:</span>&nbsp;<span class="num" id="5809352">33</span><span class="op" id="5809354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809357">}</span><br>
<span class="lineno"></span><span class="op" id="5809359">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5809362">func</span>&nbsp;<span class="ident" id="5809367">makeInstBr</span><span class="op" id="5809377">(</span><span class="ident" id="5809378">op</span><span class="op" id="5809380">,</span>&nbsp;<span class="ident" id="5809382">s1</span><span class="op" id="5809384">,</span>&nbsp;<span class="ident" id="5809386">s2</span>&nbsp;<span class="builtintype" id="5809389">uint32</span><span class="op" id="5809395">)</span>&nbsp;<span class="op" id="5809397">*</span><span class="ident" id="5809398">inst</span>&nbsp;<span class="op" id="5809403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809406">ret</span>&nbsp;<span class="op" id="5809410">:=</span>&nbsp;<span class="op" id="5809413">(</span><span class="ident" id="5809414">op</span>&nbsp;<span class="op" id="5809417">&amp;</span>&nbsp;<span class="num" id="5809419">0xff</span><span class="op" id="5809423">)</span>&nbsp;<span class="op" id="5809425">&lt;&lt;</span>&nbsp;<span class="num" id="5809428">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809432">ret</span>&nbsp;<span class="op" id="5809436">|=</span>&nbsp;<span class="op" id="5809439">(</span><span class="ident" id="5809440">s1</span>&nbsp;<span class="op" id="5809443">&amp;</span>&nbsp;<span class="num" id="5809445">0x7</span><span class="op" id="5809448">)</span>&nbsp;<span class="op" id="5809450">&lt;&lt;</span>&nbsp;<span class="num" id="5809453">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809457">ret</span>&nbsp;<span class="op" id="5809461">|=</span>&nbsp;<span class="op" id="5809464">(</span><span class="ident" id="5809465">s2</span>&nbsp;<span class="op" id="5809468">&amp;</span>&nbsp;<span class="num" id="5809470">0x7</span><span class="op" id="5809473">)</span>&nbsp;<span class="op" id="5809475">&lt;&lt;</span>&nbsp;<span class="num" id="5809478">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809482">return</span>&nbsp;<span class="op" id="5809489">&amp;</span><span class="ident" id="5809490">inst</span><span class="op" id="5809494">{</span><span class="ident" id="5809495">inst</span><span class="op" id="5809499">:</span>&nbsp;<span class="ident" id="5809501">ret</span><span class="op" id="5809504">}</span><br>
<span class="lineno">20</span><span class="op" id="5809506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5809509">func</span>&nbsp;<span class="ident" id="5809514">parseInstBr</span><span class="op" id="5809525">(</span><span class="ident" id="5809526">p</span>&nbsp;<span class="op" id="5809528">*</span><span class="ident" id="5809529">parser</span><span class="op" id="5809535">,</span>&nbsp;<span class="ident" id="5809537">ops</span>&nbsp;<span class="op" id="5809541">[</span><span class="op" id="5809542">]</span><span class="op" id="5809543">*</span><span class="ident" id="5809544">lex8</span><span class="op" id="5809548">.</span><span class="ident" id="5809549">Token</span><span class="op" id="5809554">)</span>&nbsp;<span class="op" id="5809556">(</span><span class="op" id="5809557">*</span><span class="ident" id="5809558">inst</span><span class="op" id="5809562">,</span>&nbsp;<span class="builtintype" id="5809564">bool</span><span class="op" id="5809568">)</span>&nbsp;<span class="op" id="5809570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809573">op0</span>&nbsp;<span class="op" id="5809577">:=</span>&nbsp;<span class="ident" id="5809580">ops</span><span class="op" id="5809583">[</span><span class="num" id="5809584">0</span><span class="op" id="5809585">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809588">opName</span>&nbsp;<span class="op" id="5809595">:=</span>&nbsp;<span class="ident" id="5809598">op0</span><span class="op" id="5809601">.</span><span class="ident" id="5809602">Lit</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809607">args</span>&nbsp;<span class="op" id="5809612">:=</span>&nbsp;<span class="ident" id="5809615">ops</span><span class="op" id="5809618">[</span><span class="num" id="5809619">1</span><span class="op" id="5809620">:</span><span class="op" id="5809621">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809625">var</span>&nbsp;<span class="op" id="5809629">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809633">op</span><span class="op" id="5809635">,</span>&nbsp;<span class="ident" id="5809637">s1</span><span class="op" id="5809639">,</span>&nbsp;<span class="ident" id="5809641">s2</span>&nbsp;<span class="builtintype" id="5809644">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809653">lab</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5809664">string</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809673">symTok</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5809684">*</span><span class="ident" id="5809685">lex8</span><span class="op" id="5809689">.</span><span class="ident" id="5809690">Token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809699">found</span>&nbsp;<span class="builtintype" id="5809705">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809711">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809715">if</span>&nbsp;<span class="ident" id="5809718">op</span><span class="op" id="5809720">,</span>&nbsp;<span class="ident" id="5809722">found</span>&nbsp;<span class="op" id="5809728">=</span>&nbsp;<span class="ident" id="5809730">opBrMap</span><span class="op" id="5809737">[</span><span class="ident" id="5809738">opName</span><span class="op" id="5809744">]</span><span class="op" id="5809745">;</span>&nbsp;<span class="ident" id="5809747">found</span>&nbsp;<span class="op" id="5809753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5809757">//&nbsp;op&nbsp;reg&nbsp;reg&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809779">if</span>&nbsp;<span class="ident" id="5809782">argCount</span><span class="op" id="5809790">(</span><span class="ident" id="5809791">p</span><span class="op" id="5809792">,</span>&nbsp;<span class="ident" id="5809794">ops</span><span class="op" id="5809797">,</span>&nbsp;<span class="num" id="5809799">3</span><span class="op" id="5809800">)</span>&nbsp;<span class="op" id="5809802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809807">s1</span>&nbsp;<span class="op" id="5809810">=</span>&nbsp;<span class="ident" id="5809812">parseReg</span><span class="op" id="5809820">(</span><span class="ident" id="5809821">p</span><span class="op" id="5809822">,</span>&nbsp;<span class="ident" id="5809824">args</span><span class="op" id="5809828">[</span><span class="num" id="5809829">0</span><span class="op" id="5809830">]</span><span class="op" id="5809831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809836">s2</span>&nbsp;<span class="op" id="5809839">=</span>&nbsp;<span class="ident" id="5809841">parseReg</span><span class="op" id="5809849">(</span><span class="ident" id="5809850">p</span><span class="op" id="5809851">,</span>&nbsp;<span class="ident" id="5809853">args</span><span class="op" id="5809857">[</span><span class="num" id="5809858">1</span><span class="op" id="5809859">]</span><span class="op" id="5809860">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809865">symTok</span>&nbsp;<span class="op" id="5809872">=</span>&nbsp;<span class="ident" id="5809874">args</span><span class="op" id="5809878">[</span><span class="num" id="5809879">2</span><span class="op" id="5809880">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809885">if</span>&nbsp;<span class="ident" id="5809888">parseLabel</span><span class="op" id="5809898">(</span><span class="ident" id="5809899">p</span><span class="op" id="5809900">,</span>&nbsp;<span class="ident" id="5809902">symTok</span><span class="op" id="5809908">)</span>&nbsp;<span class="op" id="5809910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809916">lab</span>&nbsp;<span class="op" id="5809920">=</span>&nbsp;<span class="ident" id="5809922">symTok</span><span class="op" id="5809928">.</span><span class="ident" id="5809929">Lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809936">}</span>&nbsp;<span class="keyword" id="5809938">else</span>&nbsp;<span class="op" id="5809943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809949">p</span><span class="op" id="5809950">.</span><span class="ident" id="5809951">err</span><span class="op" id="5809954">(</span><span class="ident" id="5809955">symTok</span><span class="op" id="5809961">.</span><span class="ident" id="5809962">Pos</span><span class="op" id="5809965">,</span>&nbsp;<span class="string" id="5809967">&#34;expects&nbsp;a&nbsp;label&nbsp;for&nbsp;%s&#34;</span><span class="op" id="5809991">,</span>&nbsp;<span class="ident" id="5809993">opName</span><span class="op" id="5809999">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810011">}</span>&nbsp;<span class="keyword" id="5810013">else</span>&nbsp;<span class="op" id="5810018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810022">return</span>&nbsp;<span class="ident" id="5810029">nil</span><span class="op" id="5810032">,</span>&nbsp;<span class="ident" id="5810034">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5810041">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810045">ret</span>&nbsp;<span class="op" id="5810049">:=</span>&nbsp;<span class="ident" id="5810052">makeInstBr</span><span class="op" id="5810062">(</span><span class="ident" id="5810063">op</span><span class="op" id="5810065">,</span>&nbsp;<span class="ident" id="5810067">s1</span><span class="op" id="5810069">,</span>&nbsp;<span class="ident" id="5810071">s2</span><span class="op" id="5810073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810076">ret</span><span class="op" id="5810079">.</span><span class="ident" id="5810080">symbol</span>&nbsp;<span class="op" id="5810087">=</span>&nbsp;<span class="ident" id="5810089">lab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810094">ret</span><span class="op" id="5810097">.</span><span class="ident" id="5810098">fill</span>&nbsp;<span class="op" id="5810103">=</span>&nbsp;<span class="ident" id="5810105">fillLabel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810116">ret</span><span class="op" id="5810119">.</span><span class="ident" id="5810120">symTok</span>&nbsp;<span class="op" id="5810127">=</span>&nbsp;<span class="ident" id="5810129">symTok</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5810138">return</span>&nbsp;<span class="ident" id="5810145">ret</span><span class="op" id="5810148">,</span>&nbsp;<span class="ident" id="5810150">true</span><br>
<span class="lineno"></span><span class="op" id="5810155">}</span>
</div>
</body>
</html>
