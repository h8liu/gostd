<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7081637">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7081692">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7081746">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7081797">package</span>&nbsp;<span class="ident" id="7081805">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7081815">import</span>&nbsp;<span class="op" id="7081822">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7081825">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7081832">&#34;net/http&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7081844">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7081854">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7081857">func</span>&nbsp;<span class="ident" id="7081862">TestRecorder</span><span class="op" id="7081874">(</span><span class="ident" id="7081875">t</span>&nbsp;<span class="op" id="7081877">*</span><span class="ident" id="7081878">testing</span><span class="op" id="7081885">.</span><span class="ident" id="7081886">T</span><span class="op" id="7081887">)</span>&nbsp;<span class="op" id="7081889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7081892">type</span>&nbsp;<span class="ident" id="7081897">checkFunc</span>&nbsp;<span class="keyword" id="7081907">func</span><span class="op" id="7081911">(</span><span class="op" id="7081912">*</span><span class="ident" id="7081913">ResponseRecorder</span><span class="op" id="7081929">)</span>&nbsp;<span class="builtintype" id="7081931">error</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7081938">check</span>&nbsp;<span class="op" id="7081944">:=</span>&nbsp;<span class="keyword" id="7081947">func</span><span class="op" id="7081951">(</span><span class="ident" id="7081952">fns</span>&nbsp;<span class="op" id="7081956">...</span><span class="ident" id="7081959">checkFunc</span><span class="op" id="7081968">)</span>&nbsp;<span class="op" id="7081970">[</span><span class="op" id="7081971">]</span><span class="ident" id="7081972">checkFunc</span>&nbsp;<span class="op" id="7081982">{</span>&nbsp;<span class="keyword" id="7081984">return</span>&nbsp;<span class="ident" id="7081991">fns</span>&nbsp;<span class="op" id="7081995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7081999">hasStatus</span>&nbsp;<span class="op" id="7082009">:=</span>&nbsp;<span class="keyword" id="7082012">func</span><span class="op" id="7082016">(</span><span class="ident" id="7082017">wantCode</span>&nbsp;<span class="builtintype" id="7082026">int</span><span class="op" id="7082029">)</span>&nbsp;<span class="ident" id="7082031">checkFunc</span>&nbsp;<span class="op" id="7082041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7082045">return</span>&nbsp;<span class="keyword" id="7082052">func</span><span class="op" id="7082056">(</span><span class="ident" id="7082057">rec</span>&nbsp;<span class="op" id="7082061">*</span><span class="ident" id="7082062">ResponseRecorder</span><span class="op" id="7082078">)</span>&nbsp;<span class="builtintype" id="7082080">error</span>&nbsp;<span class="op" id="7082086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7082091">if</span>&nbsp;<span class="ident" id="7082094">rec</span><span class="op" id="7082097">.</span><span class="ident" id="7082098">Code</span>&nbsp;<span class="op" id="7082103">!=</span>&nbsp;<span class="ident" id="7082106">wantCode</span>&nbsp;<span class="op" id="7082115">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7082121">return</span>&nbsp;<span class="ident" id="7082128">fmt</span><span class="op" id="7082131">.</span><span class="ident" id="7082132">Errorf</span><span class="op" id="7082138">(</span><span class="string" id="7082139">&#34;Status&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7082161">,</span>&nbsp;<span class="ident" id="7082163">rec</span><span class="op" id="7082166">.</span><span class="ident" id="7082167">Code</span><span class="op" id="7082171">,</span>&nbsp;<span class="ident" id="7082173">wantCode</span><span class="op" id="7082181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7082186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7082191">return</span>&nbsp;<span class="ident" id="7082198">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7082204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7082207">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7082210">hasContents</span>&nbsp;<span class="op" id="7082222">:=</span>&nbsp;<span class="keyword" id="7082225">func</span><span class="op" id="7082229">(</span><span class="ident" id="7082230">want</span>&nbsp;<span class="builtintype" id="7082235">string</span><span class="op" id="7082241">)</span>&nbsp;<span class="ident" id="7082243">checkFunc</span>&nbsp;<span class="op" id="7082253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7082257">return</span>&nbsp;<span class="keyword" id="7082264">func</span><span class="op" id="7082268">(</span><span class="ident" id="7082269">rec</span>&nbsp;<span class="op" id="7082273">*</span><span class="ident" id="7082274">ResponseRecorder</span><span class="op" id="7082290">)</span>&nbsp;<span class="builtintype" id="7082292">error</span>&nbsp;<span class="op" id="7082298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7082303">if</span>&nbsp;<span class="ident" id="7082306">rec</span><span class="op" id="7082309">.</span><span class="ident" id="7082310">Body</span><span class="op" id="7082314">.</span><span class="ident" id="7082315">String</span><span class="op" id="7082321">(</span><span class="op" id="7082322">)</span>&nbsp;<span class="op" id="7082324">!=</span>&nbsp;<span class="ident" id="7082327">want</span>&nbsp;<span class="op" id="7082332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7082338">return</span>&nbsp;<span class="ident" id="7082345">fmt</span><span class="op" id="7082348">.</span><span class="ident" id="7082349">Errorf</span><span class="op" id="7082355">(</span><span class="string" id="7082356">&#34;wrote&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7082377">,</span>&nbsp;<span class="ident" id="7082379">rec</span><span class="op" id="7082382">.</span><span class="ident" id="7082383">Body</span><span class="op" id="7082387">.</span><span class="ident" id="7082388">String</span><span class="op" id="7082394">(</span><span class="op" id="7082395">)</span><span class="op" id="7082396">,</span>&nbsp;<span class="ident" id="7082398">want</span><span class="op" id="7082402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7082407">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7082412">return</span>&nbsp;<span class="ident" id="7082419">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7082425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7082428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7082431">hasFlush</span>&nbsp;<span class="op" id="7082440">:=</span>&nbsp;<span class="keyword" id="7082443">func</span><span class="op" id="7082447">(</span><span class="ident" id="7082448">want</span>&nbsp;<span class="builtintype" id="7082453">bool</span><span class="op" id="7082457">)</span>&nbsp;<span class="ident" id="7082459">checkFunc</span>&nbsp;<span class="op" id="7082469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7082473">return</span>&nbsp;<span class="keyword" id="7082480">func</span><span class="op" id="7082484">(</span><span class="ident" id="7082485">rec</span>&nbsp;<span class="op" id="7082489">*</span><span class="ident" id="7082490">ResponseRecorder</span><span class="op" id="7082506">)</span>&nbsp;<span class="builtintype" id="7082508">error</span>&nbsp;<span class="op" id="7082514">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7082519">if</span>&nbsp;<span class="ident" id="7082522">rec</span><span class="op" id="7082525">.</span><span class="ident" id="7082526">Flushed</span>&nbsp;<span class="op" id="7082534">!=</span>&nbsp;<span class="ident" id="7082537">want</span>&nbsp;<span class="op" id="7082542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7082548">return</span>&nbsp;<span class="ident" id="7082555">fmt</span><span class="op" id="7082558">.</span><span class="ident" id="7082559">Errorf</span><span class="op" id="7082565">(</span><span class="string" id="7082566">&#34;Flushed&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7082589">,</span>&nbsp;<span class="ident" id="7082591">rec</span><span class="op" id="7082594">.</span><span class="ident" id="7082595">Flushed</span><span class="op" id="7082602">,</span>&nbsp;<span class="ident" id="7082604">want</span><span class="op" id="7082608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7082613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7082618">return</span>&nbsp;<span class="ident" id="7082625">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7082631">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7082634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7082638">tests</span>&nbsp;<span class="op" id="7082644">:=</span>&nbsp;<span class="op" id="7082647">[</span><span class="op" id="7082648">]</span><span class="keyword" id="7082649">struct</span>&nbsp;<span class="op" id="7082656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7082660">name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7082667">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7082676">h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7082683">func</span><span class="op" id="7082687">(</span><span class="ident" id="7082688">w</span>&nbsp;<span class="ident" id="7082690">http</span><span class="op" id="7082694">.</span><span class="ident" id="7082695">ResponseWriter</span><span class="op" id="7082709">,</span>&nbsp;<span class="ident" id="7082711">r</span>&nbsp;<span class="op" id="7082713">*</span><span class="ident" id="7082714">http</span><span class="op" id="7082718">.</span><span class="ident" id="7082719">Request</span><span class="op" id="7082726">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7082730">checks</span>&nbsp;<span class="op" id="7082737">[</span><span class="op" id="7082738">]</span><span class="ident" id="7082739">checkFunc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7082750">}</span><span class="op" id="7082751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7082755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7082760">&#34;200&nbsp;default&#34;</span><span class="op" id="7082773">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7082778">func</span><span class="op" id="7082782">(</span><span class="ident" id="7082783">w</span>&nbsp;<span class="ident" id="7082785">http</span><span class="op" id="7082789">.</span><span class="ident" id="7082790">ResponseWriter</span><span class="op" id="7082804">,</span>&nbsp;<span class="ident" id="7082806">r</span>&nbsp;<span class="op" id="7082808">*</span><span class="ident" id="7082809">http</span><span class="op" id="7082813">.</span><span class="ident" id="7082814">Request</span><span class="op" id="7082821">)</span>&nbsp;<span class="op" id="7082823">{</span><span class="op" id="7082824">}</span><span class="op" id="7082825">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7082830">check</span><span class="op" id="7082835">(</span><span class="ident" id="7082836">hasStatus</span><span class="op" id="7082845">(</span><span class="num" id="7082846">200</span><span class="op" id="7082849">)</span><span class="op" id="7082850">,</span>&nbsp;<span class="ident" id="7082852">hasContents</span><span class="op" id="7082863">(</span><span class="string" id="7082864">&#34;&#34;</span><span class="op" id="7082866">)</span><span class="op" id="7082867">)</span><span class="op" id="7082868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7082872">}</span><span class="op" id="7082873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7082877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7082882">&#34;first&nbsp;code&nbsp;only&#34;</span><span class="op" id="7082899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7082904">func</span><span class="op" id="7082908">(</span><span class="ident" id="7082909">w</span>&nbsp;<span class="ident" id="7082911">http</span><span class="op" id="7082915">.</span><span class="ident" id="7082916">ResponseWriter</span><span class="op" id="7082930">,</span>&nbsp;<span class="ident" id="7082932">r</span>&nbsp;<span class="op" id="7082934">*</span><span class="ident" id="7082935">http</span><span class="op" id="7082939">.</span><span class="ident" id="7082940">Request</span><span class="op" id="7082947">)</span>&nbsp;<span class="op" id="7082949">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7082955">w</span><span class="op" id="7082956">.</span><span class="ident" id="7082957">WriteHeader</span><span class="op" id="7082968">(</span><span class="num" id="7082969">201</span><span class="op" id="7082972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7082978">w</span><span class="op" id="7082979">.</span><span class="ident" id="7082980">WriteHeader</span><span class="op" id="7082991">(</span><span class="num" id="7082992">202</span><span class="op" id="7082995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083001">w</span><span class="op" id="7083002">.</span><span class="ident" id="7083003">Write</span><span class="op" id="7083008">(</span><span class="op" id="7083009">[</span><span class="op" id="7083010">]</span><span class="builtintype" id="7083011">byte</span><span class="op" id="7083015">(</span><span class="string" id="7083016">&#34;hi&#34;</span><span class="op" id="7083020">)</span><span class="op" id="7083021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7083026">}</span><span class="op" id="7083027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083032">check</span><span class="op" id="7083037">(</span><span class="ident" id="7083038">hasStatus</span><span class="op" id="7083047">(</span><span class="num" id="7083048">201</span><span class="op" id="7083051">)</span><span class="op" id="7083052">,</span>&nbsp;<span class="ident" id="7083054">hasContents</span><span class="op" id="7083065">(</span><span class="string" id="7083066">&#34;hi&#34;</span><span class="op" id="7083070">)</span><span class="op" id="7083071">)</span><span class="op" id="7083072">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7083076">}</span><span class="op" id="7083077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7083081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7083086">&#34;write&nbsp;sends&nbsp;200&#34;</span><span class="op" id="7083103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7083108">func</span><span class="op" id="7083112">(</span><span class="ident" id="7083113">w</span>&nbsp;<span class="ident" id="7083115">http</span><span class="op" id="7083119">.</span><span class="ident" id="7083120">ResponseWriter</span><span class="op" id="7083134">,</span>&nbsp;<span class="ident" id="7083136">r</span>&nbsp;<span class="op" id="7083138">*</span><span class="ident" id="7083139">http</span><span class="op" id="7083143">.</span><span class="ident" id="7083144">Request</span><span class="op" id="7083151">)</span>&nbsp;<span class="op" id="7083153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083159">w</span><span class="op" id="7083160">.</span><span class="ident" id="7083161">Write</span><span class="op" id="7083166">(</span><span class="op" id="7083167">[</span><span class="op" id="7083168">]</span><span class="builtintype" id="7083169">byte</span><span class="op" id="7083173">(</span><span class="string" id="7083174">&#34;hi&nbsp;first&#34;</span><span class="op" id="7083184">)</span><span class="op" id="7083185">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083191">w</span><span class="op" id="7083192">.</span><span class="ident" id="7083193">WriteHeader</span><span class="op" id="7083204">(</span><span class="num" id="7083205">201</span><span class="op" id="7083208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083214">w</span><span class="op" id="7083215">.</span><span class="ident" id="7083216">WriteHeader</span><span class="op" id="7083227">(</span><span class="num" id="7083228">202</span><span class="op" id="7083231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7083236">}</span><span class="op" id="7083237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083242">check</span><span class="op" id="7083247">(</span><span class="ident" id="7083248">hasStatus</span><span class="op" id="7083257">(</span><span class="num" id="7083258">200</span><span class="op" id="7083261">)</span><span class="op" id="7083262">,</span>&nbsp;<span class="ident" id="7083264">hasContents</span><span class="op" id="7083275">(</span><span class="string" id="7083276">&#34;hi&nbsp;first&#34;</span><span class="op" id="7083286">)</span><span class="op" id="7083287">,</span>&nbsp;<span class="ident" id="7083289">hasFlush</span><span class="op" id="7083297">(</span><span class="builtintype" id="7083298">false</span><span class="op" id="7083303">)</span><span class="op" id="7083304">)</span><span class="op" id="7083305">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7083309">}</span><span class="op" id="7083310">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7083314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7083319">&#34;flush&#34;</span><span class="op" id="7083326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7083331">func</span><span class="op" id="7083335">(</span><span class="ident" id="7083336">w</span>&nbsp;<span class="ident" id="7083338">http</span><span class="op" id="7083342">.</span><span class="ident" id="7083343">ResponseWriter</span><span class="op" id="7083357">,</span>&nbsp;<span class="ident" id="7083359">r</span>&nbsp;<span class="op" id="7083361">*</span><span class="ident" id="7083362">http</span><span class="op" id="7083366">.</span><span class="ident" id="7083367">Request</span><span class="op" id="7083374">)</span>&nbsp;<span class="op" id="7083376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083382">w</span><span class="op" id="7083383">.</span><span class="op" id="7083384">(</span><span class="ident" id="7083385">http</span><span class="op" id="7083389">.</span><span class="ident" id="7083390">Flusher</span><span class="op" id="7083397">)</span><span class="op" id="7083398">.</span><span class="ident" id="7083399">Flush</span><span class="op" id="7083404">(</span><span class="op" id="7083405">)</span>&nbsp;<span class="comment" id="7083407">//&nbsp;also&nbsp;sends&nbsp;a&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083431">w</span><span class="op" id="7083432">.</span><span class="ident" id="7083433">WriteHeader</span><span class="op" id="7083444">(</span><span class="num" id="7083445">201</span><span class="op" id="7083448">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7083453">}</span><span class="op" id="7083454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083459">check</span><span class="op" id="7083464">(</span><span class="ident" id="7083465">hasStatus</span><span class="op" id="7083474">(</span><span class="num" id="7083475">200</span><span class="op" id="7083478">)</span><span class="op" id="7083479">,</span>&nbsp;<span class="ident" id="7083481">hasFlush</span><span class="op" id="7083489">(</span><span class="builtintype" id="7083490">true</span><span class="op" id="7083494">)</span><span class="op" id="7083495">)</span><span class="op" id="7083496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7083500">}</span><span class="op" id="7083501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7083504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083507">r</span><span class="op" id="7083508">,</span>&nbsp;<span class="ident" id="7083510">_</span>&nbsp;<span class="op" id="7083512">:=</span>&nbsp;<span class="ident" id="7083515">http</span><span class="op" id="7083519">.</span><span class="ident" id="7083520">NewRequest</span><span class="op" id="7083530">(</span><span class="string" id="7083531">&#34;GET&#34;</span><span class="op" id="7083536">,</span>&nbsp;<span class="string" id="7083538">&#34;http://foo.com/&#34;</span><span class="op" id="7083555">,</span>&nbsp;<span class="ident" id="7083557">nil</span><span class="op" id="7083560">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7083563">for</span>&nbsp;<span class="ident" id="7083567">_</span><span class="op" id="7083568">,</span>&nbsp;<span class="ident" id="7083570">tt</span>&nbsp;<span class="op" id="7083573">:=</span>&nbsp;<span class="keyword" id="7083576">range</span>&nbsp;<span class="ident" id="7083582">tests</span>&nbsp;<span class="op" id="7083588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083592">h</span>&nbsp;<span class="op" id="7083594">:=</span>&nbsp;<span class="ident" id="7083597">http</span><span class="op" id="7083601">.</span><span class="ident" id="7083602">HandlerFunc</span><span class="op" id="7083613">(</span><span class="ident" id="7083614">tt</span><span class="op" id="7083616">.</span><span class="ident" id="7083617">h</span><span class="op" id="7083618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083622">rec</span>&nbsp;<span class="op" id="7083626">:=</span>&nbsp;<span class="ident" id="7083629">NewRecorder</span><span class="op" id="7083640">(</span><span class="op" id="7083641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083645">h</span><span class="op" id="7083646">.</span><span class="ident" id="7083647">ServeHTTP</span><span class="op" id="7083656">(</span><span class="ident" id="7083657">rec</span><span class="op" id="7083660">,</span>&nbsp;<span class="ident" id="7083662">r</span><span class="op" id="7083663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7083667">for</span>&nbsp;<span class="ident" id="7083671">_</span><span class="op" id="7083672">,</span>&nbsp;<span class="ident" id="7083674">check</span>&nbsp;<span class="op" id="7083680">:=</span>&nbsp;<span class="keyword" id="7083683">range</span>&nbsp;<span class="ident" id="7083689">tt</span><span class="op" id="7083691">.</span><span class="ident" id="7083692">checks</span>&nbsp;<span class="op" id="7083699">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7083704">if</span>&nbsp;<span class="ident" id="7083707">err</span>&nbsp;<span class="op" id="7083711">:=</span>&nbsp;<span class="ident" id="7083714">check</span><span class="op" id="7083719">(</span><span class="ident" id="7083720">rec</span><span class="op" id="7083723">)</span><span class="op" id="7083724">;</span>&nbsp;<span class="ident" id="7083726">err</span>&nbsp;<span class="op" id="7083730">!=</span>&nbsp;<span class="ident" id="7083733">nil</span>&nbsp;<span class="op" id="7083737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7083743">t</span><span class="op" id="7083744">.</span><span class="ident" id="7083745">Errorf</span><span class="op" id="7083751">(</span><span class="string" id="7083752">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7083760">,</span>&nbsp;<span class="ident" id="7083762">tt</span><span class="op" id="7083764">.</span><span class="ident" id="7083765">name</span><span class="op" id="7083769">,</span>&nbsp;<span class="ident" id="7083771">err</span><span class="op" id="7083774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7083779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7083783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7083786">}</span><br>
<span class="lineno">90</span><span class="op" id="7083788">}</span>
</div>
</body>
</html>
