<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8272868">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8272923">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8272977">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8273028">package</span>&nbsp;<span class="ident" id="8273036">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8273041">import</span>&nbsp;<span class="op" id="8273048">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8273051">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8273057">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8273070">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8273076">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8273087">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8273098">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8273105">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8273108">func</span>&nbsp;<span class="ident" id="8273113">TestShutdown</span><span class="op" id="8273125">(</span><span class="ident" id="8273126">t</span>&nbsp;<span class="op" id="8273128">*</span><span class="ident" id="8273129">testing</span><span class="op" id="8273136">.</span><span class="ident" id="8273137">T</span><span class="op" id="8273138">)</span>&nbsp;<span class="op" id="8273140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8273143">if</span>&nbsp;<span class="ident" id="8273146">runtime</span><span class="op" id="8273153">.</span><span class="ident" id="8273154">GOOS</span>&nbsp;<span class="op" id="8273159">==</span>&nbsp;<span class="string" id="8273162">&#34;plan9&#34;</span>&nbsp;<span class="op" id="8273170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8273174">t</span><span class="op" id="8273175">.</span><span class="ident" id="8273176">Skipf</span><span class="op" id="8273181">(</span><span class="string" id="8273182">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8273203">,</span>&nbsp;<span class="ident" id="8273205">runtime</span><span class="op" id="8273212">.</span><span class="ident" id="8273213">GOOS</span><span class="op" id="8273217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8273220">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8273223">ln</span><span class="op" id="8273225">,</span>&nbsp;<span class="ident" id="8273227">err</span>&nbsp;<span class="op" id="8273231">:=</span>&nbsp;<span class="ident" id="8273234">Listen</span><span class="op" id="8273240">(</span><span class="string" id="8273241">&#34;tcp&#34;</span><span class="op" id="8273246">,</span>&nbsp;<span class="string" id="8273248">&#34;127.0.0.1:0&#34;</span><span class="op" id="8273261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8273264">if</span>&nbsp;<span class="ident" id="8273267">err</span>&nbsp;<span class="op" id="8273271">!=</span>&nbsp;<span class="ident" id="8273274">nil</span>&nbsp;<span class="op" id="8273278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8273282">if</span>&nbsp;<span class="ident" id="8273285">ln</span><span class="op" id="8273287">,</span>&nbsp;<span class="ident" id="8273289">err</span>&nbsp;<span class="op" id="8273293">=</span>&nbsp;<span class="ident" id="8273295">Listen</span><span class="op" id="8273301">(</span><span class="string" id="8273302">&#34;tcp6&#34;</span><span class="op" id="8273308">,</span>&nbsp;<span class="string" id="8273310">&#34;[::1]:0&#34;</span><span class="op" id="8273319">)</span><span class="op" id="8273320">;</span>&nbsp;<span class="ident" id="8273322">err</span>&nbsp;<span class="op" id="8273326">!=</span>&nbsp;<span class="ident" id="8273329">nil</span>&nbsp;<span class="op" id="8273333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8273338">t</span><span class="op" id="8273339">.</span><span class="ident" id="8273340">Fatalf</span><span class="op" id="8273346">(</span><span class="string" id="8273347">&#34;ListenTCP&nbsp;on&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="8273368">,</span>&nbsp;<span class="ident" id="8273370">err</span><span class="op" id="8273373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8273377">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8273380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8273384">go</span>&nbsp;<span class="keyword" id="8273387">func</span><span class="op" id="8273391">(</span><span class="op" id="8273392">)</span>&nbsp;<span class="op" id="8273394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8273398">defer</span>&nbsp;<span class="ident" id="8273404">ln</span><span class="op" id="8273406">.</span><span class="ident" id="8273407">Close</span><span class="op" id="8273412">(</span><span class="op" id="8273413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8273417">c</span><span class="op" id="8273418">,</span>&nbsp;<span class="ident" id="8273420">err</span>&nbsp;<span class="op" id="8273424">:=</span>&nbsp;<span class="ident" id="8273427">ln</span><span class="op" id="8273429">.</span><span class="ident" id="8273430">Accept</span><span class="op" id="8273436">(</span><span class="op" id="8273437">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8273441">if</span>&nbsp;<span class="ident" id="8273444">err</span>&nbsp;<span class="op" id="8273448">!=</span>&nbsp;<span class="ident" id="8273451">nil</span>&nbsp;<span class="op" id="8273455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8273460">t</span><span class="op" id="8273461">.</span><span class="ident" id="8273462">Errorf</span><span class="op" id="8273468">(</span><span class="string" id="8273469">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="8273481">,</span>&nbsp;<span class="ident" id="8273483">err</span><span class="op" id="8273486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8273491">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8273500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8273504">var</span>&nbsp;<span class="ident" id="8273508">buf</span>&nbsp;<span class="op" id="8273512">[</span><span class="num" id="8273513">10</span><span class="op" id="8273515">]</span><span class="builtintype" id="8273516">byte</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8273523">n</span><span class="op" id="8273524">,</span>&nbsp;<span class="ident" id="8273526">err</span>&nbsp;<span class="op" id="8273530">:=</span>&nbsp;<span class="ident" id="8273533">c</span><span class="op" id="8273534">.</span><span class="ident" id="8273535">Read</span><span class="op" id="8273539">(</span><span class="ident" id="8273540">buf</span><span class="op" id="8273543">[</span><span class="op" id="8273544">:</span><span class="op" id="8273545">]</span><span class="op" id="8273546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8273550">if</span>&nbsp;<span class="ident" id="8273553">n</span>&nbsp;<span class="op" id="8273555">!=</span>&nbsp;<span class="num" id="8273558">0</span>&nbsp;<span class="op" id="8273560">||</span>&nbsp;<span class="ident" id="8273563">err</span>&nbsp;<span class="op" id="8273567">!=</span>&nbsp;<span class="ident" id="8273570">io</span><span class="op" id="8273572">.</span><span class="ident" id="8273573">EOF</span>&nbsp;<span class="op" id="8273577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8273582">t</span><span class="op" id="8273583">.</span><span class="ident" id="8273584">Errorf</span><span class="op" id="8273590">(</span><span class="string" id="8273591">&#34;server&nbsp;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;0,&nbsp;io.EOF&#34;</span><span class="op" id="8273629">,</span>&nbsp;<span class="ident" id="8273631">n</span><span class="op" id="8273632">,</span>&nbsp;<span class="ident" id="8273634">err</span><span class="op" id="8273637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8273642">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8273651">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8273655">c</span><span class="op" id="8273656">.</span><span class="ident" id="8273657">Write</span><span class="op" id="8273662">(</span><span class="op" id="8273663">[</span><span class="op" id="8273664">]</span><span class="builtintype" id="8273665">byte</span><span class="op" id="8273669">(</span><span class="string" id="8273670">&#34;response&#34;</span><span class="op" id="8273680">)</span><span class="op" id="8273681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8273685">c</span><span class="op" id="8273686">.</span><span class="ident" id="8273687">Close</span><span class="op" id="8273692">(</span><span class="op" id="8273693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8273696">}</span><span class="op" id="8273697">(</span><span class="op" id="8273698">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8273702">c</span><span class="op" id="8273703">,</span>&nbsp;<span class="ident" id="8273705">err</span>&nbsp;<span class="op" id="8273709">:=</span>&nbsp;<span class="ident" id="8273712">Dial</span><span class="op" id="8273716">(</span><span class="string" id="8273717">&#34;tcp&#34;</span><span class="op" id="8273722">,</span>&nbsp;<span class="ident" id="8273724">ln</span><span class="op" id="8273726">.</span><span class="ident" id="8273727">Addr</span><span class="op" id="8273731">(</span><span class="op" id="8273732">)</span><span class="op" id="8273733">.</span><span class="ident" id="8273734">String</span><span class="op" id="8273740">(</span><span class="op" id="8273741">)</span><span class="op" id="8273742">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8273745">if</span>&nbsp;<span class="ident" id="8273748">err</span>&nbsp;<span class="op" id="8273752">!=</span>&nbsp;<span class="ident" id="8273755">nil</span>&nbsp;<span class="op" id="8273759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8273763">t</span><span class="op" id="8273764">.</span><span class="ident" id="8273765">Fatalf</span><span class="op" id="8273771">(</span><span class="string" id="8273772">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8273782">,</span>&nbsp;<span class="ident" id="8273784">err</span><span class="op" id="8273787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8273790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8273793">defer</span>&nbsp;<span class="ident" id="8273799">c</span><span class="op" id="8273800">.</span><span class="ident" id="8273801">Close</span><span class="op" id="8273806">(</span><span class="op" id="8273807">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8273811">err</span>&nbsp;<span class="op" id="8273815">=</span>&nbsp;<span class="ident" id="8273817">c</span><span class="op" id="8273818">.</span><span class="op" id="8273819">(</span><span class="op" id="8273820">*</span><span class="ident" id="8273821">TCPConn</span><span class="op" id="8273828">)</span><span class="op" id="8273829">.</span><span class="ident" id="8273830">CloseWrite</span><span class="op" id="8273840">(</span><span class="op" id="8273841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8273844">if</span>&nbsp;<span class="ident" id="8273847">err</span>&nbsp;<span class="op" id="8273851">!=</span>&nbsp;<span class="ident" id="8273854">nil</span>&nbsp;<span class="op" id="8273858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8273862">t</span><span class="op" id="8273863">.</span><span class="ident" id="8273864">Fatalf</span><span class="op" id="8273870">(</span><span class="string" id="8273871">&#34;CloseWrite:&nbsp;%v&#34;</span><span class="op" id="8273887">,</span>&nbsp;<span class="ident" id="8273889">err</span><span class="op" id="8273892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8273895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8273898">var</span>&nbsp;<span class="ident" id="8273902">buf</span>&nbsp;<span class="op" id="8273906">[</span><span class="num" id="8273907">10</span><span class="op" id="8273909">]</span><span class="builtintype" id="8273910">byte</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8273916">n</span><span class="op" id="8273917">,</span>&nbsp;<span class="ident" id="8273919">err</span>&nbsp;<span class="op" id="8273923">:=</span>&nbsp;<span class="ident" id="8273926">c</span><span class="op" id="8273927">.</span><span class="ident" id="8273928">Read</span><span class="op" id="8273932">(</span><span class="ident" id="8273933">buf</span><span class="op" id="8273936">[</span><span class="op" id="8273937">:</span><span class="op" id="8273938">]</span><span class="op" id="8273939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8273942">if</span>&nbsp;<span class="ident" id="8273945">err</span>&nbsp;<span class="op" id="8273949">!=</span>&nbsp;<span class="ident" id="8273952">nil</span>&nbsp;<span class="op" id="8273956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8273960">t</span><span class="op" id="8273961">.</span><span class="ident" id="8273962">Fatalf</span><span class="op" id="8273968">(</span><span class="string" id="8273969">&#34;client&nbsp;Read:&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="8273990">,</span>&nbsp;<span class="ident" id="8273992">n</span><span class="op" id="8273993">,</span>&nbsp;<span class="ident" id="8273995">err</span><span class="op" id="8273998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8274001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274004">got</span>&nbsp;<span class="op" id="8274008">:=</span>&nbsp;<span class="builtintype" id="8274011">string</span><span class="op" id="8274017">(</span><span class="ident" id="8274018">buf</span><span class="op" id="8274021">[</span><span class="op" id="8274022">:</span><span class="ident" id="8274023">n</span><span class="op" id="8274024">]</span><span class="op" id="8274025">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8274028">if</span>&nbsp;<span class="ident" id="8274031">got</span>&nbsp;<span class="op" id="8274035">!=</span>&nbsp;<span class="string" id="8274038">&#34;response&#34;</span>&nbsp;<span class="op" id="8274049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274053">t</span><span class="op" id="8274054">.</span><span class="ident" id="8274055">Errorf</span><span class="op" id="8274061">(</span><span class="string" id="8274062">&#34;read&nbsp;=&nbsp;%q,&nbsp;want&nbsp;\&#34;response\&#34;&#34;</span><span class="op" id="8274092">,</span>&nbsp;<span class="ident" id="8274094">got</span><span class="op" id="8274097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8274100">}</span><br>
<span class="lineno"></span><span class="op" id="8274102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="8274105">func</span>&nbsp;<span class="ident" id="8274110">TestShutdownUnix</span><span class="op" id="8274126">(</span><span class="ident" id="8274127">t</span>&nbsp;<span class="op" id="8274129">*</span><span class="ident" id="8274130">testing</span><span class="op" id="8274137">.</span><span class="ident" id="8274138">T</span><span class="op" id="8274139">)</span>&nbsp;<span class="op" id="8274141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8274144">switch</span>&nbsp;<span class="ident" id="8274151">runtime</span><span class="op" id="8274158">.</span><span class="ident" id="8274159">GOOS</span>&nbsp;<span class="op" id="8274164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8274167">case</span>&nbsp;<span class="string" id="8274172">&#34;nacl&#34;</span><span class="op" id="8274178">,</span>&nbsp;<span class="string" id="8274180">&#34;plan9&#34;</span><span class="op" id="8274187">,</span>&nbsp;<span class="string" id="8274189">&#34;windows&#34;</span><span class="op" id="8274198">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274202">t</span><span class="op" id="8274203">.</span><span class="ident" id="8274204">Skipf</span><span class="op" id="8274209">(</span><span class="string" id="8274210">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8274231">,</span>&nbsp;<span class="ident" id="8274233">runtime</span><span class="op" id="8274240">.</span><span class="ident" id="8274241">GOOS</span><span class="op" id="8274245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8274248">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274251">f</span><span class="op" id="8274252">,</span>&nbsp;<span class="ident" id="8274254">err</span>&nbsp;<span class="op" id="8274258">:=</span>&nbsp;<span class="ident" id="8274261">ioutil</span><span class="op" id="8274267">.</span><span class="ident" id="8274268">TempFile</span><span class="op" id="8274276">(</span><span class="string" id="8274277">&#34;&#34;</span><span class="op" id="8274279">,</span>&nbsp;<span class="string" id="8274281">&#34;go_net_unixtest&#34;</span><span class="op" id="8274298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8274301">if</span>&nbsp;<span class="ident" id="8274304">err</span>&nbsp;<span class="op" id="8274308">!=</span>&nbsp;<span class="ident" id="8274311">nil</span>&nbsp;<span class="op" id="8274315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274319">t</span><span class="op" id="8274320">.</span><span class="ident" id="8274321">Fatalf</span><span class="op" id="8274327">(</span><span class="string" id="8274328">&#34;TempFile:&nbsp;%s&#34;</span><span class="op" id="8274342">,</span>&nbsp;<span class="ident" id="8274344">err</span><span class="op" id="8274347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8274350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274353">f</span><span class="op" id="8274354">.</span><span class="ident" id="8274355">Close</span><span class="op" id="8274360">(</span><span class="op" id="8274361">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274364">tmpname</span>&nbsp;<span class="op" id="8274372">:=</span>&nbsp;<span class="ident" id="8274375">f</span><span class="op" id="8274376">.</span><span class="ident" id="8274377">Name</span><span class="op" id="8274381">(</span><span class="op" id="8274382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274385">os</span><span class="op" id="8274387">.</span><span class="ident" id="8274388">Remove</span><span class="op" id="8274394">(</span><span class="ident" id="8274395">tmpname</span><span class="op" id="8274402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274405">ln</span><span class="op" id="8274407">,</span>&nbsp;<span class="ident" id="8274409">err</span>&nbsp;<span class="op" id="8274413">:=</span>&nbsp;<span class="ident" id="8274416">Listen</span><span class="op" id="8274422">(</span><span class="string" id="8274423">&#34;unix&#34;</span><span class="op" id="8274429">,</span>&nbsp;<span class="ident" id="8274431">tmpname</span><span class="op" id="8274438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8274441">if</span>&nbsp;<span class="ident" id="8274444">err</span>&nbsp;<span class="op" id="8274448">!=</span>&nbsp;<span class="ident" id="8274451">nil</span>&nbsp;<span class="op" id="8274455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274459">t</span><span class="op" id="8274460">.</span><span class="ident" id="8274461">Fatalf</span><span class="op" id="8274467">(</span><span class="string" id="8274468">&#34;ListenUnix&nbsp;on&nbsp;%s:&nbsp;%s&#34;</span><span class="op" id="8274490">,</span>&nbsp;<span class="ident" id="8274492">tmpname</span><span class="op" id="8274499">,</span>&nbsp;<span class="ident" id="8274501">err</span><span class="op" id="8274504">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8274507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8274510">defer</span>&nbsp;<span class="keyword" id="8274516">func</span><span class="op" id="8274520">(</span><span class="op" id="8274521">)</span>&nbsp;<span class="op" id="8274523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274527">ln</span><span class="op" id="8274529">.</span><span class="ident" id="8274530">Close</span><span class="op" id="8274535">(</span><span class="op" id="8274536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274540">os</span><span class="op" id="8274542">.</span><span class="ident" id="8274543">Remove</span><span class="op" id="8274549">(</span><span class="ident" id="8274550">tmpname</span><span class="op" id="8274557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8274560">}</span><span class="op" id="8274561">(</span><span class="op" id="8274562">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8274566">go</span>&nbsp;<span class="keyword" id="8274569">func</span><span class="op" id="8274573">(</span><span class="op" id="8274574">)</span>&nbsp;<span class="op" id="8274576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274580">c</span><span class="op" id="8274581">,</span>&nbsp;<span class="ident" id="8274583">err</span>&nbsp;<span class="op" id="8274587">:=</span>&nbsp;<span class="ident" id="8274590">ln</span><span class="op" id="8274592">.</span><span class="ident" id="8274593">Accept</span><span class="op" id="8274599">(</span><span class="op" id="8274600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8274604">if</span>&nbsp;<span class="ident" id="8274607">err</span>&nbsp;<span class="op" id="8274611">!=</span>&nbsp;<span class="ident" id="8274614">nil</span>&nbsp;<span class="op" id="8274618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274623">t</span><span class="op" id="8274624">.</span><span class="ident" id="8274625">Errorf</span><span class="op" id="8274631">(</span><span class="string" id="8274632">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="8274644">,</span>&nbsp;<span class="ident" id="8274646">err</span><span class="op" id="8274649">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8274654">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8274663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8274667">var</span>&nbsp;<span class="ident" id="8274671">buf</span>&nbsp;<span class="op" id="8274675">[</span><span class="num" id="8274676">10</span><span class="op" id="8274678">]</span><span class="builtintype" id="8274679">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274686">n</span><span class="op" id="8274687">,</span>&nbsp;<span class="ident" id="8274689">err</span>&nbsp;<span class="op" id="8274693">:=</span>&nbsp;<span class="ident" id="8274696">c</span><span class="op" id="8274697">.</span><span class="ident" id="8274698">Read</span><span class="op" id="8274702">(</span><span class="ident" id="8274703">buf</span><span class="op" id="8274706">[</span><span class="op" id="8274707">:</span><span class="op" id="8274708">]</span><span class="op" id="8274709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8274713">if</span>&nbsp;<span class="ident" id="8274716">n</span>&nbsp;<span class="op" id="8274718">!=</span>&nbsp;<span class="num" id="8274721">0</span>&nbsp;<span class="op" id="8274723">||</span>&nbsp;<span class="ident" id="8274726">err</span>&nbsp;<span class="op" id="8274730">!=</span>&nbsp;<span class="ident" id="8274733">io</span><span class="op" id="8274735">.</span><span class="ident" id="8274736">EOF</span>&nbsp;<span class="op" id="8274740">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274745">t</span><span class="op" id="8274746">.</span><span class="ident" id="8274747">Errorf</span><span class="op" id="8274753">(</span><span class="string" id="8274754">&#34;server&nbsp;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;0,&nbsp;io.EOF&#34;</span><span class="op" id="8274792">,</span>&nbsp;<span class="ident" id="8274794">n</span><span class="op" id="8274795">,</span>&nbsp;<span class="ident" id="8274797">err</span><span class="op" id="8274800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8274805">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8274814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274818">c</span><span class="op" id="8274819">.</span><span class="ident" id="8274820">Write</span><span class="op" id="8274825">(</span><span class="op" id="8274826">[</span><span class="op" id="8274827">]</span><span class="builtintype" id="8274828">byte</span><span class="op" id="8274832">(</span><span class="string" id="8274833">&#34;response&#34;</span><span class="op" id="8274843">)</span><span class="op" id="8274844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274848">c</span><span class="op" id="8274849">.</span><span class="ident" id="8274850">Close</span><span class="op" id="8274855">(</span><span class="op" id="8274856">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8274859">}</span><span class="op" id="8274860">(</span><span class="op" id="8274861">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274865">c</span><span class="op" id="8274866">,</span>&nbsp;<span class="ident" id="8274868">err</span>&nbsp;<span class="op" id="8274872">:=</span>&nbsp;<span class="ident" id="8274875">Dial</span><span class="op" id="8274879">(</span><span class="string" id="8274880">&#34;unix&#34;</span><span class="op" id="8274886">,</span>&nbsp;<span class="ident" id="8274888">tmpname</span><span class="op" id="8274895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8274898">if</span>&nbsp;<span class="ident" id="8274901">err</span>&nbsp;<span class="op" id="8274905">!=</span>&nbsp;<span class="ident" id="8274908">nil</span>&nbsp;<span class="op" id="8274912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274916">t</span><span class="op" id="8274917">.</span><span class="ident" id="8274918">Fatalf</span><span class="op" id="8274924">(</span><span class="string" id="8274925">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8274935">,</span>&nbsp;<span class="ident" id="8274937">err</span><span class="op" id="8274940">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8274943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8274946">defer</span>&nbsp;<span class="ident" id="8274952">c</span><span class="op" id="8274953">.</span><span class="ident" id="8274954">Close</span><span class="op" id="8274959">(</span><span class="op" id="8274960">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8274964">err</span>&nbsp;<span class="op" id="8274968">=</span>&nbsp;<span class="ident" id="8274970">c</span><span class="op" id="8274971">.</span><span class="op" id="8274972">(</span><span class="op" id="8274973">*</span><span class="ident" id="8274974">UnixConn</span><span class="op" id="8274982">)</span><span class="op" id="8274983">.</span><span class="ident" id="8274984">CloseWrite</span><span class="op" id="8274994">(</span><span class="op" id="8274995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8274998">if</span>&nbsp;<span class="ident" id="8275001">err</span>&nbsp;<span class="op" id="8275005">!=</span>&nbsp;<span class="ident" id="8275008">nil</span>&nbsp;<span class="op" id="8275012">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275016">t</span><span class="op" id="8275017">.</span><span class="ident" id="8275018">Fatalf</span><span class="op" id="8275024">(</span><span class="string" id="8275025">&#34;CloseWrite:&nbsp;%v&#34;</span><span class="op" id="8275041">,</span>&nbsp;<span class="ident" id="8275043">err</span><span class="op" id="8275046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8275049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8275052">var</span>&nbsp;<span class="ident" id="8275056">buf</span>&nbsp;<span class="op" id="8275060">[</span><span class="num" id="8275061">10</span><span class="op" id="8275063">]</span><span class="builtintype" id="8275064">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275070">n</span><span class="op" id="8275071">,</span>&nbsp;<span class="ident" id="8275073">err</span>&nbsp;<span class="op" id="8275077">:=</span>&nbsp;<span class="ident" id="8275080">c</span><span class="op" id="8275081">.</span><span class="ident" id="8275082">Read</span><span class="op" id="8275086">(</span><span class="ident" id="8275087">buf</span><span class="op" id="8275090">[</span><span class="op" id="8275091">:</span><span class="op" id="8275092">]</span><span class="op" id="8275093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8275096">if</span>&nbsp;<span class="ident" id="8275099">err</span>&nbsp;<span class="op" id="8275103">!=</span>&nbsp;<span class="ident" id="8275106">nil</span>&nbsp;<span class="op" id="8275110">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275114">t</span><span class="op" id="8275115">.</span><span class="ident" id="8275116">Fatalf</span><span class="op" id="8275122">(</span><span class="string" id="8275123">&#34;client&nbsp;Read:&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="8275144">,</span>&nbsp;<span class="ident" id="8275146">n</span><span class="op" id="8275147">,</span>&nbsp;<span class="ident" id="8275149">err</span><span class="op" id="8275152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8275155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275158">got</span>&nbsp;<span class="op" id="8275162">:=</span>&nbsp;<span class="builtintype" id="8275165">string</span><span class="op" id="8275171">(</span><span class="ident" id="8275172">buf</span><span class="op" id="8275175">[</span><span class="op" id="8275176">:</span><span class="ident" id="8275177">n</span><span class="op" id="8275178">]</span><span class="op" id="8275179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8275182">if</span>&nbsp;<span class="ident" id="8275185">got</span>&nbsp;<span class="op" id="8275189">!=</span>&nbsp;<span class="string" id="8275192">&#34;response&#34;</span>&nbsp;<span class="op" id="8275203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275207">t</span><span class="op" id="8275208">.</span><span class="ident" id="8275209">Errorf</span><span class="op" id="8275215">(</span><span class="string" id="8275216">&#34;read&nbsp;=&nbsp;%q,&nbsp;want&nbsp;\&#34;response\&#34;&#34;</span><span class="op" id="8275246">,</span>&nbsp;<span class="ident" id="8275248">got</span><span class="op" id="8275251">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8275254">}</span><br>
<span class="lineno"></span><span class="op" id="8275256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8275259">func</span>&nbsp;<span class="ident" id="8275264">TestTCPListenClose</span><span class="op" id="8275282">(</span><span class="ident" id="8275283">t</span>&nbsp;<span class="op" id="8275285">*</span><span class="ident" id="8275286">testing</span><span class="op" id="8275293">.</span><span class="ident" id="8275294">T</span><span class="op" id="8275295">)</span>&nbsp;<span class="op" id="8275297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275300">ln</span><span class="op" id="8275302">,</span>&nbsp;<span class="ident" id="8275304">err</span>&nbsp;<span class="op" id="8275308">:=</span>&nbsp;<span class="ident" id="8275311">Listen</span><span class="op" id="8275317">(</span><span class="string" id="8275318">&#34;tcp&#34;</span><span class="op" id="8275323">,</span>&nbsp;<span class="string" id="8275325">&#34;127.0.0.1:0&#34;</span><span class="op" id="8275338">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8275341">if</span>&nbsp;<span class="ident" id="8275344">err</span>&nbsp;<span class="op" id="8275348">!=</span>&nbsp;<span class="ident" id="8275351">nil</span>&nbsp;<span class="op" id="8275355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275359">t</span><span class="op" id="8275360">.</span><span class="ident" id="8275361">Fatalf</span><span class="op" id="8275367">(</span><span class="string" id="8275368">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8275387">,</span>&nbsp;<span class="ident" id="8275389">err</span><span class="op" id="8275392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8275395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275399">done</span>&nbsp;<span class="op" id="8275404">:=</span>&nbsp;<span class="builtinfunc" id="8275407">make</span><span class="op" id="8275411">(</span><span class="keyword" id="8275412">chan</span>&nbsp;<span class="builtintype" id="8275417">bool</span><span class="op" id="8275421">,</span>&nbsp;<span class="num" id="8275423">1</span><span class="op" id="8275424">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8275427">go</span>&nbsp;<span class="keyword" id="8275430">func</span><span class="op" id="8275434">(</span><span class="op" id="8275435">)</span>&nbsp;<span class="op" id="8275437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275441">time</span><span class="op" id="8275445">.</span><span class="ident" id="8275446">Sleep</span><span class="op" id="8275451">(</span><span class="num" id="8275452">100</span>&nbsp;<span class="op" id="8275456">*</span>&nbsp;<span class="ident" id="8275458">time</span><span class="op" id="8275462">.</span><span class="ident" id="8275463">Millisecond</span><span class="op" id="8275474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275478">ln</span><span class="op" id="8275480">.</span><span class="ident" id="8275481">Close</span><span class="op" id="8275486">(</span><span class="op" id="8275487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8275490">}</span><span class="op" id="8275491">(</span><span class="op" id="8275492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8275495">go</span>&nbsp;<span class="keyword" id="8275498">func</span><span class="op" id="8275502">(</span><span class="op" id="8275503">)</span>&nbsp;<span class="op" id="8275505">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275509">c</span><span class="op" id="8275510">,</span>&nbsp;<span class="ident" id="8275512">err</span>&nbsp;<span class="op" id="8275516">:=</span>&nbsp;<span class="ident" id="8275519">ln</span><span class="op" id="8275521">.</span><span class="ident" id="8275522">Accept</span><span class="op" id="8275528">(</span><span class="op" id="8275529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8275533">if</span>&nbsp;<span class="ident" id="8275536">err</span>&nbsp;<span class="op" id="8275540">==</span>&nbsp;<span class="ident" id="8275543">nil</span>&nbsp;<span class="op" id="8275547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275552">c</span><span class="op" id="8275553">.</span><span class="ident" id="8275554">Close</span><span class="op" id="8275559">(</span><span class="op" id="8275560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275565">t</span><span class="op" id="8275566">.</span><span class="ident" id="8275567">Error</span><span class="op" id="8275572">(</span><span class="string" id="8275573">&#34;Accept&nbsp;succeeded&#34;</span><span class="op" id="8275591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8275595">}</span>&nbsp;<span class="keyword" id="8275597">else</span>&nbsp;<span class="op" id="8275602">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275607">t</span><span class="op" id="8275608">.</span><span class="ident" id="8275609">Logf</span><span class="op" id="8275613">(</span><span class="string" id="8275614">&#34;Accept&nbsp;timeout&nbsp;error:&nbsp;%s&nbsp;(any&nbsp;error&nbsp;is&nbsp;fine)&#34;</span><span class="op" id="8275660">,</span>&nbsp;<span class="ident" id="8275662">err</span><span class="op" id="8275665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8275669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275673">done</span>&nbsp;<span class="op" id="8275678">&lt;-</span>&nbsp;<span class="builtintype" id="8275681">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8275687">}</span><span class="op" id="8275688">(</span><span class="op" id="8275689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8275692">select</span>&nbsp;<span class="op" id="8275699">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8275702">case</span>&nbsp;<span class="op" id="8275707">&lt;-</span><span class="ident" id="8275709">done</span><span class="op" id="8275713">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8275716">case</span>&nbsp;<span class="op" id="8275721">&lt;-</span><span class="ident" id="8275723">time</span><span class="op" id="8275727">.</span><span class="ident" id="8275728">After</span><span class="op" id="8275733">(</span><span class="num" id="8275734">2</span>&nbsp;<span class="op" id="8275736">*</span>&nbsp;<span class="ident" id="8275738">time</span><span class="op" id="8275742">.</span><span class="ident" id="8275743">Second</span><span class="op" id="8275749">)</span><span class="op" id="8275750">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275754">t</span><span class="op" id="8275755">.</span><span class="ident" id="8275756">Fatal</span><span class="op" id="8275761">(</span><span class="string" id="8275762">&#34;timeout&nbsp;waiting&nbsp;for&nbsp;TCP&nbsp;close&#34;</span><span class="op" id="8275793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8275796">}</span><br>
<span class="lineno"></span><span class="op" id="8275798">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="8275801">func</span>&nbsp;<span class="ident" id="8275806">TestUDPListenClose</span><span class="op" id="8275824">(</span><span class="ident" id="8275825">t</span>&nbsp;<span class="op" id="8275827">*</span><span class="ident" id="8275828">testing</span><span class="op" id="8275835">.</span><span class="ident" id="8275836">T</span><span class="op" id="8275837">)</span>&nbsp;<span class="op" id="8275839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8275842">switch</span>&nbsp;<span class="ident" id="8275849">runtime</span><span class="op" id="8275856">.</span><span class="ident" id="8275857">GOOS</span>&nbsp;<span class="op" id="8275862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8275865">case</span>&nbsp;<span class="string" id="8275870">&#34;plan9&#34;</span><span class="op" id="8275877">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275881">t</span><span class="op" id="8275882">.</span><span class="ident" id="8275883">Skipf</span><span class="op" id="8275888">(</span><span class="string" id="8275889">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8275910">,</span>&nbsp;<span class="ident" id="8275912">runtime</span><span class="op" id="8275919">.</span><span class="ident" id="8275920">GOOS</span><span class="op" id="8275924">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8275927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275930">ln</span><span class="op" id="8275932">,</span>&nbsp;<span class="ident" id="8275934">err</span>&nbsp;<span class="op" id="8275938">:=</span>&nbsp;<span class="ident" id="8275941">ListenPacket</span><span class="op" id="8275953">(</span><span class="string" id="8275954">&#34;udp&#34;</span><span class="op" id="8275959">,</span>&nbsp;<span class="string" id="8275961">&#34;127.0.0.1:0&#34;</span><span class="op" id="8275974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8275977">if</span>&nbsp;<span class="ident" id="8275980">err</span>&nbsp;<span class="op" id="8275984">!=</span>&nbsp;<span class="ident" id="8275987">nil</span>&nbsp;<span class="op" id="8275991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8275995">t</span><span class="op" id="8275996">.</span><span class="ident" id="8275997">Fatalf</span><span class="op" id="8276003">(</span><span class="string" id="8276004">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8276023">,</span>&nbsp;<span class="ident" id="8276025">err</span><span class="op" id="8276028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8276031">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276035">buf</span>&nbsp;<span class="op" id="8276039">:=</span>&nbsp;<span class="builtinfunc" id="8276042">make</span><span class="op" id="8276046">(</span><span class="op" id="8276047">[</span><span class="op" id="8276048">]</span><span class="builtintype" id="8276049">byte</span><span class="op" id="8276053">,</span>&nbsp;<span class="num" id="8276055">1000</span><span class="op" id="8276059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276062">done</span>&nbsp;<span class="op" id="8276067">:=</span>&nbsp;<span class="builtinfunc" id="8276070">make</span><span class="op" id="8276074">(</span><span class="keyword" id="8276075">chan</span>&nbsp;<span class="builtintype" id="8276080">bool</span><span class="op" id="8276084">,</span>&nbsp;<span class="num" id="8276086">1</span><span class="op" id="8276087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276090">go</span>&nbsp;<span class="keyword" id="8276093">func</span><span class="op" id="8276097">(</span><span class="op" id="8276098">)</span>&nbsp;<span class="op" id="8276100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276104">time</span><span class="op" id="8276108">.</span><span class="ident" id="8276109">Sleep</span><span class="op" id="8276114">(</span><span class="num" id="8276115">100</span>&nbsp;<span class="op" id="8276119">*</span>&nbsp;<span class="ident" id="8276121">time</span><span class="op" id="8276125">.</span><span class="ident" id="8276126">Millisecond</span><span class="op" id="8276137">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276141">ln</span><span class="op" id="8276143">.</span><span class="ident" id="8276144">Close</span><span class="op" id="8276149">(</span><span class="op" id="8276150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8276153">}</span><span class="op" id="8276154">(</span><span class="op" id="8276155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276158">go</span>&nbsp;<span class="keyword" id="8276161">func</span><span class="op" id="8276165">(</span><span class="op" id="8276166">)</span>&nbsp;<span class="op" id="8276168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276172">_</span><span class="op" id="8276173">,</span>&nbsp;<span class="ident" id="8276175">_</span><span class="op" id="8276176">,</span>&nbsp;<span class="ident" id="8276178">err</span>&nbsp;<span class="op" id="8276182">=</span>&nbsp;<span class="ident" id="8276184">ln</span><span class="op" id="8276186">.</span><span class="ident" id="8276187">ReadFrom</span><span class="op" id="8276195">(</span><span class="ident" id="8276196">buf</span><span class="op" id="8276199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276203">if</span>&nbsp;<span class="ident" id="8276206">err</span>&nbsp;<span class="op" id="8276210">==</span>&nbsp;<span class="ident" id="8276213">nil</span>&nbsp;<span class="op" id="8276217">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276222">t</span><span class="op" id="8276223">.</span><span class="ident" id="8276224">Error</span><span class="op" id="8276229">(</span><span class="string" id="8276230">&#34;ReadFrom&nbsp;succeeded&#34;</span><span class="op" id="8276250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8276254">}</span>&nbsp;<span class="keyword" id="8276256">else</span>&nbsp;<span class="op" id="8276261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276266">t</span><span class="op" id="8276267">.</span><span class="ident" id="8276268">Logf</span><span class="op" id="8276272">(</span><span class="string" id="8276273">&#34;ReadFrom&nbsp;timeout&nbsp;error:&nbsp;%s&nbsp;(any&nbsp;error&nbsp;is&nbsp;fine)&#34;</span><span class="op" id="8276321">,</span>&nbsp;<span class="ident" id="8276323">err</span><span class="op" id="8276326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8276330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276334">done</span>&nbsp;<span class="op" id="8276339">&lt;-</span>&nbsp;<span class="builtintype" id="8276342">true</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8276348">}</span><span class="op" id="8276349">(</span><span class="op" id="8276350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276353">select</span>&nbsp;<span class="op" id="8276360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276363">case</span>&nbsp;<span class="op" id="8276368">&lt;-</span><span class="ident" id="8276370">done</span><span class="op" id="8276374">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276377">case</span>&nbsp;<span class="op" id="8276382">&lt;-</span><span class="ident" id="8276384">time</span><span class="op" id="8276388">.</span><span class="ident" id="8276389">After</span><span class="op" id="8276394">(</span><span class="num" id="8276395">2</span>&nbsp;<span class="op" id="8276397">*</span>&nbsp;<span class="ident" id="8276399">time</span><span class="op" id="8276403">.</span><span class="ident" id="8276404">Second</span><span class="op" id="8276410">)</span><span class="op" id="8276411">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276415">t</span><span class="op" id="8276416">.</span><span class="ident" id="8276417">Fatal</span><span class="op" id="8276422">(</span><span class="string" id="8276423">&#34;timeout&nbsp;waiting&nbsp;for&nbsp;UDP&nbsp;close&#34;</span><span class="op" id="8276454">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8276457">}</span><br>
<span class="lineno"></span><span class="op" id="8276459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8276462">func</span>&nbsp;<span class="ident" id="8276467">TestTCPClose</span><span class="op" id="8276479">(</span><span class="ident" id="8276480">t</span>&nbsp;<span class="op" id="8276482">*</span><span class="ident" id="8276483">testing</span><span class="op" id="8276490">.</span><span class="ident" id="8276491">T</span><span class="op" id="8276492">)</span>&nbsp;<span class="op" id="8276494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276497">switch</span>&nbsp;<span class="ident" id="8276504">runtime</span><span class="op" id="8276511">.</span><span class="ident" id="8276512">GOOS</span>&nbsp;<span class="op" id="8276517">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276520">case</span>&nbsp;<span class="string" id="8276525">&#34;plan9&#34;</span><span class="op" id="8276532">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276536">t</span><span class="op" id="8276537">.</span><span class="ident" id="8276538">Skipf</span><span class="op" id="8276543">(</span><span class="string" id="8276544">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8276565">,</span>&nbsp;<span class="ident" id="8276567">runtime</span><span class="op" id="8276574">.</span><span class="ident" id="8276575">GOOS</span><span class="op" id="8276579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8276582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276585">l</span><span class="op" id="8276586">,</span>&nbsp;<span class="ident" id="8276588">err</span>&nbsp;<span class="op" id="8276592">:=</span>&nbsp;<span class="ident" id="8276595">Listen</span><span class="op" id="8276601">(</span><span class="string" id="8276602">&#34;tcp&#34;</span><span class="op" id="8276607">,</span>&nbsp;<span class="string" id="8276609">&#34;127.0.0.1:0&#34;</span><span class="op" id="8276622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276625">if</span>&nbsp;<span class="ident" id="8276628">err</span>&nbsp;<span class="op" id="8276632">!=</span>&nbsp;<span class="ident" id="8276635">nil</span>&nbsp;<span class="op" id="8276639">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276643">t</span><span class="op" id="8276644">.</span><span class="ident" id="8276645">Fatal</span><span class="op" id="8276650">(</span><span class="ident" id="8276651">err</span><span class="op" id="8276654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8276657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276660">defer</span>&nbsp;<span class="ident" id="8276666">l</span><span class="op" id="8276667">.</span><span class="ident" id="8276668">Close</span><span class="op" id="8276673">(</span><span class="op" id="8276674">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276678">read</span>&nbsp;<span class="op" id="8276683">:=</span>&nbsp;<span class="keyword" id="8276686">func</span><span class="op" id="8276690">(</span><span class="ident" id="8276691">r</span>&nbsp;<span class="ident" id="8276693">io</span><span class="op" id="8276695">.</span><span class="ident" id="8276696">Reader</span><span class="op" id="8276702">)</span>&nbsp;<span class="builtintype" id="8276704">error</span>&nbsp;<span class="op" id="8276710">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276714">var</span>&nbsp;<span class="ident" id="8276718">m</span>&nbsp;<span class="op" id="8276720">[</span><span class="num" id="8276721">1</span><span class="op" id="8276722">]</span><span class="builtintype" id="8276723">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276730">_</span><span class="op" id="8276731">,</span>&nbsp;<span class="ident" id="8276733">err</span>&nbsp;<span class="op" id="8276737">:=</span>&nbsp;<span class="ident" id="8276740">r</span><span class="op" id="8276741">.</span><span class="ident" id="8276742">Read</span><span class="op" id="8276746">(</span><span class="ident" id="8276747">m</span><span class="op" id="8276748">[</span><span class="op" id="8276749">:</span><span class="op" id="8276750">]</span><span class="op" id="8276751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276755">return</span>&nbsp;<span class="ident" id="8276762">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8276767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276771">go</span>&nbsp;<span class="keyword" id="8276774">func</span><span class="op" id="8276778">(</span><span class="op" id="8276779">)</span>&nbsp;<span class="op" id="8276781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276785">c</span><span class="op" id="8276786">,</span>&nbsp;<span class="ident" id="8276788">err</span>&nbsp;<span class="op" id="8276792">:=</span>&nbsp;<span class="ident" id="8276795">Dial</span><span class="op" id="8276799">(</span><span class="string" id="8276800">&#34;tcp&#34;</span><span class="op" id="8276805">,</span>&nbsp;<span class="ident" id="8276807">l</span><span class="op" id="8276808">.</span><span class="ident" id="8276809">Addr</span><span class="op" id="8276813">(</span><span class="op" id="8276814">)</span><span class="op" id="8276815">.</span><span class="ident" id="8276816">String</span><span class="op" id="8276822">(</span><span class="op" id="8276823">)</span><span class="op" id="8276824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276828">if</span>&nbsp;<span class="ident" id="8276831">err</span>&nbsp;<span class="op" id="8276835">!=</span>&nbsp;<span class="ident" id="8276838">nil</span>&nbsp;<span class="op" id="8276842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276847">t</span><span class="op" id="8276848">.</span><span class="ident" id="8276849">Errorf</span><span class="op" id="8276855">(</span><span class="string" id="8276856">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8276866">,</span>&nbsp;<span class="ident" id="8276868">err</span><span class="op" id="8276871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276876">return</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8276885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276890">go</span>&nbsp;<span class="ident" id="8276893">read</span><span class="op" id="8276897">(</span><span class="ident" id="8276898">c</span><span class="op" id="8276899">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276904">time</span><span class="op" id="8276908">.</span><span class="ident" id="8276909">Sleep</span><span class="op" id="8276914">(</span><span class="num" id="8276915">10</span>&nbsp;<span class="op" id="8276918">*</span>&nbsp;<span class="ident" id="8276920">time</span><span class="op" id="8276924">.</span><span class="ident" id="8276925">Millisecond</span><span class="op" id="8276936">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276940">c</span><span class="op" id="8276941">.</span><span class="ident" id="8276942">Close</span><span class="op" id="8276947">(</span><span class="op" id="8276948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8276951">}</span><span class="op" id="8276952">(</span><span class="op" id="8276953">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276957">c</span><span class="op" id="8276958">,</span>&nbsp;<span class="ident" id="8276960">err</span>&nbsp;<span class="op" id="8276964">:=</span>&nbsp;<span class="ident" id="8276967">l</span><span class="op" id="8276968">.</span><span class="ident" id="8276969">Accept</span><span class="op" id="8276975">(</span><span class="op" id="8276976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276979">if</span>&nbsp;<span class="ident" id="8276982">err</span>&nbsp;<span class="op" id="8276986">!=</span>&nbsp;<span class="ident" id="8276989">nil</span>&nbsp;<span class="op" id="8276993">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276997">t</span><span class="op" id="8276998">.</span><span class="ident" id="8276999">Fatal</span><span class="op" id="8277004">(</span><span class="ident" id="8277005">err</span><span class="op" id="8277008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8277011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8277014">defer</span>&nbsp;<span class="ident" id="8277020">c</span><span class="op" id="8277021">.</span><span class="ident" id="8277022">Close</span><span class="op" id="8277027">(</span><span class="op" id="8277028">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8277032">for</span>&nbsp;<span class="ident" id="8277036">err</span>&nbsp;<span class="op" id="8277040">==</span>&nbsp;<span class="ident" id="8277043">nil</span>&nbsp;<span class="op" id="8277047">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277051">err</span>&nbsp;<span class="op" id="8277055">=</span>&nbsp;<span class="ident" id="8277057">read</span><span class="op" id="8277061">(</span><span class="ident" id="8277062">c</span><span class="op" id="8277063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8277066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8277069">if</span>&nbsp;<span class="ident" id="8277072">err</span>&nbsp;<span class="op" id="8277076">!=</span>&nbsp;<span class="ident" id="8277079">nil</span>&nbsp;<span class="op" id="8277083">&amp;&amp;</span>&nbsp;<span class="ident" id="8277086">err</span>&nbsp;<span class="op" id="8277090">!=</span>&nbsp;<span class="ident" id="8277093">io</span><span class="op" id="8277095">.</span><span class="ident" id="8277096">EOF</span>&nbsp;<span class="op" id="8277100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277104">t</span><span class="op" id="8277105">.</span><span class="ident" id="8277106">Fatal</span><span class="op" id="8277111">(</span><span class="ident" id="8277112">err</span><span class="op" id="8277115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8277118">}</span><br>
<span class="lineno">225</span><span class="op" id="8277120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8277123">func</span>&nbsp;<span class="ident" id="8277128">TestErrorNil</span><span class="op" id="8277140">(</span><span class="ident" id="8277141">t</span>&nbsp;<span class="op" id="8277143">*</span><span class="ident" id="8277144">testing</span><span class="op" id="8277151">.</span><span class="ident" id="8277152">T</span><span class="op" id="8277153">)</span>&nbsp;<span class="op" id="8277155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277158">c</span><span class="op" id="8277159">,</span>&nbsp;<span class="ident" id="8277161">err</span>&nbsp;<span class="op" id="8277165">:=</span>&nbsp;<span class="ident" id="8277168">Dial</span><span class="op" id="8277172">(</span><span class="string" id="8277173">&#34;tcp&#34;</span><span class="op" id="8277178">,</span>&nbsp;<span class="string" id="8277180">&#34;127.0.0.1:65535&#34;</span><span class="op" id="8277197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8277200">if</span>&nbsp;<span class="ident" id="8277203">err</span>&nbsp;<span class="op" id="8277207">==</span>&nbsp;<span class="ident" id="8277210">nil</span>&nbsp;<span class="op" id="8277214">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277218">t</span><span class="op" id="8277219">.</span><span class="ident" id="8277220">Fatal</span><span class="op" id="8277225">(</span><span class="string" id="8277226">&#34;Dial&nbsp;127.0.0.1:65535&nbsp;succeeded&#34;</span><span class="op" id="8277258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8277261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8277264">if</span>&nbsp;<span class="ident" id="8277267">c</span>&nbsp;<span class="op" id="8277269">!=</span>&nbsp;<span class="ident" id="8277272">nil</span>&nbsp;<span class="op" id="8277276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277280">t</span><span class="op" id="8277281">.</span><span class="ident" id="8277282">Fatalf</span><span class="op" id="8277288">(</span><span class="string" id="8277289">&#34;Dial&nbsp;returned&nbsp;non-nil&nbsp;interface&nbsp;%T(%v)&nbsp;with&nbsp;err&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="8277345">,</span>&nbsp;<span class="ident" id="8277347">c</span><span class="op" id="8277348">,</span>&nbsp;<span class="ident" id="8277350">c</span><span class="op" id="8277351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8277354">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8277358">//&nbsp;Make&nbsp;Listen&nbsp;fail&nbsp;by&nbsp;relistening&nbsp;on&nbsp;the&nbsp;same&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277415">l</span><span class="op" id="8277416">,</span>&nbsp;<span class="ident" id="8277418">err</span>&nbsp;<span class="op" id="8277422">:=</span>&nbsp;<span class="ident" id="8277425">Listen</span><span class="op" id="8277431">(</span><span class="string" id="8277432">&#34;tcp&#34;</span><span class="op" id="8277437">,</span>&nbsp;<span class="string" id="8277439">&#34;127.0.0.1:0&#34;</span><span class="op" id="8277452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8277455">if</span>&nbsp;<span class="ident" id="8277458">err</span>&nbsp;<span class="op" id="8277462">!=</span>&nbsp;<span class="ident" id="8277465">nil</span>&nbsp;<span class="op" id="8277469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277473">t</span><span class="op" id="8277474">.</span><span class="ident" id="8277475">Fatalf</span><span class="op" id="8277481">(</span><span class="string" id="8277482">&#34;Listen&nbsp;127.0.0.1:0:&nbsp;%v&#34;</span><span class="op" id="8277506">,</span>&nbsp;<span class="ident" id="8277508">err</span><span class="op" id="8277511">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8277514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8277517">defer</span>&nbsp;<span class="ident" id="8277523">l</span><span class="op" id="8277524">.</span><span class="ident" id="8277525">Close</span><span class="op" id="8277530">(</span><span class="op" id="8277531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277534">l1</span><span class="op" id="8277536">,</span>&nbsp;<span class="ident" id="8277538">err</span>&nbsp;<span class="op" id="8277542">:=</span>&nbsp;<span class="ident" id="8277545">Listen</span><span class="op" id="8277551">(</span><span class="string" id="8277552">&#34;tcp&#34;</span><span class="op" id="8277557">,</span>&nbsp;<span class="ident" id="8277559">l</span><span class="op" id="8277560">.</span><span class="ident" id="8277561">Addr</span><span class="op" id="8277565">(</span><span class="op" id="8277566">)</span><span class="op" id="8277567">.</span><span class="ident" id="8277568">String</span><span class="op" id="8277574">(</span><span class="op" id="8277575">)</span><span class="op" id="8277576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8277579">if</span>&nbsp;<span class="ident" id="8277582">err</span>&nbsp;<span class="op" id="8277586">==</span>&nbsp;<span class="ident" id="8277589">nil</span>&nbsp;<span class="op" id="8277593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277597">t</span><span class="op" id="8277598">.</span><span class="ident" id="8277599">Fatalf</span><span class="op" id="8277605">(</span><span class="string" id="8277606">&#34;second&nbsp;Listen&nbsp;%v:&nbsp;%v&#34;</span><span class="op" id="8277628">,</span>&nbsp;<span class="ident" id="8277630">l</span><span class="op" id="8277631">.</span><span class="ident" id="8277632">Addr</span><span class="op" id="8277636">(</span><span class="op" id="8277637">)</span><span class="op" id="8277638">,</span>&nbsp;<span class="ident" id="8277640">err</span><span class="op" id="8277643">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8277646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8277649">if</span>&nbsp;<span class="ident" id="8277652">l1</span>&nbsp;<span class="op" id="8277655">!=</span>&nbsp;<span class="ident" id="8277658">nil</span>&nbsp;<span class="op" id="8277662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277666">t</span><span class="op" id="8277667">.</span><span class="ident" id="8277668">Fatalf</span><span class="op" id="8277674">(</span><span class="string" id="8277675">&#34;Listen&nbsp;returned&nbsp;non-nil&nbsp;interface&nbsp;%T(%v)&nbsp;with&nbsp;err&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="8277733">,</span>&nbsp;<span class="ident" id="8277735">l1</span><span class="op" id="8277737">,</span>&nbsp;<span class="ident" id="8277739">l1</span><span class="op" id="8277741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8277744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8277748">//&nbsp;Make&nbsp;ListenPacket&nbsp;fail&nbsp;by&nbsp;relistening&nbsp;on&nbsp;the&nbsp;same&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277811">lp</span><span class="op" id="8277813">,</span>&nbsp;<span class="ident" id="8277815">err</span>&nbsp;<span class="op" id="8277819">:=</span>&nbsp;<span class="ident" id="8277822">ListenPacket</span><span class="op" id="8277834">(</span><span class="string" id="8277835">&#34;udp&#34;</span><span class="op" id="8277840">,</span>&nbsp;<span class="string" id="8277842">&#34;127.0.0.1:0&#34;</span><span class="op" id="8277855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8277858">if</span>&nbsp;<span class="ident" id="8277861">err</span>&nbsp;<span class="op" id="8277865">!=</span>&nbsp;<span class="ident" id="8277868">nil</span>&nbsp;<span class="op" id="8277872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277876">t</span><span class="op" id="8277877">.</span><span class="ident" id="8277878">Fatalf</span><span class="op" id="8277884">(</span><span class="string" id="8277885">&#34;Listen&nbsp;127.0.0.1:0:&nbsp;%v&#34;</span><span class="op" id="8277909">,</span>&nbsp;<span class="ident" id="8277911">err</span><span class="op" id="8277914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8277917">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8277920">defer</span>&nbsp;<span class="ident" id="8277926">lp</span><span class="op" id="8277928">.</span><span class="ident" id="8277929">Close</span><span class="op" id="8277934">(</span><span class="op" id="8277935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277938">lp1</span><span class="op" id="8277941">,</span>&nbsp;<span class="ident" id="8277943">err</span>&nbsp;<span class="op" id="8277947">:=</span>&nbsp;<span class="ident" id="8277950">ListenPacket</span><span class="op" id="8277962">(</span><span class="string" id="8277963">&#34;udp&#34;</span><span class="op" id="8277968">,</span>&nbsp;<span class="ident" id="8277970">lp</span><span class="op" id="8277972">.</span><span class="ident" id="8277973">LocalAddr</span><span class="op" id="8277982">(</span><span class="op" id="8277983">)</span><span class="op" id="8277984">.</span><span class="ident" id="8277985">String</span><span class="op" id="8277991">(</span><span class="op" id="8277992">)</span><span class="op" id="8277993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8277996">if</span>&nbsp;<span class="ident" id="8277999">err</span>&nbsp;<span class="op" id="8278003">==</span>&nbsp;<span class="ident" id="8278006">nil</span>&nbsp;<span class="op" id="8278010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8278014">t</span><span class="op" id="8278015">.</span><span class="ident" id="8278016">Fatalf</span><span class="op" id="8278022">(</span><span class="string" id="8278023">&#34;second&nbsp;Listen&nbsp;%v:&nbsp;%v&#34;</span><span class="op" id="8278045">,</span>&nbsp;<span class="ident" id="8278047">lp</span><span class="op" id="8278049">.</span><span class="ident" id="8278050">LocalAddr</span><span class="op" id="8278059">(</span><span class="op" id="8278060">)</span><span class="op" id="8278061">,</span>&nbsp;<span class="ident" id="8278063">err</span><span class="op" id="8278066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8278069">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8278072">if</span>&nbsp;<span class="ident" id="8278075">lp1</span>&nbsp;<span class="op" id="8278079">!=</span>&nbsp;<span class="ident" id="8278082">nil</span>&nbsp;<span class="op" id="8278086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8278090">t</span><span class="op" id="8278091">.</span><span class="ident" id="8278092">Fatalf</span><span class="op" id="8278098">(</span><span class="string" id="8278099">&#34;ListenPacket&nbsp;returned&nbsp;non-nil&nbsp;interface&nbsp;%T(%v)&nbsp;with&nbsp;err&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="8278163">,</span>&nbsp;<span class="ident" id="8278165">lp1</span><span class="op" id="8278168">,</span>&nbsp;<span class="ident" id="8278170">lp1</span><span class="op" id="8278173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8278176">}</span><br>
<span class="lineno"></span><span class="op" id="8278178">}</span>
</div>
</body>
</html>
