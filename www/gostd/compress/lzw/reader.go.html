<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/lzw</h2>
<ul>
<li><a href="/gostd/compress/lzw/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/compress/lzw/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/lzw/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/lzw/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6087483">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6087538">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6087592">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6087643">//&nbsp;Package&nbsp;lzw&nbsp;implements&nbsp;the&nbsp;Lempel-Ziv-Welch&nbsp;compressed&nbsp;data&nbsp;format,</span><br>
<span class="lineno"></span><span class="comment" id="6087714">//&nbsp;described&nbsp;in&nbsp;T.&nbsp;A.&nbsp;Welch,&nbsp;``A&nbsp;Technique&nbsp;for&nbsp;High-Performance&nbsp;Data</span><br>
<span class="lineno"></span><span class="comment" id="6087783">//&nbsp;Compression&#39;&#39;,&nbsp;Computer,&nbsp;17(6)&nbsp;(June&nbsp;1984),&nbsp;pp&nbsp;8-19.</span><br>
<span class="lineno"></span><span class="comment" id="6087839">//</span><br>
<span class="lineno"></span><span class="comment" id="6087842">//&nbsp;In&nbsp;particular,&nbsp;it&nbsp;implements&nbsp;LZW&nbsp;as&nbsp;used&nbsp;by&nbsp;the&nbsp;GIF&nbsp;and&nbsp;PDF&nbsp;file</span><br>
<span class="lineno">10</span><span class="comment" id="6087910">//&nbsp;formats,&nbsp;which&nbsp;means&nbsp;variable-width&nbsp;codes&nbsp;up&nbsp;to&nbsp;12&nbsp;bits&nbsp;and&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="6087983">//&nbsp;two&nbsp;non-literal&nbsp;codes&nbsp;are&nbsp;a&nbsp;clear&nbsp;code&nbsp;and&nbsp;an&nbsp;EOF&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="6088042">//</span><br>
<span class="lineno"></span><span class="comment" id="6088045">//&nbsp;The&nbsp;TIFF&nbsp;file&nbsp;format&nbsp;uses&nbsp;a&nbsp;similar&nbsp;but&nbsp;incompatible&nbsp;version&nbsp;of&nbsp;the&nbsp;LZW</span><br>
<span class="lineno"></span><span class="comment" id="6088120">//&nbsp;algorithm.&nbsp;See&nbsp;the&nbsp;golang.org/x/image/tiff/lzw&nbsp;package&nbsp;for&nbsp;an</span><br>
<span class="lineno">15</span><span class="comment" id="6088185">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="6088204">package</span>&nbsp;<span class="ident" id="6088212">lzw</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6088217">//&nbsp;TODO(nigeltao):&nbsp;check&nbsp;that&nbsp;PDF&nbsp;uses&nbsp;LZW&nbsp;in&nbsp;the&nbsp;same&nbsp;way&nbsp;as&nbsp;GIF,</span><br>
<span class="lineno"></span><span class="comment" id="6088284">//&nbsp;modulo&nbsp;LSB/MSB&nbsp;packing&nbsp;order.</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6088318">import</span>&nbsp;<span class="op" id="6088325">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6088328">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6088337">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6088347">&#34;fmt&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6088354">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6088359">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6088362">//&nbsp;Order&nbsp;specifies&nbsp;the&nbsp;bit&nbsp;ordering&nbsp;in&nbsp;an&nbsp;LZW&nbsp;data&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="6088421">type</span>&nbsp;<span class="ident" id="6088426">Order</span>&nbsp;<span class="builtintype" id="6088432">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="6088437">const</span>&nbsp;<span class="op" id="6088443">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6088446">//&nbsp;LSB&nbsp;means&nbsp;Least&nbsp;Significant&nbsp;Bits&nbsp;first,&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;GIF&nbsp;file&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088522">LSB</span>&nbsp;<span class="ident" id="6088526">Order</span>&nbsp;<span class="op" id="6088532">=</span>&nbsp;<span class="ident" id="6088534">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6088540">//&nbsp;MSB&nbsp;means&nbsp;Most&nbsp;Significant&nbsp;Bits&nbsp;first,&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;TIFF&nbsp;and&nbsp;PDF</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6088611">//&nbsp;file&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088629">MSB</span><br>
<span class="lineno"></span><span class="op" id="6088633">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6088636">const</span>&nbsp;<span class="op" id="6088642">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088645">maxWidth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088664">=</span>&nbsp;<span class="num" id="6088666">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088670">decoderInvalidCode</span>&nbsp;<span class="op" id="6088689">=</span>&nbsp;<span class="num" id="6088691">0xffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088699">flushBuffer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088718">=</span>&nbsp;<span class="num" id="6088720">1</span>&nbsp;<span class="op" id="6088722">&lt;&lt;</span>&nbsp;<span class="ident" id="6088725">maxWidth</span><br>
<span class="lineno"></span><span class="op" id="6088734">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="6088737">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;state&nbsp;from&nbsp;which&nbsp;the&nbsp;readXxx&nbsp;method&nbsp;converts&nbsp;a&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="6088807">//&nbsp;stream&nbsp;into&nbsp;a&nbsp;code&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="6088837">type</span>&nbsp;<span class="ident" id="6088842">decoder</span>&nbsp;<span class="keyword" id="6088850">struct</span>&nbsp;<span class="op" id="6088857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088860">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088869">io</span><span class="op" id="6088871">.</span><span class="ident" id="6088872">ByteReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088884">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6088893">uint32</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088901">nBits</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6088910">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088916">width</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6088925">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088931">read</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088940">func</span><span class="op" id="6088944">(</span><span class="op" id="6088945">*</span><span class="ident" id="6088946">decoder</span><span class="op" id="6088953">)</span>&nbsp;<span class="op" id="6088955">(</span><span class="builtintype" id="6088956">uint16</span><span class="op" id="6088962">,</span>&nbsp;<span class="builtintype" id="6088964">error</span><span class="op" id="6088969">)</span>&nbsp;<span class="comment" id="6088971">//&nbsp;readLSB&nbsp;or&nbsp;readMSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088994">litWidth</span>&nbsp;<span class="builtintype" id="6089003">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089034">//&nbsp;width&nbsp;in&nbsp;bits&nbsp;of&nbsp;literal&nbsp;codes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089069">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6089078">error</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089086">//&nbsp;The&nbsp;first&nbsp;1&lt;&lt;litWidth&nbsp;codes&nbsp;are&nbsp;literal&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089137">//&nbsp;The&nbsp;next&nbsp;two&nbsp;codes&nbsp;mean&nbsp;clear&nbsp;and&nbsp;EOF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089180">//&nbsp;Other&nbsp;valid&nbsp;codes&nbsp;are&nbsp;in&nbsp;the&nbsp;range&nbsp;[lo,&nbsp;hi]&nbsp;where&nbsp;lo&nbsp;:=&nbsp;clear&nbsp;+&nbsp;2,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089251">//&nbsp;with&nbsp;the&nbsp;upper&nbsp;bound&nbsp;incrementing&nbsp;on&nbsp;each&nbsp;code&nbsp;seen.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089308">//&nbsp;overflow&nbsp;is&nbsp;the&nbsp;code&nbsp;at&nbsp;which&nbsp;hi&nbsp;overflows&nbsp;the&nbsp;code&nbsp;width.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089371">//&nbsp;last&nbsp;is&nbsp;the&nbsp;most&nbsp;recently&nbsp;seen&nbsp;code,&nbsp;or&nbsp;decoderInvalidCode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089435">clear</span><span class="op" id="6089440">,</span>&nbsp;<span class="ident" id="6089442">eof</span><span class="op" id="6089445">,</span>&nbsp;<span class="ident" id="6089447">hi</span><span class="op" id="6089449">,</span>&nbsp;<span class="ident" id="6089451">overflow</span><span class="op" id="6089459">,</span>&nbsp;<span class="ident" id="6089461">last</span>&nbsp;<span class="builtintype" id="6089466">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089475">//&nbsp;Each&nbsp;code&nbsp;c&nbsp;in&nbsp;[lo,&nbsp;hi]&nbsp;expands&nbsp;to&nbsp;two&nbsp;or&nbsp;more&nbsp;bytes.&nbsp;For&nbsp;c&nbsp;!=&nbsp;hi:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089546">//&nbsp;&nbsp;&nbsp;suffix[c]&nbsp;is&nbsp;the&nbsp;last&nbsp;of&nbsp;these&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089590">//&nbsp;&nbsp;&nbsp;prefix[c]&nbsp;is&nbsp;the&nbsp;code&nbsp;for&nbsp;all&nbsp;but&nbsp;the&nbsp;last&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089645">//&nbsp;&nbsp;&nbsp;This&nbsp;code&nbsp;can&nbsp;either&nbsp;be&nbsp;a&nbsp;literal&nbsp;code&nbsp;or&nbsp;another&nbsp;code&nbsp;in&nbsp;[lo,&nbsp;c).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089718">//&nbsp;The&nbsp;c&nbsp;==&nbsp;hi&nbsp;case&nbsp;is&nbsp;a&nbsp;special&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089758">suffix</span>&nbsp;<span class="op" id="6089765">[</span><span class="num" id="6089766">1</span>&nbsp;<span class="op" id="6089768">&lt;&lt;</span>&nbsp;<span class="ident" id="6089771">maxWidth</span><span class="op" id="6089779">]</span><span class="builtintype" id="6089780">uint8</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089787">prefix</span>&nbsp;<span class="op" id="6089794">[</span><span class="num" id="6089795">1</span>&nbsp;<span class="op" id="6089797">&lt;&lt;</span>&nbsp;<span class="ident" id="6089800">maxWidth</span><span class="op" id="6089808">]</span><span class="builtintype" id="6089809">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089818">//&nbsp;output&nbsp;is&nbsp;the&nbsp;temporary&nbsp;output&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089861">//&nbsp;Literal&nbsp;codes&nbsp;are&nbsp;accumulated&nbsp;from&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089925">//&nbsp;Non-literal&nbsp;codes&nbsp;decode&nbsp;to&nbsp;a&nbsp;sequence&nbsp;of&nbsp;suffixes&nbsp;that&nbsp;are&nbsp;first</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089995">//&nbsp;written&nbsp;right-to-left&nbsp;from&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;buffer&nbsp;before&nbsp;being&nbsp;copied</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090068">//&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090100">//&nbsp;It&nbsp;is&nbsp;flushed&nbsp;when&nbsp;it&nbsp;contains&nbsp;&gt;=&nbsp;1&lt;&lt;maxWidth&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090157">//&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;always&nbsp;room&nbsp;to&nbsp;decode&nbsp;an&nbsp;entire&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090216">output</span>&nbsp;<span class="op" id="6090223">[</span><span class="num" id="6090224">2</span>&nbsp;<span class="op" id="6090226">*</span>&nbsp;<span class="num" id="6090228">1</span>&nbsp;<span class="op" id="6090230">&lt;&lt;</span>&nbsp;<span class="ident" id="6090233">maxWidth</span><span class="op" id="6090241">]</span><span class="builtintype" id="6090242">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090248">o</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6090255">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090262">//&nbsp;write&nbsp;index&nbsp;into&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090290">toRead</span>&nbsp;<span class="op" id="6090297">[</span><span class="op" id="6090298">]</span><span class="builtintype" id="6090299">byte</span>&nbsp;<span class="comment" id="6090304">//&nbsp;bytes&nbsp;to&nbsp;return&nbsp;from&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="6090333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6090336">//&nbsp;readLSB&nbsp;returns&nbsp;the&nbsp;next&nbsp;code&nbsp;for&nbsp;&#34;Least&nbsp;Significant&nbsp;Bits&nbsp;first&#34;&nbsp;data.</span><br>
<span class="lineno">85</span><span class="keyword" id="6090410">func</span>&nbsp;<span class="op" id="6090415">(</span><span class="ident" id="6090416">d</span>&nbsp;<span class="op" id="6090418">*</span><span class="ident" id="6090419">decoder</span><span class="op" id="6090426">)</span>&nbsp;<span class="ident" id="6090428">readLSB</span><span class="op" id="6090435">(</span><span class="op" id="6090436">)</span>&nbsp;<span class="op" id="6090438">(</span><span class="builtintype" id="6090439">uint16</span><span class="op" id="6090445">,</span>&nbsp;<span class="builtintype" id="6090447">error</span><span class="op" id="6090452">)</span>&nbsp;<span class="op" id="6090454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090457">for</span>&nbsp;<span class="ident" id="6090461">d</span><span class="op" id="6090462">.</span><span class="ident" id="6090463">nBits</span>&nbsp;<span class="op" id="6090469">&lt;</span>&nbsp;<span class="ident" id="6090471">d</span><span class="op" id="6090472">.</span><span class="ident" id="6090473">width</span>&nbsp;<span class="op" id="6090479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090483">x</span><span class="op" id="6090484">,</span>&nbsp;<span class="ident" id="6090486">err</span>&nbsp;<span class="op" id="6090490">:=</span>&nbsp;<span class="ident" id="6090493">d</span><span class="op" id="6090494">.</span><span class="ident" id="6090495">r</span><span class="op" id="6090496">.</span><span class="ident" id="6090497">ReadByte</span><span class="op" id="6090505">(</span><span class="op" id="6090506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090510">if</span>&nbsp;<span class="ident" id="6090513">err</span>&nbsp;<span class="op" id="6090517">!=</span>&nbsp;<span class="builtintype" id="6090520">nil</span>&nbsp;<span class="op" id="6090524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090529">return</span>&nbsp;<span class="num" id="6090536">0</span><span class="op" id="6090537">,</span>&nbsp;<span class="ident" id="6090539">err</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6090545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090549">d</span><span class="op" id="6090550">.</span><span class="ident" id="6090551">bits</span>&nbsp;<span class="op" id="6090556">|=</span>&nbsp;<span class="builtintype" id="6090559">uint32</span><span class="op" id="6090565">(</span><span class="ident" id="6090566">x</span><span class="op" id="6090567">)</span>&nbsp;<span class="op" id="6090569">&lt;&lt;</span>&nbsp;<span class="ident" id="6090572">d</span><span class="op" id="6090573">.</span><span class="ident" id="6090574">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090582">d</span><span class="op" id="6090583">.</span><span class="ident" id="6090584">nBits</span>&nbsp;<span class="op" id="6090590">+=</span>&nbsp;<span class="num" id="6090593">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6090596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090599">code</span>&nbsp;<span class="op" id="6090604">:=</span>&nbsp;<span class="builtintype" id="6090607">uint16</span><span class="op" id="6090613">(</span><span class="ident" id="6090614">d</span><span class="op" id="6090615">.</span><span class="ident" id="6090616">bits</span>&nbsp;<span class="op" id="6090621">&amp;</span>&nbsp;<span class="op" id="6090623">(</span><span class="num" id="6090624">1</span><span class="op" id="6090625">&lt;&lt;</span><span class="ident" id="6090627">d</span><span class="op" id="6090628">.</span><span class="ident" id="6090629">width</span>&nbsp;<span class="op" id="6090635">-</span>&nbsp;<span class="num" id="6090637">1</span><span class="op" id="6090638">)</span><span class="op" id="6090639">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090642">d</span><span class="op" id="6090643">.</span><span class="ident" id="6090644">bits</span>&nbsp;<span class="op" id="6090649">&gt;&gt;=</span>&nbsp;<span class="ident" id="6090653">d</span><span class="op" id="6090654">.</span><span class="ident" id="6090655">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090662">d</span><span class="op" id="6090663">.</span><span class="ident" id="6090664">nBits</span>&nbsp;<span class="op" id="6090670">-=</span>&nbsp;<span class="ident" id="6090673">d</span><span class="op" id="6090674">.</span><span class="ident" id="6090675">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090682">return</span>&nbsp;<span class="ident" id="6090689">code</span><span class="op" id="6090693">,</span>&nbsp;<span class="builtintype" id="6090695">nil</span><br>
<span class="lineno"></span><span class="op" id="6090699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="6090702">//&nbsp;readMSB&nbsp;returns&nbsp;the&nbsp;next&nbsp;code&nbsp;for&nbsp;&#34;Most&nbsp;Significant&nbsp;Bits&nbsp;first&#34;&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="6090775">func</span>&nbsp;<span class="op" id="6090780">(</span><span class="ident" id="6090781">d</span>&nbsp;<span class="op" id="6090783">*</span><span class="ident" id="6090784">decoder</span><span class="op" id="6090791">)</span>&nbsp;<span class="ident" id="6090793">readMSB</span><span class="op" id="6090800">(</span><span class="op" id="6090801">)</span>&nbsp;<span class="op" id="6090803">(</span><span class="builtintype" id="6090804">uint16</span><span class="op" id="6090810">,</span>&nbsp;<span class="builtintype" id="6090812">error</span><span class="op" id="6090817">)</span>&nbsp;<span class="op" id="6090819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090822">for</span>&nbsp;<span class="ident" id="6090826">d</span><span class="op" id="6090827">.</span><span class="ident" id="6090828">nBits</span>&nbsp;<span class="op" id="6090834">&lt;</span>&nbsp;<span class="ident" id="6090836">d</span><span class="op" id="6090837">.</span><span class="ident" id="6090838">width</span>&nbsp;<span class="op" id="6090844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090848">x</span><span class="op" id="6090849">,</span>&nbsp;<span class="ident" id="6090851">err</span>&nbsp;<span class="op" id="6090855">:=</span>&nbsp;<span class="ident" id="6090858">d</span><span class="op" id="6090859">.</span><span class="ident" id="6090860">r</span><span class="op" id="6090861">.</span><span class="ident" id="6090862">ReadByte</span><span class="op" id="6090870">(</span><span class="op" id="6090871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090875">if</span>&nbsp;<span class="ident" id="6090878">err</span>&nbsp;<span class="op" id="6090882">!=</span>&nbsp;<span class="builtintype" id="6090885">nil</span>&nbsp;<span class="op" id="6090889">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090894">return</span>&nbsp;<span class="num" id="6090901">0</span><span class="op" id="6090902">,</span>&nbsp;<span class="ident" id="6090904">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6090910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090914">d</span><span class="op" id="6090915">.</span><span class="ident" id="6090916">bits</span>&nbsp;<span class="op" id="6090921">|=</span>&nbsp;<span class="builtintype" id="6090924">uint32</span><span class="op" id="6090930">(</span><span class="ident" id="6090931">x</span><span class="op" id="6090932">)</span>&nbsp;<span class="op" id="6090934">&lt;&lt;</span>&nbsp;<span class="op" id="6090937">(</span><span class="num" id="6090938">24</span>&nbsp;<span class="op" id="6090941">-</span>&nbsp;<span class="ident" id="6090943">d</span><span class="op" id="6090944">.</span><span class="ident" id="6090945">nBits</span><span class="op" id="6090950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090954">d</span><span class="op" id="6090955">.</span><span class="ident" id="6090956">nBits</span>&nbsp;<span class="op" id="6090962">+=</span>&nbsp;<span class="num" id="6090965">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6090968">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090971">code</span>&nbsp;<span class="op" id="6090976">:=</span>&nbsp;<span class="builtintype" id="6090979">uint16</span><span class="op" id="6090985">(</span><span class="ident" id="6090986">d</span><span class="op" id="6090987">.</span><span class="ident" id="6090988">bits</span>&nbsp;<span class="op" id="6090993">&gt;&gt;</span>&nbsp;<span class="op" id="6090996">(</span><span class="num" id="6090997">32</span>&nbsp;<span class="op" id="6091000">-</span>&nbsp;<span class="ident" id="6091002">d</span><span class="op" id="6091003">.</span><span class="ident" id="6091004">width</span><span class="op" id="6091009">)</span><span class="op" id="6091010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091013">d</span><span class="op" id="6091014">.</span><span class="ident" id="6091015">bits</span>&nbsp;<span class="op" id="6091020">&lt;&lt;=</span>&nbsp;<span class="ident" id="6091024">d</span><span class="op" id="6091025">.</span><span class="ident" id="6091026">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091033">d</span><span class="op" id="6091034">.</span><span class="ident" id="6091035">nBits</span>&nbsp;<span class="op" id="6091041">-=</span>&nbsp;<span class="ident" id="6091044">d</span><span class="op" id="6091045">.</span><span class="ident" id="6091046">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091053">return</span>&nbsp;<span class="ident" id="6091060">code</span><span class="op" id="6091064">,</span>&nbsp;<span class="builtintype" id="6091066">nil</span><br>
<span class="lineno"></span><span class="op" id="6091070">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="6091073">func</span>&nbsp;<span class="op" id="6091078">(</span><span class="ident" id="6091079">d</span>&nbsp;<span class="op" id="6091081">*</span><span class="ident" id="6091082">decoder</span><span class="op" id="6091089">)</span>&nbsp;<span class="ident" id="6091091">Read</span><span class="op" id="6091095">(</span><span class="ident" id="6091096">b</span>&nbsp;<span class="op" id="6091098">[</span><span class="op" id="6091099">]</span><span class="builtintype" id="6091100">byte</span><span class="op" id="6091104">)</span>&nbsp;<span class="op" id="6091106">(</span><span class="builtintype" id="6091107">int</span><span class="op" id="6091110">,</span>&nbsp;<span class="builtintype" id="6091112">error</span><span class="op" id="6091117">)</span>&nbsp;<span class="op" id="6091119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091122">for</span>&nbsp;<span class="op" id="6091126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091130">if</span>&nbsp;<span class="builtinfunc" id="6091133">len</span><span class="op" id="6091136">(</span><span class="ident" id="6091137">d</span><span class="op" id="6091138">.</span><span class="ident" id="6091139">toRead</span><span class="op" id="6091145">)</span>&nbsp;<span class="op" id="6091147">&gt;</span>&nbsp;<span class="num" id="6091149">0</span>&nbsp;<span class="op" id="6091151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091156">n</span>&nbsp;<span class="op" id="6091158">:=</span>&nbsp;<span class="builtinfunc" id="6091161">copy</span><span class="op" id="6091165">(</span><span class="ident" id="6091166">b</span><span class="op" id="6091167">,</span>&nbsp;<span class="ident" id="6091169">d</span><span class="op" id="6091170">.</span><span class="ident" id="6091171">toRead</span><span class="op" id="6091177">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091182">d</span><span class="op" id="6091183">.</span><span class="ident" id="6091184">toRead</span>&nbsp;<span class="op" id="6091191">=</span>&nbsp;<span class="ident" id="6091193">d</span><span class="op" id="6091194">.</span><span class="ident" id="6091195">toRead</span><span class="op" id="6091201">[</span><span class="ident" id="6091202">n</span><span class="op" id="6091203">:</span><span class="op" id="6091204">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091209">return</span>&nbsp;<span class="ident" id="6091216">n</span><span class="op" id="6091217">,</span>&nbsp;<span class="builtintype" id="6091219">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091229">if</span>&nbsp;<span class="ident" id="6091232">d</span><span class="op" id="6091233">.</span><span class="ident" id="6091234">err</span>&nbsp;<span class="op" id="6091238">!=</span>&nbsp;<span class="builtintype" id="6091241">nil</span>&nbsp;<span class="op" id="6091245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091250">return</span>&nbsp;<span class="num" id="6091257">0</span><span class="op" id="6091258">,</span>&nbsp;<span class="ident" id="6091260">d</span><span class="op" id="6091261">.</span><span class="ident" id="6091262">err</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091272">d</span><span class="op" id="6091273">.</span><span class="ident" id="6091274">decode</span><span class="op" id="6091280">(</span><span class="op" id="6091281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091284">}</span><br>
<span class="lineno"></span><span class="op" id="6091286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="6091289">//&nbsp;decode&nbsp;decompresses&nbsp;bytes&nbsp;from&nbsp;r&nbsp;and&nbsp;leaves&nbsp;them&nbsp;in&nbsp;d.toRead.</span><br>
<span class="lineno"></span><span class="comment" id="6091354">//&nbsp;read&nbsp;specifies&nbsp;how&nbsp;to&nbsp;decode&nbsp;bytes&nbsp;into&nbsp;codes.</span><br>
<span class="lineno"></span><span class="comment" id="6091404">//&nbsp;litWidth&nbsp;is&nbsp;the&nbsp;width&nbsp;in&nbsp;bits&nbsp;of&nbsp;literal&nbsp;codes.</span><br>
<span class="lineno"></span><span class="keyword" id="6091455">func</span>&nbsp;<span class="op" id="6091460">(</span><span class="ident" id="6091461">d</span>&nbsp;<span class="op" id="6091463">*</span><span class="ident" id="6091464">decoder</span><span class="op" id="6091471">)</span>&nbsp;<span class="ident" id="6091473">decode</span><span class="op" id="6091479">(</span><span class="op" id="6091480">)</span>&nbsp;<span class="op" id="6091482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6091485">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;code&nbsp;stream,&nbsp;converting&nbsp;codes&nbsp;into&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091558">for</span>&nbsp;<span class="op" id="6091562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091566">code</span><span class="op" id="6091570">,</span>&nbsp;<span class="ident" id="6091572">err</span>&nbsp;<span class="op" id="6091576">:=</span>&nbsp;<span class="ident" id="6091579">d</span><span class="op" id="6091580">.</span><span class="ident" id="6091581">read</span><span class="op" id="6091585">(</span><span class="ident" id="6091586">d</span><span class="op" id="6091587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091591">if</span>&nbsp;<span class="ident" id="6091594">err</span>&nbsp;<span class="op" id="6091598">!=</span>&nbsp;<span class="builtintype" id="6091601">nil</span>&nbsp;<span class="op" id="6091605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091610">if</span>&nbsp;<span class="ident" id="6091613">err</span>&nbsp;<span class="op" id="6091617">==</span>&nbsp;<span class="ident" id="6091620">io</span><span class="op" id="6091622">.</span><span class="ident" id="6091623">EOF</span>&nbsp;<span class="op" id="6091627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091633">err</span>&nbsp;<span class="op" id="6091637">=</span>&nbsp;<span class="ident" id="6091639">io</span><span class="op" id="6091641">.</span><span class="ident" id="6091642">ErrUnexpectedEOF</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091667">d</span><span class="op" id="6091668">.</span><span class="ident" id="6091669">err</span>&nbsp;<span class="op" id="6091673">=</span>&nbsp;<span class="ident" id="6091675">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091682">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091695">switch</span>&nbsp;<span class="op" id="6091702">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091706">case</span>&nbsp;<span class="ident" id="6091711">code</span>&nbsp;<span class="op" id="6091716">&lt;</span>&nbsp;<span class="ident" id="6091718">d</span><span class="op" id="6091719">.</span><span class="ident" id="6091720">clear</span><span class="op" id="6091725">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6091730">//&nbsp;We&nbsp;have&nbsp;a&nbsp;literal&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091760">d</span><span class="op" id="6091761">.</span><span class="ident" id="6091762">output</span><span class="op" id="6091768">[</span><span class="ident" id="6091769">d</span><span class="op" id="6091770">.</span><span class="ident" id="6091771">o</span><span class="op" id="6091772">]</span>&nbsp;<span class="op" id="6091774">=</span>&nbsp;<span class="builtintype" id="6091776">uint8</span><span class="op" id="6091781">(</span><span class="ident" id="6091782">code</span><span class="op" id="6091786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091791">d</span><span class="op" id="6091792">.</span><span class="ident" id="6091793">o</span><span class="op" id="6091794">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091800">if</span>&nbsp;<span class="ident" id="6091803">d</span><span class="op" id="6091804">.</span><span class="ident" id="6091805">last</span>&nbsp;<span class="op" id="6091810">!=</span>&nbsp;<span class="ident" id="6091813">decoderInvalidCode</span>&nbsp;<span class="op" id="6091832">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6091838">//&nbsp;Save&nbsp;what&nbsp;the&nbsp;hi&nbsp;code&nbsp;expands&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091879">d</span><span class="op" id="6091880">.</span><span class="ident" id="6091881">suffix</span><span class="op" id="6091887">[</span><span class="ident" id="6091888">d</span><span class="op" id="6091889">.</span><span class="ident" id="6091890">hi</span><span class="op" id="6091892">]</span>&nbsp;<span class="op" id="6091894">=</span>&nbsp;<span class="builtintype" id="6091896">uint8</span><span class="op" id="6091901">(</span><span class="ident" id="6091902">code</span><span class="op" id="6091906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091912">d</span><span class="op" id="6091913">.</span><span class="ident" id="6091914">prefix</span><span class="op" id="6091920">[</span><span class="ident" id="6091921">d</span><span class="op" id="6091922">.</span><span class="ident" id="6091923">hi</span><span class="op" id="6091925">]</span>&nbsp;<span class="op" id="6091927">=</span>&nbsp;<span class="ident" id="6091929">d</span><span class="op" id="6091930">.</span><span class="ident" id="6091931">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091943">case</span>&nbsp;<span class="ident" id="6091948">code</span>&nbsp;<span class="op" id="6091953">==</span>&nbsp;<span class="ident" id="6091956">d</span><span class="op" id="6091957">.</span><span class="ident" id="6091958">clear</span><span class="op" id="6091963">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091968">d</span><span class="op" id="6091969">.</span><span class="ident" id="6091970">width</span>&nbsp;<span class="op" id="6091976">=</span>&nbsp;<span class="num" id="6091978">1</span>&nbsp;<span class="op" id="6091980">+</span>&nbsp;<span class="builtintype" id="6091982">uint</span><span class="op" id="6091986">(</span><span class="ident" id="6091987">d</span><span class="op" id="6091988">.</span><span class="ident" id="6091989">litWidth</span><span class="op" id="6091997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092002">d</span><span class="op" id="6092003">.</span><span class="ident" id="6092004">hi</span>&nbsp;<span class="op" id="6092007">=</span>&nbsp;<span class="ident" id="6092009">d</span><span class="op" id="6092010">.</span><span class="ident" id="6092011">eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092018">d</span><span class="op" id="6092019">.</span><span class="ident" id="6092020">overflow</span>&nbsp;<span class="op" id="6092029">=</span>&nbsp;<span class="num" id="6092031">1</span>&nbsp;<span class="op" id="6092033">&lt;&lt;</span>&nbsp;<span class="ident" id="6092036">d</span><span class="op" id="6092037">.</span><span class="ident" id="6092038">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092047">d</span><span class="op" id="6092048">.</span><span class="ident" id="6092049">last</span>&nbsp;<span class="op" id="6092054">=</span>&nbsp;<span class="ident" id="6092056">decoderInvalidCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092078">continue</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092089">case</span>&nbsp;<span class="ident" id="6092094">code</span>&nbsp;<span class="op" id="6092099">==</span>&nbsp;<span class="ident" id="6092102">d</span><span class="op" id="6092103">.</span><span class="ident" id="6092104">eof</span><span class="op" id="6092107">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092112">d</span><span class="op" id="6092113">.</span><span class="ident" id="6092114">flush</span><span class="op" id="6092119">(</span><span class="op" id="6092120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092125">d</span><span class="op" id="6092126">.</span><span class="ident" id="6092127">err</span>&nbsp;<span class="op" id="6092131">=</span>&nbsp;<span class="ident" id="6092133">io</span><span class="op" id="6092135">.</span><span class="ident" id="6092136">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092143">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092152">case</span>&nbsp;<span class="ident" id="6092157">code</span>&nbsp;<span class="op" id="6092162">&lt;=</span>&nbsp;<span class="ident" id="6092165">d</span><span class="op" id="6092166">.</span><span class="ident" id="6092167">hi</span><span class="op" id="6092169">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092174">c</span><span class="op" id="6092175">,</span>&nbsp;<span class="ident" id="6092177">i</span>&nbsp;<span class="op" id="6092179">:=</span>&nbsp;<span class="ident" id="6092182">code</span><span class="op" id="6092186">,</span>&nbsp;<span class="builtinfunc" id="6092188">len</span><span class="op" id="6092191">(</span><span class="ident" id="6092192">d</span><span class="op" id="6092193">.</span><span class="ident" id="6092194">output</span><span class="op" id="6092200">)</span><span class="op" id="6092201">-</span><span class="num" id="6092202">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092207">if</span>&nbsp;<span class="ident" id="6092210">code</span>&nbsp;<span class="op" id="6092215">==</span>&nbsp;<span class="ident" id="6092218">d</span><span class="op" id="6092219">.</span><span class="ident" id="6092220">hi</span>&nbsp;<span class="op" id="6092223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6092229">//&nbsp;code&nbsp;==&nbsp;hi&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;which&nbsp;expands&nbsp;to&nbsp;the&nbsp;last&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6092301">//&nbsp;followed&nbsp;by&nbsp;the&nbsp;head&nbsp;of&nbsp;the&nbsp;last&nbsp;expansion.&nbsp;To&nbsp;find&nbsp;the&nbsp;head,&nbsp;we&nbsp;walk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6092378">//&nbsp;the&nbsp;prefix&nbsp;chain&nbsp;until&nbsp;we&nbsp;find&nbsp;a&nbsp;literal&nbsp;code.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092432">c</span>&nbsp;<span class="op" id="6092434">=</span>&nbsp;<span class="ident" id="6092436">d</span><span class="op" id="6092437">.</span><span class="ident" id="6092438">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092447">for</span>&nbsp;<span class="ident" id="6092451">c</span>&nbsp;<span class="op" id="6092453">&gt;=</span>&nbsp;<span class="ident" id="6092456">d</span><span class="op" id="6092457">.</span><span class="ident" id="6092458">clear</span>&nbsp;<span class="op" id="6092464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092471">c</span>&nbsp;<span class="op" id="6092473">=</span>&nbsp;<span class="ident" id="6092475">d</span><span class="op" id="6092476">.</span><span class="ident" id="6092477">prefix</span><span class="op" id="6092483">[</span><span class="ident" id="6092484">c</span><span class="op" id="6092485">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6092491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092497">d</span><span class="op" id="6092498">.</span><span class="ident" id="6092499">output</span><span class="op" id="6092505">[</span><span class="ident" id="6092506">i</span><span class="op" id="6092507">]</span>&nbsp;<span class="op" id="6092509">=</span>&nbsp;<span class="builtintype" id="6092511">uint8</span><span class="op" id="6092516">(</span><span class="ident" id="6092517">c</span><span class="op" id="6092518">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092524">i</span><span class="op" id="6092525">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092532">c</span>&nbsp;<span class="op" id="6092534">=</span>&nbsp;<span class="ident" id="6092536">d</span><span class="op" id="6092537">.</span><span class="ident" id="6092538">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6092546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6092551">//&nbsp;Copy&nbsp;the&nbsp;suffix&nbsp;chain&nbsp;into&nbsp;output&nbsp;and&nbsp;then&nbsp;write&nbsp;that&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092617">for</span>&nbsp;<span class="ident" id="6092621">c</span>&nbsp;<span class="op" id="6092623">&gt;=</span>&nbsp;<span class="ident" id="6092626">d</span><span class="op" id="6092627">.</span><span class="ident" id="6092628">clear</span>&nbsp;<span class="op" id="6092634">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092640">d</span><span class="op" id="6092641">.</span><span class="ident" id="6092642">output</span><span class="op" id="6092648">[</span><span class="ident" id="6092649">i</span><span class="op" id="6092650">]</span>&nbsp;<span class="op" id="6092652">=</span>&nbsp;<span class="ident" id="6092654">d</span><span class="op" id="6092655">.</span><span class="ident" id="6092656">suffix</span><span class="op" id="6092662">[</span><span class="ident" id="6092663">c</span><span class="op" id="6092664">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092670">i</span><span class="op" id="6092671">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092678">c</span>&nbsp;<span class="op" id="6092680">=</span>&nbsp;<span class="ident" id="6092682">d</span><span class="op" id="6092683">.</span><span class="ident" id="6092684">prefix</span><span class="op" id="6092690">[</span><span class="ident" id="6092691">c</span><span class="op" id="6092692">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6092697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092702">d</span><span class="op" id="6092703">.</span><span class="ident" id="6092704">output</span><span class="op" id="6092710">[</span><span class="ident" id="6092711">i</span><span class="op" id="6092712">]</span>&nbsp;<span class="op" id="6092714">=</span>&nbsp;<span class="builtintype" id="6092716">uint8</span><span class="op" id="6092721">(</span><span class="ident" id="6092722">c</span><span class="op" id="6092723">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092728">d</span><span class="op" id="6092729">.</span><span class="ident" id="6092730">o</span>&nbsp;<span class="op" id="6092732">+=</span>&nbsp;<span class="builtinfunc" id="6092735">copy</span><span class="op" id="6092739">(</span><span class="ident" id="6092740">d</span><span class="op" id="6092741">.</span><span class="ident" id="6092742">output</span><span class="op" id="6092748">[</span><span class="ident" id="6092749">d</span><span class="op" id="6092750">.</span><span class="ident" id="6092751">o</span><span class="op" id="6092752">:</span><span class="op" id="6092753">]</span><span class="op" id="6092754">,</span>&nbsp;<span class="ident" id="6092756">d</span><span class="op" id="6092757">.</span><span class="ident" id="6092758">output</span><span class="op" id="6092764">[</span><span class="ident" id="6092765">i</span><span class="op" id="6092766">:</span><span class="op" id="6092767">]</span><span class="op" id="6092768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092773">if</span>&nbsp;<span class="ident" id="6092776">d</span><span class="op" id="6092777">.</span><span class="ident" id="6092778">last</span>&nbsp;<span class="op" id="6092783">!=</span>&nbsp;<span class="ident" id="6092786">decoderInvalidCode</span>&nbsp;<span class="op" id="6092805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6092811">//&nbsp;Save&nbsp;what&nbsp;the&nbsp;hi&nbsp;code&nbsp;expands&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092852">d</span><span class="op" id="6092853">.</span><span class="ident" id="6092854">suffix</span><span class="op" id="6092860">[</span><span class="ident" id="6092861">d</span><span class="op" id="6092862">.</span><span class="ident" id="6092863">hi</span><span class="op" id="6092865">]</span>&nbsp;<span class="op" id="6092867">=</span>&nbsp;<span class="builtintype" id="6092869">uint8</span><span class="op" id="6092874">(</span><span class="ident" id="6092875">c</span><span class="op" id="6092876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092882">d</span><span class="op" id="6092883">.</span><span class="ident" id="6092884">prefix</span><span class="op" id="6092890">[</span><span class="ident" id="6092891">d</span><span class="op" id="6092892">.</span><span class="ident" id="6092893">hi</span><span class="op" id="6092895">]</span>&nbsp;<span class="op" id="6092897">=</span>&nbsp;<span class="ident" id="6092899">d</span><span class="op" id="6092900">.</span><span class="ident" id="6092901">last</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6092909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092913">default</span><span class="op" id="6092920">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092925">d</span><span class="op" id="6092926">.</span><span class="ident" id="6092927">err</span>&nbsp;<span class="op" id="6092931">=</span>&nbsp;<span class="ident" id="6092933">errors</span><span class="op" id="6092939">.</span><span class="ident" id="6092940">New</span><span class="op" id="6092943">(</span><span class="string" id="6092944">&#34;lzw:&nbsp;invalid&nbsp;code&#34;</span><span class="op" id="6092963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092968">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6092977">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092981">d</span><span class="op" id="6092982">.</span><span class="ident" id="6092983">last</span><span class="op" id="6092987">,</span>&nbsp;<span class="ident" id="6092989">d</span><span class="op" id="6092990">.</span><span class="ident" id="6092991">hi</span>&nbsp;<span class="op" id="6092994">=</span>&nbsp;<span class="ident" id="6092996">code</span><span class="op" id="6093000">,</span>&nbsp;<span class="ident" id="6093002">d</span><span class="op" id="6093003">.</span><span class="ident" id="6093004">hi</span><span class="op" id="6093006">+</span><span class="num" id="6093007">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093011">if</span>&nbsp;<span class="ident" id="6093014">d</span><span class="op" id="6093015">.</span><span class="ident" id="6093016">hi</span>&nbsp;<span class="op" id="6093019">&gt;=</span>&nbsp;<span class="ident" id="6093022">d</span><span class="op" id="6093023">.</span><span class="ident" id="6093024">overflow</span>&nbsp;<span class="op" id="6093033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093038">if</span>&nbsp;<span class="ident" id="6093041">d</span><span class="op" id="6093042">.</span><span class="ident" id="6093043">width</span>&nbsp;<span class="op" id="6093049">==</span>&nbsp;<span class="ident" id="6093052">maxWidth</span>&nbsp;<span class="op" id="6093061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093067">d</span><span class="op" id="6093068">.</span><span class="ident" id="6093069">last</span>&nbsp;<span class="op" id="6093074">=</span>&nbsp;<span class="ident" id="6093076">decoderInvalidCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6093098">}</span>&nbsp;<span class="keyword" id="6093100">else</span>&nbsp;<span class="op" id="6093105">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093111">d</span><span class="op" id="6093112">.</span><span class="ident" id="6093113">width</span><span class="op" id="6093118">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093125">d</span><span class="op" id="6093126">.</span><span class="ident" id="6093127">overflow</span>&nbsp;<span class="op" id="6093136">&lt;&lt;=</span>&nbsp;<span class="num" id="6093140">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6093145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6093149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093153">if</span>&nbsp;<span class="ident" id="6093156">d</span><span class="op" id="6093157">.</span><span class="ident" id="6093158">o</span>&nbsp;<span class="op" id="6093160">&gt;=</span>&nbsp;<span class="ident" id="6093163">flushBuffer</span>&nbsp;<span class="op" id="6093175">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093180">d</span><span class="op" id="6093181">.</span><span class="ident" id="6093182">flush</span><span class="op" id="6093187">(</span><span class="op" id="6093188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093193">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6093202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6093205">}</span><br>
<span class="lineno"></span><span class="op" id="6093207">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="6093210">func</span>&nbsp;<span class="op" id="6093215">(</span><span class="ident" id="6093216">d</span>&nbsp;<span class="op" id="6093218">*</span><span class="ident" id="6093219">decoder</span><span class="op" id="6093226">)</span>&nbsp;<span class="ident" id="6093228">flush</span><span class="op" id="6093233">(</span><span class="op" id="6093234">)</span>&nbsp;<span class="op" id="6093236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093239">d</span><span class="op" id="6093240">.</span><span class="ident" id="6093241">toRead</span>&nbsp;<span class="op" id="6093248">=</span>&nbsp;<span class="ident" id="6093250">d</span><span class="op" id="6093251">.</span><span class="ident" id="6093252">output</span><span class="op" id="6093258">[</span><span class="op" id="6093259">:</span><span class="ident" id="6093260">d</span><span class="op" id="6093261">.</span><span class="ident" id="6093262">o</span><span class="op" id="6093263">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093266">d</span><span class="op" id="6093267">.</span><span class="ident" id="6093268">o</span>&nbsp;<span class="op" id="6093270">=</span>&nbsp;<span class="num" id="6093272">0</span><br>
<span class="lineno"></span><span class="op" id="6093274">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="6093277">var</span>&nbsp;<span class="ident" id="6093281">errClosed</span>&nbsp;<span class="op" id="6093291">=</span>&nbsp;<span class="ident" id="6093293">errors</span><span class="op" id="6093299">.</span><span class="ident" id="6093300">New</span><span class="op" id="6093303">(</span><span class="string" id="6093304">&#34;compress/lzw:&nbsp;reader/writer&nbsp;is&nbsp;closed&#34;</span><span class="op" id="6093343">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6093346">func</span>&nbsp;<span class="op" id="6093351">(</span><span class="ident" id="6093352">d</span>&nbsp;<span class="op" id="6093354">*</span><span class="ident" id="6093355">decoder</span><span class="op" id="6093362">)</span>&nbsp;<span class="ident" id="6093364">Close</span><span class="op" id="6093369">(</span><span class="op" id="6093370">)</span>&nbsp;<span class="builtintype" id="6093372">error</span>&nbsp;<span class="op" id="6093378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093381">d</span><span class="op" id="6093382">.</span><span class="ident" id="6093383">err</span>&nbsp;<span class="op" id="6093387">=</span>&nbsp;<span class="ident" id="6093389">errClosed</span>&nbsp;<span class="comment" id="6093399">//&nbsp;in&nbsp;case&nbsp;any&nbsp;Reads&nbsp;come&nbsp;along</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093432">return</span>&nbsp;<span class="builtintype" id="6093439">nil</span><br>
<span class="lineno"></span><span class="op" id="6093443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6093446">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;io.ReadCloser.</span><br>
<span class="lineno"></span><span class="comment" id="6093488">//&nbsp;Reads&nbsp;from&nbsp;the&nbsp;returned&nbsp;io.ReadCloser&nbsp;read&nbsp;and&nbsp;decompress&nbsp;data&nbsp;from&nbsp;r.</span><br>
<span class="lineno">225</span><span class="comment" id="6093562">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="6093609">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="6093671">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="6093745">//&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="6093766">//&nbsp;The&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;literal&nbsp;codes,&nbsp;litWidth,&nbsp;must&nbsp;be&nbsp;in&nbsp;the</span><br>
<span class="lineno">230</span><span class="comment" id="6093839">//&nbsp;range&nbsp;[2,8]&nbsp;and&nbsp;is&nbsp;typically&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="6093874">func</span>&nbsp;<span class="ident" id="6093879">NewReader</span><span class="op" id="6093888">(</span><span class="ident" id="6093889">r</span>&nbsp;<span class="ident" id="6093891">io</span><span class="op" id="6093893">.</span><span class="ident" id="6093894">Reader</span><span class="op" id="6093900">,</span>&nbsp;<span class="ident" id="6093902">order</span>&nbsp;<span class="ident" id="6093908">Order</span><span class="op" id="6093913">,</span>&nbsp;<span class="ident" id="6093915">litWidth</span>&nbsp;<span class="builtintype" id="6093924">int</span><span class="op" id="6093927">)</span>&nbsp;<span class="ident" id="6093929">io</span><span class="op" id="6093931">.</span><span class="ident" id="6093932">ReadCloser</span>&nbsp;<span class="op" id="6093943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093946">d</span>&nbsp;<span class="op" id="6093948">:=</span>&nbsp;<span class="builtinfunc" id="6093951">new</span><span class="op" id="6093954">(</span><span class="ident" id="6093955">decoder</span><span class="op" id="6093962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093965">switch</span>&nbsp;<span class="ident" id="6093972">order</span>&nbsp;<span class="op" id="6093978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093981">case</span>&nbsp;<span class="ident" id="6093986">LSB</span><span class="op" id="6093989">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093993">d</span><span class="op" id="6093994">.</span><span class="ident" id="6093995">read</span>&nbsp;<span class="op" id="6094000">=</span>&nbsp;<span class="op" id="6094002">(</span><span class="op" id="6094003">*</span><span class="ident" id="6094004">decoder</span><span class="op" id="6094011">)</span><span class="op" id="6094012">.</span><span class="ident" id="6094013">readLSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094022">case</span>&nbsp;<span class="ident" id="6094027">MSB</span><span class="op" id="6094030">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094034">d</span><span class="op" id="6094035">.</span><span class="ident" id="6094036">read</span>&nbsp;<span class="op" id="6094041">=</span>&nbsp;<span class="op" id="6094043">(</span><span class="op" id="6094044">*</span><span class="ident" id="6094045">decoder</span><span class="op" id="6094052">)</span><span class="op" id="6094053">.</span><span class="ident" id="6094054">readMSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094063">default</span><span class="op" id="6094070">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094074">d</span><span class="op" id="6094075">.</span><span class="ident" id="6094076">err</span>&nbsp;<span class="op" id="6094080">=</span>&nbsp;<span class="ident" id="6094082">errors</span><span class="op" id="6094088">.</span><span class="ident" id="6094089">New</span><span class="op" id="6094092">(</span><span class="string" id="6094093">&#34;lzw:&nbsp;unknown&nbsp;order&#34;</span><span class="op" id="6094113">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094117">return</span>&nbsp;<span class="ident" id="6094124">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6094127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094130">if</span>&nbsp;<span class="ident" id="6094133">litWidth</span>&nbsp;<span class="op" id="6094142">&lt;</span>&nbsp;<span class="num" id="6094144">2</span>&nbsp;<span class="op" id="6094146">||</span>&nbsp;<span class="num" id="6094149">8</span>&nbsp;<span class="op" id="6094151">&lt;</span>&nbsp;<span class="ident" id="6094153">litWidth</span>&nbsp;<span class="op" id="6094162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094166">d</span><span class="op" id="6094167">.</span><span class="ident" id="6094168">err</span>&nbsp;<span class="op" id="6094172">=</span>&nbsp;<span class="ident" id="6094174">fmt</span><span class="op" id="6094177">.</span><span class="ident" id="6094178">Errorf</span><span class="op" id="6094184">(</span><span class="string" id="6094185">&#34;lzw:&nbsp;litWidth&nbsp;%d&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="6094216">,</span>&nbsp;<span class="ident" id="6094218">litWidth</span><span class="op" id="6094226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094230">return</span>&nbsp;<span class="ident" id="6094237">d</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6094240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094243">if</span>&nbsp;<span class="ident" id="6094246">br</span><span class="op" id="6094248">,</span>&nbsp;<span class="ident" id="6094250">ok</span>&nbsp;<span class="op" id="6094253">:=</span>&nbsp;<span class="ident" id="6094256">r</span><span class="op" id="6094257">.</span><span class="op" id="6094258">(</span><span class="ident" id="6094259">io</span><span class="op" id="6094261">.</span><span class="ident" id="6094262">ByteReader</span><span class="op" id="6094272">)</span><span class="op" id="6094273">;</span>&nbsp;<span class="ident" id="6094275">ok</span>&nbsp;<span class="op" id="6094278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094282">d</span><span class="op" id="6094283">.</span><span class="ident" id="6094284">r</span>&nbsp;<span class="op" id="6094286">=</span>&nbsp;<span class="ident" id="6094288">br</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6094292">}</span>&nbsp;<span class="keyword" id="6094294">else</span>&nbsp;<span class="op" id="6094299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094303">d</span><span class="op" id="6094304">.</span><span class="ident" id="6094305">r</span>&nbsp;<span class="op" id="6094307">=</span>&nbsp;<span class="ident" id="6094309">bufio</span><span class="op" id="6094314">.</span><span class="ident" id="6094315">NewReader</span><span class="op" id="6094324">(</span><span class="ident" id="6094325">r</span><span class="op" id="6094326">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6094329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094332">d</span><span class="op" id="6094333">.</span><span class="ident" id="6094334">litWidth</span>&nbsp;<span class="op" id="6094343">=</span>&nbsp;<span class="ident" id="6094345">litWidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094355">d</span><span class="op" id="6094356">.</span><span class="ident" id="6094357">width</span>&nbsp;<span class="op" id="6094363">=</span>&nbsp;<span class="num" id="6094365">1</span>&nbsp;<span class="op" id="6094367">+</span>&nbsp;<span class="builtintype" id="6094369">uint</span><span class="op" id="6094373">(</span><span class="ident" id="6094374">litWidth</span><span class="op" id="6094382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094385">d</span><span class="op" id="6094386">.</span><span class="ident" id="6094387">clear</span>&nbsp;<span class="op" id="6094393">=</span>&nbsp;<span class="builtintype" id="6094395">uint16</span><span class="op" id="6094401">(</span><span class="num" id="6094402">1</span><span class="op" id="6094403">)</span>&nbsp;<span class="op" id="6094405">&lt;&lt;</span>&nbsp;<span class="builtintype" id="6094408">uint</span><span class="op" id="6094412">(</span><span class="ident" id="6094413">litWidth</span><span class="op" id="6094421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094424">d</span><span class="op" id="6094425">.</span><span class="ident" id="6094426">eof</span><span class="op" id="6094429">,</span>&nbsp;<span class="ident" id="6094431">d</span><span class="op" id="6094432">.</span><span class="ident" id="6094433">hi</span>&nbsp;<span class="op" id="6094436">=</span>&nbsp;<span class="ident" id="6094438">d</span><span class="op" id="6094439">.</span><span class="ident" id="6094440">clear</span><span class="op" id="6094445">+</span><span class="num" id="6094446">1</span><span class="op" id="6094447">,</span>&nbsp;<span class="ident" id="6094449">d</span><span class="op" id="6094450">.</span><span class="ident" id="6094451">clear</span><span class="op" id="6094456">+</span><span class="num" id="6094457">1</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094460">d</span><span class="op" id="6094461">.</span><span class="ident" id="6094462">overflow</span>&nbsp;<span class="op" id="6094471">=</span>&nbsp;<span class="builtintype" id="6094473">uint16</span><span class="op" id="6094479">(</span><span class="num" id="6094480">1</span><span class="op" id="6094481">)</span>&nbsp;<span class="op" id="6094483">&lt;&lt;</span>&nbsp;<span class="ident" id="6094486">d</span><span class="op" id="6094487">.</span><span class="ident" id="6094488">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094495">d</span><span class="op" id="6094496">.</span><span class="ident" id="6094497">last</span>&nbsp;<span class="op" id="6094502">=</span>&nbsp;<span class="ident" id="6094504">decoderInvalidCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094525">return</span>&nbsp;<span class="ident" id="6094532">d</span><br>
<span class="lineno"></span><span class="op" id="6094534">}</span>
</div>
</body>
</html>
