<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6397186">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6397241">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6397295">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6397346">//&nbsp;+build&nbsp;!windows,!nacl,!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6397379">//&nbsp;Package&nbsp;syslog&nbsp;provides&nbsp;a&nbsp;simple&nbsp;interface&nbsp;to&nbsp;the&nbsp;system&nbsp;log</span><br>
<span class="lineno"></span><span class="comment" id="6397443">//&nbsp;service.&nbsp;It&nbsp;can&nbsp;send&nbsp;messages&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon&nbsp;using&nbsp;UNIX</span><br>
<span class="lineno"></span><span class="comment" id="6397508">//&nbsp;domain&nbsp;sockets,&nbsp;UDP&nbsp;or&nbsp;TCP.</span><br>
<span class="lineno">10</span><span class="comment" id="6397539">//</span><br>
<span class="lineno"></span><span class="comment" id="6397542">//&nbsp;Only&nbsp;one&nbsp;call&nbsp;to&nbsp;Dial&nbsp;is&nbsp;necessary.&nbsp;On&nbsp;write&nbsp;failures,</span><br>
<span class="lineno"></span><span class="comment" id="6397600">//&nbsp;the&nbsp;syslog&nbsp;client&nbsp;will&nbsp;attempt&nbsp;to&nbsp;reconnect&nbsp;to&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="6397661">//&nbsp;and&nbsp;write&nbsp;again.</span><br>
<span class="lineno"></span><span class="keyword" id="6397681">package</span>&nbsp;<span class="ident" id="6397689">syslog</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6397697">import</span>&nbsp;<span class="op" id="6397704">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6397707">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6397717">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6397724">&#34;log&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6397731">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6397738">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6397744">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6397755">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6397763">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6397770">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6397773">//&nbsp;The&nbsp;Priority&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;the&nbsp;syslog&nbsp;facility&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6397833">//&nbsp;severity.&nbsp;For&nbsp;example,&nbsp;LOG_ALERT&nbsp;|&nbsp;LOG_FTP&nbsp;sends&nbsp;an&nbsp;alert&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6397903">//&nbsp;message&nbsp;from&nbsp;the&nbsp;FTP&nbsp;facility.&nbsp;The&nbsp;default&nbsp;severity&nbsp;is&nbsp;LOG_EMERG;</span><br>
<span class="lineno">30</span><span class="comment" id="6397972">//&nbsp;the&nbsp;default&nbsp;facility&nbsp;is&nbsp;LOG_KERN.</span><br>
<span class="lineno"></span><span class="keyword" id="6398009">type</span>&nbsp;<span class="ident" id="6398014">Priority</span>&nbsp;<span class="builtintype" id="6398023">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6398028">const</span>&nbsp;<span class="ident" id="6398034">severityMask</span>&nbsp;<span class="op" id="6398047">=</span>&nbsp;<span class="num" id="6398049">0x07</span><br>
<span class="lineno"></span><span class="keyword" id="6398054">const</span>&nbsp;<span class="ident" id="6398060">facilityMask</span>&nbsp;<span class="op" id="6398073">=</span>&nbsp;<span class="num" id="6398075">0xf8</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="6398081">const</span>&nbsp;<span class="op" id="6398087">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6398090">//&nbsp;Severity.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6398105">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6398141">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398189">LOG_EMERG</span>&nbsp;<span class="ident" id="6398199">Priority</span>&nbsp;<span class="op" id="6398208">=</span>&nbsp;<span class="ident" id="6398210">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398216">LOG_ALERT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398227">LOG_CRIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398237">LOG_ERR</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398246">LOG_WARNING</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398259">LOG_NOTICE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398271">LOG_INFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398281">LOG_DEBUG</span><br>
<span class="lineno"></span><span class="op" id="6398291">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6398294">const</span>&nbsp;<span class="op" id="6398300">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6398303">//&nbsp;Facility.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6398318">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6398354">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;up&nbsp;to&nbsp;LOG_FTP&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398416">LOG_KERN</span>&nbsp;<span class="ident" id="6398425">Priority</span>&nbsp;<span class="op" id="6398434">=</span>&nbsp;<span class="ident" id="6398436">iota</span>&nbsp;<span class="op" id="6398441">&lt;&lt;</span>&nbsp;<span class="num" id="6398444">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398447">LOG_USER</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398457">LOG_MAIL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398467">LOG_DAEMON</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398479">LOG_AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398489">LOG_SYSLOG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398501">LOG_LPR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398510">LOG_NEWS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398520">LOG_UUCP</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398530">LOG_CRON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398540">LOG_AUTHPRIV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398554">LOG_FTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398563">_</span>&nbsp;<span class="comment" id="6398565">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398576">_</span>&nbsp;<span class="comment" id="6398578">//&nbsp;unused</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398589">_</span>&nbsp;<span class="comment" id="6398591">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398602">_</span>&nbsp;<span class="comment" id="6398604">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398615">LOG_LOCAL0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398627">LOG_LOCAL1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398639">LOG_LOCAL2</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398651">LOG_LOCAL3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398663">LOG_LOCAL4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398675">LOG_LOCAL5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398687">LOG_LOCAL6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398699">LOG_LOCAL7</span><br>
<span class="lineno">80</span><span class="op" id="6398710">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6398713">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6398761">type</span>&nbsp;<span class="ident" id="6398766">Writer</span>&nbsp;<span class="keyword" id="6398773">struct</span>&nbsp;<span class="op" id="6398780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398783">priority</span>&nbsp;<span class="ident" id="6398792">Priority</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398802">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6398811">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398819">hostname</span>&nbsp;<span class="builtintype" id="6398828">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398836">network</span>&nbsp;&nbsp;<span class="builtintype" id="6398845">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398853">raddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6398862">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398871">mu</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6398876">sync</span><span class="op" id="6398880">.</span><span class="ident" id="6398881">Mutex</span>&nbsp;<span class="comment" id="6398887">//&nbsp;guards&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398903">conn</span>&nbsp;<span class="ident" id="6398908">serverConn</span><br>
<span class="lineno"></span><span class="op" id="6398919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6398922">//&nbsp;This&nbsp;interface&nbsp;and&nbsp;the&nbsp;separate&nbsp;syslog_unix.go&nbsp;file&nbsp;exist&nbsp;for</span><br>
<span class="lineno">95</span><span class="comment" id="6398987">//&nbsp;Solaris&nbsp;support&nbsp;as&nbsp;implemented&nbsp;by&nbsp;gccgo.&nbsp;&nbsp;On&nbsp;Solaris&nbsp;you&nbsp;can&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="6399055">//&nbsp;simply&nbsp;open&nbsp;a&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.&nbsp;&nbsp;The&nbsp;gccgo</span><br>
<span class="lineno"></span><span class="comment" id="6399120">//&nbsp;sources&nbsp;have&nbsp;a&nbsp;syslog_solaris.go&nbsp;file&nbsp;that&nbsp;implements&nbsp;unixSyslog&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6399191">//&nbsp;return&nbsp;a&nbsp;type&nbsp;that&nbsp;satisfies&nbsp;this&nbsp;interface&nbsp;and&nbsp;simply&nbsp;calls&nbsp;the&nbsp;C</span><br>
<span class="lineno"></span><span class="comment" id="6399261">//&nbsp;library&nbsp;syslog&nbsp;function.</span><br>
<span class="lineno">100</span><span class="keyword" id="6399289">type</span>&nbsp;<span class="ident" id="6399294">serverConn</span>&nbsp;<span class="keyword" id="6399305">interface</span>&nbsp;<span class="op" id="6399315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399318">writeString</span><span class="op" id="6399329">(</span><span class="ident" id="6399330">p</span>&nbsp;<span class="ident" id="6399332">Priority</span><span class="op" id="6399340">,</span>&nbsp;<span class="ident" id="6399342">hostname</span><span class="op" id="6399350">,</span>&nbsp;<span class="ident" id="6399352">tag</span><span class="op" id="6399355">,</span>&nbsp;<span class="ident" id="6399357">s</span><span class="op" id="6399358">,</span>&nbsp;<span class="ident" id="6399360">nl</span>&nbsp;<span class="builtintype" id="6399363">string</span><span class="op" id="6399369">)</span>&nbsp;<span class="builtintype" id="6399371">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6399378">close</span><span class="op" id="6399383">(</span><span class="op" id="6399384">)</span>&nbsp;<span class="builtintype" id="6399386">error</span><br>
<span class="lineno"></span><span class="op" id="6399392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6399395">type</span>&nbsp;<span class="ident" id="6399400">netConn</span>&nbsp;<span class="keyword" id="6399408">struct</span>&nbsp;<span class="op" id="6399415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399418">local</span>&nbsp;<span class="builtintype" id="6399424">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399430">conn</span>&nbsp;&nbsp;<span class="ident" id="6399436">net</span><span class="op" id="6399439">.</span><span class="ident" id="6399440">Conn</span><br>
<span class="lineno"></span><span class="op" id="6399445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6399448">//&nbsp;New&nbsp;establishes&nbsp;a&nbsp;new&nbsp;connection&nbsp;to&nbsp;the&nbsp;system&nbsp;log&nbsp;daemon.&nbsp;&nbsp;Each</span><br>
<span class="lineno"></span><span class="comment" id="6399516">//&nbsp;write&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6399583">//&nbsp;priority&nbsp;and&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6399607">func</span>&nbsp;<span class="ident" id="6399612">New</span><span class="op" id="6399615">(</span><span class="ident" id="6399616">priority</span>&nbsp;<span class="ident" id="6399625">Priority</span><span class="op" id="6399633">,</span>&nbsp;<span class="ident" id="6399635">tag</span>&nbsp;<span class="builtintype" id="6399639">string</span><span class="op" id="6399645">)</span>&nbsp;<span class="op" id="6399647">(</span><span class="ident" id="6399648">w</span>&nbsp;<span class="op" id="6399650">*</span><span class="ident" id="6399651">Writer</span><span class="op" id="6399657">,</span>&nbsp;<span class="ident" id="6399659">err</span>&nbsp;<span class="builtintype" id="6399663">error</span><span class="op" id="6399668">)</span>&nbsp;<span class="op" id="6399670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399673">return</span>&nbsp;<span class="ident" id="6399680">Dial</span><span class="op" id="6399684">(</span><span class="string" id="6399685">&#34;&#34;</span><span class="op" id="6399687">,</span>&nbsp;<span class="string" id="6399689">&#34;&#34;</span><span class="op" id="6399691">,</span>&nbsp;<span class="ident" id="6399693">priority</span><span class="op" id="6399701">,</span>&nbsp;<span class="ident" id="6399703">tag</span><span class="op" id="6399706">)</span><br>
<span class="lineno">115</span><span class="op" id="6399708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6399711">//&nbsp;Dial&nbsp;establishes&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;log&nbsp;daemon&nbsp;by&nbsp;connecting&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6399777">//&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;specified&nbsp;network.&nbsp;&nbsp;Each&nbsp;write&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="6399848">//&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given&nbsp;facility,&nbsp;severity&nbsp;and</span><br>
<span class="lineno">120</span><span class="comment" id="6399916">//&nbsp;tag.</span><br>
<span class="lineno"></span><span class="comment" id="6399924">//&nbsp;If&nbsp;network&nbsp;is&nbsp;empty,&nbsp;Dial&nbsp;will&nbsp;connect&nbsp;to&nbsp;the&nbsp;local&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6399994">func</span>&nbsp;<span class="ident" id="6399999">Dial</span><span class="op" id="6400003">(</span><span class="ident" id="6400004">network</span><span class="op" id="6400011">,</span>&nbsp;<span class="ident" id="6400013">raddr</span>&nbsp;<span class="builtintype" id="6400019">string</span><span class="op" id="6400025">,</span>&nbsp;<span class="ident" id="6400027">priority</span>&nbsp;<span class="ident" id="6400036">Priority</span><span class="op" id="6400044">,</span>&nbsp;<span class="ident" id="6400046">tag</span>&nbsp;<span class="builtintype" id="6400050">string</span><span class="op" id="6400056">)</span>&nbsp;<span class="op" id="6400058">(</span><span class="op" id="6400059">*</span><span class="ident" id="6400060">Writer</span><span class="op" id="6400066">,</span>&nbsp;<span class="builtintype" id="6400068">error</span><span class="op" id="6400073">)</span>&nbsp;<span class="op" id="6400075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400078">if</span>&nbsp;<span class="ident" id="6400081">priority</span>&nbsp;<span class="op" id="6400090">&lt;</span>&nbsp;<span class="num" id="6400092">0</span>&nbsp;<span class="op" id="6400094">||</span>&nbsp;<span class="ident" id="6400097">priority</span>&nbsp;<span class="op" id="6400106">&gt;</span>&nbsp;<span class="ident" id="6400108">LOG_LOCAL7</span><span class="op" id="6400118">|</span><span class="ident" id="6400119">LOG_DEBUG</span>&nbsp;<span class="op" id="6400129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400133">return</span>&nbsp;<span class="ident" id="6400140">nil</span><span class="op" id="6400143">,</span>&nbsp;<span class="ident" id="6400145">errors</span><span class="op" id="6400151">.</span><span class="ident" id="6400152">New</span><span class="op" id="6400155">(</span><span class="string" id="6400156">&#34;log/syslog:&nbsp;invalid&nbsp;priority&#34;</span><span class="op" id="6400186">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400193">if</span>&nbsp;<span class="ident" id="6400196">tag</span>&nbsp;<span class="op" id="6400200">==</span>&nbsp;<span class="string" id="6400203">&#34;&#34;</span>&nbsp;<span class="op" id="6400206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400210">tag</span>&nbsp;<span class="op" id="6400214">=</span>&nbsp;<span class="ident" id="6400216">os</span><span class="op" id="6400218">.</span><span class="ident" id="6400219">Args</span><span class="op" id="6400223">[</span><span class="num" id="6400224">0</span><span class="op" id="6400225">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400228">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400231">hostname</span><span class="op" id="6400239">,</span>&nbsp;<span class="ident" id="6400241">_</span>&nbsp;<span class="op" id="6400243">:=</span>&nbsp;<span class="ident" id="6400246">os</span><span class="op" id="6400248">.</span><span class="ident" id="6400249">Hostname</span><span class="op" id="6400257">(</span><span class="op" id="6400258">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400262">w</span>&nbsp;<span class="op" id="6400264">:=</span>&nbsp;<span class="op" id="6400267">&amp;</span><span class="ident" id="6400268">Writer</span><span class="op" id="6400274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400278">priority</span><span class="op" id="6400286">:</span>&nbsp;<span class="ident" id="6400288">priority</span><span class="op" id="6400296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400300">tag</span><span class="op" id="6400303">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6400310">tag</span><span class="op" id="6400313">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400317">hostname</span><span class="op" id="6400325">:</span>&nbsp;<span class="ident" id="6400327">hostname</span><span class="op" id="6400335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400339">network</span><span class="op" id="6400346">:</span>&nbsp;&nbsp;<span class="ident" id="6400349">network</span><span class="op" id="6400356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400360">raddr</span><span class="op" id="6400365">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6400370">raddr</span><span class="op" id="6400375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400382">w</span><span class="op" id="6400383">.</span><span class="ident" id="6400384">mu</span><span class="op" id="6400386">.</span><span class="ident" id="6400387">Lock</span><span class="op" id="6400391">(</span><span class="op" id="6400392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400395">defer</span>&nbsp;<span class="ident" id="6400401">w</span><span class="op" id="6400402">.</span><span class="ident" id="6400403">mu</span><span class="op" id="6400405">.</span><span class="ident" id="6400406">Unlock</span><span class="op" id="6400412">(</span><span class="op" id="6400413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400417">err</span>&nbsp;<span class="op" id="6400421">:=</span>&nbsp;<span class="ident" id="6400424">w</span><span class="op" id="6400425">.</span><span class="ident" id="6400426">connect</span><span class="op" id="6400433">(</span><span class="op" id="6400434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400437">if</span>&nbsp;<span class="ident" id="6400440">err</span>&nbsp;<span class="op" id="6400444">!=</span>&nbsp;<span class="ident" id="6400447">nil</span>&nbsp;<span class="op" id="6400451">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400455">return</span>&nbsp;<span class="ident" id="6400462">nil</span><span class="op" id="6400465">,</span>&nbsp;<span class="ident" id="6400467">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400475">return</span>&nbsp;<span class="ident" id="6400482">w</span><span class="op" id="6400483">,</span>&nbsp;<span class="ident" id="6400485">err</span><br>
<span class="lineno"></span><span class="op" id="6400489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="6400492">//&nbsp;connect&nbsp;makes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6400544">//&nbsp;It&nbsp;must&nbsp;be&nbsp;called&nbsp;with&nbsp;w.mu&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="6400581">func</span>&nbsp;<span class="op" id="6400586">(</span><span class="ident" id="6400587">w</span>&nbsp;<span class="op" id="6400589">*</span><span class="ident" id="6400590">Writer</span><span class="op" id="6400596">)</span>&nbsp;<span class="ident" id="6400598">connect</span><span class="op" id="6400605">(</span><span class="op" id="6400606">)</span>&nbsp;<span class="op" id="6400608">(</span><span class="ident" id="6400609">err</span>&nbsp;<span class="builtintype" id="6400613">error</span><span class="op" id="6400618">)</span>&nbsp;<span class="op" id="6400620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400623">if</span>&nbsp;<span class="ident" id="6400626">w</span><span class="op" id="6400627">.</span><span class="ident" id="6400628">conn</span>&nbsp;<span class="op" id="6400633">!=</span>&nbsp;<span class="ident" id="6400636">nil</span>&nbsp;<span class="op" id="6400640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6400644">//&nbsp;ignore&nbsp;err&nbsp;from&nbsp;close,&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;continue&nbsp;anyway</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400706">w</span><span class="op" id="6400707">.</span><span class="ident" id="6400708">conn</span><span class="op" id="6400712">.</span><span class="builtinfunc" id="6400713">close</span><span class="op" id="6400718">(</span><span class="op" id="6400719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400723">w</span><span class="op" id="6400724">.</span><span class="ident" id="6400725">conn</span>&nbsp;<span class="op" id="6400730">=</span>&nbsp;<span class="ident" id="6400732">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400741">if</span>&nbsp;<span class="ident" id="6400744">w</span><span class="op" id="6400745">.</span><span class="ident" id="6400746">network</span>&nbsp;<span class="op" id="6400754">==</span>&nbsp;<span class="string" id="6400757">&#34;&#34;</span>&nbsp;<span class="op" id="6400760">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400764">w</span><span class="op" id="6400765">.</span><span class="ident" id="6400766">conn</span><span class="op" id="6400770">,</span>&nbsp;<span class="ident" id="6400772">err</span>&nbsp;<span class="op" id="6400776">=</span>&nbsp;<span class="ident" id="6400778">unixSyslog</span><span class="op" id="6400788">(</span><span class="op" id="6400789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400793">if</span>&nbsp;<span class="ident" id="6400796">w</span><span class="op" id="6400797">.</span><span class="ident" id="6400798">hostname</span>&nbsp;<span class="op" id="6400807">==</span>&nbsp;<span class="string" id="6400810">&#34;&#34;</span>&nbsp;<span class="op" id="6400813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400818">w</span><span class="op" id="6400819">.</span><span class="ident" id="6400820">hostname</span>&nbsp;<span class="op" id="6400829">=</span>&nbsp;<span class="string" id="6400831">&#34;localhost&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400848">}</span>&nbsp;<span class="keyword" id="6400850">else</span>&nbsp;<span class="op" id="6400855">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400859">var</span>&nbsp;<span class="ident" id="6400863">c</span>&nbsp;<span class="ident" id="6400865">net</span><span class="op" id="6400868">.</span><span class="ident" id="6400869">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400876">c</span><span class="op" id="6400877">,</span>&nbsp;<span class="ident" id="6400879">err</span>&nbsp;<span class="op" id="6400883">=</span>&nbsp;<span class="ident" id="6400885">net</span><span class="op" id="6400888">.</span><span class="ident" id="6400889">Dial</span><span class="op" id="6400893">(</span><span class="ident" id="6400894">w</span><span class="op" id="6400895">.</span><span class="ident" id="6400896">network</span><span class="op" id="6400903">,</span>&nbsp;<span class="ident" id="6400905">w</span><span class="op" id="6400906">.</span><span class="ident" id="6400907">raddr</span><span class="op" id="6400912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400916">if</span>&nbsp;<span class="ident" id="6400919">err</span>&nbsp;<span class="op" id="6400923">==</span>&nbsp;<span class="ident" id="6400926">nil</span>&nbsp;<span class="op" id="6400930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400935">w</span><span class="op" id="6400936">.</span><span class="ident" id="6400937">conn</span>&nbsp;<span class="op" id="6400942">=</span>&nbsp;<span class="op" id="6400944">&amp;</span><span class="ident" id="6400945">netConn</span><span class="op" id="6400952">{</span><span class="ident" id="6400953">conn</span><span class="op" id="6400957">:</span>&nbsp;<span class="ident" id="6400959">c</span><span class="op" id="6400960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400965">if</span>&nbsp;<span class="ident" id="6400968">w</span><span class="op" id="6400969">.</span><span class="ident" id="6400970">hostname</span>&nbsp;<span class="op" id="6400979">==</span>&nbsp;<span class="string" id="6400982">&#34;&#34;</span>&nbsp;<span class="op" id="6400985">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400991">w</span><span class="op" id="6400992">.</span><span class="ident" id="6400993">hostname</span>&nbsp;<span class="op" id="6401002">=</span>&nbsp;<span class="ident" id="6401004">c</span><span class="op" id="6401005">.</span><span class="ident" id="6401006">LocalAddr</span><span class="op" id="6401015">(</span><span class="op" id="6401016">)</span><span class="op" id="6401017">.</span><span class="ident" id="6401018">String</span><span class="op" id="6401024">(</span><span class="op" id="6401025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6401030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6401034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6401037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401040">return</span><br>
<span class="lineno">175</span><span class="op" id="6401047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6401050">//&nbsp;Write&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6401101">func</span>&nbsp;<span class="op" id="6401106">(</span><span class="ident" id="6401107">w</span>&nbsp;<span class="op" id="6401109">*</span><span class="ident" id="6401110">Writer</span><span class="op" id="6401116">)</span>&nbsp;<span class="ident" id="6401118">Write</span><span class="op" id="6401123">(</span><span class="ident" id="6401124">b</span>&nbsp;<span class="op" id="6401126">[</span><span class="op" id="6401127">]</span><span class="builtintype" id="6401128">byte</span><span class="op" id="6401132">)</span>&nbsp;<span class="op" id="6401134">(</span><span class="builtintype" id="6401135">int</span><span class="op" id="6401138">,</span>&nbsp;<span class="builtintype" id="6401140">error</span><span class="op" id="6401145">)</span>&nbsp;<span class="op" id="6401147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401150">return</span>&nbsp;<span class="ident" id="6401157">w</span><span class="op" id="6401158">.</span><span class="ident" id="6401159">writeAndRetry</span><span class="op" id="6401172">(</span><span class="ident" id="6401173">w</span><span class="op" id="6401174">.</span><span class="ident" id="6401175">priority</span><span class="op" id="6401183">,</span>&nbsp;<span class="builtintype" id="6401185">string</span><span class="op" id="6401191">(</span><span class="ident" id="6401192">b</span><span class="op" id="6401193">)</span><span class="op" id="6401194">)</span><br>
<span class="lineno">180</span><span class="op" id="6401196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6401199">//&nbsp;Close&nbsp;closes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6401250">func</span>&nbsp;<span class="op" id="6401255">(</span><span class="ident" id="6401256">w</span>&nbsp;<span class="op" id="6401258">*</span><span class="ident" id="6401259">Writer</span><span class="op" id="6401265">)</span>&nbsp;<span class="ident" id="6401267">Close</span><span class="op" id="6401272">(</span><span class="op" id="6401273">)</span>&nbsp;<span class="builtintype" id="6401275">error</span>&nbsp;<span class="op" id="6401281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401284">w</span><span class="op" id="6401285">.</span><span class="ident" id="6401286">mu</span><span class="op" id="6401288">.</span><span class="ident" id="6401289">Lock</span><span class="op" id="6401293">(</span><span class="op" id="6401294">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401297">defer</span>&nbsp;<span class="ident" id="6401303">w</span><span class="op" id="6401304">.</span><span class="ident" id="6401305">mu</span><span class="op" id="6401307">.</span><span class="ident" id="6401308">Unlock</span><span class="op" id="6401314">(</span><span class="op" id="6401315">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401319">if</span>&nbsp;<span class="ident" id="6401322">w</span><span class="op" id="6401323">.</span><span class="ident" id="6401324">conn</span>&nbsp;<span class="op" id="6401329">!=</span>&nbsp;<span class="ident" id="6401332">nil</span>&nbsp;<span class="op" id="6401336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401340">err</span>&nbsp;<span class="op" id="6401344">:=</span>&nbsp;<span class="ident" id="6401347">w</span><span class="op" id="6401348">.</span><span class="ident" id="6401349">conn</span><span class="op" id="6401353">.</span><span class="builtinfunc" id="6401354">close</span><span class="op" id="6401359">(</span><span class="op" id="6401360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401364">w</span><span class="op" id="6401365">.</span><span class="ident" id="6401366">conn</span>&nbsp;<span class="op" id="6401371">=</span>&nbsp;<span class="ident" id="6401373">nil</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401379">return</span>&nbsp;<span class="ident" id="6401386">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6401391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401394">return</span>&nbsp;<span class="ident" id="6401401">nil</span><br>
<span class="lineno"></span><span class="op" id="6401405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="6401408">//&nbsp;Emerg&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_EMERG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6401479">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6401497">func</span>&nbsp;<span class="op" id="6401502">(</span><span class="ident" id="6401503">w</span>&nbsp;<span class="op" id="6401505">*</span><span class="ident" id="6401506">Writer</span><span class="op" id="6401512">)</span>&nbsp;<span class="ident" id="6401514">Emerg</span><span class="op" id="6401519">(</span><span class="ident" id="6401520">m</span>&nbsp;<span class="builtintype" id="6401522">string</span><span class="op" id="6401528">)</span>&nbsp;<span class="op" id="6401530">(</span><span class="ident" id="6401531">err</span>&nbsp;<span class="builtintype" id="6401535">error</span><span class="op" id="6401540">)</span>&nbsp;<span class="op" id="6401542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401545">_</span><span class="op" id="6401546">,</span>&nbsp;<span class="ident" id="6401548">err</span>&nbsp;<span class="op" id="6401552">=</span>&nbsp;<span class="ident" id="6401554">w</span><span class="op" id="6401555">.</span><span class="ident" id="6401556">writeAndRetry</span><span class="op" id="6401569">(</span><span class="ident" id="6401570">LOG_EMERG</span><span class="op" id="6401579">,</span>&nbsp;<span class="ident" id="6401581">m</span><span class="op" id="6401582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401585">return</span>&nbsp;<span class="ident" id="6401592">err</span><br>
<span class="lineno">200</span><span class="op" id="6401596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6401599">//&nbsp;Alert&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ALERT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6401670">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6401688">func</span>&nbsp;<span class="op" id="6401693">(</span><span class="ident" id="6401694">w</span>&nbsp;<span class="op" id="6401696">*</span><span class="ident" id="6401697">Writer</span><span class="op" id="6401703">)</span>&nbsp;<span class="ident" id="6401705">Alert</span><span class="op" id="6401710">(</span><span class="ident" id="6401711">m</span>&nbsp;<span class="builtintype" id="6401713">string</span><span class="op" id="6401719">)</span>&nbsp;<span class="op" id="6401721">(</span><span class="ident" id="6401722">err</span>&nbsp;<span class="builtintype" id="6401726">error</span><span class="op" id="6401731">)</span>&nbsp;<span class="op" id="6401733">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401736">_</span><span class="op" id="6401737">,</span>&nbsp;<span class="ident" id="6401739">err</span>&nbsp;<span class="op" id="6401743">=</span>&nbsp;<span class="ident" id="6401745">w</span><span class="op" id="6401746">.</span><span class="ident" id="6401747">writeAndRetry</span><span class="op" id="6401760">(</span><span class="ident" id="6401761">LOG_ALERT</span><span class="op" id="6401770">,</span>&nbsp;<span class="ident" id="6401772">m</span><span class="op" id="6401773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401776">return</span>&nbsp;<span class="ident" id="6401783">err</span><br>
<span class="lineno"></span><span class="op" id="6401787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6401790">//&nbsp;Crit&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_CRIT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">210</span><span class="comment" id="6401859">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6401877">func</span>&nbsp;<span class="op" id="6401882">(</span><span class="ident" id="6401883">w</span>&nbsp;<span class="op" id="6401885">*</span><span class="ident" id="6401886">Writer</span><span class="op" id="6401892">)</span>&nbsp;<span class="ident" id="6401894">Crit</span><span class="op" id="6401898">(</span><span class="ident" id="6401899">m</span>&nbsp;<span class="builtintype" id="6401901">string</span><span class="op" id="6401907">)</span>&nbsp;<span class="op" id="6401909">(</span><span class="ident" id="6401910">err</span>&nbsp;<span class="builtintype" id="6401914">error</span><span class="op" id="6401919">)</span>&nbsp;<span class="op" id="6401921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401924">_</span><span class="op" id="6401925">,</span>&nbsp;<span class="ident" id="6401927">err</span>&nbsp;<span class="op" id="6401931">=</span>&nbsp;<span class="ident" id="6401933">w</span><span class="op" id="6401934">.</span><span class="ident" id="6401935">writeAndRetry</span><span class="op" id="6401948">(</span><span class="ident" id="6401949">LOG_CRIT</span><span class="op" id="6401957">,</span>&nbsp;<span class="ident" id="6401959">m</span><span class="op" id="6401960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401963">return</span>&nbsp;<span class="ident" id="6401970">err</span><br>
<span class="lineno"></span><span class="op" id="6401974">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="6401977">//&nbsp;Err&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ERR,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6402044">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6402062">func</span>&nbsp;<span class="op" id="6402067">(</span><span class="ident" id="6402068">w</span>&nbsp;<span class="op" id="6402070">*</span><span class="ident" id="6402071">Writer</span><span class="op" id="6402077">)</span>&nbsp;<span class="ident" id="6402079">Err</span><span class="op" id="6402082">(</span><span class="ident" id="6402083">m</span>&nbsp;<span class="builtintype" id="6402085">string</span><span class="op" id="6402091">)</span>&nbsp;<span class="op" id="6402093">(</span><span class="ident" id="6402094">err</span>&nbsp;<span class="builtintype" id="6402098">error</span><span class="op" id="6402103">)</span>&nbsp;<span class="op" id="6402105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402108">_</span><span class="op" id="6402109">,</span>&nbsp;<span class="ident" id="6402111">err</span>&nbsp;<span class="op" id="6402115">=</span>&nbsp;<span class="ident" id="6402117">w</span><span class="op" id="6402118">.</span><span class="ident" id="6402119">writeAndRetry</span><span class="op" id="6402132">(</span><span class="ident" id="6402133">LOG_ERR</span><span class="op" id="6402140">,</span>&nbsp;<span class="ident" id="6402142">m</span><span class="op" id="6402143">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402146">return</span>&nbsp;<span class="ident" id="6402153">err</span><br>
<span class="lineno"></span><span class="op" id="6402157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6402160">//&nbsp;Warning&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_WARNING,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6402226">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno">225</span><span class="keyword" id="6402253">func</span>&nbsp;<span class="op" id="6402258">(</span><span class="ident" id="6402259">w</span>&nbsp;<span class="op" id="6402261">*</span><span class="ident" id="6402262">Writer</span><span class="op" id="6402268">)</span>&nbsp;<span class="ident" id="6402270">Warning</span><span class="op" id="6402277">(</span><span class="ident" id="6402278">m</span>&nbsp;<span class="builtintype" id="6402280">string</span><span class="op" id="6402286">)</span>&nbsp;<span class="op" id="6402288">(</span><span class="ident" id="6402289">err</span>&nbsp;<span class="builtintype" id="6402293">error</span><span class="op" id="6402298">)</span>&nbsp;<span class="op" id="6402300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402303">_</span><span class="op" id="6402304">,</span>&nbsp;<span class="ident" id="6402306">err</span>&nbsp;<span class="op" id="6402310">=</span>&nbsp;<span class="ident" id="6402312">w</span><span class="op" id="6402313">.</span><span class="ident" id="6402314">writeAndRetry</span><span class="op" id="6402327">(</span><span class="ident" id="6402328">LOG_WARNING</span><span class="op" id="6402339">,</span>&nbsp;<span class="ident" id="6402341">m</span><span class="op" id="6402342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402345">return</span>&nbsp;<span class="ident" id="6402352">err</span><br>
<span class="lineno"></span><span class="op" id="6402356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="6402359">//&nbsp;Notice&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_NOTICE,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6402423">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6402450">func</span>&nbsp;<span class="op" id="6402455">(</span><span class="ident" id="6402456">w</span>&nbsp;<span class="op" id="6402458">*</span><span class="ident" id="6402459">Writer</span><span class="op" id="6402465">)</span>&nbsp;<span class="ident" id="6402467">Notice</span><span class="op" id="6402473">(</span><span class="ident" id="6402474">m</span>&nbsp;<span class="builtintype" id="6402476">string</span><span class="op" id="6402482">)</span>&nbsp;<span class="op" id="6402484">(</span><span class="ident" id="6402485">err</span>&nbsp;<span class="builtintype" id="6402489">error</span><span class="op" id="6402494">)</span>&nbsp;<span class="op" id="6402496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402499">_</span><span class="op" id="6402500">,</span>&nbsp;<span class="ident" id="6402502">err</span>&nbsp;<span class="op" id="6402506">=</span>&nbsp;<span class="ident" id="6402508">w</span><span class="op" id="6402509">.</span><span class="ident" id="6402510">writeAndRetry</span><span class="op" id="6402523">(</span><span class="ident" id="6402524">LOG_NOTICE</span><span class="op" id="6402534">,</span>&nbsp;<span class="ident" id="6402536">m</span><span class="op" id="6402537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402540">return</span>&nbsp;<span class="ident" id="6402547">err</span><br>
<span class="lineno">235</span><span class="op" id="6402551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6402554">//&nbsp;Info&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_INFO,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6402623">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6402641">func</span>&nbsp;<span class="op" id="6402646">(</span><span class="ident" id="6402647">w</span>&nbsp;<span class="op" id="6402649">*</span><span class="ident" id="6402650">Writer</span><span class="op" id="6402656">)</span>&nbsp;<span class="ident" id="6402658">Info</span><span class="op" id="6402662">(</span><span class="ident" id="6402663">m</span>&nbsp;<span class="builtintype" id="6402665">string</span><span class="op" id="6402671">)</span>&nbsp;<span class="op" id="6402673">(</span><span class="ident" id="6402674">err</span>&nbsp;<span class="builtintype" id="6402678">error</span><span class="op" id="6402683">)</span>&nbsp;<span class="op" id="6402685">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402688">_</span><span class="op" id="6402689">,</span>&nbsp;<span class="ident" id="6402691">err</span>&nbsp;<span class="op" id="6402695">=</span>&nbsp;<span class="ident" id="6402697">w</span><span class="op" id="6402698">.</span><span class="ident" id="6402699">writeAndRetry</span><span class="op" id="6402712">(</span><span class="ident" id="6402713">LOG_INFO</span><span class="op" id="6402721">,</span>&nbsp;<span class="ident" id="6402723">m</span><span class="op" id="6402724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402727">return</span>&nbsp;<span class="ident" id="6402734">err</span><br>
<span class="lineno"></span><span class="op" id="6402738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6402741">//&nbsp;Debug&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_DEBUG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">245</span><span class="comment" id="6402812">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6402830">func</span>&nbsp;<span class="op" id="6402835">(</span><span class="ident" id="6402836">w</span>&nbsp;<span class="op" id="6402838">*</span><span class="ident" id="6402839">Writer</span><span class="op" id="6402845">)</span>&nbsp;<span class="ident" id="6402847">Debug</span><span class="op" id="6402852">(</span><span class="ident" id="6402853">m</span>&nbsp;<span class="builtintype" id="6402855">string</span><span class="op" id="6402861">)</span>&nbsp;<span class="op" id="6402863">(</span><span class="ident" id="6402864">err</span>&nbsp;<span class="builtintype" id="6402868">error</span><span class="op" id="6402873">)</span>&nbsp;<span class="op" id="6402875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402878">_</span><span class="op" id="6402879">,</span>&nbsp;<span class="ident" id="6402881">err</span>&nbsp;<span class="op" id="6402885">=</span>&nbsp;<span class="ident" id="6402887">w</span><span class="op" id="6402888">.</span><span class="ident" id="6402889">writeAndRetry</span><span class="op" id="6402902">(</span><span class="ident" id="6402903">LOG_DEBUG</span><span class="op" id="6402912">,</span>&nbsp;<span class="ident" id="6402914">m</span><span class="op" id="6402915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402918">return</span>&nbsp;<span class="ident" id="6402925">err</span><br>
<span class="lineno"></span><span class="op" id="6402929">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6402932">func</span>&nbsp;<span class="op" id="6402937">(</span><span class="ident" id="6402938">w</span>&nbsp;<span class="op" id="6402940">*</span><span class="ident" id="6402941">Writer</span><span class="op" id="6402947">)</span>&nbsp;<span class="ident" id="6402949">writeAndRetry</span><span class="op" id="6402962">(</span><span class="ident" id="6402963">p</span>&nbsp;<span class="ident" id="6402965">Priority</span><span class="op" id="6402973">,</span>&nbsp;<span class="ident" id="6402975">s</span>&nbsp;<span class="builtintype" id="6402977">string</span><span class="op" id="6402983">)</span>&nbsp;<span class="op" id="6402985">(</span><span class="builtintype" id="6402986">int</span><span class="op" id="6402989">,</span>&nbsp;<span class="builtintype" id="6402991">error</span><span class="op" id="6402996">)</span>&nbsp;<span class="op" id="6402998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403001">pr</span>&nbsp;<span class="op" id="6403004">:=</span>&nbsp;<span class="op" id="6403007">(</span><span class="ident" id="6403008">w</span><span class="op" id="6403009">.</span><span class="ident" id="6403010">priority</span>&nbsp;<span class="op" id="6403019">&amp;</span>&nbsp;<span class="ident" id="6403021">facilityMask</span><span class="op" id="6403033">)</span>&nbsp;<span class="op" id="6403035">|</span>&nbsp;<span class="op" id="6403037">(</span><span class="ident" id="6403038">p</span>&nbsp;<span class="op" id="6403040">&amp;</span>&nbsp;<span class="ident" id="6403042">severityMask</span><span class="op" id="6403054">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403058">w</span><span class="op" id="6403059">.</span><span class="ident" id="6403060">mu</span><span class="op" id="6403062">.</span><span class="ident" id="6403063">Lock</span><span class="op" id="6403067">(</span><span class="op" id="6403068">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403071">defer</span>&nbsp;<span class="ident" id="6403077">w</span><span class="op" id="6403078">.</span><span class="ident" id="6403079">mu</span><span class="op" id="6403081">.</span><span class="ident" id="6403082">Unlock</span><span class="op" id="6403088">(</span><span class="op" id="6403089">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403093">if</span>&nbsp;<span class="ident" id="6403096">w</span><span class="op" id="6403097">.</span><span class="ident" id="6403098">conn</span>&nbsp;<span class="op" id="6403103">!=</span>&nbsp;<span class="ident" id="6403106">nil</span>&nbsp;<span class="op" id="6403110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403114">if</span>&nbsp;<span class="ident" id="6403117">n</span><span class="op" id="6403118">,</span>&nbsp;<span class="ident" id="6403120">err</span>&nbsp;<span class="op" id="6403124">:=</span>&nbsp;<span class="ident" id="6403127">w</span><span class="op" id="6403128">.</span><span class="ident" id="6403129">write</span><span class="op" id="6403134">(</span><span class="ident" id="6403135">pr</span><span class="op" id="6403137">,</span>&nbsp;<span class="ident" id="6403139">s</span><span class="op" id="6403140">)</span><span class="op" id="6403141">;</span>&nbsp;<span class="ident" id="6403143">err</span>&nbsp;<span class="op" id="6403147">==</span>&nbsp;<span class="ident" id="6403150">nil</span>&nbsp;<span class="op" id="6403154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403159">return</span>&nbsp;<span class="ident" id="6403166">n</span><span class="op" id="6403167">,</span>&nbsp;<span class="ident" id="6403169">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403181">if</span>&nbsp;<span class="ident" id="6403184">err</span>&nbsp;<span class="op" id="6403188">:=</span>&nbsp;<span class="ident" id="6403191">w</span><span class="op" id="6403192">.</span><span class="ident" id="6403193">connect</span><span class="op" id="6403200">(</span><span class="op" id="6403201">)</span><span class="op" id="6403202">;</span>&nbsp;<span class="ident" id="6403204">err</span>&nbsp;<span class="op" id="6403208">!=</span>&nbsp;<span class="ident" id="6403211">nil</span>&nbsp;<span class="op" id="6403215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403219">return</span>&nbsp;<span class="num" id="6403226">0</span><span class="op" id="6403227">,</span>&nbsp;<span class="ident" id="6403229">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403234">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403237">return</span>&nbsp;<span class="ident" id="6403244">w</span><span class="op" id="6403245">.</span><span class="ident" id="6403246">write</span><span class="op" id="6403251">(</span><span class="ident" id="6403252">pr</span><span class="op" id="6403254">,</span>&nbsp;<span class="ident" id="6403256">s</span><span class="op" id="6403257">)</span><br>
<span class="lineno"></span><span class="op" id="6403259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6403262">//&nbsp;write&nbsp;generates&nbsp;and&nbsp;writes&nbsp;a&nbsp;syslog&nbsp;formatted&nbsp;string.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="6403323">//&nbsp;format&nbsp;is&nbsp;as&nbsp;follows:&nbsp;&lt;PRI&gt;TIMESTAMP&nbsp;HOSTNAME&nbsp;TAG[PID]:&nbsp;MSG</span><br>
<span class="lineno">270</span><span class="keyword" id="6403386">func</span>&nbsp;<span class="op" id="6403391">(</span><span class="ident" id="6403392">w</span>&nbsp;<span class="op" id="6403394">*</span><span class="ident" id="6403395">Writer</span><span class="op" id="6403401">)</span>&nbsp;<span class="ident" id="6403403">write</span><span class="op" id="6403408">(</span><span class="ident" id="6403409">p</span>&nbsp;<span class="ident" id="6403411">Priority</span><span class="op" id="6403419">,</span>&nbsp;<span class="ident" id="6403421">msg</span>&nbsp;<span class="builtintype" id="6403425">string</span><span class="op" id="6403431">)</span>&nbsp;<span class="op" id="6403433">(</span><span class="builtintype" id="6403434">int</span><span class="op" id="6403437">,</span>&nbsp;<span class="builtintype" id="6403439">error</span><span class="op" id="6403444">)</span>&nbsp;<span class="op" id="6403446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6403449">//&nbsp;ensure&nbsp;it&nbsp;ends&nbsp;in&nbsp;a&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403476">nl</span>&nbsp;<span class="op" id="6403479">:=</span>&nbsp;<span class="string" id="6403482">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403486">if</span>&nbsp;<span class="op" id="6403489">!</span><span class="ident" id="6403490">strings</span><span class="op" id="6403497">.</span><span class="ident" id="6403498">HasSuffix</span><span class="op" id="6403507">(</span><span class="ident" id="6403508">msg</span><span class="op" id="6403511">,</span>&nbsp;<span class="string" id="6403513">&#34;\n&#34;</span><span class="op" id="6403517">)</span>&nbsp;<span class="op" id="6403519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403523">nl</span>&nbsp;<span class="op" id="6403526">=</span>&nbsp;<span class="string" id="6403528">&#34;\n&#34;</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403538">err</span>&nbsp;<span class="op" id="6403542">:=</span>&nbsp;<span class="ident" id="6403545">w</span><span class="op" id="6403546">.</span><span class="ident" id="6403547">conn</span><span class="op" id="6403551">.</span><span class="ident" id="6403552">writeString</span><span class="op" id="6403563">(</span><span class="ident" id="6403564">p</span><span class="op" id="6403565">,</span>&nbsp;<span class="ident" id="6403567">w</span><span class="op" id="6403568">.</span><span class="ident" id="6403569">hostname</span><span class="op" id="6403577">,</span>&nbsp;<span class="ident" id="6403579">w</span><span class="op" id="6403580">.</span><span class="ident" id="6403581">tag</span><span class="op" id="6403584">,</span>&nbsp;<span class="ident" id="6403586">msg</span><span class="op" id="6403589">,</span>&nbsp;<span class="ident" id="6403591">nl</span><span class="op" id="6403593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403596">if</span>&nbsp;<span class="ident" id="6403599">err</span>&nbsp;<span class="op" id="6403603">!=</span>&nbsp;<span class="ident" id="6403606">nil</span>&nbsp;<span class="op" id="6403610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403614">return</span>&nbsp;<span class="num" id="6403621">0</span><span class="op" id="6403622">,</span>&nbsp;<span class="ident" id="6403624">err</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6403632">//&nbsp;Note:&nbsp;return&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input,&nbsp;not&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6403692">//&nbsp;bytes&nbsp;printed&nbsp;by&nbsp;Fprintf,&nbsp;because&nbsp;this&nbsp;must&nbsp;behave&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6403752">//&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403770">return</span>&nbsp;<span class="builtinfunc" id="6403777">len</span><span class="op" id="6403780">(</span><span class="ident" id="6403781">msg</span><span class="op" id="6403784">)</span><span class="op" id="6403785">,</span>&nbsp;<span class="ident" id="6403787">nil</span><br>
<span class="lineno">285</span><span class="op" id="6403791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6403794">func</span>&nbsp;<span class="op" id="6403799">(</span><span class="ident" id="6403800">n</span>&nbsp;<span class="op" id="6403802">*</span><span class="ident" id="6403803">netConn</span><span class="op" id="6403810">)</span>&nbsp;<span class="ident" id="6403812">writeString</span><span class="op" id="6403823">(</span><span class="ident" id="6403824">p</span>&nbsp;<span class="ident" id="6403826">Priority</span><span class="op" id="6403834">,</span>&nbsp;<span class="ident" id="6403836">hostname</span><span class="op" id="6403844">,</span>&nbsp;<span class="ident" id="6403846">tag</span><span class="op" id="6403849">,</span>&nbsp;<span class="ident" id="6403851">msg</span><span class="op" id="6403854">,</span>&nbsp;<span class="ident" id="6403856">nl</span>&nbsp;<span class="builtintype" id="6403859">string</span><span class="op" id="6403865">)</span>&nbsp;<span class="builtintype" id="6403867">error</span>&nbsp;<span class="op" id="6403873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403876">if</span>&nbsp;<span class="ident" id="6403879">n</span><span class="op" id="6403880">.</span><span class="ident" id="6403881">local</span>&nbsp;<span class="op" id="6403887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6403891">//&nbsp;Compared&nbsp;to&nbsp;the&nbsp;network&nbsp;form&nbsp;below,&nbsp;the&nbsp;changes&nbsp;are:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6403949">//&nbsp;&nbsp;&nbsp;&nbsp1.&nbsp;Use&nbsp;time.Stamp&nbsp;instead&nbsp;of&nbsp;time.RFC3339.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6403997">//&nbsp;&nbsp;&nbsp;&nbsp2.&nbsp;Drop&nbsp;the&nbsp;hostname&nbsp;field&nbsp;from&nbsp;the&nbsp;Fprintf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404047">timestamp</span>&nbsp;<span class="op" id="6404057">:=</span>&nbsp;<span class="ident" id="6404060">time</span><span class="op" id="6404064">.</span><span class="ident" id="6404065">Now</span><span class="op" id="6404068">(</span><span class="op" id="6404069">)</span><span class="op" id="6404070">.</span><span class="ident" id="6404071">Format</span><span class="op" id="6404077">(</span><span class="ident" id="6404078">time</span><span class="op" id="6404082">.</span><span class="ident" id="6404083">Stamp</span><span class="op" id="6404088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404092">_</span><span class="op" id="6404093">,</span>&nbsp;<span class="ident" id="6404095">err</span>&nbsp;<span class="op" id="6404099">:=</span>&nbsp;<span class="ident" id="6404102">fmt</span><span class="op" id="6404105">.</span><span class="ident" id="6404106">Fprintf</span><span class="op" id="6404113">(</span><span class="ident" id="6404114">n</span><span class="op" id="6404115">.</span><span class="ident" id="6404116">conn</span><span class="op" id="6404120">,</span>&nbsp;<span class="string" id="6404122">&#34;&lt;%d&gt;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6404143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404148">p</span><span class="op" id="6404149">,</span>&nbsp;<span class="ident" id="6404151">timestamp</span><span class="op" id="6404160">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404165">tag</span><span class="op" id="6404168">,</span>&nbsp;<span class="ident" id="6404170">os</span><span class="op" id="6404172">.</span><span class="ident" id="6404173">Getpid</span><span class="op" id="6404179">(</span><span class="op" id="6404180">)</span><span class="op" id="6404181">,</span>&nbsp;<span class="ident" id="6404183">msg</span><span class="op" id="6404186">,</span>&nbsp;<span class="ident" id="6404188">nl</span><span class="op" id="6404190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404194">return</span>&nbsp;<span class="ident" id="6404201">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6404206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404209">timestamp</span>&nbsp;<span class="op" id="6404219">:=</span>&nbsp;<span class="ident" id="6404222">time</span><span class="op" id="6404226">.</span><span class="ident" id="6404227">Now</span><span class="op" id="6404230">(</span><span class="op" id="6404231">)</span><span class="op" id="6404232">.</span><span class="ident" id="6404233">Format</span><span class="op" id="6404239">(</span><span class="ident" id="6404240">time</span><span class="op" id="6404244">.</span><span class="ident" id="6404245">RFC3339</span><span class="op" id="6404252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404255">_</span><span class="op" id="6404256">,</span>&nbsp;<span class="ident" id="6404258">err</span>&nbsp;<span class="op" id="6404262">:=</span>&nbsp;<span class="ident" id="6404265">fmt</span><span class="op" id="6404268">.</span><span class="ident" id="6404269">Fprintf</span><span class="op" id="6404276">(</span><span class="ident" id="6404277">n</span><span class="op" id="6404278">.</span><span class="ident" id="6404279">conn</span><span class="op" id="6404283">,</span>&nbsp;<span class="string" id="6404285">&#34;&lt;%d&gt;%s&nbsp;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6404309">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404313">p</span><span class="op" id="6404314">,</span>&nbsp;<span class="ident" id="6404316">timestamp</span><span class="op" id="6404325">,</span>&nbsp;<span class="ident" id="6404327">hostname</span><span class="op" id="6404335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404339">tag</span><span class="op" id="6404342">,</span>&nbsp;<span class="ident" id="6404344">os</span><span class="op" id="6404346">.</span><span class="ident" id="6404347">Getpid</span><span class="op" id="6404353">(</span><span class="op" id="6404354">)</span><span class="op" id="6404355">,</span>&nbsp;<span class="ident" id="6404357">msg</span><span class="op" id="6404360">,</span>&nbsp;<span class="ident" id="6404362">nl</span><span class="op" id="6404364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404367">return</span>&nbsp;<span class="ident" id="6404374">err</span><br>
<span class="lineno"></span><span class="op" id="6404378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="6404381">func</span>&nbsp;<span class="op" id="6404386">(</span><span class="ident" id="6404387">n</span>&nbsp;<span class="op" id="6404389">*</span><span class="ident" id="6404390">netConn</span><span class="op" id="6404397">)</span>&nbsp;<span class="builtinfunc" id="6404399">close</span><span class="op" id="6404404">(</span><span class="op" id="6404405">)</span>&nbsp;<span class="builtintype" id="6404407">error</span>&nbsp;<span class="op" id="6404413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404416">return</span>&nbsp;<span class="ident" id="6404423">n</span><span class="op" id="6404424">.</span><span class="ident" id="6404425">conn</span><span class="op" id="6404429">.</span><span class="ident" id="6404430">Close</span><span class="op" id="6404435">(</span><span class="op" id="6404436">)</span><br>
<span class="lineno"></span><span class="op" id="6404438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6404441">//&nbsp;NewLogger&nbsp;creates&nbsp;a&nbsp;log.Logger&nbsp;whose&nbsp;output&nbsp;is&nbsp;written&nbsp;to</span><br>
<span class="lineno">310</span><span class="comment" id="6404502">//&nbsp;the&nbsp;system&nbsp;log&nbsp;service&nbsp;with&nbsp;the&nbsp;specified&nbsp;priority.&nbsp;The&nbsp;logFlag</span><br>
<span class="lineno"></span><span class="comment" id="6404569">//&nbsp;argument&nbsp;is&nbsp;the&nbsp;flag&nbsp;set&nbsp;passed&nbsp;through&nbsp;to&nbsp;log.New&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="6404633">//&nbsp;the&nbsp;Logger.</span><br>
<span class="lineno"></span><span class="keyword" id="6404648">func</span>&nbsp;<span class="ident" id="6404653">NewLogger</span><span class="op" id="6404662">(</span><span class="ident" id="6404663">p</span>&nbsp;<span class="ident" id="6404665">Priority</span><span class="op" id="6404673">,</span>&nbsp;<span class="ident" id="6404675">logFlag</span>&nbsp;<span class="builtintype" id="6404683">int</span><span class="op" id="6404686">)</span>&nbsp;<span class="op" id="6404688">(</span><span class="op" id="6404689">*</span><span class="ident" id="6404690">log</span><span class="op" id="6404693">.</span><span class="ident" id="6404694">Logger</span><span class="op" id="6404700">,</span>&nbsp;<span class="builtintype" id="6404702">error</span><span class="op" id="6404707">)</span>&nbsp;<span class="op" id="6404709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404712">s</span><span class="op" id="6404713">,</span>&nbsp;<span class="ident" id="6404715">err</span>&nbsp;<span class="op" id="6404719">:=</span>&nbsp;<span class="ident" id="6404722">New</span><span class="op" id="6404725">(</span><span class="ident" id="6404726">p</span><span class="op" id="6404727">,</span>&nbsp;<span class="string" id="6404729">&#34;&#34;</span><span class="op" id="6404731">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404734">if</span>&nbsp;<span class="ident" id="6404737">err</span>&nbsp;<span class="op" id="6404741">!=</span>&nbsp;<span class="ident" id="6404744">nil</span>&nbsp;<span class="op" id="6404748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404752">return</span>&nbsp;<span class="ident" id="6404759">nil</span><span class="op" id="6404762">,</span>&nbsp;<span class="ident" id="6404764">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6404769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404772">return</span>&nbsp;<span class="ident" id="6404779">log</span><span class="op" id="6404782">.</span><span class="ident" id="6404783">New</span><span class="op" id="6404786">(</span><span class="ident" id="6404787">s</span><span class="op" id="6404788">,</span>&nbsp;<span class="string" id="6404790">&#34;&#34;</span><span class="op" id="6404792">,</span>&nbsp;<span class="ident" id="6404794">logFlag</span><span class="op" id="6404801">)</span><span class="op" id="6404802">,</span>&nbsp;<span class="ident" id="6404804">nil</span><br>
<span class="lineno"></span><span class="op" id="6404808">}</span>
</div>
</body>
</html>
