<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7302197">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7302252">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7302306">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7302357">package</span>&nbsp;<span class="ident" id="7302365">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7302371">import</span>&nbsp;<span class="op" id="7302378">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7302381">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7302394">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7302400">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7302417">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7302427">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7302430">func</span>&nbsp;<span class="ident" id="7302435">checker</span><span class="op" id="7302442">(</span><span class="ident" id="7302443">t</span>&nbsp;<span class="op" id="7302445">*</span><span class="ident" id="7302446">testing</span><span class="op" id="7302453">.</span><span class="ident" id="7302454">T</span><span class="op" id="7302455">)</span>&nbsp;<span class="keyword" id="7302457">func</span><span class="op" id="7302461">(</span><span class="builtintype" id="7302462">string</span><span class="op" id="7302468">,</span>&nbsp;<span class="builtintype" id="7302470">error</span><span class="op" id="7302475">)</span>&nbsp;<span class="op" id="7302477">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7302480">return</span>&nbsp;<span class="keyword" id="7302487">func</span><span class="op" id="7302491">(</span><span class="ident" id="7302492">call</span>&nbsp;<span class="builtintype" id="7302497">string</span><span class="op" id="7302503">,</span>&nbsp;<span class="ident" id="7302505">err</span>&nbsp;<span class="builtintype" id="7302509">error</span><span class="op" id="7302514">)</span>&nbsp;<span class="op" id="7302516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7302520">if</span>&nbsp;<span class="ident" id="7302523">err</span>&nbsp;<span class="op" id="7302527">==</span>&nbsp;<span class="ident" id="7302530">nil</span>&nbsp;<span class="op" id="7302534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7302539">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7302548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302552">t</span><span class="op" id="7302553">.</span><span class="ident" id="7302554">Fatalf</span><span class="op" id="7302560">(</span><span class="string" id="7302561">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7302569">,</span>&nbsp;<span class="ident" id="7302571">call</span><span class="op" id="7302575">,</span>&nbsp;<span class="ident" id="7302577">err</span><span class="op" id="7302580">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7302583">}</span><br>
<span class="lineno"></span><span class="op" id="7302585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7302588">func</span>&nbsp;<span class="ident" id="7302593">TestFileTransport</span><span class="op" id="7302610">(</span><span class="ident" id="7302611">t</span>&nbsp;<span class="op" id="7302613">*</span><span class="ident" id="7302614">testing</span><span class="op" id="7302621">.</span><span class="ident" id="7302622">T</span><span class="op" id="7302623">)</span>&nbsp;<span class="op" id="7302625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302628">check</span>&nbsp;<span class="op" id="7302634">:=</span>&nbsp;<span class="ident" id="7302637">checker</span><span class="op" id="7302644">(</span><span class="ident" id="7302645">t</span><span class="op" id="7302646">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302650">dname</span><span class="op" id="7302655">,</span>&nbsp;<span class="ident" id="7302657">err</span>&nbsp;<span class="op" id="7302661">:=</span>&nbsp;<span class="ident" id="7302664">ioutil</span><span class="op" id="7302670">.</span><span class="ident" id="7302671">TempDir</span><span class="op" id="7302678">(</span><span class="string" id="7302679">&#34;&#34;</span><span class="op" id="7302681">,</span>&nbsp;<span class="string" id="7302683">&#34;&#34;</span><span class="op" id="7302685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302688">check</span><span class="op" id="7302693">(</span><span class="string" id="7302694">&#34;TempDir&#34;</span><span class="op" id="7302703">,</span>&nbsp;<span class="ident" id="7302705">err</span><span class="op" id="7302708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302711">fname</span>&nbsp;<span class="op" id="7302717">:=</span>&nbsp;<span class="ident" id="7302720">filepath</span><span class="op" id="7302728">.</span><span class="ident" id="7302729">Join</span><span class="op" id="7302733">(</span><span class="ident" id="7302734">dname</span><span class="op" id="7302739">,</span>&nbsp;<span class="string" id="7302741">&#34;foo.txt&#34;</span><span class="op" id="7302750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302753">err</span>&nbsp;<span class="op" id="7302757">=</span>&nbsp;<span class="ident" id="7302759">ioutil</span><span class="op" id="7302765">.</span><span class="ident" id="7302766">WriteFile</span><span class="op" id="7302775">(</span><span class="ident" id="7302776">fname</span><span class="op" id="7302781">,</span>&nbsp;<span class="op" id="7302783">[</span><span class="op" id="7302784">]</span><span class="builtintype" id="7302785">byte</span><span class="op" id="7302789">(</span><span class="string" id="7302790">&#34;Bar&#34;</span><span class="op" id="7302795">)</span><span class="op" id="7302796">,</span>&nbsp;<span class="num" id="7302798">0644</span><span class="op" id="7302802">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302805">check</span><span class="op" id="7302810">(</span><span class="string" id="7302811">&#34;WriteFile&#34;</span><span class="op" id="7302822">,</span>&nbsp;<span class="ident" id="7302824">err</span><span class="op" id="7302827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7302830">defer</span>&nbsp;<span class="ident" id="7302836">os</span><span class="op" id="7302838">.</span><span class="ident" id="7302839">Remove</span><span class="op" id="7302845">(</span><span class="ident" id="7302846">dname</span><span class="op" id="7302851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7302854">defer</span>&nbsp;<span class="ident" id="7302860">os</span><span class="op" id="7302862">.</span><span class="ident" id="7302863">Remove</span><span class="op" id="7302869">(</span><span class="ident" id="7302870">fname</span><span class="op" id="7302875">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302879">tr</span>&nbsp;<span class="op" id="7302882">:=</span>&nbsp;<span class="op" id="7302885">&amp;</span><span class="ident" id="7302886">Transport</span><span class="op" id="7302895">{</span><span class="op" id="7302896">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302899">tr</span><span class="op" id="7302901">.</span><span class="ident" id="7302902">RegisterProtocol</span><span class="op" id="7302918">(</span><span class="string" id="7302919">&#34;file&#34;</span><span class="op" id="7302925">,</span>&nbsp;<span class="ident" id="7302927">NewFileTransport</span><span class="op" id="7302943">(</span><span class="ident" id="7302944">Dir</span><span class="op" id="7302947">(</span><span class="ident" id="7302948">dname</span><span class="op" id="7302953">)</span><span class="op" id="7302954">)</span><span class="op" id="7302955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302958">c</span>&nbsp;<span class="op" id="7302960">:=</span>&nbsp;<span class="op" id="7302963">&amp;</span><span class="ident" id="7302964">Client</span><span class="op" id="7302970">{</span><span class="ident" id="7302971">Transport</span><span class="op" id="7302980">:</span>&nbsp;<span class="ident" id="7302982">tr</span><span class="op" id="7302984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302988">fooURLs</span>&nbsp;<span class="op" id="7302996">:=</span>&nbsp;<span class="op" id="7302999">[</span><span class="op" id="7303000">]</span><span class="builtintype" id="7303001">string</span><span class="op" id="7303007">{</span><span class="string" id="7303008">&#34;file:///foo.txt&#34;</span><span class="op" id="7303025">,</span>&nbsp;<span class="string" id="7303027">&#34;file://../foo.txt&#34;</span><span class="op" id="7303046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7303049">for</span>&nbsp;<span class="ident" id="7303053">_</span><span class="op" id="7303054">,</span>&nbsp;<span class="ident" id="7303056">urlstr</span>&nbsp;<span class="op" id="7303063">:=</span>&nbsp;<span class="keyword" id="7303066">range</span>&nbsp;<span class="ident" id="7303072">fooURLs</span>&nbsp;<span class="op" id="7303080">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303084">res</span><span class="op" id="7303087">,</span>&nbsp;<span class="ident" id="7303089">err</span>&nbsp;<span class="op" id="7303093">:=</span>&nbsp;<span class="ident" id="7303096">c</span><span class="op" id="7303097">.</span><span class="ident" id="7303098">Get</span><span class="op" id="7303101">(</span><span class="ident" id="7303102">urlstr</span><span class="op" id="7303108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303112">check</span><span class="op" id="7303117">(</span><span class="string" id="7303118">&#34;Get&nbsp;&#34;</span><span class="op" id="7303124">+</span><span class="ident" id="7303125">urlstr</span><span class="op" id="7303131">,</span>&nbsp;<span class="ident" id="7303133">err</span><span class="op" id="7303136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7303140">if</span>&nbsp;<span class="ident" id="7303143">res</span><span class="op" id="7303146">.</span><span class="ident" id="7303147">StatusCode</span>&nbsp;<span class="op" id="7303158">!=</span>&nbsp;<span class="num" id="7303161">200</span>&nbsp;<span class="op" id="7303165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303170">t</span><span class="op" id="7303171">.</span><span class="ident" id="7303172">Errorf</span><span class="op" id="7303178">(</span><span class="string" id="7303179">&#34;for&nbsp;%s,&nbsp;StatusCode&nbsp;=&nbsp;%d,&nbsp;want&nbsp;200&#34;</span><span class="op" id="7303214">,</span>&nbsp;<span class="ident" id="7303216">urlstr</span><span class="op" id="7303222">,</span>&nbsp;<span class="ident" id="7303224">res</span><span class="op" id="7303227">.</span><span class="ident" id="7303228">StatusCode</span><span class="op" id="7303238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303242">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7303246">if</span>&nbsp;<span class="ident" id="7303249">res</span><span class="op" id="7303252">.</span><span class="ident" id="7303253">ContentLength</span>&nbsp;<span class="op" id="7303267">!=</span>&nbsp;<span class="op" id="7303270">-</span><span class="num" id="7303271">1</span>&nbsp;<span class="op" id="7303273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303278">t</span><span class="op" id="7303279">.</span><span class="ident" id="7303280">Errorf</span><span class="op" id="7303286">(</span><span class="string" id="7303287">&#34;for&nbsp;%s,&nbsp;ContentLength&nbsp;=&nbsp;%d,&nbsp;want&nbsp;-1&#34;</span><span class="op" id="7303324">,</span>&nbsp;<span class="ident" id="7303326">urlstr</span><span class="op" id="7303332">,</span>&nbsp;<span class="ident" id="7303334">res</span><span class="op" id="7303337">.</span><span class="ident" id="7303338">ContentLength</span><span class="op" id="7303351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7303359">if</span>&nbsp;<span class="ident" id="7303362">res</span><span class="op" id="7303365">.</span><span class="ident" id="7303366">Body</span>&nbsp;<span class="op" id="7303371">==</span>&nbsp;<span class="ident" id="7303374">nil</span>&nbsp;<span class="op" id="7303378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303383">t</span><span class="op" id="7303384">.</span><span class="ident" id="7303385">Fatalf</span><span class="op" id="7303391">(</span><span class="string" id="7303392">&#34;for&nbsp;%s,&nbsp;nil&nbsp;Body&#34;</span><span class="op" id="7303410">,</span>&nbsp;<span class="ident" id="7303412">urlstr</span><span class="op" id="7303418">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303426">slurp</span><span class="op" id="7303431">,</span>&nbsp;<span class="ident" id="7303433">err</span>&nbsp;<span class="op" id="7303437">:=</span>&nbsp;<span class="ident" id="7303440">ioutil</span><span class="op" id="7303446">.</span><span class="ident" id="7303447">ReadAll</span><span class="op" id="7303454">(</span><span class="ident" id="7303455">res</span><span class="op" id="7303458">.</span><span class="ident" id="7303459">Body</span><span class="op" id="7303463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303467">check</span><span class="op" id="7303472">(</span><span class="string" id="7303473">&#34;ReadAll&nbsp;&#34;</span><span class="op" id="7303483">+</span><span class="ident" id="7303484">urlstr</span><span class="op" id="7303490">,</span>&nbsp;<span class="ident" id="7303492">err</span><span class="op" id="7303495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7303499">if</span>&nbsp;<span class="builtintype" id="7303502">string</span><span class="op" id="7303508">(</span><span class="ident" id="7303509">slurp</span><span class="op" id="7303514">)</span>&nbsp;<span class="op" id="7303516">!=</span>&nbsp;<span class="string" id="7303519">&#34;Bar&#34;</span>&nbsp;<span class="op" id="7303525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303530">t</span><span class="op" id="7303531">.</span><span class="ident" id="7303532">Errorf</span><span class="op" id="7303538">(</span><span class="string" id="7303539">&#34;for&nbsp;%s,&nbsp;got&nbsp;content&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7303572">,</span>&nbsp;<span class="ident" id="7303574">urlstr</span><span class="op" id="7303580">,</span>&nbsp;<span class="builtintype" id="7303582">string</span><span class="op" id="7303588">(</span><span class="ident" id="7303589">slurp</span><span class="op" id="7303594">)</span><span class="op" id="7303595">,</span>&nbsp;<span class="string" id="7303597">&#34;Bar&#34;</span><span class="op" id="7303602">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7303613">const</span>&nbsp;<span class="ident" id="7303619">badURL</span>&nbsp;<span class="op" id="7303626">=</span>&nbsp;<span class="string" id="7303628">&#34;file://../no-exist.txt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303654">res</span><span class="op" id="7303657">,</span>&nbsp;<span class="ident" id="7303659">err</span>&nbsp;<span class="op" id="7303663">:=</span>&nbsp;<span class="ident" id="7303666">c</span><span class="op" id="7303667">.</span><span class="ident" id="7303668">Get</span><span class="op" id="7303671">(</span><span class="ident" id="7303672">badURL</span><span class="op" id="7303678">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303681">check</span><span class="op" id="7303686">(</span><span class="string" id="7303687">&#34;Get&nbsp;&#34;</span><span class="op" id="7303693">+</span><span class="ident" id="7303694">badURL</span><span class="op" id="7303700">,</span>&nbsp;<span class="ident" id="7303702">err</span><span class="op" id="7303705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7303708">if</span>&nbsp;<span class="ident" id="7303711">res</span><span class="op" id="7303714">.</span><span class="ident" id="7303715">StatusCode</span>&nbsp;<span class="op" id="7303726">!=</span>&nbsp;<span class="num" id="7303729">404</span>&nbsp;<span class="op" id="7303733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303737">t</span><span class="op" id="7303738">.</span><span class="ident" id="7303739">Errorf</span><span class="op" id="7303745">(</span><span class="string" id="7303746">&#34;for&nbsp;%s,&nbsp;StatusCode&nbsp;=&nbsp;%d,&nbsp;want&nbsp;404&#34;</span><span class="op" id="7303781">,</span>&nbsp;<span class="ident" id="7303783">badURL</span><span class="op" id="7303789">,</span>&nbsp;<span class="ident" id="7303791">res</span><span class="op" id="7303794">.</span><span class="ident" id="7303795">StatusCode</span><span class="op" id="7303805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303811">res</span><span class="op" id="7303814">.</span><span class="ident" id="7303815">Body</span><span class="op" id="7303819">.</span><span class="ident" id="7303820">Close</span><span class="op" id="7303825">(</span><span class="op" id="7303826">)</span><br>
<span class="lineno">65</span><span class="op" id="7303828">}</span>
</div>
</body>
</html>
