<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/tabwriter</h2>
<ul>
<li><a href="/gostd/text/tabwriter/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter.go.html">tabwriter.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter_test.go.html">tabwriter_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4496358">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4496413">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4496467">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4496518">//&nbsp;Package&nbsp;tabwriter&nbsp;implements&nbsp;a&nbsp;write&nbsp;filter&nbsp;(tabwriter.Writer)&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4496589">//&nbsp;translates&nbsp;tabbed&nbsp;columns&nbsp;in&nbsp;input&nbsp;into&nbsp;properly&nbsp;aligned&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="4496655">//</span><br>
<span class="lineno"></span><span class="comment" id="4496658">//&nbsp;The&nbsp;package&nbsp;is&nbsp;using&nbsp;the&nbsp;Elastic&nbsp;Tabstops&nbsp;algorithm&nbsp;described&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="4496726">//&nbsp;http://nickgravgaard.com/elastictabstops/index.html.</span><br>
<span class="lineno">10</span><span class="comment" id="4496782">//</span><br>
<span class="lineno"></span><span class="keyword" id="4496785">package</span>&nbsp;<span class="ident" id="4496793">tabwriter</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4496804">import</span>&nbsp;<span class="op" id="4496811">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4496814">&#34;bytes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4496823">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4496829">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4496844">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4496847">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">20</span><span class="comment" id="4496927">//&nbsp;Filter&nbsp;implementation</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4496953">//&nbsp;A&nbsp;cell&nbsp;represents&nbsp;a&nbsp;segment&nbsp;of&nbsp;text&nbsp;terminated&nbsp;by&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks.</span><br>
<span class="lineno"></span><span class="comment" id="4497027">//&nbsp;The&nbsp;text&nbsp;itself&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;separate&nbsp;buffer;&nbsp;cell&nbsp;only&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4497102">//&nbsp;segment&#39;s&nbsp;size&nbsp;in&nbsp;bytes,&nbsp;its&nbsp;width&nbsp;in&nbsp;runes,&nbsp;and&nbsp;whether&nbsp;it&#39;s&nbsp;an&nbsp;htab</span><br>
<span class="lineno">25</span><span class="comment" id="4497175">//&nbsp;(&#39;\t&#39;)&nbsp;terminated&nbsp;cell.</span><br>
<span class="lineno"></span><span class="comment" id="4497202">//</span><br>
<span class="lineno"></span><span class="keyword" id="4497205">type</span>&nbsp;<span class="ident" id="4497210">cell</span>&nbsp;<span class="keyword" id="4497215">struct</span>&nbsp;<span class="op" id="4497222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4497225">size</span>&nbsp;&nbsp;<span class="builtintype" id="4497231">int</span>&nbsp;&nbsp;<span class="comment" id="4497236">//&nbsp;cell&nbsp;size&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4497259">width</span>&nbsp;<span class="builtintype" id="4497265">int</span>&nbsp;&nbsp;<span class="comment" id="4497270">//&nbsp;cell&nbsp;width&nbsp;in&nbsp;runes</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4497294">htab</span>&nbsp;&nbsp;<span class="builtintype" id="4497300">bool</span>&nbsp;<span class="comment" id="4497305">//&nbsp;true&nbsp;if&nbsp;the&nbsp;cell&nbsp;is&nbsp;terminated&nbsp;by&nbsp;an&nbsp;htab&nbsp;(&#39;\t&#39;)</span><br>
<span class="lineno"></span><span class="op" id="4497357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4497360">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;filter&nbsp;that&nbsp;inserts&nbsp;padding&nbsp;around&nbsp;tab-delimited</span><br>
<span class="lineno"></span><span class="comment" id="4497426">//&nbsp;columns&nbsp;in&nbsp;its&nbsp;input&nbsp;to&nbsp;align&nbsp;them&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno">35</span><span class="comment" id="4497479">//</span><br>
<span class="lineno"></span><span class="comment" id="4497482">//&nbsp;The&nbsp;Writer&nbsp;treats&nbsp;incoming&nbsp;bytes&nbsp;as&nbsp;UTF-8&nbsp;encoded&nbsp;text&nbsp;consisting</span><br>
<span class="lineno"></span><span class="comment" id="4497551">//&nbsp;of&nbsp;cells&nbsp;terminated&nbsp;by&nbsp;(horizontal&nbsp;or&nbsp;vertical)&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4497615">//&nbsp;breaks&nbsp;(newline&nbsp;or&nbsp;formfeed&nbsp;characters).&nbsp;Cells&nbsp;in&nbsp;adjacent&nbsp;lines</span><br>
<span class="lineno"></span><span class="comment" id="4497683">//&nbsp;constitute&nbsp;a&nbsp;column.&nbsp;The&nbsp;Writer&nbsp;inserts&nbsp;padding&nbsp;as&nbsp;needed&nbsp;to</span><br>
<span class="lineno">40</span><span class="comment" id="4497747">//&nbsp;make&nbsp;all&nbsp;cells&nbsp;in&nbsp;a&nbsp;column&nbsp;have&nbsp;the&nbsp;same&nbsp;width,&nbsp;effectively</span><br>
<span class="lineno"></span><span class="comment" id="4497810">//&nbsp;aligning&nbsp;the&nbsp;columns.&nbsp;It&nbsp;assumes&nbsp;that&nbsp;all&nbsp;characters&nbsp;have&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4497875">//&nbsp;same&nbsp;width&nbsp;except&nbsp;for&nbsp;tabs&nbsp;for&nbsp;which&nbsp;a&nbsp;tabwidth&nbsp;must&nbsp;be&nbsp;specified.</span><br>
<span class="lineno"></span><span class="comment" id="4497945">//&nbsp;Note&nbsp;that&nbsp;cells&nbsp;are&nbsp;tab-terminated,&nbsp;not&nbsp;tab-separated:&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="4498012">//&nbsp;non-tab&nbsp;text&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;line&nbsp;does&nbsp;not&nbsp;form&nbsp;a&nbsp;column&nbsp;cell.</span><br>
<span class="lineno">45</span><span class="comment" id="4498078">//</span><br>
<span class="lineno"></span><span class="comment" id="4498081">//&nbsp;The&nbsp;Writer&nbsp;assumes&nbsp;that&nbsp;all&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;have&nbsp;the&nbsp;same&nbsp;width;</span><br>
<span class="lineno"></span><span class="comment" id="4498153">//&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;true&nbsp;in&nbsp;some&nbsp;fonts.</span><br>
<span class="lineno"></span><span class="comment" id="4498192">//</span><br>
<span class="lineno"></span><span class="comment" id="4498195">//&nbsp;If&nbsp;DiscardEmptyColumns&nbsp;is&nbsp;set,&nbsp;empty&nbsp;columns&nbsp;that&nbsp;are&nbsp;terminated</span><br>
<span class="lineno">50</span><span class="comment" id="4498263">//&nbsp;entirely&nbsp;by&nbsp;vertical&nbsp;(or&nbsp;&#34;soft&#34;)&nbsp;tabs&nbsp;are&nbsp;discarded.&nbsp;Columns</span><br>
<span class="lineno"></span><span class="comment" id="4498327">//&nbsp;terminated&nbsp;by&nbsp;horizontal&nbsp;(or&nbsp;&#34;hard&#34;)&nbsp;tabs&nbsp;are&nbsp;not&nbsp;affected&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4498392">//&nbsp;this&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="4498406">//</span><br>
<span class="lineno"></span><span class="comment" id="4498409">//&nbsp;If&nbsp;a&nbsp;Writer&nbsp;is&nbsp;configured&nbsp;to&nbsp;filter&nbsp;HTML,&nbsp;HTML&nbsp;tags&nbsp;and&nbsp;entities</span><br>
<span class="lineno">55</span><span class="comment" id="4498477">//&nbsp;are&nbsp;passed&nbsp;through.&nbsp;The&nbsp;widths&nbsp;of&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4498536">//&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;(tags)&nbsp;and&nbsp;one&nbsp;(entities)&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4498609">//</span><br>
<span class="lineno"></span><span class="comment" id="4498612">//&nbsp;A&nbsp;segment&nbsp;of&nbsp;text&nbsp;may&nbsp;be&nbsp;escaped&nbsp;by&nbsp;bracketing&nbsp;it&nbsp;with&nbsp;Escape</span><br>
<span class="lineno"></span><span class="comment" id="4498677">//&nbsp;characters.&nbsp;The&nbsp;tabwriter&nbsp;passes&nbsp;escaped&nbsp;text&nbsp;segments&nbsp;through</span><br>
<span class="lineno">60</span><span class="comment" id="4498743">//&nbsp;unchanged.&nbsp;In&nbsp;particular,&nbsp;it&nbsp;does&nbsp;not&nbsp;interpret&nbsp;any&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4498811">//&nbsp;breaks&nbsp;within&nbsp;the&nbsp;segment.&nbsp;If&nbsp;the&nbsp;StripEscape&nbsp;flag&nbsp;is&nbsp;set,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4498877">//&nbsp;Escape&nbsp;characters&nbsp;are&nbsp;stripped&nbsp;from&nbsp;the&nbsp;output;&nbsp;otherwise&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="4498943">//&nbsp;are&nbsp;passed&nbsp;through&nbsp;as&nbsp;well.&nbsp;For&nbsp;the&nbsp;purpose&nbsp;of&nbsp;formatting,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4499009">//&nbsp;width&nbsp;of&nbsp;the&nbsp;escaped&nbsp;text&nbsp;is&nbsp;always&nbsp;computed&nbsp;excluding&nbsp;the&nbsp;Escape</span><br>
<span class="lineno">65</span><span class="comment" id="4499078">//&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="4499093">//</span><br>
<span class="lineno"></span><span class="comment" id="4499096">//&nbsp;The&nbsp;formfeed&nbsp;character&nbsp;(&#39;\f&#39;)&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline&nbsp;but&nbsp;it&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="4499161">//&nbsp;terminates&nbsp;all&nbsp;columns&nbsp;in&nbsp;the&nbsp;current&nbsp;line&nbsp;(effectively&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="4499228">//&nbsp;Flush).&nbsp;Cells&nbsp;in&nbsp;the&nbsp;next&nbsp;line&nbsp;start&nbsp;new&nbsp;columns.&nbsp;Unless&nbsp;found</span><br>
<span class="lineno">70</span><span class="comment" id="4499294">//&nbsp;inside&nbsp;an&nbsp;HTML&nbsp;tag&nbsp;or&nbsp;inside&nbsp;an&nbsp;escaped&nbsp;text&nbsp;segment,&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="4499360">//&nbsp;characters&nbsp;appear&nbsp;as&nbsp;newlines&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="4499408">//</span><br>
<span class="lineno"></span><span class="comment" id="4499411">//&nbsp;The&nbsp;Writer&nbsp;must&nbsp;buffer&nbsp;input&nbsp;internally,&nbsp;because&nbsp;proper&nbsp;spacing</span><br>
<span class="lineno"></span><span class="comment" id="4499478">//&nbsp;of&nbsp;one&nbsp;line&nbsp;may&nbsp;depend&nbsp;on&nbsp;the&nbsp;cells&nbsp;in&nbsp;future&nbsp;lines.&nbsp;Clients&nbsp;must</span><br>
<span class="lineno">75</span><span class="comment" id="4499547">//&nbsp;call&nbsp;Flush&nbsp;when&nbsp;done&nbsp;calling&nbsp;Write.</span><br>
<span class="lineno"></span><span class="comment" id="4499586">//</span><br>
<span class="lineno"></span><span class="keyword" id="4499589">type</span>&nbsp;<span class="ident" id="4499594">Writer</span>&nbsp;<span class="keyword" id="4499601">struct</span>&nbsp;<span class="op" id="4499608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4499611">//&nbsp;configuration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4499629">output</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4499638">io</span><span class="op" id="4499640">.</span><span class="ident" id="4499641">Writer</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4499649">minwidth</span>&nbsp;<span class="builtintype" id="4499658">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4499663">tabwidth</span>&nbsp;<span class="builtintype" id="4499672">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4499677">padding</span>&nbsp;&nbsp;<span class="builtintype" id="4499686">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4499691">padbytes</span>&nbsp;<span class="op" id="4499700">[</span><span class="num" id="4499701">8</span><span class="op" id="4499702">]</span><span class="builtintype" id="4499703">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4499709">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4499718">uint</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4499725">//&nbsp;current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4499743">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499751">bytes</span><span class="op" id="4499756">.</span><span class="ident" id="4499757">Buffer</span>&nbsp;<span class="comment" id="4499764">//&nbsp;collected&nbsp;text&nbsp;excluding&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4499813">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4499821">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4499834">//&nbsp;buffer&nbsp;position&nbsp;up&nbsp;to&nbsp;which&nbsp;cell.width&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;has&nbsp;been&nbsp;computed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4499914">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4499922">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4499935">//&nbsp;current&nbsp;incomplete&nbsp;cell;&nbsp;cell.width&nbsp;is&nbsp;up&nbsp;to&nbsp;buf[pos]&nbsp;excluding&nbsp;ignored&nbsp;sections</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4500020">endChar</span>&nbsp;<span class="builtintype" id="4500028">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4500041">//&nbsp;terminating&nbsp;char&nbsp;of&nbsp;escaped&nbsp;sequence&nbsp;(Escape&nbsp;for&nbsp;escapes,&nbsp;&#39;&gt;&#39;,&nbsp;&#39;;&#39;&nbsp;for&nbsp;HTML&nbsp;tags/entities,&nbsp;or&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4500142">lines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4500150">[</span><span class="op" id="4500151">]</span><span class="op" id="4500152">[</span><span class="op" id="4500153">]</span><span class="ident" id="4500154">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4500163">//&nbsp;list&nbsp;of&nbsp;lines;&nbsp;each&nbsp;line&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4500211">widths</span>&nbsp;&nbsp;<span class="op" id="4500219">[</span><span class="op" id="4500220">]</span><span class="builtintype" id="4500221">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4500232">//&nbsp;list&nbsp;of&nbsp;column&nbsp;widths&nbsp;in&nbsp;runes&nbsp;-&nbsp;re-used&nbsp;during&nbsp;formatting</span><br>
<span class="lineno"></span><span class="op" id="4500294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4500297">func</span>&nbsp;<span class="op" id="4500302">(</span><span class="ident" id="4500303">b</span>&nbsp;<span class="op" id="4500305">*</span><span class="ident" id="4500306">Writer</span><span class="op" id="4500312">)</span>&nbsp;<span class="ident" id="4500314">addLine</span><span class="op" id="4500321">(</span><span class="op" id="4500322">)</span>&nbsp;<span class="op" id="4500324">{</span>&nbsp;<span class="ident" id="4500326">b</span><span class="op" id="4500327">.</span><span class="ident" id="4500328">lines</span>&nbsp;<span class="op" id="4500334">=</span>&nbsp;<span class="builtinfunc" id="4500336">append</span><span class="op" id="4500342">(</span><span class="ident" id="4500343">b</span><span class="op" id="4500344">.</span><span class="ident" id="4500345">lines</span><span class="op" id="4500350">,</span>&nbsp;<span class="op" id="4500352">[</span><span class="op" id="4500353">]</span><span class="ident" id="4500354">cell</span><span class="op" id="4500358">{</span><span class="op" id="4500359">}</span><span class="op" id="4500360">)</span>&nbsp;<span class="op" id="4500362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4500365">//&nbsp;Reset&nbsp;the&nbsp;current&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4500393">func</span>&nbsp;<span class="op" id="4500398">(</span><span class="ident" id="4500399">b</span>&nbsp;<span class="op" id="4500401">*</span><span class="ident" id="4500402">Writer</span><span class="op" id="4500408">)</span>&nbsp;<span class="ident" id="4500410">reset</span><span class="op" id="4500415">(</span><span class="op" id="4500416">)</span>&nbsp;<span class="op" id="4500418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4500421">b</span><span class="op" id="4500422">.</span><span class="ident" id="4500423">buf</span><span class="op" id="4500426">.</span><span class="ident" id="4500427">Reset</span><span class="op" id="4500432">(</span><span class="op" id="4500433">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4500436">b</span><span class="op" id="4500437">.</span><span class="ident" id="4500438">pos</span>&nbsp;<span class="op" id="4500442">=</span>&nbsp;<span class="num" id="4500444">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4500447">b</span><span class="op" id="4500448">.</span><span class="ident" id="4500449">cell</span>&nbsp;<span class="op" id="4500454">=</span>&nbsp;<span class="ident" id="4500456">cell</span><span class="op" id="4500460">{</span><span class="op" id="4500461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4500464">b</span><span class="op" id="4500465">.</span><span class="ident" id="4500466">endChar</span>&nbsp;<span class="op" id="4500474">=</span>&nbsp;<span class="num" id="4500476">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4500479">b</span><span class="op" id="4500480">.</span><span class="ident" id="4500481">lines</span>&nbsp;<span class="op" id="4500487">=</span>&nbsp;<span class="ident" id="4500489">b</span><span class="op" id="4500490">.</span><span class="ident" id="4500491">lines</span><span class="op" id="4500496">[</span><span class="num" id="4500497">0</span><span class="op" id="4500498">:</span><span class="num" id="4500499">0</span><span class="op" id="4500500">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4500503">b</span><span class="op" id="4500504">.</span><span class="ident" id="4500505">widths</span>&nbsp;<span class="op" id="4500512">=</span>&nbsp;<span class="ident" id="4500514">b</span><span class="op" id="4500515">.</span><span class="ident" id="4500516">widths</span><span class="op" id="4500522">[</span><span class="num" id="4500523">0</span><span class="op" id="4500524">:</span><span class="num" id="4500525">0</span><span class="op" id="4500526">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4500529">b</span><span class="op" id="4500530">.</span><span class="ident" id="4500531">addLine</span><span class="op" id="4500538">(</span><span class="op" id="4500539">)</span><br>
<span class="lineno"></span><span class="op" id="4500541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4500544">//&nbsp;Internal&nbsp;representation&nbsp;(current&nbsp;state):</span><br>
<span class="lineno"></span><span class="comment" id="4500588">//</span><br>
<span class="lineno">110</span><span class="comment" id="4500591">//&nbsp;-&nbsp;all&nbsp;text&nbsp;written&nbsp;is&nbsp;appended&nbsp;to&nbsp;buf;&nbsp;tabs&nbsp;and&nbsp;line&nbsp;breaks&nbsp;are&nbsp;stripped&nbsp;away</span><br>
<span class="lineno"></span><span class="comment" id="4500672">//&nbsp;-&nbsp;at&nbsp;any&nbsp;given&nbsp;time&nbsp;there&nbsp;is&nbsp;a&nbsp;(possibly&nbsp;empty)&nbsp;incomplete&nbsp;cell&nbsp;at&nbsp;the&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="4500750">//&nbsp;&nbsp;&nbsp;(the&nbsp;cell&nbsp;starts&nbsp;after&nbsp;a&nbsp;tab&nbsp;or&nbsp;line&nbsp;break)</span><br>
<span class="lineno"></span><span class="comment" id="4500799">//&nbsp;-&nbsp;cell.size&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;belonging&nbsp;to&nbsp;the&nbsp;cell&nbsp;so&nbsp;far</span><br>
<span class="lineno"></span><span class="comment" id="4500866">//&nbsp;-&nbsp;cell.width&nbsp;is&nbsp;text&nbsp;width&nbsp;in&nbsp;runes&nbsp;of&nbsp;that&nbsp;cell&nbsp;from&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;cell&nbsp;to</span><br>
<span class="lineno">115</span><span class="comment" id="4500948">//&nbsp;&nbsp;&nbsp;position&nbsp;pos;&nbsp;html&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are&nbsp;excluded&nbsp;from&nbsp;this&nbsp;width&nbsp;if&nbsp;html</span><br>
<span class="lineno"></span><span class="comment" id="4501027">//&nbsp;&nbsp;&nbsp;filtering&nbsp;is&nbsp;enabled</span><br>
<span class="lineno"></span><span class="comment" id="4501053">//&nbsp;-&nbsp;the&nbsp;sizes&nbsp;and&nbsp;widths&nbsp;of&nbsp;processed&nbsp;text&nbsp;are&nbsp;kept&nbsp;in&nbsp;the&nbsp;lines&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="4501124">//&nbsp;&nbsp;&nbsp;which&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;cells&nbsp;for&nbsp;each&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4501174">//&nbsp;-&nbsp;the&nbsp;widths&nbsp;list&nbsp;is&nbsp;a&nbsp;temporary&nbsp;list&nbsp;with&nbsp;current&nbsp;widths&nbsp;used&nbsp;during</span><br>
<span class="lineno">120</span><span class="comment" id="4501247">//&nbsp;&nbsp;&nbsp;formatting;&nbsp;it&nbsp;is&nbsp;kept&nbsp;in&nbsp;Writer&nbsp;because&nbsp;it&#39;s&nbsp;re-used</span><br>
<span class="lineno"></span><span class="comment" id="4501306">//</span><br>
<span class="lineno"></span><span class="comment" id="4501309">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;----------&nbsp;size&nbsp;----------&gt;|</span><br>
<span class="lineno"></span><span class="comment" id="4501362">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4501415">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;-&nbsp;width&nbsp;-&gt;|&lt;-&nbsp;ignored&nbsp;-&gt;|&nbsp;&nbsp;|</span><br>
<span class="lineno">125</span><span class="comment" id="4501468">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4501521">//&nbsp;[---processed---tab------------&lt;tag&gt;...&lt;/tag&gt;...]</span><br>
<span class="lineno"></span><span class="comment" id="4501574">//&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</span><br>
<span class="lineno"></span><span class="comment" id="4501624">//&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4501674">//&nbsp;buf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;&nbsp;pos</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4501727">//&nbsp;Formatting&nbsp;can&nbsp;be&nbsp;controlled&nbsp;with&nbsp;these&nbsp;flags.</span><br>
<span class="lineno"></span><span class="keyword" id="4501777">const</span>&nbsp;<span class="op" id="4501783">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4501786">//&nbsp;Ignore&nbsp;html&nbsp;tags&nbsp;and&nbsp;treat&nbsp;entities&nbsp;(starting&nbsp;with&nbsp;&#39;&amp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4501845">//&nbsp;and&nbsp;ending&nbsp;in&nbsp;&#39;;&#39;)&nbsp;as&nbsp;single&nbsp;characters&nbsp;(width&nbsp;=&nbsp;1).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4501902">FilterHTML</span>&nbsp;<span class="builtintype" id="4501913">uint</span>&nbsp;<span class="op" id="4501918">=</span>&nbsp;<span class="num" id="4501920">1</span>&nbsp;<span class="op" id="4501922">&lt;&lt;</span>&nbsp;<span class="ident" id="4501925">iota</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4501932">//&nbsp;Strip&nbsp;Escape&nbsp;characters&nbsp;bracketing&nbsp;escaped&nbsp;text&nbsp;segments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4501993">//&nbsp;instead&nbsp;of&nbsp;passing&nbsp;them&nbsp;through&nbsp;unchanged&nbsp;with&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502054">StripEscape</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4502068">//&nbsp;Force&nbsp;right-alignment&nbsp;of&nbsp;cell&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4502111">//&nbsp;Default&nbsp;is&nbsp;left-alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502142">AlignRight</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4502155">//&nbsp;Handle&nbsp;empty&nbsp;columns&nbsp;as&nbsp;if&nbsp;they&nbsp;were&nbsp;not&nbsp;present&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4502211">//&nbsp;the&nbsp;input&nbsp;in&nbsp;the&nbsp;first&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502245">DiscardEmptyColumns</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4502267">//&nbsp;Always&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;columns&nbsp;(i.e.,&nbsp;padding&nbsp;of</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4502329">//&nbsp;leading&nbsp;empty&nbsp;cells&nbsp;on&nbsp;the&nbsp;left)&nbsp;independent&nbsp;of&nbsp;padchar.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502390">TabIndent</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4502402">//&nbsp;Print&nbsp;a&nbsp;vertical&nbsp;bar&nbsp;(&#39;|&#39;)&nbsp;between&nbsp;columns&nbsp;(after&nbsp;formatting).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4502469">//&nbsp;Discarded&nbsp;columns&nbsp;appear&nbsp;as&nbsp;zero-width&nbsp;columns&nbsp;(&#34;||&#34;).</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4502528">Debug</span><br>
<span class="lineno"></span><span class="op" id="4502534">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4502537">//&nbsp;A&nbsp;Writer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;with&nbsp;a&nbsp;call&nbsp;to&nbsp;Init.&nbsp;The&nbsp;first&nbsp;parameter&nbsp;(output)</span><br>
<span class="lineno"></span><span class="comment" id="4502619">//&nbsp;specifies&nbsp;the&nbsp;filter&nbsp;output.&nbsp;The&nbsp;remaining&nbsp;parameters&nbsp;control&nbsp;the&nbsp;formatting:</span><br>
<span class="lineno">160</span><span class="comment" id="4502700">//</span><br>
<span class="lineno"></span><span class="comment" id="4502703">//&nbsp;&nbsp;&nbsp;&nbspminwidth&nbsp;&nbsp;&nbsp;&nbspminimal&nbsp;cell&nbsp;width&nbsp;including&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span><span class="comment" id="4502756">//&nbsp;&nbsp;&nbsp;&nbsptabwidth&nbsp;&nbsp;&nbsp;&nbspwidth&nbsp;of&nbsp;tab&nbsp;characters&nbsp;(equivalent&nbsp;number&nbsp;of&nbsp;spaces)</span><br>
<span class="lineno"></span><span class="comment" id="4502822">//&nbsp;&nbsp;&nbsp;&nbsppadding&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsppadding&nbsp;added&nbsp;to&nbsp;a&nbsp;cell&nbsp;before&nbsp;computing&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="4502885">//&nbsp;&nbsp;&nbsp;&nbsppadchar&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspASCII&nbsp;char&nbsp;used&nbsp;for&nbsp;padding</span><br>
<span class="lineno">165</span><span class="comment" id="4502925">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;padchar&nbsp;==&nbsp;&#39;\t&#39;,&nbsp;the&nbsp;Writer&nbsp;will&nbsp;assume&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4502982">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspwidth&nbsp;of&nbsp;a&nbsp;&#39;\t&#39;&nbsp;in&nbsp;the&nbsp;formatted&nbsp;output&nbsp;is&nbsp;tabwidth,</span><br>
<span class="lineno"></span><span class="comment" id="4503040">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspand&nbsp;cells&nbsp;are&nbsp;left-aligned&nbsp;independent&nbsp;of&nbsp;align_left</span><br>
<span class="lineno"></span><span class="comment" id="4503098">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(for&nbsp;correct-looking&nbsp;results,&nbsp;tabwidth&nbsp;must&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="4503158">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspto&nbsp;the&nbsp;tab&nbsp;width&nbsp;in&nbsp;the&nbsp;viewer&nbsp;displaying&nbsp;the&nbsp;result)</span><br>
<span class="lineno">170</span><span class="comment" id="4503217">//&nbsp;&nbsp;&nbsp;&nbspflags&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspformatting&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="4503246">//</span><br>
<span class="lineno"></span><span class="keyword" id="4503249">func</span>&nbsp;<span class="op" id="4503254">(</span><span class="ident" id="4503255">b</span>&nbsp;<span class="op" id="4503257">*</span><span class="ident" id="4503258">Writer</span><span class="op" id="4503264">)</span>&nbsp;<span class="ident" id="4503266">Init</span><span class="op" id="4503270">(</span><span class="ident" id="4503271">output</span>&nbsp;<span class="ident" id="4503278">io</span><span class="op" id="4503280">.</span><span class="ident" id="4503281">Writer</span><span class="op" id="4503287">,</span>&nbsp;<span class="ident" id="4503289">minwidth</span><span class="op" id="4503297">,</span>&nbsp;<span class="ident" id="4503299">tabwidth</span><span class="op" id="4503307">,</span>&nbsp;<span class="ident" id="4503309">padding</span>&nbsp;<span class="builtintype" id="4503317">int</span><span class="op" id="4503320">,</span>&nbsp;<span class="ident" id="4503322">padchar</span>&nbsp;<span class="builtintype" id="4503330">byte</span><span class="op" id="4503334">,</span>&nbsp;<span class="ident" id="4503336">flags</span>&nbsp;<span class="builtintype" id="4503342">uint</span><span class="op" id="4503346">)</span>&nbsp;<span class="op" id="4503348">*</span><span class="ident" id="4503349">Writer</span>&nbsp;<span class="op" id="4503356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503359">if</span>&nbsp;<span class="ident" id="4503362">minwidth</span>&nbsp;<span class="op" id="4503371">&lt;</span>&nbsp;<span class="num" id="4503373">0</span>&nbsp;<span class="op" id="4503375">||</span>&nbsp;<span class="ident" id="4503378">tabwidth</span>&nbsp;<span class="op" id="4503387">&lt;</span>&nbsp;<span class="num" id="4503389">0</span>&nbsp;<span class="op" id="4503391">||</span>&nbsp;<span class="ident" id="4503394">padding</span>&nbsp;<span class="op" id="4503402">&lt;</span>&nbsp;<span class="num" id="4503404">0</span>&nbsp;<span class="op" id="4503406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4503410">panic</span><span class="op" id="4503415">(</span><span class="string" id="4503416">&#34;negative&nbsp;minwidth,&nbsp;tabwidth,&nbsp;or&nbsp;padding&#34;</span><span class="op" id="4503457">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4503460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503463">b</span><span class="op" id="4503464">.</span><span class="ident" id="4503465">output</span>&nbsp;<span class="op" id="4503472">=</span>&nbsp;<span class="ident" id="4503474">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503482">b</span><span class="op" id="4503483">.</span><span class="ident" id="4503484">minwidth</span>&nbsp;<span class="op" id="4503493">=</span>&nbsp;<span class="ident" id="4503495">minwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503505">b</span><span class="op" id="4503506">.</span><span class="ident" id="4503507">tabwidth</span>&nbsp;<span class="op" id="4503516">=</span>&nbsp;<span class="ident" id="4503518">tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503528">b</span><span class="op" id="4503529">.</span><span class="ident" id="4503530">padding</span>&nbsp;<span class="op" id="4503538">=</span>&nbsp;<span class="ident" id="4503540">padding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503549">for</span>&nbsp;<span class="ident" id="4503553">i</span>&nbsp;<span class="op" id="4503555">:=</span>&nbsp;<span class="keyword" id="4503558">range</span>&nbsp;<span class="ident" id="4503564">b</span><span class="op" id="4503565">.</span><span class="ident" id="4503566">padbytes</span>&nbsp;<span class="op" id="4503575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503579">b</span><span class="op" id="4503580">.</span><span class="ident" id="4503581">padbytes</span><span class="op" id="4503589">[</span><span class="ident" id="4503590">i</span><span class="op" id="4503591">]</span>&nbsp;<span class="op" id="4503593">=</span>&nbsp;<span class="ident" id="4503595">padchar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4503604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503607">if</span>&nbsp;<span class="ident" id="4503610">padchar</span>&nbsp;<span class="op" id="4503618">==</span>&nbsp;<span class="string" id="4503621">&#39;\t&#39;</span>&nbsp;<span class="op" id="4503626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4503630">//&nbsp;tab&nbsp;padding&nbsp;enforces&nbsp;left-alignment</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503671">flags</span>&nbsp;<span class="op" id="4503677">&amp;^=</span>&nbsp;<span class="ident" id="4503681">AlignRight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4503693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503696">b</span><span class="op" id="4503697">.</span><span class="ident" id="4503698">flags</span>&nbsp;<span class="op" id="4503704">=</span>&nbsp;<span class="ident" id="4503706">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503714">b</span><span class="op" id="4503715">.</span><span class="ident" id="4503716">reset</span><span class="op" id="4503721">(</span><span class="op" id="4503722">)</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503726">return</span>&nbsp;<span class="ident" id="4503733">b</span><br>
<span class="lineno"></span><span class="op" id="4503735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4503738">//&nbsp;debugging&nbsp;support&nbsp;(keep&nbsp;code&nbsp;around)</span><br>
<span class="lineno">195</span><span class="keyword" id="4503778">func</span>&nbsp;<span class="op" id="4503783">(</span><span class="ident" id="4503784">b</span>&nbsp;<span class="op" id="4503786">*</span><span class="ident" id="4503787">Writer</span><span class="op" id="4503793">)</span>&nbsp;<span class="ident" id="4503795">dump</span><span class="op" id="4503799">(</span><span class="op" id="4503800">)</span>&nbsp;<span class="op" id="4503802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503805">pos</span>&nbsp;<span class="op" id="4503809">:=</span>&nbsp;<span class="num" id="4503812">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503815">for</span>&nbsp;<span class="ident" id="4503819">i</span><span class="op" id="4503820">,</span>&nbsp;<span class="ident" id="4503822">line</span>&nbsp;<span class="op" id="4503827">:=</span>&nbsp;<span class="keyword" id="4503830">range</span>&nbsp;<span class="ident" id="4503836">b</span><span class="op" id="4503837">.</span><span class="ident" id="4503838">lines</span>&nbsp;<span class="op" id="4503844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4503848">print</span><span class="op" id="4503853">(</span><span class="string" id="4503854">&#34;(&#34;</span><span class="op" id="4503857">,</span>&nbsp;<span class="ident" id="4503859">i</span><span class="op" id="4503860">,</span>&nbsp;<span class="string" id="4503862">&#34;)&nbsp;&#34;</span><span class="op" id="4503866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4503870">for</span>&nbsp;<span class="ident" id="4503874">_</span><span class="op" id="4503875">,</span>&nbsp;<span class="ident" id="4503877">c</span>&nbsp;<span class="op" id="4503879">:=</span>&nbsp;<span class="keyword" id="4503882">range</span>&nbsp;<span class="ident" id="4503888">line</span>&nbsp;<span class="op" id="4503893">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4503898">print</span><span class="op" id="4503903">(</span><span class="string" id="4503904">&#34;[&#34;</span><span class="op" id="4503907">,</span>&nbsp;<span class="builtintype" id="4503909">string</span><span class="op" id="4503915">(</span><span class="ident" id="4503916">b</span><span class="op" id="4503917">.</span><span class="ident" id="4503918">buf</span><span class="op" id="4503921">.</span><span class="ident" id="4503922">Bytes</span><span class="op" id="4503927">(</span><span class="op" id="4503928">)</span><span class="op" id="4503929">[</span><span class="ident" id="4503930">pos</span><span class="op" id="4503933">:</span><span class="ident" id="4503934">pos</span><span class="op" id="4503937">+</span><span class="ident" id="4503938">c</span><span class="op" id="4503939">.</span><span class="ident" id="4503940">size</span><span class="op" id="4503944">]</span><span class="op" id="4503945">)</span><span class="op" id="4503946">,</span>&nbsp;<span class="string" id="4503948">&#34;]&#34;</span><span class="op" id="4503951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4503956">pos</span>&nbsp;<span class="op" id="4503960">+=</span>&nbsp;<span class="ident" id="4503963">c</span><span class="op" id="4503964">.</span><span class="ident" id="4503965">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4503972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4503976">print</span><span class="op" id="4503981">(</span><span class="string" id="4503982">&#34;\n&#34;</span><span class="op" id="4503986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4503989">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4503992">print</span><span class="op" id="4503997">(</span><span class="string" id="4503998">&#34;\n&#34;</span><span class="op" id="4504002">)</span><br>
<span class="lineno"></span><span class="op" id="4504004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4504007">//&nbsp;local&nbsp;error&nbsp;wrapper&nbsp;so&nbsp;we&nbsp;can&nbsp;distinguish&nbsp;errors&nbsp;we&nbsp;want&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4504077">//&nbsp;as&nbsp;errors&nbsp;from&nbsp;genuine&nbsp;panics&nbsp;(which&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;return&nbsp;as&nbsp;errors)</span><br>
<span class="lineno">210</span><span class="keyword" id="4504152">type</span>&nbsp;<span class="ident" id="4504157">osError</span>&nbsp;<span class="keyword" id="4504165">struct</span>&nbsp;<span class="op" id="4504172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504175">err</span>&nbsp;<span class="builtintype" id="4504179">error</span><br>
<span class="lineno"></span><span class="op" id="4504185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4504188">func</span>&nbsp;<span class="op" id="4504193">(</span><span class="ident" id="4504194">b</span>&nbsp;<span class="op" id="4504196">*</span><span class="ident" id="4504197">Writer</span><span class="op" id="4504203">)</span>&nbsp;<span class="ident" id="4504205">write0</span><span class="op" id="4504211">(</span><span class="ident" id="4504212">buf</span>&nbsp;<span class="op" id="4504216">[</span><span class="op" id="4504217">]</span><span class="builtintype" id="4504218">byte</span><span class="op" id="4504222">)</span>&nbsp;<span class="op" id="4504224">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504227">n</span><span class="op" id="4504228">,</span>&nbsp;<span class="ident" id="4504230">err</span>&nbsp;<span class="op" id="4504234">:=</span>&nbsp;<span class="ident" id="4504237">b</span><span class="op" id="4504238">.</span><span class="ident" id="4504239">output</span><span class="op" id="4504245">.</span><span class="ident" id="4504246">Write</span><span class="op" id="4504251">(</span><span class="ident" id="4504252">buf</span><span class="op" id="4504255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504258">if</span>&nbsp;<span class="ident" id="4504261">n</span>&nbsp;<span class="op" id="4504263">!=</span>&nbsp;<span class="builtinfunc" id="4504266">len</span><span class="op" id="4504269">(</span><span class="ident" id="4504270">buf</span><span class="op" id="4504273">)</span>&nbsp;<span class="op" id="4504275">&amp;&amp;</span>&nbsp;<span class="ident" id="4504278">err</span>&nbsp;<span class="op" id="4504282">==</span>&nbsp;<span class="ident" id="4504285">nil</span>&nbsp;<span class="op" id="4504289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504293">err</span>&nbsp;<span class="op" id="4504297">=</span>&nbsp;<span class="ident" id="4504299">io</span><span class="op" id="4504301">.</span><span class="ident" id="4504302">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4504317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504320">if</span>&nbsp;<span class="ident" id="4504323">err</span>&nbsp;<span class="op" id="4504327">!=</span>&nbsp;<span class="ident" id="4504330">nil</span>&nbsp;<span class="op" id="4504334">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4504338">panic</span><span class="op" id="4504343">(</span><span class="ident" id="4504344">osError</span><span class="op" id="4504351">{</span><span class="ident" id="4504352">err</span><span class="op" id="4504355">}</span><span class="op" id="4504356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4504359">}</span><br>
<span class="lineno"></span><span class="op" id="4504361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4504364">func</span>&nbsp;<span class="op" id="4504369">(</span><span class="ident" id="4504370">b</span>&nbsp;<span class="op" id="4504372">*</span><span class="ident" id="4504373">Writer</span><span class="op" id="4504379">)</span>&nbsp;<span class="ident" id="4504381">writeN</span><span class="op" id="4504387">(</span><span class="ident" id="4504388">src</span>&nbsp;<span class="op" id="4504392">[</span><span class="op" id="4504393">]</span><span class="builtintype" id="4504394">byte</span><span class="op" id="4504398">,</span>&nbsp;<span class="ident" id="4504400">n</span>&nbsp;<span class="builtintype" id="4504402">int</span><span class="op" id="4504405">)</span>&nbsp;<span class="op" id="4504407">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504410">for</span>&nbsp;<span class="ident" id="4504414">n</span>&nbsp;<span class="op" id="4504416">&gt;</span>&nbsp;<span class="builtinfunc" id="4504418">len</span><span class="op" id="4504421">(</span><span class="ident" id="4504422">src</span><span class="op" id="4504425">)</span>&nbsp;<span class="op" id="4504427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504431">b</span><span class="op" id="4504432">.</span><span class="ident" id="4504433">write0</span><span class="op" id="4504439">(</span><span class="ident" id="4504440">src</span><span class="op" id="4504443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504447">n</span>&nbsp;<span class="op" id="4504449">-=</span>&nbsp;<span class="builtinfunc" id="4504452">len</span><span class="op" id="4504455">(</span><span class="ident" id="4504456">src</span><span class="op" id="4504459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4504462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504465">b</span><span class="op" id="4504466">.</span><span class="ident" id="4504467">write0</span><span class="op" id="4504473">(</span><span class="ident" id="4504474">src</span><span class="op" id="4504477">[</span><span class="num" id="4504478">0</span><span class="op" id="4504479">:</span><span class="ident" id="4504480">n</span><span class="op" id="4504481">]</span><span class="op" id="4504482">)</span><br>
<span class="lineno">230</span><span class="op" id="4504484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4504487">var</span>&nbsp;<span class="op" id="4504491">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504494">newline</span>&nbsp;<span class="op" id="4504502">=</span>&nbsp;<span class="op" id="4504504">[</span><span class="op" id="4504505">]</span><span class="builtintype" id="4504506">byte</span><span class="op" id="4504510">{</span><span class="string" id="4504511">&#39;\n&#39;</span><span class="op" id="4504515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504518">tabs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4504526">=</span>&nbsp;<span class="op" id="4504528">[</span><span class="op" id="4504529">]</span><span class="builtintype" id="4504530">byte</span><span class="op" id="4504534">(</span><span class="string" id="4504535">&#34;\t\t\t\t\t\t\t\t&#34;</span><span class="op" id="4504553">)</span><br>
<span class="lineno">235</span><span class="op" id="4504555">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4504558">func</span>&nbsp;<span class="op" id="4504563">(</span><span class="ident" id="4504564">b</span>&nbsp;<span class="op" id="4504566">*</span><span class="ident" id="4504567">Writer</span><span class="op" id="4504573">)</span>&nbsp;<span class="ident" id="4504575">writePadding</span><span class="op" id="4504587">(</span><span class="ident" id="4504588">textw</span><span class="op" id="4504593">,</span>&nbsp;<span class="ident" id="4504595">cellw</span>&nbsp;<span class="builtintype" id="4504601">int</span><span class="op" id="4504604">,</span>&nbsp;<span class="ident" id="4504606">useTabs</span>&nbsp;<span class="builtintype" id="4504614">bool</span><span class="op" id="4504618">)</span>&nbsp;<span class="op" id="4504620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504623">if</span>&nbsp;<span class="ident" id="4504626">b</span><span class="op" id="4504627">.</span><span class="ident" id="4504628">padbytes</span><span class="op" id="4504636">[</span><span class="num" id="4504637">0</span><span class="op" id="4504638">]</span>&nbsp;<span class="op" id="4504640">==</span>&nbsp;<span class="string" id="4504643">&#39;\t&#39;</span>&nbsp;<span class="op" id="4504648">||</span>&nbsp;<span class="ident" id="4504651">useTabs</span>&nbsp;<span class="op" id="4504659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4504663">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;tabs</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504694">if</span>&nbsp;<span class="ident" id="4504697">b</span><span class="op" id="4504698">.</span><span class="ident" id="4504699">tabwidth</span>&nbsp;<span class="op" id="4504708">==</span>&nbsp;<span class="num" id="4504711">0</span>&nbsp;<span class="op" id="4504713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504718">return</span>&nbsp;<span class="comment" id="4504725">//&nbsp;tabs&nbsp;have&nbsp;no&nbsp;width&nbsp;-&nbsp;can&#39;t&nbsp;do&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4504772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4504776">//&nbsp;make&nbsp;cellw&nbsp;the&nbsp;smallest&nbsp;multiple&nbsp;of&nbsp;b.tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504828">cellw</span>&nbsp;<span class="op" id="4504834">=</span>&nbsp;<span class="op" id="4504836">(</span><span class="ident" id="4504837">cellw</span>&nbsp;<span class="op" id="4504843">+</span>&nbsp;<span class="ident" id="4504845">b</span><span class="op" id="4504846">.</span><span class="ident" id="4504847">tabwidth</span>&nbsp;<span class="op" id="4504856">-</span>&nbsp;<span class="num" id="4504858">1</span><span class="op" id="4504859">)</span>&nbsp;<span class="op" id="4504861">/</span>&nbsp;<span class="ident" id="4504863">b</span><span class="op" id="4504864">.</span><span class="ident" id="4504865">tabwidth</span>&nbsp;<span class="op" id="4504874">*</span>&nbsp;<span class="ident" id="4504876">b</span><span class="op" id="4504877">.</span><span class="ident" id="4504878">tabwidth</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504889">n</span>&nbsp;<span class="op" id="4504891">:=</span>&nbsp;<span class="ident" id="4504894">cellw</span>&nbsp;<span class="op" id="4504900">-</span>&nbsp;<span class="ident" id="4504902">textw</span>&nbsp;<span class="comment" id="4504908">//&nbsp;amount&nbsp;of&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4504931">if</span>&nbsp;<span class="ident" id="4504934">n</span>&nbsp;<span class="op" id="4504936">&lt;</span>&nbsp;<span class="num" id="4504938">0</span>&nbsp;<span class="op" id="4504940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4504945">panic</span><span class="op" id="4504950">(</span><span class="string" id="4504951">&#34;internal&nbsp;error&#34;</span><span class="op" id="4504967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4504971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4504975">b</span><span class="op" id="4504976">.</span><span class="ident" id="4504977">writeN</span><span class="op" id="4504983">(</span><span class="ident" id="4504984">tabs</span><span class="op" id="4504988">,</span>&nbsp;<span class="op" id="4504990">(</span><span class="ident" id="4504991">n</span><span class="op" id="4504992">+</span><span class="ident" id="4504993">b</span><span class="op" id="4504994">.</span><span class="ident" id="4504995">tabwidth</span><span class="op" id="4505003">-</span><span class="num" id="4505004">1</span><span class="op" id="4505005">)</span><span class="op" id="4505006">/</span><span class="ident" id="4505007">b</span><span class="op" id="4505008">.</span><span class="ident" id="4505009">tabwidth</span><span class="op" id="4505017">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505021">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4505029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4505033">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;non-tab&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505077">b</span><span class="op" id="4505078">.</span><span class="ident" id="4505079">writeN</span><span class="op" id="4505085">(</span><span class="ident" id="4505086">b</span><span class="op" id="4505087">.</span><span class="ident" id="4505088">padbytes</span><span class="op" id="4505096">[</span><span class="num" id="4505097">0</span><span class="op" id="4505098">:</span><span class="op" id="4505099">]</span><span class="op" id="4505100">,</span>&nbsp;<span class="ident" id="4505102">cellw</span><span class="op" id="4505107">-</span><span class="ident" id="4505108">textw</span><span class="op" id="4505113">)</span><br>
<span class="lineno">255</span><span class="op" id="4505115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4505118">var</span>&nbsp;<span class="ident" id="4505122">vbar</span>&nbsp;<span class="op" id="4505127">=</span>&nbsp;<span class="op" id="4505129">[</span><span class="op" id="4505130">]</span><span class="builtintype" id="4505131">byte</span><span class="op" id="4505135">{</span><span class="string" id="4505136">&#39;|&#39;</span><span class="op" id="4505139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4505142">func</span>&nbsp;<span class="op" id="4505147">(</span><span class="ident" id="4505148">b</span>&nbsp;<span class="op" id="4505150">*</span><span class="ident" id="4505151">Writer</span><span class="op" id="4505157">)</span>&nbsp;<span class="ident" id="4505159">writeLines</span><span class="op" id="4505169">(</span><span class="ident" id="4505170">pos0</span>&nbsp;<span class="builtintype" id="4505175">int</span><span class="op" id="4505178">,</span>&nbsp;<span class="ident" id="4505180">line0</span><span class="op" id="4505185">,</span>&nbsp;<span class="ident" id="4505187">line1</span>&nbsp;<span class="builtintype" id="4505193">int</span><span class="op" id="4505196">)</span>&nbsp;<span class="op" id="4505198">(</span><span class="ident" id="4505199">pos</span>&nbsp;<span class="builtintype" id="4505203">int</span><span class="op" id="4505206">)</span>&nbsp;<span class="op" id="4505208">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505211">pos</span>&nbsp;<span class="op" id="4505215">=</span>&nbsp;<span class="ident" id="4505217">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505223">for</span>&nbsp;<span class="ident" id="4505227">i</span>&nbsp;<span class="op" id="4505229">:=</span>&nbsp;<span class="ident" id="4505232">line0</span><span class="op" id="4505237">;</span>&nbsp;<span class="ident" id="4505239">i</span>&nbsp;<span class="op" id="4505241">&lt;</span>&nbsp;<span class="ident" id="4505243">line1</span><span class="op" id="4505248">;</span>&nbsp;<span class="ident" id="4505250">i</span><span class="op" id="4505251">++</span>&nbsp;<span class="op" id="4505254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505258">line</span>&nbsp;<span class="op" id="4505263">:=</span>&nbsp;<span class="ident" id="4505266">b</span><span class="op" id="4505267">.</span><span class="ident" id="4505268">lines</span><span class="op" id="4505273">[</span><span class="ident" id="4505274">i</span><span class="op" id="4505275">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4505280">//&nbsp;if&nbsp;TabIndent&nbsp;is&nbsp;set,&nbsp;use&nbsp;tabs&nbsp;to&nbsp;pad&nbsp;leading&nbsp;empty&nbsp;cells</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505342">useTabs</span>&nbsp;<span class="op" id="4505350">:=</span>&nbsp;<span class="ident" id="4505353">b</span><span class="op" id="4505354">.</span><span class="ident" id="4505355">flags</span><span class="op" id="4505360">&amp;</span><span class="ident" id="4505361">TabIndent</span>&nbsp;<span class="op" id="4505371">!=</span>&nbsp;<span class="num" id="4505374">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505379">for</span>&nbsp;<span class="ident" id="4505383">j</span><span class="op" id="4505384">,</span>&nbsp;<span class="ident" id="4505386">c</span>&nbsp;<span class="op" id="4505388">:=</span>&nbsp;<span class="keyword" id="4505391">range</span>&nbsp;<span class="ident" id="4505397">line</span>&nbsp;<span class="op" id="4505402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505407">if</span>&nbsp;<span class="ident" id="4505410">j</span>&nbsp;<span class="op" id="4505412">&gt;</span>&nbsp;<span class="num" id="4505414">0</span>&nbsp;<span class="op" id="4505416">&amp;&amp;</span>&nbsp;<span class="ident" id="4505419">b</span><span class="op" id="4505420">.</span><span class="ident" id="4505421">flags</span><span class="op" id="4505426">&amp;</span><span class="ident" id="4505427">Debug</span>&nbsp;<span class="op" id="4505433">!=</span>&nbsp;<span class="num" id="4505436">0</span>&nbsp;<span class="op" id="4505438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4505444">//&nbsp;indicate&nbsp;column&nbsp;break</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505473">b</span><span class="op" id="4505474">.</span><span class="ident" id="4505475">write0</span><span class="op" id="4505481">(</span><span class="ident" id="4505482">vbar</span><span class="op" id="4505486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4505491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505497">if</span>&nbsp;<span class="ident" id="4505500">c</span><span class="op" id="4505501">.</span><span class="ident" id="4505502">size</span>&nbsp;<span class="op" id="4505507">==</span>&nbsp;<span class="num" id="4505510">0</span>&nbsp;<span class="op" id="4505512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4505518">//&nbsp;empty&nbsp;cell</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505536">if</span>&nbsp;<span class="ident" id="4505539">j</span>&nbsp;<span class="op" id="4505541">&lt;</span>&nbsp;<span class="builtinfunc" id="4505543">len</span><span class="op" id="4505546">(</span><span class="ident" id="4505547">b</span><span class="op" id="4505548">.</span><span class="ident" id="4505549">widths</span><span class="op" id="4505555">)</span>&nbsp;<span class="op" id="4505557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505564">b</span><span class="op" id="4505565">.</span><span class="ident" id="4505566">writePadding</span><span class="op" id="4505578">(</span><span class="ident" id="4505579">c</span><span class="op" id="4505580">.</span><span class="ident" id="4505581">width</span><span class="op" id="4505586">,</span>&nbsp;<span class="ident" id="4505588">b</span><span class="op" id="4505589">.</span><span class="ident" id="4505590">widths</span><span class="op" id="4505596">[</span><span class="ident" id="4505597">j</span><span class="op" id="4505598">]</span><span class="op" id="4505599">,</span>&nbsp;<span class="ident" id="4505601">useTabs</span><span class="op" id="4505608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4505614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4505619">}</span>&nbsp;<span class="keyword" id="4505621">else</span>&nbsp;<span class="op" id="4505626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4505632">//&nbsp;non-empty&nbsp;cell</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505654">useTabs</span>&nbsp;<span class="op" id="4505662">=</span>&nbsp;<span class="builtintype" id="4505664">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505674">if</span>&nbsp;<span class="ident" id="4505677">b</span><span class="op" id="4505678">.</span><span class="ident" id="4505679">flags</span><span class="op" id="4505684">&amp;</span><span class="ident" id="4505685">AlignRight</span>&nbsp;<span class="op" id="4505696">==</span>&nbsp;<span class="num" id="4505699">0</span>&nbsp;<span class="op" id="4505701">{</span>&nbsp;<span class="comment" id="4505703">//&nbsp;align&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505722">b</span><span class="op" id="4505723">.</span><span class="ident" id="4505724">write0</span><span class="op" id="4505730">(</span><span class="ident" id="4505731">b</span><span class="op" id="4505732">.</span><span class="ident" id="4505733">buf</span><span class="op" id="4505736">.</span><span class="ident" id="4505737">Bytes</span><span class="op" id="4505742">(</span><span class="op" id="4505743">)</span><span class="op" id="4505744">[</span><span class="ident" id="4505745">pos</span>&nbsp;<span class="op" id="4505749">:</span>&nbsp;<span class="ident" id="4505751">pos</span><span class="op" id="4505754">+</span><span class="ident" id="4505755">c</span><span class="op" id="4505756">.</span><span class="ident" id="4505757">size</span><span class="op" id="4505761">]</span><span class="op" id="4505762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505769">pos</span>&nbsp;<span class="op" id="4505773">+=</span>&nbsp;<span class="ident" id="4505776">c</span><span class="op" id="4505777">.</span><span class="ident" id="4505778">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505788">if</span>&nbsp;<span class="ident" id="4505791">j</span>&nbsp;<span class="op" id="4505793">&lt;</span>&nbsp;<span class="builtinfunc" id="4505795">len</span><span class="op" id="4505798">(</span><span class="ident" id="4505799">b</span><span class="op" id="4505800">.</span><span class="ident" id="4505801">widths</span><span class="op" id="4505807">)</span>&nbsp;<span class="op" id="4505809">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505817">b</span><span class="op" id="4505818">.</span><span class="ident" id="4505819">writePadding</span><span class="op" id="4505831">(</span><span class="ident" id="4505832">c</span><span class="op" id="4505833">.</span><span class="ident" id="4505834">width</span><span class="op" id="4505839">,</span>&nbsp;<span class="ident" id="4505841">b</span><span class="op" id="4505842">.</span><span class="ident" id="4505843">widths</span><span class="op" id="4505849">[</span><span class="ident" id="4505850">j</span><span class="op" id="4505851">]</span><span class="op" id="4505852">,</span>&nbsp;<span class="builtintype" id="4505854">false</span><span class="op" id="4505859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4505866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4505872">}</span>&nbsp;<span class="keyword" id="4505874">else</span>&nbsp;<span class="op" id="4505879">{</span>&nbsp;<span class="comment" id="4505881">//&nbsp;align&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4505901">if</span>&nbsp;<span class="ident" id="4505904">j</span>&nbsp;<span class="op" id="4505906">&lt;</span>&nbsp;<span class="builtinfunc" id="4505908">len</span><span class="op" id="4505911">(</span><span class="ident" id="4505912">b</span><span class="op" id="4505913">.</span><span class="ident" id="4505914">widths</span><span class="op" id="4505920">)</span>&nbsp;<span class="op" id="4505922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505930">b</span><span class="op" id="4505931">.</span><span class="ident" id="4505932">writePadding</span><span class="op" id="4505944">(</span><span class="ident" id="4505945">c</span><span class="op" id="4505946">.</span><span class="ident" id="4505947">width</span><span class="op" id="4505952">,</span>&nbsp;<span class="ident" id="4505954">b</span><span class="op" id="4505955">.</span><span class="ident" id="4505956">widths</span><span class="op" id="4505962">[</span><span class="ident" id="4505963">j</span><span class="op" id="4505964">]</span><span class="op" id="4505965">,</span>&nbsp;<span class="builtintype" id="4505967">false</span><span class="op" id="4505972">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4505979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4505986">b</span><span class="op" id="4505987">.</span><span class="ident" id="4505988">write0</span><span class="op" id="4505994">(</span><span class="ident" id="4505995">b</span><span class="op" id="4505996">.</span><span class="ident" id="4505997">buf</span><span class="op" id="4506000">.</span><span class="ident" id="4506001">Bytes</span><span class="op" id="4506006">(</span><span class="op" id="4506007">)</span><span class="op" id="4506008">[</span><span class="ident" id="4506009">pos</span>&nbsp;<span class="op" id="4506013">:</span>&nbsp;<span class="ident" id="4506015">pos</span><span class="op" id="4506018">+</span><span class="ident" id="4506019">c</span><span class="op" id="4506020">.</span><span class="ident" id="4506021">size</span><span class="op" id="4506025">]</span><span class="op" id="4506026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506033">pos</span>&nbsp;<span class="op" id="4506037">+=</span>&nbsp;<span class="ident" id="4506040">c</span><span class="op" id="4506041">.</span><span class="ident" id="4506042">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506056">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506065">if</span>&nbsp;<span class="ident" id="4506068">i</span><span class="op" id="4506069">+</span><span class="num" id="4506070">1</span>&nbsp;<span class="op" id="4506072">==</span>&nbsp;<span class="builtinfunc" id="4506075">len</span><span class="op" id="4506078">(</span><span class="ident" id="4506079">b</span><span class="op" id="4506080">.</span><span class="ident" id="4506081">lines</span><span class="op" id="4506086">)</span>&nbsp;<span class="op" id="4506088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4506093">//&nbsp;last&nbsp;buffered&nbsp;line&nbsp;-&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;newline,&nbsp;so&nbsp;just&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4506159">//&nbsp;any&nbsp;outstanding&nbsp;buffered&nbsp;data</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506195">b</span><span class="op" id="4506196">.</span><span class="ident" id="4506197">write0</span><span class="op" id="4506203">(</span><span class="ident" id="4506204">b</span><span class="op" id="4506205">.</span><span class="ident" id="4506206">buf</span><span class="op" id="4506209">.</span><span class="ident" id="4506210">Bytes</span><span class="op" id="4506215">(</span><span class="op" id="4506216">)</span><span class="op" id="4506217">[</span><span class="ident" id="4506218">pos</span>&nbsp;<span class="op" id="4506222">:</span>&nbsp;<span class="ident" id="4506224">pos</span><span class="op" id="4506227">+</span><span class="ident" id="4506228">b</span><span class="op" id="4506229">.</span><span class="ident" id="4506230">cell</span><span class="op" id="4506234">.</span><span class="ident" id="4506235">size</span><span class="op" id="4506239">]</span><span class="op" id="4506240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506245">pos</span>&nbsp;<span class="op" id="4506249">+=</span>&nbsp;<span class="ident" id="4506252">b</span><span class="op" id="4506253">.</span><span class="ident" id="4506254">cell</span><span class="op" id="4506258">.</span><span class="ident" id="4506259">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506266">}</span>&nbsp;<span class="keyword" id="4506268">else</span>&nbsp;<span class="op" id="4506273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4506278">//&nbsp;not&nbsp;the&nbsp;last&nbsp;line&nbsp;-&nbsp;write&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506318">b</span><span class="op" id="4506319">.</span><span class="ident" id="4506320">write0</span><span class="op" id="4506326">(</span><span class="ident" id="4506327">newline</span><span class="op" id="4506334">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4506341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506344">return</span><br>
<span class="lineno"></span><span class="op" id="4506351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="4506354">//&nbsp;Format&nbsp;the&nbsp;text&nbsp;between&nbsp;line0&nbsp;and&nbsp;line1&nbsp;(excluding&nbsp;line1);&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="4506420">//&nbsp;is&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;line0.</span><br>
<span class="lineno"></span><span class="comment" id="4506487">//&nbsp;Returns&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4506552">//&nbsp;line1&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="4506583">//</span><br>
<span class="lineno">315</span><span class="keyword" id="4506586">func</span>&nbsp;<span class="op" id="4506591">(</span><span class="ident" id="4506592">b</span>&nbsp;<span class="op" id="4506594">*</span><span class="ident" id="4506595">Writer</span><span class="op" id="4506601">)</span>&nbsp;<span class="ident" id="4506603">format</span><span class="op" id="4506609">(</span><span class="ident" id="4506610">pos0</span>&nbsp;<span class="builtintype" id="4506615">int</span><span class="op" id="4506618">,</span>&nbsp;<span class="ident" id="4506620">line0</span><span class="op" id="4506625">,</span>&nbsp;<span class="ident" id="4506627">line1</span>&nbsp;<span class="builtintype" id="4506633">int</span><span class="op" id="4506636">)</span>&nbsp;<span class="op" id="4506638">(</span><span class="ident" id="4506639">pos</span>&nbsp;<span class="builtintype" id="4506643">int</span><span class="op" id="4506646">)</span>&nbsp;<span class="op" id="4506648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506651">pos</span>&nbsp;<span class="op" id="4506655">=</span>&nbsp;<span class="ident" id="4506657">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506663">column</span>&nbsp;<span class="op" id="4506670">:=</span>&nbsp;<span class="builtinfunc" id="4506673">len</span><span class="op" id="4506676">(</span><span class="ident" id="4506677">b</span><span class="op" id="4506678">.</span><span class="ident" id="4506679">widths</span><span class="op" id="4506685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506688">for</span>&nbsp;<span class="ident" id="4506692">this</span>&nbsp;<span class="op" id="4506697">:=</span>&nbsp;<span class="ident" id="4506700">line0</span><span class="op" id="4506705">;</span>&nbsp;<span class="ident" id="4506707">this</span>&nbsp;<span class="op" id="4506712">&lt;</span>&nbsp;<span class="ident" id="4506714">line1</span><span class="op" id="4506719">;</span>&nbsp;<span class="ident" id="4506721">this</span><span class="op" id="4506725">++</span>&nbsp;<span class="op" id="4506728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4506732">line</span>&nbsp;<span class="op" id="4506737">:=</span>&nbsp;<span class="ident" id="4506740">b</span><span class="op" id="4506741">.</span><span class="ident" id="4506742">lines</span><span class="op" id="4506747">[</span><span class="ident" id="4506748">this</span><span class="op" id="4506752">]</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4506757">if</span>&nbsp;<span class="ident" id="4506760">column</span>&nbsp;<span class="op" id="4506767">&lt;</span>&nbsp;<span class="builtinfunc" id="4506769">len</span><span class="op" id="4506772">(</span><span class="ident" id="4506773">line</span><span class="op" id="4506777">)</span><span class="op" id="4506778">-</span><span class="num" id="4506779">1</span>&nbsp;<span class="op" id="4506781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4506786">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column&nbsp;=&gt;&nbsp;this&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4506832">//&nbsp;has&nbsp;more&nbsp;cells&nbsp;than&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4506876">//&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;is&nbsp;ignored&nbsp;because&nbsp;cells&nbsp;are</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4506935">//&nbsp;tab-terminated;&nbsp;the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4506994">//&nbsp;text&nbsp;before&nbsp;the&nbsp;newline/formfeed&nbsp;and&nbsp;does&nbsp;not&nbsp;belong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507053">//&nbsp;to&nbsp;a&nbsp;column)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507073">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;beginning&nbsp;of&nbsp;block</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507126">pos</span>&nbsp;<span class="op" id="4507130">=</span>&nbsp;<span class="ident" id="4507132">b</span><span class="op" id="4507133">.</span><span class="ident" id="4507134">writeLines</span><span class="op" id="4507144">(</span><span class="ident" id="4507145">pos</span><span class="op" id="4507148">,</span>&nbsp;<span class="ident" id="4507150">line0</span><span class="op" id="4507155">,</span>&nbsp;<span class="ident" id="4507157">this</span><span class="op" id="4507161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507166">line0</span>&nbsp;<span class="op" id="4507172">=</span>&nbsp;<span class="ident" id="4507174">this</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507183">//&nbsp;column&nbsp;block&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507208">width</span>&nbsp;<span class="op" id="4507214">:=</span>&nbsp;<span class="ident" id="4507217">b</span><span class="op" id="4507218">.</span><span class="ident" id="4507219">minwidth</span>&nbsp;<span class="comment" id="4507228">//&nbsp;minimal&nbsp;column&nbsp;width</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507255">discardable</span>&nbsp;<span class="op" id="4507267">:=</span>&nbsp;<span class="builtintype" id="4507270">true</span>&nbsp;<span class="comment" id="4507275">//&nbsp;true&nbsp;if&nbsp;all&nbsp;cells&nbsp;in&nbsp;this&nbsp;column&nbsp;are&nbsp;empty&nbsp;and&nbsp;&#34;soft&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507335">for</span>&nbsp;<span class="op" id="4507339">;</span>&nbsp;<span class="ident" id="4507341">this</span>&nbsp;<span class="op" id="4507346">&lt;</span>&nbsp;<span class="ident" id="4507348">line1</span><span class="op" id="4507353">;</span>&nbsp;<span class="ident" id="4507355">this</span><span class="op" id="4507359">++</span>&nbsp;<span class="op" id="4507362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507368">line</span>&nbsp;<span class="op" id="4507373">=</span>&nbsp;<span class="ident" id="4507375">b</span><span class="op" id="4507376">.</span><span class="ident" id="4507377">lines</span><span class="op" id="4507382">[</span><span class="ident" id="4507383">this</span><span class="op" id="4507387">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507393">if</span>&nbsp;<span class="ident" id="4507396">column</span>&nbsp;<span class="op" id="4507403">&lt;</span>&nbsp;<span class="builtinfunc" id="4507405">len</span><span class="op" id="4507408">(</span><span class="ident" id="4507409">line</span><span class="op" id="4507413">)</span><span class="op" id="4507414">-</span><span class="num" id="4507415">1</span>&nbsp;<span class="op" id="4507417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507424">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507459">c</span>&nbsp;<span class="op" id="4507461">:=</span>&nbsp;<span class="ident" id="4507464">line</span><span class="op" id="4507468">[</span><span class="ident" id="4507469">column</span><span class="op" id="4507475">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507482">//&nbsp;update&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507503">if</span>&nbsp;<span class="ident" id="4507506">w</span>&nbsp;<span class="op" id="4507508">:=</span>&nbsp;<span class="ident" id="4507511">c</span><span class="op" id="4507512">.</span><span class="ident" id="4507513">width</span>&nbsp;<span class="op" id="4507519">+</span>&nbsp;<span class="ident" id="4507521">b</span><span class="op" id="4507522">.</span><span class="ident" id="4507523">padding</span><span class="op" id="4507530">;</span>&nbsp;<span class="ident" id="4507532">w</span>&nbsp;<span class="op" id="4507534">&gt;</span>&nbsp;<span class="ident" id="4507536">width</span>&nbsp;<span class="op" id="4507542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507550">width</span>&nbsp;<span class="op" id="4507556">=</span>&nbsp;<span class="ident" id="4507558">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4507565">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507572">//&nbsp;update&nbsp;discardable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507599">if</span>&nbsp;<span class="ident" id="4507602">c</span><span class="op" id="4507603">.</span><span class="ident" id="4507604">width</span>&nbsp;<span class="op" id="4507610">&gt;</span>&nbsp;<span class="num" id="4507612">0</span>&nbsp;<span class="op" id="4507614">||</span>&nbsp;<span class="ident" id="4507617">c</span><span class="op" id="4507618">.</span><span class="ident" id="4507619">htab</span>&nbsp;<span class="op" id="4507624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507632">discardable</span>&nbsp;<span class="op" id="4507644">=</span>&nbsp;<span class="builtintype" id="4507646">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4507657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4507663">}</span>&nbsp;<span class="keyword" id="4507665">else</span>&nbsp;<span class="op" id="4507670">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507677">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4507687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4507692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507697">//&nbsp;column&nbsp;block&nbsp;end</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507721">//&nbsp;discard&nbsp;empty&nbsp;columns&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4507762">if</span>&nbsp;<span class="ident" id="4507765">discardable</span>&nbsp;<span class="op" id="4507777">&amp;&amp;</span>&nbsp;<span class="ident" id="4507780">b</span><span class="op" id="4507781">.</span><span class="ident" id="4507782">flags</span><span class="op" id="4507787">&amp;</span><span class="ident" id="4507788">DiscardEmptyColumns</span>&nbsp;<span class="op" id="4507808">!=</span>&nbsp;<span class="num" id="4507811">0</span>&nbsp;<span class="op" id="4507813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507819">width</span>&nbsp;<span class="op" id="4507825">=</span>&nbsp;<span class="num" id="4507827">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4507832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507838">//&nbsp;format&nbsp;and&nbsp;print&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;right&nbsp;of&nbsp;this&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4507901">//&nbsp;(we&nbsp;know&nbsp;the&nbsp;widths&nbsp;of&nbsp;this&nbsp;column&nbsp;and&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;left)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4507971">b</span><span class="op" id="4507972">.</span><span class="ident" id="4507973">widths</span>&nbsp;<span class="op" id="4507980">=</span>&nbsp;<span class="builtinfunc" id="4507982">append</span><span class="op" id="4507988">(</span><span class="ident" id="4507989">b</span><span class="op" id="4507990">.</span><span class="ident" id="4507991">widths</span><span class="op" id="4507997">,</span>&nbsp;<span class="ident" id="4507999">width</span><span class="op" id="4508004">)</span>&nbsp;<span class="comment" id="4508006">//&nbsp;push&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508023">pos</span>&nbsp;<span class="op" id="4508027">=</span>&nbsp;<span class="ident" id="4508029">b</span><span class="op" id="4508030">.</span><span class="ident" id="4508031">format</span><span class="op" id="4508037">(</span><span class="ident" id="4508038">pos</span><span class="op" id="4508041">,</span>&nbsp;<span class="ident" id="4508043">line0</span><span class="op" id="4508048">,</span>&nbsp;<span class="ident" id="4508050">this</span><span class="op" id="4508054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508059">b</span><span class="op" id="4508060">.</span><span class="ident" id="4508061">widths</span>&nbsp;<span class="op" id="4508068">=</span>&nbsp;<span class="ident" id="4508070">b</span><span class="op" id="4508071">.</span><span class="ident" id="4508072">widths</span><span class="op" id="4508078">[</span><span class="num" id="4508079">0</span>&nbsp;<span class="op" id="4508081">:</span>&nbsp;<span class="builtinfunc" id="4508083">len</span><span class="op" id="4508086">(</span><span class="ident" id="4508087">b</span><span class="op" id="4508088">.</span><span class="ident" id="4508089">widths</span><span class="op" id="4508095">)</span><span class="op" id="4508096">-</span><span class="num" id="4508097">1</span><span class="op" id="4508098">]</span>&nbsp;<span class="comment" id="4508100">//&nbsp;pop&nbsp;width</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508116">line0</span>&nbsp;<span class="op" id="4508122">=</span>&nbsp;<span class="ident" id="4508124">this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4508131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4508134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4508138">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;end</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508174">return</span>&nbsp;<span class="ident" id="4508181">b</span><span class="op" id="4508182">.</span><span class="ident" id="4508183">writeLines</span><span class="op" id="4508193">(</span><span class="ident" id="4508194">pos</span><span class="op" id="4508197">,</span>&nbsp;<span class="ident" id="4508199">line0</span><span class="op" id="4508204">,</span>&nbsp;<span class="ident" id="4508206">line1</span><span class="op" id="4508211">)</span><br>
<span class="lineno"></span><span class="op" id="4508213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4508216">//&nbsp;Append&nbsp;text&nbsp;to&nbsp;current&nbsp;cell.</span><br>
<span class="lineno"></span><span class="keyword" id="4508248">func</span>&nbsp;<span class="op" id="4508253">(</span><span class="ident" id="4508254">b</span>&nbsp;<span class="op" id="4508256">*</span><span class="ident" id="4508257">Writer</span><span class="op" id="4508263">)</span>&nbsp;<span class="builtinfunc" id="4508265">append</span><span class="op" id="4508271">(</span><span class="ident" id="4508272">text</span>&nbsp;<span class="op" id="4508277">[</span><span class="op" id="4508278">]</span><span class="builtintype" id="4508279">byte</span><span class="op" id="4508283">)</span>&nbsp;<span class="op" id="4508285">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508288">b</span><span class="op" id="4508289">.</span><span class="ident" id="4508290">buf</span><span class="op" id="4508293">.</span><span class="ident" id="4508294">Write</span><span class="op" id="4508299">(</span><span class="ident" id="4508300">text</span><span class="op" id="4508304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508307">b</span><span class="op" id="4508308">.</span><span class="ident" id="4508309">cell</span><span class="op" id="4508313">.</span><span class="ident" id="4508314">size</span>&nbsp;<span class="op" id="4508319">+=</span>&nbsp;<span class="builtinfunc" id="4508322">len</span><span class="op" id="4508325">(</span><span class="ident" id="4508326">text</span><span class="op" id="4508330">)</span><br>
<span class="lineno"></span><span class="op" id="4508332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4508335">//&nbsp;Update&nbsp;the&nbsp;cell&nbsp;width.</span><br>
<span class="lineno">380</span><span class="keyword" id="4508361">func</span>&nbsp;<span class="op" id="4508366">(</span><span class="ident" id="4508367">b</span>&nbsp;<span class="op" id="4508369">*</span><span class="ident" id="4508370">Writer</span><span class="op" id="4508376">)</span>&nbsp;<span class="ident" id="4508378">updateWidth</span><span class="op" id="4508389">(</span><span class="op" id="4508390">)</span>&nbsp;<span class="op" id="4508392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508395">b</span><span class="op" id="4508396">.</span><span class="ident" id="4508397">cell</span><span class="op" id="4508401">.</span><span class="ident" id="4508402">width</span>&nbsp;<span class="op" id="4508408">+=</span>&nbsp;<span class="ident" id="4508411">utf8</span><span class="op" id="4508415">.</span><span class="ident" id="4508416">RuneCount</span><span class="op" id="4508425">(</span><span class="ident" id="4508426">b</span><span class="op" id="4508427">.</span><span class="ident" id="4508428">buf</span><span class="op" id="4508431">.</span><span class="ident" id="4508432">Bytes</span><span class="op" id="4508437">(</span><span class="op" id="4508438">)</span><span class="op" id="4508439">[</span><span class="ident" id="4508440">b</span><span class="op" id="4508441">.</span><span class="ident" id="4508442">pos</span><span class="op" id="4508445">:</span><span class="ident" id="4508446">b</span><span class="op" id="4508447">.</span><span class="ident" id="4508448">buf</span><span class="op" id="4508451">.</span><span class="ident" id="4508452">Len</span><span class="op" id="4508455">(</span><span class="op" id="4508456">)</span><span class="op" id="4508457">]</span><span class="op" id="4508458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508461">b</span><span class="op" id="4508462">.</span><span class="ident" id="4508463">pos</span>&nbsp;<span class="op" id="4508467">=</span>&nbsp;<span class="ident" id="4508469">b</span><span class="op" id="4508470">.</span><span class="ident" id="4508471">buf</span><span class="op" id="4508474">.</span><span class="ident" id="4508475">Len</span><span class="op" id="4508478">(</span><span class="op" id="4508479">)</span><br>
<span class="lineno"></span><span class="op" id="4508481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="4508484">//&nbsp;To&nbsp;escape&nbsp;a&nbsp;text&nbsp;segment,&nbsp;bracket&nbsp;it&nbsp;with&nbsp;Escape&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="4508548">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;tab&nbsp;in&nbsp;this&nbsp;string&nbsp;&#34;Ignore&nbsp;this&nbsp;tab:&nbsp;\xff\t\xff&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4508618">//&nbsp;does&nbsp;not&nbsp;terminate&nbsp;a&nbsp;cell&nbsp;and&nbsp;constitutes&nbsp;a&nbsp;single&nbsp;character&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4508685">//&nbsp;width&nbsp;one&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4508723">//</span><br>
<span class="lineno">390</span><span class="comment" id="4508726">//&nbsp;The&nbsp;value&nbsp;0xff&nbsp;was&nbsp;chosen&nbsp;because&nbsp;it&nbsp;cannot&nbsp;appear&nbsp;in&nbsp;a&nbsp;valid&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="4508807">//</span><br>
<span class="lineno"></span><span class="keyword" id="4508810">const</span>&nbsp;<span class="ident" id="4508816">Escape</span>&nbsp;<span class="op" id="4508823">=</span>&nbsp;<span class="string" id="4508825">&#39;\xff&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4508833">//&nbsp;Start&nbsp;escaped&nbsp;mode.</span><br>
<span class="lineno">395</span><span class="keyword" id="4508856">func</span>&nbsp;<span class="op" id="4508861">(</span><span class="ident" id="4508862">b</span>&nbsp;<span class="op" id="4508864">*</span><span class="ident" id="4508865">Writer</span><span class="op" id="4508871">)</span>&nbsp;<span class="ident" id="4508873">startEscape</span><span class="op" id="4508884">(</span><span class="ident" id="4508885">ch</span>&nbsp;<span class="builtintype" id="4508888">byte</span><span class="op" id="4508892">)</span>&nbsp;<span class="op" id="4508894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508897">switch</span>&nbsp;<span class="ident" id="4508904">ch</span>&nbsp;<span class="op" id="4508907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508910">case</span>&nbsp;<span class="ident" id="4508915">Escape</span><span class="op" id="4508921">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508925">b</span><span class="op" id="4508926">.</span><span class="ident" id="4508927">endChar</span>&nbsp;<span class="op" id="4508935">=</span>&nbsp;<span class="ident" id="4508937">Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508945">case</span>&nbsp;<span class="string" id="4508950">&#39;&lt;&#39;</span><span class="op" id="4508953">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508957">b</span><span class="op" id="4508958">.</span><span class="ident" id="4508959">endChar</span>&nbsp;<span class="op" id="4508967">=</span>&nbsp;<span class="string" id="4508969">&#39;&gt;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4508974">case</span>&nbsp;<span class="string" id="4508979">&#39;&amp;&#39;</span><span class="op" id="4508982">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4508986">b</span><span class="op" id="4508987">.</span><span class="ident" id="4508988">endChar</span>&nbsp;<span class="op" id="4508996">=</span>&nbsp;<span class="string" id="4508998">&#39;;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4509003">}</span><br>
<span class="lineno"></span><span class="op" id="4509005">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="4509008">//&nbsp;Terminate&nbsp;escaped&nbsp;mode.&nbsp;If&nbsp;the&nbsp;escaped&nbsp;text&nbsp;was&nbsp;an&nbsp;HTML&nbsp;tag,&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="4509082">//&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;for&nbsp;formatting&nbsp;purposes;&nbsp;if&nbsp;it&nbsp;was&nbsp;an&nbsp;HTML&nbsp;entity,</span><br>
<span class="lineno"></span><span class="comment" id="4509158">//&nbsp;its&nbsp;width&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;one.&nbsp;In&nbsp;all&nbsp;other&nbsp;cases,&nbsp;the&nbsp;width&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4509230">//&nbsp;unicode&nbsp;width&nbsp;of&nbsp;the&nbsp;text.</span><br>
<span class="lineno">410</span><span class="comment" id="4509260">//</span><br>
<span class="lineno"></span><span class="keyword" id="4509263">func</span>&nbsp;<span class="op" id="4509268">(</span><span class="ident" id="4509269">b</span>&nbsp;<span class="op" id="4509271">*</span><span class="ident" id="4509272">Writer</span><span class="op" id="4509278">)</span>&nbsp;<span class="ident" id="4509280">endEscape</span><span class="op" id="4509289">(</span><span class="op" id="4509290">)</span>&nbsp;<span class="op" id="4509292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509295">switch</span>&nbsp;<span class="ident" id="4509302">b</span><span class="op" id="4509303">.</span><span class="ident" id="4509304">endChar</span>&nbsp;<span class="op" id="4509312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509315">case</span>&nbsp;<span class="ident" id="4509320">Escape</span><span class="op" id="4509326">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509330">b</span><span class="op" id="4509331">.</span><span class="ident" id="4509332">updateWidth</span><span class="op" id="4509343">(</span><span class="op" id="4509344">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509348">if</span>&nbsp;<span class="ident" id="4509351">b</span><span class="op" id="4509352">.</span><span class="ident" id="4509353">flags</span><span class="op" id="4509358">&amp;</span><span class="ident" id="4509359">StripEscape</span>&nbsp;<span class="op" id="4509371">==</span>&nbsp;<span class="num" id="4509374">0</span>&nbsp;<span class="op" id="4509376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509381">b</span><span class="op" id="4509382">.</span><span class="ident" id="4509383">cell</span><span class="op" id="4509387">.</span><span class="ident" id="4509388">width</span>&nbsp;<span class="op" id="4509394">-=</span>&nbsp;<span class="num" id="4509397">2</span>&nbsp;<span class="comment" id="4509399">//&nbsp;don&#39;t&nbsp;count&nbsp;the&nbsp;Escape&nbsp;chars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4509433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509436">case</span>&nbsp;<span class="string" id="4509441">&#39;&gt;&#39;</span><span class="op" id="4509444">:</span>&nbsp;<span class="comment" id="4509446">//&nbsp;tag&nbsp;of&nbsp;zero&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509468">case</span>&nbsp;<span class="string" id="4509473">&#39;;&#39;</span><span class="op" id="4509476">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509480">b</span><span class="op" id="4509481">.</span><span class="ident" id="4509482">cell</span><span class="op" id="4509486">.</span><span class="ident" id="4509487">width</span><span class="op" id="4509492">++</span>&nbsp;<span class="comment" id="4509495">//&nbsp;entity,&nbsp;count&nbsp;as&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4509525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509528">b</span><span class="op" id="4509529">.</span><span class="ident" id="4509530">pos</span>&nbsp;<span class="op" id="4509534">=</span>&nbsp;<span class="ident" id="4509536">b</span><span class="op" id="4509537">.</span><span class="ident" id="4509538">buf</span><span class="op" id="4509541">.</span><span class="ident" id="4509542">Len</span><span class="op" id="4509545">(</span><span class="op" id="4509546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509549">b</span><span class="op" id="4509550">.</span><span class="ident" id="4509551">endChar</span>&nbsp;<span class="op" id="4509559">=</span>&nbsp;<span class="num" id="4509561">0</span><br>
<span class="lineno"></span><span class="op" id="4509563">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="comment" id="4509566">//&nbsp;Terminate&nbsp;the&nbsp;current&nbsp;cell&nbsp;by&nbsp;adding&nbsp;it&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;cells&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4509637">//&nbsp;current&nbsp;line.&nbsp;Returns&nbsp;the&nbsp;number&nbsp;of&nbsp;cells&nbsp;in&nbsp;that&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="4509696">//</span><br>
<span class="lineno"></span><span class="keyword" id="4509699">func</span>&nbsp;<span class="op" id="4509704">(</span><span class="ident" id="4509705">b</span>&nbsp;<span class="op" id="4509707">*</span><span class="ident" id="4509708">Writer</span><span class="op" id="4509714">)</span>&nbsp;<span class="ident" id="4509716">terminateCell</span><span class="op" id="4509729">(</span><span class="ident" id="4509730">htab</span>&nbsp;<span class="builtintype" id="4509735">bool</span><span class="op" id="4509739">)</span>&nbsp;<span class="builtintype" id="4509741">int</span>&nbsp;<span class="op" id="4509745">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509748">b</span><span class="op" id="4509749">.</span><span class="ident" id="4509750">cell</span><span class="op" id="4509754">.</span><span class="ident" id="4509755">htab</span>&nbsp;<span class="op" id="4509760">=</span>&nbsp;<span class="ident" id="4509762">htab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509768">line</span>&nbsp;<span class="op" id="4509773">:=</span>&nbsp;<span class="op" id="4509776">&amp;</span><span class="ident" id="4509777">b</span><span class="op" id="4509778">.</span><span class="ident" id="4509779">lines</span><span class="op" id="4509784">[</span><span class="builtinfunc" id="4509785">len</span><span class="op" id="4509788">(</span><span class="ident" id="4509789">b</span><span class="op" id="4509790">.</span><span class="ident" id="4509791">lines</span><span class="op" id="4509796">)</span><span class="op" id="4509797">-</span><span class="num" id="4509798">1</span><span class="op" id="4509799">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4509802">*</span><span class="ident" id="4509803">line</span>&nbsp;<span class="op" id="4509808">=</span>&nbsp;<span class="builtinfunc" id="4509810">append</span><span class="op" id="4509816">(</span><span class="op" id="4509817">*</span><span class="ident" id="4509818">line</span><span class="op" id="4509822">,</span>&nbsp;<span class="ident" id="4509824">b</span><span class="op" id="4509825">.</span><span class="ident" id="4509826">cell</span><span class="op" id="4509830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4509833">b</span><span class="op" id="4509834">.</span><span class="ident" id="4509835">cell</span>&nbsp;<span class="op" id="4509840">=</span>&nbsp;<span class="ident" id="4509842">cell</span><span class="op" id="4509846">{</span><span class="op" id="4509847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509850">return</span>&nbsp;<span class="builtinfunc" id="4509857">len</span><span class="op" id="4509860">(</span><span class="op" id="4509861">*</span><span class="ident" id="4509862">line</span><span class="op" id="4509866">)</span><br>
<span class="lineno">435</span><span class="op" id="4509868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4509871">func</span>&nbsp;<span class="ident" id="4509876">handlePanic</span><span class="op" id="4509887">(</span><span class="ident" id="4509888">err</span>&nbsp;<span class="op" id="4509892">*</span><span class="builtintype" id="4509893">error</span><span class="op" id="4509898">,</span>&nbsp;<span class="ident" id="4509900">op</span>&nbsp;<span class="builtintype" id="4509903">string</span><span class="op" id="4509909">)</span>&nbsp;<span class="op" id="4509911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509914">if</span>&nbsp;<span class="ident" id="4509917">e</span>&nbsp;<span class="op" id="4509919">:=</span>&nbsp;<span class="builtinfunc" id="4509922">recover</span><span class="op" id="4509929">(</span><span class="op" id="4509930">)</span><span class="op" id="4509931">;</span>&nbsp;<span class="ident" id="4509933">e</span>&nbsp;<span class="op" id="4509935">!=</span>&nbsp;<span class="ident" id="4509938">nil</span>&nbsp;<span class="op" id="4509942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4509946">if</span>&nbsp;<span class="ident" id="4509949">nerr</span><span class="op" id="4509953">,</span>&nbsp;<span class="ident" id="4509955">ok</span>&nbsp;<span class="op" id="4509958">:=</span>&nbsp;<span class="ident" id="4509961">e</span><span class="op" id="4509962">.</span><span class="op" id="4509963">(</span><span class="ident" id="4509964">osError</span><span class="op" id="4509971">)</span><span class="op" id="4509972">;</span>&nbsp;<span class="ident" id="4509974">ok</span>&nbsp;<span class="op" id="4509977">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4509982">*</span><span class="ident" id="4509983">err</span>&nbsp;<span class="op" id="4509987">=</span>&nbsp;<span class="ident" id="4509989">nerr</span><span class="op" id="4509993">.</span><span class="ident" id="4509994">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510001">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4510014">panic</span><span class="op" id="4510019">(</span><span class="string" id="4510020">&#34;tabwriter:&nbsp;panic&nbsp;during&nbsp;&#34;</span>&nbsp;<span class="op" id="4510047">+</span>&nbsp;<span class="ident" id="4510049">op</span><span class="op" id="4510051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510054">}</span><br>
<span class="lineno">445</span><span class="op" id="4510056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4510059">//&nbsp;Flush&nbsp;should&nbsp;be&nbsp;called&nbsp;after&nbsp;the&nbsp;last&nbsp;call&nbsp;to&nbsp;Write&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="4510124">//&nbsp;that&nbsp;any&nbsp;data&nbsp;buffered&nbsp;in&nbsp;the&nbsp;Writer&nbsp;is&nbsp;written&nbsp;to&nbsp;output.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="4510190">//&nbsp;incomplete&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;end&nbsp;is&nbsp;considered</span><br>
<span class="lineno">450</span><span class="comment" id="4510245">//&nbsp;complete&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4510282">//</span><br>
<span class="lineno"></span><span class="keyword" id="4510285">func</span>&nbsp;<span class="op" id="4510290">(</span><span class="ident" id="4510291">b</span>&nbsp;<span class="op" id="4510293">*</span><span class="ident" id="4510294">Writer</span><span class="op" id="4510300">)</span>&nbsp;<span class="ident" id="4510302">Flush</span><span class="op" id="4510307">(</span><span class="op" id="4510308">)</span>&nbsp;<span class="op" id="4510310">(</span><span class="ident" id="4510311">err</span>&nbsp;<span class="builtintype" id="4510315">error</span><span class="op" id="4510320">)</span>&nbsp;<span class="op" id="4510322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510325">defer</span>&nbsp;<span class="ident" id="4510331">b</span><span class="op" id="4510332">.</span><span class="ident" id="4510333">reset</span><span class="op" id="4510338">(</span><span class="op" id="4510339">)</span>&nbsp;<span class="comment" id="4510341">//&nbsp;even&nbsp;in&nbsp;the&nbsp;presence&nbsp;of&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510376">defer</span>&nbsp;<span class="ident" id="4510382">handlePanic</span><span class="op" id="4510393">(</span><span class="op" id="4510394">&amp;</span><span class="ident" id="4510395">err</span><span class="op" id="4510398">,</span>&nbsp;<span class="string" id="4510400">&#34;Flush&#34;</span><span class="op" id="4510407">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510411">//&nbsp;add&nbsp;current&nbsp;cell&nbsp;if&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510445">if</span>&nbsp;<span class="ident" id="4510448">b</span><span class="op" id="4510449">.</span><span class="ident" id="4510450">cell</span><span class="op" id="4510454">.</span><span class="ident" id="4510455">size</span>&nbsp;<span class="op" id="4510460">&gt;</span>&nbsp;<span class="num" id="4510462">0</span>&nbsp;<span class="op" id="4510464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510468">if</span>&nbsp;<span class="ident" id="4510471">b</span><span class="op" id="4510472">.</span><span class="ident" id="4510473">endChar</span>&nbsp;<span class="op" id="4510481">!=</span>&nbsp;<span class="num" id="4510484">0</span>&nbsp;<span class="op" id="4510486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510491">//&nbsp;inside&nbsp;escape&nbsp;-&nbsp;terminate&nbsp;it&nbsp;even&nbsp;if&nbsp;incomplete</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510545">b</span><span class="op" id="4510546">.</span><span class="ident" id="4510547">endEscape</span><span class="op" id="4510556">(</span><span class="op" id="4510557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510565">b</span><span class="op" id="4510566">.</span><span class="ident" id="4510567">terminateCell</span><span class="op" id="4510580">(</span><span class="builtintype" id="4510581">false</span><span class="op" id="4510586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4510589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510593">//&nbsp;format&nbsp;contents&nbsp;of&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510623">b</span><span class="op" id="4510624">.</span><span class="ident" id="4510625">format</span><span class="op" id="4510631">(</span><span class="num" id="4510632">0</span><span class="op" id="4510633">,</span>&nbsp;<span class="num" id="4510635">0</span><span class="op" id="4510636">,</span>&nbsp;<span class="builtinfunc" id="4510638">len</span><span class="op" id="4510641">(</span><span class="ident" id="4510642">b</span><span class="op" id="4510643">.</span><span class="ident" id="4510644">lines</span><span class="op" id="4510649">)</span><span class="op" id="4510650">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510654">return</span><br>
<span class="lineno"></span><span class="op" id="4510661">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="4510664">var</span>&nbsp;<span class="ident" id="4510668">hbar</span>&nbsp;<span class="op" id="4510673">=</span>&nbsp;<span class="op" id="4510675">[</span><span class="op" id="4510676">]</span><span class="builtintype" id="4510677">byte</span><span class="op" id="4510681">(</span><span class="string" id="4510682">&#34;---\n&#34;</span><span class="op" id="4510689">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4510692">//&nbsp;Write&nbsp;writes&nbsp;buf&nbsp;to&nbsp;the&nbsp;writer&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="4510729">//&nbsp;The&nbsp;only&nbsp;errors&nbsp;returned&nbsp;are&nbsp;ones&nbsp;encountered</span><br>
<span class="lineno">475</span><span class="comment" id="4510778">//&nbsp;while&nbsp;writing&nbsp;to&nbsp;the&nbsp;underlying&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="4510828">//</span><br>
<span class="lineno"></span><span class="keyword" id="4510831">func</span>&nbsp;<span class="op" id="4510836">(</span><span class="ident" id="4510837">b</span>&nbsp;<span class="op" id="4510839">*</span><span class="ident" id="4510840">Writer</span><span class="op" id="4510846">)</span>&nbsp;<span class="ident" id="4510848">Write</span><span class="op" id="4510853">(</span><span class="ident" id="4510854">buf</span>&nbsp;<span class="op" id="4510858">[</span><span class="op" id="4510859">]</span><span class="builtintype" id="4510860">byte</span><span class="op" id="4510864">)</span>&nbsp;<span class="op" id="4510866">(</span><span class="ident" id="4510867">n</span>&nbsp;<span class="builtintype" id="4510869">int</span><span class="op" id="4510872">,</span>&nbsp;<span class="ident" id="4510874">err</span>&nbsp;<span class="builtintype" id="4510878">error</span><span class="op" id="4510883">)</span>&nbsp;<span class="op" id="4510885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510888">defer</span>&nbsp;<span class="ident" id="4510894">handlePanic</span><span class="op" id="4510905">(</span><span class="op" id="4510906">&amp;</span><span class="ident" id="4510907">err</span><span class="op" id="4510910">,</span>&nbsp;<span class="string" id="4510912">&#34;Write&#34;</span><span class="op" id="4510919">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4510923">//&nbsp;split&nbsp;text&nbsp;into&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4510949">n</span>&nbsp;<span class="op" id="4510951">=</span>&nbsp;<span class="num" id="4510953">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510956">for</span>&nbsp;<span class="ident" id="4510960">i</span><span class="op" id="4510961">,</span>&nbsp;<span class="ident" id="4510963">ch</span>&nbsp;<span class="op" id="4510966">:=</span>&nbsp;<span class="keyword" id="4510969">range</span>&nbsp;<span class="ident" id="4510975">buf</span>&nbsp;<span class="op" id="4510979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4510983">if</span>&nbsp;<span class="ident" id="4510986">b</span><span class="op" id="4510987">.</span><span class="ident" id="4510988">endChar</span>&nbsp;<span class="op" id="4510996">==</span>&nbsp;<span class="num" id="4510999">0</span>&nbsp;<span class="op" id="4511001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511006">//&nbsp;outside&nbsp;escape</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511027">switch</span>&nbsp;<span class="ident" id="4511034">ch</span>&nbsp;<span class="op" id="4511037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511042">case</span>&nbsp;<span class="string" id="4511047">&#39;\t&#39;</span><span class="op" id="4511051">,</span>&nbsp;<span class="string" id="4511053">&#39;\v&#39;</span><span class="op" id="4511057">,</span>&nbsp;<span class="string" id="4511059">&#39;\n&#39;</span><span class="op" id="4511063">,</span>&nbsp;<span class="string" id="4511065">&#39;\f&#39;</span><span class="op" id="4511069">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511075">//&nbsp;end&nbsp;of&nbsp;cell</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511094">b</span><span class="op" id="4511095">.</span><span class="builtinfunc" id="4511096">append</span><span class="op" id="4511102">(</span><span class="ident" id="4511103">buf</span><span class="op" id="4511106">[</span><span class="ident" id="4511107">n</span><span class="op" id="4511108">:</span><span class="ident" id="4511109">i</span><span class="op" id="4511110">]</span><span class="op" id="4511111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511117">b</span><span class="op" id="4511118">.</span><span class="ident" id="4511119">updateWidth</span><span class="op" id="4511130">(</span><span class="op" id="4511131">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511137">n</span>&nbsp;<span class="op" id="4511139">=</span>&nbsp;<span class="ident" id="4511141">i</span>&nbsp;<span class="op" id="4511143">+</span>&nbsp;<span class="num" id="4511145">1</span>&nbsp;<span class="comment" id="4511147">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511166">ncells</span>&nbsp;<span class="op" id="4511173">:=</span>&nbsp;<span class="ident" id="4511176">b</span><span class="op" id="4511177">.</span><span class="ident" id="4511178">terminateCell</span><span class="op" id="4511191">(</span><span class="ident" id="4511192">ch</span>&nbsp;<span class="op" id="4511195">==</span>&nbsp;<span class="string" id="4511198">&#39;\t&#39;</span><span class="op" id="4511202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511208">if</span>&nbsp;<span class="ident" id="4511211">ch</span>&nbsp;<span class="op" id="4511214">==</span>&nbsp;<span class="string" id="4511217">&#39;\n&#39;</span>&nbsp;<span class="op" id="4511222">||</span>&nbsp;<span class="ident" id="4511225">ch</span>&nbsp;<span class="op" id="4511228">==</span>&nbsp;<span class="string" id="4511231">&#39;\f&#39;</span>&nbsp;<span class="op" id="4511236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511243">//&nbsp;terminate&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511266">b</span><span class="op" id="4511267">.</span><span class="ident" id="4511268">addLine</span><span class="op" id="4511275">(</span><span class="op" id="4511276">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511283">if</span>&nbsp;<span class="ident" id="4511286">ch</span>&nbsp;<span class="op" id="4511289">==</span>&nbsp;<span class="string" id="4511292">&#39;\f&#39;</span>&nbsp;<span class="op" id="4511297">||</span>&nbsp;<span class="ident" id="4511300">ncells</span>&nbsp;<span class="op" id="4511307">==</span>&nbsp;<span class="num" id="4511310">1</span>&nbsp;<span class="op" id="4511312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511320">//&nbsp;A&nbsp;&#39;\f&#39;&nbsp;always&nbsp;forces&nbsp;a&nbsp;flush.&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;previous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511386">//&nbsp;line&nbsp;has&nbsp;only&nbsp;one&nbsp;cell&nbsp;which&nbsp;does&nbsp;not&nbsp;have&nbsp;an&nbsp;impact&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511451">//&nbsp;the&nbsp;formatting&nbsp;of&nbsp;the&nbsp;following&nbsp;lines&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511517">//&nbsp;line&nbsp;is&nbsp;ignored&nbsp;by&nbsp;format()),&nbsp;thus&nbsp;we&nbsp;can&nbsp;flush&nbsp;the</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511578">//&nbsp;Writer&nbsp;contents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511604">if</span>&nbsp;<span class="ident" id="4511607">err</span>&nbsp;<span class="op" id="4511611">=</span>&nbsp;<span class="ident" id="4511613">b</span><span class="op" id="4511614">.</span><span class="ident" id="4511615">Flush</span><span class="op" id="4511620">(</span><span class="op" id="4511621">)</span><span class="op" id="4511622">;</span>&nbsp;<span class="ident" id="4511624">err</span>&nbsp;<span class="op" id="4511628">!=</span>&nbsp;<span class="ident" id="4511631">nil</span>&nbsp;<span class="op" id="4511635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511644">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511665">if</span>&nbsp;<span class="ident" id="4511668">ch</span>&nbsp;<span class="op" id="4511671">==</span>&nbsp;<span class="string" id="4511674">&#39;\f&#39;</span>&nbsp;<span class="op" id="4511679">&amp;&amp;</span>&nbsp;<span class="ident" id="4511682">b</span><span class="op" id="4511683">.</span><span class="ident" id="4511684">flags</span><span class="op" id="4511689">&amp;</span><span class="ident" id="4511690">Debug</span>&nbsp;<span class="op" id="4511696">!=</span>&nbsp;<span class="num" id="4511699">0</span>&nbsp;<span class="op" id="4511701">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511710">//&nbsp;indicate&nbsp;section&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511743">b</span><span class="op" id="4511744">.</span><span class="ident" id="4511745">write0</span><span class="op" id="4511751">(</span><span class="ident" id="4511752">hbar</span><span class="op" id="4511756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511777">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511783">case</span>&nbsp;<span class="ident" id="4511788">Escape</span><span class="op" id="4511794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511800">//&nbsp;start&nbsp;of&nbsp;escaped&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511833">b</span><span class="op" id="4511834">.</span><span class="builtinfunc" id="4511835">append</span><span class="op" id="4511841">(</span><span class="ident" id="4511842">buf</span><span class="op" id="4511845">[</span><span class="ident" id="4511846">n</span><span class="op" id="4511847">:</span><span class="ident" id="4511848">i</span><span class="op" id="4511849">]</span><span class="op" id="4511850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511856">b</span><span class="op" id="4511857">.</span><span class="ident" id="4511858">updateWidth</span><span class="op" id="4511869">(</span><span class="op" id="4511870">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511876">n</span>&nbsp;<span class="op" id="4511878">=</span>&nbsp;<span class="ident" id="4511880">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511886">if</span>&nbsp;<span class="ident" id="4511889">b</span><span class="op" id="4511890">.</span><span class="ident" id="4511891">flags</span><span class="op" id="4511896">&amp;</span><span class="ident" id="4511897">StripEscape</span>&nbsp;<span class="op" id="4511909">!=</span>&nbsp;<span class="num" id="4511912">0</span>&nbsp;<span class="op" id="4511914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511921">n</span><span class="op" id="4511922">++</span>&nbsp;<span class="comment" id="4511925">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4511945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4511951">b</span><span class="op" id="4511952">.</span><span class="ident" id="4511953">startEscape</span><span class="op" id="4511964">(</span><span class="ident" id="4511965">Escape</span><span class="op" id="4511971">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4511977">case</span>&nbsp;<span class="string" id="4511982">&#39;&lt;&#39;</span><span class="op" id="4511985">,</span>&nbsp;<span class="string" id="4511987">&#39;&amp;&#39;</span><span class="op" id="4511990">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4511996">//&nbsp;possibly&nbsp;an&nbsp;html&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512031">if</span>&nbsp;<span class="ident" id="4512034">b</span><span class="op" id="4512035">.</span><span class="ident" id="4512036">flags</span><span class="op" id="4512041">&amp;</span><span class="ident" id="4512042">FilterHTML</span>&nbsp;<span class="op" id="4512053">!=</span>&nbsp;<span class="num" id="4512056">0</span>&nbsp;<span class="op" id="4512058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512065">//&nbsp;begin&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512093">b</span><span class="op" id="4512094">.</span><span class="builtinfunc" id="4512095">append</span><span class="op" id="4512101">(</span><span class="ident" id="4512102">buf</span><span class="op" id="4512105">[</span><span class="ident" id="4512106">n</span><span class="op" id="4512107">:</span><span class="ident" id="4512108">i</span><span class="op" id="4512109">]</span><span class="op" id="4512110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512117">b</span><span class="op" id="4512118">.</span><span class="ident" id="4512119">updateWidth</span><span class="op" id="4512130">(</span><span class="op" id="4512131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512138">n</span>&nbsp;<span class="op" id="4512140">=</span>&nbsp;<span class="ident" id="4512142">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512149">b</span><span class="op" id="4512150">.</span><span class="ident" id="4512151">startEscape</span><span class="op" id="4512162">(</span><span class="ident" id="4512163">ch</span><span class="op" id="4512165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4512171">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4512176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4512181">}</span>&nbsp;<span class="keyword" id="4512183">else</span>&nbsp;<span class="op" id="4512188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512193">//&nbsp;inside&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512213">if</span>&nbsp;<span class="ident" id="4512216">ch</span>&nbsp;<span class="op" id="4512219">==</span>&nbsp;<span class="ident" id="4512222">b</span><span class="op" id="4512223">.</span><span class="ident" id="4512224">endChar</span>&nbsp;<span class="op" id="4512232">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512238">//&nbsp;end&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512263">j</span>&nbsp;<span class="op" id="4512265">:=</span>&nbsp;<span class="ident" id="4512268">i</span>&nbsp;<span class="op" id="4512270">+</span>&nbsp;<span class="num" id="4512272">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512278">if</span>&nbsp;<span class="ident" id="4512281">ch</span>&nbsp;<span class="op" id="4512284">==</span>&nbsp;<span class="ident" id="4512287">Escape</span>&nbsp;<span class="op" id="4512294">&amp;&amp;</span>&nbsp;<span class="ident" id="4512297">b</span><span class="op" id="4512298">.</span><span class="ident" id="4512299">flags</span><span class="op" id="4512304">&amp;</span><span class="ident" id="4512305">StripEscape</span>&nbsp;<span class="op" id="4512317">!=</span>&nbsp;<span class="num" id="4512320">0</span>&nbsp;<span class="op" id="4512322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512329">j</span>&nbsp;<span class="op" id="4512331">=</span>&nbsp;<span class="ident" id="4512333">i</span>&nbsp;<span class="comment" id="4512335">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4512355">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512361">b</span><span class="op" id="4512362">.</span><span class="builtinfunc" id="4512363">append</span><span class="op" id="4512369">(</span><span class="ident" id="4512370">buf</span><span class="op" id="4512373">[</span><span class="ident" id="4512374">n</span><span class="op" id="4512375">:</span><span class="ident" id="4512376">j</span><span class="op" id="4512377">]</span><span class="op" id="4512378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512384">n</span>&nbsp;<span class="op" id="4512386">=</span>&nbsp;<span class="ident" id="4512388">i</span>&nbsp;<span class="op" id="4512390">+</span>&nbsp;<span class="num" id="4512392">1</span>&nbsp;<span class="comment" id="4512394">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512413">b</span><span class="op" id="4512414">.</span><span class="ident" id="4512415">endEscape</span><span class="op" id="4512424">(</span><span class="op" id="4512425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4512430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4512434">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4512437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4512441">//&nbsp;append&nbsp;leftover&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512466">b</span><span class="op" id="4512467">.</span><span class="builtinfunc" id="4512468">append</span><span class="op" id="4512474">(</span><span class="ident" id="4512475">buf</span><span class="op" id="4512478">[</span><span class="ident" id="4512479">n</span><span class="op" id="4512480">:</span><span class="op" id="4512481">]</span><span class="op" id="4512482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4512485">n</span>&nbsp;<span class="op" id="4512487">=</span>&nbsp;<span class="builtinfunc" id="4512489">len</span><span class="op" id="4512492">(</span><span class="ident" id="4512493">buf</span><span class="op" id="4512496">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512499">return</span><br>
<span class="lineno"></span><span class="op" id="4512506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4512509">//&nbsp;NewWriter&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;tabwriter.Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4512572">//&nbsp;The&nbsp;parameters&nbsp;are&nbsp;the&nbsp;same&nbsp;as&nbsp;for&nbsp;the&nbsp;Init&nbsp;function.</span><br>
<span class="lineno">555</span><span class="comment" id="4512629">//</span><br>
<span class="lineno"></span><span class="keyword" id="4512632">func</span>&nbsp;<span class="ident" id="4512637">NewWriter</span><span class="op" id="4512646">(</span><span class="ident" id="4512647">output</span>&nbsp;<span class="ident" id="4512654">io</span><span class="op" id="4512656">.</span><span class="ident" id="4512657">Writer</span><span class="op" id="4512663">,</span>&nbsp;<span class="ident" id="4512665">minwidth</span><span class="op" id="4512673">,</span>&nbsp;<span class="ident" id="4512675">tabwidth</span><span class="op" id="4512683">,</span>&nbsp;<span class="ident" id="4512685">padding</span>&nbsp;<span class="builtintype" id="4512693">int</span><span class="op" id="4512696">,</span>&nbsp;<span class="ident" id="4512698">padchar</span>&nbsp;<span class="builtintype" id="4512706">byte</span><span class="op" id="4512710">,</span>&nbsp;<span class="ident" id="4512712">flags</span>&nbsp;<span class="builtintype" id="4512718">uint</span><span class="op" id="4512722">)</span>&nbsp;<span class="op" id="4512724">*</span><span class="ident" id="4512725">Writer</span>&nbsp;<span class="op" id="4512732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4512735">return</span>&nbsp;<span class="builtinfunc" id="4512742">new</span><span class="op" id="4512745">(</span><span class="ident" id="4512746">Writer</span><span class="op" id="4512752">)</span><span class="op" id="4512753">.</span><span class="ident" id="4512754">Init</span><span class="op" id="4512758">(</span><span class="ident" id="4512759">output</span><span class="op" id="4512765">,</span>&nbsp;<span class="ident" id="4512767">minwidth</span><span class="op" id="4512775">,</span>&nbsp;<span class="ident" id="4512777">tabwidth</span><span class="op" id="4512785">,</span>&nbsp;<span class="ident" id="4512787">padding</span><span class="op" id="4512794">,</span>&nbsp;<span class="ident" id="4512796">padchar</span><span class="op" id="4512803">,</span>&nbsp;<span class="ident" id="4512805">flags</span><span class="op" id="4512810">)</span><br>
<span class="lineno"></span><span class="op" id="4512812">}</span>
</div>
</body>
</html>
