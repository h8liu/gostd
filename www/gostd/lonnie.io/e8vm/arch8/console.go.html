<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/arch8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/arch8/console.go.html">console.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu.go.html">cpu.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu_test.go.html">cpu_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/device.go.html">device.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/exception.go.html">exception.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br_test.go.html">inst_br_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm_test.go.html">inst_imm_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg_test.go.html">inst_reg_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/int_bus.go.html">int_bus.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt.go.html">interrupt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt_test.go.html">interrupt_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/machine.go.html">machine.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/multi_core.go.html">multi_core.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page.go.html">page.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table.go.html">page_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table_test.go.html">page_table_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_test.go.html">page_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory.go.html">phy_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory_test.go.html">phy_memory_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs.go.html">regs.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs_test.go.html">regs_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/run_image.go.html">run_image.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/serial.go.html">serial.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/ticker.go.html">ticker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory.go.html">virt_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory_test.go.html">virt_memory_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="3561827">package</span>&nbsp;<span class="ident" id="3561835">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3561842">import</span>&nbsp;<span class="op" id="3561849">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3561852">&#34;io&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3561858">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3561865">&#34;os&#34;</span><br>
<span class="lineno"></span><span class="op" id="3561870">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3561873">//&nbsp;Console&nbsp;is&nbsp;a&nbsp;simple&nbsp;console&nbsp;that&nbsp;can&nbsp;output/input&nbsp;a&nbsp;single</span><br>
<span class="lineno">10</span><span class="comment" id="3561935">//&nbsp;byte&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span><span class="keyword" id="3561953">type</span>&nbsp;<span class="ident" id="3561958">console</span>&nbsp;<span class="keyword" id="3561966">struct</span>&nbsp;<span class="op" id="3561973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561976">intBus</span>&nbsp;<span class="ident" id="3561983">intBus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561991">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3561998">*</span><span class="ident" id="3561999">page</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562006">Core</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3562013">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562019">IntIn</span>&nbsp;&nbsp;<span class="builtintype" id="3562026">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562032">IntOut</span>&nbsp;<span class="builtintype" id="3562039">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562046">Output</span>&nbsp;<span class="ident" id="3562053">io</span><span class="op" id="3562055">.</span><span class="ident" id="3562056">Writer</span><br>
<span class="lineno">20</span><span class="op" id="3562063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3562066">//&nbsp;NewConsole&nbsp;creates&nbsp;a&nbsp;new&nbsp;simple&nbsp;console.</span><br>
<span class="lineno"></span><span class="keyword" id="3562110">func</span>&nbsp;<span class="ident" id="3562115">newConsole</span><span class="op" id="3562125">(</span><span class="ident" id="3562126">p</span>&nbsp;<span class="op" id="3562128">*</span><span class="ident" id="3562129">page</span><span class="op" id="3562133">,</span>&nbsp;<span class="ident" id="3562135">i</span>&nbsp;<span class="ident" id="3562137">intBus</span><span class="op" id="3562143">)</span>&nbsp;<span class="op" id="3562145">*</span><span class="ident" id="3562146">console</span>&nbsp;<span class="op" id="3562154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562157">ret</span>&nbsp;<span class="op" id="3562161">:=</span>&nbsp;<span class="builtinfunc" id="3562164">new</span><span class="op" id="3562167">(</span><span class="ident" id="3562168">console</span><span class="op" id="3562175">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562178">ret</span><span class="op" id="3562181">.</span><span class="ident" id="3562182">intBus</span>&nbsp;<span class="op" id="3562189">=</span>&nbsp;<span class="ident" id="3562191">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562194">ret</span><span class="op" id="3562197">.</span><span class="ident" id="3562198">p</span>&nbsp;<span class="op" id="3562200">=</span>&nbsp;<span class="ident" id="3562202">p</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562206">ret</span><span class="op" id="3562209">.</span><span class="ident" id="3562210">Core</span>&nbsp;<span class="op" id="3562215">=</span>&nbsp;<span class="num" id="3562217">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562220">ret</span><span class="op" id="3562223">.</span><span class="ident" id="3562224">IntIn</span>&nbsp;<span class="op" id="3562230">=</span>&nbsp;<span class="num" id="3562232">8</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562235">ret</span><span class="op" id="3562238">.</span><span class="ident" id="3562239">IntOut</span>&nbsp;<span class="op" id="3562246">=</span>&nbsp;<span class="num" id="3562248">9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562252">ret</span><span class="op" id="3562255">.</span><span class="ident" id="3562256">Output</span>&nbsp;<span class="op" id="3562263">=</span>&nbsp;<span class="ident" id="3562265">os</span><span class="op" id="3562267">.</span><span class="ident" id="3562268">Stdout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562276">return</span>&nbsp;<span class="ident" id="3562283">ret</span><br>
<span class="lineno"></span><span class="op" id="3562287">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="3562290">var</span>&nbsp;<span class="ident" id="3562294">_</span>&nbsp;<span class="ident" id="3562296">device</span>&nbsp;<span class="op" id="3562303">=</span>&nbsp;<span class="builtinfunc" id="3562305">new</span><span class="op" id="3562308">(</span><span class="ident" id="3562309">console</span><span class="op" id="3562316">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3562319">const</span>&nbsp;<span class="op" id="3562325">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562328">consoleBase</span>&nbsp;<span class="op" id="3562340">=</span>&nbsp;<span class="num" id="3562342">0</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562346">consoleOut</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3562362">=</span>&nbsp;<span class="ident" id="3562364">consoleBase</span>&nbsp;<span class="op" id="3562376">+</span>&nbsp;<span class="num" id="3562378">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562381">consoleOutValid</span>&nbsp;<span class="op" id="3562397">=</span>&nbsp;<span class="ident" id="3562399">consoleBase</span>&nbsp;<span class="op" id="3562411">+</span>&nbsp;<span class="num" id="3562413">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562416">consoleIn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3562432">=</span>&nbsp;<span class="ident" id="3562434">consoleBase</span>&nbsp;<span class="op" id="3562446">+</span>&nbsp;<span class="num" id="3562448">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562451">consoleInValid</span>&nbsp;&nbsp;<span class="op" id="3562467">=</span>&nbsp;<span class="ident" id="3562469">consoleBase</span>&nbsp;<span class="op" id="3562481">+</span>&nbsp;<span class="num" id="3562483">3</span><br>
<span class="lineno">45</span><span class="op" id="3562485">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3562488">func</span>&nbsp;<span class="op" id="3562493">(</span><span class="ident" id="3562494">c</span>&nbsp;<span class="op" id="3562496">*</span><span class="ident" id="3562497">console</span><span class="op" id="3562504">)</span>&nbsp;<span class="ident" id="3562506">interrupt</span><span class="op" id="3562515">(</span><span class="ident" id="3562516">code</span>&nbsp;<span class="builtintype" id="3562521">byte</span><span class="op" id="3562525">)</span>&nbsp;<span class="op" id="3562527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562530">c</span><span class="op" id="3562531">.</span><span class="ident" id="3562532">intBus</span><span class="op" id="3562538">.</span><span class="ident" id="3562539">Interrupt</span><span class="op" id="3562548">(</span><span class="ident" id="3562549">code</span><span class="op" id="3562553">,</span>&nbsp;<span class="ident" id="3562555">c</span><span class="op" id="3562556">.</span><span class="ident" id="3562557">Core</span><span class="op" id="3562561">)</span><br>
<span class="lineno"></span><span class="op" id="3562563">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="3562566">//&nbsp;Tick&nbsp;flushes&nbsp;the&nbsp;buffered&nbsp;byte&nbsp;to&nbsp;the&nbsp;console.</span><br>
<span class="lineno"></span><span class="keyword" id="3562616">func</span>&nbsp;<span class="op" id="3562621">(</span><span class="ident" id="3562622">c</span>&nbsp;<span class="op" id="3562624">*</span><span class="ident" id="3562625">console</span><span class="op" id="3562632">)</span>&nbsp;<span class="ident" id="3562634">Tick</span><span class="op" id="3562638">(</span><span class="op" id="3562639">)</span>&nbsp;<span class="op" id="3562641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562644">outValid</span>&nbsp;<span class="op" id="3562653">:=</span>&nbsp;<span class="ident" id="3562656">c</span><span class="op" id="3562657">.</span><span class="ident" id="3562658">p</span><span class="op" id="3562659">.</span><span class="ident" id="3562660">ReadByte</span><span class="op" id="3562668">(</span><span class="ident" id="3562669">consoleOutValid</span><span class="op" id="3562684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562687">if</span>&nbsp;<span class="ident" id="3562690">outValid</span>&nbsp;<span class="op" id="3562699">!=</span>&nbsp;<span class="num" id="3562702">0</span>&nbsp;<span class="op" id="3562704">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562708">out</span>&nbsp;<span class="op" id="3562712">:=</span>&nbsp;<span class="ident" id="3562715">c</span><span class="op" id="3562716">.</span><span class="ident" id="3562717">p</span><span class="op" id="3562718">.</span><span class="ident" id="3562719">ReadByte</span><span class="op" id="3562727">(</span><span class="ident" id="3562728">consoleOut</span><span class="op" id="3562738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562742">_</span><span class="op" id="3562743">,</span>&nbsp;<span class="ident" id="3562745">e</span>&nbsp;<span class="op" id="3562747">:=</span>&nbsp;<span class="ident" id="3562750">c</span><span class="op" id="3562751">.</span><span class="ident" id="3562752">Output</span><span class="op" id="3562758">.</span><span class="ident" id="3562759">Write</span><span class="op" id="3562764">(</span><span class="op" id="3562765">[</span><span class="op" id="3562766">]</span><span class="builtintype" id="3562767">byte</span><span class="op" id="3562771">{</span><span class="ident" id="3562772">out</span><span class="op" id="3562775">}</span><span class="op" id="3562776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562780">if</span>&nbsp;<span class="ident" id="3562783">e</span>&nbsp;<span class="op" id="3562785">!=</span>&nbsp;<span class="ident" id="3562788">nil</span>&nbsp;<span class="op" id="3562792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562797">log</span><span class="op" id="3562800">.</span><span class="ident" id="3562801">Print</span><span class="op" id="3562806">(</span><span class="ident" id="3562807">e</span><span class="op" id="3562808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562812">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562816">c</span><span class="op" id="3562817">.</span><span class="ident" id="3562818">p</span><span class="op" id="3562819">.</span><span class="ident" id="3562820">WriteByte</span><span class="op" id="3562829">(</span><span class="ident" id="3562830">consoleOutValid</span><span class="op" id="3562845">,</span>&nbsp;<span class="num" id="3562847">0</span><span class="op" id="3562848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562852">c</span><span class="op" id="3562853">.</span><span class="ident" id="3562854">interrupt</span><span class="op" id="3562863">(</span><span class="ident" id="3562864">c</span><span class="op" id="3562865">.</span><span class="ident" id="3562866">IntOut</span><span class="op" id="3562872">)</span>&nbsp;<span class="comment" id="3562874">//&nbsp;out&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3562896">//&nbsp;TODO:&nbsp;input&nbsp;part</span><br>
<span class="lineno">65</span><span class="op" id="3562916">}</span>
</div>
</body>
</html>
