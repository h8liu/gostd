<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7782126">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7782182">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7782236">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7782287">//&nbsp;Bridge&nbsp;package&nbsp;to&nbsp;expose&nbsp;http&nbsp;internals&nbsp;to&nbsp;tests&nbsp;in&nbsp;the&nbsp;http_test</span><br>
<span class="lineno"></span><span class="comment" id="7782356">//&nbsp;package.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7782369">package</span>&nbsp;<span class="ident" id="7782377">http</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="7782383">import</span>&nbsp;<span class="op" id="7782390">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7782393">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7782400">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7782411">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7782418">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7782421">func</span>&nbsp;<span class="ident" id="7782426">NewLoggingConn</span><span class="op" id="7782440">(</span><span class="ident" id="7782441">baseName</span>&nbsp;<span class="builtintype" id="7782450">string</span><span class="op" id="7782456">,</span>&nbsp;<span class="ident" id="7782458">c</span>&nbsp;<span class="ident" id="7782460">net</span><span class="op" id="7782463">.</span><span class="ident" id="7782464">Conn</span><span class="op" id="7782468">)</span>&nbsp;<span class="ident" id="7782470">net</span><span class="op" id="7782473">.</span><span class="ident" id="7782474">Conn</span>&nbsp;<span class="op" id="7782479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782482">return</span>&nbsp;<span class="ident" id="7782489">newLoggingConn</span><span class="op" id="7782503">(</span><span class="ident" id="7782504">baseName</span><span class="op" id="7782512">,</span>&nbsp;<span class="ident" id="7782514">c</span><span class="op" id="7782515">)</span><br>
<span class="lineno"></span><span class="op" id="7782517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7782520">var</span>&nbsp;<span class="ident" id="7782524">ExportAppendTime</span>&nbsp;<span class="op" id="7782541">=</span>&nbsp;<span class="ident" id="7782543">appendTime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7782555">func</span>&nbsp;<span class="op" id="7782560">(</span><span class="ident" id="7782561">t</span>&nbsp;<span class="op" id="7782563">*</span><span class="ident" id="7782564">Transport</span><span class="op" id="7782573">)</span>&nbsp;<span class="ident" id="7782575">NumPendingRequestsForTesting</span><span class="op" id="7782603">(</span><span class="op" id="7782604">)</span>&nbsp;<span class="builtintype" id="7782606">int</span>&nbsp;<span class="op" id="7782610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782613">t</span><span class="op" id="7782614">.</span><span class="ident" id="7782615">reqMu</span><span class="op" id="7782620">.</span><span class="ident" id="7782621">Lock</span><span class="op" id="7782625">(</span><span class="op" id="7782626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782629">defer</span>&nbsp;<span class="ident" id="7782635">t</span><span class="op" id="7782636">.</span><span class="ident" id="7782637">reqMu</span><span class="op" id="7782642">.</span><span class="ident" id="7782643">Unlock</span><span class="op" id="7782649">(</span><span class="op" id="7782650">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782653">return</span>&nbsp;<span class="builtinfunc" id="7782660">len</span><span class="op" id="7782663">(</span><span class="ident" id="7782664">t</span><span class="op" id="7782665">.</span><span class="ident" id="7782666">reqCanceler</span><span class="op" id="7782677">)</span><br>
<span class="lineno"></span><span class="op" id="7782679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7782682">func</span>&nbsp;<span class="op" id="7782687">(</span><span class="ident" id="7782688">t</span>&nbsp;<span class="op" id="7782690">*</span><span class="ident" id="7782691">Transport</span><span class="op" id="7782700">)</span>&nbsp;<span class="ident" id="7782702">IdleConnKeysForTesting</span><span class="op" id="7782724">(</span><span class="op" id="7782725">)</span>&nbsp;<span class="op" id="7782727">(</span><span class="ident" id="7782728">keys</span>&nbsp;<span class="op" id="7782733">[</span><span class="op" id="7782734">]</span><span class="builtintype" id="7782735">string</span><span class="op" id="7782741">)</span>&nbsp;<span class="op" id="7782743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782746">keys</span>&nbsp;<span class="op" id="7782751">=</span>&nbsp;<span class="builtinfunc" id="7782753">make</span><span class="op" id="7782757">(</span><span class="op" id="7782758">[</span><span class="op" id="7782759">]</span><span class="builtintype" id="7782760">string</span><span class="op" id="7782766">,</span>&nbsp;<span class="num" id="7782768">0</span><span class="op" id="7782769">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782772">t</span><span class="op" id="7782773">.</span><span class="ident" id="7782774">idleMu</span><span class="op" id="7782780">.</span><span class="ident" id="7782781">Lock</span><span class="op" id="7782785">(</span><span class="op" id="7782786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782789">defer</span>&nbsp;<span class="ident" id="7782795">t</span><span class="op" id="7782796">.</span><span class="ident" id="7782797">idleMu</span><span class="op" id="7782803">.</span><span class="ident" id="7782804">Unlock</span><span class="op" id="7782810">(</span><span class="op" id="7782811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782814">if</span>&nbsp;<span class="ident" id="7782817">t</span><span class="op" id="7782818">.</span><span class="ident" id="7782819">idleConn</span>&nbsp;<span class="op" id="7782828">==</span>&nbsp;<span class="ident" id="7782831">nil</span>&nbsp;<span class="op" id="7782835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782839">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7782847">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782850">for</span>&nbsp;<span class="ident" id="7782854">key</span>&nbsp;<span class="op" id="7782858">:=</span>&nbsp;<span class="keyword" id="7782861">range</span>&nbsp;<span class="ident" id="7782867">t</span><span class="op" id="7782868">.</span><span class="ident" id="7782869">idleConn</span>&nbsp;<span class="op" id="7782878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782882">keys</span>&nbsp;<span class="op" id="7782887">=</span>&nbsp;<span class="builtinfunc" id="7782889">append</span><span class="op" id="7782895">(</span><span class="ident" id="7782896">keys</span><span class="op" id="7782900">,</span>&nbsp;<span class="ident" id="7782902">key</span><span class="op" id="7782905">.</span><span class="ident" id="7782906">String</span><span class="op" id="7782912">(</span><span class="op" id="7782913">)</span><span class="op" id="7782914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7782917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7782920">return</span><br>
<span class="lineno"></span><span class="op" id="7782927">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7782930">func</span>&nbsp;<span class="op" id="7782935">(</span><span class="ident" id="7782936">t</span>&nbsp;<span class="op" id="7782938">*</span><span class="ident" id="7782939">Transport</span><span class="op" id="7782948">)</span>&nbsp;<span class="ident" id="7782950">IdleConnCountForTesting</span><span class="op" id="7782973">(</span><span class="ident" id="7782974">cacheKey</span>&nbsp;<span class="builtintype" id="7782983">string</span><span class="op" id="7782989">)</span>&nbsp;<span class="builtintype" id="7782991">int</span>&nbsp;<span class="op" id="7782995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7782998">t</span><span class="op" id="7782999">.</span><span class="ident" id="7783000">idleMu</span><span class="op" id="7783006">.</span><span class="ident" id="7783007">Lock</span><span class="op" id="7783011">(</span><span class="op" id="7783012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7783015">defer</span>&nbsp;<span class="ident" id="7783021">t</span><span class="op" id="7783022">.</span><span class="ident" id="7783023">idleMu</span><span class="op" id="7783029">.</span><span class="ident" id="7783030">Unlock</span><span class="op" id="7783036">(</span><span class="op" id="7783037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7783040">if</span>&nbsp;<span class="ident" id="7783043">t</span><span class="op" id="7783044">.</span><span class="ident" id="7783045">idleConn</span>&nbsp;<span class="op" id="7783054">==</span>&nbsp;<span class="ident" id="7783057">nil</span>&nbsp;<span class="op" id="7783061">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7783065">return</span>&nbsp;<span class="num" id="7783072">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7783075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7783078">for</span>&nbsp;<span class="ident" id="7783082">k</span><span class="op" id="7783083">,</span>&nbsp;<span class="ident" id="7783085">conns</span>&nbsp;<span class="op" id="7783091">:=</span>&nbsp;<span class="keyword" id="7783094">range</span>&nbsp;<span class="ident" id="7783100">t</span><span class="op" id="7783101">.</span><span class="ident" id="7783102">idleConn</span>&nbsp;<span class="op" id="7783111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7783115">if</span>&nbsp;<span class="ident" id="7783118">k</span><span class="op" id="7783119">.</span><span class="ident" id="7783120">String</span><span class="op" id="7783126">(</span><span class="op" id="7783127">)</span>&nbsp;<span class="op" id="7783129">==</span>&nbsp;<span class="ident" id="7783132">cacheKey</span>&nbsp;<span class="op" id="7783141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7783146">return</span>&nbsp;<span class="builtinfunc" id="7783153">len</span><span class="op" id="7783156">(</span><span class="ident" id="7783157">conns</span><span class="op" id="7783162">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7783166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7783169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7783172">return</span>&nbsp;<span class="num" id="7783179">0</span><br>
<span class="lineno"></span><span class="op" id="7783181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7783184">func</span>&nbsp;<span class="op" id="7783189">(</span><span class="ident" id="7783190">t</span>&nbsp;<span class="op" id="7783192">*</span><span class="ident" id="7783193">Transport</span><span class="op" id="7783202">)</span>&nbsp;<span class="ident" id="7783204">IdleConnChMapSizeForTesting</span><span class="op" id="7783231">(</span><span class="op" id="7783232">)</span>&nbsp;<span class="builtintype" id="7783234">int</span>&nbsp;<span class="op" id="7783238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7783241">t</span><span class="op" id="7783242">.</span><span class="ident" id="7783243">idleMu</span><span class="op" id="7783249">.</span><span class="ident" id="7783250">Lock</span><span class="op" id="7783254">(</span><span class="op" id="7783255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7783258">defer</span>&nbsp;<span class="ident" id="7783264">t</span><span class="op" id="7783265">.</span><span class="ident" id="7783266">idleMu</span><span class="op" id="7783272">.</span><span class="ident" id="7783273">Unlock</span><span class="op" id="7783279">(</span><span class="op" id="7783280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7783283">return</span>&nbsp;<span class="builtinfunc" id="7783290">len</span><span class="op" id="7783293">(</span><span class="ident" id="7783294">t</span><span class="op" id="7783295">.</span><span class="ident" id="7783296">idleConnCh</span><span class="op" id="7783306">)</span><br>
<span class="lineno"></span><span class="op" id="7783308">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="7783311">func</span>&nbsp;<span class="op" id="7783316">(</span><span class="ident" id="7783317">t</span>&nbsp;<span class="op" id="7783319">*</span><span class="ident" id="7783320">Transport</span><span class="op" id="7783329">)</span>&nbsp;<span class="ident" id="7783331">IsIdleForTesting</span><span class="op" id="7783347">(</span><span class="op" id="7783348">)</span>&nbsp;<span class="builtintype" id="7783350">bool</span>&nbsp;<span class="op" id="7783355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7783358">t</span><span class="op" id="7783359">.</span><span class="ident" id="7783360">idleMu</span><span class="op" id="7783366">.</span><span class="ident" id="7783367">Lock</span><span class="op" id="7783371">(</span><span class="op" id="7783372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7783375">defer</span>&nbsp;<span class="ident" id="7783381">t</span><span class="op" id="7783382">.</span><span class="ident" id="7783383">idleMu</span><span class="op" id="7783389">.</span><span class="ident" id="7783390">Unlock</span><span class="op" id="7783396">(</span><span class="op" id="7783397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7783400">return</span>&nbsp;<span class="ident" id="7783407">t</span><span class="op" id="7783408">.</span><span class="ident" id="7783409">wantIdle</span><br>
<span class="lineno">65</span><span class="op" id="7783418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7783421">func</span>&nbsp;<span class="op" id="7783426">(</span><span class="ident" id="7783427">t</span>&nbsp;<span class="op" id="7783429">*</span><span class="ident" id="7783430">Transport</span><span class="op" id="7783439">)</span>&nbsp;<span class="ident" id="7783441">RequestIdleConnChForTesting</span><span class="op" id="7783468">(</span><span class="op" id="7783469">)</span>&nbsp;<span class="op" id="7783471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7783474">t</span><span class="op" id="7783475">.</span><span class="ident" id="7783476">getIdleConnCh</span><span class="op" id="7783489">(</span><span class="ident" id="7783490">connectMethod</span><span class="op" id="7783503">{</span><span class="ident" id="7783504">nil</span><span class="op" id="7783507">,</span>&nbsp;<span class="string" id="7783509">&#34;http&#34;</span><span class="op" id="7783515">,</span>&nbsp;<span class="string" id="7783517">&#34;example.com&#34;</span><span class="op" id="7783530">}</span><span class="op" id="7783531">)</span><br>
<span class="lineno"></span><span class="op" id="7783533">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7783536">func</span>&nbsp;<span class="op" id="7783541">(</span><span class="ident" id="7783542">t</span>&nbsp;<span class="op" id="7783544">*</span><span class="ident" id="7783545">Transport</span><span class="op" id="7783554">)</span>&nbsp;<span class="ident" id="7783556">PutIdleTestConn</span><span class="op" id="7783571">(</span><span class="op" id="7783572">)</span>&nbsp;<span class="builtintype" id="7783574">bool</span>&nbsp;<span class="op" id="7783579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7783582">c</span><span class="op" id="7783583">,</span>&nbsp;<span class="ident" id="7783585">_</span>&nbsp;<span class="op" id="7783587">:=</span>&nbsp;<span class="ident" id="7783590">net</span><span class="op" id="7783593">.</span><span class="ident" id="7783594">Pipe</span><span class="op" id="7783598">(</span><span class="op" id="7783599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7783602">return</span>&nbsp;<span class="ident" id="7783609">t</span><span class="op" id="7783610">.</span><span class="ident" id="7783611">putIdleConn</span><span class="op" id="7783622">(</span><span class="op" id="7783623">&amp;</span><span class="ident" id="7783624">persistConn</span><span class="op" id="7783635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7783639">t</span><span class="op" id="7783640">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783649">t</span><span class="op" id="7783650">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7783654">conn</span><span class="op" id="7783658">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7783664">c</span><span class="op" id="7783665">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7783685">//&nbsp;dummy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7783696">closech</span><span class="op" id="7783703">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="7783706">make</span><span class="op" id="7783710">(</span><span class="keyword" id="7783711">chan</span>&nbsp;<span class="keyword" id="7783716">struct</span><span class="op" id="7783722">{</span><span class="op" id="7783723">}</span><span class="op" id="7783724">)</span><span class="op" id="7783725">,</span>&nbsp;<span class="comment" id="7783727">//&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7783752">cacheKey</span><span class="op" id="7783760">:</span>&nbsp;<span class="ident" id="7783762">connectMethodKey</span><span class="op" id="7783778">{</span><span class="string" id="7783779">&#34;&#34;</span><span class="op" id="7783781">,</span>&nbsp;<span class="string" id="7783783">&#34;http&#34;</span><span class="op" id="7783789">,</span>&nbsp;<span class="string" id="7783791">&#34;example.com&#34;</span><span class="op" id="7783804">}</span><span class="op" id="7783805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7783808">}</span><span class="op" id="7783809">)</span><br>
<span class="lineno"></span><span class="op" id="7783811">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="7783814">func</span>&nbsp;<span class="ident" id="7783819">NewTestTimeoutHandler</span><span class="op" id="7783840">(</span><span class="ident" id="7783841">handler</span>&nbsp;<span class="ident" id="7783849">Handler</span><span class="op" id="7783856">,</span>&nbsp;<span class="ident" id="7783858">ch</span>&nbsp;<span class="op" id="7783861">&lt;-</span><span class="keyword" id="7783863">chan</span>&nbsp;<span class="ident" id="7783868">time</span><span class="op" id="7783872">.</span><span class="ident" id="7783873">Time</span><span class="op" id="7783877">)</span>&nbsp;<span class="ident" id="7783879">Handler</span>&nbsp;<span class="op" id="7783887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7783890">f</span>&nbsp;<span class="op" id="7783892">:=</span>&nbsp;<span class="keyword" id="7783895">func</span><span class="op" id="7783899">(</span><span class="op" id="7783900">)</span>&nbsp;<span class="op" id="7783902">&lt;-</span><span class="keyword" id="7783904">chan</span>&nbsp;<span class="ident" id="7783909">time</span><span class="op" id="7783913">.</span><span class="ident" id="7783914">Time</span>&nbsp;<span class="op" id="7783919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7783923">return</span>&nbsp;<span class="ident" id="7783930">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7783934">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7783937">return</span>&nbsp;<span class="op" id="7783944">&amp;</span><span class="ident" id="7783945">timeoutHandler</span><span class="op" id="7783959">{</span><span class="ident" id="7783960">handler</span><span class="op" id="7783967">,</span>&nbsp;<span class="ident" id="7783969">f</span><span class="op" id="7783970">,</span>&nbsp;<span class="string" id="7783972">&#34;&#34;</span><span class="op" id="7783974">}</span><br>
<span class="lineno"></span><span class="op" id="7783976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7783979">func</span>&nbsp;<span class="ident" id="7783984">ResetCachedEnvironment</span><span class="op" id="7784006">(</span><span class="op" id="7784007">)</span>&nbsp;<span class="op" id="7784009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7784012">httpProxyEnv</span><span class="op" id="7784024">.</span><span class="ident" id="7784025">reset</span><span class="op" id="7784030">(</span><span class="op" id="7784031">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7784034">httpsProxyEnv</span><span class="op" id="7784047">.</span><span class="ident" id="7784048">reset</span><span class="op" id="7784053">(</span><span class="op" id="7784054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7784057">noProxyEnv</span><span class="op" id="7784067">.</span><span class="ident" id="7784068">reset</span><span class="op" id="7784073">(</span><span class="op" id="7784074">)</span><br>
<span class="lineno"></span><span class="op" id="7784076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7784079">var</span>&nbsp;<span class="ident" id="7784083">DefaultUserAgent</span>&nbsp;<span class="op" id="7784100">=</span>&nbsp;<span class="ident" id="7784102">defaultUserAgent</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="7784120">func</span>&nbsp;<span class="ident" id="7784125">ExportRefererForURL</span><span class="op" id="7784144">(</span><span class="ident" id="7784145">lastReq</span><span class="op" id="7784152">,</span>&nbsp;<span class="ident" id="7784154">newReq</span>&nbsp;<span class="op" id="7784161">*</span><span class="ident" id="7784162">url</span><span class="op" id="7784165">.</span><span class="ident" id="7784166">URL</span><span class="op" id="7784169">)</span>&nbsp;<span class="builtintype" id="7784171">string</span>&nbsp;<span class="op" id="7784178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7784181">return</span>&nbsp;<span class="ident" id="7784188">refererForURL</span><span class="op" id="7784201">(</span><span class="ident" id="7784202">lastReq</span><span class="op" id="7784209">,</span>&nbsp;<span class="ident" id="7784211">newReq</span><span class="op" id="7784217">)</span><br>
<span class="lineno"></span><span class="op" id="7784219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="7784222">//&nbsp;SetPendingDialHooks&nbsp;sets&nbsp;the&nbsp;hooks&nbsp;that&nbsp;run&nbsp;before&nbsp;and&nbsp;after&nbsp;handling</span><br>
<span class="lineno"></span><span class="comment" id="7784295">//&nbsp;pending&nbsp;dials.</span><br>
<span class="lineno"></span><span class="keyword" id="7784313">func</span>&nbsp;<span class="ident" id="7784318">SetPendingDialHooks</span><span class="op" id="7784337">(</span><span class="ident" id="7784338">before</span><span class="op" id="7784344">,</span>&nbsp;<span class="ident" id="7784346">after</span>&nbsp;<span class="keyword" id="7784352">func</span><span class="op" id="7784356">(</span><span class="op" id="7784357">)</span><span class="op" id="7784358">)</span>&nbsp;<span class="op" id="7784360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7784363">prePendingDial</span><span class="op" id="7784377">,</span>&nbsp;<span class="ident" id="7784379">postPendingDial</span>&nbsp;<span class="op" id="7784395">=</span>&nbsp;<span class="ident" id="7784397">before</span><span class="op" id="7784403">,</span>&nbsp;<span class="ident" id="7784405">after</span><br>
<span class="lineno"></span><span class="op" id="7784411">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7784414">var</span>&nbsp;<span class="ident" id="7784418">ExportServerNewConn</span>&nbsp;<span class="op" id="7784438">=</span>&nbsp;<span class="op" id="7784440">(</span><span class="op" id="7784441">*</span><span class="ident" id="7784442">Server</span><span class="op" id="7784448">)</span><span class="op" id="7784449">.</span><span class="ident" id="7784450">newConn</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7784459">var</span>&nbsp;<span class="ident" id="7784463">ExportCloseWriteAndWait</span>&nbsp;<span class="op" id="7784487">=</span>&nbsp;<span class="op" id="7784489">(</span><span class="op" id="7784490">*</span><span class="ident" id="7784491">conn</span><span class="op" id="7784495">)</span><span class="op" id="7784496">.</span><span class="ident" id="7784497">closeWriteAndWait</span>
</div>
</body>
</html>
