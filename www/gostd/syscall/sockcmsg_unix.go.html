<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html" class="current">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2398846">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2398902">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2398956">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2399007">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2399072">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2399100">package</span>&nbsp;<span class="ident" id="2399108">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2399117">import</span>&nbsp;<span class="string" id="2399124">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2399134">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;raw&nbsp;sockaddr&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2399197">func</span>&nbsp;<span class="ident" id="2399202">cmsgAlignOf</span><span class="op" id="2399213">(</span><span class="ident" id="2399214">salen</span>&nbsp;<span class="builtintype" id="2399220">int</span><span class="op" id="2399223">)</span>&nbsp;<span class="builtintype" id="2399225">int</span>&nbsp;<span class="op" id="2399229">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2399232">salign</span>&nbsp;<span class="op" id="2399239">:=</span>&nbsp;<span class="ident" id="2399242">sizeofPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2399253">//&nbsp;NOTE:&nbsp;It&nbsp;seems&nbsp;like&nbsp;64-bit&nbsp;Darwin&nbsp;and&nbsp;DragonFly&nbsp;BSD&nbsp;kernels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2399317">//&nbsp;still&nbsp;require&nbsp;32-bit&nbsp;aligned&nbsp;access&nbsp;to&nbsp;network&nbsp;subsystem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2399379">if</span>&nbsp;<span class="ident" id="2399382">darwin64Bit</span>&nbsp;<span class="op" id="2399394">||</span>&nbsp;<span class="ident" id="2399397">dragonfly64Bit</span>&nbsp;<span class="op" id="2399412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2399416">salign</span>&nbsp;<span class="op" id="2399423">=</span>&nbsp;<span class="num" id="2399425">4</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2399428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2399431">return</span>&nbsp;<span class="op" id="2399438">(</span><span class="ident" id="2399439">salen</span>&nbsp;<span class="op" id="2399445">+</span>&nbsp;<span class="ident" id="2399447">salign</span>&nbsp;<span class="op" id="2399454">-</span>&nbsp;<span class="num" id="2399456">1</span><span class="op" id="2399457">)</span>&nbsp;<span class="op" id="2399459">&amp;</span>&nbsp;<span class="op" id="2399461">^</span><span class="op" id="2399462">(</span><span class="ident" id="2399463">salign</span>&nbsp;<span class="op" id="2399470">-</span>&nbsp;<span class="num" id="2399472">1</span><span class="op" id="2399473">)</span><br>
<span class="lineno"></span><span class="op" id="2399475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2399478">//&nbsp;CmsgLen&nbsp;returns&nbsp;the&nbsp;value&nbsp;to&nbsp;store&nbsp;in&nbsp;the&nbsp;Len&nbsp;field&nbsp;of&nbsp;the&nbsp;Cmsghdr</span><br>
<span class="lineno">25</span><span class="comment" id="2399548">//&nbsp;structure,&nbsp;taking&nbsp;into&nbsp;account&nbsp;any&nbsp;necessary&nbsp;alignment.</span><br>
<span class="lineno"></span><span class="keyword" id="2399607">func</span>&nbsp;<span class="ident" id="2399612">CmsgLen</span><span class="op" id="2399619">(</span><span class="ident" id="2399620">datalen</span>&nbsp;<span class="builtintype" id="2399628">int</span><span class="op" id="2399631">)</span>&nbsp;<span class="builtintype" id="2399633">int</span>&nbsp;<span class="op" id="2399637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2399640">return</span>&nbsp;<span class="ident" id="2399647">cmsgAlignOf</span><span class="op" id="2399658">(</span><span class="ident" id="2399659">SizeofCmsghdr</span><span class="op" id="2399672">)</span>&nbsp;<span class="op" id="2399674">+</span>&nbsp;<span class="ident" id="2399676">datalen</span><br>
<span class="lineno"></span><span class="op" id="2399684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2399687">//&nbsp;CmsgSpace&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;an&nbsp;ancillary&nbsp;element&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="2399754">//&nbsp;payload&nbsp;of&nbsp;the&nbsp;passed&nbsp;data&nbsp;length&nbsp;occupies.</span><br>
<span class="lineno"></span><span class="keyword" id="2399801">func</span>&nbsp;<span class="ident" id="2399806">CmsgSpace</span><span class="op" id="2399815">(</span><span class="ident" id="2399816">datalen</span>&nbsp;<span class="builtintype" id="2399824">int</span><span class="op" id="2399827">)</span>&nbsp;<span class="builtintype" id="2399829">int</span>&nbsp;<span class="op" id="2399833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2399836">return</span>&nbsp;<span class="ident" id="2399843">cmsgAlignOf</span><span class="op" id="2399854">(</span><span class="ident" id="2399855">SizeofCmsghdr</span><span class="op" id="2399868">)</span>&nbsp;<span class="op" id="2399870">+</span>&nbsp;<span class="ident" id="2399872">cmsgAlignOf</span><span class="op" id="2399883">(</span><span class="ident" id="2399884">datalen</span><span class="op" id="2399891">)</span><br>
<span class="lineno"></span><span class="op" id="2399893">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2399896">func</span>&nbsp;<span class="ident" id="2399901">cmsgData</span><span class="op" id="2399909">(</span><span class="ident" id="2399910">h</span>&nbsp;<span class="op" id="2399912">*</span><span class="ident" id="2399913">Cmsghdr</span><span class="op" id="2399920">)</span>&nbsp;<span class="ident" id="2399922">unsafe</span><span class="op" id="2399928">.</span><span class="ident" id="2399929">Pointer</span>&nbsp;<span class="op" id="2399937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2399940">return</span>&nbsp;<span class="ident" id="2399947">unsafe</span><span class="op" id="2399953">.</span><span class="ident" id="2399954">Pointer</span><span class="op" id="2399961">(</span><span class="builtintype" id="2399962">uintptr</span><span class="op" id="2399969">(</span><span class="ident" id="2399970">unsafe</span><span class="op" id="2399976">.</span><span class="ident" id="2399977">Pointer</span><span class="op" id="2399984">(</span><span class="ident" id="2399985">h</span><span class="op" id="2399986">)</span><span class="op" id="2399987">)</span>&nbsp;<span class="op" id="2399989">+</span>&nbsp;<span class="builtintype" id="2399991">uintptr</span><span class="op" id="2399998">(</span><span class="ident" id="2399999">cmsgAlignOf</span><span class="op" id="2400010">(</span><span class="ident" id="2400011">SizeofCmsghdr</span><span class="op" id="2400024">)</span><span class="op" id="2400025">)</span><span class="op" id="2400026">)</span><br>
<span class="lineno"></span><span class="op" id="2400028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2400031">//&nbsp;SocketControlMessage&nbsp;represents&nbsp;a&nbsp;socket&nbsp;control&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2400092">type</span>&nbsp;<span class="ident" id="2400097">SocketControlMessage</span>&nbsp;<span class="keyword" id="2400118">struct</span>&nbsp;<span class="op" id="2400125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2400128">Header</span>&nbsp;<span class="ident" id="2400135">Cmsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2400144">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2400151">[</span><span class="op" id="2400152">]</span><span class="builtintype" id="2400153">byte</span><br>
<span class="lineno"></span><span class="op" id="2400158">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2400161">//&nbsp;ParseSocketControlMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;socket&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="2400229">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="2400242">func</span>&nbsp;<span class="ident" id="2400247">ParseSocketControlMessage</span><span class="op" id="2400272">(</span><span class="ident" id="2400273">b</span>&nbsp;<span class="op" id="2400275">[</span><span class="op" id="2400276">]</span><span class="builtintype" id="2400277">byte</span><span class="op" id="2400281">)</span>&nbsp;<span class="op" id="2400283">(</span><span class="op" id="2400284">[</span><span class="op" id="2400285">]</span><span class="ident" id="2400286">SocketControlMessage</span><span class="op" id="2400306">,</span>&nbsp;<span class="builtintype" id="2400308">error</span><span class="op" id="2400313">)</span>&nbsp;<span class="op" id="2400315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2400318">var</span>&nbsp;<span class="ident" id="2400322">msgs</span>&nbsp;<span class="op" id="2400327">[</span><span class="op" id="2400328">]</span><span class="ident" id="2400329">SocketControlMessage</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2400351">i</span>&nbsp;<span class="op" id="2400353">:=</span>&nbsp;<span class="num" id="2400356">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2400359">for</span>&nbsp;<span class="ident" id="2400363">i</span><span class="op" id="2400364">+</span><span class="ident" id="2400365">CmsgLen</span><span class="op" id="2400372">(</span><span class="num" id="2400373">0</span><span class="op" id="2400374">)</span>&nbsp;<span class="op" id="2400376">&lt;=</span>&nbsp;<span class="builtinfunc" id="2400379">len</span><span class="op" id="2400382">(</span><span class="ident" id="2400383">b</span><span class="op" id="2400384">)</span>&nbsp;<span class="op" id="2400386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2400390">h</span><span class="op" id="2400391">,</span>&nbsp;<span class="ident" id="2400393">dbuf</span><span class="op" id="2400397">,</span>&nbsp;<span class="ident" id="2400399">err</span>&nbsp;<span class="op" id="2400403">:=</span>&nbsp;<span class="ident" id="2400406">socketControlMessageHeaderAndData</span><span class="op" id="2400439">(</span><span class="ident" id="2400440">b</span><span class="op" id="2400441">[</span><span class="ident" id="2400442">i</span><span class="op" id="2400443">:</span><span class="op" id="2400444">]</span><span class="op" id="2400445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2400449">if</span>&nbsp;<span class="ident" id="2400452">err</span>&nbsp;<span class="op" id="2400456">!=</span>&nbsp;<span class="builtintype" id="2400459">nil</span>&nbsp;<span class="op" id="2400463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2400468">return</span>&nbsp;<span class="builtintype" id="2400475">nil</span><span class="op" id="2400478">,</span>&nbsp;<span class="ident" id="2400480">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2400486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2400490">m</span>&nbsp;<span class="op" id="2400492">:=</span>&nbsp;<span class="ident" id="2400495">SocketControlMessage</span><span class="op" id="2400515">{</span><span class="ident" id="2400516">Header</span><span class="op" id="2400522">:</span>&nbsp;<span class="op" id="2400524">*</span><span class="ident" id="2400525">h</span><span class="op" id="2400526">,</span>&nbsp;<span class="ident" id="2400528">Data</span><span class="op" id="2400532">:</span>&nbsp;<span class="ident" id="2400534">dbuf</span><span class="op" id="2400538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2400542">msgs</span>&nbsp;<span class="op" id="2400547">=</span>&nbsp;<span class="builtinfunc" id="2400549">append</span><span class="op" id="2400555">(</span><span class="ident" id="2400556">msgs</span><span class="op" id="2400560">,</span>&nbsp;<span class="ident" id="2400562">m</span><span class="op" id="2400563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2400567">i</span>&nbsp;<span class="op" id="2400569">+=</span>&nbsp;<span class="ident" id="2400572">cmsgAlignOf</span><span class="op" id="2400583">(</span><span class="builtintype" id="2400584">int</span><span class="op" id="2400587">(</span><span class="ident" id="2400588">h</span><span class="op" id="2400589">.</span><span class="ident" id="2400590">Len</span><span class="op" id="2400593">)</span><span class="op" id="2400594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2400597">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2400600">return</span>&nbsp;<span class="ident" id="2400607">msgs</span><span class="op" id="2400611">,</span>&nbsp;<span class="builtintype" id="2400613">nil</span><br>
<span class="lineno"></span><span class="op" id="2400617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2400620">func</span>&nbsp;<span class="ident" id="2400625">socketControlMessageHeaderAndData</span><span class="op" id="2400658">(</span><span class="ident" id="2400659">b</span>&nbsp;<span class="op" id="2400661">[</span><span class="op" id="2400662">]</span><span class="builtintype" id="2400663">byte</span><span class="op" id="2400667">)</span>&nbsp;<span class="op" id="2400669">(</span><span class="op" id="2400670">*</span><span class="ident" id="2400671">Cmsghdr</span><span class="op" id="2400678">,</span>&nbsp;<span class="op" id="2400680">[</span><span class="op" id="2400681">]</span><span class="builtintype" id="2400682">byte</span><span class="op" id="2400686">,</span>&nbsp;<span class="builtintype" id="2400688">error</span><span class="op" id="2400693">)</span>&nbsp;<span class="op" id="2400695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2400698">h</span>&nbsp;<span class="op" id="2400700">:=</span>&nbsp;<span class="op" id="2400703">(</span><span class="op" id="2400704">*</span><span class="ident" id="2400705">Cmsghdr</span><span class="op" id="2400712">)</span><span class="op" id="2400713">(</span><span class="ident" id="2400714">unsafe</span><span class="op" id="2400720">.</span><span class="ident" id="2400721">Pointer</span><span class="op" id="2400728">(</span><span class="op" id="2400729">&amp;</span><span class="ident" id="2400730">b</span><span class="op" id="2400731">[</span><span class="num" id="2400732">0</span><span class="op" id="2400733">]</span><span class="op" id="2400734">)</span><span class="op" id="2400735">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2400738">if</span>&nbsp;<span class="ident" id="2400741">h</span><span class="op" id="2400742">.</span><span class="ident" id="2400743">Len</span>&nbsp;<span class="op" id="2400747">&lt;</span>&nbsp;<span class="ident" id="2400749">SizeofCmsghdr</span>&nbsp;<span class="op" id="2400763">||</span>&nbsp;<span class="builtintype" id="2400766">int</span><span class="op" id="2400769">(</span><span class="ident" id="2400770">h</span><span class="op" id="2400771">.</span><span class="ident" id="2400772">Len</span><span class="op" id="2400775">)</span>&nbsp;<span class="op" id="2400777">&gt;</span>&nbsp;<span class="builtinfunc" id="2400779">len</span><span class="op" id="2400782">(</span><span class="ident" id="2400783">b</span><span class="op" id="2400784">)</span>&nbsp;<span class="op" id="2400786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2400790">return</span>&nbsp;<span class="builtintype" id="2400797">nil</span><span class="op" id="2400800">,</span>&nbsp;<span class="builtintype" id="2400802">nil</span><span class="op" id="2400805">,</span>&nbsp;<span class="ident" id="2400807">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2400815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2400818">return</span>&nbsp;<span class="ident" id="2400825">h</span><span class="op" id="2400826">,</span>&nbsp;<span class="ident" id="2400828">b</span><span class="op" id="2400829">[</span><span class="ident" id="2400830">cmsgAlignOf</span><span class="op" id="2400841">(</span><span class="ident" id="2400842">SizeofCmsghdr</span><span class="op" id="2400855">)</span><span class="op" id="2400856">:</span><span class="ident" id="2400857">h</span><span class="op" id="2400858">.</span><span class="ident" id="2400859">Len</span><span class="op" id="2400862">]</span><span class="op" id="2400863">,</span>&nbsp;<span class="builtintype" id="2400865">nil</span><br>
<span class="lineno"></span><span class="op" id="2400869">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="2400872">//&nbsp;UnixRights&nbsp;encodes&nbsp;a&nbsp;set&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;into&nbsp;a&nbsp;socket</span><br>
<span class="lineno"></span><span class="comment" id="2400939">//&nbsp;control&nbsp;message&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="2400990">func</span>&nbsp;<span class="ident" id="2400995">UnixRights</span><span class="op" id="2401005">(</span><span class="ident" id="2401006">fds</span>&nbsp;<span class="op" id="2401010">...</span><span class="builtintype" id="2401013">int</span><span class="op" id="2401016">)</span>&nbsp;<span class="op" id="2401018">[</span><span class="op" id="2401019">]</span><span class="builtintype" id="2401020">byte</span>&nbsp;<span class="op" id="2401025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2401028">datalen</span>&nbsp;<span class="op" id="2401036">:=</span>&nbsp;<span class="builtinfunc" id="2401039">len</span><span class="op" id="2401042">(</span><span class="ident" id="2401043">fds</span><span class="op" id="2401046">)</span>&nbsp;<span class="op" id="2401048">*</span>&nbsp;<span class="num" id="2401050">4</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2401053">b</span>&nbsp;<span class="op" id="2401055">:=</span>&nbsp;<span class="builtinfunc" id="2401058">make</span><span class="op" id="2401062">(</span><span class="op" id="2401063">[</span><span class="op" id="2401064">]</span><span class="builtintype" id="2401065">byte</span><span class="op" id="2401069">,</span>&nbsp;<span class="ident" id="2401071">CmsgSpace</span><span class="op" id="2401080">(</span><span class="ident" id="2401081">datalen</span><span class="op" id="2401088">)</span><span class="op" id="2401089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2401092">h</span>&nbsp;<span class="op" id="2401094">:=</span>&nbsp;<span class="op" id="2401097">(</span><span class="op" id="2401098">*</span><span class="ident" id="2401099">Cmsghdr</span><span class="op" id="2401106">)</span><span class="op" id="2401107">(</span><span class="ident" id="2401108">unsafe</span><span class="op" id="2401114">.</span><span class="ident" id="2401115">Pointer</span><span class="op" id="2401122">(</span><span class="op" id="2401123">&amp;</span><span class="ident" id="2401124">b</span><span class="op" id="2401125">[</span><span class="num" id="2401126">0</span><span class="op" id="2401127">]</span><span class="op" id="2401128">)</span><span class="op" id="2401129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2401132">h</span><span class="op" id="2401133">.</span><span class="ident" id="2401134">Level</span>&nbsp;<span class="op" id="2401140">=</span>&nbsp;<span class="ident" id="2401142">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2401154">h</span><span class="op" id="2401155">.</span><span class="ident" id="2401156">Type</span>&nbsp;<span class="op" id="2401161">=</span>&nbsp;<span class="ident" id="2401163">SCM_RIGHTS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2401175">h</span><span class="op" id="2401176">.</span><span class="ident" id="2401177">SetLen</span><span class="op" id="2401183">(</span><span class="ident" id="2401184">CmsgLen</span><span class="op" id="2401191">(</span><span class="ident" id="2401192">datalen</span><span class="op" id="2401199">)</span><span class="op" id="2401200">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2401203">data</span>&nbsp;<span class="op" id="2401208">:=</span>&nbsp;<span class="builtintype" id="2401211">uintptr</span><span class="op" id="2401218">(</span><span class="ident" id="2401219">cmsgData</span><span class="op" id="2401227">(</span><span class="ident" id="2401228">h</span><span class="op" id="2401229">)</span><span class="op" id="2401230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2401233">for</span>&nbsp;<span class="ident" id="2401237">_</span><span class="op" id="2401238">,</span>&nbsp;<span class="ident" id="2401240">fd</span>&nbsp;<span class="op" id="2401243">:=</span>&nbsp;<span class="keyword" id="2401246">range</span>&nbsp;<span class="ident" id="2401252">fds</span>&nbsp;<span class="op" id="2401256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2401260">*</span><span class="op" id="2401261">(</span><span class="op" id="2401262">*</span><span class="builtintype" id="2401263">int32</span><span class="op" id="2401268">)</span><span class="op" id="2401269">(</span><span class="ident" id="2401270">unsafe</span><span class="op" id="2401276">.</span><span class="ident" id="2401277">Pointer</span><span class="op" id="2401284">(</span><span class="ident" id="2401285">data</span><span class="op" id="2401289">)</span><span class="op" id="2401290">)</span>&nbsp;<span class="op" id="2401292">=</span>&nbsp;<span class="builtintype" id="2401294">int32</span><span class="op" id="2401299">(</span><span class="ident" id="2401300">fd</span><span class="op" id="2401302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2401306">data</span>&nbsp;<span class="op" id="2401311">+=</span>&nbsp;<span class="num" id="2401314">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2401317">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2401320">return</span>&nbsp;<span class="ident" id="2401327">b</span><br>
<span class="lineno"></span><span class="op" id="2401329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2401332">//&nbsp;ParseUnixRights&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2401401">//&nbsp;integer&nbsp;array&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;from&nbsp;another&nbsp;process.</span><br>
<span class="lineno">90</span><span class="keyword" id="2401465">func</span>&nbsp;<span class="ident" id="2401470">ParseUnixRights</span><span class="op" id="2401485">(</span><span class="ident" id="2401486">m</span>&nbsp;<span class="op" id="2401488">*</span><span class="ident" id="2401489">SocketControlMessage</span><span class="op" id="2401509">)</span>&nbsp;<span class="op" id="2401511">(</span><span class="op" id="2401512">[</span><span class="op" id="2401513">]</span><span class="builtintype" id="2401514">int</span><span class="op" id="2401517">,</span>&nbsp;<span class="builtintype" id="2401519">error</span><span class="op" id="2401524">)</span>&nbsp;<span class="op" id="2401526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2401529">if</span>&nbsp;<span class="ident" id="2401532">m</span><span class="op" id="2401533">.</span><span class="ident" id="2401534">Header</span><span class="op" id="2401540">.</span><span class="ident" id="2401541">Level</span>&nbsp;<span class="op" id="2401547">!=</span>&nbsp;<span class="ident" id="2401550">SOL_SOCKET</span>&nbsp;<span class="op" id="2401561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2401565">return</span>&nbsp;<span class="builtintype" id="2401572">nil</span><span class="op" id="2401575">,</span>&nbsp;<span class="ident" id="2401577">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2401585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2401588">if</span>&nbsp;<span class="ident" id="2401591">m</span><span class="op" id="2401592">.</span><span class="ident" id="2401593">Header</span><span class="op" id="2401599">.</span><span class="ident" id="2401600">Type</span>&nbsp;<span class="op" id="2401605">!=</span>&nbsp;<span class="ident" id="2401608">SCM_RIGHTS</span>&nbsp;<span class="op" id="2401619">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2401623">return</span>&nbsp;<span class="builtintype" id="2401630">nil</span><span class="op" id="2401633">,</span>&nbsp;<span class="ident" id="2401635">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2401643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2401646">fds</span>&nbsp;<span class="op" id="2401650">:=</span>&nbsp;<span class="builtinfunc" id="2401653">make</span><span class="op" id="2401657">(</span><span class="op" id="2401658">[</span><span class="op" id="2401659">]</span><span class="builtintype" id="2401660">int</span><span class="op" id="2401663">,</span>&nbsp;<span class="builtinfunc" id="2401665">len</span><span class="op" id="2401668">(</span><span class="ident" id="2401669">m</span><span class="op" id="2401670">.</span><span class="ident" id="2401671">Data</span><span class="op" id="2401675">)</span><span class="op" id="2401676">&gt;&gt;</span><span class="num" id="2401678">2</span><span class="op" id="2401679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2401682">for</span>&nbsp;<span class="ident" id="2401686">i</span><span class="op" id="2401687">,</span>&nbsp;<span class="ident" id="2401689">j</span>&nbsp;<span class="op" id="2401691">:=</span>&nbsp;<span class="num" id="2401694">0</span><span class="op" id="2401695">,</span>&nbsp;<span class="num" id="2401697">0</span><span class="op" id="2401698">;</span>&nbsp;<span class="ident" id="2401700">i</span>&nbsp;<span class="op" id="2401702">&lt;</span>&nbsp;<span class="builtinfunc" id="2401704">len</span><span class="op" id="2401707">(</span><span class="ident" id="2401708">m</span><span class="op" id="2401709">.</span><span class="ident" id="2401710">Data</span><span class="op" id="2401714">)</span><span class="op" id="2401715">;</span>&nbsp;<span class="ident" id="2401717">i</span>&nbsp;<span class="op" id="2401719">+=</span>&nbsp;<span class="num" id="2401722">4</span>&nbsp;<span class="op" id="2401724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2401728">fds</span><span class="op" id="2401731">[</span><span class="ident" id="2401732">j</span><span class="op" id="2401733">]</span>&nbsp;<span class="op" id="2401735">=</span>&nbsp;<span class="builtintype" id="2401737">int</span><span class="op" id="2401740">(</span><span class="op" id="2401741">*</span><span class="op" id="2401742">(</span><span class="op" id="2401743">*</span><span class="builtintype" id="2401744">int32</span><span class="op" id="2401749">)</span><span class="op" id="2401750">(</span><span class="ident" id="2401751">unsafe</span><span class="op" id="2401757">.</span><span class="ident" id="2401758">Pointer</span><span class="op" id="2401765">(</span><span class="op" id="2401766">&amp;</span><span class="ident" id="2401767">m</span><span class="op" id="2401768">.</span><span class="ident" id="2401769">Data</span><span class="op" id="2401773">[</span><span class="ident" id="2401774">i</span><span class="op" id="2401775">]</span><span class="op" id="2401776">)</span><span class="op" id="2401777">)</span><span class="op" id="2401778">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2401782">j</span><span class="op" id="2401783">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2401787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2401790">return</span>&nbsp;<span class="ident" id="2401797">fds</span><span class="op" id="2401800">,</span>&nbsp;<span class="builtintype" id="2401802">nil</span><br>
<span class="lineno"></span><span class="op" id="2401806">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
